const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index.es-hE72v8i0.js","./vendor-Bs7gn1Hv.js","./mui-DftQwFZt.js"])))=>i.map(i=>d[i]);
import{r as _,R as m0,j as a,c as g0,b as v0,_ as wm,F as x0,B as y0,C as b0,a as ue,A as Fd,d as w0,P as At,T as q,e as _0,f as Oe,I as jr,S as j0,D as Rd,g as Ce,h as S0,i as pr,k as io,l as vs,m as ui,n as Ll,o as Nl,p as ms,q as ld,L as oo,s as C0,t as lo,u as P0,v as co,w as k0,x as _m,M as A0,y as Zi,z as L0,E as qd,G as jm,H as Bd,J as Gc,K as Sm,Q as Cm,N as yh,O as Pm,U as Qc,V as km,W as bh,X as er,Y as Ct,Z as El,$ as N0,a0 as E0,a1 as Z,a2 as O0,a3 as xf,a4 as Ir,a5 as Yr,a6 as I0,a7 as jn,a8 as Sn,a9 as Kr,aa as yf,ab as Sr,ac as Cr,ad as Pr,ae as Nr,af as Bn,ag as es,ah as Jt,ai as Am,aj as Zt,ak as br,al as nn,am as an,an as sn,ao as Fl,ap as mi,aq as uo,ar as sa,as as ho,at as D0,au as _t,av as Lm,aw as Nm,ax as Ma,ay as Sa,az as Ca,aA as Fr,aB as Qe,aC as Pa,aD as Jc,aE as wh,aF as T0,aG as Em,aH as bf,aI as wf,aJ as Om,aK as M0,aL as _f,aM as Im,aN as F0,aO as Dm,aP as R0,aQ as q0,aR as B0,aS as jf,aT as U0,aU as W0}from"./mui-DftQwFZt.js";import{a as z0,g as Dr,b as $0}from"./vendor-Bs7gn1Hv.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();var Sc={},Sf;function H0(){if(Sf)return Sc;Sf=1;var t=z0();return Sc.createRoot=t.createRoot,Sc.hydrateRoot=t.hydrateRoot,Sc}var Y0=H0();const V0=Dr(Y0);/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ol(){return Ol=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Ol.apply(this,arguments)}var qs;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(qs||(qs={}));const Cf="popstate";function G0(t){t===void 0&&(t={});function e(s,i){let{pathname:o="/",search:l="",hash:u=""}=xi(s.location.hash.substr(1));return!o.startsWith("/")&&!o.startsWith(".")&&(o="/"+o),Ud("",{pathname:o,search:l,hash:u},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(s,i){let o=s.document.querySelector("base"),l="";if(o&&o.getAttribute("href")){let u=s.location.href,d=u.indexOf("#");l=d===-1?u:u.slice(0,d)}return l+"#"+(typeof i=="string"?i:Kc(i))}function n(s,i){_h(s.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(i)+")")}return J0(e,r,n,t)}function gn(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function _h(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Q0(){return Math.random().toString(36).substr(2,8)}function Pf(t,e){return{usr:t.state,key:t.key,idx:e}}function Ud(t,e,r,n){return r===void 0&&(r=null),Ol({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?xi(e):e,{state:r,key:e&&e.key||n||Q0()})}function Kc(t){let{pathname:e="/",search:r="",hash:n=""}=t;return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function xi(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substr(n),t=t.substr(0,n)),t&&(e.pathname=t)}return e}function J0(t,e,r,n){n===void 0&&(n={});let{window:s=document.defaultView,v5Compat:i=!1}=n,o=s.history,l=qs.Pop,u=null,d=f();d==null&&(d=0,o.replaceState(Ol({},o.state,{idx:d}),""));function f(){return(o.state||{idx:null}).idx}function m(){l=qs.Pop;let y=f(),j=y==null?null:y-d;d=y,u&&u({action:l,location:w.location,delta:j})}function v(y,j){l=qs.Push;let O=Ud(w.location,y,j);r&&r(O,y),d=f()+1;let k=Pf(O,d),I=w.createHref(O);try{o.pushState(k,"",I)}catch(H){if(H instanceof DOMException&&H.name==="DataCloneError")throw H;s.location.assign(I)}i&&u&&u({action:l,location:w.location,delta:1})}function p(y,j){l=qs.Replace;let O=Ud(w.location,y,j);r&&r(O,y),d=f();let k=Pf(O,d),I=w.createHref(O);o.replaceState(k,"",I),i&&u&&u({action:l,location:w.location,delta:0})}function b(y){let j=s.location.origin!=="null"?s.location.origin:s.location.href,O=typeof y=="string"?y:Kc(y);return O=O.replace(/ $/,"%20"),gn(j,"No window.location.(origin|href) available to create URL for href: "+O),new URL(O,j)}let w={get action(){return l},get location(){return t(s,o)},listen(y){if(u)throw new Error("A history only accepts one active listener");return s.addEventListener(Cf,m),u=y,()=>{s.removeEventListener(Cf,m),u=null}},createHref(y){return e(s,y)},createURL:b,encodeLocation(y){let j=b(y);return{pathname:j.pathname,search:j.search,hash:j.hash}},push:v,replace:p,go(y){return o.go(y)}};return w}var kf;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(kf||(kf={}));function K0(t,e,r){return r===void 0&&(r="/"),X0(t,e,r)}function X0(t,e,r,n){let s=typeof e=="string"?xi(e):e,i=jh(s.pathname||"/",r);if(i==null)return null;let o=Tm(t);Z0(o);let l=null;for(let u=0;l==null&&u<o.length;++u){let d=dv(i);l=lv(o[u],d)}return l}function Tm(t,e,r,n){e===void 0&&(e=[]),r===void 0&&(r=[]),n===void 0&&(n="");let s=(i,o,l)=>{let u={relativePath:l===void 0?i.path||"":l,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};u.relativePath.startsWith("/")&&(gn(u.relativePath.startsWith(n),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(n.length));let d=Ws([n,u.relativePath]),f=r.concat(u);i.children&&i.children.length>0&&(gn(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),Tm(i.children,e,f,d)),!(i.path==null&&!i.index)&&e.push({path:d,score:iv(d,i.index),routesMeta:f})};return t.forEach((i,o)=>{var l;if(i.path===""||!((l=i.path)!=null&&l.includes("?")))s(i,o);else for(let u of Mm(i.path))s(i,o,u)}),e}function Mm(t){let e=t.split("/");if(e.length===0)return[];let[r,...n]=e,s=r.endsWith("?"),i=r.replace(/\?$/,"");if(n.length===0)return s?[i,""]:[i];let o=Mm(n.join("/")),l=[];return l.push(...o.map(u=>u===""?i:[i,u].join("/"))),s&&l.push(...o),l.map(u=>t.startsWith("/")&&u===""?"/":u)}function Z0(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:ov(e.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const ev=/^:[\w-]+$/,tv=3,rv=2,nv=1,av=10,sv=-2,Af=t=>t==="*";function iv(t,e){let r=t.split("/"),n=r.length;return r.some(Af)&&(n+=sv),e&&(n+=rv),r.filter(s=>!Af(s)).reduce((s,i)=>s+(ev.test(i)?tv:i===""?nv:av),n)}function ov(t,e){return t.length===e.length&&t.slice(0,-1).every((n,s)=>n===e[s])?t[t.length-1]-e[e.length-1]:0}function lv(t,e,r){let{routesMeta:n}=t,s={},i="/",o=[];for(let l=0;l<n.length;++l){let u=n[l],d=l===n.length-1,f=i==="/"?e:e.slice(i.length)||"/",m=cv({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},f),v=u.route;if(!m)return null;Object.assign(s,m.params),o.push({params:s,pathname:Ws([i,m.pathname]),pathnameBase:mv(Ws([i,m.pathnameBase])),route:v}),m.pathnameBase!=="/"&&(i=Ws([i,m.pathnameBase]))}return o}function cv(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=uv(t.path,t.caseSensitive,t.end),s=e.match(r);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:n.reduce((d,f,m)=>{let{paramName:v,isOptional:p}=f;if(v==="*"){let w=l[m]||"";o=i.slice(0,i.length-w.length).replace(/(.)\/+$/,"$1")}const b=l[m];return p&&!b?d[v]=void 0:d[v]=(b||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:o,pattern:t}}function uv(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!0),_h(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let n=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,u)=>(n.push({paramName:l,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),n]}function dv(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return _h(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function jh(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,n=t.charAt(r);return n&&n!=="/"?null:t.slice(r)||"/"}function hv(t,e){e===void 0&&(e="/");let{pathname:r,search:n="",hash:s=""}=typeof t=="string"?xi(t):t;return{pathname:r?r.startsWith("/")?r:fv(r,e):e,search:gv(n),hash:vv(s)}}function fv(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?r.length>1&&r.pop():s!=="."&&r.push(s)}),r.length>1?r.join("/"):"/"}function cd(t,e,r,n){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function pv(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function Sh(t,e){let r=pv(t);return e?r.map((n,s)=>s===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function Ch(t,e,r,n){n===void 0&&(n=!1);let s;typeof t=="string"?s=xi(t):(s=Ol({},t),gn(!s.pathname||!s.pathname.includes("?"),cd("?","pathname","search",s)),gn(!s.pathname||!s.pathname.includes("#"),cd("#","pathname","hash",s)),gn(!s.search||!s.search.includes("#"),cd("#","search","hash",s)));let i=t===""||s.pathname==="",o=i?"/":s.pathname,l;if(o==null)l=r;else{let m=e.length-1;if(!n&&o.startsWith("..")){let v=o.split("/");for(;v[0]==="..";)v.shift(),m-=1;s.pathname=v.join("/")}l=m>=0?e[m]:"/"}let u=hv(s,l),d=o&&o!=="/"&&o.endsWith("/"),f=(i||o===".")&&r.endsWith("/");return!u.pathname.endsWith("/")&&(d||f)&&(u.pathname+="/"),u}const Ws=t=>t.join("/").replace(/\/\/+/g,"/"),mv=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),gv=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,vv=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function xv(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const Fm=["post","put","patch","delete"];new Set(Fm);const yv=["get",...Fm];new Set(yv);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Il(){return Il=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Il.apply(this,arguments)}const Ph=_.createContext(null),bv=_.createContext(null),Hs=_.createContext(null),fu=_.createContext(null),ts=_.createContext({outlet:null,matches:[],isDataRoute:!1}),Rm=_.createContext(null);function wv(t,e){let{relative:r}=e===void 0?{}:e;go()||gn(!1);let{basename:n,navigator:s}=_.useContext(Hs),{hash:i,pathname:o,search:l}=Bm(t,{relative:r}),u=o;return n!=="/"&&(u=o==="/"?n:Ws([n,o])),s.createHref({pathname:u,search:l,hash:i})}function go(){return _.useContext(fu)!=null}function yi(){return go()||gn(!1),_.useContext(fu).location}function qm(t){_.useContext(Hs).static||_.useLayoutEffect(t)}function Vr(){let{isDataRoute:t}=_.useContext(ts);return t?Mv():_v()}function _v(){go()||gn(!1);let t=_.useContext(Ph),{basename:e,future:r,navigator:n}=_.useContext(Hs),{matches:s}=_.useContext(ts),{pathname:i}=yi(),o=JSON.stringify(Sh(s,r.v7_relativeSplatPath)),l=_.useRef(!1);return qm(()=>{l.current=!0}),_.useCallback(function(d,f){if(f===void 0&&(f={}),!l.current)return;if(typeof d=="number"){n.go(d);return}let m=Ch(d,JSON.parse(o),i,f.relative==="path");t==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:Ws([e,m.pathname])),(f.replace?n.replace:n.push)(m,f.state,f)},[e,n,o,i,t])}const jv=_.createContext(null);function Sv(t){let e=_.useContext(ts).outlet;return e&&_.createElement(jv.Provider,{value:t},e)}function bi(){let{matches:t}=_.useContext(ts),e=t[t.length-1];return e?e.params:{}}function Bm(t,e){let{relative:r}=e===void 0?{}:e,{future:n}=_.useContext(Hs),{matches:s}=_.useContext(ts),{pathname:i}=yi(),o=JSON.stringify(Sh(s,n.v7_relativeSplatPath));return _.useMemo(()=>Ch(t,JSON.parse(o),i,r==="path"),[t,o,i,r])}function Cv(t,e){return Pv(t,e)}function Pv(t,e,r,n){go()||gn(!1);let{navigator:s}=_.useContext(Hs),{matches:i}=_.useContext(ts),o=i[i.length-1],l=o?o.params:{};o&&o.pathname;let u=o?o.pathnameBase:"/";o&&o.route;let d=yi(),f;if(e){var m;let y=typeof e=="string"?xi(e):e;u==="/"||(m=y.pathname)!=null&&m.startsWith(u)||gn(!1),f=y}else f=d;let v=f.pathname||"/",p=v;if(u!=="/"){let y=u.replace(/^\//,"").split("/");p="/"+v.replace(/^\//,"").split("/").slice(y.length).join("/")}let b=K0(t,{pathname:p}),w=Ev(b&&b.map(y=>Object.assign({},y,{params:Object.assign({},l,y.params),pathname:Ws([u,s.encodeLocation?s.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?u:Ws([u,s.encodeLocation?s.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),i,r,n);return e&&w?_.createElement(fu.Provider,{value:{location:Il({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:qs.Pop}},w):w}function kv(){let t=Tv(),e=xv(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return _.createElement(_.Fragment,null,_.createElement("h2",null,"Unexpected Application Error!"),_.createElement("h3",{style:{fontStyle:"italic"}},e),r?_.createElement("pre",{style:s},r):null,null)}const Av=_.createElement(kv,null);class Lv extends _.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,r){return r.location!==e.location||r.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:r.error,location:r.location,revalidation:e.revalidation||r.revalidation}}componentDidCatch(e,r){console.error("React Router caught the following error during render",e,r)}render(){return this.state.error!==void 0?_.createElement(ts.Provider,{value:this.props.routeContext},_.createElement(Rm.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Nv(t){let{routeContext:e,match:r,children:n}=t,s=_.useContext(Ph);return s&&s.static&&s.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=r.route.id),_.createElement(ts.Provider,{value:e},n)}function Ev(t,e,r,n){var s;if(e===void 0&&(e=[]),r===void 0&&(r=null),n===void 0&&(n=null),t==null){var i;if(!r)return null;if(r.errors)t=r.matches;else if((i=n)!=null&&i.v7_partialHydration&&e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let o=t,l=(s=r)==null?void 0:s.errors;if(l!=null){let f=o.findIndex(m=>m.route.id&&l?.[m.route.id]!==void 0);f>=0||gn(!1),o=o.slice(0,Math.min(o.length,f+1))}let u=!1,d=-1;if(r&&n&&n.v7_partialHydration)for(let f=0;f<o.length;f++){let m=o[f];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(d=f),m.route.id){let{loaderData:v,errors:p}=r,b=m.route.loader&&v[m.route.id]===void 0&&(!p||p[m.route.id]===void 0);if(m.route.lazy||b){u=!0,d>=0?o=o.slice(0,d+1):o=[o[0]];break}}}return o.reduceRight((f,m,v)=>{let p,b=!1,w=null,y=null;r&&(p=l&&m.route.id?l[m.route.id]:void 0,w=m.route.errorElement||Av,u&&(d<0&&v===0?(Fv("route-fallback"),b=!0,y=null):d===v&&(b=!0,y=m.route.hydrateFallbackElement||null)));let j=e.concat(o.slice(0,v+1)),O=()=>{let k;return p?k=w:b?k=y:m.route.Component?k=_.createElement(m.route.Component,null):m.route.element?k=m.route.element:k=f,_.createElement(Nv,{match:m,routeContext:{outlet:f,matches:j,isDataRoute:r!=null},children:k})};return r&&(m.route.ErrorBoundary||m.route.errorElement||v===0)?_.createElement(Lv,{location:r.location,revalidation:r.revalidation,component:w,error:p,children:O(),routeContext:{outlet:null,matches:j,isDataRoute:!0}}):O()},null)}var Um=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(Um||{}),Wm=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Wm||{});function Ov(t){let e=_.useContext(Ph);return e||gn(!1),e}function Iv(t){let e=_.useContext(bv);return e||gn(!1),e}function Dv(t){let e=_.useContext(ts);return e||gn(!1),e}function zm(t){let e=Dv(),r=e.matches[e.matches.length-1];return r.route.id||gn(!1),r.route.id}function Tv(){var t;let e=_.useContext(Rm),r=Iv(),n=zm();return e!==void 0?e:(t=r.errors)==null?void 0:t[n]}function Mv(){let{router:t}=Ov(Um.UseNavigateStable),e=zm(Wm.UseNavigateStable),r=_.useRef(!1);return qm(()=>{r.current=!0}),_.useCallback(function(s,i){i===void 0&&(i={}),r.current&&(typeof s=="number"?t.navigate(s):t.navigate(s,Il({fromRouteId:e},i)))},[t,e])}const Lf={};function Fv(t,e,r){Lf[t]||(Lf[t]=!0)}function Rv(t,e){t?.v7_startTransition,t?.v7_relativeSplatPath}function jl(t){let{to:e,replace:r,state:n,relative:s}=t;go()||gn(!1);let{future:i,static:o}=_.useContext(Hs),{matches:l}=_.useContext(ts),{pathname:u}=yi(),d=Vr(),f=Ch(e,Sh(l,i.v7_relativeSplatPath),u,s==="path"),m=JSON.stringify(f);return _.useEffect(()=>d(JSON.parse(m),{replace:r,state:n,relative:s}),[d,m,s,r,n]),null}function qv(t){return Sv(t.context)}function Xt(t){gn(!1)}function Bv(t){let{basename:e="/",children:r=null,location:n,navigationType:s=qs.Pop,navigator:i,static:o=!1,future:l}=t;go()&&gn(!1);let u=e.replace(/^\/*/,"/"),d=_.useMemo(()=>({basename:u,navigator:i,static:o,future:Il({v7_relativeSplatPath:!1},l)}),[u,l,i,o]);typeof n=="string"&&(n=xi(n));let{pathname:f="/",search:m="",hash:v="",state:p=null,key:b="default"}=n,w=_.useMemo(()=>{let y=jh(f,u);return y==null?null:{location:{pathname:y,search:m,hash:v,state:p,key:b},navigationType:s}},[u,f,m,v,p,b,s]);return w==null?null:_.createElement(Hs.Provider,{value:d},_.createElement(fu.Provider,{children:r,value:w}))}function Uv(t){let{children:e,location:r}=t;return Cv(Wd(e),r)}new Promise(()=>{});function Wd(t,e){e===void 0&&(e=[]);let r=[];return _.Children.forEach(t,(n,s)=>{if(!_.isValidElement(n))return;let i=[...e,s];if(n.type===_.Fragment){r.push.apply(r,Wd(n.props.children,i));return}n.type!==Xt&&gn(!1),!n.props.index||!n.props.children||gn(!1);let o={id:n.props.id||i.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=Wd(n.props.children,i)),r.push(o)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function zd(){return zd=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},zd.apply(this,arguments)}function Wv(t,e){if(t==null)return{};var r={},n=Object.keys(t),s,i;for(i=0;i<n.length;i++)s=n[i],!(e.indexOf(s)>=0)&&(r[s]=t[s]);return r}function zv(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function $v(t,e){return t.button===0&&(!e||e==="_self")&&!zv(t)}const Hv=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Yv="6";try{window.__reactRouterVersion=Yv}catch{}const Vv="startTransition",Nf=m0[Vv];function Gv(t){let{basename:e,children:r,future:n,window:s}=t,i=_.useRef();i.current==null&&(i.current=G0({window:s,v5Compat:!0}));let o=i.current,[l,u]=_.useState({action:o.action,location:o.location}),{v7_startTransition:d}=n||{},f=_.useCallback(m=>{d&&Nf?Nf(()=>u(m)):u(m)},[u,d]);return _.useLayoutEffect(()=>o.listen(f),[o,f]),_.useEffect(()=>Rv(n),[n]),_.createElement(Bv,{basename:e,children:r,location:l.location,navigationType:l.action,navigator:o,future:n})}const Qv=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Jv=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Kv=_.forwardRef(function(e,r){let{onClick:n,relative:s,reloadDocument:i,replace:o,state:l,target:u,to:d,preventScrollReset:f,viewTransition:m}=e,v=Wv(e,Hv),{basename:p}=_.useContext(Hs),b,w=!1;if(typeof d=="string"&&Jv.test(d)&&(b=d,Qv))try{let k=new URL(window.location.href),I=d.startsWith("//")?new URL(k.protocol+d):new URL(d),H=jh(I.pathname,p);I.origin===k.origin&&H!=null?d=H+I.search+I.hash:w=!0}catch{}let y=wv(d,{relative:s}),j=Xv(d,{replace:o,state:l,target:u,preventScrollReset:f,relative:s,viewTransition:m});function O(k){n&&n(k),k.defaultPrevented||j(k)}return _.createElement("a",zd({},v,{href:b||y,onClick:w||i?n:O,ref:r,target:u}))});var Ef;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Ef||(Ef={}));var Of;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(Of||(Of={}));function Xv(t,e){let{target:r,replace:n,state:s,preventScrollReset:i,relative:o,viewTransition:l}=e===void 0?{}:e,u=Vr(),d=yi(),f=Bm(t,{relative:o});return _.useCallback(m=>{if($v(m,r)){m.preventDefault();let v=n!==void 0?n:Kc(d)===Kc(f);u(t,{replace:v,state:s,preventScrollReset:i,relative:o,viewTransition:l})}},[d,u,f,n,s,r,t,i,o,l])}function $m(t,e){return function(){return t.apply(e,arguments)}}const{toString:Zv}=Object.prototype,{getPrototypeOf:kh}=Object,{iterator:pu,toStringTag:Hm}=Symbol,mu=(t=>e=>{const r=Zv.call(e);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Fa=t=>(t=t.toLowerCase(),e=>mu(e)===t),gu=t=>e=>typeof e===t,{isArray:vo}=Array,Dl=gu("undefined");function e2(t){return t!==null&&!Dl(t)&&t.constructor!==null&&!Dl(t.constructor)&&ia(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Ym=Fa("ArrayBuffer");function t2(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Ym(t.buffer),e}const r2=gu("string"),ia=gu("function"),Vm=gu("number"),vu=t=>t!==null&&typeof t=="object",n2=t=>t===!0||t===!1,Ic=t=>{if(mu(t)!=="object")return!1;const e=kh(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Hm in t)&&!(pu in t)},a2=Fa("Date"),s2=Fa("File"),i2=Fa("Blob"),o2=Fa("FileList"),l2=t=>vu(t)&&ia(t.pipe),c2=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||ia(t.append)&&((e=mu(t))==="formdata"||e==="object"&&ia(t.toString)&&t.toString()==="[object FormData]"))},u2=Fa("URLSearchParams"),[d2,h2,f2,p2]=["ReadableStream","Request","Response","Headers"].map(Fa),m2=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Rl(t,e,{allOwnKeys:r=!1}={}){if(t===null||typeof t>"u")return;let n,s;if(typeof t!="object"&&(t=[t]),vo(t))for(n=0,s=t.length;n<s;n++)e.call(null,t[n],n,t);else{const i=r?Object.getOwnPropertyNames(t):Object.keys(t),o=i.length;let l;for(n=0;n<o;n++)l=i[n],e.call(null,t[l],l,t)}}function Gm(t,e){e=e.toLowerCase();const r=Object.keys(t);let n=r.length,s;for(;n-- >0;)if(s=r[n],e===s.toLowerCase())return s;return null}const di=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Qm=t=>!Dl(t)&&t!==di;function $d(){const{caseless:t}=Qm(this)&&this||{},e={},r=(n,s)=>{const i=t&&Gm(e,s)||s;Ic(e[i])&&Ic(n)?e[i]=$d(e[i],n):Ic(n)?e[i]=$d({},n):vo(n)?e[i]=n.slice():e[i]=n};for(let n=0,s=arguments.length;n<s;n++)arguments[n]&&Rl(arguments[n],r);return e}const g2=(t,e,r,{allOwnKeys:n}={})=>(Rl(e,(s,i)=>{r&&ia(s)?t[i]=$m(s,r):t[i]=s},{allOwnKeys:n}),t),v2=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),x2=(t,e,r,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),r&&Object.assign(t.prototype,r)},y2=(t,e,r,n)=>{let s,i,o;const l={};if(e=e||{},t==null)return e;do{for(s=Object.getOwnPropertyNames(t),i=s.length;i-- >0;)o=s[i],(!n||n(o,t,e))&&!l[o]&&(e[o]=t[o],l[o]=!0);t=r!==!1&&kh(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype);return e},b2=(t,e,r)=>{t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=e.length;const n=t.indexOf(e,r);return n!==-1&&n===r},w2=t=>{if(!t)return null;if(vo(t))return t;let e=t.length;if(!Vm(e))return null;const r=new Array(e);for(;e-- >0;)r[e]=t[e];return r},_2=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&kh(Uint8Array)),j2=(t,e)=>{const n=(t&&t[pu]).call(t);let s;for(;(s=n.next())&&!s.done;){const i=s.value;e.call(t,i[0],i[1])}},S2=(t,e)=>{let r;const n=[];for(;(r=t.exec(e))!==null;)n.push(r);return n},C2=Fa("HTMLFormElement"),P2=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,s){return n.toUpperCase()+s}),If=(({hasOwnProperty:t})=>(e,r)=>t.call(e,r))(Object.prototype),k2=Fa("RegExp"),Jm=(t,e)=>{const r=Object.getOwnPropertyDescriptors(t),n={};Rl(r,(s,i)=>{let o;(o=e(s,i,t))!==!1&&(n[i]=o||s)}),Object.defineProperties(t,n)},A2=t=>{Jm(t,(e,r)=>{if(ia(t)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=t[r];if(ia(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},L2=(t,e)=>{const r={},n=s=>{s.forEach(i=>{r[i]=!0})};return vo(t)?n(t):n(String(t).split(e)),r},N2=()=>{},E2=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function O2(t){return!!(t&&ia(t.append)&&t[Hm]==="FormData"&&t[pu])}const I2=t=>{const e=new Array(10),r=(n,s)=>{if(vu(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[s]=n;const i=vo(n)?[]:{};return Rl(n,(o,l)=>{const u=r(o,s+1);!Dl(u)&&(i[l]=u)}),e[s]=void 0,i}}return n};return r(t,0)},D2=Fa("AsyncFunction"),T2=t=>t&&(vu(t)||ia(t))&&ia(t.then)&&ia(t.catch),Km=((t,e)=>t?setImmediate:e?((r,n)=>(di.addEventListener("message",({source:s,data:i})=>{s===di&&i===r&&n.length&&n.shift()()},!1),s=>{n.push(s),di.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",ia(di.postMessage)),M2=typeof queueMicrotask<"u"?queueMicrotask.bind(di):typeof process<"u"&&process.nextTick||Km,F2=t=>t!=null&&ia(t[pu]),qe={isArray:vo,isArrayBuffer:Ym,isBuffer:e2,isFormData:c2,isArrayBufferView:t2,isString:r2,isNumber:Vm,isBoolean:n2,isObject:vu,isPlainObject:Ic,isReadableStream:d2,isRequest:h2,isResponse:f2,isHeaders:p2,isUndefined:Dl,isDate:a2,isFile:s2,isBlob:i2,isRegExp:k2,isFunction:ia,isStream:l2,isURLSearchParams:u2,isTypedArray:_2,isFileList:o2,forEach:Rl,merge:$d,extend:g2,trim:m2,stripBOM:v2,inherits:x2,toFlatObject:y2,kindOf:mu,kindOfTest:Fa,endsWith:b2,toArray:w2,forEachEntry:j2,matchAll:S2,isHTMLForm:C2,hasOwnProperty:If,hasOwnProp:If,reduceDescriptors:Jm,freezeMethods:A2,toObjectSet:L2,toCamelCase:P2,noop:N2,toFiniteNumber:E2,findKey:Gm,global:di,isContextDefined:Qm,isSpecCompliantForm:O2,toJSONObject:I2,isAsyncFn:D2,isThenable:T2,setImmediate:Km,asap:M2,isIterable:F2};function Gt(t,e,r,n,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),n&&(this.request=n),s&&(this.response=s,this.status=s.status?s.status:null)}qe.inherits(Gt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:qe.toJSONObject(this.config),code:this.code,status:this.status}}});const Xm=Gt.prototype,Zm={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Zm[t]={value:t}});Object.defineProperties(Gt,Zm);Object.defineProperty(Xm,"isAxiosError",{value:!0});Gt.from=(t,e,r,n,s,i)=>{const o=Object.create(Xm);return qe.toFlatObject(t,o,function(u){return u!==Error.prototype},l=>l!=="isAxiosError"),Gt.call(o,t.message,e,r,n,s),o.cause=t,o.name=t.name,i&&Object.assign(o,i),o};const R2=null;function Hd(t){return qe.isPlainObject(t)||qe.isArray(t)}function eg(t){return qe.endsWith(t,"[]")?t.slice(0,-2):t}function Df(t,e,r){return t?t.concat(e).map(function(s,i){return s=eg(s),!r&&i?"["+s+"]":s}).join(r?".":""):e}function q2(t){return qe.isArray(t)&&!t.some(Hd)}const B2=qe.toFlatObject(qe,{},null,function(e){return/^is[A-Z]/.test(e)});function xu(t,e,r){if(!qe.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,r=qe.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(w,y){return!qe.isUndefined(y[w])});const n=r.metaTokens,s=r.visitor||f,i=r.dots,o=r.indexes,u=(r.Blob||typeof Blob<"u"&&Blob)&&qe.isSpecCompliantForm(e);if(!qe.isFunction(s))throw new TypeError("visitor must be a function");function d(b){if(b===null)return"";if(qe.isDate(b))return b.toISOString();if(qe.isBoolean(b))return b.toString();if(!u&&qe.isBlob(b))throw new Gt("Blob is not supported. Use a Buffer instead.");return qe.isArrayBuffer(b)||qe.isTypedArray(b)?u&&typeof Blob=="function"?new Blob([b]):Buffer.from(b):b}function f(b,w,y){let j=b;if(b&&!y&&typeof b=="object"){if(qe.endsWith(w,"{}"))w=n?w:w.slice(0,-2),b=JSON.stringify(b);else if(qe.isArray(b)&&q2(b)||(qe.isFileList(b)||qe.endsWith(w,"[]"))&&(j=qe.toArray(b)))return w=eg(w),j.forEach(function(k,I){!(qe.isUndefined(k)||k===null)&&e.append(o===!0?Df([w],I,i):o===null?w:w+"[]",d(k))}),!1}return Hd(b)?!0:(e.append(Df(y,w,i),d(b)),!1)}const m=[],v=Object.assign(B2,{defaultVisitor:f,convertValue:d,isVisitable:Hd});function p(b,w){if(!qe.isUndefined(b)){if(m.indexOf(b)!==-1)throw Error("Circular reference detected in "+w.join("."));m.push(b),qe.forEach(b,function(j,O){(!(qe.isUndefined(j)||j===null)&&s.call(e,j,qe.isString(O)?O.trim():O,w,v))===!0&&p(j,w?w.concat(O):[O])}),m.pop()}}if(!qe.isObject(t))throw new TypeError("data must be an object");return p(t),e}function Tf(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function Ah(t,e){this._pairs=[],t&&xu(t,this,e)}const tg=Ah.prototype;tg.append=function(e,r){this._pairs.push([e,r])};tg.toString=function(e){const r=e?function(n){return e.call(this,n,Tf)}:Tf;return this._pairs.map(function(s){return r(s[0])+"="+r(s[1])},"").join("&")};function U2(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function rg(t,e,r){if(!e)return t;const n=r&&r.encode||U2;qe.isFunction(r)&&(r={serialize:r});const s=r&&r.serialize;let i;if(s?i=s(e,r):i=qe.isURLSearchParams(e)?e.toString():new Ah(e,r).toString(n),i){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+i}return t}class Mf{constructor(){this.handlers=[]}use(e,r,n){return this.handlers.push({fulfilled:e,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){qe.forEach(this.handlers,function(n){n!==null&&e(n)})}}const ng={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},W2=typeof URLSearchParams<"u"?URLSearchParams:Ah,z2=typeof FormData<"u"?FormData:null,$2=typeof Blob<"u"?Blob:null,H2={isBrowser:!0,classes:{URLSearchParams:W2,FormData:z2,Blob:$2},protocols:["http","https","file","blob","url","data"]},Lh=typeof window<"u"&&typeof document<"u",Yd=typeof navigator=="object"&&navigator||void 0,Y2=Lh&&(!Yd||["ReactNative","NativeScript","NS"].indexOf(Yd.product)<0),V2=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",G2=Lh&&window.location.href||"http://localhost",Q2=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Lh,hasStandardBrowserEnv:Y2,hasStandardBrowserWebWorkerEnv:V2,navigator:Yd,origin:G2},Symbol.toStringTag,{value:"Module"})),Gn={...Q2,...H2};function J2(t,e){return xu(t,new Gn.classes.URLSearchParams,Object.assign({visitor:function(r,n,s,i){return Gn.isNode&&qe.isBuffer(r)?(this.append(n,r.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function K2(t){return qe.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function X2(t){const e={},r=Object.keys(t);let n;const s=r.length;let i;for(n=0;n<s;n++)i=r[n],e[i]=t[i];return e}function ag(t){function e(r,n,s,i){let o=r[i++];if(o==="__proto__")return!0;const l=Number.isFinite(+o),u=i>=r.length;return o=!o&&qe.isArray(s)?s.length:o,u?(qe.hasOwnProp(s,o)?s[o]=[s[o],n]:s[o]=n,!l):((!s[o]||!qe.isObject(s[o]))&&(s[o]=[]),e(r,n,s[o],i)&&qe.isArray(s[o])&&(s[o]=X2(s[o])),!l)}if(qe.isFormData(t)&&qe.isFunction(t.entries)){const r={};return qe.forEachEntry(t,(n,s)=>{e(K2(n),s,r,0)}),r}return null}function Z2(t,e,r){if(qe.isString(t))try{return(e||JSON.parse)(t),qe.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(t)}const ql={transitional:ng,adapter:["xhr","http","fetch"],transformRequest:[function(e,r){const n=r.getContentType()||"",s=n.indexOf("application/json")>-1,i=qe.isObject(e);if(i&&qe.isHTMLForm(e)&&(e=new FormData(e)),qe.isFormData(e))return s?JSON.stringify(ag(e)):e;if(qe.isArrayBuffer(e)||qe.isBuffer(e)||qe.isStream(e)||qe.isFile(e)||qe.isBlob(e)||qe.isReadableStream(e))return e;if(qe.isArrayBufferView(e))return e.buffer;if(qe.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return J2(e,this.formSerializer).toString();if((l=qe.isFileList(e))||n.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return xu(l?{"files[]":e}:e,u&&new u,this.formSerializer)}}return i||s?(r.setContentType("application/json",!1),Z2(e)):e}],transformResponse:[function(e){const r=this.transitional||ql.transitional,n=r&&r.forcedJSONParsing,s=this.responseType==="json";if(qe.isResponse(e)||qe.isReadableStream(e))return e;if(e&&qe.isString(e)&&(n&&!this.responseType||s)){const o=!(r&&r.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(l){if(o)throw l.name==="SyntaxError"?Gt.from(l,Gt.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Gn.classes.FormData,Blob:Gn.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};qe.forEach(["delete","get","head","post","put","patch"],t=>{ql.headers[t]={}});const ex=qe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),tx=t=>{const e={};let r,n,s;return t&&t.split(`
`).forEach(function(o){s=o.indexOf(":"),r=o.substring(0,s).trim().toLowerCase(),n=o.substring(s+1).trim(),!(!r||e[r]&&ex[r])&&(r==="set-cookie"?e[r]?e[r].push(n):e[r]=[n]:e[r]=e[r]?e[r]+", "+n:n)}),e},Ff=Symbol("internals");function Qo(t){return t&&String(t).trim().toLowerCase()}function Dc(t){return t===!1||t==null?t:qe.isArray(t)?t.map(Dc):String(t)}function rx(t){const e=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(t);)e[n[1]]=n[2];return e}const nx=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function ud(t,e,r,n,s){if(qe.isFunction(n))return n.call(this,e,r);if(s&&(e=r),!!qe.isString(e)){if(qe.isString(n))return e.indexOf(n)!==-1;if(qe.isRegExp(n))return n.test(e)}}function ax(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,r,n)=>r.toUpperCase()+n)}function sx(t,e){const r=qe.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(t,n+r,{value:function(s,i,o){return this[n].call(this,e,s,i,o)},configurable:!0})})}let oa=class{constructor(e){e&&this.set(e)}set(e,r,n){const s=this;function i(l,u,d){const f=Qo(u);if(!f)throw new Error("header name must be a non-empty string");const m=qe.findKey(s,f);(!m||s[m]===void 0||d===!0||d===void 0&&s[m]!==!1)&&(s[m||u]=Dc(l))}const o=(l,u)=>qe.forEach(l,(d,f)=>i(d,f,u));if(qe.isPlainObject(e)||e instanceof this.constructor)o(e,r);else if(qe.isString(e)&&(e=e.trim())&&!nx(e))o(tx(e),r);else if(qe.isObject(e)&&qe.isIterable(e)){let l={},u,d;for(const f of e){if(!qe.isArray(f))throw TypeError("Object iterator must return a key-value pair");l[d=f[0]]=(u=l[d])?qe.isArray(u)?[...u,f[1]]:[u,f[1]]:f[1]}o(l,r)}else e!=null&&i(r,e,n);return this}get(e,r){if(e=Qo(e),e){const n=qe.findKey(this,e);if(n){const s=this[n];if(!r)return s;if(r===!0)return rx(s);if(qe.isFunction(r))return r.call(this,s,n);if(qe.isRegExp(r))return r.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,r){if(e=Qo(e),e){const n=qe.findKey(this,e);return!!(n&&this[n]!==void 0&&(!r||ud(this,this[n],n,r)))}return!1}delete(e,r){const n=this;let s=!1;function i(o){if(o=Qo(o),o){const l=qe.findKey(n,o);l&&(!r||ud(n,n[l],l,r))&&(delete n[l],s=!0)}}return qe.isArray(e)?e.forEach(i):i(e),s}clear(e){const r=Object.keys(this);let n=r.length,s=!1;for(;n--;){const i=r[n];(!e||ud(this,this[i],i,e,!0))&&(delete this[i],s=!0)}return s}normalize(e){const r=this,n={};return qe.forEach(this,(s,i)=>{const o=qe.findKey(n,i);if(o){r[o]=Dc(s),delete r[i];return}const l=e?ax(i):String(i).trim();l!==i&&delete r[i],r[l]=Dc(s),n[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const r=Object.create(null);return qe.forEach(this,(n,s)=>{n!=null&&n!==!1&&(r[s]=e&&qe.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,r])=>e+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...r){const n=new this(e);return r.forEach(s=>n.set(s)),n}static accessor(e){const n=(this[Ff]=this[Ff]={accessors:{}}).accessors,s=this.prototype;function i(o){const l=Qo(o);n[l]||(sx(s,o),n[l]=!0)}return qe.isArray(e)?e.forEach(i):i(e),this}};oa.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);qe.reduceDescriptors(oa.prototype,({value:t},e)=>{let r=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(n){this[r]=n}}});qe.freezeMethods(oa);function dd(t,e){const r=this||ql,n=e||r,s=oa.from(n.headers);let i=n.data;return qe.forEach(t,function(l){i=l.call(r,i,s.normalize(),e?e.status:void 0)}),s.normalize(),i}function sg(t){return!!(t&&t.__CANCEL__)}function xo(t,e,r){Gt.call(this,t??"canceled",Gt.ERR_CANCELED,e,r),this.name="CanceledError"}qe.inherits(xo,Gt,{__CANCEL__:!0});function ig(t,e,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?t(r):e(new Gt("Request failed with status code "+r.status,[Gt.ERR_BAD_REQUEST,Gt.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function ix(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function ox(t,e){t=t||10;const r=new Array(t),n=new Array(t);let s=0,i=0,o;return e=e!==void 0?e:1e3,function(u){const d=Date.now(),f=n[i];o||(o=d),r[s]=u,n[s]=d;let m=i,v=0;for(;m!==s;)v+=r[m++],m=m%t;if(s=(s+1)%t,s===i&&(i=(i+1)%t),d-o<e)return;const p=f&&d-f;return p?Math.round(v*1e3/p):void 0}}function lx(t,e){let r=0,n=1e3/e,s,i;const o=(d,f=Date.now())=>{r=f,s=null,i&&(clearTimeout(i),i=null),t.apply(null,d)};return[(...d)=>{const f=Date.now(),m=f-r;m>=n?o(d,f):(s=d,i||(i=setTimeout(()=>{i=null,o(s)},n-m)))},()=>s&&o(s)]}const Xc=(t,e,r=3)=>{let n=0;const s=ox(50,250);return lx(i=>{const o=i.loaded,l=i.lengthComputable?i.total:void 0,u=o-n,d=s(u),f=o<=l;n=o;const m={loaded:o,total:l,progress:l?o/l:void 0,bytes:u,rate:d||void 0,estimated:d&&l&&f?(l-o)/d:void 0,event:i,lengthComputable:l!=null,[e?"download":"upload"]:!0};t(m)},r)},Rf=(t,e)=>{const r=t!=null;return[n=>e[0]({lengthComputable:r,total:t,loaded:n}),e[1]]},qf=t=>(...e)=>qe.asap(()=>t(...e)),cx=Gn.hasStandardBrowserEnv?((t,e)=>r=>(r=new URL(r,Gn.origin),t.protocol===r.protocol&&t.host===r.host&&(e||t.port===r.port)))(new URL(Gn.origin),Gn.navigator&&/(msie|trident)/i.test(Gn.navigator.userAgent)):()=>!0,ux=Gn.hasStandardBrowserEnv?{write(t,e,r,n,s,i){const o=[t+"="+encodeURIComponent(e)];qe.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),qe.isString(n)&&o.push("path="+n),qe.isString(s)&&o.push("domain="+s),i===!0&&o.push("secure"),document.cookie=o.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function dx(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function hx(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function og(t,e,r){let n=!dx(e);return t&&(n||r==!1)?hx(t,e):e}const Bf=t=>t instanceof oa?{...t}:t;function gi(t,e){e=e||{};const r={};function n(d,f,m,v){return qe.isPlainObject(d)&&qe.isPlainObject(f)?qe.merge.call({caseless:v},d,f):qe.isPlainObject(f)?qe.merge({},f):qe.isArray(f)?f.slice():f}function s(d,f,m,v){if(qe.isUndefined(f)){if(!qe.isUndefined(d))return n(void 0,d,m,v)}else return n(d,f,m,v)}function i(d,f){if(!qe.isUndefined(f))return n(void 0,f)}function o(d,f){if(qe.isUndefined(f)){if(!qe.isUndefined(d))return n(void 0,d)}else return n(void 0,f)}function l(d,f,m){if(m in e)return n(d,f);if(m in t)return n(void 0,d)}const u={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l,headers:(d,f,m)=>s(Bf(d),Bf(f),m,!0)};return qe.forEach(Object.keys(Object.assign({},t,e)),function(f){const m=u[f]||s,v=m(t[f],e[f],f);qe.isUndefined(v)&&m!==l||(r[f]=v)}),r}const lg=t=>{const e=gi({},t);let{data:r,withXSRFToken:n,xsrfHeaderName:s,xsrfCookieName:i,headers:o,auth:l}=e;e.headers=o=oa.from(o),e.url=rg(og(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let u;if(qe.isFormData(r)){if(Gn.hasStandardBrowserEnv||Gn.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((u=o.getContentType())!==!1){const[d,...f]=u?u.split(";").map(m=>m.trim()).filter(Boolean):[];o.setContentType([d||"multipart/form-data",...f].join("; "))}}if(Gn.hasStandardBrowserEnv&&(n&&qe.isFunction(n)&&(n=n(e)),n||n!==!1&&cx(e.url))){const d=s&&i&&ux.read(i);d&&o.set(s,d)}return e},fx=typeof XMLHttpRequest<"u",px=fx&&function(t){return new Promise(function(r,n){const s=lg(t);let i=s.data;const o=oa.from(s.headers).normalize();let{responseType:l,onUploadProgress:u,onDownloadProgress:d}=s,f,m,v,p,b;function w(){p&&p(),b&&b(),s.cancelToken&&s.cancelToken.unsubscribe(f),s.signal&&s.signal.removeEventListener("abort",f)}let y=new XMLHttpRequest;y.open(s.method.toUpperCase(),s.url,!0),y.timeout=s.timeout;function j(){if(!y)return;const k=oa.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),H={data:!l||l==="text"||l==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:k,config:t,request:y};ig(function(U){r(U),w()},function(U){n(U),w()},H),y=null}"onloadend"in y?y.onloadend=j:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(j)},y.onabort=function(){y&&(n(new Gt("Request aborted",Gt.ECONNABORTED,t,y)),y=null)},y.onerror=function(){n(new Gt("Network Error",Gt.ERR_NETWORK,t,y)),y=null},y.ontimeout=function(){let I=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const H=s.transitional||ng;s.timeoutErrorMessage&&(I=s.timeoutErrorMessage),n(new Gt(I,H.clarifyTimeoutError?Gt.ETIMEDOUT:Gt.ECONNABORTED,t,y)),y=null},i===void 0&&o.setContentType(null),"setRequestHeader"in y&&qe.forEach(o.toJSON(),function(I,H){y.setRequestHeader(H,I)}),qe.isUndefined(s.withCredentials)||(y.withCredentials=!!s.withCredentials),l&&l!=="json"&&(y.responseType=s.responseType),d&&([v,b]=Xc(d,!0),y.addEventListener("progress",v)),u&&y.upload&&([m,p]=Xc(u),y.upload.addEventListener("progress",m),y.upload.addEventListener("loadend",p)),(s.cancelToken||s.signal)&&(f=k=>{y&&(n(!k||k.type?new xo(null,t,y):k),y.abort(),y=null)},s.cancelToken&&s.cancelToken.subscribe(f),s.signal&&(s.signal.aborted?f():s.signal.addEventListener("abort",f)));const O=ix(s.url);if(O&&Gn.protocols.indexOf(O)===-1){n(new Gt("Unsupported protocol "+O+":",Gt.ERR_BAD_REQUEST,t));return}y.send(i||null)})},mx=(t,e)=>{const{length:r}=t=t?t.filter(Boolean):[];if(e||r){let n=new AbortController,s;const i=function(d){if(!s){s=!0,l();const f=d instanceof Error?d:this.reason;n.abort(f instanceof Gt?f:new xo(f instanceof Error?f.message:f))}};let o=e&&setTimeout(()=>{o=null,i(new Gt(`timeout ${e} of ms exceeded`,Gt.ETIMEDOUT))},e);const l=()=>{t&&(o&&clearTimeout(o),o=null,t.forEach(d=>{d.unsubscribe?d.unsubscribe(i):d.removeEventListener("abort",i)}),t=null)};t.forEach(d=>d.addEventListener("abort",i));const{signal:u}=n;return u.unsubscribe=()=>qe.asap(l),u}},gx=function*(t,e){let r=t.byteLength;if(r<e){yield t;return}let n=0,s;for(;n<r;)s=n+e,yield t.slice(n,s),n=s},vx=async function*(t,e){for await(const r of xx(t))yield*gx(r,e)},xx=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:r,value:n}=await e.read();if(r)break;yield n}}finally{await e.cancel()}},Uf=(t,e,r,n)=>{const s=vx(t,e);let i=0,o,l=u=>{o||(o=!0,n&&n(u))};return new ReadableStream({async pull(u){try{const{done:d,value:f}=await s.next();if(d){l(),u.close();return}let m=f.byteLength;if(r){let v=i+=m;r(v)}u.enqueue(new Uint8Array(f))}catch(d){throw l(d),d}},cancel(u){return l(u),s.return()}},{highWaterMark:2})},yu=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",cg=yu&&typeof ReadableStream=="function",yx=yu&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),ug=(t,...e)=>{try{return!!t(...e)}catch{return!1}},bx=cg&&ug(()=>{let t=!1;const e=new Request(Gn.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),Wf=64*1024,Vd=cg&&ug(()=>qe.isReadableStream(new Response("").body)),Zc={stream:Vd&&(t=>t.body)};yu&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Zc[e]&&(Zc[e]=qe.isFunction(t[e])?r=>r[e]():(r,n)=>{throw new Gt(`Response type '${e}' is not supported`,Gt.ERR_NOT_SUPPORT,n)})})})(new Response);const wx=async t=>{if(t==null)return 0;if(qe.isBlob(t))return t.size;if(qe.isSpecCompliantForm(t))return(await new Request(Gn.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(qe.isArrayBufferView(t)||qe.isArrayBuffer(t))return t.byteLength;if(qe.isURLSearchParams(t)&&(t=t+""),qe.isString(t))return(await yx(t)).byteLength},_x=async(t,e)=>{const r=qe.toFiniteNumber(t.getContentLength());return r??wx(e)},jx=yu&&(async t=>{let{url:e,method:r,data:n,signal:s,cancelToken:i,timeout:o,onDownloadProgress:l,onUploadProgress:u,responseType:d,headers:f,withCredentials:m="same-origin",fetchOptions:v}=lg(t);d=d?(d+"").toLowerCase():"text";let p=mx([s,i&&i.toAbortSignal()],o),b;const w=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let y;try{if(u&&bx&&r!=="get"&&r!=="head"&&(y=await _x(f,n))!==0){let H=new Request(e,{method:"POST",body:n,duplex:"half"}),F;if(qe.isFormData(n)&&(F=H.headers.get("content-type"))&&f.setContentType(F),H.body){const[U,C]=Rf(y,Xc(qf(u)));n=Uf(H.body,Wf,U,C)}}qe.isString(m)||(m=m?"include":"omit");const j="credentials"in Request.prototype;b=new Request(e,{...v,signal:p,method:r.toUpperCase(),headers:f.normalize().toJSON(),body:n,duplex:"half",credentials:j?m:void 0});let O=await fetch(b,v);const k=Vd&&(d==="stream"||d==="response");if(Vd&&(l||k&&w)){const H={};["status","statusText","headers"].forEach(N=>{H[N]=O[N]});const F=qe.toFiniteNumber(O.headers.get("content-length")),[U,C]=l&&Rf(F,Xc(qf(l),!0))||[];O=new Response(Uf(O.body,Wf,U,()=>{C&&C(),w&&w()}),H)}d=d||"text";let I=await Zc[qe.findKey(Zc,d)||"text"](O,t);return!k&&w&&w(),await new Promise((H,F)=>{ig(H,F,{data:I,headers:oa.from(O.headers),status:O.status,statusText:O.statusText,config:t,request:b})})}catch(j){throw w&&w(),j&&j.name==="TypeError"&&/Load failed|fetch/i.test(j.message)?Object.assign(new Gt("Network Error",Gt.ERR_NETWORK,t,b),{cause:j.cause||j}):Gt.from(j,j&&j.code,t,b)}}),Gd={http:R2,xhr:px,fetch:jx};qe.forEach(Gd,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const zf=t=>`- ${t}`,Sx=t=>qe.isFunction(t)||t===null||t===!1,dg={getAdapter:t=>{t=qe.isArray(t)?t:[t];const{length:e}=t;let r,n;const s={};for(let i=0;i<e;i++){r=t[i];let o;if(n=r,!Sx(r)&&(n=Gd[(o=String(r)).toLowerCase()],n===void 0))throw new Gt(`Unknown adapter '${o}'`);if(n)break;s[o||"#"+i]=n}if(!n){const i=Object.entries(s).map(([l,u])=>`adapter ${l} `+(u===!1?"is not supported by the environment":"is not available in the build"));let o=e?i.length>1?`since :
`+i.map(zf).join(`
`):" "+zf(i[0]):"as no adapter specified";throw new Gt("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n},adapters:Gd};function hd(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new xo(null,t)}function $f(t){return hd(t),t.headers=oa.from(t.headers),t.data=dd.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),dg.getAdapter(t.adapter||ql.adapter)(t).then(function(n){return hd(t),n.data=dd.call(t,t.transformResponse,n),n.headers=oa.from(n.headers),n},function(n){return sg(n)||(hd(t),n&&n.response&&(n.response.data=dd.call(t,t.transformResponse,n.response),n.response.headers=oa.from(n.response.headers))),Promise.reject(n)})}const hg="1.10.0",bu={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{bu[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const Hf={};bu.transitional=function(e,r,n){function s(i,o){return"[Axios v"+hg+"] Transitional option '"+i+"'"+o+(n?". "+n:"")}return(i,o,l)=>{if(e===!1)throw new Gt(s(o," has been removed"+(r?" in "+r:"")),Gt.ERR_DEPRECATED);return r&&!Hf[o]&&(Hf[o]=!0,console.warn(s(o," has been deprecated since v"+r+" and will be removed in the near future"))),e?e(i,o,l):!0}};bu.spelling=function(e){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function Cx(t,e,r){if(typeof t!="object")throw new Gt("options must be an object",Gt.ERR_BAD_OPTION_VALUE);const n=Object.keys(t);let s=n.length;for(;s-- >0;){const i=n[s],o=e[i];if(o){const l=t[i],u=l===void 0||o(l,i,t);if(u!==!0)throw new Gt("option "+i+" must be "+u,Gt.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new Gt("Unknown option "+i,Gt.ERR_BAD_OPTION)}}const Tc={assertOptions:Cx,validators:bu},Va=Tc.validators;let hi=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Mf,response:new Mf}}async request(e,r){try{return await this._request(e,r)}catch(n){if(n instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(e,r){typeof e=="string"?(r=r||{},r.url=e):r=e||{},r=gi(this.defaults,r);const{transitional:n,paramsSerializer:s,headers:i}=r;n!==void 0&&Tc.assertOptions(n,{silentJSONParsing:Va.transitional(Va.boolean),forcedJSONParsing:Va.transitional(Va.boolean),clarifyTimeoutError:Va.transitional(Va.boolean)},!1),s!=null&&(qe.isFunction(s)?r.paramsSerializer={serialize:s}:Tc.assertOptions(s,{encode:Va.function,serialize:Va.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Tc.assertOptions(r,{baseUrl:Va.spelling("baseURL"),withXsrfToken:Va.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let o=i&&qe.merge(i.common,i[r.method]);i&&qe.forEach(["delete","get","head","post","put","patch","common"],b=>{delete i[b]}),r.headers=oa.concat(o,i);const l=[];let u=!0;this.interceptors.request.forEach(function(w){typeof w.runWhen=="function"&&w.runWhen(r)===!1||(u=u&&w.synchronous,l.unshift(w.fulfilled,w.rejected))});const d=[];this.interceptors.response.forEach(function(w){d.push(w.fulfilled,w.rejected)});let f,m=0,v;if(!u){const b=[$f.bind(this),void 0];for(b.unshift.apply(b,l),b.push.apply(b,d),v=b.length,f=Promise.resolve(r);m<v;)f=f.then(b[m++],b[m++]);return f}v=l.length;let p=r;for(m=0;m<v;){const b=l[m++],w=l[m++];try{p=b(p)}catch(y){w.call(this,y);break}}try{f=$f.call(this,p)}catch(b){return Promise.reject(b)}for(m=0,v=d.length;m<v;)f=f.then(d[m++],d[m++]);return f}getUri(e){e=gi(this.defaults,e);const r=og(e.baseURL,e.url,e.allowAbsoluteUrls);return rg(r,e.params,e.paramsSerializer)}};qe.forEach(["delete","get","head","options"],function(e){hi.prototype[e]=function(r,n){return this.request(gi(n||{},{method:e,url:r,data:(n||{}).data}))}});qe.forEach(["post","put","patch"],function(e){function r(n){return function(i,o,l){return this.request(gi(l||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}hi.prototype[e]=r(),hi.prototype[e+"Form"]=r(!0)});let Px=class fg{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(i){r=i});const n=this;this.promise.then(s=>{if(!n._listeners)return;let i=n._listeners.length;for(;i-- >0;)n._listeners[i](s);n._listeners=null}),this.promise.then=s=>{let i;const o=new Promise(l=>{n.subscribe(l),i=l}).then(s);return o.cancel=function(){n.unsubscribe(i)},o},e(function(i,o,l){n.reason||(n.reason=new xo(i,o,l),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const r=this._listeners.indexOf(e);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const e=new AbortController,r=n=>{e.abort(n)};return this.subscribe(r),e.signal.unsubscribe=()=>this.unsubscribe(r),e.signal}static source(){let e;return{token:new fg(function(s){e=s}),cancel:e}}};function kx(t){return function(r){return t.apply(null,r)}}function Ax(t){return qe.isObject(t)&&t.isAxiosError===!0}const Qd={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Qd).forEach(([t,e])=>{Qd[e]=t});function pg(t){const e=new hi(t),r=$m(hi.prototype.request,e);return qe.extend(r,hi.prototype,e,{allOwnKeys:!0}),qe.extend(r,e,null,{allOwnKeys:!0}),r.create=function(s){return pg(gi(t,s))},r}const vn=pg(ql);vn.Axios=hi;vn.CanceledError=xo;vn.CancelToken=Px;vn.isCancel=sg;vn.VERSION=hg;vn.toFormData=xu;vn.AxiosError=Gt;vn.Cancel=vn.CanceledError;vn.all=function(e){return Promise.all(e)};vn.spread=kx;vn.isAxiosError=Ax;vn.mergeConfig=gi;vn.AxiosHeaders=oa;vn.formToJSON=t=>ag(qe.isHTMLForm(t)?new FormData(t):t);vn.getAdapter=dg.getAdapter;vn.HttpStatusCode=Qd;vn.default=vn;const{Axios:w4,AxiosError:_n,CanceledError:_4,isCancel:j4,CancelToken:S4,VERSION:C4,all:P4,Cancel:k4,isAxiosError:A4,spread:L4,toFormData:N4,AxiosHeaders:E4,HttpStatusCode:O4,formToJSON:I4,getAdapter:D4,mergeConfig:T4}=vn,Jd=window&&window.electronAPI;function Yf(t){return t.includes("localhost")&&t.startsWith("https://")?t.replace("https://","http://"):t}console.log("API baseURL:","http://localhost:5000");console.log("Is Electron:",Jd);const Lx={cloudflare:{baseURL:"http://localhost:5000",timeout:12e4}};function eo(){return console.log("Environment variables:",{VITE_API_BASE_URL:"http://localhost:5000",VITE_CLOUDFLARE_URL:"http://localhost:5000",MODE:"production",NODE_ENV:"production",isElectron:Jd}),Jd?(console.log("Running in Electron - checking environment variables"),"http://localhost:5000".includes("localhost")?(console.log("Using VITE_API_BASE_URL for Electron"),{baseURL:Yf("http://localhost:5000"),timeout:12e4}):(console.log("Using cloudflare config for Electron"),{baseURL:"http://localhost:5000",timeout:12e4})):"http://localhost:5000".includes("localhost")?(console.log("Using development config with VITE_API_BASE_URL"),{baseURL:Yf("http://localhost:5000"),timeout:12e4}):(console.log("Using cloudflare config"),Lx.cloudflare)}const Vf=eo(),xe=vn.create({baseURL:Vf.baseURL,timeout:Vf.timeout,withCredentials:!0});xe.interceptors.request.use(t=>{const e=localStorage.getItem("sessionToken");e&&(t.headers.Authorization=`Bearer ${e}`);const r=localStorage.getItem("deviceId");return r&&(t.headers["x-device-id"]=r),t},t=>Promise.reject(t));xe.interceptors.response.use(t=>t,async t=>{try{const r=t?.response?.status,n=!t.response&&(t.code==="ECONNABORTED"||t.message?.includes("Network Error"));r>=500||n?window.__backendUnavailableSince=window.__backendUnavailableSince||Date.now():r&&(window.__backendUnavailableSince=void 0)}catch{}const e=t.config;if(t.response?.status===401&&!e._retry){e._retry=!0;const r=localStorage.getItem("refreshToken");if(r)try{const n=await xe.post("/api/auth/refresh",{refreshToken:r}),{sessionToken:s,refreshToken:i}=n.data;return localStorage.setItem("sessionToken",s),localStorage.setItem("refreshToken",i),xe.defaults.headers.common.Authorization=`Bearer ${s}`,xe(e)}catch(n){return localStorage.removeItem("sessionToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),window.location.href="/login",Promise.reject(n)}else localStorage.removeItem("sessionToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),window.location.href="/login"}return Promise.reject(t)});const mg=_.createContext(void 0),Nx=({children:t})=>{const[e,r]=_.useState(null),[n,s]=_.useState(!1),[i,o]=_.useState("");_.useEffect(()=>{let p=localStorage.getItem("deviceId");p||(p=crypto.randomUUID(),localStorage.setItem("deviceId",p)),o(p)},[]),_.useEffect(()=>{const p=localStorage.getItem("sessionToken"),b=localStorage.getItem("refreshToken"),w=localStorage.getItem("user");if(p&&b&&w)try{const y=JSON.parse(w);r(y),s(!0),xe.defaults.headers.common.Authorization=`Bearer ${p}`,xe.defaults.headers.common["x-device-id"]=i}catch(y){console.error("Error parsing user data:",y),u()}},[i]);const l=(p,b,w)=>{localStorage.setItem("sessionToken",p),localStorage.setItem("refreshToken",b),localStorage.setItem("user",JSON.stringify(w)),r(w),s(!0)},u=()=>{localStorage.removeItem("sessionToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),r(null),s(!1)},d=async()=>{try{await xe.post("/api/auth/logout-all"),u()}catch(p){console.error("Error logging out from all devices:",p),u()}},f=async()=>{try{const p=localStorage.getItem("refreshToken");if(!p)return!1;const b=await xe.post("/api/auth/refresh",{refreshToken:p}),{sessionToken:w,refreshToken:y}=b.data;return localStorage.setItem("sessionToken",w),localStorage.setItem("refreshToken",y),!0}catch(p){return console.error("Error refreshing session:",p),u(),!1}},m=async()=>{try{return(await xe.get("/api/auth/sessions")).data}catch(p){return console.error("Error fetching user sessions:",p),[]}},v=async p=>{try{return await xe.delete(`/api/auth/sessions/${p}`),!0}catch(b){return console.error("Error deactivating session:",b),!1}};return a.jsx(mg.Provider,{value:{user:e,isAuthenticated:n,login:l,logout:u,logoutFromAllDevices:d,refreshSession:f,getUserSessions:m,deactivateSession:v,currentDeviceId:i},children:t})},Aa=()=>{const t=_.useContext(mg);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},Ex=g0({palette:{primary:{main:"#7c3aed"},secondary:{main:"#ffd600"}},typography:{h4:{fontSize:"1.5rem",fontWeight:600},h6:{fontSize:"1.2rem",fontWeight:500}}});var Mc={exports:{}},Ox=Mc.exports,Gf;function Ix(){return Gf||(Gf=1,function(t,e){(function(r,n){t.exports=n()})(Ox,function(){var r=1e3,n=6e4,s=36e5,i="millisecond",o="second",l="minute",u="hour",d="day",f="week",m="month",v="quarter",p="year",b="date",w="Invalid Date",y=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,j=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,O={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(W){var z=["th","st","nd","rd"],V=W%100;return"["+W+(z[(V-20)%10]||z[V]||z[0])+"]"}},k=function(W,z,V){var Y=String(W);return!Y||Y.length>=z?W:""+Array(z+1-Y.length).join(V)+W},I={s:k,z:function(W){var z=-W.utcOffset(),V=Math.abs(z),Y=Math.floor(V/60),E=V%60;return(z<=0?"+":"-")+k(Y,2,"0")+":"+k(E,2,"0")},m:function W(z,V){if(z.date()<V.date())return-W(V,z);var Y=12*(V.year()-z.year())+(V.month()-z.month()),E=z.clone().add(Y,m),X=V-E<0,oe=z.clone().add(Y+(X?-1:1),m);return+(-(Y+(V-E)/(X?E-oe:oe-E))||0)},a:function(W){return W<0?Math.ceil(W)||0:Math.floor(W)},p:function(W){return{M:m,y:p,w:f,d,D:b,h:u,m:l,s:o,ms:i,Q:v}[W]||String(W||"").toLowerCase().replace(/s$/,"")},u:function(W){return W===void 0}},H="en",F={};F[H]=O;var U="$isDayjsObject",C=function(W){return W instanceof L||!(!W||!W[U])},N=function W(z,V,Y){var E;if(!z)return H;if(typeof z=="string"){var X=z.toLowerCase();F[X]&&(E=X),V&&(F[X]=V,E=X);var oe=z.split("-");if(!E&&oe.length>1)return W(oe[0])}else{var de=z.name;F[de]=z,E=de}return!Y&&E&&(H=E),E||!Y&&H},Q=function(W,z){if(C(W))return W.clone();var V=typeof z=="object"?z:{};return V.date=W,V.args=arguments,new L(V)},P=I;P.l=N,P.i=C,P.w=function(W,z){return Q(W,{locale:z.$L,utc:z.$u,x:z.$x,$offset:z.$offset})};var L=function(){function W(V){this.$L=N(V.locale,null,!0),this.parse(V),this.$x=this.$x||V.x||{},this[U]=!0}var z=W.prototype;return z.parse=function(V){this.$d=function(Y){var E=Y.date,X=Y.utc;if(E===null)return new Date(NaN);if(P.u(E))return new Date;if(E instanceof Date)return new Date(E);if(typeof E=="string"&&!/Z$/i.test(E)){var oe=E.match(y);if(oe){var de=oe[2]-1||0,A=(oe[7]||"0").substring(0,3);return X?new Date(Date.UTC(oe[1],de,oe[3]||1,oe[4]||0,oe[5]||0,oe[6]||0,A)):new Date(oe[1],de,oe[3]||1,oe[4]||0,oe[5]||0,oe[6]||0,A)}}return new Date(E)}(V),this.init()},z.init=function(){var V=this.$d;this.$y=V.getFullYear(),this.$M=V.getMonth(),this.$D=V.getDate(),this.$W=V.getDay(),this.$H=V.getHours(),this.$m=V.getMinutes(),this.$s=V.getSeconds(),this.$ms=V.getMilliseconds()},z.$utils=function(){return P},z.isValid=function(){return this.$d.toString()!==w},z.isSame=function(V,Y){var E=Q(V);return this.startOf(Y)<=E&&E<=this.endOf(Y)},z.isAfter=function(V,Y){return Q(V)<this.startOf(Y)},z.isBefore=function(V,Y){return this.endOf(Y)<Q(V)},z.$g=function(V,Y,E){return P.u(V)?this[Y]:this.set(E,V)},z.unix=function(){return Math.floor(this.valueOf()/1e3)},z.valueOf=function(){return this.$d.getTime()},z.startOf=function(V,Y){var E=this,X=!!P.u(Y)||Y,oe=P.p(V),de=function(ae,pe){var ye=P.w(E.$u?Date.UTC(E.$y,pe,ae):new Date(E.$y,pe,ae),E);return X?ye:ye.endOf(d)},A=function(ae,pe){return P.w(E.toDate()[ae].apply(E.toDate("s"),(X?[0,0,0,0]:[23,59,59,999]).slice(pe)),E)},D=this.$W,J=this.$M,re=this.$D,ce="set"+(this.$u?"UTC":"");switch(oe){case p:return X?de(1,0):de(31,11);case m:return X?de(1,J):de(0,J+1);case f:var fe=this.$locale().weekStart||0,ee=(D<fe?D+7:D)-fe;return de(X?re-ee:re+(6-ee),J);case d:case b:return A(ce+"Hours",0);case u:return A(ce+"Minutes",1);case l:return A(ce+"Seconds",2);case o:return A(ce+"Milliseconds",3);default:return this.clone()}},z.endOf=function(V){return this.startOf(V,!1)},z.$set=function(V,Y){var E,X=P.p(V),oe="set"+(this.$u?"UTC":""),de=(E={},E[d]=oe+"Date",E[b]=oe+"Date",E[m]=oe+"Month",E[p]=oe+"FullYear",E[u]=oe+"Hours",E[l]=oe+"Minutes",E[o]=oe+"Seconds",E[i]=oe+"Milliseconds",E)[X],A=X===d?this.$D+(Y-this.$W):Y;if(X===m||X===p){var D=this.clone().set(b,1);D.$d[de](A),D.init(),this.$d=D.set(b,Math.min(this.$D,D.daysInMonth())).$d}else de&&this.$d[de](A);return this.init(),this},z.set=function(V,Y){return this.clone().$set(V,Y)},z.get=function(V){return this[P.p(V)]()},z.add=function(V,Y){var E,X=this;V=Number(V);var oe=P.p(Y),de=function(J){var re=Q(X);return P.w(re.date(re.date()+Math.round(J*V)),X)};if(oe===m)return this.set(m,this.$M+V);if(oe===p)return this.set(p,this.$y+V);if(oe===d)return de(1);if(oe===f)return de(7);var A=(E={},E[l]=n,E[u]=s,E[o]=r,E)[oe]||1,D=this.$d.getTime()+V*A;return P.w(D,this)},z.subtract=function(V,Y){return this.add(-1*V,Y)},z.format=function(V){var Y=this,E=this.$locale();if(!this.isValid())return E.invalidDate||w;var X=V||"YYYY-MM-DDTHH:mm:ssZ",oe=P.z(this),de=this.$H,A=this.$m,D=this.$M,J=E.weekdays,re=E.months,ce=E.meridiem,fe=function(pe,ye,Le,se){return pe&&(pe[ye]||pe(Y,X))||Le[ye].slice(0,se)},ee=function(pe){return P.s(de%12||12,pe,"0")},ae=ce||function(pe,ye,Le){var se=pe<12?"AM":"PM";return Le?se.toLowerCase():se};return X.replace(j,function(pe,ye){return ye||function(Le){switch(Le){case"YY":return String(Y.$y).slice(-2);case"YYYY":return P.s(Y.$y,4,"0");case"M":return D+1;case"MM":return P.s(D+1,2,"0");case"MMM":return fe(E.monthsShort,D,re,3);case"MMMM":return fe(re,D);case"D":return Y.$D;case"DD":return P.s(Y.$D,2,"0");case"d":return String(Y.$W);case"dd":return fe(E.weekdaysMin,Y.$W,J,2);case"ddd":return fe(E.weekdaysShort,Y.$W,J,3);case"dddd":return J[Y.$W];case"H":return String(de);case"HH":return P.s(de,2,"0");case"h":return ee(1);case"hh":return ee(2);case"a":return ae(de,A,!0);case"A":return ae(de,A,!1);case"m":return String(A);case"mm":return P.s(A,2,"0");case"s":return String(Y.$s);case"ss":return P.s(Y.$s,2,"0");case"SSS":return P.s(Y.$ms,3,"0");case"Z":return oe}return null}(pe)||oe.replace(":","")})},z.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},z.diff=function(V,Y,E){var X,oe=this,de=P.p(Y),A=Q(V),D=(A.utcOffset()-this.utcOffset())*n,J=this-A,re=function(){return P.m(oe,A)};switch(de){case p:X=re()/12;break;case m:X=re();break;case v:X=re()/3;break;case f:X=(J-D)/6048e5;break;case d:X=(J-D)/864e5;break;case u:X=J/s;break;case l:X=J/n;break;case o:X=J/r;break;default:X=J}return E?X:P.a(X)},z.daysInMonth=function(){return this.endOf(m).$D},z.$locale=function(){return F[this.$L]},z.locale=function(V,Y){if(!V)return this.$L;var E=this.clone(),X=N(V,Y,!0);return X&&(E.$L=X),E},z.clone=function(){return P.w(this.$d,this)},z.toDate=function(){return new Date(this.valueOf())},z.toJSON=function(){return this.isValid()?this.toISOString():null},z.toISOString=function(){return this.$d.toISOString()},z.toString=function(){return this.$d.toUTCString()},W}(),te=L.prototype;return Q.prototype=te,[["$ms",i],["$s",o],["$m",l],["$H",u],["$W",d],["$M",m],["$y",p],["$D",b]].forEach(function(W){te[W[1]]=function(z){return this.$g(z,W[0],W[1])}}),Q.extend=function(W,z){return W.$i||(W(z,L,Q),W.$i=!0),Q},Q.locale=N,Q.isDayjs=C,Q.unix=function(W){return Q(1e3*W)},Q.en=F[H],Q.Ls=F,Q.p={},Q})}(Mc)),Mc.exports}var Dx=Ix();const ar=Dr(Dx);var Fc={exports:{}},Tx=Fc.exports,Qf;function Mx(){return Qf||(Qf=1,function(t,e){(function(r,n){t.exports=n()})(Tx,function(){var r="week",n="year";return function(s,i,o){var l=i.prototype;l.week=function(u){if(u===void 0&&(u=null),u!==null)return this.add(7*(u-this.week()),"day");var d=this.$locale().yearStart||1;if(this.month()===11&&this.date()>25){var f=o(this).startOf(n).add(1,n).date(d),m=o(this).endOf(r);if(f.isBefore(m))return 1}var v=o(this).startOf(n).date(d).startOf(r).subtract(1,"millisecond"),p=this.diff(v,r,!0);return p<0?o(this).startOf("week").week():Math.ceil(p)},l.weeks=function(u){return u===void 0&&(u=null),this.week(u)}}})}(Fc)),Fc.exports}var Fx=Mx();const Rx=Dr(Fx);var Rc={exports:{}},qx=Rc.exports,Jf;function Bx(){return Jf||(Jf=1,function(t,e){(function(r,n){t.exports=n()})(qx,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},n=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,s=/\d/,i=/\d\d/,o=/\d\d?/,l=/\d*[^-_:/,()\s\d]+/,u={},d=function(y){return(y=+y)+(y>68?1900:2e3)},f=function(y){return function(j){this[y]=+j}},m=[/[+-]\d\d:?(\d\d)?|Z/,function(y){(this.zone||(this.zone={})).offset=function(j){if(!j||j==="Z")return 0;var O=j.match(/([+-]|\d\d)/g),k=60*O[1]+(+O[2]||0);return k===0?0:O[0]==="+"?-k:k}(y)}],v=function(y){var j=u[y];return j&&(j.indexOf?j:j.s.concat(j.f))},p=function(y,j){var O,k=u.meridiem;if(k){for(var I=1;I<=24;I+=1)if(y.indexOf(k(I,0,j))>-1){O=I>12;break}}else O=y===(j?"pm":"PM");return O},b={A:[l,function(y){this.afternoon=p(y,!1)}],a:[l,function(y){this.afternoon=p(y,!0)}],Q:[s,function(y){this.month=3*(y-1)+1}],S:[s,function(y){this.milliseconds=100*+y}],SS:[i,function(y){this.milliseconds=10*+y}],SSS:[/\d{3}/,function(y){this.milliseconds=+y}],s:[o,f("seconds")],ss:[o,f("seconds")],m:[o,f("minutes")],mm:[o,f("minutes")],H:[o,f("hours")],h:[o,f("hours")],HH:[o,f("hours")],hh:[o,f("hours")],D:[o,f("day")],DD:[i,f("day")],Do:[l,function(y){var j=u.ordinal,O=y.match(/\d+/);if(this.day=O[0],j)for(var k=1;k<=31;k+=1)j(k).replace(/\[|\]/g,"")===y&&(this.day=k)}],w:[o,f("week")],ww:[i,f("week")],M:[o,f("month")],MM:[i,f("month")],MMM:[l,function(y){var j=v("months"),O=(v("monthsShort")||j.map(function(k){return k.slice(0,3)})).indexOf(y)+1;if(O<1)throw new Error;this.month=O%12||O}],MMMM:[l,function(y){var j=v("months").indexOf(y)+1;if(j<1)throw new Error;this.month=j%12||j}],Y:[/[+-]?\d+/,f("year")],YY:[i,function(y){this.year=d(y)}],YYYY:[/\d{4}/,f("year")],Z:m,ZZ:m};function w(y){var j,O;j=y,O=u&&u.formats;for(var k=(y=j.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(Q,P,L){var te=L&&L.toUpperCase();return P||O[L]||r[L]||O[te].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(W,z,V){return z||V.slice(1)})})).match(n),I=k.length,H=0;H<I;H+=1){var F=k[H],U=b[F],C=U&&U[0],N=U&&U[1];k[H]=N?{regex:C,parser:N}:F.replace(/^\[|\]$/g,"")}return function(Q){for(var P={},L=0,te=0;L<I;L+=1){var W=k[L];if(typeof W=="string")te+=W.length;else{var z=W.regex,V=W.parser,Y=Q.slice(te),E=z.exec(Y)[0];V.call(P,E),Q=Q.replace(E,"")}}return function(X){var oe=X.afternoon;if(oe!==void 0){var de=X.hours;oe?de<12&&(X.hours+=12):de===12&&(X.hours=0),delete X.afternoon}}(P),P}}return function(y,j,O){O.p.customParseFormat=!0,y&&y.parseTwoDigitYear&&(d=y.parseTwoDigitYear);var k=j.prototype,I=k.parse;k.parse=function(H){var F=H.date,U=H.utc,C=H.args;this.$u=U;var N=C[1];if(typeof N=="string"){var Q=C[2]===!0,P=C[3]===!0,L=Q||P,te=C[2];P&&(te=C[2]),u=this.$locale(),!Q&&te&&(u=O.Ls[te]),this.$d=function(Y,E,X,oe){try{if(["x","X"].indexOf(E)>-1)return new Date((E==="X"?1e3:1)*Y);var de=w(E)(Y),A=de.year,D=de.month,J=de.day,re=de.hours,ce=de.minutes,fe=de.seconds,ee=de.milliseconds,ae=de.zone,pe=de.week,ye=new Date,Le=J||(A||D?1:ye.getDate()),se=A||ye.getFullYear(),Fe=0;A&&!D||(Fe=D>0?D-1:ye.getMonth());var ne,R=re||0,be=ce||0,je=fe||0,Pe=ee||0;return ae?new Date(Date.UTC(se,Fe,Le,R,be,je,Pe+60*ae.offset*1e3)):X?new Date(Date.UTC(se,Fe,Le,R,be,je,Pe)):(ne=new Date(se,Fe,Le,R,be,je,Pe),pe&&(ne=oe(ne).week(pe).toDate()),ne)}catch{return new Date("")}}(F,N,U,O),this.init(),te&&te!==!0&&(this.$L=this.locale(te).$L),L&&F!=this.format(N)&&(this.$d=new Date("")),u={}}else if(N instanceof Array)for(var W=N.length,z=1;z<=W;z+=1){C[1]=N[z-1];var V=O.apply(this,C);if(V.isValid()){this.$d=V.$d,this.$L=V.$L,this.init();break}z===W&&(this.$d=new Date(""))}else I.call(this,H)}}})}(Rc)),Rc.exports}var Ux=Bx();const Wx=Dr(Ux);var qc={exports:{}},zx=qc.exports,Kf;function $x(){return Kf||(Kf=1,function(t,e){(function(r,n){t.exports=n()})(zx,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(n,s,i){var o=s.prototype,l=o.format;i.en.formats=r,o.format=function(u){u===void 0&&(u="YYYY-MM-DDTHH:mm:ssZ");var d=this.$locale().formats,f=function(m,v){return m.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(p,b,w){var y=w&&w.toUpperCase();return b||v[w]||r[w]||v[y].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(j,O,k){return O||k.slice(1)})})}(u,d===void 0?{}:d);return l.call(this,f)}}})}(qc)),qc.exports}var Hx=$x();const Yx=Dr(Hx);var Bc={exports:{}},Vx=Bc.exports,Xf;function Gx(){return Xf||(Xf=1,function(t,e){(function(r,n){t.exports=n()})(Vx,function(){return function(r,n,s){n.prototype.isBetween=function(i,o,l,u){var d=s(i),f=s(o),m=(u=u||"()")[0]==="(",v=u[1]===")";return(m?this.isAfter(d,l):!this.isBefore(d,l))&&(v?this.isBefore(f,l):!this.isAfter(f,l))||(m?this.isBefore(d,l):!this.isAfter(d,l))&&(v?this.isAfter(f,l):!this.isBefore(f,l))}}})}(Bc)),Bc.exports}var Qx=Gx();const Jx=Dr(Qx);ar.extend(Wx);ar.extend(Yx);ar.extend(Jx);const Kx=v0(["Your locale has not been found.","Either the locale key is not a supported one. Locales supported by dayjs are available here: https://github.com/iamkun/dayjs/tree/dev/src/locale","Or you forget to import the locale from 'dayjs/locale/{localeUsed}'","fallback on English locale"]),Xx={YY:"year",YYYY:{sectionType:"year",contentType:"digit",maxLength:4},M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMM:{sectionType:"month",contentType:"letter"},MMMM:{sectionType:"month",contentType:"letter"},D:{sectionType:"day",contentType:"digit",maxLength:2},DD:"day",Do:{sectionType:"day",contentType:"digit-with-letter"},d:{sectionType:"weekDay",contentType:"digit",maxLength:2},dd:{sectionType:"weekDay",contentType:"letter"},ddd:{sectionType:"weekDay",contentType:"letter"},dddd:{sectionType:"weekDay",contentType:"letter"},A:"meridiem",a:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},Zx={year:"YYYY",month:"MMMM",monthShort:"MMM",dayOfMonth:"D",weekday:"dddd",weekdayShort:"dd",hours24h:"HH",hours12h:"hh",meridiem:"A",minutes:"mm",seconds:"ss",fullDate:"ll",fullDateWithWeekday:"dddd, LL",keyboardDate:"L",shortDate:"MMM D",normalDate:"D MMMM",normalDateWithWeekday:"ddd, MMM D",monthAndYear:"MMMM YYYY",monthAndDate:"MMMM D",fullTime:"LT",fullTime12h:"hh:mm A",fullTime24h:"HH:mm",fullDateTime:"lll",fullDateTime12h:"ll hh:mm A",fullDateTime24h:"ll HH:mm",keyboardDateTime:"L LT",keyboardDateTime12h:"L hh:mm A",keyboardDateTime24h:"L HH:mm"},fd=["Missing UTC plugin","To be able to use UTC or timezones, you have to enable the `utc` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-utc"].join(`
`),Zf=["Missing timezone plugin","To be able to use timezones, you have to enable both the `utc` and the `timezone` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-timezone"].join(`
`),ey=(t,e)=>e?(...r)=>t(...r).locale(e):t;class Bl{constructor({locale:e,formats:r,instance:n}={}){var s;this.isMUIAdapter=!0,this.isTimezoneCompatible=!0,this.lib="dayjs",this.rawDayJsInstance=void 0,this.dayjs=void 0,this.locale=void 0,this.formats=void 0,this.escapedCharacters={start:"[",end:"]"},this.formatTokenMap=Xx,this.setLocaleToValue=i=>{const o=this.getCurrentLocaleCode();return o===i.locale()?i:i.locale(o)},this.hasUTCPlugin=()=>typeof ar.utc<"u",this.hasTimezonePlugin=()=>typeof ar.tz<"u",this.isSame=(i,o,l)=>{const u=this.setTimezone(o,this.getTimezone(i));return i.format(l)===u.format(l)},this.cleanTimezone=i=>{switch(i){case"default":return;case"system":return ar.tz.guess();default:return i}},this.createSystemDate=i=>{if(this.rawDayJsInstance)return this.rawDayJsInstance(i);if(this.hasUTCPlugin()&&this.hasTimezonePlugin()){const o=ar.tz.guess();return o!=="UTC"?ar.tz(i,o):ar(i)}return ar(i)},this.createUTCDate=i=>{if(!this.hasUTCPlugin())throw new Error(fd);return ar.utc(i)},this.createTZDate=(i,o)=>{if(!this.hasUTCPlugin())throw new Error(fd);if(!this.hasTimezonePlugin())throw new Error(Zf);const l=i!==void 0&&!i.endsWith("Z");return ar(i).tz(this.cleanTimezone(o),l)},this.getLocaleFormats=()=>{const i=ar.Ls,o=this.locale||"en";let l=i[o];return l===void 0&&(Kx(),l=i.en),l.formats},this.adjustOffset=i=>{if(!this.hasTimezonePlugin())return i;const o=this.getTimezone(i);if(o!=="UTC"){var l,u;const d=i.tz(this.cleanTimezone(o),!0);if(((l=d.$offset)!=null?l:0)===((u=i.$offset)!=null?u:0))return i;i.$offset=d.$offset}return i},this.date=i=>i===null?null:this.dayjs(i),this.dateWithTimezone=(i,o)=>{if(i===null)return null;let l;return o==="UTC"?l=this.createUTCDate(i):o==="system"||o==="default"&&!this.hasTimezonePlugin()?l=this.createSystemDate(i):l=this.createTZDate(i,o),this.locale===void 0?l:l.locale(this.locale)},this.getTimezone=i=>{if(this.hasTimezonePlugin()){var o;const l=(o=i.$x)==null?void 0:o.$timezone;if(l)return l}return this.hasUTCPlugin()&&i.isUTC()?"UTC":"system"},this.setTimezone=(i,o)=>{if(this.getTimezone(i)===o)return i;if(o==="UTC"){if(!this.hasUTCPlugin())throw new Error(fd);return i.utc()}if(o==="system")return i.local();if(!this.hasTimezonePlugin()){if(o==="default")return i;throw new Error(Zf)}return ar.tz(i,this.cleanTimezone(o))},this.toJsDate=i=>i.toDate(),this.parseISO=i=>this.dayjs(i),this.toISO=i=>i.toISOString(),this.parse=(i,o)=>i===""?null:this.dayjs(i,o,this.locale,!0),this.getCurrentLocaleCode=()=>this.locale||"en",this.is12HourCycleInCurrentLocale=()=>/A|a/.test(this.getLocaleFormats().LT||""),this.expandFormat=i=>{const o=this.getLocaleFormats(),l=u=>u.replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(d,f,m)=>f||m.slice(1));return i.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(u,d,f)=>{const m=f&&f.toUpperCase();return d||o[f]||l(o[m])})},this.getFormatHelperText=i=>this.expandFormat(i).replace(/a/gi,"(a|p)m").toLocaleLowerCase(),this.isNull=i=>i===null,this.isValid=i=>this.dayjs(i).isValid(),this.format=(i,o)=>this.formatByString(i,this.formats[o]),this.formatByString=(i,o)=>this.dayjs(i).format(o),this.formatNumber=i=>i,this.getDiff=(i,o,l)=>i.diff(o,l),this.isEqual=(i,o)=>i===null&&o===null?!0:this.dayjs(i).toDate().getTime()===this.dayjs(o).toDate().getTime(),this.isSameYear=(i,o)=>this.isSame(i,o,"YYYY"),this.isSameMonth=(i,o)=>this.isSame(i,o,"YYYY-MM"),this.isSameDay=(i,o)=>this.isSame(i,o,"YYYY-MM-DD"),this.isSameHour=(i,o)=>i.isSame(o,"hour"),this.isAfter=(i,o)=>i>o,this.isAfterYear=(i,o)=>this.hasUTCPlugin()?!this.isSameYear(i,o)&&i.utc()>o.utc():i.isAfter(o,"year"),this.isAfterDay=(i,o)=>this.hasUTCPlugin()?!this.isSameDay(i,o)&&i.utc()>o.utc():i.isAfter(o,"day"),this.isBefore=(i,o)=>i<o,this.isBeforeYear=(i,o)=>this.hasUTCPlugin()?!this.isSameYear(i,o)&&i.utc()<o.utc():i.isBefore(o,"year"),this.isBeforeDay=(i,o)=>this.hasUTCPlugin()?!this.isSameDay(i,o)&&i.utc()<o.utc():i.isBefore(o,"day"),this.isWithinRange=(i,[o,l])=>i>=o&&i<=l,this.startOfYear=i=>this.adjustOffset(i.startOf("year")),this.startOfMonth=i=>this.adjustOffset(i.startOf("month")),this.startOfWeek=i=>this.adjustOffset(i.startOf("week")),this.startOfDay=i=>this.adjustOffset(i.startOf("day")),this.endOfYear=i=>this.adjustOffset(i.endOf("year")),this.endOfMonth=i=>this.adjustOffset(i.endOf("month")),this.endOfWeek=i=>this.adjustOffset(i.endOf("week")),this.endOfDay=i=>this.adjustOffset(i.endOf("day")),this.addYears=(i,o)=>this.adjustOffset(o<0?i.subtract(Math.abs(o),"year"):i.add(o,"year")),this.addMonths=(i,o)=>this.adjustOffset(o<0?i.subtract(Math.abs(o),"month"):i.add(o,"month")),this.addWeeks=(i,o)=>this.adjustOffset(o<0?i.subtract(Math.abs(o),"week"):i.add(o,"week")),this.addDays=(i,o)=>this.adjustOffset(o<0?i.subtract(Math.abs(o),"day"):i.add(o,"day")),this.addHours=(i,o)=>this.adjustOffset(o<0?i.subtract(Math.abs(o),"hour"):i.add(o,"hour")),this.addMinutes=(i,o)=>this.adjustOffset(o<0?i.subtract(Math.abs(o),"minute"):i.add(o,"minute")),this.addSeconds=(i,o)=>this.adjustOffset(o<0?i.subtract(Math.abs(o),"second"):i.add(o,"second")),this.getYear=i=>i.year(),this.getMonth=i=>i.month(),this.getDate=i=>i.date(),this.getHours=i=>i.hour(),this.getMinutes=i=>i.minute(),this.getSeconds=i=>i.second(),this.getMilliseconds=i=>i.millisecond(),this.setYear=(i,o)=>this.adjustOffset(i.set("year",o)),this.setMonth=(i,o)=>this.adjustOffset(i.set("month",o)),this.setDate=(i,o)=>this.adjustOffset(i.set("date",o)),this.setHours=(i,o)=>this.adjustOffset(i.set("hour",o)),this.setMinutes=(i,o)=>this.adjustOffset(i.set("minute",o)),this.setSeconds=(i,o)=>this.adjustOffset(i.set("second",o)),this.setMilliseconds=(i,o)=>this.adjustOffset(i.set("millisecond",o)),this.getDaysInMonth=i=>i.daysInMonth(),this.getNextMonth=i=>this.addMonths(i,1),this.getPreviousMonth=i=>this.addMonths(i,-1),this.getMonthArray=i=>{const l=[i.startOf("year")];for(;l.length<12;){const u=l[l.length-1];l.push(this.addMonths(u,1))}return l},this.mergeDateAndTime=(i,o)=>i.hour(o.hour()).minute(o.minute()).second(o.second()),this.getWeekdays=()=>{const i=this.dayjs().startOf("week");return[0,1,2,3,4,5,6].map(o=>this.formatByString(this.addDays(i,o),"dd"))},this.getWeekArray=i=>{const o=this.setLocaleToValue(i),l=o.startOf("month").startOf("week"),u=o.endOf("month").endOf("week");let d=0,f=l;const m=[];for(;f<u;){const v=Math.floor(d/7);m[v]=m[v]||[],m[v].push(f),f=this.addDays(f,1),d+=1}return m},this.getWeekNumber=i=>i.week(),this.getYearRange=(i,o)=>{const l=i.startOf("year"),u=o.endOf("year"),d=[];let f=l;for(;f<u;)d.push(f),f=this.addYears(f,1);return d},this.getMeridiemText=i=>i==="am"?"AM":"PM",this.rawDayJsInstance=n,this.dayjs=ey((s=this.rawDayJsInstance)!=null?s:ar,e),this.locale=e,this.formats=wm({},Zx,r),ar.extend(Rx)}}const ty=({onClick:t,isOpen:e,unreadCount:r=0})=>a.jsx(x0,{color:"primary","aria-label":"chat",onClick:t,sx:{position:"fixed",bottom:24,right:24,zIndex:1e3,boxShadow:3,"&:hover":{transform:"scale(1.1)",transition:"transform 0.2s ease-in-out"}},children:a.jsx(y0,{badgeContent:r,color:"error",children:a.jsx(b0,{})})}),ry=({message:t})=>{const e=t.sender==="user";return a.jsxs(ue,{sx:{display:"flex",justifyContent:e?"flex-end":"flex-start",mb:2,gap:1},children:[!e&&a.jsx(Fd,{sx:{bgcolor:"primary.main",width:32,height:32},children:a.jsx(w0,{fontSize:"small"})}),a.jsxs(At,{elevation:1,sx:{maxWidth:"70%",p:2,bgcolor:e?"primary.main":"grey.100",color:e?"white":"text.primary",borderRadius:2,wordWrap:"break-word"},children:[a.jsx(q,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:t.text}),a.jsx(q,{variant:"caption",sx:{display:"block",mt:.5,opacity:.7,textAlign:e?"right":"left"},children:t.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e&&a.jsx(Fd,{sx:{bgcolor:"secondary.main",width:32,height:32},children:a.jsx(_0,{fontSize:"small"})})]})},ny=({onSendMessage:t,disabled:e=!1,placeholder:r="Type your message..."})=>{const[n,s]=_.useState(""),i=()=>{n.trim()&&!e&&(t(n.trim()),s(""))},o=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),i())};return a.jsx(At,{elevation:2,sx:{p:2,borderTop:1,borderColor:"divider"},children:a.jsxs(ue,{sx:{display:"flex",gap:1,alignItems:"flex-end"},children:[a.jsx(Oe,{fullWidth:!0,multiline:!0,maxRows:4,value:n,onChange:l=>s(l.target.value),onKeyPress:o,placeholder:r,disabled:e,variant:"outlined",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}}),a.jsx(jr,{color:"primary",onClick:i,disabled:!n.trim()||e,sx:{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},"&.Mui-disabled":{bgcolor:"grey.300",color:"grey.500"}},children:a.jsx(j0,{})})]})})},ep={async testConnection(){try{const t=await xe.get("/api/ai-assistant/health");return console.log("AI Assistant Health Check:",t.data),t.data.success&&t.data.data.status==="healthy"}catch(t){return console.error("AI Assistant Health Check Error:",t),!1}},async sendMessage(t,e){try{console.log("Sending message to AI assistant:",t);const r={message:t};e&&(r.conversationId=e);const n=await xe.post("/api/ai-assistant/chat",r);if(console.log("AI Assistant Response:",n.data),n.data.success)return n.data.data;throw new Error(n.data.message||"Failed to get response from AI assistant")}catch(r){return console.error("Error calling AI assistant API:",r),{response:this.getFallbackResponse(t),sources:["fallback"],confidence:.5,toolUsed:"fallback",timestamp:new Date().toISOString()}}},async getConversationHistory(t){try{const e=await xe.get(`/api/ai-assistant/conversation/${t}`);return e.data.success?e.data.data.messages:[]}catch(e){return console.error("Error getting conversation history:",e),[]}},async clearConversation(t){try{return(await xe.delete(`/api/ai-assistant/conversation/${t}`)).data.success}catch(e){return console.error("Error clearing conversation:",e),!1}},async getStatistics(){try{const t=await xe.get("/api/ai-assistant/stats");return t.data.success?t.data.data:{}}catch(t){return console.error("Error getting AI assistant statistics:",t),{}}},getFallbackResponse(t){const e=t.toLowerCase();return e.includes("hello")||e.includes("hi")?"Hello! I'm your AI assistant for the Soft SME business management system. How can I help you today?":e.includes("inventory")||e.includes("stock")?"I can help you with inventory management. You can check your current stock levels, add new items, or track inventory movements in the Inventory section. Navigate to 'Stock' in the sidebar to manage your inventory.":e.includes("customer")||e.includes("client")?"For customer management, you can view and manage your customer database in the Customers section. You can add new customers, view their details, and track their orders. Find this in the 'Customers' section of the sidebar.":e.includes("purchase")||e.includes("order")?"Purchase orders can be managed in the Purchase Orders section. You can create new orders, track existing ones, and manage vendor relationships. Look for 'Purchase Orders' in the sidebar under the Purchasing section.":e.includes("sales")||e.includes("quote")?"Sales and quotes are handled in the Sales Orders and Quotes sections. You can create quotes, convert them to orders, and track your sales pipeline. These are available in the 'Sales' section of the sidebar.":e.includes("time")||e.includes("tracking")?"Time tracking features are available in the Time Tracking section. You can log hours, view reports, and manage employee attendance. Find this under 'Employees & Time Tracking' in the sidebar.":e.includes("help")||e.includes("support")?"I'm here to help! You can ask me about any aspect of the Soft SME system - inventory, customers, orders, time tracking, or general navigation. What would you like to know?":"I'm here to help you with the Soft SME business management system. You can ask me about inventory, customers, purchase orders, sales, time tracking, or any other features. How can I assist you?"}},pd="chat_messages",gg=()=>{const[t,e]=_.useState([]),[r,n]=_.useState(!1),[s,i]=_.useState(!1);_.useEffect(()=>{const v=localStorage.getItem(pd);if(v)try{const b=JSON.parse(v).map(w=>({...w,timestamp:new Date(w.timestamp)}));e(b)}catch(p){console.error("Error loading chat messages:",p)}},[]),_.useEffect(()=>{localStorage.setItem(pd,JSON.stringify(t))},[t]);const o=_.useCallback(v=>{e(p=>[...p,v])},[]),l=_.useCallback(async v=>{const p={id:Date.now().toString(),text:v,sender:"user",timestamp:new Date};o(p),n(!0);try{const b=await ep.sendMessage(v);console.log("AI Response in useChat:",b),console.log("AI Response type:",typeof b),console.log("AI Response keys:",Object.keys(b));const w={id:(Date.now()+1).toString(),text:b.response||"No response received",sender:"ai",timestamp:new Date};o(w)}catch(b){console.error("Error sending message:",b);const w={id:(Date.now()+1).toString(),text:"Sorry, I encountered an error. Please try again.",sender:"ai",timestamp:new Date};o(w)}finally{n(!1)}},[o]),u=_.useCallback(()=>{e([]),localStorage.removeItem(pd)},[]),d=_.useCallback(()=>{i(v=>!v)},[]),f=_.useCallback(()=>{i(!1)},[]),m=_.useCallback(async()=>{i(!0);const v=await ep.testConnection();console.log("API Connection Test:",v?"SUCCESS":"FAILED")},[]);return{messages:t,isLoading:r,isOpen:s,sendMessage:l,clearMessages:u,toggleChat:d,closeChat:f,openChat:m}},ay=({isOpen:t,onClose:e})=>{const{messages:r,isLoading:n,sendMessage:s,clearMessages:i}=gg(),o=_.useRef(null);_.useEffect(()=>{o.current?.scrollIntoView({behavior:"smooth"})},[r]);const l=()=>{window.confirm("Are you sure you want to clear all messages?")&&i()};return a.jsxs(Rd,{anchor:"right",open:t,onClose:e,sx:{"& .MuiDrawer-paper":{width:{xs:"100%",sm:400},maxWidth:"100vw",height:"100%",display:"flex",flexDirection:"column"}},children:[a.jsxs(ue,{sx:{p:2,borderBottom:1,borderColor:"divider",display:"flex",alignItems:"center",justifyContent:"space-between",bgcolor:"primary.main",color:"white"},children:[a.jsx(q,{variant:"h6",sx:{fontWeight:"bold"},children:"AI Assistant"}),a.jsxs(ue,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(Ce,{variant:"outlined",size:"small",onClick:l,sx:{color:"white",borderColor:"white","&:hover":{borderColor:"white",bgcolor:"rgba(255, 255, 255, 0.1)"},textTransform:"none",fontSize:"0.75rem",px:1,py:.5},children:"Clear Chat"}),a.jsx(jr,{color:"inherit",onClick:e,size:"small",children:a.jsx(S0,{})})]})]}),a.jsx(ue,{sx:{flex:1,overflow:"auto",p:2,display:"flex",flexDirection:"column",gap:1},children:r.length===0?a.jsxs(ue,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center",color:"text.secondary"},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Welcome to AI Assistant"}),a.jsxs(q,{variant:"body2",children:["I'm here to help you with your business management tasks.",a.jsx("br",{}),"Ask me anything about inventory, customers, orders, or time tracking!"]})]}):a.jsxs(a.Fragment,{children:[r.map(u=>a.jsx(ry,{message:u},u.id)),n&&a.jsx(ue,{sx:{display:"flex",justifyContent:"flex-start",mb:2,gap:1},children:a.jsxs(ue,{sx:{display:"flex",alignItems:"center",gap:1,p:2,bgcolor:"grey.100",borderRadius:2},children:[a.jsx(pr,{size:16}),a.jsx(q,{variant:"body2",color:"text.secondary",children:"AI is typing..."})]})}),a.jsx("div",{ref:o})]})}),a.jsx(io,{}),a.jsx(ny,{onSendMessage:s,disabled:n,placeholder:"Ask me anything about your business..."})]})},eu=async()=>{try{const t=await window?.api?.timeEvents?.pendingCount?.();return t?.success?t.count:0}catch{return 0}},sy=async(t=200)=>{const e=await window?.api?.timeEvents?.listPending?.(t);return e?.success?e.rows:[]},vg=async()=>{const t=await sy(200);let e=0,r=0;const n=[];for(const s of t)try{const i=JSON.parse(s.payload_json||"{}");switch(s.type){case"attendance_clock_in":await xe.post("/api/attendance/clock-in",{profile_id:i.profile_id});break;case"attendance_clock_out":await xe.post("/api/attendance/clock-out",{shift_id:i.shift_id});break;case"attendance_update":await xe.put(`/api/attendance/${i.shift_id}`,{clock_in:i.clock_in,clock_out:i.clock_out});break;case"time_clock_in":await xe.post("/api/time-tracking/time-entries/clock-in",{profile_id:i.profile_id,so_id:i.so_id});break;case"time_clock_out":await xe.post(`/api/time-tracking/time-entries/${i.id}/clock-out`);break;default:r++;continue}n.push(s.event_id),e++}catch{r++}return n.length&&await window?.api?.timeEvents?.markSynced?.(n),{synced:e,failed:r}},Hi=240,iy=()=>{const[t,e]=vs.useState(!1),r=Vr(),{logout:n,user:s}=Aa(),{isOpen:i,toggleChat:o,closeChat:l}=gg(),[u,d]=_.useState(0);_.useEffect(()=>{let w=!0;const y=async()=>{try{const O=await eu();w&&d(O)}catch{}},j=setInterval(y,15e3);return y(),()=>{w=!1,clearInterval(j)}},[]);const f=()=>{e(!t)},m=()=>{n(),r("/login")},v=[{type:"header",text:"Dashboard"},{text:"Dashboard",icon:a.jsx(qd,{}),path:"/dashboard"},{type:"header",text:"Purchasing"},{text:"Purchase Orders",icon:a.jsx(Nl,{}),path:"/open-purchase-orders"},{text:"Parts to Order",icon:a.jsx(ms,{}),path:"/parts-to-order"},{text:"Vendors",icon:a.jsx(jm,{}),path:"/vendors"},{type:"header",text:"Sales"},{text:"Quotes",icon:a.jsx(Bd,{}),path:"/quotes"},{text:"Sales Orders",icon:a.jsx(Ll,{}),path:"/open-sales-orders"},{text:"Customers",icon:a.jsx(Gc,{}),path:"/customers"},{type:"header",text:"Products & Inventory"},{text:"Products",icon:a.jsx(Sm,{}),path:"/products"},{text:"Stock",icon:a.jsx(ms,{}),path:"/inventory"},{text:"Supply",icon:a.jsx(ms,{}),path:"/supply"},{type:"header",text:"Time Tracking"},{text:"Attendance",icon:a.jsx(ui,{}),path:"/attendance"},{text:"Time Tracking",icon:a.jsx(ui,{}),path:"/time-tracking"},{text:"Time Tracking Reports",icon:a.jsx(Cm,{}),path:"/time-tracking/reports"},{type:"header",text:"Settings"},{text:"Business Profile",icon:a.jsx(yh,{}),path:"/business-profile"},{text:"Employees",icon:a.jsx(Pm,{}),path:"/employees"},{text:"Accounting",icon:a.jsx(Qc,{}),path:"/qbo-account-mapping"},{text:"Global Variables",icon:a.jsx(Qc,{}),path:"/margin-schedule"},{text:"Email Settings",icon:a.jsx(km,{}),path:"/email-settings"},{text:"Mobile User Access",icon:a.jsx(Gc,{}),path:"/mobile-user-access"},{text:"Backup Management",icon:a.jsx(bh,{}),path:"/backup-management"}],p=vs.useMemo(()=>{if(s?.access_role==="Time Tracking")return[{text:"Attendance",icon:a.jsx(ui,{}),path:"/attendance"},{text:"Time Tracking",icon:a.jsx(ui,{}),path:"/time-tracking"}];const w=[{type:"header",text:"Main"},{text:"Dashboard",icon:a.jsx(qd,{}),path:"/"}];return s?.access_role==="Sales and Purchase"?[...w,{type:"header",text:"Sales & Purchase"},{text:"Sales Orders",icon:a.jsx(Ll,{}),path:"/open-sales-orders"},{text:"Purchase Orders",icon:a.jsx(Nl,{}),path:"/open-purchase-orders"},{text:"Parts to Order",icon:a.jsx(ms,{}),path:"/parts-to-order"}]:v},[s,v]),b=a.jsxs("div",{children:[a.jsx(ld,{}),a.jsx(oo,{children:p.map((w,y)=>w.type==="header"?a.jsx(C0,{sx:{bgcolor:"inherit",color:"text.secondary",fontWeight:"bold",fontSize:13,textAlign:"left",pl:2},children:w.text},`header-${w.text}-${y}`):a.jsxs(lo,{onClick:()=>{r(w.path),e(!1)},sx:{cursor:"pointer"},children:[a.jsx(P0,{children:w.icon}),a.jsx(co,{primary:w.text})]},w.path||`${w.text}-${y}`))})]});return a.jsxs(ue,{sx:{display:"flex"},children:[a.jsx(k0,{position:"fixed",sx:{width:{sm:`calc(100% - ${Hi}px)`},ml:{sm:`${Hi}px`}},children:a.jsxs(ld,{children:[a.jsx(Ce,{color:"inherit",startIcon:a.jsx(_m,{}),onClick:()=>r(-1),sx:{mr:2,display:{xs:"none",sm:"inline-flex"}},children:"Back"}),a.jsx(jr,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:f,sx:{mr:2,display:{sm:"none"}},children:a.jsx(A0,{})}),a.jsxs(ue,{sx:{marginLeft:"auto",display:"flex",alignItems:"center",gap:2},children:[window.__backendUnavailableSince&&a.jsx(Zi,{title:"Backend unavailable; pending events will sync automatically when online.",children:a.jsxs(ue,{sx:{bgcolor:"orange",color:"black",px:1.5,py:.5,borderRadius:1,fontSize:12},children:["Offline",u?`  Pending: ${u}`:""]})}),u>0&&a.jsx(Ce,{color:"inherit",size:"small",onClick:async()=>{await vg();const w=await eu();d(w)},children:"Sync now"}),a.jsx(Ce,{color:"inherit",onClick:m,startIcon:a.jsx(L0,{}),children:"Logout"})]})]})}),a.jsxs(ue,{component:"nav",sx:{width:{sm:Hi},flexShrink:{sm:0}},children:[a.jsx(Rd,{variant:"temporary",open:t,onClose:f,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",sm:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:Hi}},children:b}),a.jsx(Rd,{variant:"permanent",sx:{display:{xs:"none",sm:"block"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:Hi}},open:!0,children:b})]}),a.jsxs(ue,{component:"main",sx:{flexGrow:1,p:3,width:{sm:`calc(100% - ${Hi}px)`}},children:[a.jsx(ld,{}),a.jsx(qv,{})]}),a.jsx(ty,{onClick:o,isOpen:i}),a.jsx(ay,{isOpen:i,onClose:l})]})},oy=()=>{const t=Vr(),{login:e}=Aa(),[r,n]=_.useState({email:"",password:""}),[s,i]=_.useState(null),[o,l]=_.useState(!1),[u,d]=_.useState(!1);_.useEffect(()=>{const v=localStorage.getItem("rememberedEmail"),p=localStorage.getItem("rememberedPassword");v&&p&&(n({email:v,password:p}),d(!0))},[]);const f=v=>{const{name:p,value:b}=v.target;n(w=>({...w,[p]:b}))},m=async v=>{v.preventDefault(),i(null),l(!0),u?(localStorage.setItem("rememberedEmail",r.email),localStorage.setItem("rememberedPassword",r.password)):(localStorage.removeItem("rememberedEmail"),localStorage.removeItem("rememberedPassword"));try{const p=await xe.post("/api/auth/login",r),{sessionToken:b,refreshToken:w,user:y}=p.data;e(b,w,y),y.access_role==="Time Tracking"?t("/time-tracking"):y.access_role==="Quotes"?t("/quotes"):t("/")}catch(p){console.error("Login error:",p),i(p.response?.data?.message||"Failed to login. Please try again.")}finally{l(!1)}};return a.jsx(er,{component:"main",maxWidth:"xs",children:a.jsx(ue,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:a.jsxs(At,{elevation:3,sx:{padding:4,display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[a.jsx(q,{component:"h1",variant:"h5",gutterBottom:!0,children:"Sign In"}),s&&a.jsx(Ct,{severity:"error",sx:{width:"100%",mb:2},children:s}),a.jsxs(ue,{component:"form",onSubmit:m,sx:{mt:1,width:"100%"},children:[a.jsx(Oe,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:r.email,onChange:f}),a.jsx(Oe,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:r.password,onChange:f}),a.jsx(El,{control:a.jsx(N0,{value:"remember",color:"primary",checked:u,onChange:v=>d(v.target.checked)}),label:"Remember me"}),a.jsx(Ce,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:o,children:o?"Signing in...":"Sign In"}),a.jsx(ue,{sx:{textAlign:"center"},children:a.jsx(E0,{component:Kv,to:"/register",variant:"body2",children:"Don't have an account? Register your company"})})]})]})})})},ly=()=>{const t=Vr(),{login:e}=Aa(),[r,n]=_.useState({companyName:"",adminUsername:"",adminEmail:"",adminPassword:"",confirmPassword:""}),[s,i]=_.useState(null),[o,l]=_.useState(!1),u=f=>{const{name:m,value:v}=f.target;n(p=>({...p,[m]:v}))},d=async f=>{if(f.preventDefault(),i(null),r.adminPassword!==r.confirmPassword){i("Passwords do not match");return}l(!0);try{const m=await xe.post("/api/auth/register-company",{company_name:r.companyName,admin_username:r.adminUsername,admin_email:r.adminEmail,admin_password:r.adminPassword}),{sessionToken:v,refreshToken:p,user:b}=m.data;e(v,p,b),t("/dashboard")}catch(m){console.error("Registration error:",m),i(m.response?.data?.message||"Failed to register company. Please try again.")}finally{l(!1)}};return a.jsx(er,{component:"main",maxWidth:"sm",children:a.jsx(ue,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:a.jsxs(At,{elevation:3,sx:{padding:4,display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[a.jsx(q,{component:"h1",variant:"h5",gutterBottom:!0,children:"Register Your Company"}),s&&a.jsx(Ct,{severity:"error",sx:{width:"100%",mb:2},children:s}),a.jsxs(ue,{component:"form",onSubmit:d,sx:{mt:3,width:"100%"},children:[a.jsxs(Z,{container:!0,spacing:2,children:[a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{required:!0,fullWidth:!0,label:"Company Name",name:"companyName",value:r.companyName,onChange:u})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{required:!0,fullWidth:!0,label:"Admin Username",name:"adminUsername",value:r.adminUsername,onChange:u})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{required:!0,fullWidth:!0,label:"Admin Email",name:"adminEmail",type:"email",value:r.adminEmail,onChange:u})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{required:!0,fullWidth:!0,label:"Admin Password",name:"adminPassword",type:"password",value:r.adminPassword,onChange:u})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{required:!0,fullWidth:!0,label:"Confirm Password",name:"confirmPassword",type:"password",value:r.confirmPassword,onChange:u})})]}),a.jsx(Ce,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:o,children:o?"Registering...":"Register Company"})]})]})})})},cy={Purchasing:a.jsx(Nl,{sx:{color:"primary.main"}}),Sales:a.jsx(Ll,{sx:{color:"primary.main"}}),"Products & Inventory":a.jsx(ms,{sx:{color:"primary.main"}}),"Time Tracking":a.jsx(ui,{sx:{color:"primary.main"}}),Settings:a.jsx(yh,{sx:{color:"primary.main"}})},tp=()=>{const t=Vr(),e=O0(),{user:r}=Aa();console.log("[LandingPage] user:",r);let s=[{title:"Purchasing",items:[{title:"Purchase Orders",description:"Manage purchase orders",icon:a.jsx(Nl,{sx:{fontSize:40,color:"primary.main"}}),path:"/open-purchase-orders"},{title:"Parts to Order",description:"Manage parts ordering",icon:a.jsx(ms,{sx:{fontSize:40,color:"primary.main"}}),path:"/parts-to-order"},{title:"Vendors",description:"Manage your vendors",icon:a.jsx(jm,{sx:{fontSize:40,color:"primary.main"}}),path:"/vendors"}]},{title:"Sales",items:[{title:"Quotes",description:"Manage and track quotes",icon:a.jsx(Bd,{sx:{fontSize:40,color:"primary.main"}}),path:"/quotes"},{title:"Sales Orders",description:"Manage sales orders",icon:a.jsx(Ll,{sx:{fontSize:40,color:"primary.main"}}),path:"/open-sales-orders"},{title:"Customers",description:"Track and manage your customer relationships",icon:a.jsx(Gc,{sx:{fontSize:40,color:"primary.main"}}),path:"/customers"}]},{title:"Products & Inventory",items:[{title:"Products",description:"Manage your products",icon:a.jsx(Sm,{sx:{fontSize:40,color:"primary.main"}}),path:"/products"},{title:"Stock",description:"Manage your product inventory and stock levels",icon:a.jsx(ms,{sx:{fontSize:40,color:"primary.main"}}),path:"/inventory"},{title:"Supply",description:"Manage supply and materials",icon:a.jsx(ms,{sx:{fontSize:40,color:"primary.main"}}),path:"/supply"}]},{title:"Time Tracking",items:[{title:"Attendance",description:"View and manage attendance records",icon:a.jsx(ui,{sx:{fontSize:40,color:"primary.main"}}),path:"/attendance"},{title:"Time Tracking",description:"Track employee time and project hours",icon:a.jsx(ui,{sx:{fontSize:40,color:"primary.main"}}),path:"/time-tracking"},{title:"Time Tracking Reports",description:"View and export time tracking reports",icon:a.jsx(Cm,{sx:{fontSize:40,color:"primary.main"}}),path:"/time-tracking/reports"}]},{title:"Settings",items:[{title:"Business Profile",description:"Manage your company information and settings",icon:a.jsx(yh,{sx:{fontSize:40,color:"primary.main"}}),path:"/business-profile"},{title:"Employees",description:"Manage employee accounts and roles",icon:a.jsx(Pm,{sx:{fontSize:40,color:"primary.main"}}),path:"/employees"},{title:"Accounting",description:"Configure QuickBooks account mappings",icon:a.jsx(Qc,{sx:{fontSize:40,color:"primary.main"}}),path:"/qbo-account-mapping"},{title:"Global Variables",description:"Set and manage margin, labour, and overhead rates",icon:a.jsx(Qc,{sx:{fontSize:40,color:"primary.main"}}),path:"/margin-schedule"},{title:"Email Settings",description:"Configure system email settings",icon:a.jsx(km,{sx:{fontSize:40,color:"primary.main"}}),path:"/email-settings"},{title:"Mobile User Access",description:"Manage mobile user access to profiles",icon:a.jsx(Gc,{sx:{fontSize:40,color:"primary.main"}}),path:"/mobile-user-access"},{title:"Backup Management",description:"Manage system backups and restores",icon:a.jsx(bh,{sx:{fontSize:40,color:"primary.main"}}),path:"/backup-management"}]}];return r?.access_role==="Sales and Purchase"&&(s=[{title:"Sales & Purchase",items:[{title:"Sales Orders",description:"Manage sales orders",icon:a.jsx(Ll,{sx:{fontSize:40,color:"primary.main"}}),path:"/open-sales-orders"},{title:"Purchase Orders",description:"Manage purchase orders",icon:a.jsx(Nl,{sx:{fontSize:40,color:"primary.main"}}),path:"/open-purchase-orders"},{title:"Parts to Order",description:"View parts that need to be ordered",icon:a.jsx(ms,{sx:{fontSize:40,color:"primary.main"}}),path:"/parts-to-order"}]}]),r?.access_role==="Quotes"&&(s=[{title:"Quotes",items:[{title:"Quotes",description:"Manage and track quotes",icon:a.jsx(Bd,{sx:{fontSize:40,color:"primary.main"}}),path:"/quotes"}]}]),console.log("[LandingPage] filteredSections:",s),a.jsxs(er,{maxWidth:"lg",sx:{mt:4,mb:4},children:[a.jsxs(ue,{sx:{background:`linear-gradient(90deg, ${e.palette.primary.main} 0%, ${e.palette.secondary.main} 100%)`,borderRadius:3,p:4,mb:6,color:e.palette.primary.contrastText,boxShadow:3,textAlign:"center"},children:[a.jsx(q,{variant:"h3",component:"h1",gutterBottom:!0,sx:{color:"inherit"},children:"Welcome to Soft SME"}),a.jsx(q,{variant:"h5",component:"h2",gutterBottom:!0,sx:{color:"inherit",opacity:.85},children:"Your all-in-one business management solution"})]}),s.map((i,o)=>a.jsx(xf,{in:!0,timeout:700+o*200,children:a.jsxs(ue,{sx:{mt:6,mb:4,p:3,borderRadius:3,background:e.palette.mode==="light"?e.palette.grey[50]:e.palette.grey[900],boxShadow:1},children:[a.jsxs(ue,{sx:{display:"flex",alignItems:"center",mb:2},children:[a.jsx(Fd,{sx:{bgcolor:"primary.main",mr:2},children:cy[i.title]||a.jsx(qd,{sx:{color:"primary.main"}})}),a.jsx(q,{variant:"h4",component:"h2",sx:{color:"primary.main",fontWeight:600},children:i.title})]}),a.jsx(Z,{container:!0,spacing:4,children:i.items.map((l,u)=>a.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:a.jsx(xf,{in:!0,timeout:900+u*150,children:a.jsx(Ir,{sx:{height:"100%",display:"flex",flexDirection:"column",borderRadius:2,boxShadow:2,transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-6px) scale(1.03)",boxShadow:6,cursor:"pointer"},bgcolor:"background.paper"},onClick:()=>t(l.path),tabIndex:0,role:"button","aria-label":l.title,children:a.jsxs(Yr,{sx:{flexGrow:1,textAlign:"center"},children:[l.icon,a.jsx(q,{gutterBottom:!0,variant:"h5",component:"h2",children:l.title}),a.jsx(q,{children:l.description})]})})})},u))}),o<s.length-1&&a.jsx(io,{sx:{mt:4,mb:2}})]})},i.title))]})};var Jo={},md={};const uy=$0(I0);var rp;function Cn(){return rp||(rp=1,function(t){"use client";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return e.createSvgIcon}});var e=uy}(md)),md}var np;function dy(){if(np)return Jo;np=1;var t=jn();Object.defineProperty(Jo,"__esModule",{value:!0}),Jo.default=void 0;var e=t(Cn()),r=Sn();return Jo.default=(0,e.default)((0,r.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),Jo}var hy=dy();const la=Dr(hy);var Ko={},ap;function fy(){if(ap)return Ko;ap=1;var t=jn();Object.defineProperty(Ko,"__esModule",{value:!0}),Ko.default=void 0;var e=t(Cn()),r=Sn();return Ko.default=(0,e.default)((0,r.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),Ko}var py=fy();const yo=Dr(py);var Xo={},sp;function my(){if(sp)return Xo;sp=1;var t=jn();Object.defineProperty(Xo,"__esModule",{value:!0}),Xo.default=void 0;var e=t(Cn()),r=Sn();return Xo.default=(0,e.default)((0,r.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),Xo}var gy=my();const Tl=Dr(gy),Nh=t=>typeof t=="number"&&!isNaN(t),Sl=t=>typeof t=="string",xg=t=>typeof t=="function",vy=t=>_.isValidElement(t)||Sl(t)||xg(t)||Nh(t);function xy(t,e,r){r===void 0&&(r=300);const{scrollHeight:n,style:s}=t;requestAnimationFrame(()=>{s.minHeight="initial",s.height=n+"px",s.transition=`all ${r}ms`,requestAnimationFrame(()=>{s.height="0",s.padding="0",s.margin="0",setTimeout(e,r)})})}function wu(t){let{enter:e,exit:r,appendPosition:n=!1,collapse:s=!0,collapseDuration:i=300}=t;return function(o){let{children:l,position:u,preventExitTransition:d,done:f,nodeRef:m,isIn:v,playToast:p}=o;const b=n?`${e}--${u}`:e,w=n?`${r}--${u}`:r,y=_.useRef(0);return _.useLayoutEffect(()=>{const j=m.current,O=b.split(" "),k=I=>{I.target===m.current&&(p(),j.removeEventListener("animationend",k),j.removeEventListener("animationcancel",k),y.current===0&&I.type!=="animationcancel"&&j.classList.remove(...O))};j.classList.add(...O),j.addEventListener("animationend",k),j.addEventListener("animationcancel",k)},[]),_.useEffect(()=>{const j=m.current,O=()=>{j.removeEventListener("animationend",O),s?xy(j,f,i):f()};v||(d?O():(y.current=1,j.className+=` ${w}`,j.addEventListener("animationend",O)))},[v]),vs.createElement(vs.Fragment,null,l)}}const Qa=new Map;let Kd=[];const ip=new Set,yg=()=>Qa.size>0;function yy(t,e){var r;if(e)return!((r=Qa.get(e))==null||!r.isToastActive(t));let n=!1;return Qa.forEach(s=>{s.isToastActive(t)&&(n=!0)}),n}function by(t,e){vy(t)&&(yg()||Kd.push({content:t,options:e}),Qa.forEach(r=>{r.buildToast(t,e)}))}function op(t,e){Qa.forEach(r=>{e!=null&&e!=null&&e.containerId?e?.containerId===r.id&&r.toggle(t,e?.id):r.toggle(t,e?.id)})}let wy=1;const bg=()=>""+wy++;function _y(t){return t&&(Sl(t.toastId)||Nh(t.toastId))?t.toastId:bg()}function Cl(t,e){return by(t,e),e.toastId}function tu(t,e){return{...e,type:e&&e.type||t,toastId:_y(e)}}function Cc(t){return(e,r)=>Cl(e,tu(t,r))}function ve(t,e){return Cl(t,tu("default",e))}ve.loading=(t,e)=>Cl(t,tu("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...e})),ve.promise=function(t,e,r){let n,{pending:s,error:i,success:o}=e;s&&(n=Sl(s)?ve.loading(s,r):ve.loading(s.render,{...r,...s}));const l={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},u=(f,m,v)=>{if(m==null)return void ve.dismiss(n);const p={type:f,...l,...r,data:v},b=Sl(m)?{render:m}:m;return n?ve.update(n,{...p,...b}):ve(b.render,{...p,...b}),v},d=xg(t)?t():t;return d.then(f=>u("success",o,f)).catch(f=>u("error",i,f)),d},ve.success=Cc("success"),ve.info=Cc("info"),ve.error=Cc("error"),ve.warning=Cc("warning"),ve.warn=ve.warning,ve.dark=(t,e)=>Cl(t,tu("default",{theme:"dark",...e})),ve.dismiss=function(t){(function(e){var r;if(yg()){if(e==null||Sl(r=e)||Nh(r))Qa.forEach(n=>{n.removeToast(e)});else if(e&&("containerId"in e||"id"in e)){const n=Qa.get(e.containerId);n?n.removeToast(e.id):Qa.forEach(s=>{s.removeToast(e.id)})}}else Kd=Kd.filter(n=>e!=null&&n.options.toastId!==e)})(t)},ve.clearWaitingQueue=function(t){t===void 0&&(t={}),Qa.forEach(e=>{!e.props.limit||t.containerId&&e.id!==t.containerId||e.clearQueue()})},ve.isActive=yy,ve.update=function(t,e){e===void 0&&(e={});const r=((n,s)=>{var i;let{containerId:o}=s;return(i=Qa.get(o||1))==null?void 0:i.toasts.get(n)})(t,e);if(r){const{props:n,content:s}=r,i={delay:100,...n,...e,toastId:e.toastId||t,updateId:bg()};i.toastId!==t&&(i.staleId=t);const o=i.render||s;delete i.render,Cl(o,i)}},ve.done=t=>{ve.update(t,{progress:1})},ve.onChange=function(t){return ip.add(t),()=>{ip.delete(t)}},ve.play=t=>op(!0,t),ve.pause=t=>op(!1,t);const _u=function(t,e){return e===void 0&&(e=!1),{enter:`Toastify--animate Toastify__${t}-enter`,exit:`Toastify--animate Toastify__${t}-exit`,appendPosition:e}};wu(_u("bounce",!0));wu(_u("slide",!0));wu(_u("zoom"));wu(_u("flip"));const Bs=""+new URL("default-logo-BbiCiEKs.png",import.meta.url).href,Zn=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t),Xd=t=>{if(console.log("getLogoUrl called with:",t),!t)return console.log("No logo URL provided, using default"),Bs;if(t.startsWith("http://")||t.startsWith("https://"))return console.log("Logo URL is already a full URL:",t),t;if(t.includes("\\")||t.includes(":/")||t.includes(":\\")){const n=t.split(/[\\\/]/).pop()||t;if(console.log("Extracted filename from Windows path:",n),!n||n===t)return console.warn("Could not extract valid filename from Windows path, using default"),Bs;const{baseURL:s}=eo(),i=`${s.replace(/\/$/,"")}/uploads/${n}`;return console.log("Built final URL from Windows path:",i),i}if(t.startsWith("/")){const n=t.split("/").pop()||t;if(console.log("Extracted filename from Unix path:",n),!n||n===t)return console.warn("Could not extract valid filename from Unix path, using default"),Bs;const{baseURL:s}=eo(),i=`${s.replace(/\/$/,"")}/uploads/${n}`;return console.log("Built final URL from Unix path:",i),i}if(t.includes("\\")||t.includes(":/")||t.includes(":\\"))return console.warn("Invalid filename format, using default"),Bs;const{baseURL:e}=eo(),r=`${e.replace(/\/$/,"")}/uploads/${t}`;return console.log("Built final URL from filename:",r),r};eo().baseURL;const jy=()=>{Vr();const[t,e]=_.useState({id:"",business_name:"",street_address:"",city:"",province:"",country:"",postal_code:"",telephone_number:"",email:"",business_number:"",website:"",logo_url:"",created_at:"",updated_at:""}),[r,n]=_.useState(!1),[s,i]=_.useState(null),[o,l]=_.useState(null),[u,d]=_.useState(!1),f=k=>({id:k.id||"",business_name:k.business_name||"",street_address:k.street_address||"",city:k.city||"",province:k.province||"",country:k.country||"",postal_code:k.postal_code||"",telephone_number:k.telephone_number||"",email:k.email||"",business_number:k.business_number||"",website:k.website||"",logo_url:k.logo_url||"",created_at:k.created_at||"",updated_at:k.updated_at||""});_.useEffect(()=>{m()},[]);const m=async()=>{try{const k=await xe.get("/api/business-profile");console.log("Business Profile API Response:",k.data),console.log("Logo URL from API:",k.data.logo_url),e(f(k.data))}catch(k){if(k.response?.status===404){d(!0);return}console.error("Error fetching business profile:",k),ve.error("Failed to load business profile")}},v=k=>{const{name:I,value:H}=k.target;e(F=>({...F,[I]:H}))},p=k=>{if(k.target.files&&k.target.files[0]){const I=k.target.files[0];i(I);const H=URL.createObjectURL(I);l(H)}},b=async()=>{if(t.logo_url)try{n(!0),await xe.delete("/api/business-profile/logo"),e(k=>({...k,logo_url:""})),ve.success("Logo deleted successfully")}catch(k){console.error("Error deleting logo:",k),ve.error("Failed to delete logo")}finally{n(!1)}},w=async k=>{k.preventDefault(),n(!0);try{const I=new FormData;Object.entries(t).forEach(([H,F])=>{let U=H;switch(H){case"business_name":U="business_name";break;case"street_address":U="street_address";break;case"telephone_number":U="telephone_number";break;case"business_number":U="business_number";break;case"email":U="email";break;case"website":U="website";break;case"city":U="city";break;case"province":U="province";break;case"country":U="country";break;case"postal_code":U="postal_code";break;case"logo_url":return;case"id":case"created_at":case"updated_at":return}F!=null&&I.append(U,F)}),s&&I.append("logo",s),console.log("Form data being sent:");for(let[H,F]of I.entries())console.log(`${H}:`,F);await xe.post("/api/business-profile",I,{headers:{"Content-Type":"multipart/form-data"}}),ve.success("Business profile updated successfully"),d(!1),i(null),l(null),m()}catch(I){console.error("Error updating business profile:",I),console.error("Error response:",I.response),console.error("Error message:",I.message),I.response?.status===401?ve.error("Authentication failed. Please log in again."):I.response?.status===403?ve.error("Access denied. You do not have permission to update the business profile."):I.response?.status===404?ve.error("Business profile endpoint not found. Please check your API configuration."):I.response?.status===500?ve.error("Server error. Please try again later."):I.code==="NETWORK_ERROR"?ve.error("Network error. Please check your connection and try again."):I.message?.includes("timeout")?ve.error("Request timed out. Please try again."):ve.error(`Failed to update business profile: ${I.response?.data?.error||I.message||"Unknown error"}`)}finally{n(!1)}},y=()=>{d(!1),i(null),l(null),t.id?m():e({id:"",business_name:"",street_address:"",city:"",province:"",country:"",postal_code:"",telephone_number:"",email:"",business_number:"",logo_url:"",created_at:"",updated_at:""})};if(r)return a.jsx(ue,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:a.jsx(pr,{})});const j=()=>{const k=!!t.id;return a.jsx(ue,{display:"flex",justifyContent:"center",alignItems:"flex-start",minHeight:"70vh",children:a.jsx(At,{sx:{p:{xs:2,md:4},width:"100%",maxWidth:650,borderRadius:4,boxShadow:6,bgcolor:"background.paper"},elevation:6,children:a.jsxs(Kr,{spacing:4,children:[a.jsxs(ue,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[a.jsx(q,{variant:"h5",fontWeight:700,color:"primary.main",children:k?"Current Business Profile":"Business Profile"}),a.jsx(ue,{children:a.jsx(Ce,{variant:"contained",startIcon:a.jsx(Tl,{}),onClick:()=>d(!0),sx:{borderRadius:2,fontWeight:600},children:k?"Edit Profile":"Create Profile"})})]}),a.jsx(io,{sx:{bgcolor:"primary.light",height:3,borderRadius:2}}),k?a.jsxs(a.Fragment,{children:[t.logo_url&&a.jsxs(ue,{display:"flex",flexDirection:"column",alignItems:"center",mb:2,children:[a.jsx(q,{variant:"subtitle1",fontWeight:600,color:"primary.dark",gutterBottom:!0,children:"Business Logo"}),a.jsx(Ir,{sx:{maxWidth:180,borderRadius:3,boxShadow:3,border:"2px solid",borderColor:"primary.light",p:1,mb:1,bgcolor:"grey.50"},children:a.jsx(yf,{component:"img",image:t.logo_url?Xd(t.logo_url):Bs,onError:I=>I.currentTarget.src=Bs,alt:"Business Logo",sx:{height:120,objectFit:"contain",borderRadius:2,bgcolor:"white"}})})]}),a.jsxs(Z,{container:!0,spacing:3,children:[a.jsxs(Z,{item:!0,xs:12,sm:6,children:[a.jsx(q,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Business Name"}),a.jsx(q,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:t.business_name})]}),a.jsxs(Z,{item:!0,xs:12,sm:6,children:[a.jsx(q,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Business Number"}),a.jsx(q,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:t.business_number})]}),a.jsxs(Z,{item:!0,xs:12,sm:6,children:[a.jsx(q,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Address"}),a.jsxs(q,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:[t.street_address,a.jsx("br",{}),t.city,", ",t.province,t.postal_code?`, ${t.postal_code}`:"",a.jsx("br",{}),t.country]})]}),a.jsxs(Z,{item:!0,xs:12,sm:6,children:[a.jsx(q,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Email"}),a.jsx(q,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:t.email})]}),a.jsxs(Z,{item:!0,xs:12,sm:6,children:[a.jsx(q,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Telephone"}),a.jsx(q,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:t.telephone_number})]}),a.jsxs(Z,{item:!0,xs:12,sm:6,children:[a.jsx(q,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Website"}),a.jsx(q,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:t.website?a.jsx("a",{href:t.website.startsWith("http")?t.website:`https://${t.website}`,target:"_blank",rel:"noopener noreferrer",style:{color:"inherit",textDecoration:"underline"},children:t.website}):"Not provided"})]})]})]}):a.jsxs(ue,{textAlign:"center",py:4,children:[a.jsx(q,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Business Profile Found"}),a.jsx(q,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Create your business profile to get started. This information will be used in your quotes, invoices, and other business documents."}),a.jsx(Ce,{variant:"contained",size:"large",startIcon:a.jsx(Tl,{}),onClick:()=>d(!0),sx:{borderRadius:2,fontWeight:600},children:"Create Business Profile"})]})]})})})},O=()=>a.jsx(ue,{display:"flex",justifyContent:"center",alignItems:"flex-start",minHeight:"70vh",children:a.jsx(At,{sx:{p:{xs:2,md:4},width:"100%",maxWidth:650,borderRadius:4,boxShadow:6,bgcolor:"background.paper"},elevation:6,component:"form",onSubmit:w,children:a.jsxs(Kr,{spacing:4,children:[a.jsxs(ue,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[a.jsx(q,{variant:"h5",fontWeight:700,color:"primary.main",children:t.id?"Edit Business Profile":"Create Business Profile"}),a.jsxs(ue,{children:[a.jsx(Ce,{variant:"outlined",onClick:y,sx:{borderRadius:2,fontWeight:600,mr:2},children:"Cancel"}),a.jsx(Ce,{variant:"contained",type:"submit",disabled:r,sx:{borderRadius:2,fontWeight:600},children:r?a.jsx(pr,{size:24}):t.id?"Save Changes":"Create Profile"})]})]}),a.jsx(io,{sx:{bgcolor:"primary.light",height:3,borderRadius:2}}),a.jsxs(Z,{container:!0,spacing:3,children:[a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{label:"Business Name",name:"business_name",value:t.business_name,onChange:v,fullWidth:!0,required:!0})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{label:"Business Number/GST-HST Registration Number",name:"business_number",value:t.business_number,onChange:v,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{label:"Street Address",name:"street_address",value:t.street_address,onChange:v,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"City",name:"city",value:t.city,onChange:v,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"Province",name:"province",value:t.province,onChange:v,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"Country",name:"country",value:t.country,onChange:v,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"Postal Code",name:"postal_code",value:t.postal_code,onChange:v,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"Telephone Number",name:"telephone_number",value:t.telephone_number,onChange:v,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"Email",name:"email",value:t.email,onChange:v,fullWidth:!0,type:"email"})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"Website",name:"website",value:t.website,onChange:v,fullWidth:!0})}),a.jsxs(Z,{item:!0,xs:12,children:[a.jsx(q,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Business Logo"}),t.logo_url&&a.jsxs(ue,{display:"flex",flexDirection:"column",alignItems:"center",mb:2,children:[a.jsx(Ir,{sx:{maxWidth:180,borderRadius:3,boxShadow:3,border:"2px solid",borderColor:"primary.light",p:1,mb:1,bgcolor:"grey.50"},children:a.jsx(yf,{component:"img",image:t.logo_url?Xd(t.logo_url):Bs,onError:k=>k.currentTarget.src=Bs,alt:"Business Logo",sx:{height:120,objectFit:"contain",borderRadius:2,bgcolor:"white"}})}),a.jsx(Ce,{variant:"outlined",color:"error",startIcon:a.jsx(la,{}),onClick:b,sx:{borderRadius:2,fontWeight:600},children:"Delete Current Logo"})]}),a.jsxs(Ce,{variant:"contained",component:"label",startIcon:a.jsx(yo,{}),sx:{borderRadius:2,fontWeight:600},children:[t.logo_url?"Change Logo":"Upload Logo",a.jsx("input",{type:"file",hidden:!0,onChange:p,accept:"image/*"})]}),o&&a.jsxs(ue,{mt:2,display:"flex",flexDirection:"column",alignItems:"center",children:[a.jsx(q,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"New Logo Preview:"}),a.jsx("img",{src:o,alt:"Logo Preview",style:{maxWidth:"100px",maxHeight:"100px"}})]})]})]})]})})});return a.jsx(er,{sx:{mt:4,mb:4},children:u?O():j()})};var Zo={},lp;function Sy(){if(lp)return Zo;lp=1;var t=jn();Object.defineProperty(Zo,"__esModule",{value:!0}),Zo.default=void 0;var e=t(Cn()),r=Sn();return Zo.default=(0,e.default)((0,r.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),Zo}var Cy=Sy();const rs=Dr(Cy);var el={},cp;function Py(){if(cp)return el;cp=1;var t=jn();Object.defineProperty(el,"__esModule",{value:!0}),el.default=void 0;var e=t(Cn()),r=Sn();return el.default=(0,e.default)((0,r.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),el}var ky=Py();const ka=Dr(ky);var tl={},up;function Ay(){if(up)return tl;up=1;var t=jn();Object.defineProperty(tl,"__esModule",{value:!0}),tl.default=void 0;var e=t(Cn()),r=Sn();return tl.default=(0,e.default)((0,r.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download"),tl}var Ly=Ay();const $r=Dr(Ly),Ny=async()=>(await xe.get("/api/customers")).data,Ey=async t=>(await xe.get(`/api/customers/${t}`)).data,wg=async t=>(await xe.post("/api/customers",t)).data,_g=async(t,e)=>(await xe.put(`/api/customers/${t}`,e)).data,Oy=async t=>{await xe.delete(`/api/customers/${t}`)};var Uc={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var Iy=Uc.exports,dp;function Dy(){return dp||(dp=1,function(t,e){((r,n)=>{t.exports=n()})(Iy,function r(){var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},s,i=!n.document&&!!n.postMessage,o=n.IS_PAPA_WORKER||!1,l={},u=0,d={};function f(C){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(N){var Q=H(N);Q.chunkSize=parseInt(Q.chunkSize),N.step||N.chunk||(Q.chunkSize=null),this._handle=new w(Q),(this._handle.streamer=this)._config=Q}).call(this,C),this.parseChunk=function(N,Q){var P=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<P){let te=this._config.newline;te||(L=this._config.quoteChar||'"',te=this._handle.guessLineEndings(N,L)),N=[...N.split(te).slice(P)].join(te)}this.isFirstChunk&&U(this._config.beforeFirstChunk)&&(L=this._config.beforeFirstChunk(N))!==void 0&&(N=L),this.isFirstChunk=!1,this._halted=!1;var P=this._partialLine+N,L=(this._partialLine="",this._handle.parse(P,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(N=L.meta.cursor,P=(this._finished||(this._partialLine=P.substring(N-this._baseIndex),this._baseIndex=N),L&&L.data&&(this._rowCount+=L.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),o)n.postMessage({results:L,workerId:d.WORKER_ID,finished:P});else if(U(this._config.chunk)&&!Q){if(this._config.chunk(L,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=L=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(L.data),this._completeResults.errors=this._completeResults.errors.concat(L.errors),this._completeResults.meta=L.meta),this._completed||!P||!U(this._config.complete)||L&&L.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),P||L&&L.meta.paused||this._nextChunk(),L}this._halted=!0},this._sendError=function(N){U(this._config.error)?this._config.error(N):o&&this._config.error&&n.postMessage({workerId:d.WORKER_ID,error:N,finished:!1})}}function m(C){var N;(C=C||{}).chunkSize||(C.chunkSize=d.RemoteChunkSize),f.call(this,C),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(Q){this._input=Q,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(N=new XMLHttpRequest,this._config.withCredentials&&(N.withCredentials=this._config.withCredentials),i||(N.onload=F(this._chunkLoaded,this),N.onerror=F(this._chunkError,this)),N.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var Q,P=this._config.downloadRequestHeaders;for(Q in P)N.setRequestHeader(Q,P[Q])}var L;this._config.chunkSize&&(L=this._start+this._config.chunkSize-1,N.setRequestHeader("Range","bytes="+this._start+"-"+L));try{N.send(this._config.downloadRequestBody)}catch(te){this._chunkError(te.message)}i&&N.status===0&&this._chunkError()}},this._chunkLoaded=function(){N.readyState===4&&(N.status<200||400<=N.status?this._chunkError():(this._start+=this._config.chunkSize||N.responseText.length,this._finished=!this._config.chunkSize||this._start>=(Q=>(Q=Q.getResponseHeader("Content-Range"))!==null?parseInt(Q.substring(Q.lastIndexOf("/")+1)):-1)(N),this.parseChunk(N.responseText)))},this._chunkError=function(Q){Q=N.statusText||Q,this._sendError(new Error(Q))}}function v(C){(C=C||{}).chunkSize||(C.chunkSize=d.LocalChunkSize),f.call(this,C);var N,Q,P=typeof FileReader<"u";this.stream=function(L){this._input=L,Q=L.slice||L.webkitSlice||L.mozSlice,P?((N=new FileReader).onload=F(this._chunkLoaded,this),N.onerror=F(this._chunkError,this)):N=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var L=this._input,te=(this._config.chunkSize&&(te=Math.min(this._start+this._config.chunkSize,this._input.size),L=Q.call(L,this._start,te)),N.readAsText(L,this._config.encoding));P||this._chunkLoaded({target:{result:te}})},this._chunkLoaded=function(L){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(L.target.result)},this._chunkError=function(){this._sendError(N.error)}}function p(C){var N;f.call(this,C=C||{}),this.stream=function(Q){return N=Q,this._nextChunk()},this._nextChunk=function(){var Q,P;if(!this._finished)return Q=this._config.chunkSize,N=Q?(P=N.substring(0,Q),N.substring(Q)):(P=N,""),this._finished=!N,this.parseChunk(P)}}function b(C){f.call(this,C=C||{});var N=[],Q=!0,P=!1;this.pause=function(){f.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){f.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(L){this._input=L,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){P&&N.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),N.length?this.parseChunk(N.shift()):Q=!0},this._streamData=F(function(L){try{N.push(typeof L=="string"?L:L.toString(this._config.encoding)),Q&&(Q=!1,this._checkIsFinished(),this.parseChunk(N.shift()))}catch(te){this._streamError(te)}},this),this._streamError=F(function(L){this._streamCleanUp(),this._sendError(L)},this),this._streamEnd=F(function(){this._streamCleanUp(),P=!0,this._streamData("")},this),this._streamCleanUp=F(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function w(C){var N,Q,P,L,te=Math.pow(2,53),W=-te,z=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,V=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,Y=this,E=0,X=0,oe=!1,de=!1,A=[],D={data:[],errors:[],meta:{}};function J(ee){return C.skipEmptyLines==="greedy"?ee.join("").trim()==="":ee.length===1&&ee[0].length===0}function re(){if(D&&P&&(fe("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+d.DefaultDelimiter+"'"),P=!1),C.skipEmptyLines&&(D.data=D.data.filter(function(ye){return!J(ye)})),ce()){let ye=function(Le,se){U(C.transformHeader)&&(Le=C.transformHeader(Le,se)),A.push(Le)};if(D)if(Array.isArray(D.data[0])){for(var ee=0;ce()&&ee<D.data.length;ee++)D.data[ee].forEach(ye);D.data.splice(0,1)}else D.data.forEach(ye)}function ae(ye,Le){for(var se=C.header?{}:[],Fe=0;Fe<ye.length;Fe++){var ne=Fe,R=ye[Fe],R=((be,je)=>(Pe=>(C.dynamicTypingFunction&&C.dynamicTyping[Pe]===void 0&&(C.dynamicTyping[Pe]=C.dynamicTypingFunction(Pe)),(C.dynamicTyping[Pe]||C.dynamicTyping)===!0))(be)?je==="true"||je==="TRUE"||je!=="false"&&je!=="FALSE"&&((Pe=>{if(z.test(Pe)&&(Pe=parseFloat(Pe),W<Pe&&Pe<te))return 1})(je)?parseFloat(je):V.test(je)?new Date(je):je===""?null:je):je)(ne=C.header?Fe>=A.length?"__parsed_extra":A[Fe]:ne,R=C.transform?C.transform(R,ne):R);ne==="__parsed_extra"?(se[ne]=se[ne]||[],se[ne].push(R)):se[ne]=R}return C.header&&(Fe>A.length?fe("FieldMismatch","TooManyFields","Too many fields: expected "+A.length+" fields but parsed "+Fe,X+Le):Fe<A.length&&fe("FieldMismatch","TooFewFields","Too few fields: expected "+A.length+" fields but parsed "+Fe,X+Le)),se}var pe;D&&(C.header||C.dynamicTyping||C.transform)&&(pe=1,!D.data.length||Array.isArray(D.data[0])?(D.data=D.data.map(ae),pe=D.data.length):D.data=ae(D.data,0),C.header&&D.meta&&(D.meta.fields=A),X+=pe)}function ce(){return C.header&&A.length===0}function fe(ee,ae,pe,ye){ee={type:ee,code:ae,message:pe},ye!==void 0&&(ee.row=ye),D.errors.push(ee)}U(C.step)&&(L=C.step,C.step=function(ee){D=ee,ce()?re():(re(),D.data.length!==0&&(E+=ee.data.length,C.preview&&E>C.preview?Q.abort():(D.data=D.data[0],L(D,Y))))}),this.parse=function(ee,ae,pe){var ye=C.quoteChar||'"',ye=(C.newline||(C.newline=this.guessLineEndings(ee,ye)),P=!1,C.delimiter?U(C.delimiter)&&(C.delimiter=C.delimiter(ee),D.meta.delimiter=C.delimiter):((ye=((Le,se,Fe,ne,R)=>{var be,je,Pe,He;R=R||[",","	","|",";",d.RECORD_SEP,d.UNIT_SEP];for(var Ye=0;Ye<R.length;Ye++){for(var nt,dt=R[Ye],Ae=0,Re=0,st=0,it=(Pe=void 0,new j({comments:ne,delimiter:dt,newline:se,preview:10}).parse(Le)),Lt=0;Lt<it.data.length;Lt++)Fe&&J(it.data[Lt])?st++:(nt=it.data[Lt].length,Re+=nt,Pe===void 0?Pe=nt:0<nt&&(Ae+=Math.abs(nt-Pe),Pe=nt));0<it.data.length&&(Re/=it.data.length-st),(je===void 0||Ae<=je)&&(He===void 0||He<Re)&&1.99<Re&&(je=Ae,be=dt,He=Re)}return{successful:!!(C.delimiter=be),bestDelimiter:be}})(ee,C.newline,C.skipEmptyLines,C.comments,C.delimitersToGuess)).successful?C.delimiter=ye.bestDelimiter:(P=!0,C.delimiter=d.DefaultDelimiter),D.meta.delimiter=C.delimiter),H(C));return C.preview&&C.header&&ye.preview++,N=ee,Q=new j(ye),D=Q.parse(N,ae,pe),re(),oe?{meta:{paused:!0}}:D||{meta:{paused:!1}}},this.paused=function(){return oe},this.pause=function(){oe=!0,Q.abort(),N=U(C.chunk)?"":N.substring(Q.getCharIndex())},this.resume=function(){Y.streamer._halted?(oe=!1,Y.streamer.parseChunk(N,!0)):setTimeout(Y.resume,3)},this.aborted=function(){return de},this.abort=function(){de=!0,Q.abort(),D.meta.aborted=!0,U(C.complete)&&C.complete(D),N=""},this.guessLineEndings=function(Le,ye){Le=Le.substring(0,1048576);var ye=new RegExp(y(ye)+"([^]*?)"+y(ye),"gm"),pe=(Le=Le.replace(ye,"")).split("\r"),ye=Le.split(`
`),Le=1<ye.length&&ye[0].length<pe[0].length;if(pe.length===1||Le)return`
`;for(var se=0,Fe=0;Fe<pe.length;Fe++)pe[Fe][0]===`
`&&se++;return se>=pe.length/2?`\r
`:"\r"}}function y(C){return C.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function j(C){var N=(C=C||{}).delimiter,Q=C.newline,P=C.comments,L=C.step,te=C.preview,W=C.fastMode,z=null,V=!1,Y=C.quoteChar==null?'"':C.quoteChar,E=Y;if(C.escapeChar!==void 0&&(E=C.escapeChar),(typeof N!="string"||-1<d.BAD_DELIMITERS.indexOf(N))&&(N=","),P===N)throw new Error("Comment character same as delimiter");P===!0?P="#":(typeof P!="string"||-1<d.BAD_DELIMITERS.indexOf(P))&&(P=!1),Q!==`
`&&Q!=="\r"&&Q!==`\r
`&&(Q=`
`);var X=0,oe=!1;this.parse=function(de,A,D){if(typeof de!="string")throw new Error("Input must be a string");var J=de.length,re=N.length,ce=Q.length,fe=P.length,ee=U(L),ae=[],pe=[],ye=[],Le=X=0;if(!de)return Ae();if(W||W!==!1&&de.indexOf(Y)===-1){for(var se=de.split(Q),Fe=0;Fe<se.length;Fe++){if(ye=se[Fe],X+=ye.length,Fe!==se.length-1)X+=Q.length;else if(D)return Ae();if(!P||ye.substring(0,fe)!==P){if(ee){if(ae=[],He(ye.split(N)),Re(),oe)return Ae()}else He(ye.split(N));if(te&&te<=Fe)return ae=ae.slice(0,te),Ae(!0)}}return Ae()}for(var ne=de.indexOf(N,X),R=de.indexOf(Q,X),be=new RegExp(y(E)+y(Y),"g"),je=de.indexOf(Y,X);;)if(de[X]===Y)for(je=X,X++;;){if((je=de.indexOf(Y,je+1))===-1)return D||pe.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:ae.length,index:X}),nt();if(je===J-1)return nt(de.substring(X,je).replace(be,Y));if(Y===E&&de[je+1]===E)je++;else if(Y===E||je===0||de[je-1]!==E){ne!==-1&&ne<je+1&&(ne=de.indexOf(N,je+1));var Pe=Ye((R=R!==-1&&R<je+1?de.indexOf(Q,je+1):R)===-1?ne:Math.min(ne,R));if(de.substr(je+1+Pe,re)===N){ye.push(de.substring(X,je).replace(be,Y)),de[X=je+1+Pe+re]!==Y&&(je=de.indexOf(Y,X)),ne=de.indexOf(N,X),R=de.indexOf(Q,X);break}if(Pe=Ye(R),de.substring(je+1+Pe,je+1+Pe+ce)===Q){if(ye.push(de.substring(X,je).replace(be,Y)),dt(je+1+Pe+ce),ne=de.indexOf(N,X),je=de.indexOf(Y,X),ee&&(Re(),oe))return Ae();if(te&&ae.length>=te)return Ae(!0);break}pe.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:ae.length,index:X}),je++}}else if(P&&ye.length===0&&de.substring(X,X+fe)===P){if(R===-1)return Ae();X=R+ce,R=de.indexOf(Q,X),ne=de.indexOf(N,X)}else if(ne!==-1&&(ne<R||R===-1))ye.push(de.substring(X,ne)),X=ne+re,ne=de.indexOf(N,X);else{if(R===-1)break;if(ye.push(de.substring(X,R)),dt(R+ce),ee&&(Re(),oe))return Ae();if(te&&ae.length>=te)return Ae(!0)}return nt();function He(st){ae.push(st),Le=X}function Ye(st){var it=0;return it=st!==-1&&(st=de.substring(je+1,st))&&st.trim()===""?st.length:it}function nt(st){return D||(st===void 0&&(st=de.substring(X)),ye.push(st),X=J,He(ye),ee&&Re()),Ae()}function dt(st){X=st,He(ye),ye=[],R=de.indexOf(Q,X)}function Ae(st){if(C.header&&!A&&ae.length&&!V){var it=ae[0],Lt=Object.create(null),gt=new Set(it);let St=!1;for(let ct=0;ct<it.length;ct++){let Rt=it[ct];if(Lt[Rt=U(C.transformHeader)?C.transformHeader(Rt,ct):Rt]){let xt,Rr=Lt[Rt];for(;xt=Rt+"_"+Rr,Rr++,gt.has(xt););gt.add(xt),it[ct]=xt,Lt[Rt]++,St=!0,(z=z===null?{}:z)[xt]=Rt}else Lt[Rt]=1,it[ct]=Rt;gt.add(Rt)}St&&console.warn("Duplicate headers found and renamed."),V=!0}return{data:ae,errors:pe,meta:{delimiter:N,linebreak:Q,aborted:oe,truncated:!!st,cursor:Le+(A||0),renamedHeaders:z}}}function Re(){L(Ae()),ae=[],pe=[]}},this.abort=function(){oe=!0},this.getCharIndex=function(){return X}}function O(C){var N=C.data,Q=l[N.workerId],P=!1;if(N.error)Q.userError(N.error,N.file);else if(N.results&&N.results.data){var L={abort:function(){P=!0,k(N.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:I,resume:I};if(U(Q.userStep)){for(var te=0;te<N.results.data.length&&(Q.userStep({data:N.results.data[te],errors:N.results.errors,meta:N.results.meta},L),!P);te++);delete N.results}else U(Q.userChunk)&&(Q.userChunk(N.results,L,N.file),delete N.results)}N.finished&&!P&&k(N.workerId,N.results)}function k(C,N){var Q=l[C];U(Q.userComplete)&&Q.userComplete(N),Q.terminate(),delete l[C]}function I(){throw new Error("Not implemented.")}function H(C){if(typeof C!="object"||C===null)return C;var N,Q=Array.isArray(C)?[]:{};for(N in C)Q[N]=H(C[N]);return Q}function F(C,N){return function(){C.apply(N,arguments)}}function U(C){return typeof C=="function"}return d.parse=function(C,N){var Q=(N=N||{}).dynamicTyping||!1;if(U(Q)&&(N.dynamicTypingFunction=Q,Q={}),N.dynamicTyping=Q,N.transform=!!U(N.transform)&&N.transform,!N.worker||!d.WORKERS_SUPPORTED)return Q=null,d.NODE_STREAM_INPUT,typeof C=="string"?(C=(P=>P.charCodeAt(0)!==65279?P:P.slice(1))(C),Q=new(N.download?m:p)(N)):C.readable===!0&&U(C.read)&&U(C.on)?Q=new b(N):(n.File&&C instanceof File||C instanceof Object)&&(Q=new v(N)),Q.stream(C);(Q=(()=>{var P;return!!d.WORKERS_SUPPORTED&&(P=(()=>{var L=n.URL||n.webkitURL||null,te=r.toString();return d.BLOB_URL||(d.BLOB_URL=L.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",te,")();"],{type:"text/javascript"})))})(),(P=new n.Worker(P)).onmessage=O,P.id=u++,l[P.id]=P)})()).userStep=N.step,Q.userChunk=N.chunk,Q.userComplete=N.complete,Q.userError=N.error,N.step=U(N.step),N.chunk=U(N.chunk),N.complete=U(N.complete),N.error=U(N.error),delete N.worker,Q.postMessage({input:C,config:N,workerId:Q.id})},d.unparse=function(C,N){var Q=!1,P=!0,L=",",te=`\r
`,W='"',z=W+W,V=!1,Y=null,E=!1,X=((()=>{if(typeof N=="object"){if(typeof N.delimiter!="string"||d.BAD_DELIMITERS.filter(function(A){return N.delimiter.indexOf(A)!==-1}).length||(L=N.delimiter),typeof N.quotes!="boolean"&&typeof N.quotes!="function"&&!Array.isArray(N.quotes)||(Q=N.quotes),typeof N.skipEmptyLines!="boolean"&&typeof N.skipEmptyLines!="string"||(V=N.skipEmptyLines),typeof N.newline=="string"&&(te=N.newline),typeof N.quoteChar=="string"&&(W=N.quoteChar),typeof N.header=="boolean"&&(P=N.header),Array.isArray(N.columns)){if(N.columns.length===0)throw new Error("Option columns is empty");Y=N.columns}N.escapeChar!==void 0&&(z=N.escapeChar+W),N.escapeFormulae instanceof RegExp?E=N.escapeFormulae:typeof N.escapeFormulae=="boolean"&&N.escapeFormulae&&(E=/^[=+\-@\t\r].*$/)}})(),new RegExp(y(W),"g"));if(typeof C=="string"&&(C=JSON.parse(C)),Array.isArray(C)){if(!C.length||Array.isArray(C[0]))return oe(null,C,V);if(typeof C[0]=="object")return oe(Y||Object.keys(C[0]),C,V)}else if(typeof C=="object")return typeof C.data=="string"&&(C.data=JSON.parse(C.data)),Array.isArray(C.data)&&(C.fields||(C.fields=C.meta&&C.meta.fields||Y),C.fields||(C.fields=Array.isArray(C.data[0])?C.fields:typeof C.data[0]=="object"?Object.keys(C.data[0]):[]),Array.isArray(C.data[0])||typeof C.data[0]=="object"||(C.data=[C.data])),oe(C.fields||[],C.data||[],V);throw new Error("Unable to serialize unrecognized input");function oe(A,D,J){var re="",ce=(typeof A=="string"&&(A=JSON.parse(A)),typeof D=="string"&&(D=JSON.parse(D)),Array.isArray(A)&&0<A.length),fe=!Array.isArray(D[0]);if(ce&&P){for(var ee=0;ee<A.length;ee++)0<ee&&(re+=L),re+=de(A[ee],ee);0<D.length&&(re+=te)}for(var ae=0;ae<D.length;ae++){var pe=(ce?A:D[ae]).length,ye=!1,Le=ce?Object.keys(D[ae]).length===0:D[ae].length===0;if(J&&!ce&&(ye=J==="greedy"?D[ae].join("").trim()==="":D[ae].length===1&&D[ae][0].length===0),J==="greedy"&&ce){for(var se=[],Fe=0;Fe<pe;Fe++){var ne=fe?A[Fe]:Fe;se.push(D[ae][ne])}ye=se.join("").trim()===""}if(!ye){for(var R=0;R<pe;R++){0<R&&!Le&&(re+=L);var be=ce&&fe?A[R]:R;re+=de(D[ae][be],R)}ae<D.length-1&&(!J||0<pe&&!Le)&&(re+=te)}}return re}function de(A,D){var J,re;return A==null?"":A.constructor===Date?JSON.stringify(A).slice(1,25):(re=!1,E&&typeof A=="string"&&E.test(A)&&(A="'"+A,re=!0),J=A.toString().replace(X,z),(re=re||Q===!0||typeof Q=="function"&&Q(A,D)||Array.isArray(Q)&&Q[D]||((ce,fe)=>{for(var ee=0;ee<fe.length;ee++)if(-1<ce.indexOf(fe[ee]))return!0;return!1})(J,d.BAD_DELIMITERS)||-1<J.indexOf(L)||J.charAt(0)===" "||J.charAt(J.length-1)===" ")?W+J+W:J)}},d.RECORD_SEP="",d.UNIT_SEP="",d.BYTE_ORDER_MARK="\uFEFF",d.BAD_DELIMITERS=["\r",`
`,'"',d.BYTE_ORDER_MARK],d.WORKERS_SUPPORTED=!i&&!!n.Worker,d.NODE_STREAM_INPUT=1,d.LocalChunkSize=10485760,d.RemoteChunkSize=5242880,d.DefaultDelimiter=",",d.Parser=j,d.ParserHandle=w,d.NetworkStreamer=m,d.FileStreamer=v,d.StringStreamer=p,d.ReadableStreamStreamer=b,n.jQuery&&((s=n.jQuery).fn.parse=function(C){var N=C.config||{},Q=[];return this.each(function(te){if(!(s(this).prop("tagName").toUpperCase()==="INPUT"&&s(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var W=0;W<this.files.length;W++)Q.push({file:this.files[W],inputElem:this,instanceConfig:s.extend({},N)})}),P(),this;function P(){if(Q.length===0)U(C.complete)&&C.complete();else{var te,W,z,V,Y=Q[0];if(U(C.before)){var E=C.before(Y.file,Y.inputElem);if(typeof E=="object"){if(E.action==="abort")return te="AbortError",W=Y.file,z=Y.inputElem,V=E.reason,void(U(C.error)&&C.error({name:te},W,z,V));if(E.action==="skip")return void L();typeof E.config=="object"&&(Y.instanceConfig=s.extend(Y.instanceConfig,E.config))}else if(E==="skip")return void L()}var X=Y.instanceConfig.complete;Y.instanceConfig.complete=function(oe){U(X)&&X(oe,Y.file,Y.inputElem),L()},d.parse(Y.file,Y.instanceConfig)}}function L(){Q.splice(0,1),P()}}),o&&(n.onmessage=function(C){C=C.data,d.WORKER_ID===void 0&&C&&(d.WORKER_ID=C.workerId),typeof C.input=="string"?n.postMessage({workerId:d.WORKER_ID,results:d.parse(C.input,C.config),finished:!0}):(n.File&&C.input instanceof File||C.input instanceof Object)&&(C=d.parse(C.input,C.config))&&n.postMessage({workerId:d.WORKER_ID,results:C,finished:!0})}),(m.prototype=Object.create(f.prototype)).constructor=m,(v.prototype=Object.create(f.prototype)).constructor=v,(p.prototype=Object.create(p.prototype)).constructor=p,(b.prototype=Object.create(f.prototype)).constructor=b,d})}(Uc)),Uc.exports}var Ty=Dy();const wi=Dr(Ty),jg=async()=>{try{const t=await xe.get("/api/business-profile");return{city:t.data.city||"",province:t.data.province||"",country:t.data.country||""}}catch(t){return console.error("Error fetching business profile:",t),{city:"",province:"",country:""}}};function Ys(t,e){const[r,n]=_.useState(t);return _.useEffect(()=>{const s=setTimeout(()=>{n(t)},e);return()=>{clearTimeout(s)}},[t,e]),r}const hp={customer_id:"",customer_name:"",contact_person:"",email:"",phone_number:"",street_address:"",city:"",province:"",country:"",postal_code:"",website:""},Ul=({open:t,onClose:e,onSave:r,initialCustomer:n,isEditMode:s=!1,loading:i=!1})=>{const[o,l]=_.useState(hp),[u,d]=_.useState(null),[f,m]=_.useState({}),v=Ys(o,300),[p,b]=_.useState([]),w=async()=>{try{const k=await jg();l(I=>({...I,city:k.city,province:k.province,country:k.country}))}catch(k){console.error("Error autofilling from business profile:",k)}};_.useEffect(()=>{if(t){const k={...hp,...n};l(k),d(null),(async()=>{try{const I=await xe.get("/api/customers");b(I.data||[])}catch{}})(),!s&&(!n?.city||n.city==="")&&(!n?.province||n.province==="")&&(!n?.country||n.country==="")&&w()}},[t,n,s]);const y=k=>{const{name:I,value:H}=k.target;l(F=>({...F,[I]:H})),f[I]&&m(F=>({...F,[I]:void 0}))},j=()=>o.customer_name.trim()?(d(null),!0):(d("Customer name is required"),!1),O=()=>{j()&&r(o)};return _.useEffect(()=>{if(!t)return;const k={};if(v.email&&v.email.trim().length>0&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v.email.trim())||(k.email="Invalid email format")),v.customer_name&&v.customer_name.trim().length>0){const I=v.customer_name.trim().toLowerCase(),H=(n?.customer_id??v.customer_id)||"";p.some(U=>(U.customer_name||"").trim().toLowerCase()===I&&String(U.customer_id)!==String(H||""))&&(k.customer_name="Customer name already exists")}m(I=>({...I,...k}))},[v,t]),a.jsxs(Sr,{open:t,onClose:e,maxWidth:"md",fullWidth:!0,children:[a.jsx(Cr,{children:s?"Edit Customer":"Add New Customer"}),a.jsxs(Pr,{children:[a.jsxs(Z,{container:!0,spacing:2,sx:{mt:1},children:[a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{name:"customer_name",label:"Customer Name",value:o.customer_name,onChange:y,fullWidth:!0,required:!0,error:!!f.customer_name,helperText:f.customer_name})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{name:"contact_person",label:"Contact Person",value:o.contact_person,onChange:y,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{name:"email",label:"Email",type:"email",value:o.email,onChange:y,fullWidth:!0,error:!!f.email,helperText:f.email})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{name:"phone_number",label:"Phone Number",value:o.phone_number,onChange:y,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{name:"street_address",label:"Street Address",value:o.street_address,onChange:y,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{name:"city",label:"City",value:o.city,onChange:y,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{name:"province",label:"Province/State",value:o.province,onChange:y,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{name:"country",label:"Country",value:o.country,onChange:y,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{name:"postal_code",label:"Postal Code",value:o.postal_code,onChange:y,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{name:"website",label:"Website",value:o.website,onChange:y,fullWidth:!0})})]}),u&&a.jsx("div",{style:{color:"red",marginTop:8},children:u})]}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:e,children:"Cancel"}),a.jsx(Ce,{onClick:O,variant:"contained",disabled:i,children:s?"Save Changes":"Add Customer"})]})]})},My=()=>{Vr();const[t,e]=_.useState([]),[r,n]=_.useState(""),[s,i]=_.useState(null),[o,l]=_.useState(null),[u,d]=_.useState(!1),[f,m]=_.useState({pageSize:10,page:0}),[v,p]=_.useState(!1);_.useEffect(()=>{b()},[]);const b=async()=>{try{const F=await Ny();e(F)}catch(F){console.error("Error fetching customers:",F),ve.error("Failed to fetch customers")}},w=async F=>{if(window.confirm("Are you sure you want to delete this customer?"))try{await Oy(F),e(U=>U.filter(C=>C.id!==F)),ve.success("Customer deleted successfully")}catch(U){console.error("Error deleting customer:",U),ve.error("Failed to delete customer")}},y=F=>{i(F),l({...F}),p(!0),d(!0)},j=()=>{d(!1),i(null),l(null)},O=t.filter(F=>F.customer_name.toLowerCase().includes(r.toLowerCase())||F.email?.toLowerCase().includes(r.toLowerCase())||F.phone_number?.toLowerCase().includes(r.toLowerCase())||`${F.street_address}, ${F.city}, ${F.province}, ${F.country}`.toLowerCase().includes(r.toLowerCase())),k=[{field:"customer_name",headerName:"Customer Name",flex:1.5},{field:"contact_person",headerName:"Contact Person",flex:1},{field:"email",headerName:"Email",flex:1.5},{field:"phone_number",headerName:"Phone Number",flex:1},{field:"actions",headerName:"Actions",width:80,sortable:!1,renderCell:F=>a.jsx(jr,{size:"small",color:"error",onClick:U=>{U.stopPropagation(),w(F.row.id)},children:a.jsx(la,{})})}],I=()=>{const F=O.map(Q=>({customer_name:Q.customer_name,contact_person:Q.contact_person,email:Q.email,phone_number:Q.phone_number})),U=wi.unparse(F),C=new Blob([U],{type:"text/csv;charset=utf-8;"}),N=document.createElement("a");if(N.download!==void 0){const Q=URL.createObjectURL(C);N.setAttribute("href",Q),N.setAttribute("download","customer_list.csv"),N.style.visibility="hidden",document.body.appendChild(N),N.click(),document.body.removeChild(N)}},H=()=>{window.open("/api/customers/export/pdf","_blank")};return a.jsx(er,{maxWidth:"xl",children:a.jsxs(ue,{sx:{my:4},children:[a.jsx(q,{variant:"h4",component:"h1",gutterBottom:!0,children:"Customer List"}),a.jsxs(Kr,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[a.jsx(Ce,{variant:"contained",startIcon:a.jsx(ka,{}),onClick:()=>{l({id:"",customer_id:"",customer_name:"",email:"",phone:"",phone_number:"",address:"",street_address:"",city:"",state:"",province:"",country:"",postal_code:"",contact_person:"",website:"",created_at:"",updated_at:""}),p(!1),d(!0)},children:"New Customer"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:I,children:"Export CSV"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:H,children:"Download PDF"})]}),a.jsx(At,{sx:{width:"100%",overflow:"hidden",mb:3},children:a.jsxs(ue,{sx:{p:2},children:[a.jsx(Oe,{fullWidth:!0,variant:"outlined",placeholder:"Search customers...",value:r,onChange:F=>n(F.target.value),InputProps:{startAdornment:a.jsx(Bn,{position:"start",children:a.jsx(rs,{})})},sx:{mb:2}}),a.jsx(es,{rows:O,columns:k,pageSizeOptions:[10,25,50],paginationModel:f,onPaginationModelChange:m,getRowId:F=>F.id,loading:!1,disableRowSelectionOnClick:!0,onRowClick:F=>y(F.row),sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),a.jsx(Ul,{open:u,onClose:j,onSave:async F=>{try{if(v&&o)await _g(o.id,F),e(U=>U.map(C=>C.id===o.id?{...C,...F}:C)),ve.success("Customer updated successfully");else{const U=await wg(F);e(C=>[...C,U]),ve.success("Customer created successfully")}j()}catch(U){console.error("Error saving customer:",U),ve.error(v?"Failed to update customer":"Failed to create customer")}},initialCustomer:o||{},isEditMode:v})]})})},Fy=()=>{const{id:t}=bi(),e=Vr(),r=t==="new";console.log("Debug - URL id parameter:",t),console.log("Debug - isNewCustomer calculated:",r);const[n,s]=_.useState(!1),[i,o]=_.useState(!1),[l,u]=_.useState(null),[d,f]=_.useState(!1),[m,v]=_.useState({customer_name:"",email:"",phone_number:"",street_address:"",city:"",province:"",country:"",postal_code:"",contact_person:"",website:""});_.useEffect(()=>{!r&&t?p():r&&f(!0)},[t,r]);const p=async()=>{s(!0);try{if(!t)throw new Error("Customer ID is required");const w=await Ey(t);v(w)}catch(w){console.error("Error fetching customer:",w),u("Failed to load customer data"),ve.error("Failed to load customer data")}finally{s(!1)}},b=()=>{e("/customers")};return n?a.jsx(er,{maxWidth:"md",children:a.jsx(ue,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:a.jsx(pr,{})})}):a.jsx(er,{maxWidth:"md",children:a.jsxs(ue,{sx:{my:4},children:[a.jsxs(ue,{sx:{display:"flex",alignItems:"center",mb:3},children:[a.jsx(Ce,{startIcon:a.jsx(_m,{}),onClick:b,sx:{mr:2},children:"Back to Customers"}),a.jsx(q,{variant:"h4",component:"h1",children:r?"Add New Customer":"Edit Customer"})]}),l&&a.jsx(Ct,{severity:"error",sx:{mb:2},children:l}),a.jsx(Ul,{open:d,onClose:()=>{f(!1),b()},onSave:async w=>{o(!0);try{r?(await wg(w),ve.success("Customer created successfully")):(await _g(t,w),ve.success("Customer updated successfully")),e("/customers")}catch{ve.error("Failed to save customer")}finally{o(!1)}},initialCustomer:r?{}:m,isEditMode:!r,loading:i})]})})},Ry=async()=>(await xe.get("/api/vendors")).data,fp={vendor_name:"",street_address:"",city:"",province:"",country:"",postal_code:"",contact_person:"",telephone_number:"",email:"",website:""},Sg=({open:t,onClose:e,onSave:r,initialVendor:n,isEditMode:s=!1,loading:i=!1})=>{const[o,l]=_.useState(fp),[u,d]=_.useState({}),f=Ys(o,300),[m,v]=_.useState([]);_.useEffect(()=>{if(t){console.log("UnifiedVendorDialog: Setting vendor with initialVendor:",n);const y={...fp,...n};l(y),!s&&!n?.city&&!n?.province&&!n?.country&&w(),(async()=>{try{const j=await xe.get("/api/vendors");v(j.data||[])}catch{}})()}},[t,n,s]);const p=y=>{const{name:j,value:O}=y.target;l(k=>({...k,[j]:O})),u[j]&&d(k=>({...k,[j]:void 0}))},b=()=>{r(o)};_.useEffect(()=>{if(!t)return;const y={};if(f.email&&f.email.trim().length>0&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f.email.trim())||(y.email="Invalid email format")),f.vendor_name&&f.vendor_name.trim().length>0){const j=f.vendor_name.trim().toLowerCase();m.some(k=>(k.vendor_name||"").trim().toLowerCase()===j)&&!s&&(y.vendor_name="Vendor name already exists")}d(j=>({...j,...y}))},[f,t,s,m]);const w=async()=>{try{const y=await jg();l(j=>({...j,city:y.city,province:y.province,country:y.country})),console.log("Autofilled vendor form with business profile data:",y)}catch(y){console.error("Error autofilling from business profile:",y)}};return a.jsxs(Sr,{open:t,onClose:e,maxWidth:"md",fullWidth:!0,children:[a.jsx(Cr,{children:s?"Edit Vendor":"Add New Vendor"}),a.jsx(Pr,{children:a.jsxs(Z,{container:!0,spacing:2,sx:{mt:1},children:[a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{name:"vendor_name",label:"Vendor Name",value:o.vendor_name,onChange:p,fullWidth:!0,required:!0,error:!!u.vendor_name,helperText:u.vendor_name})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{name:"contact_person",label:"Contact Person",value:o.contact_person,onChange:p,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{name:"email",label:"Email",type:"email",value:o.email,onChange:p,fullWidth:!0,error:!!u.email,helperText:u.email})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{name:"telephone_number",label:"Telephone",value:o.telephone_number,onChange:p,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{name:"street_address",label:"Street Address",value:o.street_address,onChange:p,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{name:"city",label:"City",value:o.city,onChange:p,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{name:"province",label:"Province/State",value:o.province,onChange:p,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{name:"country",label:"Country",value:o.country,onChange:p,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{name:"postal_code",label:"Postal Code",value:o.postal_code,onChange:p,fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{name:"website",label:"Website",value:o.website,onChange:p,fullWidth:!0})})]})}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:e,children:"Cancel"}),a.jsx(Ce,{onClick:b,variant:"contained",disabled:i,children:s?"Save Changes":"Add Vendor"})]})]})},qy=()=>{const[t,e]=_.useState(""),[r,n]=_.useState([]),[s,i]=_.useState(!1),[o,l]=_.useState({page:0,pageSize:10}),[u,d]=_.useState(!1),[f,m]=_.useState(!1),[v,p]=_.useState({}),b=r.filter(F=>(F.vendor_name||"").toLowerCase().includes(t.toLowerCase())||(F.contact_person||"").toLowerCase().includes(t.toLowerCase())||(F.email||"").toLowerCase().includes(t.toLowerCase())),w=[{field:"vendor_name",headerName:"Vendor Name",flex:1.5},{field:"contact_person",headerName:"Contact Person",flex:1},{field:"email",headerName:"Email",flex:1.5},{field:"telephone_number",headerName:"Phone Number",flex:1},{field:"actions",headerName:"Actions",width:100,sortable:!1,renderCell:F=>a.jsx(jr,{size:"small",color:"error",onClick:U=>{U.stopPropagation(),k(F.row.vendor_id)},children:a.jsx(la,{})})}],y=async()=>{i(!0);try{const U=(await Ry()).map(C=>({...C,id:C.vendor_id}));n(U)}catch{ve.error("Failed to fetch vendors.")}finally{i(!1)}};_.useEffect(()=>{y()},[]);const j=(F=null)=>{F?(m(!0),p(F)):(m(!1),p({vendor_name:"",street_address:"",city:"",province:"",country:"",contact_person:"",telephone_number:"",email:"",website:"",postal_code:""})),d(!0)},O=()=>{d(!1),p({})},k=async F=>{if(window.confirm("Are you sure you want to delete this vendor?"))try{await xe.delete(`/api/vendors/${F}`),ve.success("Vendor deleted successfully!"),y()}catch(U){U instanceof _n?ve.error(U.response?.data?.error||"Failed to delete vendor."):ve.error("An unexpected error occurred while deleting the vendor.")}},I=()=>{const F=wi.unparse(b),U=new Blob([F],{type:"text/csv;charset=utf-8;"}),C=document.createElement("a");if(C.download!==void 0){const N=URL.createObjectURL(U);C.setAttribute("href",N),C.setAttribute("download","vendor_list.csv"),C.style.visibility="hidden",document.body.appendChild(C),C.click(),document.body.removeChild(C)}},H=()=>{const F="/api/vendors/export/pdf",U=document.createElement("a");U.href=F,U.setAttribute("download","vendor_list.pdf"),document.body.appendChild(U),U.click(),document.body.removeChild(U)};return a.jsxs(er,{maxWidth:"xl",children:[a.jsxs(ue,{sx:{my:4},children:[a.jsx(q,{variant:"h4",component:"h1",gutterBottom:!0,children:"Vendor Management"}),a.jsxs(Kr,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[a.jsx(Ce,{variant:"contained",startIcon:a.jsx(ka,{}),onClick:()=>j(),children:"New Vendor"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:I,children:"Export CSV"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:H,children:"Download PDF"})]}),a.jsx(At,{sx:{width:"100%",overflow:"hidden",mb:3},children:a.jsxs(ue,{sx:{p:2,width:"100%"},children:[a.jsx(Oe,{fullWidth:!0,variant:"outlined",placeholder:"Search vendors...",value:t,onChange:F=>e(F.target.value),InputProps:{startAdornment:a.jsx(Bn,{position:"start",children:a.jsx(rs,{})})},sx:{mb:2}}),a.jsx(es,{rows:b,columns:w,loading:s,paginationModel:o,onPaginationModelChange:l,pageSizeOptions:[10,25,50],getRowId:F=>F.vendor_id,onRowClick:F=>j(F.row),disableRowSelectionOnClick:!0,sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})})]}),a.jsx(Sg,{open:u,onClose:O,onSave:async F=>{try{f?(await xe.put(`/api/vendors/${v.vendor_id}`,F),ve.success("Vendor updated successfully!")):(await xe.post("/api/vendors",F),ve.success("Vendor added successfully!")),O(),y()}catch(U){U instanceof _n?ve.error(U.response?.data?.error||`Failed to ${f?"update":"add"} vendor.`):ve.error(`An unexpected error occurred while ${f?"updating":"adding"} the vendor.`)}},initialVendor:v,isEditMode:f})]})},By=()=>{const{id:t}=bi();return a.jsx(er,{maxWidth:"md",children:a.jsxs(ue,{sx:{my:4},children:[a.jsx(q,{variant:"h4",component:"h1",gutterBottom:!0,children:"Vendor Detail Page"}),a.jsxs(At,{sx:{p:3},children:[a.jsxs(q,{variant:"h6",children:["Vendor ID: ",t]}),a.jsx(q,{variant:"body1",children:"This is a placeholder for the Vendor Detail Page."})]})]})})},Uy=()=>{const{id:t}=bi();return a.jsx(er,{maxWidth:"md",children:a.jsxs(ue,{sx:{my:4},children:[a.jsx(q,{variant:"h4",component:"h1",gutterBottom:!0,children:"Product Detail Page"}),a.jsxs(At,{sx:{p:3},children:[a.jsxs(q,{variant:"h6",children:["Product ID: ",t]}),a.jsx(q,{variant:"body1",children:"This is a placeholder for the Product Detail Page."})]})]})})};var rl={},pp;function Wy(){if(pp)return rl;pp=1;var t=jn();Object.defineProperty(rl,"__esModule",{value:!0}),rl.default=void 0;var e=t(Cn()),r=Sn();return rl.default=(0,e.default)((0,r.jsx)("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"}),"Upload"),rl}var zy=Wy();const Cg=Dr(zy),Pg=async t=>{const e=t?{partType:t}:{};return(await xe.get("/api/inventory",{params:e})).data},$y=async()=>Pg("stock"),Hy=async()=>Pg("supply"),kg=async t=>(await xe.get(`/api/inventory/${encodeURIComponent(t)}`)).data,Yy=async()=>(await xe.post("/api/inventory/cleanup-spaces")).data,gd=["Each","cm","ft","kg","pcs","L"],Vy=["stock","supply"],Eh=({open:t,onClose:e,onSave:r,initialPart:n={},isEditMode:s=!1,title:i})=>{const[o,l]=_.useState({part_number:"",part_description:"",unit:gd[0],last_unit_cost:"",quantity_on_hand:"",reorder_point:"",part_type:"stock",...n}),[u,d]=_.useState({}),[f,m]=_.useState(!1),v=_.useRef(null),p=Ys(o,300);_.useEffect(()=>{t&&(l({part_number:n?.part_number||"",part_description:n?.part_description||"",unit:n?.unit||gd[0],last_unit_cost:n?.last_unit_cost||"",quantity_on_hand:n?.quantity_on_hand||"",reorder_point:n?.reorder_point||"",part_type:n?.part_type||"stock"}),d({}),m(!1))},[t]),_.useEffect(()=>{t&&v.current&&setTimeout(()=>v.current?.focus(),100)},[t]);const b=(k,I)=>{k==="part_number"&&(I=I.toUpperCase()),l(k==="part_type"&&I==="supply"?H=>({...H,[k]:I,quantity_on_hand:"NA"}):H=>({...H,[k]:I})),u[k]&&d(H=>({...H,[k]:void 0}))};_.useEffect(()=>{if(!t||!p.part_number||p.part_number.trim()===""||s)return;let k=!1;return(async()=>{try{const I=await xe.get("/api/inventory/check-part-number",{params:{part_number:p.part_number.trim()}});if(k)return;I.data&&I.data.exists&&d(H=>({...H,part_number:"Part number already exists. Please use a unique part number."}))}catch{}})(),()=>{k=!0}},[p,t,s]);const w=()=>{const k={};if(o.part_number.trim()||(k.part_number="Part Number is required"),o.part_description.trim()||(k.part_description="Part Description is required"),o.unit||(k.unit="Unit is required"),o.part_type||(k.part_type="Part Type is required"),["stock","supply"].includes(o.part_type)||(k.part_type='Part Type must be either "stock" or "supply"'),o.part_type!=="supply"){const F=parseFloat(String(o.quantity_on_hand));o.quantity_on_hand!==""&&(isNaN(F)||F<0)&&(k.quantity_on_hand="Quantity on Hand must be a valid number >= 0")}const I=parseFloat(String(o.last_unit_cost));o.last_unit_cost!==""&&isNaN(I)&&(k.last_unit_cost="Last Unit Cost must be a valid number");const H=parseFloat(String(o.reorder_point));return o.reorder_point!==""&&isNaN(H)&&(k.reorder_point="Reorder Point must be a valid number"),d(k),Object.keys(k).length===0},y=async()=>{if(!w()){ve.error("Please correct the errors before saving.");return}m(!0);try{const k={...o,part_number:o.part_number.trim().toUpperCase(),part_description:o.part_description.trim(),unit:o.unit.trim(),last_unit_cost:o.last_unit_cost===""?null:parseFloat(String(o.last_unit_cost)),quantity_on_hand:o.part_type==="supply"?"NA":o.quantity_on_hand===""?0:parseFloat(String(o.quantity_on_hand)),reorder_point:o.reorder_point===""?null:parseFloat(String(o.reorder_point)),part_type:o.part_type.trim()};await r(k),ve.success(`Part ${s?"updated":"added"} successfully!`),e()}catch(k){console.error("Error saving part:",k);let I=`Failed to ${s?"update":"add"} part.`;k.response?.data?.error?I=k.response.data.error:k.response?.data?.message&&(I=k.response.data.message),k.response?.status===409||I.includes("Part number already exists")||I.includes("duplicate key value")||I.includes("already exists")?(d(H=>({...H,part_number:"Part number already exists. Please use a unique part number."})),ve.error("Part number already exists. Please use a unique part number.")):ve.error(I)}finally{m(!1)}},j=()=>{f||e()},O=i||(s?"Edit Part":"Add New Part");return a.jsxs(Sr,{open:t,onClose:j,maxWidth:"md",fullWidth:!0,children:[a.jsx(Cr,{children:O}),a.jsx(Pr,{children:a.jsxs(Kr,{spacing:3,sx:{mt:1},children:[a.jsxs(Z,{container:!0,spacing:2,children:[a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"Part Number",value:o.part_number,onChange:k=>b("part_number",k.target.value),fullWidth:!0,required:!0,error:!!u.part_number,helperText:u.part_number,inputRef:v,disabled:s})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"Part Type",value:o.part_type,onChange:k=>b("part_type",k.target.value),select:!0,fullWidth:!0,required:!0,error:!!u.part_type,helperText:u.part_type,children:Vy.map(k=>a.jsx(Jt,{value:k,children:k.charAt(0).toUpperCase()+k.slice(1)},k))})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{label:"Part Description",value:o.part_description,onChange:k=>b("part_description",k.target.value),fullWidth:!0,required:!0,error:!!u.part_description,helperText:u.part_description,multiline:!0,rows:2})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"Unit",value:o.unit,onChange:k=>b("unit",k.target.value),select:!0,fullWidth:!0,required:!0,error:!!u.unit,helperText:u.unit,children:gd.map(k=>a.jsx(Jt,{value:k,children:k},k))})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"Last Unit Cost",value:o.last_unit_cost,onChange:k=>b("last_unit_cost",k.target.value),type:"number",fullWidth:!0,error:!!u.last_unit_cost,helperText:u.last_unit_cost,inputProps:{step:"0.01",min:"0"}})}),o.part_type!=="supply"&&a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"Quantity on Hand",value:o.quantity_on_hand,onChange:k=>b("quantity_on_hand",k.target.value),type:"number",fullWidth:!0,error:!!u.quantity_on_hand,helperText:u.quantity_on_hand,inputProps:{step:"1",min:"0"}})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"Reorder Point",value:o.reorder_point,onChange:k=>b("reorder_point",k.target.value),type:"number",fullWidth:!0,error:!!u.reorder_point,helperText:u.reorder_point,inputProps:{step:"1",min:"0"}})})]}),Object.keys(u).length>0&&a.jsx(Ct,{severity:"error",children:a.jsx(q,{variant:"body2",children:"Please correct the errors above before saving."})})]})}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:j,disabled:f,children:"Cancel"}),a.jsx(Ce,{onClick:y,variant:"contained",disabled:f,children:f?"Saving...":s?"Update Part":"Save Part"})]})]})},Gy=()=>{const[t,e]=_.useState(""),[r,n]=_.useState([]),[s,i]=_.useState(!1),[o,l]=_.useState(!1),[u,d]=_.useState(null),[f,m]=_.useState(!1),[v,p]=_.useState(0),[b,w]=_.useState(null),[y,j]=_.useState(!1),O=_.useRef(null),[k,I]=_.useState(!1),[H,F]=_.useState(null),[U,C]=_.useState(!1),[N,Q]=_.useState({page:0,pageSize:10}),{user:P}=Aa(),L=async()=>{i(!0);try{const be=await $y();console.log("Raw inventory response:",be),be.length>0&&console.log("Sample inventory item from frontend:",{part_number:be[0].part_number,last_unit_cost:be[0].last_unit_cost,last_unit_cost_type:typeof be[0].last_unit_cost,quantity_on_hand:be[0].quantity_on_hand,quantity_on_hand_type:typeof be[0].quantity_on_hand});const je=be.map((Pe,He)=>({...Pe,id:Pe.part_number||He}));n(je)}catch(be){console.error("Error fetching inventory:",be)}finally{i(!1)}};_.useEffect(()=>{L();const be=()=>L();return window.addEventListener("inventory-updated",be),()=>window.removeEventListener("inventory-updated",be)},[]);const te=r.filter(be=>be.part_number?.toUpperCase().includes(t.toUpperCase())||be.part_description?.toLowerCase().includes(t.toLowerCase())),W=[{field:"part_number",headerName:"Part #",flex:1,headerAlign:"left"},{field:"part_description",headerName:"Part Description",flex:2,headerAlign:"left"},{field:"quantity_on_hand",headerName:"Quantity on Hand",flex:1,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"unit",headerName:"UOM",flex:.5,headerAlign:"left"},{field:"last_unit_cost",headerName:"Last Unit Cost",flex:1,type:"number",editable:!0,align:"center",headerAlign:"left",valueFormatter:be=>`$${(Number(be.value)||0).toFixed(2)}`,valueGetter:be=>Number(be.value)||0},{field:"reorder_point",headerName:"Reorder Point",flex:.75,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"value",headerName:"Value",flex:1,type:"number",valueGetter:be=>{const je=Number(be.row.quantity_on_hand)||0,Pe=Number(be.row.last_unit_cost)||0;return je*Pe},valueFormatter:be=>`$${(Number(be.value)||0).toFixed(2)}`,headerAlign:"left",align:"center"},P?.access_role!=="Sales and Purchase"?{field:"actions",headerName:"Actions",width:100,headerAlign:"left",sortable:!1,renderCell:be=>a.jsx(jr,{size:"small",color:"error",onClick:je=>{je.stopPropagation(),z(be.row.part_number)},children:a.jsx(la,{fontSize:"medium",sx:{fontSize:28}})})}:null].filter(Boolean),z=async be=>{if(window.confirm(`Are you sure you want to delete part ${be}?`))try{console.log(`Deleting part: ${be}`);const je=await xe.delete(`/api/inventory/${encodeURIComponent(be)}`);console.log(`Part ${be} deleted successfully:`,je.data),alert(`Part ${be} deleted successfully!`),L()}catch(je){console.error(`Error deleting part ${be}:`,je),alert(`Error deleting part ${be}. Please check the console.`)}},V=async(be,je)=>{console.log("Attempting to update row:",be);const Pe={};if(be.quantity_on_hand!==je.quantity_on_hand){const Ye=parseFloat(String(be.quantity_on_hand));if(isNaN(Ye))return alert("Invalid quantity value. Please enter a valid number."),Promise.reject("Invalid quantity");Pe.quantity_on_hand=Ye}if(be.reorder_point!==je.reorder_point){const Ye=parseFloat(String(be.reorder_point));if(isNaN(Ye))return alert("Invalid reorder point value. Please enter a valid number."),Promise.reject("Invalid reorder point");Pe.reorder_point=Ye}if(be.last_unit_cost!==je.last_unit_cost){const Ye=parseFloat(String(be.last_unit_cost));if(isNaN(Ye))return alert("Invalid last unit cost value. Please enter a valid number."),Promise.reject("Invalid last unit cost");Pe.last_unit_cost=Ye}if(Object.keys(Pe).length===0)return console.log("No fields changed."),be;const He=be.part_number;try{const Ye=await xe.put(`/api/inventory/${encodeURIComponent(He)}`,Pe);console.log(`Inventory updated for part ${He}:`,Ye.data),alert(`Part ${He} updated successfully!`);const nt=r.map(dt=>dt.id===Ye.data.updatedItem.part_number?{...dt,...Ye.data.updatedItem}:dt);return n(nt),Ye.data.updatedItem}catch(Ye){return console.error(`Error updating inventory for part ${He}:`,Ye),Ye instanceof _n&&Ye.response&&Ye.response.data&&Ye.response.data.error?alert(`Error updating inventory: ${Ye.response.data.error}`):alert(`Error updating inventory for part ${He}. Please check the console.`),Promise.reject(Ye)}},Y=()=>{const be=te.map(Ye=>({...Ye,value:(Number(Ye.quantity_on_hand)||0)*(Number(Ye.last_unit_cost)||0)})),je=wi.unparse(be),Pe=new Blob([je],{type:"text/csv;charset=utf-8;"}),He=document.createElement("a");if(He.download!==void 0){const Ye=URL.createObjectURL(Pe);He.setAttribute("href",Ye),He.setAttribute("download","inventory_list.csv"),He.style.visibility="hidden",document.body.appendChild(He),He.click()}},E=()=>{window.open("/api/inventory/export/pdf?partType=stock","_blank")},X=()=>{d(null),l(!0)},oe=async be=>{const je={...be,part_number:be.part_number.trim().toUpperCase(),part_description:be.part_description.trim(),unit:be.unit.trim(),part_type:be.part_type.trim()};try{if(u){const{part_number:Pe,...He}=je;await xe.put(`/api/inventory/${encodeURIComponent(Pe)}`,He)}else await xe.post("/api/inventory",je);L()}catch(Pe){throw Pe}},de=()=>{l(!1),d(null)},[A,D]=_.useState(!1),[J,re]=_.useState(null),ce=be=>{re({...be.row}),D(!0)},fe=(be,je)=>{re(Pe=>({...Pe,[be]:je}))},ee=async()=>{if(J)try{const{part_number:be,...je}=J,Pe={...je,part_description:je.part_description?je.part_description.trim():"",unit:je.unit?je.unit.trim():"",part_type:je.part_type?je.part_type.trim():""};await xe.put(`/api/inventory/${encodeURIComponent(be.toUpperCase())}`,Pe),D(!1),re(null),L()}catch{alert("Failed to update part.")}},ae=()=>{D(!1),re(null)},pe=()=>{O.current?.click()},ye=async be=>{const je=be.target.files?.[0];if(je){if(!je.name.endsWith(".csv")&&je.type!=="text/csv"){alert("Please select a valid CSV file");return}if(je.size>5*1024*1024){alert("File size must be less than 5MB");return}await Le(je)}},Le=async be=>{m(!0),p(0),w(null);const je=new FormData;je.append("csvFile",be);try{const Pe=setInterval(()=>{p(Ye=>Ye>=90?(clearInterval(Pe),90):Ye+10)},200),He=await xe.post("/api/inventory/upload-csv",je,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:Ye=>{if(Ye.total){const nt=Math.round(Ye.loaded*90/Ye.total);p(nt)}}});clearInterval(Pe),p(100),w(He.data),j(!0),setTimeout(()=>{L()},1e3)}catch(Pe){console.error("Error uploading CSV:",Pe),Pe instanceof _n&&Pe.response?.data?w({error:"Upload failed",errors:Pe.response.data.errors||[Pe.response.data.error||"Unknown error"],warnings:Pe.response.data.warnings||[]}):w({error:"Upload failed",errors:["An unexpected error occurred during upload"]}),j(!0)}finally{m(!1),p(0),O.current&&(O.current.value="")}},se=async()=>{try{const be=await xe.get("/api/inventory/csv-template",{responseType:"blob"}),je=window.URL.createObjectURL(new Blob([be.data])),Pe=document.createElement("a");Pe.href=je,Pe.setAttribute("download","inventory_template.csv"),document.body.appendChild(Pe),Pe.click(),Pe.remove(),window.URL.revokeObjectURL(je)}catch(be){console.error("Error downloading template:",be),alert("Error downloading template")}},Fe=()=>{j(!1),w(null)},ne=async()=>{if(window.confirm("Are you sure you want to clean up leading and trailing spaces from all inventory items? This action cannot be undone.")){I(!0);try{const be=await Yy();F(be),C(!0),await L()}catch(be){console.error("Error during cleanup:",be),F({error:!0,message:"Failed to clean up inventory spaces",details:be instanceof Error?be.message:"Unknown error"}),C(!0)}finally{I(!1)}}},R=()=>{C(!1),F(null)};return a.jsxs(er,{maxWidth:"xl",sx:{mt:4},children:[a.jsxs(ue,{sx:{mb:4},children:[a.jsxs(ue,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[a.jsx(q,{variant:"h4",component:"h1",gutterBottom:!0,children:"Stock"}),a.jsxs(Kr,{direction:"row",spacing:2,children:[a.jsx(Ce,{variant:"contained",startIcon:a.jsx(ka,{}),onClick:X,children:"New Part"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx(Cg,{}),onClick:pe,children:"Upload CSV"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:se,children:"Download Template"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:Y,children:"Export CSV"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:E,children:"Download PDF"}),a.jsx(Ce,{variant:"outlined",color:"warning",onClick:ne,disabled:k,startIcon:k?a.jsx(pr,{size:20}):a.jsx(la,{}),children:k?"Cleaning...":"Clean"})]})]}),a.jsx("input",{type:"file",ref:O,onChange:ye,accept:".csv",style:{display:"none"}}),f&&a.jsxs(At,{sx:{p:2,mb:2},children:[a.jsx(q,{variant:"body2",gutterBottom:!0,children:"Uploading CSV file..."}),a.jsx(Am,{variant:"determinate",value:v}),a.jsxs(q,{variant:"caption",color:"text.secondary",children:[v,"% complete"]})]}),a.jsx(At,{sx:{width:"100%",overflow:"hidden",mb:3},children:a.jsxs(ue,{sx:{p:2},children:[a.jsx(Oe,{fullWidth:!0,variant:"outlined",placeholder:"Search stock...",value:t,onChange:be=>e(be.target.value),InputProps:{startAdornment:a.jsx(Bn,{position:"start",children:a.jsx(rs,{})})},sx:{mb:2}}),a.jsx(es,{rows:te,columns:W,loading:s,paginationModel:N,onPaginationModelChange:be=>Q(be),pageSizeOptions:[10,20,50],processRowUpdate:V,getRowId:be=>be.id,onRowClick:P?.access_role==="Sales and Purchase"?void 0:ce,sx:{cursor:"pointer","& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})})]}),a.jsx(Eh,{open:o,onClose:de,onSave:oe,initialPart:u||void 0,isEditMode:!!u,title:u?"Edit Inventory Part":"Add New Inventory Part"}),a.jsxs(Sr,{open:A,onClose:ae,maxWidth:"md",fullWidth:!0,children:[a.jsx(Cr,{children:"Edit Inventory Part"}),a.jsx(Pr,{children:J&&a.jsxs(Z,{container:!0,spacing:2,sx:{mt:1},children:[a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"Part Number",value:J.part_number||"",fullWidth:!0,disabled:!0})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"Part Description",value:J.part_description||"",onChange:be=>fe("part_description",be.target.value),fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"Unit",value:J.unit||"",onChange:be=>fe("unit",be.target.value),fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"Last Unit Cost",type:"number",value:J.last_unit_cost||"",onChange:be=>fe("last_unit_cost",be.target.value),fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"Quantity on Hand",type:"number",value:J.quantity_on_hand||"",onChange:be=>fe("quantity_on_hand",be.target.value),fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"Reorder Point",type:"number",value:J.reorder_point||"",onChange:be=>fe("reorder_point",be.target.value),fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"Part Type",value:J.part_type||"",onChange:be=>fe("part_type",be.target.value),fullWidth:!0})})]})}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:ae,children:"Cancel"}),a.jsx(Ce,{onClick:ee,variant:"contained",children:"Save"})]})]}),a.jsxs(Sr,{open:y,onClose:Fe,maxWidth:"md",fullWidth:!0,children:[a.jsx(Cr,{children:b?.error?"Upload Failed":"Upload Completed"}),a.jsx(Pr,{children:b&&a.jsxs(ue,{children:[b.error?a.jsx(Ct,{severity:"error",sx:{mb:2},children:b.error}):a.jsx(Ct,{severity:"success",sx:{mb:2},children:b.message}),b.summary&&a.jsxs(ue,{sx:{mb:3},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Summary"}),a.jsxs(Z,{container:!0,spacing:2,children:[a.jsx(Z,{item:!0,xs:6,sm:3,children:a.jsx(Zt,{label:`Total: ${b.summary.totalProcessed}`,color:"primary"})}),a.jsx(Z,{item:!0,xs:6,sm:3,children:a.jsx(Zt,{label:`New: ${b.summary.newItems}`,color:"success"})}),a.jsx(Z,{item:!0,xs:6,sm:3,children:a.jsx(Zt,{label:`Updated: ${b.summary.updatedItems}`,color:"info"})}),a.jsx(Z,{item:!0,xs:6,sm:3,children:a.jsx(Zt,{label:`Errors: ${b.summary.errors}`,color:"error"})})]})]}),b.errors&&b.errors.length>0&&a.jsxs(ue,{sx:{mb:3},children:[a.jsxs(q,{variant:"h6",color:"error",gutterBottom:!0,children:["Errors (",b.errors.length,")"]}),a.jsx(oo,{dense:!0,children:b.errors.map((be,je)=>a.jsx(lo,{children:a.jsx(co,{primary:be})},je))})]}),b.warnings&&b.warnings.length>0&&a.jsxs(ue,{sx:{mb:3},children:[a.jsxs(q,{variant:"h6",color:"warning.main",gutterBottom:!0,children:["Warnings (",b.warnings.length,")"]}),a.jsx(oo,{dense:!0,children:b.warnings.map((be,je)=>a.jsx(lo,{children:a.jsx(co,{primary:be})},je))})]})]})}),a.jsx(Nr,{children:a.jsx(Ce,{onClick:Fe,variant:"contained",children:"Close"})})]}),a.jsxs(Sr,{open:U,onClose:R,maxWidth:"sm",fullWidth:!0,children:[a.jsx(Cr,{children:H?.error?"Cleanup Failed":"Cleanup Completed"}),a.jsx(Pr,{children:H&&a.jsxs(ue,{children:[H.error?a.jsxs(Ct,{severity:"error",sx:{mb:2},children:[H.message,H.details&&a.jsxs(q,{variant:"body2",sx:{mt:1},children:["Details: ",H.details]})]}):a.jsx(Ct,{severity:"success",sx:{mb:2},children:H.message}),H.summary&&a.jsxs(ue,{sx:{mb:3},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Summary"}),a.jsxs(Z,{container:!0,spacing:2,children:[a.jsx(Z,{item:!0,xs:6,sm:4,children:a.jsx(Zt,{label:`Total: ${H.summary.totalProcessed}`,color:"primary"})}),a.jsx(Z,{item:!0,xs:6,sm:4,children:a.jsx(Zt,{label:`Updated: ${H.summary.itemsUpdated}`,color:"success"})}),a.jsx(Z,{item:!0,xs:6,sm:4,children:a.jsx(Zt,{label:`Errors: ${H.summary.errors}`,color:"error"})})]})]})]})}),a.jsx(Nr,{children:a.jsx(Ce,{onClick:R,variant:"contained",children:"Close"})})]})]})},Qy=()=>{const[t,e]=_.useState(""),[r,n]=_.useState([]),[s,i]=_.useState(!1),[o,l]=_.useState(!1),[u,d]=_.useState(null),[f,m]=_.useState(!1),[v,p]=_.useState(0),[b,w]=_.useState(null),[y,j]=_.useState(!1),O=_.useRef(null),[k,I]=_.useState({page:0,pageSize:10}),H=async()=>{i(!0);try{const ae=(await Hy()).map((pe,ye)=>({...pe,id:pe.part_number||ye}));n(ae)}catch(ee){console.error("Error fetching supply inventory:",ee)}finally{i(!1)}};_.useEffect(()=>{H();const ee=()=>H();return window.addEventListener("supply-updated",ee),()=>window.removeEventListener("supply-updated",ee)},[]);const F=r.filter(ee=>ee.part_number?.toUpperCase().includes(t.toUpperCase())||ee.part_description?.toLowerCase().includes(t.toLowerCase())),U=[{field:"part_number",headerName:"Part #",flex:1,headerAlign:"left"},{field:"part_description",headerName:"Part Description",flex:2,headerAlign:"left"},{field:"unit",headerName:"UOM",flex:.5,headerAlign:"left"},{field:"last_unit_cost",headerName:"Last Unit Cost",flex:1,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"reorder_point",headerName:"Reorder Point",flex:.75,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"part_type",headerName:"Type",flex:.5,headerAlign:"left"},{field:"value",headerName:"Value",flex:1,type:"number",valueGetter:ee=>{const ae=ee.row.quantity_on_hand==="NA"?0:Number(ee.row.quantity_on_hand)||0,pe=Number(ee.row.last_unit_cost)||0;return ae*pe},valueFormatter:ee=>`$${(Number(ee.value)||0).toFixed(2)}`,headerAlign:"left",align:"center"},{field:"actions",headerName:"Actions",width:100,headerAlign:"left",sortable:!1,renderCell:ee=>a.jsx(jr,{size:"small",color:"error",onClick:ae=>{ae.stopPropagation(),C(ee.row.part_number)},children:a.jsx(la,{fontSize:"medium",sx:{fontSize:28}})})}],C=async ee=>{if(window.confirm(`Are you sure you want to delete part ${ee}?`))try{console.log(`Deleting part: ${ee}`);const ae=await xe.delete(`/api/inventory/${encodeURIComponent(ee)}`);console.log(`Part ${ee} deleted successfully:`,ae.data),alert(`Part ${ee} deleted successfully!`),H()}catch(ae){console.error(`Error deleting part ${ee}:`,ae),alert(`Error deleting part ${ee}. Please check the console.`)}},N=async(ee,ae)=>{console.log("Attempting to update row:",ee);const pe={};if(ee.reorder_point!==ae.reorder_point){const Le=parseFloat(String(ee.reorder_point));if(isNaN(Le))return alert("Invalid reorder point value. Please enter a valid number."),Promise.reject("Invalid reorder point");pe.reorder_point=Le}if(ee.last_unit_cost!==ae.last_unit_cost){const Le=parseFloat(String(ee.last_unit_cost));if(isNaN(Le))return alert("Invalid last unit cost value. Please enter a valid number."),Promise.reject("Invalid last unit cost");pe.last_unit_cost=Le}if(Object.keys(pe).length===0)return console.log("No fields changed."),ee;const ye=ee.part_number;try{const Le=await xe.put(`/api/inventory/${encodeURIComponent(ye)}`,pe);console.log(`Supply inventory updated for part ${ye}:`,Le.data),alert(`Part ${ye} updated successfully!`);const se=r.map(Fe=>Fe.id===Le.data.updatedItem.part_number?{...Fe,...Le.data.updatedItem}:Fe);return n(se),Le.data.updatedItem}catch(Le){return console.error(`Error updating supply inventory for part ${ye}:`,Le),Le instanceof _n&&Le.response&&Le.response.data&&Le.response.data.error?alert(`Error updating inventory: ${Le.response.data.error}`):alert(`Error updating inventory for part ${ye}. Please check the console.`),Promise.reject(Le)}},Q=()=>{const ee=F.map(Le=>({...Le,value:(Le.quantity_on_hand==="NA"?0:Number(Le.quantity_on_hand)||0)*(Number(Le.last_unit_cost)||0)})),ae=wi.unparse(ee),pe=new Blob([ae],{type:"text/csv;charset=utf-8;"}),ye=document.createElement("a");if(ye.download!==void 0){const Le=URL.createObjectURL(pe);ye.setAttribute("href",Le),ye.setAttribute("download","supply_list.csv"),ye.style.visibility="hidden",document.body.appendChild(ye),ye.click()}},P=()=>{window.open("/api/inventory/export/pdf?partType=supply","_blank")},L=()=>{d({part_number:"",part_description:"",unit:"",last_unit_cost:"",quantity_on_hand:"NA",reorder_point:"",part_type:"supply"}),l(!0)},te=async ee=>{const ae={...ee,part_number:ee.part_number.trim().toUpperCase(),part_description:ee.part_description.trim(),unit:ee.unit.trim(),part_type:ee.part_type.trim()};try{if(u){const{part_number:pe,...ye}=ae;await xe.put(`/api/inventory/${encodeURIComponent(pe)}`,ye)}else await xe.post("/api/inventory",ae);H()}catch(pe){throw pe}},W=()=>{l(!1),d(null)},[z,V]=_.useState(!1),[Y,E]=_.useState(null),X=ee=>{E({...ee.row}),V(!0)},oe=(ee,ae)=>{E(pe=>({...pe,[ee]:ae}))},de=async()=>{if(Y)try{const{part_number:ee,...ae}=Y,pe={...ae,part_description:ae.part_description?ae.part_description.trim():"",unit:ae.unit?ae.unit.trim():"",part_type:ae.part_type?ae.part_type.trim():""};await xe.put(`/api/inventory/${encodeURIComponent(ee.toUpperCase())}`,pe),V(!1),E(null),H()}catch{alert("Failed to update part.")}},A=()=>{V(!1),E(null)},D=()=>{O.current?.click()},J=async ee=>{const ae=ee.target.files?.[0];if(ae){if(!ae.name.endsWith(".csv")&&ae.type!=="text/csv"){alert("Please select a valid CSV file");return}if(ae.size>5*1024*1024){alert("File size must be less than 5MB");return}await re(ae)}},re=async ee=>{m(!0),p(0),w(null);const ae=new FormData;ae.append("csvFile",ee);try{const pe=setInterval(()=>{p(Le=>Le>=90?(clearInterval(pe),90):Le+10)},200),ye=await xe.post("/api/inventory/upload-csv",ae,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:Le=>{if(Le.total){const se=Math.round(Le.loaded*90/Le.total);p(se)}}});clearInterval(pe),p(100),w(ye.data),j(!0),setTimeout(()=>{H()},1e3)}catch(pe){console.error("Error uploading CSV:",pe),pe instanceof _n&&pe.response?.data?w({error:"Upload failed",errors:pe.response.data.errors||[pe.response.data.error||"Unknown error"],warnings:pe.response.data.warnings||[]}):w({error:"Upload failed",errors:["An unexpected error occurred during upload"]}),j(!0)}finally{m(!1),p(0),O.current&&(O.current.value="")}},ce=async()=>{try{const ee=await xe.get("/api/inventory/csv-template",{responseType:"blob"}),ae=window.URL.createObjectURL(new Blob([ee.data])),pe=document.createElement("a");pe.href=ae,pe.setAttribute("download","supply_template.csv"),document.body.appendChild(pe),pe.click(),pe.remove(),window.URL.revokeObjectURL(ae)}catch(ee){console.error("Error downloading template:",ee),alert("Error downloading template")}},fe=()=>{j(!1),w(null)};return a.jsxs(er,{maxWidth:"xl",sx:{mt:4},children:[a.jsxs(ue,{sx:{mb:4},children:[a.jsxs(ue,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[a.jsx(q,{variant:"h4",component:"h1",gutterBottom:!0,children:"Supply List"}),a.jsxs(Kr,{direction:"row",spacing:2,children:[a.jsx(Ce,{variant:"contained",startIcon:a.jsx(ka,{}),onClick:L,children:"New Part"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx(Cg,{}),onClick:D,children:"Upload CSV"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:ce,children:"Download Template"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:Q,children:"Export CSV"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:P,children:"Download PDF"})]})]}),a.jsx("input",{type:"file",ref:O,onChange:J,accept:".csv",style:{display:"none"}}),f&&a.jsxs(At,{sx:{p:2,mb:2},children:[a.jsx(q,{variant:"body2",gutterBottom:!0,children:"Uploading CSV file..."}),a.jsx(Am,{variant:"determinate",value:v}),a.jsxs(q,{variant:"caption",color:"text.secondary",children:[v,"% complete"]})]}),a.jsx(At,{sx:{width:"100%",overflow:"hidden",mb:3},children:a.jsxs(ue,{sx:{p:2},children:[a.jsx(Oe,{fullWidth:!0,variant:"outlined",placeholder:"Search supply...",value:t,onChange:ee=>e(ee.target.value),InputProps:{startAdornment:a.jsx(Bn,{position:"start",children:a.jsx(rs,{})})},sx:{mb:2}}),a.jsx(es,{rows:F,columns:U,loading:s,paginationModel:k,onPaginationModelChange:ee=>I(ee),pageSizeOptions:[10,20,50],processRowUpdate:N,getRowId:ee=>ee.id,onRowClick:X,sx:{cursor:"pointer","& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})})]}),a.jsx(Eh,{open:o,onClose:W,onSave:te,initialPart:u||void 0,isEditMode:!!u,title:u?"Edit Supply Part":"Add New Supply Part"}),a.jsxs(Sr,{open:z,onClose:A,maxWidth:"md",fullWidth:!0,children:[a.jsx(Cr,{children:"Edit Supply Part"}),a.jsx(Pr,{children:Y&&a.jsxs(Z,{container:!0,spacing:2,sx:{mt:1},children:[a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"Part Number",value:Y.part_number||"",fullWidth:!0,disabled:!0})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"Part Description",value:Y.part_description||"",onChange:ee=>oe("part_description",ee.target.value),fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"Unit",value:Y.unit||"",onChange:ee=>oe("unit",ee.target.value),fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"Last Unit Cost",type:"number",value:Y.last_unit_cost||"",onChange:ee=>oe("last_unit_cost",ee.target.value),fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"Reorder Point",type:"number",value:Y.reorder_point||"",onChange:ee=>oe("reorder_point",ee.target.value),fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"Part Type",value:Y.part_type||"",onChange:ee=>oe("part_type",ee.target.value),fullWidth:!0})})]})}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:A,children:"Cancel"}),a.jsx(Ce,{onClick:de,variant:"contained",children:"Save"})]})]}),a.jsxs(Sr,{open:y,onClose:fe,maxWidth:"md",fullWidth:!0,children:[a.jsx(Cr,{children:b?.error?"Upload Failed":"Upload Completed"}),a.jsx(Pr,{children:b&&a.jsxs(ue,{children:[b.error?a.jsx(Ct,{severity:"error",sx:{mb:2},children:b.error}):a.jsx(Ct,{severity:"success",sx:{mb:2},children:b.message}),b.summary&&a.jsxs(ue,{sx:{mb:3},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Summary"}),a.jsxs(Z,{container:!0,spacing:2,children:[a.jsx(Z,{item:!0,xs:6,sm:3,children:a.jsx(Zt,{label:`Total: ${b.summary.totalProcessed}`,color:"primary"})}),a.jsx(Z,{item:!0,xs:6,sm:3,children:a.jsx(Zt,{label:`New: ${b.summary.newItems}`,color:"success"})}),a.jsx(Z,{item:!0,xs:6,sm:3,children:a.jsx(Zt,{label:`Updated: ${b.summary.updatedItems}`,color:"info"})}),a.jsx(Z,{item:!0,xs:6,sm:3,children:a.jsx(Zt,{label:`Errors: ${b.summary.errors}`,color:"error"})})]})]}),b.errors&&b.errors.length>0&&a.jsxs(ue,{sx:{mb:3},children:[a.jsxs(q,{variant:"h6",color:"error",gutterBottom:!0,children:["Errors (",b.errors.length,")"]}),a.jsx(oo,{dense:!0,children:b.errors.map((ee,ae)=>a.jsx(lo,{children:a.jsx(co,{primary:ee})},ae))})]}),b.warnings&&b.warnings.length>0&&a.jsxs(ue,{sx:{mb:3},children:[a.jsxs(q,{variant:"h6",color:"warning.main",gutterBottom:!0,children:["Warnings (",b.warnings.length,")"]}),a.jsx(oo,{dense:!0,children:b.warnings.map((ee,ae)=>a.jsx(lo,{children:a.jsx(co,{primary:ee})},ae))})]})]})}),a.jsx(Nr,{children:a.jsx(Ce,{onClick:fe,variant:"contained",children:"Close"})})]})]})};var nl={},mp;function Jy(){if(mp)return nl;mp=1;var t=jn();Object.defineProperty(nl,"__esModule",{value:!0}),nl.default=void 0;var e=t(Cn()),r=Sn();return nl.default=(0,e.default)((0,r.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),nl}var Ky=Jy();const Vs=Dr(Ky),Xy=async()=>(await xe.get("/api/quotes")).data,Zy="modulepreload",eb=function(t,e){return new URL(t,e).href},gp={},Zd=function(e,r,n){let s=Promise.resolve();if(r&&r.length>0){let d=function(f){return Promise.all(f.map(m=>Promise.resolve(m).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};const o=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),u=l?.nonce||l?.getAttribute("nonce");s=d(r.map(f=>{if(f=eb(f,n),f in gp)return;gp[f]=!0;const m=f.endsWith(".css"),v=m?'[rel="stylesheet"]':"";if(!!n)for(let w=o.length-1;w>=0;w--){const y=o[w];if(y.href===f&&(!m||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${v}`))return;const b=document.createElement("link");if(b.rel=m?"stylesheet":Zy,m||(b.as="script"),b.crossOrigin="",b.href=f,u&&b.setAttribute("nonce",u),document.head.appendChild(b),m)return new Promise((w,y)=>{b.addEventListener("load",w),b.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${f}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return s.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})};var Qn=Uint8Array,ga=Uint16Array,Oh=Int32Array,ju=new Qn([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Su=new Qn([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),eh=new Qn([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ag=function(t,e){for(var r=new ga(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var s=new Oh(r[30]),n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)s[i]=i-r[n]<<5|n;return{b:r,r:s}},Lg=Ag(ju,2),Ng=Lg.b,th=Lg.r;Ng[28]=258,th[258]=28;var Eg=Ag(Su,0),tb=Eg.b,vp=Eg.r,rh=new ga(32768);for(var zr=0;zr<32768;++zr){var Ts=(zr&43690)>>1|(zr&21845)<<1;Ts=(Ts&52428)>>2|(Ts&13107)<<2,Ts=(Ts&61680)>>4|(Ts&3855)<<4,rh[zr]=((Ts&65280)>>8|(Ts&255)<<8)>>1}var Za=function(t,e,r){for(var n=t.length,s=0,i=new ga(e);s<n;++s)t[s]&&++i[t[s]-1];var o=new ga(e);for(s=1;s<e;++s)o[s]=o[s-1]+i[s-1]<<1;var l;if(r){l=new ga(1<<e);var u=15-e;for(s=0;s<n;++s)if(t[s])for(var d=s<<4|t[s],f=e-t[s],m=o[t[s]-1]++<<f,v=m|(1<<f)-1;m<=v;++m)l[rh[m]>>u]=d}else for(l=new ga(n),s=0;s<n;++s)t[s]&&(l[s]=rh[o[t[s]-1]++]>>15-t[s]);return l},zs=new Qn(288);for(var zr=0;zr<144;++zr)zs[zr]=8;for(var zr=144;zr<256;++zr)zs[zr]=9;for(var zr=256;zr<280;++zr)zs[zr]=7;for(var zr=280;zr<288;++zr)zs[zr]=8;var Ml=new Qn(32);for(var zr=0;zr<32;++zr)Ml[zr]=5;var rb=Za(zs,9,0),nb=Za(zs,9,1),ab=Za(Ml,5,0),sb=Za(Ml,5,1),vd=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},Ia=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(e&7)&r},xd=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},Ih=function(t){return(t+7)/8|0},Og=function(t,e,r){return(r==null||r>t.length)&&(r=t.length),new Qn(t.subarray(e,r))},ib=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ta=function(t,e,r){var n=new Error(e||ib[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,Ta),!r)throw n;return n},ob=function(t,e,r,n){var s=t.length,i=0;if(!s||e.f&&!e.l)return r||new Qn(0);var o=!r,l=o||e.i!=2,u=e.i;o&&(r=new Qn(s*3));var d=function(ye){var Le=r.length;if(ye>Le){var se=new Qn(Math.max(Le*2,ye));se.set(r),r=se}},f=e.f||0,m=e.p||0,v=e.b||0,p=e.l,b=e.d,w=e.m,y=e.n,j=s*8;do{if(!p){f=Ia(t,m,1);var O=Ia(t,m+1,3);if(m+=3,O)if(O==1)p=nb,b=sb,w=9,y=5;else if(O==2){var F=Ia(t,m,31)+257,U=Ia(t,m+10,15)+4,C=F+Ia(t,m+5,31)+1;m+=14;for(var N=new Qn(C),Q=new Qn(19),P=0;P<U;++P)Q[eh[P]]=Ia(t,m+P*3,7);m+=U*3;for(var L=vd(Q),te=(1<<L)-1,W=Za(Q,L,1),P=0;P<C;){var z=W[Ia(t,m,te)];m+=z&15;var k=z>>4;if(k<16)N[P++]=k;else{var V=0,Y=0;for(k==16?(Y=3+Ia(t,m,3),m+=2,V=N[P-1]):k==17?(Y=3+Ia(t,m,7),m+=3):k==18&&(Y=11+Ia(t,m,127),m+=7);Y--;)N[P++]=V}}var E=N.subarray(0,F),X=N.subarray(F);w=vd(E),y=vd(X),p=Za(E,w,1),b=Za(X,y,1)}else Ta(1);else{var k=Ih(m)+4,I=t[k-4]|t[k-3]<<8,H=k+I;if(H>s){u&&Ta(0);break}l&&d(v+I),r.set(t.subarray(k,H),v),e.b=v+=I,e.p=m=H*8,e.f=f;continue}if(m>j){u&&Ta(0);break}}l&&d(v+131072);for(var oe=(1<<w)-1,de=(1<<y)-1,A=m;;A=m){var V=p[xd(t,m)&oe],D=V>>4;if(m+=V&15,m>j){u&&Ta(0);break}if(V||Ta(2),D<256)r[v++]=D;else if(D==256){A=m,p=null;break}else{var J=D-254;if(D>264){var P=D-257,re=ju[P];J=Ia(t,m,(1<<re)-1)+Ng[P],m+=re}var ce=b[xd(t,m)&de],fe=ce>>4;ce||Ta(3),m+=ce&15;var X=tb[fe];if(fe>3){var re=Su[fe];X+=xd(t,m)&(1<<re)-1,m+=re}if(m>j){u&&Ta(0);break}l&&d(v+131072);var ee=v+J;if(v<X){var ae=i-X,pe=Math.min(X,ee);for(ae+v<0&&Ta(3);v<pe;++v)r[v]=n[ae+v]}for(;v<ee;++v)r[v]=r[v-X]}}e.l=p,e.p=A,e.b=v,e.f=f,p&&(f=1,e.m=w,e.d=b,e.n=y)}while(!f);return v!=r.length&&o?Og(r,0,v):r.subarray(0,v)},ps=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8},al=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8,t[n+2]|=r>>16},yd=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var s=r.length,i=r.slice();if(!s)return{t:Dg,l:0};if(s==1){var o=new Qn(r[0].s+1);return o[r[0].s]=1,{t:o,l:1}}r.sort(function(H,F){return H.f-F.f}),r.push({s:-1,f:25001});var l=r[0],u=r[1],d=0,f=1,m=2;for(r[0]={s:-1,f:l.f+u.f,l,r:u};f!=s-1;)l=r[r[d].f<r[m].f?d++:m++],u=r[d!=f&&r[d].f<r[m].f?d++:m++],r[f++]={s:-1,f:l.f+u.f,l,r:u};for(var v=i[0].s,n=1;n<s;++n)i[n].s>v&&(v=i[n].s);var p=new ga(v+1),b=nh(r[f-1],p,0);if(b>e){var n=0,w=0,y=b-e,j=1<<y;for(i.sort(function(F,U){return p[U.s]-p[F.s]||F.f-U.f});n<s;++n){var O=i[n].s;if(p[O]>e)w+=j-(1<<b-p[O]),p[O]=e;else break}for(w>>=y;w>0;){var k=i[n].s;p[k]<e?w-=1<<e-p[k]++-1:++n}for(;n>=0&&w;--n){var I=i[n].s;p[I]==e&&(--p[I],++w)}b=e}return{t:new Qn(p),l:b}},nh=function(t,e,r){return t.s==-1?Math.max(nh(t.l,e,r+1),nh(t.r,e,r+1)):e[t.s]=r},xp=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new ga(++e),n=0,s=t[0],i=1,o=function(u){r[n++]=u},l=1;l<=e;++l)if(t[l]==s&&l!=e)++i;else{if(!s&&i>2){for(;i>138;i-=138)o(32754);i>2&&(o(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(o(s),--i;i>6;i-=6)o(8304);i>2&&(o(i-3<<5|8208),i=0)}for(;i--;)o(s);i=1,s=t[l]}return{c:r.subarray(0,n),n:e}},sl=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},Ig=function(t,e,r){var n=r.length,s=Ih(e+2);t[s]=n&255,t[s+1]=n>>8,t[s+2]=t[s]^255,t[s+3]=t[s+1]^255;for(var i=0;i<n;++i)t[s+i+4]=r[i];return(s+4+n)*8},yp=function(t,e,r,n,s,i,o,l,u,d,f){ps(e,f++,r),++s[256];for(var m=yd(s,15),v=m.t,p=m.l,b=yd(i,15),w=b.t,y=b.l,j=xp(v),O=j.c,k=j.n,I=xp(w),H=I.c,F=I.n,U=new ga(19),C=0;C<O.length;++C)++U[O[C]&31];for(var C=0;C<H.length;++C)++U[H[C]&31];for(var N=yd(U,7),Q=N.t,P=N.l,L=19;L>4&&!Q[eh[L-1]];--L);var te=d+5<<3,W=sl(s,zs)+sl(i,Ml)+o,z=sl(s,v)+sl(i,w)+o+14+3*L+sl(U,Q)+2*U[16]+3*U[17]+7*U[18];if(u>=0&&te<=W&&te<=z)return Ig(e,f,t.subarray(u,u+d));var V,Y,E,X;if(ps(e,f,1+(z<W)),f+=2,z<W){V=Za(v,p,0),Y=v,E=Za(w,y,0),X=w;var oe=Za(Q,P,0);ps(e,f,k-257),ps(e,f+5,F-1),ps(e,f+10,L-4),f+=14;for(var C=0;C<L;++C)ps(e,f+3*C,Q[eh[C]]);f+=3*L;for(var de=[O,H],A=0;A<2;++A)for(var D=de[A],C=0;C<D.length;++C){var J=D[C]&31;ps(e,f,oe[J]),f+=Q[J],J>15&&(ps(e,f,D[C]>>5&127),f+=D[C]>>12)}}else V=rb,Y=zs,E=ab,X=Ml;for(var C=0;C<l;++C){var re=n[C];if(re>255){var J=re>>18&31;al(e,f,V[J+257]),f+=Y[J+257],J>7&&(ps(e,f,re>>23&31),f+=ju[J]);var ce=re&31;al(e,f,E[ce]),f+=X[ce],ce>3&&(al(e,f,re>>5&8191),f+=Su[ce])}else al(e,f,V[re]),f+=Y[re]}return al(e,f,V[256]),f+Y[256]},lb=new Oh([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Dg=new Qn(0),cb=function(t,e,r,n,s,i){var o=i.z||t.length,l=new Qn(n+o+5*(1+Math.ceil(o/7e3))+s),u=l.subarray(n,l.length-s),d=i.l,f=(i.r||0)&7;if(e){f&&(u[0]=i.r>>3);for(var m=lb[e-1],v=m>>13,p=m&8191,b=(1<<r)-1,w=i.p||new ga(32768),y=i.h||new ga(b+1),j=Math.ceil(r/3),O=2*j,k=function(Fe){return(t[Fe]^t[Fe+1]<<j^t[Fe+2]<<O)&b},I=new Oh(25e3),H=new ga(288),F=new ga(32),U=0,C=0,N=i.i||0,Q=0,P=i.w||0,L=0;N+2<o;++N){var te=k(N),W=N&32767,z=y[te];if(w[W]=z,y[te]=W,P<=N){var V=o-N;if((U>7e3||Q>24576)&&(V>423||!d)){f=yp(t,u,0,I,H,F,C,Q,L,N-L,f),Q=U=C=0,L=N;for(var Y=0;Y<286;++Y)H[Y]=0;for(var Y=0;Y<30;++Y)F[Y]=0}var E=2,X=0,oe=p,de=W-z&32767;if(V>2&&te==k(N-de))for(var A=Math.min(v,V)-1,D=Math.min(32767,N),J=Math.min(258,V);de<=D&&--oe&&W!=z;){if(t[N+E]==t[N+E-de]){for(var re=0;re<J&&t[N+re]==t[N+re-de];++re);if(re>E){if(E=re,X=de,re>A)break;for(var ce=Math.min(de,re-2),fe=0,Y=0;Y<ce;++Y){var ee=N-de+Y&32767,ae=w[ee],pe=ee-ae&32767;pe>fe&&(fe=pe,z=ee)}}}W=z,z=w[W],de+=W-z&32767}if(X){I[Q++]=268435456|th[E]<<18|vp[X];var ye=th[E]&31,Le=vp[X]&31;C+=ju[ye]+Su[Le],++H[257+ye],++F[Le],P=N+E,++U}else I[Q++]=t[N],++H[t[N]]}}for(N=Math.max(N,P);N<o;++N)I[Q++]=t[N],++H[t[N]];f=yp(t,u,d,I,H,F,C,Q,L,N-L,f),d||(i.r=f&7|u[f/8|0]<<3,f-=7,i.h=y,i.p=w,i.i=N,i.w=P)}else{for(var N=i.w||0;N<o+d;N+=65535){var se=N+65535;se>=o&&(u[f/8|0]=d,se=o),f=Ig(u,f+1,t.subarray(N,se))}i.i=o}return Og(l,0,n+Ih(f)+s)},Tg=function(){var t=1,e=0;return{p:function(r){for(var n=t,s=e,i=r.length|0,o=0;o!=i;){for(var l=Math.min(o+2655,i);o<l;++o)s+=n+=r[o];n=(n&65535)+15*(n>>16),s=(s&65535)+15*(s>>16)}t=n,e=s},d:function(){return t%=65521,e%=65521,(t&255)<<24|(t&65280)<<8|(e&255)<<8|e>>8}}},ub=function(t,e,r,n,s){if(!s&&(s={l:1},e.dictionary)){var i=e.dictionary.subarray(-32768),o=new Qn(i.length+t.length);o.set(i),o.set(t,i.length),t=o,s.w=i.length}return cb(t,e.level==null?6:e.level,e.mem==null?s.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+e.mem,r,n,s)},Mg=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8},db=function(t,e){var r=e.level,n=r==0?0:r<6?1:r==9?3:2;if(t[0]=120,t[1]=n<<6|(e.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,e.dictionary){var s=Tg();s.p(e.dictionary),Mg(t,2,s.d())}},hb=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&Ta(6,"invalid zlib data"),(t[1]>>5&1)==1&&Ta(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function ah(t,e){e||(e={});var r=Tg();r.p(t);var n=ub(t,e,e.dictionary?6:2,4);return db(n,e),Mg(n,n.length-4,r.d()),n}function fb(t,e){return ob(t.subarray(hb(t),-4),{i:2},e,e)}var pb=typeof TextDecoder<"u"&&new TextDecoder,mb=0;try{pb.decode(Dg,{stream:!0}),mb=1}catch{}var Mt=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function bd(){Mt.console&&typeof Mt.console.log=="function"&&Mt.console.log.apply(Mt.console,arguments)}var Mr={log:bd,warn:function(t){Mt.console&&(typeof Mt.console.warn=="function"?Mt.console.warn.apply(Mt.console,arguments):bd.call(null,arguments))},error:function(t){Mt.console&&(typeof Mt.console.error=="function"?Mt.console.error.apply(Mt.console,arguments):bd(t))}};function wd(t,e,r){var n=new XMLHttpRequest;n.open("GET",t),n.responseType="blob",n.onload=function(){oi(n.response,e,r)},n.onerror=function(){Mr.error("could not download file")},n.send()}function bp(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function Pc(t){try{t.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var Pl,sh,oi=Mt.saveAs||((typeof window>"u"?"undefined":br(window))!=="object"||window!==Mt?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(t,e,r){var n=Mt.URL||Mt.webkitURL,s=document.createElement("a");e=e||t.name||"download",s.download=e,s.rel="noopener",typeof t=="string"?(s.href=t,s.origin!==location.origin?bp(s.href)?wd(t,e,r):Pc(s,s.target="_blank"):Pc(s)):(s.href=n.createObjectURL(t),setTimeout(function(){n.revokeObjectURL(s.href)},4e4),setTimeout(function(){Pc(s)},0))}:"msSaveOrOpenBlob"in navigator?function(t,e,r){if(e=e||t.name||"download",typeof t=="string")if(bp(t))wd(t,e,r);else{var n=document.createElement("a");n.href=t,n.target="_blank",setTimeout(function(){Pc(n)})}else navigator.msSaveOrOpenBlob(function(s,i){return i===void 0?i={autoBom:!1}:br(i)!=="object"&&(Mr.warn("Deprecated: Expected third argument to be a object"),i={autoBom:!i}),i.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\uFEFF",s],{type:s.type}):s}(t,r),e)}:function(t,e,r,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof t=="string")return wd(t,e,r);var s=t.type==="application/octet-stream",i=/constructor/i.test(Mt.HTMLElement)||Mt.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent);if((o||s&&i)&&(typeof FileReader>"u"?"undefined":br(FileReader))==="object"){var l=new FileReader;l.onloadend=function(){var f=l.result;f=o?f:f.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=f:location=f,n=null},l.readAsDataURL(t)}else{var u=Mt.URL||Mt.webkitURL,d=u.createObjectURL(t);n?n.location=d:location.href=d,n=null,setTimeout(function(){u.revokeObjectURL(d)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function Fg(t){var e;t=t||"",this.ok=!1,t.charAt(0)=="#"&&(t=t.substr(1,6)),t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[t=(t=t.replace(/ /g,"")).toLowerCase()]||t;for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],n=0;n<r.length;n++){var s=r[n].re,i=r[n].process,o=s.exec(t);o&&(e=i(o),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var l=this.r.toString(16),u=this.g.toString(16),d=this.b.toString(16);return l.length==1&&(l="0"+l),u.length==1&&(u="0"+u),d.length==1&&(d="0"+d),"#"+l+u+d}}/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function _d(t,e){var r=t[0],n=t[1],s=t[2],i=t[3];r=zn(r,n,s,i,e[0],7,-680876936),i=zn(i,r,n,s,e[1],12,-389564586),s=zn(s,i,r,n,e[2],17,606105819),n=zn(n,s,i,r,e[3],22,-1044525330),r=zn(r,n,s,i,e[4],7,-176418897),i=zn(i,r,n,s,e[5],12,1200080426),s=zn(s,i,r,n,e[6],17,-1473231341),n=zn(n,s,i,r,e[7],22,-45705983),r=zn(r,n,s,i,e[8],7,1770035416),i=zn(i,r,n,s,e[9],12,-1958414417),s=zn(s,i,r,n,e[10],17,-42063),n=zn(n,s,i,r,e[11],22,-1990404162),r=zn(r,n,s,i,e[12],7,1804603682),i=zn(i,r,n,s,e[13],12,-40341101),s=zn(s,i,r,n,e[14],17,-1502002290),r=$n(r,n=zn(n,s,i,r,e[15],22,1236535329),s,i,e[1],5,-165796510),i=$n(i,r,n,s,e[6],9,-1069501632),s=$n(s,i,r,n,e[11],14,643717713),n=$n(n,s,i,r,e[0],20,-373897302),r=$n(r,n,s,i,e[5],5,-701558691),i=$n(i,r,n,s,e[10],9,38016083),s=$n(s,i,r,n,e[15],14,-660478335),n=$n(n,s,i,r,e[4],20,-405537848),r=$n(r,n,s,i,e[9],5,568446438),i=$n(i,r,n,s,e[14],9,-1019803690),s=$n(s,i,r,n,e[3],14,-187363961),n=$n(n,s,i,r,e[8],20,1163531501),r=$n(r,n,s,i,e[13],5,-1444681467),i=$n(i,r,n,s,e[2],9,-51403784),s=$n(s,i,r,n,e[7],14,1735328473),r=Hn(r,n=$n(n,s,i,r,e[12],20,-1926607734),s,i,e[5],4,-378558),i=Hn(i,r,n,s,e[8],11,-2022574463),s=Hn(s,i,r,n,e[11],16,1839030562),n=Hn(n,s,i,r,e[14],23,-35309556),r=Hn(r,n,s,i,e[1],4,-1530992060),i=Hn(i,r,n,s,e[4],11,1272893353),s=Hn(s,i,r,n,e[7],16,-155497632),n=Hn(n,s,i,r,e[10],23,-1094730640),r=Hn(r,n,s,i,e[13],4,681279174),i=Hn(i,r,n,s,e[0],11,-358537222),s=Hn(s,i,r,n,e[3],16,-722521979),n=Hn(n,s,i,r,e[6],23,76029189),r=Hn(r,n,s,i,e[9],4,-640364487),i=Hn(i,r,n,s,e[12],11,-421815835),s=Hn(s,i,r,n,e[15],16,530742520),r=Yn(r,n=Hn(n,s,i,r,e[2],23,-995338651),s,i,e[0],6,-198630844),i=Yn(i,r,n,s,e[7],10,1126891415),s=Yn(s,i,r,n,e[14],15,-1416354905),n=Yn(n,s,i,r,e[5],21,-57434055),r=Yn(r,n,s,i,e[12],6,1700485571),i=Yn(i,r,n,s,e[3],10,-1894986606),s=Yn(s,i,r,n,e[10],15,-1051523),n=Yn(n,s,i,r,e[1],21,-2054922799),r=Yn(r,n,s,i,e[8],6,1873313359),i=Yn(i,r,n,s,e[15],10,-30611744),s=Yn(s,i,r,n,e[6],15,-1560198380),n=Yn(n,s,i,r,e[13],21,1309151649),r=Yn(r,n,s,i,e[4],6,-145523070),i=Yn(i,r,n,s,e[11],10,-1120210379),s=Yn(s,i,r,n,e[2],15,718787259),n=Yn(n,s,i,r,e[9],21,-343485551),t[0]=Us(r,t[0]),t[1]=Us(n,t[1]),t[2]=Us(s,t[2]),t[3]=Us(i,t[3])}function Cu(t,e,r,n,s,i){return e=Us(Us(e,t),Us(n,i)),Us(e<<s|e>>>32-s,r)}function zn(t,e,r,n,s,i,o){return Cu(e&r|~e&n,t,e,s,i,o)}function $n(t,e,r,n,s,i,o){return Cu(e&n|r&~n,t,e,s,i,o)}function Hn(t,e,r,n,s,i,o){return Cu(e^r^n,t,e,s,i,o)}function Yn(t,e,r,n,s,i,o){return Cu(r^(e|~n),t,e,s,i,o)}function Rg(t){var e,r=t.length,n=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=t.length;e+=64)_d(n,gb(t.substring(e-64,e)));t=t.substring(e-64);var s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<t.length;e++)s[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(s[e>>2]|=128<<(e%4<<3),e>55)for(_d(n,s),e=0;e<16;e++)s[e]=0;return s[14]=8*r,_d(n,s),n}function gb(t){var e,r=[];for(e=0;e<64;e+=4)r[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return r}Pl=Mt.atob.bind(Mt),sh=Mt.btoa.bind(Mt);var wp="0123456789abcdef".split("");function vb(t){for(var e="",r=0;r<4;r++)e+=wp[t>>8*r+4&15]+wp[t>>8*r&15];return e}function xb(t){return String.fromCharCode((255&t)>>0,(65280&t)>>8,(16711680&t)>>16,(4278190080&t)>>24)}function ih(t){return Rg(t).map(xb).join("")}var yb=function(t){for(var e=0;e<t.length;e++)t[e]=vb(t[e]);return t.join("")}(Rg("hello"))!="5d41402abc4b2a76b9719d911017c592";function Us(t,e){if(yb){var r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}return t+e&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function oh(t,e){var r,n,s,i;if(t!==r){for(var o=(s=t,i=1+(256/t.length>>0),new Array(i+1).join(s)),l=[],u=0;u<256;u++)l[u]=u;var d=0;for(u=0;u<256;u++){var f=l[u];d=(d+f+o.charCodeAt(u))%256,l[u]=l[d],l[d]=f}r=t,n=l}else l=n;var m=e.length,v=0,p=0,b="";for(u=0;u<m;u++)p=(p+(f=l[v=(v+1)%256]))%256,l[v]=l[p],l[p]=f,o=l[(l[v]+l[p])%256],b+=String.fromCharCode(e.charCodeAt(u)^o);return b}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var _p={print:4,modify:8,copy:16,"annot-forms":32};function Qi(t,e,r,n){this.v=1,this.r=2;var s=192;t.forEach(function(l){if(_p.perm!==void 0)throw new Error("Invalid permission: "+l);s+=_p[l]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var i=(e+this.padding).substr(0,32),o=(r+this.padding).substr(0,32);this.O=this.processOwnerPassword(i,o),this.P=-(1+(255^s)),this.encryptionKey=ih(i+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=oh(this.encryptionKey,this.padding)}function Ji(t){if(/[^\u0000-\u00ff]/.test(t))throw new Error("Invalid PDF Name Object: "+t+", Only accept ASCII characters.");for(var e="",r=t.length,n=0;n<r;n++){var s=t.charCodeAt(n);s<33||s===35||s===37||s===40||s===41||s===47||s===60||s===62||s===91||s===93||s===123||s===125||s>126?e+="#"+("0"+s.toString(16)).slice(-2):e+=t[n]}return e}function jp(t){if(br(t)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(r,n,s){if(s=s||!1,typeof r!="string"||typeof n!="function"||typeof s!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(r)||(e[r]={});var i=Math.random().toString(35);return e[r][i]=[n,!!s],i},this.unsubscribe=function(r){for(var n in e)if(e[n][r])return delete e[n][r],Object.keys(e[n]).length===0&&delete e[n],!0;return!1},this.publish=function(r){if(e.hasOwnProperty(r)){var n=Array.prototype.slice.call(arguments,1),s=[];for(var i in e[r]){var o=e[r][i];try{o[0].apply(t,n)}catch(l){Mt.console&&Mr.error("jsPDF PubSub Error",l.message,l)}o[1]&&s.push(i)}s.length&&s.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function ru(t){if(!(this instanceof ru))return new ru(t);var e="opacity,stroke-opacity".split(",");for(var r in t)t.hasOwnProperty(r)&&e.indexOf(r)>=0&&(this[r]=t[r]);this.id="",this.objectNumber=-1}function qg(t,e){this.gState=t,this.matrix=e,this.id="",this.objectNumber=-1}function ci(t,e,r,n,s){if(!(this instanceof ci))return new ci(t,e,r,n,s);this.type=t==="axial"?2:3,this.coords=e,this.colors=r,qg.call(this,n,s)}function Ki(t,e,r,n,s){if(!(this instanceof Ki))return new Ki(t,e,r,n,s);this.boundingBox=t,this.xStep=e,this.yStep=r,this.stream="",this.cloneIndex=0,qg.call(this,n,s)}function Tt(t){var e,r=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],s=arguments[2],i=arguments[3],o=[],l=1,u=16,d="S",f=null;br(t=t||{})==="object"&&(r=t.orientation,n=t.unit||n,s=t.format||s,i=t.compress||t.compressPdf||i,(f=t.encryption||null)!==null&&(f.userPassword=f.userPassword||"",f.ownerPassword=f.ownerPassword||"",f.userPermissions=f.userPermissions||[]),l=typeof t.userUnit=="number"?Math.abs(t.userUnit):1,t.precision!==void 0&&(e=t.precision),t.floatPrecision!==void 0&&(u=t.floatPrecision),d=t.defaultPathOperation||"S"),o=t.filters||(i===!0?["FlateEncode"]:o),n=n||"mm",r=(""+(r||"P")).toLowerCase();var m=t.putOnlyUsedFonts||!1,v={},p={internal:{},__private__:{}};p.__private__.PubSub=jp;var b="1.3",w=p.__private__.getPdfVersion=function(){return b};p.__private__.setPdfVersion=function(g){b=g};var y={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};p.__private__.getPageFormats=function(){return y};var j=p.__private__.getPageFormat=function(g){return y[g]};s=s||"a4";var O={COMPAT:"compat",ADVANCED:"advanced"},k=O.COMPAT;function I(){this.saveGraphicsState(),R(new Nt(ct,0,0,-ct,0,js()*ct).toString()+" cm"),this.setFontSize(this.getFontSize()/ct),d="n",k=O.ADVANCED}function H(){this.restoreGraphicsState(),d="S",k=O.COMPAT}var F=p.__private__.combineFontStyleAndFontWeight=function(g,M){if(g=="bold"&&M=="normal"||g=="bold"&&M==400||g=="normal"&&M=="italic"||g=="bold"&&M=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return M&&(g=M==400||M==="normal"?g==="italic"?"italic":"normal":M!=700&&M!=="bold"||g!=="normal"?(M==700?"bold":M)+""+g:"bold"),g};p.advancedAPI=function(g){var M=k===O.COMPAT;return M&&I.call(this),typeof g!="function"||(g(this),M&&H.call(this)),this},p.compatAPI=function(g){var M=k===O.ADVANCED;return M&&H.call(this),typeof g!="function"||(g(this),M&&I.call(this)),this},p.isAdvancedAPI=function(){return k===O.ADVANCED};var U,C=function(g){if(k!==O.ADVANCED)throw new Error(g+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},N=p.roundToPrecision=p.__private__.roundToPrecision=function(g,M){var le=e||M;if(isNaN(g)||isNaN(le))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return g.toFixed(le).replace(/0+$/,"")};U=p.hpf=p.__private__.hpf=typeof u=="number"?function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.hpf");return N(g,u)}:u==="smart"?function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.hpf");return N(g,g>-1&&g<1?16:5)}:function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.hpf");return N(g,16)};var Q=p.f2=p.__private__.f2=function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.f2");return N(g,2)},P=p.__private__.f3=function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.f3");return N(g,3)},L=p.scale=p.__private__.scale=function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.scale");return k===O.COMPAT?g*ct:k===O.ADVANCED?g:void 0},te=function(g){return k===O.COMPAT?js()-g:k===O.ADVANCED?g:void 0},W=function(g){return L(te(g))};p.__private__.setPrecision=p.setPrecision=function(g){typeof parseInt(g,10)=="number"&&(e=parseInt(g,10))};var z,V="00000000000000000000000000000000",Y=p.__private__.getFileId=function(){return V},E=p.__private__.setFileId=function(g){return V=g!==void 0&&/^[a-fA-F0-9]{32}$/.test(g)?g.toUpperCase():V.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),f!==null&&(Un=new Qi(f.userPermissions,f.userPassword,f.ownerPassword,V)),V};p.setFileId=function(g){return E(g),this},p.getFileId=function(){return Y()};var X=p.__private__.convertDateToPDFDate=function(g){var M=g.getTimezoneOffset(),le=M<0?"+":"-",ge=Math.floor(Math.abs(M/60)),Ee=Math.abs(M%60),Ge=[le,J(ge),"'",J(Ee),"'"].join("");return["D:",g.getFullYear(),J(g.getMonth()+1),J(g.getDate()),J(g.getHours()),J(g.getMinutes()),J(g.getSeconds()),Ge].join("")},oe=p.__private__.convertPDFDateToDate=function(g){var M=parseInt(g.substr(2,4),10),le=parseInt(g.substr(6,2),10)-1,ge=parseInt(g.substr(8,2),10),Ee=parseInt(g.substr(10,2),10),Ge=parseInt(g.substr(12,2),10),lt=parseInt(g.substr(14,2),10);return new Date(M,le,ge,Ee,Ge,lt,0)},de=p.__private__.setCreationDate=function(g){var M;if(g===void 0&&(g=new Date),g instanceof Date)M=X(g);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(g))throw new Error("Invalid argument passed to jsPDF.setCreationDate");M=g}return z=M},A=p.__private__.getCreationDate=function(g){var M=z;return g==="jsDate"&&(M=oe(z)),M};p.setCreationDate=function(g){return de(g),this},p.getCreationDate=function(g){return A(g)};var D,J=p.__private__.padd2=function(g){return("0"+parseInt(g)).slice(-2)},re=p.__private__.padd2Hex=function(g){return("00"+(g=g.toString())).substr(g.length)},ce=0,fe=[],ee=[],ae=0,pe=[],ye=[],Le=!1,se=ee,Fe=function(){ce=0,ae=0,ee=[],fe=[],pe=[],ur=Ke(),kr=Ke()};p.__private__.setCustomOutputDestination=function(g){Le=!0,se=g};var ne=function(g){Le||(se=g)};p.__private__.resetCustomOutputDestination=function(){Le=!1,se=ee};var R=p.__private__.out=function(g){return g=g.toString(),ae+=g.length+1,se.push(g),se},be=p.__private__.write=function(g){return R(arguments.length===1?g.toString():Array.prototype.join.call(arguments," "))},je=p.__private__.getArrayBuffer=function(g){for(var M=g.length,le=new ArrayBuffer(M),ge=new Uint8Array(le);M--;)ge[M]=g.charCodeAt(M);return le},Pe=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];p.__private__.getStandardFonts=function(){return Pe};var He=t.fontSize||16;p.__private__.setFontSize=p.setFontSize=function(g){return He=k===O.ADVANCED?g/ct:g,this};var Ye,nt=p.__private__.getFontSize=p.getFontSize=function(){return k===O.COMPAT?He:He*ct},dt=t.R2L||!1;p.__private__.setR2L=p.setR2L=function(g){return dt=g,this},p.__private__.getR2L=p.getR2L=function(){return dt};var Ae,Re=p.__private__.setZoomMode=function(g){var M=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(g))Ye=g;else if(isNaN(g)){if(M.indexOf(g)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+g+'" is not recognized.');Ye=g}else Ye=parseInt(g,10)};p.__private__.getZoomMode=function(){return Ye};var st,it=p.__private__.setPageMode=function(g){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(g)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+g+'" is not recognized.');Ae=g};p.__private__.getPageMode=function(){return Ae};var Lt=p.__private__.setLayoutMode=function(g){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(g)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+g+'" is not recognized.');st=g};p.__private__.getLayoutMode=function(){return st},p.__private__.setDisplayMode=p.setDisplayMode=function(g,M,le){return Re(g),Lt(M),it(le),this};var gt={title:"",subject:"",author:"",keywords:"",creator:""};p.__private__.getDocumentProperty=function(g){if(Object.keys(gt).indexOf(g)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return gt[g]},p.__private__.getDocumentProperties=function(){return gt},p.__private__.setDocumentProperties=p.setProperties=p.setDocumentProperties=function(g){for(var M in gt)gt.hasOwnProperty(M)&&g[M]&&(gt[M]=g[M]);return this},p.__private__.setDocumentProperty=function(g,M){if(Object.keys(gt).indexOf(g)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return gt[g]=M};var St,ct,Rt,xt,Rr,tr={},rr={},Pn=[],Bt={},Xr={},sr={},Zr={},xn=null,_r=0,Pt=[],Kt=new jp(p),Ln=t.hotfixes||[],ir={},Hr={},Nn=[],Nt=function g(M,le,ge,Ee,Ge,lt){if(!(this instanceof g))return new g(M,le,ge,Ee,Ge,lt);isNaN(M)&&(M=1),isNaN(le)&&(le=0),isNaN(ge)&&(ge=0),isNaN(Ee)&&(Ee=1),isNaN(Ge)&&(Ge=0),isNaN(lt)&&(lt=0),this._matrix=[M,le,ge,Ee,Ge,lt]};Object.defineProperty(Nt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(g){this._matrix[0]=g}}),Object.defineProperty(Nt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(g){this._matrix[1]=g}}),Object.defineProperty(Nt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(g){this._matrix[2]=g}}),Object.defineProperty(Nt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(g){this._matrix[3]=g}}),Object.defineProperty(Nt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(g){this._matrix[4]=g}}),Object.defineProperty(Nt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(g){this._matrix[5]=g}}),Object.defineProperty(Nt.prototype,"a",{get:function(){return this._matrix[0]},set:function(g){this._matrix[0]=g}}),Object.defineProperty(Nt.prototype,"b",{get:function(){return this._matrix[1]},set:function(g){this._matrix[1]=g}}),Object.defineProperty(Nt.prototype,"c",{get:function(){return this._matrix[2]},set:function(g){this._matrix[2]=g}}),Object.defineProperty(Nt.prototype,"d",{get:function(){return this._matrix[3]},set:function(g){this._matrix[3]=g}}),Object.defineProperty(Nt.prototype,"e",{get:function(){return this._matrix[4]},set:function(g){this._matrix[4]=g}}),Object.defineProperty(Nt.prototype,"f",{get:function(){return this._matrix[5]},set:function(g){this._matrix[5]=g}}),Object.defineProperty(Nt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Nt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Nt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Nt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Nt.prototype.join=function(g){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(U).join(g)},Nt.prototype.multiply=function(g){var M=g.sx*this.sx+g.shy*this.shx,le=g.sx*this.shy+g.shy*this.sy,ge=g.shx*this.sx+g.sy*this.shx,Ee=g.shx*this.shy+g.sy*this.sy,Ge=g.tx*this.sx+g.ty*this.shx+this.tx,lt=g.tx*this.shy+g.ty*this.sy+this.ty;return new Nt(M,le,ge,Ee,Ge,lt)},Nt.prototype.decompose=function(){var g=this.sx,M=this.shy,le=this.shx,ge=this.sy,Ee=this.tx,Ge=this.ty,lt=Math.sqrt(g*g+M*M),yt=(g/=lt)*le+(M/=lt)*ge;le-=g*yt,ge-=M*yt;var It=Math.sqrt(le*le+ge*ge);return yt/=It,g*(ge/=It)<M*(le/=It)&&(g=-g,M=-M,yt=-yt,lt=-lt),{scale:new Nt(lt,0,0,It,0,0),translate:new Nt(1,0,0,1,Ee,Ge),rotate:new Nt(g,M,-M,g,0,0),skew:new Nt(1,0,yt,1,0,0)}},Nt.prototype.toString=function(g){return this.join(" ")},Nt.prototype.inversed=function(){var g=this.sx,M=this.shy,le=this.shx,ge=this.sy,Ee=this.tx,Ge=this.ty,lt=1/(g*ge-M*le),yt=ge*lt,It=-M*lt,Yt=-le*lt,Wt=g*lt;return new Nt(yt,It,Yt,Wt,-yt*Ee-Yt*Ge,-It*Ee-Wt*Ge)},Nt.prototype.applyToPoint=function(g){var M=g.x*this.sx+g.y*this.shx+this.tx,le=g.x*this.shy+g.y*this.sy+this.ty;return new Li(M,le)},Nt.prototype.applyToRectangle=function(g){var M=this.applyToPoint(g),le=this.applyToPoint(new Li(g.x+g.w,g.y+g.h));return new Lo(M.x,M.y,le.x-M.x,le.y-M.y)},Nt.prototype.clone=function(){var g=this.sx,M=this.shy,le=this.shx,ge=this.sy,Ee=this.tx,Ge=this.ty;return new Nt(g,M,le,ge,Ee,Ge)},p.Matrix=Nt;var kn=p.matrixMult=function(g,M){return M.multiply(g)},Ne=new Nt(1,0,0,1,0,0);p.unitMatrix=p.identityMatrix=Ne;var Be=function(g,M){if(!Xr[g]){var le=(M instanceof ci?"Sh":"P")+(Object.keys(Bt).length+1).toString(10);M.id=le,Xr[g]=le,Bt[le]=M,Kt.publish("addPattern",M)}};p.ShadingPattern=ci,p.TilingPattern=Ki,p.addShadingPattern=function(g,M){return C("addShadingPattern()"),Be(g,M),this},p.beginTilingPattern=function(g){C("beginTilingPattern()"),Xl(g.boundingBox[0],g.boundingBox[1],g.boundingBox[2]-g.boundingBox[0],g.boundingBox[3]-g.boundingBox[1],g.matrix)},p.endTilingPattern=function(g,M){C("endTilingPattern()"),M.stream=ye[D].join(`
`),Be(g,M),Kt.publish("endTilingPattern",M),Nn.pop().restore()};var Ve=p.__private__.newObject=function(){var g=Ke();return $t(g,!0),g},Ke=p.__private__.newObjectDeferred=function(){return ce++,fe[ce]=function(){return ae},ce},$t=function(g,M){return M=typeof M=="boolean"&&M,fe[g]=ae,M&&R(g+" 0 obj"),g},kt=p.__private__.newAdditionalObject=function(){var g={objId:Ke(),content:""};return pe.push(g),g},ur=Ke(),kr=Ke(),ln=p.__private__.decodeColorString=function(g){var M=g.split(" ");if(M.length!==2||M[1]!=="g"&&M[1]!=="G")M.length===5&&(M[4]==="k"||M[4]==="K")&&(M=[(1-M[0])*(1-M[3]),(1-M[1])*(1-M[3]),(1-M[2])*(1-M[3]),"r"]);else{var le=parseFloat(M[0]);M=[le,le,le,"r"]}for(var ge="#",Ee=0;Ee<3;Ee++)ge+=("0"+Math.floor(255*parseFloat(M[Ee])).toString(16)).slice(-2);return ge},$e=p.__private__.encodeColorString=function(g){var M;typeof g=="string"&&(g={ch1:g});var le=g.ch1,ge=g.ch2,Ee=g.ch3,Ge=g.ch4,lt=g.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof le=="string"&&le.charAt(0)!=="#"){var yt=new Fg(le);if(yt.ok)le=yt.toHex();else if(!/^\d*\.?\d*$/.test(le))throw new Error('Invalid color "'+le+'" passed to jsPDF.encodeColorString.')}if(typeof le=="string"&&/^#[0-9A-Fa-f]{3}$/.test(le)&&(le="#"+le[1]+le[1]+le[2]+le[2]+le[3]+le[3]),typeof le=="string"&&/^#[0-9A-Fa-f]{6}$/.test(le)){var It=parseInt(le.substr(1),16);le=It>>16&255,ge=It>>8&255,Ee=255&It}if(ge===void 0||Ge===void 0&&le===ge&&ge===Ee)if(typeof le=="string")M=le+" "+lt[0];else switch(g.precision){case 2:M=Q(le/255)+" "+lt[0];break;case 3:default:M=P(le/255)+" "+lt[0]}else if(Ge===void 0||br(Ge)==="object"){if(Ge&&!isNaN(Ge.a)&&Ge.a===0)return M=["1.","1.","1.",lt[1]].join(" ");if(typeof le=="string")M=[le,ge,Ee,lt[1]].join(" ");else switch(g.precision){case 2:M=[Q(le/255),Q(ge/255),Q(Ee/255),lt[1]].join(" ");break;default:case 3:M=[P(le/255),P(ge/255),P(Ee/255),lt[1]].join(" ")}}else if(typeof le=="string")M=[le,ge,Ee,Ge,lt[2]].join(" ");else switch(g.precision){case 2:M=[Q(le),Q(ge),Q(Ee),Q(Ge),lt[2]].join(" ");break;case 3:default:M=[P(le),P(ge),P(Ee),P(Ge),lt[2]].join(" ")}return M},ze=p.__private__.getFilters=function(){return o},ut=p.__private__.putStream=function(g){var M=(g=g||{}).data||"",le=g.filters||ze(),ge=g.alreadyAppliedFilters||[],Ee=g.addLength1||!1,Ge=M.length,lt=g.objectId,yt=function(Wn){return Wn};if(f!==null&&lt===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");f!==null&&(yt=Un.encryptor(lt,0));var It={};le===!0&&(le=["FlateEncode"]);var Yt=g.additionalKeyValues||[],Wt=(It=Tt.API.processDataByFilters!==void 0?Tt.API.processDataByFilters(M,le):{data:M,reverseChain:[]}).reverseChain+(Array.isArray(ge)?ge.join(" "):ge.toString());if(It.data.length!==0&&(Yt.push({key:"Length",value:It.data.length}),Ee===!0&&Yt.push({key:"Length1",value:Ge})),Wt.length!=0)if(Wt.split("/").length-1==1)Yt.push({key:"Filter",value:Wt});else{Yt.push({key:"Filter",value:"["+Wt+"]"});for(var hr=0;hr<Yt.length;hr+=1)if(Yt[hr].key==="DecodeParms"){for(var Qr=[],en=0;en<It.reverseChain.split("/").length-1;en+=1)Qr.push("null");Qr.push(Yt[hr].value),Yt[hr].value="["+Qr.join(" ")+"]"}}R("<<");for(var yn=0;yn<Yt.length;yn++)R("/"+Yt[yn].key+" "+Yt[yn].value);R(">>"),It.data.length!==0&&(R("stream"),R(yt(It.data)),R("endstream"))},qt=p.__private__.putPage=function(g){var M=g.number,le=g.data,ge=g.objId,Ee=g.contentsObjId;$t(ge,!0),R("<</Type /Page"),R("/Parent "+g.rootDictionaryObjId+" 0 R"),R("/Resources "+g.resourceDictionaryObjId+" 0 R"),R("/MediaBox ["+parseFloat(U(g.mediaBox.bottomLeftX))+" "+parseFloat(U(g.mediaBox.bottomLeftY))+" "+U(g.mediaBox.topRightX)+" "+U(g.mediaBox.topRightY)+"]"),g.cropBox!==null&&R("/CropBox ["+U(g.cropBox.bottomLeftX)+" "+U(g.cropBox.bottomLeftY)+" "+U(g.cropBox.topRightX)+" "+U(g.cropBox.topRightY)+"]"),g.bleedBox!==null&&R("/BleedBox ["+U(g.bleedBox.bottomLeftX)+" "+U(g.bleedBox.bottomLeftY)+" "+U(g.bleedBox.topRightX)+" "+U(g.bleedBox.topRightY)+"]"),g.trimBox!==null&&R("/TrimBox ["+U(g.trimBox.bottomLeftX)+" "+U(g.trimBox.bottomLeftY)+" "+U(g.trimBox.topRightX)+" "+U(g.trimBox.topRightY)+"]"),g.artBox!==null&&R("/ArtBox ["+U(g.artBox.bottomLeftX)+" "+U(g.artBox.bottomLeftY)+" "+U(g.artBox.topRightX)+" "+U(g.artBox.topRightY)+"]"),typeof g.userUnit=="number"&&g.userUnit!==1&&R("/UserUnit "+g.userUnit),Kt.publish("putPage",{objId:ge,pageContext:Pt[M],pageNumber:M,page:le}),R("/Contents "+Ee+" 0 R"),R(">>"),R("endobj");var Ge=le.join(`
`);return k===O.ADVANCED&&(Ge+=`
Q`),$t(Ee,!0),ut({data:Ge,filters:ze(),objectId:Ee}),R("endobj"),ge},qr=p.__private__.putPages=function(){var g,M,le=[];for(g=1;g<=_r;g++)Pt[g].objId=Ke(),Pt[g].contentsObjId=Ke();for(g=1;g<=_r;g++)le.push(qt({number:g,data:ye[g],objId:Pt[g].objId,contentsObjId:Pt[g].contentsObjId,mediaBox:Pt[g].mediaBox,cropBox:Pt[g].cropBox,bleedBox:Pt[g].bleedBox,trimBox:Pt[g].trimBox,artBox:Pt[g].artBox,userUnit:Pt[g].userUnit,rootDictionaryObjId:ur,resourceDictionaryObjId:kr}));$t(ur,!0),R("<</Type /Pages");var ge="/Kids [";for(M=0;M<_r;M++)ge+=le[M]+" 0 R ";R(ge+"]"),R("/Count "+_r),R(">>"),R("endobj"),Kt.publish("postPutPages")},Me=function(g){Kt.publish("putFont",{font:g,out:R,newObject:Ve,putStream:ut}),g.isAlreadyPutted!==!0&&(g.objectNumber=Ve(),R("<<"),R("/Type /Font"),R("/BaseFont /"+Ji(g.postScriptName)),R("/Subtype /Type1"),typeof g.encoding=="string"&&R("/Encoding /"+g.encoding),R("/FirstChar 32"),R("/LastChar 255"),R(">>"),R("endobj"))},Ue=function(){for(var g in tr)tr.hasOwnProperty(g)&&(m===!1||m===!0&&v.hasOwnProperty(g))&&Me(tr[g])},rt=function(g){g.objectNumber=Ve();var M=[];M.push({key:"Type",value:"/XObject"}),M.push({key:"Subtype",value:"/Form"}),M.push({key:"BBox",value:"["+[U(g.x),U(g.y),U(g.x+g.width),U(g.y+g.height)].join(" ")+"]"}),M.push({key:"Matrix",value:"["+g.matrix.toString()+"]"});var le=g.pages[1].join(`
`);ut({data:le,additionalKeyValues:M,objectId:g.objectNumber}),R("endobj")},Je=function(){for(var g in ir)ir.hasOwnProperty(g)&&rt(ir[g])},Ot=function(g,M){var le,ge=[],Ee=1/(M-1);for(le=0;le<1;le+=Ee)ge.push(le);if(ge.push(1),g[0].offset!=0){var Ge={offset:0,color:g[0].color};g.unshift(Ge)}if(g[g.length-1].offset!=1){var lt={offset:1,color:g[g.length-1].color};g.push(lt)}for(var yt="",It=0,Yt=0;Yt<ge.length;Yt++){for(le=ge[Yt];le>g[It+1].offset;)It++;var Wt=g[It].offset,hr=(le-Wt)/(g[It+1].offset-Wt),Qr=g[It].color,en=g[It+1].color;yt+=re(Math.round((1-hr)*Qr[0]+hr*en[0]).toString(16))+re(Math.round((1-hr)*Qr[1]+hr*en[1]).toString(16))+re(Math.round((1-hr)*Qr[2]+hr*en[2]).toString(16))}return yt.trim()},Ht=function(g,M){M||(M=21);var le=Ve(),ge=Ot(g.colors,M),Ee=[];Ee.push({key:"FunctionType",value:"0"}),Ee.push({key:"Domain",value:"[0.0 1.0]"}),Ee.push({key:"Size",value:"["+M+"]"}),Ee.push({key:"BitsPerSample",value:"8"}),Ee.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Ee.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),ut({data:ge,additionalKeyValues:Ee,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:le}),R("endobj"),g.objectNumber=Ve(),R("<< /ShadingType "+g.type),R("/ColorSpace /DeviceRGB");var Ge="/Coords ["+U(parseFloat(g.coords[0]))+" "+U(parseFloat(g.coords[1]))+" ";g.type===2?Ge+=U(parseFloat(g.coords[2]))+" "+U(parseFloat(g.coords[3])):Ge+=U(parseFloat(g.coords[2]))+" "+U(parseFloat(g.coords[3]))+" "+U(parseFloat(g.coords[4]))+" "+U(parseFloat(g.coords[5])),R(Ge+="]"),g.matrix&&R("/Matrix ["+g.matrix.toString()+"]"),R("/Function "+le+" 0 R"),R("/Extend [true true]"),R(">>"),R("endobj")},Gr=function(g,M){var le=Ke(),ge=Ve();M.push({resourcesOid:le,objectOid:ge}),g.objectNumber=ge;var Ee=[];Ee.push({key:"Type",value:"/Pattern"}),Ee.push({key:"PatternType",value:"1"}),Ee.push({key:"PaintType",value:"1"}),Ee.push({key:"TilingType",value:"1"}),Ee.push({key:"BBox",value:"["+g.boundingBox.map(U).join(" ")+"]"}),Ee.push({key:"XStep",value:U(g.xStep)}),Ee.push({key:"YStep",value:U(g.yStep)}),Ee.push({key:"Resources",value:le+" 0 R"}),g.matrix&&Ee.push({key:"Matrix",value:"["+g.matrix.toString()+"]"}),ut({data:g.stream,additionalKeyValues:Ee,objectId:g.objectNumber}),R("endobj")},dr=function(g){var M;for(M in Bt)Bt.hasOwnProperty(M)&&(Bt[M]instanceof ci?Ht(Bt[M]):Bt[M]instanceof Ki&&Gr(Bt[M],g))},En=function(g){for(var M in g.objectNumber=Ve(),R("<<"),g)switch(M){case"opacity":R("/ca "+Q(g[M]));break;case"stroke-opacity":R("/CA "+Q(g[M]))}R(">>"),R("endobj")},Gs=function(){var g;for(g in sr)sr.hasOwnProperty(g)&&En(sr[g])},Qs=function(){for(var g in R("/XObject <<"),ir)ir.hasOwnProperty(g)&&ir[g].objectNumber>=0&&R("/"+g+" "+ir[g].objectNumber+" 0 R");Kt.publish("putXobjectDict"),R(">>")},bo=function(){Un.oid=Ve(),R("<<"),R("/Filter /Standard"),R("/V "+Un.v),R("/R "+Un.r),R("/U <"+Un.toHexString(Un.U)+">"),R("/O <"+Un.toHexString(Un.O)+">"),R("/P "+Un.P),R(">>"),R("endobj")},ji=function(){for(var g in R("/Font <<"),tr)tr.hasOwnProperty(g)&&(m===!1||m===!0&&v.hasOwnProperty(g))&&R("/"+g+" "+tr[g].objectNumber+" 0 R");R(">>")},ss=function(){if(Object.keys(Bt).length>0){for(var g in R("/Shading <<"),Bt)Bt.hasOwnProperty(g)&&Bt[g]instanceof ci&&Bt[g].objectNumber>=0&&R("/"+g+" "+Bt[g].objectNumber+" 0 R");Kt.publish("putShadingPatternDict"),R(">>")}},ys=function(g){if(Object.keys(Bt).length>0){for(var M in R("/Pattern <<"),Bt)Bt.hasOwnProperty(M)&&Bt[M]instanceof p.TilingPattern&&Bt[M].objectNumber>=0&&Bt[M].objectNumber<g&&R("/"+M+" "+Bt[M].objectNumber+" 0 R");Kt.publish("putTilingPatternDict"),R(">>")}},wo=function(){if(Object.keys(sr).length>0){var g;for(g in R("/ExtGState <<"),sr)sr.hasOwnProperty(g)&&sr[g].objectNumber>=0&&R("/"+g+" "+sr[g].objectNumber+" 0 R");Kt.publish("putGStateDict"),R(">>")}},me=function(g){$t(g.resourcesOid,!0),R("<<"),R("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),ji(),ss(),ys(g.objectOid),wo(),Qs(),R(">>"),R("endobj")},he=function(){var g=[];Ue(),Gs(),Je(),dr(g),Kt.publish("putResources"),g.forEach(me),me({resourcesOid:kr,objectOid:Number.MAX_SAFE_INTEGER}),Kt.publish("postPutResources")},Te=function(){Kt.publish("putAdditionalObjects");for(var g=0;g<pe.length;g++){var M=pe[g];$t(M.objId,!0),R(M.content),R("endobj")}Kt.publish("postPutAdditionalObjects")},Xe=function(g){rr[g.fontName]=rr[g.fontName]||{},rr[g.fontName][g.fontStyle]=g.id},ht=function(g,M,le,ge,Ee){var Ge={id:"F"+(Object.keys(tr).length+1).toString(10),postScriptName:g,fontName:M,fontStyle:le,encoding:ge,isStandardFont:Ee||!1,metadata:{}};return Kt.publish("addFont",{font:Ge,instance:this}),tr[Ge.id]=Ge,Xe(Ge),Ge.id},Et=function(g){for(var M=0,le=Pe.length;M<le;M++){var ge=ht.call(this,g[M][0],g[M][1],g[M][2],Pe[M][3],!0);m===!1&&(v[ge]=!0);var Ee=g[M][0].split("-");Xe({id:ge,fontName:Ee[0],fontStyle:Ee[1]||""})}Kt.publish("addFonts",{fonts:tr,dictionary:rr})},Qt=function(g){return g.foo=function(){try{return g.apply(this,arguments)}catch(ge){var M=ge.stack||"";~M.indexOf(" at ")&&(M=M.split(" at ")[1]);var le="Error in function "+M.split(`
`)[0].split("<")[0]+": "+ge.message;if(!Mt.console)throw new Error(le);Mt.console.error(le,ge),Mt.alert&&alert(le)}},g.foo.bar=g,g.foo},xr=function(g,M){var le,ge,Ee,Ge,lt,yt,It,Yt,Wt;if(Ee=(M=M||{}).sourceEncoding||"Unicode",lt=M.outputEncoding,(M.autoencode||lt)&&tr[St].metadata&&tr[St].metadata[Ee]&&tr[St].metadata[Ee].encoding&&(Ge=tr[St].metadata[Ee].encoding,!lt&&tr[St].encoding&&(lt=tr[St].encoding),!lt&&Ge.codePages&&(lt=Ge.codePages[0]),typeof lt=="string"&&(lt=Ge[lt]),lt)){for(It=!1,yt=[],le=0,ge=g.length;le<ge;le++)(Yt=lt[g.charCodeAt(le)])?yt.push(String.fromCharCode(Yt)):yt.push(g[le]),yt[le].charCodeAt(0)>>8&&(It=!0);g=yt.join("")}for(le=g.length;It===void 0&&le!==0;)g.charCodeAt(le-1)>>8&&(It=!0),le--;if(!It)return g;for(yt=M.noBOM?[]:[254,255],le=0,ge=g.length;le<ge;le++){if((Wt=(Yt=g.charCodeAt(le))>>8)>>8)throw new Error("Character at position "+le+" of string '"+g+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");yt.push(Wt),yt.push(Yt-(Wt<<8))}return String.fromCharCode.apply(void 0,yt)},Er=p.__private__.pdfEscape=p.pdfEscape=function(g,M){return xr(g,M).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Mn=p.__private__.beginPage=function(g){ye[++_r]=[],Pt[_r]={objId:0,contentsObjId:0,userUnit:Number(l),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(g[0]),topRightY:Number(g[1])}},Ua(_r),ne(ye[D])},Br=function(g,M){var le,ge,Ee;switch(r=M||r,typeof g=="string"&&(le=j(g.toLowerCase()),Array.isArray(le)&&(ge=le[0],Ee=le[1])),Array.isArray(g)&&(ge=g[0]*ct,Ee=g[1]*ct),isNaN(ge)&&(ge=s[0],Ee=s[1]),(ge>14400||Ee>14400)&&(Mr.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),ge=Math.min(14400,ge),Ee=Math.min(14400,Ee)),s=[ge,Ee],r.substr(0,1)){case"l":Ee>ge&&(s=[Ee,ge]);break;case"p":ge>Ee&&(s=[Ee,ge])}Mn(s),Vl(Co),R(La),ko!==0&&R(ko+" J"),Ao!==0&&R(Ao+" j"),Kt.publish("addPage",{pageNumber:_r})},Ba=function(g){g>0&&g<=_r&&(ye.splice(g,1),Pt.splice(g,1),_r--,D>_r&&(D=_r),this.setPage(D))},Ua=function(g){g>0&&g<=_r&&(D=g)},_o=p.__private__.getNumberOfPages=p.getNumberOfPages=function(){return ye.length-1},Si=function(g,M,le){var ge,Ee=void 0;return le=le||{},g=g!==void 0?g:tr[St].fontName,M=M!==void 0?M:tr[St].fontStyle,ge=g.toLowerCase(),rr[ge]!==void 0&&rr[ge][M]!==void 0?Ee=rr[ge][M]:rr[g]!==void 0&&rr[g][M]!==void 0?Ee=rr[g][M]:le.disableWarning===!1&&Mr.warn("Unable to look up font label for font '"+g+"', '"+M+"'. Refer to getFontList() for available fonts."),Ee||le.noFallback||(Ee=rr.times[M])==null&&(Ee=rr.times.normal),Ee},at=p.__private__.putInfo=function(){var g=Ve(),M=function(ge){return ge};for(var le in f!==null&&(M=Un.encryptor(g,0)),R("<<"),R("/Producer ("+Er(M("jsPDF "+Tt.version))+")"),gt)gt.hasOwnProperty(le)&&gt[le]&&R("/"+le.substr(0,1).toUpperCase()+le.substr(1)+" ("+Er(M(gt[le]))+")");R("/CreationDate ("+Er(M(z))+")"),R(">>"),R("endobj")},Ft=p.__private__.putCatalog=function(g){var M=(g=g||{}).rootDictionaryObjId||ur;switch(Ve(),R("<<"),R("/Type /Catalog"),R("/Pages "+M+" 0 R"),Ye||(Ye="fullwidth"),Ye){case"fullwidth":R("/OpenAction [3 0 R /FitH null]");break;case"fullheight":R("/OpenAction [3 0 R /FitV null]");break;case"fullpage":R("/OpenAction [3 0 R /Fit]");break;case"original":R("/OpenAction [3 0 R /XYZ null null 1]");break;default:var le=""+Ye;le.substr(le.length-1)==="%"&&(Ye=parseInt(Ye)/100),typeof Ye=="number"&&R("/OpenAction [3 0 R /XYZ null null "+Q(Ye)+"]")}switch(st||(st="continuous"),st){case"continuous":R("/PageLayout /OneColumn");break;case"single":R("/PageLayout /SinglePage");break;case"two":case"twoleft":R("/PageLayout /TwoColumnLeft");break;case"tworight":R("/PageLayout /TwoColumnRight")}Ae&&R("/PageMode /"+Ae),Kt.publish("putCatalog"),R(">>"),R("endobj")},Fn=p.__private__.putTrailer=function(){R("trailer"),R("<<"),R("/Size "+(ce+1)),R("/Root "+ce+" 0 R"),R("/Info "+(ce-1)+" 0 R"),f!==null&&R("/Encrypt "+Un.oid+" 0 R"),R("/ID [ <"+V+"> <"+V+"> ]"),R(">>")},ea=p.__private__.putHeader=function(){R("%PDF-"+b),R("%")},bs=p.__private__.putXRef=function(){var g="0000000000";R("xref"),R("0 "+(ce+1)),R("0000000000 65535 f ");for(var M=1;M<=ce;M++)typeof fe[M]=="function"?R((g+fe[M]()).slice(-10)+" 00000 n "):fe[M]!==void 0?R((g+fe[M]).slice(-10)+" 00000 n "):R("0000000000 00000 n ")},ua=p.__private__.buildDocument=function(){Fe(),ne(ee),Kt.publish("buildDocument"),ea(),qr(),Te(),he(),f!==null&&bo(),at(),Ft();var g=ae;return bs(),Fn(),R("startxref"),R(""+g),R("%%EOF"),ne(ye[D]),ee.join(`
`)},Wa=p.__private__.getBlob=function(g){return new Blob([je(g)],{type:"application/pdf"})},da=p.output=p.__private__.output=Qt(function(g,M){switch(typeof(M=M||{})=="string"?M={filename:M}:M.filename=M.filename||"generated.pdf",g){case void 0:return ua();case"save":p.save(M.filename);break;case"arraybuffer":return je(ua());case"blob":return Wa(ua());case"bloburi":case"bloburl":if(Mt.URL!==void 0&&typeof Mt.URL.createObjectURL=="function")return Mt.URL&&Mt.URL.createObjectURL(Wa(ua()))||void 0;Mr.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var le="",ge=ua();try{le=sh(ge)}catch{le=sh(unescape(encodeURIComponent(ge)))}return"data:application/pdf;filename="+M.filename+";base64,"+le;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Mt)==="[object Window]"){var Ee="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Ge=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';M.pdfObjectUrl&&(Ee=M.pdfObjectUrl,Ge="");var lt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Ee+'"'+Ge+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(M)+");<\/script></body></html>",yt=Mt.open();return yt!==null&&yt.document.write(lt),yt}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Mt)==="[object Window]"){var It='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(M.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+M.filename+'" width="500px" height="400px" /></body></html>',Yt=Mt.open();if(Yt!==null){Yt.document.write(It);var Wt=this;Yt.document.documentElement.querySelector("#pdfViewer").onload=function(){Yt.document.title=M.filename,Yt.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Wt.output("bloburl"))}}return Yt}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Mt)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var hr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",M)+'"></iframe></body></html>',Qr=Mt.open();if(Qr!==null&&(Qr.document.write(hr),Qr.document.title=M.filename),Qr||typeof safari>"u")return Qr;break;case"datauri":case"dataurl":return Mt.document.location.href=this.output("datauristring",M);default:return null}}),Ci=function(g){return Array.isArray(Ln)===!0&&Ln.indexOf(g)>-1};switch(n){case"pt":ct=1;break;case"mm":ct=72/25.4;break;case"cm":ct=72/2.54;break;case"in":ct=72;break;case"px":ct=Ci("px_scaling")==1?.75:96/72;break;case"pc":case"em":ct=12;break;case"ex":ct=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);ct=n}var Un=null;de(),E();var Iu=function(g){return f!==null?Un.encryptor(g,0):function(M){return M}},$l=p.__private__.getPageInfo=p.getPageInfo=function(g){if(isNaN(g)||g%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Pt[g].objId,pageNumber:g,pageContext:Pt[g]}},Ut=p.__private__.getPageInfoByObjId=function(g){if(isNaN(g)||g%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var M in Pt)if(Pt[M].objId===g)break;return $l(M)},Du=p.__private__.getCurrentPageInfo=p.getCurrentPageInfo=function(){return{objId:Pt[D].objId,pageNumber:D,pageContext:Pt[D]}};p.addPage=function(){return Br.apply(this,arguments),this},p.setPage=function(){return Ua.apply(this,arguments),ne.call(this,ye[D]),this},p.insertPage=function(g){return this.addPage(),this.movePage(D,g),this},p.movePage=function(g,M){var le,ge;if(g>M){le=ye[g],ge=Pt[g];for(var Ee=g;Ee>M;Ee--)ye[Ee]=ye[Ee-1],Pt[Ee]=Pt[Ee-1];ye[M]=le,Pt[M]=ge,this.setPage(M)}else if(g<M){le=ye[g],ge=Pt[g];for(var Ge=g;Ge<M;Ge++)ye[Ge]=ye[Ge+1],Pt[Ge]=Pt[Ge+1];ye[M]=le,Pt[M]=ge,this.setPage(M)}return this},p.deletePage=function(){return Ba.apply(this,arguments),this},p.__private__.text=p.text=function(g,M,le,ge,Ee){var Ge,lt,yt,It,Yt,Wt,hr,Qr,en,yn=(ge=ge||{}).scope||this;if(typeof g=="number"&&typeof M=="number"&&(typeof le=="string"||Array.isArray(le))){var Wn=le;le=M,M=g,g=Wn}if(arguments[3]instanceof Nt?(C("The transform parameter of text() with a Matrix value"),en=Ee):(yt=arguments[4],It=arguments[5],br(hr=arguments[3])==="object"&&hr!==null||(typeof yt=="string"&&(It=yt,yt=null),typeof hr=="string"&&(It=hr,hr=null),typeof hr=="number"&&(yt=hr,hr=null),ge={flags:hr,angle:yt,align:It})),isNaN(M)||isNaN(le)||g==null)throw new Error("Invalid arguments passed to jsPDF.text");if(g.length===0)return yn;var On="",Na=!1,ha=typeof ge.lineHeightFactor=="number"?ge.lineHeightFactor:Ks,Ha=yn.internal.scaleFactor;function Zl(Ur){return Ur=Ur.split("	").join(Array(ge.TabLen||9).join(" ")),Er(Ur,hr)}function Io(Ur){for(var Wr,un=Ur.concat(),An=[],us=un.length;us--;)typeof(Wr=un.shift())=="string"?An.push(Wr):Array.isArray(Ur)&&(Wr.length===1||Wr[1]===void 0&&Wr[2]===void 0)?An.push(Wr[0]):An.push([Wr[0],Wr[1],Wr[2]]);return An}function Do(Ur,Wr){var un;if(typeof Ur=="string")un=Wr(Ur)[0];else if(Array.isArray(Ur)){for(var An,us,Wo=Ur.concat(),Bi=[],ac=Wo.length;ac--;)typeof(An=Wo.shift())=="string"?Bi.push(Wr(An)[0]):Array.isArray(An)&&typeof An[0]=="string"&&(us=Wr(An[0],An[1],An[2]),Bi.push([us[0],us[1],us[2]]));un=Bi}return un}var Ei=!1,To=!0;if(typeof g=="string")Ei=!0;else if(Array.isArray(g)){var Mo=g.concat();lt=[];for(var Oi,Rn=Mo.length;Rn--;)(typeof(Oi=Mo.shift())!="string"||Array.isArray(Oi)&&typeof Oi[0]!="string")&&(To=!1);Ei=To}if(Ei===!1)throw new Error('Type of text must be string or Array. "'+g+'" is not recognized.');typeof g=="string"&&(g=g.match(/[\r?\n]/)?g.split(/\r\n|\r|\n/g):[g]);var Ii=He/yn.internal.scaleFactor,Di=Ii*(ha-1);switch(ge.baseline){case"bottom":le-=Di;break;case"top":le+=Ii-Di;break;case"hanging":le+=Ii-2*Di;break;case"middle":le+=Ii/2-Di}if((Wt=ge.maxWidth||0)>0&&(typeof g=="string"?g=yn.splitTextToSize(g,Wt):Object.prototype.toString.call(g)==="[object Array]"&&(g=g.reduce(function(Ur,Wr){return Ur.concat(yn.splitTextToSize(Wr,Wt))},[]))),Ge={text:g,x:M,y:le,options:ge,mutex:{pdfEscape:Er,activeFontKey:St,fonts:tr,activeFontSize:He}},Kt.publish("preProcessText",Ge),g=Ge.text,yt=(ge=Ge.options).angle,!(en instanceof Nt)&&yt&&typeof yt=="number"){yt*=Math.PI/180,ge.rotationDirection===0&&(yt=-yt),k===O.ADVANCED&&(yt=-yt);var Ti=Math.cos(yt),Fo=Math.sin(yt);en=new Nt(Ti,Fo,-Fo,Ti,0,0)}else yt&&yt instanceof Nt&&(en=yt);k!==O.ADVANCED||en||(en=Ne),(Yt=ge.charSpace||Ai)!==void 0&&(On+=U(L(Yt))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Qr=ge.horizontalScale)!==void 0&&(On+=U(100*Qr)+` Tz
`),ge.lang;var ta=-1,$u=ge.renderingMode!==void 0?ge.renderingMode:ge.stroke,Ro=yn.internal.getCurrentPageInfo().pageContext;switch($u){case 0:case!1:case"fill":ta=0;break;case 1:case!0:case"stroke":ta=1;break;case 2:case"fillThenStroke":ta=2;break;case 3:case"invisible":ta=3;break;case 4:case"fillAndAddForClipping":ta=4;break;case 5:case"strokeAndAddPathForClipping":ta=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":ta=6;break;case 7:case"addToPathForClipping":ta=7}var ec=Ro.usedRenderingMode!==void 0?Ro.usedRenderingMode:-1;ta!==-1?On+=ta+` Tr
`:ec!==-1&&(On+=`0 Tr
`),ta!==-1&&(Ro.usedRenderingMode=ta),It=ge.align||"left";var va,Mi=He*ha,tc=yn.internal.pageSize.getWidth(),rc=tr[St];Yt=ge.charSpace||Ai,Wt=ge.maxWidth||0,hr=Object.assign({autoencode:!0,noBOM:!0},ge.flags);var Ss=[],ei=function(Ur){return yn.getStringUnitWidth(Ur,{font:rc,charSpace:Yt,fontSize:He,doKerning:!1})*He/Ha};if(Object.prototype.toString.call(g)==="[object Array]"){var ra;lt=Io(g),It!=="left"&&(va=lt.map(ei));var Jn,Cs=0;if(It==="right"){M-=va[0],g=[],Rn=lt.length;for(var os=0;os<Rn;os++)os===0?(Jn=$a(M),ra=is(le)):(Jn=L(Cs-va[os]),ra=-Mi),g.push([lt[os],Jn,ra]),Cs=va[os]}else if(It==="center"){M-=va[0]/2,g=[],Rn=lt.length;for(var ls=0;ls<Rn;ls++)ls===0?(Jn=$a(M),ra=is(le)):(Jn=L((Cs-va[ls])/2),ra=-Mi),g.push([lt[ls],Jn,ra]),Cs=va[ls]}else if(It==="left"){g=[],Rn=lt.length;for(var Fi=0;Fi<Rn;Fi++)g.push(lt[Fi])}else if(It==="justify"&&rc.encoding==="Identity-H"){g=[],Rn=lt.length,Wt=Wt!==0?Wt:tc;for(var cs=0,cn=0;cn<Rn;cn++)if(ra=cn===0?is(le):-Mi,Jn=cn===0?$a(M):cs,cn<Rn-1){var qo=L((Wt-va[cn])/(lt[cn].split(" ").length-1)),Kn=lt[cn].split(" ");g.push([Kn[0]+" ",Jn,ra]),cs=0;for(var xa=1;xa<Kn.length;xa++){var Ri=(ei(Kn[xa-1]+" "+Kn[xa])-ei(Kn[xa]))*Ha+qo;xa==Kn.length-1?g.push([Kn[xa],Ri,0]):g.push([Kn[xa]+" ",Ri,0]),cs-=Ri}}else g.push([lt[cn],Jn,ra]);g.push(["",cs,0])}else{if(It!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(g=[],Rn=lt.length,Wt=Wt!==0?Wt:tc,cn=0;cn<Rn;cn++)ra=cn===0?is(le):-Mi,Jn=cn===0?$a(M):0,cn<Rn-1?Ss.push(U(L((Wt-va[cn])/(lt[cn].split(" ").length-1)))):Ss.push(0),g.push([lt[cn],Jn,ra])}}var nc=typeof ge.R2L=="boolean"?ge.R2L:dt;nc===!0&&(g=Do(g,function(Ur,Wr,un){return[Ur.split("").reverse().join(""),Wr,un]})),Ge={text:g,x:M,y:le,options:ge,mutex:{pdfEscape:Er,activeFontKey:St,fonts:tr,activeFontSize:He}},Kt.publish("postProcessText",Ge),g=Ge.text,Na=Ge.mutex.isHex||!1;var Bo=tr[St].encoding;Bo!=="WinAnsiEncoding"&&Bo!=="StandardEncoding"||(g=Do(g,function(Ur,Wr,un){return[Zl(Ur),Wr,un]})),lt=Io(g),g=[];for(var ti,ri,Ps,ni=0,qi=1,ai=Array.isArray(lt[0])?qi:ni,ks="",Uo=function(Ur,Wr,un){var An="";return un instanceof Nt?(un=typeof ge.angle=="number"?kn(un,new Nt(1,0,0,1,Ur,Wr)):kn(new Nt(1,0,0,1,Ur,Wr),un),k===O.ADVANCED&&(un=kn(new Nt(1,0,0,-1,0,0),un)),An=un.join(" ")+` Tm
`):An=U(Ur)+" "+U(Wr)+` Td
`,An},ya=0;ya<lt.length;ya++){switch(ks="",ai){case qi:Ps=(Na?"<":"(")+lt[ya][0]+(Na?">":")"),ti=parseFloat(lt[ya][1]),ri=parseFloat(lt[ya][2]);break;case ni:Ps=(Na?"<":"(")+lt[ya]+(Na?">":")"),ti=$a(M),ri=is(le)}Ss!==void 0&&Ss[ya]!==void 0&&(ks=Ss[ya]+` Tw
`),ya===0?g.push(ks+Uo(ti,ri,en)+Ps):ai===ni?g.push(ks+Ps):ai===qi&&g.push(ks+Uo(ti,ri,en)+Ps)}g=ai===ni?g.join(` Tj
T* `):g.join(` Tj
`),g+=` Tj
`;var ba=`BT
/`;return ba+=St+" "+He+` Tf
`,ba+=U(He*ha)+` TL
`,ba+=Xs+`
`,ba+=On,ba+=g,R(ba+="ET"),v[St]=!0,yn};var Tu=p.__private__.clip=p.clip=function(g){return R(g==="evenodd"?"W*":"W"),this};p.clipEvenOdd=function(){return Tu("evenodd")},p.__private__.discardPath=p.discardPath=function(){return R("n"),this};var za=p.__private__.isValidStyle=function(g){var M=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(g)!==-1&&(M=!0),M};p.__private__.setDefaultPathOperation=p.setDefaultPathOperation=function(g){return za(g)&&(d=g),this};var Hl=p.__private__.getStyle=p.getStyle=function(g){var M=d;switch(g){case"D":case"S":M="S";break;case"F":M="f";break;case"FD":case"DF":M="B";break;case"f":case"f*":case"B":case"B*":M=g}return M},Yl=p.close=function(){return R("h"),this};p.stroke=function(){return R("S"),this},p.fill=function(g){return Pi("f",g),this},p.fillEvenOdd=function(g){return Pi("f*",g),this},p.fillStroke=function(g){return Pi("B",g),this},p.fillStrokeEvenOdd=function(g){return Pi("B*",g),this};var Pi=function(g,M){br(M)==="object"?Fu(M,g):R(g)},jo=function(g){g===null||k===O.ADVANCED&&g===void 0||(g=Hl(g),R(g))};function Mu(g,M,le,ge,Ee){var Ge=new Ki(M||this.boundingBox,le||this.xStep,ge||this.yStep,this.gState,Ee||this.matrix);Ge.stream=this.stream;var lt=g+"$$"+this.cloneIndex+++"$$";return Be(lt,Ge),Ge}var Fu=function(g,M){var le=Xr[g.key],ge=Bt[le];if(ge instanceof ci)R("q"),R(Ru(M)),ge.gState&&p.setGState(ge.gState),R(g.matrix.toString()+" cm"),R("/"+le+" sh"),R("Q");else if(ge instanceof Ki){var Ee=new Nt(1,0,0,-1,0,js());g.matrix&&(Ee=Ee.multiply(g.matrix||Ne),le=Mu.call(ge,g.key,g.boundingBox,g.xStep,g.yStep,Ee).id),R("q"),R("/Pattern cs"),R("/"+le+" scn"),ge.gState&&p.setGState(ge.gState),R(M),R("Q")}},Ru=function(g){switch(g){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},So=p.moveTo=function(g,M){return R(U(L(g))+" "+U(W(M))+" m"),this},Js=p.lineTo=function(g,M){return R(U(L(g))+" "+U(W(M))+" l"),this},ws=p.curveTo=function(g,M,le,ge,Ee,Ge){return R([U(L(g)),U(W(M)),U(L(le)),U(W(ge)),U(L(Ee)),U(W(Ge)),"c"].join(" ")),this};p.__private__.line=p.line=function(g,M,le,ge,Ee){if(isNaN(g)||isNaN(M)||isNaN(le)||isNaN(ge)||!za(Ee))throw new Error("Invalid arguments passed to jsPDF.line");return k===O.COMPAT?this.lines([[le-g,ge-M]],g,M,[1,1],Ee||"S"):this.lines([[le-g,ge-M]],g,M,[1,1]).stroke()},p.__private__.lines=p.lines=function(g,M,le,ge,Ee,Ge){var lt,yt,It,Yt,Wt,hr,Qr,en,yn,Wn,On,Na;if(typeof g=="number"&&(Na=le,le=M,M=g,g=Na),ge=ge||[1,1],Ge=Ge||!1,isNaN(M)||isNaN(le)||!Array.isArray(g)||!Array.isArray(ge)||!za(Ee)||typeof Ge!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(So(M,le),lt=ge[0],yt=ge[1],Yt=g.length,Wn=M,On=le,It=0;It<Yt;It++)(Wt=g[It]).length===2?(Wn=Wt[0]*lt+Wn,On=Wt[1]*yt+On,Js(Wn,On)):(hr=Wt[0]*lt+Wn,Qr=Wt[1]*yt+On,en=Wt[2]*lt+Wn,yn=Wt[3]*yt+On,Wn=Wt[4]*lt+Wn,On=Wt[5]*yt+On,ws(hr,Qr,en,yn,Wn,On));return Ge&&Yl(),jo(Ee),this},p.path=function(g){for(var M=0;M<g.length;M++){var le=g[M],ge=le.c;switch(le.op){case"m":So(ge[0],ge[1]);break;case"l":Js(ge[0],ge[1]);break;case"c":ws.apply(this,ge);break;case"h":Yl()}}return this},p.__private__.rect=p.rect=function(g,M,le,ge,Ee){if(isNaN(g)||isNaN(M)||isNaN(le)||isNaN(ge)||!za(Ee))throw new Error("Invalid arguments passed to jsPDF.rect");return k===O.COMPAT&&(ge=-ge),R([U(L(g)),U(W(M)),U(L(le)),U(L(ge)),"re"].join(" ")),jo(Ee),this},p.__private__.triangle=p.triangle=function(g,M,le,ge,Ee,Ge,lt){if(isNaN(g)||isNaN(M)||isNaN(le)||isNaN(ge)||isNaN(Ee)||isNaN(Ge)||!za(lt))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[le-g,ge-M],[Ee-le,Ge-ge],[g-Ee,M-Ge]],g,M,[1,1],lt,!0),this},p.__private__.roundedRect=p.roundedRect=function(g,M,le,ge,Ee,Ge,lt){if(isNaN(g)||isNaN(M)||isNaN(le)||isNaN(ge)||isNaN(Ee)||isNaN(Ge)||!za(lt))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var yt=4/3*(Math.SQRT2-1);return Ee=Math.min(Ee,.5*le),Ge=Math.min(Ge,.5*ge),this.lines([[le-2*Ee,0],[Ee*yt,0,Ee,Ge-Ge*yt,Ee,Ge],[0,ge-2*Ge],[0,Ge*yt,-Ee*yt,Ge,-Ee,Ge],[2*Ee-le,0],[-Ee*yt,0,-Ee,-Ge*yt,-Ee,-Ge],[0,2*Ge-ge],[0,-Ge*yt,Ee*yt,-Ge,Ee,-Ge]],g+Ee,M,[1,1],lt,!0),this},p.__private__.ellipse=p.ellipse=function(g,M,le,ge,Ee){if(isNaN(g)||isNaN(M)||isNaN(le)||isNaN(ge)||!za(Ee))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Ge=4/3*(Math.SQRT2-1)*le,lt=4/3*(Math.SQRT2-1)*ge;return So(g+le,M),ws(g+le,M-lt,g+Ge,M-ge,g,M-ge),ws(g-Ge,M-ge,g-le,M-lt,g-le,M),ws(g-le,M+lt,g-Ge,M+ge,g,M+ge),ws(g+Ge,M+ge,g+le,M+lt,g+le,M),jo(Ee),this},p.__private__.circle=p.circle=function(g,M,le,ge){if(isNaN(g)||isNaN(M)||isNaN(le)||!za(ge))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(g,M,le,le,ge)},p.setFont=function(g,M,le){return le&&(M=F(M,le)),St=Si(g,M,{disableWarning:!1}),this};var qu=p.__private__.getFont=p.getFont=function(){return tr[Si.apply(p,arguments)]};p.__private__.getFontList=p.getFontList=function(){var g,M,le={};for(g in rr)if(rr.hasOwnProperty(g))for(M in le[g]=[],rr[g])rr[g].hasOwnProperty(M)&&le[g].push(M);return le},p.addFont=function(g,M,le,ge,Ee){var Ge=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Ge.indexOf(arguments[3])!==-1?Ee=arguments[3]:arguments[3]&&Ge.indexOf(arguments[3])==-1&&(le=F(le,ge)),Ee=Ee||"Identity-H",ht.call(this,g,M,le,Ee)};var Ks,Co=t.lineWidth||.200025,ki=p.__private__.getLineWidth=p.getLineWidth=function(){return Co},Vl=p.__private__.setLineWidth=p.setLineWidth=function(g){return Co=g,R(U(L(g))+" w"),this};p.__private__.setLineDash=Tt.API.setLineDash=Tt.API.setLineDashPattern=function(g,M){if(g=g||[],M=M||0,isNaN(M)||!Array.isArray(g))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return g=g.map(function(le){return U(L(le))}).join(" "),M=U(L(M)),R("["+g+"] "+M+" d"),this};var Gl=p.__private__.getLineHeight=p.getLineHeight=function(){return He*Ks};p.__private__.getLineHeight=p.getLineHeight=function(){return He*Ks};var Ql=p.__private__.setLineHeightFactor=p.setLineHeightFactor=function(g){return typeof(g=g||1.15)=="number"&&(Ks=g),this},Jl=p.__private__.getLineHeightFactor=p.getLineHeightFactor=function(){return Ks};Ql(t.lineHeight);var $a=p.__private__.getHorizontalCoordinate=function(g){return L(g)},is=p.__private__.getVerticalCoordinate=function(g){return k===O.ADVANCED?g:Pt[D].mediaBox.topRightY-Pt[D].mediaBox.bottomLeftY-L(g)},Bu=p.__private__.getHorizontalCoordinateString=p.getHorizontalCoordinateString=function(g){return U($a(g))},_s=p.__private__.getVerticalCoordinateString=p.getVerticalCoordinateString=function(g){return U(is(g))},La=t.strokeColor||"0 G";p.__private__.getStrokeColor=p.getDrawColor=function(){return ln(La)},p.__private__.setStrokeColor=p.setDrawColor=function(g,M,le,ge){return La=$e({ch1:g,ch2:M,ch3:le,ch4:ge,pdfColorType:"draw",precision:2}),R(La),this};var Po=t.fillColor||"0 g";p.__private__.getFillColor=p.getFillColor=function(){return ln(Po)},p.__private__.setFillColor=p.setFillColor=function(g,M,le,ge){return Po=$e({ch1:g,ch2:M,ch3:le,ch4:ge,pdfColorType:"fill",precision:2}),R(Po),this};var Xs=t.textColor||"0 g",Uu=p.__private__.getTextColor=p.getTextColor=function(){return ln(Xs)};p.__private__.setTextColor=p.setTextColor=function(g,M,le,ge){return Xs=$e({ch1:g,ch2:M,ch3:le,ch4:ge,pdfColorType:"text",precision:3}),this};var Ai=t.charSpace,Wu=p.__private__.getCharSpace=p.getCharSpace=function(){return parseFloat(Ai||0)};p.__private__.setCharSpace=p.setCharSpace=function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Ai=g,this};var ko=0;p.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},p.__private__.setLineCap=p.setLineCap=function(g){var M=p.CapJoinStyles[g];if(M===void 0)throw new Error("Line cap style of '"+g+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return ko=M,R(M+" J"),this};var Ao=0;p.__private__.setLineJoin=p.setLineJoin=function(g){var M=p.CapJoinStyles[g];if(M===void 0)throw new Error("Line join style of '"+g+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Ao=M,R(M+" j"),this},p.__private__.setLineMiterLimit=p.__private__.setMiterLimit=p.setLineMiterLimit=p.setMiterLimit=function(g){if(g=g||0,isNaN(g))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return R(U(L(g))+" M"),this},p.GState=ru,p.setGState=function(g){(g=typeof g=="string"?sr[Zr[g]]:Kl(null,g)).equals(xn)||(R("/"+g.id+" gs"),xn=g)};var Kl=function(g,M){if(!g||!Zr[g]){var le=!1;for(var ge in sr)if(sr.hasOwnProperty(ge)&&sr[ge].equals(M)){le=!0;break}if(le)M=sr[ge];else{var Ee="GS"+(Object.keys(sr).length+1).toString(10);sr[Ee]=M,M.id=Ee}return g&&(Zr[g]=M.id),Kt.publish("addGState",M),M}};p.addGState=function(g,M){return Kl(g,M),this},p.saveGraphicsState=function(){return R("q"),Pn.push({key:St,size:He,color:Xs}),this},p.restoreGraphicsState=function(){R("Q");var g=Pn.pop();return St=g.key,He=g.size,Xs=g.color,xn=null,this},p.setCurrentTransformationMatrix=function(g){return R(g.toString()+" cm"),this},p.comment=function(g){return R("#"+g),this};var Li=function(g,M){var le=g||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return le},set:function(Ge){isNaN(Ge)||(le=parseFloat(Ge))}});var ge=M||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return ge},set:function(Ge){isNaN(Ge)||(ge=parseFloat(Ge))}});var Ee="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Ee},set:function(Ge){Ee=Ge.toString()}}),this},Lo=function(g,M,le,ge){Li.call(this,g,M),this.type="rect";var Ee=le||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Ee},set:function(lt){isNaN(lt)||(Ee=parseFloat(lt))}});var Ge=ge||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Ge},set:function(lt){isNaN(lt)||(Ge=parseFloat(lt))}}),this},No=function(){this.page=_r,this.currentPage=D,this.pages=ye.slice(0),this.pagesContext=Pt.slice(0),this.x=Rt,this.y=xt,this.matrix=Rr,this.width=Zs(D),this.height=js(D),this.outputDestination=se,this.id="",this.objectNumber=-1};No.prototype.restore=function(){_r=this.page,D=this.currentPage,Pt=this.pagesContext,ye=this.pages,Rt=this.x,xt=this.y,Rr=this.matrix,Eo(D,this.width),Oo(D,this.height),se=this.outputDestination};var Xl=function(g,M,le,ge,Ee){Nn.push(new No),_r=D=0,ye=[],Rt=g,xt=M,Rr=Ee,Mn([le,ge])},zu=function(g){if(Hr[g])Nn.pop().restore();else{var M=new No,le="Xo"+(Object.keys(ir).length+1).toString(10);M.id=le,Hr[g]=le,ir[le]=M,Kt.publish("addFormObject",M),Nn.pop().restore()}};for(var Ni in p.beginFormObject=function(g,M,le,ge,Ee){return Xl(g,M,le,ge,Ee),this},p.endFormObject=function(g){return zu(g),this},p.doFormObject=function(g,M){var le=ir[Hr[g]];return R("q"),R(M.toString()+" cm"),R("/"+le.id+" Do"),R("Q"),this},p.getFormObject=function(g){var M=ir[Hr[g]];return{x:M.x,y:M.y,width:M.width,height:M.height,matrix:M.matrix}},p.save=function(g,M){return g=g||"generated.pdf",(M=M||{}).returnPromise=M.returnPromise||!1,M.returnPromise===!1?(oi(Wa(ua()),g),typeof oi.unload=="function"&&Mt.setTimeout&&setTimeout(oi.unload,911),this):new Promise(function(le,ge){try{var Ee=oi(Wa(ua()),g);typeof oi.unload=="function"&&Mt.setTimeout&&setTimeout(oi.unload,911),le(Ee)}catch(Ge){ge(Ge.message)}})},Tt.API)Tt.API.hasOwnProperty(Ni)&&(Ni==="events"&&Tt.API.events.length?function(g,M){var le,ge,Ee;for(Ee=M.length-1;Ee!==-1;Ee--)le=M[Ee][0],ge=M[Ee][1],g.subscribe.apply(g,[le].concat(typeof ge=="function"?[ge]:ge))}(Kt,Tt.API.events):p[Ni]=Tt.API[Ni]);var Zs=p.getPageWidth=function(g){return(Pt[g=g||D].mediaBox.topRightX-Pt[g].mediaBox.bottomLeftX)/ct},Eo=p.setPageWidth=function(g,M){Pt[g].mediaBox.topRightX=M*ct+Pt[g].mediaBox.bottomLeftX},js=p.getPageHeight=function(g){return(Pt[g=g||D].mediaBox.topRightY-Pt[g].mediaBox.bottomLeftY)/ct},Oo=p.setPageHeight=function(g,M){Pt[g].mediaBox.topRightY=M*ct+Pt[g].mediaBox.bottomLeftY};return p.internal={pdfEscape:Er,getStyle:Hl,getFont:qu,getFontSize:nt,getCharSpace:Wu,getTextColor:Uu,getLineHeight:Gl,getLineHeightFactor:Jl,getLineWidth:ki,write:be,getHorizontalCoordinate:$a,getVerticalCoordinate:is,getCoordinateString:Bu,getVerticalCoordinateString:_s,collections:{},newObject:Ve,newAdditionalObject:kt,newObjectDeferred:Ke,newObjectDeferredBegin:$t,getFilters:ze,putStream:ut,events:Kt,scaleFactor:ct,pageSize:{getWidth:function(){return Zs(D)},setWidth:function(g){Eo(D,g)},getHeight:function(){return js(D)},setHeight:function(g){Oo(D,g)}},encryptionOptions:f,encryption:Un,getEncryptor:Iu,output:da,getNumberOfPages:_o,pages:ye,out:R,f2:Q,f3:P,getPageInfo:$l,getPageInfoByObjId:Ut,getCurrentPageInfo:Du,getPDFVersion:w,Point:Li,Rectangle:Lo,Matrix:Nt,hasHotfix:Ci},Object.defineProperty(p.internal.pageSize,"width",{get:function(){return Zs(D)},set:function(g){Eo(D,g)},enumerable:!0,configurable:!0}),Object.defineProperty(p.internal.pageSize,"height",{get:function(){return js(D)},set:function(g){Oo(D,g)},enumerable:!0,configurable:!0}),Et.call(p,Pe),St="F1",Br(s,r),Kt.publish("initialized"),p}Qi.prototype.lsbFirstWord=function(t){return String.fromCharCode(t>>0&255,t>>8&255,t>>16&255,t>>24&255)},Qi.prototype.toHexString=function(t){return t.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Qi.prototype.hexToBytes=function(t){for(var e=[],r=0;r<t.length;r+=2)e.push(String.fromCharCode(parseInt(t.substr(r,2),16)));return e.join("")},Qi.prototype.processOwnerPassword=function(t,e){return oh(ih(e).substr(0,5),t)},Qi.prototype.encryptor=function(t,e){var r=ih(this.encryptionKey+String.fromCharCode(255&t,t>>8&255,t>>16&255,255&e,e>>8&255)).substr(0,10);return function(n){return oh(r,n)}},ru.prototype.equals=function(t){var e,r="id,objectNumber,equals";if(!t||br(t)!==br(this))return!1;var n=0;for(e in this)if(!(r.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!t.hasOwnProperty(e)||this[e]!==t[e])return!1;n++}for(e in t)t.hasOwnProperty(e)&&r.indexOf(e)<0&&n--;return n===0},Tt.API={events:[]},Tt.version="3.0.1";var rn=Tt.API,Dh=1,_i=function(t){return t.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Yi=function(t){return t.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},zt=function(t){return t.toFixed(2)},Ms=function(t){return t.toFixed(5)};rn.__acroform__={};var ca=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},Sp=function(t){return t*Dh},Ga=function(t){var e=new Ug,r=jt.internal.getHeight(t)||0,n=jt.internal.getWidth(t)||0;return e.BBox=[0,0,Number(zt(n)),Number(zt(r))],e},bb=rn.__acroform__.setBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return t|=1<<e},wb=rn.__acroform__.clearBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return t&=~(1<<e)},_b=rn.__acroform__.getBit=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return(t&1<<e)==0?0:1},dn=rn.__acroform__.getBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return _b(t,e-1)},hn=rn.__acroform__.setBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return bb(t,e-1)},fn=rn.__acroform__.clearBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return wb(t,e-1)},jb=rn.__acroform__.calculateCoordinates=function(t,e){var r=e.internal.getHorizontalCoordinate,n=e.internal.getVerticalCoordinate,s=t[0],i=t[1],o=t[2],l=t[3],u={};return u.lowerLeft_X=r(s)||0,u.lowerLeft_Y=n(i+l)||0,u.upperRight_X=r(s+o)||0,u.upperRight_Y=n(i)||0,[Number(zt(u.lowerLeft_X)),Number(zt(u.lowerLeft_Y)),Number(zt(u.upperRight_X)),Number(zt(u.upperRight_Y))]},Sb=function(t){if(t.appearanceStreamContent)return t.appearanceStreamContent;if(t.V||t.DV){var e=[],r=t._V||t.DV,n=lh(t,r),s=t.scope.internal.getFont(t.fontName,t.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(t.scope.__private__.encodeColorString(t.color)),e.push("/"+s+" "+zt(n.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(n.text),e.push("ET"),e.push("Q"),e.push("EMC");var i=Ga(t);return i.scope=t.scope,i.stream=e.join(`
`),i}},lh=function(t,e){var r=t.fontSize===0?t.maxFontSize:t.fontSize,n={text:"",fontSize:""},s=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");s=t.multiline?s.map(function(P){return P.split(`
`)}):s.map(function(P){return[P]});var i=r,o=jt.internal.getHeight(t)||0;o=o<0?-o:o;var l=jt.internal.getWidth(t)||0;l=l<0?-l:l;var u=function(P,L,te){if(P+1<s.length){var W=L+" "+s[P+1][0];return kc(W,t,te).width<=l-4}return!1};i++;e:for(;i>0;){e="",i--;var d,f,m=kc("3",t,i).height,v=t.multiline?o-i:(o-m)/2,p=v+=2,b=0,w=0,y=0;if(i<=0){e=`(...) Tj
`,e+="% Width of Text: "+kc(e,t,i=12).width+", FieldWidth:"+l+`
`;break}for(var j="",O=0,k=0;k<s.length;k++)if(s.hasOwnProperty(k)){var I=!1;if(s[k].length!==1&&y!==s[k].length-1){if((m+2)*(O+2)+2>o)continue e;j+=s[k][y],I=!0,w=k,k--}else{j=(j+=s[k][y]+" ").substr(j.length-1)==" "?j.substr(0,j.length-1):j;var H=parseInt(k),F=u(H,j,i),U=k>=s.length-1;if(F&&!U){j+=" ",y=0;continue}if(F||U){if(U)w=H;else if(t.multiline&&(m+2)*(O+2)+2>o)continue e}else{if(!t.multiline||(m+2)*(O+2)+2>o)continue e;w=H}}for(var C="",N=b;N<=w;N++){var Q=s[N];if(t.multiline){if(N===w){C+=Q[y]+" ",y=(y+1)%Q.length;continue}if(N===b){C+=Q[Q.length-1]+" ";continue}}C+=Q[0]+" "}switch(C=C.substr(C.length-1)==" "?C.substr(0,C.length-1):C,f=kc(C,t,i).width,t.textAlign){case"right":d=l-f-2;break;case"center":d=(l-f)/2;break;case"left":default:d=2}e+=zt(d)+" "+zt(p)+` Td
`,e+="("+_i(C)+`) Tj
`,e+=-zt(d)+` 0 Td
`,p=-(i+2),f=0,b=I?w:w+1,O++,j=""}break}return n.text=e,n.fontSize=i,n},kc=function(t,e,r){var n=e.scope.internal.getFont(e.fontName,e.fontStyle),s=e.scope.getStringUnitWidth(t,{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r);return{height:e.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r)*1.5,width:s}},Cb={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Pb=function(t,e){var r={type:"reference",object:t};e.internal.getPageInfo(t.page).pageContext.annotations.find(function(n){return n.type===r.type&&n.object===r.object})===void 0&&e.internal.getPageInfo(t.page).pageContext.annotations.push(r)},kb=function(t,e){for(var r in t)if(t.hasOwnProperty(r)){var n=r,s=t[r];e.internal.newObjectDeferredBegin(s.objId,!0),br(s)==="object"&&typeof s.putStream=="function"&&s.putStream(),delete t[n]}},Ab=function(t,e){if(e.scope=t,t.internal!==void 0&&(t.internal.acroformPlugin===void 0||t.internal.acroformPlugin.isInitialized===!1)){if(Ra.FieldNum=0,t.internal.acroformPlugin=JSON.parse(JSON.stringify(Cb)),t.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Dh=t.internal.scaleFactor,t.internal.acroformPlugin.acroFormDictionaryRoot=new Wg,t.internal.acroformPlugin.acroFormDictionaryRoot.scope=t,t.internal.acroformPlugin.acroFormDictionaryRoot._eventID=t.internal.events.subscribe("postPutResources",function(){(function(r){r.internal.events.unsubscribe(r.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete r.internal.acroformPlugin.acroFormDictionaryRoot._eventID,r.internal.acroformPlugin.printedOut=!0})(t)}),t.internal.events.subscribe("buildDocument",function(){(function(r){r.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=r.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var s in n)if(n.hasOwnProperty(s)){var i=n[s];i.objId=void 0,i.hasAnnotation&&Pb(i,r)}})(t)}),t.internal.events.subscribe("putCatalog",function(){(function(r){if(r.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");r.internal.write("/AcroForm "+r.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(t)}),t.internal.events.subscribe("postPutPages",function(r){(function(n,s){var i=!n;for(var o in n||(s.internal.newObjectDeferredBegin(s.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),s.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||s.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(o)){var l=n[o],u=[],d=l.Rect;if(l.Rect&&(l.Rect=jb(l.Rect,s)),s.internal.newObjectDeferredBegin(l.objId,!0),l.DA=jt.createDefaultAppearanceStream(l),br(l)==="object"&&typeof l.getKeyValueListForStream=="function"&&(u=l.getKeyValueListForStream()),l.Rect=d,l.hasAppearanceStream&&!l.appearanceStreamContent){var f=Sb(l);u.push({key:"AP",value:"<</N "+f+">>"}),s.internal.acroformPlugin.xForms.push(f)}if(l.appearanceStreamContent){var m="";for(var v in l.appearanceStreamContent)if(l.appearanceStreamContent.hasOwnProperty(v)){var p=l.appearanceStreamContent[v];if(m+="/"+v+" ",m+="<<",Object.keys(p).length>=1||Array.isArray(p)){for(var o in p)if(p.hasOwnProperty(o)){var b=p[o];typeof b=="function"&&(b=b.call(s,l)),m+="/"+o+" "+b+" ",s.internal.acroformPlugin.xForms.indexOf(b)>=0||s.internal.acroformPlugin.xForms.push(b)}}else typeof(b=p)=="function"&&(b=b.call(s,l)),m+="/"+o+" "+b,s.internal.acroformPlugin.xForms.indexOf(b)>=0||s.internal.acroformPlugin.xForms.push(b);m+=">>"}u.push({key:"AP",value:`<<
`+m+">>"})}s.internal.putStream({additionalKeyValues:u,objectId:l.objId}),s.internal.out("endobj")}i&&kb(s.internal.acroformPlugin.xForms,s)})(r,t)}),t.internal.acroformPlugin.isInitialized=!0}},Bg=rn.__acroform__.arrayToPdfArray=function(t,e,r){var n=function(o){return o};if(Array.isArray(t)){for(var s="[",i=0;i<t.length;i++)switch(i!==0&&(s+=" "),br(t[i])){case"boolean":case"number":case"object":s+=t[i].toString();break;case"string":t[i].substr(0,1)!=="/"?(e!==void 0&&r&&(n=r.internal.getEncryptor(e)),s+="("+_i(n(t[i].toString()))+")"):s+=t[i].toString()}return s+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},jd=function(t,e,r){var n=function(s){return s};return e!==void 0&&r&&(n=r.internal.getEncryptor(e)),(t=t||"").toString(),t="("+_i(n(t))+")"},Xa=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(t){this._objId=t}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Xa.prototype.toString=function(){return this.objId+" 0 R"},Xa.prototype.putStream=function(){var t=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:t,objectId:this.objId}),this.scope.internal.out("endobj")},Xa.prototype.getKeyValueListForStream=function(){var t=[],e=Object.getOwnPropertyNames(this).filter(function(i){return i!="content"&&i!="appearanceStreamContent"&&i!="scope"&&i!="objId"&&i.substring(0,1)!="_"});for(var r in e)if(Object.getOwnPropertyDescriptor(this,e[r]).configurable===!1){var n=e[r],s=this[n];s&&(Array.isArray(s)?t.push({key:n,value:Bg(s,this.objId,this.scope)}):s instanceof Xa?(s.scope=this.scope,t.push({key:n,value:s.objId+" 0 R"})):typeof s!="function"&&t.push({key:n,value:s}))}return t};var Ug=function(){Xa.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var t,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(r){t=r.trim()},get:function(){return t||null}})};ca(Ug,Xa);var Wg=function(){Xa.call(this);var t,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(t){var r=function(n){return n};return this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),"("+_i(r(t))+")"}},set:function(r){t=r}})};ca(Wg,Xa);var Ra=function t(){Xa.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(j){if(isNaN(j))throw new Error('Invalid value "'+j+'" for attribute F supplied.');e=j}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!dn(e,3)},set:function(j){j?this.F=hn(e,3):this.F=fn(e,3)}});var r=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return r},set:function(j){if(isNaN(j))throw new Error('Invalid value "'+j+'" for attribute Ff supplied.');r=j}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(j){n=j!==void 0?j:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(j){n[0]=j}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(j){n[1]=j}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(j){n[2]=j}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(j){n[3]=j}});var s="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return s},set:function(j){switch(j){case"/Btn":case"/Tx":case"/Ch":case"/Sig":s=j;break;default:throw new Error('Invalid value "'+j+'" for attribute FT supplied.')}}});var i=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!i||i.length<1){if(this instanceof nu)return;i="FieldObject"+t.FieldNum++}var j=function(O){return O};return this.scope&&(j=this.scope.internal.getEncryptor(this.objId)),"("+_i(j(i))+")"},set:function(j){i=j.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return i},set:function(j){i=j}});var o="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return o},set:function(j){o=j}});var l="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return l},set:function(j){l=j}});var u=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return u},set:function(j){u=j}});var d=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return d===void 0?50/Dh:d},set:function(j){d=j}});var f="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return f},set:function(j){f=j}});var m="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!m||this instanceof nu||this instanceof fi))return jd(m,this.objId,this.scope)},set:function(j){j=j.toString(),m=j}});var v=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(v)return this instanceof Tn?v:jd(v,this.objId,this.scope)},set:function(j){j=j.toString(),v=this instanceof Tn?j:j.substr(0,1)==="("?Yi(j.substr(1,j.length-2)):Yi(j)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Tn?Yi(v.substr(1,v.length-1)):v},set:function(j){j=j.toString(),v=this instanceof Tn?"/"+j:j}});var p=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(p)return p},set:function(j){this.V=j}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(p)return this instanceof Tn?p:jd(p,this.objId,this.scope)},set:function(j){j=j.toString(),p=this instanceof Tn?j:j.substr(0,1)==="("?Yi(j.substr(1,j.length-2)):Yi(j)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Tn?Yi(p.substr(1,p.length-1)):p},set:function(j){j=j.toString(),p=this instanceof Tn?"/"+j:j}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var b,w=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return w},set:function(j){j=!!j,w=j}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(b)return b},set:function(j){b=j}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,1)},set:function(j){j?this.Ff=hn(this.Ff,1):this.Ff=fn(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,2)},set:function(j){j?this.Ff=hn(this.Ff,2):this.Ff=fn(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,3)},set:function(j){j?this.Ff=hn(this.Ff,3):this.Ff=fn(this.Ff,3)}});var y=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(y!==null)return y},set:function(j){if([0,1,2].indexOf(j)===-1)throw new Error('Invalid value "'+j+'" for attribute Q supplied.');y=j}}),Object.defineProperty(this,"textAlign",{get:function(){var j;switch(y){case 0:default:j="left";break;case 1:j="center";break;case 2:j="right"}return j},configurable:!0,enumerable:!0,set:function(j){switch(j){case"right":case 2:y=2;break;case"center":case 1:y=1;break;case"left":case 0:default:y=0}}})};ca(Ra,Xa);var to=function(){Ra.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var t=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return t},set:function(r){t=r}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return Bg(e,this.objId,this.scope)},set:function(r){var n,s;s=[],typeof(n=r)=="string"&&(s=function(i,o,l){l||(l=1);for(var u,d=[];u=o.exec(i);)d.push(u[l]);return d}(n,/\((.*?)\)/g)),e=s}}),this.getOptions=function(){return e},this.setOptions=function(r){e=r,this.sort&&e.sort()},this.addOption=function(r){r=(r=r||"").toString(),e.push(r),this.sort&&e.sort()},this.removeOption=function(r,n){for(n=n||!1,r=(r=r||"").toString();e.indexOf(r)!==-1&&(e.splice(e.indexOf(r),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,18)},set:function(r){r?this.Ff=hn(this.Ff,18):this.Ff=fn(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,19)},set:function(r){this.combo===!0&&(r?this.Ff=hn(this.Ff,19):this.Ff=fn(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,20)},set:function(r){r?(this.Ff=hn(this.Ff,20),e.sort()):this.Ff=fn(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,22)},set:function(r){r?this.Ff=hn(this.Ff,22):this.Ff=fn(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,23)},set:function(r){r?this.Ff=hn(this.Ff,23):this.Ff=fn(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,27)},set:function(r){r?this.Ff=hn(this.Ff,27):this.Ff=fn(this.Ff,27)}}),this.hasAppearanceStream=!1};ca(to,Ra);var ro=function(){to.call(this),this.fontName="helvetica",this.combo=!1};ca(ro,to);var no=function(){ro.call(this),this.combo=!0};ca(no,ro);var Wc=function(){no.call(this),this.edit=!0};ca(Wc,no);var Tn=function(){Ra.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,15)},set:function(r){r?this.Ff=hn(this.Ff,15):this.Ff=fn(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,16)},set:function(r){r?this.Ff=hn(this.Ff,16):this.Ff=fn(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,17)},set:function(r){r?this.Ff=hn(this.Ff,17):this.Ff=fn(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,26)},set:function(r){r?this.Ff=hn(this.Ff,26):this.Ff=fn(this.Ff,26)}});var t,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(i){return i};if(this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var n,s=[];for(n in s.push("<<"),e)s.push("/"+n+" ("+_i(r(e[n]))+")");return s.push(">>"),s.join(`
`)}},set:function(r){br(r)==="object"&&(e=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(r){typeof r=="string"&&(e.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(r){t="/"+r}})};ca(Tn,Ra);var zc=function(){Tn.call(this),this.pushButton=!0};ca(zc,Tn);var ao=function(){Tn.call(this),this.radio=!0,this.pushButton=!1;var t=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e!==void 0?e:[]}})};ca(ao,Tn);var nu=function(){var t,e;Ra.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return t},set:function(s){t=s}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(s){e=s}});var r,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var s=function(l){return l};this.scope&&(s=this.scope.internal.getEncryptor(this.objId));var i,o=[];for(i in o.push("<<"),n)o.push("/"+i+" ("+_i(s(n[i]))+")");return o.push(">>"),o.join(`
`)},set:function(s){br(s)==="object"&&(n=s)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(s){typeof s=="string"&&(n.CA=s)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(s){r=s}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(s){r="/"+s}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=jt.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};ca(nu,Ra),ao.prototype.setAppearance=function(t){if(!("createAppearanceStream"in t)||!("getCA"in t))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var r=this.Kids[e];r.appearanceStreamContent=t.createAppearanceStream(r.optionName),r.caption=t.getCA()}},ao.prototype.createOption=function(t){var e=new nu;return e.Parent=this,e.optionName=t,this.Kids.push(e),Lb.call(this.scope,e),e};var $c=function(){Tn.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=jt.CheckBox.createAppearanceStream()};ca($c,Tn);var fi=function(){Ra.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,13)},set:function(e){e?this.Ff=hn(this.Ff,13):this.Ff=fn(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,21)},set:function(e){e?this.Ff=hn(this.Ff,21):this.Ff=fn(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,23)},set:function(e){e?this.Ff=hn(this.Ff,23):this.Ff=fn(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,24)},set:function(e){e?this.Ff=hn(this.Ff,24):this.Ff=fn(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,25)},set:function(e){e?this.Ff=hn(this.Ff,25):this.Ff=fn(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,26)},set:function(e){e?this.Ff=hn(this.Ff,26):this.Ff=fn(this.Ff,26)}});var t=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return t},set:function(e){Number.isInteger(e)&&(t=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};ca(fi,Ra);var Hc=function(){fi.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!dn(this.Ff,14)},set:function(t){t?this.Ff=hn(this.Ff,14):this.Ff=fn(this.Ff,14)}}),this.password=!0};ca(Hc,fi);var jt={CheckBox:{createAppearanceStream:function(){return{N:{On:jt.CheckBox.YesNormal},D:{On:jt.CheckBox.YesPushDown,Off:jt.CheckBox.OffPushDown}}},YesPushDown:function(t){var e=Ga(t);e.scope=t.scope;var r=[],n=t.scope.internal.getFont(t.fontName,t.fontStyle).id,s=t.scope.__private__.encodeColorString(t.color),i=lh(t,t.caption);return r.push("0.749023 g"),r.push("0 0 "+zt(jt.internal.getWidth(t))+" "+zt(jt.internal.getHeight(t))+" re"),r.push("f"),r.push("BMC"),r.push("q"),r.push("0 0 1 rg"),r.push("/"+n+" "+zt(i.fontSize)+" Tf "+s),r.push("BT"),r.push(i.text),r.push("ET"),r.push("Q"),r.push("EMC"),e.stream=r.join(`
`),e},YesNormal:function(t){var e=Ga(t);e.scope=t.scope;var r=t.scope.internal.getFont(t.fontName,t.fontStyle).id,n=t.scope.__private__.encodeColorString(t.color),s=[],i=jt.internal.getHeight(t),o=jt.internal.getWidth(t),l=lh(t,t.caption);return s.push("1 g"),s.push("0 0 "+zt(o)+" "+zt(i)+" re"),s.push("f"),s.push("q"),s.push("0 0 1 rg"),s.push("0 0 "+zt(o-1)+" "+zt(i-1)+" re"),s.push("W"),s.push("n"),s.push("0 g"),s.push("BT"),s.push("/"+r+" "+zt(l.fontSize)+" Tf "+n),s.push(l.text),s.push("ET"),s.push("Q"),e.stream=s.join(`
`),e},OffPushDown:function(t){var e=Ga(t);e.scope=t.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+zt(jt.internal.getWidth(t))+" "+zt(jt.internal.getHeight(t))+" re"),r.push("f"),e.stream=r.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(t){var e={D:{Off:jt.RadioButton.Circle.OffPushDown},N:{}};return e.N[t]=jt.RadioButton.Circle.YesNormal,e.D[t]=jt.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(t){var e=Ga(t);e.scope=t.scope;var r=[],n=jt.internal.getWidth(t)<=jt.internal.getHeight(t)?jt.internal.getWidth(t)/4:jt.internal.getHeight(t)/4;n=Number((.9*n).toFixed(5));var s=jt.internal.Bezier_C,i=Number((n*s).toFixed(5));return r.push("q"),r.push("1 0 0 1 "+Ms(jt.internal.getWidth(t)/2)+" "+Ms(jt.internal.getHeight(t)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+i+" "+i+" "+n+" 0 "+n+" c"),r.push("-"+i+" "+n+" -"+n+" "+i+" -"+n+" 0 c"),r.push("-"+n+" -"+i+" -"+i+" -"+n+" 0 -"+n+" c"),r.push(i+" -"+n+" "+n+" -"+i+" "+n+" 0 c"),r.push("f"),r.push("Q"),e.stream=r.join(`
`),e},YesPushDown:function(t){var e=Ga(t);e.scope=t.scope;var r=[],n=jt.internal.getWidth(t)<=jt.internal.getHeight(t)?jt.internal.getWidth(t)/4:jt.internal.getHeight(t)/4;n=Number((.9*n).toFixed(5));var s=Number((2*n).toFixed(5)),i=Number((s*jt.internal.Bezier_C).toFixed(5)),o=Number((n*jt.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+Ms(jt.internal.getWidth(t)/2)+" "+Ms(jt.internal.getHeight(t)/2)+" cm"),r.push(s+" 0 m"),r.push(s+" "+i+" "+i+" "+s+" 0 "+s+" c"),r.push("-"+i+" "+s+" -"+s+" "+i+" -"+s+" 0 c"),r.push("-"+s+" -"+i+" -"+i+" -"+s+" 0 -"+s+" c"),r.push(i+" -"+s+" "+s+" -"+i+" "+s+" 0 c"),r.push("f"),r.push("Q"),r.push("0 g"),r.push("q"),r.push("1 0 0 1 "+Ms(jt.internal.getWidth(t)/2)+" "+Ms(jt.internal.getHeight(t)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),r.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),r.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),r.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),r.push("f"),r.push("Q"),e.stream=r.join(`
`),e},OffPushDown:function(t){var e=Ga(t);e.scope=t.scope;var r=[],n=jt.internal.getWidth(t)<=jt.internal.getHeight(t)?jt.internal.getWidth(t)/4:jt.internal.getHeight(t)/4;n=Number((.9*n).toFixed(5));var s=Number((2*n).toFixed(5)),i=Number((s*jt.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+Ms(jt.internal.getWidth(t)/2)+" "+Ms(jt.internal.getHeight(t)/2)+" cm"),r.push(s+" 0 m"),r.push(s+" "+i+" "+i+" "+s+" 0 "+s+" c"),r.push("-"+i+" "+s+" -"+s+" "+i+" -"+s+" 0 c"),r.push("-"+s+" -"+i+" -"+i+" -"+s+" 0 -"+s+" c"),r.push(i+" -"+s+" "+s+" -"+i+" "+s+" 0 c"),r.push("f"),r.push("Q"),e.stream=r.join(`
`),e}},Cross:{createAppearanceStream:function(t){var e={D:{Off:jt.RadioButton.Cross.OffPushDown},N:{}};return e.N[t]=jt.RadioButton.Cross.YesNormal,e.D[t]=jt.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(t){var e=Ga(t);e.scope=t.scope;var r=[],n=jt.internal.calculateCross(t);return r.push("q"),r.push("1 1 "+zt(jt.internal.getWidth(t)-2)+" "+zt(jt.internal.getHeight(t)-2)+" re"),r.push("W"),r.push("n"),r.push(zt(n.x1.x)+" "+zt(n.x1.y)+" m"),r.push(zt(n.x2.x)+" "+zt(n.x2.y)+" l"),r.push(zt(n.x4.x)+" "+zt(n.x4.y)+" m"),r.push(zt(n.x3.x)+" "+zt(n.x3.y)+" l"),r.push("s"),r.push("Q"),e.stream=r.join(`
`),e},YesPushDown:function(t){var e=Ga(t);e.scope=t.scope;var r=jt.internal.calculateCross(t),n=[];return n.push("0.749023 g"),n.push("0 0 "+zt(jt.internal.getWidth(t))+" "+zt(jt.internal.getHeight(t))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+zt(jt.internal.getWidth(t)-2)+" "+zt(jt.internal.getHeight(t)-2)+" re"),n.push("W"),n.push("n"),n.push(zt(r.x1.x)+" "+zt(r.x1.y)+" m"),n.push(zt(r.x2.x)+" "+zt(r.x2.y)+" l"),n.push(zt(r.x4.x)+" "+zt(r.x4.y)+" m"),n.push(zt(r.x3.x)+" "+zt(r.x3.y)+" l"),n.push("s"),n.push("Q"),e.stream=n.join(`
`),e},OffPushDown:function(t){var e=Ga(t);e.scope=t.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+zt(jt.internal.getWidth(t))+" "+zt(jt.internal.getHeight(t))+" re"),r.push("f"),e.stream=r.join(`
`),e}}},createDefaultAppearanceStream:function(t){var e=t.scope.internal.getFont(t.fontName,t.fontStyle).id,r=t.scope.__private__.encodeColorString(t.color);return"/"+e+" "+t.fontSize+" Tf "+r}};jt.internal={Bezier_C:.551915024494,calculateCross:function(t){var e=jt.internal.getWidth(t),r=jt.internal.getHeight(t),n=Math.min(e,r);return{x1:{x:(e-n)/2,y:(r-n)/2+n},x2:{x:(e-n)/2+n,y:(r-n)/2},x3:{x:(e-n)/2,y:(r-n)/2},x4:{x:(e-n)/2+n,y:(r-n)/2+n}}}},jt.internal.getWidth=function(t){var e=0;return br(t)==="object"&&(e=Sp(t.Rect[2])),e},jt.internal.getHeight=function(t){var e=0;return br(t)==="object"&&(e=Sp(t.Rect[3])),e};var Lb=rn.addField=function(t){if(Ab(this,t),!(t instanceof Ra))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=t).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),t.page=t.scope.internal.getCurrentPageInfo().pageNumber,this};rn.AcroFormChoiceField=to,rn.AcroFormListBox=ro,rn.AcroFormComboBox=no,rn.AcroFormEditBox=Wc,rn.AcroFormButton=Tn,rn.AcroFormPushButton=zc,rn.AcroFormRadioButton=ao,rn.AcroFormCheckBox=$c,rn.AcroFormTextField=fi,rn.AcroFormPasswordField=Hc,rn.AcroFormAppearance=jt,rn.AcroForm={ChoiceField:to,ListBox:ro,ComboBox:no,EditBox:Wc,Button:Tn,PushButton:zc,RadioButton:ao,CheckBox:$c,TextField:fi,PasswordField:Hc,Appearance:jt},Tt.AcroForm={ChoiceField:to,ListBox:ro,ComboBox:no,EditBox:Wc,Button:Tn,PushButton:zc,RadioButton:ao,CheckBox:$c,TextField:fi,PasswordField:Hc,Appearance:jt};Tt.AcroForm;function zg(t){return t.reduce(function(e,r,n){return e[r]=n,e},{})}(function(t){t.__addimage__={};var e="UNKNOWN",r={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},n=t.__addimage__.getImageFileTypeByImageData=function(P,L){var te,W,z,V,Y,E=e;if((L=L||e)==="RGBA"||P.data!==void 0&&P.data instanceof Uint8ClampedArray&&"height"in P&&"width"in P)return"RGBA";if(F(P))for(Y in r)for(z=r[Y],te=0;te<z.length;te+=1){for(V=!0,W=0;W<z[te].length;W+=1)if(z[te][W]!==void 0&&z[te][W]!==P[W]){V=!1;break}if(V===!0){E=Y;break}}else for(Y in r)for(z=r[Y],te=0;te<z.length;te+=1){for(V=!0,W=0;W<z[te].length;W+=1)if(z[te][W]!==void 0&&z[te][W]!==P.charCodeAt(W)){V=!1;break}if(V===!0){E=Y;break}}return E===e&&L!==e&&(E=L),E},s=function P(L){for(var te=this.internal.write,W=this.internal.putStream,z=(0,this.internal.getFilters)();z.indexOf("FlateEncode")!==-1;)z.splice(z.indexOf("FlateEncode"),1);L.objectId=this.internal.newObject();var V=[];if(V.push({key:"Type",value:"/XObject"}),V.push({key:"Subtype",value:"/Image"}),V.push({key:"Width",value:L.width}),V.push({key:"Height",value:L.height}),L.colorSpace===y.INDEXED?V.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(L.palette.length/3-1)+" "+("sMask"in L&&L.sMask!==void 0?L.objectId+2:L.objectId+1)+" 0 R]"}):(V.push({key:"ColorSpace",value:"/"+L.colorSpace}),L.colorSpace===y.DEVICE_CMYK&&V.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),V.push({key:"BitsPerComponent",value:L.bitsPerComponent}),"decodeParameters"in L&&L.decodeParameters!==void 0&&V.push({key:"DecodeParms",value:"<<"+L.decodeParameters+">>"}),"transparency"in L&&Array.isArray(L.transparency)){for(var Y="",E=0,X=L.transparency.length;E<X;E++)Y+=L.transparency[E]+" "+L.transparency[E]+" ";V.push({key:"Mask",value:"["+Y+"]"})}L.sMask!==void 0&&V.push({key:"SMask",value:L.objectId+1+" 0 R"});var oe=L.filter!==void 0?["/"+L.filter]:void 0;if(W({data:L.data,additionalKeyValues:V,alreadyAppliedFilters:oe,objectId:L.objectId}),te("endobj"),"sMask"in L&&L.sMask!==void 0){var de="/Predictor "+L.predictor+" /Colors 1 /BitsPerComponent "+L.bitsPerComponent+" /Columns "+L.width,A={width:L.width,height:L.height,colorSpace:"DeviceGray",bitsPerComponent:L.bitsPerComponent,decodeParameters:de,data:L.sMask};"filter"in L&&(A.filter=L.filter),P.call(this,A)}if(L.colorSpace===y.INDEXED){var D=this.internal.newObject();W({data:C(new Uint8Array(L.palette)),objectId:D}),te("endobj")}},i=function(){var P=this.internal.collections.addImage_images;for(var L in P)s.call(this,P[L])},o=function(){var P,L=this.internal.collections.addImage_images,te=this.internal.write;for(var W in L)te("/I"+(P=L[W]).index,P.objectId,"0","R")},l=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",i),this.internal.events.subscribe("putXobjectDict",o))},u=function(){var P=this.internal.collections.addImage_images;return l.call(this),P},d=function(){return Object.keys(this.internal.collections.addImage_images).length},f=function(P){return typeof t["process"+P.toUpperCase()]=="function"},m=function(P){return br(P)==="object"&&P.nodeType===1},v=function(P,L){if(P.nodeName==="IMG"&&P.hasAttribute("src")){var te=""+P.getAttribute("src");if(te.indexOf("data:image/")===0)return Pl(unescape(te).split("base64,").pop());var W=t.loadFile(te,!0);if(W!==void 0)return W}if(P.nodeName==="CANVAS"){if(P.width===0||P.height===0)throw new Error("Given canvas must have data. Canvas width: "+P.width+", height: "+P.height);var z;switch(L){case"PNG":z="image/png";break;case"WEBP":z="image/webp";break;case"JPEG":case"JPG":default:z="image/jpeg"}return Pl(P.toDataURL(z,1).split("base64,").pop())}},p=function(P){var L=this.internal.collections.addImage_images;if(L){for(var te in L)if(P===L[te].alias)return L[te]}},b=function(P,L,te){return P||L||(P=-96,L=-96),P<0&&(P=-1*te.width*72/P/this.internal.scaleFactor),L<0&&(L=-1*te.height*72/L/this.internal.scaleFactor),P===0&&(P=L*te.width/te.height),L===0&&(L=P*te.height/te.width),[P,L]},w=function(P,L,te,W,z,V){var Y=b.call(this,te,W,z),E=this.internal.getCoordinateString,X=this.internal.getVerticalCoordinateString,oe=u.call(this);if(te=Y[0],W=Y[1],oe[z.index]=z,V){V*=Math.PI/180;var de=Math.cos(V),A=Math.sin(V),D=function(re){return re.toFixed(4)},J=[D(de),D(A),D(-1*A),D(de),0,0,"cm"]}this.internal.write("q"),V?(this.internal.write([1,"0","0",1,E(P),X(L+W),"cm"].join(" ")),this.internal.write(J.join(" ")),this.internal.write([E(te),"0","0",E(W),"0","0","cm"].join(" "))):this.internal.write([E(te),"0","0",E(W),E(P),X(L+W),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+z.index+" Do"),this.internal.write("Q")},y=t.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};t.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var j=t.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},O=t.__addimage__.sHashCode=function(P){var L,te,W=0;if(typeof P=="string")for(te=P.length,L=0;L<te;L++)W=(W<<5)-W+P.charCodeAt(L),W|=0;else if(F(P))for(te=P.byteLength/2,L=0;L<te;L++)W=(W<<5)-W+P[L],W|=0;return W},k=t.__addimage__.validateStringAsBase64=function(P){(P=P||"").toString().trim();var L=!0;return P.length===0&&(L=!1),P.length%4!=0&&(L=!1),/^[A-Za-z0-9+/]+$/.test(P.substr(0,P.length-2))===!1&&(L=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(P.substr(-2))===!1&&(L=!1),L},I=t.__addimage__.extractImageFromDataUrl=function(P){if(P==null||!(P=P.trim()).startsWith("data:"))return null;var L=P.indexOf(",");return L<0?null:P.substring(0,L).trim().endsWith("base64")?P.substring(L+1):null},H=t.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};t.__addimage__.isArrayBuffer=function(P){return H()&&P instanceof ArrayBuffer};var F=t.__addimage__.isArrayBufferView=function(P){return H()&&typeof Uint32Array<"u"&&(P instanceof Int8Array||P instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&P instanceof Uint8ClampedArray||P instanceof Int16Array||P instanceof Uint16Array||P instanceof Int32Array||P instanceof Uint32Array||P instanceof Float32Array||P instanceof Float64Array)},U=t.__addimage__.binaryStringToUint8Array=function(P){for(var L=P.length,te=new Uint8Array(L),W=0;W<L;W++)te[W]=P.charCodeAt(W);return te},C=t.__addimage__.arrayBufferToBinaryString=function(P){for(var L="",te=F(P)?P:new Uint8Array(P),W=0;W<te.length;W+=8192)L+=String.fromCharCode.apply(null,te.subarray(W,W+8192));return L};t.addImage=function(){var P,L,te,W,z,V,Y,E,X;if(typeof arguments[1]=="number"?(L=e,te=arguments[1],W=arguments[2],z=arguments[3],V=arguments[4],Y=arguments[5],E=arguments[6],X=arguments[7]):(L=arguments[1],te=arguments[2],W=arguments[3],z=arguments[4],V=arguments[5],Y=arguments[6],E=arguments[7],X=arguments[8]),br(P=arguments[0])==="object"&&!m(P)&&"imageData"in P){var oe=P;P=oe.imageData,L=oe.format||L||e,te=oe.x||te||0,W=oe.y||W||0,z=oe.w||oe.width||z,V=oe.h||oe.height||V,Y=oe.alias||Y,E=oe.compression||E,X=oe.rotation||oe.angle||X}var de=this.internal.getFilters();if(E===void 0&&de.indexOf("FlateEncode")!==-1&&(E="SLOW"),isNaN(te)||isNaN(W))throw new Error("Invalid coordinates passed to jsPDF.addImage");l.call(this);var A=N.call(this,P,L,Y,E);return w.call(this,te,W,z,V,A,X),this};var N=function(P,L,te,W){var z,V,Y;if(typeof P=="string"&&n(P)===e){P=unescape(P);var E=Q(P,!1);(E!==""||(E=t.loadFile(P,!0))!==void 0)&&(P=E)}if(m(P)&&(P=v(P,L)),L=n(P,L),!f(L))throw new Error("addImage does not support files of type '"+L+"', please ensure that a plugin for '"+L+"' support is added.");if(((Y=te)==null||Y.length===0)&&(te=function(X){return typeof X=="string"||F(X)?O(X):F(X.data)?O(X.data):null}(P)),(z=p.call(this,te))||(H()&&(P instanceof Uint8Array||L==="RGBA"||(V=P,P=U(P))),z=this["process"+L.toUpperCase()](P,d.call(this),te,function(X){return X&&typeof X=="string"&&(X=X.toUpperCase()),X in t.image_compression?X:j.NONE}(W),V)),!z)throw new Error("An unknown error occurred whilst processing the image.");return z},Q=t.__addimage__.convertBase64ToBinaryString=function(P,L){L=typeof L!="boolean"||L;var te,W="";if(typeof P=="string"){var z;te=(z=I(P))!==null&&z!==void 0?z:P;try{W=Pl(te)}catch(V){if(L)throw k(te)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+V.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return W};t.getImageProperties=function(P){var L,te,W="";if(m(P)&&(P=v(P)),typeof P=="string"&&n(P)===e&&((W=Q(P,!1))===""&&(W=t.loadFile(P)||""),P=W),te=n(P),!f(te))throw new Error("addImage does not support files of type '"+te+"', please ensure that a plugin for '"+te+"' support is added.");if(!H()||P instanceof Uint8Array||(P=U(P)),!(L=this["process"+te.toUpperCase()](P)))throw new Error("An unknown error occurred whilst processing the image");return L.fileType=te,L}})(Tt.API),function(t){var e=function(r){if(r!==void 0&&r!="")return!0};Tt.API.events.push(["addPage",function(r){this.internal.getPageInfo(r.pageNumber).pageContext.annotations=[]}]),t.events.push(["putPage",function(r){for(var n,s,i,o=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,u=this.internal.getPageInfoByObjId(r.objId),d=r.pageContext.annotations,f=!1,m=0;m<d.length&&!f;m++)switch((n=d[m]).type){case"link":(e(n.options.url)||e(n.options.pageNumber))&&(f=!0);break;case"reference":case"text":case"freetext":f=!0}if(f!=0){this.internal.write("/Annots [");for(var v=0;v<d.length;v++){n=d[v];var p=this.internal.pdfEscape,b=this.internal.getEncryptor(r.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var w=this.internal.newAdditionalObject(),y=this.internal.newAdditionalObject(),j=this.internal.getEncryptor(w.objId),O=n.title||"Note";i="<</Type /Annot /Subtype /Text "+(s="/Rect ["+o(n.bounds.x)+" "+l(n.bounds.y+n.bounds.h)+" "+o(n.bounds.x+n.bounds.w)+" "+l(n.bounds.y)+"] ")+"/Contents ("+p(j(n.contents))+")",i+=" /Popup "+y.objId+" 0 R",i+=" /P "+u.objId+" 0 R",i+=" /T ("+p(j(O))+") >>",w.content=i;var k=w.objId+" 0 R";i="<</Type /Annot /Subtype /Popup "+(s="/Rect ["+o(n.bounds.x+30)+" "+l(n.bounds.y+n.bounds.h)+" "+o(n.bounds.x+n.bounds.w+30)+" "+l(n.bounds.y)+"] ")+" /Parent "+k,n.open&&(i+=" /Open true"),i+=" >>",y.content=i,this.internal.write(w.objId,"0 R",y.objId,"0 R");break;case"freetext":s="/Rect ["+o(n.bounds.x)+" "+l(n.bounds.y)+" "+o(n.bounds.x+n.bounds.w)+" "+l(n.bounds.y+n.bounds.h)+"] ";var I=n.color||"#000000";i="<</Type /Annot /Subtype /FreeText "+s+"/Contents ("+p(b(n.contents))+")",i+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+I+")",i+=" /Border [0 0 0]",i+=" >>",this.internal.write(i);break;case"link":if(n.options.name){var H=this.annotations._nameMap[n.options.name];n.options.pageNumber=H.page,n.options.top=H.y}else n.options.top||(n.options.top=0);if(s="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",i="",n.options.url)i="<</Type /Annot /Subtype /Link "+s+"/Border [0 0 0] /A <</S /URI /URI ("+p(b(n.options.url))+") >>";else if(n.options.pageNumber)switch(i="<</Type /Annot /Subtype /Link "+s+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":i+=" /Fit]";break;case"FitH":i+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,i+=" /FitV "+n.options.left+"]";break;case"XYZ":default:var F=l(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),i+=" /XYZ "+n.options.left+" "+F+" "+n.options.zoom+"]"}i!=""&&(i+=" >>",this.internal.write(i))}}this.internal.write("]")}}]),t.createAnnotation=function(r){var n=this.internal.getCurrentPageInfo();switch(r.type){case"link":this.link(r.bounds.x,r.bounds.y,r.bounds.w,r.bounds.h,r);break;case"text":case"freetext":n.pageContext.annotations.push(r)}},t.link=function(r,n,s,i,o){var l=this.internal.getCurrentPageInfo(),u=this.internal.getCoordinateString,d=this.internal.getVerticalCoordinateString;l.pageContext.annotations.push({finalBounds:{x:u(r),y:d(n),w:u(r+s),h:d(n+i)},options:o,type:"link"})},t.textWithLink=function(r,n,s,i){var o,l,u=this.getTextWidth(r),d=this.internal.getLineHeight()/this.internal.scaleFactor;if(i.maxWidth!==void 0){l=i.maxWidth;var f=this.splitTextToSize(r,l).length;o=Math.ceil(d*f)}else l=u,o=d;return this.text(r,n,s,i),s+=.2*d,i.align==="center"&&(n-=u/2),i.align==="right"&&(n-=u),this.link(n,s-d,l,o,i),u},t.getTextWidth=function(r){var n=this.internal.getFontSize();return this.getStringUnitWidth(r)*n/this.internal.scaleFactor}}(Tt.API),function(t){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},r={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},s=[1570,1571,1573,1575];t.__arabicParser__={};var i=t.__arabicParser__.isInArabicSubstitutionA=function(w){return e[w.charCodeAt(0)]!==void 0},o=t.__arabicParser__.isArabicLetter=function(w){return typeof w=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(w)},l=t.__arabicParser__.isArabicEndLetter=function(w){return o(w)&&i(w)&&e[w.charCodeAt(0)].length<=2},u=t.__arabicParser__.isArabicAlfLetter=function(w){return o(w)&&s.indexOf(w.charCodeAt(0))>=0};t.__arabicParser__.arabicLetterHasIsolatedForm=function(w){return o(w)&&i(w)&&e[w.charCodeAt(0)].length>=1};var d=t.__arabicParser__.arabicLetterHasFinalForm=function(w){return o(w)&&i(w)&&e[w.charCodeAt(0)].length>=2};t.__arabicParser__.arabicLetterHasInitialForm=function(w){return o(w)&&i(w)&&e[w.charCodeAt(0)].length>=3};var f=t.__arabicParser__.arabicLetterHasMedialForm=function(w){return o(w)&&i(w)&&e[w.charCodeAt(0)].length==4},m=t.__arabicParser__.resolveLigatures=function(w){var y=0,j=r,O="",k=0;for(y=0;y<w.length;y+=1)j[w.charCodeAt(y)]!==void 0?(k++,typeof(j=j[w.charCodeAt(y)])=="number"&&(O+=String.fromCharCode(j),j=r,k=0),y===w.length-1&&(j=r,O+=w.charAt(y-(k-1)),y-=k-1,k=0)):(j=r,O+=w.charAt(y-k),y-=k,k=0);return O};t.__arabicParser__.isArabicDiacritic=function(w){return w!==void 0&&n[w.charCodeAt(0)]!==void 0};var v=t.__arabicParser__.getCorrectForm=function(w,y,j){return o(w)?i(w)===!1?-1:!d(w)||!o(y)&&!o(j)||!o(j)&&l(y)||l(w)&&!o(y)||l(w)&&u(y)||l(w)&&l(y)?0:f(w)&&o(y)&&!l(y)&&o(j)&&d(j)?3:l(w)||!o(j)?1:2:-1},p=function(w){var y=0,j=0,O=0,k="",I="",H="",F=(w=w||"").split("\\s+"),U=[];for(y=0;y<F.length;y+=1){for(U.push(""),j=0;j<F[y].length;j+=1)k=F[y][j],I=F[y][j-1],H=F[y][j+1],o(k)?(O=v(k,I,H),U[y]+=O!==-1?String.fromCharCode(e[k.charCodeAt(0)][O]):k):U[y]+=k;U[y]=m(U[y])}return U.join(" ")},b=t.__arabicParser__.processArabic=t.processArabic=function(){var w,y=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,j=[];if(Array.isArray(y)){var O=0;for(j=[],O=0;O<y.length;O+=1)Array.isArray(y[O])?j.push([p(y[O][0]),y[O][1],y[O][2]]):j.push([p(y[O])]);w=j}else w=p(y);return typeof arguments[0]=="string"?w:(arguments[0].text=w,arguments[0])};t.events.push(["preProcessText",b])}(Tt.API),Tt.API.autoPrint=function(t){var e;switch((t=t||{}).variant=t.variant||"non-conform",t.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})}return this},function(t){var e=function(){var r=void 0;Object.defineProperty(this,"pdf",{get:function(){return r},set:function(l){r=l}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(l){n=isNaN(l)||Number.isInteger(l)===!1||l<0?150:l,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var s=300;Object.defineProperty(this,"height",{get:function(){return s},set:function(l){s=isNaN(l)||Number.isInteger(l)===!1||l<0?300:l,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=s+1)}});var i=[];Object.defineProperty(this,"childNodes",{get:function(){return i},set:function(l){i=l}});var o={};Object.defineProperty(this,"style",{get:function(){return o},set:function(l){o=l}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(r,n){var s;if((r=r||"2d")!=="2d")return null;for(s in n)this.pdf.context2d.hasOwnProperty(s)&&(this.pdf.context2d[s]=n[s]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},t.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])}(Tt.API),function(t){var e={left:0,top:0,bottom:0,right:0},r=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),s.call(this))},s=function(){this.internal.__cell__.lastCell=new i,this.internal.__cell__.pages=1},i=function(){var u=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return u},set:function(w){u=w}});var d=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return d},set:function(w){d=w}});var f=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return f},set:function(w){f=w}});var m=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return m},set:function(w){m=w}});var v=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return v},set:function(w){v=w}});var p=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return p},set:function(w){p=w}});var b=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return b},set:function(w){b=w}}),this};i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},i.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},t.setHeaderFunction=function(u){return n.call(this),this.internal.__cell__.headerFunction=typeof u=="function"?u:void 0,this},t.getTextDimensions=function(u,d){n.call(this);var f=(d=d||{}).fontSize||this.getFontSize(),m=d.font||this.getFont(),v=d.scaleFactor||this.internal.scaleFactor,p=0,b=0,w=0,y=this;if(!Array.isArray(u)&&typeof u!="string"){if(typeof u!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");u=String(u)}var j=d.maxWidth;j>0?typeof u=="string"?u=this.splitTextToSize(u,j):Object.prototype.toString.call(u)==="[object Array]"&&(u=u.reduce(function(k,I){return k.concat(y.splitTextToSize(I,j))},[])):u=Array.isArray(u)?u:[u];for(var O=0;O<u.length;O++)p<(w=this.getStringUnitWidth(u[O],{font:m})*f)&&(p=w);return p!==0&&(b=u.length),{w:p/=v,h:Math.max((b*f*this.getLineHeightFactor()-f*(this.getLineHeightFactor()-1))/v,0)}},t.cellAddPage=function(){n.call(this),this.addPage();var u=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new i(u.left,u.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var o=t.cell=function(){var u;u=arguments[0]instanceof i?arguments[0]:new i(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var d=this.internal.__cell__.lastCell,f=this.internal.__cell__.padding,m=this.internal.__cell__.margins||e,v=this.internal.__cell__.tableHeaderRow,p=this.internal.__cell__.printHeaders;return d.lineNumber!==void 0&&(d.lineNumber===u.lineNumber?(u.x=(d.x||0)+(d.width||0),u.y=d.y||0):d.y+d.height+u.height+m.bottom>this.getPageHeight()?(this.cellAddPage(),u.y=m.top,p&&v&&(this.printHeaderRow(u.lineNumber,!0),u.y+=v[0].height)):u.y=d.y+d.height||u.y),u.text[0]!==void 0&&(this.rect(u.x,u.y,u.width,u.height,r===!0?"FD":void 0),u.align==="right"?this.text(u.text,u.x+u.width-f,u.y+f,{align:"right",baseline:"top"}):u.align==="center"?this.text(u.text,u.x+u.width/2,u.y+f,{align:"center",baseline:"top",maxWidth:u.width-f-f}):this.text(u.text,u.x+f,u.y+f,{align:"left",baseline:"top",maxWidth:u.width-f-f})),this.internal.__cell__.lastCell=u,this};t.table=function(u,d,f,m,v){if(n.call(this),!f)throw new Error("No data for PDF table.");var p,b,w,y,j=[],O=[],k=[],I={},H={},F=[],U=[],C=(v=v||{}).autoSize||!1,N=v.printHeaders!==!1,Q=v.css&&v.css["font-size"]!==void 0?16*v.css["font-size"]:v.fontSize||12,P=v.margins||Object.assign({width:this.getPageWidth()},e),L=typeof v.padding=="number"?v.padding:3,te=v.headerBackgroundColor||"#c8c8c8",W=v.headerTextColor||"#000";if(s.call(this),this.internal.__cell__.printHeaders=N,this.internal.__cell__.margins=P,this.internal.__cell__.table_font_size=Q,this.internal.__cell__.padding=L,this.internal.__cell__.headerBackgroundColor=te,this.internal.__cell__.headerTextColor=W,this.setFontSize(Q),m==null)O=j=Object.keys(f[0]),k=j.map(function(){return"left"});else if(Array.isArray(m)&&br(m[0])==="object")for(j=m.map(function(oe){return oe.name}),O=m.map(function(oe){return oe.prompt||oe.name||""}),k=m.map(function(oe){return oe.align||"left"}),p=0;p<m.length;p+=1)H[m[p].name]=m[p].width*(19.049976/25.4);else Array.isArray(m)&&typeof m[0]=="string"&&(O=j=m,k=j.map(function(){return"left"}));if(C||Array.isArray(m)&&typeof m[0]=="string")for(p=0;p<j.length;p+=1){for(I[y=j[p]]=f.map(function(oe){return oe[y]}),this.setFont(void 0,"bold"),F.push(this.getTextDimensions(O[p],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),b=I[y],this.setFont(void 0,"normal"),w=0;w<b.length;w+=1)F.push(this.getTextDimensions(b[w],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);H[y]=Math.max.apply(null,F)+L+L,F=[]}if(N){var z={};for(p=0;p<j.length;p+=1)z[j[p]]={},z[j[p]].text=O[p],z[j[p]].align=k[p];var V=l.call(this,z,H);U=j.map(function(oe){return new i(u,d,H[oe],V,z[oe].text,void 0,z[oe].align)}),this.setTableHeaderRow(U),this.printHeaderRow(1,!1)}var Y=m.reduce(function(oe,de){return oe[de.name]=de.align,oe},{});for(p=0;p<f.length;p+=1){"rowStart"in v&&v.rowStart instanceof Function&&v.rowStart({row:p,data:f[p]},this);var E=l.call(this,f[p],H);for(w=0;w<j.length;w+=1){var X=f[p][j[w]];"cellStart"in v&&v.cellStart instanceof Function&&v.cellStart({row:p,col:w,data:X},this),o.call(this,new i(u,d,H[j[w]],E,X,p+2,Y[j[w]]))}}return this.internal.__cell__.table_x=u,this.internal.__cell__.table_y=d,this};var l=function(u,d){var f=this.internal.__cell__.padding,m=this.internal.__cell__.table_font_size,v=this.internal.scaleFactor;return Object.keys(u).map(function(p){var b=u[p];return this.splitTextToSize(b.hasOwnProperty("text")?b.text:b,d[p]-f-f)},this).map(function(p){return this.getLineHeightFactor()*p.length*m/v+f+f},this).reduce(function(p,b){return Math.max(p,b)},0)};t.setTableHeaderRow=function(u){n.call(this),this.internal.__cell__.tableHeaderRow=u},t.printHeaderRow=function(u,d){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var f;if(r=!0,typeof this.internal.__cell__.headerFunction=="function"){var m=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new i(m[0],m[1],m[2],m[3],void 0,-1)}this.setFont(void 0,"bold");for(var v=[],p=0;p<this.internal.__cell__.tableHeaderRow.length;p+=1){f=this.internal.__cell__.tableHeaderRow[p].clone(),d&&(f.y=this.internal.__cell__.margins.top||0,v.push(f)),f.lineNumber=u;var b=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),o.call(this,f),this.setTextColor(b)}v.length>0&&this.setTableHeaderRow(v),this.setFont(void 0,"normal"),r=!1}}(Tt.API);var $g={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},Hg=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],ch=zg(Hg),Yg=[100,200,300,400,500,600,700,800,900],Nb=zg(Yg);function uh(t){var e=t.family.replace(/"|'/g,"").toLowerCase(),r=function(i){return $g[i=i||"normal"]?i:"normal"}(t.style),n=function(i){if(!i)return 400;if(typeof i=="number")return i>=100&&i<=900&&i%100==0?i:400;if(/^\d00$/.test(i))return parseInt(i);switch(i){case"bold":return 700;case"normal":default:return 400}}(t.weight),s=function(i){return typeof ch[i=i||"normal"]=="number"?i:"normal"}(t.stretch);return{family:e,style:r,weight:n,stretch:s,src:t.src||[],ref:t.ref||{name:e,style:[s,r,n].join(" ")}}}function Cp(t,e,r,n){var s;for(s=r;s>=0&&s<e.length;s+=n)if(t[e[s]])return t[e[s]];for(s=r;s>=0&&s<e.length;s-=n)if(t[e[s]])return t[e[s]]}var Eb={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},Pp={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function kp(t){return[t.stretch,t.style,t.weight,t.family].join(" ")}function Ob(t,e,r){for(var n=(r=r||{}).defaultFontFamily||"times",s=Object.assign({},Eb,r.genericFontFamilies||{}),i=null,o=null,l=0;l<e.length;++l)if(s[(i=uh(e[l])).family]&&(i.family=s[i.family]),t.hasOwnProperty(i.family)){o=t[i.family];break}if(!(o=o||t[n]))throw new Error("Could not find a font-family for the rule '"+kp(i)+"' and default family '"+n+"'.");if(o=function(u,d){if(d[u])return d[u];var f=ch[u],m=f<=ch.normal?-1:1,v=Cp(d,Hg,f,m);if(!v)throw new Error("Could not find a matching font-stretch value for "+u);return v}(i.stretch,o),o=function(u,d){if(d[u])return d[u];for(var f=$g[u],m=0;m<f.length;++m)if(d[f[m]])return d[f[m]];throw new Error("Could not find a matching font-style for "+u)}(i.style,o),!(o=function(u,d){if(d[u])return d[u];if(u===400&&d[500])return d[500];if(u===500&&d[400])return d[400];var f=Nb[u],m=Cp(d,Yg,f,u<400?-1:1);if(!m)throw new Error("Could not find a matching font-weight for value "+u);return m}(i.weight,o)))throw new Error("Failed to resolve a font for the rule '"+kp(i)+"'.");return o}function Ap(t){return t.trimLeft()}function Ib(t,e){for(var r=0;r<t.length;){if(t.charAt(r)===e)return[t.substring(0,r),t.substring(r+1)];r+=1}return null}function Db(t){var e=t.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],t.substring(e[0].length)]}var Ac,Lp,Np,Sd=["times"];(function(t){var e,r,n,s,i,o,l,u,d,f=function(A){return A=A||{},this.isStrokeTransparent=A.isStrokeTransparent||!1,this.strokeOpacity=A.strokeOpacity||1,this.strokeStyle=A.strokeStyle||"#000000",this.fillStyle=A.fillStyle||"#000000",this.isFillTransparent=A.isFillTransparent||!1,this.fillOpacity=A.fillOpacity||1,this.font=A.font||"10px sans-serif",this.textBaseline=A.textBaseline||"alphabetic",this.textAlign=A.textAlign||"left",this.lineWidth=A.lineWidth||1,this.lineJoin=A.lineJoin||"miter",this.lineCap=A.lineCap||"butt",this.path=A.path||[],this.transform=A.transform!==void 0?A.transform.clone():new u,this.globalCompositeOperation=A.globalCompositeOperation||"normal",this.globalAlpha=A.globalAlpha||1,this.clip_path=A.clip_path||[],this.currentPoint=A.currentPoint||new o,this.miterLimit=A.miterLimit||10,this.lastPoint=A.lastPoint||new o,this.lineDashOffset=A.lineDashOffset||0,this.lineDash=A.lineDash||[],this.margin=A.margin||[0,0,0,0],this.prevPageLastElemOffset=A.prevPageLastElemOffset||0,this.ignoreClearRect=typeof A.ignoreClearRect!="boolean"||A.ignoreClearRect,this};t.events.push(["initialized",function(){this.context2d=new m(this),e=this.internal.f2,r=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,s=this.internal.getHorizontalCoordinate,i=this.internal.getVerticalCoordinate,o=this.internal.Point,l=this.internal.Rectangle,u=this.internal.Matrix,d=new f}]);var m=function(A){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var D=A;Object.defineProperty(this,"pdf",{get:function(){return D}});var J=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return J},set:function(ne){J=!!ne}});var re=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return re},set:function(ne){re=!!ne}});var ce=0;Object.defineProperty(this,"posX",{get:function(){return ce},set:function(ne){isNaN(ne)||(ce=ne)}});var fe=0;Object.defineProperty(this,"posY",{get:function(){return fe},set:function(ne){isNaN(ne)||(fe=ne)}}),Object.defineProperty(this,"margin",{get:function(){return d.margin},set:function(ne){var R;typeof ne=="number"?R=[ne,ne,ne,ne]:((R=new Array(4))[0]=ne[0],R[1]=ne.length>=2?ne[1]:R[0],R[2]=ne.length>=3?ne[2]:R[0],R[3]=ne.length>=4?ne[3]:R[1]),d.margin=R}});var ee=!1;Object.defineProperty(this,"autoPaging",{get:function(){return ee},set:function(ne){ee=ne}});var ae=0;Object.defineProperty(this,"lastBreak",{get:function(){return ae},set:function(ne){ae=ne}});var pe=[];Object.defineProperty(this,"pageBreaks",{get:function(){return pe},set:function(ne){pe=ne}}),Object.defineProperty(this,"ctx",{get:function(){return d},set:function(ne){ne instanceof f&&(d=ne)}}),Object.defineProperty(this,"path",{get:function(){return d.path},set:function(ne){d.path=ne}});var ye=[];Object.defineProperty(this,"ctxStack",{get:function(){return ye},set:function(ne){ye=ne}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(ne){var R;R=v(ne),this.ctx.fillStyle=R.style,this.ctx.isFillTransparent=R.a===0,this.ctx.fillOpacity=R.a,this.pdf.setFillColor(R.r,R.g,R.b,{a:R.a}),this.pdf.setTextColor(R.r,R.g,R.b,{a:R.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(ne){var R=v(ne);this.ctx.strokeStyle=R.style,this.ctx.isStrokeTransparent=R.a===0,this.ctx.strokeOpacity=R.a,R.a===0?this.pdf.setDrawColor(255,255,255):(R.a,this.pdf.setDrawColor(R.r,R.g,R.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(ne){["butt","round","square"].indexOf(ne)!==-1&&(this.ctx.lineCap=ne,this.pdf.setLineCap(ne))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(ne){isNaN(ne)||(this.ctx.lineWidth=ne,this.pdf.setLineWidth(ne))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(ne){["bevel","round","miter"].indexOf(ne)!==-1&&(this.ctx.lineJoin=ne,this.pdf.setLineJoin(ne))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(ne){isNaN(ne)||(this.ctx.miterLimit=ne,this.pdf.setMiterLimit(ne))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(ne){this.ctx.textBaseline=ne}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(ne){["right","end","center","left","start"].indexOf(ne)!==-1&&(this.ctx.textAlign=ne)}});var Le=null;function se(ne,R){if(Le===null){var be=function(je){var Pe=[];return Object.keys(je).forEach(function(He){je[He].forEach(function(Ye){var nt=null;switch(Ye){case"bold":nt={family:He,weight:"bold"};break;case"italic":nt={family:He,style:"italic"};break;case"bolditalic":nt={family:He,weight:"bold",style:"italic"};break;case"":case"normal":nt={family:He}}nt!==null&&(nt.ref={name:He,style:Ye},Pe.push(nt))})}),Pe}(ne.getFontList());Le=function(je){for(var Pe={},He=0;He<je.length;++He){var Ye=uh(je[He]),nt=Ye.family,dt=Ye.stretch,Ae=Ye.style,Re=Ye.weight;Pe[nt]=Pe[nt]||{},Pe[nt][dt]=Pe[nt][dt]||{},Pe[nt][dt][Ae]=Pe[nt][dt][Ae]||{},Pe[nt][dt][Ae][Re]=Ye}return Pe}(be.concat(R))}return Le}var Fe=null;Object.defineProperty(this,"fontFaces",{get:function(){return Fe},set:function(ne){Le=null,Fe=ne}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(ne){var R;if(this.ctx.font=ne,(R=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(ne))!==null){var be=R[1];R[2];var je=R[3],Pe=R[4];R[5];var He=R[6],Ye=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Pe)[2];Pe=Math.floor(Ye==="px"?parseFloat(Pe)*this.pdf.internal.scaleFactor:Ye==="em"?parseFloat(Pe)*this.pdf.getFontSize():parseFloat(Pe)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Pe);var nt=function(gt){var St,ct,Rt=[],xt=gt.trim();if(xt==="")return Sd;if(xt in Pp)return[Pp[xt]];for(;xt!=="";){switch(ct=null,St=(xt=Ap(xt)).charAt(0)){case'"':case"'":ct=Ib(xt.substring(1),St);break;default:ct=Db(xt)}if(ct===null||(Rt.push(ct[0]),(xt=Ap(ct[1]))!==""&&xt.charAt(0)!==","))return Sd;xt=xt.replace(/^,/,"")}return Rt}(He);if(this.fontFaces){var dt=Ob(se(this.pdf,this.fontFaces),nt.map(function(gt){return{family:gt,stretch:"normal",weight:je,style:be}}));this.pdf.setFont(dt.ref.name,dt.ref.style)}else{var Ae="";(je==="bold"||parseInt(je,10)>=700||be==="bold")&&(Ae="bold"),be==="italic"&&(Ae+="italic"),Ae.length===0&&(Ae="normal");for(var Re="",st={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},it=0;it<nt.length;it++){if(this.pdf.internal.getFont(nt[it],Ae,{noFallback:!0,disableWarning:!0})!==void 0){Re=nt[it];break}if(Ae==="bolditalic"&&this.pdf.internal.getFont(nt[it],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Re=nt[it],Ae="bold";else if(this.pdf.internal.getFont(nt[it],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Re=nt[it],Ae="normal";break}}if(Re===""){for(var Lt=0;Lt<nt.length;Lt++)if(st[nt[Lt]]){Re=st[nt[Lt]];break}}Re=Re===""?"Times":Re,this.pdf.setFont(Re,Ae)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(ne){this.ctx.globalCompositeOperation=ne}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(ne){this.ctx.globalAlpha=ne}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(ne){this.ctx.lineDashOffset=ne,de.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(ne){this.ctx.lineDash=ne,de.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(ne){this.ctx.ignoreClearRect=!!ne}})};m.prototype.setLineDash=function(A){this.lineDash=A},m.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},m.prototype.fill=function(){I.call(this,"fill",!1)},m.prototype.stroke=function(){I.call(this,"stroke",!1)},m.prototype.beginPath=function(){this.path=[{type:"begin"}]},m.prototype.moveTo=function(A,D){if(isNaN(A)||isNaN(D))throw Mr.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var J=this.ctx.transform.applyToPoint(new o(A,D));this.path.push({type:"mt",x:J.x,y:J.y}),this.ctx.lastPoint=new o(A,D)},m.prototype.closePath=function(){var A=new o(0,0),D=0;for(D=this.path.length-1;D!==-1;D--)if(this.path[D].type==="begin"&&br(this.path[D+1])==="object"&&typeof this.path[D+1].x=="number"){A=new o(this.path[D+1].x,this.path[D+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new o(A.x,A.y)},m.prototype.lineTo=function(A,D){if(isNaN(A)||isNaN(D))throw Mr.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var J=this.ctx.transform.applyToPoint(new o(A,D));this.path.push({type:"lt",x:J.x,y:J.y}),this.ctx.lastPoint=new o(J.x,J.y)},m.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),I.call(this,null,!0)},m.prototype.quadraticCurveTo=function(A,D,J,re){if(isNaN(J)||isNaN(re)||isNaN(A)||isNaN(D))throw Mr.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var ce=this.ctx.transform.applyToPoint(new o(J,re)),fe=this.ctx.transform.applyToPoint(new o(A,D));this.path.push({type:"qct",x1:fe.x,y1:fe.y,x:ce.x,y:ce.y}),this.ctx.lastPoint=new o(ce.x,ce.y)},m.prototype.bezierCurveTo=function(A,D,J,re,ce,fe){if(isNaN(ce)||isNaN(fe)||isNaN(A)||isNaN(D)||isNaN(J)||isNaN(re))throw Mr.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var ee=this.ctx.transform.applyToPoint(new o(ce,fe)),ae=this.ctx.transform.applyToPoint(new o(A,D)),pe=this.ctx.transform.applyToPoint(new o(J,re));this.path.push({type:"bct",x1:ae.x,y1:ae.y,x2:pe.x,y2:pe.y,x:ee.x,y:ee.y}),this.ctx.lastPoint=new o(ee.x,ee.y)},m.prototype.arc=function(A,D,J,re,ce,fe){if(isNaN(A)||isNaN(D)||isNaN(J)||isNaN(re)||isNaN(ce))throw Mr.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(fe=!!fe,!this.ctx.transform.isIdentity){var ee=this.ctx.transform.applyToPoint(new o(A,D));A=ee.x,D=ee.y;var ae=this.ctx.transform.applyToPoint(new o(0,J)),pe=this.ctx.transform.applyToPoint(new o(0,0));J=Math.sqrt(Math.pow(ae.x-pe.x,2)+Math.pow(ae.y-pe.y,2))}Math.abs(ce-re)>=2*Math.PI&&(re=0,ce=2*Math.PI),this.path.push({type:"arc",x:A,y:D,radius:J,startAngle:re,endAngle:ce,counterclockwise:fe})},m.prototype.arcTo=function(A,D,J,re,ce){throw new Error("arcTo not implemented.")},m.prototype.rect=function(A,D,J,re){if(isNaN(A)||isNaN(D)||isNaN(J)||isNaN(re))throw Mr.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(A,D),this.lineTo(A+J,D),this.lineTo(A+J,D+re),this.lineTo(A,D+re),this.lineTo(A,D),this.lineTo(A+J,D),this.lineTo(A,D)},m.prototype.fillRect=function(A,D,J,re){if(isNaN(A)||isNaN(D)||isNaN(J)||isNaN(re))throw Mr.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!p.call(this)){var ce={};this.lineCap!=="butt"&&(ce.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(ce.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(A,D,J,re),this.fill(),ce.hasOwnProperty("lineCap")&&(this.lineCap=ce.lineCap),ce.hasOwnProperty("lineJoin")&&(this.lineJoin=ce.lineJoin)}},m.prototype.strokeRect=function(A,D,J,re){if(isNaN(A)||isNaN(D)||isNaN(J)||isNaN(re))throw Mr.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");b.call(this)||(this.beginPath(),this.rect(A,D,J,re),this.stroke())},m.prototype.clearRect=function(A,D,J,re){if(isNaN(A)||isNaN(D)||isNaN(J)||isNaN(re))throw Mr.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(A,D,J,re))},m.prototype.save=function(A){A=typeof A!="boolean"||A;for(var D=this.pdf.internal.getCurrentPageInfo().pageNumber,J=0;J<this.pdf.internal.getNumberOfPages();J++)this.pdf.setPage(J+1),this.pdf.internal.out("q");if(this.pdf.setPage(D),A){this.ctx.fontSize=this.pdf.internal.getFontSize();var re=new f(this.ctx);this.ctxStack.push(this.ctx),this.ctx=re}},m.prototype.restore=function(A){A=typeof A!="boolean"||A;for(var D=this.pdf.internal.getCurrentPageInfo().pageNumber,J=0;J<this.pdf.internal.getNumberOfPages();J++)this.pdf.setPage(J+1),this.pdf.internal.out("Q");this.pdf.setPage(D),A&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},m.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var v=function(A){var D,J,re,ce;if(A.isCanvasGradient===!0&&(A=A.getColor()),!A)return{r:0,g:0,b:0,a:0,style:A};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(A))D=0,J=0,re=0,ce=0;else{var fe=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(A);if(fe!==null)D=parseInt(fe[1]),J=parseInt(fe[2]),re=parseInt(fe[3]),ce=1;else if((fe=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(A))!==null)D=parseInt(fe[1]),J=parseInt(fe[2]),re=parseInt(fe[3]),ce=parseFloat(fe[4]);else{if(ce=1,typeof A=="string"&&A.charAt(0)!=="#"){var ee=new Fg(A);A=ee.ok?ee.toHex():"#000000"}A.length===4?(D=A.substring(1,2),D+=D,J=A.substring(2,3),J+=J,re=A.substring(3,4),re+=re):(D=A.substring(1,3),J=A.substring(3,5),re=A.substring(5,7)),D=parseInt(D,16),J=parseInt(J,16),re=parseInt(re,16)}}return{r:D,g:J,b:re,a:ce,style:A}},p=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},b=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};m.prototype.fillText=function(A,D,J,re){if(isNaN(D)||isNaN(J)||typeof A!="string")throw Mr.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(re=isNaN(re)?void 0:re,!p.call(this)){var ce=E(this.ctx.transform.rotation),fe=this.ctx.transform.scaleX;L.call(this,{text:A,x:D,y:J,scale:fe,angle:ce,align:this.textAlign,maxWidth:re})}},m.prototype.strokeText=function(A,D,J,re){if(isNaN(D)||isNaN(J)||typeof A!="string")throw Mr.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!b.call(this)){re=isNaN(re)?void 0:re;var ce=E(this.ctx.transform.rotation),fe=this.ctx.transform.scaleX;L.call(this,{text:A,x:D,y:J,scale:fe,renderingMode:"stroke",angle:ce,align:this.textAlign,maxWidth:re})}},m.prototype.measureText=function(A){if(typeof A!="string")throw Mr.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var D=this.pdf,J=this.pdf.internal.scaleFactor,re=D.internal.getFontSize(),ce=D.getStringUnitWidth(A)*re/D.internal.scaleFactor,fe=function(ee){var ae=(ee=ee||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return ae}}),this};return new fe({width:ce*=Math.round(96*J/72*1e4)/1e4})},m.prototype.scale=function(A,D){if(isNaN(A)||isNaN(D))throw Mr.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var J=new u(A,0,0,D,0,0);this.ctx.transform=this.ctx.transform.multiply(J)},m.prototype.rotate=function(A){if(isNaN(A))throw Mr.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var D=new u(Math.cos(A),Math.sin(A),-Math.sin(A),Math.cos(A),0,0);this.ctx.transform=this.ctx.transform.multiply(D)},m.prototype.translate=function(A,D){if(isNaN(A)||isNaN(D))throw Mr.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var J=new u(1,0,0,1,A,D);this.ctx.transform=this.ctx.transform.multiply(J)},m.prototype.transform=function(A,D,J,re,ce,fe){if(isNaN(A)||isNaN(D)||isNaN(J)||isNaN(re)||isNaN(ce)||isNaN(fe))throw Mr.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var ee=new u(A,D,J,re,ce,fe);this.ctx.transform=this.ctx.transform.multiply(ee)},m.prototype.setTransform=function(A,D,J,re,ce,fe){A=isNaN(A)?1:A,D=isNaN(D)?0:D,J=isNaN(J)?0:J,re=isNaN(re)?1:re,ce=isNaN(ce)?0:ce,fe=isNaN(fe)?0:fe,this.ctx.transform=new u(A,D,J,re,ce,fe)};var w=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};m.prototype.drawImage=function(A,D,J,re,ce,fe,ee,ae,pe){var ye=this.pdf.getImageProperties(A),Le=1,se=1,Fe=1,ne=1;re!==void 0&&ae!==void 0&&(Fe=ae/re,ne=pe/ce,Le=ye.width/re*ae/re,se=ye.height/ce*pe/ce),fe===void 0&&(fe=D,ee=J,D=0,J=0),re!==void 0&&ae===void 0&&(ae=re,pe=ce),re===void 0&&ae===void 0&&(ae=ye.width,pe=ye.height);for(var R,be=this.ctx.transform.decompose(),je=E(be.rotate.shx),Pe=new u,He=(Pe=(Pe=(Pe=Pe.multiply(be.translate)).multiply(be.skew)).multiply(be.scale)).applyToRectangle(new l(fe-D*Fe,ee-J*ne,re*Le,ce*se)),Ye=y.call(this,He),nt=[],dt=0;dt<Ye.length;dt+=1)nt.indexOf(Ye[dt])===-1&&nt.push(Ye[dt]);if(k(nt),this.autoPaging)for(var Ae=nt[0],Re=nt[nt.length-1],st=Ae;st<Re+1;st++){this.pdf.setPage(st);var it=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Lt=st===1?this.posY+this.margin[0]:this.margin[0],gt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],St=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],ct=st===1?0:gt+(st-2)*St;if(this.ctx.clip_path.length!==0){var Rt=this.path;R=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=O(R,this.posX+this.margin[3],-ct+Lt+this.ctx.prevPageLastElemOffset),H.call(this,"fill",!0),this.path=Rt}var xt=JSON.parse(JSON.stringify(He));xt=O([xt],this.posX+this.margin[3],-ct+Lt+this.ctx.prevPageLastElemOffset)[0];var Rr=(st>Ae||st<Re)&&w.call(this);Rr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],it,St,null).clip().discardPath()),this.pdf.addImage(A,"JPEG",xt.x,xt.y,xt.w,xt.h,null,null,je),Rr&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(A,"JPEG",He.x,He.y,He.w,He.h,null,null,je)};var y=function(A,D,J){var re=[];D=D||this.pdf.internal.pageSize.width,J=J||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var ce=this.posY+this.ctx.prevPageLastElemOffset;switch(A.type){default:case"mt":case"lt":re.push(Math.floor((A.y+ce)/J)+1);break;case"arc":re.push(Math.floor((A.y+ce-A.radius)/J)+1),re.push(Math.floor((A.y+ce+A.radius)/J)+1);break;case"qct":var fe=X(this.ctx.lastPoint.x,this.ctx.lastPoint.y,A.x1,A.y1,A.x,A.y);re.push(Math.floor((fe.y+ce)/J)+1),re.push(Math.floor((fe.y+fe.h+ce)/J)+1);break;case"bct":var ee=oe(this.ctx.lastPoint.x,this.ctx.lastPoint.y,A.x1,A.y1,A.x2,A.y2,A.x,A.y);re.push(Math.floor((ee.y+ce)/J)+1),re.push(Math.floor((ee.y+ee.h+ce)/J)+1);break;case"rect":re.push(Math.floor((A.y+ce)/J)+1),re.push(Math.floor((A.y+A.h+ce)/J)+1)}for(var ae=0;ae<re.length;ae+=1)for(;this.pdf.internal.getNumberOfPages()<re[ae];)j.call(this);return re},j=function(){var A=this.fillStyle,D=this.strokeStyle,J=this.font,re=this.lineCap,ce=this.lineWidth,fe=this.lineJoin;this.pdf.addPage(),this.fillStyle=A,this.strokeStyle=D,this.font=J,this.lineCap=re,this.lineWidth=ce,this.lineJoin=fe},O=function(A,D,J){for(var re=0;re<A.length;re++)switch(A[re].type){case"bct":A[re].x2+=D,A[re].y2+=J;case"qct":A[re].x1+=D,A[re].y1+=J;case"mt":case"lt":case"arc":default:A[re].x+=D,A[re].y+=J}return A},k=function(A){return A.sort(function(D,J){return D-J})},I=function(A,D){for(var J,re,ce=this.fillStyle,fe=this.strokeStyle,ee=this.lineCap,ae=this.lineWidth,pe=Math.abs(ae*this.ctx.transform.scaleX),ye=this.lineJoin,Le=JSON.parse(JSON.stringify(this.path)),se=JSON.parse(JSON.stringify(this.path)),Fe=[],ne=0;ne<se.length;ne++)if(se[ne].x!==void 0)for(var R=y.call(this,se[ne]),be=0;be<R.length;be+=1)Fe.indexOf(R[be])===-1&&Fe.push(R[be]);for(var je=0;je<Fe.length;je++)for(;this.pdf.internal.getNumberOfPages()<Fe[je];)j.call(this);if(k(Fe),this.autoPaging)for(var Pe=Fe[0],He=Fe[Fe.length-1],Ye=Pe;Ye<He+1;Ye++){this.pdf.setPage(Ye),this.fillStyle=ce,this.strokeStyle=fe,this.lineCap=ee,this.lineWidth=pe,this.lineJoin=ye;var nt=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],dt=Ye===1?this.posY+this.margin[0]:this.margin[0],Ae=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Re=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],st=Ye===1?0:Ae+(Ye-2)*Re;if(this.ctx.clip_path.length!==0){var it=this.path;J=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=O(J,this.posX+this.margin[3],-st+dt+this.ctx.prevPageLastElemOffset),H.call(this,A,!0),this.path=it}if(re=JSON.parse(JSON.stringify(Le)),this.path=O(re,this.posX+this.margin[3],-st+dt+this.ctx.prevPageLastElemOffset),D===!1||Ye===0){var Lt=(Ye>Pe||Ye<He)&&w.call(this);Lt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],nt,Re,null).clip().discardPath()),H.call(this,A,D),Lt&&this.pdf.restoreGraphicsState()}this.lineWidth=ae}else this.lineWidth=pe,H.call(this,A,D),this.lineWidth=ae;this.path=Le},H=function(A,D){if((A!=="stroke"||D||!b.call(this))&&(A==="stroke"||D||!p.call(this))){for(var J,re,ce=[],fe=this.path,ee=0;ee<fe.length;ee++){var ae=fe[ee];switch(ae.type){case"begin":ce.push({begin:!0});break;case"close":ce.push({close:!0});break;case"mt":ce.push({start:ae,deltas:[],abs:[]});break;case"lt":var pe=ce.length;if(fe[ee-1]&&!isNaN(fe[ee-1].x)&&(J=[ae.x-fe[ee-1].x,ae.y-fe[ee-1].y],pe>0)){for(;pe>=0;pe--)if(ce[pe-1].close!==!0&&ce[pe-1].begin!==!0){ce[pe-1].deltas.push(J),ce[pe-1].abs.push(ae);break}}break;case"bct":J=[ae.x1-fe[ee-1].x,ae.y1-fe[ee-1].y,ae.x2-fe[ee-1].x,ae.y2-fe[ee-1].y,ae.x-fe[ee-1].x,ae.y-fe[ee-1].y],ce[ce.length-1].deltas.push(J);break;case"qct":var ye=fe[ee-1].x+2/3*(ae.x1-fe[ee-1].x),Le=fe[ee-1].y+2/3*(ae.y1-fe[ee-1].y),se=ae.x+2/3*(ae.x1-ae.x),Fe=ae.y+2/3*(ae.y1-ae.y),ne=ae.x,R=ae.y;J=[ye-fe[ee-1].x,Le-fe[ee-1].y,se-fe[ee-1].x,Fe-fe[ee-1].y,ne-fe[ee-1].x,R-fe[ee-1].y],ce[ce.length-1].deltas.push(J);break;case"arc":ce.push({deltas:[],abs:[],arc:!0}),Array.isArray(ce[ce.length-1].abs)&&ce[ce.length-1].abs.push(ae)}}re=D?null:A==="stroke"?"stroke":"fill";for(var be=!1,je=0;je<ce.length;je++)if(ce[je].arc)for(var Pe=ce[je].abs,He=0;He<Pe.length;He++){var Ye=Pe[He];Ye.type==="arc"?C.call(this,Ye.x,Ye.y,Ye.radius,Ye.startAngle,Ye.endAngle,Ye.counterclockwise,void 0,D,!be):te.call(this,Ye.x,Ye.y),be=!0}else if(ce[je].close===!0)this.pdf.internal.out("h"),be=!1;else if(ce[je].begin!==!0){var nt=ce[je].start.x,dt=ce[je].start.y;W.call(this,ce[je].deltas,nt,dt),be=!0}re&&N.call(this,re),D&&Q.call(this)}},F=function(A){var D=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,J=D*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return A-J;case"top":return A+D-J;case"hanging":return A+D-2*J;case"middle":return A+D/2-J;case"ideographic":return A;case"alphabetic":default:return A}},U=function(A){return A+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};m.prototype.createLinearGradient=function(){var A=function(){};return A.colorStops=[],A.addColorStop=function(D,J){this.colorStops.push([D,J])},A.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},A.isCanvasGradient=!0,A},m.prototype.createPattern=function(){return this.createLinearGradient()},m.prototype.createRadialGradient=function(){return this.createLinearGradient()};var C=function(A,D,J,re,ce,fe,ee,ae,pe){for(var ye=V.call(this,J,re,ce,fe),Le=0;Le<ye.length;Le++){var se=ye[Le];Le===0&&(pe?P.call(this,se.x1+A,se.y1+D):te.call(this,se.x1+A,se.y1+D)),z.call(this,A,D,se.x2,se.y2,se.x3,se.y3,se.x4,se.y4)}ae?Q.call(this):N.call(this,ee)},N=function(A){switch(A){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},Q=function(){this.pdf.clip(),this.pdf.discardPath()},P=function(A,D){this.pdf.internal.out(r(A)+" "+n(D)+" m")},L=function(A){var D;switch(A.align){case"right":case"end":D="right";break;case"center":D="center";break;case"left":case"start":default:D="left"}var J=this.pdf.getTextDimensions(A.text),re=F.call(this,A.y),ce=U.call(this,re)-J.h,fe=this.ctx.transform.applyToPoint(new o(A.x,re)),ee=this.ctx.transform.decompose(),ae=new u;ae=(ae=(ae=ae.multiply(ee.translate)).multiply(ee.skew)).multiply(ee.scale);for(var pe,ye,Le,se=this.ctx.transform.applyToRectangle(new l(A.x,re,J.w,J.h)),Fe=ae.applyToRectangle(new l(A.x,ce,J.w,J.h)),ne=y.call(this,Fe),R=[],be=0;be<ne.length;be+=1)R.indexOf(ne[be])===-1&&R.push(ne[be]);if(k(R),this.autoPaging)for(var je=R[0],Pe=R[R.length-1],He=je;He<Pe+1;He++){this.pdf.setPage(He);var Ye=He===1?this.posY+this.margin[0]:this.margin[0],nt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],dt=this.pdf.internal.pageSize.height-this.margin[2],Ae=dt-this.margin[0],Re=this.pdf.internal.pageSize.width-this.margin[1],st=Re-this.margin[3],it=He===1?0:nt+(He-2)*Ae;if(this.ctx.clip_path.length!==0){var Lt=this.path;pe=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=O(pe,this.posX+this.margin[3],-1*it+Ye),H.call(this,"fill",!0),this.path=Lt}var gt=O([JSON.parse(JSON.stringify(Fe))],this.posX+this.margin[3],-it+Ye+this.ctx.prevPageLastElemOffset)[0];A.scale>=.01&&(ye=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ye*A.scale),Le=this.lineWidth,this.lineWidth=Le*A.scale);var St=this.autoPaging!=="text";if(St||gt.y+gt.h<=dt){if(St||gt.y>=Ye&&gt.x<=Re){var ct=St?A.text:this.pdf.splitTextToSize(A.text,A.maxWidth||Re-gt.x)[0],Rt=O([JSON.parse(JSON.stringify(se))],this.posX+this.margin[3],-it+Ye+this.ctx.prevPageLastElemOffset)[0],xt=St&&(He>je||He<Pe)&&w.call(this);xt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],st,Ae,null).clip().discardPath()),this.pdf.text(ct,Rt.x,Rt.y,{angle:A.angle,align:D,renderingMode:A.renderingMode}),xt&&this.pdf.restoreGraphicsState()}}else gt.y<dt&&(this.ctx.prevPageLastElemOffset+=dt-gt.y);A.scale>=.01&&(this.pdf.setFontSize(ye),this.lineWidth=Le)}else A.scale>=.01&&(ye=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ye*A.scale),Le=this.lineWidth,this.lineWidth=Le*A.scale),this.pdf.text(A.text,fe.x+this.posX,fe.y+this.posY,{angle:A.angle,align:D,renderingMode:A.renderingMode,maxWidth:A.maxWidth}),A.scale>=.01&&(this.pdf.setFontSize(ye),this.lineWidth=Le)},te=function(A,D,J,re){J=J||0,re=re||0,this.pdf.internal.out(r(A+J)+" "+n(D+re)+" l")},W=function(A,D,J){return this.pdf.lines(A,D,J,null,null)},z=function(A,D,J,re,ce,fe,ee,ae){this.pdf.internal.out([e(s(J+A)),e(i(re+D)),e(s(ce+A)),e(i(fe+D)),e(s(ee+A)),e(i(ae+D)),"c"].join(" "))},V=function(A,D,J,re){for(var ce=2*Math.PI,fe=Math.PI/2;D>J;)D-=ce;var ee=Math.abs(J-D);ee<ce&&re&&(ee=ce-ee);for(var ae=[],pe=re?-1:1,ye=D;ee>1e-5;){var Le=ye+pe*Math.min(ee,fe);ae.push(Y.call(this,A,ye,Le)),ee-=Math.abs(Le-ye),ye=Le}return ae},Y=function(A,D,J){var re=(J-D)/2,ce=A*Math.cos(re),fe=A*Math.sin(re),ee=ce,ae=-fe,pe=ee*ee+ae*ae,ye=pe+ee*ce+ae*fe,Le=4/3*(Math.sqrt(2*pe*ye)-ye)/(ee*fe-ae*ce),se=ee-Le*ae,Fe=ae+Le*ee,ne=se,R=-Fe,be=re+D,je=Math.cos(be),Pe=Math.sin(be);return{x1:A*Math.cos(D),y1:A*Math.sin(D),x2:se*je-Fe*Pe,y2:se*Pe+Fe*je,x3:ne*je-R*Pe,y3:ne*Pe+R*je,x4:A*Math.cos(J),y4:A*Math.sin(J)}},E=function(A){return 180*A/Math.PI},X=function(A,D,J,re,ce,fe){var ee=A+.5*(J-A),ae=D+.5*(re-D),pe=ce+.5*(J-ce),ye=fe+.5*(re-fe),Le=Math.min(A,ce,ee,pe),se=Math.max(A,ce,ee,pe),Fe=Math.min(D,fe,ae,ye),ne=Math.max(D,fe,ae,ye);return new l(Le,Fe,se-Le,ne-Fe)},oe=function(A,D,J,re,ce,fe,ee,ae){var pe,ye,Le,se,Fe,ne,R,be,je,Pe,He,Ye,nt,dt,Ae=J-A,Re=re-D,st=ce-J,it=fe-re,Lt=ee-ce,gt=ae-fe;for(ye=0;ye<41;ye++)je=(R=(Le=A+(pe=ye/40)*Ae)+pe*((Fe=J+pe*st)-Le))+pe*(Fe+pe*(ce+pe*Lt-Fe)-R),Pe=(be=(se=D+pe*Re)+pe*((ne=re+pe*it)-se))+pe*(ne+pe*(fe+pe*gt-ne)-be),ye==0?(He=je,Ye=Pe,nt=je,dt=Pe):(He=Math.min(He,je),Ye=Math.min(Ye,Pe),nt=Math.max(nt,je),dt=Math.max(dt,Pe));return new l(Math.round(He),Math.round(Ye),Math.round(nt-He),Math.round(dt-Ye))},de=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var A,D,J=(A=this.ctx.lineDash,D=this.ctx.lineDashOffset,JSON.stringify({lineDash:A,lineDashOffset:D}));this.prevLineDash!==J&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=J)}}})(Tt.API),function(t){var e=function(i){var o,l,u,d,f,m,v,p,b,w;for(l=[],u=0,d=(i+=o="\0\0\0\0".slice(i.length%4||4)).length;d>u;u+=4)(f=(i.charCodeAt(u)<<24)+(i.charCodeAt(u+1)<<16)+(i.charCodeAt(u+2)<<8)+i.charCodeAt(u+3))!==0?(m=(f=((f=((f=((f=(f-(w=f%85))/85)-(b=f%85))/85)-(p=f%85))/85)-(v=f%85))/85)%85,l.push(m+33,v+33,p+33,b+33,w+33)):l.push(122);return function(y,j){for(var O=j;O>0;O--)y.pop()}(l,o.length),String.fromCharCode.apply(String,l)+"~>"},r=function(i){var o,l,u,d,f,m=String,v="length",p=255,b="charCodeAt",w="slice",y="replace";for(i[w](-2),i=i[w](0,-2)[y](/\s/g,"")[y]("z","!!!!!"),u=[],d=0,f=(i+=o="uuuuu"[w](i[v]%5||5))[v];f>d;d+=5)l=52200625*(i[b](d)-33)+614125*(i[b](d+1)-33)+7225*(i[b](d+2)-33)+85*(i[b](d+3)-33)+(i[b](d+4)-33),u.push(p&l>>24,p&l>>16,p&l>>8,p&l);return function(j,O){for(var k=O;k>0;k--)j.pop()}(u,o[v]),m.fromCharCode.apply(m,u)},n=function(i){var o=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((i=i.replace(/\s/g,"")).indexOf(">")!==-1&&(i=i.substr(0,i.indexOf(">"))),i.length%2&&(i+="0"),o.test(i)===!1)return"";for(var l="",u=0;u<i.length;u+=2)l+=String.fromCharCode("0x"+(i[u]+i[u+1]));return l},s=function(i){for(var o=new Uint8Array(i.length),l=i.length;l--;)o[l]=i.charCodeAt(l);return i=(o=ah(o)).reduce(function(u,d){return u+String.fromCharCode(d)},"")};t.processDataByFilters=function(i,o){var l=0,u=i||"",d=[];for(typeof(o=o||[])=="string"&&(o=[o]),l=0;l<o.length;l+=1)switch(o[l]){case"ASCII85Decode":case"/ASCII85Decode":u=r(u),d.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":u=e(u),d.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":u=n(u),d.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":u=u.split("").map(function(f){return("0"+f.charCodeAt().toString(16)).slice(-2)}).join("")+">",d.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":u=s(u),d.push("/FlateDecode");break;default:throw new Error('The filter: "'+o[l]+'" is not implemented')}return{data:u,reverseChain:d.reverse().join(" ")}}}(Tt.API),function(t){t.loadFile=function(e,r,n){return function(s,i,o){i=i!==!1,o=typeof o=="function"?o:function(){};var l=void 0;try{l=function(u,d,f){var m=new XMLHttpRequest,v=0,p=function(b){var w=b.length,y=[],j=String.fromCharCode;for(v=0;v<w;v+=1)y.push(j(255&b.charCodeAt(v)));return y.join("")};if(m.open("GET",u,!d),m.overrideMimeType("text/plain; charset=x-user-defined"),d===!1&&(m.onload=function(){m.status===200?f(p(this.responseText)):f(void 0)}),m.send(null),d&&m.status===200)return p(m.responseText)}(s,i,o)}catch{}return l}(e,r,n)},t.loadImageFile=t.loadFile}(Tt.API),function(t){function e(){return(Mt.html2canvas?Promise.resolve(Mt.html2canvas):Zd(()=>import("./html2canvas.esm-BfxBtG_O.js"),[],import.meta.url)).catch(function(o){return Promise.reject(new Error("Could not load html2canvas: "+o))}).then(function(o){return o.default?o.default:o})}function r(){return(Mt.DOMPurify?Promise.resolve(Mt.DOMPurify):Zd(()=>import("./purify.es-CQJ0hv7W.js"),[],import.meta.url)).catch(function(o){return Promise.reject(new Error("Could not load dompurify: "+o))}).then(function(o){return o.default?o.default:o})}var n=function(o){var l=br(o);return l==="undefined"?"undefined":l==="string"||o instanceof String?"string":l==="number"||o instanceof Number?"number":l==="function"||o instanceof Function?"function":o&&o.constructor===Array?"array":o&&o.nodeType===1?"element":l==="object"?"object":"unknown"},s=function(o,l){var u=document.createElement(o);for(var d in l.className&&(u.className=l.className),l.innerHTML&&l.dompurify&&(u.innerHTML=l.dompurify.sanitize(l.innerHTML)),l.style)u.style[d]=l.style[d];return u},i=function o(l){var u=Object.assign(o.convert(Promise.resolve()),JSON.parse(JSON.stringify(o.template))),d=o.convert(Promise.resolve(),u);return d=(d=d.setProgress(1,o,1,[o])).set(l)};(i.prototype=Object.create(Promise.prototype)).constructor=i,i.convert=function(o,l){return o.__proto__=l||i.prototype,o},i.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},i.prototype.from=function(o,l){return this.then(function(){switch(l=l||function(u){switch(n(u)){case"string":return"string";case"element":return u.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(o)){case"string":return this.then(r).then(function(u){return this.set({src:s("div",{innerHTML:o,dompurify:u})})});case"element":return this.set({src:o});case"canvas":return this.set({canvas:o});case"img":return this.set({img:o});default:return this.error("Unknown source type.")}})},i.prototype.to=function(o){switch(o){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},i.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var o={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},l=function u(d,f){for(var m=d.nodeType===3?document.createTextNode(d.nodeValue):d.cloneNode(!1),v=d.firstChild;v;v=v.nextSibling)f!==!0&&v.nodeType===1&&v.nodeName==="SCRIPT"||m.appendChild(u(v,f));return d.nodeType===1&&(d.nodeName==="CANVAS"?(m.width=d.width,m.height=d.height,m.getContext("2d").drawImage(d,0,0)):d.nodeName!=="TEXTAREA"&&d.nodeName!=="SELECT"||(m.value=d.value),m.addEventListener("load",function(){m.scrollTop=d.scrollTop,m.scrollLeft=d.scrollLeft},!0)),m}(this.prop.src,this.opt.html2canvas.javascriptEnabled);l.tagName==="BODY"&&(o.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=s("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=s("div",{className:"html2pdf__container",style:o}),this.prop.container.appendChild(l),this.prop.container.firstChild.appendChild(s("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},i.prototype.toCanvas=function(){var o=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(o).then(e).then(function(l){var u=Object.assign({},this.opt.html2canvas);return delete u.onrendered,l(this.prop.container,u)}).then(function(l){(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},i.prototype.toContext2d=function(){var o=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(o).then(e).then(function(l){var u=this.opt.jsPDF,d=this.opt.fontFaces,f=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,m=Object.assign({async:!0,allowTaint:!0,scale:f,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete m.onrendered,u.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,u.context2d.posX=this.opt.x,u.context2d.posY=this.opt.y,u.context2d.margin=this.opt.margin,u.context2d.fontFaces=d,d)for(var v=0;v<d.length;++v){var p=d[v],b=p.src.find(function(w){return w.format==="truetype"});b&&u.addFont(b.url,p.ref.name,p.ref.style)}return m.windowHeight=m.windowHeight||0,m.windowHeight=m.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):m.windowHeight,u.context2d.save(!0),l(this.prop.container,m)}).then(function(l){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},i.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var o=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=o})},i.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},i.prototype.output=function(o,l,u){return(u=u||"pdf").toLowerCase()==="img"||u.toLowerCase()==="image"?this.outputImg(o,l):this.outputPdf(o,l)},i.prototype.outputPdf=function(o,l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(o,l)})},i.prototype.outputImg=function(o){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(o){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+o+'" is not supported.'}})},i.prototype.save=function(o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(o?{filename:o}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},i.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},i.prototype.set=function(o){if(n(o)!=="object")return this;var l=Object.keys(o||{}).map(function(u){if(u in i.template.prop)return function(){this.prop[u]=o[u]};switch(u){case"margin":return this.setMargin.bind(this,o.margin);case"jsPDF":return function(){return this.opt.jsPDF=o.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,o.pageSize);default:return function(){this.opt[u]=o[u]}}},this);return this.then(function(){return this.thenList(l)})},i.prototype.get=function(o,l){return this.then(function(){var u=o in i.template.prop?this.prop[o]:this.opt[o];return l?l(u):u})},i.prototype.setMargin=function(o){return this.then(function(){switch(n(o)){case"number":o=[o,o,o,o];case"array":if(o.length===2&&(o=[o[0],o[1],o[0],o[1]]),o.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=o}).then(this.setPageSize)},i.prototype.setPageSize=function(o){function l(u,d){return Math.floor(u*d/72*96)}return this.then(function(){(o=o||Tt.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(o.inner={width:o.width-this.opt.margin[1]-this.opt.margin[3],height:o.height-this.opt.margin[0]-this.opt.margin[2]},o.inner.px={width:l(o.inner.width,o.k),height:l(o.inner.height,o.k)},o.inner.ratio=o.inner.height/o.inner.width),this.prop.pageSize=o})},i.prototype.setProgress=function(o,l,u,d){return o!=null&&(this.progress.val=o),l!=null&&(this.progress.state=l),u!=null&&(this.progress.n=u),d!=null&&(this.progress.stack=d),this.progress.ratio=this.progress.val/this.progress.state,this},i.prototype.updateProgress=function(o,l,u,d){return this.setProgress(o?this.progress.val+o:null,l||null,u?this.progress.n+u:null,d?this.progress.stack.concat(d):null)},i.prototype.then=function(o,l){var u=this;return this.thenCore(o,l,function(d,f){return u.updateProgress(null,null,1,[d]),Promise.prototype.then.call(this,function(m){return u.updateProgress(null,d),m}).then(d,f).then(function(m){return u.updateProgress(1),m})})},i.prototype.thenCore=function(o,l,u){u=u||Promise.prototype.then,o&&(o=o.bind(this)),l&&(l=l.bind(this));var d=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:i.convert(Object.assign({},this),Promise.prototype),f=u.call(d,o,l);return i.convert(f,this.__proto__)},i.prototype.thenExternal=function(o,l){return Promise.prototype.then.call(this,o,l)},i.prototype.thenList=function(o){var l=this;return o.forEach(function(u){l=l.thenCore(u)}),l},i.prototype.catch=function(o){o&&(o=o.bind(this));var l=Promise.prototype.catch.call(this,o);return i.convert(l,this)},i.prototype.catchExternal=function(o){return Promise.prototype.catch.call(this,o)},i.prototype.error=function(o){return this.then(function(){throw new Error(o)})},i.prototype.using=i.prototype.set,i.prototype.saveAs=i.prototype.save,i.prototype.export=i.prototype.output,i.prototype.run=i.prototype.then,Tt.getPageSize=function(o,l,u){if(br(o)==="object"){var d=o;o=d.orientation,l=d.unit||l,u=d.format||u}l=l||"mm",u=u||"a4",o=(""+(o||"P")).toLowerCase();var f,m=(""+u).toLowerCase(),v={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(l){case"pt":f=1;break;case"mm":f=72/25.4;break;case"cm":f=72/2.54;break;case"in":f=72;break;case"px":f=.75;break;case"pc":case"em":f=12;break;case"ex":f=6;break;default:throw"Invalid unit: "+l}var p,b=0,w=0;if(v.hasOwnProperty(m))b=v[m][1]/f,w=v[m][0]/f;else try{b=u[1],w=u[0]}catch{throw new Error("Invalid format: "+u)}if(o==="p"||o==="portrait")o="p",w>b&&(p=w,w=b,b=p);else{if(o!=="l"&&o!=="landscape")throw"Invalid orientation: "+o;o="l",b>w&&(p=w,w=b,b=p)}return{width:w,height:b,unit:l,k:f,orientation:o}},t.html=function(o,l){(l=l||{}).callback=l.callback||function(){},l.html2canvas=l.html2canvas||{},l.html2canvas.canvas=l.html2canvas.canvas||this.canvas,l.jsPDF=l.jsPDF||this,l.fontFaces=l.fontFaces?l.fontFaces.map(uh):null;var u=new i(l);return l.worker?u:u.from(o).doCallback()}}(Tt.API),Tt.API.addJS=function(t){return Np=t,this.internal.events.subscribe("postPutResources",function(){Ac=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Ac+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),Lp=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+Np+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Ac!==void 0&&Lp!==void 0&&this.internal.out("/Names <</JavaScript "+Ac+" 0 R>>")}),this},function(t){var e;t.events.push(["postPutResources",function(){var r=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var s=r.outline.render().split(/\r\n/),i=0;i<s.length;i++){var o=s[i],l=n.exec(o);if(l!=null){var u=l[1];r.internal.newObjectDeferredBegin(u,!1)}r.internal.write(o)}if(this.outline.createNamedDestinations){var d=this.internal.pages.length,f=[];for(i=0;i<d;i++){var m=r.internal.newObject();f.push(m);var v=r.internal.getPageInfo(i+1);r.internal.write("<< /D["+v.objId+" 0 R /XYZ null null null]>> endobj")}var p=r.internal.newObject();for(r.internal.write("<< /Names [ "),i=0;i<f.length;i++)r.internal.write("(page_"+(i+1)+")"+f[i]+" 0 R");r.internal.write(" ] >>","endobj"),e=r.internal.newObject(),r.internal.write("<< /Dests "+p+" 0 R"),r.internal.write(">>","endobj")}}]),t.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+e+" 0 R"))}]),t.events.push(["initialized",function(){var r=this;r.outline={createNamedDestinations:!1,root:{children:[]}},r.outline.add=function(n,s,i){var o={title:s,options:i,children:[]};return n==null&&(n=this.root),n.children.push(o),o},r.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=r,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},r.outline.genIds_r=function(n){n.id=r.internal.newObjectDeferred();for(var s=0;s<n.children.length;s++)this.genIds_r(n.children[s])},r.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},r.outline.renderItems=function(n){for(var s=this.ctx.pdf.internal.getVerticalCoordinateString,i=0;i<n.children.length;i++){var o=n.children[i];this.objStart(o),this.line("/Title "+this.makeString(o.title)),this.line("/Parent "+this.makeRef(n)),i>0&&this.line("/Prev "+this.makeRef(n.children[i-1])),i<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[i+1])),o.children.length>0&&(this.line("/First "+this.makeRef(o.children[0])),this.line("/Last "+this.makeRef(o.children[o.children.length-1])));var l=this.count=this.count_r({count:0},o);if(l>0&&this.line("/Count "+l),o.options&&o.options.pageNumber){var u=r.internal.getPageInfo(o.options.pageNumber);this.line("/Dest ["+u.objId+" 0 R /XYZ 0 "+s(0)+" 0]")}this.objEnd()}for(var d=0;d<n.children.length;d++)this.renderItems(n.children[d])},r.outline.line=function(n){this.ctx.val+=n+`\r
`},r.outline.makeRef=function(n){return n.id+" 0 R"},r.outline.makeString=function(n){return"("+r.internal.pdfEscape(n)+")"},r.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},r.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},r.outline.count_r=function(n,s){for(var i=0;i<s.children.length;i++)n.count++,this.count_r(n,s.children[i]);return n.count}}])}(Tt.API),function(t){var e=[192,193,194,195,196,197,198,199];t.processJPEG=function(r,n,s,i,o,l){var u,d=this.decode.DCT_DECODE,f=null;if(typeof r=="string"||this.__addimage__.isArrayBuffer(r)||this.__addimage__.isArrayBufferView(r)){switch(r=o||r,r=this.__addimage__.isArrayBuffer(r)?new Uint8Array(r):r,(u=function(m){for(var v,p=256*m.charCodeAt(4)+m.charCodeAt(5),b=m.length,w={width:0,height:0,numcomponents:1},y=4;y<b;y+=2){if(y+=p,e.indexOf(m.charCodeAt(y+1))!==-1){v=256*m.charCodeAt(y+5)+m.charCodeAt(y+6),w={width:256*m.charCodeAt(y+7)+m.charCodeAt(y+8),height:v,numcomponents:m.charCodeAt(y+9)};break}p=256*m.charCodeAt(y+2)+m.charCodeAt(y+3)}return w}(r=this.__addimage__.isArrayBufferView(r)?this.__addimage__.arrayBufferToBinaryString(r):r)).numcomponents){case 1:l=this.color_spaces.DEVICE_GRAY;break;case 4:l=this.color_spaces.DEVICE_CMYK;break;case 3:l=this.color_spaces.DEVICE_RGB}f={data:r,width:u.width,height:u.height,colorSpace:l,bitsPerComponent:8,filter:d,index:n,alias:s}}return f}}(Tt.API);var Vi,Lc,Ep,Op,Ip,Tb=function(){var t,e,r;function n(i){var o,l,u,d,f,m,v,p,b,w,y,j,O,k;for(this.data=i,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},m=null;;){switch(o=this.readUInt32(),b=(function(){var I,H;for(H=[],I=0;I<4;++I)H.push(String.fromCharCode(this.data[this.pos++]));return H}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(o);break;case"fcTL":m&&this.animation.frames.push(m),this.pos+=4,m={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},f=this.readUInt16(),d=this.readUInt16()||100,m.delay=1e3*f/d,m.disposeOp=this.data[this.pos++],m.blendOp=this.data[this.pos++],m.data=[];break;case"IDAT":case"fdAT":for(b==="fdAT"&&(this.pos+=4,o-=4),i=m?.data||this.imgData,j=0;0<=o?j<o:j>o;0<=o?++j:--j)i.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(u=this.palette.length/3,this.transparency.indexed=this.read(o),this.transparency.indexed.length>u)throw new Error("More transparent colors than palette size");if((w=u-this.transparency.indexed.length)>0)for(O=0;0<=w?O<w:O>w;0<=w?++O:--O)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(o)[0];break;case 2:this.transparency.rgb=this.read(o)}break;case"tEXt":v=(y=this.read(o)).indexOf(0),p=String.fromCharCode.apply(String,y.slice(0,v)),this.text[p]=String.fromCharCode.apply(String,y.slice(v+1));break;case"IEND":return m&&this.animation.frames.push(m),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(k=this.colorType)===4||k===6,l=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*l,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=o}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}n.prototype.read=function(i){var o,l;for(l=[],o=0;0<=i?o<i:o>i;0<=i?++o:--o)l.push(this.data[this.pos++]);return l},n.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.decodePixels=function(i){var o=this.pixelBitlength/8,l=new Uint8Array(this.width*this.height*o),u=0,d=this;if(i==null&&(i=this.imgData),i.length===0)return new Uint8Array(0);function f(m,v,p,b){var w,y,j,O,k,I,H,F,U,C,N,Q,P,L,te,W,z,V,Y,E,X,oe=Math.ceil((d.width-m)/p),de=Math.ceil((d.height-v)/b),A=d.width==oe&&d.height==de;for(L=o*oe,Q=A?l:new Uint8Array(L*de),I=i.length,P=0,y=0;P<de&&u<I;){switch(i[u++]){case 0:for(O=z=0;z<L;O=z+=1)Q[y++]=i[u++];break;case 1:for(O=V=0;V<L;O=V+=1)w=i[u++],k=O<o?0:Q[y-o],Q[y++]=(w+k)%256;break;case 2:for(O=Y=0;Y<L;O=Y+=1)w=i[u++],j=(O-O%o)/o,te=P&&Q[(P-1)*L+j*o+O%o],Q[y++]=(te+w)%256;break;case 3:for(O=E=0;E<L;O=E+=1)w=i[u++],j=(O-O%o)/o,k=O<o?0:Q[y-o],te=P&&Q[(P-1)*L+j*o+O%o],Q[y++]=(w+Math.floor((k+te)/2))%256;break;case 4:for(O=X=0;X<L;O=X+=1)w=i[u++],j=(O-O%o)/o,k=O<o?0:Q[y-o],P===0?te=W=0:(te=Q[(P-1)*L+j*o+O%o],W=j&&Q[(P-1)*L+(j-1)*o+O%o]),H=k+te-W,F=Math.abs(H-k),C=Math.abs(H-te),N=Math.abs(H-W),U=F<=C&&F<=N?k:C<=N?te:W,Q[y++]=(w+U)%256;break;default:throw new Error("Invalid filter algorithm: "+i[u-1])}if(!A){var D=((v+P*b)*d.width+m)*o,J=P*L;for(O=0;O<oe;O+=1){for(var re=0;re<o;re+=1)l[D++]=Q[J++];D+=(p-1)*o}}P++}}return i=fb(i),d.interlaceMethod==1?(f(0,0,8,8),f(4,0,8,8),f(0,4,4,8),f(2,0,4,4),f(0,2,2,4),f(1,0,2,2),f(0,1,1,2)):f(0,0,1,1),l},n.prototype.decodePalette=function(){var i,o,l,u,d,f,m,v,p;for(l=this.palette,f=this.transparency.indexed||[],d=new Uint8Array((f.length||0)+l.length),u=0,i=0,o=m=0,v=l.length;m<v;o=m+=3)d[u++]=l[o],d[u++]=l[o+1],d[u++]=l[o+2],d[u++]=(p=f[i++])!=null?p:255;return d},n.prototype.copyToImageData=function(i,o){var l,u,d,f,m,v,p,b,w,y,j;if(u=this.colors,w=null,l=this.hasAlphaChannel,this.palette.length&&(w=(j=this._decodedPalette)!=null?j:this._decodedPalette=this.decodePalette(),u=4,l=!0),b=(d=i.data||i).length,m=w||o,f=v=0,u===1)for(;f<b;)p=w?4*o[f/4]:v,y=m[p++],d[f++]=y,d[f++]=y,d[f++]=y,d[f++]=l?m[p++]:255,v=p;else for(;f<b;)p=w?4*o[f/4]:v,d[f++]=m[p++],d[f++]=m[p++],d[f++]=m[p++],d[f++]=l?m[p++]:255,v=p},n.prototype.decode=function(){var i;return i=new Uint8Array(this.width*this.height*4),this.copyToImageData(i,this.decodePixels()),i};var s=function(){if(Object.prototype.toString.call(Mt)==="[object Window]"){try{e=Mt.document.createElement("canvas"),r=e.getContext("2d")}catch{return!1}return!0}return!1};return s(),t=function(i){var o;if(s()===!0)return r.width=i.width,r.height=i.height,r.clearRect(0,0,i.width,i.height),r.putImageData(i,0,0),(o=new Image).src=e.toDataURL(),o;throw new Error("This method requires a Browser with Canvas-capability.")},n.prototype.decodeFrames=function(i){var o,l,u,d,f,m,v,p;if(this.animation){for(p=[],l=f=0,m=(v=this.animation.frames).length;f<m;l=++f)o=v[l],u=i.createImageData(o.width,o.height),d=this.decodePixels(new Uint8Array(o.data)),this.copyToImageData(u,d),o.imageData=u,p.push(o.image=t(u));return p}},n.prototype.renderFrame=function(i,o){var l,u,d;return l=(u=this.animation.frames)[o],d=u[o-1],o===0&&i.clearRect(0,0,this.width,this.height),d?.disposeOp===1?i.clearRect(d.xOffset,d.yOffset,d.width,d.height):d?.disposeOp===2&&i.putImageData(d.imageData,d.xOffset,d.yOffset),l.blendOp===0&&i.clearRect(l.xOffset,l.yOffset,l.width,l.height),i.drawImage(l.image,l.xOffset,l.yOffset)},n.prototype.animate=function(i){var o,l,u,d,f,m,v=this;return l=0,m=this.animation,d=m.numFrames,u=m.frames,f=m.numPlays,(o=function(){var p,b;if(p=l++%d,b=u[p],v.renderFrame(i,p),d>1&&l/d<f)return v.animation._timeout=setTimeout(o,b.delay)})()},n.prototype.stopAnimation=function(){var i;return clearTimeout((i=this.animation)!=null?i._timeout:void 0)},n.prototype.render=function(i){var o,l;return i._png&&i._png.stopAnimation(),i._png=this,i.width=this.width,i.height=this.height,o=i.getContext("2d"),this.animation?(this.decodeFrames(o),this.animate(o)):(l=o.createImageData(this.width,this.height),this.copyToImageData(l,this.decodePixels()),o.putImageData(l,0,0))},n}();/**
 * @license
 *
 * Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 *//**
 * @license
 * (c) Dean McNamee <dean@gmail.com>, 2013.
 *
 * https://github.com/deanm/omggif
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
 * including animation and compression.  It does not rely on any specific
 * underlying system, so should run in the browser, Node, or Plask.
 */function Mb(t){var e=0;if(t[e++]!==71||t[e++]!==73||t[e++]!==70||t[e++]!==56||(t[e++]+1&253)!=56||t[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var r=t[e++]|t[e++]<<8,n=t[e++]|t[e++]<<8,s=t[e++],i=s>>7,o=1<<(7&s)+1;t[e++],t[e++];var l=null,u=null;i&&(l=e,u=o,e+=3*o);var d=!0,f=[],m=0,v=null,p=0,b=null;for(this.width=r,this.height=n;d&&e<t.length;)switch(t[e++]){case 33:switch(t[e++]){case 255:if(t[e]!==11||t[e+1]==78&&t[e+2]==69&&t[e+3]==84&&t[e+4]==83&&t[e+5]==67&&t[e+6]==65&&t[e+7]==80&&t[e+8]==69&&t[e+9]==50&&t[e+10]==46&&t[e+11]==48&&t[e+12]==3&&t[e+13]==1&&t[e+16]==0)e+=14,b=t[e++]|t[e++]<<8,e++;else for(e+=12;;){if(!((P=t[e++])>=0))throw Error("Invalid block size");if(P===0)break;e+=P}break;case 249:if(t[e++]!==4||t[e+4]!==0)throw new Error("Invalid graphics extension block.");var w=t[e++];m=t[e++]|t[e++]<<8,v=t[e++],(1&w)==0&&(v=null),p=w>>2&7,e++;break;case 254:for(;;){if(!((P=t[e++])>=0))throw Error("Invalid block size");if(P===0)break;e+=P}break;default:throw new Error("Unknown graphic control label: 0x"+t[e-1].toString(16))}break;case 44:var y=t[e++]|t[e++]<<8,j=t[e++]|t[e++]<<8,O=t[e++]|t[e++]<<8,k=t[e++]|t[e++]<<8,I=t[e++],H=I>>6&1,F=1<<(7&I)+1,U=l,C=u,N=!1;I>>7&&(N=!0,U=e,C=F,e+=3*F);var Q=e;for(e++;;){var P;if(!((P=t[e++])>=0))throw Error("Invalid block size");if(P===0)break;e+=P}f.push({x:y,y:j,width:O,height:k,has_local_palette:N,palette_offset:U,palette_size:C,data_offset:Q,data_length:e-Q,transparent_index:v,interlaced:!!H,delay:m,disposal:p});break;case 59:d=!1;break;default:throw new Error("Unknown gif block: 0x"+t[e-1].toString(16))}this.numFrames=function(){return f.length},this.loopCount=function(){return b},this.frameInfo=function(L){if(L<0||L>=f.length)throw new Error("Frame index out of range.");return f[L]},this.decodeAndBlitFrameBGRA=function(L,te){var W=this.frameInfo(L),z=W.width*W.height,V=new Uint8Array(z);Dp(t,W.data_offset,V,z);var Y=W.palette_offset,E=W.transparent_index;E===null&&(E=256);var X=W.width,oe=r-X,de=X,A=4*(W.y*r+W.x),D=4*((W.y+W.height)*r+W.x),J=A,re=4*oe;W.interlaced===!0&&(re+=4*r*7);for(var ce=8,fe=0,ee=V.length;fe<ee;++fe){var ae=V[fe];if(de===0&&(de=X,(J+=re)>=D&&(re=4*oe+4*r*(ce-1),J=A+(X+oe)*(ce<<1),ce>>=1)),ae===E)J+=4;else{var pe=t[Y+3*ae],ye=t[Y+3*ae+1],Le=t[Y+3*ae+2];te[J++]=Le,te[J++]=ye,te[J++]=pe,te[J++]=255}--de}},this.decodeAndBlitFrameRGBA=function(L,te){var W=this.frameInfo(L),z=W.width*W.height,V=new Uint8Array(z);Dp(t,W.data_offset,V,z);var Y=W.palette_offset,E=W.transparent_index;E===null&&(E=256);var X=W.width,oe=r-X,de=X,A=4*(W.y*r+W.x),D=4*((W.y+W.height)*r+W.x),J=A,re=4*oe;W.interlaced===!0&&(re+=4*r*7);for(var ce=8,fe=0,ee=V.length;fe<ee;++fe){var ae=V[fe];if(de===0&&(de=X,(J+=re)>=D&&(re=4*oe+4*r*(ce-1),J=A+(X+oe)*(ce<<1),ce>>=1)),ae===E)J+=4;else{var pe=t[Y+3*ae],ye=t[Y+3*ae+1],Le=t[Y+3*ae+2];te[J++]=pe,te[J++]=ye,te[J++]=Le,te[J++]=255}--de}}}function Dp(t,e,r,n){for(var s=t[e++],i=1<<s,o=i+1,l=o+1,u=s+1,d=(1<<u)-1,f=0,m=0,v=0,p=t[e++],b=new Int32Array(4096),w=null;;){for(;f<16&&p!==0;)m|=t[e++]<<f,f+=8,p===1?p=t[e++]:--p;if(f<u)break;var y=m&d;if(m>>=u,f-=u,y!==i){if(y===o)break;for(var j=y<l?y:w,O=0,k=j;k>i;)k=b[k]>>8,++O;var I=k;if(v+O+(j!==y?1:0)>n)return void Mr.log("Warning, gif stream longer than expected.");r[v++]=I;var H=v+=O;for(j!==y&&(r[v++]=I),k=j;O--;)k=b[k],r[--H]=255&k,k>>=8;w!==null&&l<4096&&(b[l++]=w<<8|I,l>=d+1&&u<12&&(++u,d=d<<1|1)),w=y}else l=o+1,d=(1<<(u=s+1))-1,w=null}return v!==n&&Mr.log("Warning, gif stream shorter than expected."),r}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function Cd(t){var e,r,n,s,i,o=Math.floor,l=new Array(64),u=new Array(64),d=new Array(64),f=new Array(64),m=new Array(65535),v=new Array(65535),p=new Array(64),b=new Array(64),w=[],y=0,j=7,O=new Array(64),k=new Array(64),I=new Array(64),H=new Array(256),F=new Array(2048),U=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],C=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],N=[0,1,2,3,4,5,6,7,8,9,10,11],Q=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],P=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],L=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],te=[0,1,2,3,4,5,6,7,8,9,10,11],W=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],z=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function V(A,D){for(var J=0,re=0,ce=new Array,fe=1;fe<=16;fe++){for(var ee=1;ee<=A[fe];ee++)ce[D[re]]=[],ce[D[re]][0]=J,ce[D[re]][1]=fe,re++,J++;J*=2}return ce}function Y(A){for(var D=A[0],J=A[1]-1;J>=0;)D&1<<J&&(y|=1<<j),J--,--j<0&&(y==255?(E(255),E(0)):E(y),j=7,y=0)}function E(A){w.push(A)}function X(A){E(A>>8&255),E(255&A)}function oe(A,D,J,re,ce){for(var fe,ee=ce[0],ae=ce[240],pe=function(Pe,He){var Ye,nt,dt,Ae,Re,st,it,Lt,gt,St,ct=0;for(gt=0;gt<8;++gt){Ye=Pe[ct],nt=Pe[ct+1],dt=Pe[ct+2],Ae=Pe[ct+3],Re=Pe[ct+4],st=Pe[ct+5],it=Pe[ct+6];var Rt=Ye+(Lt=Pe[ct+7]),xt=Ye-Lt,Rr=nt+it,tr=nt-it,rr=dt+st,Pn=dt-st,Bt=Ae+Re,Xr=Ae-Re,sr=Rt+Bt,Zr=Rt-Bt,xn=Rr+rr,_r=Rr-rr;Pe[ct]=sr+xn,Pe[ct+4]=sr-xn;var Pt=.707106781*(_r+Zr);Pe[ct+2]=Zr+Pt,Pe[ct+6]=Zr-Pt;var Kt=.382683433*((sr=Xr+Pn)-(_r=tr+xt)),Ln=.5411961*sr+Kt,ir=1.306562965*_r+Kt,Hr=.707106781*(xn=Pn+tr),Nn=xt+Hr,Nt=xt-Hr;Pe[ct+5]=Nt+Ln,Pe[ct+3]=Nt-Ln,Pe[ct+1]=Nn+ir,Pe[ct+7]=Nn-ir,ct+=8}for(ct=0,gt=0;gt<8;++gt){Ye=Pe[ct],nt=Pe[ct+8],dt=Pe[ct+16],Ae=Pe[ct+24],Re=Pe[ct+32],st=Pe[ct+40],it=Pe[ct+48];var kn=Ye+(Lt=Pe[ct+56]),Ne=Ye-Lt,Be=nt+it,Ve=nt-it,Ke=dt+st,$t=dt-st,kt=Ae+Re,ur=Ae-Re,kr=kn+kt,ln=kn-kt,$e=Be+Ke,ze=Be-Ke;Pe[ct]=kr+$e,Pe[ct+32]=kr-$e;var ut=.707106781*(ze+ln);Pe[ct+16]=ln+ut,Pe[ct+48]=ln-ut;var qt=.382683433*((kr=ur+$t)-(ze=Ve+Ne)),qr=.5411961*kr+qt,Me=1.306562965*ze+qt,Ue=.707106781*($e=$t+Ve),rt=Ne+Ue,Je=Ne-Ue;Pe[ct+40]=Je+qr,Pe[ct+24]=Je-qr,Pe[ct+8]=rt+Me,Pe[ct+56]=rt-Me,ct++}for(gt=0;gt<64;++gt)St=Pe[gt]*He[gt],p[gt]=St>0?St+.5|0:St-.5|0;return p}(A,D),ye=0;ye<64;++ye)b[U[ye]]=pe[ye];var Le=b[0]-J;J=b[0],Le==0?Y(re[0]):(Y(re[v[fe=32767+Le]]),Y(m[fe]));for(var se=63;se>0&&b[se]==0;)se--;if(se==0)return Y(ee),J;for(var Fe,ne=1;ne<=se;){for(var R=ne;b[ne]==0&&ne<=se;)++ne;var be=ne-R;if(be>=16){Fe=be>>4;for(var je=1;je<=Fe;++je)Y(ae);be&=15}fe=32767+b[ne],Y(ce[(be<<4)+v[fe]]),Y(m[fe]),ne++}return se!=63&&Y(ee),J}function de(A){A=Math.min(Math.max(A,1),100),i!=A&&(function(D){for(var J=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],re=0;re<64;re++){var ce=o((J[re]*D+50)/100);ce=Math.min(Math.max(ce,1),255),l[U[re]]=ce}for(var fe=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],ee=0;ee<64;ee++){var ae=o((fe[ee]*D+50)/100);ae=Math.min(Math.max(ae,1),255),u[U[ee]]=ae}for(var pe=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],ye=0,Le=0;Le<8;Le++)for(var se=0;se<8;se++)d[ye]=1/(l[U[ye]]*pe[Le]*pe[se]*8),f[ye]=1/(u[U[ye]]*pe[Le]*pe[se]*8),ye++}(A<50?Math.floor(5e3/A):Math.floor(200-2*A)),i=A)}this.encode=function(A,D){D&&de(D),w=new Array,y=0,j=7,X(65496),X(65504),X(16),E(74),E(70),E(73),E(70),E(0),E(1),E(1),E(0),X(1),X(1),E(0),E(0),function(){X(65499),X(132),E(0);for(var nt=0;nt<64;nt++)E(l[nt]);E(1);for(var dt=0;dt<64;dt++)E(u[dt])}(),function(nt,dt){X(65472),X(17),E(8),X(dt),X(nt),E(3),E(1),E(17),E(0),E(2),E(17),E(1),E(3),E(17),E(1)}(A.width,A.height),function(){X(65476),X(418),E(0);for(var nt=0;nt<16;nt++)E(C[nt+1]);for(var dt=0;dt<=11;dt++)E(N[dt]);E(16);for(var Ae=0;Ae<16;Ae++)E(Q[Ae+1]);for(var Re=0;Re<=161;Re++)E(P[Re]);E(1);for(var st=0;st<16;st++)E(L[st+1]);for(var it=0;it<=11;it++)E(te[it]);E(17);for(var Lt=0;Lt<16;Lt++)E(W[Lt+1]);for(var gt=0;gt<=161;gt++)E(z[gt])}(),X(65498),X(12),E(3),E(1),E(0),E(2),E(17),E(3),E(17),E(0),E(63),E(0);var J=0,re=0,ce=0;y=0,j=7,this.encode.displayName="_encode_";for(var fe,ee,ae,pe,ye,Le,se,Fe,ne,R=A.data,be=A.width,je=A.height,Pe=4*be,He=0;He<je;){for(fe=0;fe<Pe;){for(ye=Pe*He+fe,se=-1,Fe=0,ne=0;ne<64;ne++)Le=ye+(Fe=ne>>3)*Pe+(se=4*(7&ne)),He+Fe>=je&&(Le-=Pe*(He+1+Fe-je)),fe+se>=Pe&&(Le-=fe+se-Pe+4),ee=R[Le++],ae=R[Le++],pe=R[Le++],O[ne]=(F[ee]+F[ae+256>>0]+F[pe+512>>0]>>16)-128,k[ne]=(F[ee+768>>0]+F[ae+1024>>0]+F[pe+1280>>0]>>16)-128,I[ne]=(F[ee+1280>>0]+F[ae+1536>>0]+F[pe+1792>>0]>>16)-128;J=oe(O,d,J,e,n),re=oe(k,f,re,r,s),ce=oe(I,f,ce,r,s),fe+=32}He+=8}if(j>=0){var Ye=[];Ye[1]=j+1,Ye[0]=(1<<j+1)-1,Y(Ye)}return X(65497),new Uint8Array(w)},t=t||50,function(){for(var A=String.fromCharCode,D=0;D<256;D++)H[D]=A(D)}(),e=V(C,N),r=V(L,te),n=V(Q,P),s=V(W,z),function(){for(var A=1,D=2,J=1;J<=15;J++){for(var re=A;re<D;re++)v[32767+re]=J,m[32767+re]=[],m[32767+re][1]=J,m[32767+re][0]=re;for(var ce=-(D-1);ce<=-A;ce++)v[32767+ce]=J,m[32767+ce]=[],m[32767+ce][1]=J,m[32767+ce][0]=D-1+ce;A<<=1,D<<=1}}(),function(){for(var A=0;A<256;A++)F[A]=19595*A,F[A+256>>0]=38470*A,F[A+512>>0]=7471*A+32768,F[A+768>>0]=-11059*A,F[A+1024>>0]=-21709*A,F[A+1280>>0]=32768*A+8421375,F[A+1536>>0]=-27439*A,F[A+1792>>0]=-5329*A}(),de(t)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function Da(t,e){if(this.pos=0,this.buffer=t,this.datav=new DataView(t.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function Tp(t){function e(C){if(!C)throw Error("assert :P")}function r(C,N,Q){for(var P=0;4>P;P++)if(C[N+P]!=Q.charCodeAt(P))return!0;return!1}function n(C,N,Q,P,L){for(var te=0;te<L;te++)C[N+te]=Q[P+te]}function s(C,N,Q,P){for(var L=0;L<P;L++)C[N+L]=Q}function i(C){return new Int32Array(C)}function o(C,N){for(var Q=[],P=0;P<C;P++)Q.push(new N);return Q}function l(C,N){var Q=[];return function P(L,te,W){for(var z=W[te],V=0;V<z&&(L.push(W.length>te+1?[]:new N),!(W.length<te+1));V++)P(L[V],te+1,W)}(Q,0,C),Q}var u=function(){var C=this;function N(c,h){for(var x=1<<h-1>>>0;c&x;)x>>>=1;return x?(c&x-1)+x:c}function Q(c,h,x,S,T){e(!(S%x));do c[h+(S-=x)]=T;while(0<S)}function P(c,h,x,S,T){if(e(2328>=T),512>=T)var B=i(512);else if((B=i(T))==null)return 0;return function($,G,K,ie,we,Ie){var De,ke,tt=G,We=1<<K,_e=i(16),Se=i(16);for(e(we!=0),e(ie!=null),e($!=null),e(0<K),ke=0;ke<we;++ke){if(15<ie[ke])return 0;++_e[ie[ke]]}if(_e[0]==we)return 0;for(Se[1]=0,De=1;15>De;++De){if(_e[De]>1<<De)return 0;Se[De+1]=Se[De]+_e[De]}for(ke=0;ke<we;++ke)De=ie[ke],0<ie[ke]&&(Ie[Se[De]++]=ke);if(Se[15]==1)return(ie=new L).g=0,ie.value=Ie[0],Q($,tt,1,We,ie),We;var Ze,ot=-1,et=We-1,wt=0,ft=1,Dt=1,vt=1<<K;for(ke=0,De=1,we=2;De<=K;++De,we<<=1){if(ft+=Dt<<=1,0>(Dt-=_e[De]))return 0;for(;0<_e[De];--_e[De])(ie=new L).g=De,ie.value=Ie[ke++],Q($,tt+wt,we,vt,ie),wt=N(wt,De)}for(De=K+1,we=2;15>=De;++De,we<<=1){if(ft+=Dt<<=1,0>(Dt-=_e[De]))return 0;for(;0<_e[De];--_e[De]){if(ie=new L,(wt&et)!=ot){for(tt+=vt,Ze=1<<(ot=De)-K;15>ot&&!(0>=(Ze-=_e[ot]));)++ot,Ze<<=1;We+=vt=1<<(Ze=ot-K),$[G+(ot=wt&et)].g=Ze+K,$[G+ot].value=tt-G-ot}ie.g=De-K,ie.value=Ie[ke++],Q($,tt+(wt>>K),we,vt,ie),wt=N(wt,De)}}return ft!=2*Se[15]-1?0:We}(c,h,x,S,T,B)}function L(){this.value=this.g=0}function te(){this.value=this.g=0}function W(){this.G=o(5,L),this.H=i(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=o(Rn,te)}function z(c,h,x,S){e(c!=null),e(h!=null),e(2147483648>S),c.Ca=254,c.I=0,c.b=-8,c.Ka=0,c.oa=h,c.pa=x,c.Jd=h,c.Yc=x+S,c.Zc=4<=S?x+S-4+1:x,fe(c)}function V(c,h){for(var x=0;0<h--;)x|=ae(c,128)<<h;return x}function Y(c,h){var x=V(c,h);return ee(c)?-x:x}function E(c,h,x,S){var T,B=0;for(e(c!=null),e(h!=null),e(4294967288>S),c.Sb=S,c.Ra=0,c.u=0,c.h=0,4<S&&(S=4),T=0;T<S;++T)B+=h[x+T]<<8*T;c.Ra=B,c.bb=S,c.oa=h,c.pa=x}function X(c){for(;8<=c.u&&c.bb<c.Sb;)c.Ra>>>=8,c.Ra+=c.oa[c.pa+c.bb]<<Ti-8>>>0,++c.bb,c.u-=8;J(c)&&(c.h=1,c.u=0)}function oe(c,h){if(e(0<=h),!c.h&&h<=Di){var x=D(c)&Ii[h];return c.u+=h,X(c),x}return c.h=1,c.u=0}function de(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function A(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function D(c){return c.Ra>>>(c.u&Ti-1)>>>0}function J(c){return e(c.bb<=c.Sb),c.h||c.bb==c.Sb&&c.u>Ti}function re(c,h){c.u=h,c.h=J(c)}function ce(c){c.u>=Fo&&(e(c.u>=Fo),X(c))}function fe(c){e(c!=null&&c.oa!=null),c.pa<c.Zc?(c.I=(c.oa[c.pa++]|c.I<<8)>>>0,c.b+=8):(e(c!=null&&c.oa!=null),c.pa<c.Yc?(c.b+=8,c.I=c.oa[c.pa++]|c.I<<8):c.Ka?c.b=0:(c.I<<=8,c.b+=8,c.Ka=1))}function ee(c){return V(c,1)}function ae(c,h){var x=c.Ca;0>c.b&&fe(c);var S=c.b,T=x*h>>>8,B=(c.I>>>S>T)+0;for(B?(x-=T,c.I-=T+1<<S>>>0):x=T+1,S=x,T=0;256<=S;)T+=8,S>>=8;return S=7^T+ta[S],c.b-=S,c.Ca=(x<<S)-1,B}function pe(c,h,x){c[h+0]=x>>24&255,c[h+1]=x>>16&255,c[h+2]=x>>8&255,c[h+3]=x>>0&255}function ye(c,h){return c[h+0]<<0|c[h+1]<<8}function Le(c,h){return ye(c,h)|c[h+2]<<16}function se(c,h){return ye(c,h)|ye(c,h+2)<<16}function Fe(c,h){var x=1<<h;return e(c!=null),e(0<h),c.X=i(x),c.X==null?0:(c.Mb=32-h,c.Xa=h,1)}function ne(c,h){e(c!=null),e(h!=null),e(c.Xa==h.Xa),n(h.X,0,c.X,0,1<<h.Xa)}function R(){this.X=[],this.Xa=this.Mb=0}function be(c,h,x,S){e(x!=null),e(S!=null);var T=x[0],B=S[0];return T==0&&(T=(c*B+h/2)/h),B==0&&(B=(h*T+c/2)/c),0>=T||0>=B?0:(x[0]=T,S[0]=B,1)}function je(c,h){return c+(1<<h)-1>>>h}function Pe(c,h){return((4278255360&c)+(4278255360&h)>>>0&4278255360)+((16711935&c)+(16711935&h)>>>0&16711935)>>>0}function He(c,h){C[h]=function(x,S,T,B,$,G,K){var ie;for(ie=0;ie<$;++ie){var we=C[c](G[K+ie-1],T,B+ie);G[K+ie]=Pe(x[S+ie],we)}}}function Ye(){this.ud=this.hd=this.jd=0}function nt(c,h){return((4278124286&(c^h))>>>1)+(c&h)>>>0}function dt(c){return 0<=c&&256>c?c:0>c?0:255<c?255:void 0}function Ae(c,h){return dt(c+(c-h+.5>>1))}function Re(c,h,x){return Math.abs(h-x)-Math.abs(c-x)}function st(c,h,x,S,T,B,$){for(S=B[$-1],x=0;x<T;++x)B[$+x]=S=Pe(c[h+x],S)}function it(c,h,x,S,T){var B;for(B=0;B<x;++B){var $=c[h+B],G=$>>8&255,K=16711935&(K=(K=16711935&$)+((G<<16)+G));S[T+B]=(4278255360&$)+K>>>0}}function Lt(c,h){h.jd=c>>0&255,h.hd=c>>8&255,h.ud=c>>16&255}function gt(c,h,x,S,T,B){var $;for($=0;$<S;++$){var G=h[x+$],K=G>>>8,ie=G,we=255&(we=(we=G>>>16)+((c.jd<<24>>24)*(K<<24>>24)>>>5));ie=255&(ie=(ie=ie+((c.hd<<24>>24)*(K<<24>>24)>>>5))+((c.ud<<24>>24)*(we<<24>>24)>>>5)),T[B+$]=(4278255360&G)+(we<<16)+ie}}function St(c,h,x,S,T){C[h]=function(B,$,G,K,ie,we,Ie,De,ke){for(K=Ie;K<De;++K)for(Ie=0;Ie<ke;++Ie)ie[we++]=T(G[S(B[$++])])},C[c]=function(B,$,G,K,ie,we,Ie){var De=8>>B.b,ke=B.Ea,tt=B.K[0],We=B.w;if(8>De)for(B=(1<<B.b)-1,We=(1<<De)-1;$<G;++$){var _e,Se=0;for(_e=0;_e<ke;++_e)_e&B||(Se=S(K[ie++])),we[Ie++]=T(tt[Se&We]),Se>>=De}else C["VP8LMapColor"+x](K,ie,tt,We,we,Ie,$,G,ke)}}function ct(c,h,x,S,T){for(x=h+x;h<x;){var B=c[h++];S[T++]=B>>16&255,S[T++]=B>>8&255,S[T++]=B>>0&255}}function Rt(c,h,x,S,T){for(x=h+x;h<x;){var B=c[h++];S[T++]=B>>16&255,S[T++]=B>>8&255,S[T++]=B>>0&255,S[T++]=B>>24&255}}function xt(c,h,x,S,T){for(x=h+x;h<x;){var B=($=c[h++])>>16&240|$>>12&15,$=$>>0&240|$>>28&15;S[T++]=B,S[T++]=$}}function Rr(c,h,x,S,T){for(x=h+x;h<x;){var B=($=c[h++])>>16&248|$>>13&7,$=$>>5&224|$>>3&31;S[T++]=B,S[T++]=$}}function tr(c,h,x,S,T){for(x=h+x;h<x;){var B=c[h++];S[T++]=B>>0&255,S[T++]=B>>8&255,S[T++]=B>>16&255}}function rr(c,h,x,S,T,B){if(B==0)for(x=h+x;h<x;)pe(S,((B=c[h++])[0]>>24|B[1]>>8&65280|B[2]<<8&16711680|B[3]<<24)>>>0),T+=32;else n(S,T,c,h,x)}function Pn(c,h){C[h][0]=C[c+"0"],C[h][1]=C[c+"1"],C[h][2]=C[c+"2"],C[h][3]=C[c+"3"],C[h][4]=C[c+"4"],C[h][5]=C[c+"5"],C[h][6]=C[c+"6"],C[h][7]=C[c+"7"],C[h][8]=C[c+"8"],C[h][9]=C[c+"9"],C[h][10]=C[c+"10"],C[h][11]=C[c+"11"],C[h][12]=C[c+"12"],C[h][13]=C[c+"13"],C[h][14]=C[c+"0"],C[h][15]=C[c+"0"]}function Bt(c){return c==Vu||c==Gu||c==uc||c==Qu}function Xr(){this.eb=[],this.size=this.A=this.fb=0}function sr(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Zr(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Xr,this.f.kb=new sr,this.sd=null}function xn(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function _r(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Pt(c){return alert("todo:WebPSamplerProcessPlane"),c.T}function Kt(c,h){var x=c.T,S=h.ba.f.RGBA,T=S.eb,B=S.fb+c.ka*S.A,$=_a[h.ba.S],G=c.y,K=c.O,ie=c.f,we=c.N,Ie=c.ea,De=c.W,ke=h.cc,tt=h.dc,We=h.Mc,_e=h.Nc,Se=c.ka,Ze=c.ka+c.T,ot=c.U,et=ot+1>>1;for(Se==0?$(G,K,null,null,ie,we,Ie,De,ie,we,Ie,De,T,B,null,null,ot):($(h.ec,h.fc,G,K,ke,tt,We,_e,ie,we,Ie,De,T,B-S.A,T,B,ot),++x);Se+2<Ze;Se+=2)ke=ie,tt=we,We=Ie,_e=De,we+=c.Rc,De+=c.Rc,B+=2*S.A,$(G,(K+=2*c.fa)-c.fa,G,K,ke,tt,We,_e,ie,we,Ie,De,T,B-S.A,T,B,ot);return K+=c.fa,c.j+Ze<c.o?(n(h.ec,h.fc,G,K,ot),n(h.cc,h.dc,ie,we,et),n(h.Mc,h.Nc,Ie,De,et),x--):1&Ze||$(G,K,null,null,ie,we,Ie,De,ie,we,Ie,De,T,B+S.A,null,null,ot),x}function Ln(c,h,x){var S=c.F,T=[c.J];if(S!=null){var B=c.U,$=h.ba.S,G=$==cc||$==uc;h=h.ba.f.RGBA;var K=[0],ie=c.ka;K[0]=c.T,c.Kb&&(ie==0?--K[0]:(--ie,T[0]-=c.width),c.j+c.ka+c.T==c.o&&(K[0]=c.o-c.j-ie));var we=h.eb;ie=h.fb+ie*h.A,c=Wr(S,T[0],c.width,B,K,we,ie+(G?0:3),h.A),e(x==K),c&&Bt($)&&ba(we,ie,G,B,K,h.A)}return 0}function ir(c){var h=c.ma,x=h.ba.S,S=11>x,T=x==oc||x==lc||x==cc||x==Yu||x==12||Bt(x);if(h.memory=null,h.Ib=null,h.Jb=null,h.Nd=null,!To(h.Oa,c,T?11:12))return 0;if(T&&Bt(x)&&lt(),c.da)alert("todo:use_scaling");else{if(S){if(h.Ib=Pt,c.Kb){if(x=c.U+1>>1,h.memory=i(c.U+2*x),h.memory==null)return 0;h.ec=h.memory,h.fc=0,h.cc=h.ec,h.dc=h.fc+c.U,h.Mc=h.cc,h.Nc=h.dc+x,h.Ib=Kt,lt()}}else alert("todo:EmitYUV");T&&(h.Jb=Ln,S&&Ee())}if(S&&!Zh){for(c=0;256>c;++c)J1[c]=89858*(c-128)+hc>>dc,Z1[c]=-22014*(c-128)+hc,X1[c]=-45773*(c-128),K1[c]=113618*(c-128)+hc>>dc;for(c=$o;c<Xu;++c)h=76283*(c-16)+hc>>dc,e0[c-$o]=ha(h,255),t0[c-$o]=ha(h+8>>4,15);Zh=1}return 1}function Hr(c){var h=c.ma,x=c.U,S=c.T;return e(!(1&c.ka)),0>=x||0>=S?0:(x=h.Ib(c,h),h.Jb!=null&&h.Jb(c,h,x),h.Dc+=x,1)}function Nn(c){c.ma.memory=null}function Nt(c,h,x,S){return oe(c,8)!=47?0:(h[0]=oe(c,14)+1,x[0]=oe(c,14)+1,S[0]=oe(c,1),oe(c,3)!=0?0:!c.h)}function kn(c,h){if(4>c)return c+1;var x=c-2>>1;return(2+(1&c)<<x)+oe(h,x)+1}function Ne(c,h){return 120<h?h-120:1<=(x=((x=M1[h-1])>>4)*c+(8-(15&x)))?x:1;var x}function Be(c,h,x){var S=D(x),T=c[h+=255&S].g-8;return 0<T&&(re(x,x.u+8),S=D(x),h+=c[h].value,h+=S&(1<<T)-1),re(x,x.u+c[h].g),c[h].value}function Ve(c,h,x){return x.g+=c.g,x.value+=c.value<<h>>>0,e(8>=x.g),c.g}function Ke(c,h,x){var S=c.xc;return e((h=S==0?0:c.vc[c.md*(x>>S)+(h>>S)])<c.Wb),c.Ya[h]}function $t(c,h,x,S){var T=c.ab,B=c.c*h,$=c.C;h=$+h;var G=x,K=S;for(S=c.Ta,x=c.Ua;0<T--;){var ie=c.gc[T],we=$,Ie=h,De=G,ke=K,tt=(K=S,G=x,ie.Ea);switch(e(we<Ie),e(Ie<=ie.nc),ie.hc){case 2:ec(De,ke,(Ie-we)*tt,K,G);break;case 0:var We=we,_e=Ie,Se=K,Ze=G,ot=(vt=ie).Ea;We==0&&($u(De,ke,null,null,1,Se,Ze),st(De,ke+1,0,0,ot-1,Se,Ze+1),ke+=ot,Ze+=ot,++We);for(var et=1<<vt.b,wt=et-1,ft=je(ot,vt.b),Dt=vt.K,vt=vt.w+(We>>vt.b)*ft;We<_e;){var yr=Dt,Ar=vt,fr=1;for(Ro(De,ke,Se,Ze-ot,1,Se,Ze);fr<ot;){var or=(fr&~wt)+et;or>ot&&(or=ot),(0,Ss[yr[Ar++]>>8&15])(De,ke+ +fr,Se,Ze+fr-ot,or-fr,Se,Ze+fr),fr=or}ke+=ot,Ze+=ot,++We&wt||(vt+=ft)}Ie!=ie.nc&&n(K,G-tt,K,G+(Ie-we-1)*tt,tt);break;case 1:for(tt=De,_e=ke,ot=(De=ie.Ea)-(Ze=De&~(Se=(ke=1<<ie.b)-1)),We=je(De,ie.b),et=ie.K,ie=ie.w+(we>>ie.b)*We;we<Ie;){for(wt=et,ft=ie,Dt=new Ye,vt=_e+Ze,yr=_e+De;_e<vt;)Lt(wt[ft++],Dt),ei(Dt,tt,_e,ke,K,G),_e+=ke,G+=ke;_e<yr&&(Lt(wt[ft++],Dt),ei(Dt,tt,_e,ot,K,G),_e+=ot,G+=ot),++we&Se||(ie+=We)}break;case 3:if(De==K&&ke==G&&0<ie.b){for(_e=K,De=tt=G+(Ie-we)*tt-(Ze=(Ie-we)*je(ie.Ea,ie.b)),ke=K,Se=G,We=[],Ze=(ot=Ze)-1;0<=Ze;--Ze)We[Ze]=ke[Se+Ze];for(Ze=ot-1;0<=Ze;--Ze)_e[De+Ze]=We[Ze];va(ie,we,Ie,K,tt,K,G)}else va(ie,we,Ie,De,ke,K,G)}G=S,K=x}K!=x&&n(S,x,G,K,B)}function kt(c,h){var x=c.V,S=c.Ba+c.c*c.C,T=h-c.C;if(e(h<=c.l.o),e(16>=T),0<T){var B=c.l,$=c.Ta,G=c.Ua,K=B.width;if($t(c,T,x,S),T=G=[G],e((x=c.C)<(S=h)),e(B.v<B.va),S>B.o&&(S=B.o),x<B.j){var ie=B.j-x;x=B.j,T[0]+=ie*K}if(x>=S?x=0:(T[0]+=4*B.v,B.ka=x-B.j,B.U=B.va-B.v,B.T=S-x,x=1),x){if(G=G[0],11>(x=c.ca).S){var we=x.f.RGBA,Ie=(S=x.S,T=B.U,B=B.T,ie=we.eb,we.A),De=B;for(we=we.fb+c.Ma*we.A;0<De--;){var ke=$,tt=G,We=T,_e=ie,Se=we;switch(S){case ic:ra(ke,tt,We,_e,Se);break;case oc:Jn(ke,tt,We,_e,Se);break;case Vu:Jn(ke,tt,We,_e,Se),ba(_e,Se,0,We,1,0);break;case $h:ls(ke,tt,We,_e,Se);break;case lc:rr(ke,tt,We,_e,Se,1);break;case Gu:rr(ke,tt,We,_e,Se,1),ba(_e,Se,0,We,1,0);break;case cc:rr(ke,tt,We,_e,Se,0);break;case uc:rr(ke,tt,We,_e,Se,0),ba(_e,Se,1,We,1,0);break;case Yu:Cs(ke,tt,We,_e,Se);break;case Qu:Cs(ke,tt,We,_e,Se),Ur(_e,Se,We,1,0);break;case Hh:os(ke,tt,We,_e,Se);break;default:e(0)}G+=K,we+=Ie}c.Ma+=B}else alert("todo:EmitRescaledRowsYUVA");e(c.Ma<=x.height)}}c.C=h,e(c.C<=c.i)}function ur(c){var h;if(0<c.ua)return 0;for(h=0;h<c.Wb;++h){var x=c.Ya[h].G,S=c.Ya[h].H;if(0<x[1][S[1]+0].g||0<x[2][S[2]+0].g||0<x[3][S[3]+0].g)return 0}return 1}function kr(c,h,x,S,T,B){if(c.Z!=0){var $=c.qd,G=c.rd;for(e(Ls[c.Z]!=null);h<x;++h)Ls[c.Z]($,G,S,T,S,T,B),$=S,G=T,T+=B;c.qd=$,c.rd=G}}function ln(c,h){var x=c.l.ma,S=x.Z==0||x.Z==1?c.l.j:c.C;if(S=c.C<S?S:c.C,e(h<=c.l.o),h>S){var T=c.l.width,B=x.ca,$=x.tb+T*S,G=c.V,K=c.Ba+c.c*S,ie=c.gc;e(c.ab==1),e(ie[0].hc==3),tc(ie[0],S,h,G,K,B,$),kr(x,S,h,B,$,T)}c.C=c.Ma=h}function $e(c,h,x,S,T,B,$){var G=c.$/S,K=c.$%S,ie=c.m,we=c.s,Ie=x+c.$,De=Ie;T=x+S*T;var ke=x+S*B,tt=280+we.ua,We=c.Pb?G:16777216,_e=0<we.ua?we.Wa:null,Se=we.wc,Ze=Ie<ke?Ke(we,K,G):null;e(c.C<B),e(ke<=T);var ot=!1;e:for(;;){for(;ot||Ie<ke;){var et=0;if(G>=We){var wt=Ie-x;e((We=c).Pb),We.wd=We.m,We.xd=wt,0<We.s.ua&&ne(We.s.Wa,We.s.vb),We=G+R1}if(K&Se||(Ze=Ke(we,K,G)),e(Ze!=null),Ze.Qb&&(h[Ie]=Ze.qb,ot=!0),!ot)if(ce(ie),Ze.jc){et=ie,wt=h;var ft=Ie,Dt=Ze.pd[D(et)&Rn-1];e(Ze.jc),256>Dt.g?(re(et,et.u+Dt.g),wt[ft]=Dt.value,et=0):(re(et,et.u+Dt.g-256),e(256<=Dt.value),et=Dt.value),et==0&&(ot=!0)}else et=Be(Ze.G[0],Ze.H[0],ie);if(ie.h)break;if(ot||256>et){if(!ot)if(Ze.nd)h[Ie]=(Ze.qb|et<<8)>>>0;else{if(ce(ie),ot=Be(Ze.G[1],Ze.H[1],ie),ce(ie),wt=Be(Ze.G[2],Ze.H[2],ie),ft=Be(Ze.G[3],Ze.H[3],ie),ie.h)break;h[Ie]=(ft<<24|ot<<16|et<<8|wt)>>>0}if(ot=!1,++Ie,++K>=S&&(K=0,++G,$!=null&&G<=B&&!(G%16)&&$(c,G),_e!=null))for(;De<Ie;)et=h[De++],_e.X[(506832829*et&4294967295)>>>_e.Mb]=et}else if(280>et){if(et=kn(et-256,ie),wt=Be(Ze.G[4],Ze.H[4],ie),ce(ie),wt=Ne(S,wt=kn(wt,ie)),ie.h)break;if(Ie-x<wt||T-Ie<et)break e;for(ft=0;ft<et;++ft)h[Ie+ft]=h[Ie+ft-wt];for(Ie+=et,K+=et;K>=S;)K-=S,++G,$!=null&&G<=B&&!(G%16)&&$(c,G);if(e(Ie<=T),K&Se&&(Ze=Ke(we,K,G)),_e!=null)for(;De<Ie;)et=h[De++],_e.X[(506832829*et&4294967295)>>>_e.Mb]=et}else{if(!(et<tt))break e;for(ot=et-280,e(_e!=null);De<Ie;)et=h[De++],_e.X[(506832829*et&4294967295)>>>_e.Mb]=et;et=Ie,e(!(ot>>>(wt=_e).Xa)),h[et]=wt.X[ot],ot=!0}ot||e(ie.h==J(ie))}if(c.Pb&&ie.h&&Ie<T)e(c.m.h),c.a=5,c.m=c.wd,c.$=c.xd,0<c.s.ua&&ne(c.s.vb,c.s.Wa);else{if(ie.h)break e;$?.(c,G>B?B:G),c.a=0,c.$=Ie-x}return 1}return c.a=3,0}function ze(c){e(c!=null),c.vc=null,c.yc=null,c.Ya=null;var h=c.Wa;h!=null&&(h.X=null),c.vb=null,e(c!=null)}function ut(){var c=new zu;return c==null?null:(c.a=0,c.xb=Gh,Pn("Predictor","VP8LPredictors"),Pn("Predictor","VP8LPredictors_C"),Pn("PredictorAdd","VP8LPredictorsAdd"),Pn("PredictorAdd","VP8LPredictorsAdd_C"),ec=it,ei=gt,ra=ct,Jn=Rt,Cs=xt,os=Rr,ls=tr,C.VP8LMapColor32b=Mi,C.VP8LMapColor8b=rc,c)}function qt(c,h,x,S,T){var B=1,$=[c],G=[h],K=S.m,ie=S.s,we=null,Ie=0;e:for(;;){if(x)for(;B&&oe(K,1);){var De=$,ke=G,tt=S,We=1,_e=tt.m,Se=tt.gc[tt.ab],Ze=oe(_e,2);if(tt.Oc&1<<Ze)B=0;else{switch(tt.Oc|=1<<Ze,Se.hc=Ze,Se.Ea=De[0],Se.nc=ke[0],Se.K=[null],++tt.ab,e(4>=tt.ab),Ze){case 0:case 1:Se.b=oe(_e,3)+2,We=qt(je(Se.Ea,Se.b),je(Se.nc,Se.b),0,tt,Se.K),Se.K=Se.K[0];break;case 3:var ot,et=oe(_e,8)+1,wt=16<et?0:4<et?1:2<et?2:3;if(De[0]=je(Se.Ea,wt),Se.b=wt,ot=We=qt(et,1,0,tt,Se.K)){var ft,Dt=et,vt=Se,yr=1<<(8>>vt.b),Ar=i(yr);if(Ar==null)ot=0;else{var fr=vt.K[0],or=vt.w;for(Ar[0]=vt.K[0][0],ft=1;ft<1*Dt;++ft)Ar[ft]=Pe(fr[or+ft],Ar[ft-1]);for(;ft<4*yr;++ft)Ar[ft]=0;vt.K[0]=null,vt.K[0]=Ar,ot=1}}We=ot;break;case 2:break;default:e(0)}B=We}}if($=$[0],G=G[0],B&&oe(K,1)&&!(B=1<=(Ie=oe(K,4))&&11>=Ie)){S.a=3;break e}var Tr;if(Tr=B)t:{var Or,Vt,bn,na=S,wn=$,aa=G,Lr=Ie,pa=x,ma=na.m,In=na.s,qn=[null],Xn=1,ja=0,Ya=F1[Lr];r:for(;;){if(pa&&oe(ma,1)){var Dn=oe(ma,3)+2,hs=je(wn,Dn),si=je(aa,Dn),Ui=hs*si;if(!qt(hs,si,0,na,qn))break r;for(qn=qn[0],In.xc=Dn,Or=0;Or<Ui;++Or){var Ns=qn[Or]>>8&65535;qn[Or]=Ns,Ns>=Xn&&(Xn=Ns+1)}}if(ma.h)break r;for(Vt=0;5>Vt;++Vt){var tn=Yh[Vt];!Vt&&0<Lr&&(tn+=1<<Lr),ja<tn&&(ja=tn)}var Zu=o(Xn*Ya,L),rf=Xn,nf=o(rf,W);if(nf==null)var pc=null;else e(65536>=rf),pc=nf;var Ho=i(ja);if(pc==null||Ho==null||Zu==null){na.a=1;break r}var mc=Zu;for(Or=bn=0;Or<Xn;++Or){var Oa=pc[Or],Wi=Oa.G,zi=Oa.H,af=0,gc=1,sf=0;for(Vt=0;5>Vt;++Vt){tn=Yh[Vt],Wi[Vt]=mc,zi[Vt]=bn,!Vt&&0<Lr&&(tn+=1<<Lr);a:{var vc,ed=tn,xc=na,Yo=Ho,a0=mc,s0=bn,td=0,Es=xc.m,i0=oe(Es,1);if(s(Yo,0,0,ed),i0){var o0=oe(Es,1)+1,l0=oe(Es,1),of=oe(Es,l0==0?1:8);Yo[of]=1,o0==2&&(Yo[of=oe(Es,8)]=1);var yc=1}else{var lf=i(19),cf=oe(Es,4)+4;if(19<cf){xc.a=3;var bc=0;break a}for(vc=0;vc<cf;++vc)lf[T1[vc]]=oe(Es,3);var rd=void 0,Vo=void 0,uf=xc,c0=lf,wc=ed,df=Yo,nd=0,Os=uf.m,hf=8,ff=o(128,L);n:for(;P(ff,0,7,c0,19);){if(oe(Os,1)){var u0=2+2*oe(Os,3);if((rd=2+oe(Os,u0))>wc)break n}else rd=wc;for(Vo=0;Vo<wc&&rd--;){ce(Os);var pf=ff[0+(127&D(Os))];re(Os,Os.u+pf.g);var $i=pf.value;if(16>$i)df[Vo++]=$i,$i!=0&&(hf=$i);else{var d0=$i==16,mf=$i-16,h0=I1[mf],gf=oe(Os,O1[mf])+h0;if(Vo+gf>wc)break n;for(var f0=d0?hf:0;0<gf--;)df[Vo++]=f0}}nd=1;break n}nd||(uf.a=3),yc=nd}(yc=yc&&!Es.h)&&(td=P(a0,s0,8,Yo,ed)),yc&&td!=0?bc=td:(xc.a=3,bc=0)}if(bc==0)break r;if(gc&&D1[Vt]==1&&(gc=mc[bn].g==0),af+=mc[bn].g,bn+=bc,3>=Vt){var Go,ad=Ho[0];for(Go=1;Go<tn;++Go)Ho[Go]>ad&&(ad=Ho[Go]);sf+=ad}}if(Oa.nd=gc,Oa.Qb=0,gc&&(Oa.qb=(Wi[3][zi[3]+0].value<<24|Wi[1][zi[1]+0].value<<16|Wi[2][zi[2]+0].value)>>>0,af==0&&256>Wi[0][zi[0]+0].value&&(Oa.Qb=1,Oa.qb+=Wi[0][zi[0]+0].value<<8)),Oa.jc=!Oa.Qb&&6>sf,Oa.jc){var _c,fs=Oa;for(_c=0;_c<Rn;++_c){var Is=_c,Ds=fs.pd[Is],jc=fs.G[0][fs.H[0]+Is];256<=jc.value?(Ds.g=jc.g+256,Ds.value=jc.value):(Ds.g=0,Ds.value=0,Is>>=Ve(jc,8,Ds),Is>>=Ve(fs.G[1][fs.H[1]+Is],16,Ds),Is>>=Ve(fs.G[2][fs.H[2]+Is],0,Ds),Ve(fs.G[3][fs.H[3]+Is],24,Ds))}}}In.vc=qn,In.Wb=Xn,In.Ya=pc,In.yc=Zu,Tr=1;break t}Tr=0}if(!(B=Tr)){S.a=3;break e}if(0<Ie){if(ie.ua=1<<Ie,!Fe(ie.Wa,Ie)){S.a=1,B=0;break e}}else ie.ua=0;var sd=S,vf=$,p0=G,id=sd.s,od=id.xc;if(sd.c=vf,sd.i=p0,id.md=je(vf,od),id.wc=od==0?-1:(1<<od)-1,x){S.xb=H1;break e}if((we=i($*G))==null){S.a=1,B=0;break e}B=(B=$e(S,we,0,$,G,G,null))&&!K.h;break e}return B?(T!=null?T[0]=we:(e(we==null),e(x)),S.$=0,x||ze(ie)):ze(ie),B}function qr(c,h){var x=c.c*c.i,S=x+h+16*h;return e(c.c<=h),c.V=i(S),c.V==null?(c.Ta=null,c.Ua=0,c.a=1,0):(c.Ta=c.V,c.Ua=c.Ba+x+h,1)}function Me(c,h){var x=c.C,S=h-x,T=c.V,B=c.Ba+c.c*x;for(e(h<=c.l.o);0<S;){var $=16<S?16:S,G=c.l.ma,K=c.l.width,ie=K*$,we=G.ca,Ie=G.tb+K*x,De=c.Ta,ke=c.Ua;$t(c,$,T,B),un(De,ke,we,Ie,ie),kr(G,x,x+$,we,Ie,K),S-=$,T+=$*c.c,x+=$}e(x==h),c.C=c.Ma=h}function Ue(){this.ub=this.yd=this.td=this.Rb=0}function rt(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Je(){this.Fb=this.Bb=this.Cb=0,this.Zb=i(4),this.Lb=i(4)}function Ot(){this.Yb=function(){var c=[];return function h(x,S,T){for(var B=T[S],$=0;$<B&&(x.push(T.length>S+1?[]:0),!(T.length<S+1));$++)h(x[$],S+1,T)}(c,0,[3,11]),c}()}function Ht(){this.jb=i(3),this.Wc=l([4,8],Ot),this.Xc=l([4,17],Ot)}function Gr(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new i(4),this.od=new i(4)}function dr(){this.ld=this.La=this.dd=this.tc=0}function En(){this.Na=this.la=0}function Gs(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Qs(){this.ad=i(384),this.Za=0,this.Ob=i(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function bo(){this.uc=this.M=this.Nb=0,this.wa=Array(new dr),this.Y=0,this.ya=Array(new Qs),this.aa=0,this.l=new ys}function ji(){this.y=i(16),this.f=i(8),this.ea=i(8)}function ss(){this.cb=this.a=0,this.sc="",this.m=new de,this.Od=new Ue,this.Kc=new rt,this.ed=new Gr,this.Qa=new Je,this.Ic=this.$c=this.Aa=0,this.D=new bo,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=o(8,de),this.ia=0,this.pb=o(4,Gs),this.Pa=new Ht,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new ji),this.Hd=0,this.rb=Array(new En),this.sb=0,this.wa=Array(new dr),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Qs),this.L=this.aa=0,this.gd=l([4,2],dr),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function ys(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function wo(){var c=new ss;return c!=null&&(c.a=0,c.sc="OK",c.cb=0,c.Xb=0,zo||(zo=Xe)),c}function me(c,h,x){return c.a==0&&(c.a=h,c.sc=x,c.cb=0),0}function he(c,h,x){return 3<=x&&c[h+0]==157&&c[h+1]==1&&c[h+2]==42}function Te(c,h){if(c==null)return 0;if(c.a=0,c.sc="OK",h==null)return me(c,2,"null VP8Io passed to VP8GetHeaders()");var x=h.data,S=h.w,T=h.ha;if(4>T)return me(c,7,"Truncated header.");var B=x[S+0]|x[S+1]<<8|x[S+2]<<16,$=c.Od;if($.Rb=!(1&B),$.td=B>>1&7,$.yd=B>>4&1,$.ub=B>>5,3<$.td)return me(c,3,"Incorrect keyframe parameters.");if(!$.yd)return me(c,4,"Frame not displayable.");S+=3,T-=3;var G=c.Kc;if($.Rb){if(7>T)return me(c,7,"cannot parse picture header");if(!he(x,S,T))return me(c,3,"Bad code word");G.c=16383&(x[S+4]<<8|x[S+3]),G.Td=x[S+4]>>6,G.i=16383&(x[S+6]<<8|x[S+5]),G.Ud=x[S+6]>>6,S+=7,T-=7,c.za=G.c+15>>4,c.Ub=G.i+15>>4,h.width=G.c,h.height=G.i,h.Da=0,h.j=0,h.v=0,h.va=h.width,h.o=h.height,h.da=0,h.ib=h.width,h.hb=h.height,h.U=h.width,h.T=h.height,s((B=c.Pa).jb,0,255,B.jb.length),e((B=c.Qa)!=null),B.Cb=0,B.Bb=0,B.Fb=1,s(B.Zb,0,0,B.Zb.length),s(B.Lb,0,0,B.Lb)}if($.ub>T)return me(c,7,"bad partition length");z(B=c.m,x,S,$.ub),S+=$.ub,T-=$.ub,$.Rb&&(G.Ld=ee(B),G.Kd=ee(B)),G=c.Qa;var K,ie=c.Pa;if(e(B!=null),e(G!=null),G.Cb=ee(B),G.Cb){if(G.Bb=ee(B),ee(B)){for(G.Fb=ee(B),K=0;4>K;++K)G.Zb[K]=ee(B)?Y(B,7):0;for(K=0;4>K;++K)G.Lb[K]=ee(B)?Y(B,6):0}if(G.Bb)for(K=0;3>K;++K)ie.jb[K]=ee(B)?V(B,8):255}else G.Bb=0;if(B.Ka)return me(c,3,"cannot parse segment header");if((G=c.ed).zd=ee(B),G.Tb=V(B,6),G.wb=V(B,3),G.Pc=ee(B),G.Pc&&ee(B)){for(ie=0;4>ie;++ie)ee(B)&&(G.vd[ie]=Y(B,6));for(ie=0;4>ie;++ie)ee(B)&&(G.od[ie]=Y(B,6))}if(c.L=G.Tb==0?0:G.zd?1:2,B.Ka)return me(c,3,"cannot parse filter header");var we=T;if(T=K=S,S=K+we,G=we,c.Xb=(1<<V(c.m,2))-1,we<3*(ie=c.Xb))x=7;else{for(K+=3*ie,G-=3*ie,we=0;we<ie;++we){var Ie=x[T+0]|x[T+1]<<8|x[T+2]<<16;Ie>G&&(Ie=G),z(c.Jc[+we],x,K,Ie),K+=Ie,G-=Ie,T+=3}z(c.Jc[+ie],x,K,G),x=K<S?0:5}if(x!=0)return me(c,x,"cannot parse partitions");for(x=V(K=c.m,7),T=ee(K)?Y(K,4):0,S=ee(K)?Y(K,4):0,G=ee(K)?Y(K,4):0,ie=ee(K)?Y(K,4):0,K=ee(K)?Y(K,4):0,we=c.Qa,Ie=0;4>Ie;++Ie){if(we.Cb){var De=we.Zb[Ie];we.Fb||(De+=x)}else{if(0<Ie){c.pb[Ie]=c.pb[0];continue}De=x}var ke=c.pb[Ie];ke.Sc[0]=Ju[ha(De+T,127)],ke.Sc[1]=Ku[ha(De+0,127)],ke.Eb[0]=2*Ju[ha(De+S,127)],ke.Eb[1]=101581*Ku[ha(De+G,127)]>>16,8>ke.Eb[1]&&(ke.Eb[1]=8),ke.Qc[0]=Ju[ha(De+ie,117)],ke.Qc[1]=Ku[ha(De+K,127)],ke.lc=De+K}if(!$.Rb)return me(c,4,"Not a key frame.");for(ee(B),$=c.Pa,x=0;4>x;++x){for(T=0;8>T;++T)for(S=0;3>S;++S)for(G=0;11>G;++G)ie=ae(B,z1[x][T][S][G])?V(B,8):U1[x][T][S][G],$.Wc[x][T].Yb[S][G]=ie;for(T=0;17>T;++T)$.Xc[x][T]=$.Wc[x][$1[T]]}return c.kc=ee(B),c.kc&&(c.Bd=V(B,8)),c.cb=1}function Xe(c,h,x,S,T,B,$){var G=h[T].Yb[x];for(x=0;16>T;++T){if(!ae(c,G[x+0]))return T;for(;!ae(c,G[x+1]);)if(G=h[++T].Yb[0],x=0,T==16)return 16;var K=h[T+1].Yb;if(ae(c,G[x+2])){var ie=c,we=0;if(ae(ie,(De=G)[(Ie=x)+3]))if(ae(ie,De[Ie+6])){for(G=0,Ie=2*(we=ae(ie,De[Ie+8]))+(De=ae(ie,De[Ie+9+we])),we=0,De=q1[Ie];De[G];++G)we+=we+ae(ie,De[G]);we+=3+(8<<Ie)}else ae(ie,De[Ie+7])?(we=7+2*ae(ie,165),we+=ae(ie,145)):we=5+ae(ie,159);else we=ae(ie,De[Ie+4])?3+ae(ie,De[Ie+5]):2;G=K[2]}else we=1,G=K[1];K=$+B1[T],0>(ie=c).b&&fe(ie);var Ie,De=ie.b,ke=(Ie=ie.Ca>>1)-(ie.I>>De)>>31;--ie.b,ie.Ca+=ke,ie.Ca|=1,ie.I-=(Ie+1&ke)<<De,B[K]=((we^ke)-ke)*S[(0<T)+0]}return 16}function ht(c){var h=c.rb[c.sb-1];h.la=0,h.Na=0,s(c.zc,0,0,c.zc.length),c.ja=0}function Et(c,h){if(c==null)return 0;if(h==null)return me(c,2,"NULL VP8Io parameter in VP8Decode().");if(!c.cb&&!Te(c,h))return 0;if(e(c.cb),h.ac==null||h.ac(h)){h.ob&&(c.L=0);var x=fc[c.L];if(c.L==2?(c.yb=0,c.zb=0):(c.yb=h.v-x>>4,c.zb=h.j-x>>4,0>c.yb&&(c.yb=0),0>c.zb&&(c.zb=0)),c.Va=h.o+15+x>>4,c.Hb=h.va+15+x>>4,c.Hb>c.za&&(c.Hb=c.za),c.Va>c.Ub&&(c.Va=c.Ub),0<c.L){var S=c.ed;for(x=0;4>x;++x){var T;if(c.Qa.Cb){var B=c.Qa.Lb[x];c.Qa.Fb||(B+=S.Tb)}else B=S.Tb;for(T=0;1>=T;++T){var $=c.gd[x][T],G=B;if(S.Pc&&(G+=S.vd[0],T&&(G+=S.od[0])),0<(G=0>G?0:63<G?63:G)){var K=G;0<S.wb&&(K=4<S.wb?K>>2:K>>1)>9-S.wb&&(K=9-S.wb),1>K&&(K=1),$.dd=K,$.tc=2*G+K,$.ld=40<=G?2:15<=G?1:0}else $.tc=0;$.La=T}}}x=0}else me(c,6,"Frame setup failed"),x=c.a;if(x=x==0){if(x){c.$c=0,0<c.Aa||(c.Ic=n0);e:{x=c.Ic,S=4*(K=c.za);var ie=32*K,we=K+1,Ie=0<c.L?K*(0<c.Aa?2:1):0,De=(c.Aa==2?2:1)*K;if(($=S+832+(T=3*(16*x+fc[c.L])/2*ie)+(B=c.Fa!=null&&0<c.Fa.length?c.Kc.c*c.Kc.i:0))!=$)x=0;else{if($>c.Vb){if(c.Vb=0,c.Ec=i($),c.Fc=0,c.Ec==null){x=me(c,1,"no memory during frame initialization.");break e}c.Vb=$}$=c.Ec,G=c.Fc,c.Ac=$,c.Bc=G,G+=S,c.Gd=o(ie,ji),c.Hd=0,c.rb=o(we+1,En),c.sb=1,c.wa=Ie?o(Ie,dr):null,c.Y=0,c.D.Nb=0,c.D.wa=c.wa,c.D.Y=c.Y,0<c.Aa&&(c.D.Y+=K),e(!0),c.oc=$,c.pc=G,G+=832,c.ya=o(De,Qs),c.aa=0,c.D.ya=c.ya,c.D.aa=c.aa,c.Aa==2&&(c.D.aa+=K),c.R=16*K,c.B=8*K,K=(ie=fc[c.L])*c.R,ie=ie/2*c.B,c.sa=$,c.ta=G+K,c.qa=c.sa,c.ra=c.ta+16*x*c.R+ie,c.Ha=c.qa,c.Ia=c.ra+8*x*c.B+ie,c.$c=0,G+=T,c.mb=B?$:null,c.nb=B?G:null,e(G+B<=c.Fc+c.Vb),ht(c),s(c.Ac,c.Bc,0,S),x=1}}if(x){if(h.ka=0,h.y=c.sa,h.O=c.ta,h.f=c.qa,h.N=c.ra,h.ea=c.Ha,h.Vd=c.Ia,h.fa=c.R,h.Rc=c.B,h.F=null,h.J=0,!ac){for(x=-255;255>=x;++x)An[255+x]=0>x?-x:x;for(x=-1020;1020>=x;++x)us[1020+x]=-128>x?-128:127<x?127:x;for(x=-112;112>=x;++x)Wo[112+x]=-16>x?-16:15<x?15:x;for(x=-255;510>=x;++x)Bi[255+x]=0>x?0:255<x?255:x;ac=1}Fi=at,cs=Ba,qo=Ua,Kn=_o,xa=Si,cn=Br,Ri=Po,nc=Xs,Bo=Wu,ti=ko,ri=Uu,Ps=Ai,ni=Ao,qi=Kl,ai=Jl,ks=$a,Uo=is,ya=Bu,Ea[0]=za,Ea[1]=Fn,Ea[2]=Du,Ea[3]=Tu,Ea[4]=Hl,Ea[5]=Pi,Ea[6]=Yl,Ea[7]=jo,Ea[8]=Fu,Ea[9]=Mu,As[0]=Ci,As[1]=bs,As[2]=ua,As[3]=Wa,As[4]=Un,As[5]=Iu,As[6]=$l,ds[0]=ws,ds[1]=ea,ds[2]=Ru,ds[3]=So,ds[4]=Ks,ds[5]=qu,ds[6]=Co,x=1}else x=0}x&&(x=function(ke,tt){for(ke.M=0;ke.M<ke.Va;++ke.M){var We,_e=ke.Jc[ke.M&ke.Xb],Se=ke.m,Ze=ke;for(We=0;We<Ze.za;++We){var ot=Se,et=Ze,wt=et.Ac,ft=et.Bc+4*We,Dt=et.zc,vt=et.ya[et.aa+We];if(et.Qa.Bb?vt.$b=ae(ot,et.Pa.jb[0])?2+ae(ot,et.Pa.jb[2]):ae(ot,et.Pa.jb[1]):vt.$b=0,et.kc&&(vt.Ad=ae(ot,et.Bd)),vt.Za=!ae(ot,145)+0,vt.Za){var yr=vt.Ob,Ar=0;for(et=0;4>et;++et){var fr,or=Dt[0+et];for(fr=0;4>fr;++fr){or=W1[wt[ft+fr]][or];for(var Tr=Vh[ae(ot,or[0])];0<Tr;)Tr=Vh[2*Tr+ae(ot,or[Tr])];or=-Tr,wt[ft+fr]=or}n(yr,Ar,wt,ft,4),Ar+=4,Dt[0+et]=or}}else or=ae(ot,156)?ae(ot,128)?1:3:ae(ot,163)?2:0,vt.Ob[0]=or,s(wt,ft,or,4),s(Dt,0,or,4);vt.Dd=ae(ot,142)?ae(ot,114)?ae(ot,183)?1:3:2:0}if(Ze.m.Ka)return me(ke,7,"Premature end-of-partition0 encountered.");for(;ke.ja<ke.za;++ke.ja){if(Ze=_e,ot=(Se=ke).rb[Se.sb-1],wt=Se.rb[Se.sb+Se.ja],We=Se.ya[Se.aa+Se.ja],ft=Se.kc?We.Ad:0)ot.la=wt.la=0,We.Za||(ot.Na=wt.Na=0),We.Hc=0,We.Gc=0,We.ia=0;else{var Or,Vt;if(ot=wt,wt=Ze,ft=Se.Pa.Xc,Dt=Se.ya[Se.aa+Se.ja],vt=Se.pb[Dt.$b],et=Dt.ad,yr=0,Ar=Se.rb[Se.sb-1],or=fr=0,s(et,yr,0,384),Dt.Za)var bn=0,na=ft[3];else{Tr=i(16);var wn=ot.Na+Ar.Na;if(wn=zo(wt,ft[1],wn,vt.Eb,0,Tr,0),ot.Na=Ar.Na=(0<wn)+0,1<wn)Fi(Tr,0,et,yr);else{var aa=Tr[0]+3>>3;for(Tr=0;256>Tr;Tr+=16)et[yr+Tr]=aa}bn=1,na=ft[0]}var Lr=15&ot.la,pa=15&Ar.la;for(Tr=0;4>Tr;++Tr){var ma=1&pa;for(aa=Vt=0;4>aa;++aa)Lr=Lr>>1|(ma=(wn=zo(wt,na,wn=ma+(1&Lr),vt.Sc,bn,et,yr))>bn)<<7,Vt=Vt<<2|(3<wn?3:1<wn?2:et[yr+0]!=0),yr+=16;Lr>>=4,pa=pa>>1|ma<<7,fr=(fr<<8|Vt)>>>0}for(na=Lr,bn=pa>>4,Or=0;4>Or;Or+=2){for(Vt=0,Lr=ot.la>>4+Or,pa=Ar.la>>4+Or,Tr=0;2>Tr;++Tr){for(ma=1&pa,aa=0;2>aa;++aa)wn=ma+(1&Lr),Lr=Lr>>1|(ma=0<(wn=zo(wt,ft[2],wn,vt.Qc,0,et,yr)))<<3,Vt=Vt<<2|(3<wn?3:1<wn?2:et[yr+0]!=0),yr+=16;Lr>>=2,pa=pa>>1|ma<<5}or|=Vt<<4*Or,na|=Lr<<4<<Or,bn|=(240&pa)<<Or}ot.la=na,Ar.la=bn,Dt.Hc=fr,Dt.Gc=or,Dt.ia=43690&or?0:vt.ia,ft=!(fr|or)}if(0<Se.L&&(Se.wa[Se.Y+Se.ja]=Se.gd[We.$b][We.Za],Se.wa[Se.Y+Se.ja].La|=!ft),Ze.Ka)return me(ke,7,"Premature end-of-file encountered.")}if(ht(ke),Se=tt,Ze=1,We=(_e=ke).D,ot=0<_e.L&&_e.M>=_e.zb&&_e.M<=_e.Va,_e.Aa==0)e:{if(We.M=_e.M,We.uc=ot,Do(_e,We),Ze=1,We=(Vt=_e.D).Nb,ot=(or=fc[_e.L])*_e.R,wt=or/2*_e.B,Tr=16*We*_e.R,aa=8*We*_e.B,ft=_e.sa,Dt=_e.ta-ot+Tr,vt=_e.qa,et=_e.ra-wt+aa,yr=_e.Ha,Ar=_e.Ia-wt+aa,pa=(Lr=Vt.M)==0,fr=Lr>=_e.Va-1,_e.Aa==2&&Do(_e,Vt),Vt.uc)for(ma=(wn=_e).D.M,e(wn.D.uc),Vt=wn.yb;Vt<wn.Hb;++Vt){bn=Vt,na=ma;var In=(qn=(tn=wn).D).Nb;Or=tn.R;var qn=qn.wa[qn.Y+bn],Xn=tn.sa,ja=tn.ta+16*In*Or+16*bn,Ya=qn.dd,Dn=qn.tc;if(Dn!=0)if(e(3<=Dn),tn.L==1)0<bn&&ks(Xn,ja,Or,Dn+4),qn.La&&ya(Xn,ja,Or,Dn),0<na&&ai(Xn,ja,Or,Dn+4),qn.La&&Uo(Xn,ja,Or,Dn);else{var hs=tn.B,si=tn.qa,Ui=tn.ra+8*In*hs+8*bn,Ns=tn.Ha,tn=tn.Ia+8*In*hs+8*bn;In=qn.ld,0<bn&&(nc(Xn,ja,Or,Dn+4,Ya,In),ti(si,Ui,Ns,tn,hs,Dn+4,Ya,In)),qn.La&&(Ps(Xn,ja,Or,Dn,Ya,In),qi(si,Ui,Ns,tn,hs,Dn,Ya,In)),0<na&&(Ri(Xn,ja,Or,Dn+4,Ya,In),Bo(si,Ui,Ns,tn,hs,Dn+4,Ya,In)),qn.La&&(ri(Xn,ja,Or,Dn,Ya,In),ni(si,Ui,Ns,tn,hs,Dn,Ya,In))}}if(_e.ia&&alert("todo:DitherRow"),Se.put!=null){if(Vt=16*Lr,Lr=16*(Lr+1),pa?(Se.y=_e.sa,Se.O=_e.ta+Tr,Se.f=_e.qa,Se.N=_e.ra+aa,Se.ea=_e.Ha,Se.W=_e.Ia+aa):(Vt-=or,Se.y=ft,Se.O=Dt,Se.f=vt,Se.N=et,Se.ea=yr,Se.W=Ar),fr||(Lr-=or),Lr>Se.o&&(Lr=Se.o),Se.F=null,Se.J=null,_e.Fa!=null&&0<_e.Fa.length&&Vt<Lr&&(Se.J=Oo(_e,Se,Vt,Lr-Vt),Se.F=_e.mb,Se.F==null&&Se.F.length==0)){Ze=me(_e,3,"Could not decode alpha data.");break e}Vt<Se.j&&(or=Se.j-Vt,Vt=Se.j,e(!(1&or)),Se.O+=_e.R*or,Se.N+=_e.B*(or>>1),Se.W+=_e.B*(or>>1),Se.F!=null&&(Se.J+=Se.width*or)),Vt<Lr&&(Se.O+=Se.v,Se.N+=Se.v>>1,Se.W+=Se.v>>1,Se.F!=null&&(Se.J+=Se.v),Se.ka=Vt-Se.j,Se.U=Se.va-Se.v,Se.T=Lr-Vt,Ze=Se.put(Se))}We+1!=_e.Ic||fr||(n(_e.sa,_e.ta-ot,ft,Dt+16*_e.R,ot),n(_e.qa,_e.ra-wt,vt,et+8*_e.B,wt),n(_e.Ha,_e.Ia-wt,yr,Ar+8*_e.B,wt))}if(!Ze)return me(ke,6,"Output aborted.")}return 1}(c,h)),h.bc!=null&&h.bc(h),x&=1}return x?(c.cb=0,x):0}function Qt(c,h,x,S,T){T=c[h+x+32*S]+(T>>3),c[h+x+32*S]=-256&T?0>T?0:255:T}function xr(c,h,x,S,T,B){Qt(c,h,0,x,S+T),Qt(c,h,1,x,S+B),Qt(c,h,2,x,S-B),Qt(c,h,3,x,S-T)}function Er(c){return(20091*c>>16)+c}function Mn(c,h,x,S){var T,B=0,$=i(16);for(T=0;4>T;++T){var G=c[h+0]+c[h+8],K=c[h+0]-c[h+8],ie=(35468*c[h+4]>>16)-Er(c[h+12]),we=Er(c[h+4])+(35468*c[h+12]>>16);$[B+0]=G+we,$[B+1]=K+ie,$[B+2]=K-ie,$[B+3]=G-we,B+=4,h++}for(T=B=0;4>T;++T)G=(c=$[B+0]+4)+$[B+8],K=c-$[B+8],ie=(35468*$[B+4]>>16)-Er($[B+12]),Qt(x,S,0,0,G+(we=Er($[B+4])+(35468*$[B+12]>>16))),Qt(x,S,1,0,K+ie),Qt(x,S,2,0,K-ie),Qt(x,S,3,0,G-we),B++,S+=32}function Br(c,h,x,S){var T=c[h+0]+4,B=35468*c[h+4]>>16,$=Er(c[h+4]),G=35468*c[h+1]>>16;xr(x,S,0,T+$,c=Er(c[h+1]),G),xr(x,S,1,T+B,c,G),xr(x,S,2,T-B,c,G),xr(x,S,3,T-$,c,G)}function Ba(c,h,x,S,T){Mn(c,h,x,S),T&&Mn(c,h+16,x,S+4)}function Ua(c,h,x,S){cs(c,h+0,x,S,1),cs(c,h+32,x,S+128,1)}function _o(c,h,x,S){var T;for(c=c[h+0]+4,T=0;4>T;++T)for(h=0;4>h;++h)Qt(x,S,h,T,c)}function Si(c,h,x,S){c[h+0]&&Kn(c,h+0,x,S),c[h+16]&&Kn(c,h+16,x,S+4),c[h+32]&&Kn(c,h+32,x,S+128),c[h+48]&&Kn(c,h+48,x,S+128+4)}function at(c,h,x,S){var T,B=i(16);for(T=0;4>T;++T){var $=c[h+0+T]+c[h+12+T],G=c[h+4+T]+c[h+8+T],K=c[h+4+T]-c[h+8+T],ie=c[h+0+T]-c[h+12+T];B[0+T]=$+G,B[8+T]=$-G,B[4+T]=ie+K,B[12+T]=ie-K}for(T=0;4>T;++T)$=(c=B[0+4*T]+3)+B[3+4*T],G=B[1+4*T]+B[2+4*T],K=B[1+4*T]-B[2+4*T],ie=c-B[3+4*T],x[S+0]=$+G>>3,x[S+16]=ie+K>>3,x[S+32]=$-G>>3,x[S+48]=ie-K>>3,S+=64}function Ft(c,h,x){var S,T=h-32,B=fa,$=255-c[T-1];for(S=0;S<x;++S){var G,K=B,ie=$+c[h-1];for(G=0;G<x;++G)c[h+G]=K[ie+c[T+G]];h+=32}}function Fn(c,h){Ft(c,h,4)}function ea(c,h){Ft(c,h,8)}function bs(c,h){Ft(c,h,16)}function ua(c,h){var x;for(x=0;16>x;++x)n(c,h+32*x,c,h-32,16)}function Wa(c,h){var x;for(x=16;0<x;--x)s(c,h,c[h-1],16),h+=32}function da(c,h,x){var S;for(S=0;16>S;++S)s(h,x+32*S,c,16)}function Ci(c,h){var x,S=16;for(x=0;16>x;++x)S+=c[h-1+32*x]+c[h+x-32];da(S>>5,c,h)}function Un(c,h){var x,S=8;for(x=0;16>x;++x)S+=c[h-1+32*x];da(S>>4,c,h)}function Iu(c,h){var x,S=8;for(x=0;16>x;++x)S+=c[h+x-32];da(S>>4,c,h)}function $l(c,h){da(128,c,h)}function Ut(c,h,x){return c+2*h+x+2>>2}function Du(c,h){var x,S=h-32;for(S=new Uint8Array([Ut(c[S-1],c[S+0],c[S+1]),Ut(c[S+0],c[S+1],c[S+2]),Ut(c[S+1],c[S+2],c[S+3]),Ut(c[S+2],c[S+3],c[S+4])]),x=0;4>x;++x)n(c,h+32*x,S,0,S.length)}function Tu(c,h){var x=c[h-1],S=c[h-1+32],T=c[h-1+64],B=c[h-1+96];pe(c,h+0,16843009*Ut(c[h-1-32],x,S)),pe(c,h+32,16843009*Ut(x,S,T)),pe(c,h+64,16843009*Ut(S,T,B)),pe(c,h+96,16843009*Ut(T,B,B))}function za(c,h){var x,S=4;for(x=0;4>x;++x)S+=c[h+x-32]+c[h-1+32*x];for(S>>=3,x=0;4>x;++x)s(c,h+32*x,S,4)}function Hl(c,h){var x=c[h-1+0],S=c[h-1+32],T=c[h-1+64],B=c[h-1-32],$=c[h+0-32],G=c[h+1-32],K=c[h+2-32],ie=c[h+3-32];c[h+0+96]=Ut(S,T,c[h-1+96]),c[h+1+96]=c[h+0+64]=Ut(x,S,T),c[h+2+96]=c[h+1+64]=c[h+0+32]=Ut(B,x,S),c[h+3+96]=c[h+2+64]=c[h+1+32]=c[h+0+0]=Ut($,B,x),c[h+3+64]=c[h+2+32]=c[h+1+0]=Ut(G,$,B),c[h+3+32]=c[h+2+0]=Ut(K,G,$),c[h+3+0]=Ut(ie,K,G)}function Yl(c,h){var x=c[h+1-32],S=c[h+2-32],T=c[h+3-32],B=c[h+4-32],$=c[h+5-32],G=c[h+6-32],K=c[h+7-32];c[h+0+0]=Ut(c[h+0-32],x,S),c[h+1+0]=c[h+0+32]=Ut(x,S,T),c[h+2+0]=c[h+1+32]=c[h+0+64]=Ut(S,T,B),c[h+3+0]=c[h+2+32]=c[h+1+64]=c[h+0+96]=Ut(T,B,$),c[h+3+32]=c[h+2+64]=c[h+1+96]=Ut(B,$,G),c[h+3+64]=c[h+2+96]=Ut($,G,K),c[h+3+96]=Ut(G,K,K)}function Pi(c,h){var x=c[h-1+0],S=c[h-1+32],T=c[h-1+64],B=c[h-1-32],$=c[h+0-32],G=c[h+1-32],K=c[h+2-32],ie=c[h+3-32];c[h+0+0]=c[h+1+64]=B+$+1>>1,c[h+1+0]=c[h+2+64]=$+G+1>>1,c[h+2+0]=c[h+3+64]=G+K+1>>1,c[h+3+0]=K+ie+1>>1,c[h+0+96]=Ut(T,S,x),c[h+0+64]=Ut(S,x,B),c[h+0+32]=c[h+1+96]=Ut(x,B,$),c[h+1+32]=c[h+2+96]=Ut(B,$,G),c[h+2+32]=c[h+3+96]=Ut($,G,K),c[h+3+32]=Ut(G,K,ie)}function jo(c,h){var x=c[h+0-32],S=c[h+1-32],T=c[h+2-32],B=c[h+3-32],$=c[h+4-32],G=c[h+5-32],K=c[h+6-32],ie=c[h+7-32];c[h+0+0]=x+S+1>>1,c[h+1+0]=c[h+0+64]=S+T+1>>1,c[h+2+0]=c[h+1+64]=T+B+1>>1,c[h+3+0]=c[h+2+64]=B+$+1>>1,c[h+0+32]=Ut(x,S,T),c[h+1+32]=c[h+0+96]=Ut(S,T,B),c[h+2+32]=c[h+1+96]=Ut(T,B,$),c[h+3+32]=c[h+2+96]=Ut(B,$,G),c[h+3+64]=Ut($,G,K),c[h+3+96]=Ut(G,K,ie)}function Mu(c,h){var x=c[h-1+0],S=c[h-1+32],T=c[h-1+64],B=c[h-1+96];c[h+0+0]=x+S+1>>1,c[h+2+0]=c[h+0+32]=S+T+1>>1,c[h+2+32]=c[h+0+64]=T+B+1>>1,c[h+1+0]=Ut(x,S,T),c[h+3+0]=c[h+1+32]=Ut(S,T,B),c[h+3+32]=c[h+1+64]=Ut(T,B,B),c[h+3+64]=c[h+2+64]=c[h+0+96]=c[h+1+96]=c[h+2+96]=c[h+3+96]=B}function Fu(c,h){var x=c[h-1+0],S=c[h-1+32],T=c[h-1+64],B=c[h-1+96],$=c[h-1-32],G=c[h+0-32],K=c[h+1-32],ie=c[h+2-32];c[h+0+0]=c[h+2+32]=x+$+1>>1,c[h+0+32]=c[h+2+64]=S+x+1>>1,c[h+0+64]=c[h+2+96]=T+S+1>>1,c[h+0+96]=B+T+1>>1,c[h+3+0]=Ut(G,K,ie),c[h+2+0]=Ut($,G,K),c[h+1+0]=c[h+3+32]=Ut(x,$,G),c[h+1+32]=c[h+3+64]=Ut(S,x,$),c[h+1+64]=c[h+3+96]=Ut(T,S,x),c[h+1+96]=Ut(B,T,S)}function Ru(c,h){var x;for(x=0;8>x;++x)n(c,h+32*x,c,h-32,8)}function So(c,h){var x;for(x=0;8>x;++x)s(c,h,c[h-1],8),h+=32}function Js(c,h,x){var S;for(S=0;8>S;++S)s(h,x+32*S,c,8)}function ws(c,h){var x,S=8;for(x=0;8>x;++x)S+=c[h+x-32]+c[h-1+32*x];Js(S>>4,c,h)}function qu(c,h){var x,S=4;for(x=0;8>x;++x)S+=c[h+x-32];Js(S>>3,c,h)}function Ks(c,h){var x,S=4;for(x=0;8>x;++x)S+=c[h-1+32*x];Js(S>>3,c,h)}function Co(c,h){Js(128,c,h)}function ki(c,h,x){var S=c[h-x],T=c[h+0],B=3*(T-S)+Hu[1020+c[h-2*x]-c[h+x]],$=sc[112+(B+4>>3)];c[h-x]=fa[255+S+sc[112+(B+3>>3)]],c[h+0]=fa[255+T-$]}function Vl(c,h,x,S){var T=c[h+0],B=c[h+x];return wa[255+c[h-2*x]-c[h-x]]>S||wa[255+B-T]>S}function Gl(c,h,x,S){return 4*wa[255+c[h-x]-c[h+0]]+wa[255+c[h-2*x]-c[h+x]]<=S}function Ql(c,h,x,S,T){var B=c[h-3*x],$=c[h-2*x],G=c[h-x],K=c[h+0],ie=c[h+x],we=c[h+2*x],Ie=c[h+3*x];return 4*wa[255+G-K]+wa[255+$-ie]>S?0:wa[255+c[h-4*x]-B]<=T&&wa[255+B-$]<=T&&wa[255+$-G]<=T&&wa[255+Ie-we]<=T&&wa[255+we-ie]<=T&&wa[255+ie-K]<=T}function Jl(c,h,x,S){var T=2*S+1;for(S=0;16>S;++S)Gl(c,h+S,x,T)&&ki(c,h+S,x)}function $a(c,h,x,S){var T=2*S+1;for(S=0;16>S;++S)Gl(c,h+S*x,1,T)&&ki(c,h+S*x,1)}function is(c,h,x,S){var T;for(T=3;0<T;--T)Jl(c,h+=4*x,x,S)}function Bu(c,h,x,S){var T;for(T=3;0<T;--T)$a(c,h+=4,x,S)}function _s(c,h,x,S,T,B,$,G){for(B=2*B+1;0<T--;){if(Ql(c,h,x,B,$))if(Vl(c,h,x,G))ki(c,h,x);else{var K=c,ie=h,we=x,Ie=K[ie-2*we],De=K[ie-we],ke=K[ie+0],tt=K[ie+we],We=K[ie+2*we],_e=27*(Ze=Hu[1020+3*(ke-De)+Hu[1020+Ie-tt]])+63>>7,Se=18*Ze+63>>7,Ze=9*Ze+63>>7;K[ie-3*we]=fa[255+K[ie-3*we]+Ze],K[ie-2*we]=fa[255+Ie+Se],K[ie-we]=fa[255+De+_e],K[ie+0]=fa[255+ke-_e],K[ie+we]=fa[255+tt-Se],K[ie+2*we]=fa[255+We-Ze]}h+=S}}function La(c,h,x,S,T,B,$,G){for(B=2*B+1;0<T--;){if(Ql(c,h,x,B,$))if(Vl(c,h,x,G))ki(c,h,x);else{var K=c,ie=h,we=x,Ie=K[ie-we],De=K[ie+0],ke=K[ie+we],tt=sc[112+((We=3*(De-Ie))+4>>3)],We=sc[112+(We+3>>3)],_e=tt+1>>1;K[ie-2*we]=fa[255+K[ie-2*we]+_e],K[ie-we]=fa[255+Ie+We],K[ie+0]=fa[255+De-tt],K[ie+we]=fa[255+ke-_e]}h+=S}}function Po(c,h,x,S,T,B){_s(c,h,x,1,16,S,T,B)}function Xs(c,h,x,S,T,B){_s(c,h,1,x,16,S,T,B)}function Uu(c,h,x,S,T,B){var $;for($=3;0<$;--$)La(c,h+=4*x,x,1,16,S,T,B)}function Ai(c,h,x,S,T,B){var $;for($=3;0<$;--$)La(c,h+=4,1,x,16,S,T,B)}function Wu(c,h,x,S,T,B,$,G){_s(c,h,T,1,8,B,$,G),_s(x,S,T,1,8,B,$,G)}function ko(c,h,x,S,T,B,$,G){_s(c,h,1,T,8,B,$,G),_s(x,S,1,T,8,B,$,G)}function Ao(c,h,x,S,T,B,$,G){La(c,h+4*T,T,1,8,B,$,G),La(x,S+4*T,T,1,8,B,$,G)}function Kl(c,h,x,S,T,B,$,G){La(c,h+4,1,T,8,B,$,G),La(x,S+4,1,T,8,B,$,G)}function Li(){this.ba=new Zr,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new _r,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Lo(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function No(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Xl(){this.ua=0,this.Wa=new R,this.vb=new R,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new W,this.yc=new L}function zu(){this.xb=this.a=0,this.l=new ys,this.ca=new Zr,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new A,this.Pb=0,this.wd=new A,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Xl,this.ab=0,this.gc=o(4,No),this.Oc=0}function Ni(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new ys,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Zs(c,h,x,S,T,B,$){for(c=c==null?0:c[h+0],h=0;h<$;++h)T[B+h]=c+x[S+h]&255,c=T[B+h]}function Eo(c,h,x,S,T,B,$){var G;if(c==null)Zs(null,null,x,S,T,B,$);else for(G=0;G<$;++G)T[B+G]=c[h+G]+x[S+G]&255}function js(c,h,x,S,T,B,$){if(c==null)Zs(null,null,x,S,T,B,$);else{var G,K=c[h+0],ie=K,we=K;for(G=0;G<$;++G)ie=we+(K=c[h+G])-ie,we=x[S+G]+(-256&ie?0>ie?0:255:ie)&255,ie=K,T[B+G]=we}}function Oo(c,h,x,S){var T=h.width,B=h.o;if(e(c!=null&&h!=null),0>x||0>=S||x+S>B)return null;if(!c.Cc){if(c.ga==null){var $;if(c.ga=new Ni,($=c.ga==null)||($=h.width*h.o,e(c.Gb.length==0),c.Gb=i($),c.Uc=0,c.Gb==null?$=0:(c.mb=c.Gb,c.nb=c.Uc,c.rc=null,$=1),$=!$),!$){$=c.ga;var G=c.Fa,K=c.P,ie=c.qc,we=c.mb,Ie=c.nb,De=K+1,ke=ie-1,tt=$.l;if(e(G!=null&&we!=null&&h!=null),Ls[0]=null,Ls[1]=Zs,Ls[2]=Eo,Ls[3]=js,$.ca=we,$.tb=Ie,$.c=h.width,$.i=h.height,e(0<$.c&&0<$.i),1>=ie)h=0;else if($.$a=G[K+0]>>0&3,$.Z=G[K+0]>>2&3,$.Lc=G[K+0]>>4&3,K=G[K+0]>>6&3,0>$.$a||1<$.$a||4<=$.Z||1<$.Lc||K)h=0;else if(tt.put=Hr,tt.ac=ir,tt.bc=Nn,tt.ma=$,tt.width=h.width,tt.height=h.height,tt.Da=h.Da,tt.v=h.v,tt.va=h.va,tt.j=h.j,tt.o=h.o,$.$a)e:{e($.$a==1),h=ut();t:for(;;){if(h==null){h=0;break e}if(e($!=null),$.mc=h,h.c=$.c,h.i=$.i,h.l=$.l,h.l.ma=$,h.l.width=$.c,h.l.height=$.i,h.a=0,E(h.m,G,De,ke),!qt($.c,$.i,1,h,null)||(h.ab==1&&h.gc[0].hc==3&&ur(h.s)?($.ic=1,G=h.c*h.i,h.Ta=null,h.Ua=0,h.V=i(G),h.Ba=0,h.V==null?(h.a=1,h=0):h=1):($.ic=0,h=qr(h,$.c)),!h))break t;h=1;break e}$.mc=null,h=0}else h=ke>=$.c*$.i;$=!h}if($)return null;c.ga.Lc!=1?c.Ga=0:S=B-x}e(c.ga!=null),e(x+S<=B);e:{if(h=(G=c.ga).c,B=G.l.o,G.$a==0){if(De=c.rc,ke=c.Vc,tt=c.Fa,K=c.P+1+x*h,ie=c.mb,we=c.nb+x*h,e(K<=c.P+c.qc),G.Z!=0)for(e(Ls[G.Z]!=null),$=0;$<S;++$)Ls[G.Z](De,ke,tt,K,ie,we,h),De=ie,ke=we,we+=h,K+=h;else for($=0;$<S;++$)n(ie,we,tt,K,h),De=ie,ke=we,we+=h,K+=h;c.rc=De,c.Vc=ke}else{if(e(G.mc!=null),h=x+S,e(($=G.mc)!=null),e(h<=$.i),$.C>=h)h=1;else if(G.ic||Ee(),G.ic){G=$.V,De=$.Ba,ke=$.c;var We=$.i,_e=(tt=1,K=$.$/ke,ie=$.$%ke,we=$.m,Ie=$.s,$.$),Se=ke*We,Ze=ke*h,ot=Ie.wc,et=_e<Ze?Ke(Ie,ie,K):null;e(_e<=Se),e(h<=We),e(ur(Ie));t:for(;;){for(;!we.h&&_e<Ze;){if(ie&ot||(et=Ke(Ie,ie,K)),e(et!=null),ce(we),256>(We=Be(et.G[0],et.H[0],we)))G[De+_e]=We,++_e,++ie>=ke&&(ie=0,++K<=h&&!(K%16)&&ln($,K));else{if(!(280>We)){tt=0;break t}We=kn(We-256,we);var wt,ft=Be(et.G[4],et.H[4],we);if(ce(we),!(_e>=(ft=Ne(ke,ft=kn(ft,we)))&&Se-_e>=We)){tt=0;break t}for(wt=0;wt<We;++wt)G[De+_e+wt]=G[De+_e+wt-ft];for(_e+=We,ie+=We;ie>=ke;)ie-=ke,++K<=h&&!(K%16)&&ln($,K);_e<Ze&&ie&ot&&(et=Ke(Ie,ie,K))}e(we.h==J(we))}ln($,K>h?h:K);break t}!tt||we.h&&_e<Se?(tt=0,$.a=we.h?5:3):$.$=_e,h=tt}else h=$e($,$.V,$.Ba,$.c,$.i,h,Me);if(!h){S=0;break e}}x+S>=B&&(c.Cc=1),S=1}if(!S)return null;if(c.Cc&&((S=c.ga)!=null&&(S.mc=null),c.ga=null,0<c.Ga))return alert("todo:WebPDequantizeLevels"),null}return c.nb+x*T}function g(c,h,x,S,T,B){for(;0<T--;){var $,G=c,K=h+(x?1:0),ie=c,we=h+(x?0:3);for($=0;$<S;++$){var Ie=ie[we+4*$];Ie!=255&&(Ie*=32897,G[K+4*$+0]=G[K+4*$+0]*Ie>>23,G[K+4*$+1]=G[K+4*$+1]*Ie>>23,G[K+4*$+2]=G[K+4*$+2]*Ie>>23)}h+=B}}function M(c,h,x,S,T){for(;0<S--;){var B;for(B=0;B<x;++B){var $=c[h+2*B+0],G=15&(ie=c[h+2*B+1]),K=4369*G,ie=(240&ie|ie>>4)*K>>16;c[h+2*B+0]=(240&$|$>>4)*K>>16&240|(15&$|$<<4)*K>>16>>4&15,c[h+2*B+1]=240&ie|G}h+=T}}function le(c,h,x,S,T,B,$,G){var K,ie,we=255;for(ie=0;ie<T;++ie){for(K=0;K<S;++K){var Ie=c[h+K];B[$+4*K]=Ie,we&=Ie}h+=x,$+=G}return we!=255}function ge(c,h,x,S,T){var B;for(B=0;B<T;++B)x[S+B]=c[h+B]>>8}function Ee(){ba=g,Ur=M,Wr=le,un=ge}function Ge(c,h,x){C[c]=function(S,T,B,$,G,K,ie,we,Ie,De,ke,tt,We,_e,Se,Ze,ot){var et,wt=ot-1>>1,ft=G[K+0]|ie[we+0]<<16,Dt=Ie[De+0]|ke[tt+0]<<16;e(S!=null);var vt=3*ft+Dt+131074>>2;for(h(S[T+0],255&vt,vt>>16,We,_e),B!=null&&(vt=3*Dt+ft+131074>>2,h(B[$+0],255&vt,vt>>16,Se,Ze)),et=1;et<=wt;++et){var yr=G[K+et]|ie[we+et]<<16,Ar=Ie[De+et]|ke[tt+et]<<16,fr=ft+yr+Dt+Ar+524296,or=fr+2*(yr+Dt)>>3;vt=or+ft>>1,ft=(fr=fr+2*(ft+Ar)>>3)+yr>>1,h(S[T+2*et-1],255&vt,vt>>16,We,_e+(2*et-1)*x),h(S[T+2*et-0],255&ft,ft>>16,We,_e+(2*et-0)*x),B!=null&&(vt=fr+Dt>>1,ft=or+Ar>>1,h(B[$+2*et-1],255&vt,vt>>16,Se,Ze+(2*et-1)*x),h(B[$+2*et+0],255&ft,ft>>16,Se,Ze+(2*et+0)*x)),ft=yr,Dt=Ar}1&ot||(vt=3*ft+Dt+131074>>2,h(S[T+ot-1],255&vt,vt>>16,We,_e+(ot-1)*x),B!=null&&(vt=3*Dt+ft+131074>>2,h(B[$+ot-1],255&vt,vt>>16,Se,Ze+(ot-1)*x)))}}function lt(){_a[ic]=Y1,_a[oc]=Qh,_a[$h]=V1,_a[lc]=Jh,_a[cc]=Kh,_a[Yu]=Xh,_a[Hh]=G1,_a[Vu]=Qh,_a[Gu]=Jh,_a[uc]=Kh,_a[Qu]=Xh}function yt(c){return c&-16384?0>c?0:255:c>>Q1}function It(c,h){return yt((19077*c>>8)+(26149*h>>8)-14234)}function Yt(c,h,x){return yt((19077*c>>8)-(6419*h>>8)-(13320*x>>8)+8708)}function Wt(c,h){return yt((19077*c>>8)+(33050*h>>8)-17685)}function hr(c,h,x,S,T){S[T+0]=It(c,x),S[T+1]=Yt(c,h,x),S[T+2]=Wt(c,h)}function Qr(c,h,x,S,T){S[T+0]=Wt(c,h),S[T+1]=Yt(c,h,x),S[T+2]=It(c,x)}function en(c,h,x,S,T){var B=Yt(c,h,x);h=B<<3&224|Wt(c,h)>>3,S[T+0]=248&It(c,x)|B>>5,S[T+1]=h}function yn(c,h,x,S,T){var B=240&Wt(c,h)|15;S[T+0]=240&It(c,x)|Yt(c,h,x)>>4,S[T+1]=B}function Wn(c,h,x,S,T){S[T+0]=255,hr(c,h,x,S,T+1)}function On(c,h,x,S,T){Qr(c,h,x,S,T),S[T+3]=255}function Na(c,h,x,S,T){hr(c,h,x,S,T),S[T+3]=255}function ha(c,h){return 0>c?0:c>h?h:c}function Ha(c,h,x){C[c]=function(S,T,B,$,G,K,ie,we,Ie){for(var De=we+(-2&Ie)*x;we!=De;)h(S[T+0],B[$+0],G[K+0],ie,we),h(S[T+1],B[$+0],G[K+0],ie,we+x),T+=2,++$,++K,we+=2*x;1&Ie&&h(S[T+0],B[$+0],G[K+0],ie,we)}}function Zl(c,h,x){return x==0?c==0?h==0?6:5:h==0?4:0:x}function Io(c,h,x,S,T){switch(c>>>30){case 3:cs(h,x,S,T,0);break;case 2:cn(h,x,S,T);break;case 1:Kn(h,x,S,T)}}function Do(c,h){var x,S,T=h.M,B=h.Nb,$=c.oc,G=c.pc+40,K=c.oc,ie=c.pc+584,we=c.oc,Ie=c.pc+600;for(x=0;16>x;++x)$[G+32*x-1]=129;for(x=0;8>x;++x)K[ie+32*x-1]=129,we[Ie+32*x-1]=129;for(0<T?$[G-1-32]=K[ie-1-32]=we[Ie-1-32]=129:(s($,G-32-1,127,21),s(K,ie-32-1,127,9),s(we,Ie-32-1,127,9)),S=0;S<c.za;++S){var De=h.ya[h.aa+S];if(0<S){for(x=-1;16>x;++x)n($,G+32*x-4,$,G+32*x+12,4);for(x=-1;8>x;++x)n(K,ie+32*x-4,K,ie+32*x+4,4),n(we,Ie+32*x-4,we,Ie+32*x+4,4)}var ke=c.Gd,tt=c.Hd+S,We=De.ad,_e=De.Hc;if(0<T&&(n($,G-32,ke[tt].y,0,16),n(K,ie-32,ke[tt].f,0,8),n(we,Ie-32,ke[tt].ea,0,8)),De.Za){var Se=$,Ze=G-32+16;for(0<T&&(S>=c.za-1?s(Se,Ze,ke[tt].y[15],4):n(Se,Ze,ke[tt+1].y,0,4)),x=0;4>x;x++)Se[Ze+128+x]=Se[Ze+256+x]=Se[Ze+384+x]=Se[Ze+0+x];for(x=0;16>x;++x,_e<<=2)Se=$,Ze=G+ef[x],Ea[De.Ob[x]](Se,Ze),Io(_e,We,16*+x,Se,Ze)}else if(Se=Zl(S,T,De.Ob[0]),As[Se]($,G),_e!=0)for(x=0;16>x;++x,_e<<=2)Io(_e,We,16*+x,$,G+ef[x]);for(x=De.Gc,Se=Zl(S,T,De.Dd),ds[Se](K,ie),ds[Se](we,Ie),_e=We,Se=K,Ze=ie,255&(De=x>>0)&&(170&De?qo(_e,256,Se,Ze):xa(_e,256,Se,Ze)),De=we,_e=Ie,255&(x>>=8)&&(170&x?qo(We,320,De,_e):xa(We,320,De,_e)),T<c.Ub-1&&(n(ke[tt].y,0,$,G+480,16),n(ke[tt].f,0,K,ie+224,8),n(ke[tt].ea,0,we,Ie+224,8)),x=8*B*c.B,ke=c.sa,tt=c.ta+16*S+16*B*c.R,We=c.qa,De=c.ra+8*S+x,_e=c.Ha,Se=c.Ia+8*S+x,x=0;16>x;++x)n(ke,tt+x*c.R,$,G+32*x,16);for(x=0;8>x;++x)n(We,De+x*c.B,K,ie+32*x,8),n(_e,Se+x*c.B,we,Ie+32*x,8)}}function Ei(c,h,x,S,T,B,$,G,K){var ie=[0],we=[0],Ie=0,De=K!=null?K.kd:0,ke=K??new Lo;if(c==null||12>x)return 7;ke.data=c,ke.w=h,ke.ha=x,h=[h],x=[x],ke.gb=[ke.gb];e:{var tt=h,We=x,_e=ke.gb;if(e(c!=null),e(We!=null),e(_e!=null),_e[0]=0,12<=We[0]&&!r(c,tt[0],"RIFF")){if(r(c,tt[0]+8,"WEBP")){_e=3;break e}var Se=se(c,tt[0]+4);if(12>Se||4294967286<Se){_e=3;break e}if(De&&Se>We[0]-8){_e=7;break e}_e[0]=Se,tt[0]+=12,We[0]-=12}_e=0}if(_e!=0)return _e;for(Se=0<ke.gb[0],x=x[0];;){e:{var Ze=c;We=h,_e=x;var ot=ie,et=we,wt=tt=[0];if((vt=Ie=[Ie])[0]=0,8>_e[0])_e=7;else{if(!r(Ze,We[0],"VP8X")){if(se(Ze,We[0]+4)!=10){_e=3;break e}if(18>_e[0]){_e=7;break e}var ft=se(Ze,We[0]+8),Dt=1+Le(Ze,We[0]+12);if(2147483648<=Dt*(Ze=1+Le(Ze,We[0]+15))){_e=3;break e}wt!=null&&(wt[0]=ft),ot!=null&&(ot[0]=Dt),et!=null&&(et[0]=Ze),We[0]+=18,_e[0]-=18,vt[0]=1}_e=0}}if(Ie=Ie[0],tt=tt[0],_e!=0)return _e;if(We=!!(2&tt),!Se&&Ie)return 3;if(B!=null&&(B[0]=!!(16&tt)),$!=null&&($[0]=We),G!=null&&(G[0]=0),$=ie[0],tt=we[0],Ie&&We&&K==null){_e=0;break}if(4>x){_e=7;break}if(Se&&Ie||!Se&&!Ie&&!r(c,h[0],"ALPH")){x=[x],ke.na=[ke.na],ke.P=[ke.P],ke.Sa=[ke.Sa];e:{ft=c,_e=h,Se=x;var vt=ke.gb;ot=ke.na,et=ke.P,wt=ke.Sa,Dt=22,e(ft!=null),e(Se!=null),Ze=_e[0];var yr=Se[0];for(e(ot!=null),e(wt!=null),ot[0]=null,et[0]=null,wt[0]=0;;){if(_e[0]=Ze,Se[0]=yr,8>yr){_e=7;break e}var Ar=se(ft,Ze+4);if(4294967286<Ar){_e=3;break e}var fr=8+Ar+1&-2;if(Dt+=fr,0<vt&&Dt>vt){_e=3;break e}if(!r(ft,Ze,"VP8 ")||!r(ft,Ze,"VP8L")){_e=0;break e}if(yr[0]<fr){_e=7;break e}r(ft,Ze,"ALPH")||(ot[0]=ft,et[0]=Ze+8,wt[0]=Ar),Ze+=fr,yr-=fr}}if(x=x[0],ke.na=ke.na[0],ke.P=ke.P[0],ke.Sa=ke.Sa[0],_e!=0)break}x=[x],ke.Ja=[ke.Ja],ke.xa=[ke.xa];e:if(vt=c,_e=h,Se=x,ot=ke.gb[0],et=ke.Ja,wt=ke.xa,ft=_e[0],Ze=!r(vt,ft,"VP8 "),Dt=!r(vt,ft,"VP8L"),e(vt!=null),e(Se!=null),e(et!=null),e(wt!=null),8>Se[0])_e=7;else{if(Ze||Dt){if(vt=se(vt,ft+4),12<=ot&&vt>ot-12){_e=3;break e}if(De&&vt>Se[0]-8){_e=7;break e}et[0]=vt,_e[0]+=8,Se[0]-=8,wt[0]=Dt}else wt[0]=5<=Se[0]&&vt[ft+0]==47&&!(vt[ft+4]>>5),et[0]=Se[0];_e=0}if(x=x[0],ke.Ja=ke.Ja[0],ke.xa=ke.xa[0],h=h[0],_e!=0)break;if(4294967286<ke.Ja)return 3;if(G==null||We||(G[0]=ke.xa?2:1),$=[$],tt=[tt],ke.xa){if(5>x){_e=7;break}G=$,De=tt,We=B,c==null||5>x?c=0:5<=x&&c[h+0]==47&&!(c[h+4]>>5)?(Se=[0],vt=[0],ot=[0],E(et=new A,c,h,x),Nt(et,Se,vt,ot)?(G!=null&&(G[0]=Se[0]),De!=null&&(De[0]=vt[0]),We!=null&&(We[0]=ot[0]),c=1):c=0):c=0}else{if(10>x){_e=7;break}G=tt,c==null||10>x||!he(c,h+3,x-3)?c=0:(De=c[h+0]|c[h+1]<<8|c[h+2]<<16,We=16383&(c[h+7]<<8|c[h+6]),c=16383&(c[h+9]<<8|c[h+8]),1&De||3<(De>>1&7)||!(De>>4&1)||De>>5>=ke.Ja||!We||!c?c=0:($&&($[0]=We),G&&(G[0]=c),c=1))}if(!c||($=$[0],tt=tt[0],Ie&&(ie[0]!=$||we[0]!=tt)))return 3;K!=null&&(K[0]=ke,K.offset=h-K.w,e(4294967286>h-K.w),e(K.offset==K.ha-x));break}return _e==0||_e==7&&Ie&&K==null?(B!=null&&(B[0]|=ke.na!=null&&0<ke.na.length),S!=null&&(S[0]=$),T!=null&&(T[0]=tt),0):_e}function To(c,h,x){var S=h.width,T=h.height,B=0,$=0,G=S,K=T;if(h.Da=c!=null&&0<c.Da,h.Da&&(G=c.cd,K=c.bd,B=c.v,$=c.j,11>x||(B&=-2,$&=-2),0>B||0>$||0>=G||0>=K||B+G>S||$+K>T))return 0;if(h.v=B,h.j=$,h.va=B+G,h.o=$+K,h.U=G,h.T=K,h.da=c!=null&&0<c.da,h.da){if(!be(G,K,x=[c.ib],B=[c.hb]))return 0;h.ib=x[0],h.hb=B[0]}return h.ob=c!=null&&c.ob,h.Kb=c==null||!c.Sd,h.da&&(h.ob=h.ib<3*S/4&&h.hb<3*T/4,h.Kb=0),1}function Mo(c){if(c==null)return 2;if(11>c.S){var h=c.f.RGBA;h.fb+=(c.height-1)*h.A,h.A=-h.A}else h=c.f.kb,c=c.height,h.O+=(c-1)*h.fa,h.fa=-h.fa,h.N+=(c-1>>1)*h.Ab,h.Ab=-h.Ab,h.W+=(c-1>>1)*h.Db,h.Db=-h.Db,h.F!=null&&(h.J+=(c-1)*h.lb,h.lb=-h.lb);return 0}function Oi(c,h,x,S){if(S==null||0>=c||0>=h)return 2;if(x!=null){if(x.Da){var T=x.cd,B=x.bd,$=-2&x.v,G=-2&x.j;if(0>$||0>G||0>=T||0>=B||$+T>c||G+B>h)return 2;c=T,h=B}if(x.da){if(!be(c,h,T=[x.ib],B=[x.hb]))return 2;c=T[0],h=B[0]}}S.width=c,S.height=h;e:{var K=S.width,ie=S.height;if(c=S.S,0>=K||0>=ie||!(c>=ic&&13>c))c=2;else{if(0>=S.Rd&&S.sd==null){$=B=T=h=0;var we=(G=K*tf[c])*ie;if(11>c||(B=(ie+1)/2*(h=(K+1)/2),c==12&&($=(T=K)*ie)),(ie=i(we+2*B+$))==null){c=1;break e}S.sd=ie,11>c?((K=S.f.RGBA).eb=ie,K.fb=0,K.A=G,K.size=we):((K=S.f.kb).y=ie,K.O=0,K.fa=G,K.Fd=we,K.f=ie,K.N=0+we,K.Ab=h,K.Cd=B,K.ea=ie,K.W=0+we+B,K.Db=h,K.Ed=B,c==12&&(K.F=ie,K.J=0+we+2*B),K.Tc=$,K.lb=T)}if(h=1,T=S.S,B=S.width,$=S.height,T>=ic&&13>T)if(11>T)c=S.f.RGBA,h&=(G=Math.abs(c.A))*($-1)+B<=c.size,h&=G>=B*tf[T],h&=c.eb!=null;else{c=S.f.kb,G=(B+1)/2,we=($+1)/2,K=Math.abs(c.fa),ie=Math.abs(c.Ab);var Ie=Math.abs(c.Db),De=Math.abs(c.lb),ke=De*($-1)+B;h&=K*($-1)+B<=c.Fd,h&=ie*(we-1)+G<=c.Cd,h=(h&=Ie*(we-1)+G<=c.Ed)&K>=B&ie>=G&Ie>=G,h&=c.y!=null,h&=c.f!=null,h&=c.ea!=null,T==12&&(h&=De>=B,h&=ke<=c.Tc,h&=c.F!=null)}else h=0;c=h?0:2}}return c!=0||x!=null&&x.fd&&(c=Mo(S)),c}var Rn=64,Ii=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Di=24,Ti=32,Fo=8,ta=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];He("Predictor0","PredictorAdd0"),C.Predictor0=function(){return 4278190080},C.Predictor1=function(c){return c},C.Predictor2=function(c,h,x){return h[x+0]},C.Predictor3=function(c,h,x){return h[x+1]},C.Predictor4=function(c,h,x){return h[x-1]},C.Predictor5=function(c,h,x){return nt(nt(c,h[x+1]),h[x+0])},C.Predictor6=function(c,h,x){return nt(c,h[x-1])},C.Predictor7=function(c,h,x){return nt(c,h[x+0])},C.Predictor8=function(c,h,x){return nt(h[x-1],h[x+0])},C.Predictor9=function(c,h,x){return nt(h[x+0],h[x+1])},C.Predictor10=function(c,h,x){return nt(nt(c,h[x-1]),nt(h[x+0],h[x+1]))},C.Predictor11=function(c,h,x){var S=h[x+0];return 0>=Re(S>>24&255,c>>24&255,(h=h[x-1])>>24&255)+Re(S>>16&255,c>>16&255,h>>16&255)+Re(S>>8&255,c>>8&255,h>>8&255)+Re(255&S,255&c,255&h)?S:c},C.Predictor12=function(c,h,x){var S=h[x+0];return(dt((c>>24&255)+(S>>24&255)-((h=h[x-1])>>24&255))<<24|dt((c>>16&255)+(S>>16&255)-(h>>16&255))<<16|dt((c>>8&255)+(S>>8&255)-(h>>8&255))<<8|dt((255&c)+(255&S)-(255&h)))>>>0},C.Predictor13=function(c,h,x){var S=h[x-1];return(Ae((c=nt(c,h[x+0]))>>24&255,S>>24&255)<<24|Ae(c>>16&255,S>>16&255)<<16|Ae(c>>8&255,S>>8&255)<<8|Ae(c>>0&255,S>>0&255))>>>0};var $u=C.PredictorAdd0;C.PredictorAdd1=st,He("Predictor2","PredictorAdd2"),He("Predictor3","PredictorAdd3"),He("Predictor4","PredictorAdd4"),He("Predictor5","PredictorAdd5"),He("Predictor6","PredictorAdd6"),He("Predictor7","PredictorAdd7"),He("Predictor8","PredictorAdd8"),He("Predictor9","PredictorAdd9"),He("Predictor10","PredictorAdd10"),He("Predictor11","PredictorAdd11"),He("Predictor12","PredictorAdd12"),He("Predictor13","PredictorAdd13");var Ro=C.PredictorAdd2;St("ColorIndexInverseTransform","MapARGB","32b",function(c){return c>>8&255},function(c){return c}),St("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(c){return c},function(c){return c>>8&255});var ec,va=C.ColorIndexInverseTransform,Mi=C.MapARGB,tc=C.VP8LColorIndexInverseTransformAlpha,rc=C.MapAlpha,Ss=C.VP8LPredictorsAdd=[];Ss.length=16,(C.VP8LPredictors=[]).length=16,(C.VP8LPredictorsAdd_C=[]).length=16,(C.VP8LPredictors_C=[]).length=16;var ei,ra,Jn,Cs,os,ls,Fi,cs,cn,qo,Kn,xa,Ri,nc,Bo,ti,ri,Ps,ni,qi,ai,ks,Uo,ya,ba,Ur,Wr,un,An=i(511),us=i(2041),Wo=i(225),Bi=i(767),ac=0,Hu=us,sc=Wo,fa=Bi,wa=An,ic=0,oc=1,$h=2,lc=3,cc=4,Yu=5,Hh=6,Vu=7,Gu=8,uc=9,Qu=10,O1=[2,3,7],I1=[3,3,11],Yh=[280,256,256,256,40],D1=[0,1,1,1,0],T1=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],M1=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],F1=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],R1=8,Ju=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Ku=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],zo=null,q1=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],B1=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Vh=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],U1=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],W1=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],z1=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],$1=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],As=[],Ea=[],ds=[],H1=1,Gh=2,Ls=[],_a=[];Ge("UpsampleRgbLinePair",hr,3),Ge("UpsampleBgrLinePair",Qr,3),Ge("UpsampleRgbaLinePair",Na,4),Ge("UpsampleBgraLinePair",On,4),Ge("UpsampleArgbLinePair",Wn,4),Ge("UpsampleRgba4444LinePair",yn,2),Ge("UpsampleRgb565LinePair",en,2);var Y1=C.UpsampleRgbLinePair,V1=C.UpsampleBgrLinePair,Qh=C.UpsampleRgbaLinePair,Jh=C.UpsampleBgraLinePair,Kh=C.UpsampleArgbLinePair,Xh=C.UpsampleRgba4444LinePair,G1=C.UpsampleRgb565LinePair,dc=16,hc=1<<dc-1,$o=-227,Xu=482,Q1=6,Zh=0,J1=i(256),K1=i(256),X1=i(256),Z1=i(256),e0=i(Xu-$o),t0=i(Xu-$o);Ha("YuvToRgbRow",hr,3),Ha("YuvToBgrRow",Qr,3),Ha("YuvToRgbaRow",Na,4),Ha("YuvToBgraRow",On,4),Ha("YuvToArgbRow",Wn,4),Ha("YuvToRgba4444Row",yn,2),Ha("YuvToRgb565Row",en,2);var ef=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],fc=[0,2,8],r0=[8,7,6,4,4,2,2,2,1,1,1,1],n0=1;this.WebPDecodeRGBA=function(c,h,x,S,T){var B=oc,$=new Li,G=new Zr;$.ba=G,G.S=B,G.width=[G.width],G.height=[G.height];var K=G.width,ie=G.height,we=new xn;if(we==null||c==null)var Ie=2;else e(we!=null),Ie=Ei(c,h,x,we.width,we.height,we.Pd,we.Qd,we.format,null);if(Ie!=0?K=0:(K!=null&&(K[0]=we.width[0]),ie!=null&&(ie[0]=we.height[0]),K=1),K){G.width=G.width[0],G.height=G.height[0],S!=null&&(S[0]=G.width),T!=null&&(T[0]=G.height);e:{if(S=new ys,(T=new Lo).data=c,T.w=h,T.ha=x,T.kd=1,h=[0],e(T!=null),((c=Ei(T.data,T.w,T.ha,null,null,null,h,null,T))==0||c==7)&&h[0]&&(c=4),(h=c)==0){if(e($!=null),S.data=T.data,S.w=T.w+T.offset,S.ha=T.ha-T.offset,S.put=Hr,S.ac=ir,S.bc=Nn,S.ma=$,T.xa){if((c=ut())==null){$=1;break e}if(function(De,ke){var tt=[0],We=[0],_e=[0];t:for(;;){if(De==null)return 0;if(ke==null)return De.a=2,0;if(De.l=ke,De.a=0,E(De.m,ke.data,ke.w,ke.ha),!Nt(De.m,tt,We,_e)){De.a=3;break t}if(De.xb=Gh,ke.width=tt[0],ke.height=We[0],!qt(tt[0],We[0],1,De,null))break t;return 1}return e(De.a!=0),0}(c,S)){if(S=(h=Oi(S.width,S.height,$.Oa,$.ba))==0){t:{S=c;r:for(;;){if(S==null){S=0;break t}if(e(S.s.yc!=null),e(S.s.Ya!=null),e(0<S.s.Wb),e((x=S.l)!=null),e((T=x.ma)!=null),S.xb!=0){if(S.ca=T.ba,S.tb=T.tb,e(S.ca!=null),!To(T.Oa,x,lc)){S.a=2;break r}if(!qr(S,x.width)||x.da)break r;if((x.da||Bt(S.ca.S))&&Ee(),11>S.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),S.ca.f.kb.F!=null&&Ee()),S.Pb&&0<S.s.ua&&S.s.vb.X==null&&!Fe(S.s.vb,S.s.Wa.Xa)){S.a=1;break r}S.xb=0}if(!$e(S,S.V,S.Ba,S.c,S.i,x.o,kt))break r;T.Dc=S.Ma,S=1;break t}e(S.a!=0),S=0}S=!S}S&&(h=c.a)}else h=c.a}else{if((c=new wo)==null){$=1;break e}if(c.Fa=T.na,c.P=T.P,c.qc=T.Sa,Te(c,S)){if((h=Oi(S.width,S.height,$.Oa,$.ba))==0){if(c.Aa=0,x=$.Oa,e((T=c)!=null),x!=null){if(0<(K=0>(K=x.Md)?0:100<K?255:255*K/100)){for(ie=we=0;4>ie;++ie)12>(Ie=T.pb[ie]).lc&&(Ie.ia=K*r0[0>Ie.lc?0:Ie.lc]>>3),we|=Ie.ia;we&&(alert("todo:VP8InitRandom"),T.ia=1)}T.Ga=x.Id,100<T.Ga?T.Ga=100:0>T.Ga&&(T.Ga=0)}Et(c,S)||(h=c.a)}}else h=c.a}h==0&&$.Oa!=null&&$.Oa.fd&&(h=Mo($.ba))}$=h}B=$!=0?null:11>B?G.f.RGBA.eb:G.f.kb.y}else B=null;return B};var tf=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function d(C,N){for(var Q="",P=0;P<4;P++)Q+=String.fromCharCode(C[N++]);return Q}function f(C,N){return(C[N+0]<<0|C[N+1]<<8|C[N+2]<<16)>>>0}function m(C,N){return(C[N+0]<<0|C[N+1]<<8|C[N+2]<<16|C[N+3]<<24)>>>0}new u;var v=[0],p=[0],b=[],w=new u,y=t,j=function(C,N){var Q={},P=0,L=!1,te=0,W=0;if(Q.frames=[],!function(D,J,re,ce){for(var fe=0;fe<ce;fe++)if(D[J+fe]!=re.charCodeAt(fe))return!0;return!1}(C,N,"RIFF",4)){for(m(C,N+=4),N+=8;N<C.length;){var z=d(C,N),V=m(C,N+=4);N+=4;var Y=V+(1&V);switch(z){case"VP8 ":case"VP8L":Q.frames[P]===void 0&&(Q.frames[P]={}),(oe=Q.frames[P]).src_off=L?W:N-8,oe.src_size=te+V+8,P++,L&&(L=!1,te=0,W=0);break;case"VP8X":(oe=Q.header={}).feature_flags=C[N];var E=N+4;oe.canvas_width=1+f(C,E),E+=3,oe.canvas_height=1+f(C,E),E+=3;break;case"ALPH":L=!0,te=Y+8,W=N-8;break;case"ANIM":(oe=Q.header).bgcolor=m(C,N),E=N+4,oe.loop_count=(de=C)[(A=E)+0]<<0|de[A+1]<<8,E+=2;break;case"ANMF":var X,oe;(oe=Q.frames[P]={}).offset_x=2*f(C,N),N+=3,oe.offset_y=2*f(C,N),N+=3,oe.width=1+f(C,N),N+=3,oe.height=1+f(C,N),N+=3,oe.duration=f(C,N),N+=3,X=C[N++],oe.dispose=1&X,oe.blend=X>>1&1}z!="ANMF"&&(N+=Y)}var de,A;return Q}}(y,0);j.response=y,j.rgbaoutput=!0,j.dataurl=!1;var O=j.header?j.header:null,k=j.frames?j.frames:null;if(O){O.loop_counter=O.loop_count,v=[O.canvas_height],p=[O.canvas_width];for(var I=0;I<k.length&&k[I].blend!=0;I++);}var H=k[0],F=w.WebPDecodeRGBA(y,H.src_off,H.src_size,p,v);H.rgba=F,H.imgwidth=p[0],H.imgheight=v[0];for(var U=0;U<p[0]*v[0]*4;U++)b[U]=F[U];return this.width=p,this.height=v,this.data=b,this}(function(t){var e=function(){return typeof ah=="function"},r=function(v,p,b,w){var y=4,j=o;switch(w){case t.image_compression.FAST:y=1,j=i;break;case t.image_compression.MEDIUM:y=6,j=l;break;case t.image_compression.SLOW:y=9,j=u}v=n(v,p,b,j);var O=ah(v,{level:y});return t.__addimage__.arrayBufferToBinaryString(O)},n=function(v,p,b,w){for(var y,j,O,k=v.length/p,I=new Uint8Array(v.length+k),H=f(),F=0;F<k;F+=1){if(O=F*p,y=v.subarray(O,O+p),w)I.set(w(y,b,j),O+F);else{for(var U,C=H.length,N=[];U<C;U+=1)N[U]=H[U](y,b,j);var Q=m(N.concat());I.set(N[Q],O+F)}j=y}return I},s=function(v){var p=Array.apply([],v);return p.unshift(0),p},i=function(v,p){var b,w=[],y=v.length;w[0]=1;for(var j=0;j<y;j+=1)b=v[j-p]||0,w[j+1]=v[j]-b+256&255;return w},o=function(v,p,b){var w,y=[],j=v.length;y[0]=2;for(var O=0;O<j;O+=1)w=b&&b[O]||0,y[O+1]=v[O]-w+256&255;return y},l=function(v,p,b){var w,y,j=[],O=v.length;j[0]=3;for(var k=0;k<O;k+=1)w=v[k-p]||0,y=b&&b[k]||0,j[k+1]=v[k]+256-(w+y>>>1)&255;return j},u=function(v,p,b){var w,y,j,O,k=[],I=v.length;k[0]=4;for(var H=0;H<I;H+=1)w=v[H-p]||0,y=b&&b[H]||0,j=b&&b[H-p]||0,O=d(w,y,j),k[H+1]=v[H]-O+256&255;return k},d=function(v,p,b){if(v===p&&p===b)return v;var w=Math.abs(p-b),y=Math.abs(v-b),j=Math.abs(v+p-b-b);return w<=y&&w<=j?v:y<=j?p:b},f=function(){return[s,i,o,l,u]},m=function(v){var p=v.map(function(b){return b.reduce(function(w,y){return w+Math.abs(y)},0)});return p.indexOf(Math.min.apply(null,p))};t.processPNG=function(v,p,b,w){var y,j,O,k,I,H,F,U,C,N,Q,P,L,te,W,z=this.decode.FLATE_DECODE,V="";if(this.__addimage__.isArrayBuffer(v)&&(v=new Uint8Array(v)),this.__addimage__.isArrayBufferView(v)){if(v=(O=new Tb(v)).imgData,j=O.bits,y=O.colorSpace,I=O.colors,[4,6].indexOf(O.colorType)!==-1){if(O.bits===8){C=(U=O.pixelBitlength==32?new Uint32Array(O.decodePixels().buffer):O.pixelBitlength==16?new Uint16Array(O.decodePixels().buffer):new Uint8Array(O.decodePixels().buffer)).length,Q=new Uint8Array(C*O.colors),N=new Uint8Array(C);var Y,E=O.pixelBitlength-O.bits;for(te=0,W=0;te<C;te++){for(L=U[te],Y=0;Y<E;)Q[W++]=L>>>Y&255,Y+=O.bits;N[te]=L>>>Y&255}}if(O.bits===16){C=(U=new Uint32Array(O.decodePixels().buffer)).length,Q=new Uint8Array(C*(32/O.pixelBitlength)*O.colors),N=new Uint8Array(C*(32/O.pixelBitlength)),P=O.colors>1,te=0,W=0;for(var X=0;te<C;)L=U[te++],Q[W++]=L>>>0&255,P&&(Q[W++]=L>>>16&255,L=U[te++],Q[W++]=L>>>0&255),N[X++]=L>>>16&255;j=8}w!==t.image_compression.NONE&&e()?(v=r(Q,O.width*O.colors,O.colors,w),F=r(N,O.width,1,w)):(v=Q,F=N,z=void 0)}if(O.colorType===3&&(y=this.color_spaces.INDEXED,H=O.palette,O.transparency.indexed)){var oe=O.transparency.indexed,de=0;for(te=0,C=oe.length;te<C;++te)de+=oe[te];if((de/=255)===C-1&&oe.indexOf(0)!==-1)k=[oe.indexOf(0)];else if(de!==C){for(U=O.decodePixels(),N=new Uint8Array(U.length),te=0,C=U.length;te<C;te++)N[te]=oe[U[te]];F=r(N,O.width,1)}}var A=function(D){var J;switch(D){case t.image_compression.FAST:J=11;break;case t.image_compression.MEDIUM:J=13;break;case t.image_compression.SLOW:J=14;break;default:J=12}return J}(w);return z===this.decode.FLATE_DECODE&&(V="/Predictor "+A+" "),V+="/Colors "+I+" /BitsPerComponent "+j+" /Columns "+O.width,(this.__addimage__.isArrayBuffer(v)||this.__addimage__.isArrayBufferView(v))&&(v=this.__addimage__.arrayBufferToBinaryString(v)),(F&&this.__addimage__.isArrayBuffer(F)||this.__addimage__.isArrayBufferView(F))&&(F=this.__addimage__.arrayBufferToBinaryString(F)),{alias:b,data:v,index:p,filter:z,decodeParameters:V,transparency:k,palette:H,sMask:F,predictor:A,width:O.width,height:O.height,bitsPerComponent:j,colorSpace:y}}}})(Tt.API),function(t){t.processGIF89A=function(e,r,n,s){var i=new Mb(e),o=i.width,l=i.height,u=[];i.decodeAndBlitFrameRGBA(0,u);var d={data:u,width:o,height:l},f=new Cd(100).encode(d,100);return t.processJPEG.call(this,f,r,n,s)},t.processGIF87A=t.processGIF89A}(Tt.API),Da.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var t=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(t);for(var e=0;e<t;e++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:s,green:n,blue:r,quad:i}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Da.prototype.parseBGR=function(){this.pos=this.offset;try{var t="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[t]()}catch(r){Mr.log("bit decode error:"+r)}},Da.prototype.bit1=function(){var t,e=Math.ceil(this.width/8),r=e%4;for(t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,s=0;s<e;s++)for(var i=this.datav.getUint8(this.pos++,!0),o=n*this.width*4+8*s*4,l=0;l<8&&8*s+l<this.width;l++){var u=this.palette[i>>7-l&1];this.data[o+4*l]=u.blue,this.data[o+4*l+1]=u.green,this.data[o+4*l+2]=u.red,this.data[o+4*l+3]=255}r!==0&&(this.pos+=4-r)}},Da.prototype.bit4=function(){for(var t=Math.ceil(this.width/2),e=t%4,r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,s=0;s<t;s++){var i=this.datav.getUint8(this.pos++,!0),o=n*this.width*4+2*s*4,l=i>>4,u=15&i,d=this.palette[l];if(this.data[o]=d.blue,this.data[o+1]=d.green,this.data[o+2]=d.red,this.data[o+3]=255,2*s+1>=this.width)break;d=this.palette[u],this.data[o+4]=d.blue,this.data[o+4+1]=d.green,this.data[o+4+2]=d.red,this.data[o+4+3]=255}e!==0&&(this.pos+=4-e)}},Da.prototype.bit8=function(){for(var t=this.width%4,e=this.height-1;e>=0;e--){for(var r=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var s=this.datav.getUint8(this.pos++,!0),i=r*this.width*4+4*n;if(s<this.palette.length){var o=this.palette[s];this.data[i]=o.red,this.data[i+1]=o.green,this.data[i+2]=o.blue,this.data[i+3]=255}else this.data[i]=255,this.data[i+1]=255,this.data[i+2]=255,this.data[i+3]=255}t!==0&&(this.pos+=4-t)}},Da.prototype.bit15=function(){for(var t=this.width%3,e=parseInt("11111",2),r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,s=0;s<this.width;s++){var i=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(i&e)/e*255|0,l=(i>>5&e)/e*255|0,u=(i>>10&e)/e*255|0,d=i>>15?255:0,f=n*this.width*4+4*s;this.data[f]=u,this.data[f+1]=l,this.data[f+2]=o,this.data[f+3]=d}this.pos+=t}},Da.prototype.bit16=function(){for(var t=this.width%3,e=parseInt("11111",2),r=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var s=this.bottom_up?n:this.height-1-n,i=0;i<this.width;i++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(o&e)/e*255|0,u=(o>>5&r)/r*255|0,d=(o>>11)/e*255|0,f=s*this.width*4+4*i;this.data[f]=d,this.data[f+1]=u,this.data[f+2]=l,this.data[f+3]=255}this.pos+=t}},Da.prototype.bit24=function(){for(var t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),o=e*this.width*4+4*r;this.data[o]=i,this.data[o+1]=s,this.data[o+2]=n,this.data[o+3]=255}this.pos+=this.width%4}},Da.prototype.bit32=function(){for(var t=this.height-1;t>=0;t--)for(var e=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),l=e*this.width*4+4*r;this.data[l]=i,this.data[l+1]=s,this.data[l+2]=n,this.data[l+3]=o}},Da.prototype.getData=function(){return this.data},function(t){t.processBMP=function(e,r,n,s){var i=new Da(e,!1),o=i.width,l=i.height,u={data:i.getData(),width:o,height:l},d=new Cd(100).encode(u,100);return t.processJPEG.call(this,d,r,n,s)}}(Tt.API),Tp.prototype.getData=function(){return this.data},function(t){t.processWEBP=function(e,r,n,s){var i=new Tp(e),o=i.width,l=i.height,u={data:i.getData(),width:o,height:l},d=new Cd(100).encode(u,100);return t.processJPEG.call(this,d,r,n,s)}}(Tt.API),Tt.API.processRGBA=function(t,e,r){for(var n=t.data,s=n.length,i=new Uint8Array(s/4*3),o=new Uint8Array(s/4),l=0,u=0,d=0;d<s;d+=4){var f=n[d],m=n[d+1],v=n[d+2],p=n[d+3];i[l++]=f,i[l++]=m,i[l++]=v,o[u++]=p}var b=this.__addimage__.arrayBufferToBinaryString(i);return{alpha:this.__addimage__.arrayBufferToBinaryString(o),data:b,index:e,alias:r,colorSpace:"DeviceRGB",bitsPerComponent:8,width:t.width,height:t.height}},Tt.API.setLanguage=function(t){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[t]!==void 0&&(this.internal.languageSettings.languageCode=t,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Vi=Tt.API,Lc=Vi.getCharWidthsArray=function(t,e){var r,n,s=(e=e||{}).font||this.internal.getFont(),i=e.fontSize||this.internal.getFontSize(),o=e.charSpace||this.internal.getCharSpace(),l=e.widths?e.widths:s.metadata.Unicode.widths,u=l.fof?l.fof:1,d=e.kerning?e.kerning:s.metadata.Unicode.kerning,f=d.fof?d.fof:1,m=e.doKerning!==!1,v=0,p=t.length,b=0,w=l[0]||u,y=[];for(r=0;r<p;r++)n=t.charCodeAt(r),typeof s.metadata.widthOfString=="function"?y.push((s.metadata.widthOfGlyph(s.metadata.characterToGlyph(n))+o*(1e3/i)||0)/1e3):(v=m&&br(d[n])==="object"&&!isNaN(parseInt(d[n][b],10))?d[n][b]/f:0,y.push((l[n]||w)/u+v)),b=n;return y},Ep=Vi.getStringUnitWidth=function(t,e){var r=(e=e||{}).fontSize||this.internal.getFontSize(),n=e.font||this.internal.getFont(),s=e.charSpace||this.internal.getCharSpace();return Vi.processArabic&&(t=Vi.processArabic(t)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(t,r,s)/r:Lc.apply(this,arguments).reduce(function(i,o){return i+o},0)},Op=function(t,e,r,n){for(var s=[],i=0,o=t.length,l=0;i!==o&&l+e[i]<r;)l+=e[i],i++;s.push(t.slice(0,i));var u=i;for(l=0;i!==o;)l+e[i]>n&&(s.push(t.slice(u,i)),l=0,u=i),l+=e[i],i++;return u!==i&&s.push(t.slice(u,i)),s},Ip=function(t,e,r){r||(r={});var n,s,i,o,l,u,d,f=[],m=[f],v=r.textIndent||0,p=0,b=0,w=t.split(" "),y=Lc.apply(this,[" ",r])[0];if(u=r.lineIndent===-1?w[0].length+2:r.lineIndent||0){var j=Array(u).join(" "),O=[];w.map(function(I){(I=I.split(/\s*\n/)).length>1?O=O.concat(I.map(function(H,F){return(F&&H.length?`
`:"")+H})):O.push(I[0])}),w=O,u=Ep.apply(this,[j,r])}for(i=0,o=w.length;i<o;i++){var k=0;if(n=w[i],u&&n[0]==`
`&&(n=n.substr(1),k=1),v+p+(b=(s=Lc.apply(this,[n,r])).reduce(function(I,H){return I+H},0))>e||k){if(b>e){for(l=Op.apply(this,[n,s,e-(v+p),e]),f.push(l.shift()),f=[l.pop()];l.length;)m.push([l.shift()]);b=s.slice(n.length-(f[0]?f[0].length:0)).reduce(function(I,H){return I+H},0)}else f=[n];m.push(f),v=b+u,p=y}else f.push(n),v+=p+b,p=y}return d=u?function(I,H){return(H?j:"")+I.join(" ")}:function(I){return I.join(" ")},m.map(d)},Vi.splitTextToSize=function(t,e,r){var n,s=(r=r||{}).fontSize||this.internal.getFontSize(),i=(function(f){if(f.widths&&f.kerning)return{widths:f.widths,kerning:f.kerning};var m=this.internal.getFont(f.fontName,f.fontStyle);return m.metadata.Unicode?{widths:m.metadata.Unicode.widths||{0:1},kerning:m.metadata.Unicode.kerning||{}}:{font:m.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,r);n=Array.isArray(t)?t:String(t).split(/\r?\n/);var o=1*this.internal.scaleFactor*e/s;i.textIndent=r.textIndent?1*r.textIndent*this.internal.scaleFactor/s:0,i.lineIndent=r.lineIndent;var l,u,d=[];for(l=0,u=n.length;l<u;l++)d=d.concat(Ip.apply(this,[n[l],o,i]));return d},function(t){t.__fontmetrics__=t.__fontmetrics__||{};for(var e="klmnopqrstuvwxyz",r={},n={},s=0;s<e.length;s++)r[e[s]]="0123456789abcdef"[s],n["0123456789abcdef"[s]]=e[s];var i=function(m){return"0x"+parseInt(m,10).toString(16)},o=t.__fontmetrics__.compress=function(m){var v,p,b,w,y=["{"];for(var j in m){if(v=m[j],isNaN(parseInt(j,10))?p="'"+j+"'":(j=parseInt(j,10),p=(p=i(j).slice(2)).slice(0,-1)+n[p.slice(-1)]),typeof v=="number")v<0?(b=i(v).slice(3),w="-"):(b=i(v).slice(2),w=""),b=w+b.slice(0,-1)+n[b.slice(-1)];else{if(br(v)!=="object")throw new Error("Don't know what to do with value type "+br(v)+".");b=o(v)}y.push(p+b)}return y.push("}"),y.join("")},l=t.__fontmetrics__.uncompress=function(m){if(typeof m!="string")throw new Error("Invalid argument passed to uncompress.");for(var v,p,b,w,y={},j=1,O=y,k=[],I="",H="",F=m.length-1,U=1;U<F;U+=1)(w=m[U])=="'"?v?(b=v.join(""),v=void 0):v=[]:v?v.push(w):w=="{"?(k.push([O,b]),O={},b=void 0):w=="}"?((p=k.pop())[0][p[1]]=O,b=void 0,O=p[0]):w=="-"?j=-1:b===void 0?r.hasOwnProperty(w)?(I+=r[w],b=parseInt(I,16)*j,j=1,I=""):I+=w:r.hasOwnProperty(w)?(H+=r[w],O[b]=parseInt(H,16)*j,j=1,b=void 0,H=""):H+=w;return y},u={codePages:["WinAnsiEncoding"],WinAnsiEncoding:l("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},d={Unicode:{Courier:u,"Courier-Bold":u,"Courier-BoldOblique":u,"Courier-Oblique":u,Helvetica:u,"Helvetica-Bold":u,"Helvetica-BoldOblique":u,"Helvetica-Oblique":u,"Times-Roman":u,"Times-Bold":u,"Times-BoldItalic":u,"Times-Italic":u}},f={Unicode:{"Courier-Oblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":l("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":l("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:l("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:l("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":l("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":l("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};t.events.push(["addFont",function(m){var v=m.font,p=f.Unicode[v.postScriptName];p&&(v.metadata.Unicode={},v.metadata.Unicode.widths=p.widths,v.metadata.Unicode.kerning=p.kerning);var b=d.Unicode[v.postScriptName];b&&(v.metadata.Unicode.encoding=b,v.encoding=b.codePages[0])}])}(Tt.API),function(t){var e=function(r){for(var n=r.length,s=new Uint8Array(n),i=0;i<n;i++)s[i]=r.charCodeAt(i);return s};t.API.events.push(["addFont",function(r){var n=void 0,s=r.font,i=r.instance;if(!s.isStandardFont){if(i===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");if(typeof(n=i.existsFileInVFS(s.postScriptName)===!1?i.loadFile(s.postScriptName):i.getFileFromVFS(s.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");(function(o,l){l=/^\x00\x01\x00\x00/.test(l)?e(l):e(Pl(l)),o.metadata=t.API.TTFFont.open(l),o.metadata.Unicode=o.metadata.Unicode||{encoding:{},kerning:{},widths:[]},o.metadata.glyIdsUsed=[0]})(s,n)}}])}(Tt),function(t){function e(){return(Mt.canvg?Promise.resolve(Mt.canvg):Zd(()=>import("./index.es-hE72v8i0.js"),__vite__mapDeps([0,1,2]),import.meta.url)).catch(function(r){return Promise.reject(new Error("Could not load canvg: "+r))}).then(function(r){return r.default?r.default:r})}Tt.API.addSvgAsImage=function(r,n,s,i,o,l,u,d){if(isNaN(n)||isNaN(s))throw Mr.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(i)||isNaN(o))throw Mr.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var f=document.createElement("canvas");f.width=i,f.height=o;var m=f.getContext("2d");m.fillStyle="#fff",m.fillRect(0,0,f.width,f.height);var v={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},p=this;return e().then(function(b){return b.fromString(m,r,v)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(b){return b.render(v)}).then(function(){p.addImage(f.toDataURL("image/jpeg",1),n,s,i,o,u,d)})}}(),Tt.API.putTotalPages=function(t){var e,r=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(t,"g"),r=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(t,this.internal.getFont()),"g"),r=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var s=0;s<this.internal.pages[n].length;s++)this.internal.pages[n][s]=this.internal.pages[n][s].replace(e,r);return this},Tt.API.viewerPreferences=function(t,e){var r;t=t||{},e=e||!1;var n,s,i,o={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},l=Object.keys(o),u=[],d=0,f=0,m=0;function v(b,w){var y,j=!1;for(y=0;y<b.length;y+=1)b[y]===w&&(j=!0);return j}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(o)),this.internal.viewerpreferences.isSubscribed=!1),r=this.internal.viewerpreferences.configuration,t==="reset"||e===!0){var p=l.length;for(m=0;m<p;m+=1)r[l[m]].value=r[l[m]].defaultValue,r[l[m]].explicitSet=!1}if(br(t)==="object"){for(s in t)if(i=t[s],v(l,s)&&i!==void 0){if(r[s].type==="boolean"&&typeof i=="boolean")r[s].value=i;else if(r[s].type==="name"&&v(r[s].valueSet,i))r[s].value=i;else if(r[s].type==="integer"&&Number.isInteger(i))r[s].value=i;else if(r[s].type==="array"){for(d=0;d<i.length;d+=1)if(n=!0,i[d].length===1&&typeof i[d][0]=="number")u.push(String(i[d]-1));else if(i[d].length>1){for(f=0;f<i[d].length;f+=1)typeof i[d][f]!="number"&&(n=!1);n===!0&&u.push([i[d][0]-1,i[d][1]-1].join(" "))}r[s].value="["+u.join(" ")+"]"}else r[s].value=r[s].defaultValue;r[s].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var b,w=[];for(b in r)r[b].explicitSet===!0&&(r[b].type==="name"?w.push("/"+b+" /"+r[b].value):w.push("/"+b+" "+r[b].value));w.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+w.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=r,this},function(t){var e=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',s=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),i=unescape(encodeURIComponent(n)),o=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),l=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),u=unescape(encodeURIComponent("</x:xmpmeta>")),d=i.length+o.length+l.length+s.length+u.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+d+" >>"),this.internal.write("stream"),this.internal.write(s+i+o+l+u),this.internal.write("endstream"),this.internal.write("endobj")},r=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};t.addMetadata=function(n,s){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:s||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",r),this.internal.events.subscribe("postPutResources",e)),this}}(Tt.API),function(t){var e=t.API,r=e.pdfEscape16=function(i,o){for(var l,u=o.metadata.Unicode.widths,d=["","0","00","000","0000"],f=[""],m=0,v=i.length;m<v;++m){if(l=o.metadata.characterToGlyph(i.charCodeAt(m)),o.metadata.glyIdsUsed.push(l),o.metadata.toUnicode[l]=i.charCodeAt(m),u.indexOf(l)==-1&&(u.push(l),u.push([parseInt(o.metadata.widthOfGlyph(l),10)])),l=="0")return f.join("");l=l.toString(16),f.push(d[4-l.length],l)}return f.join("")},n=function(i){var o,l,u,d,f,m,v;for(f=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,u=[],m=0,v=(l=Object.keys(i).sort(function(p,b){return p-b})).length;m<v;m++)o=l[m],u.length>=100&&(f+=`
`+u.length+` beginbfchar
`+u.join(`
`)+`
endbfchar`,u=[]),i[o]!==void 0&&i[o]!==null&&typeof i[o].toString=="function"&&(d=("0000"+i[o].toString(16)).slice(-4),o=("0000"+(+o).toString(16)).slice(-4),u.push("<"+o+"><"+d+">"));return u.length&&(f+=`
`+u.length+` beginbfchar
`+u.join(`
`)+`
endbfchar
`),f+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(i){(function(o){var l=o.font,u=o.out,d=o.newObject,f=o.putStream;if(l.metadata instanceof t.API.TTFFont&&l.encoding==="Identity-H"){for(var m=l.metadata.Unicode.widths,v=l.metadata.subset.encode(l.metadata.glyIdsUsed,1),p="",b=0;b<v.length;b++)p+=String.fromCharCode(v[b]);var w=d();f({data:p,addLength1:!0,objectId:w}),u("endobj");var y=d();f({data:n(l.metadata.toUnicode),addLength1:!0,objectId:y}),u("endobj");var j=d();u("<<"),u("/Type /FontDescriptor"),u("/FontName /"+Ji(l.fontName)),u("/FontFile2 "+w+" 0 R"),u("/FontBBox "+t.API.PDFObject.convert(l.metadata.bbox)),u("/Flags "+l.metadata.flags),u("/StemV "+l.metadata.stemV),u("/ItalicAngle "+l.metadata.italicAngle),u("/Ascent "+l.metadata.ascender),u("/Descent "+l.metadata.decender),u("/CapHeight "+l.metadata.capHeight),u(">>"),u("endobj");var O=d();u("<<"),u("/Type /Font"),u("/BaseFont /"+Ji(l.fontName)),u("/FontDescriptor "+j+" 0 R"),u("/W "+t.API.PDFObject.convert(m)),u("/CIDToGIDMap /Identity"),u("/DW 1000"),u("/Subtype /CIDFontType2"),u("/CIDSystemInfo"),u("<<"),u("/Supplement 0"),u("/Registry (Adobe)"),u("/Ordering ("+l.encoding+")"),u(">>"),u(">>"),u("endobj"),l.objectNumber=d(),u("<<"),u("/Type /Font"),u("/Subtype /Type0"),u("/ToUnicode "+y+" 0 R"),u("/BaseFont /"+Ji(l.fontName)),u("/Encoding /"+l.encoding),u("/DescendantFonts ["+O+" 0 R]"),u(">>"),u("endobj"),l.isAlreadyPutted=!0}})(i)}]),e.events.push(["putFont",function(i){(function(o){var l=o.font,u=o.out,d=o.newObject,f=o.putStream;if(l.metadata instanceof t.API.TTFFont&&l.encoding==="WinAnsiEncoding"){for(var m=l.metadata.rawData,v="",p=0;p<m.length;p++)v+=String.fromCharCode(m[p]);var b=d();f({data:v,addLength1:!0,objectId:b}),u("endobj");var w=d();f({data:n(l.metadata.toUnicode),addLength1:!0,objectId:w}),u("endobj");var y=d();u("<<"),u("/Descent "+l.metadata.decender),u("/CapHeight "+l.metadata.capHeight),u("/StemV "+l.metadata.stemV),u("/Type /FontDescriptor"),u("/FontFile2 "+b+" 0 R"),u("/Flags 96"),u("/FontBBox "+t.API.PDFObject.convert(l.metadata.bbox)),u("/FontName /"+Ji(l.fontName)),u("/ItalicAngle "+l.metadata.italicAngle),u("/Ascent "+l.metadata.ascender),u(">>"),u("endobj"),l.objectNumber=d();for(var j=0;j<l.metadata.hmtx.widths.length;j++)l.metadata.hmtx.widths[j]=parseInt(l.metadata.hmtx.widths[j]*(1e3/l.metadata.head.unitsPerEm));u("<</Subtype/TrueType/Type/Font/ToUnicode "+w+" 0 R/BaseFont/"+Ji(l.fontName)+"/FontDescriptor "+y+" 0 R/Encoding/"+l.encoding+" /FirstChar 29 /LastChar 255 /Widths "+t.API.PDFObject.convert(l.metadata.hmtx.widths)+">>"),u("endobj"),l.isAlreadyPutted=!0}})(i)}]);var s=function(i){var o,l=i.text||"",u=i.x,d=i.y,f=i.options||{},m=i.mutex||{},v=m.pdfEscape,p=m.activeFontKey,b=m.fonts,w=p,y="",j=0,O="",k=b[w].encoding;if(b[w].encoding!=="Identity-H")return{text:l,x:u,y:d,options:f,mutex:m};for(O=l,w=p,Array.isArray(l)&&(O=l[0]),j=0;j<O.length;j+=1)b[w].metadata.hasOwnProperty("cmap")&&(o=b[w].metadata.cmap.unicode.codeMap[O[j].charCodeAt(0)]),o||O[j].charCodeAt(0)<256&&b[w].metadata.hasOwnProperty("Unicode")?y+=O[j]:y+="";var I="";return parseInt(w.slice(1))<14||k==="WinAnsiEncoding"?I=v(y,w).split("").map(function(H){return H.charCodeAt(0).toString(16)}).join(""):k==="Identity-H"&&(I=r(y,b[w])),m.isHex=!0,{text:I,x:u,y:d,options:f,mutex:m}};e.events.push(["postProcessText",function(i){var o=i.text||"",l=[],u={text:o,x:i.x,y:i.y,options:i.options,mutex:i.mutex};if(Array.isArray(o)){var d=0;for(d=0;d<o.length;d+=1)Array.isArray(o[d])&&o[d].length===3?l.push([s(Object.assign({},u,{text:o[d][0]})).text,o[d][1],o[d][2]]):l.push(s(Object.assign({},u,{text:o[d]})).text);i.text=l}else i.text=s(Object.assign({},u,{text:o})).text}])}(Tt),function(t){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};t.existsFileInVFS=function(r){return e.call(this),this.internal.vFS[r]!==void 0},t.addFileToVFS=function(r,n){return e.call(this),this.internal.vFS[r]=n,this},t.getFileFromVFS=function(r){return e.call(this),this.internal.vFS[r]!==void 0?this.internal.vFS[r]:null}}(Tt.API),function(t){t.__bidiEngine__=t.prototype.__bidiEngine__=function(n){var s,i,o,l,u,d,f,m=e,v=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],p=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],b={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},w={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},y=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],j=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),O=!1,k=0;this.__bidiEngine__={};var I=function(P){var L=P.charCodeAt(),te=L>>8,W=w[te];return W!==void 0?m[256*W+(255&L)]:te===252||te===253?"AL":j.test(te)?"L":te===8?"R":"N"},H=function(P){for(var L,te=0;te<P.length;te++){if((L=I(P.charAt(te)))==="L")return!1;if(L==="R")return!0}return!1},F=function(P,L,te,W){var z,V,Y,E,X=L[W];switch(X){case"L":case"R":O=!1;break;case"N":case"AN":break;case"EN":O&&(X="AN");break;case"AL":O=!0,X="R";break;case"WS":X="N";break;case"CS":W<1||W+1>=L.length||(z=te[W-1])!=="EN"&&z!=="AN"||(V=L[W+1])!=="EN"&&V!=="AN"?X="N":O&&(V="AN"),X=V===z?V:"N";break;case"ES":X=(z=W>0?te[W-1]:"B")==="EN"&&W+1<L.length&&L[W+1]==="EN"?"EN":"N";break;case"ET":if(W>0&&te[W-1]==="EN"){X="EN";break}if(O){X="N";break}for(Y=W+1,E=L.length;Y<E&&L[Y]==="ET";)Y++;X=Y<E&&L[Y]==="EN"?"EN":"N";break;case"NSM":if(o&&!l){for(E=L.length,Y=W+1;Y<E&&L[Y]==="NSM";)Y++;if(Y<E){var oe=P[W],de=oe>=1425&&oe<=2303||oe===64286;if(z=L[Y],de&&(z==="R"||z==="AL")){X="R";break}}}X=W<1||(z=L[W-1])==="B"?"N":te[W-1];break;case"B":O=!1,s=!0,X=k;break;case"S":i=!0,X="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":O=!1;break;case"BN":X="N"}return X},U=function(P,L,te){var W=P.split("");return te&&C(W,te,{hiLevel:k}),W.reverse(),L&&L.reverse(),W.join("")},C=function(P,L,te){var W,z,V,Y,E,X=-1,oe=P.length,de=0,A=[],D=k?p:v,J=[];for(O=!1,s=!1,i=!1,z=0;z<oe;z++)J[z]=I(P[z]);for(V=0;V<oe;V++){if(E=de,A[V]=F(P,J,A,V),W=240&(de=D[E][b[A[V]]]),de&=15,L[V]=Y=D[de][5],W>0)if(W===16){for(z=X;z<V;z++)L[z]=1;X=-1}else X=-1;if(D[de][6])X===-1&&(X=V);else if(X>-1){for(z=X;z<V;z++)L[z]=Y;X=-1}J[V]==="B"&&(L[V]=0),te.hiLevel|=Y}i&&function(re,ce,fe){for(var ee=0;ee<fe;ee++)if(re[ee]==="S"){ce[ee]=k;for(var ae=ee-1;ae>=0&&re[ae]==="WS";ae--)ce[ae]=k}}(J,L,oe)},N=function(P,L,te,W,z){if(!(z.hiLevel<P)){if(P===1&&k===1&&!s)return L.reverse(),void(te&&te.reverse());for(var V,Y,E,X,oe=L.length,de=0;de<oe;){if(W[de]>=P){for(E=de+1;E<oe&&W[E]>=P;)E++;for(X=de,Y=E-1;X<Y;X++,Y--)V=L[X],L[X]=L[Y],L[Y]=V,te&&(V=te[X],te[X]=te[Y],te[Y]=V);de=E}de++}}},Q=function(P,L,te){var W=P.split(""),z={hiLevel:k};return te||(te=[]),C(W,te,z),function(V,Y,E){if(E.hiLevel!==0&&f)for(var X,oe=0;oe<V.length;oe++)Y[oe]===1&&(X=y.indexOf(V[oe]))>=0&&(V[oe]=y[X+1])}(W,te,z),N(2,W,L,te,z),N(1,W,L,te,z),W.join("")};return this.__bidiEngine__.doBidiReorder=function(P,L,te){if(function(z,V){if(V)for(var Y=0;Y<z.length;Y++)V[Y]=Y;l===void 0&&(l=H(z)),d===void 0&&(d=H(z))}(P,L),o||!u||d)if(o&&u&&l^d)k=l?1:0,P=U(P,L,te);else if(!o&&u&&d)k=l?1:0,P=Q(P,L,te),P=U(P,L);else if(!o||l||u||d){if(o&&!u&&l^d)P=U(P,L),l?(k=0,P=Q(P,L,te)):(k=1,P=Q(P,L,te),P=U(P,L));else if(o&&l&&!u&&d)k=1,P=Q(P,L,te),P=U(P,L);else if(!o&&!u&&l^d){var W=f;l?(k=1,P=Q(P,L,te),k=0,f=!1,P=Q(P,L,te),f=W):(k=0,P=Q(P,L,te),P=U(P,L),k=1,f=!1,P=Q(P,L,te),f=W,P=U(P,L))}}else k=0,P=Q(P,L,te);else k=l?1:0,P=Q(P,L,te);return P},this.__bidiEngine__.setOptions=function(P){P&&(o=P.isInputVisual,u=P.isOutputVisual,l=P.isInputRtl,d=P.isOutputRtl,f=P.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],r=new t.__bidiEngine__({isInputVisual:!0});t.API.events.push(["postProcessText",function(n){var s=n.text;n.x,n.y;var i=n.options||{};n.mutex,i.lang;var o=[];if(i.isInputVisual=typeof i.isInputVisual!="boolean"||i.isInputVisual,r.setOptions(i),Object.prototype.toString.call(s)==="[object Array]"){var l=0;for(o=[],l=0;l<s.length;l+=1)Object.prototype.toString.call(s[l])==="[object Array]"?o.push([r.doBidiReorder(s[l][0]),s[l][1],s[l][2]]):o.push([r.doBidiReorder(s[l])]);n.text=o}else n.text=r.doBidiReorder(s);r.setOptions({isInputVisual:!0})}])}(Tt),Tt.API.TTFFont=function(){function t(e){var r;if(this.rawData=e,r=this.contents=new $s(e),this.contents.pos=4,r.readString(4)==="ttcf")throw new Error("TTCF not supported.");r.pos=0,this.parse(),this.subset=new Kb(this),this.registerTTF()}return t.open=function(e){return new t(e)},t.prototype.parse=function(){return this.directory=new Fb(this.contents),this.head=new qb(this),this.name=new $b(this),this.cmap=new Vg(this),this.toUnicode={},this.hhea=new Bb(this),this.maxp=new Hb(this),this.hmtx=new Yb(this),this.post=new Wb(this),this.os2=new Ub(this),this.loca=new Jb(this),this.glyf=new Vb(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},t.prototype.registerTTF=function(){var e,r,n,s,i;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var o,l,u,d;for(d=[],o=0,l=(u=this.bbox).length;o<l;o++)e=u[o],d.push(Math.round(e*this.scaleFactor));return d}).call(this),this.stemV=0,this.post.exists?(n=255&(s=this.post.italic_angle),(32768&(r=s>>16))!=0&&(r=-(1+(65535^r))),this.italicAngle=+(r+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(i=this.familyClass)===1||i===2||i===3||i===4||i===5||i===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},t.prototype.characterToGlyph=function(e){var r;return((r=this.cmap.unicode)!=null?r.codeMap[e]:void 0)||0},t.prototype.widthOfGlyph=function(e){var r;return r=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*r},t.prototype.widthOfString=function(e,r,n){var s,i,o,l;for(o=0,i=0,l=(e=""+e).length;0<=l?i<l:i>l;i=0<=l?++i:--i)s=e.charCodeAt(i),o+=this.widthOfGlyph(this.characterToGlyph(s))+n*(1e3/r)||0;return o*(r/1e3)},t.prototype.lineHeight=function(e,r){var n;return r==null&&(r=!1),n=r?this.lineGap:0,(this.ascender+n-this.decender)/1e3*e},t}();var qa,$s=function(){function t(e){this.data=e??[],this.pos=0,this.length=this.data.length}return t.prototype.readByte=function(){return this.data[this.pos++]},t.prototype.writeByte=function(e){return this.data[this.pos++]=e},t.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},t.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},t.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},t.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},t.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},t.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},t.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},t.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},t.prototype.readString=function(e){var r,n;for(n=[],r=0;0<=e?r<e:r>e;r=0<=e?++r:--r)n[r]=String.fromCharCode(this.readByte());return n.join("")},t.prototype.writeString=function(e){var r,n,s;for(s=[],r=0,n=e.length;0<=n?r<n:r>n;r=0<=n?++r:--r)s.push(this.writeByte(e.charCodeAt(r)));return s},t.prototype.readShort=function(){return this.readInt16()},t.prototype.writeShort=function(e){return this.writeInt16(e)},t.prototype.readLongLong=function(){var e,r,n,s,i,o,l,u;return e=this.readByte(),r=this.readByte(),n=this.readByte(),s=this.readByte(),i=this.readByte(),o=this.readByte(),l=this.readByte(),u=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^r)+1099511627776*(255^n)+4294967296*(255^s)+16777216*(255^i)+65536*(255^o)+256*(255^l)+(255^u)+1):72057594037927940*e+281474976710656*r+1099511627776*n+4294967296*s+16777216*i+65536*o+256*l+u},t.prototype.writeLongLong=function(e){var r,n;return r=Math.floor(e/4294967296),n=4294967295&e,this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},t.prototype.readInt=function(){return this.readInt32()},t.prototype.writeInt=function(e){return this.writeInt32(e)},t.prototype.read=function(e){var r,n;for(r=[],n=0;0<=e?n<e:n>e;n=0<=e?++n:--n)r.push(this.readByte());return r},t.prototype.write=function(e){var r,n,s,i;for(i=[],n=0,s=e.length;n<s;n++)r=e[n],i.push(this.writeByte(r));return i},t}(),Fb=function(){var t;function e(r){var n,s,i;for(this.scalarType=r.readInt(),this.tableCount=r.readShort(),this.searchRange=r.readShort(),this.entrySelector=r.readShort(),this.rangeShift=r.readShort(),this.tables={},s=0,i=this.tableCount;0<=i?s<i:s>i;s=0<=i?++s:--s)n={tag:r.readString(4),checksum:r.readInt(),offset:r.readInt(),length:r.readInt()},this.tables[n.tag]=n}return e.prototype.encode=function(r){var n,s,i,o,l,u,d,f,m,v,p,b,w;for(w in p=Object.keys(r).length,u=Math.log(2),m=16*Math.floor(Math.log(p)/u),o=Math.floor(m/u),f=16*p-m,(s=new $s).writeInt(this.scalarType),s.writeShort(p),s.writeShort(m),s.writeShort(o),s.writeShort(f),i=16*p,d=s.pos+i,l=null,b=[],r)for(v=r[w],s.writeString(w),s.writeInt(t(v)),s.writeInt(d),s.writeInt(v.length),b=b.concat(v),w==="head"&&(l=d),d+=v.length;d%4;)b.push(0),d++;return s.write(b),n=2981146554-t(s.data),s.pos=l+8,s.writeUInt32(n),s.data},t=function(r){var n,s,i,o;for(r=Gg.call(r);r.length%4;)r.push(0);for(i=new $s(r),s=0,n=0,o=r.length;n<o;n=n+=4)s+=i.readUInt32();return 4294967295&s},e}(),Rb={}.hasOwnProperty,ns=function(t,e){for(var r in e)Rb.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};qa=function(){function t(e){var r;this.file=e,r=this.file.directory.tables[this.tag],this.exists=!!r,r&&(this.offset=r.offset,this.length=r.length,this.parse(this.file.contents))}return t.prototype.parse=function(){},t.prototype.encode=function(){},t.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},t}();var qb=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return ns(e,qa),e.prototype.tag="head",e.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.revision=r.readInt(),this.checkSumAdjustment=r.readInt(),this.magicNumber=r.readInt(),this.flags=r.readShort(),this.unitsPerEm=r.readShort(),this.created=r.readLongLong(),this.modified=r.readLongLong(),this.xMin=r.readShort(),this.yMin=r.readShort(),this.xMax=r.readShort(),this.yMax=r.readShort(),this.macStyle=r.readShort(),this.lowestRecPPEM=r.readShort(),this.fontDirectionHint=r.readShort(),this.indexToLocFormat=r.readShort(),this.glyphDataFormat=r.readShort()},e.prototype.encode=function(r){var n;return(n=new $s).writeInt(this.version),n.writeInt(this.revision),n.writeInt(this.checkSumAdjustment),n.writeInt(this.magicNumber),n.writeShort(this.flags),n.writeShort(this.unitsPerEm),n.writeLongLong(this.created),n.writeLongLong(this.modified),n.writeShort(this.xMin),n.writeShort(this.yMin),n.writeShort(this.xMax),n.writeShort(this.yMax),n.writeShort(this.macStyle),n.writeShort(this.lowestRecPPEM),n.writeShort(this.fontDirectionHint),n.writeShort(r),n.writeShort(this.glyphDataFormat),n.data},e}(),Mp=function(){function t(e,r){var n,s,i,o,l,u,d,f,m,v,p,b,w,y,j,O,k;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=r+e.readInt(),m=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(u=0;u<256;++u)this.codeMap[u]=e.readByte();break;case 4:for(p=e.readUInt16(),v=p/2,e.pos+=6,i=function(){var I,H;for(H=[],u=I=0;0<=v?I<v:I>v;u=0<=v?++I:--I)H.push(e.readUInt16());return H}(),e.pos+=2,w=function(){var I,H;for(H=[],u=I=0;0<=v?I<v:I>v;u=0<=v?++I:--I)H.push(e.readUInt16());return H}(),d=function(){var I,H;for(H=[],u=I=0;0<=v?I<v:I>v;u=0<=v?++I:--I)H.push(e.readUInt16());return H}(),f=function(){var I,H;for(H=[],u=I=0;0<=v?I<v:I>v;u=0<=v?++I:--I)H.push(e.readUInt16());return H}(),s=(this.length-e.pos+this.offset)/2,l=function(){var I,H;for(H=[],u=I=0;0<=s?I<s:I>s;u=0<=s?++I:--I)H.push(e.readUInt16());return H}(),u=j=0,k=i.length;j<k;u=++j)for(y=i[u],n=O=b=w[u];b<=y?O<=y:O>=y;n=b<=y?++O:--O)f[u]===0?o=n+d[u]:(o=l[f[u]/2+(n-b)-(v-u)]||0)!==0&&(o+=d[u]),this.codeMap[n]=65535&o}e.pos=m}return t.encode=function(e,r){var n,s,i,o,l,u,d,f,m,v,p,b,w,y,j,O,k,I,H,F,U,C,N,Q,P,L,te,W,z,V,Y,E,X,oe,de,A,D,J,re,ce,fe,ee,ae,pe,ye,Le;switch(W=new $s,o=Object.keys(e).sort(function(se,Fe){return se-Fe}),r){case"macroman":for(w=0,y=function(){var se=[];for(b=0;b<256;++b)se.push(0);return se}(),O={0:0},i={},z=0,X=o.length;z<X;z++)O[ae=e[s=o[z]]]==null&&(O[ae]=++w),i[s]={old:e[s],new:O[e[s]]},y[s]=O[e[s]];return W.writeUInt16(1),W.writeUInt16(0),W.writeUInt32(12),W.writeUInt16(0),W.writeUInt16(262),W.writeUInt16(0),W.write(y),{charMap:i,subtable:W.data,maxGlyphID:w+1};case"unicode":for(L=[],m=[],k=0,O={},n={},j=d=null,V=0,oe=o.length;V<oe;V++)O[H=e[s=o[V]]]==null&&(O[H]=++k),n[s]={old:H,new:O[H]},l=O[H]-s,j!=null&&l===d||(j&&m.push(j),L.push(s),d=l),j=s;for(j&&m.push(j),m.push(65535),L.push(65535),Q=2*(N=L.length),C=2*Math.pow(Math.log(N)/Math.LN2,2),v=Math.log(C/2)/Math.LN2,U=2*N-C,u=[],F=[],p=[],b=Y=0,de=L.length;Y<de;b=++Y){if(P=L[b],f=m[b],P===65535){u.push(0),F.push(0);break}if(P-(te=n[P].new)>=32768)for(u.push(0),F.push(2*(p.length+N-b)),s=E=P;P<=f?E<=f:E>=f;s=P<=f?++E:--E)p.push(n[s].new);else u.push(te-P),F.push(0)}for(W.writeUInt16(3),W.writeUInt16(1),W.writeUInt32(12),W.writeUInt16(4),W.writeUInt16(16+8*N+2*p.length),W.writeUInt16(0),W.writeUInt16(Q),W.writeUInt16(C),W.writeUInt16(v),W.writeUInt16(U),fe=0,A=m.length;fe<A;fe++)s=m[fe],W.writeUInt16(s);for(W.writeUInt16(0),ee=0,D=L.length;ee<D;ee++)s=L[ee],W.writeUInt16(s);for(pe=0,J=u.length;pe<J;pe++)l=u[pe],W.writeUInt16(l);for(ye=0,re=F.length;ye<re;ye++)I=F[ye],W.writeUInt16(I);for(Le=0,ce=p.length;Le<ce;Le++)w=p[Le],W.writeUInt16(w);return{charMap:n,subtable:W.data,maxGlyphID:k+1}}},t}(),Vg=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return ns(e,qa),e.prototype.tag="cmap",e.prototype.parse=function(r){var n,s,i;for(r.pos=this.offset,this.version=r.readUInt16(),i=r.readUInt16(),this.tables=[],this.unicode=null,s=0;0<=i?s<i:s>i;s=0<=i?++s:--s)n=new Mp(r,this.offset),this.tables.push(n),n.isUnicode&&this.unicode==null&&(this.unicode=n);return!0},e.encode=function(r,n){var s,i;return n==null&&(n="macroman"),s=Mp.encode(r,n),(i=new $s).writeUInt16(0),i.writeUInt16(1),s.table=i.data.concat(s.subtable),s},e}(),Bb=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return ns(e,qa),e.prototype.tag="hhea",e.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.ascender=r.readShort(),this.decender=r.readShort(),this.lineGap=r.readShort(),this.advanceWidthMax=r.readShort(),this.minLeftSideBearing=r.readShort(),this.minRightSideBearing=r.readShort(),this.xMaxExtent=r.readShort(),this.caretSlopeRise=r.readShort(),this.caretSlopeRun=r.readShort(),this.caretOffset=r.readShort(),r.pos+=8,this.metricDataFormat=r.readShort(),this.numberOfMetrics=r.readUInt16()},e}(),Ub=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return ns(e,qa),e.prototype.tag="OS/2",e.prototype.parse=function(r){if(r.pos=this.offset,this.version=r.readUInt16(),this.averageCharWidth=r.readShort(),this.weightClass=r.readUInt16(),this.widthClass=r.readUInt16(),this.type=r.readShort(),this.ySubscriptXSize=r.readShort(),this.ySubscriptYSize=r.readShort(),this.ySubscriptXOffset=r.readShort(),this.ySubscriptYOffset=r.readShort(),this.ySuperscriptXSize=r.readShort(),this.ySuperscriptYSize=r.readShort(),this.ySuperscriptXOffset=r.readShort(),this.ySuperscriptYOffset=r.readShort(),this.yStrikeoutSize=r.readShort(),this.yStrikeoutPosition=r.readShort(),this.familyClass=r.readShort(),this.panose=function(){var n,s;for(s=[],n=0;n<10;++n)s.push(r.readByte());return s}(),this.charRange=function(){var n,s;for(s=[],n=0;n<4;++n)s.push(r.readInt());return s}(),this.vendorID=r.readString(4),this.selection=r.readShort(),this.firstCharIndex=r.readShort(),this.lastCharIndex=r.readShort(),this.version>0&&(this.ascent=r.readShort(),this.descent=r.readShort(),this.lineGap=r.readShort(),this.winAscent=r.readShort(),this.winDescent=r.readShort(),this.codePageRange=function(){var n,s;for(s=[],n=0;n<2;n=++n)s.push(r.readInt());return s}(),this.version>1))return this.xHeight=r.readShort(),this.capHeight=r.readShort(),this.defaultChar=r.readShort(),this.breakChar=r.readShort(),this.maxContext=r.readShort()},e}(),Wb=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return ns(e,qa),e.prototype.tag="post",e.prototype.parse=function(r){var n,s,i;switch(r.pos=this.offset,this.format=r.readInt(),this.italicAngle=r.readInt(),this.underlinePosition=r.readShort(),this.underlineThickness=r.readShort(),this.isFixedPitch=r.readInt(),this.minMemType42=r.readInt(),this.maxMemType42=r.readInt(),this.minMemType1=r.readInt(),this.maxMemType1=r.readInt(),this.format){case 65536:break;case 131072:var o;for(s=r.readUInt16(),this.glyphNameIndex=[],o=0;0<=s?o<s:o>s;o=0<=s?++o:--o)this.glyphNameIndex.push(r.readUInt16());for(this.names=[],i=[];r.pos<this.offset+this.length;)n=r.readByte(),i.push(this.names.push(r.readString(n)));return i;case 151552:return s=r.readUInt16(),this.offsets=r.read(s);case 196608:break;case 262144:return this.map=(function(){var l,u,d;for(d=[],o=l=0,u=this.file.maxp.numGlyphs;0<=u?l<u:l>u;o=0<=u?++l:--l)d.push(r.readUInt32());return d}).call(this)}},e}(),zb=function(t,e){this.raw=t,this.length=t.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},$b=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return ns(e,qa),e.prototype.tag="name",e.prototype.parse=function(r){var n,s,i,o,l,u,d,f,m,v,p;for(r.pos=this.offset,r.readShort(),n=r.readShort(),u=r.readShort(),s=[],o=0;0<=n?o<n:o>n;o=0<=n?++o:--o)s.push({platformID:r.readShort(),encodingID:r.readShort(),languageID:r.readShort(),nameID:r.readShort(),length:r.readShort(),offset:this.offset+u+r.readShort()});for(d={},o=m=0,v=s.length;m<v;o=++m)i=s[o],r.pos=i.offset,f=r.readString(i.length),l=new zb(f,i),d[p=i.nameID]==null&&(d[p]=[]),d[i.nameID].push(l);this.strings=d,this.copyright=d[0],this.fontFamily=d[1],this.fontSubfamily=d[2],this.uniqueSubfamily=d[3],this.fontName=d[4],this.version=d[5];try{this.postscriptName=d[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=d[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=d[7],this.manufacturer=d[8],this.designer=d[9],this.description=d[10],this.vendorUrl=d[11],this.designerUrl=d[12],this.license=d[13],this.licenseUrl=d[14],this.preferredFamily=d[15],this.preferredSubfamily=d[17],this.compatibleFull=d[18],this.sampleText=d[19]},e}(),Hb=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return ns(e,qa),e.prototype.tag="maxp",e.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.numGlyphs=r.readUInt16(),this.maxPoints=r.readUInt16(),this.maxContours=r.readUInt16(),this.maxCompositePoints=r.readUInt16(),this.maxComponentContours=r.readUInt16(),this.maxZones=r.readUInt16(),this.maxTwilightPoints=r.readUInt16(),this.maxStorage=r.readUInt16(),this.maxFunctionDefs=r.readUInt16(),this.maxInstructionDefs=r.readUInt16(),this.maxStackElements=r.readUInt16(),this.maxSizeOfInstructions=r.readUInt16(),this.maxComponentElements=r.readUInt16(),this.maxComponentDepth=r.readUInt16()},e}(),Yb=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return ns(e,qa),e.prototype.tag="hmtx",e.prototype.parse=function(r){var n,s,i,o,l,u,d;for(r.pos=this.offset,this.metrics=[],n=0,u=this.file.hhea.numberOfMetrics;0<=u?n<u:n>u;n=0<=u?++n:--n)this.metrics.push({advance:r.readUInt16(),lsb:r.readInt16()});for(i=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var f,m;for(m=[],n=f=0;0<=i?f<i:f>i;n=0<=i?++f:--f)m.push(r.readInt16());return m}(),this.widths=(function(){var f,m,v,p;for(p=[],f=0,m=(v=this.metrics).length;f<m;f++)o=v[f],p.push(o.advance);return p}).call(this),s=this.widths[this.widths.length-1],d=[],n=l=0;0<=i?l<i:l>i;n=0<=i?++l:--l)d.push(this.widths.push(s));return d},e.prototype.forGlyph=function(r){return r in this.metrics?this.metrics[r]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[r-this.metrics.length]}},e}(),Gg=[].slice,Vb=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return ns(e,qa),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(r){var n,s,i,o,l,u,d,f,m,v;return r in this.cache?this.cache[r]:(o=this.file.loca,n=this.file.contents,s=o.indexOf(r),(i=o.lengthOf(r))===0?this.cache[r]=null:(n.pos=this.offset+s,l=(u=new $s(n.read(i))).readShort(),f=u.readShort(),v=u.readShort(),d=u.readShort(),m=u.readShort(),this.cache[r]=l===-1?new Qb(u,f,v,d,m):new Gb(u,l,f,v,d,m),this.cache[r]))},e.prototype.encode=function(r,n,s){var i,o,l,u,d;for(l=[],o=[],u=0,d=n.length;u<d;u++)i=r[n[u]],o.push(l.length),i&&(l=l.concat(i.encode(s)));return o.push(l.length),{table:l,offsets:o}},e}(),Gb=function(){function t(e,r,n,s,i,o){this.raw=e,this.numberOfContours=r,this.xMin=n,this.yMin=s,this.xMax=i,this.yMax=o,this.compound=!1}return t.prototype.encode=function(){return this.raw.data},t}(),Qb=function(){function t(e,r,n,s,i){var o,l;for(this.raw=e,this.xMin=r,this.yMin=n,this.xMax=s,this.yMax=i,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],o=this.raw;l=o.readShort(),this.glyphOffsets.push(o.pos),this.glyphIDs.push(o.readUInt16()),32&l;)o.pos+=1&l?4:2,128&l?o.pos+=8:64&l?o.pos+=4:8&l&&(o.pos+=2)}return t.prototype.encode=function(){var e,r,n;for(r=new $s(Gg.call(this.raw.data)),e=0,n=this.glyphIDs.length;e<n;++e)r.pos=this.glyphOffsets[e];return r.data},t}(),Jb=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return ns(e,qa),e.prototype.tag="loca",e.prototype.parse=function(r){var n,s;return r.pos=this.offset,n=this.file.head.indexToLocFormat,this.offsets=n===0?(function(){var i,o;for(o=[],s=0,i=this.length;s<i;s+=2)o.push(2*r.readUInt16());return o}).call(this):(function(){var i,o;for(o=[],s=0,i=this.length;s<i;s+=4)o.push(r.readUInt32());return o}).call(this)},e.prototype.indexOf=function(r){return this.offsets[r]},e.prototype.lengthOf=function(r){return this.offsets[r+1]-this.offsets[r]},e.prototype.encode=function(r,n){for(var s=new Uint32Array(this.offsets.length),i=0,o=0,l=0;l<s.length;++l)if(s[l]=i,o<n.length&&n[o]==l){++o,s[l]=i;var u=this.offsets[l],d=this.offsets[l+1]-u;d>0&&(i+=d)}for(var f=new Array(4*s.length),m=0;m<s.length;++m)f[4*m+3]=255&s[m],f[4*m+2]=(65280&s[m])>>8,f[4*m+1]=(16711680&s[m])>>16,f[4*m]=(4278190080&s[m])>>24;return f},e}(),Kb=function(){function t(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return t.prototype.generateCmap=function(){var e,r,n,s,i;for(r in s=this.font.cmap.tables[0].codeMap,e={},i=this.subset)n=i[r],e[r]=s[n];return e},t.prototype.glyphsFor=function(e){var r,n,s,i,o,l,u;for(s={},o=0,l=e.length;o<l;o++)s[i=e[o]]=this.font.glyf.glyphFor(i);for(i in r=[],s)(n=s[i])!=null&&n.compound&&r.push.apply(r,n.glyphIDs);if(r.length>0)for(i in u=this.glyphsFor(r))n=u[i],s[i]=n;return s},t.prototype.encode=function(e,r){var n,s,i,o,l,u,d,f,m,v,p,b,w,y,j;for(s in n=Vg.encode(this.generateCmap(),"unicode"),o=this.glyphsFor(e),p={0:0},j=n.charMap)p[(u=j[s]).old]=u.new;for(b in v=n.maxGlyphID,o)b in p||(p[b]=v++);return f=function(O){var k,I;for(k in I={},O)I[O[k]]=k;return I}(p),m=Object.keys(f).sort(function(O,k){return O-k}),w=function(){var O,k,I;for(I=[],O=0,k=m.length;O<k;O++)l=m[O],I.push(f[l]);return I}(),i=this.font.glyf.encode(o,w,p),d=this.font.loca.encode(i.offsets,w),y={cmap:this.font.cmap.raw(),glyf:i.table,loca:d,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(r)},this.font.os2.exists&&(y["OS/2"]=this.font.os2.raw()),this.font.directory.encode(y)},t}();Tt.API.PDFObject=function(){var t;function e(){}return t=function(r,n){return(Array(n+1).join("0")+r).slice(-n)},e.convert=function(r){var n,s,i,o;if(Array.isArray(r))return"["+function(){var l,u,d;for(d=[],l=0,u=r.length;l<u;l++)n=r[l],d.push(e.convert(n));return d}().join(" ")+"]";if(typeof r=="string")return"/"+r;if(r?.isString)return"("+r+")";if(r instanceof Date)return"(D:"+t(r.getUTCFullYear(),4)+t(r.getUTCMonth(),2)+t(r.getUTCDate(),2)+t(r.getUTCHours(),2)+t(r.getUTCMinutes(),2)+t(r.getUTCSeconds(),2)+"Z)";if({}.toString.call(r)==="[object Object]"){for(s in i=["<<"],r)o=r[s],i.push("/"+s+" "+e.convert(o));return i.push(">>"),i.join(`
`)}return""+r},e}();const Fp={product_name:""},Pu=({open:t,onClose:e,onSave:r,initialProduct:n,isEditMode:s=!1,loading:i=!1})=>{const[o,l]=_.useState(Fp),[u,d]=_.useState(null),f=Ys(o,300);_.useEffect(()=>{t&&(l({...Fp,...n}),d(null))},[t,n]);const m=b=>{const{name:w,value:y}=b.target;l(j=>({...j,[w]:y}))},v=()=>o.product_name.trim()?(d(null),!0):(d("Product name is required"),!1),p=()=>{v()&&r(o)};return _.useEffect(()=>{},[f,t]),a.jsxs(Sr,{open:t,onClose:e,maxWidth:"sm",fullWidth:!0,children:[a.jsx(Cr,{children:s?"Edit Product":"Add New Product"}),a.jsxs(Pr,{children:[a.jsx(Z,{container:!0,spacing:2,sx:{mt:1},children:a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{name:"product_name",label:"Product Name",value:o.product_name,onChange:m,fullWidth:!0,required:!0,autoFocus:!0})})}),u&&a.jsx("div",{style:{color:"red",marginTop:8},children:u})]}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:e,children:"Cancel"}),a.jsx(Ce,{onClick:p,variant:"contained",disabled:i,children:s?"Save Changes":"Add Product"})]})]})};var il={},Rp;function Xb(){if(Rp)return il;Rp=1;var t=jn();Object.defineProperty(il,"__esModule",{value:!0}),il.default=void 0;var e=t(Cn()),r=Sn();return il.default=(0,e.default)((0,r.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Email"),il}var Zb=Xb();const au=Dr(Zb),Qg=({open:t,onClose:e,type:r,recordId:n,defaultTo:s,defaultSubject:i,defaultMessage:o,allowMessageEdit:l=!0})=>{const{user:u}=Aa(),[d,f]=_.useState(s||""),[m,v]=_.useState(i||""),[p,b]=_.useState(o||""),[w,y]=_.useState(""),[j,O]=_.useState(!1),[k,I]=_.useState(""),[H,F]=_.useState([]),[U,C]=_.useState("");_.useEffect(()=>{t&&(!d||d.trim()==="")&&f(s||"")},[t,s]),_.useEffect(()=>{t&&N()},[t,r]);const N=async()=>{try{const W=await xe.get("/api/email/templates");if(W.data.success){const z=W.data.templates.filter(Y=>Y.type===r);F(z);const V=z.find(Y=>Y.is_default);V&&(C(V.id),v(V.subject),b(V.html_content))}}catch(W){console.error("Error loading templates:",W)}},Q=W=>{if(C(W),W!==""){const z=H.find(V=>V.id===W);z&&(v(z.subject),b(z.html_content))}},P=async()=>{if(r==="custom"){if(!d||!m||!p){I("Please fill in all required fields");return}}else if(!d){I("Please enter a recipient email address");return}O(!0),I("");try{let W="/api/email/send",z={to:d,subject:m,message:p};r!=="custom"&&n&&(W=`/api/email/${r.replace("-","-")}/${n}`,z={to:d,...w&&{customMessage:w}});const V=await xe.post(W,z);V.data.success?(ve.success("Email sent successfully!"),e(),f(""),v(""),b(""),y(""),C("")):I(V.data.message||"Failed to send email")}catch(W){console.error("Error sending email:",W),I(W.response?.data?.message||"Failed to send email")}finally{O(!1)}},L=()=>{j||(e(),I(""))},te=()=>{switch(r){case"sales-order":return"Send Sales Order Email";case"purchase-order":return"Send Purchase Order Email";case"quote":return"Send Quote Email";default:return"Send Email"}};return a.jsxs(Sr,{open:t,onClose:L,maxWidth:"md",fullWidth:!0,children:[a.jsx(Cr,{children:te()}),a.jsx(Pr,{children:a.jsxs(ue,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[r!=="custom"&&H.length>0&&a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"Email Template"}),a.jsxs(sn,{value:U,onChange:W=>Q(W.target.value),label:"Email Template",children:[a.jsx(Jt,{value:"",children:a.jsx("em",{children:"Use default template"})}),H.map(W=>a.jsx(Jt,{value:W.id,children:a.jsxs(ue,{sx:{display:"flex",alignItems:"center",gap:1},children:[W.name,W.is_default&&a.jsx(Zt,{label:"Default",size:"small",color:"secondary"})]})},W.id))]})]}),a.jsx(Oe,{label:"To",value:d,onChange:W=>f(W.target.value),fullWidth:!0,required:!0,type:"email"}),r==="custom"&&a.jsxs(a.Fragment,{children:[a.jsx(Oe,{label:"Subject",value:m,onChange:W=>v(W.target.value),fullWidth:!0,required:!0}),a.jsx(Oe,{label:"Message",value:p,onChange:W=>b(W.target.value),fullWidth:!0,multiline:!0,rows:6,required:!0})]}),r!=="custom"&&l&&a.jsx(Oe,{label:"Additional Message (Optional)",value:w,onChange:W=>y(W.target.value),fullWidth:!0,multiline:!0,rows:4,helperText:"Add a custom message to include with the email"}),k&&a.jsx(Ct,{severity:"error",sx:{mt:2},children:k})]})}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:L,disabled:j,children:"Cancel"}),a.jsx(Ce,{onClick:P,variant:"contained",disabled:j,startIcon:j?a.jsx(pr,{size:20}):void 0,children:j?"Sending...":"Send Email"})]})]})},e5=({emailType:t="custom",recordId:e,defaultTo:r="",defaultSubject:n="",defaultMessage:s="",variant:i="outlined",size:o="medium",startIcon:l,children:u,...d})=>{const[f,m]=_.useState(!1),v=()=>{m(!0)},p=()=>{if(u)return u;switch(t){case"sales-order":return"Email Customer";case"purchase-order":return"Email Vendor";case"quote":return"Email Quote";default:return"Send Email"}},b=()=>l||a.jsx(au,{});return a.jsxs(a.Fragment,{children:[a.jsx(Ce,{variant:i,size:o,startIcon:b(),onClick:v,...d,children:p()}),a.jsx(Qg,{open:f,onClose:()=>m(!1),type:t,recordId:e,defaultTo:r,defaultSubject:n,defaultMessage:s})]})},t5=Fl(),r5=Fl(),n5=()=>{const[t,e]=_.useState([]),[r,n]=_.useState([]),[s,i]=_.useState([]),[o,l]=_.useState(null),[u,d]=_.useState(null),[f,m]=_.useState(!1),[v,p]=_.useState(null),b=Ys(v,300),[w,y]=_.useState(null),[j,O]=_.useState(null),[k,I]=_.useState(""),[H,F]=_.useState(null),[U,C]=_.useState(""),[N,Q]=_.useState(ar()),[P,L]=_.useState(ar()),[te,W]=_.useState(""),[z,V]=_.useState(""),[Y,E]=_.useState(""),[X,oe]=_.useState(""),[de,A]=_.useState(""),[D,J]=_.useState(""),[re,ce]=_.useState(""),[fe,ee]=_.useState({page:0,pageSize:10}),[ae,pe]=_.useState({}),[ye,Le]=_.useState(!1),[se,Fe]=_.useState(""),[ne,R]=_.useState(""),[be,je]=_.useState(""),[Pe,He]=_.useState(""),[Ye,nt]=_.useState(""),[dt,Ae]=_.useState(""),[Re,st]=_.useState(""),[it,Lt]=_.useState(""),[gt,St]=_.useState(""),[ct,Rt]=_.useState(""),[xt,Rr]=_.useState(!1),[tr,rr]=_.useState(""),Pn=Vr(),[Bt,Xr]=_.useState(!1),[sr,Zr]=_.useState(!1);_.useEffect(()=>{xn(),_r(),Pt()},[]),_.useEffect(()=>{y(b??null)},[b]),_.useEffect(()=>{if(console.log("selectedCustomer changed:",j),j?.id){const $e=t.find(ze=>ze.id===j.id)?.email||"";console.log("Found email for selected customer:",$e),ce($e)}else console.log("No selected customer or ID, setting email to empty."),ce("")},[j,t]);const xn=async()=>{try{const ze=(await xe.get("/api/customers")).data.map(ut=>({label:ut.customer_name,id:ut.customer_id,email:ut.email}));console.log("Fetched customers:",ze),e(ze),console.log("Customers state after fetch:",ze)}catch($e){console.error("Error fetching customers:",$e),$e instanceof _n?l($e.response?.data?.message||"Failed to load customers"):l("An unexpected error occurred.")}},_r=async()=>{try{const ze=(await xe.get("/api/products")).data.map(ut=>({label:ut.product_name,id:ut.product_id}));n(ze)}catch($e){console.error("Error fetching products:",$e),$e instanceof _n?l($e.response?.data?.message||"Failed to load products"):l("An unexpected error occurred.")}},Pt=async()=>{try{const ze=(await Xy()).sort((ut,qt)=>{const qr=rt=>{const Je=rt.match(/\d+/);return Je?parseInt(Je[0],10):0},Me=qr(ut.quote_number);return qr(qt.quote_number)-Me});i(ze)}catch{l("Failed to load quotes")}},Kt=()=>{const $e={};(!j||!j.id)&&($e.customer="Customer is required"),N||($e.quoteDate="Quote Date is required"),P||($e.validUntil="Valid Until Date is required"),(!H||!H.label)&&($e.product="Product is required");const ze=parseFloat(te);return(!te||isNaN(ze)||ze<=0)&&($e.estimatedCost="Estimated Cost must be greater than 0"),pe($e),Object.keys($e).length===0},Ln=async()=>{if(!Kt())return;if(!t.some(ut=>ut.id===j?.id)){l("Selected customer is not valid. Please select a customer from the list.");return}const ze={customer_id:j?.id,quote_date:N?.format("YYYY-MM-DD"),valid_until:P?.format("YYYY-MM-DD"),product_id:H?.id,product_name:H?.label,product_description:z,estimated_cost:parseFloat(te),status:"Open",postal_code:ct,terms:Y,customer_po_number:X,vin_number:de};console.log("Saving quote with data:",ze),console.log("Selected customer:",j),console.log("Available customers:",t);try{const ut=await xe.post("/api/quotes",ze);console.log("Quote saved successfully:",ut.data),d("Quote created successfully!"),Pt();const qt=ut.data;y(qt),p(qt),O(t.find(Me=>Me.id===qt.customer_id)||null);const qr=r.find(Me=>Me.label===qt.product_name);F(qr||{label:qt.product_name}),Q(ar(qt.quote_date)),L(ar(qt.valid_until)),W(qt.estimated_cost.toString()),V(qt.product_description||""),E(qt.terms||""),Rt("")}catch(ut){console.error("Error saving quote:",ut),ut instanceof _n&&ut.response?.data?.error?l(`Error creating quote: ${ut.response.data.error}`):l("Failed to save quote")}},ir=()=>{O(null),I(""),F(null),C(""),Q(ar()),L(ar()),W(""),V(""),E(""),oe(""),A(""),pe({}),p(null)},Hr=async $e=>{if(window.confirm("Are you sure you want to delete this quote?"))try{await xe.delete(`/api/quotes/${$e}`),d("Quote deleted successfully!"),Pt()}catch(ze){console.error("Error deleting quote:",ze),ze instanceof _n&&ze.response?.data?.error?l(`Error deleting quote: ${ze.response.data.error}`):l("Failed to delete quote")}},Nn=$e=>{const ze=s.find(ut=>ut.quote_id===$e.id);if(ze){m(!0),y(ze),p(ze),O(t.find(qt=>qt.id===ze.customer_id)||null);const ut=r.find(qt=>qt.label===ze.product_name);F(ut||{label:ze.product_name}),Q(ar(ze.quote_date)),L(ar(ze.valid_until)),W(ze.estimated_cost.toString()),V(ze.product_description||""),E(ze.terms||""),oe(ze.customer_po_number||""),A(ze.vin_number||""),l(null),d(null)}},Nt=async()=>{if(!b||!Kt())return;if(!t.some(ut=>ut.id===j?.id)){l("Selected customer is not valid. Please select a customer from the list.");return}const ze={customer_id:j?.id,quote_date:N?.format("YYYY-MM-DD"),valid_until:P?.format("YYYY-MM-DD"),product_id:H?.id,product_name:H?.label,product_description:z,estimated_cost:parseFloat(te),status:w.status,postal_code:ct,terms:Y,customer_po_number:X,vin_number:de};try{const ut=await xe.put(`/api/quotes/${w.quote_id}`,ze);console.log("Quote updated successfully:",ut.data),d("Quote updated successfully!"),Pt()}catch(ut){console.error("Error updating quote:",ut),ut instanceof _n&&ut.response?.data?.error?l(`Error updating quote: ${ut.response.data.error}`):l("Failed to update quote")}},kn=async $e=>{if(window.confirm(`Are you sure you want to convert Quote ${$e.quote_number} to a Sales Order?`))try{const ze=await xe.post(`/api/quotes/${$e.quote_id}/convert-to-sales-order`);console.log("Quote conversion response:",ze.data),d(ze.data.message||"Quote converted to Sales Order successfully!"),Pt(),ze.data.salesOrder&&ze.data.salesOrder.sales_order_id?(console.log("Navigating to open sales order:",ze.data.salesOrder.sales_order_id),Pn(`/open-sales-orders/${ze.data.salesOrder.sales_order_id}`)):console.log("No salesOrder or sales_order_id in response:",ze.data)}catch(ze){console.error("Error converting quote to sales order:",ze),ze instanceof _n&&ze.response?.data?.error?l(`Error converting quote: ${ze.response.data.error}`):l("Failed to convert quote to sales order")}},Ne=async($e,ze)=>{try{const ut=await xe.get(`/api/quotes/${$e}/pdf`,{responseType:"blob"}),qt=window.URL.createObjectURL(new Blob([ut.data])),qr=document.createElement("a");qr.href=qt,qr.setAttribute("download",`quote_${ze}.pdf`),document.body.appendChild(qr),qr.click(),qr.parentNode?.removeChild(qr)}catch(ut){console.error("Error downloading PDF:",ut),ut instanceof _n&&ut.response?.data?.error?l(`Error downloading PDF: ${ut.response.data.error}`):l("Failed to download PDF")}},Be=async()=>{w&&(await Nt(),!o&&await Ne(w.quote_id,w.quote_number))},Ve=_.useMemo(()=>[{field:"quote_number",headerName:"Quote #",flex:1,minWidth:120},{field:"customer_name",headerName:"Customer",flex:1.2,minWidth:140},{field:"product_name",headerName:"Product",flex:1,minWidth:120},{field:"estimated_cost",headerName:"Est. Price",type:"number",flex:.8,minWidth:100,align:"left",headerAlign:"left"},{field:"quote_date",headerName:"Quote Date",type:"date",flex:.9,minWidth:110,valueGetter:$e=>$e.value?ar($e.value).toDate():null,valueFormatter:$e=>$e.value?ar($e.value).format("YYYY-MM-DD"):""},{field:"valid_until",headerName:"Valid Until",type:"date",flex:.9,minWidth:110,valueGetter:$e=>$e.value?ar($e.value).toDate():null,valueFormatter:$e=>$e.value?ar($e.value).format("YYYY-MM-DD"):""},{field:"actions",headerName:"Actions",width:100,sortable:!1,renderCell:$e=>a.jsx(Kr,{direction:"row",spacing:1,children:a.jsx(jr,{size:"small",color:"error",onClick:ze=>{ze.stopPropagation(),Hr($e.row.quote_id)},children:a.jsx(la,{})})})}],[s,t,r]),Ke=()=>{Le(!1),Fe(""),R(""),je(""),He(""),nt(""),Ae(""),st(""),Lt(""),St(""),Rt("")},$t=()=>{Rr(!1)},kt=()=>{const $e=wi.unparse(s),ze=new Blob([$e],{type:"text/csv;charset=utf-8;"}),ut=document.createElement("a");ut.href=URL.createObjectURL(ze),ut.download=`quotes_${ar().format("YYYY-MM-DD")}.csv`,ut.click()},ur=()=>{const $e=new Tt;$e.autoTable({head:[Ve.map(ze=>ze.headerName)],body:s.map(ze=>Ve.map(ut=>ze[ut.field])),styles:{overflow:"linebreak",cellPadding:2,fontSize:10},columnStyles:{2:{cellWidth:60},3:{cellWidth:80}}}),$e.save(`quotes_${ar().format("YYYY-MM-DD")}.pdf`)},kr=$e=>{if($e.key==="Enter"){$e.preventDefault();const ze=k.trim();if(!ze)return;const ut=t.find(qt=>qt.label.toLowerCase()===ze.toLowerCase());ut?(O(ut),I(ut.label)):(Xr(!0),Fe(ze),Le(!0))}},ln=$e=>{if($e.key==="Enter"){$e.preventDefault();const ze=U.trim();if(!ze)return;const ut=r.find(qt=>qt.label.toLowerCase()===ze.toLowerCase());ut?(F(ut),C(ut.label)):(Zr(!0),rr(ze),Rr(!0))}};return a.jsxs(mi,{dateAdapter:Bl,children:[a.jsx(er,{maxWidth:"xl",sx:{mt:4,mb:4},children:f?a.jsxs(ue,{children:[a.jsxs(ue,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[a.jsx(q,{variant:"h4",component:"h1",gutterBottom:!0,children:w?`Edit Quote${w.quote_number?`: ${w.quote_number}`:""}`:"New Quote"}),a.jsxs(ue,{sx:{display:"flex",gap:2},children:[a.jsx(Ce,{variant:"contained",color:"primary",onClick:w?Nt:Ln,startIcon:a.jsx(Vs,{}),children:w?"Save Changes":"Save Quote"}),w&&a.jsxs(a.Fragment,{children:[a.jsx(Ce,{variant:"contained",color:"primary",onClick:()=>kn(w),children:"Convert to SO"}),a.jsx(Ce,{variant:"contained",color:"primary",onClick:Be,startIcon:a.jsx($r,{}),children:"Download PDF"}),console.log("Rendering EmailButton with defaultTo:",re,"for selectedCustomer:",j),a.jsx(e5,{emailType:"quote",recordId:w.quote_id,defaultTo:re,variant:"contained",size:"medium",sx:{backgroundColor:"#ff9800","&:hover":{backgroundColor:"#f57c00"}},children:"Email Quote"})]})]})]}),a.jsx(uo,{open:!!u,autoHideDuration:6e3,onClose:()=>d(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:a.jsx(Ct,{onClose:()=>d(null),severity:"success",sx:{width:"100%"},children:u})}),a.jsx(uo,{open:!!o,autoHideDuration:6e3,onClose:()=>l(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:a.jsx(Ct,{onClose:()=>l(null),severity:"error",sx:{width:"100%"},children:o})}),a.jsx(At,{sx:{p:3,mb:3},children:a.jsxs(Z,{container:!0,spacing:3,children:[a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(sa,{value:j,onChange:($e,ze)=>{if(Bt){Xr(!1);return}ze&&ze.isNew?(Le(!0),Fe(k),O(null),I("")):O(ze),pe(ut=>({...ut,customer:void 0}))},filterOptions:($e,ze)=>{const ut=t5($e,ze);return ze.inputValue!==""&&!t.some(qt=>qt.label.toLowerCase()===ze.inputValue.toLowerCase())&&ut.push({label:`Add "${ze.inputValue}" as New Customer`,isNew:!0}),ut},inputValue:k,onInputChange:($e,ze)=>I(ze),options:t,getOptionLabel:$e=>typeof $e=="string"?$e:$e.label,isOptionEqualToValue:($e,ze)=>$e.id===ze.id,renderInput:$e=>a.jsx(Oe,{...$e,label:"Customer",variant:"outlined",required:!0,error:!!ae.customer,helperText:ae.customer,onKeyDown:kr})})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"Customer PO #",variant:"outlined",fullWidth:!0,value:v?v.customer_po_number??"":X,onChange:$e=>{v?p(ze=>ze?{...ze,customer_po_number:$e.target.value}:null):oe($e.target.value)},placeholder:"Optional"})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"Estimated Price",type:"number",variant:"outlined",fullWidth:!0,required:!0,value:v?v.estimated_cost!=null?String(v.estimated_cost):"":te,onChange:$e=>{v&&p(ze=>ze?{...ze,estimated_cost:parseFloat($e.target.value)||0}:null),W($e.target.value),pe(ze=>({...ze,estimatedCost:void 0}))},error:!!ae.estimatedCost,helperText:ae.estimatedCost,InputProps:{startAdornment:a.jsx(Bn,{position:"start",children:"$"})}})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(sa,{value:H,onChange:($e,ze)=>{if(sr){Zr(!1);return}ze&&ze.isNew?(Rr(!0),F(null),C("")):F(ze),pe(ut=>({...ut,product:void 0}))},filterOptions:($e,ze)=>{const ut=r5($e,ze);return ze.inputValue!==""&&!r.some(qt=>qt.label.toLowerCase()===ze.inputValue.toLowerCase())&&ut.push({label:`Add "${ze.inputValue}" as New Product`,isNew:!0}),ut},inputValue:U,onInputChange:($e,ze)=>C(ze),options:r,getOptionLabel:$e=>typeof $e=="string"?$e:$e.label,isOptionEqualToValue:($e,ze)=>$e.id===ze.id,renderInput:$e=>a.jsx(Oe,{...$e,label:"Product",variant:"outlined",required:!0,error:!!ae.product,helperText:ae.product,onKeyDown:ln})})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(Oe,{label:"VIN #",variant:"outlined",fullWidth:!0,value:v?v.vin_number??"":de,onChange:$e=>{v?p(ze=>ze?{...ze,vin_number:$e.target.value}:null):A($e.target.value)},placeholder:"Optional"})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(ho,{label:"Quote Date",value:N,onChange:$e=>{Q($e),pe(ze=>({...ze,quoteDate:void 0}))},slotProps:{textField:{fullWidth:!0}}})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsx(ho,{label:"Valid Until",value:P,onChange:$e=>{L($e),pe(ze=>({...ze,validUntil:void 0}))},slotProps:{textField:{fullWidth:!0}}})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{label:"Product Description",variant:"outlined",fullWidth:!0,multiline:!0,rows:4,value:v?v.product_description??"":z,onChange:$e=>{v&&p(ze=>ze?{...ze,product_description:$e.target.value}:null),V($e.target.value)}})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{label:"Terms and Conditions",variant:"outlined",fullWidth:!0,multiline:!0,rows:4,value:v?v.terms??"":Y,onChange:$e=>{v&&p(ze=>ze?{...ze,terms:$e.target.value}:null),E($e.target.value)}})})]})})]}):a.jsxs(a.Fragment,{children:[a.jsxs(ue,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[a.jsx(q,{variant:"h4",component:"h1",gutterBottom:!0,children:"Quotes"}),a.jsxs(Kr,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[a.jsx(Ce,{variant:"contained",color:"primary",startIcon:a.jsx(ka,{}),onClick:()=>{m(!0),y(null),ir()},children:"New Quote"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:kt,children:"Export CSV"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:ur,children:"Export PDF"})]})]}),a.jsxs(At,{sx:{width:"100%",overflow:"hidden",mb:3},children:[a.jsx(ue,{sx:{p:2},children:a.jsx(Oe,{fullWidth:!0,variant:"outlined",placeholder:"Search quotes...",value:D,onChange:$e=>J($e.target.value),InputProps:{startAdornment:a.jsx(Bn,{position:"start",children:a.jsx(rs,{})})}})}),a.jsx(es,{rows:s,columns:Ve,getRowId:$e=>$e.quote_id,paginationModel:fe,onPaginationModelChange:ee,pageSizeOptions:[10,20,50],disableRowSelectionOnClick:!0,onRowClick:$e=>Nn($e),initialState:{sorting:{sortModel:[{field:"quote_number",sort:"desc"}]}},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})]})}),a.jsx(Ul,{open:ye,onClose:Ke,onSave:async $e=>{try{const ut=(await xe.post("/api/customers",$e)).data.customer_id,qt={label:$e.customer_name,id:ut};e(qr=>[...qr,qt]),O(qt),Ke(),d("Customer added successfully!")}catch{l("Failed to add customer.")}},initialCustomer:{customer_name:se},isEditMode:!1}),a.jsx(Pu,{open:xt,onClose:$t,onSave:async $e=>{try{const ze=await xe.post("/api/products",$e),ut={label:$e.product_name,id:ze.data.product_id};n(qt=>[...qt,ut]),F(ut),$t(),d("Product added successfully!")}catch{l("Failed to add product.")}},initialProduct:{product_name:tr||U},isEditMode:!1})]})},a5=()=>{const[t,e]=_.useState([]),[r,n]=_.useState(!0),[s,i]=_.useState({page:0,pageSize:10});_.useEffect(()=>{o()},[]);const o=async()=>{try{const d=await xe.get("/api/quotes");e(d.data)}catch(d){console.error("Error fetching quotes:",d)}finally{n(!1)}},l=()=>{window.open("/api/quotes/export/pdf","_blank")},u=[{field:"quote_number",headerName:"Quote #",flex:1},{field:"customer_name",headerName:"Customer",flex:1},{field:"product_name",headerName:"Product",flex:1},{field:"estimated_cost",headerName:"Estimated Price",flex:1,type:"number",valueFormatter:d=>`$${(d.value||0).toFixed(2)}`}];return a.jsxs(er,{maxWidth:"xl",sx:{mt:4,mb:4},children:[a.jsxs(ue,{sx:{mb:4},children:[a.jsx(q,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontSize:"1.2rem"},children:"Quote History"}),a.jsx(Kr,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:l,children:"Download PDF"})})]}),a.jsx(At,{sx:{width:"100%",overflow:"hidden"},children:a.jsx(es,{rows:t,columns:u,loading:r,paginationModel:s,onPaginationModelChange:i,pageSizeOptions:[10,25,50],getRowId:d=>d.quote_id,sx:{cursor:"pointer","& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1rem"}},autoHeight:!0})})]})},s5=()=>{const t=Vr(),e=()=>{t("/open-purchase-orders/new")},r=()=>{t("/open-purchase-orders")};return a.jsx(er,{maxWidth:"md",children:a.jsxs(ue,{sx:{my:4},children:[a.jsx(q,{variant:"h4",component:"h1",gutterBottom:!0,children:"Purchase Order Management"}),a.jsxs(At,{sx:{p:3},children:[a.jsxs(q,{variant:"body1",sx:{mb:3},children:["Welcome to Purchase Order Management. Here you can create new purchase orders or view existing ones.",a.jsx("br",{}),a.jsx("b",{children:"Note:"})," GST rate is customizable per order (default 5%)."]}),a.jsxs(ue,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[a.jsx(Ce,{variant:"contained",color:"primary",onClick:e,children:"Create New Purchase Order"}),a.jsx(Ce,{variant:"outlined",color:"primary",onClick:r,children:"View Purchase Orders"})]})]})]})})},Th=(t,e)=>{const r=parseFloat(String(t))||0,n=parseFloat(String(e))||0;return Math.round(r*n*100)/100},su=(t,e=5)=>{const r=t.reduce((i,o)=>{const l=Th(o.quantity,o.unit_price);return i+l},0),n=r*(e/100),s=r+n;return{subtotal:Math.round(r*100)/100,total_gst_amount:Math.round(n*100)/100,total_amount:Math.round(s*100)/100}},i5=t=>{const e={};t.part_number?.trim()||(e.part_number="Part Number is required"),t.part_description?.trim()||(e.part_description="Part Description is required");const r=parseFloat(String(t.quantity));(isNaN(r)||r<=0)&&(e.quantity="Quantity must be greater than 0");const n=parseFloat(String(t.unit_price));return(isNaN(n)||n<=0)&&(e.unit_price="Unit Price must be greater than 0"),e},o5=(t,e,r,n)=>{const s={};e||(s.customer="Customer is required"),r||(s.product="Product is required"),n||(s.salesDate="Sales Date is required");const i=t.map(i5);return i.some(l=>Object.keys(l).length>0)&&(s.lineItems=i),s},Vn=t=>{const e=parseFloat(String(t));return isNaN(e)?0:e},Pd=["Each","cm","ft","kg","pcs","hr","L"],ii=5,l5=Fl(),c5=Fl(),u5=()=>{const t=Vr(),[e,r]=_.useState(null),[n,s]=_.useState(""),[i,o]=_.useState(ar()),[l,u]=_.useState([]),[d,f]=_.useState([]),m=Ys(d,300),[v,p]=_.useState([]),[b,w]=_.useState([]),[y,j]=_.useState([]),[O,k]=_.useState(!1),[I,H]=_.useState(""),[F,U]=_.useState(null),[C,N]=_.useState(""),[Q,P]=_.useState(""),[L,te]=_.useState(""),[W,z]=_.useState(""),[V,Y]=_.useState(""),[E,X]=_.useState([]),[oe,de]=_.useState(!1),[A,D]=_.useState(null),[J,re]=_.useState(""),[ce,fe]=_.useState(null),[ee,ae]=_.useState(null),[pe,ye]=_.useState(null),[Le,se]=_.useState(null),[Fe,ne]=_.useState(!1),[R,be]=_.useState([]),[je,Pe]=_.useState(null),[He,Ye]=_.useState(!1),[nt,dt]=_.useState(!1),[Ae,Re]=_.useState(null);_.useEffect(()=>{(async()=>{try{const Ve=(await xe.get("/api/customers")).data.map(Ke=>({label:Ke.customer_name,id:Ke.customer_id}));u(Ve)}catch(Be){console.error("Error fetching customers:",Be)}})()},[]),_.useEffect(()=>{(async()=>{try{const Be=await xe.get("/api/margin-schedule");w(Be.data)}catch(Be){console.error("Error fetching margin schedule:",Be)}})()},[]),_.useEffect(()=>{(async()=>{try{const Be=await xe.get("/api/inventory");j(Be.data),console.log("Fetched inventory items:",Be.data)}catch(Be){console.error("Error fetching inventory:",Be)}})()},[]),_.useEffect(()=>{(async()=>{try{const Ve=(await xe.get("/api/products")).data.map(Ke=>({label:Ke.product_name,id:Ke.product_id,description:Ke.product_description}));X(Ve)}catch(Be){console.error("Error fetching products:",Be)}})()},[]),_.useEffect(()=>{(async()=>{try{const Be=await xe.get("/api/settings/labour-rate");ae(Be.data.labour_rate??null)}catch{ae(null)}})()},[]),_.useEffect(()=>{(async()=>{try{const Be=await xe.get("/api/settings/overhead-rate");ye(Be.data.overhead_rate??null)}catch{ye(null)}})()},[]),_.useEffect(()=>{(async()=>{try{const Be=await xe.get("/api/settings/supply-rate");se(Be.data.supply_rate??null)}catch{se(null)}})()},[]),_.useEffect(()=>{ee!==null&&p(Ne=>Ne.map(Be=>Be.part_number==="LABOUR"?{...Be,unit_price:ee}:Be))},[ee]),_.useEffect(()=>{pe!==null&&p(Ne=>Ne.map(Be=>Be.part_number==="OVERHEAD"?{...Be,unit_price:pe}:Be))},[pe]),_.useEffect(()=>{Le!==null&&Le>0?p(Ne=>{const Be=Ne.some(Ke=>Ke.part_number==="LABOUR"),Ve=Ne.some(Ke=>Ke.part_number==="SUPPLY");return Be&&!Ve?[...Ne,{part_number:"SUPPLY",part_description:"Supply",quantity:"",unit:"",unit_price:0,gst:ii,line_amount:0}]:!Be&&Ve?Ne.filter(Ke=>Ke.part_number!=="SUPPLY"):Ne}):p(Ne=>Ne.filter(Be=>Be.part_number!=="SUPPLY"))},[Le,v]),_.useEffect(()=>{Le!==null&&Le>0&&p(Ne=>{const Be=Ne.find(Ke=>Ke.part_number==="LABOUR"),Ve=Ne.find(Ke=>Ke.part_number==="SUPPLY");if(Be&&Ve){const $t=parseFloat(Be.line_amount?.toString()||"0")*(Le/100);return Ne.map(kt=>kt.part_number==="SUPPLY"?{...kt,line_amount:$t}:kt)}return Ne})},[Le,v]);const st=Ne=>{const Be=[...b].sort((Ve,Ke)=>Ve.cost_lower_bound-Ke.cost_lower_bound);for(const Ve of Be){const Ke=parseFloat(String(Ve.cost_lower_bound)),$t=parseFloat(String(Ve.cost_upper_bound)),kt=parseFloat(String(Ve.margin_factor));if(Ne>=Ke&&(Ne<$t||$t===null)||$t===null&&Ne>=Ke)return kt}return console.warn("No margin schedule found for cost:",Ne,"Returning factor of 1."),1},[it,Lt]=_.useState({}),gt=_.useMemo(()=>m.map(Ne=>({part_number:Ne.part_number,part_description:Ne.part_description,quantity:Vn(Ne.quantity),unit:Ne.unit,unit_price:Vn(Ne.unit_price)})),[m]),St=_.useMemo(()=>su(gt,ii),[gt]),ct=St.subtotal,Rt=St.total_gst_amount,xt=St.total_amount,Rr=(Ne,Be,Ve)=>{f(Ke=>{const $t=[...Ke],kt={...$t[Ne],[Be]:Ve};if(parseFloat(Ve)<=0&&kt.part_number!=="LABOUR"&&kt.part_number!=="OVERHEAD")return $t.filter((ln,$e)=>$e!==Ne);const ur=Vn(kt.quantity),kr=Vn(kt.unit_price);return kt.line_amount=Th(ur,kr),$t[Ne]=kt,$t})},tr=Ne=>y.find(Be=>Be.part_number===Ne),rr=(Ne,Be)=>{f(Ve=>{const Ke=[...Ve];if(Be===null||Be.trim()==="")Ke[Ne]={...Ke[Ne],part_number:"",part_description:"",quantity:"",unit:Pd[0],unit_price:0,line_amount:0};else if(Be.toUpperCase()==="LABOUR")Ke[Ne]={...Ke[Ne],part_number:"LABOUR",part_description:"Labour",unit:"hr",unit_price:ee??0};else if(Be.toUpperCase()==="OVERHEAD")Ke[Ne]={...Ke[Ne],part_number:"OVERHEAD",part_description:"Overhead",unit:"hr",unit_price:pe??0};else if(Be.toUpperCase()==="SUPPLY")Ke[Ne]={...Ke[Ne],part_number:"SUPPLY",part_description:"Supply",unit:"",unit_price:0};else{const $t=tr(Be);if($t){const kt=parseFloat(String($t.last_unit_cost))||0,ur=st(kt),kr=kt*ur;Ke[Ne]={...Ke[Ne],part_number:Be,part_description:$t.part_description||"",unit:$t.unit,unit_price:kr}}else Ke[Ne]={...Ke[Ne],part_number:Be,part_description:"Part not found",unit_price:0}}return Ke})},Pn=()=>{p(Ne=>[...Ne,{part_number:"",part_description:"",quantity:"",unit:Pd[0],unit_price:0,gst:ii,line_amount:0}])},Bt=(Ne,Be)=>{if(Ne.part_number==="LABOUR"||Ne.part_number==="OVERHEAD"||Ne.part_number==="SUPPLY")return null;const Ve=y.find(kr=>kr.part_number.toLowerCase()===Ne.part_number.toLowerCase());if(!Ve||Ve.part_type==="supply")return null;const Ke=parseFloat(Ve.quantity_on_hand)||0,kt=parseFloat(Ne.quantity)||0,ur=Ke-kt;return{available:ur,currentStock:Ke,changeInQuantity:kt,isNegative:ur<0}},Xr=Ne=>{Re(Ne),dt(!0)},sr=()=>{Ae!==null&&(p(Ne=>Ne.filter((Be,Ve)=>Ve!==Ae)),dt(!1),Re(null))},Zr=()=>{dt(!1),Re(null)},xn=()=>{const Ne=v.map(kt=>({part_number:kt.part_number,part_description:kt.part_description,quantity:Vn(kt.quantity),unit:kt.unit,unit_price:Vn(kt.unit_price)})),Be=v.filter(kt=>{if(kt.part_number==="LABOUR"||kt.part_number==="OVERHEAD"||kt.part_number==="SUPPLY")return!1;const ur=y.find(kr=>kr.part_number===kt.part_number);return!ur||ur.part_type==="supply"});let Ve=o5(Ne,e,F,i);Be.length>0&&(Ve={...Ve,lineItems:(Ve.lineItems||[]).map((kt,ur)=>{const kr=y.find(ln=>ln.part_number===v[ur].part_number);if(kr){if(kr.part_type==="supply")return{...kt,part_number:"Supply parts are not allowed in sales orders"}}else return{...kt,part_number:"Invalid part number"};return kt})});let Ke="";const $t=v.filter(kt=>{if(kt.part_number==="LABOUR"||kt.part_number==="OVERHEAD"||kt.part_number==="SUPPLY")return!1;const ur=y.find($e=>$e.part_number===kt.part_number),kr=Vn(kt.quantity),ln=ur?Vn(ur.quantity_on_hand):null;return ur&&ur.part_type!=="supply"&&kr>ln});return $t.length>0&&(Ke=$t.map(kt=>`Insufficient inventory for part ${kt.part_number} (requested: ${kt.quantity}, available: ${y.find(ur=>ur.part_number===kt.part_number)?.quantity_on_hand??0})`).join(`
`)),Ke?(fe(Ke),!1):(Lt(Ve),Object.keys(Ve).length===0&&Be.length===0)},_r=async()=>{if(!xn())return;const Ne=su(gt,ii);Ne.subtotal,Ne.total_gst_amount,Ne.total_amount;const Be={customer_id:e?.id,sales_date:i?i.toISOString():new Date().toISOString(),product_name:F?.label?.trim(),product_description:Q.trim(),terms:L.trim(),customer_po_number:W.trim(),vin_number:V.trim(),subtotal:ct!=null?Number(ct):0,total_gst_amount:Rt!=null?Number(Rt):0,total_amount:xt!=null?Number(xt):0,status:"Open",estimated_cost:A!=null?Number(A):0,lineItems:v.map(Ve=>({part_number:Ve.part_number.trim(),part_description:Ve.part_description.trim(),quantity_sold:Ve.quantity!==void 0&&Ve.quantity!==null&&Ve.quantity!==""?Math.round(Number(Ve.quantity)):0,unit:Ve.unit.trim(),unit_price:Ve.unit_price!=null?Number(Ve.unit_price):0,line_amount:Ve.line_amount!=null?Number(Ve.line_amount):0}))};try{console.log("Saving sales order:",Be);const Ve=await xe.post("/api/sales-orders",Be);console.log("Sales order created:",Ve.data),ve.success("Sales Order created successfully!"),fe(null),t(`/open-sales-orders/${Ve.data.sales_order_id}`)}catch(Ve){let Ke="Failed to save sales order.";Ve.response?.data?.error?Ke=Ve.response.data.error:Ve.response?.data?.details?Ke=Ve.response.data.details:Ve.response?.data?.message&&(Ke=Ve.response.data.message),fe(Ke)}},Pt=()=>{r(null),s(""),o(ar()),U(null),N(""),P(""),te(""),z(""),Y(""),D(null),p([{part_number:"",part_description:"",quantity:"",unit:Pd[0],unit_price:0,gst:ii,line_amount:0}]),Lt({})},Kt=()=>{k(!1),H("")},Ln=()=>{de(!1),D(null)},ir=Ne=>{if(Ne.key==="Enter"){Ne.preventDefault();const Be=n.trim();if(!Be)return;const Ve=l.find(Ke=>Ke.label.toLowerCase()===Be.toLowerCase());Ve?(r(Ve),s(Ve.label)):(H(Be),k(!0))}},Hr=Ne=>{if(Ne.key==="Enter"){Ne.preventDefault();const Be=C.trim();if(!Be)return;const Ve=E.find(Ke=>Ke.label.toLowerCase()===Be.toLowerCase());Ve?(U(Ve),N(Ve.label)):(re(Be),de(!0))}},Nn=async()=>{Ye(!0);try{const Ne=await xe.get("/api/sales-orders");be(Ne.data)}catch{ve.error("Failed to fetch sales orders for import")}finally{Ye(!1)}},Nt=()=>{ne(!0),Nn()},kn=async()=>{if(je){Ye(!0);try{const Ne=await xe.get(`/api/sales-orders/${je.sales_order_id}`),Ve=(Ne.data.lineItems||Ne.data.salesOrder?.line_items||[]).filter(Ke=>(Ke.part_number||"").toUpperCase()!=="LABOUR");p(Ve.map(Ke=>({part_number:Ke.part_number,part_description:Ke.part_description,quantity:String(Ke.quantity),unit:Ke.unit,unit_price:Ke.unit_price,gst:Ke.gst??ii,line_amount:Ke.line_amount}))),f(Ve.map(Ke=>({part_number:Ke.part_number,part_description:Ke.part_description,quantity:String(Ke.quantity),unit:Ke.unit,unit_price:Ke.unit_price,gst:Ke.gst??ii,line_amount:Ke.line_amount}))),ne(!1),Pe(null),ve.success("Line items imported!")}catch{ve.error("Failed to import line items")}finally{Ye(!1)}}};return a.jsx(mi,{dateAdapter:Bl,children:a.jsxs(er,{maxWidth:"lg",sx:{mt:4,mb:4},children:[a.jsxs(ue,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[a.jsx(q,{variant:"h4",component:"h1",gutterBottom:!0,children:"Create Sales Order"}),a.jsxs(Kr,{direction:"row",spacing:1,children:[a.jsx(Ce,{variant:"outlined",onClick:Pt,children:"Reset"}),a.jsx(Ce,{variant:"contained",onClick:_r,startIcon:a.jsx(Vs,{}),children:"Save Sales Order"})]})]}),a.jsx(ue,{sx:{mb:2},children:a.jsx(Ce,{variant:"outlined",color:"secondary",onClick:Nt,children:"Import Line Items"})}),a.jsxs(Sr,{open:Fe,onClose:()=>ne(!1),maxWidth:"sm",fullWidth:!0,children:[a.jsx(Cr,{children:"Import Line Items from Sales Order"}),a.jsx(Pr,{children:He?a.jsx(ue,{display:"flex",alignItems:"center",justifyContent:"center",minHeight:120,children:a.jsx(pr,{})}):a.jsx(sa,{options:R,getOptionLabel:Ne=>{if(!Ne)return"";const Be=Ne.sales_order_number||"",Ve=Ne.customer_name||"",Ke=Ne.status||"";return`${Be} - ${Ve}${Ke?` (${Ke})`:""}`},value:je,onChange:(Ne,Be)=>Pe(Be),renderInput:Ne=>a.jsx(Oe,{...Ne,label:"Select Sales Order",fullWidth:!0}),isOptionEqualToValue:(Ne,Be)=>Ne.sales_order_id===Be?.sales_order_id})}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:()=>ne(!1),children:"Cancel"}),a.jsx(Ce,{onClick:kn,disabled:!je||He,variant:"contained",children:"Import"})]})]}),ce&&a.jsxs(Ct,{severity:"warning",sx:{mb:3},onClose:()=>fe(null),children:[a.jsx(q,{variant:"body1",sx:{fontWeight:"medium"},children:"Inventory Error"}),a.jsx(q,{variant:"body2",children:ce})]}),a.jsx(At,{sx:{p:3,mb:3},elevation:3,children:a.jsxs(Z,{container:!0,spacing:3,children:[a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(sa,{value:e,onChange:(Ne,Be)=>{typeof Be=="string"?r({label:Be,isNew:!0}):Be&&Be.isNew?(k(!0),H(n),r(null),s("")):r(Be)},inputValue:n,onInputChange:(Ne,Be)=>s(Be),filterOptions:(Ne,Be)=>{const Ve=l5(Ne,Be);return Be.inputValue!==""&&!Ve.some(Ke=>Ke.label===Be.inputValue)&&Ve.push({label:`Add "${Be.inputValue}"`,isNew:!0}),Ve},options:l,getOptionLabel:Ne=>typeof Ne=="string"?Ne:Ne.label,renderInput:Ne=>a.jsx(Oe,{...Ne,label:"Customer",fullWidth:!0,required:!0,error:!!it.customer,helperText:it.customer,onKeyDown:ir})})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"Customer PO #",value:W,onChange:Ne=>z(Ne.target.value),fullWidth:!0,placeholder:"Optional"})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"Estimated Price",type:"number",value:A??"",onChange:Ne=>D(Ne.target.value?parseFloat(Ne.target.value):null),fullWidth:!0,InputProps:{startAdornment:a.jsx(Bn,{position:"start",children:"$"})},inputProps:{onWheel:Ne=>Ne.currentTarget.blur()}})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(sa,{value:F,onChange:(Ne,Be)=>{Be&&Be.isNew?(de(!0),re(C),U(null),N("")):U(Be)},inputValue:C,onInputChange:(Ne,Be)=>N(Be),filterOptions:(Ne,Be)=>{const Ve=c5(Ne,Be);return Be.inputValue!==""&&!Ve.some(Ke=>Ke.label===Be.inputValue)&&Ve.push({label:`Add "${Be.inputValue}"`,isNew:!0,description:""}),Ve},options:E,getOptionLabel:Ne=>typeof Ne=="string"?Ne:Ne.label,renderInput:Ne=>a.jsx(Oe,{...Ne,label:"Product Name",fullWidth:!0,required:!0,error:!!it.product,helperText:it.product,onKeyDown:Hr})})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"VIN #",value:V,onChange:Ne=>Y(Ne.target.value),fullWidth:!0,placeholder:"Optional"})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(ho,{label:"Sales Date",value:i,onChange:Ne=>o(Ne),sx:{width:"100%"},slotProps:{textField:{required:!0,error:!!it.salesDate,helperText:it.salesDate}}})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{label:"Product Description",value:Q,onChange:Ne=>P(Ne.target.value),fullWidth:!0,multiline:!0,minRows:2,maxRows:6,sx:{mt:1}})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{label:"Terms",value:L,onChange:Ne=>te(Ne.target.value),fullWidth:!0,multiline:!0,minRows:3,maxRows:8,sx:{mt:1},placeholder:"Enter payment terms, delivery terms, or any other conditions..."})})]})}),a.jsx(q,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Line Items"}),a.jsxs(At,{sx:{p:3,mb:3},elevation:3,children:[a.jsx(Z,{container:!0,spacing:2,children:v.map((Ne,Be)=>a.jsxs(vs.Fragment,{children:[a.jsx(Z,{item:!0,xs:12,sm:6,md:2,children:a.jsx(sa,{value:Ne.part_number,onChange:(Ve,Ke)=>rr(Be,Ke),onInputChange:(Ve,Ke)=>{p($t=>{const kt=[...$t];return kt[Be]={...kt[Be],part_number:Ke.toUpperCase()},kt})},options:y.filter(Ve=>Ve.part_type!=="supply").map(Ve=>Ve.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,renderInput:Ve=>a.jsx(Oe,{...Ve,label:"Part Number",required:!0,fullWidth:!0,error:!!it?.lineItems?.[Be]?.part_number,helperText:it?.lineItems?.[Be]?.part_number||(y.some(Ke=>Ke.part_number===Ne.part_number)?"":"Invalid part number")})})}),a.jsx(Z,{item:!0,xs:12,sm:6,md:2,children:a.jsx(Oe,{label:"Part Description",value:Ne.part_description,fullWidth:!0,required:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),a.jsx(Z,{item:!0,xs:6,sm:3,md:1,children:a.jsx(Oe,{label:"Qty",value:Ne.quantity,onChange:Ve=>Rr(Be,"quantity",Ve.target.value),type:"number",fullWidth:!0,required:!0,error:!!it?.lineItems?.[Be]?.quantity,helperText:it?.lineItems?.[Be]?.quantity,InputProps:{readOnly:Ne.part_number==="SUPPLY",disabled:Ne.part_number==="SUPPLY"},inputProps:{step:1,onWheel:Ve=>Ve.target.blur()}})}),a.jsx(Z,{item:!0,xs:6,sm:3,md:1,children:a.jsx(Oe,{label:"Avail",value:(()=>{const Ve=Bt(Ne);return Ve?Ve.isNegative?`${Ve.available.toFixed(0)} (Insufficient)`:Ve.available.toFixed(0):"N/A"})(),fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:(()=>{const Ve=Bt(Ne);return Ve?Ve.available>=0?"#e8f5e8":"#ffeaea":"#f5f5f5"})(),"& .MuiInputBase-input":{color:Bt(Ne)?.isNegative?"#d32f2f":"#2e7d32"}}})}),a.jsx(Z,{item:!0,xs:6,sm:3,md:1,children:a.jsx(Oe,{label:"Unit",value:Ne.part_number==="SUPPLY"?"":Ne.unit,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),a.jsx(Z,{item:!0,xs:12,sm:2,md:1.5,children:a.jsx(Oe,{label:"Unit Cost",value:Ne.part_number==="LABOUR"?ee??0:Ne.part_number==="OVERHEAD"?pe??0:Ne.part_number==="SUPPLY"?"":Ne.unit_price,type:"number",fullWidth:!0,InputProps:{readOnly:!0,startAdornment:Ne.part_number!=="SUPPLY"?a.jsx(Bn,{position:"start",children:"$"}):void 0,disabled:Ne.part_number==="LABOUR"||Ne.part_number==="OVERHEAD"||Ne.part_number==="SUPPLY"}})}),a.jsx(Z,{item:!0,xs:6,sm:3,md:1.5,children:a.jsx(Oe,{label:"Amount",value:Ne.line_amount!=null&&!isNaN(Number(Ne.line_amount))?Number(Ne.line_amount).toFixed(2):"0.00",InputProps:{readOnly:!0},fullWidth:!0})}),a.jsx(Z,{item:!0,xs:6,sm:3,md:1,sx:{display:"flex",alignItems:"center"},children:a.jsx(Ce,{variant:"outlined",color:"primary",onClick:()=>Xr(Be),fullWidth:!0,children:"Remove"})})]},Be))}),a.jsx(ue,{sx:{mt:2},children:a.jsx(Ce,{variant:"outlined",color:"primary",onClick:Pn,children:"Add Line Item"})})]}),a.jsx(At,{sx:{p:3,mb:3},elevation:3,children:a.jsxs(Z,{container:!0,spacing:2,children:[a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsxs(q,{variant:"subtitle1",children:["Subtotal: $",ct!=null&&!isNaN(Number(ct))?Number(ct).toFixed(2):"0.00"]})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsxs(q,{variant:"subtitle1",children:["Total GST: $",Rt!=null&&!isNaN(Number(Rt))?Number(Rt).toFixed(2):"0.00"]})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsxs(q,{variant:"h6",children:["Total Amount: $",xt!=null&&!isNaN(Number(xt))?Number(xt).toFixed(2):"0.00"]})})]})}),a.jsx(Ul,{open:O,onClose:Kt,onSave:async Ne=>{try{const Ve=(await xe.post("/api/customers",Ne)).data.customer_id,Ke={label:Ne.customer_name,id:Ve};u($t=>[...$t,Ke]),r(Ke),Kt(),ve.success("Customer added successfully!")}catch{ve.error("Failed to add customer.")}},initialCustomer:{customer_name:I},isEditMode:!1}),a.jsx(Pu,{open:oe,onClose:Ln,onSave:async Ne=>{try{const Be=await xe.post("/api/products",Ne),Ve={label:Ne.product_name,id:Be.data.product_id,description:Ne.product_name};X(Ke=>[...Ke,Ve]),U(Ve),Ln(),ve.success("Product added successfully!")}catch{ve.error("Failed to add product.")}},initialProduct:{product_name:J||C},isEditMode:!1}),a.jsxs(Sr,{open:nt,onClose:Zr,children:[a.jsx(Cr,{children:"Remove Line Item"}),a.jsxs(Pr,{children:[a.jsx(q,{children:"Are you sure you want to remove this line item? This action cannot be undone."}),Ae!==null&&v[Ae]&&a.jsxs(ue,{sx:{mt:2,p:2,bgcolor:"grey.100",borderRadius:1},children:[a.jsxs(q,{variant:"body2",fontWeight:"medium",children:["Part: ",v[Ae].part_number]}),a.jsxs(q,{variant:"body2",color:"text.secondary",children:["Description: ",v[Ae].part_description]}),a.jsxs(q,{variant:"body2",color:"text.secondary",children:["Quantity: ",v[Ae].quantity]})]})]}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:Zr,children:"Cancel"}),a.jsx(Ce,{onClick:sr,color:"error",variant:"contained",children:"Remove"})]})]})]})})},d5=async()=>(await xe.get("/api/employees")).data,qp=["Admin","Sales and Purchase","Time Tracking","Mobile Time Tracker"],h5=()=>{const[t,e]=_.useState(""),[r,n]=_.useState(""),[s,i]=_.useState(""),[o,l]=_.useState(""),[u,d]=_.useState("Employee"),[f,m]=_.useState(null),[v,p]=_.useState(null),[b,w]=_.useState([]),[y,j]=_.useState(!0);Vr();const[O,k]=_.useState(null),[I,H]=_.useState(""),[F,U]=_.useState(""),[C,N]=_.useState(""),[Q,P]=_.useState(!1);_.useEffect(()=>{L()},[]);const L=async()=>{j(!0);try{const E=await d5();w(E)}catch{m("Failed to fetch employees.")}finally{j(!1)}},te=async E=>{if(E.preventDefault(),m(null),p(null),s!==o){m("Passwords do not match");return}try{const X=await xe.post("/api/employees",{username:t,email:r,password:s,access_role:u});p(X.data.message),e(""),n(""),i(""),l(""),d("Employee"),L()}catch(X){X instanceof _n?m(X.response?.data?.message||"Employee registration failed"):m("An unexpected error occurred")}},W=async E=>{if(window.confirm("Are you sure you want to delete this employee?"))try{await xe.delete(`/api/employees/${E}`),p("Employee deleted successfully"),L()}catch(X){console.error("Error deleting employee:",X),X instanceof _n?m(X.response?.data?.message||"Failed to delete employee"):m("An unexpected error occurred")}},z=E=>{k(E),H(E.username),U(E.access_role),N(""),P(!0)},V=()=>{P(!1),k(null),m(null),p(null)},Y=async()=>{if(O){m(null),p(null);try{const E={username:I,access_role:F};C&&(E.password=C);const X=await xe.put(`/api/employees/${O.id}`,E);p(X.data.message||"Employee updated successfully"),L(),V()}catch(E){console.error("Error updating employee:",E),E instanceof _n?m(E.response?.data?.message||"Failed to update employee"):m("An unexpected error occurred")}}};return y?a.jsxs(er,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[a.jsx(pr,{}),a.jsx(q,{children:"Loading employees..."})]}):a.jsxs(er,{component:"main",maxWidth:"md",children:[a.jsxs(ue,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsxs(At,{elevation:6,sx:{p:4,width:"100%",borderRadius:2,mb:4},children:[a.jsx(q,{component:"h1",variant:"h5",sx:{mb:3,textAlign:"center"},children:"Register New Employee"}),a.jsxs(ue,{component:"form",onSubmit:te,noValidate:!0,sx:{mt:1},children:[a.jsx(Oe,{margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Username",name:"username",autoComplete:"new-username",value:t,onChange:E=>e(E.target.value)}),a.jsx(Oe,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"new-email",value:r,onChange:E=>n(E.target.value)}),a.jsx(Oe,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Initial Password",type:"password",id:"password",autoComplete:"new-password",value:s,onChange:E=>i(E.target.value)}),a.jsx(Oe,{margin:"normal",required:!0,fullWidth:!0,name:"confirmPassword",label:"Confirm Initial Password",type:"password",id:"confirmPassword",autoComplete:"new-password",value:o,onChange:E=>l(E.target.value)}),a.jsxs(nn,{fullWidth:!0,margin:"normal",children:[a.jsx(an,{id:"access-role-label",children:"Access Role"}),a.jsx(sn,{labelId:"access-role-label",id:"access-role",value:u,label:"Access Role",onChange:E=>d(E.target.value),children:qp.map(E=>a.jsx(Jt,{value:E,children:E},E))})]}),a.jsx(Ce,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},children:"Register Employee"}),f&&a.jsx(Ct,{severity:"error",sx:{mt:2},children:f}),v&&a.jsx(Ct,{severity:"success",sx:{mt:2},children:v})]})]}),a.jsxs(At,{elevation:6,sx:{p:4,width:"100%",borderRadius:2},children:[a.jsx(q,{component:"h2",variant:"h5",sx:{mb:3,textAlign:"center"},children:"Existing Employees"}),a.jsx(oo,{children:b.map(E=>a.jsx(lo,{secondaryAction:a.jsxs(ue,{children:[a.jsx(jr,{edge:"end","aria-label":"edit",onClick:()=>z(E),sx:{mr:1},children:a.jsx(Tl,{})}),a.jsx(jr,{edge:"end","aria-label":"delete",onClick:()=>W(E.id),children:a.jsx(la,{})})]}),children:a.jsx(co,{primary:E.username,secondary:`Email: ${E.email} | Role: ${E.role} | Access: ${E.access_role}`})},E.id))})]})]}),a.jsxs(Sr,{open:Q,onClose:V,children:[a.jsx(Cr,{children:"Edit Employee Roles"}),a.jsxs(Pr,{children:[O&&a.jsxs(ue,{component:"form",noValidate:!0,sx:{mt:1},children:[a.jsx(Oe,{margin:"normal",fullWidth:!0,id:"edit-username",label:"Username",value:I,onChange:E=>H(E.target.value),variant:"standard"}),a.jsx(Oe,{margin:"normal",fullWidth:!0,id:"edit-email",label:"Email",value:O.email,InputProps:{readOnly:!0,disableUnderline:!0},variant:"standard"}),a.jsx(Oe,{margin:"normal",fullWidth:!0,id:"edit-password",label:"New Password (leave blank to keep current)",type:"password",value:C,onChange:E=>N(E.target.value),variant:"standard"}),a.jsxs(nn,{fullWidth:!0,margin:"normal",children:[a.jsx(an,{id:"edit-access-role-label",children:"Access Role"}),a.jsx(sn,{labelId:"edit-access-role-label",id:"edit-access-role",value:F,label:"Access Role",onChange:E=>U(E.target.value),children:qp.map(E=>a.jsx(Jt,{value:E,children:E},E))})]})]}),f&&a.jsx(Ct,{severity:"error",sx:{mt:2},children:f}),v&&a.jsx(Ct,{severity:"success",sx:{mt:2},children:v})]}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:V,children:"Cancel"}),a.jsx(Ce,{onClick:Y,variant:"contained",color:"primary",children:"Save Changes"})]})]})]})},f5=()=>{const[t,e]=_.useState([]),[r,n]=_.useState(!0),[s,i]=_.useState(!1),[o,l]=_.useState(!1),[u,d]=_.useState({margin_id:"",cost_lower_bound:"",cost_upper_bound:"",margin_factor:""}),[f,m]=_.useState(null),[v,p]=_.useState({page:0,pageSize:5}),[b,w]=_.useState(""),[y,j]=_.useState(!1),[O,k]=_.useState(""),[I,H]=_.useState(!1),[F,U]=_.useState(""),[C,N]=_.useState(!1),[Q,P]=_.useState(""),[L,te]=_.useState(!1),[W,z]=_.useState(""),[V,Y]=_.useState(!1),E=async()=>{try{const R=await xe.get("/api/margin-schedule");e(R.data.map(be=>({...be,id:be.margin_id}))),n(!1),m(null)}catch(R){console.error("Error fetching margin schedules:",R),m("Failed to load margin schedules"),ve.error("Failed to load margin schedules"),n(!1)}},X=async()=>{j(!0);try{const R=await xe.get("/api/settings/labour-rate");w(R.data.labour_rate??"")}catch{w("")}finally{j(!1)}},oe=async()=>{H(!0);try{const R=await xe.get("/api/settings/overhead-rate");k(R.data.overhead_rate??"")}catch{k("")}finally{H(!1)}},de=async()=>{N(!0);try{const R=await xe.get("/api/settings/supply-rate");U(R.data.supply_rate??"")}catch{U("")}finally{N(!1)}},A=async()=>{te(!0);try{const R=await xe.get("/api/settings/daily-break-start");P(R.data.daily_break_start??"")}catch{P("")}finally{te(!1)}},D=async()=>{Y(!0);try{const R=await xe.get("/api/settings/daily-break-end");z(R.data.daily_break_end??"")}catch{z("")}finally{Y(!1)}};_.useEffect(()=>{E(),X(),oe(),de(),A(),D()},[]);const J=()=>{l(!1),d({margin_id:"",cost_lower_bound:"",cost_upper_bound:"",margin_factor:""}),i(!0)},re=R=>{l(!0),d({margin_id:R.margin_id,cost_lower_bound:String(R.cost_lower_bound),cost_upper_bound:String(R.cost_upper_bound),margin_factor:String(R.margin_factor)}),i(!0)},ce=async R=>{if(window.confirm("Are you sure you want to delete this margin schedule?"))try{await xe.delete(`/api/margin-schedule/${R}`),ve.success("Margin schedule deleted successfully"),E()}catch(be){console.error("Error deleting margin schedule:",be),ve.error("Failed to delete margin schedule")}},fe=()=>{i(!1)},ee=R=>{const{name:be,value:je}=R.target;d(Pe=>({...Pe,[be]:je}))},ae=async R=>{R.preventDefault();try{o?(await xe.put(`/api/margin-schedule/${u.margin_id}`,{cost_lower_bound:parseFloat(u.cost_lower_bound),cost_upper_bound:parseFloat(u.cost_upper_bound),margin_factor:parseFloat(u.margin_factor)}),ve.success("Margin schedule updated successfully")):(await xe.post("/api/margin-schedule",{schedule:[{cost_lower_bound:parseFloat(u.cost_lower_bound),cost_upper_bound:parseFloat(u.cost_upper_bound),margin_factor:parseFloat(u.margin_factor)}]}),ve.success("Margin schedule created successfully")),fe(),E()}catch(be){console.error("Error saving margin schedule:",be),ve.error("Failed to save margin schedule")}},pe=async()=>{j(!0);try{await xe.put("/api/settings/labour-rate",{labour_rate:Number(b)}),X()}catch{}finally{j(!1)}},ye=async()=>{H(!0);try{await xe.put("/api/settings/overhead-rate",{overhead_rate:Number(O)}),oe()}catch{}finally{H(!1)}},Le=async()=>{N(!0);try{await xe.put("/api/settings/supply-rate",{supply_rate:Number(F)}),de(),ve.success("Supply rate updated successfully")}catch{ve.error("Failed to update supply rate")}finally{N(!1)}},se=async()=>{te(!0);try{await xe.put("/api/settings/daily-break-start",{daily_break_start:Q}),A(),ve.success("Daily break start time updated successfully")}catch{ve.error("Failed to update daily break start time")}finally{te(!1)}},Fe=async()=>{Y(!0);try{await xe.put("/api/settings/daily-break-end",{daily_break_end:W}),D(),ve.success("Daily break end time updated successfully")}catch{ve.error("Failed to update daily break end time")}finally{Y(!1)}},ne=[{field:"margin_id",headerName:"ID",flex:.5,minWidth:60,headerAlign:"center",align:"center"},{field:"cost_lower_bound",headerName:"Cost Lower Bound",flex:1,minWidth:120,type:"number",headerAlign:"center",align:"center"},{field:"cost_upper_bound",headerName:"Cost Upper Bound",flex:1,minWidth:120,type:"number",headerAlign:"center",align:"center"},{field:"margin_factor",headerName:"Margin Factor",flex:1,minWidth:120,type:"number",headerAlign:"center",align:"center"},{field:"actions",headerName:"Actions",width:80,sortable:!1,headerAlign:"center",align:"center",renderCell:R=>a.jsx(jr,{size:"small",color:"error",onClick:be=>{be.stopPropagation(),ce(R.row.margin_id)},children:a.jsx(la,{})})}];return a.jsxs(er,{maxWidth:"xl",sx:{mt:4,mb:4},children:[a.jsxs(ue,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[a.jsx(q,{variant:"h4",gutterBottom:!0,children:"Global Variables"}),a.jsxs(Kr,{direction:"row",spacing:2,children:[a.jsx(Ce,{variant:"contained",onClick:J,startIcon:a.jsx(ka,{}),children:"New Entry"}),a.jsx(Ce,{variant:"contained",onClick:E,children:"Refresh"})]})]}),a.jsx(At,{sx:{width:"100%",overflow:"hidden",mb:3},children:a.jsx(ue,{sx:{p:2},children:a.jsx(es,{rows:t,columns:ne,getRowId:R=>R.id,paginationModel:v,onPaginationModelChange:R=>p(R),pageSizeOptions:[5,10,20],loading:r,disableRowSelectionOnClick:!0,onRowClick:R=>re(R.row),sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"},cursor:"pointer"}})})}),a.jsx(At,{sx:{width:"100%",overflow:"hidden",mb:3,p:2},children:a.jsxs(ue,{sx:{display:"flex",gap:4,alignItems:"flex-start"},children:[a.jsxs(ue,{sx:{flex:1},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Labour Hourly Rate"}),a.jsxs(ue,{sx:{display:"flex",alignItems:"center",gap:2},children:[a.jsx(Oe,{label:"Hourly Rate ($)",type:"number",value:b,onChange:R=>w(R.target.value===""?"":Number(R.target.value)),disabled:y,InputProps:{startAdornment:a.jsx(Bn,{position:"start",children:"$"})},sx:{maxWidth:200}}),a.jsx(Ce,{variant:"contained",onClick:pe,disabled:y||b==="",children:"Save"})]})]}),a.jsxs(ue,{sx:{flex:1},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Overhead Hourly Rate"}),a.jsxs(ue,{sx:{display:"flex",alignItems:"center",gap:2},children:[a.jsx(Oe,{label:"Hourly Rate ($)",type:"number",value:O,onChange:R=>k(R.target.value===""?"":Number(R.target.value)),disabled:I,InputProps:{startAdornment:a.jsx(Bn,{position:"start",children:"$"})},sx:{maxWidth:200}}),a.jsx(Ce,{variant:"contained",onClick:ye,disabled:I||O==="",children:"Save"})]})]}),a.jsxs(ue,{sx:{flex:1},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Supply Percentage"}),a.jsxs(ue,{sx:{display:"flex",alignItems:"center",gap:2},children:[a.jsx(Oe,{label:"Percentage (%)",type:"number",value:F,onChange:R=>U(R.target.value===""?"":Number(R.target.value)),disabled:C,InputProps:{endAdornment:a.jsx(Bn,{position:"end",children:"%"})},sx:{maxWidth:200}}),a.jsx(Ce,{variant:"contained",onClick:Le,disabled:C||F==="",children:"Save"})]})]}),a.jsxs(ue,{sx:{flex:1},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Daily Break Times"}),a.jsxs(ue,{sx:{display:"flex",flexDirection:"column",gap:2},children:[a.jsx(Oe,{label:"Break Start (HH:MM)",type:"time",value:Q,onChange:R=>P(R.target.value),disabled:L,InputLabelProps:{shrink:!0},sx:{maxWidth:200}}),a.jsx(Ce,{variant:"contained",onClick:se,disabled:L||Q==="",children:"Save Start"}),a.jsx(Oe,{label:"Break End (HH:MM)",type:"time",value:W,onChange:R=>z(R.target.value),disabled:V,InputLabelProps:{shrink:!0},sx:{maxWidth:200}}),a.jsx(Ce,{variant:"contained",onClick:Fe,disabled:V||W==="",children:"Save End"})]})]})]})}),a.jsxs(Sr,{open:s,onClose:fe,children:[a.jsx(Cr,{children:o?"Edit Margin Entry":"Add New Margin Entry"}),a.jsx(Pr,{children:a.jsxs(Kr,{spacing:2,mt:1,children:[a.jsx(Oe,{label:"Cost Lower Bound",name:"cost_lower_bound",value:u.cost_lower_bound,onChange:ee,fullWidth:!0,type:"number"}),a.jsx(Oe,{label:"Cost Upper Bound",name:"cost_upper_bound",value:u.cost_upper_bound,onChange:ee,fullWidth:!0,type:"number"}),a.jsx(Oe,{label:"Margin Factor",name:"margin_factor",value:u.margin_factor,onChange:ee,fullWidth:!0,type:"number"})]})}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:fe,children:"Cancel"}),a.jsx(Ce,{onClick:ae,children:o?"Save Changes":"Add Entry"})]})]})]})};var ol={},Bp;function p5(){if(Bp)return ol;Bp=1;var t=jn();Object.defineProperty(ol,"__esModule",{value:!0}),ol.default=void 0;var e=t(Cn()),r=Sn();return ol.default=(0,e.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),ol}var m5=p5();const Wl=Dr(m5);var ll={},Up;function g5(){if(Up)return ll;Up=1;var t=jn();Object.defineProperty(ll,"__esModule",{value:!0}),ll.default=void 0;var e=t(Cn()),r=Sn();return ll.default=(0,e.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error"),ll}var v5=g5();const ku=Dr(v5);var cl={},Wp;function x5(){if(Wp)return cl;Wp=1;var t=jn();Object.defineProperty(cl,"__esModule",{value:!0}),cl.default=void 0;var e=t(Cn()),r=Sn();return cl.default=(0,e.default)((0,r.jsx)("path",{d:"M6 2v6h.01L6 8.01 10 12l-4 4 .01.01H6V22h12v-5.99h-.01L18 16l-4-4 4-3.99-.01-.01H18V2zm10 14.5V20H8v-3.5l4-4zm-4-5-4-4V4h8v3.5z"}),"HourglassEmpty"),cl}var y5=x5();const Jg=Dr(y5),b5=()=>{const[t,e]=_.useState(""),[r,n]=_.useState([]),[s,i]=_.useState("open"),[o,l]=_.useState(0),u=Vr(),[d,f]=_.useState(!1),[m,v]=_.useState(null),[p,b]=_.useState(null),[w,y]=_.useState(null),[j,O]=_.useState({page:0,pageSize:10}),k=async(P=s)=>{try{const te=(await xe.get("/api/sales-orders",{params:{status:P}})).data.sort((z,V)=>{const Y=oe=>{const de=oe.match(/\d+/);return de?parseInt(de[0],10):0},E=Y(z.sales_order_number);return Y(V.sales_order_number)-E}),W=te.map(z=>({...z,id:z.sales_order_id,subtotal:z.subtotal,total_gst_amount:z.total_gst_amount,total_amount:z.total_amount}));if(n(W),P==="open"||P==="all"){const V=(P==="open"?te:te.filter(Y=>Y.status==="Open")).reduce((Y,E)=>{const X=parseFloat(E.subtotal)||0;return Y+X},0);l(V)}else l(0)}catch(L){console.error("Error fetching sales orders:",L),n([]),l(0)}};_.useEffect(()=>{k(s)},[s]);const I=async P=>{if(window.confirm("Are you sure you want to delete this Sales Order? This action cannot be undone."))try{await xe.delete(`/api/sales-orders/${P}`),ve.success("Sales Order deleted successfully!"),k()}catch(L){console.error("Error deleting sales order:",L),ve.error("Failed to delete sales order.")}},H=async P=>{v(P),b(null),y(null);try{const L=await xe.post(`/api/sales-orders/${P}/export-to-qbo`);ve.success("Exported to QuickBooks successfully!"),y(`Sales Order exported to QuickBooks successfully! Invoice ID: ${L.data.qboInvoiceId}`),k(s)}catch(L){const te=L?.response?.data?.error||"Failed to export to QuickBooks.";b(te),ve.error(te)}finally{v(null)}},F=r.filter(P=>P.sales_order_number?.toLowerCase().includes(t.toLowerCase())||P.customer_name?.toLowerCase().includes(t.toLowerCase())||P.product_name?.toLowerCase().includes(t.toLowerCase())||P.product_description?.toLowerCase().includes(t.toLowerCase())),U=[{field:"sales_order_number",headerName:"Sales Order #",flex:1,minWidth:120},{field:"customer_name",headerName:"Customer",flex:1.3,minWidth:150},{field:"product_name",headerName:"Product Name",flex:1,minWidth:120},{field:"product_description",headerName:"Product Description",flex:1.5,minWidth:150},{field:"subtotal",headerName:"Subtotal",flex:.8,minWidth:100,valueFormatter:P=>P.value!=null&&!isNaN(Number(P.value))?`$${Number(P.value).toFixed(2)}`:"$0.00"},{field:"total_gst_amount",headerName:"GST",flex:.7,minWidth:80,valueFormatter:P=>P.value!=null&&!isNaN(Number(P.value))?`$${Number(P.value).toFixed(2)}`:"$0.00"},{field:"total_amount",headerName:"Total",flex:.8,minWidth:100,valueFormatter:P=>P.value!=null&&!isNaN(Number(P.value))?`$${Number(P.value).toFixed(2)}`:"$0.00"},{field:"status",headerName:"Status",flex:.8,minWidth:100,renderCell:P=>a.jsx(Zt,{label:P.value,color:P.value==="Open"?"success":"error",size:"small",variant:"outlined"})},{field:"exported_to_qbo",headerName:"QBO Exported",flex:.8,minWidth:120,renderCell:P=>P.row.exported_to_qbo?a.jsx(Wl,{color:"success",titleAccess:"Exported to QuickBooks"}):P.row.qbo_export_status?a.jsx(ku,{color:"error",titleAccess:`QBO Export Error: ${P.row.qbo_export_status}`}):P.row.status==="Closed"?a.jsx(Jg,{color:"warning",titleAccess:"Not exported to QuickBooks"}):null},{field:"actions",headerName:"Actions",width:150,sortable:!1,renderCell:P=>a.jsxs(ue,{sx:{display:"flex",gap:.5},children:[P.row.status==="Closed"&&!P.row.exported_to_qbo&&a.jsx(jr,{size:"small",color:"success",onClick:L=>{L.stopPropagation(),H(P.row.sales_order_id)},disabled:m===P.row.sales_order_id,children:m===P.row.sales_order_id?a.jsx(pr,{size:16}):a.jsx(yo,{})}),P.row.status!=="Closed"&&a.jsx(jr,{size:"small",color:"error",onClick:L=>{L.stopPropagation(),I(P.row.sales_order_id)},children:a.jsx(la,{})})]})}],C=()=>{let P=F;s==="open"?P=F.filter(z=>z.status==="Open"):s==="closed"&&(P=F.filter(z=>z.status==="Closed"));const L=wi.unparse(P.map(z=>{const V={};return U.forEach(Y=>{if(Y.field!=="actions"){const E=z[Y.field];Y.field==="bill_date"||Y.field==="sales_date"?V[Y.headerName]=E?new Date(E).toLocaleDateString():"":Y.type==="number"?V[Y.headerName]=E!=null&&!isNaN(parseFloat(String(E)))?parseFloat(String(E)).toFixed(2):"":V[Y.headerName]=E!==void 0?String(E):""}}),V})),te=new Blob([L],{type:"text/csv;charset=utf-8;"}),W=document.createElement("a");if(W.download!==void 0){const z=URL.createObjectURL(te);W.setAttribute("href",z),W.setAttribute("download","open_sales_orders.csv"),W.style.visibility="hidden",document.body.appendChild(W),W.click(),document.body.removeChild(W)}},N=()=>{const L=`/api/sales-orders/export/pdf?status=${s==="all"?"":s}`;window.open(L,"_blank")},Q=P=>{u(`/open-sales-orders/${P.row.sales_order_id}`)};return a.jsxs(er,{maxWidth:"xl",sx:{mt:4,mb:4},children:[a.jsxs(ue,{sx:{mb:4},children:[a.jsx(q,{variant:"h4",component:"h1",gutterBottom:!0,children:"Sales Orders"}),(s==="open"||s==="all")&&a.jsxs(ue,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[a.jsxs(q,{variant:"h6",component:"div",sx:{fontWeight:"bold",color:"primary.main"},children:["Work In Process: $",o.toFixed(2)]}),a.jsx(q,{variant:"body2",color:"text.secondary",children:"Total subtotal value of all open sales orders"})]}),a.jsx(ue,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:a.jsxs(Kr,{direction:"row",spacing:2,children:[a.jsx(Ce,{variant:"contained",startIcon:a.jsx(ka,{}),onClick:()=>u("/sales-order"),children:"New SO"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:C,children:"Export CSV"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:N,children:"Download PDF"})]})})]}),a.jsx(At,{sx:{width:"100%",overflow:"hidden",mb:3},children:a.jsxs(ue,{sx:{p:2},children:[a.jsxs(Kr,{direction:"row",spacing:3,sx:{mb:2},children:[a.jsx(Oe,{label:"Search",variant:"outlined",value:t,onChange:P=>e(P.target.value),InputProps:{startAdornment:a.jsx(Bn,{position:"start",children:a.jsx(rs,{sx:{fontSize:22}})})},sx:{minWidth:340,maxWidth:400,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"small"}),a.jsx(Zt,{label:"All",onClick:()=>i("all"),color:s==="all"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),a.jsx(Zt,{label:"Open",onClick:()=>i("open"),color:s==="open"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),a.jsx(Zt,{label:"Closed",onClick:()=>i("closed"),color:s==="closed"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}})]}),a.jsx(es,{rows:F,columns:U,loading:!1,paginationModel:j,onPaginationModelChange:O,pageSizeOptions:[10,25,50],getRowId:P=>P.id,onRowClick:Q,disableRowSelectionOnClick:!0,initialState:{sorting:{sortModel:[{field:"sales_order_number",sort:"desc"}]}},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),p&&a.jsx(Ct,{severity:"error",sx:{mt:2},onClose:()=>b(null),children:p}),w&&a.jsx(Ct,{severity:"success",sx:{mt:2},onClose:()=>y(null),children:w})]})};function mr(t){if(t===null||t===!0||t===!1)return NaN;var e=Number(t);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function pt(t,e){if(e.length<t)throw new TypeError(t+" argument"+(t>1?"s":"")+" required, but only "+e.length+" present")}function mt(t){pt(1,arguments);var e=Object.prototype.toString.call(t);return t instanceof Date||br(t)==="object"&&e==="[object Date]"?new Date(t.getTime()):typeof t=="number"||e==="[object Number]"?new Date(t):((typeof t=="string"||e==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function Yc(t,e){pt(2,arguments);var r=mt(t),n=mr(e);return isNaN(n)?new Date(NaN):(n&&r.setDate(r.getDate()+n),r)}function Vc(t,e){pt(2,arguments);var r=mt(t),n=mr(e);if(isNaN(n))return new Date(NaN);if(!n)return r;var s=r.getDate(),i=new Date(r.getTime());i.setMonth(r.getMonth()+n+1,0);var o=i.getDate();return s>=o?i:(r.setFullYear(i.getFullYear(),i.getMonth(),s),r)}function Au(t,e){pt(2,arguments);var r=mt(t).getTime(),n=mr(e);return new Date(r+n)}var w5=36e5;function _5(t,e){pt(2,arguments);var r=mr(e);return Au(t,r*w5)}var j5={};function as(){return j5}function pi(t,e){var r,n,s,i,o,l,u,d;pt(1,arguments);var f=as(),m=mr((r=(n=(s=(i=e?.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&s!==void 0?s:f.weekStartsOn)!==null&&n!==void 0?n:(u=f.locale)===null||u===void 0||(d=u.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&r!==void 0?r:0);if(!(m>=0&&m<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var v=mt(t),p=v.getDay(),b=(p<m?7:0)+p-m;return v.setDate(v.getDate()-b),v.setHours(0,0,0,0),v}function iu(t){var e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),t.getTime()-e.getTime()}function fo(t){pt(1,arguments);var e=mt(t);return e.setHours(0,0,0,0),e}var S5=864e5;function C5(t,e){pt(2,arguments);var r=fo(t),n=fo(e),s=r.getTime()-iu(r),i=n.getTime()-iu(n);return Math.round((s-i)/S5)}var P5=6e4;function k5(t,e){pt(2,arguments);var r=mr(e);return Au(t,r*P5)}function A5(t,e){pt(2,arguments);var r=mr(e);return Au(t,r*1e3)}function L5(t,e){pt(2,arguments);var r=mr(e),n=r*7;return Yc(t,n)}function zp(t,e){pt(2,arguments);var r=mr(e);return Vc(t,r*12)}function kl(t,e){pt(2,arguments);var r=mt(t),n=mt(e),s=r.getTime()-n.getTime();return s<0?-1:s>0?1:s}var Lu=6e4,Nu=36e5,N5=1e3;function E5(t,e){pt(2,arguments);var r=fo(t),n=fo(e);return r.getTime()===n.getTime()}function O5(t){return pt(1,arguments),t instanceof Date||br(t)==="object"&&Object.prototype.toString.call(t)==="[object Date]"}function Kg(t){if(pt(1,arguments),!O5(t)&&typeof t!="number")return!1;var e=mt(t);return!isNaN(Number(e))}function I5(t,e){pt(2,arguments);var r=mt(t),n=mt(e),s=r.getFullYear()-n.getFullYear(),i=r.getMonth()-n.getMonth();return s*12+i}function D5(t,e){pt(2,arguments);var r=mt(t),n=mt(e);return r.getFullYear()-n.getFullYear()}function $p(t,e){var r=t.getFullYear()-e.getFullYear()||t.getMonth()-e.getMonth()||t.getDate()-e.getDate()||t.getHours()-e.getHours()||t.getMinutes()-e.getMinutes()||t.getSeconds()-e.getSeconds()||t.getMilliseconds()-e.getMilliseconds();return r<0?-1:r>0?1:r}function Xg(t,e){pt(2,arguments);var r=mt(t),n=mt(e),s=$p(r,n),i=Math.abs(C5(r,n));r.setDate(r.getDate()-s*i);var o=+($p(r,n)===-s),l=s*(i-o);return l===0?0:l}function Eu(t,e){return pt(2,arguments),mt(t).getTime()-mt(e).getTime()}var Hp={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(e){return e<0?Math.ceil(e):Math.floor(e)}},T5="trunc";function zl(t){return t?Hp[t]:Hp[T5]}function M5(t,e,r){pt(2,arguments);var n=Eu(t,e)/Nu;return zl(void 0)(n)}function F5(t,e,r){pt(2,arguments);var n=Eu(t,e)/Lu;return zl(void 0)(n)}function dh(t){pt(1,arguments);var e=mt(t);return e.setHours(23,59,59,999),e}function hh(t){pt(1,arguments);var e=mt(t),r=e.getMonth();return e.setFullYear(e.getFullYear(),r+1,0),e.setHours(23,59,59,999),e}function R5(t){pt(1,arguments);var e=mt(t);return dh(e).getTime()===hh(e).getTime()}function Zg(t,e){pt(2,arguments);var r=mt(t),n=mt(e),s=kl(r,n),i=Math.abs(I5(r,n)),o;if(i<1)o=0;else{r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-s*i);var l=kl(r,n)===-s;R5(mt(t))&&i===1&&kl(t,n)===1&&(l=!1),o=s*(i-Number(l))}return o===0?0:o}function q5(t,e,r){pt(2,arguments);var n=Zg(t,e)/3;return zl(void 0)(n)}function B5(t,e,r){pt(2,arguments);var n=Eu(t,e)/1e3;return zl(void 0)(n)}function U5(t,e,r){pt(2,arguments);var n=Xg(t,e)/7;return zl(void 0)(n)}function W5(t,e){pt(2,arguments);var r=mt(t),n=mt(e),s=kl(r,n),i=Math.abs(D5(r,n));r.setFullYear(1584),n.setFullYear(1584);var o=kl(r,n)===-s,l=s*(i-Number(o));return l===0?0:l}function z5(t,e){var r;pt(1,arguments);var n=t||{},s=mt(n.start),i=mt(n.end),o=i.getTime();if(!(s.getTime()<=o))throw new RangeError("Invalid interval");var l=[],u=s;u.setHours(0,0,0,0);var d=Number((r=void 0)!==null&&r!==void 0?r:1);if(d<1||isNaN(d))throw new RangeError("`options.step` must be a number greater than 1");for(;u.getTime()<=o;)l.push(mt(u)),u.setDate(u.getDate()+d),u.setHours(0,0,0,0);return l}function Yp(t){pt(1,arguments);var e=mt(t);return e.setDate(1),e.setHours(0,0,0,0),e}function kd(t){pt(1,arguments);var e=mt(t),r=e.getFullYear();return e.setFullYear(r+1,0,0),e.setHours(23,59,59,999),e}function Nc(t){pt(1,arguments);var e=mt(t),r=new Date(0);return r.setFullYear(e.getFullYear(),0,1),r.setHours(0,0,0,0),r}function Ad(t,e){var r,n,s,i,o,l,u,d;pt(1,arguments);var f=as(),m=mr((r=(n=(s=(i=e?.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&s!==void 0?s:f.weekStartsOn)!==null&&n!==void 0?n:(u=f.locale)===null||u===void 0||(d=u.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&r!==void 0?r:0);if(!(m>=0&&m<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var v=mt(t),p=v.getDay(),b=(p<m?-7:0)+6-(p-m);return v.setDate(v.getDate()+b),v.setHours(23,59,59,999),v}function e1(t,e){pt(2,arguments);var r=mr(e);return Au(t,-r)}var $5=864e5;function H5(t){pt(1,arguments);var e=mt(t),r=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var n=e.getTime(),s=r-n;return Math.floor(s/$5)+1}function po(t){pt(1,arguments);var e=1,r=mt(t),n=r.getUTCDay(),s=(n<e?7:0)+n-e;return r.setUTCDate(r.getUTCDate()-s),r.setUTCHours(0,0,0,0),r}function t1(t){pt(1,arguments);var e=mt(t),r=e.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(r+1,0,4),n.setUTCHours(0,0,0,0);var s=po(n),i=new Date(0);i.setUTCFullYear(r,0,4),i.setUTCHours(0,0,0,0);var o=po(i);return e.getTime()>=s.getTime()?r+1:e.getTime()>=o.getTime()?r:r-1}function Y5(t){pt(1,arguments);var e=t1(t),r=new Date(0);r.setUTCFullYear(e,0,4),r.setUTCHours(0,0,0,0);var n=po(r);return n}var V5=6048e5;function r1(t){pt(1,arguments);var e=mt(t),r=po(e).getTime()-Y5(e).getTime();return Math.round(r/V5)+1}function vi(t,e){var r,n,s,i,o,l,u,d;pt(1,arguments);var f=as(),m=mr((r=(n=(s=(i=e?.weekStartsOn)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&s!==void 0?s:f.weekStartsOn)!==null&&n!==void 0?n:(u=f.locale)===null||u===void 0||(d=u.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&r!==void 0?r:0);if(!(m>=0&&m<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var v=mt(t),p=v.getUTCDay(),b=(p<m?7:0)+p-m;return v.setUTCDate(v.getUTCDate()-b),v.setUTCHours(0,0,0,0),v}function Mh(t,e){var r,n,s,i,o,l,u,d;pt(1,arguments);var f=mt(t),m=f.getUTCFullYear(),v=as(),p=mr((r=(n=(s=(i=e?.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:v.firstWeekContainsDate)!==null&&n!==void 0?n:(u=v.locale)===null||u===void 0||(d=u.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&r!==void 0?r:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var b=new Date(0);b.setUTCFullYear(m+1,0,p),b.setUTCHours(0,0,0,0);var w=vi(b,e),y=new Date(0);y.setUTCFullYear(m,0,p),y.setUTCHours(0,0,0,0);var j=vi(y,e);return f.getTime()>=w.getTime()?m+1:f.getTime()>=j.getTime()?m:m-1}function G5(t,e){var r,n,s,i,o,l,u,d;pt(1,arguments);var f=as(),m=mr((r=(n=(s=(i=e?.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:f.firstWeekContainsDate)!==null&&n!==void 0?n:(u=f.locale)===null||u===void 0||(d=u.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&r!==void 0?r:1),v=Mh(t,e),p=new Date(0);p.setUTCFullYear(v,0,m),p.setUTCHours(0,0,0,0);var b=vi(p,e);return b}var Q5=6048e5;function n1(t,e){pt(1,arguments);var r=mt(t),n=vi(r,e).getTime()-G5(r,e).getTime();return Math.round(n/Q5)+1}function nr(t,e){for(var r=t<0?"-":"",n=Math.abs(t).toString();n.length<e;)n="0"+n;return r+n}var Fs={y:function(e,r){var n=e.getUTCFullYear(),s=n>0?n:1-n;return nr(r==="yy"?s%100:s,r.length)},M:function(e,r){var n=e.getUTCMonth();return r==="M"?String(n+1):nr(n+1,2)},d:function(e,r){return nr(e.getUTCDate(),r.length)},a:function(e,r){var n=e.getUTCHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h:function(e,r){return nr(e.getUTCHours()%12||12,r.length)},H:function(e,r){return nr(e.getUTCHours(),r.length)},m:function(e,r){return nr(e.getUTCMinutes(),r.length)},s:function(e,r){return nr(e.getUTCSeconds(),r.length)},S:function(e,r){var n=r.length,s=e.getUTCMilliseconds(),i=Math.floor(s*Math.pow(10,n-3));return nr(i,r.length)}},Gi={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},J5={G:function(e,r,n){var s=e.getUTCFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return n.era(s,{width:"abbreviated"});case"GGGGG":return n.era(s,{width:"narrow"});case"GGGG":default:return n.era(s,{width:"wide"})}},y:function(e,r,n){if(r==="yo"){var s=e.getUTCFullYear(),i=s>0?s:1-s;return n.ordinalNumber(i,{unit:"year"})}return Fs.y(e,r)},Y:function(e,r,n,s){var i=Mh(e,s),o=i>0?i:1-i;if(r==="YY"){var l=o%100;return nr(l,2)}return r==="Yo"?n.ordinalNumber(o,{unit:"year"}):nr(o,r.length)},R:function(e,r){var n=t1(e);return nr(n,r.length)},u:function(e,r){var n=e.getUTCFullYear();return nr(n,r.length)},Q:function(e,r,n){var s=Math.ceil((e.getUTCMonth()+1)/3);switch(r){case"Q":return String(s);case"QQ":return nr(s,2);case"Qo":return n.ordinalNumber(s,{unit:"quarter"});case"QQQ":return n.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(s,{width:"wide",context:"formatting"})}},q:function(e,r,n){var s=Math.ceil((e.getUTCMonth()+1)/3);switch(r){case"q":return String(s);case"qq":return nr(s,2);case"qo":return n.ordinalNumber(s,{unit:"quarter"});case"qqq":return n.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(s,{width:"wide",context:"standalone"})}},M:function(e,r,n){var s=e.getUTCMonth();switch(r){case"M":case"MM":return Fs.M(e,r);case"Mo":return n.ordinalNumber(s+1,{unit:"month"});case"MMM":return n.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(s,{width:"wide",context:"formatting"})}},L:function(e,r,n){var s=e.getUTCMonth();switch(r){case"L":return String(s+1);case"LL":return nr(s+1,2);case"Lo":return n.ordinalNumber(s+1,{unit:"month"});case"LLL":return n.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(s,{width:"wide",context:"standalone"})}},w:function(e,r,n,s){var i=n1(e,s);return r==="wo"?n.ordinalNumber(i,{unit:"week"}):nr(i,r.length)},I:function(e,r,n){var s=r1(e);return r==="Io"?n.ordinalNumber(s,{unit:"week"}):nr(s,r.length)},d:function(e,r,n){return r==="do"?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):Fs.d(e,r)},D:function(e,r,n){var s=H5(e);return r==="Do"?n.ordinalNumber(s,{unit:"dayOfYear"}):nr(s,r.length)},E:function(e,r,n){var s=e.getUTCDay();switch(r){case"E":case"EE":case"EEE":return n.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(s,{width:"short",context:"formatting"});case"EEEE":default:return n.day(s,{width:"wide",context:"formatting"})}},e:function(e,r,n,s){var i=e.getUTCDay(),o=(i-s.weekStartsOn+8)%7||7;switch(r){case"e":return String(o);case"ee":return nr(o,2);case"eo":return n.ordinalNumber(o,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});case"eeee":default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,r,n,s){var i=e.getUTCDay(),o=(i-s.weekStartsOn+8)%7||7;switch(r){case"c":return String(o);case"cc":return nr(o,r.length);case"co":return n.ordinalNumber(o,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});case"cccc":default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,r,n){var s=e.getUTCDay(),i=s===0?7:s;switch(r){case"i":return String(i);case"ii":return nr(i,r.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(s,{width:"short",context:"formatting"});case"iiii":default:return n.day(s,{width:"wide",context:"formatting"})}},a:function(e,r,n){var s=e.getUTCHours(),i=s/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(e,r,n){var s=e.getUTCHours(),i;switch(s===12?i=Gi.noon:s===0?i=Gi.midnight:i=s/12>=1?"pm":"am",r){case"b":case"bb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(e,r,n){var s=e.getUTCHours(),i;switch(s>=17?i=Gi.evening:s>=12?i=Gi.afternoon:s>=4?i=Gi.morning:i=Gi.night,r){case"B":case"BB":case"BBB":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(e,r,n){if(r==="ho"){var s=e.getUTCHours()%12;return s===0&&(s=12),n.ordinalNumber(s,{unit:"hour"})}return Fs.h(e,r)},H:function(e,r,n){return r==="Ho"?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):Fs.H(e,r)},K:function(e,r,n){var s=e.getUTCHours()%12;return r==="Ko"?n.ordinalNumber(s,{unit:"hour"}):nr(s,r.length)},k:function(e,r,n){var s=e.getUTCHours();return s===0&&(s=24),r==="ko"?n.ordinalNumber(s,{unit:"hour"}):nr(s,r.length)},m:function(e,r,n){return r==="mo"?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):Fs.m(e,r)},s:function(e,r,n){return r==="so"?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):Fs.s(e,r)},S:function(e,r){return Fs.S(e,r)},X:function(e,r,n,s){var i=s._originalDate||e,o=i.getTimezoneOffset();if(o===0)return"Z";switch(r){case"X":return Gp(o);case"XXXX":case"XX":return li(o);case"XXXXX":case"XXX":default:return li(o,":")}},x:function(e,r,n,s){var i=s._originalDate||e,o=i.getTimezoneOffset();switch(r){case"x":return Gp(o);case"xxxx":case"xx":return li(o);case"xxxxx":case"xxx":default:return li(o,":")}},O:function(e,r,n,s){var i=s._originalDate||e,o=i.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+Vp(o,":");case"OOOO":default:return"GMT"+li(o,":")}},z:function(e,r,n,s){var i=s._originalDate||e,o=i.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+Vp(o,":");case"zzzz":default:return"GMT"+li(o,":")}},t:function(e,r,n,s){var i=s._originalDate||e,o=Math.floor(i.getTime()/1e3);return nr(o,r.length)},T:function(e,r,n,s){var i=s._originalDate||e,o=i.getTime();return nr(o,r.length)}};function Vp(t,e){var r=t>0?"-":"+",n=Math.abs(t),s=Math.floor(n/60),i=n%60;if(i===0)return r+String(s);var o=e;return r+String(s)+o+nr(i,2)}function Gp(t,e){if(t%60===0){var r=t>0?"-":"+";return r+nr(Math.abs(t)/60,2)}return li(t,e)}function li(t,e){var r=e||"",n=t>0?"-":"+",s=Math.abs(t),i=nr(Math.floor(s/60),2),o=nr(s%60,2);return n+i+r+o}var Qp=function(e,r){switch(e){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},a1=function(e,r){switch(e){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},K5=function(e,r){var n=e.match(/(P+)(p+)?/)||[],s=n[1],i=n[2];if(!i)return Qp(e,r);var o;switch(s){case"P":o=r.dateTime({width:"short"});break;case"PP":o=r.dateTime({width:"medium"});break;case"PPP":o=r.dateTime({width:"long"});break;case"PPPP":default:o=r.dateTime({width:"full"});break}return o.replace("{{date}}",Qp(s,r)).replace("{{time}}",a1(i,r))},fh={p:a1,P:K5},X5=["D","DD"],Z5=["YY","YYYY"];function s1(t){return X5.indexOf(t)!==-1}function i1(t){return Z5.indexOf(t)!==-1}function ou(t,e,r){if(t==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(e,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(t==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(e,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(t==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(e,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(t==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(e,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var ew={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},tw=function(e,r,n){var s,i=ew[e];return typeof i=="string"?s=i:r===1?s=i.one:s=i.other.replace("{{count}}",r.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+s:s+" ago":s};function Ld(t){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=e.width?String(e.width):t.defaultWidth,n=t.formats[r]||t.formats[t.defaultWidth];return n}}var rw={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},nw={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},aw={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},sw={date:Ld({formats:rw,defaultWidth:"full"}),time:Ld({formats:nw,defaultWidth:"full"}),dateTime:Ld({formats:aw,defaultWidth:"full"})},iw={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},ow=function(e,r,n,s){return iw[e]};function ul(t){return function(e,r){var n=r!=null&&r.context?String(r.context):"standalone",s;if(n==="formatting"&&t.formattingValues){var i=t.defaultFormattingWidth||t.defaultWidth,o=r!=null&&r.width?String(r.width):i;s=t.formattingValues[o]||t.formattingValues[i]}else{var l=t.defaultWidth,u=r!=null&&r.width?String(r.width):t.defaultWidth;s=t.values[u]||t.values[l]}var d=t.argumentCallback?t.argumentCallback(e):e;return s[d]}}var lw={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},cw={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},uw={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},dw={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},hw={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},fw={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},pw=function(e,r){var n=Number(e),s=n%100;if(s>20||s<10)switch(s%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},mw={ordinalNumber:pw,era:ul({values:lw,defaultWidth:"wide"}),quarter:ul({values:cw,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:ul({values:uw,defaultWidth:"wide"}),day:ul({values:dw,defaultWidth:"wide"}),dayPeriod:ul({values:hw,defaultWidth:"wide",formattingValues:fw,defaultFormattingWidth:"wide"})};function dl(t){return function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=r.width,s=n&&t.matchPatterns[n]||t.matchPatterns[t.defaultMatchWidth],i=e.match(s);if(!i)return null;var o=i[0],l=n&&t.parsePatterns[n]||t.parsePatterns[t.defaultParseWidth],u=Array.isArray(l)?vw(l,function(m){return m.test(o)}):gw(l,function(m){return m.test(o)}),d;d=t.valueCallback?t.valueCallback(u):u,d=r.valueCallback?r.valueCallback(d):d;var f=e.slice(o.length);return{value:d,rest:f}}}function gw(t,e){for(var r in t)if(t.hasOwnProperty(r)&&e(t[r]))return r}function vw(t,e){for(var r=0;r<t.length;r++)if(e(t[r]))return r}function xw(t){return function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.match(t.matchPattern);if(!n)return null;var s=n[0],i=e.match(t.parsePattern);if(!i)return null;var o=t.valueCallback?t.valueCallback(i[0]):i[0];o=r.valueCallback?r.valueCallback(o):o;var l=e.slice(s.length);return{value:o,rest:l}}}var yw=/^(\d+)(th|st|nd|rd)?/i,bw=/\d+/i,ww={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},_w={any:[/^b/i,/^(a|c)/i]},jw={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Sw={any:[/1/i,/2/i,/3/i,/4/i]},Cw={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Pw={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},kw={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Aw={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Lw={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Nw={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Ew={ordinalNumber:xw({matchPattern:yw,parsePattern:bw,valueCallback:function(e){return parseInt(e,10)}}),era:dl({matchPatterns:ww,defaultMatchWidth:"wide",parsePatterns:_w,defaultParseWidth:"any"}),quarter:dl({matchPatterns:jw,defaultMatchWidth:"wide",parsePatterns:Sw,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:dl({matchPatterns:Cw,defaultMatchWidth:"wide",parsePatterns:Pw,defaultParseWidth:"any"}),day:dl({matchPatterns:kw,defaultMatchWidth:"wide",parsePatterns:Aw,defaultParseWidth:"any"}),dayPeriod:dl({matchPatterns:Lw,defaultMatchWidth:"any",parsePatterns:Nw,defaultParseWidth:"any"})},Fh={code:"en-US",formatDistance:tw,formatLong:sw,formatRelative:ow,localize:mw,match:Ew,options:{weekStartsOn:0,firstWeekContainsDate:1}},Ow=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Iw=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Dw=/^'([^]*?)'?$/,Tw=/''/g,Mw=/[a-zA-Z]/;function o1(t,e,r){var n,s,i,o,l,u,d,f,m,v,p,b,w,y,j,O,k,I;pt(2,arguments);var H=String(e),F=as(),U=(n=(s=r?.locale)!==null&&s!==void 0?s:F.locale)!==null&&n!==void 0?n:Fh,C=mr((i=(o=(l=(u=r?.firstWeekContainsDate)!==null&&u!==void 0?u:r==null||(d=r.locale)===null||d===void 0||(f=d.options)===null||f===void 0?void 0:f.firstWeekContainsDate)!==null&&l!==void 0?l:F.firstWeekContainsDate)!==null&&o!==void 0?o:(m=F.locale)===null||m===void 0||(v=m.options)===null||v===void 0?void 0:v.firstWeekContainsDate)!==null&&i!==void 0?i:1);if(!(C>=1&&C<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var N=mr((p=(b=(w=(y=r?.weekStartsOn)!==null&&y!==void 0?y:r==null||(j=r.locale)===null||j===void 0||(O=j.options)===null||O===void 0?void 0:O.weekStartsOn)!==null&&w!==void 0?w:F.weekStartsOn)!==null&&b!==void 0?b:(k=F.locale)===null||k===void 0||(I=k.options)===null||I===void 0?void 0:I.weekStartsOn)!==null&&p!==void 0?p:0);if(!(N>=0&&N<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!U.localize)throw new RangeError("locale must contain localize property");if(!U.formatLong)throw new RangeError("locale must contain formatLong property");var Q=mt(t);if(!Kg(Q))throw new RangeError("Invalid time value");var P=iu(Q),L=e1(Q,P),te={firstWeekContainsDate:C,weekStartsOn:N,locale:U,_originalDate:Q},W=H.match(Iw).map(function(z){var V=z[0];if(V==="p"||V==="P"){var Y=fh[V];return Y(z,U.formatLong)}return z}).join("").match(Ow).map(function(z){if(z==="''")return"'";var V=z[0];if(V==="'")return Fw(z);var Y=J5[V];if(Y)return!(r!=null&&r.useAdditionalWeekYearTokens)&&i1(z)&&ou(z,e,String(t)),!(r!=null&&r.useAdditionalDayOfYearTokens)&&s1(z)&&ou(z,e,String(t)),Y(L,z,U.localize,te);if(V.match(Mw))throw new RangeError("Format string contains an unescaped latin alphabet character `"+V+"`");return z}).join("");return W}function Fw(t){var e=t.match(Dw);return e?e[1].replace(Tw,"'"):t}function Rw(t,e){if(t==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}function qw(t,e){var r,n;pt(1,arguments);var s=mt(t);if(isNaN(s.getTime()))throw new RangeError("Invalid time value");var i=String((r=e?.format)!==null&&r!==void 0?r:"extended"),o=String((n=e?.representation)!==null&&n!==void 0?n:"complete");if(i!=="extended"&&i!=="basic")throw new RangeError("format must be 'extended' or 'basic'");if(o!=="date"&&o!=="time"&&o!=="complete")throw new RangeError("representation must be 'date', 'time', or 'complete'");var l="",u="",d=i==="extended"?"-":"",f=i==="extended"?":":"";if(o!=="time"){var m=nr(s.getDate(),2),v=nr(s.getMonth()+1,2),p=nr(s.getFullYear(),4);l="".concat(p).concat(d).concat(v).concat(d).concat(m)}if(o!=="date"){var b=s.getTimezoneOffset();if(b!==0){var w=Math.abs(b),y=nr(Math.floor(w/60),2),j=nr(w%60,2),O=b<0?"+":"-";u="".concat(O).concat(y,":").concat(j)}else u="Z";var k=nr(s.getHours(),2),I=nr(s.getMinutes(),2),H=nr(s.getSeconds(),2),F=l===""?"":"T",U=[k,I,H].join(f);l="".concat(l).concat(F).concat(U).concat(u)}return l}function Bw(t){pt(1,arguments);var e=mt(t),r=e.getDate();return r}function l1(t){pt(1,arguments);var e=mt(t),r=e.getFullYear(),n=e.getMonth(),s=new Date(0);return s.setFullYear(r,n+1,0),s.setHours(0,0,0,0),s.getDate()}function Uw(t){pt(1,arguments);var e=mt(t),r=e.getHours();return r}function Ww(t){pt(1,arguments);var e=mt(t),r=e.getMilliseconds();return r}function zw(t){pt(1,arguments);var e=mt(t),r=e.getMinutes();return r}function $w(t){pt(1,arguments);var e=mt(t),r=e.getMonth();return r}function Hw(t){pt(1,arguments);var e=mt(t),r=e.getSeconds();return r}function Yw(t,e){var r,n,s,i,o,l,u,d;pt(1,arguments);var f=mt(t),m=f.getFullYear(),v=as(),p=mr((r=(n=(s=(i=e?.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:v.firstWeekContainsDate)!==null&&n!==void 0?n:(u=v.locale)===null||u===void 0||(d=u.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&r!==void 0?r:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var b=new Date(0);b.setFullYear(m+1,0,p),b.setHours(0,0,0,0);var w=pi(b,e),y=new Date(0);y.setFullYear(m,0,p),y.setHours(0,0,0,0);var j=pi(y,e);return f.getTime()>=w.getTime()?m+1:f.getTime()>=j.getTime()?m:m-1}function Vw(t,e){var r,n,s,i,o,l,u,d;pt(1,arguments);var f=as(),m=mr((r=(n=(s=(i=e?.firstWeekContainsDate)!==null&&i!==void 0?i:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:f.firstWeekContainsDate)!==null&&n!==void 0?n:(u=f.locale)===null||u===void 0||(d=u.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&r!==void 0?r:1),v=Yw(t,e),p=new Date(0);p.setFullYear(v,0,m),p.setHours(0,0,0,0);var b=pi(p,e);return b}var Gw=6048e5;function Qw(t,e){pt(1,arguments);var r=mt(t),n=pi(r,e).getTime()-Vw(r,e).getTime();return Math.round(n/Gw)+1}function Jw(t){return pt(1,arguments),mt(t).getFullYear()}function Nd(t,e){pt(2,arguments);var r=mt(t),n=mt(e);return r.getTime()>n.getTime()}function hl(t,e){pt(2,arguments);var r=mt(t),n=mt(e);return r.getTime()<n.getTime()}function Kw(t,e){pt(2,arguments);var r=mt(t),n=mt(e);return r.getTime()===n.getTime()}function Jp(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function Xw(t,e){if(t){if(typeof t=="string")return Jp(t,e);var r={}.toString.call(t).slice(8,-1);return r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set"?Array.from(t):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Jp(t,e):void 0}}function Kp(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=Xw(t))||e){r&&(t=r);var n=0,s=function(){};return{s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(d){throw d},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i,o=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var d=r.next();return o=d.done,d},e:function(d){l=!0,i=d},f:function(){try{o||r.return==null||r.return()}finally{if(l)throw i}}}}function gr(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&D0(t,e)}function lu(t){return lu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},lu(t)}function c1(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c1=function(){return!!t})()}function Zw(t,e){if(e&&(br(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _t(t)}function vr(t){var e=c1();return function(){var r,n=lu(t);if(e){var s=lu(this).constructor;r=Reflect.construct(n,arguments,s)}else r=n.apply(this,arguments);return Zw(this,r)}}function lr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e_(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Lm(n.key),n)}}function cr(t,e,r){return e&&e_(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function bt(t,e,r){return(e=Lm(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var t_=10,u1=function(){function t(){lr(this,t),bt(this,"priority",void 0),bt(this,"subPriority",0)}return cr(t,[{key:"validate",value:function(r,n){return!0}}]),t}(),r_=function(t){gr(r,t);var e=vr(r);function r(n,s,i,o,l){var u;return lr(this,r),u=e.call(this),u.value=n,u.validateValue=s,u.setValue=i,u.priority=o,l&&(u.subPriority=l),u}return cr(r,[{key:"validate",value:function(s,i){return this.validateValue(s,this.value,i)}},{key:"set",value:function(s,i,o){return this.setValue(s,i,this.value,o)}}]),r}(u1),n_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",t_),bt(_t(n),"subPriority",-1),n}return cr(r,[{key:"set",value:function(s,i){if(i.timestampIsSet)return s;var o=new Date(0);return o.setFullYear(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),o.setHours(s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()),o}}]),r}(u1),wr=function(){function t(){lr(this,t),bt(this,"incompatibleTokens",void 0),bt(this,"priority",void 0),bt(this,"subPriority",void 0)}return cr(t,[{key:"run",value:function(r,n,s,i){var o=this.parse(r,n,s,i);return o?{setter:new r_(o.value,this.validate,this.set,this.priority,this.subPriority),rest:o.rest}:null}},{key:"validate",value:function(r,n,s){return!0}}]),t}(),a_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",140),bt(_t(n),"incompatibleTokens",["R","u","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){switch(i){case"G":case"GG":case"GGG":return o.era(s,{width:"abbreviated"})||o.era(s,{width:"narrow"});case"GGGGG":return o.era(s,{width:"narrow"});case"GGGG":default:return o.era(s,{width:"wide"})||o.era(s,{width:"abbreviated"})||o.era(s,{width:"narrow"})}}},{key:"set",value:function(s,i,o){return i.era=o,s.setUTCFullYear(o,0,1),s.setUTCHours(0,0,0,0),s}}]),r}(wr),pn={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},Ja={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function mn(t,e){return t&&{value:e(t.value),rest:t.rest}}function Jr(t,e){var r=e.match(t);return r?{value:parseInt(r[0],10),rest:e.slice(r[0].length)}:null}function Ka(t,e){var r=e.match(t);if(!r)return null;if(r[0]==="Z")return{value:0,rest:e.slice(1)};var n=r[1]==="+"?1:-1,s=r[2]?parseInt(r[2],10):0,i=r[3]?parseInt(r[3],10):0,o=r[5]?parseInt(r[5],10):0;return{value:n*(s*Nu+i*Lu+o*N5),rest:e.slice(r[0].length)}}function d1(t){return Jr(pn.anyDigitsSigned,t)}function on(t,e){switch(t){case 1:return Jr(pn.singleDigit,e);case 2:return Jr(pn.twoDigits,e);case 3:return Jr(pn.threeDigits,e);case 4:return Jr(pn.fourDigits,e);default:return Jr(new RegExp("^\\d{1,"+t+"}"),e)}}function cu(t,e){switch(t){case 1:return Jr(pn.singleDigitSigned,e);case 2:return Jr(pn.twoDigitsSigned,e);case 3:return Jr(pn.threeDigitsSigned,e);case 4:return Jr(pn.fourDigitsSigned,e);default:return Jr(new RegExp("^-?\\d{1,"+t+"}"),e)}}function Rh(t){switch(t){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function h1(t,e){var r=e>0,n=r?e:1-e,s;if(n<=50)s=t||100;else{var i=n+50,o=Math.floor(i/100)*100,l=t>=i%100;s=t+o-(l?100:0)}return r?s:1-s}function f1(t){return t%400===0||t%4===0&&t%100!==0}var s_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",130),bt(_t(n),"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){var l=function(d){return{year:d,isTwoDigitYear:i==="yy"}};switch(i){case"y":return mn(on(4,s),l);case"yo":return mn(o.ordinalNumber(s,{unit:"year"}),l);default:return mn(on(i.length,s),l)}}},{key:"validate",value:function(s,i){return i.isTwoDigitYear||i.year>0}},{key:"set",value:function(s,i,o){var l=s.getUTCFullYear();if(o.isTwoDigitYear){var u=h1(o.year,l);return s.setUTCFullYear(u,0,1),s.setUTCHours(0,0,0,0),s}var d=!("era"in i)||i.era===1?o.year:1-o.year;return s.setUTCFullYear(d,0,1),s.setUTCHours(0,0,0,0),s}}]),r}(wr),i_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",130),bt(_t(n),"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){var l=function(d){return{year:d,isTwoDigitYear:i==="YY"}};switch(i){case"Y":return mn(on(4,s),l);case"Yo":return mn(o.ordinalNumber(s,{unit:"year"}),l);default:return mn(on(i.length,s),l)}}},{key:"validate",value:function(s,i){return i.isTwoDigitYear||i.year>0}},{key:"set",value:function(s,i,o,l){var u=Mh(s,l);if(o.isTwoDigitYear){var d=h1(o.year,u);return s.setUTCFullYear(d,0,l.firstWeekContainsDate),s.setUTCHours(0,0,0,0),vi(s,l)}var f=!("era"in i)||i.era===1?o.year:1-o.year;return s.setUTCFullYear(f,0,l.firstWeekContainsDate),s.setUTCHours(0,0,0,0),vi(s,l)}}]),r}(wr),o_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",130),bt(_t(n),"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i){return cu(i==="R"?4:i.length,s)}},{key:"set",value:function(s,i,o){var l=new Date(0);return l.setUTCFullYear(o,0,4),l.setUTCHours(0,0,0,0),po(l)}}]),r}(wr),l_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",130),bt(_t(n),"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i){return cu(i==="u"?4:i.length,s)}},{key:"set",value:function(s,i,o){return s.setUTCFullYear(o,0,1),s.setUTCHours(0,0,0,0),s}}]),r}(wr),c_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",120),bt(_t(n),"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){switch(i){case"Q":case"QQ":return on(i.length,s);case"Qo":return o.ordinalNumber(s,{unit:"quarter"});case"QQQ":return o.quarter(s,{width:"abbreviated",context:"formatting"})||o.quarter(s,{width:"narrow",context:"formatting"});case"QQQQQ":return o.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return o.quarter(s,{width:"wide",context:"formatting"})||o.quarter(s,{width:"abbreviated",context:"formatting"})||o.quarter(s,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(s,i){return i>=1&&i<=4}},{key:"set",value:function(s,i,o){return s.setUTCMonth((o-1)*3,1),s.setUTCHours(0,0,0,0),s}}]),r}(wr),u_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",120),bt(_t(n),"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){switch(i){case"q":case"qq":return on(i.length,s);case"qo":return o.ordinalNumber(s,{unit:"quarter"});case"qqq":return o.quarter(s,{width:"abbreviated",context:"standalone"})||o.quarter(s,{width:"narrow",context:"standalone"});case"qqqqq":return o.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return o.quarter(s,{width:"wide",context:"standalone"})||o.quarter(s,{width:"abbreviated",context:"standalone"})||o.quarter(s,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(s,i){return i>=1&&i<=4}},{key:"set",value:function(s,i,o){return s.setUTCMonth((o-1)*3,1),s.setUTCHours(0,0,0,0),s}}]),r}(wr),d_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]),bt(_t(n),"priority",110),n}return cr(r,[{key:"parse",value:function(s,i,o){var l=function(d){return d-1};switch(i){case"M":return mn(Jr(pn.month,s),l);case"MM":return mn(on(2,s),l);case"Mo":return mn(o.ordinalNumber(s,{unit:"month"}),l);case"MMM":return o.month(s,{width:"abbreviated",context:"formatting"})||o.month(s,{width:"narrow",context:"formatting"});case"MMMMM":return o.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return o.month(s,{width:"wide",context:"formatting"})||o.month(s,{width:"abbreviated",context:"formatting"})||o.month(s,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(s,i){return i>=0&&i<=11}},{key:"set",value:function(s,i,o){return s.setUTCMonth(o,1),s.setUTCHours(0,0,0,0),s}}]),r}(wr),h_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",110),bt(_t(n),"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){var l=function(d){return d-1};switch(i){case"L":return mn(Jr(pn.month,s),l);case"LL":return mn(on(2,s),l);case"Lo":return mn(o.ordinalNumber(s,{unit:"month"}),l);case"LLL":return o.month(s,{width:"abbreviated",context:"standalone"})||o.month(s,{width:"narrow",context:"standalone"});case"LLLLL":return o.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return o.month(s,{width:"wide",context:"standalone"})||o.month(s,{width:"abbreviated",context:"standalone"})||o.month(s,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(s,i){return i>=0&&i<=11}},{key:"set",value:function(s,i,o){return s.setUTCMonth(o,1),s.setUTCHours(0,0,0,0),s}}]),r}(wr);function f_(t,e,r){pt(2,arguments);var n=mt(t),s=mr(e),i=n1(n,r)-s;return n.setUTCDate(n.getUTCDate()-i*7),n}var p_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",100),bt(_t(n),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){switch(i){case"w":return Jr(pn.week,s);case"wo":return o.ordinalNumber(s,{unit:"week"});default:return on(i.length,s)}}},{key:"validate",value:function(s,i){return i>=1&&i<=53}},{key:"set",value:function(s,i,o,l){return vi(f_(s,o,l),l)}}]),r}(wr);function m_(t,e){pt(2,arguments);var r=mt(t),n=mr(e),s=r1(r)-n;return r.setUTCDate(r.getUTCDate()-s*7),r}var g_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",100),bt(_t(n),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){switch(i){case"I":return Jr(pn.week,s);case"Io":return o.ordinalNumber(s,{unit:"week"});default:return on(i.length,s)}}},{key:"validate",value:function(s,i){return i>=1&&i<=53}},{key:"set",value:function(s,i,o){return po(m_(s,o))}}]),r}(wr),v_=[31,28,31,30,31,30,31,31,30,31,30,31],x_=[31,29,31,30,31,30,31,31,30,31,30,31],y_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",90),bt(_t(n),"subPriority",1),bt(_t(n),"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){switch(i){case"d":return Jr(pn.date,s);case"do":return o.ordinalNumber(s,{unit:"date"});default:return on(i.length,s)}}},{key:"validate",value:function(s,i){var o=s.getUTCFullYear(),l=f1(o),u=s.getUTCMonth();return l?i>=1&&i<=x_[u]:i>=1&&i<=v_[u]}},{key:"set",value:function(s,i,o){return s.setUTCDate(o),s.setUTCHours(0,0,0,0),s}}]),r}(wr),b_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",90),bt(_t(n),"subpriority",1),bt(_t(n),"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){switch(i){case"D":case"DD":return Jr(pn.dayOfYear,s);case"Do":return o.ordinalNumber(s,{unit:"date"});default:return on(i.length,s)}}},{key:"validate",value:function(s,i){var o=s.getUTCFullYear(),l=f1(o);return l?i>=1&&i<=366:i>=1&&i<=365}},{key:"set",value:function(s,i,o){return s.setUTCMonth(0,o),s.setUTCHours(0,0,0,0),s}}]),r}(wr);function qh(t,e,r){var n,s,i,o,l,u,d,f;pt(2,arguments);var m=as(),v=mr((n=(s=(i=(o=r?.weekStartsOn)!==null&&o!==void 0?o:r==null||(l=r.locale)===null||l===void 0||(u=l.options)===null||u===void 0?void 0:u.weekStartsOn)!==null&&i!==void 0?i:m.weekStartsOn)!==null&&s!==void 0?s:(d=m.locale)===null||d===void 0||(f=d.options)===null||f===void 0?void 0:f.weekStartsOn)!==null&&n!==void 0?n:0);if(!(v>=0&&v<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var p=mt(t),b=mr(e),w=p.getUTCDay(),y=b%7,j=(y+7)%7,O=(j<v?7:0)+b-w;return p.setUTCDate(p.getUTCDate()+O),p}var w_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",90),bt(_t(n),"incompatibleTokens",["D","i","e","c","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){switch(i){case"E":case"EE":case"EEE":return o.day(s,{width:"abbreviated",context:"formatting"})||o.day(s,{width:"short",context:"formatting"})||o.day(s,{width:"narrow",context:"formatting"});case"EEEEE":return o.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return o.day(s,{width:"short",context:"formatting"})||o.day(s,{width:"narrow",context:"formatting"});case"EEEE":default:return o.day(s,{width:"wide",context:"formatting"})||o.day(s,{width:"abbreviated",context:"formatting"})||o.day(s,{width:"short",context:"formatting"})||o.day(s,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(s,i){return i>=0&&i<=6}},{key:"set",value:function(s,i,o,l){return s=qh(s,o,l),s.setUTCHours(0,0,0,0),s}}]),r}(wr),__=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",90),bt(_t(n),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o,l){var u=function(f){var m=Math.floor((f-1)/7)*7;return(f+l.weekStartsOn+6)%7+m};switch(i){case"e":case"ee":return mn(on(i.length,s),u);case"eo":return mn(o.ordinalNumber(s,{unit:"day"}),u);case"eee":return o.day(s,{width:"abbreviated",context:"formatting"})||o.day(s,{width:"short",context:"formatting"})||o.day(s,{width:"narrow",context:"formatting"});case"eeeee":return o.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return o.day(s,{width:"short",context:"formatting"})||o.day(s,{width:"narrow",context:"formatting"});case"eeee":default:return o.day(s,{width:"wide",context:"formatting"})||o.day(s,{width:"abbreviated",context:"formatting"})||o.day(s,{width:"short",context:"formatting"})||o.day(s,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(s,i){return i>=0&&i<=6}},{key:"set",value:function(s,i,o,l){return s=qh(s,o,l),s.setUTCHours(0,0,0,0),s}}]),r}(wr),j_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",90),bt(_t(n),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o,l){var u=function(f){var m=Math.floor((f-1)/7)*7;return(f+l.weekStartsOn+6)%7+m};switch(i){case"c":case"cc":return mn(on(i.length,s),u);case"co":return mn(o.ordinalNumber(s,{unit:"day"}),u);case"ccc":return o.day(s,{width:"abbreviated",context:"standalone"})||o.day(s,{width:"short",context:"standalone"})||o.day(s,{width:"narrow",context:"standalone"});case"ccccc":return o.day(s,{width:"narrow",context:"standalone"});case"cccccc":return o.day(s,{width:"short",context:"standalone"})||o.day(s,{width:"narrow",context:"standalone"});case"cccc":default:return o.day(s,{width:"wide",context:"standalone"})||o.day(s,{width:"abbreviated",context:"standalone"})||o.day(s,{width:"short",context:"standalone"})||o.day(s,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(s,i){return i>=0&&i<=6}},{key:"set",value:function(s,i,o,l){return s=qh(s,o,l),s.setUTCHours(0,0,0,0),s}}]),r}(wr);function S_(t,e){pt(2,arguments);var r=mr(e);r%7===0&&(r=r-7);var n=1,s=mt(t),i=s.getUTCDay(),o=r%7,l=(o+7)%7,u=(l<n?7:0)+r-i;return s.setUTCDate(s.getUTCDate()+u),s}var C_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",90),bt(_t(n),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){var l=function(d){return d===0?7:d};switch(i){case"i":case"ii":return on(i.length,s);case"io":return o.ordinalNumber(s,{unit:"day"});case"iii":return mn(o.day(s,{width:"abbreviated",context:"formatting"})||o.day(s,{width:"short",context:"formatting"})||o.day(s,{width:"narrow",context:"formatting"}),l);case"iiiii":return mn(o.day(s,{width:"narrow",context:"formatting"}),l);case"iiiiii":return mn(o.day(s,{width:"short",context:"formatting"})||o.day(s,{width:"narrow",context:"formatting"}),l);case"iiii":default:return mn(o.day(s,{width:"wide",context:"formatting"})||o.day(s,{width:"abbreviated",context:"formatting"})||o.day(s,{width:"short",context:"formatting"})||o.day(s,{width:"narrow",context:"formatting"}),l)}}},{key:"validate",value:function(s,i){return i>=1&&i<=7}},{key:"set",value:function(s,i,o){return s=S_(s,o),s.setUTCHours(0,0,0,0),s}}]),r}(wr),P_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",80),bt(_t(n),"incompatibleTokens",["b","B","H","k","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){switch(i){case"a":case"aa":case"aaa":return o.dayPeriod(s,{width:"abbreviated",context:"formatting"})||o.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaaa":return o.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return o.dayPeriod(s,{width:"wide",context:"formatting"})||o.dayPeriod(s,{width:"abbreviated",context:"formatting"})||o.dayPeriod(s,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(s,i,o){return s.setUTCHours(Rh(o),0,0,0),s}}]),r}(wr),k_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",80),bt(_t(n),"incompatibleTokens",["a","B","H","k","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){switch(i){case"b":case"bb":case"bbb":return o.dayPeriod(s,{width:"abbreviated",context:"formatting"})||o.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbbb":return o.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return o.dayPeriod(s,{width:"wide",context:"formatting"})||o.dayPeriod(s,{width:"abbreviated",context:"formatting"})||o.dayPeriod(s,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(s,i,o){return s.setUTCHours(Rh(o),0,0,0),s}}]),r}(wr),A_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",80),bt(_t(n),"incompatibleTokens",["a","b","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){switch(i){case"B":case"BB":case"BBB":return o.dayPeriod(s,{width:"abbreviated",context:"formatting"})||o.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBBB":return o.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return o.dayPeriod(s,{width:"wide",context:"formatting"})||o.dayPeriod(s,{width:"abbreviated",context:"formatting"})||o.dayPeriod(s,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(s,i,o){return s.setUTCHours(Rh(o),0,0,0),s}}]),r}(wr),L_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",70),bt(_t(n),"incompatibleTokens",["H","K","k","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){switch(i){case"h":return Jr(pn.hour12h,s);case"ho":return o.ordinalNumber(s,{unit:"hour"});default:return on(i.length,s)}}},{key:"validate",value:function(s,i){return i>=1&&i<=12}},{key:"set",value:function(s,i,o){var l=s.getUTCHours()>=12;return l&&o<12?s.setUTCHours(o+12,0,0,0):!l&&o===12?s.setUTCHours(0,0,0,0):s.setUTCHours(o,0,0,0),s}}]),r}(wr),N_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",70),bt(_t(n),"incompatibleTokens",["a","b","h","K","k","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){switch(i){case"H":return Jr(pn.hour23h,s);case"Ho":return o.ordinalNumber(s,{unit:"hour"});default:return on(i.length,s)}}},{key:"validate",value:function(s,i){return i>=0&&i<=23}},{key:"set",value:function(s,i,o){return s.setUTCHours(o,0,0,0),s}}]),r}(wr),E_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",70),bt(_t(n),"incompatibleTokens",["h","H","k","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){switch(i){case"K":return Jr(pn.hour11h,s);case"Ko":return o.ordinalNumber(s,{unit:"hour"});default:return on(i.length,s)}}},{key:"validate",value:function(s,i){return i>=0&&i<=11}},{key:"set",value:function(s,i,o){var l=s.getUTCHours()>=12;return l&&o<12?s.setUTCHours(o+12,0,0,0):s.setUTCHours(o,0,0,0),s}}]),r}(wr),O_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",70),bt(_t(n),"incompatibleTokens",["a","b","h","H","K","t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){switch(i){case"k":return Jr(pn.hour24h,s);case"ko":return o.ordinalNumber(s,{unit:"hour"});default:return on(i.length,s)}}},{key:"validate",value:function(s,i){return i>=1&&i<=24}},{key:"set",value:function(s,i,o){var l=o<=24?o%24:o;return s.setUTCHours(l,0,0,0),s}}]),r}(wr),I_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",60),bt(_t(n),"incompatibleTokens",["t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){switch(i){case"m":return Jr(pn.minute,s);case"mo":return o.ordinalNumber(s,{unit:"minute"});default:return on(i.length,s)}}},{key:"validate",value:function(s,i){return i>=0&&i<=59}},{key:"set",value:function(s,i,o){return s.setUTCMinutes(o,0,0),s}}]),r}(wr),D_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",50),bt(_t(n),"incompatibleTokens",["t","T"]),n}return cr(r,[{key:"parse",value:function(s,i,o){switch(i){case"s":return Jr(pn.second,s);case"so":return o.ordinalNumber(s,{unit:"second"});default:return on(i.length,s)}}},{key:"validate",value:function(s,i){return i>=0&&i<=59}},{key:"set",value:function(s,i,o){return s.setUTCSeconds(o,0),s}}]),r}(wr),T_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",30),bt(_t(n),"incompatibleTokens",["t","T"]),n}return cr(r,[{key:"parse",value:function(s,i){var o=function(u){return Math.floor(u*Math.pow(10,-i.length+3))};return mn(on(i.length,s),o)}},{key:"set",value:function(s,i,o){return s.setUTCMilliseconds(o),s}}]),r}(wr),M_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",10),bt(_t(n),"incompatibleTokens",["t","T","x"]),n}return cr(r,[{key:"parse",value:function(s,i){switch(i){case"X":return Ka(Ja.basicOptionalMinutes,s);case"XX":return Ka(Ja.basic,s);case"XXXX":return Ka(Ja.basicOptionalSeconds,s);case"XXXXX":return Ka(Ja.extendedOptionalSeconds,s);case"XXX":default:return Ka(Ja.extended,s)}}},{key:"set",value:function(s,i,o){return i.timestampIsSet?s:new Date(s.getTime()-o)}}]),r}(wr),F_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",10),bt(_t(n),"incompatibleTokens",["t","T","X"]),n}return cr(r,[{key:"parse",value:function(s,i){switch(i){case"x":return Ka(Ja.basicOptionalMinutes,s);case"xx":return Ka(Ja.basic,s);case"xxxx":return Ka(Ja.basicOptionalSeconds,s);case"xxxxx":return Ka(Ja.extendedOptionalSeconds,s);case"xxx":default:return Ka(Ja.extended,s)}}},{key:"set",value:function(s,i,o){return i.timestampIsSet?s:new Date(s.getTime()-o)}}]),r}(wr),R_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",40),bt(_t(n),"incompatibleTokens","*"),n}return cr(r,[{key:"parse",value:function(s){return d1(s)}},{key:"set",value:function(s,i,o){return[new Date(o*1e3),{timestampIsSet:!0}]}}]),r}(wr),q_=function(t){gr(r,t);var e=vr(r);function r(){var n;lr(this,r);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i)),bt(_t(n),"priority",20),bt(_t(n),"incompatibleTokens","*"),n}return cr(r,[{key:"parse",value:function(s){return d1(s)}},{key:"set",value:function(s,i,o){return[new Date(o),{timestampIsSet:!0}]}}]),r}(wr),B_={G:new a_,y:new s_,Y:new i_,R:new o_,u:new l_,Q:new c_,q:new u_,M:new d_,L:new h_,w:new p_,I:new g_,d:new y_,D:new b_,E:new w_,e:new __,c:new j_,i:new C_,a:new P_,b:new k_,B:new A_,h:new L_,H:new N_,K:new E_,k:new O_,m:new I_,s:new D_,S:new T_,X:new M_,x:new F_,t:new R_,T:new q_},U_=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,W_=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,z_=/^'([^]*?)'?$/,$_=/''/g,H_=/\S/,Y_=/[a-zA-Z]/;function V_(t,e,r,n){var s,i,o,l,u,d,f,m,v,p,b,w,y,j,O,k,I,H;pt(3,arguments);var F=String(t),U=String(e),C=as(),N=(s=(i=n?.locale)!==null&&i!==void 0?i:C.locale)!==null&&s!==void 0?s:Fh;if(!N.match)throw new RangeError("locale must contain match property");var Q=mr((o=(l=(u=(d=n?.firstWeekContainsDate)!==null&&d!==void 0?d:n==null||(f=n.locale)===null||f===void 0||(m=f.options)===null||m===void 0?void 0:m.firstWeekContainsDate)!==null&&u!==void 0?u:C.firstWeekContainsDate)!==null&&l!==void 0?l:(v=C.locale)===null||v===void 0||(p=v.options)===null||p===void 0?void 0:p.firstWeekContainsDate)!==null&&o!==void 0?o:1);if(!(Q>=1&&Q<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var P=mr((b=(w=(y=(j=n?.weekStartsOn)!==null&&j!==void 0?j:n==null||(O=n.locale)===null||O===void 0||(k=O.options)===null||k===void 0?void 0:k.weekStartsOn)!==null&&y!==void 0?y:C.weekStartsOn)!==null&&w!==void 0?w:(I=C.locale)===null||I===void 0||(H=I.options)===null||H===void 0?void 0:H.weekStartsOn)!==null&&b!==void 0?b:0);if(!(P>=0&&P<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(U==="")return F===""?mt(r):new Date(NaN);var L={firstWeekContainsDate:Q,weekStartsOn:P,locale:N},te=[new n_],W=U.match(W_).map(function(ee){var ae=ee[0];if(ae in fh){var pe=fh[ae];return pe(ee,N.formatLong)}return ee}).join("").match(U_),z=[],V=Kp(W),Y;try{var E=function(){var ae=Y.value;!(n!=null&&n.useAdditionalWeekYearTokens)&&i1(ae)&&ou(ae,U,t),!(n!=null&&n.useAdditionalDayOfYearTokens)&&s1(ae)&&ou(ae,U,t);var pe=ae[0],ye=B_[pe];if(ye){var Le=ye.incompatibleTokens;if(Array.isArray(Le)){var se=z.find(function(ne){return Le.includes(ne.token)||ne.token===pe});if(se)throw new RangeError("The format string mustn't contain `".concat(se.fullToken,"` and `").concat(ae,"` at the same time"))}else if(ye.incompatibleTokens==="*"&&z.length>0)throw new RangeError("The format string mustn't contain `".concat(ae,"` and any other token at the same time"));z.push({token:pe,fullToken:ae});var Fe=ye.run(F,ae,N.match,L);if(!Fe)return{v:new Date(NaN)};te.push(Fe.setter),F=Fe.rest}else{if(pe.match(Y_))throw new RangeError("Format string contains an unescaped latin alphabet character `"+pe+"`");if(ae==="''"?ae="'":pe==="'"&&(ae=G_(ae)),F.indexOf(ae)===0)F=F.slice(ae.length);else return{v:new Date(NaN)}}};for(V.s();!(Y=V.n()).done;){var X=E();if(br(X)==="object")return X.v}}catch(ee){V.e(ee)}finally{V.f()}if(F.length>0&&H_.test(F))return new Date(NaN);var oe=te.map(function(ee){return ee.priority}).sort(function(ee,ae){return ae-ee}).filter(function(ee,ae,pe){return pe.indexOf(ee)===ae}).map(function(ee){return te.filter(function(ae){return ae.priority===ee}).sort(function(ae,pe){return pe.subPriority-ae.subPriority})}).map(function(ee){return ee[0]}),de=mt(r);if(isNaN(de.getTime()))return new Date(NaN);var A=e1(de,iu(de)),D={},J=Kp(oe),re;try{for(J.s();!(re=J.n()).done;){var ce=re.value;if(!ce.validate(A,L))return new Date(NaN);var fe=ce.set(A,D,L);Array.isArray(fe)?(A=fe[0],Rw(D,fe[1])):A=fe}}catch(ee){J.e(ee)}finally{J.f()}return A}function G_(t){return t.match(z_)[1].replace($_,"'")}function Xp(t){pt(1,arguments);var e=mt(t);return e.setMinutes(0,0,0),e}function Q_(t,e){pt(2,arguments);var r=Xp(t),n=Xp(e);return r.getTime()===n.getTime()}function J_(t,e){pt(2,arguments);var r=mt(t),n=mt(e);return r.getFullYear()===n.getFullYear()&&r.getMonth()===n.getMonth()}function K_(t,e){pt(2,arguments);var r=mt(t),n=mt(e);return r.getFullYear()===n.getFullYear()}function X_(t,e){pt(2,arguments);var r=mt(t).getTime(),n=mt(e.start).getTime(),s=mt(e.end).getTime();if(!(n<=s))throw new RangeError("Invalid interval");return r>=n&&r<=s}function Z_(t,e){var r;pt(1,arguments);var n=mr((r=void 0)!==null&&r!==void 0?r:2);if(n!==2&&n!==1&&n!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof t=="string"||Object.prototype.toString.call(t)==="[object String]"))return new Date(NaN);var s=nj(t),i;if(s.date){var o=aj(s.date,n);i=sj(o.restDateString,o.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);var l=i.getTime(),u=0,d;if(s.time&&(u=ij(s.time),isNaN(u)))return new Date(NaN);if(s.timezone){if(d=oj(s.timezone),isNaN(d))return new Date(NaN)}else{var f=new Date(l+u),m=new Date(0);return m.setFullYear(f.getUTCFullYear(),f.getUTCMonth(),f.getUTCDate()),m.setHours(f.getUTCHours(),f.getUTCMinutes(),f.getUTCSeconds(),f.getUTCMilliseconds()),m}return new Date(l+u+d)}var Ec={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},ej=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,tj=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,rj=/^([+-])(\d{2})(?::?(\d{2}))?$/;function nj(t){var e={},r=t.split(Ec.dateTimeDelimiter),n;if(r.length>2)return e;if(/:/.test(r[0])?n=r[0]:(e.date=r[0],n=r[1],Ec.timeZoneDelimiter.test(e.date)&&(e.date=t.split(Ec.timeZoneDelimiter)[0],n=t.substr(e.date.length,t.length))),n){var s=Ec.timezone.exec(n);s?(e.time=n.replace(s[1],""),e.timezone=s[1]):e.time=n}return e}function aj(t,e){var r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),n=t.match(r);if(!n)return{year:NaN,restDateString:""};var s=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:i===null?s:i*100,restDateString:t.slice((n[1]||n[2]).length)}}function sj(t,e){if(e===null)return new Date(NaN);var r=t.match(ej);if(!r)return new Date(NaN);var n=!!r[4],s=fl(r[1]),i=fl(r[2])-1,o=fl(r[3]),l=fl(r[4]),u=fl(r[5])-1;if(n)return hj(e,l,u)?lj(e,l,u):new Date(NaN);var d=new Date(0);return!uj(e,i,o)||!dj(e,s)?new Date(NaN):(d.setUTCFullYear(e,i,Math.max(s,o)),d)}function fl(t){return t?parseInt(t):1}function ij(t){var e=t.match(tj);if(!e)return NaN;var r=Ed(e[1]),n=Ed(e[2]),s=Ed(e[3]);return fj(r,n,s)?r*Nu+n*Lu+s*1e3:NaN}function Ed(t){return t&&parseFloat(t.replace(",","."))||0}function oj(t){if(t==="Z")return 0;var e=t.match(rj);if(!e)return 0;var r=e[1]==="+"?-1:1,n=parseInt(e[2]),s=e[3]&&parseInt(e[3])||0;return pj(n,s)?r*(n*Nu+s*Lu):NaN}function lj(t,e,r){var n=new Date(0);n.setUTCFullYear(t,0,4);var s=n.getUTCDay()||7,i=(e-1)*7+r+1-s;return n.setUTCDate(n.getUTCDate()+i),n}var cj=[31,null,31,30,31,30,31,31,30,31,30,31];function p1(t){return t%400===0||t%4===0&&t%100!==0}function uj(t,e,r){return e>=0&&e<=11&&r>=1&&r<=(cj[e]||(p1(t)?29:28))}function dj(t,e){return e>=1&&e<=(p1(t)?366:365)}function hj(t,e,r){return e>=1&&e<=53&&r>=0&&r<=6}function fj(t,e,r){return t===24?e===0&&r===0:r>=0&&r<60&&e>=0&&e<60&&t>=0&&t<25}function pj(t,e){return e>=0&&e<=59}function mj(t,e){pt(2,arguments);var r=mt(t),n=mr(e),s=r.getFullYear(),i=r.getDate(),o=new Date(0);o.setFullYear(s,n,15),o.setHours(0,0,0,0);var l=l1(o);return r.setMonth(n,Math.min(i,l)),r}function gj(t,e){pt(2,arguments);var r=mt(t),n=mr(e);return r.setDate(n),r}function vj(t,e){pt(2,arguments);var r=mt(t),n=mr(e);return r.setHours(n),r}function xj(t,e){pt(2,arguments);var r=mt(t),n=mr(e);return r.setMilliseconds(n),r}function yj(t,e){pt(2,arguments);var r=mt(t),n=mr(e);return r.setMinutes(n),r}function bj(t,e){pt(2,arguments);var r=mt(t),n=mr(e);return r.setSeconds(n),r}function wj(t,e){pt(2,arguments);var r=mt(t),n=mr(e);return isNaN(r.getTime())?new Date(NaN):(r.setFullYear(n),r)}const Zp=()=>{const{id:t}=bi(),[e,r]=_.useState(null),[n,s]=_.useState(null),[i,o]=_.useState(null),[l,u]=_.useState(!0),[d,f]=_.useState(null),[m,v]=_.useState(null),[p,b]=_.useState([]),[w,y]=_.useState(null),[j,O]=_.useState([]),[k,I]=_.useState(!1),H=Vr(),[F,U]=_.useState([]),[C,N]=_.useState(!1),[Q,P]=_.useState({}),[L,te]=_.useState({}),[W,z]=_.useState(null),[V,Y]=_.useState(""),[E,X]=_.useState(!1),[oe,de]=_.useState([]),[A,D]=_.useState(null),[J,re]=_.useState(!1),[ce,fe]=_.useState(!1),[ee,ae]=_.useState(null),[pe,ye]=_.useState(null);_.useEffect(()=>{(async()=>{if(t){u(!0),f(null);try{const[Re,st]=await Promise.all([xe.get(`/api/sales-orders/${t}`),xe.get("/api/customers")]),{salesOrder:it,lineItems:Lt}=Re.data;console.log("API Response - salesOrder:",it),console.log("API Response - lineItems:",Lt);const gt={...it,subtotal:it.subtotal?parseFloat(it.subtotal):null,gst_amount:it.gst_amount?parseFloat(it.gst_amount):null,total_amount:it.total_amount?parseFloat(it.total_amount):null,estimated_cost:it.estimated_cost?parseFloat(it.estimated_cost):null,line_items:Lt.map(xt=>({...xt,quantity:Math.round(Number(xt.quantity)),unit_price:parseFloat(xt.unit_price),line_amount:parseFloat(xt.line_amount)}))};console.log("Parsed SalesOrder:",gt),console.log("Setting fetchedLineItems to:",gt.line_items),r(gt),y(ar(it.sales_date)),U(gt.line_items);const St=st.data.map(xt=>({id:xt.customer_id,label:xt.customer_name}));b(St);const ct=St.find(xt=>xt.id===it.customer_id);v(ct||null);const Rt=await xe.get("/api/products");O(Rt.data.map(xt=>({id:xt.product_id,label:xt.product_name,description:xt.product_description}))),Y(it.terms||"")}catch(Re){console.error("Error fetching sales order:",Re),Re.response?.status===404?(f("Sales order not found. It may have been deleted."),setTimeout(()=>{H("/open-sales-orders")},3e3)):f("Failed to load sales order data. Please try again."),u(!1)}}})()},[t,H]),_.useEffect(()=>{(async()=>{try{const{data:Re}=await xe.get("/api/business-profile");if(s(Re),Re.logo_url){const st=Xd(Re.logo_url);o(st)}}catch(Re){console.error("Error fetching business profile:",Re),s(null),o(null)}})()},[]),_.useEffect(()=>{(async()=>{try{const Re=await xe.get("/api/settings/labour-rate");z(Re.data.labour_rate??null)}catch{z(null)}})()},[]),_.useEffect(()=>{console.log("SalesOrder changed:",e),console.log("FetchedLineItems:",F)},[e,F]);const Le=async(Ae,Re)=>{if(Re)try{const st=await kg(Re);P(it=>({...it,[Re]:st.quantity_on_hand}))}catch{P(it=>({...it,[Re]:0}))}},se=(Ae,Re,st)=>{U(it=>{const Lt=[...it],gt={...Lt[Ae],[Re]:st};if(Re==="quantity"&&parseFloat(st)<=0&&gt.part_number!=="LABOUR"&&gt.part_number!=="OVERHEAD")return Lt.filter((St,ct)=>ct!==Ae);if(Re==="part_number"&&(Le(Ae,st),te(St=>({...St,[Ae]:""}))),Re==="quantity"||Re==="unit_price"){const St=Vn(gt.quantity),ct=Vn(gt.unit_price);gt.line_amount=St*ct;const Rt=Q[gt.part_number];Rt!==void 0&&St>Rt?te(xt=>({...xt,[Ae]:`Cannot order more than available (${Rt})`})):te(xt=>({...xt,[Ae]:""}))}return Lt[Ae]=gt,Lt})},Fe=Ae=>{U(Re=>Re.filter((st,it)=>it!==Ae))},ne=async()=>{if(e)try{k&&e.status?.toLowerCase()!=="closed"&&await Pe();const Ae=await xe.get(`/api/sales-orders/${e.sales_order_id}/pdf`,{responseType:"blob"}),Re=new Blob([Ae.data],{type:"application/pdf"}),st=window.URL.createObjectURL(Re),it=document.createElement("a");it.href=st,it.download=`sales_order_${e.sales_order_number}.pdf`,document.body.appendChild(it),it.click(),document.body.removeChild(it),window.URL.revokeObjectURL(st)}catch(Ae){console.error("Error saving or downloading PDF:",Ae),ve.error("Failed to save or download PDF")}},R=async()=>{if(!e?.sales_order_id){ve.error("Sales order not loaded. Cannot reopen.");return}if(window.confirm("Are you sure you want to reopen this sales order?"))try{const Ae={...e,sales_order_id:Number(e.sales_order_id),customer_id:Number(e.customer_id),status:"Open",lineItems:e.line_items.map(Re=>({part_number:Re.part_number.trim(),part_description:Re.part_description.trim(),quantity:Number(Re.quantity),unit:Re.unit.trim(),unit_price:Number(Re.unit_price),line_amount:Number(Re.line_amount)}))};await xe.put(`/api/sales-orders/${e.sales_order_id}`,Ae),ve.success("Sales Order reopened successfully!"),H(`/open-sales-orders/${e.sales_order_id}`)}catch(Ae){let Re="Failed to reopen sales order.";Ae.response?.data?.error?Re=Ae.response.data.error:Ae.response?.data?.details?Re=Ae.response.data.details:Ae.response?.data?.message&&(Re=Ae.response.data.message),f(Re)}},be=_.useMemo(()=>e?.line_items?.map(Ae=>({part_number:Ae.part_number,part_description:Ae.part_description,quantity:Vn(Ae.quantity),unit:Ae.unit,unit_price:Vn(Ae.unit_price)}))||[],[e?.line_items]),je=_.useMemo(()=>su(be,5),[be]);je.subtotal,je.total_gst_amount,je.total_amount;const Pe=async()=>{try{I(!1),ve.success("Changes saved successfully!")}catch(Ae){let Re="Failed to save changes. Please try again.";Ae.response?.data?.error?Re=Ae.response.data.error:Ae.response?.data?.details?Re=Ae.response.data.details:Ae.response?.data?.message&&(Re=Ae.response.data.message),f(Re)}};e?.line_items.filter(Ae=>Ae.part_number!=="LABOUR");const He=async()=>{re(!0);try{const Ae=await xe.get("/api/sales-orders");de(Ae.data)}catch{ve.error("Failed to fetch sales orders for import")}finally{re(!1)}},Ye=()=>{X(!0),He()},nt=async()=>{if(A){re(!0);try{const Ae=await xe.get(`/api/sales-orders/${A.sales_order_id}`),{lineItems:Re}=Ae.data;r(st=>st?{...st,line_items:Re.map(it=>({...it,quantity:Math.round(Number(it.quantity)),unit_price:parseFloat(it.unit_price)||0,line_amount:parseFloat(it.line_amount)||0}))}:null),X(!1),D(null),ve.success("Line items imported successfully")}catch(Ae){console.error("Error importing line items:",Ae),ve.error("Failed to import line items")}finally{re(!1)}}},dt=async()=>{if(e?.sales_order_id){fe(!0),ae(null),ye(null);try{const Ae=await xe.post(`/api/sales-orders/${e.sales_order_id}/export-to-qbo`);ve.success("Exported to QuickBooks successfully!"),ye("Exported to QuickBooks successfully!");const Re=await xe.get(`/api/sales-orders/${e.sales_order_id}`),{salesOrder:st}=Re.data;r(it=>it?{...it,...st}:null)}catch(Ae){ae(Ae?.response?.data?.error||"Failed to export to QuickBooks."),ve.error("Failed to export to QuickBooks.")}finally{fe(!1)}}};return l?a.jsxs(er,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[a.jsx(pr,{}),a.jsx(q,{children:"Loading sales order details..."})]}):d?a.jsxs(er,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[a.jsx(Ct,{severity:"error",children:d}),a.jsx(Ce,{onClick:()=>window.location.reload(),sx:{mt:2},children:"Retry"})]}):e?a.jsxs(ue,{p:{xs:2,md:4},maxWidth:1e3,mx:"auto",children:[a.jsx(q,{variant:"h4",gutterBottom:!0,children:"Sales Order Details"}),k&&a.jsx(ue,{sx:{mb:2},children:a.jsx(Ce,{variant:"outlined",color:"secondary",onClick:Ye,children:"Import Line Items"})}),a.jsxs(Sr,{open:E,onClose:()=>X(!1),maxWidth:"sm",fullWidth:!0,children:[a.jsx(Cr,{children:"Import Line Items from Sales Order"}),a.jsx(Pr,{children:J?a.jsx(ue,{display:"flex",alignItems:"center",justifyContent:"center",minHeight:120,children:a.jsx(pr,{})}):a.jsx(sa,{options:oe,getOptionLabel:Ae=>{if(!Ae)return"";const Re=Ae.sales_order_number||"",st=Ae.customer_name||"",it=Ae.status||"";return`${Re} - ${st}${it?` (${Ae.status})`:""}`},value:A,onChange:(Ae,Re)=>D(Re),renderInput:Ae=>a.jsx(Oe,{...Ae,label:"Select Sales Order",fullWidth:!0}),isOptionEqualToValue:(Ae,Re)=>Ae.sales_order_id===Re?.sales_order_id})}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:()=>X(!1),children:"Cancel"}),a.jsx(Ce,{onClick:nt,disabled:!A||J,variant:"contained",children:"Import"})]})]}),a.jsx(Ir,{variant:"outlined",sx:{mb:3},children:a.jsx(Yr,{children:a.jsxs(Z,{container:!0,spacing:{xs:2,md:3},children:[a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"Sales Order #:"}),a.jsx(q,{variant:"body1",children:e.sales_order_number})]})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"Customer PO #:"}),a.jsx(q,{variant:"body1",children:e.customer_po_number||"N/A"})]})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"Estimated Price:"}),a.jsx(q,{variant:"body1",children:Zn(e.estimated_cost||0)})]})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"Product:"}),a.jsx(q,{variant:"body1",children:e.product_name||"N/A"})]})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"VIN #:"}),a.jsx(q,{variant:"body1",children:e.vin_number||"N/A"})]})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"Sales Date:"}),a.jsx(q,{variant:"body1",children:e.sales_date?o1(new Date(e.sales_date),"PPP"):"N/A"})]})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"Customer:"}),a.jsx(q,{variant:"body1",children:e.customer_name})]})}),a.jsx(Z,{item:!0,xs:12,children:a.jsxs(ue,{display:"flex",alignItems:"flex-start",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1,mt:.5},children:"Terms and Conditions:"}),k?a.jsx(Oe,{value:V,onChange:Ae=>Y(Ae.target.value),fullWidth:!0,multiline:!0,minRows:3,maxRows:8,placeholder:"Enter payment terms, delivery terms, or any other conditions..."}):a.jsx(q,{variant:"body1",children:V||"N/A"})]})})]})})}),a.jsx(q,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"Line Items"}),a.jsx("pre",{children:JSON.stringify(e.line_items,null,2)}),a.jsxs(ue,{sx:{mb:2},children:[a.jsxs(Z,{container:!0,spacing:2,alignItems:"center",children:[a.jsx(Z,{item:!0,xs:2,children:a.jsx("b",{children:"Part Number"})}),a.jsx(Z,{item:!0,xs:3,children:a.jsx("b",{children:"Part Description"})}),a.jsx(Z,{item:!0,xs:1,children:a.jsx("b",{children:"Qty"})}),a.jsx(Z,{item:!0,xs:1,children:a.jsx("b",{children:"Unit"})}),a.jsx(Z,{item:!0,xs:2,children:a.jsx("b",{children:"Unit Price"})}),a.jsx(Z,{item:!0,xs:2,children:a.jsx("b",{children:"Amount"})}),a.jsx(Z,{item:!0,xs:1})]}),k?F.map((Ae,Re)=>(console.log("EDIT MODE: Rendering unit for item:",Ae.part_number,Ae.unit),a.jsxs(Z,{container:!0,spacing:2,alignItems:"center",sx:{mt:1},children:[a.jsx(Z,{item:!0,xs:2,children:a.jsx(Oe,{value:Ae.part_number,onChange:st=>se(Re,"part_number",st.target.value),disabled:e.status?.toLowerCase()==="closed",size:"small",label:"Part #"})}),a.jsx(Z,{item:!0,xs:3,children:a.jsx(Oe,{value:Ae.part_description,onChange:st=>se(Re,"part_description",st.target.value),disabled:e.status?.toLowerCase()==="closed",size:"small",label:"Description"})}),a.jsx(Z,{item:!0,xs:1,children:a.jsx(Oe,{value:Ae.quantity,onChange:st=>se(Re,"quantity",st.target.value),disabled:e.status?.toLowerCase()==="closed",size:"small",label:"Qty",error:!!L[Re],helperText:L[Re]||(Ae.part_number&&Q[Ae.part_number]!==void 0?`Available: ${Q[Ae.part_number]}`:""),type:"number",inputProps:{min:0,onWheel:st=>st.currentTarget.blur()}})}),a.jsx(Z,{item:!0,xs:1,children:a.jsx(Oe,{value:Ae.unit,onChange:st=>se(Re,"unit",st.target.value),disabled:e.status?.toLowerCase()==="closed",size:"small",label:"Unit"})}),a.jsx(Z,{item:!0,xs:2,children:a.jsx(Oe,{value:Ae.part_number==="LABOUR"?W??0:Ae.unit_price,onChange:st=>se(Re,"unit_price",st.target.value),disabled:Ae.part_number==="LABOUR"||e.status?.toLowerCase()==="closed",size:"small",label:"Unit Price",type:"number",inputProps:{min:0,onWheel:st=>st.currentTarget.blur()}})}),a.jsx(Z,{item:!0,xs:2,children:a.jsx(q,{children:Ae.line_amount})}),a.jsx(Z,{item:!0,xs:1,children:a.jsx(Ce,{onClick:()=>Fe(Re),disabled:e.status?.toLowerCase()==="closed",color:"error",children:"Remove"})})]},Ae.sales_order_line_item_id||Re))):e.line_items.length===0?a.jsx(q,{color:"textSecondary",sx:{mt:2},children:"No line items found."}):e.line_items.map((Ae,Re)=>(console.log("READ-ONLY MODE: Rendering unit for item:",Ae.part_number,Ae.unit),a.jsxs(Z,{container:!0,spacing:2,alignItems:"center",sx:{mt:1},children:[a.jsx(Z,{item:!0,xs:2,children:a.jsx(q,{children:Ae.part_number})}),a.jsx(Z,{item:!0,xs:3,children:a.jsx(q,{children:Ae.part_description})}),a.jsx(Z,{item:!0,xs:1,children:a.jsx(q,{children:Ae.quantity})}),a.jsx(Z,{item:!0,xs:1,children:a.jsx(q,{children:Ae.unit})}),a.jsx(Z,{item:!0,xs:2,children:a.jsx(q,{children:Ae.part_number==="LABOUR"?W??0:Ae.unit_price})}),a.jsx(Z,{item:!0,xs:2,children:a.jsx(q,{children:Ae.line_amount})}),a.jsx(Z,{item:!0,xs:1})]},Ae.sales_order_line_item_id||Re)))]}),a.jsx(ue,{sx:{mt:2,p:2,bgcolor:"grey.100",borderRadius:1},children:a.jsxs(q,{variant:"body2",color:"textSecondary",children:["Debug: Status: ",e.status,", Exported: ",e.exported_to_qbo?"Yes":"No"]})}),a.jsxs(ue,{mt:4,display:"flex",justifyContent:{xs:"center",sm:"flex-end"},children:[a.jsx(Ce,{variant:"contained",color:"primary",onClick:ne,startIcon:a.jsx($r,{}),children:"Download PDF"}),e.status?.toLowerCase()==="closed"&&a.jsx(Ce,{variant:"contained",color:"success",onClick:dt,startIcon:a.jsx(yo,{}),sx:{ml:2},disabled:ce,children:ce?"Exporting...":"Export to QuickBooks"}),e.status?.toLowerCase()==="closed"&&a.jsx(Ce,{variant:"contained",color:"primary",onClick:R,sx:{ml:2},children:"REOPEN SO"})]}),e.exported_to_qbo?a.jsxs(Ct,{severity:"success",sx:{mt:2},children:["Exported to QuickBooks",e.qbo_export_date?` on ${new Date(e.qbo_export_date).toLocaleString()}`:"",e.qbo_invoice_id&&` (Invoice ID: ${e.qbo_invoice_id})`]}):e.qbo_export_status?a.jsxs(Ct,{severity:"error",sx:{mt:2},children:["QBO Export Error: ",e.qbo_export_status]}):null,ee&&a.jsx(Ct,{severity:"error",sx:{mt:2},children:ee}),pe&&a.jsx(Ct,{severity:"success",sx:{mt:2},children:pe}),a.jsx(ue,{sx:{mt:3,display:"flex",justifyContent:"flex-end"},children:k?a.jsx(Ce,{startIcon:a.jsx(Vs,{}),onClick:Pe,variant:"contained",children:"Save"}):a.jsx(Ce,{startIcon:a.jsx(Tl,{}),onClick:()=>I(!0),variant:"contained",children:"Edit"})})]}):a.jsx(ue,{p:4,children:a.jsx(q,{variant:"h5",children:"Sales Order not found"})})};var pl={},em;function _j(){if(em)return pl;em=1;var t=jn();Object.defineProperty(pl,"__esModule",{value:!0}),pl.default=void 0;var e=t(Cn()),r=Sn();return pl.default=(0,e.default)((0,r.jsx)("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"}),"DoneAll"),pl}var jj=_j();const ph=Dr(jj),tm=["Each","cm","ft","kg","pcs","hr","L"],ml=5,Sj=()=>{const{id:t}=bi(),e=Vr(),[r,n]=_.useState(null),[s,i]=_.useState(!0),[o,l]=_.useState(null),[u,d]=_.useState([]),[f,m]=_.useState([]),[v,p]=_.useState([]),[b,w]=_.useState([]),[y,j]=_.useState(null),[O,k]=_.useState(null),[I,H]=_.useState(null),[F,U]=_.useState(null),[C,N]=_.useState([]),Q=Ys(C,300),[P,L]=_.useState([]),[te,W]=_.useState(""),[z,V]=_.useState(""),[Y,E]=_.useState(""),[X,oe]=_.useState(""),de=_.useMemo(()=>Q.map(me=>({part_number:me.part_number,part_description:me.part_description,quantity:Vn(me.quantity),unit:me.unit,unit_price:Vn(me.unit_price)})),[Q]),A=_.useMemo(()=>su(de,ml),[de]),D=A.subtotal,J=A.total_gst_amount,re=A.total_amount,ce=r?.status?.toLowerCase()==="closed",[fe,ee]=_.useState(null),[ae,pe]=_.useState(null),[ye,Le]=_.useState(null),[se,Fe]=_.useState(null),[ne,R]=_.useState(null),[be,je]=_.useState(""),[Pe,He]=_.useState(""),[Ye,nt]=_.useState(!1),[dt,Ae]=_.useState(""),[Re,st]=_.useState(!1),[it,Lt]=_.useState(""),[gt,St]=_.useState(!1),[ct,Rt]=_.useState([]),[xt,Rr]=_.useState(null),[tr,rr]=_.useState(!1),[Pn,Bt]=_.useState(!1),[Xr,sr]=_.useState(null),[Zr,xn]=_.useState(!1),[_r,Pt]=_.useState(null),[Kt,Ln]=_.useState(null),[ir,Hr]=_.useState([]),[Nn,Nt]=_.useState([]),[kn,Ne]=_.useState([]),{user:Be}=Aa(),Ve=_.useRef(!1);_.useEffect(()=>{(async()=>{try{const he=await xe.get("/api/settings/labour-rate");Le(he.data.labour_rate??null)}catch{Le(null)}})()},[]),_.useEffect(()=>{(async()=>{try{const he=await xe.get("/api/settings/overhead-rate");Fe(he.data.overhead_rate??null)}catch{Fe(null)}})()},[]),_.useEffect(()=>{(async()=>{try{const he=await xe.get("/api/settings/supply-rate");R(he.data.supply_rate??null)}catch{R(null)}})()},[]),_.useEffect(()=>{P.length>0&&v.length>0&&wo()},[P,v]),_.useEffect(()=>{ye!==null&&L(me=>me.map(he=>he.part_number==="LABOUR"?{...he,unit_price:ye}:he))},[ye]),_.useEffect(()=>{se!==null&&L(me=>me.map(he=>he.part_number==="OVERHEAD"?{...he,unit_price:se}:he))},[se]),_.useEffect(()=>{L(me=>{const he=me.some(Xe=>Xe.part_number==="LABOUR"),Te=me.some(Xe=>Xe.part_number==="SUPPLY");if(ne!==null&&ne>0){if(he&&!Te)return[...me,{part_number:"SUPPLY",part_description:"Supply",quantity:"1",unit:"Each",unit_price:0,gst:ml,line_amount:0}];if(!he&&Te)return me.filter(Xe=>Xe.part_number!=="SUPPLY")}else if(Te)return me.filter(Xe=>Xe.part_number!=="SUPPLY");return me})},[ne,P]),_.useEffect(()=>{ne!==null&&ne>0&&L(me=>{const he=me.find(Xe=>Xe.part_number==="LABOUR"),Te=me.find(Xe=>Xe.part_number==="SUPPLY");if(he&&Te){const ht=parseFloat(he.line_amount?.toString()||"0")*(ne/100);if(Te.line_amount!==ht)return me.map(Et=>Et.part_number==="SUPPLY"?{...Et,line_amount:ht}:Et)}return me})},[ne,P.find(me=>me.part_number==="LABOUR")?.line_amount]);const Ke=async()=>{i(!0),l(null);try{const he=(await xe.get(`/api/sales-orders/${t}`)).data;n(he.salesOrder);const Te=(he.lineItems||[]).map(Br=>({...Br,quantity:Br.part_number==="SUPPLY"?"1":Br.quantity_sold?.toString()||"0",gst:ml}));L(Te),N(Te),Nt(Te),he.salesOrder&&(k(ar(he.salesOrder.sales_date)),U(he.salesOrder.estimated_cost||0),W(he.salesOrder.product_description||""),V(he.salesOrder.terms||""),E(he.salesOrder.customer_po_number||""),oe(he.salesOrder.vin_number||""));const ht=(await xe.get("/api/customers")).data.map(Br=>({id:Br.customer_id,label:Br.customer_name}));if(d(ht),he.salesOrder?.customer_id){const Br=ht.find(Ba=>Ba.id===he.salesOrder.customer_id);j(Br||null)}const Qt=(await xe.get("/api/products")).data.map(Br=>({id:Br.product_id,label:Br.product_name,description:Br.product_description}));if(m(Qt),he.salesOrder?.product_name){const Br=Qt.find(Ba=>Ba.label===he.salesOrder.product_name);H(Br||null)}const xr=await xe.get("/api/margin-schedule");w(xr.data);const Mn=(await xe.get("/api/inventory")).data;p(Mn)}catch(me){console.error("Error fetching sales order data:",me),me.response?.status===404?(l("Sales order not found. It may have been deleted."),setTimeout(()=>{e("/open-sales-orders")},3e3)):l("Failed to load sales order data. Please try again.")}finally{i(!1)}};_.useEffect(()=>{t&&!Ve.current&&P.length===0?Ke():Ve.current&&(Ve.current=!1)},[t]);const $t=me=>{if(me.key==="Enter"){me.preventDefault();const he=be.trim();if(!he)return;const Te=u.find(Xe=>Xe.label.toLowerCase()===he.toLowerCase());Te?(j(Te),je(Te.label)):(Ae(he),nt(!0))}},kt=me=>{if(me.key==="Enter"){me.preventDefault();const he=Pe.trim();if(!he)return;const Te=f.find(Xe=>Xe.label.toLowerCase()===he.toLowerCase());Te?(H(Te),He(Te.label)):(Lt(he),st(!0))}},ur=me=>{const he=[...b].sort((Te,Xe)=>Te.cost_lower_bound-Xe.cost_lower_bound);for(const Te of he){const Xe=parseFloat(String(Te.cost_lower_bound)),ht=parseFloat(String(Te.cost_upper_bound)),Et=parseFloat(String(Te.margin_factor));if(me>=Xe&&(me<ht||ht===null)||ht===null&&me>=Xe)return Et}return console.warn("No margin schedule found for cost:",me,"Returning factor of 1."),1},kr=me=>v.find(he=>he.part_number===me),ln=(me,he,Te)=>{N(Xe=>{const ht=[...Xe],Et={...ht[me],[he]:Te};if(parseFloat(Te)<=0&&Et.part_number!=="LABOUR"&&Et.part_number!=="OVERHEAD"&&Et.part_number!=="SUPPLY")return ht.filter((Er,Mn)=>Mn!==me);const Qt=Vn(Et.quantity),xr=Vn(Et.unit_price);return Et.line_amount=Th(Qt,xr),ht[me]=Et,ht})},$e=(me,he)=>{N(Te=>{const Xe=[...Te];if(he===null||he.trim()==="")Xe[me]={...Xe[me],part_number:"",part_description:"",quantity:"",unit:tm[0],unit_price:0,line_amount:0};else if(he.toUpperCase()==="LABOUR")Xe[me]={...Xe[me],part_number:"LABOUR",part_description:"Labour",unit:"hr",unit_price:ye??0};else if(he.toUpperCase()==="OVERHEAD")Xe[me]={...Xe[me],part_number:"OVERHEAD",part_description:"Overhead",unit:"hr",unit_price:se??0};else if(he.toUpperCase()==="SUPPLY")Xe[me]={...Xe[me],part_number:"SUPPLY",part_description:"Supply",unit:"",unit_price:0};else{const ht=kr(he);if(ht){const Et=parseFloat(String(ht.last_unit_cost))||0,Qt=ur(Et),xr=Et*Qt;Xe[me]={...Xe[me],part_number:he,part_description:ht.part_description||"",unit:ht.unit,unit_price:xr}}else Xe[me]={...Xe[me],part_number:he,part_description:"Part not found",unit_price:0}}return Xe})},ze=()=>{L(me=>[...me,{part_number:"",part_description:"",quantity:"",unit:tm[0],unit_price:0,gst:ml,line_amount:0}])},ut=()=>{Hr([...ir,{sales_order_id:Number(t)||0,part_number:"",part_description:"",quantity_to_order:"",unit:"Each",unit_price:0,line_amount:0}])},qt=me=>{Hr(ir.filter((he,Te)=>Te!==me))},qr=(me,he,Te)=>{const Xe=[...ir];Xe[me]={...Xe[me],[he]:Te};{const ht=parseFloat(Te)||0,Et=Xe[me].unit_price||0;Xe[me].line_amount=ht*Et}Hr(Xe)},Me=(me,he)=>{if(!he){Hr(Xe=>{const ht=[...Xe];return ht[me]={...ht[me],part_number:"",part_description:"",unit:"Each",unit_price:0,line_amount:0},ht});return}const Te=v.find(Xe=>Xe.part_number===he);if(Te){const Xe=parseFloat(String(Te.last_unit_cost))||0,ht=ur(Xe),Et=Xe*ht;Hr(Qt=>{const xr=[...Qt];return xr[me]={...xr[me],part_number:Te.part_number,part_description:Te.part_description,unit:Te.unit||"Each",unit_price:Et,line_amount:0},xr})}else Hr(Xe=>{const ht=[...Xe];return ht[me]={...ht[me],part_number:he,part_description:"",unit:"Each",unit_price:0,line_amount:0},ht})},Ue=me=>{sr(me),Bt(!0)},rt=()=>{Xr!==null&&(L(me=>me.filter((he,Te)=>Te!==Xr)),Bt(!1),sr(null))},Je=()=>{Bt(!1),sr(null)},Ot=async()=>{if(!t||!y||!O||!I){ve.error("Please fill in all required fields.");return}const me=[];P.filter(at=>!at.part_number||at.part_number.trim()==="").length>0&&me.push(" Line items with blank part numbers are not allowed. Please fill in the part number or remove the line item.");const Te=P.filter(at=>at.part_number&&at.part_number!=="LABOUR"&&at.part_number!=="OVERHEAD"&&at.part_number!=="SUPPLY").map(at=>at.part_number.trim().toLowerCase()),Xe=Te.filter((at,Ft)=>Te.indexOf(at)!==Ft);if(Xe.length>0){const at=[...new Set(Xe)];me.push(` Duplicate part numbers found: ${at.join(", ")}. Each part can only appear once in a sales order.`)}const ht=P.filter(at=>at.part_number==="LABOUR"||at.part_number==="OVERHEAD"||at.part_number==="SUPPLY"||!at.part_number||at.part_number.trim()===""?!1:(parseFloat(String(at.quantity))||0)===0);if(ht.length>0){const at=ht.map(Ft=>Ft.part_number).join(", ");me.push(` Line items with 0 quantity are not allowed: ${at}. Please set a quantity greater than 0 or remove these line items.`)}const Et=P.filter(at=>{if(at.part_number==="LABOUR"||at.part_number==="OVERHEAD"||at.part_number==="SUPPLY"||!at.part_number||at.part_number.trim()===""||(parseFloat(String(at.quantity))||0)===0)return!1;const Fn=v.find(ea=>ea.part_number.toLowerCase()===at.part_number.trim().toLowerCase());return!Fn||Fn.part_type==="supply"});if(Et.length>0){const Ft=Et.map(Fn=>{const ea=v.find(bs=>bs.part_number.toLowerCase()===Fn.part_number.trim().toLowerCase());if(ea){if(ea.part_type==="supply")return`${Fn.part_number} (supply part not allowed)`}else return`${Fn.part_number} (not found in inventory)`;return Fn.part_number}).join(", ");me.push(` Invalid part numbers: ${Ft}. Please check the part numbers or add these parts to inventory first.`)}if(me.length>0){const at="Sales Order Validation Errors",Ft=me.join(`

`);ve.error(`${at}

${Ft}

Please fix these issues before saving.`,{position:"top-center",autoClose:1e4,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0}),ee(`Cannot save: ${at}

${Ft}`);return}const Qt=[];ir.filter(at=>!at.part_number||at.part_number.trim()==="").length>0&&Qt.push(" Parts to Order items with blank part numbers are not allowed. Please fill in the part number or remove the item.");const Er=ir.filter(at=>at.part_number).map(at=>at.part_number.trim().toLowerCase()),Mn=Er.filter((at,Ft)=>Er.indexOf(at)!==Ft);if(Mn.length>0){const at=[...new Set(Mn)];Qt.push(` Duplicate part numbers in Parts to Order: ${at.join(", ")}. Each part can only appear once.`)}const Br=ir.filter(at=>!at.part_number||at.part_number.trim()===""?!1:parseFloat(String(at.quantity_to_order))<=0);if(Br.length>0){const at=Br.map(Ft=>Ft.part_number).join(", ");Qt.push(` Parts to Order items with 0 quantity are not allowed: ${at}. Please set a quantity greater than 0 or remove these items.`)}const Ba=ir.filter(at=>!at.part_number||at.part_number.trim()===""||parseFloat(String(at.quantity_to_order))<=0?!1:!v.find(Fn=>Fn.part_number.toLowerCase()===at.part_number.trim().toLowerCase()));if(Ba.length>0){const at=Ba.map(Ft=>Ft.part_number).join(", ");Qt.push(` Invalid part numbers in Parts to Order (not found in inventory): ${at}. Please check the part numbers or add these parts to inventory first.`)}if(Qt.length>0){const at="Parts to Order Validation Errors",Ft=Qt.join(`

`);ve.error(`${at}

${Ft}

Please fix these issues before saving.`,{position:"top-center",autoClose:1e4,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0}),ee(`Cannot save: ${at}

${Ft}`);return}ee(null);const Ua=[];for(const at of P)if(at.part_number!=="LABOUR"&&at.part_number!=="OVERHEAD"&&at.part_number!=="SUPPLY"){const Ft=parseFloat(at.quantity)||0,Fn=v.find(ea=>ea.part_number.toLowerCase()===at.part_number.toLowerCase());if(Fn&&Fn.part_type!=="supply"){const ea=parseFloat(Fn.quantity_on_hand)||0,bs=Nn.find(Ci=>Ci.part_number===at.part_number),ua=bs&&parseFloat(bs.quantity)||0,Wa=Ft-ua,da=ea-Wa;console.log(`Inventory validation for ${at.part_number}:`,{currentQuantitySold:ua,newQuantitySold:Ft,changeInQuantitySold:Wa,currentQuantityOnHand:ea,newQuantityOnHand:da}),da<0?(console.log(` Adding inventory warning for ${at.part_number}: newQuantityOnHand = ${da} < 0`),Ua.push({part_number:at.part_number,currentQuantitySold:ua,newQuantitySold:Ft,changeInQuantitySold:Wa,currentQuantityOnHand:ea,newQuantityOnHand:da,shortfall:Math.abs(da)})):console.log(` No inventory warning for ${at.part_number}: newQuantityOnHand = ${da} >= 0`)}}if(console.log(" Final inventoryWarnings array:",Ua),Ua.length>0){console.log(" INVENTORY VALIDATION FAILED - Blocking save:",Ua);const at=Ua.map(Ft=>`Insufficient inventory for part ${Ft.part_number} (requested: ${Ft.newQuantitySold}, available: ${Ft.currentQuantityOnHand})`).join(`
`);ee(at);return}else console.log(" INVENTORY VALIDATION PASSED - Proceeding with save");const _o=ir.filter(at=>at.part_number&&parseFloat(String(at.quantity_to_order))>0).map(at=>({sales_order_id:Number(t),part_number:at.part_number.trim(),part_description:at.part_description.trim(),quantity_needed:parseFloat(String(at.quantity_to_order))||0,unit:at.unit.trim(),unit_price:at.unit_price,line_amount:at.line_amount})),Si={customer_id:y.id,sales_date:O.toISOString(),product_name:I.label.trim(),product_description:te.trim(),customer_po_number:Y.trim(),vin_number:X.trim(),estimated_cost:F!=null?Number(F):0,subtotal:D!=null?Number(D):0,total_gst_amount:J!=null?Number(J):0,total_amount:re!=null?Number(re):0,status:"Open",terms:z.trim(),lineItems:P.map(at=>{const Ft={part_number:at.part_number.trim(),part_description:at.part_description.trim(),unit:at.unit.trim(),unit_price:at.unit_price!=null?parseFloat(String(at.unit_price)):0,line_amount:at.line_amount!=null?parseFloat(String(at.line_amount)):0};return at.part_number==="SUPPLY"?{...Ft,quantity_sold:1}:{...Ft,quantity_sold:at.quantity!==void 0&&at.quantity!==null&&at.quantity!==""?parseInt(String(at.quantity),10):0}}),partsToOrder:_o};try{const at=await xe.put(`/api/sales-orders/${t}`,Si);pe("Sales Order updated successfully!");try{await Ke()}catch(Ft){console.error("Failed to refresh sales order data:",Ft)}try{const Ft=await xe.get("/api/inventory");p(Ft.data)}catch(Ft){console.error("Failed to refresh inventory:",Ft)}window.dispatchEvent(new Event("inventory-updated")),window.dispatchEvent(new Event("supply-updated")),window.dispatchEvent(new Event("parts-to-order-updated")),Ve.current=!0}catch(at){console.error("Failed to update sales order:",at);let Ft="Failed to update sales order.";at.response?.data?.error?Ft=at.response.data.error:at.response?.data?.details?Ft=at.response.data.details:at.response?.data?.message&&(Ft=at.response.data.message),ee(Ft)}},Ht=async()=>{if(r)try{r.status?.toLowerCase()!=="closed"&&await Ot();const me=await xe.get(`/api/sales-orders/${r.sales_order_id}/pdf`,{responseType:"blob"}),he=new Blob([me.data],{type:"application/pdf"}),Te=window.URL.createObjectURL(he),Xe=document.createElement("a");Xe.href=Te,Xe.download=`sales_order_${r.sales_order_number}.pdf`,document.body.appendChild(Xe),Xe.click(),document.body.removeChild(Xe),window.URL.revokeObjectURL(Te);const ht=r.status?.toLowerCase()==="closed"?"PDF downloaded successfully!":"Sales order saved and PDF downloaded successfully!";ve.success(ht)}catch(me){console.error("Failed to save or download PDF:",me);let he="Failed to save or download PDF.";me.response?.data?.error?he=me.response.data.error:me.response?.data?.details?he=me.response.data.details:me.response?.data?.message&&(he=me.response.data.message),ee(he)}},Gr=async()=>{if(!t||!r)return;if(ir.some(he=>parseFloat(String(he.quantity_to_order))>0)){const he=ir.filter(Te=>parseFloat(String(Te.quantity_to_order))>0).map(Te=>`${Te.part_number} (${Te.quantity_to_order})`).join(", ");ve.error(`Cannot close sales order: The following parts still need to be ordered: ${he}. Please remove these parts from the "Parts to Order" section or set their quantities to 0 before closing.`,{position:"top-center",autoClose:8e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0});return}try{const he={customer_id:r.customer_id,sales_date:r.sales_date,product_name:r.product_name.trim(),product_description:te.trim(),terms:z.trim(),subtotal:D,total_gst_amount:J,total_amount:re,status:"Closed",estimated_cost:r.estimated_cost,lineItems:P.map(Te=>({...Te,part_number:Te.part_number.trim(),part_description:Te.part_description.trim(),unit:Te.unit.trim(),quantity_sold:Te.quantity!==void 0&&Te.quantity!==null&&Te.quantity!==""?parseInt(String(Te.quantity),10):0,unit_price:Te.unit_price!=null?parseFloat(String(Te.unit_price)):0,line_amount:Te.line_amount!=null?parseFloat(String(Te.line_amount)):0}))};await xe.put(`/api/sales-orders/${t}`,he),ve.success("Sales Order closed successfully!"),n(Te=>Te&&{...Te,status:"Closed"}),ee(null)}catch(he){console.error("Failed to close sales order:",he);let Te="Failed to close sales order.";he.response?.data?.error?Te=he.response.data.error:he.response?.data?.details?Te=he.response.data.details:he.response?.data?.message&&(Te=he.response.data.message),ee(Te)}},dr=async()=>{if(r)try{const me={customer_id:r.customer_id,sales_date:r.sales_date,product_name:r.product_name.trim(),product_description:te.trim(),terms:z.trim(),subtotal:D,total_gst_amount:J,total_amount:re,status:"Open",estimated_cost:r.estimated_cost,lineItems:P.map(he=>({...he,part_number:he.part_number.trim(),part_description:he.part_description.trim(),unit:he.unit.trim(),quantity_sold:he.quantity!==void 0&&he.quantity!==null&&he.quantity!==""?parseInt(String(he.quantity),10):0,unit_price:he.unit_price!=null?parseFloat(String(he.unit_price)):0,line_amount:he.line_amount!=null?parseFloat(String(he.line_amount)):0}))};await xe.put(`/api/sales-orders/${r.sales_order_id}`,me),ve.success("Sales Order reopened successfully!"),n(he=>he&&{...he,status:"Open"}),e(`/open-sales-orders/${r.sales_order_id}`)}catch(me){console.error("Failed to reopen sales order:",me);let he="Failed to reopen sales order.";me.response?.data?.error?he=me.response.data.error:me.response?.data?.details?he=me.response.data.details:me.response?.data?.message&&(he=me.response.data.message),ee(he)}},En=async()=>{if(!r)return;if(ir.some(he=>parseFloat(String(he.quantity_to_order))>0)){const he=ir.filter(Te=>parseFloat(String(Te.quantity_to_order))>0).map(Te=>`${Te.part_number} (${Te.quantity_to_order})`).join(", ");ve.error(`Cannot export to QuickBooks: The following parts still need to be ordered: ${he}. Please remove these parts from the "Parts to Order" section or set their quantities to 0 before exporting.`,{position:"top-center",autoClose:8e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0});return}xn(!0),Pt(null),Ln(null);try{const he=await xe.post(`/api/sales-orders/${r.sales_order_id}/export-to-qbo`);Ln("Sales Order exported to QuickBooks successfully!"),n(Te=>Te&&{...Te,exported_to_qbo:!0,qbo_invoice_id:he.data.qbo_invoice_id,qbo_export_date:new Date().toISOString(),qbo_export_status:"Success"}),ve.success("Sales Order exported to QuickBooks successfully!")}catch(he){if(he?.response?.data?.error==="CUSTOMER_NOT_FOUND"){const Te=he.response.data.customerData,Xe=he.response.data.customerName;if(window.confirm(`Customer '${Xe}' does not exist in QuickBooks.

Would you like to create this customer in QuickBooks and then export the Sales Order?

Customer Details:
- Name: ${Te.DisplayName}
- Email: ${Te.PrimaryEmailAddr?.Address||"N/A"}
- Phone: ${Te.PrimaryPhone?.FreeFormNumber||"N/A"}
- Address: ${Te.BillAddr?.Line1||"N/A"}, ${Te.BillAddr?.City||"N/A"}`))try{const Et=await xe.post(`/api/sales-orders/${r.sales_order_id}/export-to-qbo-with-customer`,{customerData:Te});ve.success("Customer created and Sales Order exported to QuickBooks successfully!"),Ln("Customer created and Sales Order exported to QuickBooks successfully!"),n(Qt=>Qt&&{...Qt,exported_to_qbo:!0,qbo_invoice_id:Et.data.qbo_invoice_id,qbo_export_date:new Date().toISOString(),qbo_export_status:"Success"})}catch(Et){Pt(Et?.response?.data?.error||"Failed to create customer and export to QuickBooks."),ve.error("Failed to create customer and export to QuickBooks.")}else Pt("Export cancelled. Customer must exist in QuickBooks to export this Sales Order.")}else if(he?.response?.data?.error==="Supply items not allowed in sales orders"){const ht=`Cannot export: Sales Order contains supply items which are not allowed: ${(he.response.data.supplyItems||[]).map(Et=>`${Et.part_number} (${Et.part_description})`).join(", ")}. Please remove these supply items from the sales order before exporting.`;Pt(ht),ve.error("Supply items not allowed in sales orders")}else{console.error("Failed to export sales order to QuickBooks:",he);let Te="Failed to export to QuickBooks.";he.response?.data?.error?Te=he.response.data.error:he.response?.data?.message&&(Te=he.response.data.message),Pt(Te),ve.error(Te)}}finally{xn(!1)}},Gs=()=>{if(!r)return null;const me=P||[];let he=me.reduce((Et,Qt)=>Et+(Number(Qt.line_amount)||0),0),Xe=he*.05,ht=he+Xe;return isNaN(he)&&(he=0),isNaN(Xe)&&(Xe=0),isNaN(ht)&&(ht=0),a.jsxs(ue,{p:{xs:2,md:4},maxWidth:1e3,mx:"auto",children:[a.jsx(q,{variant:"h4",gutterBottom:!0,children:"Sales Order Details"}),Kt&&a.jsx(Ct,{severity:"success",sx:{mb:2},onClose:()=>Ln(null),children:Kt}),_r&&a.jsx(Ct,{severity:"error",sx:{mb:2},onClose:()=>Pt(null),children:_r}),a.jsx(Ir,{variant:"outlined",sx:{mb:3},children:a.jsx(Yr,{children:a.jsxs(Z,{container:!0,spacing:{xs:2,md:3},children:[a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"Sales Order #:"}),a.jsx(q,{variant:"body1",children:r.sales_order_number})]})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"Customer:"}),a.jsx(q,{variant:"body1",children:r.customer_name||"N/A"})]})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"Sales Date:"}),a.jsx(q,{variant:"body1",children:r.sales_date?new Date(r.sales_date).toLocaleDateString():""})]})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"Status:"}),a.jsx(q,{variant:"body1",sx:{color:r.status==="closed"?"error.main":"success.main",fontWeight:"bold"},children:r.status?.toUpperCase()||"N/A"})]})}),a.jsx(Z,{item:!0,xs:12,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"Estimated Price:"}),a.jsx(q,{variant:"body1",children:Zn(r.estimated_cost||0)})]})}),a.jsx(Z,{item:!0,xs:12,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"Product Description:"}),a.jsx(q,{variant:"body1",children:r.product_description||"N/A"})]})}),a.jsx(Z,{item:!0,xs:12,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"Terms and Conditions:"}),a.jsx(q,{variant:"body1",children:r.terms||"N/A"})]})}),r.exported_to_qbo&&a.jsx(Z,{item:!0,xs:12,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"QBO Export Status:"}),a.jsxs(q,{variant:"body1",sx:{color:"success.main",fontWeight:"bold"},children:["Exported to QuickBooks",r.qbo_invoice_id&&` (Invoice ID: ${r.qbo_invoice_id})`,r.qbo_export_date&&` on ${new Date(r.qbo_export_date).toLocaleDateString()}`]})]})})]})})}),a.jsx(q,{variant:"h5",gutterBottom:!0,sx:{mt:{xs:2,md:4}},children:"Items"}),a.jsx(Ir,{variant:"outlined",children:a.jsxs(Yr,{children:[a.jsxs(Z,{container:!0,spacing:2,sx:{fontWeight:"bold",borderBottom:"1px solid #ccc",pb:1,mb:1},children:[a.jsx(Z,{item:!0,xs:6,sm:3,md:2,children:a.jsx(q,{variant:"subtitle2",sx:{fontSize:"1rem",fontWeight:600},children:"Part #"})}),a.jsx(Z,{item:!0,xs:6,sm:5,md:4,children:a.jsx(q,{variant:"subtitle2",sx:{fontSize:"1rem",fontWeight:600},children:"Description"})}),a.jsx(Z,{item:!0,xs:4,sm:2,md:1.5,children:a.jsx(q,{variant:"subtitle2",sx:{fontSize:"1rem",fontWeight:600},children:"Qty"})}),a.jsx(Z,{item:!0,xs:4,sm:2,md:1.5,children:a.jsx(q,{variant:"subtitle2",sx:{fontSize:"1rem",fontWeight:600},children:"UOM"})}),a.jsx(Z,{item:!0,xs:4,sm:2,md:1.5,children:a.jsx(q,{variant:"subtitle2",sx:{fontSize:"1rem",fontWeight:600},children:"Unit Cost"})}),a.jsx(Z,{item:!0,xs:4,sm:2,md:1,children:a.jsx(q,{variant:"subtitle2",sx:{fontSize:"1rem",fontWeight:600},children:"Amount"})})]}),me.map((Et,Qt)=>a.jsxs(Z,{container:!0,spacing:2,children:[a.jsx(Z,{item:!0,xs:6,sm:3,md:2,children:a.jsx(q,{variant:"body2",sx:{fontSize:"1.05rem"},children:Et.part_number})}),a.jsx(Z,{item:!0,xs:6,sm:5,md:4,children:a.jsx(q,{variant:"body2",sx:{fontSize:"1.05rem"},children:Et.part_description})}),a.jsx(Z,{item:!0,xs:4,sm:2,md:1.5,children:a.jsx(q,{variant:"body2",sx:{fontSize:"1.05rem"},children:Et.quantity})}),a.jsx(Z,{item:!0,xs:4,sm:2,md:1.5,children:a.jsx(q,{variant:"body2",sx:{fontSize:"1.05rem"},children:Et.unit})}),a.jsx(Z,{item:!0,xs:4,sm:2,md:1.5,children:a.jsx(q,{variant:"body2",sx:{fontSize:"1.05rem"},children:Zn(Et.unit_price)})}),a.jsx(Z,{item:!0,xs:4,sm:2,md:1,children:a.jsx(q,{variant:"body2",sx:{fontSize:"1.05rem"},children:Zn(Et.line_amount)})})]},Qt))]})}),a.jsxs(ue,{mt:4,display:"flex",flexDirection:"column",alignItems:"flex-end",children:[a.jsxs(q,{variant:"h6",children:["Subtotal: ",Zn(he)]}),a.jsxs(q,{variant:"h6",children:["Total GST: ",Zn(Xe)]}),a.jsxs(q,{variant:"h6",children:["Total Amount: ",Zn(ht)]})]}),a.jsxs(ue,{mt:4,display:"flex",justifyContent:{xs:"center",sm:"flex-end"},gap:2,children:[a.jsx(Ce,{variant:"contained",color:"primary",startIcon:a.jsx($r,{}),onClick:Ht,children:"Download PDF"}),!r.exported_to_qbo&&a.jsx(Ce,{variant:"contained",color:"success",startIcon:a.jsx(yo,{}),onClick:En,disabled:Zr,children:Zr?"Exporting...":"Export to QuickBooks"}),a.jsx(Ce,{variant:"contained",color:"primary",onClick:dr,children:"Reopen SO"})]})]})},Qs=async()=>{rr(!0);try{const me=await xe.get("/api/sales-orders");Rt(me.data)}catch{ve.error("Failed to fetch sales orders for import")}finally{rr(!1)}},bo=()=>{St(!0),Qs()},ji=async()=>{if(xt){rr(!0);try{const me=await xe.get(`/api/sales-orders/${xt.sales_order_id}`),Te=(me.data.lineItems||me.data.salesOrder?.line_items||[]).filter(Xe=>(Xe.part_number||"").toUpperCase()!=="LABOUR");L(Te.map(Xe=>({part_number:Xe.part_number,part_description:Xe.part_description,unit:Xe.unit,unit_price:Xe.unit_price,line_amount:Xe.line_amount,quantity:String(Xe.quantity_sold),gst:ml}))),St(!1),Rr(null),ve.success("Line items imported!")}catch{ve.error("Failed to import line items")}finally{rr(!1)}}},ss=(me,he)=>{if(me.part_number==="LABOUR"||me.part_number==="OVERHEAD"||me.part_number==="SUPPLY")return null;const Te=v.find(Br=>Br.part_number.toLowerCase()===me.part_number.toLowerCase());if(!Te||Te.part_type==="supply")return null;const Xe=parseFloat(Te.quantity_on_hand)||0,ht=parseFloat(me.quantity)||0,Et=Nn.find(Br=>Br.part_number===me.part_number),Qt=Et&&parseFloat(Et.quantity)||0,xr=ht-Qt,Er=Xe-xr,Mn=Er<0?Math.floor(Er):Math.round(Er);return{available:Mn,currentStock:Xe,changeInQuantity:xr,isNegative:Mn<0}},ys=me=>{const he=P[me],Te=ss(he);if(!Te||!Te.isNegative)return;const Xe=Math.abs(Te.available),ht=v.find(xr=>xr.part_number.toLowerCase()===he.part_number.toLowerCase()),Et={sales_order_id:r?.sales_order_id||0,part_number:he.part_number,part_description:he.part_description,quantity_to_order:Xe.toString(),unit:he.unit,unit_price:ht?.last_unit_cost||0,line_amount:(ht?.last_unit_cost||0)*Xe};Hr(xr=>[...xr,Et]);const Qt=Math.max(0,parseFloat(he.quantity)-Xe);L(xr=>xr.map((Er,Mn)=>Mn===me?{...Er,quantity:Qt.toString()}:Er)),Ne(xr=>xr.filter(Er=>Er.lineItemIndex!==me)),ve.success(`Transferred ${Xe} ${he.unit} of ${he.part_number} to parts to order`)},wo=()=>{const me=[];P.forEach((he,Te)=>{const Xe=ss(he);Xe&&Xe.available<0&&me.push({lineItemIndex:Te,partNumber:he.part_number,partDescription:he.part_description,excessQuantity:Math.abs(Xe.available),unit:he.unit})}),Ne(me)};return s?a.jsxs(er,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[a.jsx(pr,{}),a.jsx(q,{children:"Loading sales order details..."})]}):o?a.jsxs(er,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[a.jsx(Ct,{severity:"error",sx:{mb:2},children:o}),a.jsx(Ce,{variant:"contained",onClick:()=>window.location.reload(),sx:{mr:2},children:"Retry"}),a.jsx(Ce,{variant:"outlined",onClick:()=>e("/open-sales-orders"),children:"Back to Sales Orders"})]}):ce?Gs():a.jsx(mi,{dateAdapter:Bl,children:a.jsxs(er,{maxWidth:"lg",sx:{mt:4,mb:4},children:[a.jsxs(ue,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[a.jsxs(q,{variant:"h4",component:"h1",gutterBottom:!0,children:["Edit Sales Order",r?.sales_order_number?`: ${r.sales_order_number}`:""]}),a.jsxs(ue,{sx:{display:"flex",gap:2},children:[a.jsx(Ce,{variant:"contained",color:"primary",startIcon:a.jsx(Vs,{}),onClick:Ot,children:"Save Changes"}),a.jsx(Ce,{variant:"contained",color:"primary",startIcon:a.jsx(ph,{}),onClick:Gr,disabled:!1,children:"Close SO"}),a.jsx(Ce,{variant:"contained",color:"primary",startIcon:a.jsx($r,{}),onClick:Ht,disabled:!1,children:"Download PDF"})]})]}),a.jsx(ue,{sx:{mb:2},children:a.jsx(Ce,{variant:"outlined",color:"secondary",onClick:bo,children:"Import Line Items"})}),a.jsxs(Sr,{open:gt,onClose:()=>St(!1),maxWidth:"sm",fullWidth:!0,children:[a.jsx(Cr,{children:"Import Line Items from Sales Order"}),a.jsx(Pr,{children:tr?a.jsx(ue,{display:"flex",alignItems:"center",justifyContent:"center",minHeight:120,children:a.jsx(pr,{})}):a.jsx(sa,{options:ct,getOptionLabel:me=>{if(!me)return"";const he=me.sales_order_number||"",Te=me.customer_name||"",Xe=me.status||"";return`${he} - ${Te}${Xe?` (${Xe})`:""}`},value:xt,onChange:(me,he)=>Rr(he),renderInput:me=>a.jsx(Oe,{...me,label:"Select Sales Order",fullWidth:!0}),isOptionEqualToValue:(me,he)=>me.sales_order_id===he?.sales_order_id})}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:()=>St(!1),children:"Cancel"}),a.jsx(Ce,{onClick:ji,disabled:!xt||tr,variant:"contained",children:"Import"})]})]}),fe&&a.jsxs(Ct,{severity:"warning",sx:{mb:3},onClose:()=>ee(null),children:[a.jsx(q,{variant:"body1",sx:{fontWeight:"medium"},children:"Inventory Error"}),a.jsx(q,{variant:"body2",children:fe})]}),a.jsx(uo,{open:!!ae,autoHideDuration:6e3,onClose:()=>pe(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:a.jsx(Ct,{onClose:()=>pe(null),severity:"success",sx:{width:"100%"},children:ae})}),a.jsx(At,{sx:{p:3,mb:3},elevation:3,children:a.jsxs(Z,{container:!0,spacing:3,children:[a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(sa,{value:y,onChange:(me,he)=>{typeof he=="string"?j({label:he,isNew:!0}):he&&he.isNew?(nt(!0),Ae(be),j(null),je("")):j(he)},inputValue:be,onInputChange:(me,he)=>je(he),options:u,getOptionLabel:me=>typeof me=="string"?me:me.label,renderInput:me=>a.jsx(Oe,{...me,label:"Customer",fullWidth:!0,required:!0,onKeyDown:$t})})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"Customer PO #",variant:"outlined",fullWidth:!0,value:Y,onChange:me=>E(me.target.value),placeholder:"Optional"})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"Estimated Price",type:"number",value:F??"",onChange:me=>U(me.target.value?parseFloat(me.target.value):null),fullWidth:!0,required:!0,InputProps:{startAdornment:a.jsx(Bn,{position:"start",children:"$"})},inputProps:{onWheel:me=>me.currentTarget.blur()}})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(sa,{value:I,onChange:(me,he)=>{he&&he.isNew?(st(!0),Lt(he.label.replace(/^Add \"|\"$/g,"")),H(null),He("")):H(he)},filterOptions:(me,he)=>{const Te=me.filter(Xe=>Xe.label.toLowerCase().includes(he.inputValue.toLowerCase()));return he.inputValue!==""&&!me.some(Xe=>Xe.label.toLowerCase()===he.inputValue.toLowerCase())&&Te.push({label:`Add "${he.inputValue}"`,isNew:!0}),Te},inputValue:Pe,onInputChange:(me,he)=>He(he),options:f,getOptionLabel:me=>typeof me=="string"?me:me.label,renderInput:me=>a.jsx(Oe,{...me,label:"Product Name",fullWidth:!0,required:!0,onKeyDown:kt}),disabled:ce})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"VIN #",variant:"outlined",fullWidth:!0,value:X,onChange:me=>oe(me.target.value),placeholder:"Optional"})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(ho,{label:"Sales Date",value:O,onChange:me=>k(me),sx:{width:"100%"},slotProps:{textField:{required:!0}}})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{label:"Product Description",value:te,onChange:me=>W(me.target.value),fullWidth:!0,multiline:!0,minRows:2,maxRows:6,sx:{mt:1}})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{label:"Terms and Conditions",value:z,onChange:me=>V(me.target.value),fullWidth:!0,multiline:!0,minRows:3,maxRows:8,sx:{mt:1},placeholder:"Enter payment terms, delivery terms, or any other conditions..."})})]})}),a.jsx(q,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Line Items"}),kn.length>0&&a.jsx(ue,{sx:{mb:2},children:kn.map((me,he)=>a.jsxs(Ct,{severity:"warning",sx:{mb:1,"& .MuiAlert-message":{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"}},children:[a.jsxs(ue,{children:[a.jsxs(q,{variant:"body2",fontWeight:"medium",children:["Insufficient stock for ",me.partNumber]}),a.jsxs(q,{variant:"body2",color:"text.secondary",children:["Excess quantity: ",me.excessQuantity," ",me.unit]})]}),a.jsxs(Ce,{variant:"contained",size:"small",color:"primary",onClick:()=>ys(me.lineItemIndex),sx:{ml:2,minWidth:"auto"},children:["Transfer ",me.excessQuantity," to Parts to Order"]})]},`${me.lineItemIndex}-${he}`))}),a.jsxs(At,{sx:{p:3,mb:3},elevation:3,children:[a.jsx(Z,{container:!0,spacing:2,children:P.map((he,Te)=>({item:he,originalIndex:Te})).sort((he,Te)=>{const Xe=he.item.part_number==="LABOUR"||he.item.part_number==="OVERHEAD"||he.item.part_number==="SUPPLY",ht=Te.item.part_number==="LABOUR"||Te.item.part_number==="OVERHEAD"||Te.item.part_number==="SUPPLY";return Xe&&!ht?1:!Xe&&ht?-1:0}).map(({item:he,originalIndex:Te},Xe)=>a.jsxs(vs.Fragment,{children:[a.jsx(Z,{item:!0,xs:12,sm:6,md:2,children:a.jsx(sa,{value:he.part_number,onChange:(ht,Et)=>$e(Te,Et),onInputChange:(ht,Et)=>{L(Qt=>{const xr=[...Qt];return xr[Te]={...xr[Te],part_number:Et.toUpperCase()},xr})},options:v.filter(ht=>ht.part_type!=="supply").map(ht=>ht.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,renderInput:ht=>a.jsx(Oe,{...ht,label:"Part Number",required:!0,fullWidth:!0})})}),a.jsx(Z,{item:!0,xs:12,sm:6,md:2,children:a.jsx(Oe,{label:"Part Description",value:he.part_description,fullWidth:!0,required:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),a.jsx(Z,{item:!0,xs:6,sm:3,md:1,children:a.jsx(Oe,{label:"Qty",value:he.quantity,onChange:ht=>ln(Te,"quantity",ht.target.value),type:"number",fullWidth:!0,required:!0,InputProps:{readOnly:he.part_number==="SUPPLY"||he.part_number==="LABOUR"||he.part_number==="OVERHEAD",disabled:he.part_number==="SUPPLY"||he.part_number==="LABOUR"||he.part_number==="OVERHEAD"},inputProps:{step:1,onWheel:ht=>ht.target.blur()}})}),a.jsx(Z,{item:!0,xs:6,sm:3,md:1,children:a.jsx(Oe,{label:"Avail",value:(()=>{const ht=ss(he);return ht?ht.available<0?`${ht.available} (Insufficient)`:String(ht.available):"N/A"})(),fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:(()=>{const ht=ss(he);return ht?ht.available>=0?"#e8f5e8":"#ffeaea":"#f5f5f5"})(),"& .MuiInputBase-input":{color:ss(he)?.isNegative?"#d32f2f":"#2e7d32"}}})}),a.jsx(Z,{item:!0,xs:6,sm:3,md:1,children:a.jsx(Oe,{label:"Unit",value:he.part_number==="SUPPLY"?"":he.unit,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),a.jsx(Z,{item:!0,xs:12,sm:2,md:1.5,children:a.jsx(Oe,{label:"Unit Cost",value:he.part_number==="LABOUR"?ye??0:he.part_number==="OVERHEAD"?se??0:he.part_number==="SUPPLY"?"":he.unit_price,type:"number",fullWidth:!0,InputProps:{readOnly:!0,startAdornment:he.part_number!=="SUPPLY"?a.jsx(Bn,{position:"start",children:"$"}):void 0,disabled:he.part_number==="LABOUR"||he.part_number==="OVERHEAD"||he.part_number==="SUPPLY"}})}),a.jsx(Z,{item:!0,xs:6,sm:3,md:1.5,children:a.jsx(Oe,{label:"Amount",value:he.line_amount!=null&&!isNaN(Number(he.line_amount))?Number(he.line_amount).toFixed(2):"0.00",InputProps:{readOnly:!0},fullWidth:!0})}),a.jsx(Z,{item:!0,xs:6,sm:3,md:1,sx:{display:"flex",alignItems:"center"},children:a.jsx(Ce,{variant:"outlined",color:"primary",onClick:()=>Ue(Te),fullWidth:!0,children:"Remove"})})]},Te))}),a.jsx(ue,{sx:{mt:2},children:a.jsx(Ce,{variant:"outlined",color:"primary",onClick:ze,children:"Add Line Item"})})]}),a.jsx(At,{sx:{p:3,mb:3},elevation:3,children:a.jsxs(Z,{container:!0,spacing:2,children:[a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsxs(q,{variant:"subtitle1",children:["Subtotal: ",Zn(D)]})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsxs(q,{variant:"subtitle1",children:["Total GST: ",Zn(J)]})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsxs(q,{variant:"h6",children:["Total Amount: ",Zn(re)]})})]})}),a.jsxs(At,{sx:{p:3,mb:3,elevation:3,border:"2px solid #b8860b","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#b8860b"},"&:hover fieldset":{borderColor:"#b8860b"}}},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Parts to Order"}),a.jsx(q,{variant:"body2",color:"textSecondary",sx:{mb:2},children:"Add parts that need to be ordered for this sales order. These quantities will be aggregated across all sales orders."}),a.jsx(Z,{container:!0,spacing:2,children:ir.map((me,he)=>a.jsxs(vs.Fragment,{children:[a.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:a.jsx(sa,{value:me.part_number,onChange:(Te,Xe)=>Me(he,Xe),onInputChange:(Te,Xe)=>{Hr(ht=>{const Et=[...ht];return Et[he]={...Et[he],part_number:Xe.toUpperCase()},Et})},options:v.filter(Te=>Te.part_type!=="supply").map(Te=>Te.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,renderInput:Te=>a.jsx(Oe,{...Te,label:"Part Number",fullWidth:!0,required:!0})})}),a.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Oe,{label:"Description",value:me.part_description,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#f5f5f5"}})}),a.jsx(Z,{item:!0,xs:6,sm:3,md:1,children:a.jsx(Oe,{label:"Qty to Order",value:me.quantity_to_order,onChange:Te=>qr(he,"quantity_to_order",Te.target.value),type:"number",fullWidth:!0,required:!0,inputProps:{step:1,min:0,onWheel:Te=>Te.target.blur()}})}),a.jsx(Z,{item:!0,xs:6,sm:3,md:1,children:a.jsx(Oe,{label:"Unit",value:me.unit,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),a.jsx(Z,{item:!0,xs:12,sm:1.5,children:a.jsx(Oe,{label:"Unit Price",value:me.unit_price,type:"number",fullWidth:!0,InputProps:{readOnly:!0,startAdornment:a.jsx(Bn,{position:"start",children:"$"})},sx:{backgroundColor:"#f5f5f5"}})}),a.jsx(Z,{item:!0,xs:6,sm:3,md:1.5,children:a.jsx(Oe,{label:"Amount",value:me.line_amount,InputProps:{readOnly:!0},fullWidth:!0})}),a.jsx(Z,{item:!0,xs:12,sm:1,md:1,sx:{display:"flex",alignItems:"center",gap:2},children:a.jsx(Ce,{variant:"outlined",onClick:()=>qt(he),sx:{flexShrink:0,borderColor:"#b8860b",color:"#b8860b","&:hover":{borderColor:"#8b6914",backgroundColor:"#fff8dc"}},children:"Remove"})})]},he))}),a.jsx(ue,{sx:{mt:2},children:a.jsx(Ce,{variant:"outlined",color:"primary",onClick:ut,children:"Add Parts to Order Item"})})]}),a.jsx(Ul,{open:Ye,onClose:()=>nt(!1),onSave:async me=>{try{const Te=(await xe.post("/api/customers",me)).data,Xe={label:Te.customer_name,id:Te.customer_id};d(ht=>[...ht,Xe]),j(Xe),nt(!1),ve.success("Customer added successfully!")}catch{ve.error("Failed to add customer")}},initialCustomer:{customer_name:dt},isEditMode:!1}),a.jsx(Pu,{open:Re,onClose:()=>st(!1),onSave:async me=>{try{const he=await xe.post("/api/products",me),Te={label:me.product_name,id:he.data.product_id,description:me.product_name};m(Xe=>[...Xe,Te]),H(Te),He(Te.label),st(!1),Lt(""),ve.success("Product added successfully!")}catch{ve.error("Failed to add product.")}},initialProduct:{product_name:it||Pe},isEditMode:!1}),a.jsxs(Sr,{open:Pn,onClose:Je,children:[a.jsx(Cr,{children:"Remove Line Item"}),a.jsxs(Pr,{children:[a.jsx(q,{children:"Are you sure you want to remove this line item? This action cannot be undone."}),Xr!==null&&P[Xr]&&a.jsxs(ue,{sx:{mt:2,p:2,bgcolor:"grey.100",borderRadius:1},children:[a.jsxs(q,{variant:"body2",fontWeight:"medium",children:["Part: ",P[Xr].part_number]}),a.jsxs(q,{variant:"body2",color:"text.secondary",children:["Description: ",P[Xr].part_description]}),a.jsxs(q,{variant:"body2",color:"text.secondary",children:["Quantity: ",P[Xr].quantity]})]})]}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:Je,children:"Cancel"}),a.jsx(Ce,{onClick:rt,color:"error",variant:"contained",children:"Remove"})]})]})]})})},Cj=()=>{const[t,e]=_.useState([]),[r,n]=_.useState(!0),[s,i]=_.useState(""),[o,l]=_.useState("open"),[u,d]=_.useState({page:0,pageSize:10}),[f,m]=_.useState(null),[v,p]=_.useState(null),[b,w]=_.useState(null),y=Vr();yi();const j=async()=>{n(!0);try{const N=(await xe.get("/api/purchase-history",{params:{status:o,searchTerm:s||void 0}})).data.sort((Q,P)=>{const L=z=>{const V=z.match(/\d+/);return V?parseInt(V[0],10):0},te=L(Q.purchase_number);return L(P.purchase_number)-te});e(N)}catch(C){console.error("Error fetching purchase orders:",C),e([]),ve.error("Failed to fetch purchase orders")}finally{n(!1)}};_.useEffect(()=>{j()},[o,s]);const O=C=>{window.confirm("Are you sure you want to delete this purchase order?")&&k(C)},k=async C=>{try{await xe.delete(`/api/purchase-orders/${C}`),ve.success("Purchase order deleted successfully"),j()}catch(N){console.error("Error deleting purchase order:",N),ve.error("Failed to delete purchase order")}},I=async C=>{m(C),p(null),w(null);try{const N=await xe.post(`/api/purchase-orders/${C}/export-to-qbo`);ve.success("Exported to QuickBooks successfully!"),w(`Purchase Order exported to QuickBooks successfully! Bill ID: ${N.data.qboBillId}`),j()}catch(N){const Q=N?.response?.data?.error||"Failed to export to QuickBooks.";p(Q),ve.error(Q)}finally{m(null)}},H=()=>{let C=t;o==="open"?C=t.filter(L=>L.status==="Open"):o==="closed"&&(C=t.filter(L=>L.status==="Closed"));const N=wi.unparse(C),Q=new Blob([N],{type:"text/csv;charset=utf-8;"}),P=document.createElement("a");P.href=URL.createObjectURL(Q),P.download=`purchase_orders_${ar().format("YYYY-MM-DD")}.csv`,P.click()},F=()=>{const N=`/api/purchase-history/export/pdf?status=${o==="all"?"":o}`;window.open(N,"_blank")},U=[{field:"purchase_number",headerName:"Purchase #",flex:1,minWidth:120},{field:"vendor_name",headerName:"Vendor",flex:1.3,minWidth:150},{field:"bill_number",headerName:"Bill #",flex:.9,minWidth:100},{field:"subtotal",headerName:"Subtotal",flex:.8,minWidth:100,valueFormatter:C=>C.value!=null&&!isNaN(Number(C.value))?`$${Number(C.value).toFixed(2)}`:"$0.00"},{field:"gst_rate",headerName:"GST Rate (%)",flex:.7,minWidth:80,valueFormatter:C=>C.value!=null&&!isNaN(Number(C.value))?`${Number(C.value).toFixed(2)}%`:"5.00%"},{field:"total_gst_amount",headerName:"GST",flex:.7,minWidth:80,valueFormatter:C=>C.value!=null&&!isNaN(Number(C.value))?`$${Number(C.value).toFixed(2)}`:"$0.00"},{field:"total_amount",headerName:"Total",flex:.8,minWidth:100,valueFormatter:C=>C.value!=null&&!isNaN(Number(C.value))?`$${Number(C.value).toFixed(2)}`:"$0.00"},{field:"status",headerName:"Status",flex:.8,minWidth:100,renderCell:C=>a.jsx(Zt,{label:C.value,color:C.value==="Open"?"success":"error",size:"small",variant:"outlined"})},{field:"qbo_exported",headerName:"QBO Exported",flex:.8,minWidth:120,renderCell:C=>C.row.exported_to_qbo?a.jsx(Wl,{color:"success",titleAccess:"Exported to QuickBooks"}):C.row.qbo_export_status?a.jsx(ku,{color:"error",titleAccess:`QBO Export Error: ${C.row.qbo_export_status}`}):C.row.status==="Closed"?a.jsx(Jg,{color:"warning",titleAccess:"Not exported to QuickBooks"}):null},{field:"actions",headerName:"Actions",width:150,sortable:!1,renderCell:C=>a.jsxs(ue,{sx:{display:"flex",gap:.5},children:[C.row.status==="Closed"&&!C.row.exported_to_qbo&&a.jsx(jr,{size:"small",color:"success",onClick:N=>{N.stopPropagation(),I(C.row.purchase_id)},disabled:f===C.row.purchase_id,children:f===C.row.purchase_id?a.jsx(pr,{size:16}):a.jsx(yo,{})}),C.row.status!=="Closed"&&a.jsx(jr,{size:"small",color:"error",onClick:N=>{N.stopPropagation(),O(C.row.purchase_id)},children:a.jsx(la,{})})]})}];return a.jsxs(er,{maxWidth:"xl",sx:{mt:4},children:[a.jsxs(ue,{sx:{mb:4},children:[a.jsx(q,{variant:"h4",component:"h1",gutterBottom:!0,children:o==="open"?"Open Purchase Orders":o==="closed"?"Purchase Order History":"All Purchase Orders"}),a.jsxs(Kr,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[a.jsx(Ce,{variant:"contained",startIcon:a.jsx(ka,{}),onClick:()=>y("/open-purchase-orders/new"),children:"New PO"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:H,children:"Export CSV"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:F,children:"Download PDF"})]}),a.jsx(At,{sx:{width:"100%",overflow:"hidden",mb:3},children:a.jsxs(ue,{sx:{p:2},children:[a.jsxs(Kr,{direction:"row",spacing:3,sx:{mb:3},children:[a.jsx(Oe,{label:"Search",variant:"outlined",value:s,onChange:C=>i(C.target.value),InputProps:{startAdornment:a.jsx(Bn,{position:"start",children:a.jsx(rs,{sx:{fontSize:32}})}),sx:{fontSize:22,height:56}},sx:{minWidth:340,maxWidth:400,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"medium"}),a.jsx(Zt,{label:"All",onClick:()=>l("all"),color:o==="all"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),a.jsx(Zt,{label:"Open",onClick:()=>l("open"),color:o==="open"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),a.jsx(Zt,{label:"Closed",onClick:()=>l("closed"),color:o==="closed"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}})]}),a.jsx(es,{rows:t,columns:U,loading:r,paginationModel:u,onPaginationModelChange:d,pageSizeOptions:[10,25,50],getRowId:C=>C.purchase_id,disableRowSelectionOnClick:!0,initialState:{sorting:{sortModel:[{field:"purchase_number",sort:"desc"}]}},onRowClick:C=>{const N=C.row.status?.toLowerCase();y(N==="closed"?`/purchase-order/${C.row.purchase_id}`:`/open-purchase-orders/${C.row.purchase_id}`)},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"},cursor:"pointer"}})]})})]}),v&&a.jsx(Ct,{severity:"error",sx:{mt:2},onClose:()=>p(null),children:v}),b&&a.jsx(Ct,{severity:"success",sx:{mt:2},onClose:()=>w(null),children:b})]})};function m1(t,e,r,n,s){n=n||{};var i=1.15,o=s.internal.scaleFactor,l=s.internal.getFontSize()/o,u=s.getLineHeightFactor?s.getLineHeightFactor():i,d=l*u,f=/\r\n|\r|\n/g,m="",v=1;if((n.valign==="middle"||n.valign==="bottom"||n.halign==="center"||n.halign==="right")&&(m=typeof t=="string"?t.split(f):t,v=m.length||1),r+=l*(2-i),n.valign==="middle"?r-=v/2*d:n.valign==="bottom"&&(r-=v*d),n.halign==="center"||n.halign==="right"){var p=l;if(n.halign==="center"&&(p*=.5),m&&v>=1){for(var b=0;b<m.length;b++)s.text(m[b],e-s.getStringUnitWidth(m[b])*p,r),r+=d;return s}e-=s.getStringUnitWidth(t)*p}return n.halign==="justify"?s.text(t,e,r,{maxWidth:n.maxWidth||100,align:"justify"}):s.text(t,e,r),s}var rm={},so=function(){function t(e){this.jsPDFDocument=e,this.userStyles={textColor:e.getTextColor?this.jsPDFDocument.getTextColor():0,fontSize:e.internal.getFontSize(),fontStyle:e.internal.getFont().fontStyle,font:e.internal.getFont().fontName,lineWidth:e.getLineWidth?this.jsPDFDocument.getLineWidth():0,lineColor:e.getDrawColor?this.jsPDFDocument.getDrawColor():0}}return t.setDefaults=function(e,r){r===void 0&&(r=null),r?r.__autoTableDocumentDefaults=e:rm=e},t.unifyColor=function(e){return Array.isArray(e)?e:typeof e=="number"?[e,e,e]:typeof e=="string"?[e]:null},t.prototype.applyStyles=function(e,r){var n,s,i;r===void 0&&(r=!1),e.fontStyle&&this.jsPDFDocument.setFontStyle&&this.jsPDFDocument.setFontStyle(e.fontStyle);var o=this.jsPDFDocument.internal.getFont(),l=o.fontStyle,u=o.fontName;if(e.font&&(u=e.font),e.fontStyle){l=e.fontStyle;var d=this.getFontList()[u];d&&d.indexOf(l)===-1&&this.jsPDFDocument.setFontStyle&&(this.jsPDFDocument.setFontStyle(d[0]),l=d[0])}if(this.jsPDFDocument.setFont(u,l),e.fontSize&&this.jsPDFDocument.setFontSize(e.fontSize),!r){var f=t.unifyColor(e.fillColor);f&&(n=this.jsPDFDocument).setFillColor.apply(n,f),f=t.unifyColor(e.textColor),f&&(s=this.jsPDFDocument).setTextColor.apply(s,f),f=t.unifyColor(e.lineColor),f&&(i=this.jsPDFDocument).setDrawColor.apply(i,f),typeof e.lineWidth=="number"&&this.jsPDFDocument.setLineWidth(e.lineWidth)}},t.prototype.splitTextToSize=function(e,r,n){return this.jsPDFDocument.splitTextToSize(e,r,n)},t.prototype.rect=function(e,r,n,s,i){return this.jsPDFDocument.rect(e,r,n,s,i)},t.prototype.getLastAutoTable=function(){return this.jsPDFDocument.lastAutoTable||null},t.prototype.getTextWidth=function(e){return this.jsPDFDocument.getTextWidth(e)},t.prototype.getDocument=function(){return this.jsPDFDocument},t.prototype.setPage=function(e){this.jsPDFDocument.setPage(e)},t.prototype.addPage=function(){return this.jsPDFDocument.addPage()},t.prototype.getFontList=function(){return this.jsPDFDocument.getFontList()},t.prototype.getGlobalOptions=function(){return rm||{}},t.prototype.getDocumentOptions=function(){return this.jsPDFDocument.__autoTableDocumentDefaults||{}},t.prototype.pageSize=function(){var e=this.jsPDFDocument.internal.pageSize;return e.width==null&&(e={width:e.getWidth(),height:e.getHeight()}),e},t.prototype.scaleFactor=function(){return this.jsPDFDocument.internal.scaleFactor},t.prototype.getLineHeightFactor=function(){var e=this.jsPDFDocument;return e.getLineHeightFactor?e.getLineHeightFactor():1.15},t.prototype.getLineHeight=function(e){return e/this.scaleFactor()*this.getLineHeightFactor()},t.prototype.pageNumber=function(){var e=this.jsPDFDocument.internal.getCurrentPageInfo();return e?e.pageNumber:this.jsPDFDocument.internal.getNumberOfPages()},t}(),mh=function(t,e){return mh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])},mh(t,e)};function g1(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");mh(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var v1=function(t){g1(e,t);function e(r){var n=t.call(this)||this;return n._element=r,n}return e}(Array);function Pj(t){return{font:"helvetica",fontStyle:"normal",overflow:"linebreak",fillColor:!1,textColor:20,halign:"left",valign:"top",fontSize:10,cellPadding:5/t,lineColor:200,lineWidth:0,cellWidth:"auto",minCellHeight:0,minCellWidth:0}}function kj(t){var e={striped:{table:{fillColor:255,textColor:80,fontStyle:"normal"},head:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},body:{},foot:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},alternateRow:{fillColor:245}},grid:{table:{fillColor:255,textColor:80,fontStyle:"normal",lineWidth:.1},head:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},body:{},foot:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},alternateRow:{}},plain:{head:{fontStyle:"bold"},foot:{fontStyle:"bold"}}};return e[t]}function uu(t,e,r){r.applyStyles(e,!0);var n=Array.isArray(t)?t:[t],s=n.map(function(i){return r.getTextWidth(i)}).reduce(function(i,o){return Math.max(i,o)},0);return s}function x1(t,e,r,n){var s=e.settings.tableLineWidth,i=e.settings.tableLineColor;t.applyStyles({lineWidth:s,lineColor:i});var o=y1(s,!1);o&&t.rect(r.x,r.y,e.getWidth(t.pageSize().width),n.y-r.y,o)}function y1(t,e){var r=t>0,n=e||e===0;return r&&n?"DF":r?"S":n?"F":null}function Ou(t,e){var r,n,s,i;if(t=t||e,Array.isArray(t)){if(t.length>=4)return{top:t[0],right:t[1],bottom:t[2],left:t[3]};if(t.length===3)return{top:t[0],right:t[1],bottom:t[2],left:t[1]};if(t.length===2)return{top:t[0],right:t[1],bottom:t[0],left:t[1]};t.length===1?t=t[0]:t=e}return typeof t=="object"?(typeof t.vertical=="number"&&(t.top=t.vertical,t.bottom=t.vertical),typeof t.horizontal=="number"&&(t.right=t.horizontal,t.left=t.horizontal),{left:(r=t.left)!==null&&r!==void 0?r:e,top:(n=t.top)!==null&&n!==void 0?n:e,right:(s=t.right)!==null&&s!==void 0?s:e,bottom:(i=t.bottom)!==null&&i!==void 0?i:e}):(typeof t!="number"&&(t=e),{top:t,right:t,bottom:t,left:t})}function b1(t,e){var r=Ou(e.settings.margin,0);return t.pageSize().width-(r.left+r.right)}function Aj(t,e,r,n,s){var i={},o=1.3333333333333333,l=Od(e,function(k){return s.getComputedStyle(k).backgroundColor});l!=null&&(i.fillColor=l);var u=Od(e,function(k){return s.getComputedStyle(k).color});u!=null&&(i.textColor=u);var d=Nj(n,r);d&&(i.cellPadding=d);var f="borderTopColor",m=o*r,v=n.borderTopWidth;if(n.borderBottomWidth===v&&n.borderRightWidth===v&&n.borderLeftWidth===v){var p=(parseFloat(v)||0)/m;p&&(i.lineWidth=p)}else i.lineWidth={top:(parseFloat(n.borderTopWidth)||0)/m,right:(parseFloat(n.borderRightWidth)||0)/m,bottom:(parseFloat(n.borderBottomWidth)||0)/m,left:(parseFloat(n.borderLeftWidth)||0)/m},i.lineWidth.top||(i.lineWidth.right?f="borderRightColor":i.lineWidth.bottom?f="borderBottomColor":i.lineWidth.left&&(f="borderLeftColor"));var b=Od(e,function(k){return s.getComputedStyle(k)[f]});b!=null&&(i.lineColor=b);var w=["left","right","center","justify"];w.indexOf(n.textAlign)!==-1&&(i.halign=n.textAlign),w=["middle","bottom","top"],w.indexOf(n.verticalAlign)!==-1&&(i.valign=n.verticalAlign);var y=parseInt(n.fontSize||"");isNaN(y)||(i.fontSize=y/o);var j=Lj(n);j&&(i.fontStyle=j);var O=(n.fontFamily||"").toLowerCase();return t.indexOf(O)!==-1&&(i.font=O),i}function Lj(t){var e="";return(t.fontWeight==="bold"||t.fontWeight==="bolder"||parseInt(t.fontWeight)>=700)&&(e="bold"),(t.fontStyle==="italic"||t.fontStyle==="oblique")&&(e+="italic"),e}function Od(t,e){var r=w1(t,e);if(!r)return null;var n=r.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*\.?\d*))?\)$/);if(!n||!Array.isArray(n))return null;var s=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])],i=parseInt(n[4]);return i===0||isNaN(s[0])||isNaN(s[1])||isNaN(s[2])?null:s}function w1(t,e){var r=e(t);return r==="rgba(0, 0, 0, 0)"||r==="transparent"||r==="initial"||r==="inherit"?t.parentElement==null?null:w1(t.parentElement,e):r}function Nj(t,e){var r=[t.paddingTop,t.paddingRight,t.paddingBottom,t.paddingLeft],n=96/(72/e),s=(parseInt(t.lineHeight)-parseInt(t.fontSize))/e/2,i=r.map(function(l){return parseInt(l||"0")/n}),o=Ou(i,0);return s>o.top&&(o.top=s),s>o.bottom&&(o.bottom=s),o}function _1(t,e,r,n,s){var i,o;n===void 0&&(n=!1),s===void 0&&(s=!1);var l;typeof e=="string"?l=r.document.querySelector(e):l=e;var u=Object.keys(t.getFontList()),d=t.scaleFactor(),f=[],m=[],v=[];if(!l)return console.error("Html table could not be found with input: ",e),{head:f,body:m,foot:v};for(var p=0;p<l.rows.length;p++){var b=l.rows[p],w=(o=(i=b?.parentElement)===null||i===void 0?void 0:i.tagName)===null||o===void 0?void 0:o.toLowerCase(),y=Ej(u,d,r,b,n,s);y&&(w==="thead"?f.push(y):w==="tfoot"?v.push(y):m.push(y))}return{head:f,body:m,foot:v}}function Ej(t,e,r,n,s,i){for(var o=new v1(n),l=0;l<n.cells.length;l++){var u=n.cells[l],d=r.getComputedStyle(u);if(s||d.display!=="none"){var f=void 0;i&&(f=Aj(t,u,e,d,r)),o.push({rowSpan:u.rowSpan,colSpan:u.colSpan,styles:f,_element:u,content:Oj(u)})}}var m=r.getComputedStyle(n);if(o.length>0&&(s||m.display!=="none"))return o}function Oj(t){var e=t.cloneNode(!0);return e.innerHTML=e.innerHTML.replace(/\n/g,"").replace(/ +/g," "),e.innerHTML=e.innerHTML.split(/<br.*?>/).map(function(r){return r.trim()}).join(`
`),e.innerText||e.textContent||""}function Ij(t,e,r){for(var n=0,s=[t,e,r];n<s.length;n++){var i=s[n];i&&typeof i!="object"&&console.error("The options parameter should be of type object, is: "+typeof i),i.startY&&typeof i.startY!="number"&&(console.error("Invalid value for startY option",i.startY),delete i.startY)}}function gs(t,e,r,n,s){if(t==null)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),o=1;o<arguments.length;o++){var l=arguments[o];if(l!=null)for(var u in l)Object.prototype.hasOwnProperty.call(l,u)&&(i[u]=l[u])}return i}function Dj(t,e){var r=new so(t),n=r.getDocumentOptions(),s=r.getGlobalOptions();Ij(s,n,e);var i=gs({},s,n,e),o;typeof window<"u"&&(o=window);var l=Tj(s,n,e),u=Mj(s,n,e),d=Fj(r,i),f=qj(r,i,o);return{id:e.tableId,content:f,hooks:u,styles:l,settings:d}}function Tj(t,e,r){for(var n={styles:{},headStyles:{},bodyStyles:{},footStyles:{},alternateRowStyles:{},columnStyles:{}},s=function(u){if(u==="columnStyles"){var d=t[u],f=e[u],m=r[u];n.columnStyles=gs({},d,f,m)}else{var v=[t,e,r],p=v.map(function(b){return b[u]||{}});n[u]=gs({},p[0],p[1],p[2])}},i=0,o=Object.keys(n);i<o.length;i++){var l=o[i];s(l)}return n}function Mj(t,e,r){for(var n=[t,e,r],s={didParseCell:[],willDrawCell:[],didDrawCell:[],willDrawPage:[],didDrawPage:[]},i=0,o=n;i<o.length;i++){var l=o[i];l.didParseCell&&s.didParseCell.push(l.didParseCell),l.willDrawCell&&s.willDrawCell.push(l.willDrawCell),l.didDrawCell&&s.didDrawCell.push(l.didDrawCell),l.willDrawPage&&s.willDrawPage.push(l.willDrawPage),l.didDrawPage&&s.didDrawPage.push(l.didDrawPage)}return s}function Fj(t,e){var r,n,s,i,o,l,u,d,f,m,v,p,b=Ou(e.margin,40/t.scaleFactor()),w=(r=Rj(t,e.startY))!==null&&r!==void 0?r:b.top,y;e.showFoot===!0?y="everyPage":e.showFoot===!1?y="never":y=(n=e.showFoot)!==null&&n!==void 0?n:"everyPage";var j;e.showHead===!0?j="everyPage":e.showHead===!1?j="never":j=(s=e.showHead)!==null&&s!==void 0?s:"everyPage";var O=(i=e.useCss)!==null&&i!==void 0?i:!1,k=e.theme||(O?"plain":"striped"),I=!!e.horizontalPageBreak,H=(o=e.horizontalPageBreakRepeat)!==null&&o!==void 0?o:null;return{includeHiddenHtml:(l=e.includeHiddenHtml)!==null&&l!==void 0?l:!1,useCss:O,theme:k,startY:w,margin:b,pageBreak:(u=e.pageBreak)!==null&&u!==void 0?u:"auto",rowPageBreak:(d=e.rowPageBreak)!==null&&d!==void 0?d:"auto",tableWidth:(f=e.tableWidth)!==null&&f!==void 0?f:"auto",showHead:j,showFoot:y,tableLineWidth:(m=e.tableLineWidth)!==null&&m!==void 0?m:0,tableLineColor:(v=e.tableLineColor)!==null&&v!==void 0?v:200,horizontalPageBreak:I,horizontalPageBreakRepeat:H,horizontalPageBreakBehaviour:(p=e.horizontalPageBreakBehaviour)!==null&&p!==void 0?p:"afterAllRows"}}function Rj(t,e){var r=t.getLastAutoTable(),n=t.scaleFactor(),s=t.pageNumber(),i=!1;if(r&&r.startPageNumber){var o=r.startPageNumber+r.pageNumber-1;i=o===s}return typeof e=="number"?e:(e==null||e===!1)&&i&&r?.finalY!=null?r.finalY+20/n:null}function qj(t,e,r){var n=e.head||[],s=e.body||[],i=e.foot||[];if(e.html){var o=e.includeHiddenHtml;if(r){var l=_1(t,e.html,r,o,e.useCss)||{};n=l.head||n,s=l.body||n,i=l.foot||n}else console.error("Cannot parse html in non browser environment")}var u=e.columns||Bj(n,s,i);return{columns:u,head:n,body:s,foot:i}}function Bj(t,e,r){var n=t[0]||e[0]||r[0]||[],s=[];return Object.keys(n).filter(function(i){return i!=="_element"}).forEach(function(i){var o=1,l;Array.isArray(n)?l=n[parseInt(i)]:l=n[i],typeof l=="object"&&!Array.isArray(l)&&(o=l?.colSpan||1);for(var u=0;u<o;u++){var d=void 0;Array.isArray(n)?d=s.length:d=i+(u>0?"_".concat(u):"");var f={dataKey:d};s.push(f)}}),s}var gh=function(){function t(e,r,n){this.table=r,this.pageNumber=r.pageNumber,this.settings=r.settings,this.cursor=n,this.doc=e.getDocument()}return t}(),Uj=function(t){g1(e,t);function e(r,n,s,i,o,l){var u=t.call(this,r,n,l)||this;return u.cell=s,u.row=i,u.column=o,u.section=i.section,u}return e}(gh),Wj=function(){function t(e,r){this.pageNumber=1,this.id=e.id,this.settings=e.settings,this.styles=e.styles,this.hooks=e.hooks,this.columns=r.columns,this.head=r.head,this.body=r.body,this.foot=r.foot}return t.prototype.getHeadHeight=function(e){return this.head.reduce(function(r,n){return r+n.getMaxCellHeight(e)},0)},t.prototype.getFootHeight=function(e){return this.foot.reduce(function(r,n){return r+n.getMaxCellHeight(e)},0)},t.prototype.allRows=function(){return this.head.concat(this.body).concat(this.foot)},t.prototype.callCellHooks=function(e,r,n,s,i,o){for(var l=0,u=r;l<u.length;l++){var d=u[l],f=new Uj(e,this,n,s,i,o),m=d(f)===!1;if(n.text=Array.isArray(n.text)?n.text:[n.text],m)return!1}return!0},t.prototype.callEndPageHooks=function(e,r){e.applyStyles(e.userStyles);for(var n=0,s=this.hooks.didDrawPage;n<s.length;n++){var i=s[n];i(new gh(e,this,r))}},t.prototype.callWillDrawPageHooks=function(e,r){for(var n=0,s=this.hooks.willDrawPage;n<s.length;n++){var i=s[n];i(new gh(e,this,r))}},t.prototype.getWidth=function(e){if(typeof this.settings.tableWidth=="number")return this.settings.tableWidth;if(this.settings.tableWidth==="wrap"){var r=this.columns.reduce(function(s,i){return s+i.wrappedWidth},0);return r}else{var n=this.settings.margin;return e-n.left-n.right}},t}(),j1=function(){function t(e,r,n,s,i){i===void 0&&(i=!1),this.height=0,this.raw=e,e instanceof v1&&(this.raw=e._element,this.element=e._element),this.index=r,this.section=n,this.cells=s,this.spansMultiplePages=i}return t.prototype.getMaxCellHeight=function(e){var r=this;return e.reduce(function(n,s){var i;return Math.max(n,((i=r.cells[s.index])===null||i===void 0?void 0:i.height)||0)},0)},t.prototype.hasRowSpan=function(e){var r=this;return e.filter(function(n){var s=r.cells[n.index];return s?s.rowSpan>1:!1}).length>0},t.prototype.canEntireRowFit=function(e,r){return this.getMaxCellHeight(r)<=e},t.prototype.getMinimumRowHeight=function(e,r){var n=this;return e.reduce(function(s,i){var o=n.cells[i.index];if(!o)return 0;var l=r.getLineHeight(o.styles.fontSize),u=o.padding("vertical"),d=u+l;return d>s?d:s},0)},t}(),S1=function(){function t(e,r,n){var s;this.contentHeight=0,this.contentWidth=0,this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.height=0,this.x=0,this.y=0,this.styles=r,this.section=n,this.raw=e;var i=e;e!=null&&typeof e=="object"&&!Array.isArray(e)?(this.rowSpan=e.rowSpan||1,this.colSpan=e.colSpan||1,i=(s=e.content)!==null&&s!==void 0?s:e,e._element&&(this.raw=e._element)):(this.rowSpan=1,this.colSpan=1);var o=i!=null?""+i:"",l=/\r\n|\r|\n/g;this.text=o.split(l)}return t.prototype.getTextPos=function(){var e;if(this.styles.valign==="top")e=this.y+this.padding("top");else if(this.styles.valign==="bottom")e=this.y+this.height-this.padding("bottom");else{var r=this.height-this.padding("vertical");e=this.y+r/2+this.padding("top")}var n;if(this.styles.halign==="right")n=this.x+this.width-this.padding("right");else if(this.styles.halign==="center"){var s=this.width-this.padding("horizontal");n=this.x+s/2+this.padding("left")}else n=this.x+this.padding("left");return{x:n,y:e}},t.prototype.getContentHeight=function(e,r){r===void 0&&(r=1.15);var n=Array.isArray(this.text)?this.text.length:1,s=this.styles.fontSize/e*r,i=n*s+this.padding("vertical");return Math.max(i,this.styles.minCellHeight)},t.prototype.padding=function(e){var r=Ou(this.styles.cellPadding,0);return e==="vertical"?r.top+r.bottom:e==="horizontal"?r.left+r.right:r[e]},t}(),zj=function(){function t(e,r,n){this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.dataKey=e,this.raw=r,this.index=n}return t.prototype.getMaxCustomCellWidth=function(e){for(var r=0,n=0,s=e.allRows();n<s.length;n++){var i=s[n],o=i.cells[this.index];o&&typeof o.styles.cellWidth=="number"&&(r=Math.max(r,o.styles.cellWidth))}return r},t}();function $j(t,e){Hj(t,e);var r=[],n=0;e.columns.forEach(function(i){var o=i.getMaxCustomCellWidth(e);o?i.width=o:(i.width=i.wrappedWidth,r.push(i)),n+=i.width});var s=e.getWidth(t.pageSize().width)-n;s&&(s=vh(r,s,function(i){return Math.max(i.minReadableWidth,i.minWidth)})),s&&(s=vh(r,s,function(i){return i.minWidth})),s=Math.abs(s),!e.settings.horizontalPageBreak&&s>.1/t.scaleFactor()&&(s=s<1?s:Math.round(s),console.warn("Of the table content, ".concat(s," units width could not fit page"))),Vj(e),Gj(e,t),Yj(e)}function Hj(t,e){var r=t.scaleFactor(),n=e.settings.horizontalPageBreak,s=b1(t,e);e.allRows().forEach(function(i){for(var o=0,l=e.columns;o<l.length;o++){var u=l[o],d=i.cells[u.index];if(d){var f=e.hooks.didParseCell;e.callCellHooks(t,f,d,i,u,null);var m=d.padding("horizontal");d.contentWidth=uu(d.text,d.styles,t)+m;var v=uu(d.text.join(" ").split(/[^\S\u00A0]+/),d.styles,t);if(d.minReadableWidth=v+d.padding("horizontal"),typeof d.styles.cellWidth=="number")d.minWidth=d.styles.cellWidth,d.wrappedWidth=d.styles.cellWidth;else if(d.styles.cellWidth==="wrap"||n===!0)d.contentWidth>s?(d.minWidth=s,d.wrappedWidth=s):(d.minWidth=d.contentWidth,d.wrappedWidth=d.contentWidth);else{var p=10/r;d.minWidth=d.styles.minCellWidth||p,d.wrappedWidth=d.contentWidth,d.minWidth>d.wrappedWidth&&(d.wrappedWidth=d.minWidth)}}}}),e.allRows().forEach(function(i){for(var o=0,l=e.columns;o<l.length;o++){var u=l[o],d=i.cells[u.index];if(d&&d.colSpan===1)u.wrappedWidth=Math.max(u.wrappedWidth,d.wrappedWidth),u.minWidth=Math.max(u.minWidth,d.minWidth),u.minReadableWidth=Math.max(u.minReadableWidth,d.minReadableWidth);else{var f=e.styles.columnStyles[u.dataKey]||e.styles.columnStyles[u.index]||{},m=f.cellWidth||f.minCellWidth;m&&typeof m=="number"&&(u.minWidth=m,u.wrappedWidth=m)}d&&(d.colSpan>1&&!u.minWidth&&(u.minWidth=d.minWidth),d.colSpan>1&&!u.wrappedWidth&&(u.wrappedWidth=d.minWidth))}})}function vh(t,e,r){for(var n=e,s=t.reduce(function(p,b){return p+b.wrappedWidth},0),i=0;i<t.length;i++){var o=t[i],l=o.wrappedWidth/s,u=n*l,d=o.width+u,f=r(o),m=d<f?f:d;e-=m-o.width,o.width=m}if(e=Math.round(e*1e10)/1e10,e){var v=t.filter(function(p){return e<0?p.width>r(p):!0});v.length&&(e=vh(v,e,r))}return e}function Yj(t){for(var e={},r=1,n=t.allRows(),s=0;s<n.length;s++)for(var i=n[s],o=0,l=t.columns;o<l.length;o++){var u=l[o],d=e[u.index];if(r>1)r--,delete i.cells[u.index];else if(d)d.cell.height+=i.height,r=d.cell.colSpan,delete i.cells[u.index],d.left--,d.left<=1&&delete e[u.index];else{var f=i.cells[u.index];if(!f)continue;if(f.height=i.height,f.rowSpan>1){var m=n.length-s,v=f.rowSpan>m?m:f.rowSpan;e[u.index]={cell:f,left:v,row:i}}}}}function Vj(t){for(var e=t.allRows(),r=0;r<e.length;r++)for(var n=e[r],s=null,i=0,o=0,l=0;l<t.columns.length;l++){var u=t.columns[l];if(o-=1,o>1&&t.columns[l+1])i+=u.width,delete n.cells[u.index];else if(s){var d=s;delete n.cells[u.index],s=null,d.width=u.width+i}else{var d=n.cells[u.index];if(!d)continue;if(o=d.colSpan,i=0,d.colSpan>1){s=d,i+=u.width;continue}d.width=u.width+i}}}function Gj(t,e){for(var r={count:0,height:0},n=0,s=t.allRows();n<s.length;n++){for(var i=s[n],o=0,l=t.columns;o<l.length;o++){var u=l[o],d=i.cells[u.index];if(d){e.applyStyles(d.styles,!0);var f=d.width-d.padding("horizontal");if(d.styles.overflow==="linebreak")d.text=e.splitTextToSize(d.text,f+1/e.scaleFactor(),{fontSize:d.styles.fontSize});else if(d.styles.overflow==="ellipsize")d.text=nm(d.text,f,d.styles,e,"...");else if(d.styles.overflow==="hidden")d.text=nm(d.text,f,d.styles,e,"");else if(typeof d.styles.overflow=="function"){var m=d.styles.overflow(d.text,f);typeof m=="string"?d.text=[m]:d.text=m}d.contentHeight=d.getContentHeight(e.scaleFactor(),e.getLineHeightFactor());var v=d.contentHeight/d.rowSpan;d.rowSpan>1&&r.count*r.height<v*d.rowSpan?r={height:v,count:d.rowSpan}:r&&r.count>0&&r.height>v&&(v=r.height),v>i.height&&(i.height=v)}}r.count--}}function nm(t,e,r,n,s){return t.map(function(i){return Qj(i,e,r,n,s)})}function Qj(t,e,r,n,s){var i=1e4*n.scaleFactor();if(e=Math.ceil(e*i)/i,e>=uu(t,r,n))return t;for(;e<uu(t+s,r,n)&&!(t.length<=1);)t=t.substring(0,t.length-1);return t.trim()+s}function Jj(t,e){var r=new so(t),n=Kj(e,r.scaleFactor()),s=new Wj(e,n);return $j(r,s),r.applyStyles(r.userStyles),s}function Kj(t,e){var r=t.content,n=Zj(r.columns);if(r.head.length===0){var s=am(n,"head");s&&r.head.push(s)}if(r.foot.length===0){var s=am(n,"foot");s&&r.foot.push(s)}var i=t.settings.theme,o=t.styles;return{columns:n,head:Id("head",r.head,n,o,i,e),body:Id("body",r.body,n,o,i,e),foot:Id("foot",r.foot,n,o,i,e)}}function Id(t,e,r,n,s,i){var o={},l=e.map(function(u,d){for(var f=0,m={},v=0,p=0,b=0,w=r;b<w.length;b++){var y=w[b];if(o[y.index]==null||o[y.index].left===0)if(p===0){var j=void 0;Array.isArray(u)?j=u[y.index-v-f]:j=u[y.dataKey];var O={};typeof j=="object"&&!Array.isArray(j)&&(O=j?.styles||{});var k=eS(t,y,d,s,n,i,O),I=new S1(j,k,t);m[y.dataKey]=I,m[y.index]=I,p=I.colSpan-1,o[y.index]={left:I.rowSpan-1,times:p}}else p--,v++;else o[y.index].left--,p=o[y.index].times,f++}return new j1(u,d,t,m)});return l}function am(t,e){var r={};return t.forEach(function(n){if(n.raw!=null){var s=Xj(e,n.raw);s!=null&&(r[n.dataKey]=s)}}),Object.keys(r).length>0?r:null}function Xj(t,e){if(t==="head"){if(typeof e=="object")return e.header||null;if(typeof e=="string"||typeof e=="number")return e}else if(t==="foot"&&typeof e=="object")return e.footer;return null}function Zj(t){return t.map(function(e,r){var n,s;return typeof e=="object"?s=(n=e.dataKey)!==null&&n!==void 0?n:r:s=r,new zj(s,e,r)})}function eS(t,e,r,n,s,i,o){var l=kj(n),u;t==="head"?u=s.headStyles:t==="body"?u=s.bodyStyles:t==="foot"&&(u=s.footStyles);var d=gs({},l.table,l[t],s.styles,u),f=s.columnStyles[e.dataKey]||s.columnStyles[e.index]||{},m=t==="body"?f:{},v=t==="body"&&r%2===0?gs({},l.alternateRow,s.alternateRowStyles):{},p=Pj(i),b=gs({},p,d,v,m);return gs(b,o)}function tS(t,e,r){var n;r===void 0&&(r={});var s=b1(t,e),i=new Map,o=[],l=[],u=[];Array.isArray(e.settings.horizontalPageBreakRepeat)?u=e.settings.horizontalPageBreakRepeat:(typeof e.settings.horizontalPageBreakRepeat=="string"||typeof e.settings.horizontalPageBreakRepeat=="number")&&(u=[e.settings.horizontalPageBreakRepeat]),u.forEach(function(v){var p=e.columns.find(function(b){return b.dataKey===v||b.index===v});p&&!i.has(p.index)&&(i.set(p.index,!0),o.push(p.index),l.push(e.columns[p.index]),s-=p.wrappedWidth)});for(var d=!0,f=(n=r?.start)!==null&&n!==void 0?n:0;f<e.columns.length;){if(i.has(f)){f++;continue}var m=e.columns[f].wrappedWidth;if(d||s>=m)d=!1,o.push(f),l.push(e.columns[f]),s-=m;else break;f++}return{colIndexes:o,columns:l,lastIndex:f-1}}function rS(t,e){for(var r=[],n=0;n<e.columns.length;n++){var s=tS(t,e,{start:n});s.columns.length&&(r.push(s),n=s.lastIndex)}return r}function nS(t,e){var r=e.settings,n=r.startY,s=r.margin,i={x:s.left,y:n},o=e.getHeadHeight(e.columns)+e.getFootHeight(e.columns),l=n+s.bottom+o;if(r.pageBreak==="avoid"){var u=e.body,d=u.reduce(function(v,p){return v+p.height},0);l+=d}var f=new so(t);(r.pageBreak==="always"||r.startY!=null&&l>f.pageSize().height)&&(P1(f),i.y=s.top),e.callWillDrawPageHooks(f,i);var m=gs({},i);e.startPageNumber=f.pageNumber(),r.horizontalPageBreak?aS(f,e,m,i):(f.applyStyles(f.userStyles),(r.showHead==="firstPage"||r.showHead==="everyPage")&&e.head.forEach(function(v){return xs(f,e,v,i,e.columns)}),f.applyStyles(f.userStyles),e.body.forEach(function(v,p){var b=p===e.body.length-1;du(f,e,v,b,m,i,e.columns)}),f.applyStyles(f.userStyles),(r.showFoot==="lastPage"||r.showFoot==="everyPage")&&e.foot.forEach(function(v){return xs(f,e,v,i,e.columns)})),x1(f,e,m,i),e.callEndPageHooks(f,i),e.finalY=i.y,t.lastAutoTable=e,f.applyStyles(f.userStyles)}function aS(t,e,r,n){var s=rS(t,e),i=e.settings;if(i.horizontalPageBreakBehaviour==="afterAllRows")s.forEach(function(d,f){t.applyStyles(t.userStyles),f>0?Al(t,e,r,n,d.columns,!0):sm(t,e,n,d.columns),sS(t,e,r,n,d.columns),Dd(t,e,n,d.columns)});else for(var o=-1,l=s[0],u=function(){var d=o;if(l){t.applyStyles(t.userStyles);var f=l.columns;o>=0?Al(t,e,r,n,f,!0):sm(t,e,n,f),d=im(t,e,o+1,n,f),Dd(t,e,n,f)}var m=d-o;s.slice(1).forEach(function(v){t.applyStyles(t.userStyles),Al(t,e,r,n,v.columns,!0),im(t,e,o+1,n,v.columns,m),Dd(t,e,n,v.columns)}),o=d};o<e.body.length-1;)u()}function sm(t,e,r,n){var s=e.settings;t.applyStyles(t.userStyles),(s.showHead==="firstPage"||s.showHead==="everyPage")&&e.head.forEach(function(i){return xs(t,e,i,r,n)})}function sS(t,e,r,n,s){t.applyStyles(t.userStyles),e.body.forEach(function(i,o){var l=o===e.body.length-1;du(t,e,i,l,r,n,s)})}function im(t,e,r,n,s,i){t.applyStyles(t.userStyles),i=i??e.body.length;var o=Math.min(r+i,e.body.length),l=-1;return e.body.slice(r,o).forEach(function(u,d){var f=r+d===e.body.length-1,m=C1(t,e,f,n);u.canEntireRowFit(m,s)&&(xs(t,e,u,n,s),l=r+d)}),l}function Dd(t,e,r,n){var s=e.settings;t.applyStyles(t.userStyles),(s.showFoot==="lastPage"||s.showFoot==="everyPage")&&e.foot.forEach(function(i){return xs(t,e,i,r,n)})}function iS(t,e,r){var n=r.getLineHeight(t.styles.fontSize),s=t.padding("vertical"),i=Math.floor((e-s)/n);return Math.max(0,i)}function oS(t,e,r,n){var s={};t.spansMultiplePages=!0,t.height=0;for(var i=0,o=0,l=r.columns;o<l.length;o++){var u=l[o],d=t.cells[u.index];if(d){Array.isArray(d.text)||(d.text=[d.text]);var f=new S1(d.raw,d.styles,d.section);f=gs(f,d),f.text=[];var m=iS(d,e,n);d.text.length>m&&(f.text=d.text.splice(m,d.text.length));var v=n.scaleFactor(),p=n.getLineHeightFactor();d.contentHeight=d.getContentHeight(v,p),d.contentHeight>=e&&(d.contentHeight=e,f.styles.minCellHeight-=e),d.contentHeight>t.height&&(t.height=d.contentHeight),f.contentHeight=f.getContentHeight(v,p),f.contentHeight>i&&(i=f.contentHeight),s[u.index]=f}}var b=new j1(t.raw,-1,t.section,s,!0);b.height=i;for(var w=0,y=r.columns;w<y.length;w++){var u=y[w],f=b.cells[u.index];f&&(f.height=b.height);var d=t.cells[u.index];d&&(d.height=t.height)}return b}function lS(t,e,r,n){var s=t.pageSize().height,i=n.settings.margin,o=i.top+i.bottom,l=s-o;e.section==="body"&&(l-=n.getHeadHeight(n.columns)+n.getFootHeight(n.columns));var u=e.getMinimumRowHeight(n.columns,t),d=u<r;if(u>l)return console.error("Will not be able to print row ".concat(e.index," correctly since it's minimum height is larger than page height")),!0;if(!d)return!1;var f=e.hasRowSpan(n.columns),m=e.getMaxCellHeight(n.columns)>l;return m?(f&&console.error("The content of row ".concat(e.index," will not be drawn correctly since drawing rows with a height larger than the page height and has cells with rowspans is not supported.")),!0):!(f||n.settings.rowPageBreak==="avoid")}function du(t,e,r,n,s,i,o){var l=C1(t,e,n,i);if(r.canEntireRowFit(l,o))xs(t,e,r,i,o);else if(lS(t,r,l,e)){var u=oS(r,l,e,t);xs(t,e,r,i,o),Al(t,e,s,i,o),du(t,e,u,n,s,i,o)}else Al(t,e,s,i,o),du(t,e,r,n,s,i,o)}function xs(t,e,r,n,s){n.x=e.settings.margin.left;for(var i=0,o=s;i<o.length;i++){var l=o[i],u=r.cells[l.index];if(!u){n.x+=l.width;continue}t.applyStyles(u.styles),u.x=n.x,u.y=n.y;var d=e.callCellHooks(t,e.hooks.willDrawCell,u,r,l,n);if(d===!1){n.x+=l.width;continue}cS(t,u,n);var f=u.getTextPos();m1(u.text,f.x,f.y,{halign:u.styles.halign,valign:u.styles.valign,maxWidth:Math.ceil(u.width-u.padding("left")-u.padding("right"))},t.getDocument()),e.callCellHooks(t,e.hooks.didDrawCell,u,r,l,n),n.x+=l.width}n.y+=r.height}function cS(t,e,r){var n=e.styles;if(t.getDocument().setFillColor(t.getDocument().getFillColor()),typeof n.lineWidth=="number"){var s=y1(n.lineWidth,n.fillColor);s&&t.rect(e.x,r.y,e.width,e.height,s)}else typeof n.lineWidth=="object"&&(n.fillColor&&t.rect(e.x,r.y,e.width,e.height,"F"),uS(t,e,r,n.lineWidth))}function uS(t,e,r,n){var s,i,o,l;n.top&&(s=r.x,i=r.y,o=r.x+e.width,l=r.y,n.right&&(o+=.5*n.right),n.left&&(s-=.5*n.left),u(n.top,s,i,o,l)),n.bottom&&(s=r.x,i=r.y+e.height,o=r.x+e.width,l=r.y+e.height,n.right&&(o+=.5*n.right),n.left&&(s-=.5*n.left),u(n.bottom,s,i,o,l)),n.left&&(s=r.x,i=r.y,o=r.x,l=r.y+e.height,n.top&&(i-=.5*n.top),n.bottom&&(l+=.5*n.bottom),u(n.left,s,i,o,l)),n.right&&(s=r.x+e.width,i=r.y,o=r.x+e.width,l=r.y+e.height,n.top&&(i-=.5*n.top),n.bottom&&(l+=.5*n.bottom),u(n.right,s,i,o,l));function u(d,f,m,v,p){t.getDocument().setLineWidth(d),t.getDocument().line(f,m,v,p,"S")}}function C1(t,e,r,n){var s=e.settings.margin.bottom,i=e.settings.showFoot;return(i==="everyPage"||i==="lastPage"&&r)&&(s+=e.getFootHeight(e.columns)),t.pageSize().height-n.y-s}function Al(t,e,r,n,s,i){s===void 0&&(s=[]),i===void 0&&(i=!1),t.applyStyles(t.userStyles),e.settings.showFoot==="everyPage"&&!i&&e.foot.forEach(function(l){return xs(t,e,l,n,s)}),e.callEndPageHooks(t,n);var o=e.settings.margin;x1(t,e,r,n),P1(t),e.pageNumber++,n.x=o.left,n.y=o.top,r.y=o.top,e.callWillDrawPageHooks(t,n),e.settings.showHead==="everyPage"&&(e.head.forEach(function(l){return xs(t,e,l,n,s)}),t.applyStyles(t.userStyles))}function P1(t){var e=t.pageNumber();t.setPage(e+1);var r=t.pageNumber();return r===e?(t.addPage(),!0):!1}function dS(t){t.API.autoTable=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=e[0],s=Dj(this,n),i=Jj(this,s);return nS(this,i),this},t.API.lastAutoTable=!1,t.API.autoTableText=function(e,r,n,s){m1(e,r,n,s,this)},t.API.autoTableSetDefaults=function(e){return so.setDefaults(e,this),this},t.autoTableSetDefaults=function(e,r){so.setDefaults(e,r)},t.API.autoTableHtmlToJson=function(e,r){var n;if(r===void 0&&(r=!1),typeof window>"u")return console.error("Cannot run autoTableHtmlToJson in non browser environment"),null;var s=new so(this),i=_1(s,e,window,r,!1),o=i.head,l=i.body,u=((n=o[0])===null||n===void 0?void 0:n.map(function(d){return d.content}))||[];return{columns:u,rows:l,data:l}}}var Td;try{if(typeof window<"u"&&window){var om=window,lm=om.jsPDF||((Td=om.jspdf)===null||Td===void 0?void 0:Td.jsPDF);lm&&dS(lm)}}catch(t){console.error("Could not apply autoTable plugin",t)}const k1=(t,e)=>{const r=parseFloat(String(t))||0,n=parseFloat(String(e))||0;return Math.round(r*n*100)/100},A1=(t,e=5)=>{const r=t.reduce((i,o)=>{const l=k1(o.quantity,o.unit_cost);return i+l},0),n=r*(e/100),s=r+n;return{subtotal:Math.round(r*100)/100,total_gst_amount:Math.round(n*100)/100,total_amount:Math.round(s*100)/100}},hS=t=>{const e={};t.part_number?.trim()||(e.part_number="Part Number is required"),t.part_description?.trim()||(e.part_description="Part Description is required");const r=parseFloat(String(t.quantity));(isNaN(r)||r<=0)&&(e.quantity="Quantity must be greater than 0");const n=parseFloat(String(t.unit_cost));return(isNaN(n)||n<=0)&&(e.unit_cost="Unit Cost must be greater than 0"),e},fS=(t,e)=>{const r={};e||(r.vendor="Vendor is required");const n=t.map(hS);return n.some(i=>Object.keys(i).length>0)&&(r.lineItems=n),r},Rs=t=>{const e=parseFloat(String(t));return isNaN(e)?0:e},pS=()=>{const{id:t}=bi(),e=Vr(),[r,n]=_.useState(void 0),[s,i]=_.useState(null),[o,l]=_.useState(!1),[u,d]=_.useState(null),[f,m]=_.useState(null);_.useEffect(()=>{(async()=>{if(t)try{const y=await xe.get(`/api/purchase-history/${t}`);console.log("Purchase Order Detail Data Received:",y.data);const j={...y.data,total_amount:y.data.total_amount!==null?parseFloat(String(y.data.total_amount)):null,subtotal:y.data.subtotal!==null?parseFloat(String(y.data.subtotal)):null,total_gst_amount:y.data.total_gst_amount!==null?parseFloat(String(y.data.total_gst_amount)):null,lineItems:y.data.lineItems.map(H=>({...H,quantity:parseFloat(String(H.quantity)),unit_cost:parseFloat(String(H.unit_cost)),gst_rate:parseFloat(String(H.gst_rate)),line_amount:parseFloat(String(H.line_amount))}))},O=j.lineItems.map(H=>({part_number:H.part_number,part_description:H.part_description,quantity:Rs(H.quantity),unit:H.unit,unit_cost:Rs(H.unit_cost)})),k=A1(O,5),I={...j,subtotal:k.subtotal,total_gst_amount:k.total_gst_amount,total_amount:k.total_amount};n(I)}catch(y){console.error(`Error fetching purchase order detail for ID ${t}:`,y),n(void 0)}})()},[t]);const v=async()=>{if(!r?.purchase_id){ve.error("Purchase order not loaded. Cannot download PDF.");return}try{const w=await xe.get(`/api/purchase-history/${r.purchase_id}/pdf`,{responseType:"blob"}),y=window.URL.createObjectURL(new Blob([w.data])),j=document.createElement("a");j.href=y,j.download=`purchase_order_${r.purchase_number}.pdf`,document.body.appendChild(j),j.click(),j.remove(),window.URL.revokeObjectURL(y)}catch(w){console.error("Error downloading PDF:",w),ve.error("Failed to download PDF. Please try again.")}},p=async()=>{if(!r?.purchase_id){ve.error("Purchase order not loaded. Cannot reopen.");return}if(window.confirm("Are you sure you want to reopen this purchase order?"))try{i(null);const w={vendor_id:r.vendor_id,bill_number:r.bill_number,total_amount:r.total_amount,status:"Open",lineItems:(r.lineItems||[]).map(y=>({part_number:y.part_number,part_description:y.part_description,quantity:y.quantity,unit:y.unit,unit_cost:y.unit_cost,line_amount:y.line_amount}))};await xe.put(`/api/purchase-history/${r.purchase_id}`,w),ve.success("Purchase Order reopened successfully!"),e(`/open-purchase-orders/${r.purchase_id}`)}catch(w){console.error("Error reopening purchase order:",w),w.response&&w.response.data&&w.response.data.error&&w.response.data.error.toLowerCase().includes("inventory cannot be negative")?i("Cannot reopen purchase order: Inventory would become negative for one or more items."):ve.error("Failed to reopen purchase order. Please try again.")}},b=async()=>{if(r?.purchase_id){l(!0),d(null),m(null);try{const w=await xe.post(`/api/purchase-orders/${r.purchase_id}/export-to-qbo`);ve.success("Exported to QuickBooks successfully!"),m("Exported to QuickBooks successfully!");const y=await xe.get(`/api/purchase-history/${r.purchase_id}`);n(y.data)}catch(w){if(w?.response?.data?.error==="VENDOR_NOT_FOUND"){const y=w.response.data.vendorData,j=w.response.data.vendorName;if(window.confirm(`Vendor '${j}' does not exist in QuickBooks.

Would you like to create this vendor in QuickBooks and then export the Purchase Order?

Vendor Details:
- Name: ${y.DisplayName}
- Email: ${y.PrimaryEmailAddr?.Address||"N/A"}
- Phone: ${y.PrimaryPhone?.FreeFormNumber||"N/A"}
- Address: ${y.BillAddr?.Line1||"N/A"}, ${y.BillAddr?.City||"N/A"}`))try{const k=await xe.post(`/api/purchase-orders/${r.purchase_id}/export-to-qbo-with-vendor`,{vendorData:y});ve.success("Vendor created and Purchase Order exported to QuickBooks successfully!"),m("Vendor created and Purchase Order exported to QuickBooks successfully!");const I=await xe.get(`/api/purchase-history/${r.purchase_id}`);n(I.data)}catch(k){d(k?.response?.data?.error||"Failed to create vendor and export to QuickBooks."),ve.error("Failed to create vendor and export to QuickBooks.")}else d("Export cancelled. Vendor must exist in QuickBooks to export this Purchase Order.")}else d(w?.response?.data?.error||"Failed to export to QuickBooks."),ve.error("Failed to export to QuickBooks.")}finally{l(!1)}}};return r?a.jsxs(ue,{p:{xs:2,md:4},maxWidth:1e3,mx:"auto",children:[s&&a.jsx(ue,{mb:2,children:a.jsx(Ct,{severity:"error",variant:"filled",children:s})}),a.jsx(q,{variant:"h4",gutterBottom:!0,children:"Purchase Order Details"}),r.exported_to_qbo?a.jsxs(Ct,{severity:"success",sx:{mb:2},children:["Exported to QuickBooks",r.qbo_exported_at?` on ${new Date(r.qbo_exported_at).toLocaleString()}`:""]}):r.qbo_export_status?a.jsxs(Ct,{severity:"error",sx:{mb:2},children:["QBO Export Error: ",r.qbo_export_status]}):null,u&&a.jsx(Ct,{severity:"error",sx:{mb:2},children:u}),f&&a.jsx(Ct,{severity:"success",sx:{mb:2},children:f}),a.jsx(Ir,{variant:"outlined",sx:{mb:3},children:a.jsx(Yr,{children:a.jsxs(Z,{container:!0,spacing:{xs:2,md:3},children:[a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"Purchase Order #:"}),a.jsx(q,{variant:"body1",children:r.purchase_number})]})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"Vendor:"}),a.jsx(q,{variant:"body1",children:r.vendor_name})]})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"Created Date:"}),a.jsx(q,{variant:"body1",children:r.created_at?new Date(r.created_at).toLocaleDateString():""})]})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"Bill #:"}),a.jsx(q,{variant:"body1",children:r.bill_number})]})}),a.jsx(Z,{item:!0,xs:12,sm:6,children:a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(q,{variant:"subtitle1",color:"textSecondary",sx:{mr:1},children:"GST Rate:"}),a.jsx(q,{variant:"body1",children:r.gst_rate!=null?`${Number(r.gst_rate).toFixed(2)}%`:"5.00%"})]})})]})})}),a.jsx(q,{variant:"h5",gutterBottom:!0,sx:{mt:{xs:2,md:4}},children:"Items"}),a.jsx(Ir,{variant:"outlined",children:a.jsxs(Yr,{children:[a.jsxs(Z,{container:!0,spacing:2,sx:{fontWeight:"bold",borderBottom:"1px solid #ccc",pb:1,mb:1},children:[a.jsx(Z,{item:!0,xs:6,sm:3,md:2,children:a.jsx(q,{variant:"subtitle2",sx:{fontSize:"1rem",fontWeight:600},children:"Part #"})}),a.jsx(Z,{item:!0,xs:6,sm:5,md:4,children:a.jsx(q,{variant:"subtitle2",sx:{fontSize:"1rem",fontWeight:600},children:"Description"})}),a.jsx(Z,{item:!0,xs:4,sm:2,md:1.5,children:a.jsx(q,{variant:"subtitle2",sx:{fontSize:"1rem",fontWeight:600},children:"Qty"})}),a.jsx(Z,{item:!0,xs:4,sm:2,md:1.5,children:a.jsx(q,{variant:"subtitle2",sx:{fontSize:"1rem",fontWeight:600},children:"UOM"})}),a.jsx(Z,{item:!0,xs:4,sm:2,md:1.5,children:a.jsx(q,{variant:"subtitle2",sx:{fontSize:"1rem",fontWeight:600},children:"Unit Cost"})}),a.jsx(Z,{item:!0,xs:4,sm:2,md:1,children:a.jsx(q,{variant:"subtitle2",sx:{fontSize:"1rem",fontWeight:600},children:"Amount"})})]}),r.lineItems.map(w=>a.jsxs(Z,{container:!0,spacing:2,children:[a.jsx(Z,{item:!0,xs:6,sm:3,md:2,children:a.jsx(q,{variant:"body2",sx:{fontSize:"1.05rem"},children:w.part_number})}),a.jsx(Z,{item:!0,xs:6,sm:5,md:4,children:a.jsx(q,{variant:"body2",sx:{fontSize:"1.05rem"},children:w.part_description})}),a.jsx(Z,{item:!0,xs:4,sm:2,md:1.5,children:a.jsx(q,{variant:"body2",sx:{fontSize:"1.05rem"},children:w.quantity})}),a.jsx(Z,{item:!0,xs:4,sm:2,md:1.5,children:a.jsx(q,{variant:"body2",sx:{fontSize:"1.05rem"},children:w.unit})}),a.jsx(Z,{item:!0,xs:4,sm:2,md:1.5,children:a.jsx(q,{variant:"body2",sx:{fontSize:"1.05rem"},children:Zn(w.unit_cost)})}),a.jsx(Z,{item:!0,xs:4,sm:2,md:1,children:a.jsx(q,{variant:"body2",sx:{fontSize:"1.05rem"},children:Zn(w.quantity*w.unit_cost)})})]},w.part_number+w.quantity))]})}),a.jsxs(ue,{mt:4,display:"flex",flexDirection:"column",alignItems:"flex-end",children:[a.jsxs(q,{variant:"h6",children:["Subtotal: ",Zn(r.subtotal)]}),a.jsxs(q,{variant:"h6",children:["Total GST: ",Zn(r.total_gst_amount)]}),a.jsxs(q,{variant:"h6",children:["Total Amount: ",Zn(r.total_amount)]})]}),a.jsxs(ue,{mt:4,display:"flex",justifyContent:{xs:"center",sm:"flex-end"},children:[a.jsx(Ce,{variant:"contained",color:"primary",onClick:v,startIcon:a.jsx($r,{}),children:"Download PDF"}),r.status==="Closed"&&!r.exported_to_qbo&&a.jsx(Ce,{variant:"contained",color:"success",onClick:b,startIcon:a.jsx(yo,{}),sx:{ml:2},disabled:o,children:o?"Exporting...":"Export to QuickBooks"}),r.status==="Closed"&&a.jsx(Ce,{variant:"contained",color:"primary",onClick:p,sx:{ml:2},children:"REOPEN PO"})]})]}):a.jsx(ue,{p:4,children:a.jsx(q,{variant:"h5",children:"Purchase Order not found"})})};var gl={},cm;function mS(){if(cm)return gl;cm=1;var t=jn();Object.defineProperty(gl,"__esModule",{value:!0}),gl.default=void 0;var e=t(Cn()),r=Sn();return gl.default=(0,e.default)((0,r.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),gl}var gS=mS();const vS=Dr(gS);var vl={},um;function xS(){if(um)return vl;um=1;var t=jn();Object.defineProperty(vl,"__esModule",{value:!0}),vl.default=void 0;var e=t(Cn()),r=Sn();return vl.default=(0,e.default)((0,r.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess"),vl}var yS=xS();const bS=Dr(yS),wS=({open:t,onClose:e,purchaseOrderId:r,onSuccess:n,onAllocationSaved:s})=>{const[i,o]=_.useState(!1),[l,u]=_.useState(!1),[d,f]=_.useState(null),[m,v]=_.useState({}),[p,b]=_.useState({}),[w,y]=_.useState({}),[j,O]=_.useState(new Set),[k,I]=_.useState([]);_.useEffect(()=>{t&&r&&(f(null),v({}),b({}),y({}),O(new Set),I([]),H())},[t,r]);const H=async()=>{o(!0);try{const V=(await xe.get(`/api/purchase-history/${r}/allocation-suggestions`)).data;console.log("Allocation suggestions data:",V),console.log("Number of suggestions:",V.suggestions?.length),V.suggestions?.forEach((A,D)=>{console.log(`Suggestion ${D}: ${A.part_number} - ${A.allocation_suggestions?.length} sales orders`),A.allocation_suggestions?.forEach((J,re)=>{console.log(`  Allocation ${re}: SO ${J.sales_order_number}, current_quantity_needed: ${J.current_quantity_needed}, is_needed: ${J.is_needed}`)})});const Y=new Set,E=[];for(const A of V.suggestions||[])try{console.log(`Checking part type for: ${A.part_number}`);const D=await kg(A.part_number);console.log(`Part info for ${A.part_number}:`,D),D.part_type==="supply"?(Y.add(A.part_number),console.log(`Filtering out supply part: ${A.part_number}`)):(console.log(`Including stock part: ${A.part_number} (type: ${D.part_type})`),E.push(A))}catch(D){console.warn(`Could not determine part type for ${A.part_number}, including it:`,D),E.push(A)}O(Y),console.log(`Filtering summary: ${Y.size} supply parts filtered out, ${E.length} stock parts remaining`),console.log("Supply parts filtered:",Array.from(Y)),console.log("Stock parts included:",E.map(A=>A.part_number));const X={...V,suggestions:E};f(X);const oe={},de={};E.forEach(A=>{oe[A.part_number]={},de[A.part_number]=A.suggested_surplus,A.allocation_suggestions.forEach(D=>{oe[A.part_number][D.sales_order_id]=D.suggested_alloc})}),v(oe),b(de),I([])}catch(z){console.error("Error fetching allocation suggestions:",z),ve.error("Failed to load allocation suggestions")}finally{o(!1)}},F=(z,V,Y)=>{if(!d)return{valid:!0};const E=d.suggestions.find(fe=>fe.part_number===z);if(!E)return{valid:!0};const X=E.allocation_suggestions.find(fe=>fe.sales_order_id===V);if(!X)return{valid:!0};const oe=X.current_quantity_needed,de=E.quantity_ordered,A=E.allocation_suggestions.filter(fe=>fe.is_needed).reduce((fe,ee)=>fe+ee.current_quantity_needed,0),D=de>=A,J=L(z),re=m[z]?.[V]||0,ce=de-(J-re);return Y>ce?{valid:!1,message:`Cannot allocate more than ${ce} units (exceeds ordered quantity)`}:D&&X.is_needed&&Y<oe?{valid:!1,message:`Cannot allocate less than ${oe} units when surplus exists`}:!D&&X.is_needed&&Y<oe?{valid:!0,warning:`Allocating ${Y} units but ${oe} units are needed for quantity to order`}:{valid:!0}},U=(z,V,Y)=>{const E=Math.max(0,Y),X=F(z,V,E);if(!X.valid){ve.error(X.message);return}X.warning&&ve.warning(X.warning),v(oe=>{const de={...oe,[z]:{...oe[z],[V]:E}};if(d){const A=d.suggestions.find(D=>D.part_number===z);if(A){const D=de[z]||{},J=Object.values(D).reduce((ce,fe)=>ce+fe,0),re=Math.max(0,A.quantity_ordered-J);b(ce=>({...ce,[z]:re}))}}return de})},C=z=>{if(!d)return;const V=d.suggestions.find(D=>D.part_number===z);if(!V)return;const Y=V.quantity_ordered,E=V.allocation_suggestions.filter(D=>D.is_needed).reduce((D,J)=>D+J.current_quantity_needed,0),X=Y>=E,oe=V.allocation_suggestions.filter(D=>D.is_needed).sort((D,J)=>D.sales_order_number.localeCompare(J.sales_order_number)),de={};let A=Y;if(X){for(const D of oe){const J=D.current_quantity_needed,re=Math.min(J,A);re>0&&(de[D.sales_order_id]=re,A-=re)}if(A>0)for(const D of V.allocation_suggestions){if(A<=0)break;const J=de[D.sales_order_id]||0,re=Math.min(A,1);de[D.sales_order_id]=J+re,A-=re}}else for(const D of oe){if(A<=0)break;const J=D.current_quantity_needed,re=Math.min(J,A);re>0&&(de[D.sales_order_id]=re,A-=re)}v(D=>({...D,[z]:de})),b(D=>({...D,[z]:A}))},N=()=>{d&&d.suggestions.forEach(z=>{C(z.part_number)})},Q=()=>{const z=[];return d?(d.suggestions.forEach(V=>{const Y=V.part_number,E=V.quantity_ordered,X=m[Y]||{},oe=Object.values(X).reduce((D,J)=>D+J,0);oe>E&&z.push(`Total allocation (${oe}) exceeds ordered quantity (${E}) for part ${Y}`);const de=V.allocation_suggestions.filter(D=>D.is_needed).reduce((D,J)=>D+J.current_quantity_needed,0);if(E>=de){for(const D of V.allocation_suggestions)if(D.is_needed){const J=X[D.sales_order_id]||0,re=D.current_quantity_needed;J<re&&z.push(`Sales order ${D.sales_order_number} must receive at least ${re} units when surplus exists`)}}}),I(z),z.length===0):!1},P=async()=>{if(Q()){u(!0);try{const z=[];for(const[Y,E]of Object.entries(m))for(const[X,oe]of Object.entries(E))oe>0&&z.push({sales_order_id:parseInt(X),part_number:Y,allocate_qty:oe});const V=await xe.post(`/api/purchase-history/${r}/save-allocations`,{allocations:z,surplusPerPart:p});ve.success("Allocations saved successfully"),s&&s(),e()}catch(z){console.error("Error saving allocations:",z);const V=z.response?.data?.error||"Failed to save allocations";ve.error(V)}finally{u(!1)}}},L=z=>{const V=m[z]||{};return Object.values(V).reduce((Y,E)=>Y+E,0)},te=z=>{if(!d)return 0;const V=d.suggestions.find(E=>E.part_number===z);if(!V)return 0;const Y=L(z);return V.quantity_ordered-Y},W=z=>{y(V=>({...V,[z]:!V[z]}))};return i?a.jsxs(Sr,{open:t,onClose:e,maxWidth:"lg",fullWidth:!0,children:[a.jsx(Cr,{children:"Loading Allocation Suggestions..."}),a.jsx(Pr,{children:a.jsx(ue,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:a.jsx(pr,{})})})]}):a.jsxs(Sr,{open:t,onClose:e,maxWidth:"lg",fullWidth:!0,children:[a.jsxs(Cr,{children:["Allocate Purchase Order: ",d?.purchase_order_number]}),a.jsxs(Pr,{children:[d&&d.suggestions.length>0&&a.jsxs(At,{sx:{mb:3,p:2,backgroundColor:"grey.50"},children:[a.jsxs(q,{variant:"h6",gutterBottom:!0,children:["Purchase Order Summary (",d.suggestions.length," parts)"]}),a.jsx(ue,{display:"flex",flexWrap:"wrap",gap:1,children:d.suggestions.map((z,V)=>a.jsx(Zt,{label:`${z.part_number}: ${z.quantity_ordered} ordered`,color:"primary",variant:"outlined",size:"small"},`${z.part_number}-${V}`))})]}),j.size>0&&a.jsxs(Ct,{severity:"info",sx:{mb:2},children:[a.jsxs(q,{variant:"body2",children:[a.jsx("strong",{children:"Note:"})," ",j.size," supply part",j.size>1?"s":""," ",j.size>1?"have":"has"," been filtered out from allocation. Supply parts are not tracked for inventory allocation."]}),a.jsx(ue,{mt:1,children:a.jsxs(q,{variant:"body2",color:"text.secondary",children:["Filtered parts: ",Array.from(j).join(", ")]})})]}),k.length>0&&a.jsxs(Ct,{severity:"error",sx:{mb:2},children:[a.jsx(q,{variant:"subtitle2",gutterBottom:!0,children:"Please correct the following errors:"}),k.map((z,V)=>a.jsxs(q,{variant:"body2",children:[" ",z]},V))]}),d?.suggestions.length===0?a.jsx(Ct,{severity:"info",sx:{mb:2},children:a.jsx(q,{variant:"body1",children:"No parts found in this purchase order to allocate."})}):d?.suggestions.map((z,V)=>a.jsxs(At,{sx:{mb:2,p:2},children:[a.jsxs(ue,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[a.jsxs(ue,{display:"flex",alignItems:"center",gap:1,children:[a.jsx(jr,{size:"small",onClick:()=>W(z.part_number),sx:{p:.5},children:w[z.part_number]?a.jsx(bS,{}):a.jsx(vS,{})}),a.jsxs(q,{variant:"h6",children:[z.part_number," - ",z.part_description]})]}),a.jsxs(ue,{display:"flex",gap:1,alignItems:"center",children:[a.jsx(Zt,{label:`Ordered: ${z.quantity_ordered}`,color:"primary",variant:"outlined",size:"small"}),a.jsx(Zt,{label:`Total Needed: ${z.total_needed}`,color:"secondary",variant:"outlined",size:"small"}),a.jsx(Zt,{label:`Remaining: ${te(z.part_number)}`,color:te(z.part_number)<0?"error":"default",variant:"outlined",size:"small"}),a.jsx(Ce,{variant:"outlined",size:"small",onClick:()=>C(z.part_number),children:"Auto Allocate (FIFO)"})]})]}),a.jsx(Nm,{in:w[z.part_number],children:a.jsx(ue,{mt:2,children:a.jsx(Ma,{children:a.jsxs(Sa,{size:"small",children:[a.jsx(Ca,{children:a.jsxs(Fr,{children:[a.jsx(Qe,{children:"Sales Order"}),a.jsx(Qe,{children:"Customer"}),a.jsx(Qe,{children:"Date"}),a.jsx(Qe,{align:"right",children:"Quantity to Order"}),a.jsx(Qe,{align:"right",children:"Allocate Qty"}),a.jsx(Qe,{children:"Status"})]})}),a.jsx(Pa,{children:z.allocation_suggestions.map(Y=>(console.log(`Rendering allocation for SO ${Y.sales_order_number}: current_quantity_needed = ${Y.current_quantity_needed}, is_needed = ${Y.is_needed}`),a.jsxs(Fr,{sx:{backgroundColor:Y.is_needed?"warning.light":"grey.50","&:hover":{backgroundColor:Y.is_needed?"warning.main":"grey.100"},borderLeft:Y.is_needed?"4px solid #ff9800":"4px solid transparent"},children:[a.jsx(Qe,{children:a.jsx(q,{variant:"body2",fontWeight:"medium",children:Y.sales_order_number})}),a.jsx(Qe,{children:Y.customer_name}),a.jsx(Qe,{children:new Date(Y.sales_date).toLocaleDateString()}),a.jsx(Qe,{align:"right",children:a.jsx(q,{variant:"body2",color:"black",fontWeight:Y.is_needed?"bold":"normal",children:Y.current_quantity_needed||0})}),a.jsx(Qe,{align:"right",children:a.jsx(Oe,{type:"number",value:m[z.part_number]?.[Y.sales_order_id]||0,onChange:E=>{const X=parseFloat(E.target.value)||0;U(z.part_number,Y.sales_order_id,X)},onBlur:E=>{const X=parseFloat(E.target.value)||0,oe=L(z.part_number),de=m[z.part_number]?.[Y.sales_order_id]||0,A=z.quantity_ordered-(oe-de);X>A&&U(z.part_number,Y.sales_order_id,A)},size:"small",sx:{width:80},inputProps:{min:0,step:1,max:z.quantity_ordered}})}),a.jsx(Qe,{children:a.jsx(Zt,{label:Y.is_needed?"Needs Part":"No Need",color:Y.is_needed?"warning":"default",size:"small",variant:"outlined"})})]},`${z.part_number}-${Y.sales_order_id}`)))})]})})})}),a.jsxs(ue,{mt:2,display:"flex",justifyContent:"space-between",alignItems:"center",children:[a.jsxs(q,{variant:"body2",children:["Total Allocated: ",L(z.part_number)]}),a.jsxs(ue,{display:"flex",alignItems:"center",gap:2,children:[a.jsx(q,{variant:"body2",children:"Surplus to Stock:"}),a.jsx(Oe,{type:"number",value:p[z.part_number]||0,disabled:!0,size:"small",sx:{width:80},inputProps:{min:0,step:1}})]})]})]},`${z.part_number}-${V}`))]}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:e,disabled:l,children:"Cancel"}),a.jsx(Ce,{onClick:N,variant:"outlined",disabled:l,sx:{mr:"auto"},children:"Auto Allocate All (FIFO)"}),a.jsx(Ce,{onClick:P,variant:"contained",disabled:l||k.length>0,children:l?a.jsx(pr,{size:20}):"Save Allocations"})]})]})},Md=["Each","cm","ft","kg","pcs","L"],dm=5,_S=()=>{const{id:t}=bi(),e=Vr(),{user:r}=Aa(),n=t==="new";console.log("Is creation mode:",n,"ID:",t);const[s,i]=_.useState(null),[o,l]=_.useState(null),[u,d]=_.useState(ar()),[f,m]=_.useState(""),[v,p]=_.useState([]),b=Ys(v,300),[w,y]=_.useState([]),[j,O]=_.useState("Open"),[k,I]=_.useState(dm),[H,F]=_.useState({}),[U,C]=_.useState(0),[N,Q]=_.useState([]),[P,L]=_.useState([]),[te,W]=_.useState(!0),[z,V]=_.useState(!1),[Y,E]=_.useState(null),[X,oe]=_.useState(""),[de,A]=_.useState({}),D=_.useMemo(()=>Fl(),[]),[J,re]=_.useState(null),[ce,fe]=_.useState(!1),[ee,ae]=_.useState(null),pe=async()=>{try{console.log("Fetching aggregate quantities...");const Me=new AbortController,Ue=setTimeout(()=>Me.abort(),1e4),rt=await xe.get("/api/sales-orders/parts-to-order/all",{signal:Me.signal});clearTimeout(Ue);const{aggregatedParts:Je}=rt.data;if(console.log("Full API response:",rt.data),console.log("Aggregated parts response:",Je),Je&&Je.length>0){const Ot={};Je.forEach(Ht=>{const Gr=typeof Ht.total_quantity_needed=="string"?parseFloat(Ht.total_quantity_needed):Ht.total_quantity_needed;Ot[Ht.part_number.toUpperCase()]=Gr}),console.log("Calculated quantities:",Ot),F(Ot),y(Ht=>{const Gr=Ht.map(dr=>({...dr,quantity_to_order:Ot[dr.part_number]||0}));return console.log("Updated line items with quantities:",Gr),Gr})}else console.log("No aggregated parts found, clearing quantities"),F({}),y(Ot=>Ot.map(Ht=>({...Ht,quantity_to_order:0})))}catch(Me){console.error("Error fetching aggregate quantities:",Me),Me.name==="AbortError"&&console.error("Request timed out"),F({}),y(Ue=>Ue.map(rt=>({...rt,quantity_to_order:0})))}},ye=async()=>{if(console.log("fetchData called. ID:",t),n)try{console.log(" Fetching vendors and inventory for creation mode...");const Me=new AbortController,Ue=setTimeout(()=>Me.abort(),15e3),[rt,Je]=await Promise.all([xe.get("/api/vendors",{signal:Me.signal}),xe.get("/api/inventory",{signal:Me.signal})]);clearTimeout(Ue),console.log(" Vendors and inventory fetched successfully"),console.log("Raw vendors data:",rt.data);const Ot=rt.data.map(Ht=>({label:Ht.vendor_name,id:Ht.vendor_id,email:Ht.email}));console.log("Mapped vendors:",Ot),Q(Ot),L(Je.data),y([{part_number:"",part_description:"",quantity:"",unit:"Each",unit_cost:"",line_amount:0,quantity_to_order:0}]);try{await pe()}catch(Ht){console.error("Error fetching aggregate quantities:",Ht)}W(!1),console.log(" Creation mode initialization complete");return}catch(Me){console.error(" Error fetching vendors/inventory:",Me),Me.name==="AbortError"?re("Request timed out. Please try again."):re("Failed to fetch vendors and inventory. Please check your connection and try again."),W(!1);return}try{const[Me,Ue,rt]=await Promise.all([xe.get(`/api/purchase-orders/${t}`),xe.get("/api/vendors"),xe.get("/api/inventory")]),Je=Me.data;if(console.log("Fetched Order Data:",Je),i(Je),Je.vendor_name&&Je.vendor_id){const dr=Ue.data.find(En=>En.vendor_id===Je.vendor_id);l({label:Je.vendor_name,id:Je.vendor_id,email:dr?.email})}else if(Je.vendor_id){const dr=Ue.data.find(En=>En.vendor_id===Je.vendor_id);dr?l({label:dr.vendor_name,id:dr.vendor_id,email:dr.email}):(!o||!o.id)&&l(null)}else(!o||!o.id)&&l(null);d(ar(Je.purchase_date)),m(Je.bill_number||""),console.log("Original line items from backend:",Je.lineItems);const Ot=Je.lineItems.map(dr=>{const En={...dr,quantity:String(dr.quantity||""),unit_cost:String(dr.unit_cost||""),line_amount:parseFloat(String(dr.line_amount??dr.line_total??0)),quantity_to_order:0};return console.log("Mapped line item:",En),En});console.log("Final mapped line items:",Ot),y(Ot),p(Ot);const Ht=Je.status==="Closed"?"Closed":"Open";console.log("Setting purchase order status:",Ht,"from fetched status:",Je.status),O(Ht),I(Je.global_gst_rate||dm),console.log("State after setting:",{purchaseOrder:Je,billNumber:Je.bill_number||"",lineItems:Je.lineItems,mappedLineItems:Ot,subTotal:parseFloat(String(Je.subtotal))||0,totalGSTAmount:parseFloat(String(Je.total_gst_amount))||0,totalAmount:parseFloat(String(Je.total_amount))||0}),console.log("Raw vendors data (edit mode):",Ue.data);const Gr=Ue.data.map(dr=>({label:dr.vendor_name,id:dr.vendor_id,email:dr.email}));console.log("Mapped vendors (edit mode):",Gr),Q(Gr),L(rt.data),await pe(),W(!1)}catch(Me){console.error("Error fetching data:",Me),Me instanceof _n?re(Me.response?.data?.message||"Failed to fetch data"):re("An unexpected error occurred")}};_.useEffect(()=>{t&&ye()},[t]),_.useEffect(()=>{console.log("lineItems state changed:",w)},[w]);const Le=Me=>k1(Rs(Me.quantity),Rs(Me.unit_cost)),se=_.useMemo(()=>b.map(Me=>({part_number:Me.part_number,part_description:Me.part_description,quantity:Rs(Me.quantity),unit:Me.unit,unit_cost:Rs(Me.unit_cost)})),[b]),Fe=_.useMemo(()=>A1(se,k),[se,k]),ne=Fe.subtotal,R=Fe.total_gst_amount,be=Fe.total_amount;_.useEffect(()=>{console.log("Aggregate quantities changed:",H),Object.keys(H).length>0&&y(Me=>{const Ue=Me.map(rt=>{const Je=H[rt.part_number]||H[rt.part_number.toUpperCase()]||H[rt.part_number.toLowerCase()]||0,Ot=typeof Je=="string"?parseFloat(Je):Je;return{...rt,quantity_to_order:Ot}});return console.log("Updated line items from aggregate quantities effect:",Ue),Ue})},[H]);const je=(Me,Ue,rt)=>{p(Je=>{const Ot=[...Je],Ht={...Ot[Me],[Ue]:rt};return Ue==="quantity"&&parseFloat(rt)<=0?Ot.filter((Gr,dr)=>dr!==Me):((Ue==="quantity"||Ue==="unit_cost")&&(Ht.line_amount=Le(Ht)),Ot[Me]=Ht,Ot)})},Pe=()=>{y(Me=>[...Me,{part_number:"",part_description:"",quantity:"",unit:Md[0],unit_cost:"",line_amount:0,quantity_to_order:0}])},He=Me=>{y(Ue=>Ue.filter((rt,Je)=>Je!==Me))},Ye=Me=>P.find(Ue=>Ue.part_number===Me),nt=(Me,Ue)=>{console.log("handlePartNumberChange called:",{idx:Me,newValue:Ue,inventoryItemsLength:P.length}),p(rt=>{const Je=[...rt],Ot=Je[Me];if(console.log("Current item before change:",Ot),Ue===null||typeof Ue=="string"&&Ue.trim()==="")console.log("Resetting line item to empty values"),!Ot.part_number&&!Ot.part_description&&!Ot.quantity&&!Ot.unit_cost?Je[Me]={...Ot,part_number:"",part_description:"",quantity:"",unit:Md[0],unit_cost:"",line_amount:0,quantity_to_order:0}:console.log("Preserving existing data despite empty input value");else if(typeof Ue!="string"&&Ue.isNew)console.log("Opening part dialog for new part"),E(Me),V(!0);else if(typeof Ue=="string"){const Ht=Ye(Ue);console.log("Found inventory item:",Ht);const Gr=H[Ue]||H[Ue.toUpperCase()]||H[Ue.toLowerCase()]||0,dr=typeof Gr=="string"?parseFloat(Gr):Gr;if(console.log(`Quantity to order for ${Ue}:`,Gr,"as number:",dr),console.log("Available aggregate quantities keys:",Object.keys(H)),console.log("Looking for part:",Ue,"in aggregate quantities:",H),Ht){const En=Ot.unit_cost,Gs=!En||En===""||En==="0";Je[Me]={...Ot,part_number:Ue,part_description:Ht.part_description,unit:Ht.unit,unit_cost:Gs?String(Ht.last_unit_cost):En,quantity_to_order:dr}}else console.log("Inventory item not found, preserving existing data"),Je[Me]={...Ot,part_number:Ue,quantity_to_order:dr}}return Je[Me].line_amount=Le(Je[Me]),console.log("Updated item after change:",Je[Me]),Je}),typeof Ue=="string"&&Ue.trim()!==""&&pe()},dt=async(Me,Ue)=>{if(!Me||Me.trim()==="")return!1;try{return(await xe.get("/api/purchase-history/check-bill-number",{params:{bill_number:Me.trim(),exclude_purchase_id:Ue}})).data.exists}catch(rt){return console.error("Error checking duplicate bill number:",rt),!1}},Ae=(Me=!1)=>{let Ue={};o||(Ue.vendor="Vendor is required."),u||(Ue.date="Date is required."),Me&&!f.trim()&&(Ue.billNumber="Bill Number is required.");const rt=w.map(Ot=>({part_number:Ot.part_number,part_description:Ot.part_description,quantity:Rs(Ot.quantity),unit:Ot.unit,unit_cost:Rs(Ot.unit_cost)})),Je=fS(rt,o);return Je.lineItems&&(Ue.lineItems=Je.lineItems),A(Ue),Object.keys(Ue).length===0},Re=async()=>{if(!Ae(!1)){ve.error("Please correct the errors before saving.");return}if(!(f&&f.trim()&&await dt(f,s?.purchase_id)&&!window.confirm(`Warning: Bill number "${f}" already exists in another purchase order. Do you want to proceed anyway?`)))try{if(n){const Me={vendor_id:o?.id,purchase_date:u?.toISOString(),bill_number:f.trim(),lineItems:w.map(Je=>({part_number:Je.part_number.trim(),part_description:Je.part_description.trim(),unit:Je.unit.trim(),quantity:parseFloat(String(Je.quantity)),unit_cost:parseFloat(String(Je.unit_cost)),line_amount:parseFloat(String(Je.line_amount))})),status:"Open",subtotal:ne,total_gst_amount:R,total_amount:be,global_gst_rate:k,company_id:r?.company_id,created_by:r?.id};console.log("Creating new purchase order:",Me);const Ue=await xe.post("/api/purchase-orders",Me);ve.success("Purchase Order created successfully!");const rt=Ue.data.purchase_id;e(`/open-purchase-orders/${rt}`)}else{const Me={...s,vendor_id:o?.id,purchase_date:u?.toISOString(),bill_number:f.trim(),lineItems:w.map(rt=>({...rt,part_number:rt.part_number.trim(),part_description:rt.part_description.trim(),unit:rt.unit.trim(),quantity:parseFloat(String(rt.quantity)),unit_cost:parseFloat(String(rt.unit_cost)),line_amount:parseFloat(String(rt.line_amount))})),status:j,subtotal:ne,total_gst_amount:R,total_amount:be,global_gst_rate:k,gst_rate:k};console.log("Sending to backend (handleSave):",Me);const Ue=await xe.put(`/api/purchase-orders/${t}`,Me);ae("Purchase Order updated successfully!")}}catch(Me){console.error("Error saving Purchase Order:",Me),Me instanceof _n&&Me.response?.data?.error?ve.error(`Error saving Purchase Order: ${Me.response.data.error}`):ve.error("Error saving Purchase Order. Please try again.")}},st=async()=>{s?.purchase_id&&await it()},it=async()=>{if(!s?.purchase_id)return;if(!Ae(!0)){fe(!0),ve.error("A bill number is required to close the purchase order.");return}if(!(await dt(f,s.purchase_id)&&!window.confirm(`Warning: Bill number "${f}" already exists in another purchase order. Do you want to proceed with closing this purchase order anyway?`)))try{const Ue={...s,vendor_id:o?.id,purchase_date:u?.toISOString(),bill_number:f.trim(),lineItems:w.map(Je=>({...Je,part_number:Je.part_number.trim(),part_description:Je.part_description.trim(),unit:Je.unit.trim(),quantity:parseFloat(String(Je.quantity)),unit_cost:parseFloat(String(Je.unit_cost)),line_amount:parseFloat(String(Je.line_amount))})),status:"Closed",subtotal:ne,total_gst_amount:R,total_amount:be,global_gst_rate:k,gst_rate:k},rt=await xe.put(`/api/purchase-orders/${s.purchase_id}`,Ue);rt.status===200?(console.log("Purchase Order closed:",rt.data),ve.success("Purchase Order closed successfully!"),e(`/purchase-order/${s.purchase_id}`)):ve.error("Failed to close purchase order")}catch(Ue){console.error("Error closing purchase order:",Ue),Ue instanceof _n&&Ue.response?.data?.error?ve.error(`Error closing PO: ${Ue.response.data.error}`):ve.error("An unexpected error occurred while closing the PO.")}},Lt=()=>{e(`/purchase-order/${s?.purchase_id}`)},gt=()=>{ye(),ve.success("Allocation changes saved successfully. Purchase order remains open.")},St=async()=>{if(!Ae(!1)){ve.error("Please correct the errors before proceeding with allocation.");return}try{const Me={...s,vendor_id:o?.id,purchase_date:u?.toISOString(),bill_number:f.trim(),lineItems:w.map(Ue=>({...Ue,part_number:Ue.part_number.trim(),part_description:Ue.part_description.trim(),unit:Ue.unit.trim(),quantity:parseFloat(String(Ue.quantity)),unit_cost:parseFloat(String(Ue.unit_cost)),line_amount:parseFloat(String(Ue.line_amount))})),subtotal:ne,total_gst_amount:R,total_amount:be,global_gst_rate:k,gst_rate:k};await xe.put(`/api/purchase-orders/${s.purchase_id}`,Me),i(Me),Rr(!0),ve.success("Changes saved successfully. Opening allocation modal...")}catch(Me){console.error("Error saving changes before allocation:",Me),Me instanceof _n&&Me.response?.data?.error?ve.error(`Error saving changes: ${Me.response.data.error}`):ve.error("Failed to save changes before allocation. Please try again.")}},ct=async()=>{if(!s?.purchase_id){ve.error("Purchase order not loaded. Cannot download PDF.");return}try{const Me=await xe.get(`/api/purchase-orders/${s.purchase_id}/pdf`,{responseType:"blob"}),Ue=window.URL.createObjectURL(new Blob([Me.data])),rt=document.createElement("a");rt.href=Ue,rt.download=`purchase_order_${s.purchase_number}.pdf`,document.body.appendChild(rt),rt.click(),rt.remove(),window.URL.revokeObjectURL(Ue)}catch(Me){console.error("Error downloading PDF:",Me),ve.error("Failed to download PDF. Please try again.")}},Rt=async()=>{await Re(),!(Object.keys(de).length>0)&&await ct()},[xt,Rr]=_.useState(!1),[tr,rr]=_.useState(!1),[Pn,Bt]=_.useState(""),[Xr,sr]=_.useState(!1),[Zr,xn]=_.useState(""),[_r,Pt]=_.useState(""),[Kt,Ln]=_.useState(""),[ir,Hr]=_.useState(""),[Nn,Nt]=_.useState(""),[kn,Ne]=_.useState(""),[Be,Ve]=_.useState(""),[Ke,$t]=_.useState(""),[kt,ur]=_.useState(""),[kr,ln]=_.useState(""),$e=Me=>{if(Me.key==="Enter"){Me.preventDefault();const Ue=o?.label?.trim()||"";if(!Ue)return;const rt=N.find(Je=>Je.label.toLowerCase()===Ue.toLowerCase());rt?l(rt):(sr(!0),xn(Ue))}},ze=(Me,Ue)=>{if(Ue.key==="Enter"){Ue.preventDefault(),Ue.stopPropagation();const rt=w[Me].part_number.trim();if(console.log("Part number Enter key pressed with inputValue:",rt),!rt){console.log("No input value, returning");return}const Je=P.find(Ot=>Ot.part_number.toUpperCase()===rt.toUpperCase());Je?(console.log("Found exact match:",Je),nt(Me,Je.part_number)):(console.log("No exact match found, opening dialog with inputValue:",rt),oe(rt),E(Me),V(!0),console.log("Modal state set - openPartDialog should be true"))}},ut=Me=>{const Ue=N.find(rt=>rt.id===Me);return console.log("Getting vendor email for vendor ID:",Me),console.log("Selected vendor:",Ue),console.log("Vendor email:",Ue?.email),Ue?.email||""},qt=()=>{if(!o?.id){ve.error("Please select a vendor first");return}const Me=ut(o.id);console.log("Email button clicked - vendor ID:",o.id),console.log("Retrieved email:",Me),Bt(Me),rr(!0)},qr=()=>{if(!o?.id){ve.error("Please select a vendor first");return}const Me=ut(o.id);Bt(Me),rr(!0)};return _.useEffect(()=>{console.log("Part modal state changed - openPartDialog:",z,"partNumberForModal:",X,"partToAddIndex:",Y)},[z,X,Y]),_.useEffect(()=>{if(o?.id){const Me=ut(o.id);console.log("Vendor changed - updating email:",Me),Bt(Me)}else Bt("")},[o,N]),!n&&!s?a.jsx(ue,{p:4,children:a.jsx(q,{variant:"h5",children:"Loading Purchase Order..."})}):te?a.jsx(ue,{p:4,children:a.jsx(q,{variant:"h5",children:"Loading..."})}):a.jsxs(a.Fragment,{children:[a.jsx(mi,{dateAdapter:Bl,children:a.jsxs(er,{maxWidth:"lg",sx:{mt:4,mb:4},children:[a.jsxs(ue,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[a.jsx(q,{variant:"h4",component:"h1",gutterBottom:!0,children:n?"Create New Purchase Order":`Edit Purchase Order: ${s?.purchase_number}`}),a.jsxs(Kr,{direction:"row",spacing:1,children:[a.jsx(Ce,{variant:"contained",color:"primary",onClick:Re,startIcon:a.jsx(Vs,{}),children:n?"Create Purchase Order":"Save Changes"}),!n&&a.jsxs(a.Fragment,{children:[a.jsx(Ce,{variant:"contained",color:"primary",onClick:st,startIcon:a.jsx(ph,{}),children:"Close PO"}),a.jsx(Ce,{variant:"contained",color:"primary",onClick:Rt,startIcon:a.jsx($r,{}),children:"Download PDF"}),a.jsx(Ce,{variant:"contained",onClick:qt,startIcon:a.jsx(au,{}),sx:{backgroundColor:"#ff9800","&:hover":{backgroundColor:"#f57c00"}},children:"Email Vendor"})]}),n&&a.jsx(Ce,{variant:"contained",onClick:qr,startIcon:a.jsx(au,{}),sx:{backgroundColor:"#ff9800","&:hover":{backgroundColor:"#f57c00"}},children:"Email Vendor"})]})]}),ce&&a.jsxs(Ct,{severity:"warning",sx:{mb:3},onClose:()=>fe(!1),children:[a.jsx(q,{variant:"body1",sx:{fontWeight:"medium"},children:"Bill Number Required"}),a.jsx(q,{variant:"body2",children:"A bill number is required to close this purchase order. Please enter a bill number before closing."})]}),a.jsx(At,{sx:{p:3},children:a.jsxs(Z,{container:!0,spacing:3,children:[a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(sa,{value:o,onChange:(Me,Ue)=>{typeof Ue=="string"?(l({label:Ue,isNew:!0}),sr(!0),xn(Ue)):Ue&&Ue.isNew?(sr(!0),xn(Ue.label.replace('Add "',"").replace('"',""))):l(Ue)},filterOptions:(Me,Ue)=>{const rt=D(Me,Ue);return Ue.inputValue!==""&&!rt.some(Je=>Je.label===Ue.inputValue)&&rt.push({label:`Add "${Ue.inputValue}"`,isNew:!0}),rt},options:N,getOptionLabel:Me=>typeof Me=="string"?Me:Me.label,isOptionEqualToValue:(Me,Ue)=>Me.id===Ue.id,renderInput:Me=>a.jsx(Oe,{...Me,label:"Vendor",error:!!de.vendor,helperText:de.vendor,onKeyDown:$e})})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"Bill Number",value:f,onChange:Me=>{m(Me.target.value),Me.target.value.trim()!==""&&fe(!1)},fullWidth:!0,error:!!de.billNumber,helperText:de.billNumber})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"GST Rate (%)",type:"number",value:k,onChange:Me=>I(Number(Me.target.value)),fullWidth:!0,inputProps:{min:0,max:100,step:.01,readOnly:j==="Closed",onWheel:Me=>Me.currentTarget.blur()},helperText:"Change GST rate if needed (default 5%). This will affect GST and total calculations.",disabled:j==="Closed"})})]})}),a.jsxs(ue,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:3,mb:2},children:[a.jsx(q,{variant:"h6",children:"Line Items"}),a.jsx(Ce,{variant:"contained",onClick:St,startIcon:a.jsx(ph,{}),sx:{backgroundColor:"#ff9800","&:hover":{backgroundColor:"#f57c00"}},children:"Allocate Parts"})]}),a.jsxs(At,{sx:{p:3,mb:3,mt:0},elevation:3,children:[a.jsx(Z,{container:!0,spacing:2,children:w.map((Me,Ue)=>a.jsxs(vs.Fragment,{children:[a.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:a.jsx(sa,{value:Me.part_number,onInputChange:(rt,Je)=>{console.log("Autocomplete onInputChange triggered:",{idx:Ue,newInputValue:Je,currentPartNumber:Me.part_number,isInitialLoad:te}),te||nt(Ue,Je)},onChange:(rt,Je)=>{if(typeof Je=="string")nt(Ue,Je);else if(Je&&typeof Je=="object"&&"isNew"in Je){const Ot=Je.inputValue||"";oe(Ot),E(Ue),V(!0)}},options:P.map(rt=>rt.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,getOptionLabel:rt=>typeof rt=="string"?rt:rt.label,renderOption:(rt,Je)=>{const Ot=typeof Je=="object"?Je.label:Je;return typeof Je=="object"?_.createElement("li",{...rt,key:Ot},Je.label):_.createElement("li",{...rt,key:Ot},Je)},filterOptions:(rt,Je)=>{const Ot=rt.filter(Gr=>Gr.toLowerCase().includes(Je.inputValue.toLowerCase())),Ht=rt.some(Gr=>Je.inputValue.toLowerCase()===Gr.toLowerCase());return Je.inputValue!==""&&!Ht&&Ot.push({inputValue:Je.inputValue,label:`Add "${Je.inputValue}" as New Part`,isNew:!0}),Ot},renderInput:rt=>a.jsx(Oe,{...rt,label:"Part Number",fullWidth:!0,required:!0,error:!!de.lineItems?.[Ue]?.part_number,helperText:de.lineItems?.[Ue]?.part_number,onKeyDown:Je=>ze(Ue,Je)})})}),a.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Oe,{label:"Part Description",value:Me.part_description,InputProps:{readOnly:!0},fullWidth:!0,error:!!de.lineItems?.[Ue]?.part_description,helperText:de.lineItems?.[Ue]?.part_description})}),a.jsx(Z,{item:!0,xs:6,sm:3,md:1,children:a.jsx(Oe,{label:"Qty",value:Me.quantity,onChange:rt=>je(Ue,"quantity",rt.target.value),type:"number",fullWidth:!0,required:!0,error:!!de.lineItems?.[Ue]?.quantity,helperText:de.lineItems?.[Ue]?.quantity,inputProps:{step:"1",onWheel:rt=>rt.currentTarget.blur()}})}),a.jsx(Z,{item:!0,xs:6,sm:3,md:1,children:a.jsx(Oe,{label:"Unit",value:Me.unit,onChange:rt=>je(Ue,"unit",rt.target.value),select:!0,fullWidth:!0,children:Md.map(rt=>a.jsx(Jt,{value:rt,children:rt},rt))})}),a.jsx(Z,{item:!0,xs:6,sm:3,md:1.5,children:a.jsx(Oe,{label:"Unit Cost",value:Me.unit_cost,onChange:rt=>je(Ue,"unit_cost",rt.target.value),type:"number",fullWidth:!0,required:!0,error:!!de.lineItems?.[Ue]?.unit_cost,helperText:de.lineItems?.[Ue]?.unit_cost,inputProps:{step:"0.01",onWheel:rt=>rt.currentTarget.blur()}})}),a.jsx(Z,{item:!0,xs:6,sm:3,md:1.5,children:a.jsx(Oe,{label:"Amount",value:Me.line_amount!=null&&!isNaN(Number(Me.line_amount))?Number(Me.line_amount).toFixed(2):"0.00",InputProps:{readOnly:!0},fullWidth:!0})}),a.jsxs(Z,{item:!0,xs:12,sm:1,md:1,sx:{display:"flex",alignItems:"center",gap:2},children:[a.jsx(Ce,{variant:"outlined",color:"primary",onClick:()=>He(Ue),sx:{flexShrink:0},children:"Remove"}),(()=>{const rt=n?"Open":j,Je=rt==="Open"&&typeof Me.quantity_to_order=="number"&&Me.quantity_to_order>0;return console.log(`Rendering Qty to Order for ${Me.part_number}:`,{status:j,isCreationMode:n,effectiveStatus:rt,quantity_to_order:Me.quantity_to_order,type:typeof Me.quantity_to_order,shouldShow:Je}),Je?a.jsx(Oe,{label:"Qty to Order",value:Me.quantity_to_order,size:"small",InputProps:{readOnly:!0},sx:{backgroundColor:"#fff3cd",minWidth:"120px","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#ffc107"},"&:hover fieldset":{borderColor:"#ffc107"}}}}):null})()]})]},Ue))}),a.jsx(ue,{sx:{mt:2},children:a.jsx(Ce,{variant:"outlined",color:"primary",onClick:Pe,children:"Add Line Item"})})]}),a.jsx(At,{sx:{p:3,mb:3},elevation:3,children:a.jsxs(Z,{container:!0,spacing:2,children:[a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsxs(q,{variant:"subtitle1",children:["Subtotal: $",ne!=null&&!isNaN(Number(ne))?Number(ne).toFixed(2):"0.00"]})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsxs(q,{variant:"subtitle1",children:["Total GST: $",R!=null&&!isNaN(Number(R))?Number(R).toFixed(2):"0.00"]})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsxs(q,{variant:"h6",children:["Total Amount: $",be!=null&&!isNaN(Number(be))?Number(be).toFixed(2):"0.00"]})})]})}),a.jsx(Eh,{open:z,onClose:()=>{V(!1),E(null),oe("")},onSave:async Me=>{try{const Ue=await xe.post("/api/inventory",Me);console.log("New part added successfully:",Ue.data);const rt=await xe.get("/api/inventory");L(rt.data);const Je=Ue.data.item;Y!==null&&y(Ot=>{const Ht=[...Ot];return Ht[Y]={...Ht[Y],part_number:Je.part_number,part_description:Je.part_description,unit:Je.unit,unit_cost:String(Je.last_unit_cost),quantity:Ht[Y].quantity},Ht[Y].line_amount=Le(Ht[Y]),Ht}),E(null),oe("")}catch(Ue){throw Ue}},title:"Add New Part",initialPart:{part_number:X.toUpperCase()}}),a.jsx(Sg,{open:Xr,onClose:()=>sr(!1),onSave:async Me=>{try{const rt=(await xe.post("/api/vendors",Me)).data.vendor;Q(Je=>[...Je,{label:rt.vendor_name,id:rt.vendor_id}]),l({label:rt.vendor_name,id:rt.vendor_id}),!n&&s&&i(Je=>Je&&{...Je,vendor_id:rt.vendor_id,vendor_name:rt.vendor_name}),sr(!1),ve.success("Vendor added successfully!")}catch{ve.error("Failed to add vendor.")}},initialVendor:{vendor_name:Zr},isEditMode:!1}),a.jsx(wS,{open:xt,onClose:()=>Rr(!1),purchaseOrderId:s?.purchase_id||0,onSuccess:Lt,onAllocationSaved:gt}),a.jsx(Qg,{open:tr,onClose:()=>rr(!1),type:n?"custom":"purchase-order",recordId:n?void 0:s?.purchase_id,defaultTo:Pn,defaultSubject:n?`Purchase Order - ${o?.label||"Vendor"}`:void 0,defaultMessage:n?`Dear ${o?.label||"Vendor"},

Please find attached our purchase order details.

Best regards,
Your Company`:void 0,allowMessageEdit:!n}),tr&&a.jsxs("div",{style:{display:"none"},children:["Debug: vendorEmail = ",Pn,", vendor = ",JSON.stringify(o)]})]})}),a.jsx(uo,{open:!!ee,autoHideDuration:6e3,onClose:()=>ae(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:a.jsx(Ct,{onClose:()=>ae(null),severity:"success",sx:{width:"100%"},children:ee})})]})},hu=t=>new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString(),L1=()=>crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,Bh=async()=>(await xe.get("/api/time-tracking/profiles")).data,jS=async(t,e)=>(await xe.post("/api/time-tracking/profiles",{name:t,email:e})).data,N1=async()=>(await xe.get("/api/time-tracking/sales-orders")).data,SS=async(t,e)=>{const r={date:t};return e&&(r.profile_id=e),(await xe.get("/api/time-tracking/time-entries",{params:r})).data},CS=async(t,e)=>{try{return(await xe.post("/api/time-tracking/time-entries/clock-in",{profile_id:t,so_id:e})).data}catch{const n={event_id:L1(),user_id:t,device_id:localStorage.getItem("deviceId")||"unknown-device",type:"time_clock_in",timestamp_utc:hu(new Date),payload_json:JSON.stringify({profile_id:t,so_id:e}),created_at:hu(new Date)};return await window?.api?.timeEvents?.insert?.(n),{id:-Math.floor(Math.random()*1e9),profile_id:t,profile_name:"",sales_order_id:e,sales_order_number:"",clock_in:new Date().toISOString(),clock_out:null,duration:null,unit_price:0,__pending:!0,__pending_event_id:n.event_id}}},PS=async t=>{try{return(await xe.post(`/api/time-tracking/time-entries/${t}/clock-out`)).data}catch{const r={event_id:L1(),device_id:localStorage.getItem("deviceId")||"unknown-device",type:"time_clock_out",timestamp_utc:hu(new Date),payload_json:JSON.stringify({id:t}),created_at:hu(new Date)};return await window?.api?.timeEvents?.insert?.(r),{id:t,clock_out:new Date().toISOString(),__pending:!0,__pending_event_id:r.event_id}}},kS=async(t,e,r)=>(await xe.put(`/api/time-tracking/time-entries/${t}`,{clock_in:e,clock_out:r})).data,AS=async(t,e,r,n,s="csv")=>(await xe.get("/api/time-tracking/reports/time-entries/export",{params:{from:t,to:e,profile:r,so:n,format:s},responseType:"blob"})).data,LS=async t=>(await xe.get("/api/time-tracking/time-entries/open",{params:{profile_id:t}})).data,NS=()=>{const{user:t}=Aa(),[e,r]=_.useState([]),[n,s]=_.useState([]),[i,o]=_.useState([]),[l,u]=_.useState(""),[d,f]=_.useState(""),[m,v]=_.useState(!0),[p,b]=_.useState(null);_.useEffect(()=>{w()},[]),_.useEffect(()=>{l?y():o([])},[l]),_.useEffect(()=>{const I=setInterval(()=>{o(H=>H.map(F=>{if(!F.clock_out){const U=new Date,C=new Date(F.clock_in),N=(U.getTime()-C.getTime())/(1e3*60*60);return{...F,duration:N}}return F}))},1e3);return()=>clearInterval(I)},[]);const w=async()=>{try{v(!0);const[I,H]=await Promise.all([Bh(),N1()]);console.log("Sales orders data received:",H),r(I),s(H),b(null)}catch(I){b("Failed to fetch data. Please try again."),console.error("Error fetching data:",I)}finally{v(!1)}},y=async()=>{if(l)try{const[I,H]=await Promise.all([SS(new Date().toISOString().split("T")[0],l),LS(l)]),F=new Map;[...I,...H].forEach(U=>{F.set(U.id,U)}),o(Array.from(F.values()))}catch(I){b("Failed to fetch time entries. Please try again."),console.error("Error fetching time entries:",I)}},j=async()=>{if(!l||!d){b("Please select both a profile and a sales order");return}if(i.find(H=>H.sales_order_id===d&&!H.clock_out)){b("You are already clocked in for this sales order");return}try{const H=await CS(l,d);o([H,...i]),u(""),f(""),o([]),b(null)}catch(H){H.response&&H.response.data&&H.response.data.error.includes("attendance")?b("You must clock in for attendance before you can clock in for a sales order."):b("Failed to clock in. Please try again."),console.error("Error clocking in:",H)}},O=async I=>{try{const H=await PS(I);o(i.map(F=>F.id===I?H:F)),u(""),f(""),o([]),b(null)}catch(H){b("Failed to clock out. Please try again."),console.error("Error clocking out:",H)}},k=l&&i.some(I=>I.profile_id===l&&!I.clock_out);return m?a.jsx(ue,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:a.jsx(pr,{})}):a.jsxs(er,{maxWidth:"lg",sx:{mt:4,mb:4},children:[a.jsx(q,{variant:"h4",gutterBottom:!0,children:"Time Tracking"}),p&&a.jsx(Ct,{severity:"error",sx:{mb:2},children:p}),a.jsxs(Z,{container:!0,spacing:3,children:[a.jsx(Z,{item:!0,xs:12,md:6,children:a.jsxs(At,{sx:{p:2},children:[a.jsx(ue,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:a.jsx(q,{variant:"h6",children:"Profile"})}),a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"Select Profile"}),a.jsx(sn,{value:l,label:"Select Profile",onChange:I=>u(I.target.value),sx:{"& .MuiSelect-select":{fontSize:"1.1rem"}},children:e.map(I=>a.jsx(Jt,{value:I.id,sx:{fontSize:"1.1rem"},children:I.name},I.id))})]})]})}),l&&a.jsx(Z,{item:!0,xs:12,md:6,children:a.jsxs(At,{sx:{p:2},children:[a.jsx(ue,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:a.jsx(q,{variant:"h6",children:"Sales Order"})}),a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"Select Sales Order"}),a.jsx(sn,{value:d,label:"Select Sales Order",onChange:I=>f(I.target.value),sx:{"& .MuiSelect-select":{fontSize:"1.1rem"}},children:n.map(I=>{const H=i.some(F=>F.sales_order_id===I.id&&!F.clock_out);return a.jsxs(Jt,{value:I.id,disabled:H,sx:{fontSize:"1.1rem"},children:[I.number," - ",I.product_name||"No Product Name",H?" - Already Clocked In":""]},I.id)})})]})]})}),l&&d&&a.jsx(Z,{item:!0,xs:12,children:a.jsx(At,{sx:{p:2},children:a.jsx(ue,{display:"flex",justifyContent:"center",gap:2,children:a.jsx(Ce,{variant:"contained",sx:{backgroundColor:"green","&:hover":{backgroundColor:"darkgreen"}},onClick:j,disabled:k,children:"Clock In"})})})}),l&&a.jsx(Z,{item:!0,xs:12,children:a.jsxs(At,{sx:{p:2},children:[a.jsxs(q,{variant:"h6",gutterBottom:!0,children:["Today's Time Entries for ",e.find(I=>I.id===l)?.name]}),a.jsx(Ma,{children:a.jsxs(Sa,{children:[a.jsx(Ca,{children:a.jsxs(Fr,{children:[a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Sales Order"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Clock In"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Clock Out"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Duration"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Actions"})]})}),a.jsx(Pa,{children:i.map(I=>a.jsxs(Fr,{children:[a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:I.sales_order_number}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:new Date(I.clock_in).toLocaleTimeString()}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:I.clock_out?new Date(I.clock_out).toLocaleTimeString():"-"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:I.duration!==null&&I.duration!==void 0&&!isNaN(Number(I.duration))?`${Number(I.duration).toFixed(3)} hrs`:"-"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:!I.clock_out&&a.jsx(Ce,{variant:"contained",sx:{backgroundColor:"red","&:hover":{backgroundColor:"darkred"}},onClick:()=>O(I.id),children:"Clock Out"})})]},I.id))})]})})]})})]})]})};var Oc={exports:{}},hm;function ES(){return hm||(hm=1,function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(u,d){switch(u){case"P":return d.date({width:"short"});case"PP":return d.date({width:"medium"});case"PPP":return d.date({width:"long"});case"PPPP":default:return d.date({width:"full"})}},n=function(u,d){switch(u){case"p":return d.time({width:"short"});case"pp":return d.time({width:"medium"});case"ppp":return d.time({width:"long"});case"pppp":default:return d.time({width:"full"})}},s=function(u,d){var f=u.match(/(P+)(p+)?/)||[],m=f[1],v=f[2];if(!v)return r(u,d);var p;switch(m){case"P":p=d.dateTime({width:"short"});break;case"PP":p=d.dateTime({width:"medium"});break;case"PPP":p=d.dateTime({width:"long"});break;case"PPPP":default:p=d.dateTime({width:"full"});break}return p.replace("{{date}}",r(m,d)).replace("{{time}}",n(v,d))},i={p:n,P:s},o=i;e.default=o,t.exports=e.default}(Oc,Oc.exports)),Oc.exports}var OS=ES();const IS=Dr(OS),DS={y:{sectionType:"year",contentType:"digit",maxLength:4},yy:"year",yyy:{sectionType:"year",contentType:"digit",maxLength:4},yyyy:"year",M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMMM:{sectionType:"month",contentType:"letter"},MMM:{sectionType:"month",contentType:"letter"},L:{sectionType:"month",contentType:"digit",maxLength:2},LL:"month",LLL:{sectionType:"month",contentType:"letter"},LLLL:{sectionType:"month",contentType:"letter"},d:{sectionType:"day",contentType:"digit",maxLength:2},dd:"day",do:{sectionType:"day",contentType:"digit-with-letter"},E:{sectionType:"weekDay",contentType:"letter"},EE:{sectionType:"weekDay",contentType:"letter"},EEE:{sectionType:"weekDay",contentType:"letter"},EEEE:{sectionType:"weekDay",contentType:"letter"},EEEEE:{sectionType:"weekDay",contentType:"letter"},i:{sectionType:"weekDay",contentType:"digit",maxLength:1},ii:"weekDay",iii:{sectionType:"weekDay",contentType:"letter"},iiii:{sectionType:"weekDay",contentType:"letter"},e:{sectionType:"weekDay",contentType:"digit",maxLength:1},ee:"weekDay",eee:{sectionType:"weekDay",contentType:"letter"},eeee:{sectionType:"weekDay",contentType:"letter"},eeeee:{sectionType:"weekDay",contentType:"letter"},eeeeee:{sectionType:"weekDay",contentType:"letter"},c:{sectionType:"weekDay",contentType:"digit",maxLength:1},cc:"weekDay",ccc:{sectionType:"weekDay",contentType:"letter"},cccc:{sectionType:"weekDay",contentType:"letter"},ccccc:{sectionType:"weekDay",contentType:"letter"},cccccc:{sectionType:"weekDay",contentType:"letter"},a:"meridiem",aa:"meridiem",aaa:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},TS={year:"yyyy",month:"LLLL",monthShort:"MMM",dayOfMonth:"d",weekday:"EEEE",weekdayShort:"EEEEEE",hours24h:"HH",hours12h:"hh",meridiem:"aa",minutes:"mm",seconds:"ss",fullDate:"PP",fullDateWithWeekday:"PPPP",keyboardDate:"P",shortDate:"MMM d",normalDate:"d MMMM",normalDateWithWeekday:"EEE, MMM d",monthAndYear:"LLLL yyyy",monthAndDate:"MMMM d",fullTime:"p",fullTime12h:"hh:mm aa",fullTime24h:"HH:mm",fullDateTime:"PP p",fullDateTime12h:"PP hh:mm aa",fullDateTime24h:"PP HH:mm",keyboardDateTime:"P p",keyboardDateTime12h:"P hh:mm aa",keyboardDateTime24h:"P HH:mm"};class MS{constructor(e){this.isMUIAdapter=!0,this.isTimezoneCompatible=!1,this.lib="date-fns",this.locale=void 0,this.formats=void 0,this.formatTokenMap=DS,this.escapedCharacters={start:"'",end:"'"},this.longFormatters=void 0,this.date=i=>typeof i>"u"?new Date:i===null?null:new Date(i),this.dateWithTimezone=i=>this.date(i),this.getTimezone=()=>"default",this.setTimezone=i=>i,this.toJsDate=i=>i,this.getCurrentLocaleCode=()=>{var i;return((i=this.locale)==null?void 0:i.code)||"en-US"},this.is12HourCycleInCurrentLocale=()=>this.locale?/a/.test(this.locale.formatLong.time({width:"short"})):!0,this.expandFormat=i=>{const o=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g;return i.match(o).map(l=>{const u=l[0];if(u==="p"||u==="P"){const d=this.longFormatters[u];return d(l,this.locale.formatLong)}return l}).join("")},this.getFormatHelperText=i=>this.expandFormat(i).replace(/(aaa|aa|a)/g,"(a|p)m").toLocaleLowerCase(),this.isNull=i=>i===null,this.formatNumber=i=>i,this.getMeridiemText=i=>i==="am"?"AM":"PM";const{locale:r,formats:n,longFormatters:s}=e;this.locale=r,this.formats=wm({},TS,n),this.longFormatters=s}}class fm extends MS{constructor({locale:e,formats:r}={}){if(typeof Yc!="function")throw new Error(["MUI: The `date-fns` package v3.x is not compatible with this adapter.","Please, install v2.x of the package or use the `AdapterDateFnsV3` instead."].join(`
`));super({locale:e??Fh,formats:r,longFormatters:IS}),this.parseISO=n=>Z_(n),this.toISO=n=>qw(n,{format:"extended"}),this.parse=(n,s)=>n===""?null:V_(n,s,new Date,{locale:this.locale}),this.isValid=n=>Kg(this.date(n)),this.format=(n,s)=>this.formatByString(n,this.formats[s]),this.formatByString=(n,s)=>o1(n,s,{locale:this.locale}),this.getDiff=(n,s,i)=>{switch(i){case"years":return W5(n,this.date(s));case"quarters":return q5(n,this.date(s));case"months":return Zg(n,this.date(s));case"weeks":return U5(n,this.date(s));case"days":return Xg(n,this.date(s));case"hours":return M5(n,this.date(s));case"minutes":return F5(n,this.date(s));case"seconds":return B5(n,this.date(s));default:return Eu(n,this.date(s))}},this.isEqual=(n,s)=>n===null&&s===null?!0:Kw(n,s),this.isSameYear=(n,s)=>K_(n,s),this.isSameMonth=(n,s)=>J_(n,s),this.isSameDay=(n,s)=>E5(n,s),this.isSameHour=(n,s)=>Q_(n,s),this.isAfter=(n,s)=>Nd(n,s),this.isAfterYear=(n,s)=>Nd(n,kd(s)),this.isAfterDay=(n,s)=>Nd(n,dh(s)),this.isBefore=(n,s)=>hl(n,s),this.isBeforeYear=(n,s)=>hl(n,Nc(s)),this.isBeforeDay=(n,s)=>hl(n,fo(s)),this.isWithinRange=(n,[s,i])=>X_(n,{start:s,end:i}),this.startOfYear=n=>Nc(n),this.startOfMonth=n=>Yp(n),this.startOfWeek=n=>pi(n,{locale:this.locale}),this.startOfDay=n=>fo(n),this.endOfYear=n=>kd(n),this.endOfMonth=n=>hh(n),this.endOfWeek=n=>Ad(n,{locale:this.locale}),this.endOfDay=n=>dh(n),this.addYears=(n,s)=>zp(n,s),this.addMonths=(n,s)=>Vc(n,s),this.addWeeks=(n,s)=>L5(n,s),this.addDays=(n,s)=>Yc(n,s),this.addHours=(n,s)=>_5(n,s),this.addMinutes=(n,s)=>k5(n,s),this.addSeconds=(n,s)=>A5(n,s),this.getYear=n=>Jw(n),this.getMonth=n=>$w(n),this.getDate=n=>Bw(n),this.getHours=n=>Uw(n),this.getMinutes=n=>zw(n),this.getSeconds=n=>Hw(n),this.getMilliseconds=n=>Ww(n),this.setYear=(n,s)=>wj(n,s),this.setMonth=(n,s)=>mj(n,s),this.setDate=(n,s)=>gj(n,s),this.setHours=(n,s)=>vj(n,s),this.setMinutes=(n,s)=>yj(n,s),this.setSeconds=(n,s)=>bj(n,s),this.setMilliseconds=(n,s)=>xj(n,s),this.getDaysInMonth=n=>l1(n),this.getNextMonth=n=>Vc(n,1),this.getPreviousMonth=n=>Vc(n,-1),this.getMonthArray=n=>{const i=[Nc(n)];for(;i.length<12;){const o=i[i.length-1];i.push(this.getNextMonth(o))}return i},this.mergeDateAndTime=(n,s)=>this.setSeconds(this.setMinutes(this.setHours(n,this.getHours(s)),this.getMinutes(s)),this.getSeconds(s)),this.getWeekdays=()=>{const n=new Date;return z5({start:pi(n,{locale:this.locale}),end:Ad(n,{locale:this.locale})}).map(s=>this.formatByString(s,"EEEEEE"))},this.getWeekArray=n=>{const s=pi(Yp(n),{locale:this.locale}),i=Ad(hh(n),{locale:this.locale});let o=0,l=s;const u=[];for(;hl(l,i);){const d=Math.floor(o/7);u[d]=u[d]||[],u[d].push(l),l=Yc(l,1),o+=1}return u},this.getWeekNumber=n=>Qw(n,{locale:this.locale}),this.getYearRange=(n,s)=>{const i=Nc(n),o=kd(s),l=[];let u=i;for(;hl(u,o);)l.push(u),u=zp(u,1);return l}}}const mo=t=>new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString(),Uh=()=>crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,FS=async t=>(await xe.get("/api/attendance",{params:{profile_id:t}})).data,RS=async t=>{try{return(await xe.post("/api/attendance/clock-in",{profile_id:t})).data}catch{const r={event_id:Uh(),user_id:t,device_id:localStorage.getItem("deviceId")||"unknown-device",type:"attendance_clock_in",timestamp_utc:mo(new Date),payload_json:JSON.stringify({profile_id:t}),created_at:mo(new Date)};return await window?.api?.timeEvents?.insert?.(r),{id:-Math.floor(Math.random()*1e9),profile_id:t,clock_in:new Date().toISOString(),clock_out:null,duration:null,__pending:!0,__pending_event_id:r.event_id}}},qS=async t=>{try{return(await xe.post("/api/attendance/clock-out",{shift_id:t})).data}catch{const r={event_id:Uh(),user_id:void 0,device_id:localStorage.getItem("deviceId")||"unknown-device",type:"attendance_clock_out",timestamp_utc:mo(new Date),payload_json:JSON.stringify({shift_id:t}),created_at:mo(new Date)};return await window?.api?.timeEvents?.insert?.(r),{id:t,clock_out:new Date().toISOString(),__pending:!0,__pending_event_id:r.event_id}}},BS=async(t,e,r)=>{try{return(await xe.put(`/api/attendance/${t}`,{clock_in:e,clock_out:r})).data}catch{const s={event_id:Uh(),device_id:localStorage.getItem("deviceId")||"unknown-device",type:"attendance_update",timestamp_utc:mo(new Date),payload_json:JSON.stringify({shift_id:t,clock_in:e,clock_out:r}),created_at:mo(new Date)};return await window?.api?.timeEvents?.insert?.(s),{id:t,clock_in:e,clock_out:r,__pending:!0,__pending_event_id:s.event_id}}},US=async(t,e,r)=>(await xe.get("/api/attendance",{params:{profile_id:t,from:e,to:r}})).data;function Xi(t){if(!t)return"";const e=new Date(t),r=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-r).toISOString().slice(0,16)}function pm(t){return t?new Date(t).toISOString():null}const WS=()=>{const[t,e]=_.useState([]),[r,n]=_.useState([]),[s,i]=_.useState([]),[o,l]=_.useState(""),[u,d]=_.useState(""),f=new Date,m=new Date;m.setDate(f.getDate()-13);const[v,p]=_.useState(m),[b,w]=_.useState(f),[y,j]=_.useState(!0),[O,k]=_.useState(null),[I,H]=_.useState(null),[F,U]=_.useState(""),[C,N]=_.useState(""),[Q,P]=_.useState([]),[L,te]=_.useState({}),[W,z]=_.useState([]),[V,Y]=_.useState(null),[E,X]=_.useState(null),[oe,de]=_.useState(""),[A,D]=_.useState(""),[J,re]=_.useState(!1),[ce,fe]=_.useState(!0);_.useEffect(()=>{ee()},[]);const ee=async()=>{try{j(!0);const[ne,R]=await Promise.all([Bh(),N1()]);e(ne),n(R),k(null)}catch(ne){k("Failed to fetch data. Please try again."),console.error("Error fetching data:",ne)}finally{j(!1)}},ae=async()=>{if(!v||!b){k("Please select a date range");return}try{j(!0);const ne=v.toISOString().split("T")[0],R=new Date(b);R.setDate(R.getDate()+1);const be=R.toISOString().split("T")[0];console.log("Requesting shifts for:",ne,be);const je=await US(o||void 0,ne,be);console.log("Fetched shifts:",je),P(je);const Pe=[];let He=new Date(ne);const Ye=new Date(be);for(;He<Ye;){const Re={date:He.toISOString().split("T")[0]};o&&(Re.profile_id=o);const st=await xe.get("/api/time-tracking/time-entries",{params:Re});Pe.push(...st.data),He.setDate(He.getDate()+1)}const nt={},dt=[];je.forEach(Ae=>{nt[Ae.id]=[]}),Pe.forEach(Ae=>{const Re=new Date(Ae.clock_in).getTime();let st=!1;for(const it of je){const Lt=new Date(it.clock_in).getTime(),gt=it.clock_out?new Date(it.clock_out).getTime():null;if(gt&&Re>=Lt&&Re<gt){nt[it.id].push(Ae),st=!0;break}}st||dt.push(Ae)}),te(nt),z(dt),k(null)}catch(ne){k("Failed to generate report. Please try again."),console.error("Error generating report:",ne)}finally{j(!1)}},pe=async ne=>{if(!v||!b){k("Please select both from and to dates");return}try{const R=await AS(v.toISOString().split("T")[0],b.toISOString().split("T")[0],o||void 0,void 0,ne);zS(R,`time-entries-report.${ne}`)}catch(R){k("Failed to export report. Please try again."),console.error("Error exporting report:",R)}},ye=async()=>{if(I)try{const ne=pm(F),R=pm(C),be=await kS(I.id,ne,R);i(s.map(je=>je.id===I.id?{...je,clock_in:be.clock_in,clock_out:be.clock_out,duration:be.duration}:je)),H(null),k(null)}catch(ne){k("Failed to update time entry. Please try again."),console.error("Error updating time entry:",ne)}};if(_.useEffect(()=>{E&&(de(E.clock_in?Xi(E.clock_in):""),D(E.clock_out?Xi(E.clock_out):""))},[E]),y)return a.jsx(ue,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:a.jsx(pr,{})});const Le={};Q.forEach(ne=>{if(ne.clock_in&&ne.clock_out){const R=new Date(ne.clock_in).getTime(),be=new Date(ne.clock_out).getTime(),je=Math.max(0,(be-R)/(1e3*60*60)),Pe=L[ne.id]||[];let He=0;Pe.forEach(Ae=>{const Re=typeof Ae.duration=="number"?Ae.duration:Number(Ae.duration)||0;He+=Re});const Ye=Math.max(0,je-He),nt=Math.min(je,8),dt=Math.max(0,je-8);Le[ne.profile_id]||(Le[ne.profile_id]={hours:0,idle:0,regular:0,overtime:0}),Le[ne.profile_id].hours+=je,Le[ne.profile_id].idle+=Ye,Le[ne.profile_id].regular+=nt,Le[ne.profile_id].overtime+=dt}});let se={},Fe={};if(u){const ne=String(u);s.forEach(R=>{if(R.sales_order_number===ne){const be=R.profile_name||"Unknown",je=typeof R.duration=="number"?R.duration:Number(R.duration)||0;se[be]=(se[be]||0)+je,Fe[be]||(Fe[be]=[]),Fe[be].push({date:R.date,duration:je})}})}return a.jsxs(er,{maxWidth:"lg",sx:{mt:4,mb:4},children:[a.jsx(q,{variant:"h4",gutterBottom:!0,sx:{fontSize:"2.5rem"},children:"Time Tracking Reports"}),O&&a.jsx(Ct,{severity:"error",sx:{mb:2},children:O}),a.jsxs(Z,{container:!0,spacing:3,children:[a.jsx(Z,{item:!0,xs:12,children:a.jsxs(At,{sx:{p:2},children:[a.jsxs(Z,{container:!0,spacing:2,children:[a.jsx(Z,{item:!0,xs:12,md:3,children:a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{shrink:!0,children:"Profile"}),a.jsxs(sn,{value:o,label:"Profile",onChange:ne=>l(ne.target.value),displayEmpty:!0,sx:{"& .MuiSelect-select":{fontSize:"1.2rem"}},children:[a.jsx(Jt,{value:"",sx:{fontSize:"1.2rem"},children:"All Profiles"}),t.map(ne=>a.jsx(Jt,{value:ne.id,sx:{fontSize:"1.1rem"},children:ne.name},ne.id))]})]})}),a.jsx(Z,{item:!0,xs:12,md:3,children:a.jsx(mi,{dateAdapter:fm,children:a.jsx(ho,{label:"From Date",value:v,onChange:ne=>p(ne),slotProps:{textField:{fullWidth:!0}}})})}),a.jsx(Z,{item:!0,xs:12,md:3,children:a.jsx(mi,{dateAdapter:fm,children:a.jsx(ho,{label:"To Date",value:b,onChange:ne=>w(ne),slotProps:{textField:{fullWidth:!0}}})})})]}),a.jsxs(ue,{display:"flex",justifyContent:"center",gap:2,mt:2,children:[a.jsx(Ce,{variant:"contained",color:"primary",onClick:ae,children:"Generate Report"}),a.jsx(Ce,{variant:"outlined",onClick:()=>pe("csv"),children:"Export CSV"}),a.jsx(Ce,{variant:"outlined",onClick:()=>pe("pdf"),children:"Download PDF"})]})]})}),a.jsx(Z,{item:!0,xs:12,children:u?a.jsxs(At,{sx:{p:2},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,sx:{fontSize:"1.5rem"},children:"Time Entries Report"}),a.jsx(ue,{display:"flex",alignItems:"center",mb:2,children:a.jsx(El,{control:a.jsx(Jc,{checked:ce,onChange:ne=>fe(ne.target.checked),color:"primary"}),label:a.jsx(q,{sx:{fontSize:"1.1rem"},children:"Show time entry breakdown"})})}),a.jsx(ue,{mb:2,children:a.jsxs(At,{elevation:2,sx:{p:2,background:"#ede9fe",borderLeft:"6px solid #7c3aed"},children:[a.jsx(q,{variant:"h6",color:"#7c3aed",fontWeight:700,sx:{fontSize:"1.5rem"},children:"Total Hours on Sales Order"}),Object.entries(se).map(([ne,R])=>a.jsxs(q,{variant:"body1",sx:{ml:2,fontSize:"1.2rem"},children:[" ",ne,": ",R.toFixed(2)," hrs"]},ne))]})}),a.jsxs(At,{elevation:3,sx:{p:2,mb:2},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Time Entries for Sales Order"}),a.jsx(Ma,{children:a.jsxs(Sa,{children:[a.jsx(Ca,{children:a.jsxs(Fr,{children:[a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Profile"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Date"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Duration"})]})}),a.jsx(Pa,{children:Object.entries(Fe).flatMap(([ne,R])=>R.map((be,je)=>a.jsxs(Fr,{children:[a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:ne}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:be.date?new Date(be.date).toLocaleDateString():""}),a.jsxs(Qe,{sx:{fontSize:"1.1rem"},children:[be.duration.toFixed(3)," hrs"]})]},ne+"-"+je)))})]})})]})]}):a.jsxs(At,{sx:{p:2},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,sx:{fontSize:"1.5rem"},children:"Time Entries Report"}),a.jsx(ue,{display:"flex",alignItems:"center",mb:2,children:a.jsx(El,{control:a.jsx(Jc,{checked:ce,onChange:ne=>fe(ne.target.checked),color:"primary"}),label:a.jsx(q,{sx:{fontSize:"1.1rem"},children:"Show time entry breakdown"})})}),Q.length>0&&a.jsx(ue,{mb:2,children:a.jsxs(At,{elevation:2,sx:{p:2,background:"#ede9fe",borderLeft:"6px solid #7c3aed"},children:[a.jsx(q,{variant:"h6",color:"#7c3aed",fontWeight:700,children:"Summary of Shift Hours by Profile"}),a.jsx(Ma,{component:At,sx:{mt:2},children:a.jsxs(Sa,{size:"small",children:[a.jsx(Ca,{children:a.jsxs(Fr,{children:[a.jsx(Qe,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Profile Name"}),a.jsx(Qe,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Total hr"}),a.jsx(Qe,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Idle hr"}),a.jsx(Qe,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Regular hr"}),a.jsx(Qe,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Overtime hr"})]})}),a.jsx(Pa,{children:Object.entries(Le).map(([ne,R])=>{const je=Q.find(Pe=>Pe.profile_id===Number(ne))?.profile_name||t.find(Pe=>Pe.id===Number(ne))?.name||`Profile ${ne}`;return a.jsxs(Fr,{children:[a.jsx(Qe,{sx:{fontSize:"1.2rem"},children:je}),a.jsx(Qe,{sx:{fontSize:"1.2rem"},children:R.hours.toFixed(2)}),a.jsx(Qe,{sx:{fontSize:"1.2rem"},children:R.idle.toFixed(2)}),a.jsx(Qe,{sx:{fontSize:"1.2rem"},children:R.regular.toFixed(2)}),a.jsx(Qe,{sx:{fontSize:"1.2rem"},children:R.overtime.toFixed(2)})]},ne)})})]})})]})}),Q.length===0&&!y&&a.jsx(Ct,{severity:"info",sx:{mb:2},children:"No shifts found"}),Q.map(ne=>a.jsx($S,{shift:ne,entries:L[ne.id]||[],expanded:V===ne.id,onExpand:()=>Y(V===ne.id?null:ne.id),setEditEntry:H,setEditClockIn:U,setEditClockOut:N,profiles:t,setEditShift:X,showBreakdown:ce},ne.id)),W.length>0&&a.jsx(At,{elevation:3,sx:{mb:2,borderLeft:"6px solid #a21caf",background:"#f3e8ff"},children:a.jsxs(ue,{p:2,children:[a.jsx(q,{variant:"subtitle1",fontWeight:700,color:"#a21caf",sx:{fontSize:"1.2rem"},children:"Unscheduled Entries"}),a.jsx(E1,{entries:W,setEditEntry:H,setEditClockIn:U,setEditClockOut:N})]})}),s.length>0&&a.jsx(Ma,{children:a.jsxs(Sa,{children:[a.jsx(Ca,{children:a.jsxs(Fr,{children:[a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Profile"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Sales Order"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Date"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Clock In"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Clock Out"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Duration"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Actions"})]})}),a.jsx(Pa,{children:s.map(ne=>a.jsxs(Fr,{children:[a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:ne.profile_name}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:ne.sales_order_number}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:new Date(ne.date).toLocaleDateString()}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:new Date(ne.clock_in).toLocaleTimeString()}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:ne.clock_out?new Date(ne.clock_out).toLocaleTimeString():"-"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:ne.duration!==null&&ne.duration!==void 0&&!isNaN(Number(ne.duration))?`${Number(ne.duration).toFixed(3)} hrs`:"-"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:ne.clock_out&&a.jsx(Ce,{variant:"text",startIcon:a.jsx(wh,{}),onClick:()=>{H(ne),U(Xi(ne.clock_in)),N(Xi(ne.clock_out))},sx:{ml:1},children:"Edit"})})]},ne.id))})]})})]})})]}),a.jsxs(Sr,{open:!!I,onClose:()=>H(null),children:[a.jsx(Cr,{children:"Edit Time Entry"}),a.jsxs(Pr,{children:[a.jsx(Oe,{label:"Clock In",type:"datetime-local",value:F,onChange:ne=>U(ne.target.value),fullWidth:!0,sx:{mb:2}}),a.jsx(Oe,{label:"Clock Out",type:"datetime-local",value:C,onChange:ne=>N(ne.target.value),fullWidth:!0})]}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:()=>H(null),children:"Cancel"}),a.jsx(Ce,{onClick:ye,variant:"contained",startIcon:a.jsx(T0,{}),children:"Save"})]})]}),a.jsxs(Sr,{open:!!E,onClose:()=>X(null),children:[a.jsx(Cr,{children:"Edit Shift"}),a.jsxs(Pr,{children:[a.jsx(Oe,{label:"Clock In",type:"datetime-local",value:oe,onChange:ne=>de(ne.target.value),fullWidth:!0,sx:{mb:2}}),a.jsx(Oe,{label:"Clock Out",type:"datetime-local",value:A,onChange:ne=>D(ne.target.value),fullWidth:!0})]}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:()=>X(null),children:"Cancel"}),a.jsx(Ce,{onClick:async()=>{if(E){re(!0);try{await BS(E.id,new Date(oe).toISOString(),new Date(A).toISOString()),X(null),re(!1),await ae()}catch{re(!1),alert("Failed to update shift.")}}},variant:"contained",color:"primary",disabled:J,children:"Save"})]})]})]})};function zS(t,e){const r=window.URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download=e,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(r),document.body.removeChild(n)}function $S({shift:t,entries:e,expanded:r,onExpand:n,setEditEntry:s,setEditClockIn:i,setEditClockOut:o,profiles:l,setEditShift:u,showBreakdown:d}){const f=new Date(t.clock_in),m=t.clock_out?new Date(t.clock_out):null,v=t.duration!==null&&t.duration!==void 0?Number(t.duration):0,p=t.profile_name||l.find(j=>j.id===t.profile_id)?.name||`Profile ${t.profile_id}`,b={};let w=0;e.forEach(j=>{const O=j.sales_order_number||"Unknown",k=typeof j.duration=="number"?j.duration:Number(j.duration)||0;b[O]=(b[O]||0)+k,w+=k});const y=Math.max(0,v-w);return a.jsx(At,{elevation:3,sx:{mb:2,borderLeft:"6px solid #7c3aed",background:r?"#f3e8ff":"white"},children:a.jsxs(ue,{p:2,children:[a.jsxs(ue,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[a.jsxs(q,{variant:"subtitle1",fontWeight:700,color:"#7c3aed",sx:{fontSize:"1.2rem"},children:["Profile: ",p,"  Date: ",f.toLocaleDateString()]}),a.jsxs(ue,{display:"flex",gap:1,children:[d&&a.jsx(Ce,{variant:"contained",color:"primary",size:"small",onClick:n,sx:{ml:2},children:r?"Hide Entries":"Show Entries"}),a.jsx(Ce,{variant:"contained",color:"primary",size:"small",onClick:()=>u(t),children:"Edit Shift"})]})]}),a.jsxs(q,{variant:"body1",sx:{mt:1,fontSize:"1.1rem"},children:["Shift: ",f.toLocaleTimeString(),"  ",m?m.toLocaleTimeString():"-"," (",v.toFixed(2)," hrs)"]}),d&&a.jsxs(ue,{sx:{mt:1,ml:2},children:[Object.entries(b).map(([j,O])=>a.jsxs(q,{variant:"body2",sx:{fontSize:"1.1rem"},children:[" ",j," ",Number(O).toFixed(3)," hrs"]},j)),a.jsxs(q,{variant:"body2",sx:{fontSize:"1.1rem"},children:[" Idle ",y.toFixed(3)," hrs"]})]}),d&&r&&a.jsx(E1,{entries:e,setEditEntry:s,setEditClockIn:i,setEditClockOut:o})]})})}function E1({entries:t,setEditEntry:e,setEditClockIn:r,setEditClockOut:n}){return a.jsx(Ma,{sx:{mt:1,mb:1},children:a.jsxs(Sa,{size:"small",children:[a.jsx(Ca,{children:a.jsxs(Fr,{children:[a.jsx(Qe,{children:"Sales Order"}),a.jsx(Qe,{children:"Clock In"}),a.jsx(Qe,{children:"Clock Out"}),a.jsx(Qe,{children:"Duration"}),a.jsx(Qe,{children:"Actions"})]})}),a.jsx(Pa,{children:t.map(s=>a.jsxs(Fr,{children:[a.jsx(Qe,{children:s.sales_order_number}),a.jsx(Qe,{children:new Date(s.clock_in).toLocaleTimeString()}),a.jsx(Qe,{children:s.clock_out?new Date(s.clock_out).toLocaleTimeString():"-"}),a.jsx(Qe,{children:s.duration!==null&&s.duration!==void 0&&!isNaN(Number(s.duration))?`${Number(s.duration).toFixed(3)} hrs`:"-"}),a.jsx(Qe,{children:s.clock_out&&a.jsx(Ce,{variant:"text",startIcon:a.jsx(wh,{}),onClick:()=>{e(s),r(Xi(s.clock_in)),n(Xi(s.clock_out))},sx:{ml:1},children:"Edit"})})]},s.id))})]})})}const HS=async()=>(await xe.get("/api/products")).data,YS=()=>{const[t,e]=_.useState([]),[r,n]=_.useState(!1),[s,i]=_.useState(null),[o,l]=_.useState({page:0,pageSize:10}),[u,d]=_.useState(""),[f,m]=_.useState(!1);_.useEffect(()=>{v()},[]);const v=async()=>{n(!0),i(null);try{const I=await HS();e(I)}catch{i("Failed to fetch products"),ve.error("Failed to fetch products")}finally{n(!1)}},p=t.filter(I=>I.product_name.toLowerCase().includes(u.toLowerCase())),b=async I=>{if(window.confirm("Are you sure you want to delete this product?"))try{await xe.delete(`/api/products/${I}`),e(H=>H.filter(F=>F.product_id!==I)),ve.success("Product deleted successfully")}catch{ve.error("Failed to delete product")}},w=[{field:"product_id",headerName:"Product ID",flex:1,minWidth:100},{field:"product_name",headerName:"Product Name",flex:2,minWidth:180},{field:"actions",headerName:"Actions",width:80,sortable:!1,renderCell:I=>a.jsx(jr,{size:"small",color:"error",onClick:H=>{H.stopPropagation(),b(I.row.product_id)},children:a.jsx(la,{})})}],y=()=>{alert("Export CSV for products coming soon!")},j=()=>{window.open("/api/products/export/pdf","_blank")},O=()=>{m(!0)},k=()=>{m(!1)};return a.jsxs(er,{maxWidth:"lg",children:[a.jsxs(ue,{sx:{my:4},children:[a.jsx(q,{variant:"h4",component:"h1",gutterBottom:!0,children:"Product List"}),a.jsxs(Kr,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[a.jsx(Ce,{variant:"contained",startIcon:a.jsx(ka,{}),onClick:O,children:"NEW PRODUCT"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:y,children:"EXPORT CSV"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx($r,{}),onClick:j,children:"Download PDF"})]}),a.jsx(At,{sx:{width:"100%",overflow:"hidden",mb:3},children:a.jsxs(ue,{sx:{p:2},children:[a.jsx(Oe,{fullWidth:!0,variant:"outlined",placeholder:"Search products...",value:u,onChange:I=>d(I.target.value),InputProps:{startAdornment:a.jsx(Bn,{position:"start",children:a.jsx(rs,{})})},sx:{mb:2}}),a.jsx(es,{rows:p.map(I=>({...I,id:I.product_id})),columns:w,loading:r,pageSizeOptions:[10,25,50],paginationModel:o,onPaginationModelChange:l,disableRowSelectionOnClick:!0,sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),s&&a.jsx(q,{color:"error",children:s})]}),a.jsx(Pu,{open:f,onClose:k,onSave:async I=>{try{await xe.post("/api/products",I),ve.success("Product added successfully!"),m(!1),v()}catch{ve.error("Failed to add product")}},isEditMode:!1})]})},VS=({open:t,onClose:e,onSettingsSaved:r})=>{const[n,s]=_.useState({customBackupDir:"",customRestoreDir:""}),[i,o]=_.useState(!1),[l,u]=_.useState(!1),[d,f]=_.useState(null),[m,v]=_.useState(!1);_.useEffect(()=>{t&&p()},[t]);const p=async()=>{o(!0);try{const k=await xe.get("/api/backup/settings");s(k.data)}catch(k){console.error("Error fetching backup settings:",k),ve.error("Failed to load backup settings")}finally{o(!1)}},b=async()=>{u(!0);try{await xe.post("/api/backup/settings",n),ve.success("Backup settings saved successfully!"),r(),e()}catch(k){console.error("Error saving backup settings:",k),ve.error("Failed to save backup settings")}finally{u(!1)}},w=k=>{const I=k.target.files?.[0];I&&f(I)},y=async()=>{if(!d){ve.error("Please select a backup file to upload");return}v(!0);try{const k=new FormData;k.append("backup",d);const I=await xe.post("/api/backup/upload",k,{headers:{"Content-Type":"multipart/form-data"}});ve.success("Backup uploaded successfully!"),f(null),r(),e()}catch(k){console.error("Error uploading backup:",k),ve.error("Failed to upload backup file")}finally{v(!1)}},j=async()=>{try{if(window.api?.browseDirectory){const k=await window.api.browseDirectory({title:"Select Backup Directory"});k.success&&k.directory&&s(I=>({...I,customBackupDir:k.directory}))}else ve.info("Please enter the backup directory path manually")}catch(k){console.error("Error browsing backup directory:",k),ve.error("Failed to browse directory")}},O=async()=>{try{if(window.api?.browseDirectory){const k=await window.api.browseDirectory({title:"Select Restore Directory"});k.success&&k.directory&&s(I=>({...I,customRestoreDir:k.directory}))}else ve.info("Please enter the restore directory path manually")}catch(k){console.error("Error browsing restore directory:",k),ve.error("Failed to browse directory")}};return a.jsxs(Sr,{open:t,onClose:e,maxWidth:"md",fullWidth:!0,children:[a.jsx(Cr,{children:a.jsxs(ue,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(Em,{}),"Backup Settings"]})}),a.jsx(Pr,{children:i?a.jsx(ue,{sx:{display:"flex",justifyContent:"center",p:3},children:a.jsx(pr,{})}):a.jsxs(ue,{sx:{mt:2},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Custom Backup Directory"}),a.jsx(q,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Set a custom directory where backups will be stored on your device"}),a.jsxs(Z,{container:!0,spacing:2,alignItems:"center",children:[a.jsx(Z,{item:!0,xs:!0,children:a.jsx(Oe,{fullWidth:!0,label:"Backup Directory Path",value:n.customBackupDir,onChange:k=>s(I=>({...I,customBackupDir:k.target.value})),placeholder:"e.g., C:\\MyBackups or /home/user/backups",helperText:"Leave empty to use default backup location"})}),a.jsx(Z,{item:!0,children:a.jsx(Zi,{title:"Browse for backup directory",children:a.jsx(jr,{onClick:j,children:a.jsx(bf,{})})})})]}),a.jsx(io,{sx:{my:3}}),a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Custom Restore Directory"}),a.jsx(q,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Set a custom directory to look for backup files when restoring"}),a.jsxs(Z,{container:!0,spacing:2,alignItems:"center",children:[a.jsx(Z,{item:!0,xs:!0,children:a.jsx(Oe,{fullWidth:!0,label:"Restore Directory Path",value:n.customRestoreDir,onChange:k=>s(I=>({...I,customRestoreDir:k.target.value})),placeholder:"e.g., C:\\ExternalBackups or /home/user/external-backups",helperText:"Leave empty to use default restore location"})}),a.jsx(Z,{item:!0,children:a.jsx(Zi,{title:"Browse for restore directory",children:a.jsx(jr,{onClick:O,children:a.jsx(bf,{})})})})]}),a.jsx(io,{sx:{my:3}}),a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Upload External Backup"}),a.jsx(q,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Upload a backup file from your device to restore from"}),a.jsxs(ue,{sx:{display:"flex",alignItems:"center",gap:2},children:[a.jsxs(Ce,{variant:"outlined",component:"label",startIcon:a.jsx(wf,{}),disabled:m,children:["Select Backup File",a.jsx("input",{type:"file",hidden:!0,accept:".zip,.sql,.json",onChange:w})]}),d&&a.jsxs(q,{variant:"body2",children:["Selected: ",d.name]}),d&&a.jsx(Ce,{variant:"contained",onClick:y,disabled:m,startIcon:m?a.jsx(pr,{size:20}):a.jsx(wf,{}),children:m?"Uploading...":"Upload & Restore"})]}),a.jsx(Ct,{severity:"info",sx:{mt:2},children:a.jsxs(q,{variant:"body2",children:[a.jsx("strong",{children:"Note:"})," Custom directories must be accessible by the application. Make sure the directories exist and have proper read/write permissions."]})})]})}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:e,children:"Cancel"}),a.jsx(Ce,{onClick:b,variant:"contained",disabled:l||i,startIcon:l?a.jsx(pr,{size:20}):void 0,children:l?"Saving...":"Save Settings"})]})]})},GS=()=>{const[t,e]=_.useState([]),[r,n]=_.useState(null),[s,i]=_.useState(!1),[o,l]=_.useState(!1),[u,d]=_.useState(null),[f,m]=_.useState(null),[v,p]=_.useState(null),[b,w]=_.useState(!1),y=async()=>{i(!0);try{const[N,Q]=await Promise.all([xe.get("/api/backup/list"),xe.get("/api/backup/stats")]);e(N.data.backups),n(Q.data)}catch(N){console.error("Error fetching backups:",N),ve.error("Failed to fetch backups")}finally{i(!1)}};_.useEffect(()=>{y()},[]);const j=async()=>{l(!0);try{const N=await xe.post("/api/backup/create");ve.success("Backup created successfully!"),y()}catch(N){console.error("Error creating backup:",N),ve.error("Failed to create backup")}finally{l(!1)}},O=async N=>{try{const Q=await xe.get(`/api/backup/download/${N}`,{responseType:"blob"}),P=window.URL.createObjectURL(new Blob([Q.data])),L=document.createElement("a");L.href=P,L.setAttribute("download",N),document.body.appendChild(L),L.click(),L.remove(),window.URL.revokeObjectURL(P),ve.success("Backup downloaded successfully!")}catch(Q){console.error("Error downloading backup:",Q),ve.error("Failed to download backup")}},k=async N=>{try{await xe.delete(`/api/backup/delete/${N}`),ve.success("Backup deleted successfully!"),m(null),y()}catch(Q){console.error("Error deleting backup:",Q),ve.error("Failed to delete backup")}},I=async N=>{d(N.manifest);try{const P=(await xe.post(`/api/backup/restore/${N.manifest}`)).data.results,L=Object.values(P).filter(W=>W==="success").length,te=Object.keys(P).length;L===te?ve.success("Backup restored successfully! Please refresh the page."):ve.warning(`Restore completed with ${L}/${te} components successful`),p(null),d(null)}catch(Q){console.error("Error restoring backup:",Q),ve.error("Failed to restore backup"),d(null)}},H=N=>{if(N===0)return"0 Bytes";const Q=1024,P=["Bytes","KB","MB","GB"],L=Math.floor(Math.log(N)/Math.log(Q));return parseFloat((N/Math.pow(Q,L)).toFixed(2))+" "+P[L]},F=N=>N.replace(/(\d{4}-\d{2}-\d{2})T(\d{2})-(\d{2})-(\d{2})-(\d{3})Z/,"$1T$2:$3:$4.$5Z"),U=N=>new Date(F(N)).toLocaleString(),C=N=>{const Q=N.components,P=Object.keys(Q).length;return`${Object.values(Q).filter(te=>te!==null).length}/${P}`};return a.jsxs(er,{maxWidth:"xl",sx:{mt:4,mb:4},children:[a.jsxs(ue,{sx:{mb:4},children:[a.jsx(q,{variant:"h4",component:"h1",gutterBottom:!0,children:"Backup Management"}),a.jsx(q,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:"Create, manage, and restore backups of your application data"})]}),r&&a.jsxs(Z,{container:!0,spacing:3,sx:{mb:4},children:[a.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Ir,{children:a.jsxs(Yr,{children:[a.jsx(q,{color:"text.secondary",gutterBottom:!0,children:"Total Backups"}),a.jsx(q,{variant:"h4",component:"div",children:r.total_backups})]})})}),a.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Ir,{children:a.jsxs(Yr,{children:[a.jsx(q,{color:"text.secondary",gutterBottom:!0,children:"Total Size"}),a.jsx(q,{variant:"h4",component:"div",children:H(r.total_size)})]})})})]}),a.jsxs(ue,{sx:{mb:3,display:"flex",gap:2,flexWrap:"wrap"},children:[a.jsx(Ce,{variant:"contained",startIcon:o?a.jsx(pr,{size:20}):a.jsx(bh,{}),onClick:j,disabled:o,children:o?"Creating Backup...":"Create Backup"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx(Om,{}),onClick:y,disabled:s,children:"Refresh"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx(Em,{}),onClick:()=>w(!0),children:"Backup Settings"})]}),a.jsx(Ct,{severity:"warning",sx:{mb:3},children:a.jsxs(q,{variant:"body2",children:[a.jsx("strong",{children:"Important:"})," Restoring a backup will overwrite your current data. Make sure you have a backup of your current data before proceeding."]})}),a.jsx(At,{sx:{width:"100%",overflow:"hidden"},children:a.jsx(Ma,{children:a.jsxs(Sa,{children:[a.jsx(Ca,{children:a.jsxs(Fr,{children:[a.jsx(Qe,{children:"Date & Time"}),a.jsx(Qe,{children:"Components"}),a.jsx(Qe,{children:"Size"}),a.jsx(Qe,{children:"System Info"}),a.jsx(Qe,{align:"center",children:"Actions"})]})}),a.jsx(Pa,{children:s?a.jsx(Fr,{children:a.jsx(Qe,{colSpan:5,align:"center",children:a.jsx(pr,{})})}):t.length===0?a.jsx(Fr,{children:a.jsx(Qe,{colSpan:5,align:"center",children:a.jsx(q,{variant:"body2",color:"text.secondary",children:"No backups found. Create your first backup to get started."})})}):t.map(N=>a.jsxs(Fr,{hover:!0,children:[a.jsx(Qe,{children:a.jsx(q,{variant:"body2",children:U(N.timestamp)})}),a.jsxs(Qe,{children:[a.jsxs(ue,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[N.components.database&&a.jsx(Zt,{label:"Database",size:"small",color:"primary"}),N.components.uploads&&a.jsx(Zt,{label:"Uploads",size:"small",color:"secondary"}),N.components.config&&a.jsx(Zt,{label:"Config",size:"small",color:"default"})]}),a.jsxs(q,{variant:"caption",color:"text.secondary",children:[C(N)," components available"]})]}),a.jsx(Qe,{children:a.jsx(q,{variant:"body2",children:H(N.size)})}),a.jsx(Qe,{children:a.jsxs(q,{variant:"caption",color:"text.secondary",children:[N.system_info.platform,"  ",N.system_info.arch]})}),a.jsx(Qe,{align:"center",children:a.jsxs(ue,{sx:{display:"flex",gap:1,justifyContent:"center"},children:[a.jsx(Zi,{title:"Download Backup",children:a.jsx(jr,{size:"small",onClick:()=>O(N.manifest),children:a.jsx(M0,{})})}),a.jsx(Zi,{title:"Restore Backup",children:a.jsx(jr,{size:"small",color:"primary",onClick:()=>p(N),children:a.jsx(_f,{})})}),a.jsx(Zi,{title:"Delete Backup",children:a.jsx(jr,{size:"small",color:"error",onClick:()=>m(N.manifest),children:a.jsx(Im,{})})})]})})]},N.manifest))})]})})}),a.jsxs(Sr,{open:!!f,onClose:()=>m(null),children:[a.jsx(Cr,{children:"Delete Backup"}),a.jsx(Pr,{children:a.jsx(q,{children:"Are you sure you want to delete this backup? This action cannot be undone."})}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:()=>m(null),children:"Cancel"}),a.jsx(Ce,{onClick:()=>f&&k(f),color:"error",variant:"contained",children:"Delete"})]})]}),a.jsxs(Sr,{open:!!v,onClose:()=>p(null),maxWidth:"sm",fullWidth:!0,children:[a.jsx(Cr,{children:a.jsxs(ue,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(F0,{color:"warning"}),"Restore Backup"]})}),a.jsxs(Pr,{children:[a.jsx(Ct,{severity:"warning",sx:{mb:2},children:a.jsxs(q,{variant:"body2",children:[a.jsx("strong",{children:"Warning:"})," This will overwrite your current data with the backup from"," ",v?U(v.timestamp):"","."]})}),a.jsx(q,{variant:"body2",gutterBottom:!0,children:"Backup components:"}),a.jsxs(ue,{sx:{display:"flex",gap:1,mb:2},children:[v?.components.database&&a.jsx(Zt,{label:"Database",size:"small",color:"primary"}),v?.components.uploads&&a.jsx(Zt,{label:"Uploads",size:"small",color:"secondary"}),v?.components.config&&a.jsx(Zt,{label:"Config",size:"small",color:"default"})]}),a.jsx(q,{variant:"body2",color:"text.secondary",children:"Make sure you have a backup of your current data before proceeding."})]}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:()=>p(null),children:"Cancel"}),a.jsx(Ce,{onClick:()=>v&&I(v),color:"warning",variant:"contained",disabled:u===v?.manifest,startIcon:u===v?.manifest?a.jsx(pr,{size:20}):a.jsx(_f,{}),children:u===v?.manifest?"Restoring...":"Restore"})]})]}),a.jsx(VS,{open:b,onClose:()=>w(!1),onSettingsSaved:y})]})},QS=()=>{const{user:t}=Aa(),[e,r]=_.useState([]),[n,s]=_.useState([]),[i,o]=_.useState(""),[l,u]=_.useState(!0),[d,f]=_.useState(null),[m,v]=_.useState(!1),[p,b]=_.useState({name:"",email:""}),[w,y]=_.useState(!1);_.useEffect(()=>{j()},[]),_.useEffect(()=>{i?O():s([])},[i]);const j=async()=>{try{u(!0);const U=await Bh();r(U),f(null)}catch(U){f("Failed to fetch data. Please try again."),console.error("Error fetching data:",U)}finally{u(!1)}},O=async()=>{if(i)try{const U=await FS(i);s(U);const C=new Date;C.setDate(C.getDate()-1);const N=U.find(Q=>!Q.clock_out&&new Date(Q.clock_in).toDateString()!==new Date().toDateString());y(!!N)}catch(U){f("Failed to fetch shifts. Please try again."),console.error("Error fetching shifts:",U)}},k=async()=>{if(!i){f("Please select a profile");return}if(n.some(U=>!U.clock_out)){f("You are already clocked in. Please clock out first.");return}try{const U=await RS(i);s([U,...n]),f(null),o(""),s([])}catch(U){f("Failed to clock in. Please try again."),console.error("Error clocking in:",U)}},I=async U=>{try{const C=await qS(U);s(n.map(N=>N.id===U?C:N)),f(null),o(""),s([])}catch(C){f("Failed to clock out. Please try again."),console.error("Error clocking out:",C)}},H=async()=>{try{const U=await jS(p.name,p.email);r([...e,U]),v(!1),b({name:"",email:""}),f(null)}catch(U){f("Failed to create profile. Please try again."),console.error("Error creating profile:",U)}},F=i&&n.some(U=>U.profile_id===i&&!U.clock_out);return l?a.jsx(ue,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:a.jsx(pr,{})}):a.jsxs(er,{maxWidth:"lg",sx:{mt:4,mb:4},children:[a.jsx(q,{variant:"h4",gutterBottom:!0,children:"Attendance (Shift Tracking)"}),d&&a.jsx(Ct,{severity:"error",sx:{mb:2},children:d}),w&&a.jsx(Ct,{severity:"warning",sx:{mb:2},children:"You have an unclosed shift from a previous day. Please clock out before starting a new shift."}),a.jsxs(Z,{container:!0,spacing:3,children:[a.jsx(Z,{item:!0,xs:12,md:6,children:a.jsxs(At,{sx:{p:2},children:[a.jsxs(ue,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[a.jsx(q,{variant:"h6",children:"Profile"}),t?.access_role!=="Time Tracking"&&a.jsx(Ce,{startIcon:a.jsx(Dm,{}),onClick:()=>v(!0),children:"Add Profile"})]}),a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"Select Profile"}),a.jsx(sn,{value:i,label:"Select Profile",onChange:U=>o(U.target.value),sx:{"& .MuiSelect-select":{fontSize:"1.1rem"}},children:e.map(U=>a.jsx(Jt,{value:U.id,sx:{fontSize:"1.1rem"},children:U.name},U.id))})]})]})}),i&&!F&&a.jsx(Z,{item:!0,xs:12,children:a.jsx(At,{sx:{p:2},children:a.jsx(ue,{display:"flex",justifyContent:"center",gap:2,children:a.jsx(Ce,{variant:"contained",sx:{backgroundColor:"green","&:hover":{backgroundColor:"darkgreen"}},onClick:k,children:"Clock In"})})})}),i&&a.jsx(Z,{item:!0,xs:12,children:a.jsxs(At,{sx:{p:2},children:[a.jsx(ue,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:a.jsxs(q,{variant:"h6",gutterBottom:!0,children:["Shift History for ",e.find(U=>U.id===i)?.name]})}),a.jsx(Ma,{children:a.jsxs(Sa,{children:[a.jsx(Ca,{children:a.jsxs(Fr,{children:[a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Clock In"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Clock Out"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Duration"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:"Actions"})]})}),a.jsx(Pa,{children:n.map(U=>{const C=new Date(U.clock_in),N=U.clock_out?new Date(U.clock_out):null,Q=U.duration!==null&&U.duration!==void 0?Number(U.duration):null;return a.jsxs(Fr,{children:[a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:C.toLocaleString()}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:N?N.toLocaleString():"-"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:Q!==null?`${Q.toFixed(2)} hrs`:"-"}),a.jsx(Qe,{sx:{fontSize:"1.1rem"},children:!U.clock_out&&a.jsx(Ce,{variant:"contained",sx:{backgroundColor:"red","&:hover":{backgroundColor:"darkred"}},onClick:()=>I(U.id),children:"Clock Out"})})]},U.id)})})]})})]})})]}),a.jsxs(Sr,{open:m,onClose:()=>v(!1),children:[a.jsx(Cr,{children:"Add Profile"}),a.jsxs(Pr,{children:[a.jsx(Oe,{label:"Name",value:p.name,onChange:U=>b({...p,name:U.target.value}),fullWidth:!0,sx:{mb:2}}),a.jsx(Oe,{label:"Email",value:p.email,onChange:U=>b({...p,email:U.target.value}),fullWidth:!0})]}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:()=>v(!1),children:"Cancel"}),a.jsx(Ce,{onClick:H,variant:"contained",children:"Save"})]})]})]})};var xl={},mm;function JS(){if(mm)return xl;mm=1;var t=jn();Object.defineProperty(xl,"__esModule",{value:!0}),xl.default=void 0;var e=t(Cn()),r=Sn();return xl.default=(0,e.default)((0,r.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),xl}var KS=JS();const Wh=Dr(KS);var yl={},gm;function XS(){if(gm)return yl;gm=1;var t=jn();Object.defineProperty(yl,"__esModule",{value:!0}),yl.default=void 0;var e=t(Cn()),r=Sn();return yl.default=(0,e.default)((0,r.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),yl}var ZS=XS();const zh=Dr(ZS);var bl={},vm;function e4(){if(vm)return bl;vm=1;var t=jn();Object.defineProperty(bl,"__esModule",{value:!0}),bl.default=void 0;var e=t(Cn()),r=Sn();return bl.default=(0,e.default)((0,r.jsx)("path",{d:"M4 10h3v7H4zm6.5 0h3v7h-3zM2 19h20v3H2zm15-9h3v7h-3zm-5-9L2 6v2h20V6z"}),"AccountBalance"),bl}var t4=e4();const xh=Dr(t4),r4=()=>{const t=Vr(),[e,r]=_.useState(!0),[n,s]=_.useState(!1),[i,o]=_.useState([]),[l,u]=_.useState({}),[d,f]=_.useState(null),[m,v]=_.useState(null),[p,b]=_.useState(""),[w,y]=_.useState(""),[j,O]=_.useState(""),[k,I]=_.useState(""),[H,F]=_.useState(""),[U,C]=_.useState(""),[N,Q]=_.useState(""),[P,L]=_.useState(""),[te,W]=_.useState(""),[z,V]=_.useState(""),[Y,E]=_.useState(""),[X,oe]=_.useState(""),[de,A]=_.useState(!1),[D,J]=_.useState(""),[re,ce]=_.useState("");_.useEffect(()=>{ee()},[]);const fe=()=>{const Fe=`${eo().baseURL}/api/qbo/auth`;window.location.href=Fe},ee=async()=>{r(!0);try{const se=await xe.get("/api/qbo-accounts/test-connection");if(v(se.data),se.data.connected){const Fe=await xe.get("/api/qbo-accounts/accounts");o(Fe.data.accounts),u(Fe.data.accountTypes);const ne=await xe.get("/api/qbo-accounts/mapping");ne.data.mapping&&(f(ne.data.mapping),b(ne.data.mapping.qbo_inventory_account_id),y(ne.data.mapping.qbo_gst_account_id),O(ne.data.mapping.qbo_ap_account_id),I(ne.data.mapping.qbo_supply_expense_account_id||""),F(ne.data.mapping.qbo_sales_account_id||""),C(ne.data.mapping.qbo_labour_sales_account_id||""),Q(ne.data.mapping.qbo_ar_account_id||""),L(ne.data.mapping.qbo_cogs_account_id||""),W(ne.data.mapping.qbo_cost_of_labour_account_id||""),V(ne.data.mapping.qbo_cost_of_materials_account_id||""),E(ne.data.mapping.qbo_labour_expense_reduction_account_id||""),oe(ne.data.mapping.qbo_overhead_cogs_account_id||""))}}catch(se){console.error("Error loading QBO data:",se),ve.error("Failed to load QuickBooks data")}finally{r(!1)}},ae=async()=>{if(!p||!w||!j){ve.error("Please select all required accounts");return}s(!0);try{const se=await xe.post("/api/qbo-accounts/mapping",{qbo_inventory_account_id:p,qbo_gst_account_id:w,qbo_ap_account_id:j,qbo_supply_expense_account_id:k,qbo_sales_account_id:H,qbo_labour_sales_account_id:U,qbo_ar_account_id:N,qbo_cogs_account_id:P,qbo_cost_of_labour_account_id:te,qbo_cost_of_materials_account_id:z,qbo_labour_expense_reduction_account_id:Y,qbo_overhead_cogs_account_id:X});f(se.data.mapping),ve.success("Account mapping saved successfully")}catch(se){console.error("Error saving mapping:",se),ve.error("Failed to save account mapping")}finally{s(!1)}},pe=se=>{const Fe=se.AccountNumber?`#${se.AccountNumber}`:"";return`${se.Name} ${Fe} (${se.AccountType})`},ye=se=>{let Fe=i.filter(ne=>ne.Classification===se);if(re){const ne=re.toLowerCase();Fe=Fe.filter(R=>R.Name.toLowerCase().includes(ne)||R.AccountNumber&&R.AccountNumber.includes(ne)||R.Description&&R.Description.toLowerCase().includes(ne))}return Fe},Le=()=>a.jsxs(Sr,{open:de,onClose:()=>A(!1),maxWidth:"md",fullWidth:!0,children:[a.jsxs(Cr,{children:["QuickBooks Accounts - ",D]}),a.jsx(Pr,{children:a.jsx(ue,{sx:{mt:2},children:l[D]?.map(se=>a.jsx(Ir,{sx:{mb:1,p:2},children:a.jsxs(ue,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[a.jsxs(ue,{children:[a.jsx(q,{variant:"h6",children:se.Name}),a.jsxs(q,{variant:"body2",color:"text.secondary",children:["Type: ",se.AccountType," | Subtype: ",se.AccountSubType]}),se.AccountNumber&&a.jsxs(q,{variant:"body2",color:"primary",fontWeight:500,children:["Account #: ",se.AccountNumber]}),se.Description&&a.jsx(q,{variant:"body2",color:"text.secondary",children:se.Description})]}),a.jsx(Zt,{label:se.AccountNumber||"No Number",size:"small",color:se.AccountNumber?"primary":"default",variant:"outlined"})]})},se.Id))})}),a.jsx(Nr,{children:a.jsx(Ce,{onClick:()=>A(!1),children:"Close"})})]});return e?a.jsx(ue,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:a.jsx(pr,{})}):a.jsxs(er,{maxWidth:"lg",sx:{py:4},children:[a.jsxs(ue,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[a.jsxs(ue,{display:"flex",alignItems:"center",children:[a.jsx(Ce,{startIcon:a.jsx(Wh,{}),onClick:()=>t("/business-profile"),sx:{mr:2},children:"Back"}),a.jsx(q,{variant:"h4",component:"h1",children:"QuickBooks Account Mapping"})]}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx(xh,{}),onClick:fe,sx:{borderRadius:2,fontWeight:600},children:"Connect to QuickBooks"})]}),m&&a.jsx(Ir,{sx:{mb:3},children:a.jsxs(Yr,{children:[a.jsxs(ue,{display:"flex",alignItems:"center",gap:2,children:[m.connected?a.jsx(Wl,{color:"success"}):a.jsx(ku,{color:"error"}),a.jsx(q,{variant:"h6",children:m.connected?"Connected to QuickBooks":"Not Connected"})]}),a.jsx(q,{variant:"body2",color:"text.secondary",sx:{mt:1},children:m.message}),m.connected&&m.realmId&&a.jsxs(q,{variant:"body2",color:"text.secondary",children:["Realm ID: ",m.realmId]})]})}),m?.connected?a.jsxs(a.Fragment,{children:[a.jsx(Z,{container:!0,spacing:3,sx:{mb:3},children:Object.entries(l).map(([se,Fe])=>a.jsx(Z,{item:!0,xs:12,sm:6,md:4,children:a.jsx(Ir,{children:a.jsxs(Yr,{children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:se}),a.jsx(q,{variant:"h4",color:"primary",children:Fe.length}),a.jsx(Ce,{size:"small",onClick:()=>{J(se),A(!0)},sx:{mt:1},children:"View Accounts"})]})})},se))}),a.jsxs(At,{sx:{p:3},children:[a.jsx(q,{variant:"h5",gutterBottom:!0,children:"Map QuickBooks Accounts"}),a.jsx(q,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Select the QuickBooks accounts that correspond to your business accounts. Different companies use different account names, so choose the accounts that make sense for your business."}),a.jsxs(Ct,{severity:"info",sx:{mb:3},children:[a.jsxs(q,{variant:"body2",children:[a.jsx("strong",{children:"How this works:"})," Configure your QuickBooks accounts to map to your business transactions. Accounts used by both purchase orders and sales orders are shown at the top."]}),a.jsxs(q,{variant:"body2",sx:{mt:1},children:[a.jsx("strong",{children:"Purchase Orders:"})," Stock items  Inventory Account, Supply items  Supply Expense Account, GST  GST Account, Total  Accounts Payable."]}),a.jsxs(q,{variant:"body2",sx:{mt:1},children:[a.jsx("strong",{children:"Sales Orders:"})," Materials  Sales Account, Labour  Labour Sales Account, GST  GST Account, Total  Accounts Receivable, Costs  COGS Account."]})]}),a.jsx(ue,{sx:{mb:3},children:a.jsx(Oe,{fullWidth:!0,label:"Search accounts by name, number, or description",value:re,onChange:se=>ce(se.target.value),placeholder:"e.g., 1200, Inventory, GST...",size:"small",InputProps:{startAdornment:a.jsx(rs,{sx:{mr:1,color:"text.secondary"}})}})}),a.jsx(q,{variant:"h6",sx:{mt:4,mb:2,color:"primary.main"},children:"Shared Accounts (Purchase Orders & Sales Orders)"}),a.jsxs(Z,{container:!0,spacing:3,children:[a.jsxs(Z,{item:!0,xs:12,md:6,children:[a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"GST/Tax Account"}),a.jsx(sn,{value:w,onChange:se=>y(se.target.value),label:"GST/Tax Account",children:ye("Liability").map(se=>a.jsx(Jt,{value:se.Id,children:pe(se)},se.Id))})]}),a.jsx(q,{variant:"caption",color:"text.secondary",children:"Account for GST/HST/tax tracking (used by both purchase orders and sales orders)"})]}),a.jsxs(Z,{item:!0,xs:12,md:6,children:[a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"Inventory Account"}),a.jsx(sn,{value:p,onChange:se=>b(se.target.value),label:"Inventory Account",children:ye("Asset").map(se=>a.jsx(Jt,{value:se.Id,children:pe(se)},se.Id))})]}),a.jsx(q,{variant:"caption",color:"text.secondary",children:"Account for tracking inventory (stock purchases and sales cost reduction)"})]})]}),a.jsx(q,{variant:"h6",sx:{mt:4,mb:2},children:"Purchase Order Account Mapping"}),a.jsxs(Z,{container:!0,spacing:3,children:[a.jsxs(Z,{item:!0,xs:12,md:6,children:[a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"Supply Expense Account"}),a.jsxs(sn,{value:k,onChange:se=>I(se.target.value),label:"Supply Expense Account",children:[a.jsx(Jt,{value:"",children:a.jsx("em",{children:"Optional - Select an expense account"})}),ye("Expense").map(se=>a.jsx(Jt,{value:se.Id,children:pe(se)},se.Id))]})]}),a.jsx(q,{variant:"caption",color:"text.secondary",children:"Account for supply items (e.g., Office Supplies, Tools, etc.) - Optional"})]}),a.jsxs(Z,{item:!0,xs:12,md:6,children:[a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"Accounts Payable"}),a.jsx(sn,{value:j,onChange:se=>O(se.target.value),label:"Accounts Payable",children:ye("Liability").map(se=>a.jsx(Jt,{value:se.Id,children:pe(se)},se.Id))})]}),a.jsx(q,{variant:"caption",color:"text.secondary",children:'Account for tracking vendor payables (usually "Accounts Payable")'})]})]}),a.jsx(q,{variant:"h6",sx:{mt:4,mb:2},children:"Sales Order Account Mapping"}),a.jsxs(Z,{container:!0,spacing:3,children:[a.jsxs(Z,{item:!0,xs:12,md:6,children:[a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"Sales Account"}),a.jsx(sn,{value:H,onChange:se=>F(se.target.value),label:"Sales Account",children:ye("Revenue").map(se=>a.jsx(Jt,{value:se.Id,children:pe(se)},se.Id))})]}),a.jsx(q,{variant:"caption",color:"text.secondary",children:"Revenue account for sales (e.g., Sales, Revenue, etc.) - Used for invoice creation"})]}),a.jsxs(Z,{item:!0,xs:12,md:6,children:[a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"Accounts Receivable"}),a.jsx(sn,{value:N,onChange:se=>Q(se.target.value),label:"Accounts Receivable",children:ye("Asset").map(se=>a.jsx(Jt,{value:se.Id,children:pe(se)},se.Id))})]}),a.jsx(q,{variant:"caption",color:"text.secondary",children:'Account for tracking customer receivables (usually "Accounts Receivable") - Used for invoice total amount'})]})]}),a.jsx(q,{variant:"h6",sx:{mt:4,mb:2},children:"Cost Accounts (Journal Entries)"}),a.jsxs(Z,{container:!0,spacing:3,children:[a.jsxs(Z,{item:!0,xs:12,md:6,children:[a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"Cost of Materials"}),a.jsxs(sn,{value:z,onChange:se=>V(se.target.value),label:"Cost of Materials",children:[a.jsx(Jt,{value:"",children:a.jsx("em",{children:"Optional - Select an expense account"})}),ye("Expense").map(se=>a.jsx(Jt,{value:se.Id,children:pe(se)},se.Id))]})]}),a.jsx(q,{variant:"caption",color:"text.secondary",children:"Expense account for tracking cost of materials sold - Used for COGS journal entries - Optional"})]}),a.jsxs(Z,{item:!0,xs:12,md:6,children:[a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"Cost of Labour"}),a.jsxs(sn,{value:te,onChange:se=>W(se.target.value),label:"Cost of Labour",children:[a.jsx(Jt,{value:"",children:a.jsx("em",{children:"Optional - Select an expense account"})}),ye("Expense").map(se=>a.jsx(Jt,{value:se.Id,children:pe(se)},se.Id))]})]}),a.jsx(q,{variant:"caption",color:"text.secondary",children:"Expense account for tracking cost of labour sold - Used for COGS journal entries - Optional"})]}),a.jsxs(Z,{item:!0,xs:12,md:6,children:[a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"Labour Expense Reduction Account"}),a.jsxs(sn,{value:Y,onChange:se=>E(se.target.value),label:"Labour Expense Reduction Account",children:[a.jsx(Jt,{value:"",children:a.jsx("em",{children:"Optional - Select an expense account"})}),ye("Expense").map(se=>a.jsx(Jt,{value:se.Id,children:pe(se)},se.Id))]})]}),a.jsx(q,{variant:"caption",color:"text.secondary",children:"Expense account for reducing labour costs when sold (e.g., Labour Expense, Wages Expense) - Used for COGS journal entries - Optional"})]}),a.jsxs(Z,{item:!0,xs:12,md:6,children:[a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"Overhead COGS Account"}),a.jsxs(sn,{value:X,onChange:se=>oe(se.target.value),label:"Overhead COGS Account",children:[a.jsx(Jt,{value:"",children:a.jsx("em",{children:"Optional - Select an expense account"})}),ye("Expense").map(se=>a.jsx(Jt,{value:se.Id,children:pe(se)},se.Id))]})]}),a.jsx(q,{variant:"caption",color:"text.secondary",children:"Expense account for tracking overhead costs when sold - Used for COGS journal entries - Optional"})]})]}),a.jsx(ue,{sx:{mt:3,display:"flex",justifyContent:"center"},children:a.jsx(Ce,{variant:"outlined",onClick:()=>t("/overhead-management"),sx:{width:"100%",maxWidth:"600px",borderRadius:2,fontWeight:600,py:1.5,fontSize:"1.1rem"},children:"Manage Overhead Settings"})}),a.jsxs(ue,{sx:{mt:3,display:"flex",gap:2},children:[a.jsx(Ce,{variant:"contained",startIcon:a.jsx(Vs,{}),onClick:ae,disabled:n||!p||!w||!j,children:n?"Saving...":"Save Mapping"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx(zh,{}),onClick:ee,disabled:e,children:"Refresh"})]}),d&&a.jsxs(ue,{sx:{mt:3,p:2,bgcolor:"grey.50",borderRadius:1},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Current Mapping"}),a.jsx(q,{variant:"subtitle2",color:"primary",sx:{mt:2,mb:1},children:"Shared Accounts (Purchase Orders & Sales Orders)"}),a.jsxs(Z,{container:!0,spacing:2,children:[a.jsx(Z,{item:!0,xs:12,md:6,children:a.jsxs(q,{variant:"body2",color:"text.secondary",children:["GST/Tax: ",(()=>{const se=i.find(Fe=>Fe.Id===d.qbo_gst_account_id);return se?`${se.Name}${se.AccountNumber?` (#${se.AccountNumber})`:""}`:"Not configured"})()]})}),a.jsx(Z,{item:!0,xs:12,md:6,children:a.jsxs(q,{variant:"body2",color:"text.secondary",children:["Inventory: ",(()=>{const se=i.find(Fe=>Fe.Id===d.qbo_inventory_account_id);return se?`${se.Name}${se.AccountNumber?` (#${se.AccountNumber})`:""}`:"Not configured"})()]})})]}),a.jsx(q,{variant:"subtitle2",color:"primary",sx:{mt:2,mb:1},children:"Purchase Order Accounts"}),a.jsxs(Z,{container:!0,spacing:2,children:[a.jsx(Z,{item:!0,xs:12,md:6,children:a.jsxs(q,{variant:"body2",color:"text.secondary",children:["Supply Expense: ",(()=>{const se=i.find(Fe=>Fe.Id===d.qbo_supply_expense_account_id);return se?`${se.Name}${se.AccountNumber?` (#${se.AccountNumber})`:""}`:"Not configured"})()]})}),a.jsx(Z,{item:!0,xs:12,md:6,children:a.jsxs(q,{variant:"body2",color:"text.secondary",children:["Accounts Payable: ",(()=>{const se=i.find(Fe=>Fe.Id===d.qbo_ap_account_id);return se?`${se.Name}${se.AccountNumber?` (#${se.AccountNumber})`:""}`:"Not configured"})()]})})]}),a.jsx(q,{variant:"subtitle2",color:"primary",sx:{mt:2,mb:1},children:"Sales Order Accounts"}),a.jsxs(Z,{container:!0,spacing:2,children:[a.jsx(Z,{item:!0,xs:12,md:6,children:a.jsxs(q,{variant:"body2",color:"text.secondary",children:["Sales: ",(()=>{const se=i.find(Fe=>Fe.Id===d.qbo_sales_account_id);return se?`${se.Name}${se.AccountNumber?` (#${se.AccountNumber})`:""}`:"Not configured"})()]})}),a.jsx(Z,{item:!0,xs:12,md:6,children:a.jsxs(q,{variant:"body2",color:"text.secondary",children:["Accounts Receivable: ",(()=>{const se=i.find(Fe=>Fe.Id===d.qbo_ar_account_id);return se?`${se.Name}${se.AccountNumber?` (#${se.AccountNumber})`:""}`:"Not configured"})()]})})]}),a.jsx(q,{variant:"subtitle2",color:"primary",sx:{mt:2,mb:1},children:"Cost Accounts"}),a.jsxs(Z,{container:!0,spacing:2,children:[a.jsx(Z,{item:!0,xs:12,md:6,children:a.jsxs(q,{variant:"body2",color:"text.secondary",children:["Cost of Materials: ",(()=>{const se=i.find(Fe=>Fe.Id===d.qbo_cost_of_materials_account_id);return se?`${se.Name}${se.AccountNumber?` (#${se.AccountNumber})`:""}`:"Not configured"})()]})}),a.jsx(Z,{item:!0,xs:12,md:6,children:a.jsxs(q,{variant:"body2",color:"text.secondary",children:["Cost of Labour: ",(()=>{const se=i.find(Fe=>Fe.Id===d.qbo_cost_of_labour_account_id);return se?`${se.Name}${se.AccountNumber?` (#${se.AccountNumber})`:""}`:"Not configured"})()]})}),a.jsx(Z,{item:!0,xs:12,md:6,children:a.jsxs(q,{variant:"body2",color:"text.secondary",children:["Labour Expense Reduction: ",(()=>{const se=i.find(Fe=>Fe.Id===d.qbo_labour_expense_reduction_account_id);return se?`${se.Name}${se.AccountNumber?` (#${se.AccountNumber})`:""}`:"Not configured"})()]})}),a.jsx(Z,{item:!0,xs:12,md:6,children:a.jsxs(q,{variant:"body2",color:"text.secondary",children:["Overhead COGS: ",(()=>{const se=i.find(Fe=>Fe.Id===d.qbo_overhead_cogs_account_id);return se?`${se.Name}${se.AccountNumber?` (#${se.AccountNumber})`:""}`:"Not configured"})()]})})]})]})]})]}):a.jsx(Ct,{severity:"warning",sx:{mb:3},children:"Please connect your QuickBooks account first in the Business Profile page."}),Le()]})},n4=()=>{const t=Vr(),[e,r]=_.useState(!0),[n,s]=_.useState(!1),[i,o]=_.useState([]),[l,u]=_.useState({}),[d,f]=_.useState([]),[m,v]=_.useState(null),[p,b]=_.useState(!1),[w,y]=_.useState(""),[j,O]=_.useState(""),[k,I]=_.useState(!1),[H,F]=_.useState(null),[U,C]=_.useState({expense_account_id:"",percentage:"",description:""});_.useEffect(()=>{N()},[]);const N=async()=>{r(!0);try{const[E,X]=await Promise.all([xe.get("/api/qbo-accounts/accounts"),xe.get("/api/overhead/distribution")]);o(E.data.accounts||[]),u(E.data.accountTypes||{}),f(X.data||[]),v({connected:!0,message:"Connected to QuickBooks"})}catch(E){console.error("Error loading data:",E),v({connected:!1,message:E.response?.data?.error||"Failed to connect to QuickBooks"}),ve.error("Failed to load overhead management data")}finally{r(!1)}},Q=async()=>{if(!U.expense_account_id||!U.percentage){ve.error("Please fill in all required fields");return}const E=parseFloat(U.percentage);if(isNaN(E)||E<=0||E>100){ve.error("Percentage must be between 0 and 100");return}const X=d.filter(oe=>oe.id!==H?.id).reduce((oe,de)=>oe+de.percentage,0);if(X+E>100){ve.error(`Total percentage would exceed 100%. Current total: ${X}%, adding: ${E}%`);return}s(!0);try{H?(await xe.put(`/api/overhead/distribution/${H.id}`,{expense_account_id:U.expense_account_id,percentage:E,description:U.description}),ve.success("Distribution updated successfully")):(await xe.post("/api/overhead/distribution",{expense_account_id:U.expense_account_id,percentage:E,description:U.description}),ve.success("Distribution added successfully")),I(!1),F(null),C({expense_account_id:"",percentage:"",description:""}),N()}catch(oe){console.error("Error saving distribution:",oe),ve.error(oe.response?.data?.error||"Failed to save distribution")}finally{s(!1)}},P=E=>{F(E),C({expense_account_id:E.expense_account_id,percentage:E.percentage.toString(),description:E.description}),I(!0)},L=async E=>{if(window.confirm("Are you sure you want to delete this distribution?"))try{await xe.delete(`/api/overhead/distribution/${E}`),ve.success("Distribution deleted successfully"),N()}catch(X){console.error("Error deleting distribution:",X),ve.error(X.response?.data?.error||"Failed to delete distribution")}},te=()=>{F(null),C({expense_account_id:"",percentage:"",description:""}),I(!0)},W=E=>`${E.Name} (${E.AccountType})`,z=E=>(l[E]||[]).filter(X=>X.Classification===E).map(X=>({label:W(X),value:X.Id,account:X})),V=()=>a.jsxs(Sr,{open:p,onClose:()=>b(!1),maxWidth:"md",fullWidth:!0,children:[a.jsx(Cr,{children:a.jsxs(ue,{display:"flex",alignItems:"center",gap:1,children:[a.jsx(xh,{}),"QuickBooks Accounts"]})}),a.jsxs(Pr,{children:[a.jsx(ue,{mb:2,children:a.jsx(Oe,{fullWidth:!0,label:"Search accounts",value:j,onChange:E=>O(E.target.value),InputProps:{startAdornment:a.jsx(rs,{})}})}),a.jsxs(nn,{fullWidth:!0,sx:{mb:2},children:[a.jsx(an,{children:"Account Type"}),a.jsxs(sn,{value:w,onChange:E=>y(E.target.value),label:"Account Type",children:[a.jsx(Jt,{value:"",children:"All Types"}),a.jsx(Jt,{value:"Asset",children:"Asset"}),a.jsx(Jt,{value:"Liability",children:"Liability"}),a.jsx(Jt,{value:"Equity",children:"Equity"}),a.jsx(Jt,{value:"Revenue",children:"Revenue"}),a.jsx(Jt,{value:"Expense",children:"Expense"})]})]}),a.jsx(ue,{maxHeight:400,overflow:"auto",children:Object.entries(l).map(([E,X])=>{if(w&&E!==w)return null;const oe=X.filter(de=>de.Name.toLowerCase().includes(j.toLowerCase())||de.AccountType.toLowerCase().includes(j.toLowerCase()));return oe.length===0?null:a.jsxs(ue,{mb:3,children:[a.jsxs(q,{variant:"h6",gutterBottom:!0,children:[E," Accounts (",oe.length,")"]}),a.jsx(Z,{container:!0,spacing:1,children:oe.map(de=>a.jsx(Z,{item:!0,xs:12,sm:6,md:4,children:a.jsxs(Ir,{variant:"outlined",sx:{p:1},children:[a.jsx(q,{variant:"body2",fontWeight:"bold",children:de.Name}),a.jsx(q,{variant:"caption",color:"textSecondary",children:de.AccountType}),de.AccountNumber&&a.jsxs(q,{variant:"caption",display:"block",color:"textSecondary",children:["#",de.AccountNumber]})]})},de.Id))})]},E)})})]}),a.jsx(Nr,{children:a.jsx(Ce,{onClick:()=>b(!1),children:"Close"})})]}),Y=d.reduce((E,X)=>E+X.percentage,0);return a.jsxs(er,{maxWidth:"xl",sx:{mt:4,mb:4},children:[a.jsxs(ue,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[a.jsxs(ue,{sx:{display:"flex",alignItems:"center",gap:2},children:[a.jsx(jr,{onClick:()=>t(-1),children:a.jsx(Wh,{})}),a.jsx(q,{variant:"h4",gutterBottom:!0,children:"Overhead Management"})]}),a.jsxs(Kr,{direction:"row",spacing:2,children:[a.jsx(Ce,{variant:"outlined",onClick:()=>b(!0),startIcon:a.jsx(xh,{}),children:"View QBO Accounts"}),a.jsx(Ce,{variant:"contained",onClick:te,startIcon:a.jsx(ka,{}),children:"Add Distribution"}),a.jsx(Ce,{variant:"outlined",onClick:N,startIcon:a.jsx(zh,{}),children:"Refresh"})]})]}),m&&a.jsx(Ct,{severity:m.connected?"success":"error",icon:m.connected?a.jsx(Wl,{}):a.jsx(ku,{}),sx:{mb:3},children:m.message}),a.jsxs(At,{sx:{p:3,mb:3},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Distribution Summary"}),a.jsxs(Z,{container:!0,spacing:2,children:[a.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Ir,{children:a.jsxs(Yr,{children:[a.jsx(q,{color:"textSecondary",gutterBottom:!0,children:"Total Distributions"}),a.jsx(q,{variant:"h4",children:d.length})]})})}),a.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Ir,{children:a.jsxs(Yr,{children:[a.jsx(q,{color:"textSecondary",gutterBottom:!0,children:"Total Percentage"}),a.jsxs(q,{variant:"h4",color:Y===100?"success.main":"warning.main",children:[Y.toFixed(1),"%"]})]})})}),a.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Ir,{children:a.jsxs(Yr,{children:[a.jsx(q,{color:"textSecondary",gutterBottom:!0,children:"Remaining"}),a.jsxs(q,{variant:"h4",color:Y>100?"error.main":"text.primary",children:[(100-Y).toFixed(1),"%"]})]})})}),a.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Ir,{children:a.jsxs(Yr,{children:[a.jsx(q,{color:"textSecondary",gutterBottom:!0,children:"Status"}),a.jsx(Zt,{label:Y===100?"Complete":Y>100?"Over 100%":"Incomplete",color:Y===100?"success":Y>100?"error":"warning"})]})})})]})]}),a.jsx(At,{sx:{width:"100%",overflow:"hidden"},children:a.jsxs(ue,{sx:{p:2},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Expense Distributions"}),e?a.jsx(ue,{display:"flex",justifyContent:"center",p:3,children:a.jsx(pr,{})}):d.length===0?a.jsx(Ct,{severity:"info",children:'No expense distributions configured. Click "Add Distribution" to get started.'}):a.jsx(Z,{container:!0,spacing:2,children:d.map(E=>{const X=i.find(oe=>oe.Id===E.expense_account_id);return a.jsx(Z,{item:!0,xs:12,sm:6,md:4,children:a.jsx(Ir,{children:a.jsx(Yr,{children:a.jsxs(ue,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[a.jsxs(ue,{flex:1,children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:E.description||X?.Name||"Unknown Account"}),a.jsxs(q,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:[X?.Name," (",X?.AccountType,")"]}),a.jsx(Zt,{label:`${E.percentage}%`,color:"primary",size:"small"})]}),a.jsxs(ue,{children:[a.jsx(jr,{size:"small",onClick:()=>P(E),children:a.jsx(Tl,{})}),a.jsx(jr,{size:"small",color:"error",onClick:()=>L(E.id),children:a.jsx(la,{})})]})]})})})},E.id)})})]})}),a.jsxs(Sr,{open:k,onClose:()=>I(!1),maxWidth:"sm",fullWidth:!0,children:[a.jsx(Cr,{children:H?"Edit Distribution":"Add Distribution"}),a.jsx(Pr,{children:a.jsxs(Kr,{spacing:3,sx:{mt:1},children:[a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"Expense Account"}),a.jsx(sn,{value:U.expense_account_id,onChange:E=>C(X=>({...X,expense_account_id:E.target.value})),label:"Expense Account",children:z("Expense").map(E=>a.jsx(Jt,{value:E.value,children:E.label},E.value))})]}),a.jsx(Oe,{label:"Percentage",type:"number",value:U.percentage,onChange:E=>C(X=>({...X,percentage:E.target.value})),inputProps:{min:0,max:100,step:.01},helperText:`Current total: ${Y}%${H?` (excluding this item: ${(Y-H.percentage).toFixed(1)}%)`:""}`}),a.jsx(Oe,{label:"Description (Optional)",value:U.description,onChange:E=>C(X=>({...X,description:E.target.value})),helperText:"A description to help identify this distribution"})]})}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:()=>I(!1),children:"Cancel"}),a.jsx(Ce,{onClick:Q,variant:"contained",disabled:n||!U.expense_account_id||!U.percentage,startIcon:n?a.jsx(pr,{size:20}):a.jsx(Vs,{}),children:n?"Saving...":"Save"})]})]}),V()]})},a4=()=>{const[t,e]=_.useState(!1),[r,n]=_.useState(!1),[s,i]=_.useState([]),[o,l]=_.useState(new Set),u=Vr();_.useEffect(()=>{d();const b=()=>{console.log(" Parts to order update event received, refreshing data..."),d()};return window.addEventListener("parts-to-order-updated",b),()=>{window.removeEventListener("parts-to-order-updated",b)}},[]);const d=async()=>{e(!0);try{const b=await xe.get("/api/sales-orders/parts-to-order/all"),{individualParts:w,aggregatedParts:y}=b.data;if(y&&y.length>0)i(y);else{const j=f(w);i(j)}}catch(b){console.error("Error fetching parts to order:",b),ve.error("Failed to load parts to order data")}finally{e(!1)}},f=b=>{const w={};return b.forEach(y=>{w[y.part_number]||(w[y.part_number]={part_number:y.part_number,part_description:y.part_description,total_quantity_needed:0,unit:y.unit,unit_price:y.unit_price,total_line_amount:0,sales_orders:[]}),w[y.part_number].total_quantity_needed+=y.quantity_needed,w[y.part_number].total_line_amount+=y.line_amount,w[y.part_number].sales_orders.push(y)}),Object.values(w)},m=b=>{const w=new Set(o);w.has(b)?w.delete(b):w.add(b),l(w)},v=()=>{d()},p=async b=>{let w=s;if(b){const y=s.find(j=>j.part_number===b);if(!y){ve.warning(`Part ${b} not found for purchase order creation.`);return}w=[y]}if(w.length===0){ve.warning("No parts to order");return}n(!0);try{const y=await xe.post("/api/purchase-orders/auto-create-from-parts-to-order",{parts:w});if(y.data.success)if(ve.success(`Purchase order created successfully! PO Number: ${y.data.purchase_order_number}`),y.data.purchase_orders&&y.data.purchase_orders.length===1){const j=y.data.purchase_orders[0].purchase_id;u(`/open-purchase-orders/${j}`)}else d();else ve.error(y.data.message||"Failed to create purchase order")}catch(y){console.error("Error creating purchase order:",y),ve.error(y.response?.data?.error||"Failed to create purchase order")}finally{n(!1)}};return t?a.jsx(ue,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:a.jsx(pr,{})}):a.jsxs(ue,{p:3,children:[a.jsxs(ue,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[a.jsx(q,{variant:"h3",component:"h1",children:"Parts to Order"}),a.jsx(Ce,{variant:"outlined",startIcon:a.jsx(Om,{}),onClick:v,children:"Refresh"})]}),s.length===0?a.jsx(Ct,{severity:"info",children:"No parts currently need to be ordered."}):a.jsx(Ma,{component:At,children:a.jsxs(Sa,{size:"medium",children:[a.jsx(Ca,{children:a.jsxs(Fr,{children:[a.jsx(Qe,{children:a.jsx(q,{variant:"h6",fontWeight:"bold"})}),a.jsx(Qe,{children:a.jsx(q,{variant:"h6",fontWeight:"bold",children:"Part Number"})}),a.jsx(Qe,{children:a.jsx(q,{variant:"h6",fontWeight:"bold",children:"Description"})}),a.jsx(Qe,{align:"center",children:a.jsx(q,{variant:"h6",fontWeight:"bold",children:"Quantity to Order"})}),a.jsx(Qe,{align:"center",children:a.jsx(q,{variant:"h6",fontWeight:"bold",children:"Unit"})}),a.jsx(Qe,{align:"center",children:a.jsx(q,{variant:"h6",fontWeight:"bold",children:"Unit Price"})}),a.jsx(Qe,{align:"center",children:a.jsx(q,{variant:"h6",fontWeight:"bold",children:"Total Amount"})}),a.jsx(Qe,{align:"center",children:a.jsx(q,{variant:"h6",fontWeight:"bold",children:"Actions"})})]})}),a.jsx(Pa,{children:s.map(b=>a.jsxs(vs.Fragment,{children:[a.jsxs(Fr,{children:[a.jsx(Qe,{children:a.jsx(jr,{size:"small",onClick:()=>m(b.part_number),children:o.has(b.part_number)?a.jsx(R0,{}):a.jsx(q0,{})})}),a.jsx(Qe,{children:a.jsx(q,{variant:"body1",fontWeight:"medium",fontSize:"1.1rem",children:b.part_number})}),a.jsx(Qe,{children:a.jsx(q,{variant:"body1",fontSize:"1.1rem",children:b.part_description})}),a.jsx(Qe,{align:"center",children:a.jsx(q,{variant:"body1",fontWeight:"medium",fontSize:"1.1rem",children:Number(b.total_quantity_needed)||0})}),a.jsx(Qe,{align:"center",children:a.jsx(q,{variant:"body1",fontSize:"1.1rem",children:b.unit})}),a.jsx(Qe,{align:"center",children:a.jsxs(q,{variant:"body1",fontSize:"1.1rem",children:["$",(Number(b.unit_price)||0).toFixed(2)]})}),a.jsx(Qe,{align:"center",children:a.jsxs(q,{variant:"body1",fontSize:"1.1rem",children:["$",(Number(b.total_line_amount)||0).toFixed(2)]})}),a.jsx(Qe,{align:"center",children:a.jsx(Ce,{variant:"contained",color:"primary",size:"medium",startIcon:a.jsx(B0,{}),onClick:()=>p(b.part_number),disabled:r,children:"Create PO"})})]}),a.jsx(Fr,{children:a.jsx(Qe,{style:{paddingBottom:0,paddingTop:0},colSpan:8,children:a.jsx(Nm,{in:o.has(b.part_number),timeout:"auto",unmountOnExit:!0,children:a.jsxs(ue,{sx:{margin:1},children:[a.jsx(q,{variant:"h5",gutterBottom:!0,component:"div",children:"Sales Orders Requiring This Part"}),a.jsxs(Sa,{size:"medium",children:[a.jsx(Ca,{children:a.jsxs(Fr,{children:[a.jsx(Qe,{children:a.jsx(q,{variant:"subtitle1",fontWeight:"bold",children:"Sales Order"})}),a.jsx(Qe,{children:a.jsx(q,{variant:"subtitle1",fontWeight:"bold",children:"Customer"})}),a.jsx(Qe,{align:"center",children:a.jsx(q,{variant:"subtitle1",fontWeight:"bold",children:"Quantity to Order"})}),a.jsx(Qe,{align:"center",children:a.jsx(q,{variant:"subtitle1",fontWeight:"bold",children:"Unit Price"})}),a.jsx(Qe,{align:"center",children:a.jsx(q,{variant:"subtitle1",fontWeight:"bold",children:"Line Amount"})})]})}),a.jsx(Pa,{children:b.sales_orders.map(w=>a.jsxs(Fr,{children:[a.jsx(Qe,{children:a.jsx(q,{variant:"body1",fontSize:"1rem",children:w.sales_order_number})}),a.jsx(Qe,{children:a.jsx(q,{variant:"body1",fontSize:"1rem",children:w.customer_name})}),a.jsx(Qe,{align:"center",children:a.jsx(q,{variant:"body1",fontSize:"1rem",children:Number(w.quantity_needed)||0})}),a.jsx(Qe,{align:"center",children:a.jsxs(q,{variant:"body1",fontSize:"1rem",children:["$",(Number(w.unit_price)||0).toFixed(2)]})}),a.jsx(Qe,{align:"center",children:a.jsxs(q,{variant:"body1",fontSize:"1rem",children:["$",(Number(w.line_amount)||0).toFixed(2)]})})]},`${w.sales_order_id}-${w.part_number}`))})]})]})})})})]},b.part_number))})]})})]})},s4=()=>{const t=Vr(),[e,r]=_.useState(!0),[n,s]=_.useState(!1),[i,o]=_.useState([]),[l,u]=_.useState([]),[d,f]=_.useState([]),[m,v]=_.useState(!1),[p,b]=_.useState(""),[w,y]=_.useState("");_.useEffect(()=>{j()},[]);const j=async()=>{r(!0);try{const[F,U,C]=await Promise.all([xe.get("/api/time-tracking/admin/available-users"),xe.get("/api/time-tracking/profiles"),xe.get("/api/time-tracking/admin/user-profile-access")]);o(F.data||[]),u(U.data||[]),f(C.data||[])}catch(F){console.error("Error loading data:",F),ve.error("Failed to load mobile user access data")}finally{r(!1)}},O=async()=>{if(!p||!w){ve.error("Please select both a user and a profile");return}s(!0);try{await xe.post("/api/time-tracking/admin/user-profile-access",{user_id:p,profile_id:w}),ve.success("Profile access granted successfully"),v(!1),b(""),y(""),j()}catch(F){console.error("Error granting access:",F),ve.error(F.response?.data?.error||"Failed to grant access")}finally{s(!1)}},k=async F=>{if(window.confirm("Are you sure you want to revoke this profile access?"))try{await xe.delete(`/api/time-tracking/admin/user-profile-access/${F}`),ve.success("Profile access revoked successfully"),j()}catch(U){console.error("Error revoking access:",U),ve.error(U.response?.data?.error||"Failed to revoke access")}},I=d.filter(F=>F.is_active),H=d.filter(F=>!F.is_active);return a.jsxs(er,{maxWidth:"xl",sx:{mt:4,mb:4},children:[a.jsxs(ue,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[a.jsxs(ue,{sx:{display:"flex",alignItems:"center",gap:2},children:[a.jsx(jr,{onClick:()=>t(-1),children:a.jsx(Wh,{})}),a.jsx(q,{variant:"h4",gutterBottom:!0,children:"Mobile User Access Management"})]}),a.jsxs(Kr,{direction:"row",spacing:2,children:[a.jsx(Ce,{variant:"contained",onClick:()=>v(!0),startIcon:a.jsx(ka,{}),children:"Grant Access"}),a.jsx(Ce,{variant:"outlined",onClick:j,startIcon:a.jsx(zh,{}),children:"Refresh"})]})]}),a.jsxs(Z,{container:!0,spacing:3,sx:{mb:4},children:[a.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Ir,{children:a.jsxs(Yr,{children:[a.jsx(q,{color:"textSecondary",gutterBottom:!0,children:"Mobile Users"}),a.jsx(q,{variant:"h4",children:i.length})]})})}),a.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Ir,{children:a.jsxs(Yr,{children:[a.jsx(q,{color:"textSecondary",gutterBottom:!0,children:"Available Profiles"}),a.jsx(q,{variant:"h4",children:l.length})]})})}),a.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Ir,{children:a.jsxs(Yr,{children:[a.jsx(q,{color:"textSecondary",gutterBottom:!0,children:"Active Access"}),a.jsx(q,{variant:"h4",color:"success.main",children:I.length})]})})}),a.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Ir,{children:a.jsxs(Yr,{children:[a.jsx(q,{color:"textSecondary",gutterBottom:!0,children:"Revoked Access"}),a.jsx(q,{variant:"h4",color:"text.secondary",children:H.length})]})})})]}),e?a.jsx(ue,{display:"flex",justifyContent:"center",p:3,children:a.jsx(pr,{})}):a.jsxs(a.Fragment,{children:[a.jsx(At,{sx:{width:"100%",overflow:"hidden",mb:3},children:a.jsxs(ue,{sx:{p:2},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Active Profile Access"}),I.length===0?a.jsx(Ct,{severity:"info",children:'No active profile access assignments. Click "Grant Access" to get started.'}):a.jsx(Ma,{children:a.jsxs(Sa,{children:[a.jsx(Ca,{children:a.jsxs(Fr,{children:[a.jsx(Qe,{children:"Mobile User"}),a.jsx(Qe,{children:"Profile"}),a.jsx(Qe,{children:"Granted By"}),a.jsx(Qe,{children:"Granted At"}),a.jsx(Qe,{children:"Actions"})]})}),a.jsx(Pa,{children:I.map(F=>a.jsxs(Fr,{children:[a.jsx(Qe,{children:a.jsxs(ue,{children:[a.jsx(q,{variant:"body2",fontWeight:"bold",children:F.user_email}),a.jsx(Zt,{label:F.user_role,size:"small",color:"primary",variant:"outlined"})]})}),a.jsx(Qe,{children:a.jsxs(ue,{children:[a.jsx(q,{variant:"body2",fontWeight:"bold",children:F.profile_name}),a.jsx(q,{variant:"caption",color:"textSecondary",children:F.profile_email})]})}),a.jsx(Qe,{children:a.jsx(q,{variant:"body2",children:F.granted_by_email||"System"})}),a.jsx(Qe,{children:a.jsx(q,{variant:"body2",children:new Date(F.granted_at).toLocaleDateString()})}),a.jsx(Qe,{children:a.jsx(jr,{color:"error",onClick:()=>k(F.id),title:"Revoke Access",children:a.jsx(la,{})})})]},F.id))})]})})]})}),H.length>0&&a.jsx(At,{sx:{width:"100%",overflow:"hidden"},children:a.jsxs(ue,{sx:{p:2},children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Revoked Profile Access"}),a.jsx(Ma,{children:a.jsxs(Sa,{children:[a.jsx(Ca,{children:a.jsxs(Fr,{children:[a.jsx(Qe,{children:"Mobile User"}),a.jsx(Qe,{children:"Profile"}),a.jsx(Qe,{children:"Revoked At"})]})}),a.jsx(Pa,{children:H.map(F=>a.jsxs(Fr,{children:[a.jsx(Qe,{children:a.jsxs(ue,{children:[a.jsx(q,{variant:"body2",fontWeight:"bold",children:F.user_email}),a.jsx(Zt,{label:F.user_role,size:"small",color:"default",variant:"outlined"})]})}),a.jsx(Qe,{children:a.jsxs(ue,{children:[a.jsx(q,{variant:"body2",fontWeight:"bold",children:F.profile_name}),a.jsx(q,{variant:"caption",color:"textSecondary",children:F.profile_email})]})}),a.jsx(Qe,{children:a.jsx(q,{variant:"body2",children:new Date(F.updated_at).toLocaleDateString()})})]},F.id))})]})})]})})]}),a.jsxs(Sr,{open:m,onClose:()=>v(!1),maxWidth:"sm",fullWidth:!0,children:[a.jsx(Cr,{children:a.jsxs(ue,{display:"flex",alignItems:"center",gap:1,children:[a.jsx(ka,{}),"Grant Profile Access"]})}),a.jsx(Pr,{children:a.jsxs(Kr,{spacing:3,sx:{mt:1},children:[a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"Mobile User"}),a.jsx(sn,{value:p,onChange:F=>b(Number(F.target.value)),label:"Mobile User",children:i.map(F=>a.jsx(Jt,{value:F.id,children:a.jsxs(ue,{children:[a.jsx(q,{variant:"body2",fontWeight:"bold",children:F.email}),a.jsx(q,{variant:"caption",color:"textSecondary",children:F.access_role})]})},F.id))})]}),a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"Profile"}),a.jsx(sn,{value:w,onChange:F=>y(Number(F.target.value)),label:"Profile",children:l.map(F=>a.jsx(Jt,{value:F.id,children:a.jsxs(ue,{children:[a.jsx(q,{variant:"body2",fontWeight:"bold",children:F.name}),a.jsx(q,{variant:"caption",color:"textSecondary",children:F.email})]})},F.id))})]})]})}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:()=>v(!1),children:"Cancel"}),a.jsx(Ce,{onClick:O,variant:"contained",disabled:n||!p||!w,startIcon:n?a.jsx(pr,{size:20}):a.jsx(Wl,{}),children:n?"Granting...":"Grant Access"})]})]})]})};var wl={},xm;function i4(){if(xm)return wl;xm=1;var t=jn();Object.defineProperty(wl,"__esModule",{value:!0}),wl.default=void 0;var e=t(Cn()),r=Sn();return wl.default=(0,e.default)((0,r.jsx)("path",{d:"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20zm-6 8h-4v-2h4zm0-4h-4v-2h4z"}),"BugReport"),wl}var o4=i4();const l4=Dr(o4);var _l={},ym;function c4(){if(ym)return _l;ym=1;var t=jn();Object.defineProperty(_l,"__esModule",{value:!0}),_l.default=void 0;var e=t(Cn()),r=Sn();return _l.default=(0,e.default)((0,r.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 16H8v-2h8zm0-4H8v-2h8zm-3-5V3.5L18.5 9z"}),"Description"),_l}var u4=c4();const d4=Dr(u4),bm=[{value:"gmail",label:"Gmail",host:"smtp.gmail.com",port:587,secure:!1},{value:"outlook",label:"Outlook/Hotmail",host:"smtp-mail.outlook.com",port:587,secure:!1},{value:"yahoo",label:"Yahoo",host:"smtp.mail.yahoo.com",port:587,secure:!1},{value:"icloud",label:"iCloud",host:"smtp.mail.me.com",port:587,secure:!1},{value:"custom",label:"Custom SMTP",host:"",port:587,secure:!1}],h4=()=>{const t=Vr(),[e,r]=_.useState({email_provider:"gmail",email_host:"smtp.gmail.com",email_port:587,email_secure:!1,email_user:"",email_from:""}),[n,s]=_.useState(""),[i,o]=_.useState(!1),[l,u]=_.useState(!1),[d,f]=_.useState(!1),[m,v]=_.useState("unknown");_.useEffect(()=>{p()},[]);const p=async()=>{try{const I=await xe.get("/api/email/user-settings");if(I.data.success&&I.data.settings){const H=I.data.settings;r({email_provider:H.email_provider,email_host:H.email_host,email_port:H.email_port,email_secure:H.email_secure,email_user:H.email_user,email_from:H.email_from||H.email_user}),f(!0)}}catch(I){console.error("Error loading user email settings:",I)}},b=async()=>{if(!e.email_host||!e.email_port||!e.email_user){ve.error("Please fill in all required fields");return}d&&!n&&ve.info("Password field is empty - keeping existing password"),o(!0);try{const I={...e,...n&&{email_pass:n}},H=await xe.post("/api/email/user-settings",I);H.data.success?(ve.success("Email settings saved successfully!"),f(!0),s(""),v("unknown")):ve.error(H.data.message||"Failed to save email settings")}catch(I){console.error("Error saving email settings:",I),ve.error(I.response?.data?.message||"Failed to save email settings")}finally{o(!1)}},w=async()=>{if(!d){ve.error("Please save your email settings first");return}u(!0);try{const I=await xe.post("/api/email/test-user-connection");I.data.success?(v("connected"),ve.success("Email connection test successful!")):(v("failed"),ve.error(I.data.message||"Email connection test failed"))}catch(I){console.error("Error testing email connection:",I),v("failed"),ve.error(I.response?.data?.message||"Email connection test failed")}finally{u(!1)}},y=I=>{const H=bm.find(F=>F.value===I);H&&r(F=>({...F,email_provider:I,email_host:H.host,email_port:H.port,email_secure:H.secure}))},j=(I,H)=>{r(F=>({...F,[I]:H}))},O=()=>{switch(m){case"connected":return"success";case"failed":return"error";default:return"info"}},k=()=>{switch(m){case"connected":return"Connected";case"failed":return"Connection Failed";default:return"Not Tested"}};return a.jsxs(er,{maxWidth:"lg",sx:{mt:4,mb:4},children:[a.jsxs(ue,{sx:{display:"flex",alignItems:"center",mb:3},children:[a.jsx(au,{sx:{mr:2,fontSize:32}}),a.jsx(q,{variant:"h4",component:"h1",children:"My Email Settings"})]}),a.jsx(Ct,{severity:"info",sx:{mb:3},children:"Configure your personal email settings to send emails from your own email account. These settings are private to your account and will be used when you send emails from the system."}),a.jsxs(Ct,{severity:"warning",sx:{mb:3},children:[a.jsx(q,{variant:"subtitle2",gutterBottom:!0,children:a.jsx("strong",{children:"Important for Gmail users:"})}),a.jsxs(q,{variant:"body2",children:[`If you're using Gmail with 2-Factor Authentication, you need to use an "App Password" instead of your regular password.`,a.jsx("br",{})," Go to ",a.jsx("a",{href:"https://myaccount.google.com/apppasswords",target:"_blank",rel:"noopener noreferrer",children:"Google App Passwords"}),a.jsx("br",{}),' Generate an app password for "Mail"',a.jsx("br",{}),' Use that 16-character password in the "App Password" field below']})]}),a.jsxs(Z,{container:!0,spacing:3,children:[a.jsx(Z,{item:!0,xs:12,md:8,children:a.jsxs(Ir,{children:[a.jsxs(Yr,{children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Email Configuration"}),a.jsxs(Z,{container:!0,spacing:2,children:[a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{select:!0,label:"Email Provider",value:e.email_provider,onChange:I=>y(I.target.value),fullWidth:!0,helperText:"Select your email provider or choose Custom for other SMTP servers",children:bm.map(I=>a.jsx(Jt,{value:I.value,children:I.label},I.value))})}),a.jsx(Z,{item:!0,xs:12,sm:8,children:a.jsx(Oe,{label:"SMTP Host",value:e.email_host,onChange:I=>j("email_host",I.target.value),fullWidth:!0,required:!0,disabled:e.email_provider!=="custom"})}),a.jsx(Z,{item:!0,xs:12,sm:4,children:a.jsx(Oe,{label:"SMTP Port",type:"number",value:e.email_port,onChange:I=>j("email_port",parseInt(I.target.value)),fullWidth:!0,required:!0,disabled:e.email_provider!=="custom"})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(El,{control:a.jsx(Jc,{checked:e.email_secure,onChange:I=>j("email_secure",I.target.checked),disabled:e.email_provider!=="custom"}),label:"Use SSL/TLS (usually for port 465)"})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{label:"Email Address",type:"email",value:e.email_user,onChange:I=>j("email_user",I.target.value),fullWidth:!0,required:!0,helperText:"Your email address for authentication"})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{label:d?"Update App Password":"App Password",type:"password",value:n,onChange:I=>s(I.target.value),fullWidth:!0,required:!d,helperText:d?"Leave blank to keep current password, or enter new password to update":"Your email password or app password (for Gmail with 2FA)"})}),a.jsx(Z,{item:!0,xs:12,children:a.jsx(Oe,{label:"From Name (Optional)",value:e.email_from,onChange:I=>j("email_from",I.target.value),fullWidth:!0,helperText:"Display name for outgoing emails (defaults to email address)"})})]})]}),a.jsx(jf,{children:a.jsx(Ce,{variant:"contained",startIcon:i?a.jsx(pr,{size:20}):a.jsx(Vs,{}),onClick:b,disabled:i,children:i?"Saving...":"Save Settings"})})]})}),a.jsxs(Z,{item:!0,xs:12,md:4,children:[a.jsxs(Ir,{children:[a.jsxs(Yr,{children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Connection Status"}),a.jsx(Ct,{severity:O(),sx:{mb:2},children:k()}),a.jsx(q,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Test your email configuration to ensure it works correctly."})]}),a.jsx(jf,{children:a.jsx(Ce,{variant:"outlined",startIcon:l?a.jsx(pr,{size:20}):a.jsx(l4,{}),onClick:w,disabled:l||!d,fullWidth:!0,children:l?"Testing...":"Test Connection"})})]}),a.jsx(Ir,{sx:{mt:2},children:a.jsxs(Yr,{children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Setup Instructions"}),a.jsxs(q,{variant:"body2",sx:{mb:1},children:[a.jsx("strong",{children:"Gmail:"})," Use an App Password instead of your regular password."]}),a.jsxs(q,{variant:"body2",sx:{mb:1},children:[a.jsx("strong",{children:"Outlook:"})," Use an App Password for enhanced security."]}),a.jsxs(q,{variant:"body2",children:[a.jsx("strong",{children:"Other providers:"})," Check your email provider's SMTP settings."]})]})}),a.jsx(Ir,{sx:{mt:2,border:"2px solid red"},children:a.jsxs(Yr,{children:[a.jsx(q,{variant:"h6",gutterBottom:!0,children:"Quick Actions"}),a.jsx(q,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Manage your email templates and customize email content for different types of communications."}),a.jsx(Ce,{fullWidth:!0,variant:"outlined",onClick:()=>t("/email-templates"),startIcon:a.jsx(d4,{}),sx:{mb:1},color:"primary",children:"Manage Email Templates"})]})})]})]})]})},f4=()=>{const{user:t}=Aa(),[e,r]=_.useState([]),[n,s]=_.useState(!0),[i,o]=_.useState(!1),[l,u]=_.useState(null),[d,f]=_.useState({name:"",type:"purchase_order",subject:"",html_content:"",text_content:"",is_default:!1}),[m,v]=_.useState(""),[p,b]=_.useState("");_.useEffect(()=>{w()},[]);const w=async()=>{try{s(!0);const F=await xe.get("/api/email/templates");F.data.success&&r(F.data.templates)}catch(F){console.error("Error loading templates:",F),v("Failed to load email templates")}finally{s(!1)}},y=F=>{F?(u(F),f({name:F.name,type:F.type,subject:F.subject,html_content:F.html_content,text_content:F.text_content||"",is_default:F.is_default})):(u(null),f({name:"",type:"purchase_order",subject:"",html_content:"",text_content:"",is_default:!1})),o(!0)},j=()=>{o(!1),u(null),f({name:"",type:"purchase_order",subject:"",html_content:"",text_content:"",is_default:!1})},O=async()=>{try{l?(await xe.put(`/api/email/templates/${l.id}`,d),b("Email template updated successfully")):(await xe.post("/api/email/templates",d),b("Email template created successfully")),j(),w()}catch(F){console.error("Error saving template:",F),v(F.response?.data?.message||"Failed to save template")}},k=async F=>{if(window.confirm("Are you sure you want to delete this template?"))try{await xe.delete(`/api/email/templates/${F}`),b("Email template deleted successfully"),w()}catch(U){console.error("Error deleting template:",U),v(U.response?.data?.message||"Failed to delete template")}},I=F=>{switch(F){case"purchase_order":return"primary";case"sales_order":return"success";case"quote":return"warning";case"custom":return"info";default:return"default"}},H=F=>{switch(F){case"purchase_order":return"Purchase Order";case"sales_order":return"Sales Order";case"quote":return"Quote";case"custom":return"Custom";default:return F}};return n?a.jsx(er,{maxWidth:"lg",children:a.jsx(q,{variant:"h4",gutterBottom:!0,children:"Loading..."})}):a.jsxs(er,{maxWidth:"lg",children:[a.jsxs(ue,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[a.jsx(q,{variant:"h4",gutterBottom:!0,children:"Email Templates"}),a.jsx(Ce,{variant:"contained",startIcon:a.jsx(Dm,{}),onClick:()=>y(),children:"Create Template"})]}),a.jsx(Z,{container:!0,spacing:3,children:e.map(F=>a.jsx(Z,{item:!0,xs:12,md:6,lg:4,children:a.jsx(Ir,{children:a.jsxs(Yr,{children:[a.jsxs(ue,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[a.jsx(q,{variant:"h6",component:"div",children:F.name}),a.jsxs(ue,{children:[a.jsx(jr,{size:"small",onClick:()=>y(F),color:"primary",children:a.jsx(wh,{})}),a.jsx(jr,{size:"small",onClick:()=>k(F.id),color:"error",children:a.jsx(Im,{})})]})]}),a.jsx(Zt,{label:H(F.type),color:I(F.type),size:"small",sx:{mb:1}}),F.is_default&&a.jsx(Zt,{label:"Default",color:"secondary",size:"small",sx:{ml:1}}),a.jsxs(q,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[a.jsx("strong",{children:"Subject:"})," ",F.subject]}),a.jsxs(q,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[a.jsx("strong",{children:"Created:"})," ",new Date(F.created_at).toLocaleDateString()]}),a.jsxs(q,{variant:"body2",color:"text.secondary",children:[a.jsx("strong",{children:"Updated:"})," ",new Date(F.updated_at).toLocaleDateString()]})]})})},F.id))}),e.length===0&&a.jsxs(ue,{sx:{textAlign:"center",mt:4},children:[a.jsx(q,{variant:"h6",color:"text.secondary",children:"No email templates found"}),a.jsx(q,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Create your first email template to get started"})]}),a.jsxs(Sr,{open:i,onClose:j,maxWidth:"md",fullWidth:!0,children:[a.jsx(Cr,{children:l?"Edit Email Template":"Create Email Template"}),a.jsx(Pr,{children:a.jsxs(ue,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[a.jsx(Oe,{label:"Template Name",value:d.name,onChange:F=>f({...d,name:F.target.value}),fullWidth:!0,required:!0}),a.jsxs(nn,{fullWidth:!0,children:[a.jsx(an,{children:"Template Type"}),a.jsxs(sn,{value:d.type,onChange:F=>f({...d,type:F.target.value}),label:"Template Type",children:[a.jsx(Jt,{value:"purchase_order",children:"Purchase Order"}),a.jsx(Jt,{value:"sales_order",children:"Sales Order"}),a.jsx(Jt,{value:"quote",children:"Quote"}),a.jsx(Jt,{value:"custom",children:"Custom"})]})]}),a.jsx(Oe,{label:"Subject",value:d.subject,onChange:F=>f({...d,subject:F.target.value}),fullWidth:!0,required:!0}),a.jsx(Oe,{label:"HTML Content",value:d.html_content,onChange:F=>f({...d,html_content:F.target.value}),fullWidth:!0,multiline:!0,rows:8,required:!0,helperText:"Use HTML formatting for rich email content"}),a.jsx(Oe,{label:"Text Content (Optional)",value:d.text_content,onChange:F=>f({...d,text_content:F.target.value}),fullWidth:!0,multiline:!0,rows:4,helperText:"Plain text version for email clients that don't support HTML"}),a.jsx(El,{control:a.jsx(Jc,{checked:d.is_default,onChange:F=>f({...d,is_default:F.target.checked})}),label:"Set as default template for this type"})]})}),a.jsxs(Nr,{children:[a.jsx(Ce,{onClick:j,children:"Cancel"}),a.jsx(Ce,{onClick:O,variant:"contained",children:l?"Update":"Create"})]})]}),a.jsx(uo,{open:!!m,autoHideDuration:6e3,onClose:()=>v(""),anchorOrigin:{vertical:"top",horizontal:"center"},children:a.jsx(Ct,{onClose:()=>v(""),severity:"error",sx:{width:"100%"},children:m})}),a.jsx(uo,{open:!!p,autoHideDuration:6e3,onClose:()=>b(""),anchorOrigin:{vertical:"top",horizontal:"center"},children:a.jsx(Ct,{onClose:()=>b(""),severity:"success",sx:{width:"100%"},children:p})})]})},p4=({children:t})=>{const{isAuthenticated:e,user:r}=Aa(),s=yi().pathname;return e?r?.access_role==="Time Tracking"&&s!=="/"&&s!=="/time-tracking"&&s!=="/attendance"?a.jsx(jl,{to:"/",replace:!0}):r?.access_role==="Sales and Purchase"&&!["/","/open-sales-orders","/open-purchase-orders","/parts-to-order"].includes(s)&&!s.startsWith("/open-sales-orders/")&&!s.startsWith("/open-purchase-orders/")?a.jsx(jl,{to:"/",replace:!0}):r?.access_role==="Quotes"&&s!=="/quotes"?a.jsx(jl,{to:"/quotes",replace:!0}):a.jsx(a.Fragment,{children:t}):a.jsx(jl,{to:"/login",replace:!0})},m4=()=>a.jsxs(Uv,{children:[a.jsx(Xt,{path:"/login",element:a.jsx(oy,{})}),a.jsx(Xt,{path:"/register",element:a.jsx(ly,{})}),a.jsxs(Xt,{path:"/",element:a.jsx(p4,{children:a.jsx(iy,{})}),children:[a.jsx(Xt,{index:!0,element:a.jsx(tp,{})}),a.jsx(Xt,{path:"dashboard",element:a.jsx(tp,{})}),a.jsx(Xt,{path:"business-profile",element:a.jsx(jy,{})}),a.jsx(Xt,{path:"qbo-account-mapping",element:a.jsx(r4,{})}),a.jsx(Xt,{path:"customers",element:a.jsx(My,{})}),a.jsx(Xt,{path:"customers/:id",element:a.jsx(Fy,{})}),a.jsx(Xt,{path:"products",element:a.jsx(YS,{})}),a.jsx(Xt,{path:"products/:id",element:a.jsx(Uy,{})}),a.jsx(Xt,{path:"purchase-order",element:a.jsx(s5,{})}),a.jsx(Xt,{path:"purchase-order/:id",element:a.jsx(pS,{})}),a.jsx(Xt,{path:"open-purchase-orders",element:a.jsx(Cj,{})}),a.jsx(Xt,{path:"open-purchase-orders/:id",element:a.jsx(_S,{})}),a.jsx(Xt,{path:"vendors",element:a.jsx(qy,{})}),a.jsx(Xt,{path:"vendors/:id",element:a.jsx(By,{})}),a.jsx(Xt,{path:"inventory",element:a.jsx(Gy,{})}),a.jsx(Xt,{path:"supply",element:a.jsx(Qy,{})}),a.jsx(Xt,{path:"employees",element:a.jsx(h5,{})}),a.jsx(Xt,{path:"time-tracking",element:a.jsx(NS,{})}),a.jsx(Xt,{path:"attendance",element:a.jsx(QS,{})}),a.jsx(Xt,{path:"time-tracking/reports",element:a.jsx(WS,{})}),a.jsx(Xt,{path:"sales-order",element:a.jsx(u5,{})}),a.jsx(Xt,{path:"sales-order/:id",element:a.jsx(Zp,{})}),a.jsx(Xt,{path:"open-sales-orders",element:a.jsx(b5,{})}),a.jsx(Xt,{path:"sales-order-detail/:id",element:a.jsx(Zp,{})}),a.jsx(Xt,{path:"open-sales-orders/:id",element:a.jsx(Sj,{})}),a.jsx(Xt,{path:"quotes",element:a.jsx(n5,{})}),a.jsx(Xt,{path:"quote-history",element:a.jsx(a5,{})}),a.jsx(Xt,{path:"margin-schedule",element:a.jsx(f5,{})}),a.jsx(Xt,{path:"overhead-management",element:a.jsx(n4,{})}),a.jsx(Xt,{path:"parts-to-order",element:a.jsx(a4,{})}),a.jsx(Xt,{path:"backup-management",element:a.jsx(GS,{})}),a.jsx(Xt,{path:"mobile-user-access",element:a.jsx(s4,{})}),a.jsx(Xt,{path:"email-settings",element:a.jsx(h4,{})}),a.jsx(Xt,{path:"email-templates",element:a.jsx(f4,{})})]}),a.jsx(Xt,{path:"*",element:a.jsx(jl,{to:"/",replace:!0})})]}),g4=()=>{const[t,e]=_.useState(0);return _.useEffect(()=>{let r=!0;const n=async()=>{try{const i=await eu();if(r&&e(i),!window.__backendUnavailableSince&&i>0){await vg();const o=await eu();r&&e(o)}}catch{}},s=setInterval(n,15e3);return n(),()=>{r=!1,clearInterval(s)}},[]),a.jsxs(U0,{theme:Ex,children:[a.jsx(W0,{}),a.jsx(Nx,{children:a.jsx(mi,{dateAdapter:Bl,children:a.jsx(Gv,{children:a.jsx(m4,{})})})})]})};V0.createRoot(document.getElementById("root")).render(a.jsx(g4,{}));export{bt as _};
