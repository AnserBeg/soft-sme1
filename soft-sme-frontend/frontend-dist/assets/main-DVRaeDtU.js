const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-CxN4jgO7.js","assets/vendor-Bs7gn1Hv.js","assets/mui-CPySk4Sq.js"])))=>i.map(i=>d[i]);
import{r as x,R as r8,j as i,c as n8,b as a8,_ as mI,u as i8,a as ir,d as or,e as Pr,f as Ae,P as vn,g as gI,h as o8,B as Z,i as pn,A as kp,T as B,I as vr,k as xe,l as Pe,F as ui,S as ac,C as er,m as Hn,n as s8,o as l8,p as bt,D as Vn,q as c8,s as L2,t as XS,v as Bu,w as sg,x as lg,y as li,z as vI,L as R2,E as xs,G as Fh,H as yI,J as JS,K as Nc,Q as xI,M as bI,N as u8,O as _I,U as Vw,V as cg,W as wI,X as ug,Y as Gw,Z as rx,$ as pa,a0 as d8,a1 as Sa,a2 as f8,a3 as Yw,a4 as Qn,a5 as h8,a6 as jI,a7 as p8,a8 as m8,a9 as ZS,aa as rr,ab as Pt,ac as Xi,ad as g8,ae as ie,af as Rr,ag as Hr,ah as ut,ai as e5,aj as aa,ak as t5,al as dr,am as fr,an as hr,ao as _r,ap as Td,aq as Po,ar as ot,as as Jt,at as mn,au as v8,av as Kt,aw as SI,ax as hl,ay as tn,az as sn,aA as ln,aB as Os,aC as Ra,aD as os,aE as Tv,aF as y8,aG as x8,aH as b8,aI as q2,aJ as al,aK as ma,aL as ia,aM as oa,aN as mr,aO as Oe,aP as sa,aQ as jh,aR as Tu,aS as CI,aT as Id,aU as Ep,aV as dg,aW as Iv,aX as r5,aY as AI,aZ as _8,a_ as w8,a$ as Tp,b0 as PI,b1 as F2,b2 as Uu,b3 as zu,b4 as j8,b5 as S8,b6 as C8,b7 as A8,b8 as OI,b9 as kI,ba as P8,bb as O8,bc as EI,bd as k8,be as Kw,bf as n5,bg as nx,bh as a5,bi as E8,bj as T8,bk as I8,bl as i5,bm as $h,bn as TI,bo as N8,bp as D8,bq as M8,br as L8,bs as R8,bt as q8}from"./mui-CPySk4Sq.js";import{a as F8,g as Et,b as $8,c as hm}from"./vendor-Bs7gn1Hv.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=r(a);fetch(a.href,o)}})();var pm={},o5;function B8(){if(o5)return pm;o5=1;var e=F8();return pm.createRoot=e.createRoot,pm.hydrateRoot=e.hydrateRoot,pm}var U8=B8();const z8=Et(U8);/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Bh(){return Bh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Bh.apply(this,arguments)}var Gl;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Gl||(Gl={}));const s5="popstate";function W8(e){e===void 0&&(e={});function t(a,o){let{pathname:s="/",search:l="",hash:c=""}=nu(a.location.hash.substr(1));return!s.startsWith("/")&&!s.startsWith(".")&&(s="/"+s),$2("",{pathname:s,search:l,hash:c},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function r(a,o){let s=a.document.querySelector("base"),l="";if(s&&s.getAttribute("href")){let c=a.location.href,u=c.indexOf("#");l=u===-1?c:c.slice(0,u)}return l+"#"+(typeof o=="string"?o:fg(o))}function n(a,o){Qw(a.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(o)+")")}return V8(t,r,n,e)}function Pa(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Qw(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function H8(){return Math.random().toString(36).substr(2,8)}function l5(e,t){return{usr:e.state,key:e.key,idx:t}}function $2(e,t,r,n){return r===void 0&&(r=null),Bh({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?nu(t):t,{state:r,key:t&&t.key||n||H8()})}function fg(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function nu(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function V8(e,t,r,n){n===void 0&&(n={});let{window:a=document.defaultView,v5Compat:o=!1}=n,s=a.history,l=Gl.Pop,c=null,u=d();u==null&&(u=0,s.replaceState(Bh({},s.state,{idx:u}),""));function d(){return(s.state||{idx:null}).idx}function f(){l=Gl.Pop;let y=d(),b=y==null?null:y-u;u=y,c&&c({action:l,location:m.location,delta:b})}function h(y,b){l=Gl.Push;let _=$2(m.location,y,b);r&&r(_,y),u=d()+1;let w=l5(_,u),A=m.createHref(_);try{s.pushState(w,"",A)}catch(P){if(P instanceof DOMException&&P.name==="DataCloneError")throw P;a.location.assign(A)}o&&c&&c({action:l,location:m.location,delta:1})}function p(y,b){l=Gl.Replace;let _=$2(m.location,y,b);r&&r(_,y),u=d();let w=l5(_,u),A=m.createHref(_);s.replaceState(w,"",A),o&&c&&c({action:l,location:m.location,delta:0})}function v(y){let b=a.location.origin!=="null"?a.location.origin:a.location.href,_=typeof y=="string"?y:fg(y);return _=_.replace(/ $/,"%20"),Pa(b,"No window.location.(origin|href) available to create URL for href: "+_),new URL(_,b)}let m={get action(){return l},get location(){return e(a,s)},listen(y){if(c)throw new Error("A history only accepts one active listener");return a.addEventListener(s5,f),c=y,()=>{a.removeEventListener(s5,f),c=null}},createHref(y){return t(a,y)},createURL:v,encodeLocation(y){let b=v(y);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:h,replace:p,go(y){return s.go(y)}};return m}var c5;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(c5||(c5={}));function G8(e,t,r){return r===void 0&&(r="/"),Y8(e,t,r)}function Y8(e,t,r,n){let a=typeof t=="string"?nu(t):t,o=Xw(a.pathname||"/",r);if(o==null)return null;let s=II(e);K8(s);let l=null;for(let c=0;l==null&&c<s.length;++c){let u=sq(o);l=aq(s[c],u)}return l}function II(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let a=(o,s,l)=>{let c={relativePath:l===void 0?o.path||"":l,caseSensitive:o.caseSensitive===!0,childrenIndex:s,route:o};c.relativePath.startsWith("/")&&(Pa(c.relativePath.startsWith(n),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(n.length));let u=Xl([n,c.relativePath]),d=r.concat(c);o.children&&o.children.length>0&&(Pa(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),II(o.children,t,d,u)),!(o.path==null&&!o.index)&&t.push({path:u,score:rq(u,o.index),routesMeta:d})};return e.forEach((o,s)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))a(o,s);else for(let c of NI(o.path))a(o,s,c)}),t}function NI(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,a=r.endsWith("?"),o=r.replace(/\?$/,"");if(n.length===0)return a?[o,""]:[o];let s=NI(n.join("/")),l=[];return l.push(...s.map(c=>c===""?o:[o,c].join("/"))),a&&l.push(...s),l.map(c=>e.startsWith("/")&&c===""?"/":c)}function K8(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:nq(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const Q8=/^:[\w-]+$/,X8=3,J8=2,Z8=1,eq=10,tq=-2,u5=e=>e==="*";function rq(e,t){let r=e.split("/"),n=r.length;return r.some(u5)&&(n+=tq),t&&(n+=J8),r.filter(a=>!u5(a)).reduce((a,o)=>a+(Q8.test(o)?X8:o===""?Z8:eq),n)}function nq(e,t){return e.length===t.length&&e.slice(0,-1).every((n,a)=>n===t[a])?e[e.length-1]-t[t.length-1]:0}function aq(e,t,r){let{routesMeta:n}=e,a={},o="/",s=[];for(let l=0;l<n.length;++l){let c=n[l],u=l===n.length-1,d=o==="/"?t:t.slice(o.length)||"/",f=iq({path:c.relativePath,caseSensitive:c.caseSensitive,end:u},d),h=c.route;if(!f)return null;Object.assign(a,f.params),s.push({params:a,pathname:Xl([o,f.pathname]),pathnameBase:dq(Xl([o,f.pathnameBase])),route:h}),f.pathnameBase!=="/"&&(o=Xl([o,f.pathnameBase]))}return s}function iq(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=oq(e.path,e.caseSensitive,e.end),a=t.match(r);if(!a)return null;let o=a[0],s=o.replace(/(.)\/+$/,"$1"),l=a.slice(1);return{params:n.reduce((u,d,f)=>{let{paramName:h,isOptional:p}=d;if(h==="*"){let m=l[f]||"";s=o.slice(0,o.length-m.length).replace(/(.)\/+$/,"$1")}const v=l[f];return p&&!v?u[h]=void 0:u[h]=(v||"").replace(/%2F/g,"/"),u},{}),pathname:o,pathnameBase:s,pattern:e}}function oq(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),Qw(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(s,l,c)=>(n.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),a+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?a+="\\/*$":e!==""&&e!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,t?void 0:"i"),n]}function sq(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Qw(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Xw(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function lq(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:a=""}=typeof e=="string"?nu(e):e;return{pathname:r?r.startsWith("/")?r:cq(r,t):t,search:fq(n),hash:hq(a)}}function cq(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(a=>{a===".."?r.length>1&&r.pop():a!=="."&&r.push(a)}),r.length>1?r.join("/"):"/"}function ax(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function uq(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function Jw(e,t){let r=uq(e);return t?r.map((n,a)=>a===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function Zw(e,t,r,n){n===void 0&&(n=!1);let a;typeof e=="string"?a=nu(e):(a=Bh({},e),Pa(!a.pathname||!a.pathname.includes("?"),ax("?","pathname","search",a)),Pa(!a.pathname||!a.pathname.includes("#"),ax("#","pathname","hash",a)),Pa(!a.search||!a.search.includes("#"),ax("#","search","hash",a)));let o=e===""||a.pathname==="",s=o?"/":a.pathname,l;if(s==null)l=r;else{let f=t.length-1;if(!n&&s.startsWith("..")){let h=s.split("/");for(;h[0]==="..";)h.shift(),f-=1;a.pathname=h.join("/")}l=f>=0?t[f]:"/"}let c=lq(a,l),u=s&&s!=="/"&&s.endsWith("/"),d=(o||s===".")&&r.endsWith("/");return!c.pathname.endsWith("/")&&(u||d)&&(c.pathname+="/"),c}const Xl=e=>e.join("/").replace(/\/\/+/g,"/"),dq=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),fq=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,hq=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function pq(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const DI=["post","put","patch","delete"];new Set(DI);const mq=["get",...DI];new Set(mq);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Uh(){return Uh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Uh.apply(this,arguments)}const ej=x.createContext(null),gq=x.createContext(null),ic=x.createContext(null),Nv=x.createContext(null),Ns=x.createContext({outlet:null,matches:[],isDataRoute:!1}),MI=x.createContext(null);function vq(e,t){let{relative:r}=t===void 0?{}:t;Nd()||Pa(!1);let{basename:n,navigator:a}=x.useContext(ic),{hash:o,pathname:s,search:l}=RI(e,{relative:r}),c=s;return n!=="/"&&(c=s==="/"?n:Xl([n,s])),a.createHref({pathname:c,search:l,hash:o})}function Nd(){return x.useContext(Nv)!=null}function Ds(){return Nd()||Pa(!1),x.useContext(Nv).location}function LI(e){x.useContext(ic).static||x.useLayoutEffect(e)}function kn(){let{isDataRoute:e}=x.useContext(Ns);return e?Iq():yq()}function yq(){Nd()||Pa(!1);let e=x.useContext(ej),{basename:t,future:r,navigator:n}=x.useContext(ic),{matches:a}=x.useContext(Ns),{pathname:o}=Ds(),s=JSON.stringify(Jw(a,r.v7_relativeSplatPath)),l=x.useRef(!1);return LI(()=>{l.current=!0}),x.useCallback(function(u,d){if(d===void 0&&(d={}),!l.current)return;if(typeof u=="number"){n.go(u);return}let f=Zw(u,JSON.parse(s),o,d.relative==="path");e==null&&t!=="/"&&(f.pathname=f.pathname==="/"?t:Xl([t,f.pathname])),(d.replace?n.replace:n.push)(f,d.state,d)},[t,n,s,o,e])}const xq=x.createContext(null);function bq(e){let t=x.useContext(Ns).outlet;return t&&x.createElement(xq.Provider,{value:e},t)}function Ms(){let{matches:e}=x.useContext(Ns),t=e[e.length-1];return t?t.params:{}}function RI(e,t){let{relative:r}=t===void 0?{}:t,{future:n}=x.useContext(ic),{matches:a}=x.useContext(Ns),{pathname:o}=Ds(),s=JSON.stringify(Jw(a,n.v7_relativeSplatPath));return x.useMemo(()=>Zw(e,JSON.parse(s),o,r==="path"),[e,s,o,r])}function _q(e,t){return wq(e,t)}function wq(e,t,r,n){Nd()||Pa(!1);let{navigator:a}=x.useContext(ic),{matches:o}=x.useContext(Ns),s=o[o.length-1],l=s?s.params:{};s&&s.pathname;let c=s?s.pathnameBase:"/";s&&s.route;let u=Ds(),d;if(t){var f;let y=typeof t=="string"?nu(t):t;c==="/"||(f=y.pathname)!=null&&f.startsWith(c)||Pa(!1),d=y}else d=u;let h=d.pathname||"/",p=h;if(c!=="/"){let y=c.replace(/^\//,"").split("/");p="/"+h.replace(/^\//,"").split("/").slice(y.length).join("/")}let v=G8(e,{pathname:p}),m=Pq(v&&v.map(y=>Object.assign({},y,{params:Object.assign({},l,y.params),pathname:Xl([c,a.encodeLocation?a.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?c:Xl([c,a.encodeLocation?a.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),o,r,n);return t&&m?x.createElement(Nv.Provider,{value:{location:Uh({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:Gl.Pop}},m):m}function jq(){let e=Tq(),t=pq(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,a={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return x.createElement(x.Fragment,null,x.createElement("h2",null,"Unexpected Application Error!"),x.createElement("h3",{style:{fontStyle:"italic"}},t),r?x.createElement("pre",{style:a},r):null,null)}const Sq=x.createElement(jq,null);class Cq extends x.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?x.createElement(Ns.Provider,{value:this.props.routeContext},x.createElement(MI.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Aq(e){let{routeContext:t,match:r,children:n}=e,a=x.useContext(ej);return a&&a.static&&a.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=r.route.id),x.createElement(Ns.Provider,{value:t},n)}function Pq(e,t,r,n){var a;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var o;if(!r)return null;if(r.errors)e=r.matches;else if((o=n)!=null&&o.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let s=e,l=(a=r)==null?void 0:a.errors;if(l!=null){let d=s.findIndex(f=>f.route.id&&l?.[f.route.id]!==void 0);d>=0||Pa(!1),s=s.slice(0,Math.min(s.length,d+1))}let c=!1,u=-1;if(r&&n&&n.v7_partialHydration)for(let d=0;d<s.length;d++){let f=s[d];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(u=d),f.route.id){let{loaderData:h,errors:p}=r,v=f.route.loader&&h[f.route.id]===void 0&&(!p||p[f.route.id]===void 0);if(f.route.lazy||v){c=!0,u>=0?s=s.slice(0,u+1):s=[s[0]];break}}}return s.reduceRight((d,f,h)=>{let p,v=!1,m=null,y=null;r&&(p=l&&f.route.id?l[f.route.id]:void 0,m=f.route.errorElement||Sq,c&&(u<0&&h===0?(Nq("route-fallback"),v=!0,y=null):u===h&&(v=!0,y=f.route.hydrateFallbackElement||null)));let b=t.concat(s.slice(0,h+1)),_=()=>{let w;return p?w=m:v?w=y:f.route.Component?w=x.createElement(f.route.Component,null):f.route.element?w=f.route.element:w=d,x.createElement(Aq,{match:f,routeContext:{outlet:d,matches:b,isDataRoute:r!=null},children:w})};return r&&(f.route.ErrorBoundary||f.route.errorElement||h===0)?x.createElement(Cq,{location:r.location,revalidation:r.revalidation,component:m,error:p,children:_(),routeContext:{outlet:null,matches:b,isDataRoute:!0}}):_()},null)}var qI=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(qI||{}),FI=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(FI||{});function Oq(e){let t=x.useContext(ej);return t||Pa(!1),t}function kq(e){let t=x.useContext(gq);return t||Pa(!1),t}function Eq(e){let t=x.useContext(Ns);return t||Pa(!1),t}function $I(e){let t=Eq(),r=t.matches[t.matches.length-1];return r.route.id||Pa(!1),r.route.id}function Tq(){var e;let t=x.useContext(MI),r=kq(),n=$I();return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function Iq(){let{router:e}=Oq(qI.UseNavigateStable),t=$I(FI.UseNavigateStable),r=x.useRef(!1);return LI(()=>{r.current=!0}),x.useCallback(function(a,o){o===void 0&&(o={}),r.current&&(typeof a=="number"?e.navigate(a):e.navigate(a,Uh({fromRouteId:t},o)))},[e,t])}const d5={};function Nq(e,t,r){d5[e]||(d5[e]=!0)}function Dq(e,t){e?.v7_startTransition,e?.v7_relativeSplatPath}function Ou(e){let{to:t,replace:r,state:n,relative:a}=e;Nd()||Pa(!1);let{future:o,static:s}=x.useContext(ic),{matches:l}=x.useContext(Ns),{pathname:c}=Ds(),u=kn(),d=Zw(t,Jw(l,o.v7_relativeSplatPath),c,a==="path"),f=JSON.stringify(d);return x.useEffect(()=>u(JSON.parse(f),{replace:r,state:n,relative:a}),[u,f,a,r,n]),null}function Mq(e){return bq(e.context)}function ur(e){Pa(!1)}function Lq(e){let{basename:t="/",children:r=null,location:n,navigationType:a=Gl.Pop,navigator:o,static:s=!1,future:l}=e;Nd()&&Pa(!1);let c=t.replace(/^\/*/,"/"),u=x.useMemo(()=>({basename:c,navigator:o,static:s,future:Uh({v7_relativeSplatPath:!1},l)}),[c,l,o,s]);typeof n=="string"&&(n=nu(n));let{pathname:d="/",search:f="",hash:h="",state:p=null,key:v="default"}=n,m=x.useMemo(()=>{let y=Xw(d,c);return y==null?null:{location:{pathname:y,search:f,hash:h,state:p,key:v},navigationType:a}},[c,d,f,h,p,v,a]);return m==null?null:x.createElement(ic.Provider,{value:u},x.createElement(Nv.Provider,{children:r,value:m}))}function Rq(e){let{children:t,location:r}=e;return _q(B2(t),r)}new Promise(()=>{});function B2(e,t){t===void 0&&(t=[]);let r=[];return x.Children.forEach(e,(n,a)=>{if(!x.isValidElement(n))return;let o=[...t,a];if(n.type===x.Fragment){r.push.apply(r,B2(n.props.children,o));return}n.type!==ur&&Pa(!1),!n.props.index||!n.props.children||Pa(!1);let s={id:n.props.id||o.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(s.children=B2(n.props.children,o)),r.push(s)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function U2(){return U2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},U2.apply(this,arguments)}function qq(e,t){if(e==null)return{};var r={},n=Object.keys(e),a,o;for(o=0;o<n.length;o++)a=n[o],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}function Fq(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function $q(e,t){return e.button===0&&(!t||t==="_self")&&!Fq(e)}const Bq=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Uq="6";try{window.__reactRouterVersion=Uq}catch{}const zq="startTransition",f5=r8[zq];function Wq(e){let{basename:t,children:r,future:n,window:a}=e,o=x.useRef();o.current==null&&(o.current=W8({window:a,v5Compat:!0}));let s=o.current,[l,c]=x.useState({action:s.action,location:s.location}),{v7_startTransition:u}=n||{},d=x.useCallback(f=>{u&&f5?f5(()=>c(f)):c(f)},[c,u]);return x.useLayoutEffect(()=>s.listen(d),[s,d]),x.useEffect(()=>Dq(n),[n]),x.createElement(Lq,{basename:t,children:r,location:l.location,navigationType:l.action,navigator:s,future:n})}const Hq=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Vq=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,BI=x.forwardRef(function(t,r){let{onClick:n,relative:a,reloadDocument:o,replace:s,state:l,target:c,to:u,preventScrollReset:d,viewTransition:f}=t,h=qq(t,Bq),{basename:p}=x.useContext(ic),v,m=!1;if(typeof u=="string"&&Vq.test(u)&&(v=u,Hq))try{let w=new URL(window.location.href),A=u.startsWith("//")?new URL(w.protocol+u):new URL(u),P=Xw(A.pathname,p);A.origin===w.origin&&P!=null?u=P+A.search+A.hash:m=!0}catch{}let y=vq(u,{relative:a}),b=Gq(u,{replace:s,state:l,target:c,preventScrollReset:d,relative:a,viewTransition:f});function _(w){n&&n(w),w.defaultPrevented||b(w)}return x.createElement("a",U2({},h,{href:v||y,onClick:m||o?n:_,ref:r,target:c}))});var h5;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(h5||(h5={}));var p5;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(p5||(p5={}));function Gq(e,t){let{target:r,replace:n,state:a,preventScrollReset:o,relative:s,viewTransition:l}=t===void 0?{}:t,c=kn(),u=Ds(),d=RI(e,{relative:s});return x.useCallback(f=>{if($q(f,r)){f.preventDefault();let h=n!==void 0?n:fg(u)===fg(d);c(e,{replace:h,state:a,preventScrollReset:o,relative:s,viewTransition:l})}},[u,c,d,n,a,r,e,o,s,l])}function UI(e,t){return function(){return e.apply(t,arguments)}}const{toString:Yq}=Object.prototype,{getPrototypeOf:tj}=Object,{iterator:Dv,toStringTag:zI}=Symbol,Mv=(e=>t=>{const r=Yq.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),ss=e=>(e=e.toLowerCase(),t=>Mv(t)===e),Lv=e=>t=>typeof t===e,{isArray:Dd}=Array,zh=Lv("undefined");function Kq(e){return e!==null&&!zh(e)&&e.constructor!==null&&!zh(e.constructor)&&Ji(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const WI=ss("ArrayBuffer");function Qq(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&WI(e.buffer),t}const Xq=Lv("string"),Ji=Lv("function"),HI=Lv("number"),Rv=e=>e!==null&&typeof e=="object",Jq=e=>e===!0||e===!1,Bm=e=>{if(Mv(e)!=="object")return!1;const t=tj(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(zI in e)&&!(Dv in e)},Zq=ss("Date"),eF=ss("File"),tF=ss("Blob"),rF=ss("FileList"),nF=e=>Rv(e)&&Ji(e.pipe),aF=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Ji(e.append)&&((t=Mv(e))==="formdata"||t==="object"&&Ji(e.toString)&&e.toString()==="[object FormData]"))},iF=ss("URLSearchParams"),[oF,sF,lF,cF]=["ReadableStream","Request","Response","Headers"].map(ss),uF=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Ip(e,t,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let n,a;if(typeof e!="object"&&(e=[e]),Dd(e))for(n=0,a=e.length;n<a;n++)t.call(null,e[n],n,e);else{const o=r?Object.getOwnPropertyNames(e):Object.keys(e),s=o.length;let l;for(n=0;n<s;n++)l=o[n],t.call(null,e[l],l,e)}}function VI(e,t){t=t.toLowerCase();const r=Object.keys(e);let n=r.length,a;for(;n-- >0;)if(a=r[n],t===a.toLowerCase())return a;return null}const Dc=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,GI=e=>!zh(e)&&e!==Dc;function z2(){const{caseless:e}=GI(this)&&this||{},t={},r=(n,a)=>{const o=e&&VI(t,a)||a;Bm(t[o])&&Bm(n)?t[o]=z2(t[o],n):Bm(n)?t[o]=z2({},n):Dd(n)?t[o]=n.slice():t[o]=n};for(let n=0,a=arguments.length;n<a;n++)arguments[n]&&Ip(arguments[n],r);return t}const dF=(e,t,r,{allOwnKeys:n}={})=>(Ip(t,(a,o)=>{r&&Ji(a)?e[o]=UI(a,r):e[o]=a},{allOwnKeys:n}),e),fF=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),hF=(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},pF=(e,t,r,n)=>{let a,o,s;const l={};if(t=t||{},e==null)return t;do{for(a=Object.getOwnPropertyNames(e),o=a.length;o-- >0;)s=a[o],(!n||n(s,e,t))&&!l[s]&&(t[s]=e[s],l[s]=!0);e=r!==!1&&tj(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},mF=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return n!==-1&&n===r},gF=e=>{if(!e)return null;if(Dd(e))return e;let t=e.length;if(!HI(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},vF=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&tj(Uint8Array)),yF=(e,t)=>{const n=(e&&e[Dv]).call(e);let a;for(;(a=n.next())&&!a.done;){const o=a.value;t.call(e,o[0],o[1])}},xF=(e,t)=>{let r;const n=[];for(;(r=e.exec(t))!==null;)n.push(r);return n},bF=ss("HTMLFormElement"),_F=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,a){return n.toUpperCase()+a}),m5=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),wF=ss("RegExp"),YI=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};Ip(r,(a,o)=>{let s;(s=t(a,o,e))!==!1&&(n[o]=s||a)}),Object.defineProperties(e,n)},jF=e=>{YI(e,(t,r)=>{if(Ji(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=e[r];if(Ji(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},SF=(e,t)=>{const r={},n=a=>{a.forEach(o=>{r[o]=!0})};return Dd(e)?n(e):n(String(e).split(t)),r},CF=()=>{},AF=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function PF(e){return!!(e&&Ji(e.append)&&e[zI]==="FormData"&&e[Dv])}const OF=e=>{const t=new Array(10),r=(n,a)=>{if(Rv(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[a]=n;const o=Dd(n)?[]:{};return Ip(n,(s,l)=>{const c=r(s,a+1);!zh(c)&&(o[l]=c)}),t[a]=void 0,o}}return n};return r(e,0)},kF=ss("AsyncFunction"),EF=e=>e&&(Rv(e)||Ji(e))&&Ji(e.then)&&Ji(e.catch),KI=((e,t)=>e?setImmediate:t?((r,n)=>(Dc.addEventListener("message",({source:a,data:o})=>{a===Dc&&o===r&&n.length&&n.shift()()},!1),a=>{n.push(a),Dc.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",Ji(Dc.postMessage)),TF=typeof queueMicrotask<"u"?queueMicrotask.bind(Dc):typeof process<"u"&&process.nextTick||KI,IF=e=>e!=null&&Ji(e[Dv]),lt={isArray:Dd,isArrayBuffer:WI,isBuffer:Kq,isFormData:aF,isArrayBufferView:Qq,isString:Xq,isNumber:HI,isBoolean:Jq,isObject:Rv,isPlainObject:Bm,isReadableStream:oF,isRequest:sF,isResponse:lF,isHeaders:cF,isUndefined:zh,isDate:Zq,isFile:eF,isBlob:tF,isRegExp:wF,isFunction:Ji,isStream:nF,isURLSearchParams:iF,isTypedArray:vF,isFileList:rF,forEach:Ip,merge:z2,extend:dF,trim:uF,stripBOM:fF,inherits:hF,toFlatObject:pF,kindOf:Mv,kindOfTest:ss,endsWith:mF,toArray:gF,forEachEntry:yF,matchAll:xF,isHTMLForm:bF,hasOwnProperty:m5,hasOwnProp:m5,reduceDescriptors:YI,freezeMethods:jF,toObjectSet:SF,toCamelCase:_F,noop:CF,toFiniteNumber:AF,findKey:VI,global:Dc,isContextDefined:GI,isSpecCompliantForm:PF,toJSONObject:OF,isAsyncFn:kF,isThenable:EF,setImmediate:KI,asap:TF,isIterable:IF};function Ur(e,t,r,n,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),a&&(this.response=a,this.status=a.status?a.status:null)}lt.inherits(Ur,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:lt.toJSONObject(this.config),code:this.code,status:this.status}}});const QI=Ur.prototype,XI={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{XI[e]={value:e}});Object.defineProperties(Ur,XI);Object.defineProperty(QI,"isAxiosError",{value:!0});Ur.from=(e,t,r,n,a,o)=>{const s=Object.create(QI);return lt.toFlatObject(e,s,function(c){return c!==Error.prototype},l=>l!=="isAxiosError"),Ur.call(s,e.message,t,r,n,a),s.cause=e,s.name=e.name,o&&Object.assign(s,o),s};const NF=null;function W2(e){return lt.isPlainObject(e)||lt.isArray(e)}function JI(e){return lt.endsWith(e,"[]")?e.slice(0,-2):e}function g5(e,t,r){return e?e.concat(t).map(function(a,o){return a=JI(a),!r&&o?"["+a+"]":a}).join(r?".":""):t}function DF(e){return lt.isArray(e)&&!e.some(W2)}const MF=lt.toFlatObject(lt,{},null,function(t){return/^is[A-Z]/.test(t)});function qv(e,t,r){if(!lt.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=lt.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,y){return!lt.isUndefined(y[m])});const n=r.metaTokens,a=r.visitor||d,o=r.dots,s=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&lt.isSpecCompliantForm(t);if(!lt.isFunction(a))throw new TypeError("visitor must be a function");function u(v){if(v===null)return"";if(lt.isDate(v))return v.toISOString();if(lt.isBoolean(v))return v.toString();if(!c&&lt.isBlob(v))throw new Ur("Blob is not supported. Use a Buffer instead.");return lt.isArrayBuffer(v)||lt.isTypedArray(v)?c&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function d(v,m,y){let b=v;if(v&&!y&&typeof v=="object"){if(lt.endsWith(m,"{}"))m=n?m:m.slice(0,-2),v=JSON.stringify(v);else if(lt.isArray(v)&&DF(v)||(lt.isFileList(v)||lt.endsWith(m,"[]"))&&(b=lt.toArray(v)))return m=JI(m),b.forEach(function(w,A){!(lt.isUndefined(w)||w===null)&&t.append(s===!0?g5([m],A,o):s===null?m:m+"[]",u(w))}),!1}return W2(v)?!0:(t.append(g5(y,m,o),u(v)),!1)}const f=[],h=Object.assign(MF,{defaultVisitor:d,convertValue:u,isVisitable:W2});function p(v,m){if(!lt.isUndefined(v)){if(f.indexOf(v)!==-1)throw Error("Circular reference detected in "+m.join("."));f.push(v),lt.forEach(v,function(b,_){(!(lt.isUndefined(b)||b===null)&&a.call(t,b,lt.isString(_)?_.trim():_,m,h))===!0&&p(b,m?m.concat(_):[_])}),f.pop()}}if(!lt.isObject(e))throw new TypeError("data must be an object");return p(e),t}function v5(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function rj(e,t){this._pairs=[],e&&qv(e,this,t)}const ZI=rj.prototype;ZI.append=function(t,r){this._pairs.push([t,r])};ZI.toString=function(t){const r=t?function(n){return t.call(this,n,v5)}:v5;return this._pairs.map(function(a){return r(a[0])+"="+r(a[1])},"").join("&")};function LF(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function eN(e,t,r){if(!t)return e;const n=r&&r.encode||LF;lt.isFunction(r)&&(r={serialize:r});const a=r&&r.serialize;let o;if(a?o=a(t,r):o=lt.isURLSearchParams(t)?t.toString():new rj(t,r).toString(n),o){const s=e.indexOf("#");s!==-1&&(e=e.slice(0,s)),e+=(e.indexOf("?")===-1?"?":"&")+o}return e}class y5{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){lt.forEach(this.handlers,function(n){n!==null&&t(n)})}}const tN={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},RF=typeof URLSearchParams<"u"?URLSearchParams:rj,qF=typeof FormData<"u"?FormData:null,FF=typeof Blob<"u"?Blob:null,$F={isBrowser:!0,classes:{URLSearchParams:RF,FormData:qF,Blob:FF},protocols:["http","https","file","blob","url","data"]},nj=typeof window<"u"&&typeof document<"u",H2=typeof navigator=="object"&&navigator||void 0,BF=nj&&(!H2||["ReactNative","NativeScript","NS"].indexOf(H2.product)<0),UF=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",zF=nj&&window.location.href||"http://localhost",WF=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:nj,hasStandardBrowserEnv:BF,hasStandardBrowserWebWorkerEnv:UF,navigator:H2,origin:zF},Symbol.toStringTag,{value:"Module"})),bi={...WF,...$F};function HF(e,t){return qv(e,new bi.classes.URLSearchParams,Object.assign({visitor:function(r,n,a,o){return bi.isNode&&lt.isBuffer(r)?(this.append(n,r.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},t))}function VF(e){return lt.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function GF(e){const t={},r=Object.keys(e);let n;const a=r.length;let o;for(n=0;n<a;n++)o=r[n],t[o]=e[o];return t}function rN(e){function t(r,n,a,o){let s=r[o++];if(s==="__proto__")return!0;const l=Number.isFinite(+s),c=o>=r.length;return s=!s&&lt.isArray(a)?a.length:s,c?(lt.hasOwnProp(a,s)?a[s]=[a[s],n]:a[s]=n,!l):((!a[s]||!lt.isObject(a[s]))&&(a[s]=[]),t(r,n,a[s],o)&&lt.isArray(a[s])&&(a[s]=GF(a[s])),!l)}if(lt.isFormData(e)&&lt.isFunction(e.entries)){const r={};return lt.forEachEntry(e,(n,a)=>{t(VF(n),a,r,0)}),r}return null}function YF(e,t,r){if(lt.isString(e))try{return(t||JSON.parse)(e),lt.trim(e)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(e)}const Np={transitional:tN,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",a=n.indexOf("application/json")>-1,o=lt.isObject(t);if(o&&lt.isHTMLForm(t)&&(t=new FormData(t)),lt.isFormData(t))return a?JSON.stringify(rN(t)):t;if(lt.isArrayBuffer(t)||lt.isBuffer(t)||lt.isStream(t)||lt.isFile(t)||lt.isBlob(t)||lt.isReadableStream(t))return t;if(lt.isArrayBufferView(t))return t.buffer;if(lt.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let l;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return HF(t,this.formSerializer).toString();if((l=lt.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return qv(l?{"files[]":t}:t,c&&new c,this.formSerializer)}}return o||a?(r.setContentType("application/json",!1),YF(t)):t}],transformResponse:[function(t){const r=this.transitional||Np.transitional,n=r&&r.forcedJSONParsing,a=this.responseType==="json";if(lt.isResponse(t)||lt.isReadableStream(t))return t;if(t&&lt.isString(t)&&(n&&!this.responseType||a)){const s=!(r&&r.silentJSONParsing)&&a;try{return JSON.parse(t)}catch(l){if(s)throw l.name==="SyntaxError"?Ur.from(l,Ur.ERR_BAD_RESPONSE,this,null,this.response):l}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:bi.classes.FormData,Blob:bi.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};lt.forEach(["delete","get","head","post","put","patch"],e=>{Np.headers[e]={}});const KF=lt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),QF=e=>{const t={};let r,n,a;return e&&e.split(`
`).forEach(function(s){a=s.indexOf(":"),r=s.substring(0,a).trim().toLowerCase(),n=s.substring(a+1).trim(),!(!r||t[r]&&KF[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},x5=Symbol("internals");function tf(e){return e&&String(e).trim().toLowerCase()}function Um(e){return e===!1||e==null?e:lt.isArray(e)?e.map(Um):String(e)}function XF(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}const JF=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function ix(e,t,r,n,a){if(lt.isFunction(n))return n.call(this,t,r);if(a&&(t=r),!!lt.isString(t)){if(lt.isString(n))return t.indexOf(n)!==-1;if(lt.isRegExp(n))return n.test(t)}}function ZF(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function e7(e,t){const r=lt.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(a,o,s){return this[n].call(this,t,a,o,s)},configurable:!0})})}let Zi=class{constructor(t){t&&this.set(t)}set(t,r,n){const a=this;function o(l,c,u){const d=tf(c);if(!d)throw new Error("header name must be a non-empty string");const f=lt.findKey(a,d);(!f||a[f]===void 0||u===!0||u===void 0&&a[f]!==!1)&&(a[f||c]=Um(l))}const s=(l,c)=>lt.forEach(l,(u,d)=>o(u,d,c));if(lt.isPlainObject(t)||t instanceof this.constructor)s(t,r);else if(lt.isString(t)&&(t=t.trim())&&!JF(t))s(QF(t),r);else if(lt.isObject(t)&&lt.isIterable(t)){let l={},c,u;for(const d of t){if(!lt.isArray(d))throw TypeError("Object iterator must return a key-value pair");l[u=d[0]]=(c=l[u])?lt.isArray(c)?[...c,d[1]]:[c,d[1]]:d[1]}s(l,r)}else t!=null&&o(r,t,n);return this}get(t,r){if(t=tf(t),t){const n=lt.findKey(this,t);if(n){const a=this[n];if(!r)return a;if(r===!0)return XF(a);if(lt.isFunction(r))return r.call(this,a,n);if(lt.isRegExp(r))return r.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=tf(t),t){const n=lt.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||ix(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let a=!1;function o(s){if(s=tf(s),s){const l=lt.findKey(n,s);l&&(!r||ix(n,n[l],l,r))&&(delete n[l],a=!0)}}return lt.isArray(t)?t.forEach(o):o(t),a}clear(t){const r=Object.keys(this);let n=r.length,a=!1;for(;n--;){const o=r[n];(!t||ix(this,this[o],o,t,!0))&&(delete this[o],a=!0)}return a}normalize(t){const r=this,n={};return lt.forEach(this,(a,o)=>{const s=lt.findKey(n,o);if(s){r[s]=Um(a),delete r[o];return}const l=t?ZF(o):String(o).trim();l!==o&&delete r[o],r[l]=Um(a),n[l]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return lt.forEach(this,(n,a)=>{n!=null&&n!==!1&&(r[a]=t&&lt.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(a=>n.set(a)),n}static accessor(t){const n=(this[x5]=this[x5]={accessors:{}}).accessors,a=this.prototype;function o(s){const l=tf(s);n[l]||(e7(a,s),n[l]=!0)}return lt.isArray(t)?t.forEach(o):o(t),this}};Zi.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);lt.reduceDescriptors(Zi.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(n){this[r]=n}}});lt.freezeMethods(Zi);function ox(e,t){const r=this||Np,n=t||r,a=Zi.from(n.headers);let o=n.data;return lt.forEach(e,function(l){o=l.call(r,o,a.normalize(),t?t.status:void 0)}),a.normalize(),o}function nN(e){return!!(e&&e.__CANCEL__)}function Md(e,t,r){Ur.call(this,e??"canceled",Ur.ERR_CANCELED,t,r),this.name="CanceledError"}lt.inherits(Md,Ur,{__CANCEL__:!0});function aN(e,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?e(r):t(new Ur("Request failed with status code "+r.status,[Ur.ERR_BAD_REQUEST,Ur.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function t7(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function r7(e,t){e=e||10;const r=new Array(e),n=new Array(e);let a=0,o=0,s;return t=t!==void 0?t:1e3,function(c){const u=Date.now(),d=n[o];s||(s=u),r[a]=c,n[a]=u;let f=o,h=0;for(;f!==a;)h+=r[f++],f=f%e;if(a=(a+1)%e,a===o&&(o=(o+1)%e),u-s<t)return;const p=d&&u-d;return p?Math.round(h*1e3/p):void 0}}function n7(e,t){let r=0,n=1e3/t,a,o;const s=(u,d=Date.now())=>{r=d,a=null,o&&(clearTimeout(o),o=null),e.apply(null,u)};return[(...u)=>{const d=Date.now(),f=d-r;f>=n?s(u,d):(a=u,o||(o=setTimeout(()=>{o=null,s(a)},n-f)))},()=>a&&s(a)]}const hg=(e,t,r=3)=>{let n=0;const a=r7(50,250);return n7(o=>{const s=o.loaded,l=o.lengthComputable?o.total:void 0,c=s-n,u=a(c),d=s<=l;n=s;const f={loaded:s,total:l,progress:l?s/l:void 0,bytes:c,rate:u||void 0,estimated:u&&l&&d?(l-s)/u:void 0,event:o,lengthComputable:l!=null,[t?"download":"upload"]:!0};e(f)},r)},b5=(e,t)=>{const r=e!=null;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},_5=e=>(...t)=>lt.asap(()=>e(...t)),a7=bi.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,bi.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(bi.origin),bi.navigator&&/(msie|trident)/i.test(bi.navigator.userAgent)):()=>!0,i7=bi.hasStandardBrowserEnv?{write(e,t,r,n,a,o){const s=[e+"="+encodeURIComponent(t)];lt.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),lt.isString(n)&&s.push("path="+n),lt.isString(a)&&s.push("domain="+a),o===!0&&s.push("secure"),document.cookie=s.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function o7(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function s7(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function iN(e,t,r){let n=!o7(t);return e&&(n||r==!1)?s7(e,t):t}const w5=e=>e instanceof Zi?{...e}:e;function Vc(e,t){t=t||{};const r={};function n(u,d,f,h){return lt.isPlainObject(u)&&lt.isPlainObject(d)?lt.merge.call({caseless:h},u,d):lt.isPlainObject(d)?lt.merge({},d):lt.isArray(d)?d.slice():d}function a(u,d,f,h){if(lt.isUndefined(d)){if(!lt.isUndefined(u))return n(void 0,u,f,h)}else return n(u,d,f,h)}function o(u,d){if(!lt.isUndefined(d))return n(void 0,d)}function s(u,d){if(lt.isUndefined(d)){if(!lt.isUndefined(u))return n(void 0,u)}else return n(void 0,d)}function l(u,d,f){if(f in t)return n(u,d);if(f in e)return n(void 0,u)}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:l,headers:(u,d,f)=>a(w5(u),w5(d),f,!0)};return lt.forEach(Object.keys(Object.assign({},e,t)),function(d){const f=c[d]||a,h=f(e[d],t[d],d);lt.isUndefined(h)&&f!==l||(r[d]=h)}),r}const oN=e=>{const t=Vc({},e);let{data:r,withXSRFToken:n,xsrfHeaderName:a,xsrfCookieName:o,headers:s,auth:l}=t;t.headers=s=Zi.from(s),t.url=eN(iN(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&s.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let c;if(lt.isFormData(r)){if(bi.hasStandardBrowserEnv||bi.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if((c=s.getContentType())!==!1){const[u,...d]=c?c.split(";").map(f=>f.trim()).filter(Boolean):[];s.setContentType([u||"multipart/form-data",...d].join("; "))}}if(bi.hasStandardBrowserEnv&&(n&&lt.isFunction(n)&&(n=n(t)),n||n!==!1&&a7(t.url))){const u=a&&o&&i7.read(o);u&&s.set(a,u)}return t},l7=typeof XMLHttpRequest<"u",c7=l7&&function(e){return new Promise(function(r,n){const a=oN(e);let o=a.data;const s=Zi.from(a.headers).normalize();let{responseType:l,onUploadProgress:c,onDownloadProgress:u}=a,d,f,h,p,v;function m(){p&&p(),v&&v(),a.cancelToken&&a.cancelToken.unsubscribe(d),a.signal&&a.signal.removeEventListener("abort",d)}let y=new XMLHttpRequest;y.open(a.method.toUpperCase(),a.url,!0),y.timeout=a.timeout;function b(){if(!y)return;const w=Zi.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),P={data:!l||l==="text"||l==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:w,config:e,request:y};aN(function(T){r(T),m()},function(T){n(T),m()},P),y=null}"onloadend"in y?y.onloadend=b:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(b)},y.onabort=function(){y&&(n(new Ur("Request aborted",Ur.ECONNABORTED,e,y)),y=null)},y.onerror=function(){n(new Ur("Network Error",Ur.ERR_NETWORK,e,y)),y=null},y.ontimeout=function(){let A=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const P=a.transitional||tN;a.timeoutErrorMessage&&(A=a.timeoutErrorMessage),n(new Ur(A,P.clarifyTimeoutError?Ur.ETIMEDOUT:Ur.ECONNABORTED,e,y)),y=null},o===void 0&&s.setContentType(null),"setRequestHeader"in y&&lt.forEach(s.toJSON(),function(A,P){y.setRequestHeader(P,A)}),lt.isUndefined(a.withCredentials)||(y.withCredentials=!!a.withCredentials),l&&l!=="json"&&(y.responseType=a.responseType),u&&([h,v]=hg(u,!0),y.addEventListener("progress",h)),c&&y.upload&&([f,p]=hg(c),y.upload.addEventListener("progress",f),y.upload.addEventListener("loadend",p)),(a.cancelToken||a.signal)&&(d=w=>{y&&(n(!w||w.type?new Md(null,e,y):w),y.abort(),y=null)},a.cancelToken&&a.cancelToken.subscribe(d),a.signal&&(a.signal.aborted?d():a.signal.addEventListener("abort",d)));const _=t7(a.url);if(_&&bi.protocols.indexOf(_)===-1){n(new Ur("Unsupported protocol "+_+":",Ur.ERR_BAD_REQUEST,e));return}y.send(o||null)})},u7=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let n=new AbortController,a;const o=function(u){if(!a){a=!0,l();const d=u instanceof Error?u:this.reason;n.abort(d instanceof Ur?d:new Md(d instanceof Error?d.message:d))}};let s=t&&setTimeout(()=>{s=null,o(new Ur(`timeout ${t} of ms exceeded`,Ur.ETIMEDOUT))},t);const l=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(u=>{u.unsubscribe?u.unsubscribe(o):u.removeEventListener("abort",o)}),e=null)};e.forEach(u=>u.addEventListener("abort",o));const{signal:c}=n;return c.unsubscribe=()=>lt.asap(l),c}},d7=function*(e,t){let r=e.byteLength;if(r<t){yield e;return}let n=0,a;for(;n<r;)a=n+t,yield e.slice(n,a),n=a},f7=async function*(e,t){for await(const r of h7(e))yield*d7(r,t)},h7=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},j5=(e,t,r,n)=>{const a=f7(e,t);let o=0,s,l=c=>{s||(s=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:u,value:d}=await a.next();if(u){l(),c.close();return}let f=d.byteLength;if(r){let h=o+=f;r(h)}c.enqueue(new Uint8Array(d))}catch(u){throw l(u),u}},cancel(c){return l(c),a.return()}},{highWaterMark:2})},Fv=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",sN=Fv&&typeof ReadableStream=="function",p7=Fv&&(typeof TextEncoder=="function"?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),lN=(e,...t)=>{try{return!!e(...t)}catch{return!1}},m7=sN&&lN(()=>{let e=!1;const t=new Request(bi.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),S5=64*1024,V2=sN&&lN(()=>lt.isReadableStream(new Response("").body)),pg={stream:V2&&(e=>e.body)};Fv&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!pg[t]&&(pg[t]=lt.isFunction(e[t])?r=>r[t]():(r,n)=>{throw new Ur(`Response type '${t}' is not supported`,Ur.ERR_NOT_SUPPORT,n)})})})(new Response);const g7=async e=>{if(e==null)return 0;if(lt.isBlob(e))return e.size;if(lt.isSpecCompliantForm(e))return(await new Request(bi.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(lt.isArrayBufferView(e)||lt.isArrayBuffer(e))return e.byteLength;if(lt.isURLSearchParams(e)&&(e=e+""),lt.isString(e))return(await p7(e)).byteLength},v7=async(e,t)=>{const r=lt.toFiniteNumber(e.getContentLength());return r??g7(t)},y7=Fv&&(async e=>{let{url:t,method:r,data:n,signal:a,cancelToken:o,timeout:s,onDownloadProgress:l,onUploadProgress:c,responseType:u,headers:d,withCredentials:f="same-origin",fetchOptions:h}=oN(e);u=u?(u+"").toLowerCase():"text";let p=u7([a,o&&o.toAbortSignal()],s),v;const m=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let y;try{if(c&&m7&&r!=="get"&&r!=="head"&&(y=await v7(d,n))!==0){let P=new Request(t,{method:"POST",body:n,duplex:"half"}),E;if(lt.isFormData(n)&&(E=P.headers.get("content-type"))&&d.setContentType(E),P.body){const[T,S]=b5(y,hg(_5(c)));n=j5(P.body,S5,T,S)}}lt.isString(f)||(f=f?"include":"omit");const b="credentials"in Request.prototype;v=new Request(t,{...h,signal:p,method:r.toUpperCase(),headers:d.normalize().toJSON(),body:n,duplex:"half",credentials:b?f:void 0});let _=await fetch(v,h);const w=V2&&(u==="stream"||u==="response");if(V2&&(l||w&&m)){const P={};["status","statusText","headers"].forEach(I=>{P[I]=_[I]});const E=lt.toFiniteNumber(_.headers.get("content-length")),[T,S]=l&&b5(E,hg(_5(l),!0))||[];_=new Response(j5(_.body,S5,T,()=>{S&&S(),m&&m()}),P)}u=u||"text";let A=await pg[lt.findKey(pg,u)||"text"](_,e);return!w&&m&&m(),await new Promise((P,E)=>{aN(P,E,{data:A,headers:Zi.from(_.headers),status:_.status,statusText:_.statusText,config:e,request:v})})}catch(b){throw m&&m(),b&&b.name==="TypeError"&&/Load failed|fetch/i.test(b.message)?Object.assign(new Ur("Network Error",Ur.ERR_NETWORK,e,v),{cause:b.cause||b}):Ur.from(b,b&&b.code,e,v)}}),G2={http:NF,xhr:c7,fetch:y7};lt.forEach(G2,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const C5=e=>`- ${e}`,x7=e=>lt.isFunction(e)||e===null||e===!1,cN={getAdapter:e=>{e=lt.isArray(e)?e:[e];const{length:t}=e;let r,n;const a={};for(let o=0;o<t;o++){r=e[o];let s;if(n=r,!x7(r)&&(n=G2[(s=String(r)).toLowerCase()],n===void 0))throw new Ur(`Unknown adapter '${s}'`);if(n)break;a[s||"#"+o]=n}if(!n){const o=Object.entries(a).map(([l,c])=>`adapter ${l} `+(c===!1?"is not supported by the environment":"is not available in the build"));let s=t?o.length>1?`since :
`+o.map(C5).join(`
`):" "+C5(o[0]):"as no adapter specified";throw new Ur("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return n},adapters:G2};function sx(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Md(null,e)}function A5(e){return sx(e),e.headers=Zi.from(e.headers),e.data=ox.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),cN.getAdapter(e.adapter||Np.adapter)(e).then(function(n){return sx(e),n.data=ox.call(e,e.transformResponse,n),n.headers=Zi.from(n.headers),n},function(n){return nN(n)||(sx(e),n&&n.response&&(n.response.data=ox.call(e,e.transformResponse,n.response),n.response.headers=Zi.from(n.response.headers))),Promise.reject(n)})}const uN="1.10.0",$v={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{$v[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const P5={};$v.transitional=function(t,r,n){function a(o,s){return"[Axios v"+uN+"] Transitional option '"+o+"'"+s+(n?". "+n:"")}return(o,s,l)=>{if(t===!1)throw new Ur(a(s," has been removed"+(r?" in "+r:"")),Ur.ERR_DEPRECATED);return r&&!P5[s]&&(P5[s]=!0,console.warn(a(s," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(o,s,l):!0}};$v.spelling=function(t){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function b7(e,t,r){if(typeof e!="object")throw new Ur("options must be an object",Ur.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let a=n.length;for(;a-- >0;){const o=n[a],s=t[o];if(s){const l=e[o],c=l===void 0||s(l,o,e);if(c!==!0)throw new Ur("option "+o+" must be "+c,Ur.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new Ur("Unknown option "+o,Ur.ERR_BAD_OPTION)}}const zm={assertOptions:b7,validators:$v},gs=zm.validators;let Fc=class{constructor(t){this.defaults=t||{},this.interceptors={request:new y5,response:new y5}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const o=a.stack?a.stack.replace(/^.+\n/,""):"";try{n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=Vc(this.defaults,r);const{transitional:n,paramsSerializer:a,headers:o}=r;n!==void 0&&zm.assertOptions(n,{silentJSONParsing:gs.transitional(gs.boolean),forcedJSONParsing:gs.transitional(gs.boolean),clarifyTimeoutError:gs.transitional(gs.boolean)},!1),a!=null&&(lt.isFunction(a)?r.paramsSerializer={serialize:a}:zm.assertOptions(a,{encode:gs.function,serialize:gs.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),zm.assertOptions(r,{baseUrl:gs.spelling("baseURL"),withXsrfToken:gs.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let s=o&&lt.merge(o.common,o[r.method]);o&&lt.forEach(["delete","get","head","post","put","patch","common"],v=>{delete o[v]}),r.headers=Zi.concat(s,o);const l=[];let c=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(r)===!1||(c=c&&m.synchronous,l.unshift(m.fulfilled,m.rejected))});const u=[];this.interceptors.response.forEach(function(m){u.push(m.fulfilled,m.rejected)});let d,f=0,h;if(!c){const v=[A5.bind(this),void 0];for(v.unshift.apply(v,l),v.push.apply(v,u),h=v.length,d=Promise.resolve(r);f<h;)d=d.then(v[f++],v[f++]);return d}h=l.length;let p=r;for(f=0;f<h;){const v=l[f++],m=l[f++];try{p=v(p)}catch(y){m.call(this,y);break}}try{d=A5.call(this,p)}catch(v){return Promise.reject(v)}for(f=0,h=u.length;f<h;)d=d.then(u[f++],u[f++]);return d}getUri(t){t=Vc(this.defaults,t);const r=iN(t.baseURL,t.url,t.allowAbsoluteUrls);return eN(r,t.params,t.paramsSerializer)}};lt.forEach(["delete","get","head","options"],function(t){Fc.prototype[t]=function(r,n){return this.request(Vc(n||{},{method:t,url:r,data:(n||{}).data}))}});lt.forEach(["post","put","patch"],function(t){function r(n){return function(o,s,l){return this.request(Vc(l||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:s}))}}Fc.prototype[t]=r(),Fc.prototype[t+"Form"]=r(!0)});let _7=class dN{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(o){r=o});const n=this;this.promise.then(a=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](a);n._listeners=null}),this.promise.then=a=>{let o;const s=new Promise(l=>{n.subscribe(l),o=l}).then(a);return s.cancel=function(){n.unsubscribe(o)},s},t(function(o,s,l){n.reason||(n.reason=new Md(o,s,l),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new dN(function(a){t=a}),cancel:t}}};function w7(e){return function(r){return e.apply(null,r)}}function j7(e){return lt.isObject(e)&&e.isAxiosError===!0}const Y2={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Y2).forEach(([e,t])=>{Y2[t]=e});function fN(e){const t=new Fc(e),r=UI(Fc.prototype.request,t);return lt.extend(r,Fc.prototype,t,{allOwnKeys:!0}),lt.extend(r,t,null,{allOwnKeys:!0}),r.create=function(a){return fN(Vc(e,a))},r}const Oa=fN(Np);Oa.Axios=Fc;Oa.CanceledError=Md;Oa.CancelToken=_7;Oa.isCancel=nN;Oa.VERSION=uN;Oa.toFormData=qv;Oa.AxiosError=Ur;Oa.Cancel=Oa.CanceledError;Oa.all=function(t){return Promise.all(t)};Oa.spread=w7;Oa.isAxiosError=j7;Oa.mergeConfig=Vc;Oa.AxiosHeaders=Zi;Oa.formToJSON=e=>rN(lt.isHTMLForm(e)?new FormData(e):e);Oa.getAdapter=cN.getAdapter;Oa.HttpStatusCode=Y2;Oa.default=Oa;const{Axios:upe,AxiosError:ci,CanceledError:dpe,isCancel:fpe,CancelToken:hpe,VERSION:ppe,all:mpe,Cancel:gpe,isAxiosError:vpe,spread:ype,toFormData:xpe,AxiosHeaders:bpe,HttpStatusCode:_pe,formToJSON:wpe,getAdapter:jpe,mergeConfig:Spe}=Oa,K2=typeof window<"u"&&!!window.electronAPI;function S7(e){return e&&e.includes("localhost")&&e.startsWith("https://")?e.replace("https://","http://"):e}console.log("API baseURL:",void 0);console.log("Is Electron:",K2);const C7={cloudflare:{baseURL:"https://api.yourdomain.com"}};function Wu(){return console.log("Environment variables:",{VITE_API_BASE_URL:void 0,VITE_CLOUDFLARE_URL:void 0,MODE:"production",NODE_ENV:"production",isElectron:K2}),K2&&console.log("Running in Electron - checking environment variables"),console.log("Using production config"),{baseURL:S7(C7.cloudflare.baseURL),timeout:12e4}}const O5=Wu(),Ac=(e,t)=>{try{window.dispatchEvent(new CustomEvent(e,{detail:t}))}catch{}},lx=()=>{localStorage.setItem("authRedirectMessage","Your session expired. Please sign in again."),Ac("auth:expired"),localStorage.removeItem("sessionToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),window.location.href="/login"};let mm=null;const ve=Oa.create({baseURL:O5.baseURL,timeout:O5.timeout,withCredentials:!0});ve.interceptors.request.use(e=>{const t=localStorage.getItem("sessionToken");t&&(e.headers.Authorization=`Bearer ${t}`);const r=localStorage.getItem("deviceId");r&&(e.headers["x-device-id"]=r);try{const n=typeof Intl<"u"?Intl.DateTimeFormat().resolvedOptions().timeZone:void 0;n&&(e.headers["x-timezone"]=n)}catch{}return e},e=>Promise.reject(e));ve.interceptors.response.use(e=>{try{window.__backendUnavailableSince=void 0,Ac("backend:available"),Ac("connectivity:online");const t=window.__triggerSync;typeof t=="function"&&setTimeout(()=>{try{t()}catch{}},0)}catch{}return e},async e=>{try{const n=e?.response?.status,a=!e.response&&(e.code==="ECONNABORTED"||e.message?.includes("Network Error"));(typeof n=="number"&&n>=500||a)&&(window.__backendUnavailableSince=window.__backendUnavailableSince||Date.now(),Ac("backend:unavailable",{status:n,networkDown:a}),Ac("connectivity:offline",{reason:"backend"})),typeof navigator<"u"&&navigator&&navigator.onLine===!1&&Ac("connectivity:offline",{reason:"network"})}catch{}const t=e.config;if(e.response?.status===401&&t?.url?.includes("/api/auth/refresh"))return lx(),Promise.reject(e);if(e.response?.status===401&&!t._retry){t._retry=!0;const n=localStorage.getItem("refreshToken");if(n)try{return mm||(mm=ve.post("/api/auth/refresh",{refreshToken:n}).then(a=>{const{sessionToken:o,refreshToken:s}=a.data;return localStorage.setItem("sessionToken",o),localStorage.setItem("refreshToken",s),ve.defaults.headers.common.Authorization=`Bearer ${o}`,o}).catch(a=>{throw lx(),a}).finally(()=>{mm=null})),await mm,ve(t)}catch(a){return Promise.reject(a)}else lx()}const r=e?.response?.data?.message||e?.message||"Request failed. Please check your connection and try again.";return Ac("app:error",{message:r}),Promise.reject(e)});const hN=x.createContext(void 0),A7=({children:e})=>{const[t,r]=x.useState(null),[n,a]=x.useState(!1),[o,s]=x.useState("");x.useEffect(()=>{let p=localStorage.getItem("deviceId");p||(p=crypto.randomUUID(),localStorage.setItem("deviceId",p)),s(p)},[]),x.useEffect(()=>{const p=localStorage.getItem("sessionToken"),v=localStorage.getItem("refreshToken"),m=localStorage.getItem("user");if(p&&v&&m)try{const y=JSON.parse(m);r(y),a(!0),ve.defaults.headers.common.Authorization=`Bearer ${p}`,ve.defaults.headers.common["x-device-id"]=o}catch(y){console.error("Error parsing user data:",y),c()}},[o]);const l=(p,v,m)=>{localStorage.setItem("sessionToken",p),localStorage.setItem("refreshToken",v),localStorage.setItem("user",JSON.stringify(m)),ve.defaults.headers.common.Authorization=`Bearer ${p}`;const y=localStorage.getItem("deviceId");y&&(ve.defaults.headers.common["x-device-id"]=y),r(m),a(!0)},c=()=>{localStorage.removeItem("sessionToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),delete ve.defaults.headers.common.Authorization,r(null),a(!1)},u=async()=>{try{await ve.post("/api/auth/logout-all"),c()}catch(p){console.error("Error logging out from all devices:",p),c()}},d=async()=>{try{const p=localStorage.getItem("refreshToken");if(!p)return!1;const v=await ve.post("/api/auth/refresh",{refreshToken:p}),{sessionToken:m,refreshToken:y}=v.data;return localStorage.setItem("sessionToken",m),localStorage.setItem("refreshToken",y),ve.defaults.headers.common.Authorization=`Bearer ${m}`,!0}catch(p){return console.error("Error refreshing session:",p),c(),!1}},f=async()=>{try{return(await ve.get("/api/auth/sessions")).data}catch(p){return console.error("Error fetching user sessions:",p),[]}},h=async p=>{try{return await ve.delete(`/api/auth/sessions/${p}`),!0}catch(v){return console.error("Error deactivating session:",v),!1}};return i.jsx(hN.Provider,{value:{user:t,isAuthenticated:n,login:l,logout:c,logoutFromAllDevices:u,refreshSession:d,getUserSessions:f,deactivateSession:h,currentDeviceId:o},children:e})},Jn=()=>{const e=x.useContext(hN);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e},k5=e=>({id:Number(e.id),companyId:Number(e.companyId??e.company_id),conversationType:e.conversationType??e.conversation_type,title:e.title??null,createdBy:Number(e.createdBy??e.created_by),createdAt:e.createdAt??e.created_at,updatedAt:e.updatedAt??e.updated_at,lastMessageAt:e.lastMessageAt??e.last_message_at??null,participants:Array.isArray(e.participants)?e.participants.map(t=>({id:Number(t.id),username:t.username??null,email:t.email??null,isAdmin:!!(t.isAdmin??t.is_admin??!1)})):[],lastMessage:e.lastMessage?{id:Number(e.lastMessage.id),conversationId:Number(e.lastMessage.conversationId??e.lastMessage.conversation_id??e.id),senderId:e.lastMessage.senderId!==void 0&&e.lastMessage.senderId!==null?Number(e.lastMessage.senderId):null,senderName:e.lastMessage.senderName??null,content:e.lastMessage.isDeletedForUser||e.lastMessage.is_deleted_for_user?"Message deleted":e.lastMessage.content??"",isSystem:!!e.lastMessage.isSystem,createdAt:e.lastMessage.createdAt??"",updatedAt:e.lastMessage.updatedAt??e.lastMessage.createdAt??"",isDeletedForUser:!!(e.lastMessage.isDeletedForUser??e.lastMessage.is_deleted_for_user??!1),deletedAt:e.lastMessage.deletedAt??e.lastMessage.deleted_at??null}:null}),cx=e=>({id:typeof e.id=="number"||typeof e.id=="string"?e.id:Number(e.id),conversationId:Number(e.conversationId??e.conversation_id),senderId:e.senderId!==void 0&&e.senderId!==null?Number(e.senderId):e.sender_id!==void 0&&e.sender_id!==null?Number(e.sender_id):null,senderName:e.senderName??e.sender_name??e.username??null,content:e.isDeletedForUser||e.is_deleted_for_user?"Message deleted":e.content??"",isSystem:!!(e.isSystem??e.is_system??!1),createdAt:e.createdAt??e.created_at??new Date().toISOString(),updatedAt:e.updatedAt??e.updated_at??e.createdAt??e.created_at??new Date().toISOString(),pending:e.pending,error:e.error,isDeletedForUser:!!(e.isDeletedForUser??e.is_deleted_for_user??!1),deletedAt:e.deletedAt??e.deleted_at??null}),rf={async createConversation(e){const t=await ve.post("/api/messaging/conversations",e),{conversation:r,created:n}=t.data;return{conversation:k5(r),created:!!n}},async getConversations(){return((await ve.get("/api/messaging/conversations")).data?.conversations??[]).map(r=>k5(r))},async getMessages(e,t={}){return((await ve.get(`/api/messaging/conversations/${e}/messages`,{params:t})).data?.messages??[]).map(a=>cx(a))},async postMessage(e,t){const r=await ve.post(`/api/messaging/conversations/${e}/messages`,{content:t});return cx(r.data?.message??r.data)},async deleteMessage(e,t){const r=await ve.delete(`/api/messaging/conversations/${e}/messages/${t}`);return cx(r.data?.message??r.data)}},pN=x.createContext(void 0),P7=(e,t)=>{const r=e.participants??[],n=t?r.filter(s=>s.id!==t):r,a=r.map(s=>s.username||s.email||"Unknown user").join(", ");if(e.conversationType==="group"){const s=e.title?.trim(),l=`${r.length} participants`;return{displayName:s||l,otherParticipants:n,participantNames:a}}if(n.length===1){const s=n[0];return{displayName:s.username||s.email||"Direct message",otherParticipants:n,participantNames:a}}return{displayName:n.length>0?n.map(s=>s.username||s.email||"Direct message").join(", "):e.title||"Direct message",otherParticipants:n,participantNames:a}},E5=e=>[...e].sort((t,r)=>{const n=t.lastMessageAt||t.updatedAt||t.createdAt,a=r.lastMessageAt||r.updatedAt||r.createdAt;return new Date(a).getTime()-new Date(n).getTime()}),O7=({children:e})=>{const{isAuthenticated:t,user:r}=Jn(),n=r?Number(r.id):null,[a,o]=x.useState([]),[s,l]=x.useState(!1),[c,u]=x.useState({}),[d,f]=x.useState({}),[h,p]=x.useState(null),[v,m]=x.useState({}),[y,b]=x.useState([]),_=x.useRef({});x.useEffect(()=>{_.current=c},[c]);const w=x.useMemo(()=>n?`messaging:last-read:${n}`:null,[n]);x.useEffect(()=>{if(!w){m({});return}try{const L=localStorage.getItem(w);if(L){const q=JSON.parse(L);m(q)}else m({})}catch{m({})}},[w]),x.useEffect(()=>{if(w)try{localStorage.setItem(w,JSON.stringify(v))}catch{}},[v,w]);const A=x.useCallback((L,q)=>{w&&m(z=>{const K=q??new Date().toISOString(),J=z[L];return J&&new Date(J).getTime()>=new Date(K).getTime()?z:{...z,[L]:K}})},[w]),P=x.useCallback(L=>{const{displayName:q,otherParticipants:z,participantNames:K}=P7(L,n);return{...L,displayName:q,otherParticipants:z,participantNames:K}},[n]),E=x.useCallback(async(L={})=>{if(t){L.silent||l(!0);try{const q=await rf.getConversations(),z=E5(q.map(P));o(z)}catch(q){console.error("Failed to load conversations",q)}finally{L.silent||l(!1)}}},[P,t]);x.useEffect(()=>{if(!t){o([]),u({}),l(!1),f({}),p(null),b([]);return}E()},[t,E]),x.useEffect(()=>{if(!t)return;const L=setInterval(()=>{E({silent:!0}).catch(()=>{})},1e4);return()=>clearInterval(L)},[t,E]),x.useEffect(()=>{!t||a.length===0||(!h||!a.some(L=>L.id===h))&&p(a[0].id)},[h,a,t]);const T=x.useCallback(async(L,q={})=>{if(t&&!(!q.force&&_.current[L])){q.silent||f(z=>({...z,[L]:!0}));try{const z=await rf.getMessages(L);u(K=>({...K,[L]:z.map(J=>({...J,pending:!1,error:!1}))}))}catch(z){console.error("Failed to load messages",z)}finally{q.silent||f(z=>({...z,[L]:!1}))}}},[t]);x.useEffect(()=>{h&&T(h).catch(()=>{})},[h,T]),x.useEffect(()=>{if(!h||!t)return;const L=setInterval(()=>{T(h,{force:!0,silent:!0}).catch(()=>{})},1e4);return()=>clearInterval(L)},[h,t,T]);const S=x.useCallback(L=>{p(L),L&&T(L).catch(()=>{})},[T]),I=x.useCallback(async(L,q)=>{if(!t||!r)throw new Error("Not authenticated");const z=q.trim();if(!z)throw new Error("Message cannot be empty");const K=`temp-${Date.now()}`,J={id:K,conversationId:L,senderId:n,senderName:r.username||r.email||null,content:z,isSystem:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),pending:!0};u(R=>{const k=R[L]??[];return{...R,[L]:[...k,J]}});try{const R=await rf.postMessage(L,z);return u(k=>{const $=k[L]??[];return{...k,[L]:$.map(X=>X.id===K?R:X)}}),await E(),A(L,new Date().toISOString()),R}catch(R){throw u(k=>{const $=k[L]??[];return{...k,[L]:$.map(X=>X.id===K?{...X,pending:!1,error:!0}:X)}}),R}},[n,t,E,r]),U=x.useCallback(async(L,q)=>{if(!t)throw new Error("Not authenticated");const z=await rf.deleteMessage(L,q);return u(K=>{const J=K[L]??[];return{...K,[L]:J.map(R=>Number(R.id)===Number(q)?{...R,...z,id:R.id,content:"Message deleted",isDeletedForUser:!0,deletedAt:z.deletedAt??null,pending:!1,error:!1}:R)}}),E({silent:!0}).catch(()=>{}),z},[t,E]),O=x.useCallback(async L=>{if(!t)throw new Error("Not authenticated");const q=await rf.createConversation(L),z=P(q.conversation);return o(K=>{const J=K.filter(R=>R.id!==z.id);return E5([z,...J])}),p(z.id),q.created&&u(K=>({...K,[z.id]:[]})),A(z.id,new Date().toISOString()),{conversation:z,created:q.created}},[P,t,A]);x.useEffect(()=>{if(!t){b([]);return}const L=a.filter(q=>{const z=q.lastMessage;if(!z)return!1;const K=q.lastMessageAt||z.updatedAt||z.createdAt;if(!K)return!1;const J=new Date(K).getTime();if(!J||Number.isNaN(J))return!1;const R=v[q.id]?new Date(v[q.id]).getTime():0;if(R&&R>=J)return!1;const k=z.senderId!==null&&z.senderId!==void 0?Number(z.senderId):null;return!(k!==null&&n!==null&&k===n)}).map(q=>q.id);b(L)},[a,n,t,v]),x.useEffect(()=>{if(!h)return;const L=a.find(z=>z.id===h);if(!L)return;const q=L.lastMessageAt||L.updatedAt||L.createdAt;q&&A(h,q)},[h,a,A]);const M=x.useMemo(()=>({conversations:a,isLoadingConversations:s,activeConversationId:h,selectConversation:S,messagesByConversation:c,loadMessages:T,isLoadingMessages:d,sendMessage:I,createConversation:O,refreshConversations:E,deleteMessage:U,unreadConversationIds:y,unreadConversationCount:y.length,markConversationRead:A}),[a,s,h,S,c,T,d,I,O,E,U,y,A]);return i.jsx(pN.Provider,{value:M,children:e})},mN=()=>{const e=x.useContext(pN);if(!e)throw new Error("useMessaging must be used within a MessagingProvider");return e},k7=n8({palette:{primary:{main:"#7c3aed"},secondary:{main:"#ffd600"}},typography:{h4:{fontSize:"1.5rem",fontWeight:600},h6:{fontSize:"1.2rem",fontWeight:500}}});var Wm={exports:{}},E7=Wm.exports,T5;function T7(){return T5||(T5=1,function(e,t){(function(r,n){e.exports=n()})(E7,function(){var r=1e3,n=6e4,a=36e5,o="millisecond",s="second",l="minute",c="hour",u="day",d="week",f="month",h="quarter",p="year",v="date",m="Invalid Date",y=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,b=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,_={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(q){var z=["th","st","nd","rd"],K=q%100;return"["+q+(z[(K-20)%10]||z[K]||z[0])+"]"}},w=function(q,z,K){var J=String(q);return!J||J.length>=z?q:""+Array(z+1-J.length).join(K)+q},A={s:w,z:function(q){var z=-q.utcOffset(),K=Math.abs(z),J=Math.floor(K/60),R=K%60;return(z<=0?"+":"-")+w(J,2,"0")+":"+w(R,2,"0")},m:function q(z,K){if(z.date()<K.date())return-q(K,z);var J=12*(K.year()-z.year())+(K.month()-z.month()),R=z.clone().add(J,f),k=K-R<0,$=z.clone().add(J+(k?-1:1),f);return+(-(J+(K-R)/(k?R-$:$-R))||0)},a:function(q){return q<0?Math.ceil(q)||0:Math.floor(q)},p:function(q){return{M:f,y:p,w:d,d:u,D:v,h:c,m:l,s,ms:o,Q:h}[q]||String(q||"").toLowerCase().replace(/s$/,"")},u:function(q){return q===void 0}},P="en",E={};E[P]=_;var T="$isDayjsObject",S=function(q){return q instanceof M||!(!q||!q[T])},I=function q(z,K,J){var R;if(!z)return P;if(typeof z=="string"){var k=z.toLowerCase();E[k]&&(R=k),K&&(E[k]=K,R=k);var $=z.split("-");if(!R&&$.length>1)return q($[0])}else{var X=z.name;E[X]=z,R=X}return!J&&R&&(P=R),R||!J&&P},U=function(q,z){if(S(q))return q.clone();var K=typeof z=="object"?z:{};return K.date=q,K.args=arguments,new M(K)},O=A;O.l=I,O.i=S,O.w=function(q,z){return U(q,{locale:z.$L,utc:z.$u,x:z.$x,$offset:z.$offset})};var M=function(){function q(K){this.$L=I(K.locale,null,!0),this.parse(K),this.$x=this.$x||K.x||{},this[T]=!0}var z=q.prototype;return z.parse=function(K){this.$d=function(J){var R=J.date,k=J.utc;if(R===null)return new Date(NaN);if(O.u(R))return new Date;if(R instanceof Date)return new Date(R);if(typeof R=="string"&&!/Z$/i.test(R)){var $=R.match(y);if($){var X=$[2]-1||0,C=($[7]||"0").substring(0,3);return k?new Date(Date.UTC($[1],X,$[3]||1,$[4]||0,$[5]||0,$[6]||0,C)):new Date($[1],X,$[3]||1,$[4]||0,$[5]||0,$[6]||0,C)}}return new Date(R)}(K),this.init()},z.init=function(){var K=this.$d;this.$y=K.getFullYear(),this.$M=K.getMonth(),this.$D=K.getDate(),this.$W=K.getDay(),this.$H=K.getHours(),this.$m=K.getMinutes(),this.$s=K.getSeconds(),this.$ms=K.getMilliseconds()},z.$utils=function(){return O},z.isValid=function(){return this.$d.toString()!==m},z.isSame=function(K,J){var R=U(K);return this.startOf(J)<=R&&R<=this.endOf(J)},z.isAfter=function(K,J){return U(K)<this.startOf(J)},z.isBefore=function(K,J){return this.endOf(J)<U(K)},z.$g=function(K,J,R){return O.u(K)?this[J]:this.set(R,K)},z.unix=function(){return Math.floor(this.valueOf()/1e3)},z.valueOf=function(){return this.$d.getTime()},z.startOf=function(K,J){var R=this,k=!!O.u(J)||J,$=O.p(K),X=function(ae,pe){var ge=O.w(R.$u?Date.UTC(R.$y,pe,ae):new Date(R.$y,pe,ae),R);return k?ge:ge.endOf(u)},C=function(ae,pe){return O.w(R.toDate()[ae].apply(R.toDate("s"),(k?[0,0,0,0]:[23,59,59,999]).slice(pe)),R)},N=this.$W,H=this.$M,W=this.$D,ne="set"+(this.$u?"UTC":"");switch($){case p:return k?X(1,0):X(31,11);case f:return k?X(1,H):X(0,H+1);case d:var se=this.$locale().weekStart||0,oe=(N<se?N+7:N)-se;return X(k?W-oe:W+(6-oe),H);case u:case v:return C(ne+"Hours",0);case c:return C(ne+"Minutes",1);case l:return C(ne+"Seconds",2);case s:return C(ne+"Milliseconds",3);default:return this.clone()}},z.endOf=function(K){return this.startOf(K,!1)},z.$set=function(K,J){var R,k=O.p(K),$="set"+(this.$u?"UTC":""),X=(R={},R[u]=$+"Date",R[v]=$+"Date",R[f]=$+"Month",R[p]=$+"FullYear",R[c]=$+"Hours",R[l]=$+"Minutes",R[s]=$+"Seconds",R[o]=$+"Milliseconds",R)[k],C=k===u?this.$D+(J-this.$W):J;if(k===f||k===p){var N=this.clone().set(v,1);N.$d[X](C),N.init(),this.$d=N.set(v,Math.min(this.$D,N.daysInMonth())).$d}else X&&this.$d[X](C);return this.init(),this},z.set=function(K,J){return this.clone().$set(K,J)},z.get=function(K){return this[O.p(K)]()},z.add=function(K,J){var R,k=this;K=Number(K);var $=O.p(J),X=function(H){var W=U(k);return O.w(W.date(W.date()+Math.round(H*K)),k)};if($===f)return this.set(f,this.$M+K);if($===p)return this.set(p,this.$y+K);if($===u)return X(1);if($===d)return X(7);var C=(R={},R[l]=n,R[c]=a,R[s]=r,R)[$]||1,N=this.$d.getTime()+K*C;return O.w(N,this)},z.subtract=function(K,J){return this.add(-1*K,J)},z.format=function(K){var J=this,R=this.$locale();if(!this.isValid())return R.invalidDate||m;var k=K||"YYYY-MM-DDTHH:mm:ssZ",$=O.z(this),X=this.$H,C=this.$m,N=this.$M,H=R.weekdays,W=R.months,ne=R.meridiem,se=function(pe,ge,Q,G){return pe&&(pe[ge]||pe(J,k))||Q[ge].slice(0,G)},oe=function(pe){return O.s(X%12||12,pe,"0")},ae=ne||function(pe,ge,Q){var G=pe<12?"AM":"PM";return Q?G.toLowerCase():G};return k.replace(b,function(pe,ge){return ge||function(Q){switch(Q){case"YY":return String(J.$y).slice(-2);case"YYYY":return O.s(J.$y,4,"0");case"M":return N+1;case"MM":return O.s(N+1,2,"0");case"MMM":return se(R.monthsShort,N,W,3);case"MMMM":return se(W,N);case"D":return J.$D;case"DD":return O.s(J.$D,2,"0");case"d":return String(J.$W);case"dd":return se(R.weekdaysMin,J.$W,H,2);case"ddd":return se(R.weekdaysShort,J.$W,H,3);case"dddd":return H[J.$W];case"H":return String(X);case"HH":return O.s(X,2,"0");case"h":return oe(1);case"hh":return oe(2);case"a":return ae(X,C,!0);case"A":return ae(X,C,!1);case"m":return String(C);case"mm":return O.s(C,2,"0");case"s":return String(J.$s);case"ss":return O.s(J.$s,2,"0");case"SSS":return O.s(J.$ms,3,"0");case"Z":return $}return null}(pe)||$.replace(":","")})},z.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},z.diff=function(K,J,R){var k,$=this,X=O.p(J),C=U(K),N=(C.utcOffset()-this.utcOffset())*n,H=this-C,W=function(){return O.m($,C)};switch(X){case p:k=W()/12;break;case f:k=W();break;case h:k=W()/3;break;case d:k=(H-N)/6048e5;break;case u:k=(H-N)/864e5;break;case c:k=H/a;break;case l:k=H/n;break;case s:k=H/r;break;default:k=H}return R?k:O.a(k)},z.daysInMonth=function(){return this.endOf(f).$D},z.$locale=function(){return E[this.$L]},z.locale=function(K,J){if(!K)return this.$L;var R=this.clone(),k=I(K,J,!0);return k&&(R.$L=k),R},z.clone=function(){return O.w(this.$d,this)},z.toDate=function(){return new Date(this.valueOf())},z.toJSON=function(){return this.isValid()?this.toISOString():null},z.toISOString=function(){return this.$d.toISOString()},z.toString=function(){return this.$d.toUTCString()},q}(),L=M.prototype;return U.prototype=L,[["$ms",o],["$s",s],["$m",l],["$H",c],["$W",u],["$M",f],["$y",p],["$D",v]].forEach(function(q){L[q[1]]=function(z){return this.$g(z,q[0],q[1])}}),U.extend=function(q,z){return q.$i||(q(z,M,U),q.$i=!0),U},U.locale=I,U.isDayjs=S,U.unix=function(q){return U(1e3*q)},U.en=E[P],U.Ls=E,U.p={},U})}(Wm)),Wm.exports}var I7=T7();const Rt=Et(I7);var Hm={exports:{}},N7=Hm.exports,I5;function D7(){return I5||(I5=1,function(e,t){(function(r,n){e.exports=n()})(N7,function(){var r="week",n="year";return function(a,o,s){var l=o.prototype;l.week=function(c){if(c===void 0&&(c=null),c!==null)return this.add(7*(c-this.week()),"day");var u=this.$locale().yearStart||1;if(this.month()===11&&this.date()>25){var d=s(this).startOf(n).add(1,n).date(u),f=s(this).endOf(r);if(d.isBefore(f))return 1}var h=s(this).startOf(n).date(u).startOf(r).subtract(1,"millisecond"),p=this.diff(h,r,!0);return p<0?s(this).startOf("week").week():Math.ceil(p)},l.weeks=function(c){return c===void 0&&(c=null),this.week(c)}}})}(Hm)),Hm.exports}var M7=D7();const L7=Et(M7);var Vm={exports:{}},R7=Vm.exports,N5;function q7(){return N5||(N5=1,function(e,t){(function(r,n){e.exports=n()})(R7,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},n=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,a=/\d/,o=/\d\d/,s=/\d\d?/,l=/\d*[^-_:/,()\s\d]+/,c={},u=function(y){return(y=+y)+(y>68?1900:2e3)},d=function(y){return function(b){this[y]=+b}},f=[/[+-]\d\d:?(\d\d)?|Z/,function(y){(this.zone||(this.zone={})).offset=function(b){if(!b||b==="Z")return 0;var _=b.match(/([+-]|\d\d)/g),w=60*_[1]+(+_[2]||0);return w===0?0:_[0]==="+"?-w:w}(y)}],h=function(y){var b=c[y];return b&&(b.indexOf?b:b.s.concat(b.f))},p=function(y,b){var _,w=c.meridiem;if(w){for(var A=1;A<=24;A+=1)if(y.indexOf(w(A,0,b))>-1){_=A>12;break}}else _=y===(b?"pm":"PM");return _},v={A:[l,function(y){this.afternoon=p(y,!1)}],a:[l,function(y){this.afternoon=p(y,!0)}],Q:[a,function(y){this.month=3*(y-1)+1}],S:[a,function(y){this.milliseconds=100*+y}],SS:[o,function(y){this.milliseconds=10*+y}],SSS:[/\d{3}/,function(y){this.milliseconds=+y}],s:[s,d("seconds")],ss:[s,d("seconds")],m:[s,d("minutes")],mm:[s,d("minutes")],H:[s,d("hours")],h:[s,d("hours")],HH:[s,d("hours")],hh:[s,d("hours")],D:[s,d("day")],DD:[o,d("day")],Do:[l,function(y){var b=c.ordinal,_=y.match(/\d+/);if(this.day=_[0],b)for(var w=1;w<=31;w+=1)b(w).replace(/\[|\]/g,"")===y&&(this.day=w)}],w:[s,d("week")],ww:[o,d("week")],M:[s,d("month")],MM:[o,d("month")],MMM:[l,function(y){var b=h("months"),_=(h("monthsShort")||b.map(function(w){return w.slice(0,3)})).indexOf(y)+1;if(_<1)throw new Error;this.month=_%12||_}],MMMM:[l,function(y){var b=h("months").indexOf(y)+1;if(b<1)throw new Error;this.month=b%12||b}],Y:[/[+-]?\d+/,d("year")],YY:[o,function(y){this.year=u(y)}],YYYY:[/\d{4}/,d("year")],Z:f,ZZ:f};function m(y){var b,_;b=y,_=c&&c.formats;for(var w=(y=b.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(U,O,M){var L=M&&M.toUpperCase();return O||_[M]||r[M]||_[L].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(q,z,K){return z||K.slice(1)})})).match(n),A=w.length,P=0;P<A;P+=1){var E=w[P],T=v[E],S=T&&T[0],I=T&&T[1];w[P]=I?{regex:S,parser:I}:E.replace(/^\[|\]$/g,"")}return function(U){for(var O={},M=0,L=0;M<A;M+=1){var q=w[M];if(typeof q=="string")L+=q.length;else{var z=q.regex,K=q.parser,J=U.slice(L),R=z.exec(J)[0];K.call(O,R),U=U.replace(R,"")}}return function(k){var $=k.afternoon;if($!==void 0){var X=k.hours;$?X<12&&(k.hours+=12):X===12&&(k.hours=0),delete k.afternoon}}(O),O}}return function(y,b,_){_.p.customParseFormat=!0,y&&y.parseTwoDigitYear&&(u=y.parseTwoDigitYear);var w=b.prototype,A=w.parse;w.parse=function(P){var E=P.date,T=P.utc,S=P.args;this.$u=T;var I=S[1];if(typeof I=="string"){var U=S[2]===!0,O=S[3]===!0,M=U||O,L=S[2];O&&(L=S[2]),c=this.$locale(),!U&&L&&(c=_.Ls[L]),this.$d=function(J,R,k,$){try{if(["x","X"].indexOf(R)>-1)return new Date((R==="X"?1e3:1)*J);var X=m(R)(J),C=X.year,N=X.month,H=X.day,W=X.hours,ne=X.minutes,se=X.seconds,oe=X.milliseconds,ae=X.zone,pe=X.week,ge=new Date,Q=H||(C||N?1:ge.getDate()),G=C||ge.getFullYear(),ee=0;C&&!N||(ee=N>0?N-1:ge.getMonth());var le,V=W||0,Ve=ne||0,Me=se||0,Fe=oe||0;return ae?new Date(Date.UTC(G,ee,Q,V,Ve,Me,Fe+60*ae.offset*1e3)):k?new Date(Date.UTC(G,ee,Q,V,Ve,Me,Fe)):(le=new Date(G,ee,Q,V,Ve,Me,Fe),pe&&(le=$(le).week(pe).toDate()),le)}catch{return new Date("")}}(E,I,T,_),this.init(),L&&L!==!0&&(this.$L=this.locale(L).$L),M&&E!=this.format(I)&&(this.$d=new Date("")),c={}}else if(I instanceof Array)for(var q=I.length,z=1;z<=q;z+=1){S[1]=I[z-1];var K=_.apply(this,S);if(K.isValid()){this.$d=K.$d,this.$L=K.$L,this.init();break}z===q&&(this.$d=new Date(""))}else A.call(this,P)}}})}(Vm)),Vm.exports}var F7=q7();const $7=Et(F7);var Gm={exports:{}},B7=Gm.exports,D5;function U7(){return D5||(D5=1,function(e,t){(function(r,n){e.exports=n()})(B7,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(n,a,o){var s=a.prototype,l=s.format;o.en.formats=r,s.format=function(c){c===void 0&&(c="YYYY-MM-DDTHH:mm:ssZ");var u=this.$locale().formats,d=function(f,h){return f.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(p,v,m){var y=m&&m.toUpperCase();return v||h[m]||r[m]||h[y].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(b,_,w){return _||w.slice(1)})})}(c,u===void 0?{}:u);return l.call(this,d)}}})}(Gm)),Gm.exports}var z7=U7();const W7=Et(z7);var Ym={exports:{}},H7=Ym.exports,M5;function V7(){return M5||(M5=1,function(e,t){(function(r,n){e.exports=n()})(H7,function(){return function(r,n,a){n.prototype.isBetween=function(o,s,l,c){var u=a(o),d=a(s),f=(c=c||"()")[0]==="(",h=c[1]===")";return(f?this.isAfter(u,l):!this.isBefore(u,l))&&(h?this.isBefore(d,l):!this.isAfter(d,l))||(f?this.isBefore(u,l):!this.isAfter(u,l))&&(h?this.isAfter(d,l):!this.isBefore(d,l))}}})}(Ym)),Ym.exports}var G7=V7();const Y7=Et(G7);Rt.extend($7);Rt.extend(W7);Rt.extend(Y7);const K7=a8(["Your locale has not been found.","Either the locale key is not a supported one. Locales supported by dayjs are available here: https://github.com/iamkun/dayjs/tree/dev/src/locale","Or you forget to import the locale from 'dayjs/locale/{localeUsed}'","fallback on English locale"]),Q7={YY:"year",YYYY:{sectionType:"year",contentType:"digit",maxLength:4},M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMM:{sectionType:"month",contentType:"letter"},MMMM:{sectionType:"month",contentType:"letter"},D:{sectionType:"day",contentType:"digit",maxLength:2},DD:"day",Do:{sectionType:"day",contentType:"digit-with-letter"},d:{sectionType:"weekDay",contentType:"digit",maxLength:2},dd:{sectionType:"weekDay",contentType:"letter"},ddd:{sectionType:"weekDay",contentType:"letter"},dddd:{sectionType:"weekDay",contentType:"letter"},A:"meridiem",a:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},X7={year:"YYYY",month:"MMMM",monthShort:"MMM",dayOfMonth:"D",weekday:"dddd",weekdayShort:"dd",hours24h:"HH",hours12h:"hh",meridiem:"A",minutes:"mm",seconds:"ss",fullDate:"ll",fullDateWithWeekday:"dddd, LL",keyboardDate:"L",shortDate:"MMM D",normalDate:"D MMMM",normalDateWithWeekday:"ddd, MMM D",monthAndYear:"MMMM YYYY",monthAndDate:"MMMM D",fullTime:"LT",fullTime12h:"hh:mm A",fullTime24h:"HH:mm",fullDateTime:"lll",fullDateTime12h:"ll hh:mm A",fullDateTime24h:"ll HH:mm",keyboardDateTime:"L LT",keyboardDateTime12h:"L hh:mm A",keyboardDateTime24h:"L HH:mm"},ux=["Missing UTC plugin","To be able to use UTC or timezones, you have to enable the `utc` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-utc"].join(`
`),L5=["Missing timezone plugin","To be able to use timezones, you have to enable both the `utc` and the `timezone` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-timezone"].join(`
`),J7=(e,t)=>t?(...r)=>e(...r).locale(t):e;class oc{constructor({locale:t,formats:r,instance:n}={}){var a;this.isMUIAdapter=!0,this.isTimezoneCompatible=!0,this.lib="dayjs",this.rawDayJsInstance=void 0,this.dayjs=void 0,this.locale=void 0,this.formats=void 0,this.escapedCharacters={start:"[",end:"]"},this.formatTokenMap=Q7,this.setLocaleToValue=o=>{const s=this.getCurrentLocaleCode();return s===o.locale()?o:o.locale(s)},this.hasUTCPlugin=()=>typeof Rt.utc<"u",this.hasTimezonePlugin=()=>typeof Rt.tz<"u",this.isSame=(o,s,l)=>{const c=this.setTimezone(s,this.getTimezone(o));return o.format(l)===c.format(l)},this.cleanTimezone=o=>{switch(o){case"default":return;case"system":return Rt.tz.guess();default:return o}},this.createSystemDate=o=>{if(this.rawDayJsInstance)return this.rawDayJsInstance(o);if(this.hasUTCPlugin()&&this.hasTimezonePlugin()){const s=Rt.tz.guess();return s!=="UTC"?Rt.tz(o,s):Rt(o)}return Rt(o)},this.createUTCDate=o=>{if(!this.hasUTCPlugin())throw new Error(ux);return Rt.utc(o)},this.createTZDate=(o,s)=>{if(!this.hasUTCPlugin())throw new Error(ux);if(!this.hasTimezonePlugin())throw new Error(L5);const l=o!==void 0&&!o.endsWith("Z");return Rt(o).tz(this.cleanTimezone(s),l)},this.getLocaleFormats=()=>{const o=Rt.Ls,s=this.locale||"en";let l=o[s];return l===void 0&&(K7(),l=o.en),l.formats},this.adjustOffset=o=>{if(!this.hasTimezonePlugin())return o;const s=this.getTimezone(o);if(s!=="UTC"){var l,c;const u=o.tz(this.cleanTimezone(s),!0);if(((l=u.$offset)!=null?l:0)===((c=o.$offset)!=null?c:0))return o;o.$offset=u.$offset}return o},this.date=o=>o===null?null:this.dayjs(o),this.dateWithTimezone=(o,s)=>{if(o===null)return null;let l;return s==="UTC"?l=this.createUTCDate(o):s==="system"||s==="default"&&!this.hasTimezonePlugin()?l=this.createSystemDate(o):l=this.createTZDate(o,s),this.locale===void 0?l:l.locale(this.locale)},this.getTimezone=o=>{if(this.hasTimezonePlugin()){var s;const l=(s=o.$x)==null?void 0:s.$timezone;if(l)return l}return this.hasUTCPlugin()&&o.isUTC()?"UTC":"system"},this.setTimezone=(o,s)=>{if(this.getTimezone(o)===s)return o;if(s==="UTC"){if(!this.hasUTCPlugin())throw new Error(ux);return o.utc()}if(s==="system")return o.local();if(!this.hasTimezonePlugin()){if(s==="default")return o;throw new Error(L5)}return Rt.tz(o,this.cleanTimezone(s))},this.toJsDate=o=>o.toDate(),this.parseISO=o=>this.dayjs(o),this.toISO=o=>o.toISOString(),this.parse=(o,s)=>o===""?null:this.dayjs(o,s,this.locale,!0),this.getCurrentLocaleCode=()=>this.locale||"en",this.is12HourCycleInCurrentLocale=()=>/A|a/.test(this.getLocaleFormats().LT||""),this.expandFormat=o=>{const s=this.getLocaleFormats(),l=c=>c.replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(u,d,f)=>d||f.slice(1));return o.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(c,u,d)=>{const f=d&&d.toUpperCase();return u||s[d]||l(s[f])})},this.getFormatHelperText=o=>this.expandFormat(o).replace(/a/gi,"(a|p)m").toLocaleLowerCase(),this.isNull=o=>o===null,this.isValid=o=>this.dayjs(o).isValid(),this.format=(o,s)=>this.formatByString(o,this.formats[s]),this.formatByString=(o,s)=>this.dayjs(o).format(s),this.formatNumber=o=>o,this.getDiff=(o,s,l)=>o.diff(s,l),this.isEqual=(o,s)=>o===null&&s===null?!0:this.dayjs(o).toDate().getTime()===this.dayjs(s).toDate().getTime(),this.isSameYear=(o,s)=>this.isSame(o,s,"YYYY"),this.isSameMonth=(o,s)=>this.isSame(o,s,"YYYY-MM"),this.isSameDay=(o,s)=>this.isSame(o,s,"YYYY-MM-DD"),this.isSameHour=(o,s)=>o.isSame(s,"hour"),this.isAfter=(o,s)=>o>s,this.isAfterYear=(o,s)=>this.hasUTCPlugin()?!this.isSameYear(o,s)&&o.utc()>s.utc():o.isAfter(s,"year"),this.isAfterDay=(o,s)=>this.hasUTCPlugin()?!this.isSameDay(o,s)&&o.utc()>s.utc():o.isAfter(s,"day"),this.isBefore=(o,s)=>o<s,this.isBeforeYear=(o,s)=>this.hasUTCPlugin()?!this.isSameYear(o,s)&&o.utc()<s.utc():o.isBefore(s,"year"),this.isBeforeDay=(o,s)=>this.hasUTCPlugin()?!this.isSameDay(o,s)&&o.utc()<s.utc():o.isBefore(s,"day"),this.isWithinRange=(o,[s,l])=>o>=s&&o<=l,this.startOfYear=o=>this.adjustOffset(o.startOf("year")),this.startOfMonth=o=>this.adjustOffset(o.startOf("month")),this.startOfWeek=o=>this.adjustOffset(o.startOf("week")),this.startOfDay=o=>this.adjustOffset(o.startOf("day")),this.endOfYear=o=>this.adjustOffset(o.endOf("year")),this.endOfMonth=o=>this.adjustOffset(o.endOf("month")),this.endOfWeek=o=>this.adjustOffset(o.endOf("week")),this.endOfDay=o=>this.adjustOffset(o.endOf("day")),this.addYears=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"year"):o.add(s,"year")),this.addMonths=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"month"):o.add(s,"month")),this.addWeeks=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"week"):o.add(s,"week")),this.addDays=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"day"):o.add(s,"day")),this.addHours=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"hour"):o.add(s,"hour")),this.addMinutes=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"minute"):o.add(s,"minute")),this.addSeconds=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"second"):o.add(s,"second")),this.getYear=o=>o.year(),this.getMonth=o=>o.month(),this.getDate=o=>o.date(),this.getHours=o=>o.hour(),this.getMinutes=o=>o.minute(),this.getSeconds=o=>o.second(),this.getMilliseconds=o=>o.millisecond(),this.setYear=(o,s)=>this.adjustOffset(o.set("year",s)),this.setMonth=(o,s)=>this.adjustOffset(o.set("month",s)),this.setDate=(o,s)=>this.adjustOffset(o.set("date",s)),this.setHours=(o,s)=>this.adjustOffset(o.set("hour",s)),this.setMinutes=(o,s)=>this.adjustOffset(o.set("minute",s)),this.setSeconds=(o,s)=>this.adjustOffset(o.set("second",s)),this.setMilliseconds=(o,s)=>this.adjustOffset(o.set("millisecond",s)),this.getDaysInMonth=o=>o.daysInMonth(),this.getNextMonth=o=>this.addMonths(o,1),this.getPreviousMonth=o=>this.addMonths(o,-1),this.getMonthArray=o=>{const l=[o.startOf("year")];for(;l.length<12;){const c=l[l.length-1];l.push(this.addMonths(c,1))}return l},this.mergeDateAndTime=(o,s)=>o.hour(s.hour()).minute(s.minute()).second(s.second()),this.getWeekdays=()=>{const o=this.dayjs().startOf("week");return[0,1,2,3,4,5,6].map(s=>this.formatByString(this.addDays(o,s),"dd"))},this.getWeekArray=o=>{const s=this.setLocaleToValue(o),l=s.startOf("month").startOf("week"),c=s.endOf("month").endOf("week");let u=0,d=l;const f=[];for(;d<c;){const h=Math.floor(u/7);f[h]=f[h]||[],f[h].push(d),d=this.addDays(d,1),u+=1}return f},this.getWeekNumber=o=>o.week(),this.getYearRange=(o,s)=>{const l=o.startOf("year"),c=s.endOf("year"),u=[];let d=l;for(;d<c;)u.push(d),d=this.addYears(d,1);return u},this.getMeridiemText=o=>o==="am"?"AM":"PM",this.rawDayJsInstance=n,this.dayjs=J7((a=this.rawDayJsInstance)!=null?a:Rt,t),this.locale=t,this.formats=mI({},X7,r),Rt.extend(L7)}}const Sh=async()=>{try{const e=await window?.api?.timeEvents?.pendingCount?.();return e?.success?e.count:0}catch{return 0}},Z7=async(e=200)=>{const t=await window?.api?.timeEvents?.listPending?.(e);return t?.success?t.rows:[]},R5=async()=>{const e=await Z7(200);let t=0,r=0;const n=[];for(const a of e)try{const o=JSON.parse(a.payload_json||"{}");switch(a.type){case"attendance_clock_in":await ve.post("/api/attendance/clock-in",{profile_id:o.profile_id,latitude:o.latitude,longitude:o.longitude});break;case"attendance_clock_out":await ve.post("/api/attendance/clock-out",{shift_id:o.shift_id});break;case"attendance_update":await ve.put(`/api/attendance/${o.shift_id}`,{clock_in:o.clock_in,clock_out:o.clock_out});break;case"time_clock_in":await ve.post("/api/time-tracking/time-entries/clock-in",{profile_id:o.profile_id,so_id:o.so_id});break;case"time_clock_out":await ve.post(`/api/time-tracking/time-entries/${o.id}/clock-out`);break;default:r++;continue}n.push(a.event_id),t++}catch{r++}return n.length&&await window?.api?.timeEvents?.markSynced?.(n),{synced:t,failed:r}};var nf={},dx={};const e$=$8(i8);var q5;function sr(){return q5||(q5=1,function(e){"use client";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=e$}(dx)),dx}var F5;function t$(){if(F5)return nf;F5=1;var e=ir();Object.defineProperty(nf,"__esModule",{value:!0}),nf.default=void 0;var t=e(sr()),r=or();return nf.default=(0,t.default)((0,r.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 9h12v2H6zm8 5H6v-2h8zm4-6H6V6h12z"}),"Chat"),nf}var r$=t$();const n$=Et(r$);var af={},$5;function a$(){if($5)return af;$5=1;var e=ir();Object.defineProperty(af,"__esModule",{value:!0}),af.default=void 0;var t=e(sr()),r=or();return af.default=(0,t.default)((0,r.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),af}var i$=a$();const aj=Et(i$);var of={},B5;function o$(){if(B5)return of;B5=1;var e=ir();Object.defineProperty(of,"__esModule",{value:!0}),of.default=void 0;var t=e(sr()),r=or();return of.default=(0,t.default)((0,r.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),of}var s$=o$();const gN=Et(s$);var sf={},U5;function l$(){if(U5)return sf;U5=1;var e=ir();Object.defineProperty(sf,"__esModule",{value:!0}),sf.default=void 0;var t=e(sr()),r=or();return sf.default=(0,t.default)((0,r.jsx)("path",{d:"M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3M7.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S9.83 13 9 13s-1.5-.67-1.5-1.5M16 17H8v-2h8zm-1-4c-.83 0-1.5-.67-1.5-1.5S14.17 10 15 10s1.5.67 1.5 1.5S15.83 13 15 13"}),"SmartToy"),sf}var c$=l$();const u$=Et(c$);var lf={},z5;function d$(){if(z5)return lf;z5=1;var e=ir();Object.defineProperty(lf,"__esModule",{value:!0}),lf.default=void 0;var t=e(sr()),r=or();return lf.default=(0,t.default)((0,r.jsx)("path",{d:"M9 17H7v-7h2zm4 0h-2V7h2zm4 0h-2v-4h2zm2.5 2.1h-15V5h15zm0-16.1h-15c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"}),"InsertChartOutlined"),lf}var f$=d$();const h$=Et(f$);var cf={},W5;function p$(){if(W5)return cf;W5=1;var e=ir();Object.defineProperty(cf,"__esModule",{value:!0}),cf.default=void 0;var t=e(sr()),r=or();return cf.default=(0,t.default)((0,r.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7zm-8 2V5h2v6h1.17L12 13.17 9.83 11zm-6 7h14v2H5z"}),"DownloadOutlined"),cf}var m$=p$();const g$=Et(m$);async function v$(e,t){return(await ve.post("/api/assistant",{prompt:e,mode:t})).data}var fx,H5;function eo(){if(H5)return fx;H5=1;var e=Array.isArray;return fx=e,fx}var hx,V5;function vN(){if(V5)return hx;V5=1;var e=typeof hm=="object"&&hm&&hm.Object===Object&&hm;return hx=e,hx}var px,G5;function Ls(){if(G5)return px;G5=1;var e=vN(),t=typeof self=="object"&&self&&self.Object===Object&&self,r=e||t||Function("return this")();return px=r,px}var mx,Y5;function Dp(){if(Y5)return mx;Y5=1;var e=Ls(),t=e.Symbol;return mx=t,mx}var gx,K5;function y$(){if(K5)return gx;K5=1;var e=Dp(),t=Object.prototype,r=t.hasOwnProperty,n=t.toString,a=e?e.toStringTag:void 0;function o(s){var l=r.call(s,a),c=s[a];try{s[a]=void 0;var u=!0}catch{}var d=n.call(s);return u&&(l?s[a]=c:delete s[a]),d}return gx=o,gx}var vx,Q5;function x$(){if(Q5)return vx;Q5=1;var e=Object.prototype,t=e.toString;function r(n){return t.call(n)}return vx=r,vx}var yx,X5;function bl(){if(X5)return yx;X5=1;var e=Dp(),t=y$(),r=x$(),n="[object Null]",a="[object Undefined]",o=e?e.toStringTag:void 0;function s(l){return l==null?l===void 0?a:n:o&&o in Object(l)?t(l):r(l)}return yx=s,yx}var xx,J5;function _l(){if(J5)return xx;J5=1;function e(t){return t!=null&&typeof t=="object"}return xx=e,xx}var bx,Z5;function Ld(){if(Z5)return bx;Z5=1;var e=bl(),t=_l(),r="[object Symbol]";function n(a){return typeof a=="symbol"||t(a)&&e(a)==r}return bx=n,bx}var _x,eC;function ij(){if(eC)return _x;eC=1;var e=eo(),t=Ld(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function a(o,s){if(e(o))return!1;var l=typeof o;return l=="number"||l=="symbol"||l=="boolean"||o==null||t(o)?!0:n.test(o)||!r.test(o)||s!=null&&o in Object(s)}return _x=a,_x}var wx,tC;function sc(){if(tC)return wx;tC=1;function e(t){var r=typeof t;return t!=null&&(r=="object"||r=="function")}return wx=e,wx}var jx,rC;function oj(){if(rC)return jx;rC=1;var e=bl(),t=sc(),r="[object AsyncFunction]",n="[object Function]",a="[object GeneratorFunction]",o="[object Proxy]";function s(l){if(!t(l))return!1;var c=e(l);return c==n||c==a||c==r||c==o}return jx=s,jx}var Sx,nC;function b$(){if(nC)return Sx;nC=1;var e=Ls(),t=e["__core-js_shared__"];return Sx=t,Sx}var Cx,aC;function _$(){if(aC)return Cx;aC=1;var e=b$(),t=function(){var n=/[^.]+$/.exec(e&&e.keys&&e.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function r(n){return!!t&&t in n}return Cx=r,Cx}var Ax,iC;function yN(){if(iC)return Ax;iC=1;var e=Function.prototype,t=e.toString;function r(n){if(n!=null){try{return t.call(n)}catch{}try{return n+""}catch{}}return""}return Ax=r,Ax}var Px,oC;function w$(){if(oC)return Px;oC=1;var e=oj(),t=_$(),r=sc(),n=yN(),a=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,s=Function.prototype,l=Object.prototype,c=s.toString,u=l.hasOwnProperty,d=RegExp("^"+c.call(u).replace(a,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function f(h){if(!r(h)||t(h))return!1;var p=e(h)?d:o;return p.test(n(h))}return Px=f,Px}var Ox,sC;function j$(){if(sC)return Ox;sC=1;function e(t,r){return t?.[r]}return Ox=e,Ox}var kx,lC;function au(){if(lC)return kx;lC=1;var e=w$(),t=j$();function r(n,a){var o=t(n,a);return e(o)?o:void 0}return kx=r,kx}var Ex,cC;function Bv(){if(cC)return Ex;cC=1;var e=au(),t=e(Object,"create");return Ex=t,Ex}var Tx,uC;function S$(){if(uC)return Tx;uC=1;var e=Bv();function t(){this.__data__=e?e(null):{},this.size=0}return Tx=t,Tx}var Ix,dC;function C$(){if(dC)return Ix;dC=1;function e(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r}return Ix=e,Ix}var Nx,fC;function A$(){if(fC)return Nx;fC=1;var e=Bv(),t="__lodash_hash_undefined__",r=Object.prototype,n=r.hasOwnProperty;function a(o){var s=this.__data__;if(e){var l=s[o];return l===t?void 0:l}return n.call(s,o)?s[o]:void 0}return Nx=a,Nx}var Dx,hC;function P$(){if(hC)return Dx;hC=1;var e=Bv(),t=Object.prototype,r=t.hasOwnProperty;function n(a){var o=this.__data__;return e?o[a]!==void 0:r.call(o,a)}return Dx=n,Dx}var Mx,pC;function O$(){if(pC)return Mx;pC=1;var e=Bv(),t="__lodash_hash_undefined__";function r(n,a){var o=this.__data__;return this.size+=this.has(n)?0:1,o[n]=e&&a===void 0?t:a,this}return Mx=r,Mx}var Lx,mC;function k$(){if(mC)return Lx;mC=1;var e=S$(),t=C$(),r=A$(),n=P$(),a=O$();function o(s){var l=-1,c=s==null?0:s.length;for(this.clear();++l<c;){var u=s[l];this.set(u[0],u[1])}}return o.prototype.clear=e,o.prototype.delete=t,o.prototype.get=r,o.prototype.has=n,o.prototype.set=a,Lx=o,Lx}var Rx,gC;function E$(){if(gC)return Rx;gC=1;function e(){this.__data__=[],this.size=0}return Rx=e,Rx}var qx,vC;function sj(){if(vC)return qx;vC=1;function e(t,r){return t===r||t!==t&&r!==r}return qx=e,qx}var Fx,yC;function Uv(){if(yC)return Fx;yC=1;var e=sj();function t(r,n){for(var a=r.length;a--;)if(e(r[a][0],n))return a;return-1}return Fx=t,Fx}var $x,xC;function T$(){if(xC)return $x;xC=1;var e=Uv(),t=Array.prototype,r=t.splice;function n(a){var o=this.__data__,s=e(o,a);if(s<0)return!1;var l=o.length-1;return s==l?o.pop():r.call(o,s,1),--this.size,!0}return $x=n,$x}var Bx,bC;function I$(){if(bC)return Bx;bC=1;var e=Uv();function t(r){var n=this.__data__,a=e(n,r);return a<0?void 0:n[a][1]}return Bx=t,Bx}var Ux,_C;function N$(){if(_C)return Ux;_C=1;var e=Uv();function t(r){return e(this.__data__,r)>-1}return Ux=t,Ux}var zx,wC;function D$(){if(wC)return zx;wC=1;var e=Uv();function t(r,n){var a=this.__data__,o=e(a,r);return o<0?(++this.size,a.push([r,n])):a[o][1]=n,this}return zx=t,zx}var Wx,jC;function zv(){if(jC)return Wx;jC=1;var e=E$(),t=T$(),r=I$(),n=N$(),a=D$();function o(s){var l=-1,c=s==null?0:s.length;for(this.clear();++l<c;){var u=s[l];this.set(u[0],u[1])}}return o.prototype.clear=e,o.prototype.delete=t,o.prototype.get=r,o.prototype.has=n,o.prototype.set=a,Wx=o,Wx}var Hx,SC;function lj(){if(SC)return Hx;SC=1;var e=au(),t=Ls(),r=e(t,"Map");return Hx=r,Hx}var Vx,CC;function M$(){if(CC)return Vx;CC=1;var e=k$(),t=zv(),r=lj();function n(){this.size=0,this.__data__={hash:new e,map:new(r||t),string:new e}}return Vx=n,Vx}var Gx,AC;function L$(){if(AC)return Gx;AC=1;function e(t){var r=typeof t;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?t!=="__proto__":t===null}return Gx=e,Gx}var Yx,PC;function Wv(){if(PC)return Yx;PC=1;var e=L$();function t(r,n){var a=r.__data__;return e(n)?a[typeof n=="string"?"string":"hash"]:a.map}return Yx=t,Yx}var Kx,OC;function R$(){if(OC)return Kx;OC=1;var e=Wv();function t(r){var n=e(this,r).delete(r);return this.size-=n?1:0,n}return Kx=t,Kx}var Qx,kC;function q$(){if(kC)return Qx;kC=1;var e=Wv();function t(r){return e(this,r).get(r)}return Qx=t,Qx}var Xx,EC;function F$(){if(EC)return Xx;EC=1;var e=Wv();function t(r){return e(this,r).has(r)}return Xx=t,Xx}var Jx,TC;function $$(){if(TC)return Jx;TC=1;var e=Wv();function t(r,n){var a=e(this,r),o=a.size;return a.set(r,n),this.size+=a.size==o?0:1,this}return Jx=t,Jx}var Zx,IC;function cj(){if(IC)return Zx;IC=1;var e=M$(),t=R$(),r=q$(),n=F$(),a=$$();function o(s){var l=-1,c=s==null?0:s.length;for(this.clear();++l<c;){var u=s[l];this.set(u[0],u[1])}}return o.prototype.clear=e,o.prototype.delete=t,o.prototype.get=r,o.prototype.has=n,o.prototype.set=a,Zx=o,Zx}var eb,NC;function xN(){if(NC)return eb;NC=1;var e=cj(),t="Expected a function";function r(n,a){if(typeof n!="function"||a!=null&&typeof a!="function")throw new TypeError(t);var o=function(){var s=arguments,l=a?a.apply(this,s):s[0],c=o.cache;if(c.has(l))return c.get(l);var u=n.apply(this,s);return o.cache=c.set(l,u)||c,u};return o.cache=new(r.Cache||e),o}return r.Cache=e,eb=r,eb}var tb,DC;function B$(){if(DC)return tb;DC=1;var e=xN(),t=500;function r(n){var a=e(n,function(s){return o.size===t&&o.clear(),s}),o=a.cache;return a}return tb=r,tb}var rb,MC;function U$(){if(MC)return rb;MC=1;var e=B$(),t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,n=e(function(a){var o=[];return a.charCodeAt(0)===46&&o.push(""),a.replace(t,function(s,l,c,u){o.push(c?u.replace(r,"$1"):l||s)}),o});return rb=n,rb}var nb,LC;function uj(){if(LC)return nb;LC=1;function e(t,r){for(var n=-1,a=t==null?0:t.length,o=Array(a);++n<a;)o[n]=r(t[n],n,t);return o}return nb=e,nb}var ab,RC;function z$(){if(RC)return ab;RC=1;var e=Dp(),t=uj(),r=eo(),n=Ld(),a=e?e.prototype:void 0,o=a?a.toString:void 0;function s(l){if(typeof l=="string")return l;if(r(l))return t(l,s)+"";if(n(l))return o?o.call(l):"";var c=l+"";return c=="0"&&1/l==-1/0?"-0":c}return ab=s,ab}var ib,qC;function bN(){if(qC)return ib;qC=1;var e=z$();function t(r){return r==null?"":e(r)}return ib=t,ib}var ob,FC;function _N(){if(FC)return ob;FC=1;var e=eo(),t=ij(),r=U$(),n=bN();function a(o,s){return e(o)?o:t(o,s)?[o]:r(n(o))}return ob=a,ob}var sb,$C;function Hv(){if($C)return sb;$C=1;var e=Ld();function t(r){if(typeof r=="string"||e(r))return r;var n=r+"";return n=="0"&&1/r==-1/0?"-0":n}return sb=t,sb}var lb,BC;function dj(){if(BC)return lb;BC=1;var e=_N(),t=Hv();function r(n,a){a=e(a,n);for(var o=0,s=a.length;n!=null&&o<s;)n=n[t(a[o++])];return o&&o==s?n:void 0}return lb=r,lb}var cb,UC;function wN(){if(UC)return cb;UC=1;var e=dj();function t(r,n,a){var o=r==null?void 0:e(r,n);return o===void 0?a:o}return cb=t,cb}var W$=wN();const Co=Et(W$);var ub,zC;function H$(){if(zC)return ub;zC=1;function e(t){return t==null}return ub=e,ub}var V$=H$();const Fr=Et(V$);var db,WC;function G$(){if(WC)return db;WC=1;var e=bl(),t=eo(),r=_l(),n="[object String]";function a(o){return typeof o=="string"||!t(o)&&r(o)&&e(o)==n}return db=a,db}var Y$=G$();const Gc=Et(Y$);var K$=oj();const Tr=Et(K$);var Q$=sc();const Rd=Et(Q$);var fb={exports:{}},yn={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var HC;function X$(){if(HC)return yn;HC=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),s=Symbol.for("react.context"),l=Symbol.for("react.server_context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.for("react.offscreen"),v;v=Symbol.for("react.module.reference");function m(y){if(typeof y=="object"&&y!==null){var b=y.$$typeof;switch(b){case e:switch(y=y.type,y){case r:case a:case n:case u:case d:return y;default:switch(y=y&&y.$$typeof,y){case l:case s:case c:case h:case f:case o:return y;default:return b}}case t:return b}}}return yn.ContextConsumer=s,yn.ContextProvider=o,yn.Element=e,yn.ForwardRef=c,yn.Fragment=r,yn.Lazy=h,yn.Memo=f,yn.Portal=t,yn.Profiler=a,yn.StrictMode=n,yn.Suspense=u,yn.SuspenseList=d,yn.isAsyncMode=function(){return!1},yn.isConcurrentMode=function(){return!1},yn.isContextConsumer=function(y){return m(y)===s},yn.isContextProvider=function(y){return m(y)===o},yn.isElement=function(y){return typeof y=="object"&&y!==null&&y.$$typeof===e},yn.isForwardRef=function(y){return m(y)===c},yn.isFragment=function(y){return m(y)===r},yn.isLazy=function(y){return m(y)===h},yn.isMemo=function(y){return m(y)===f},yn.isPortal=function(y){return m(y)===t},yn.isProfiler=function(y){return m(y)===a},yn.isStrictMode=function(y){return m(y)===n},yn.isSuspense=function(y){return m(y)===u},yn.isSuspenseList=function(y){return m(y)===d},yn.isValidElementType=function(y){return typeof y=="string"||typeof y=="function"||y===r||y===a||y===n||y===u||y===d||y===p||typeof y=="object"&&y!==null&&(y.$$typeof===h||y.$$typeof===f||y.$$typeof===o||y.$$typeof===s||y.$$typeof===c||y.$$typeof===v||y.getModuleId!==void 0)},yn.typeOf=m,yn}var VC;function J$(){return VC||(VC=1,fb.exports=X$()),fb.exports}var Z$=J$(),hb,GC;function jN(){if(GC)return hb;GC=1;var e=bl(),t=_l(),r="[object Number]";function n(a){return typeof a=="number"||t(a)&&e(a)==r}return hb=n,hb}var pb,YC;function eB(){if(YC)return pb;YC=1;var e=jN();function t(r){return e(r)&&r!=+r}return pb=t,pb}var tB=eB();const Mp=Et(tB);var rB=jN();const nB=Et(rB);var Mi=function(t){return t===0?0:t>0?1:-1},Mc=function(t){return Gc(t)&&t.indexOf("%")===t.length-1},Dt=function(t){return nB(t)&&!Mp(t)},Ha=function(t){return Dt(t)||Gc(t)},aB=0,qd=function(t){var r=++aB;return"".concat(t||"").concat(r)},Li=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!Dt(t)&&!Gc(t))return n;var o;if(Mc(t)){var s=t.indexOf("%");o=r*parseFloat(t.slice(0,s))/100}else o=+t;return Mp(o)&&(o=n),a&&o>r&&(o=r),o},Vl=function(t){if(!t)return null;var r=Object.keys(t);return r&&r.length?t[r[0]]:null},iB=function(t){if(!Array.isArray(t))return!1;for(var r=t.length,n={},a=0;a<r;a++)if(!n[t[a]])n[t[a]]=!0;else return!0;return!1},_o=function(t,r){return Dt(t)&&Dt(r)?function(n){return t+n*(r-t)}:function(){return r}};function mg(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):Co(n,t))===r})}var oB=function(t,r){return Dt(t)&&Dt(r)?t-r:Gc(t)&&Gc(r)?t.localeCompare(r):t instanceof Date&&r instanceof Date?t.getTime()-r.getTime():String(t).localeCompare(String(r))};function Hu(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function Q2(e){"@babel/helpers - typeof";return Q2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Q2(e)}var sB=["viewBox","children"],lB=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],KC=["points","pathLength"],mb={svg:sB,polygon:KC,polyline:KC},fj=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],gg=function(t,r){if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(x.isValidElement(t)&&(n=t.props),!Rd(n))return null;var a={};return Object.keys(n).forEach(function(o){fj.includes(o)&&(a[o]=r||function(s){return n[o](n,s)})}),a},cB=function(t,r,n){return function(a){return t(r,n,a),null}},Yc=function(t,r,n){if(!Rd(t)||Q2(t)!=="object")return null;var a=null;return Object.keys(t).forEach(function(o){var s=t[o];fj.includes(o)&&typeof s=="function"&&(a||(a={}),a[o]=cB(s,r,n))}),a},uB=["children"],dB=["children"];function QC(e,t){if(e==null)return{};var r=fB(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function fB(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function X2(e){"@babel/helpers - typeof";return X2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X2(e)}var XC={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},ul=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},JC=null,gb=null,hj=function e(t){if(t===JC&&Array.isArray(gb))return gb;var r=[];return x.Children.forEach(t,function(n){Fr(n)||(Z$.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),gb=r,JC=t,r};function Ao(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(a){return ul(a)}):n=[ul(t)],hj(e).forEach(function(a){var o=Co(a,"type.displayName")||Co(a,"type.name");n.indexOf(o)!==-1&&r.push(a)}),r}function yo(e,t){var r=Ao(e,t);return r&&r[0]}var ZC=function(t){if(!t||!t.props)return!1;var r=t.props,n=r.width,a=r.height;return!(!Dt(n)||n<=0||!Dt(a)||a<=0)},hB=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],pB=function(t){return t&&t.type&&Gc(t.type)&&hB.indexOf(t.type)>=0},mB=function(t){return t&&X2(t)==="object"&&"clipDot"in t},gB=function(t,r,n,a){var o,s=(o=mb?.[a])!==null&&o!==void 0?o:[];return r.startsWith("data-")||!Tr(t)&&(a&&s.includes(r)||lB.includes(r))||n&&fj.includes(r)},gr=function(t,r,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var a=t;if(x.isValidElement(t)&&(a=t.props),!Rd(a))return null;var o={};return Object.keys(a).forEach(function(s){var l;gB((l=a)===null||l===void 0?void 0:l[s],s,r,n)&&(o[s]=a[s])}),o},J2=function e(t,r){if(t===r)return!0;var n=x.Children.count(t);if(n!==x.Children.count(r))return!1;if(n===0)return!0;if(n===1)return eA(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var a=0;a<n;a++){var o=t[a],s=r[a];if(Array.isArray(o)||Array.isArray(s)){if(!e(o,s))return!1}else if(!eA(o,s))return!1}return!0},eA=function(t,r){if(Fr(t)&&Fr(r))return!0;if(!Fr(t)&&!Fr(r)){var n=t.props||{},a=n.children,o=QC(n,uB),s=r.props||{},l=s.children,c=QC(s,dB);return a&&l?Hu(o,c)&&J2(a,l):!a&&!l?Hu(o,c):!1}return!1},tA=function(t,r){var n=[],a={};return hj(t).forEach(function(o,s){if(pB(o))n.push(o);else if(o){var l=ul(o.type),c=r[l]||{},u=c.handler,d=c.once;if(u&&(!d||!a[l])){var f=u(o,l,s);n.push(f),a[l]=!0}}}),n},vB=function(t){var r=t&&t.type;return r&&XC[r]?XC[r]:null},yB=function(t,r){return hj(r).indexOf(t)},xB=["children","width","height","viewBox","className","style","title","desc"];function Z2(){return Z2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Z2.apply(this,arguments)}function bB(e,t){if(e==null)return{};var r=_B(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function _B(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function e_(e){var t=e.children,r=e.width,n=e.height,a=e.viewBox,o=e.className,s=e.style,l=e.title,c=e.desc,u=bB(e,xB),d=a||{width:r,height:n,x:0,y:0},f=Pr("recharts-surface",o);return Ae.createElement("svg",Z2({},gr(u,!0,"svg"),{className:f,width:r,height:n,style:s,viewBox:"".concat(d.x," ").concat(d.y," ").concat(d.width," ").concat(d.height)}),Ae.createElement("title",null,l),Ae.createElement("desc",null,c),t)}var wB=["children","className"];function t_(){return t_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},t_.apply(this,arguments)}function jB(e,t){if(e==null)return{};var r=SB(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function SB(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var cn=Ae.forwardRef(function(e,t){var r=e.children,n=e.className,a=jB(e,wB),o=Pr("recharts-layer",n);return Ae.createElement("g",t_({className:o},gr(a,!0),{ref:t}),r)}),is=function(t,r){for(var n=arguments.length,a=new Array(n>2?n-2:0),o=2;o<n;o++)a[o-2]=arguments[o]},vb,rA;function CB(){if(rA)return vb;rA=1;function e(t,r,n){var a=-1,o=t.length;r<0&&(r=-r>o?0:o+r),n=n>o?o:n,n<0&&(n+=o),o=r>n?0:n-r>>>0,r>>>=0;for(var s=Array(o);++a<o;)s[a]=t[a+r];return s}return vb=e,vb}var yb,nA;function AB(){if(nA)return yb;nA=1;var e=CB();function t(r,n,a){var o=r.length;return a=a===void 0?o:a,!n&&a>=o?r:e(r,n,a)}return yb=t,yb}var xb,aA;function SN(){if(aA)return xb;aA=1;var e="\\ud800-\\udfff",t="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",a=t+r+n,o="\\ufe0e\\ufe0f",s="\\u200d",l=RegExp("["+s+e+a+o+"]");function c(u){return l.test(u)}return xb=c,xb}var bb,iA;function PB(){if(iA)return bb;iA=1;function e(t){return t.split("")}return bb=e,bb}var _b,oA;function OB(){if(oA)return _b;oA=1;var e="\\ud800-\\udfff",t="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",a=t+r+n,o="\\ufe0e\\ufe0f",s="["+e+"]",l="["+a+"]",c="\\ud83c[\\udffb-\\udfff]",u="(?:"+l+"|"+c+")",d="[^"+e+"]",f="(?:\\ud83c[\\udde6-\\uddff]){2}",h="[\\ud800-\\udbff][\\udc00-\\udfff]",p="\\u200d",v=u+"?",m="["+o+"]?",y="(?:"+p+"(?:"+[d,f,h].join("|")+")"+m+v+")*",b=m+v+y,_="(?:"+[d+l+"?",l,f,h,s].join("|")+")",w=RegExp(c+"(?="+c+")|"+_+b,"g");function A(P){return P.match(w)||[]}return _b=A,_b}var wb,sA;function kB(){if(sA)return wb;sA=1;var e=PB(),t=SN(),r=OB();function n(a){return t(a)?r(a):e(a)}return wb=n,wb}var jb,lA;function EB(){if(lA)return jb;lA=1;var e=AB(),t=SN(),r=kB(),n=bN();function a(o){return function(s){s=n(s);var l=t(s)?r(s):void 0,c=l?l[0]:s.charAt(0),u=l?e(l,1).join(""):s.slice(1);return c[o]()+u}}return jb=a,jb}var Sb,cA;function TB(){if(cA)return Sb;cA=1;var e=EB(),t=e("toUpperCase");return Sb=t,Sb}var IB=TB();const Vv=Et(IB);function qn(e){return function(){return e}}const CN=Math.cos,vg=Math.sin,ls=Math.sqrt,yg=Math.PI,Gv=2*yg,r_=Math.PI,n_=2*r_,Pc=1e-6,NB=n_-Pc;function AN(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function DB(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return AN;const r=10**t;return function(n){this._+=n[0];for(let a=1,o=n.length;a<o;++a)this._+=Math.round(arguments[a]*r)/r+n[a]}}class MB{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?AN:DB(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,a){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+a}`}bezierCurveTo(t,r,n,a,o,s){this._append`C${+t},${+r},${+n},${+a},${this._x1=+o},${this._y1=+s}`}arcTo(t,r,n,a,o){if(t=+t,r=+r,n=+n,a=+a,o=+o,o<0)throw new Error(`negative radius: ${o}`);let s=this._x1,l=this._y1,c=n-t,u=a-r,d=s-t,f=l-r,h=d*d+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(h>Pc)if(!(Math.abs(f*c-u*d)>Pc)||!o)this._append`L${this._x1=t},${this._y1=r}`;else{let p=n-s,v=a-l,m=c*c+u*u,y=p*p+v*v,b=Math.sqrt(m),_=Math.sqrt(h),w=o*Math.tan((r_-Math.acos((m+h-y)/(2*b*_)))/2),A=w/_,P=w/b;Math.abs(A-1)>Pc&&this._append`L${t+A*d},${r+A*f}`,this._append`A${o},${o},0,0,${+(f*p>d*v)},${this._x1=t+P*c},${this._y1=r+P*u}`}}arc(t,r,n,a,o,s){if(t=+t,r=+r,n=+n,s=!!s,n<0)throw new Error(`negative radius: ${n}`);let l=n*Math.cos(a),c=n*Math.sin(a),u=t+l,d=r+c,f=1^s,h=s?a-o:o-a;this._x1===null?this._append`M${u},${d}`:(Math.abs(this._x1-u)>Pc||Math.abs(this._y1-d)>Pc)&&this._append`L${u},${d}`,n&&(h<0&&(h=h%n_+n_),h>NB?this._append`A${n},${n},0,1,${f},${t-l},${r-c}A${n},${n},0,1,${f},${this._x1=u},${this._y1=d}`:h>Pc&&this._append`A${n},${n},0,${+(h>=r_)},${f},${this._x1=t+n*Math.cos(o)},${this._y1=r+n*Math.sin(o)}`)}rect(t,r,n,a){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+a}h${-n}Z`}toString(){return this._}}function pj(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new MB(t)}function mj(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function PN(e){this._context=e}PN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Yv(e){return new PN(e)}function ON(e){return e[0]}function kN(e){return e[1]}function EN(e,t){var r=qn(!0),n=null,a=Yv,o=null,s=pj(l);e=typeof e=="function"?e:e===void 0?ON:qn(e),t=typeof t=="function"?t:t===void 0?kN:qn(t);function l(c){var u,d=(c=mj(c)).length,f,h=!1,p;for(n==null&&(o=a(p=s())),u=0;u<=d;++u)!(u<d&&r(f=c[u],u,c))===h&&((h=!h)?o.lineStart():o.lineEnd()),h&&o.point(+e(f,u,c),+t(f,u,c));if(p)return o=null,p+""||null}return l.x=function(c){return arguments.length?(e=typeof c=="function"?c:qn(+c),l):e},l.y=function(c){return arguments.length?(t=typeof c=="function"?c:qn(+c),l):t},l.defined=function(c){return arguments.length?(r=typeof c=="function"?c:qn(!!c),l):r},l.curve=function(c){return arguments.length?(a=c,n!=null&&(o=a(n)),l):a},l.context=function(c){return arguments.length?(c==null?n=o=null:o=a(n=c),l):n},l}function gm(e,t,r){var n=null,a=qn(!0),o=null,s=Yv,l=null,c=pj(u);e=typeof e=="function"?e:e===void 0?ON:qn(+e),t=typeof t=="function"?t:qn(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?kN:qn(+r);function u(f){var h,p,v,m=(f=mj(f)).length,y,b=!1,_,w=new Array(m),A=new Array(m);for(o==null&&(l=s(_=c())),h=0;h<=m;++h){if(!(h<m&&a(y=f[h],h,f))===b)if(b=!b)p=h,l.areaStart(),l.lineStart();else{for(l.lineEnd(),l.lineStart(),v=h-1;v>=p;--v)l.point(w[v],A[v]);l.lineEnd(),l.areaEnd()}b&&(w[h]=+e(y,h,f),A[h]=+t(y,h,f),l.point(n?+n(y,h,f):w[h],r?+r(y,h,f):A[h]))}if(_)return l=null,_+""||null}function d(){return EN().defined(a).curve(s).context(o)}return u.x=function(f){return arguments.length?(e=typeof f=="function"?f:qn(+f),n=null,u):e},u.x0=function(f){return arguments.length?(e=typeof f=="function"?f:qn(+f),u):e},u.x1=function(f){return arguments.length?(n=f==null?null:typeof f=="function"?f:qn(+f),u):n},u.y=function(f){return arguments.length?(t=typeof f=="function"?f:qn(+f),r=null,u):t},u.y0=function(f){return arguments.length?(t=typeof f=="function"?f:qn(+f),u):t},u.y1=function(f){return arguments.length?(r=f==null?null:typeof f=="function"?f:qn(+f),u):r},u.lineX0=u.lineY0=function(){return d().x(e).y(t)},u.lineY1=function(){return d().x(e).y(r)},u.lineX1=function(){return d().x(n).y(t)},u.defined=function(f){return arguments.length?(a=typeof f=="function"?f:qn(!!f),u):a},u.curve=function(f){return arguments.length?(s=f,o!=null&&(l=s(o)),u):s},u.context=function(f){return arguments.length?(f==null?o=l=null:l=s(o=f),u):o},u}class TN{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function LB(e){return new TN(e,!0)}function RB(e){return new TN(e,!1)}const gj={draw(e,t){const r=ls(t/yg);e.moveTo(r,0),e.arc(0,0,r,0,Gv)}},qB={draw(e,t){const r=ls(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},IN=ls(1/3),FB=IN*2,$B={draw(e,t){const r=ls(t/FB),n=r*IN;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},BB={draw(e,t){const r=ls(t),n=-r/2;e.rect(n,n,r,r)}},UB=.8908130915292852,NN=vg(yg/10)/vg(7*yg/10),zB=vg(Gv/10)*NN,WB=-CN(Gv/10)*NN,HB={draw(e,t){const r=ls(t*UB),n=zB*r,a=WB*r;e.moveTo(0,-r),e.lineTo(n,a);for(let o=1;o<5;++o){const s=Gv*o/5,l=CN(s),c=vg(s);e.lineTo(c*r,-l*r),e.lineTo(l*n-c*a,c*n+l*a)}e.closePath()}},Cb=ls(3),VB={draw(e,t){const r=-ls(t/(Cb*3));e.moveTo(0,r*2),e.lineTo(-Cb*r,-r),e.lineTo(Cb*r,-r),e.closePath()}},$o=-.5,Bo=ls(3)/2,a_=1/ls(12),GB=(a_/2+1)*3,YB={draw(e,t){const r=ls(t/GB),n=r/2,a=r*a_,o=n,s=r*a_+r,l=-o,c=s;e.moveTo(n,a),e.lineTo(o,s),e.lineTo(l,c),e.lineTo($o*n-Bo*a,Bo*n+$o*a),e.lineTo($o*o-Bo*s,Bo*o+$o*s),e.lineTo($o*l-Bo*c,Bo*l+$o*c),e.lineTo($o*n+Bo*a,$o*a-Bo*n),e.lineTo($o*o+Bo*s,$o*s-Bo*o),e.lineTo($o*l+Bo*c,$o*c-Bo*l),e.closePath()}};function KB(e,t){let r=null,n=pj(a);e=typeof e=="function"?e:qn(e||gj),t=typeof t=="function"?t:qn(t===void 0?64:+t);function a(){let o;if(r||(r=o=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),o)return r=null,o+""||null}return a.type=function(o){return arguments.length?(e=typeof o=="function"?o:qn(o),a):e},a.size=function(o){return arguments.length?(t=typeof o=="function"?o:qn(+o),a):t},a.context=function(o){return arguments.length?(r=o??null,a):r},a}function xg(){}function bg(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function DN(e){this._context=e}DN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:bg(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:bg(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function QB(e){return new DN(e)}function MN(e){this._context=e}MN.prototype={areaStart:xg,areaEnd:xg,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:bg(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function XB(e){return new MN(e)}function LN(e){this._context=e}LN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:bg(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function JB(e){return new LN(e)}function RN(e){this._context=e}RN.prototype={areaStart:xg,areaEnd:xg,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function ZB(e){return new RN(e)}function uA(e){return e<0?-1:1}function dA(e,t,r){var n=e._x1-e._x0,a=t-e._x1,o=(e._y1-e._y0)/(n||a<0&&-0),s=(r-e._y1)/(a||n<0&&-0),l=(o*a+s*n)/(n+a);return(uA(o)+uA(s))*Math.min(Math.abs(o),Math.abs(s),.5*Math.abs(l))||0}function fA(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function Ab(e,t,r){var n=e._x0,a=e._y0,o=e._x1,s=e._y1,l=(o-n)/3;e._context.bezierCurveTo(n+l,a+l*t,o-l,s-l*r,o,s)}function _g(e){this._context=e}_g.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Ab(this,this._t0,fA(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Ab(this,fA(this,r=dA(this,e,t)),r);break;default:Ab(this,this._t0,r=dA(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function qN(e){this._context=new FN(e)}(qN.prototype=Object.create(_g.prototype)).point=function(e,t){_g.prototype.point.call(this,t,e)};function FN(e){this._context=e}FN.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,a,o){this._context.bezierCurveTo(t,e,n,r,o,a)}};function eU(e){return new _g(e)}function tU(e){return new qN(e)}function $N(e){this._context=e}$N.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=hA(e),a=hA(t),o=0,s=1;s<r;++o,++s)this._context.bezierCurveTo(n[0][o],a[0][o],n[1][o],a[1][o],e[s],t[s]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function hA(e){var t,r=e.length-1,n,a=new Array(r),o=new Array(r),s=new Array(r);for(a[0]=0,o[0]=2,s[0]=e[0]+2*e[1],t=1;t<r-1;++t)a[t]=1,o[t]=4,s[t]=4*e[t]+2*e[t+1];for(a[r-1]=2,o[r-1]=7,s[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=a[t]/o[t-1],o[t]-=n,s[t]-=n*s[t-1];for(a[r-1]=s[r-1]/o[r-1],t=r-2;t>=0;--t)a[t]=(s[t]-a[t+1])/o[t];for(o[r-1]=(e[r]+a[r-1])/2,t=0;t<r-1;++t)o[t]=2*e[t+1]-a[t+1];return[a,o]}function rU(e){return new $N(e)}function Kv(e,t){this._context=e,this._t=t}Kv.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function nU(e){return new Kv(e,.5)}function aU(e){return new Kv(e,0)}function iU(e){return new Kv(e,1)}function ed(e,t){if((s=e.length)>1)for(var r=1,n,a,o=e[t[0]],s,l=o.length;r<s;++r)for(a=o,o=e[t[r]],n=0;n<l;++n)o[n][1]+=o[n][0]=isNaN(a[n][1])?a[n][0]:a[n][1]}function i_(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function oU(e,t){return e[t]}function sU(e){const t=[];return t.key=e,t}function lU(){var e=qn([]),t=i_,r=ed,n=oU;function a(o){var s=Array.from(e.apply(this,arguments),sU),l,c=s.length,u=-1,d;for(const f of o)for(l=0,++u;l<c;++l)(s[l][u]=[0,+n(f,s[l].key,u,o)]).data=f;for(l=0,d=mj(t(s));l<c;++l)s[d[l]].index=l;return r(s,d),s}return a.keys=function(o){return arguments.length?(e=typeof o=="function"?o:qn(Array.from(o)),a):e},a.value=function(o){return arguments.length?(n=typeof o=="function"?o:qn(+o),a):n},a.order=function(o){return arguments.length?(t=o==null?i_:typeof o=="function"?o:qn(Array.from(o)),a):t},a.offset=function(o){return arguments.length?(r=o??ed,a):r},a}function cU(e,t){if((n=e.length)>0){for(var r,n,a=0,o=e[0].length,s;a<o;++a){for(s=r=0;r<n;++r)s+=e[r][a][1]||0;if(s)for(r=0;r<n;++r)e[r][a][1]/=s}ed(e,t)}}function uU(e,t){if((a=e.length)>0){for(var r=0,n=e[t[0]],a,o=n.length;r<o;++r){for(var s=0,l=0;s<a;++s)l+=e[s][r][1]||0;n[r][1]+=n[r][0]=-l/2}ed(e,t)}}function dU(e,t){if(!(!((s=e.length)>0)||!((o=(a=e[t[0]]).length)>0))){for(var r=0,n=1,a,o,s;n<o;++n){for(var l=0,c=0,u=0;l<s;++l){for(var d=e[t[l]],f=d[n][1]||0,h=d[n-1][1]||0,p=(f-h)/2,v=0;v<l;++v){var m=e[t[v]],y=m[n][1]||0,b=m[n-1][1]||0;p+=y-b}c+=f,u+=p*f}a[n-1][1]+=a[n-1][0]=r,c&&(r-=u/c)}a[n-1][1]+=a[n-1][0]=r,ed(e,t)}}function Wh(e){"@babel/helpers - typeof";return Wh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wh(e)}var fU=["type","size","sizeType"];function o_(){return o_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o_.apply(this,arguments)}function pA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function mA(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?pA(Object(r),!0).forEach(function(n){hU(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pA(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hU(e,t,r){return t=pU(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pU(e){var t=mU(e,"string");return Wh(t)=="symbol"?t:t+""}function mU(e,t){if(Wh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Wh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function gU(e,t){if(e==null)return{};var r=vU(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function vU(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var BN={symbolCircle:gj,symbolCross:qB,symbolDiamond:$B,symbolSquare:BB,symbolStar:HB,symbolTriangle:VB,symbolWye:YB},yU=Math.PI/180,xU=function(t){var r="symbol".concat(Vv(t));return BN[r]||gj},bU=function(t,r,n){if(r==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var a=18*yU;return 1.25*t*t*(Math.tan(a)-Math.tan(a*2)*Math.pow(Math.tan(a),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},_U=function(t,r){BN["symbol".concat(Vv(t))]=r},vj=function(t){var r=t.type,n=r===void 0?"circle":r,a=t.size,o=a===void 0?64:a,s=t.sizeType,l=s===void 0?"area":s,c=gU(t,fU),u=mA(mA({},c),{},{type:n,size:o,sizeType:l}),d=function(){var y=xU(n),b=KB().type(y).size(bU(o,l,n));return b()},f=u.className,h=u.cx,p=u.cy,v=gr(u,!0);return h===+h&&p===+p&&o===+o?Ae.createElement("path",o_({},v,{className:Pr("recharts-symbols",f),transform:"translate(".concat(h,", ").concat(p,")"),d:d()})):null};vj.registerSymbol=_U;function td(e){"@babel/helpers - typeof";return td=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},td(e)}function s_(){return s_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s_.apply(this,arguments)}function gA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function wU(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gA(Object(r),!0).forEach(function(n){Hh(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gA(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jU(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function SU(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,zN(n.key),n)}}function CU(e,t,r){return t&&SU(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function AU(e,t,r){return t=wg(t),PU(e,UN()?Reflect.construct(t,r||[],wg(e).constructor):t.apply(e,r))}function PU(e,t){if(t&&(td(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return OU(e)}function OU(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function UN(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(UN=function(){return!!e})()}function wg(e){return wg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},wg(e)}function kU(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l_(e,t)}function l_(e,t){return l_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},l_(e,t)}function Hh(e,t,r){return t=zN(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zN(e){var t=EU(e,"string");return td(t)=="symbol"?t:t+""}function EU(e,t){if(td(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(td(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Uo=32,yj=function(e){function t(){return jU(this,t),AU(this,t,arguments)}return kU(t,e),CU(t,[{key:"renderIcon",value:function(n){var a=this.props.inactiveColor,o=Uo/2,s=Uo/6,l=Uo/3,c=n.inactive?a:n.color;if(n.type==="plainline")return Ae.createElement("line",{strokeWidth:4,fill:"none",stroke:c,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:o,x2:Uo,y2:o,className:"recharts-legend-icon"});if(n.type==="line")return Ae.createElement("path",{strokeWidth:4,fill:"none",stroke:c,d:"M0,".concat(o,"h").concat(l,`
            A`).concat(s,",").concat(s,",0,1,1,").concat(2*l,",").concat(o,`
            H`).concat(Uo,"M").concat(2*l,",").concat(o,`
            A`).concat(s,",").concat(s,",0,1,1,").concat(l,",").concat(o),className:"recharts-legend-icon"});if(n.type==="rect")return Ae.createElement("path",{stroke:"none",fill:c,d:"M0,".concat(Uo/8,"h").concat(Uo,"v").concat(Uo*3/4,"h").concat(-Uo,"z"),className:"recharts-legend-icon"});if(Ae.isValidElement(n.legendIcon)){var u=wU({},n);return delete u.legendIcon,Ae.cloneElement(n.legendIcon,u)}return Ae.createElement(vj,{fill:c,cx:o,cy:o,size:Uo,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,a=this.props,o=a.payload,s=a.iconSize,l=a.layout,c=a.formatter,u=a.inactiveColor,d={x:0,y:0,width:Uo,height:Uo},f={display:l==="horizontal"?"inline-block":"block",marginRight:10},h={display:"inline-block",verticalAlign:"middle",marginRight:4};return o.map(function(p,v){var m=p.formatter||c,y=Pr(Hh(Hh({"recharts-legend-item":!0},"legend-item-".concat(v),!0),"inactive",p.inactive));if(p.type==="none")return null;var b=Tr(p.value)?null:p.value;is(!Tr(p.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var _=p.inactive?u:p.color;return Ae.createElement("li",s_({className:y,style:f,key:"legend-item-".concat(v)},Yc(n.props,p,v)),Ae.createElement(e_,{width:s,height:s,viewBox:d,style:h},n.renderIcon(p)),Ae.createElement("span",{className:"recharts-legend-item-text",style:{color:_}},m?m(b,p,v):b))})}},{key:"render",value:function(){var n=this.props,a=n.payload,o=n.layout,s=n.align;if(!a||!a.length)return null;var l={padding:0,margin:0,textAlign:o==="horizontal"?s:"left"};return Ae.createElement("ul",{className:"recharts-default-legend",style:l},this.renderItems())}}])}(x.PureComponent);Hh(yj,"displayName","Legend");Hh(yj,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var Pb,vA;function TU(){if(vA)return Pb;vA=1;var e=zv();function t(){this.__data__=new e,this.size=0}return Pb=t,Pb}var Ob,yA;function IU(){if(yA)return Ob;yA=1;function e(t){var r=this.__data__,n=r.delete(t);return this.size=r.size,n}return Ob=e,Ob}var kb,xA;function NU(){if(xA)return kb;xA=1;function e(t){return this.__data__.get(t)}return kb=e,kb}var Eb,bA;function DU(){if(bA)return Eb;bA=1;function e(t){return this.__data__.has(t)}return Eb=e,Eb}var Tb,_A;function MU(){if(_A)return Tb;_A=1;var e=zv(),t=lj(),r=cj(),n=200;function a(o,s){var l=this.__data__;if(l instanceof e){var c=l.__data__;if(!t||c.length<n-1)return c.push([o,s]),this.size=++l.size,this;l=this.__data__=new r(c)}return l.set(o,s),this.size=l.size,this}return Tb=a,Tb}var Ib,wA;function WN(){if(wA)return Ib;wA=1;var e=zv(),t=TU(),r=IU(),n=NU(),a=DU(),o=MU();function s(l){var c=this.__data__=new e(l);this.size=c.size}return s.prototype.clear=t,s.prototype.delete=r,s.prototype.get=n,s.prototype.has=a,s.prototype.set=o,Ib=s,Ib}var Nb,jA;function LU(){if(jA)return Nb;jA=1;var e="__lodash_hash_undefined__";function t(r){return this.__data__.set(r,e),this}return Nb=t,Nb}var Db,SA;function RU(){if(SA)return Db;SA=1;function e(t){return this.__data__.has(t)}return Db=e,Db}var Mb,CA;function HN(){if(CA)return Mb;CA=1;var e=cj(),t=LU(),r=RU();function n(a){var o=-1,s=a==null?0:a.length;for(this.__data__=new e;++o<s;)this.add(a[o])}return n.prototype.add=n.prototype.push=t,n.prototype.has=r,Mb=n,Mb}var Lb,AA;function VN(){if(AA)return Lb;AA=1;function e(t,r){for(var n=-1,a=t==null?0:t.length;++n<a;)if(r(t[n],n,t))return!0;return!1}return Lb=e,Lb}var Rb,PA;function GN(){if(PA)return Rb;PA=1;function e(t,r){return t.has(r)}return Rb=e,Rb}var qb,OA;function YN(){if(OA)return qb;OA=1;var e=HN(),t=VN(),r=GN(),n=1,a=2;function o(s,l,c,u,d,f){var h=c&n,p=s.length,v=l.length;if(p!=v&&!(h&&v>p))return!1;var m=f.get(s),y=f.get(l);if(m&&y)return m==l&&y==s;var b=-1,_=!0,w=c&a?new e:void 0;for(f.set(s,l),f.set(l,s);++b<p;){var A=s[b],P=l[b];if(u)var E=h?u(P,A,b,l,s,f):u(A,P,b,s,l,f);if(E!==void 0){if(E)continue;_=!1;break}if(w){if(!t(l,function(T,S){if(!r(w,S)&&(A===T||d(A,T,c,u,f)))return w.push(S)})){_=!1;break}}else if(!(A===P||d(A,P,c,u,f))){_=!1;break}}return f.delete(s),f.delete(l),_}return qb=o,qb}var Fb,kA;function qU(){if(kA)return Fb;kA=1;var e=Ls(),t=e.Uint8Array;return Fb=t,Fb}var $b,EA;function FU(){if(EA)return $b;EA=1;function e(t){var r=-1,n=Array(t.size);return t.forEach(function(a,o){n[++r]=[o,a]}),n}return $b=e,$b}var Bb,TA;function xj(){if(TA)return Bb;TA=1;function e(t){var r=-1,n=Array(t.size);return t.forEach(function(a){n[++r]=a}),n}return Bb=e,Bb}var Ub,IA;function $U(){if(IA)return Ub;IA=1;var e=Dp(),t=qU(),r=sj(),n=YN(),a=FU(),o=xj(),s=1,l=2,c="[object Boolean]",u="[object Date]",d="[object Error]",f="[object Map]",h="[object Number]",p="[object RegExp]",v="[object Set]",m="[object String]",y="[object Symbol]",b="[object ArrayBuffer]",_="[object DataView]",w=e?e.prototype:void 0,A=w?w.valueOf:void 0;function P(E,T,S,I,U,O,M){switch(S){case _:if(E.byteLength!=T.byteLength||E.byteOffset!=T.byteOffset)return!1;E=E.buffer,T=T.buffer;case b:return!(E.byteLength!=T.byteLength||!O(new t(E),new t(T)));case c:case u:case h:return r(+E,+T);case d:return E.name==T.name&&E.message==T.message;case p:case m:return E==T+"";case f:var L=a;case v:var q=I&s;if(L||(L=o),E.size!=T.size&&!q)return!1;var z=M.get(E);if(z)return z==T;I|=l,M.set(E,T);var K=n(L(E),L(T),I,U,O,M);return M.delete(E),K;case y:if(A)return A.call(E)==A.call(T)}return!1}return Ub=P,Ub}var zb,NA;function KN(){if(NA)return zb;NA=1;function e(t,r){for(var n=-1,a=r.length,o=t.length;++n<a;)t[o+n]=r[n];return t}return zb=e,zb}var Wb,DA;function BU(){if(DA)return Wb;DA=1;var e=KN(),t=eo();function r(n,a,o){var s=a(n);return t(n)?s:e(s,o(n))}return Wb=r,Wb}var Hb,MA;function UU(){if(MA)return Hb;MA=1;function e(t,r){for(var n=-1,a=t==null?0:t.length,o=0,s=[];++n<a;){var l=t[n];r(l,n,t)&&(s[o++]=l)}return s}return Hb=e,Hb}var Vb,LA;function zU(){if(LA)return Vb;LA=1;function e(){return[]}return Vb=e,Vb}var Gb,RA;function WU(){if(RA)return Gb;RA=1;var e=UU(),t=zU(),r=Object.prototype,n=r.propertyIsEnumerable,a=Object.getOwnPropertySymbols,o=a?function(s){return s==null?[]:(s=Object(s),e(a(s),function(l){return n.call(s,l)}))}:t;return Gb=o,Gb}var Yb,qA;function HU(){if(qA)return Yb;qA=1;function e(t,r){for(var n=-1,a=Array(t);++n<t;)a[n]=r(n);return a}return Yb=e,Yb}var Kb,FA;function VU(){if(FA)return Kb;FA=1;var e=bl(),t=_l(),r="[object Arguments]";function n(a){return t(a)&&e(a)==r}return Kb=n,Kb}var Qb,$A;function bj(){if($A)return Qb;$A=1;var e=VU(),t=_l(),r=Object.prototype,n=r.hasOwnProperty,a=r.propertyIsEnumerable,o=e(function(){return arguments}())?e:function(s){return t(s)&&n.call(s,"callee")&&!a.call(s,"callee")};return Qb=o,Qb}var Ch={exports:{}},Xb,BA;function GU(){if(BA)return Xb;BA=1;function e(){return!1}return Xb=e,Xb}Ch.exports;var UA;function QN(){return UA||(UA=1,function(e,t){var r=Ls(),n=GU(),a=t&&!t.nodeType&&t,o=a&&!0&&e&&!e.nodeType&&e,s=o&&o.exports===a,l=s?r.Buffer:void 0,c=l?l.isBuffer:void 0,u=c||n;e.exports=u}(Ch,Ch.exports)),Ch.exports}var Jb,zA;function _j(){if(zA)return Jb;zA=1;var e=9007199254740991,t=/^(?:0|[1-9]\d*)$/;function r(n,a){var o=typeof n;return a=a??e,!!a&&(o=="number"||o!="symbol"&&t.test(n))&&n>-1&&n%1==0&&n<a}return Jb=r,Jb}var Zb,WA;function wj(){if(WA)return Zb;WA=1;var e=9007199254740991;function t(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=e}return Zb=t,Zb}var e0,HA;function YU(){if(HA)return e0;HA=1;var e=bl(),t=wj(),r=_l(),n="[object Arguments]",a="[object Array]",o="[object Boolean]",s="[object Date]",l="[object Error]",c="[object Function]",u="[object Map]",d="[object Number]",f="[object Object]",h="[object RegExp]",p="[object Set]",v="[object String]",m="[object WeakMap]",y="[object ArrayBuffer]",b="[object DataView]",_="[object Float32Array]",w="[object Float64Array]",A="[object Int8Array]",P="[object Int16Array]",E="[object Int32Array]",T="[object Uint8Array]",S="[object Uint8ClampedArray]",I="[object Uint16Array]",U="[object Uint32Array]",O={};O[_]=O[w]=O[A]=O[P]=O[E]=O[T]=O[S]=O[I]=O[U]=!0,O[n]=O[a]=O[y]=O[o]=O[b]=O[s]=O[l]=O[c]=O[u]=O[d]=O[f]=O[h]=O[p]=O[v]=O[m]=!1;function M(L){return r(L)&&t(L.length)&&!!O[e(L)]}return e0=M,e0}var t0,VA;function XN(){if(VA)return t0;VA=1;function e(t){return function(r){return t(r)}}return t0=e,t0}var Ah={exports:{}};Ah.exports;var GA;function KU(){return GA||(GA=1,function(e,t){var r=vN(),n=t&&!t.nodeType&&t,a=n&&!0&&e&&!e.nodeType&&e,o=a&&a.exports===n,s=o&&r.process,l=function(){try{var c=a&&a.require&&a.require("util").types;return c||s&&s.binding&&s.binding("util")}catch{}}();e.exports=l}(Ah,Ah.exports)),Ah.exports}var r0,YA;function JN(){if(YA)return r0;YA=1;var e=YU(),t=XN(),r=KU(),n=r&&r.isTypedArray,a=n?t(n):e;return r0=a,r0}var n0,KA;function QU(){if(KA)return n0;KA=1;var e=HU(),t=bj(),r=eo(),n=QN(),a=_j(),o=JN(),s=Object.prototype,l=s.hasOwnProperty;function c(u,d){var f=r(u),h=!f&&t(u),p=!f&&!h&&n(u),v=!f&&!h&&!p&&o(u),m=f||h||p||v,y=m?e(u.length,String):[],b=y.length;for(var _ in u)(d||l.call(u,_))&&!(m&&(_=="length"||p&&(_=="offset"||_=="parent")||v&&(_=="buffer"||_=="byteLength"||_=="byteOffset")||a(_,b)))&&y.push(_);return y}return n0=c,n0}var a0,QA;function XU(){if(QA)return a0;QA=1;var e=Object.prototype;function t(r){var n=r&&r.constructor,a=typeof n=="function"&&n.prototype||e;return r===a}return a0=t,a0}var i0,XA;function ZN(){if(XA)return i0;XA=1;function e(t,r){return function(n){return t(r(n))}}return i0=e,i0}var o0,JA;function JU(){if(JA)return o0;JA=1;var e=ZN(),t=e(Object.keys,Object);return o0=t,o0}var s0,ZA;function ZU(){if(ZA)return s0;ZA=1;var e=XU(),t=JU(),r=Object.prototype,n=r.hasOwnProperty;function a(o){if(!e(o))return t(o);var s=[];for(var l in Object(o))n.call(o,l)&&l!="constructor"&&s.push(l);return s}return s0=a,s0}var l0,eP;function Lp(){if(eP)return l0;eP=1;var e=oj(),t=wj();function r(n){return n!=null&&t(n.length)&&!e(n)}return l0=r,l0}var c0,tP;function Qv(){if(tP)return c0;tP=1;var e=QU(),t=ZU(),r=Lp();function n(a){return r(a)?e(a):t(a)}return c0=n,c0}var u0,rP;function ez(){if(rP)return u0;rP=1;var e=BU(),t=WU(),r=Qv();function n(a){return e(a,r,t)}return u0=n,u0}var d0,nP;function tz(){if(nP)return d0;nP=1;var e=ez(),t=1,r=Object.prototype,n=r.hasOwnProperty;function a(o,s,l,c,u,d){var f=l&t,h=e(o),p=h.length,v=e(s),m=v.length;if(p!=m&&!f)return!1;for(var y=p;y--;){var b=h[y];if(!(f?b in s:n.call(s,b)))return!1}var _=d.get(o),w=d.get(s);if(_&&w)return _==s&&w==o;var A=!0;d.set(o,s),d.set(s,o);for(var P=f;++y<p;){b=h[y];var E=o[b],T=s[b];if(c)var S=f?c(T,E,b,s,o,d):c(E,T,b,o,s,d);if(!(S===void 0?E===T||u(E,T,l,c,d):S)){A=!1;break}P||(P=b=="constructor")}if(A&&!P){var I=o.constructor,U=s.constructor;I!=U&&"constructor"in o&&"constructor"in s&&!(typeof I=="function"&&I instanceof I&&typeof U=="function"&&U instanceof U)&&(A=!1)}return d.delete(o),d.delete(s),A}return d0=a,d0}var f0,aP;function rz(){if(aP)return f0;aP=1;var e=au(),t=Ls(),r=e(t,"DataView");return f0=r,f0}var h0,iP;function nz(){if(iP)return h0;iP=1;var e=au(),t=Ls(),r=e(t,"Promise");return h0=r,h0}var p0,oP;function eD(){if(oP)return p0;oP=1;var e=au(),t=Ls(),r=e(t,"Set");return p0=r,p0}var m0,sP;function az(){if(sP)return m0;sP=1;var e=au(),t=Ls(),r=e(t,"WeakMap");return m0=r,m0}var g0,lP;function iz(){if(lP)return g0;lP=1;var e=rz(),t=lj(),r=nz(),n=eD(),a=az(),o=bl(),s=yN(),l="[object Map]",c="[object Object]",u="[object Promise]",d="[object Set]",f="[object WeakMap]",h="[object DataView]",p=s(e),v=s(t),m=s(r),y=s(n),b=s(a),_=o;return(e&&_(new e(new ArrayBuffer(1)))!=h||t&&_(new t)!=l||r&&_(r.resolve())!=u||n&&_(new n)!=d||a&&_(new a)!=f)&&(_=function(w){var A=o(w),P=A==c?w.constructor:void 0,E=P?s(P):"";if(E)switch(E){case p:return h;case v:return l;case m:return u;case y:return d;case b:return f}return A}),g0=_,g0}var v0,cP;function oz(){if(cP)return v0;cP=1;var e=WN(),t=YN(),r=$U(),n=tz(),a=iz(),o=eo(),s=QN(),l=JN(),c=1,u="[object Arguments]",d="[object Array]",f="[object Object]",h=Object.prototype,p=h.hasOwnProperty;function v(m,y,b,_,w,A){var P=o(m),E=o(y),T=P?d:a(m),S=E?d:a(y);T=T==u?f:T,S=S==u?f:S;var I=T==f,U=S==f,O=T==S;if(O&&s(m)){if(!s(y))return!1;P=!0,I=!1}if(O&&!I)return A||(A=new e),P||l(m)?t(m,y,b,_,w,A):r(m,y,T,b,_,w,A);if(!(b&c)){var M=I&&p.call(m,"__wrapped__"),L=U&&p.call(y,"__wrapped__");if(M||L){var q=M?m.value():m,z=L?y.value():y;return A||(A=new e),w(q,z,b,_,A)}}return O?(A||(A=new e),n(m,y,b,_,w,A)):!1}return v0=v,v0}var y0,uP;function jj(){if(uP)return y0;uP=1;var e=oz(),t=_l();function r(n,a,o,s,l){return n===a?!0:n==null||a==null||!t(n)&&!t(a)?n!==n&&a!==a:e(n,a,o,s,r,l)}return y0=r,y0}var x0,dP;function sz(){if(dP)return x0;dP=1;var e=WN(),t=jj(),r=1,n=2;function a(o,s,l,c){var u=l.length,d=u,f=!c;if(o==null)return!d;for(o=Object(o);u--;){var h=l[u];if(f&&h[2]?h[1]!==o[h[0]]:!(h[0]in o))return!1}for(;++u<d;){h=l[u];var p=h[0],v=o[p],m=h[1];if(f&&h[2]){if(v===void 0&&!(p in o))return!1}else{var y=new e;if(c)var b=c(v,m,p,o,s,y);if(!(b===void 0?t(m,v,r|n,c,y):b))return!1}}return!0}return x0=a,x0}var b0,fP;function tD(){if(fP)return b0;fP=1;var e=sc();function t(r){return r===r&&!e(r)}return b0=t,b0}var _0,hP;function lz(){if(hP)return _0;hP=1;var e=tD(),t=Qv();function r(n){for(var a=t(n),o=a.length;o--;){var s=a[o],l=n[s];a[o]=[s,l,e(l)]}return a}return _0=r,_0}var w0,pP;function rD(){if(pP)return w0;pP=1;function e(t,r){return function(n){return n==null?!1:n[t]===r&&(r!==void 0||t in Object(n))}}return w0=e,w0}var j0,mP;function cz(){if(mP)return j0;mP=1;var e=sz(),t=lz(),r=rD();function n(a){var o=t(a);return o.length==1&&o[0][2]?r(o[0][0],o[0][1]):function(s){return s===a||e(s,a,o)}}return j0=n,j0}var S0,gP;function uz(){if(gP)return S0;gP=1;function e(t,r){return t!=null&&r in Object(t)}return S0=e,S0}var C0,vP;function dz(){if(vP)return C0;vP=1;var e=_N(),t=bj(),r=eo(),n=_j(),a=wj(),o=Hv();function s(l,c,u){c=e(c,l);for(var d=-1,f=c.length,h=!1;++d<f;){var p=o(c[d]);if(!(h=l!=null&&u(l,p)))break;l=l[p]}return h||++d!=f?h:(f=l==null?0:l.length,!!f&&a(f)&&n(p,f)&&(r(l)||t(l)))}return C0=s,C0}var A0,yP;function fz(){if(yP)return A0;yP=1;var e=uz(),t=dz();function r(n,a){return n!=null&&t(n,a,e)}return A0=r,A0}var P0,xP;function hz(){if(xP)return P0;xP=1;var e=jj(),t=wN(),r=fz(),n=ij(),a=tD(),o=rD(),s=Hv(),l=1,c=2;function u(d,f){return n(d)&&a(f)?o(s(d),f):function(h){var p=t(h,d);return p===void 0&&p===f?r(h,d):e(f,p,l|c)}}return P0=u,P0}var O0,bP;function Fd(){if(bP)return O0;bP=1;function e(t){return t}return O0=e,O0}var k0,_P;function pz(){if(_P)return k0;_P=1;function e(t){return function(r){return r?.[t]}}return k0=e,k0}var E0,wP;function mz(){if(wP)return E0;wP=1;var e=dj();function t(r){return function(n){return e(n,r)}}return E0=t,E0}var T0,jP;function gz(){if(jP)return T0;jP=1;var e=pz(),t=mz(),r=ij(),n=Hv();function a(o){return r(o)?e(n(o)):t(o)}return T0=a,T0}var I0,SP;function Rs(){if(SP)return I0;SP=1;var e=cz(),t=hz(),r=Fd(),n=eo(),a=gz();function o(s){return typeof s=="function"?s:s==null?r:typeof s=="object"?n(s)?t(s[0],s[1]):e(s):a(s)}return I0=o,I0}var N0,CP;function nD(){if(CP)return N0;CP=1;function e(t,r,n,a){for(var o=t.length,s=n+(a?1:-1);a?s--:++s<o;)if(r(t[s],s,t))return s;return-1}return N0=e,N0}var D0,AP;function vz(){if(AP)return D0;AP=1;function e(t){return t!==t}return D0=e,D0}var M0,PP;function yz(){if(PP)return M0;PP=1;function e(t,r,n){for(var a=n-1,o=t.length;++a<o;)if(t[a]===r)return a;return-1}return M0=e,M0}var L0,OP;function xz(){if(OP)return L0;OP=1;var e=nD(),t=vz(),r=yz();function n(a,o,s){return o===o?r(a,o,s):e(a,t,s)}return L0=n,L0}var R0,kP;function bz(){if(kP)return R0;kP=1;var e=xz();function t(r,n){var a=r==null?0:r.length;return!!a&&e(r,n,0)>-1}return R0=t,R0}var q0,EP;function _z(){if(EP)return q0;EP=1;function e(t,r,n){for(var a=-1,o=t==null?0:t.length;++a<o;)if(n(r,t[a]))return!0;return!1}return q0=e,q0}var F0,TP;function wz(){if(TP)return F0;TP=1;function e(){}return F0=e,F0}var $0,IP;function jz(){if(IP)return $0;IP=1;var e=eD(),t=wz(),r=xj(),n=1/0,a=e&&1/r(new e([,-0]))[1]==n?function(o){return new e(o)}:t;return $0=a,$0}var B0,NP;function Sz(){if(NP)return B0;NP=1;var e=HN(),t=bz(),r=_z(),n=GN(),a=jz(),o=xj(),s=200;function l(c,u,d){var f=-1,h=t,p=c.length,v=!0,m=[],y=m;if(d)v=!1,h=r;else if(p>=s){var b=u?null:a(c);if(b)return o(b);v=!1,h=n,y=new e}else y=u?[]:m;e:for(;++f<p;){var _=c[f],w=u?u(_):_;if(_=d||_!==0?_:0,v&&w===w){for(var A=y.length;A--;)if(y[A]===w)continue e;u&&y.push(w),m.push(_)}else h(y,w,d)||(y!==m&&y.push(w),m.push(_))}return m}return B0=l,B0}var U0,DP;function Cz(){if(DP)return U0;DP=1;var e=Rs(),t=Sz();function r(n,a){return n&&n.length?t(n,e(a,2)):[]}return U0=r,U0}var Az=Cz();const MP=Et(Az);function aD(e,t,r){return t===!0?MP(e,r):Tr(t)?MP(e,t):e}function rd(e){"@babel/helpers - typeof";return rd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rd(e)}var Pz=["ref"];function LP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Js(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?LP(Object(r),!0).forEach(function(n){Xv(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):LP(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Oz(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function RP(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,oD(n.key),n)}}function kz(e,t,r){return t&&RP(e.prototype,t),r&&RP(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ez(e,t,r){return t=jg(t),Tz(e,iD()?Reflect.construct(t,r||[],jg(e).constructor):t.apply(e,r))}function Tz(e,t){if(t&&(rd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Iz(e)}function Iz(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function iD(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(iD=function(){return!!e})()}function jg(e){return jg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},jg(e)}function Nz(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c_(e,t)}function c_(e,t){return c_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},c_(e,t)}function Xv(e,t,r){return t=oD(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oD(e){var t=Dz(e,"string");return rd(t)=="symbol"?t:t+""}function Dz(e,t){if(rd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(rd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Mz(e,t){if(e==null)return{};var r=Lz(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Lz(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Rz(e){return e.value}function qz(e,t){if(Ae.isValidElement(e))return Ae.cloneElement(e,t);if(typeof e=="function")return Ae.createElement(e,t);t.ref;var r=Mz(t,Pz);return Ae.createElement(yj,r)}var qP=1,Ss=function(e){function t(){var r;Oz(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return r=Ez(this,t,[].concat(a)),Xv(r,"lastBoundingBox",{width:-1,height:-1}),r}return Nz(t,e),kz(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,a=this.getBBox();a?(Math.abs(a.width-this.lastBoundingBox.width)>qP||Math.abs(a.height-this.lastBoundingBox.height)>qP)&&(this.lastBoundingBox.width=a.width,this.lastBoundingBox.height=a.height,n&&n(a)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?Js({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var a=this.props,o=a.layout,s=a.align,l=a.verticalAlign,c=a.margin,u=a.chartWidth,d=a.chartHeight,f,h;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(s==="center"&&o==="vertical"){var p=this.getBBoxSnapshot();f={left:((u||0)-p.width)/2}}else f=s==="right"?{right:c&&c.right||0}:{left:c&&c.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(l==="middle"){var v=this.getBBoxSnapshot();h={top:((d||0)-v.height)/2}}else h=l==="bottom"?{bottom:c&&c.bottom||0}:{top:c&&c.top||0};return Js(Js({},f),h)}},{key:"render",value:function(){var n=this,a=this.props,o=a.content,s=a.width,l=a.height,c=a.wrapperStyle,u=a.payloadUniqBy,d=a.payload,f=Js(Js({position:"absolute",width:s||"auto",height:l||"auto"},this.getDefaultPosition(c)),c);return Ae.createElement("div",{className:"recharts-legend-wrapper",style:f,ref:function(p){n.wrapperNode=p}},qz(o,Js(Js({},this.props),{},{payload:aD(d,u,Rz)})))}}],[{key:"getWithHeight",value:function(n,a){var o=Js(Js({},this.defaultProps),n.props),s=o.layout;return s==="vertical"&&Dt(n.props.height)?{height:n.props.height}:s==="horizontal"?{width:n.props.width||a}:null}}])}(x.PureComponent);Xv(Ss,"displayName","Legend");Xv(Ss,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var z0,FP;function Fz(){if(FP)return z0;FP=1;var e=Dp(),t=bj(),r=eo(),n=e?e.isConcatSpreadable:void 0;function a(o){return r(o)||t(o)||!!(n&&o&&o[n])}return z0=a,z0}var W0,$P;function sD(){if($P)return W0;$P=1;var e=KN(),t=Fz();function r(n,a,o,s,l){var c=-1,u=n.length;for(o||(o=t),l||(l=[]);++c<u;){var d=n[c];a>0&&o(d)?a>1?r(d,a-1,o,s,l):e(l,d):s||(l[l.length]=d)}return l}return W0=r,W0}var H0,BP;function $z(){if(BP)return H0;BP=1;function e(t){return function(r,n,a){for(var o=-1,s=Object(r),l=a(r),c=l.length;c--;){var u=l[t?c:++o];if(n(s[u],u,s)===!1)break}return r}}return H0=e,H0}var V0,UP;function Bz(){if(UP)return V0;UP=1;var e=$z(),t=e();return V0=t,V0}var G0,zP;function lD(){if(zP)return G0;zP=1;var e=Bz(),t=Qv();function r(n,a){return n&&e(n,a,t)}return G0=r,G0}var Y0,WP;function Uz(){if(WP)return Y0;WP=1;var e=Lp();function t(r,n){return function(a,o){if(a==null)return a;if(!e(a))return r(a,o);for(var s=a.length,l=n?s:-1,c=Object(a);(n?l--:++l<s)&&o(c[l],l,c)!==!1;);return a}}return Y0=t,Y0}var K0,HP;function Sj(){if(HP)return K0;HP=1;var e=lD(),t=Uz(),r=t(e);return K0=r,K0}var Q0,VP;function cD(){if(VP)return Q0;VP=1;var e=Sj(),t=Lp();function r(n,a){var o=-1,s=t(n)?Array(n.length):[];return e(n,function(l,c,u){s[++o]=a(l,c,u)}),s}return Q0=r,Q0}var X0,GP;function zz(){if(GP)return X0;GP=1;function e(t,r){var n=t.length;for(t.sort(r);n--;)t[n]=t[n].value;return t}return X0=e,X0}var J0,YP;function Wz(){if(YP)return J0;YP=1;var e=Ld();function t(r,n){if(r!==n){var a=r!==void 0,o=r===null,s=r===r,l=e(r),c=n!==void 0,u=n===null,d=n===n,f=e(n);if(!u&&!f&&!l&&r>n||l&&c&&d&&!u&&!f||o&&c&&d||!a&&d||!s)return 1;if(!o&&!l&&!f&&r<n||f&&a&&s&&!o&&!l||u&&a&&s||!c&&s||!d)return-1}return 0}return J0=t,J0}var Z0,KP;function Hz(){if(KP)return Z0;KP=1;var e=Wz();function t(r,n,a){for(var o=-1,s=r.criteria,l=n.criteria,c=s.length,u=a.length;++o<c;){var d=e(s[o],l[o]);if(d){if(o>=u)return d;var f=a[o];return d*(f=="desc"?-1:1)}}return r.index-n.index}return Z0=t,Z0}var e1,QP;function Vz(){if(QP)return e1;QP=1;var e=uj(),t=dj(),r=Rs(),n=cD(),a=zz(),o=XN(),s=Hz(),l=Fd(),c=eo();function u(d,f,h){f.length?f=e(f,function(m){return c(m)?function(y){return t(y,m.length===1?m[0]:m)}:m}):f=[l];var p=-1;f=e(f,o(r));var v=n(d,function(m,y,b){var _=e(f,function(w){return w(m)});return{criteria:_,index:++p,value:m}});return a(v,function(m,y){return s(m,y,h)})}return e1=u,e1}var t1,XP;function Gz(){if(XP)return t1;XP=1;function e(t,r,n){switch(n.length){case 0:return t.call(r);case 1:return t.call(r,n[0]);case 2:return t.call(r,n[0],n[1]);case 3:return t.call(r,n[0],n[1],n[2])}return t.apply(r,n)}return t1=e,t1}var r1,JP;function Yz(){if(JP)return r1;JP=1;var e=Gz(),t=Math.max;function r(n,a,o){return a=t(a===void 0?n.length-1:a,0),function(){for(var s=arguments,l=-1,c=t(s.length-a,0),u=Array(c);++l<c;)u[l]=s[a+l];l=-1;for(var d=Array(a+1);++l<a;)d[l]=s[l];return d[a]=o(u),e(n,this,d)}}return r1=r,r1}var n1,ZP;function Kz(){if(ZP)return n1;ZP=1;function e(t){return function(){return t}}return n1=e,n1}var a1,eO;function uD(){if(eO)return a1;eO=1;var e=au(),t=function(){try{var r=e(Object,"defineProperty");return r({},"",{}),r}catch{}}();return a1=t,a1}var i1,tO;function Qz(){if(tO)return i1;tO=1;var e=Kz(),t=uD(),r=Fd(),n=t?function(a,o){return t(a,"toString",{configurable:!0,enumerable:!1,value:e(o),writable:!0})}:r;return i1=n,i1}var o1,rO;function Xz(){if(rO)return o1;rO=1;var e=800,t=16,r=Date.now;function n(a){var o=0,s=0;return function(){var l=r(),c=t-(l-s);if(s=l,c>0){if(++o>=e)return arguments[0]}else o=0;return a.apply(void 0,arguments)}}return o1=n,o1}var s1,nO;function Jz(){if(nO)return s1;nO=1;var e=Qz(),t=Xz(),r=t(e);return s1=r,s1}var l1,aO;function Zz(){if(aO)return l1;aO=1;var e=Fd(),t=Yz(),r=Jz();function n(a,o){return r(t(a,o,e),a+"")}return l1=n,l1}var c1,iO;function Jv(){if(iO)return c1;iO=1;var e=sj(),t=Lp(),r=_j(),n=sc();function a(o,s,l){if(!n(l))return!1;var c=typeof s;return(c=="number"?t(l)&&r(s,l.length):c=="string"&&s in l)?e(l[s],o):!1}return c1=a,c1}var u1,oO;function eW(){if(oO)return u1;oO=1;var e=sD(),t=Vz(),r=Zz(),n=Jv(),a=r(function(o,s){if(o==null)return[];var l=s.length;return l>1&&n(o,s[0],s[1])?s=[]:l>2&&n(s[0],s[1],s[2])&&(s=[s[0]]),t(o,e(s,1),[])});return u1=a,u1}var tW=eW();const Cj=Et(tW);function Vh(e){"@babel/helpers - typeof";return Vh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vh(e)}function u_(){return u_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u_.apply(this,arguments)}function rW(e,t){return oW(e)||iW(e,t)||aW(e,t)||nW()}function nW(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aW(e,t){if(e){if(typeof e=="string")return sO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sO(e,t)}}function sO(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function iW(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function oW(e){if(Array.isArray(e))return e}function lO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function d1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?lO(Object(r),!0).forEach(function(n){sW(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lO(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sW(e,t,r){return t=lW(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lW(e){var t=cW(e,"string");return Vh(t)=="symbol"?t:t+""}function cW(e,t){if(Vh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Vh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function uW(e){return Array.isArray(e)&&Ha(e[0])&&Ha(e[1])?e.join(" ~ "):e}var dW=function(t){var r=t.separator,n=r===void 0?" : ":r,a=t.contentStyle,o=a===void 0?{}:a,s=t.itemStyle,l=s===void 0?{}:s,c=t.labelStyle,u=c===void 0?{}:c,d=t.payload,f=t.formatter,h=t.itemSorter,p=t.wrapperClassName,v=t.labelClassName,m=t.label,y=t.labelFormatter,b=t.accessibilityLayer,_=b===void 0?!1:b,w=function(){if(d&&d.length){var M={padding:0,margin:0},L=(h?Cj(d,h):d).map(function(q,z){if(q.type==="none")return null;var K=d1({display:"block",paddingTop:4,paddingBottom:4,color:q.color||"#000"},l),J=q.formatter||f||uW,R=q.value,k=q.name,$=R,X=k;if(J&&$!=null&&X!=null){var C=J(R,k,q,z,d);if(Array.isArray(C)){var N=rW(C,2);$=N[0],X=N[1]}else $=C}return Ae.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(z),style:K},Ha(X)?Ae.createElement("span",{className:"recharts-tooltip-item-name"},X):null,Ha(X)?Ae.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,Ae.createElement("span",{className:"recharts-tooltip-item-value"},$),Ae.createElement("span",{className:"recharts-tooltip-item-unit"},q.unit||""))});return Ae.createElement("ul",{className:"recharts-tooltip-item-list",style:M},L)}return null},A=d1({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},o),P=d1({margin:0},u),E=!Fr(m),T=E?m:"",S=Pr("recharts-default-tooltip",p),I=Pr("recharts-tooltip-label",v);E&&y&&d!==void 0&&d!==null&&(T=y(m,d));var U=_?{role:"status","aria-live":"assertive"}:{};return Ae.createElement("div",u_({className:S,style:A},U),Ae.createElement("p",{className:I,style:P},Ae.isValidElement(T)?T:"".concat(T)),w())};function Gh(e){"@babel/helpers - typeof";return Gh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gh(e)}function vm(e,t,r){return t=fW(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fW(e){var t=hW(e,"string");return Gh(t)=="symbol"?t:t+""}function hW(e,t){if(Gh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Gh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var uf="recharts-tooltip-wrapper",pW={visibility:"hidden"};function mW(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return Pr(uf,vm(vm(vm(vm({},"".concat(uf,"-right"),Dt(r)&&t&&Dt(t.x)&&r>=t.x),"".concat(uf,"-left"),Dt(r)&&t&&Dt(t.x)&&r<t.x),"".concat(uf,"-bottom"),Dt(n)&&t&&Dt(t.y)&&n>=t.y),"".concat(uf,"-top"),Dt(n)&&t&&Dt(t.y)&&n<t.y))}function cO(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,a=e.offsetTopLeft,o=e.position,s=e.reverseDirection,l=e.tooltipDimension,c=e.viewBox,u=e.viewBoxDimension;if(o&&Dt(o[n]))return o[n];var d=r[n]-l-a,f=r[n]+a;if(t[n])return s[n]?d:f;if(s[n]){var h=d,p=c[n];return h<p?Math.max(f,c[n]):Math.max(d,c[n])}var v=f+l,m=c[n]+u;return v>m?Math.max(d,c[n]):Math.max(f,c[n])}function gW(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function vW(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,a=e.position,o=e.reverseDirection,s=e.tooltipBox,l=e.useTranslate3d,c=e.viewBox,u,d,f;return s.height>0&&s.width>0&&r?(d=cO({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:a,reverseDirection:o,tooltipDimension:s.width,viewBox:c,viewBoxDimension:c.width}),f=cO({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:a,reverseDirection:o,tooltipDimension:s.height,viewBox:c,viewBoxDimension:c.height}),u=gW({translateX:d,translateY:f,useTranslate3d:l})):u=pW,{cssProperties:u,cssClasses:mW({translateX:d,translateY:f,coordinate:r})}}function nd(e){"@babel/helpers - typeof";return nd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nd(e)}function uO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function dO(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uO(Object(r),!0).forEach(function(n){f_(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uO(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yW(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xW(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,fD(n.key),n)}}function bW(e,t,r){return t&&xW(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _W(e,t,r){return t=Sg(t),wW(e,dD()?Reflect.construct(t,r||[],Sg(e).constructor):t.apply(e,r))}function wW(e,t){if(t&&(nd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return jW(e)}function jW(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function dD(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(dD=function(){return!!e})()}function Sg(e){return Sg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Sg(e)}function SW(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d_(e,t)}function d_(e,t){return d_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},d_(e,t)}function f_(e,t,r){return t=fD(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fD(e){var t=CW(e,"string");return nd(t)=="symbol"?t:t+""}function CW(e,t){if(nd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(nd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var fO=1,AW=function(e){function t(){var r;yW(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return r=_W(this,t,[].concat(a)),f_(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),f_(r,"handleKeyDown",function(s){if(s.key==="Escape"){var l,c,u,d;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(l=(c=r.props.coordinate)===null||c===void 0?void 0:c.x)!==null&&l!==void 0?l:0,y:(u=(d=r.props.coordinate)===null||d===void 0?void 0:d.y)!==null&&u!==void 0?u:0}})}}),r}return SW(t,e),bW(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>fO||Math.abs(n.height-this.state.lastBoundingBox.height)>fO)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,a;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((a=this.props.coordinate)===null||a===void 0?void 0:a.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,a=this.props,o=a.active,s=a.allowEscapeViewBox,l=a.animationDuration,c=a.animationEasing,u=a.children,d=a.coordinate,f=a.hasPayload,h=a.isAnimationActive,p=a.offset,v=a.position,m=a.reverseDirection,y=a.useTranslate3d,b=a.viewBox,_=a.wrapperStyle,w=vW({allowEscapeViewBox:s,coordinate:d,offsetTopLeft:p,position:v,reverseDirection:m,tooltipBox:this.state.lastBoundingBox,useTranslate3d:y,viewBox:b}),A=w.cssClasses,P=w.cssProperties,E=dO(dO({transition:h&&o?"transform ".concat(l,"ms ").concat(c):void 0},P),{},{pointerEvents:"none",visibility:!this.state.dismissed&&o&&f?"visible":"hidden",position:"absolute",top:0,left:0},_);return Ae.createElement("div",{tabIndex:-1,className:A,style:E,ref:function(S){n.wrapperNode=S}},u)}}])}(x.PureComponent),PW=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},iu={isSsr:PW()};function ad(e){"@babel/helpers - typeof";return ad=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ad(e)}function hO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function pO(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hO(Object(r),!0).forEach(function(n){Aj(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hO(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function OW(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kW(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,pD(n.key),n)}}function EW(e,t,r){return t&&kW(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function TW(e,t,r){return t=Cg(t),IW(e,hD()?Reflect.construct(t,r||[],Cg(e).constructor):t.apply(e,r))}function IW(e,t){if(t&&(ad(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return NW(e)}function NW(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hD(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hD=function(){return!!e})()}function Cg(e){return Cg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Cg(e)}function DW(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h_(e,t)}function h_(e,t){return h_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},h_(e,t)}function Aj(e,t,r){return t=pD(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pD(e){var t=MW(e,"string");return ad(t)=="symbol"?t:t+""}function MW(e,t){if(ad(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ad(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function LW(e){return e.dataKey}function RW(e,t){return Ae.isValidElement(e)?Ae.cloneElement(e,t):typeof e=="function"?Ae.createElement(e,t):Ae.createElement(dW,t)}var xo=function(e){function t(){return OW(this,t),TW(this,t,arguments)}return DW(t,e),EW(t,[{key:"render",value:function(){var n=this,a=this.props,o=a.active,s=a.allowEscapeViewBox,l=a.animationDuration,c=a.animationEasing,u=a.content,d=a.coordinate,f=a.filterNull,h=a.isAnimationActive,p=a.offset,v=a.payload,m=a.payloadUniqBy,y=a.position,b=a.reverseDirection,_=a.useTranslate3d,w=a.viewBox,A=a.wrapperStyle,P=v??[];f&&P.length&&(P=aD(v.filter(function(T){return T.value!=null&&(T.hide!==!0||n.props.includeHidden)}),m,LW));var E=P.length>0;return Ae.createElement(AW,{allowEscapeViewBox:s,animationDuration:l,animationEasing:c,isAnimationActive:h,active:o,coordinate:d,hasPayload:E,offset:p,position:y,reverseDirection:b,useTranslate3d:_,viewBox:w,wrapperStyle:A},RW(u,pO(pO({},this.props),{},{payload:P})))}}])}(x.PureComponent);Aj(xo,"displayName","Tooltip");Aj(xo,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!iu.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var f1,mO;function qW(){if(mO)return f1;mO=1;var e=Ls(),t=function(){return e.Date.now()};return f1=t,f1}var h1,gO;function FW(){if(gO)return h1;gO=1;var e=/\s/;function t(r){for(var n=r.length;n--&&e.test(r.charAt(n)););return n}return h1=t,h1}var p1,vO;function $W(){if(vO)return p1;vO=1;var e=FW(),t=/^\s+/;function r(n){return n&&n.slice(0,e(n)+1).replace(t,"")}return p1=r,p1}var m1,yO;function mD(){if(yO)return m1;yO=1;var e=$W(),t=sc(),r=Ld(),n=NaN,a=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,s=/^0o[0-7]+$/i,l=parseInt;function c(u){if(typeof u=="number")return u;if(r(u))return n;if(t(u)){var d=typeof u.valueOf=="function"?u.valueOf():u;u=t(d)?d+"":d}if(typeof u!="string")return u===0?u:+u;u=e(u);var f=o.test(u);return f||s.test(u)?l(u.slice(2),f?2:8):a.test(u)?n:+u}return m1=c,m1}var g1,xO;function BW(){if(xO)return g1;xO=1;var e=sc(),t=qW(),r=mD(),n="Expected a function",a=Math.max,o=Math.min;function s(l,c,u){var d,f,h,p,v,m,y=0,b=!1,_=!1,w=!0;if(typeof l!="function")throw new TypeError(n);c=r(c)||0,e(u)&&(b=!!u.leading,_="maxWait"in u,h=_?a(r(u.maxWait)||0,c):h,w="trailing"in u?!!u.trailing:w);function A(L){var q=d,z=f;return d=f=void 0,y=L,p=l.apply(z,q),p}function P(L){return y=L,v=setTimeout(S,c),b?A(L):p}function E(L){var q=L-m,z=L-y,K=c-q;return _?o(K,h-z):K}function T(L){var q=L-m,z=L-y;return m===void 0||q>=c||q<0||_&&z>=h}function S(){var L=t();if(T(L))return I(L);v=setTimeout(S,E(L))}function I(L){return v=void 0,w&&d?A(L):(d=f=void 0,p)}function U(){v!==void 0&&clearTimeout(v),y=0,d=m=f=v=void 0}function O(){return v===void 0?p:I(t())}function M(){var L=t(),q=T(L);if(d=arguments,f=this,m=L,q){if(v===void 0)return P(m);if(_)return clearTimeout(v),v=setTimeout(S,c),A(m)}return v===void 0&&(v=setTimeout(S,c)),p}return M.cancel=U,M.flush=O,M}return g1=s,g1}var v1,bO;function UW(){if(bO)return v1;bO=1;var e=BW(),t=sc(),r="Expected a function";function n(a,o,s){var l=!0,c=!0;if(typeof a!="function")throw new TypeError(r);return t(s)&&(l="leading"in s?!!s.leading:l,c="trailing"in s?!!s.trailing:c),e(a,o,{leading:l,maxWait:o,trailing:c})}return v1=n,v1}var zW=UW();const gD=Et(zW);function Yh(e){"@babel/helpers - typeof";return Yh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yh(e)}function _O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ym(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_O(Object(r),!0).forEach(function(n){WW(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_O(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function WW(e,t,r){return t=HW(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function HW(e){var t=VW(e,"string");return Yh(t)=="symbol"?t:t+""}function VW(e,t){if(Yh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Yh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function GW(e,t){return XW(e)||QW(e,t)||KW(e,t)||YW()}function YW(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function KW(e,t){if(e){if(typeof e=="string")return wO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wO(e,t)}}function wO(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function QW(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function XW(e){if(Array.isArray(e))return e}var vD=x.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,a=n===void 0?{width:-1,height:-1}:n,o=e.width,s=o===void 0?"100%":o,l=e.height,c=l===void 0?"100%":l,u=e.minWidth,d=u===void 0?0:u,f=e.minHeight,h=e.maxHeight,p=e.children,v=e.debounce,m=v===void 0?0:v,y=e.id,b=e.className,_=e.onResize,w=e.style,A=w===void 0?{}:w,P=x.useRef(null),E=x.useRef();E.current=_,x.useImperativeHandle(t,function(){return Object.defineProperty(P.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),P.current},configurable:!0})});var T=x.useState({containerWidth:a.width,containerHeight:a.height}),S=GW(T,2),I=S[0],U=S[1],O=x.useCallback(function(L,q){U(function(z){var K=Math.round(L),J=Math.round(q);return z.containerWidth===K&&z.containerHeight===J?z:{containerWidth:K,containerHeight:J}})},[]);x.useEffect(function(){var L=function(k){var $,X=k[0].contentRect,C=X.width,N=X.height;O(C,N),($=E.current)===null||$===void 0||$.call(E,C,N)};m>0&&(L=gD(L,m,{trailing:!0,leading:!1}));var q=new ResizeObserver(L),z=P.current.getBoundingClientRect(),K=z.width,J=z.height;return O(K,J),q.observe(P.current),function(){q.disconnect()}},[O,m]);var M=x.useMemo(function(){var L=I.containerWidth,q=I.containerHeight;if(L<0||q<0)return null;is(Mc(s)||Mc(c),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,s,c),is(!r||r>0,"The aspect(%s) must be greater than zero.",r);var z=Mc(s)?L:s,K=Mc(c)?q:c;r&&r>0&&(z?K=z/r:K&&(z=K*r),h&&K>h&&(K=h)),is(z>0||K>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,z,K,s,c,d,f,r);var J=!Array.isArray(p)&&ul(p.type).endsWith("Chart");return Ae.Children.map(p,function(R){return Ae.isValidElement(R)?x.cloneElement(R,ym({width:z,height:K},J?{style:ym({height:"100%",width:"100%",maxHeight:K,maxWidth:z},R.props.style)}:{})):R})},[r,p,c,h,f,d,I,s]);return Ae.createElement("div",{id:y?"".concat(y):void 0,className:Pr("recharts-responsive-container",b),style:ym(ym({},A),{},{width:s,height:c,minWidth:d,minHeight:f,maxHeight:h}),ref:P},M)}),Zv=function(t){return null};Zv.displayName="Cell";function Kh(e){"@babel/helpers - typeof";return Kh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kh(e)}function jO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function p_(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jO(Object(r),!0).forEach(function(n){JW(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jO(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function JW(e,t,r){return t=ZW(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ZW(e){var t=e9(e,"string");return Kh(t)=="symbol"?t:t+""}function e9(e,t){if(Kh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Kh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var xu={widthCache:{},cacheCount:0},t9=2e3,r9={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},SO="recharts_measurement_span";function n9(e){var t=p_({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var kh=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||iu.isSsr)return{width:0,height:0};var n=n9(r),a=JSON.stringify({text:t,copyStyle:n});if(xu.widthCache[a])return xu.widthCache[a];try{var o=document.getElementById(SO);o||(o=document.createElement("span"),o.setAttribute("id",SO),o.setAttribute("aria-hidden","true"),document.body.appendChild(o));var s=p_(p_({},r9),n);Object.assign(o.style,s),o.textContent="".concat(t);var l=o.getBoundingClientRect(),c={width:l.width,height:l.height};return xu.widthCache[a]=c,++xu.cacheCount>t9&&(xu.cacheCount=0,xu.widthCache={}),c}catch{return{width:0,height:0}}},a9=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function Qh(e){"@babel/helpers - typeof";return Qh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qh(e)}function Ag(e,t){return l9(e)||s9(e,t)||o9(e,t)||i9()}function i9(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function o9(e,t){if(e){if(typeof e=="string")return CO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return CO(e,t)}}function CO(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function s9(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function l9(e){if(Array.isArray(e))return e}function c9(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function AO(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d9(n.key),n)}}function u9(e,t,r){return t&&AO(e.prototype,t),r&&AO(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function d9(e){var t=f9(e,"string");return Qh(t)=="symbol"?t:t+""}function f9(e,t){if(Qh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Qh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var PO=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,OO=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,h9=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,p9=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,yD={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},m9=Object.keys(yD),Iu="NaN";function g9(e,t){return e*yD[t]}var xm=function(){function e(t,r){c9(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!h9.test(r)&&(this.num=NaN,this.unit=""),m9.includes(r)&&(this.num=g9(t,r),this.unit="px")}return u9(e,[{key:"add",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var n,a=(n=p9.exec(r))!==null&&n!==void 0?n:[],o=Ag(a,3),s=o[1],l=o[2];return new e(parseFloat(s),l??"")}}])}();function xD(e){if(e.includes(Iu))return Iu;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=PO.exec(t))!==null&&r!==void 0?r:[],a=Ag(n,4),o=a[1],s=a[2],l=a[3],c=xm.parse(o??""),u=xm.parse(l??""),d=s==="*"?c.multiply(u):c.divide(u);if(d.isNaN())return Iu;t=t.replace(PO,d.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var f,h=(f=OO.exec(t))!==null&&f!==void 0?f:[],p=Ag(h,4),v=p[1],m=p[2],y=p[3],b=xm.parse(v??""),_=xm.parse(y??""),w=m==="+"?b.add(_):b.subtract(_);if(w.isNaN())return Iu;t=t.replace(OO,w.toString())}return t}var kO=/\(([^()]*)\)/;function v9(e){for(var t=e;t.includes("(");){var r=kO.exec(t),n=Ag(r,2),a=n[1];t=t.replace(kO,xD(a))}return t}function y9(e){var t=e.replace(/\s+/g,"");return t=v9(t),t=xD(t),t}function x9(e){try{return y9(e)}catch{return Iu}}function y1(e){var t=x9(e.slice(5,-1));return t===Iu?"":t}var b9=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],_9=["dx","dy","angle","className","breakAll"];function m_(){return m_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},m_.apply(this,arguments)}function EO(e,t){if(e==null)return{};var r=w9(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function w9(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function TO(e,t){return A9(e)||C9(e,t)||S9(e,t)||j9()}function j9(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function S9(e,t){if(e){if(typeof e=="string")return IO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return IO(e,t)}}function IO(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function C9(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function A9(e){if(Array.isArray(e))return e}var bD=/[ \f\n\r\t\v\u2028\u2029]+/,_D=function(t){var r=t.children,n=t.breakAll,a=t.style;try{var o=[];Fr(r)||(n?o=r.toString().split(""):o=r.toString().split(bD));var s=o.map(function(c){return{word:c,width:kh(c,a).width}}),l=n?0:kh("",a).width;return{wordsWithComputedWidth:s,spaceWidth:l}}catch{return null}},P9=function(t,r,n,a,o){var s=t.maxLines,l=t.children,c=t.style,u=t.breakAll,d=Dt(s),f=l,h=function(){var z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return z.reduce(function(K,J){var R=J.word,k=J.width,$=K[K.length-1];if($&&(a==null||o||$.width+k+n<Number(a)))$.words.push(R),$.width+=k+n;else{var X={words:[R],width:k};K.push(X)}return K},[])},p=h(r),v=function(z){return z.reduce(function(K,J){return K.width>J.width?K:J})};if(!d)return p;for(var m="",y=function(z){var K=f.slice(0,z),J=_D({breakAll:u,style:c,children:K+m}).wordsWithComputedWidth,R=h(J),k=R.length>s||v(R).width>Number(a);return[k,R]},b=0,_=f.length-1,w=0,A;b<=_&&w<=f.length-1;){var P=Math.floor((b+_)/2),E=P-1,T=y(E),S=TO(T,2),I=S[0],U=S[1],O=y(P),M=TO(O,1),L=M[0];if(!I&&!L&&(b=P+1),I&&L&&(_=P-1),!I&&L){A=U;break}w++}return A||p},NO=function(t){var r=Fr(t)?[]:t.toString().split(bD);return[{words:r}]},O9=function(t){var r=t.width,n=t.scaleToFit,a=t.children,o=t.style,s=t.breakAll,l=t.maxLines;if((r||n)&&!iu.isSsr){var c,u,d=_D({breakAll:s,children:a,style:o});if(d){var f=d.wordsWithComputedWidth,h=d.spaceWidth;c=f,u=h}else return NO(a);return P9({breakAll:s,children:a,maxLines:l,style:o},c,u,r,n)}return NO(a)},DO="#808080",Kc=function(t){var r=t.x,n=r===void 0?0:r,a=t.y,o=a===void 0?0:a,s=t.lineHeight,l=s===void 0?"1em":s,c=t.capHeight,u=c===void 0?"0.71em":c,d=t.scaleToFit,f=d===void 0?!1:d,h=t.textAnchor,p=h===void 0?"start":h,v=t.verticalAnchor,m=v===void 0?"end":v,y=t.fill,b=y===void 0?DO:y,_=EO(t,b9),w=x.useMemo(function(){return O9({breakAll:_.breakAll,children:_.children,maxLines:_.maxLines,scaleToFit:f,style:_.style,width:_.width})},[_.breakAll,_.children,_.maxLines,f,_.style,_.width]),A=_.dx,P=_.dy,E=_.angle,T=_.className,S=_.breakAll,I=EO(_,_9);if(!Ha(n)||!Ha(o))return null;var U=n+(Dt(A)?A:0),O=o+(Dt(P)?P:0),M;switch(m){case"start":M=y1("calc(".concat(u,")"));break;case"middle":M=y1("calc(".concat((w.length-1)/2," * -").concat(l," + (").concat(u," / 2))"));break;default:M=y1("calc(".concat(w.length-1," * -").concat(l,")"));break}var L=[];if(f){var q=w[0].width,z=_.width;L.push("scale(".concat((Dt(z)?z/q:1)/q,")"))}return E&&L.push("rotate(".concat(E,", ").concat(U,", ").concat(O,")")),L.length&&(I.transform=L.join(" ")),Ae.createElement("text",m_({},gr(I,!0),{x:U,y:O,className:Pr("recharts-text",T),textAnchor:p,fill:b.includes("url")?DO:b}),w.map(function(K,J){var R=K.words.join(S?"":" ");return Ae.createElement("tspan",{x:U,dy:J===0?M:l,key:"".concat(R,"-").concat(J)},R)}))};function Jl(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function k9(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Pj(e){let t,r,n;e.length!==2?(t=Jl,r=(l,c)=>Jl(e(l),c),n=(l,c)=>e(l)-c):(t=e===Jl||e===k9?e:E9,r=e,n=e);function a(l,c,u=0,d=l.length){if(u<d){if(t(c,c)!==0)return d;do{const f=u+d>>>1;r(l[f],c)<0?u=f+1:d=f}while(u<d)}return u}function o(l,c,u=0,d=l.length){if(u<d){if(t(c,c)!==0)return d;do{const f=u+d>>>1;r(l[f],c)<=0?u=f+1:d=f}while(u<d)}return u}function s(l,c,u=0,d=l.length){const f=a(l,c,u,d-1);return f>u&&n(l[f-1],c)>-n(l[f],c)?f-1:f}return{left:a,center:s,right:o}}function E9(){return 0}function wD(e){return e===null?NaN:+e}function*T9(e,t){for(let r of e)r!=null&&(r=+r)>=r&&(yield r)}const I9=Pj(Jl),Rp=I9.right;Pj(wD).center;class MO extends Map{constructor(t,r=M9){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,a]of t)this.set(n,a)}get(t){return super.get(LO(this,t))}has(t){return super.has(LO(this,t))}set(t,r){return super.set(N9(this,t),r)}delete(t){return super.delete(D9(this,t))}}function LO({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function N9({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function D9({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function M9(e){return e!==null&&typeof e=="object"?e.valueOf():e}function L9(e=Jl){if(e===Jl)return jD;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function jD(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const R9=Math.sqrt(50),q9=Math.sqrt(10),F9=Math.sqrt(2);function Pg(e,t,r){const n=(t-e)/Math.max(0,r),a=Math.floor(Math.log10(n)),o=n/Math.pow(10,a),s=o>=R9?10:o>=q9?5:o>=F9?2:1;let l,c,u;return a<0?(u=Math.pow(10,-a)/s,l=Math.round(e*u),c=Math.round(t*u),l/u<e&&++l,c/u>t&&--c,u=-u):(u=Math.pow(10,a)*s,l=Math.round(e/u),c=Math.round(t/u),l*u<e&&++l,c*u>t&&--c),c<l&&.5<=r&&r<2?Pg(e,t,r*2):[l,c,u]}function g_(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[a,o,s]=n?Pg(t,e,r):Pg(e,t,r);if(!(o>=a))return[];const l=o-a+1,c=new Array(l);if(n)if(s<0)for(let u=0;u<l;++u)c[u]=(o-u)/-s;else for(let u=0;u<l;++u)c[u]=(o-u)*s;else if(s<0)for(let u=0;u<l;++u)c[u]=(a+u)/-s;else for(let u=0;u<l;++u)c[u]=(a+u)*s;return c}function v_(e,t,r){return t=+t,e=+e,r=+r,Pg(e,t,r)[2]}function y_(e,t,r){t=+t,e=+e,r=+r;const n=t<e,a=n?v_(t,e,r):v_(e,t,r);return(n?-1:1)*(a<0?1/-a:a)}function RO(e,t){let r;for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function qO(e,t){let r;for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function SD(e,t,r=0,n=1/0,a){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(a=a===void 0?jD:L9(a);n>r;){if(n-r>600){const c=n-r+1,u=t-r+1,d=Math.log(c),f=.5*Math.exp(2*d/3),h=.5*Math.sqrt(d*f*(c-f)/c)*(u-c/2<0?-1:1),p=Math.max(r,Math.floor(t-u*f/c+h)),v=Math.min(n,Math.floor(t+(c-u)*f/c+h));SD(e,t,p,v,a)}const o=e[t];let s=r,l=n;for(df(e,r,t),a(e[n],o)>0&&df(e,r,n);s<l;){for(df(e,s,l),++s,--l;a(e[s],o)<0;)++s;for(;a(e[l],o)>0;)--l}a(e[r],o)===0?df(e,r,l):(++l,df(e,l,n)),l<=t&&(r=l+1),t<=l&&(n=l-1)}return e}function df(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function $9(e,t,r){if(e=Float64Array.from(T9(e)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return qO(e);if(t>=1)return RO(e);var n,a=(n-1)*t,o=Math.floor(a),s=RO(SD(e,o).subarray(0,o+1)),l=qO(e.subarray(o+1));return s+(l-s)*(a-o)}}function B9(e,t,r=wD){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*t,o=Math.floor(a),s=+r(e[o],o,e),l=+r(e[o+1],o+1,e);return s+(l-s)*(a-o)}}function U9(e,t,r){e=+e,t=+t,r=(a=arguments.length)<2?(t=e,e=0,1):a<3?1:+r;for(var n=-1,a=Math.max(0,Math.ceil((t-e)/r))|0,o=new Array(a);++n<a;)o[n]=e+n*r;return o}function Go(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function wl(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const x_=Symbol("implicit");function Oj(){var e=new MO,t=[],r=[],n=x_;function a(o){let s=e.get(o);if(s===void 0){if(n!==x_)return n;e.set(o,s=t.push(o)-1)}return r[s%r.length]}return a.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new MO;for(const s of o)e.has(s)||e.set(s,t.push(s)-1);return a},a.range=function(o){return arguments.length?(r=Array.from(o),a):r.slice()},a.unknown=function(o){return arguments.length?(n=o,a):n},a.copy=function(){return Oj(t,r).unknown(n)},Go.apply(a,arguments),a}function Xh(){var e=Oj().unknown(void 0),t=e.domain,r=e.range,n=0,a=1,o,s,l=!1,c=0,u=0,d=.5;delete e.unknown;function f(){var h=t().length,p=a<n,v=p?a:n,m=p?n:a;o=(m-v)/Math.max(1,h-c+u*2),l&&(o=Math.floor(o)),v+=(m-v-o*(h-c))*d,s=o*(1-c),l&&(v=Math.round(v),s=Math.round(s));var y=U9(h).map(function(b){return v+o*b});return r(p?y.reverse():y)}return e.domain=function(h){return arguments.length?(t(h),f()):t()},e.range=function(h){return arguments.length?([n,a]=h,n=+n,a=+a,f()):[n,a]},e.rangeRound=function(h){return[n,a]=h,n=+n,a=+a,l=!0,f()},e.bandwidth=function(){return s},e.step=function(){return o},e.round=function(h){return arguments.length?(l=!!h,f()):l},e.padding=function(h){return arguments.length?(c=Math.min(1,u=+h),f()):c},e.paddingInner=function(h){return arguments.length?(c=Math.min(1,h),f()):c},e.paddingOuter=function(h){return arguments.length?(u=+h,f()):u},e.align=function(h){return arguments.length?(d=Math.max(0,Math.min(1,h)),f()):d},e.copy=function(){return Xh(t(),[n,a]).round(l).paddingInner(c).paddingOuter(u).align(d)},Go.apply(f(),arguments)}function CD(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return CD(t())},e}function Eh(){return CD(Xh.apply(null,arguments).paddingInner(1))}function kj(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function AD(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function qp(){}var Jh=.7,Og=1/Jh,Vu="\\s*([+-]?\\d+)\\s*",Zh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Cs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",z9=/^#([0-9a-f]{3,8})$/,W9=new RegExp(`^rgb\\(${Vu},${Vu},${Vu}\\)$`),H9=new RegExp(`^rgb\\(${Cs},${Cs},${Cs}\\)$`),V9=new RegExp(`^rgba\\(${Vu},${Vu},${Vu},${Zh}\\)$`),G9=new RegExp(`^rgba\\(${Cs},${Cs},${Cs},${Zh}\\)$`),Y9=new RegExp(`^hsl\\(${Zh},${Cs},${Cs}\\)$`),K9=new RegExp(`^hsla\\(${Zh},${Cs},${Cs},${Zh}\\)$`),FO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};kj(qp,ep,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:$O,formatHex:$O,formatHex8:Q9,formatHsl:X9,formatRgb:BO,toString:BO});function $O(){return this.rgb().formatHex()}function Q9(){return this.rgb().formatHex8()}function X9(){return PD(this).formatHsl()}function BO(){return this.rgb().formatRgb()}function ep(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=z9.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?UO(t):r===3?new Qi(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?bm(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?bm(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=W9.exec(e))?new Qi(t[1],t[2],t[3],1):(t=H9.exec(e))?new Qi(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=V9.exec(e))?bm(t[1],t[2],t[3],t[4]):(t=G9.exec(e))?bm(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Y9.exec(e))?HO(t[1],t[2]/100,t[3]/100,1):(t=K9.exec(e))?HO(t[1],t[2]/100,t[3]/100,t[4]):FO.hasOwnProperty(e)?UO(FO[e]):e==="transparent"?new Qi(NaN,NaN,NaN,0):null}function UO(e){return new Qi(e>>16&255,e>>8&255,e&255,1)}function bm(e,t,r,n){return n<=0&&(e=t=r=NaN),new Qi(e,t,r,n)}function J9(e){return e instanceof qp||(e=ep(e)),e?(e=e.rgb(),new Qi(e.r,e.g,e.b,e.opacity)):new Qi}function b_(e,t,r,n){return arguments.length===1?J9(e):new Qi(e,t,r,n??1)}function Qi(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}kj(Qi,b_,AD(qp,{brighter(e){return e=e==null?Og:Math.pow(Og,e),new Qi(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Jh:Math.pow(Jh,e),new Qi(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Qi($c(this.r),$c(this.g),$c(this.b),kg(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:zO,formatHex:zO,formatHex8:Z9,formatRgb:WO,toString:WO}));function zO(){return`#${Lc(this.r)}${Lc(this.g)}${Lc(this.b)}`}function Z9(){return`#${Lc(this.r)}${Lc(this.g)}${Lc(this.b)}${Lc((isNaN(this.opacity)?1:this.opacity)*255)}`}function WO(){const e=kg(this.opacity);return`${e===1?"rgb(":"rgba("}${$c(this.r)}, ${$c(this.g)}, ${$c(this.b)}${e===1?")":`, ${e})`}`}function kg(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function $c(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Lc(e){return e=$c(e),(e<16?"0":"")+e.toString(16)}function HO(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new as(e,t,r,n)}function PD(e){if(e instanceof as)return new as(e.h,e.s,e.l,e.opacity);if(e instanceof qp||(e=ep(e)),!e)return new as;if(e instanceof as)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,a=Math.min(t,r,n),o=Math.max(t,r,n),s=NaN,l=o-a,c=(o+a)/2;return l?(t===o?s=(r-n)/l+(r<n)*6:r===o?s=(n-t)/l+2:s=(t-r)/l+4,l/=c<.5?o+a:2-o-a,s*=60):l=c>0&&c<1?0:s,new as(s,l,c,e.opacity)}function eH(e,t,r,n){return arguments.length===1?PD(e):new as(e,t,r,n??1)}function as(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}kj(as,eH,AD(qp,{brighter(e){return e=e==null?Og:Math.pow(Og,e),new as(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Jh:Math.pow(Jh,e),new as(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,a=2*r-n;return new Qi(x1(e>=240?e-240:e+120,a,n),x1(e,a,n),x1(e<120?e+240:e-120,a,n),this.opacity)},clamp(){return new as(VO(this.h),_m(this.s),_m(this.l),kg(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=kg(this.opacity);return`${e===1?"hsl(":"hsla("}${VO(this.h)}, ${_m(this.s)*100}%, ${_m(this.l)*100}%${e===1?")":`, ${e})`}`}}));function VO(e){return e=(e||0)%360,e<0?e+360:e}function _m(e){return Math.max(0,Math.min(1,e||0))}function x1(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const Ej=e=>()=>e;function tH(e,t){return function(r){return e+r*t}}function rH(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function nH(e){return(e=+e)==1?OD:function(t,r){return r-t?rH(t,r,e):Ej(isNaN(t)?r:t)}}function OD(e,t){var r=t-e;return r?tH(e,r):Ej(isNaN(e)?t:e)}const GO=function e(t){var r=nH(t);function n(a,o){var s=r((a=b_(a)).r,(o=b_(o)).r),l=r(a.g,o.g),c=r(a.b,o.b),u=OD(a.opacity,o.opacity);return function(d){return a.r=s(d),a.g=l(d),a.b=c(d),a.opacity=u(d),a+""}}return n.gamma=e,n}(1);function aH(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),a;return function(o){for(a=0;a<r;++a)n[a]=e[a]*(1-o)+t[a]*o;return n}}function iH(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function oH(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,a=new Array(n),o=new Array(r),s;for(s=0;s<n;++s)a[s]=$d(e[s],t[s]);for(;s<r;++s)o[s]=t[s];return function(l){for(s=0;s<n;++s)o[s]=a[s](l);return o}}function sH(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function Eg(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function lH(e,t){var r={},n={},a;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(a in t)a in e?r[a]=$d(e[a],t[a]):n[a]=t[a];return function(o){for(a in r)n[a]=r[a](o);return n}}var __=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,b1=new RegExp(__.source,"g");function cH(e){return function(){return e}}function uH(e){return function(t){return e(t)+""}}function dH(e,t){var r=__.lastIndex=b1.lastIndex=0,n,a,o,s=-1,l=[],c=[];for(e=e+"",t=t+"";(n=__.exec(e))&&(a=b1.exec(t));)(o=a.index)>r&&(o=t.slice(r,o),l[s]?l[s]+=o:l[++s]=o),(n=n[0])===(a=a[0])?l[s]?l[s]+=a:l[++s]=a:(l[++s]=null,c.push({i:s,x:Eg(n,a)})),r=b1.lastIndex;return r<t.length&&(o=t.slice(r),l[s]?l[s]+=o:l[++s]=o),l.length<2?c[0]?uH(c[0].x):cH(t):(t=c.length,function(u){for(var d=0,f;d<t;++d)l[(f=c[d]).i]=f.x(u);return l.join("")})}function $d(e,t){var r=typeof t,n;return t==null||r==="boolean"?Ej(t):(r==="number"?Eg:r==="string"?(n=ep(t))?(t=n,GO):dH:t instanceof ep?GO:t instanceof Date?sH:iH(t)?aH:Array.isArray(t)?oH:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?lH:Eg)(e,t)}function Tj(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function fH(e,t){t===void 0&&(t=e,e=$d);for(var r=0,n=t.length-1,a=t[0],o=new Array(n<0?0:n);r<n;)o[r]=e(a,a=t[++r]);return function(s){var l=Math.max(0,Math.min(n-1,Math.floor(s*=n)));return o[l](s-l)}}function hH(e){return function(){return e}}function Tg(e){return+e}var YO=[0,1];function Ri(e){return e}function w_(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:hH(isNaN(t)?NaN:.5)}function pH(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function mH(e,t,r){var n=e[0],a=e[1],o=t[0],s=t[1];return a<n?(n=w_(a,n),o=r(s,o)):(n=w_(n,a),o=r(o,s)),function(l){return o(n(l))}}function gH(e,t,r){var n=Math.min(e.length,t.length)-1,a=new Array(n),o=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<n;)a[s]=w_(e[s],e[s+1]),o[s]=r(t[s],t[s+1]);return function(l){var c=Rp(e,l,1,n)-1;return o[c](a[c](l))}}function Fp(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function ey(){var e=YO,t=YO,r=$d,n,a,o,s=Ri,l,c,u;function d(){var h=Math.min(e.length,t.length);return s!==Ri&&(s=pH(e[0],e[h-1])),l=h>2?gH:mH,c=u=null,f}function f(h){return h==null||isNaN(h=+h)?o:(c||(c=l(e.map(n),t,r)))(n(s(h)))}return f.invert=function(h){return s(a((u||(u=l(t,e.map(n),Eg)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,Tg),d()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),d()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),r=Tj,d()},f.clamp=function(h){return arguments.length?(s=h?!0:Ri,d()):s!==Ri},f.interpolate=function(h){return arguments.length?(r=h,d()):r},f.unknown=function(h){return arguments.length?(o=h,f):o},function(h,p){return n=h,a=p,d()}}function Ij(){return ey()(Ri,Ri)}function vH(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Ig(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function id(e){return e=Ig(Math.abs(e)),e?e[1]:NaN}function yH(e,t){return function(r,n){for(var a=r.length,o=[],s=0,l=e[0],c=0;a>0&&l>0&&(c+l+1>n&&(l=Math.max(1,n-c)),o.push(r.substring(a-=l,a+l)),!((c+=l+1)>n));)l=e[s=(s+1)%e.length];return o.reverse().join(t)}}function xH(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var bH=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function tp(e){if(!(t=bH.exec(e)))throw new Error("invalid format: "+e);var t;return new Nj({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}tp.prototype=Nj.prototype;function Nj(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Nj.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function _H(e){e:for(var t=e.length,r=1,n=-1,a;r<t;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var kD;function wH(e,t){var r=Ig(e,t);if(!r)return e+"";var n=r[0],a=r[1],o=a-(kD=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,s=n.length;return o===s?n:o>s?n+new Array(o-s+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+Ig(e,Math.max(0,t+o-1))[0]}function KO(e,t){var r=Ig(e,t);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}const QO={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:vH,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>KO(e*100,t),r:KO,s:wH,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function XO(e){return e}var JO=Array.prototype.map,ZO=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function jH(e){var t=e.grouping===void 0||e.thousands===void 0?XO:yH(JO.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?XO:xH(JO.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function u(f){f=tp(f);var h=f.fill,p=f.align,v=f.sign,m=f.symbol,y=f.zero,b=f.width,_=f.comma,w=f.precision,A=f.trim,P=f.type;P==="n"?(_=!0,P="g"):QO[P]||(w===void 0&&(w=12),A=!0,P="g"),(y||h==="0"&&p==="=")&&(y=!0,h="0",p="=");var E=m==="$"?r:m==="#"&&/[boxX]/.test(P)?"0"+P.toLowerCase():"",T=m==="$"?n:/[%p]/.test(P)?s:"",S=QO[P],I=/[defgprs%]/.test(P);w=w===void 0?6:/[gprs]/.test(P)?Math.max(1,Math.min(21,w)):Math.max(0,Math.min(20,w));function U(O){var M=E,L=T,q,z,K;if(P==="c")L=S(O)+L,O="";else{O=+O;var J=O<0||1/O<0;if(O=isNaN(O)?c:S(Math.abs(O),w),A&&(O=_H(O)),J&&+O==0&&v!=="+"&&(J=!1),M=(J?v==="("?v:l:v==="-"||v==="("?"":v)+M,L=(P==="s"?ZO[8+kD/3]:"")+L+(J&&v==="("?")":""),I){for(q=-1,z=O.length;++q<z;)if(K=O.charCodeAt(q),48>K||K>57){L=(K===46?a+O.slice(q+1):O.slice(q))+L,O=O.slice(0,q);break}}}_&&!y&&(O=t(O,1/0));var R=M.length+O.length+L.length,k=R<b?new Array(b-R+1).join(h):"";switch(_&&y&&(O=t(k+O,k.length?b-L.length:1/0),k=""),p){case"<":O=M+O+L+k;break;case"=":O=M+k+O+L;break;case"^":O=k.slice(0,R=k.length>>1)+M+O+L+k.slice(R);break;default:O=k+M+O+L;break}return o(O)}return U.toString=function(){return f+""},U}function d(f,h){var p=u((f=tp(f),f.type="f",f)),v=Math.max(-8,Math.min(8,Math.floor(id(h)/3)))*3,m=Math.pow(10,-v),y=ZO[8+v/3];return function(b){return p(m*b)+y}}return{format:u,formatPrefix:d}}var wm,Dj,ED;SH({thousands:",",grouping:[3],currency:["$",""]});function SH(e){return wm=jH(e),Dj=wm.format,ED=wm.formatPrefix,wm}function CH(e){return Math.max(0,-id(Math.abs(e)))}function AH(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(id(t)/3)))*3-id(Math.abs(e)))}function PH(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,id(t)-id(e))+1}function TD(e,t,r,n){var a=y_(e,t,r),o;switch(n=tp(n??",f"),n.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(o=AH(a,s))&&(n.precision=o),ED(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=PH(a,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=CH(a))&&(n.precision=o-(n.type==="%")*2);break}}return Dj(n)}function lc(e){var t=e.domain;return e.ticks=function(r){var n=t();return g_(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var a=t();return TD(a[0],a[a.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),a=0,o=n.length-1,s=n[a],l=n[o],c,u,d=10;for(l<s&&(u=s,s=l,l=u,u=a,a=o,o=u);d-- >0;){if(u=v_(s,l,r),u===c)return n[a]=s,n[o]=l,t(n);if(u>0)s=Math.floor(s/u)*u,l=Math.ceil(l/u)*u;else if(u<0)s=Math.ceil(s*u)/u,l=Math.floor(l*u)/u;else break;c=u}return e},e}function Ng(){var e=Ij();return e.copy=function(){return Fp(e,Ng())},Go.apply(e,arguments),lc(e)}function ID(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,Tg),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return ID(e).unknown(t)},e=arguments.length?Array.from(e,Tg):[0,1],lc(r)}function ND(e,t){e=e.slice();var r=0,n=e.length-1,a=e[r],o=e[n],s;return o<a&&(s=r,r=n,n=s,s=a,a=o,o=s),e[r]=t.floor(a),e[n]=t.ceil(o),e}function ek(e){return Math.log(e)}function tk(e){return Math.exp(e)}function OH(e){return-Math.log(-e)}function kH(e){return-Math.exp(-e)}function EH(e){return isFinite(e)?+("1e"+e):e<0?0:e}function TH(e){return e===10?EH:e===Math.E?Math.exp:t=>Math.pow(e,t)}function IH(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function rk(e){return(t,r)=>-e(-t,r)}function Mj(e){const t=e(ek,tk),r=t.domain;let n=10,a,o;function s(){return a=IH(n),o=TH(n),r()[0]<0?(a=rk(a),o=rk(o),e(OH,kH)):e(ek,tk),t}return t.base=function(l){return arguments.length?(n=+l,s()):n},t.domain=function(l){return arguments.length?(r(l),s()):r()},t.ticks=l=>{const c=r();let u=c[0],d=c[c.length-1];const f=d<u;f&&([u,d]=[d,u]);let h=a(u),p=a(d),v,m;const y=l==null?10:+l;let b=[];if(!(n%1)&&p-h<y){if(h=Math.floor(h),p=Math.ceil(p),u>0){for(;h<=p;++h)for(v=1;v<n;++v)if(m=h<0?v/o(-h):v*o(h),!(m<u)){if(m>d)break;b.push(m)}}else for(;h<=p;++h)for(v=n-1;v>=1;--v)if(m=h>0?v/o(-h):v*o(h),!(m<u)){if(m>d)break;b.push(m)}b.length*2<y&&(b=g_(u,d,y))}else b=g_(h,p,Math.min(p-h,y)).map(o);return f?b.reverse():b},t.tickFormat=(l,c)=>{if(l==null&&(l=10),c==null&&(c=n===10?"s":","),typeof c!="function"&&(!(n%1)&&(c=tp(c)).precision==null&&(c.trim=!0),c=Dj(c)),l===1/0)return c;const u=Math.max(1,n*l/t.ticks().length);return d=>{let f=d/o(Math.round(a(d)));return f*n<n-.5&&(f*=n),f<=u?c(d):""}},t.nice=()=>r(ND(r(),{floor:l=>o(Math.floor(a(l))),ceil:l=>o(Math.ceil(a(l)))})),t}function DD(){const e=Mj(ey()).domain([1,10]);return e.copy=()=>Fp(e,DD()).base(e.base()),Go.apply(e,arguments),e}function nk(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function ak(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function Lj(e){var t=1,r=e(nk(t),ak(t));return r.constant=function(n){return arguments.length?e(nk(t=+n),ak(t)):t},lc(r)}function MD(){var e=Lj(ey());return e.copy=function(){return Fp(e,MD()).constant(e.constant())},Go.apply(e,arguments)}function ik(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function NH(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function DH(e){return e<0?-e*e:e*e}function Rj(e){var t=e(Ri,Ri),r=1;function n(){return r===1?e(Ri,Ri):r===.5?e(NH,DH):e(ik(r),ik(1/r))}return t.exponent=function(a){return arguments.length?(r=+a,n()):r},lc(t)}function qj(){var e=Rj(ey());return e.copy=function(){return Fp(e,qj()).exponent(e.exponent())},Go.apply(e,arguments),e}function MH(){return qj.apply(null,arguments).exponent(.5)}function ok(e){return Math.sign(e)*e*e}function LH(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function LD(){var e=Ij(),t=[0,1],r=!1,n;function a(o){var s=LH(e(o));return isNaN(s)?n:r?Math.round(s):s}return a.invert=function(o){return e.invert(ok(o))},a.domain=function(o){return arguments.length?(e.domain(o),a):e.domain()},a.range=function(o){return arguments.length?(e.range((t=Array.from(o,Tg)).map(ok)),a):t.slice()},a.rangeRound=function(o){return a.range(o).round(!0)},a.round=function(o){return arguments.length?(r=!!o,a):r},a.clamp=function(o){return arguments.length?(e.clamp(o),a):e.clamp()},a.unknown=function(o){return arguments.length?(n=o,a):n},a.copy=function(){return LD(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},Go.apply(a,arguments),lc(a)}function RD(){var e=[],t=[],r=[],n;function a(){var s=0,l=Math.max(1,t.length);for(r=new Array(l-1);++s<l;)r[s-1]=B9(e,s/l);return o}function o(s){return s==null||isNaN(s=+s)?n:t[Rp(r,s)]}return o.invertExtent=function(s){var l=t.indexOf(s);return l<0?[NaN,NaN]:[l>0?r[l-1]:e[0],l<r.length?r[l]:e[e.length-1]]},o.domain=function(s){if(!arguments.length)return e.slice();e=[];for(let l of s)l!=null&&!isNaN(l=+l)&&e.push(l);return e.sort(Jl),a()},o.range=function(s){return arguments.length?(t=Array.from(s),a()):t.slice()},o.unknown=function(s){return arguments.length?(n=s,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return RD().domain(e).range(t).unknown(n)},Go.apply(o,arguments)}function qD(){var e=0,t=1,r=1,n=[.5],a=[0,1],o;function s(c){return c!=null&&c<=c?a[Rp(n,c,0,r)]:o}function l(){var c=-1;for(n=new Array(r);++c<r;)n[c]=((c+1)*t-(c-r)*e)/(r+1);return s}return s.domain=function(c){return arguments.length?([e,t]=c,e=+e,t=+t,l()):[e,t]},s.range=function(c){return arguments.length?(r=(a=Array.from(c)).length-1,l()):a.slice()},s.invertExtent=function(c){var u=a.indexOf(c);return u<0?[NaN,NaN]:u<1?[e,n[0]]:u>=r?[n[r-1],t]:[n[u-1],n[u]]},s.unknown=function(c){return arguments.length&&(o=c),s},s.thresholds=function(){return n.slice()},s.copy=function(){return qD().domain([e,t]).range(a).unknown(o)},Go.apply(lc(s),arguments)}function FD(){var e=[.5],t=[0,1],r,n=1;function a(o){return o!=null&&o<=o?t[Rp(e,o,0,n)]:r}return a.domain=function(o){return arguments.length?(e=Array.from(o),n=Math.min(e.length,t.length-1),a):e.slice()},a.range=function(o){return arguments.length?(t=Array.from(o),n=Math.min(e.length,t.length-1),a):t.slice()},a.invertExtent=function(o){var s=t.indexOf(o);return[e[s-1],e[s]]},a.unknown=function(o){return arguments.length?(r=o,a):r},a.copy=function(){return FD().domain(e).range(t).unknown(r)},Go.apply(a,arguments)}const _1=new Date,w1=new Date;function Ga(e,t,r,n){function a(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return a.floor=o=>(e(o=new Date(+o)),o),a.ceil=o=>(e(o=new Date(o-1)),t(o,1),e(o),o),a.round=o=>{const s=a(o),l=a.ceil(o);return o-s<l-o?s:l},a.offset=(o,s)=>(t(o=new Date(+o),s==null?1:Math.floor(s)),o),a.range=(o,s,l)=>{const c=[];if(o=a.ceil(o),l=l==null?1:Math.floor(l),!(o<s)||!(l>0))return c;let u;do c.push(u=new Date(+o)),t(o,l),e(o);while(u<o&&o<s);return c},a.filter=o=>Ga(s=>{if(s>=s)for(;e(s),!o(s);)s.setTime(s-1)},(s,l)=>{if(s>=s)if(l<0)for(;++l<=0;)for(;t(s,-1),!o(s););else for(;--l>=0;)for(;t(s,1),!o(s););}),r&&(a.count=(o,s)=>(_1.setTime(+o),w1.setTime(+s),e(_1),e(w1),Math.floor(r(_1,w1))),a.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?a.filter(n?s=>n(s)%o===0:s=>a.count(0,s)%o===0):a)),a}const Dg=Ga(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);Dg.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ga(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):Dg);Dg.range;const il=1e3,Ho=il*60,ol=Ho*60,pl=ol*24,Fj=pl*7,sk=pl*30,j1=pl*365,Rc=Ga(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*il)},(e,t)=>(t-e)/il,e=>e.getUTCSeconds());Rc.range;const $j=Ga(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*il)},(e,t)=>{e.setTime(+e+t*Ho)},(e,t)=>(t-e)/Ho,e=>e.getMinutes());$j.range;const Bj=Ga(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Ho)},(e,t)=>(t-e)/Ho,e=>e.getUTCMinutes());Bj.range;const Uj=Ga(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*il-e.getMinutes()*Ho)},(e,t)=>{e.setTime(+e+t*ol)},(e,t)=>(t-e)/ol,e=>e.getHours());Uj.range;const zj=Ga(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*ol)},(e,t)=>(t-e)/ol,e=>e.getUTCHours());zj.range;const $p=Ga(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Ho)/pl,e=>e.getDate()-1);$p.range;const ty=Ga(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/pl,e=>e.getUTCDate()-1);ty.range;const $D=Ga(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/pl,e=>Math.floor(e/pl));$D.range;function ou(e){return Ga(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*Ho)/Fj)}const ry=ou(0),Mg=ou(1),RH=ou(2),qH=ou(3),od=ou(4),FH=ou(5),$H=ou(6);ry.range;Mg.range;RH.range;qH.range;od.range;FH.range;$H.range;function su(e){return Ga(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/Fj)}const ny=su(0),Lg=su(1),BH=su(2),UH=su(3),sd=su(4),zH=su(5),WH=su(6);ny.range;Lg.range;BH.range;UH.range;sd.range;zH.range;WH.range;const Wj=Ga(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());Wj.range;const Hj=Ga(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());Hj.range;const ml=Ga(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());ml.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ga(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});ml.range;const gl=Ga(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());gl.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ga(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});gl.range;function BD(e,t,r,n,a,o){const s=[[Rc,1,il],[Rc,5,5*il],[Rc,15,15*il],[Rc,30,30*il],[o,1,Ho],[o,5,5*Ho],[o,15,15*Ho],[o,30,30*Ho],[a,1,ol],[a,3,3*ol],[a,6,6*ol],[a,12,12*ol],[n,1,pl],[n,2,2*pl],[r,1,Fj],[t,1,sk],[t,3,3*sk],[e,1,j1]];function l(u,d,f){const h=d<u;h&&([u,d]=[d,u]);const p=f&&typeof f.range=="function"?f:c(u,d,f),v=p?p.range(u,+d+1):[];return h?v.reverse():v}function c(u,d,f){const h=Math.abs(d-u)/f,p=Pj(([,,y])=>y).right(s,h);if(p===s.length)return e.every(y_(u/j1,d/j1,f));if(p===0)return Dg.every(Math.max(y_(u,d,f),1));const[v,m]=s[h/s[p-1][2]<s[p][2]/h?p-1:p];return v.every(m)}return[l,c]}const[HH,VH]=BD(gl,Hj,ny,$D,zj,Bj),[GH,YH]=BD(ml,Wj,ry,$p,Uj,$j);function S1(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function C1(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function ff(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function KH(e){var t=e.dateTime,r=e.date,n=e.time,a=e.periods,o=e.days,s=e.shortDays,l=e.months,c=e.shortMonths,u=hf(a),d=pf(a),f=hf(o),h=pf(o),p=hf(s),v=pf(s),m=hf(l),y=pf(l),b=hf(c),_=pf(c),w={a:J,A:R,b:k,B:$,c:null,d:hk,e:hk,f:yV,g:OV,G:EV,H:mV,I:gV,j:vV,L:UD,m:xV,M:bV,p:X,q:C,Q:gk,s:vk,S:_V,u:wV,U:jV,V:SV,w:CV,W:AV,x:null,X:null,y:PV,Y:kV,Z:TV,"%":mk},A={a:N,A:H,b:W,B:ne,c:null,d:pk,e:pk,f:MV,g:HV,G:GV,H:IV,I:NV,j:DV,L:WD,m:LV,M:RV,p:se,q:oe,Q:gk,s:vk,S:qV,u:FV,U:$V,V:BV,w:UV,W:zV,x:null,X:null,y:WV,Y:VV,Z:YV,"%":mk},P={a:U,A:O,b:M,B:L,c:q,d:dk,e:dk,f:dV,g:uk,G:ck,H:fk,I:fk,j:sV,L:uV,m:oV,M:lV,p:I,q:iV,Q:hV,s:pV,S:cV,u:eV,U:tV,V:rV,w:ZH,W:nV,x:z,X:K,y:uk,Y:ck,Z:aV,"%":fV};w.x=E(r,w),w.X=E(n,w),w.c=E(t,w),A.x=E(r,A),A.X=E(n,A),A.c=E(t,A);function E(ae,pe){return function(ge){var Q=[],G=-1,ee=0,le=ae.length,V,Ve,Me;for(ge instanceof Date||(ge=new Date(+ge));++G<le;)ae.charCodeAt(G)===37&&(Q.push(ae.slice(ee,G)),(Ve=lk[V=ae.charAt(++G)])!=null?V=ae.charAt(++G):Ve=V==="e"?" ":"0",(Me=pe[V])&&(V=Me(ge,Ve)),Q.push(V),ee=G+1);return Q.push(ae.slice(ee,G)),Q.join("")}}function T(ae,pe){return function(ge){var Q=ff(1900,void 0,1),G=S(Q,ae,ge+="",0),ee,le;if(G!=ge.length)return null;if("Q"in Q)return new Date(Q.Q);if("s"in Q)return new Date(Q.s*1e3+("L"in Q?Q.L:0));if(pe&&!("Z"in Q)&&(Q.Z=0),"p"in Q&&(Q.H=Q.H%12+Q.p*12),Q.m===void 0&&(Q.m="q"in Q?Q.q:0),"V"in Q){if(Q.V<1||Q.V>53)return null;"w"in Q||(Q.w=1),"Z"in Q?(ee=C1(ff(Q.y,0,1)),le=ee.getUTCDay(),ee=le>4||le===0?Lg.ceil(ee):Lg(ee),ee=ty.offset(ee,(Q.V-1)*7),Q.y=ee.getUTCFullYear(),Q.m=ee.getUTCMonth(),Q.d=ee.getUTCDate()+(Q.w+6)%7):(ee=S1(ff(Q.y,0,1)),le=ee.getDay(),ee=le>4||le===0?Mg.ceil(ee):Mg(ee),ee=$p.offset(ee,(Q.V-1)*7),Q.y=ee.getFullYear(),Q.m=ee.getMonth(),Q.d=ee.getDate()+(Q.w+6)%7)}else("W"in Q||"U"in Q)&&("w"in Q||(Q.w="u"in Q?Q.u%7:"W"in Q?1:0),le="Z"in Q?C1(ff(Q.y,0,1)).getUTCDay():S1(ff(Q.y,0,1)).getDay(),Q.m=0,Q.d="W"in Q?(Q.w+6)%7+Q.W*7-(le+5)%7:Q.w+Q.U*7-(le+6)%7);return"Z"in Q?(Q.H+=Q.Z/100|0,Q.M+=Q.Z%100,C1(Q)):S1(Q)}}function S(ae,pe,ge,Q){for(var G=0,ee=pe.length,le=ge.length,V,Ve;G<ee;){if(Q>=le)return-1;if(V=pe.charCodeAt(G++),V===37){if(V=pe.charAt(G++),Ve=P[V in lk?pe.charAt(G++):V],!Ve||(Q=Ve(ae,ge,Q))<0)return-1}else if(V!=ge.charCodeAt(Q++))return-1}return Q}function I(ae,pe,ge){var Q=u.exec(pe.slice(ge));return Q?(ae.p=d.get(Q[0].toLowerCase()),ge+Q[0].length):-1}function U(ae,pe,ge){var Q=p.exec(pe.slice(ge));return Q?(ae.w=v.get(Q[0].toLowerCase()),ge+Q[0].length):-1}function O(ae,pe,ge){var Q=f.exec(pe.slice(ge));return Q?(ae.w=h.get(Q[0].toLowerCase()),ge+Q[0].length):-1}function M(ae,pe,ge){var Q=b.exec(pe.slice(ge));return Q?(ae.m=_.get(Q[0].toLowerCase()),ge+Q[0].length):-1}function L(ae,pe,ge){var Q=m.exec(pe.slice(ge));return Q?(ae.m=y.get(Q[0].toLowerCase()),ge+Q[0].length):-1}function q(ae,pe,ge){return S(ae,t,pe,ge)}function z(ae,pe,ge){return S(ae,r,pe,ge)}function K(ae,pe,ge){return S(ae,n,pe,ge)}function J(ae){return s[ae.getDay()]}function R(ae){return o[ae.getDay()]}function k(ae){return c[ae.getMonth()]}function $(ae){return l[ae.getMonth()]}function X(ae){return a[+(ae.getHours()>=12)]}function C(ae){return 1+~~(ae.getMonth()/3)}function N(ae){return s[ae.getUTCDay()]}function H(ae){return o[ae.getUTCDay()]}function W(ae){return c[ae.getUTCMonth()]}function ne(ae){return l[ae.getUTCMonth()]}function se(ae){return a[+(ae.getUTCHours()>=12)]}function oe(ae){return 1+~~(ae.getUTCMonth()/3)}return{format:function(ae){var pe=E(ae+="",w);return pe.toString=function(){return ae},pe},parse:function(ae){var pe=T(ae+="",!1);return pe.toString=function(){return ae},pe},utcFormat:function(ae){var pe=E(ae+="",A);return pe.toString=function(){return ae},pe},utcParse:function(ae){var pe=T(ae+="",!0);return pe.toString=function(){return ae},pe}}}var lk={"-":"",_:" ",0:"0"},ei=/^\s*\d+/,QH=/^%/,XH=/[\\^$*+?|[\]().{}]/g;function un(e,t,r){var n=e<0?"-":"",a=(n?-e:e)+"",o=a.length;return n+(o<r?new Array(r-o+1).join(t)+a:a)}function JH(e){return e.replace(XH,"\\$&")}function hf(e){return new RegExp("^(?:"+e.map(JH).join("|")+")","i")}function pf(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function ZH(e,t,r){var n=ei.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function eV(e,t,r){var n=ei.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function tV(e,t,r){var n=ei.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function rV(e,t,r){var n=ei.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function nV(e,t,r){var n=ei.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function ck(e,t,r){var n=ei.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function uk(e,t,r){var n=ei.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function aV(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function iV(e,t,r){var n=ei.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function oV(e,t,r){var n=ei.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function dk(e,t,r){var n=ei.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function sV(e,t,r){var n=ei.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function fk(e,t,r){var n=ei.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function lV(e,t,r){var n=ei.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function cV(e,t,r){var n=ei.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function uV(e,t,r){var n=ei.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function dV(e,t,r){var n=ei.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function fV(e,t,r){var n=QH.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function hV(e,t,r){var n=ei.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function pV(e,t,r){var n=ei.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function hk(e,t){return un(e.getDate(),t,2)}function mV(e,t){return un(e.getHours(),t,2)}function gV(e,t){return un(e.getHours()%12||12,t,2)}function vV(e,t){return un(1+$p.count(ml(e),e),t,3)}function UD(e,t){return un(e.getMilliseconds(),t,3)}function yV(e,t){return UD(e,t)+"000"}function xV(e,t){return un(e.getMonth()+1,t,2)}function bV(e,t){return un(e.getMinutes(),t,2)}function _V(e,t){return un(e.getSeconds(),t,2)}function wV(e){var t=e.getDay();return t===0?7:t}function jV(e,t){return un(ry.count(ml(e)-1,e),t,2)}function zD(e){var t=e.getDay();return t>=4||t===0?od(e):od.ceil(e)}function SV(e,t){return e=zD(e),un(od.count(ml(e),e)+(ml(e).getDay()===4),t,2)}function CV(e){return e.getDay()}function AV(e,t){return un(Mg.count(ml(e)-1,e),t,2)}function PV(e,t){return un(e.getFullYear()%100,t,2)}function OV(e,t){return e=zD(e),un(e.getFullYear()%100,t,2)}function kV(e,t){return un(e.getFullYear()%1e4,t,4)}function EV(e,t){var r=e.getDay();return e=r>=4||r===0?od(e):od.ceil(e),un(e.getFullYear()%1e4,t,4)}function TV(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+un(t/60|0,"0",2)+un(t%60,"0",2)}function pk(e,t){return un(e.getUTCDate(),t,2)}function IV(e,t){return un(e.getUTCHours(),t,2)}function NV(e,t){return un(e.getUTCHours()%12||12,t,2)}function DV(e,t){return un(1+ty.count(gl(e),e),t,3)}function WD(e,t){return un(e.getUTCMilliseconds(),t,3)}function MV(e,t){return WD(e,t)+"000"}function LV(e,t){return un(e.getUTCMonth()+1,t,2)}function RV(e,t){return un(e.getUTCMinutes(),t,2)}function qV(e,t){return un(e.getUTCSeconds(),t,2)}function FV(e){var t=e.getUTCDay();return t===0?7:t}function $V(e,t){return un(ny.count(gl(e)-1,e),t,2)}function HD(e){var t=e.getUTCDay();return t>=4||t===0?sd(e):sd.ceil(e)}function BV(e,t){return e=HD(e),un(sd.count(gl(e),e)+(gl(e).getUTCDay()===4),t,2)}function UV(e){return e.getUTCDay()}function zV(e,t){return un(Lg.count(gl(e)-1,e),t,2)}function WV(e,t){return un(e.getUTCFullYear()%100,t,2)}function HV(e,t){return e=HD(e),un(e.getUTCFullYear()%100,t,2)}function VV(e,t){return un(e.getUTCFullYear()%1e4,t,4)}function GV(e,t){var r=e.getUTCDay();return e=r>=4||r===0?sd(e):sd.ceil(e),un(e.getUTCFullYear()%1e4,t,4)}function YV(){return"+0000"}function mk(){return"%"}function gk(e){return+e}function vk(e){return Math.floor(+e/1e3)}var bu,VD,GD;KV({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function KV(e){return bu=KH(e),VD=bu.format,bu.parse,GD=bu.utcFormat,bu.utcParse,bu}function QV(e){return new Date(e)}function XV(e){return e instanceof Date?+e:+new Date(+e)}function Vj(e,t,r,n,a,o,s,l,c,u){var d=Ij(),f=d.invert,h=d.domain,p=u(".%L"),v=u(":%S"),m=u("%I:%M"),y=u("%I %p"),b=u("%a %d"),_=u("%b %d"),w=u("%B"),A=u("%Y");function P(E){return(c(E)<E?p:l(E)<E?v:s(E)<E?m:o(E)<E?y:n(E)<E?a(E)<E?b:_:r(E)<E?w:A)(E)}return d.invert=function(E){return new Date(f(E))},d.domain=function(E){return arguments.length?h(Array.from(E,XV)):h().map(QV)},d.ticks=function(E){var T=h();return e(T[0],T[T.length-1],E??10)},d.tickFormat=function(E,T){return T==null?P:u(T)},d.nice=function(E){var T=h();return(!E||typeof E.range!="function")&&(E=t(T[0],T[T.length-1],E??10)),E?h(ND(T,E)):d},d.copy=function(){return Fp(d,Vj(e,t,r,n,a,o,s,l,c,u))},d}function JV(){return Go.apply(Vj(GH,YH,ml,Wj,ry,$p,Uj,$j,Rc,VD).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function ZV(){return Go.apply(Vj(HH,VH,gl,Hj,ny,ty,zj,Bj,Rc,GD).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function ay(){var e=0,t=1,r,n,a,o,s=Ri,l=!1,c;function u(f){return f==null||isNaN(f=+f)?c:s(a===0?.5:(f=(o(f)-r)*a,l?Math.max(0,Math.min(1,f)):f))}u.domain=function(f){return arguments.length?([e,t]=f,r=o(e=+e),n=o(t=+t),a=r===n?0:1/(n-r),u):[e,t]},u.clamp=function(f){return arguments.length?(l=!!f,u):l},u.interpolator=function(f){return arguments.length?(s=f,u):s};function d(f){return function(h){var p,v;return arguments.length?([p,v]=h,s=f(p,v),u):[s(0),s(1)]}}return u.range=d($d),u.rangeRound=d(Tj),u.unknown=function(f){return arguments.length?(c=f,u):c},function(f){return o=f,r=f(e),n=f(t),a=r===n?0:1/(n-r),u}}function cc(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function YD(){var e=lc(ay()(Ri));return e.copy=function(){return cc(e,YD())},wl.apply(e,arguments)}function KD(){var e=Mj(ay()).domain([1,10]);return e.copy=function(){return cc(e,KD()).base(e.base())},wl.apply(e,arguments)}function QD(){var e=Lj(ay());return e.copy=function(){return cc(e,QD()).constant(e.constant())},wl.apply(e,arguments)}function Gj(){var e=Rj(ay());return e.copy=function(){return cc(e,Gj()).exponent(e.exponent())},wl.apply(e,arguments)}function eG(){return Gj.apply(null,arguments).exponent(.5)}function XD(){var e=[],t=Ri;function r(n){if(n!=null&&!isNaN(n=+n))return t((Rp(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let a of n)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(Jl),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,a)=>t(a/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(a,o)=>$9(e,o/n))},r.copy=function(){return XD(t).domain(e)},wl.apply(r,arguments)}function iy(){var e=0,t=.5,r=1,n=1,a,o,s,l,c,u=Ri,d,f=!1,h;function p(m){return isNaN(m=+m)?h:(m=.5+((m=+d(m))-o)*(n*m<n*o?l:c),u(f?Math.max(0,Math.min(1,m)):m))}p.domain=function(m){return arguments.length?([e,t,r]=m,a=d(e=+e),o=d(t=+t),s=d(r=+r),l=a===o?0:.5/(o-a),c=o===s?0:.5/(s-o),n=o<a?-1:1,p):[e,t,r]},p.clamp=function(m){return arguments.length?(f=!!m,p):f},p.interpolator=function(m){return arguments.length?(u=m,p):u};function v(m){return function(y){var b,_,w;return arguments.length?([b,_,w]=y,u=fH(m,[b,_,w]),p):[u(0),u(.5),u(1)]}}return p.range=v($d),p.rangeRound=v(Tj),p.unknown=function(m){return arguments.length?(h=m,p):h},function(m){return d=m,a=m(e),o=m(t),s=m(r),l=a===o?0:.5/(o-a),c=o===s?0:.5/(s-o),n=o<a?-1:1,p}}function JD(){var e=lc(iy()(Ri));return e.copy=function(){return cc(e,JD())},wl.apply(e,arguments)}function ZD(){var e=Mj(iy()).domain([.1,1,10]);return e.copy=function(){return cc(e,ZD()).base(e.base())},wl.apply(e,arguments)}function eM(){var e=Lj(iy());return e.copy=function(){return cc(e,eM()).constant(e.constant())},wl.apply(e,arguments)}function Yj(){var e=Rj(iy());return e.copy=function(){return cc(e,Yj()).exponent(e.exponent())},wl.apply(e,arguments)}function tG(){return Yj.apply(null,arguments).exponent(.5)}const yk=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:Xh,scaleDiverging:JD,scaleDivergingLog:ZD,scaleDivergingPow:Yj,scaleDivergingSqrt:tG,scaleDivergingSymlog:eM,scaleIdentity:ID,scaleImplicit:x_,scaleLinear:Ng,scaleLog:DD,scaleOrdinal:Oj,scalePoint:Eh,scalePow:qj,scaleQuantile:RD,scaleQuantize:qD,scaleRadial:LD,scaleSequential:YD,scaleSequentialLog:KD,scaleSequentialPow:Gj,scaleSequentialQuantile:XD,scaleSequentialSqrt:eG,scaleSequentialSymlog:QD,scaleSqrt:MH,scaleSymlog:MD,scaleThreshold:FD,scaleTime:JV,scaleUtc:ZV,tickFormat:TD},Symbol.toStringTag,{value:"Module"}));var A1,xk;function oy(){if(xk)return A1;xk=1;var e=Ld();function t(r,n,a){for(var o=-1,s=r.length;++o<s;){var l=r[o],c=n(l);if(c!=null&&(u===void 0?c===c&&!e(c):a(c,u)))var u=c,d=l}return d}return A1=t,A1}var P1,bk;function tM(){if(bk)return P1;bk=1;function e(t,r){return t>r}return P1=e,P1}var O1,_k;function rG(){if(_k)return O1;_k=1;var e=oy(),t=tM(),r=Fd();function n(a){return a&&a.length?e(a,r,t):void 0}return O1=n,O1}var nG=rG();const sy=Et(nG);var k1,wk;function rM(){if(wk)return k1;wk=1;function e(t,r){return t<r}return k1=e,k1}var E1,jk;function aG(){if(jk)return E1;jk=1;var e=oy(),t=rM(),r=Fd();function n(a){return a&&a.length?e(a,r,t):void 0}return E1=n,E1}var iG=aG();const ly=Et(iG);var T1,Sk;function oG(){if(Sk)return T1;Sk=1;var e=uj(),t=Rs(),r=cD(),n=eo();function a(o,s){var l=n(o)?e:r;return l(o,t(s,3))}return T1=a,T1}var I1,Ck;function sG(){if(Ck)return I1;Ck=1;var e=sD(),t=oG();function r(n,a){return e(t(n,a),1)}return I1=r,I1}var lG=sG();const cG=Et(lG);var N1,Ak;function uG(){if(Ak)return N1;Ak=1;var e=jj();function t(r,n){return e(r,n)}return N1=t,N1}var dG=uG();const Bp=Et(dG);var Bd=1e9,fG={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Qj,Xn=!0,Vo="[DecimalError] ",Bc=Vo+"Invalid argument: ",Kj=Vo+"Exponent out of range: ",Ud=Math.floor,Oc=Math.pow,hG=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,wo,Xa=1e7,zn=7,nM=9007199254740991,Rg=Ud(nM/zn),Qt={};Qt.absoluteValue=Qt.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Qt.comparedTo=Qt.cmp=function(e){var t,r,n,a,o=this;if(e=new o.constructor(e),o.s!==e.s)return o.s||-e.s;if(o.e!==e.e)return o.e>e.e^o.s<0?1:-1;for(n=o.d.length,a=e.d.length,t=0,r=n<a?n:a;t<r;++t)if(o.d[t]!==e.d[t])return o.d[t]>e.d[t]^o.s<0?1:-1;return n===a?0:n>a^o.s<0?1:-1};Qt.decimalPlaces=Qt.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*zn;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};Qt.dividedBy=Qt.div=function(e){return dl(this,new this.constructor(e))};Qt.dividedToIntegerBy=Qt.idiv=function(e){var t=this,r=t.constructor;return On(dl(t,new r(e),0,1),r.precision)};Qt.equals=Qt.eq=function(e){return!this.cmp(e)};Qt.exponent=function(){return qa(this)};Qt.greaterThan=Qt.gt=function(e){return this.cmp(e)>0};Qt.greaterThanOrEqualTo=Qt.gte=function(e){return this.cmp(e)>=0};Qt.isInteger=Qt.isint=function(){return this.e>this.d.length-2};Qt.isNegative=Qt.isneg=function(){return this.s<0};Qt.isPositive=Qt.ispos=function(){return this.s>0};Qt.isZero=function(){return this.s===0};Qt.lessThan=Qt.lt=function(e){return this.cmp(e)<0};Qt.lessThanOrEqualTo=Qt.lte=function(e){return this.cmp(e)<1};Qt.logarithm=Qt.log=function(e){var t,r=this,n=r.constructor,a=n.precision,o=a+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(wo))throw Error(Vo+"NaN");if(r.s<1)throw Error(Vo+(r.s?"NaN":"-Infinity"));return r.eq(wo)?new n(0):(Xn=!1,t=dl(rp(r,o),rp(e,o),o),Xn=!0,On(t,a))};Qt.minus=Qt.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?oM(t,e):aM(t,(e.s=-e.s,e))};Qt.modulo=Qt.mod=function(e){var t,r=this,n=r.constructor,a=n.precision;if(e=new n(e),!e.s)throw Error(Vo+"NaN");return r.s?(Xn=!1,t=dl(r,e,0,1).times(e),Xn=!0,r.minus(t)):On(new n(r),a)};Qt.naturalExponential=Qt.exp=function(){return iM(this)};Qt.naturalLogarithm=Qt.ln=function(){return rp(this)};Qt.negated=Qt.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Qt.plus=Qt.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?aM(t,e):oM(t,(e.s=-e.s,e))};Qt.precision=Qt.sd=function(e){var t,r,n,a=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Bc+e);if(t=qa(a)+1,n=a.d.length-1,r=n*zn+1,n=a.d[n],n){for(;n%10==0;n/=10)r--;for(n=a.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};Qt.squareRoot=Qt.sqrt=function(){var e,t,r,n,a,o,s,l=this,c=l.constructor;if(l.s<1){if(!l.s)return new c(0);throw Error(Vo+"NaN")}for(e=qa(l),Xn=!1,a=Math.sqrt(+l),a==0||a==1/0?(t=ws(l.d),(t.length+e)%2==0&&(t+="0"),a=Math.sqrt(t),e=Ud((e+1)/2)-(e<0||e%2),a==1/0?t="5e"+e:(t=a.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new c(t)):n=new c(a.toString()),r=c.precision,a=s=r+3;;)if(o=n,n=o.plus(dl(l,o,s+2)).times(.5),ws(o.d).slice(0,s)===(t=ws(n.d)).slice(0,s)){if(t=t.slice(s-3,s+1),a==s&&t=="4999"){if(On(o,r+1,0),o.times(o).eq(l)){n=o;break}}else if(t!="9999")break;s+=4}return Xn=!0,On(n,r)};Qt.times=Qt.mul=function(e){var t,r,n,a,o,s,l,c,u,d=this,f=d.constructor,h=d.d,p=(e=new f(e)).d;if(!d.s||!e.s)return new f(0);for(e.s*=d.s,r=d.e+e.e,c=h.length,u=p.length,c<u&&(o=h,h=p,p=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(t=0,a=c+n;a>n;)l=o[a]+p[n]*h[a-n-1]+t,o[a--]=l%Xa|0,t=l/Xa|0;o[a]=(o[a]+t)%Xa|0}for(;!o[--s];)o.pop();return t?++r:o.shift(),e.d=o,e.e=r,Xn?On(e,f.precision):e};Qt.toDecimalPlaces=Qt.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(ks(e,0,Bd),t===void 0?t=n.rounding:ks(t,0,8),On(r,e+qa(r)+1,t))};Qt.toExponential=function(e,t){var r,n=this,a=n.constructor;return e===void 0?r=Qc(n,!0):(ks(e,0,Bd),t===void 0?t=a.rounding:ks(t,0,8),n=On(new a(n),e+1,t),r=Qc(n,!0,e+1)),r};Qt.toFixed=function(e,t){var r,n,a=this,o=a.constructor;return e===void 0?Qc(a):(ks(e,0,Bd),t===void 0?t=o.rounding:ks(t,0,8),n=On(new o(a),e+qa(a)+1,t),r=Qc(n.abs(),!1,e+qa(n)+1),a.isneg()&&!a.isZero()?"-"+r:r)};Qt.toInteger=Qt.toint=function(){var e=this,t=e.constructor;return On(new t(e),qa(e)+1,t.rounding)};Qt.toNumber=function(){return+this};Qt.toPower=Qt.pow=function(e){var t,r,n,a,o,s,l=this,c=l.constructor,u=12,d=+(e=new c(e));if(!e.s)return new c(wo);if(l=new c(l),!l.s){if(e.s<1)throw Error(Vo+"Infinity");return l}if(l.eq(wo))return l;if(n=c.precision,e.eq(wo))return On(l,n);if(t=e.e,r=e.d.length-1,s=t>=r,o=l.s,s){if((r=d<0?-d:d)<=nM){for(a=new c(wo),t=Math.ceil(n/zn+4),Xn=!1;r%2&&(a=a.times(l),Ok(a.d,t)),r=Ud(r/2),r!==0;)l=l.times(l),Ok(l.d,t);return Xn=!0,e.s<0?new c(wo).div(a):On(a,n)}}else if(o<0)throw Error(Vo+"NaN");return o=o<0&&e.d[Math.max(t,r)]&1?-1:1,l.s=1,Xn=!1,a=e.times(rp(l,n+u)),Xn=!0,a=iM(a),a.s=o,a};Qt.toPrecision=function(e,t){var r,n,a=this,o=a.constructor;return e===void 0?(r=qa(a),n=Qc(a,r<=o.toExpNeg||r>=o.toExpPos)):(ks(e,1,Bd),t===void 0?t=o.rounding:ks(t,0,8),a=On(new o(a),e,t),r=qa(a),n=Qc(a,e<=r||r<=o.toExpNeg,e)),n};Qt.toSignificantDigits=Qt.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(ks(e,1,Bd),t===void 0?t=n.rounding:ks(t,0,8)),On(new n(r),e,t)};Qt.toString=Qt.valueOf=Qt.val=Qt.toJSON=Qt[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=qa(e),r=e.constructor;return Qc(e,t<=r.toExpNeg||t>=r.toExpPos)};function aM(e,t){var r,n,a,o,s,l,c,u,d=e.constructor,f=d.precision;if(!e.s||!t.s)return t.s||(t=new d(e)),Xn?On(t,f):t;if(c=e.d,u=t.d,s=e.e,a=t.e,c=c.slice(),o=s-a,o){for(o<0?(n=c,o=-o,l=u.length):(n=u,a=s,l=c.length),s=Math.ceil(f/zn),l=s>l?s+1:l+1,o>l&&(o=l,n.length=1),n.reverse();o--;)n.push(0);n.reverse()}for(l=c.length,o=u.length,l-o<0&&(o=l,n=u,u=c,c=n),r=0;o;)r=(c[--o]=c[o]+u[o]+r)/Xa|0,c[o]%=Xa;for(r&&(c.unshift(r),++a),l=c.length;c[--l]==0;)c.pop();return t.d=c,t.e=a,Xn?On(t,f):t}function ks(e,t,r){if(e!==~~e||e<t||e>r)throw Error(Bc+e)}function ws(e){var t,r,n,a=e.length-1,o="",s=e[0];if(a>0){for(o+=s,t=1;t<a;t++)n=e[t]+"",r=zn-n.length,r&&(o+=Wl(r)),o+=n;s=e[t],n=s+"",r=zn-n.length,r&&(o+=Wl(r))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}var dl=function(){function e(n,a){var o,s=0,l=n.length;for(n=n.slice();l--;)o=n[l]*a+s,n[l]=o%Xa|0,s=o/Xa|0;return s&&n.unshift(s),n}function t(n,a,o,s){var l,c;if(o!=s)c=o>s?1:-1;else for(l=c=0;l<o;l++)if(n[l]!=a[l]){c=n[l]>a[l]?1:-1;break}return c}function r(n,a,o){for(var s=0;o--;)n[o]-=s,s=n[o]<a[o]?1:0,n[o]=s*Xa+n[o]-a[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,a,o,s){var l,c,u,d,f,h,p,v,m,y,b,_,w,A,P,E,T,S,I=n.constructor,U=n.s==a.s?1:-1,O=n.d,M=a.d;if(!n.s)return new I(n);if(!a.s)throw Error(Vo+"Division by zero");for(c=n.e-a.e,T=M.length,P=O.length,p=new I(U),v=p.d=[],u=0;M[u]==(O[u]||0);)++u;if(M[u]>(O[u]||0)&&--c,o==null?_=o=I.precision:s?_=o+(qa(n)-qa(a))+1:_=o,_<0)return new I(0);if(_=_/zn+2|0,u=0,T==1)for(d=0,M=M[0],_++;(u<P||d)&&_--;u++)w=d*Xa+(O[u]||0),v[u]=w/M|0,d=w%M|0;else{for(d=Xa/(M[0]+1)|0,d>1&&(M=e(M,d),O=e(O,d),T=M.length,P=O.length),A=T,m=O.slice(0,T),y=m.length;y<T;)m[y++]=0;S=M.slice(),S.unshift(0),E=M[0],M[1]>=Xa/2&&++E;do d=0,l=t(M,m,T,y),l<0?(b=m[0],T!=y&&(b=b*Xa+(m[1]||0)),d=b/E|0,d>1?(d>=Xa&&(d=Xa-1),f=e(M,d),h=f.length,y=m.length,l=t(f,m,h,y),l==1&&(d--,r(f,T<h?S:M,h))):(d==0&&(l=d=1),f=M.slice()),h=f.length,h<y&&f.unshift(0),r(m,f,y),l==-1&&(y=m.length,l=t(M,m,T,y),l<1&&(d++,r(m,T<y?S:M,y))),y=m.length):l===0&&(d++,m=[0]),v[u++]=d,l&&m[0]?m[y++]=O[A]||0:(m=[O[A]],y=1);while((A++<P||m[0]!==void 0)&&_--)}return v[0]||v.shift(),p.e=c,On(p,s?o+qa(p)+1:o)}}();function iM(e,t){var r,n,a,o,s,l,c=0,u=0,d=e.constructor,f=d.precision;if(qa(e)>16)throw Error(Kj+qa(e));if(!e.s)return new d(wo);for(Xn=!1,l=f,s=new d(.03125);e.abs().gte(.1);)e=e.times(s),u+=5;for(n=Math.log(Oc(2,u))/Math.LN10*2+5|0,l+=n,r=a=o=new d(wo),d.precision=l;;){if(a=On(a.times(e),l),r=r.times(++c),s=o.plus(dl(a,r,l)),ws(s.d).slice(0,l)===ws(o.d).slice(0,l)){for(;u--;)o=On(o.times(o),l);return d.precision=f,t==null?(Xn=!0,On(o,f)):o}o=s}}function qa(e){for(var t=e.e*zn,r=e.d[0];r>=10;r/=10)t++;return t}function D1(e,t,r){if(t>e.LN10.sd())throw Xn=!0,r&&(e.precision=r),Error(Vo+"LN10 precision limit exceeded");return On(new e(e.LN10),t)}function Wl(e){for(var t="";e--;)t+="0";return t}function rp(e,t){var r,n,a,o,s,l,c,u,d,f=1,h=10,p=e,v=p.d,m=p.constructor,y=m.precision;if(p.s<1)throw Error(Vo+(p.s?"NaN":"-Infinity"));if(p.eq(wo))return new m(0);if(t==null?(Xn=!1,u=y):u=t,p.eq(10))return t==null&&(Xn=!0),D1(m,u);if(u+=h,m.precision=u,r=ws(v),n=r.charAt(0),o=qa(p),Math.abs(o)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)p=p.times(e),r=ws(p.d),n=r.charAt(0),f++;o=qa(p),n>1?(p=new m("0."+r),o++):p=new m(n+"."+r.slice(1))}else return c=D1(m,u+2,y).times(o+""),p=rp(new m(n+"."+r.slice(1)),u-h).plus(c),m.precision=y,t==null?(Xn=!0,On(p,y)):p;for(l=s=p=dl(p.minus(wo),p.plus(wo),u),d=On(p.times(p),u),a=3;;){if(s=On(s.times(d),u),c=l.plus(dl(s,new m(a),u)),ws(c.d).slice(0,u)===ws(l.d).slice(0,u))return l=l.times(2),o!==0&&(l=l.plus(D1(m,u+2,y).times(o+""))),l=dl(l,new m(f),u),m.precision=y,t==null?(Xn=!0,On(l,y)):l;l=c,a+=2}}function Pk(e,t){var r,n,a;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(a=t.length;t.charCodeAt(a-1)===48;)--a;if(t=t.slice(n,a),t){if(a-=n,r=r-n-1,e.e=Ud(r/zn),e.d=[],n=(r+1)%zn,r<0&&(n+=zn),n<a){for(n&&e.d.push(+t.slice(0,n)),a-=zn;n<a;)e.d.push(+t.slice(n,n+=zn));t=t.slice(n),n=zn-t.length}else n-=a;for(;n--;)t+="0";if(e.d.push(+t),Xn&&(e.e>Rg||e.e<-Rg))throw Error(Kj+r)}else e.s=0,e.e=0,e.d=[0];return e}function On(e,t,r){var n,a,o,s,l,c,u,d,f=e.d;for(s=1,o=f[0];o>=10;o/=10)s++;if(n=t-s,n<0)n+=zn,a=t,u=f[d=0];else{if(d=Math.ceil((n+1)/zn),o=f.length,d>=o)return e;for(u=o=f[d],s=1;o>=10;o/=10)s++;n%=zn,a=n-zn+s}if(r!==void 0&&(o=Oc(10,s-a-1),l=u/o%10|0,c=t<0||f[d+1]!==void 0||u%o,c=r<4?(l||c)&&(r==0||r==(e.s<0?3:2)):l>5||l==5&&(r==4||c||r==6&&(n>0?a>0?u/Oc(10,s-a):0:f[d-1])%10&1||r==(e.s<0?8:7))),t<1||!f[0])return c?(o=qa(e),f.length=1,t=t-o-1,f[0]=Oc(10,(zn-t%zn)%zn),e.e=Ud(-t/zn)||0):(f.length=1,f[0]=e.e=e.s=0),e;if(n==0?(f.length=d,o=1,d--):(f.length=d+1,o=Oc(10,zn-n),f[d]=a>0?(u/Oc(10,s-a)%Oc(10,a)|0)*o:0),c)for(;;)if(d==0){(f[0]+=o)==Xa&&(f[0]=1,++e.e);break}else{if(f[d]+=o,f[d]!=Xa)break;f[d--]=0,o=1}for(n=f.length;f[--n]===0;)f.pop();if(Xn&&(e.e>Rg||e.e<-Rg))throw Error(Kj+qa(e));return e}function oM(e,t){var r,n,a,o,s,l,c,u,d,f,h=e.constructor,p=h.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new h(e),Xn?On(t,p):t;if(c=e.d,f=t.d,n=t.e,u=e.e,c=c.slice(),s=u-n,s){for(d=s<0,d?(r=c,s=-s,l=f.length):(r=f,n=u,l=c.length),a=Math.max(Math.ceil(p/zn),l)+2,s>a&&(s=a,r.length=1),r.reverse(),a=s;a--;)r.push(0);r.reverse()}else{for(a=c.length,l=f.length,d=a<l,d&&(l=a),a=0;a<l;a++)if(c[a]!=f[a]){d=c[a]<f[a];break}s=0}for(d&&(r=c,c=f,f=r,t.s=-t.s),l=c.length,a=f.length-l;a>0;--a)c[l++]=0;for(a=f.length;a>s;){if(c[--a]<f[a]){for(o=a;o&&c[--o]===0;)c[o]=Xa-1;--c[o],c[a]+=Xa}c[a]-=f[a]}for(;c[--l]===0;)c.pop();for(;c[0]===0;c.shift())--n;return c[0]?(t.d=c,t.e=n,Xn?On(t,p):t):new h(0)}function Qc(e,t,r){var n,a=qa(e),o=ws(e.d),s=o.length;return t?(r&&(n=r-s)>0?o=o.charAt(0)+"."+o.slice(1)+Wl(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(a<0?"e":"e+")+a):a<0?(o="0."+Wl(-a-1)+o,r&&(n=r-s)>0&&(o+=Wl(n))):a>=s?(o+=Wl(a+1-s),r&&(n=r-a-1)>0&&(o=o+"."+Wl(n))):((n=a+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),r&&(n=r-s)>0&&(a+1===s&&(o+="."),o+=Wl(n))),e.s<0?"-"+o:o}function Ok(e,t){if(e.length>t)return e.length=t,!0}function sM(e){var t,r,n;function a(o){var s=this;if(!(s instanceof a))return new a(o);if(s.constructor=a,o instanceof a){s.s=o.s,s.e=o.e,s.d=(o=o.d)?o.slice():o;return}if(typeof o=="number"){if(o*0!==0)throw Error(Bc+o);if(o>0)s.s=1;else if(o<0)o=-o,s.s=-1;else{s.s=0,s.e=0,s.d=[0];return}if(o===~~o&&o<1e7){s.e=0,s.d=[o];return}return Pk(s,o.toString())}else if(typeof o!="string")throw Error(Bc+o);if(o.charCodeAt(0)===45?(o=o.slice(1),s.s=-1):s.s=1,hG.test(o))Pk(s,o);else throw Error(Bc+o)}if(a.prototype=Qt,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=sM,a.config=a.set=pG,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return a.config(e),a}function pG(e){if(!e||typeof e!="object")throw Error(Vo+"Object expected");var t,r,n,a=["precision",1,Bd,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<a.length;t+=3)if((n=e[r=a[t]])!==void 0)if(Ud(n)===n&&n>=a[t+1]&&n<=a[t+2])this[r]=n;else throw Error(Bc+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(Bc+r+": "+n);return this}var Qj=sM(fG);wo=new Qj(1);const Sn=Qj;function mG(e){return xG(e)||yG(e)||vG(e)||gG()}function gG(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vG(e,t){if(e){if(typeof e=="string")return j_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j_(e,t)}}function yG(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function xG(e){if(Array.isArray(e))return j_(e)}function j_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var bG=function(t){return t},lM={},cM=function(t){return t===lM},kk=function(t){return function r(){return arguments.length===0||arguments.length===1&&cM(arguments.length<=0?void 0:arguments[0])?r:t.apply(void 0,arguments)}},_G=function e(t,r){return t===1?r:kk(function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];var s=a.filter(function(l){return l!==lM}).length;return s>=t?r.apply(void 0,a):e(t-s,kk(function(){for(var l=arguments.length,c=new Array(l),u=0;u<l;u++)c[u]=arguments[u];var d=a.map(function(f){return cM(f)?c.shift():f});return r.apply(void 0,mG(d).concat(c))}))})},cy=function(t){return _G(t.length,t)},S_=function(t,r){for(var n=[],a=t;a<r;++a)n[a-t]=a;return n},wG=cy(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),jG=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!r.length)return bG;var a=r.reverse(),o=a[0],s=a.slice(1);return function(){return s.reduce(function(l,c){return c(l)},o.apply(void 0,arguments))}},C_=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},uM=function(t){var r=null,n=null;return function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return r&&o.every(function(l,c){return l===r[c]})||(r=o,n=t.apply(void 0,o)),n}};function SG(e){var t;return e===0?t=1:t=Math.floor(new Sn(e).abs().log(10).toNumber())+1,t}function CG(e,t,r){for(var n=new Sn(e),a=0,o=[];n.lt(t)&&a<1e5;)o.push(n.toNumber()),n=n.add(r),a++;return o}var AG=cy(function(e,t,r){var n=+e,a=+t;return n+r*(a-n)}),PG=cy(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),OG=cy(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const uy={rangeStep:CG,getDigitCount:SG,interpolateNumber:AG,uninterpolateNumber:PG,uninterpolateTruncation:OG};function A_(e){return TG(e)||EG(e)||dM(e)||kG()}function kG(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EG(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function TG(e){if(Array.isArray(e))return P_(e)}function np(e,t){return DG(e)||NG(e,t)||dM(e,t)||IG()}function IG(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dM(e,t){if(e){if(typeof e=="string")return P_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return P_(e,t)}}function P_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function NG(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,a=!1,o=void 0;try{for(var s=e[Symbol.iterator](),l;!(n=(l=s.next()).done)&&(r.push(l.value),!(t&&r.length===t));n=!0);}catch(c){a=!0,o=c}finally{try{!n&&s.return!=null&&s.return()}finally{if(a)throw o}}return r}}function DG(e){if(Array.isArray(e))return e}function fM(e){var t=np(e,2),r=t[0],n=t[1],a=r,o=n;return r>n&&(a=n,o=r),[a,o]}function hM(e,t,r){if(e.lte(0))return new Sn(0);var n=uy.getDigitCount(e.toNumber()),a=new Sn(10).pow(n),o=e.div(a),s=n!==1?.05:.1,l=new Sn(Math.ceil(o.div(s).toNumber())).add(r).mul(s),c=l.mul(a);return t?c:new Sn(Math.ceil(c))}function MG(e,t,r){var n=1,a=new Sn(e);if(!a.isint()&&r){var o=Math.abs(e);o<1?(n=new Sn(10).pow(uy.getDigitCount(e)-1),a=new Sn(Math.floor(a.div(n).toNumber())).mul(n)):o>1&&(a=new Sn(Math.floor(e)))}else e===0?a=new Sn(Math.floor((t-1)/2)):r||(a=new Sn(Math.floor(e)));var s=Math.floor((t-1)/2),l=jG(wG(function(c){return a.add(new Sn(c-s).mul(n)).toNumber()}),S_);return l(0,t)}function pM(e,t,r,n){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new Sn(0),tickMin:new Sn(0),tickMax:new Sn(0)};var o=hM(new Sn(t).sub(e).div(r-1),n,a),s;e<=0&&t>=0?s=new Sn(0):(s=new Sn(e).add(t).div(2),s=s.sub(new Sn(s).mod(o)));var l=Math.ceil(s.sub(e).div(o).toNumber()),c=Math.ceil(new Sn(t).sub(s).div(o).toNumber()),u=l+c+1;return u>r?pM(e,t,r,n,a+1):(u<r&&(c=t>0?c+(r-u):c,l=t>0?l:l+(r-u)),{step:o,tickMin:s.sub(new Sn(l).mul(o)),tickMax:s.add(new Sn(c).mul(o))})}function LG(e){var t=np(e,2),r=t[0],n=t[1],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=Math.max(a,2),l=fM([r,n]),c=np(l,2),u=c[0],d=c[1];if(u===-1/0||d===1/0){var f=d===1/0?[u].concat(A_(S_(0,a-1).map(function(){return 1/0}))):[].concat(A_(S_(0,a-1).map(function(){return-1/0})),[d]);return r>n?C_(f):f}if(u===d)return MG(u,a,o);var h=pM(u,d,s,o),p=h.step,v=h.tickMin,m=h.tickMax,y=uy.rangeStep(v,m.add(new Sn(.1).mul(p)),p);return r>n?C_(y):y}function RG(e,t){var r=np(e,2),n=r[0],a=r[1],o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=fM([n,a]),l=np(s,2),c=l[0],u=l[1];if(c===-1/0||u===1/0)return[n,a];if(c===u)return[c];var d=Math.max(t,2),f=hM(new Sn(u).sub(c).div(d-1),o,0),h=[].concat(A_(uy.rangeStep(new Sn(c),new Sn(u).sub(new Sn(.99).mul(f)),f)),[u]);return n>a?C_(h):h}var qG=uM(LG),FG=uM(RG),$G="Invariant failed";function Xc(e,t){throw new Error($G)}var BG=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function ld(e){"@babel/helpers - typeof";return ld=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ld(e)}function qg(){return qg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qg.apply(this,arguments)}function UG(e,t){return VG(e)||HG(e,t)||WG(e,t)||zG()}function zG(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function WG(e,t){if(e){if(typeof e=="string")return Ek(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ek(e,t)}}function Ek(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function HG(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function VG(e){if(Array.isArray(e))return e}function GG(e,t){if(e==null)return{};var r=YG(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function YG(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function KG(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function QG(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,vM(n.key),n)}}function XG(e,t,r){return t&&QG(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function JG(e,t,r){return t=Fg(t),ZG(e,mM()?Reflect.construct(t,r||[],Fg(e).constructor):t.apply(e,r))}function ZG(e,t){if(t&&(ld(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return eY(e)}function eY(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mM(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mM=function(){return!!e})()}function Fg(e){return Fg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Fg(e)}function tY(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&O_(e,t)}function O_(e,t){return O_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},O_(e,t)}function gM(e,t,r){return t=vM(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vM(e){var t=rY(e,"string");return ld(t)=="symbol"?t:t+""}function rY(e,t){if(ld(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ld(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Up=function(e){function t(){return KG(this,t),JG(this,t,arguments)}return tY(t,e),XG(t,[{key:"render",value:function(){var n=this.props,a=n.offset,o=n.layout,s=n.width,l=n.dataKey,c=n.data,u=n.dataPointFormatter,d=n.xAxis,f=n.yAxis,h=GG(n,BG),p=gr(h,!1);this.props.direction==="x"&&d.type!=="number"&&Xc();var v=c.map(function(m){var y=u(m,l),b=y.x,_=y.y,w=y.value,A=y.errorVal;if(!A)return null;var P=[],E,T;if(Array.isArray(A)){var S=UG(A,2);E=S[0],T=S[1]}else E=T=A;if(o==="vertical"){var I=d.scale,U=_+a,O=U+s,M=U-s,L=I(w-E),q=I(w+T);P.push({x1:q,y1:O,x2:q,y2:M}),P.push({x1:L,y1:U,x2:q,y2:U}),P.push({x1:L,y1:O,x2:L,y2:M})}else if(o==="horizontal"){var z=f.scale,K=b+a,J=K-s,R=K+s,k=z(w-E),$=z(w+T);P.push({x1:J,y1:$,x2:R,y2:$}),P.push({x1:K,y1:k,x2:K,y2:$}),P.push({x1:J,y1:k,x2:R,y2:k})}return Ae.createElement(cn,qg({className:"recharts-errorBar",key:"bar-".concat(P.map(function(X){return"".concat(X.x1,"-").concat(X.x2,"-").concat(X.y1,"-").concat(X.y2)}))},p),P.map(function(X){return Ae.createElement("line",qg({},X,{key:"line-".concat(X.x1,"-").concat(X.x2,"-").concat(X.y1,"-").concat(X.y2)}))}))});return Ae.createElement(cn,{className:"recharts-errorBars"},v)}}])}(Ae.Component);gM(Up,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});gM(Up,"displayName","ErrorBar");function ap(e){"@babel/helpers - typeof";return ap=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ap(e)}function Tk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function wc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Tk(Object(r),!0).forEach(function(n){nY(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Tk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nY(e,t,r){return t=aY(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aY(e){var t=iY(e,"string");return ap(t)=="symbol"?t:t+""}function iY(e,t){if(ap(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ap(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var yM=function(t){var r=t.children,n=t.formattedGraphicalItems,a=t.legendWidth,o=t.legendContent,s=yo(r,Ss);if(!s)return null;var l=Ss.defaultProps,c=l!==void 0?wc(wc({},l),s.props):{},u;return s.props&&s.props.payload?u=s.props&&s.props.payload:o==="children"?u=(n||[]).reduce(function(d,f){var h=f.item,p=f.props,v=p.sectors||p.data||[];return d.concat(v.map(function(m){return{type:s.props.iconType||h.props.legendType,value:m.name,color:m.fill,payload:m}}))},[]):u=(n||[]).map(function(d){var f=d.item,h=f.type.defaultProps,p=h!==void 0?wc(wc({},h),f.props):{},v=p.dataKey,m=p.name,y=p.legendType,b=p.hide;return{inactive:b,dataKey:v,type:c.iconType||y||"square",color:Xj(f),value:m||v,payload:p}}),wc(wc(wc({},c),Ss.getWithHeight(s,a)),{},{payload:u,item:s})};function ip(e){"@babel/helpers - typeof";return ip=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ip(e)}function Ik(e){return cY(e)||lY(e)||sY(e)||oY()}function oY(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sY(e,t){if(e){if(typeof e=="string")return k_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k_(e,t)}}function lY(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function cY(e){if(Array.isArray(e))return k_(e)}function k_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Nk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ha(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Nk(Object(r),!0).forEach(function(n){Gu(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Gu(e,t,r){return t=uY(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uY(e){var t=dY(e,"string");return ip(t)=="symbol"?t:t+""}function dY(e,t){if(ip(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ip(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Wa(e,t,r){return Fr(e)||Fr(t)?r:Ha(t)?Co(e,t,r):Tr(t)?t(e):r}function Th(e,t,r,n){var a=cG(e,function(l){return Wa(l,t)});if(r==="number"){var o=a.filter(function(l){return Dt(l)||parseFloat(l)});return o.length?[ly(o),sy(o)]:[1/0,-1/0]}var s=n?a.filter(function(l){return!Fr(l)}):a;return s.map(function(l){return Ha(l)||l instanceof Date?l:""})}var fY=function(t){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,s=-1,l=(r=n?.length)!==null&&r!==void 0?r:0;if(l<=1)return 0;if(o&&o.axisType==="angleAxis"&&Math.abs(Math.abs(o.range[1]-o.range[0])-360)<=1e-6)for(var c=o.range,u=0;u<l;u++){var d=u>0?a[u-1].coordinate:a[l-1].coordinate,f=a[u].coordinate,h=u>=l-1?a[0].coordinate:a[u+1].coordinate,p=void 0;if(Mi(f-d)!==Mi(h-f)){var v=[];if(Mi(h-f)===Mi(c[1]-c[0])){p=h;var m=f+c[1]-c[0];v[0]=Math.min(m,(m+d)/2),v[1]=Math.max(m,(m+d)/2)}else{p=d;var y=h+c[1]-c[0];v[0]=Math.min(f,(y+f)/2),v[1]=Math.max(f,(y+f)/2)}var b=[Math.min(f,(p+f)/2),Math.max(f,(p+f)/2)];if(t>b[0]&&t<=b[1]||t>=v[0]&&t<=v[1]){s=a[u].index;break}}else{var _=Math.min(d,h),w=Math.max(d,h);if(t>(_+f)/2&&t<=(w+f)/2){s=a[u].index;break}}}else for(var A=0;A<l;A++)if(A===0&&t<=(n[A].coordinate+n[A+1].coordinate)/2||A>0&&A<l-1&&t>(n[A].coordinate+n[A-1].coordinate)/2&&t<=(n[A].coordinate+n[A+1].coordinate)/2||A===l-1&&t>(n[A].coordinate+n[A-1].coordinate)/2){s=n[A].index;break}return s},Xj=function(t){var r,n=t,a=n.type.displayName,o=(r=t.type)!==null&&r!==void 0&&r.defaultProps?ha(ha({},t.type.defaultProps),t.props):t.props,s=o.stroke,l=o.fill,c;switch(a){case"Line":c=s;break;case"Area":case"Radar":c=s&&s!=="none"?s:l;break;default:c=l;break}return c},hY=function(t){var r=t.barSize,n=t.totalSize,a=t.stackGroups,o=a===void 0?{}:a;if(!o)return{};for(var s={},l=Object.keys(o),c=0,u=l.length;c<u;c++)for(var d=o[l[c]].stackGroups,f=Object.keys(d),h=0,p=f.length;h<p;h++){var v=d[f[h]],m=v.items,y=v.cateAxisId,b=m.filter(function(T){return ul(T.type).indexOf("Bar")>=0});if(b&&b.length){var _=b[0].type.defaultProps,w=_!==void 0?ha(ha({},_),b[0].props):b[0].props,A=w.barSize,P=w[y];s[P]||(s[P]=[]);var E=Fr(A)?r:A;s[P].push({item:b[0],stackList:b.slice(1),barSize:Fr(E)?void 0:Li(E,n,0)})}}return s},pY=function(t){var r=t.barGap,n=t.barCategoryGap,a=t.bandSize,o=t.sizeList,s=o===void 0?[]:o,l=t.maxBarSize,c=s.length;if(c<1)return null;var u=Li(r,a,0,!0),d,f=[];if(s[0].barSize===+s[0].barSize){var h=!1,p=a/c,v=s.reduce(function(A,P){return A+P.barSize||0},0);v+=(c-1)*u,v>=a&&(v-=(c-1)*u,u=0),v>=a&&p>0&&(h=!0,p*=.9,v=c*p);var m=(a-v)/2>>0,y={offset:m-u,size:0};d=s.reduce(function(A,P){var E={item:P.item,position:{offset:y.offset+y.size+u,size:h?p:P.barSize}},T=[].concat(Ik(A),[E]);return y=T[T.length-1].position,P.stackList&&P.stackList.length&&P.stackList.forEach(function(S){T.push({item:S,position:y})}),T},f)}else{var b=Li(n,a,0,!0);a-2*b-(c-1)*u<=0&&(u=0);var _=(a-2*b-(c-1)*u)/c;_>1&&(_>>=0);var w=l===+l?Math.min(_,l):_;d=s.reduce(function(A,P,E){var T=[].concat(Ik(A),[{item:P.item,position:{offset:b+(_+u)*E+(_-w)/2,size:w}}]);return P.stackList&&P.stackList.length&&P.stackList.forEach(function(S){T.push({item:S,position:T[T.length-1].position})}),T},f)}return d},mY=function(t,r,n,a){var o=n.children,s=n.width,l=n.margin,c=s-(l.left||0)-(l.right||0),u=yM({children:o,legendWidth:c});if(u){var d=a||{},f=d.width,h=d.height,p=u.align,v=u.verticalAlign,m=u.layout;if((m==="vertical"||m==="horizontal"&&v==="middle")&&p!=="center"&&Dt(t[p]))return ha(ha({},t),{},Gu({},p,t[p]+(f||0)));if((m==="horizontal"||m==="vertical"&&p==="center")&&v!=="middle"&&Dt(t[v]))return ha(ha({},t),{},Gu({},v,t[v]+(h||0)))}return t},gY=function(t,r,n){return Fr(r)?!0:t==="horizontal"?r==="yAxis":t==="vertical"||n==="x"?r==="xAxis":n==="y"?r==="yAxis":!0},xM=function(t,r,n,a,o){var s=r.props.children,l=Ao(s,Up).filter(function(u){return gY(a,o,u.props.direction)});if(l&&l.length){var c=l.map(function(u){return u.props.dataKey});return t.reduce(function(u,d){var f=Wa(d,n);if(Fr(f))return u;var h=Array.isArray(f)?[ly(f),sy(f)]:[f,f],p=c.reduce(function(v,m){var y=Wa(d,m,0),b=h[0]-Math.abs(Array.isArray(y)?y[0]:y),_=h[1]+Math.abs(Array.isArray(y)?y[1]:y);return[Math.min(b,v[0]),Math.max(_,v[1])]},[1/0,-1/0]);return[Math.min(p[0],u[0]),Math.max(p[1],u[1])]},[1/0,-1/0])}return null},vY=function(t,r,n,a,o){var s=r.map(function(l){return xM(t,l,n,o,a)}).filter(function(l){return!Fr(l)});return s&&s.length?s.reduce(function(l,c){return[Math.min(l[0],c[0]),Math.max(l[1],c[1])]},[1/0,-1/0]):null},bM=function(t,r,n,a,o){var s=r.map(function(c){var u=c.props.dataKey;return n==="number"&&u&&xM(t,c,u,a)||Th(t,u,n,o)});if(n==="number")return s.reduce(function(c,u){return[Math.min(c[0],u[0]),Math.max(c[1],u[1])]},[1/0,-1/0]);var l={};return s.reduce(function(c,u){for(var d=0,f=u.length;d<f;d++)l[u[d]]||(l[u[d]]=!0,c.push(u[d]));return c},[])},_M=function(t,r){return t==="horizontal"&&r==="xAxis"||t==="vertical"&&r==="yAxis"||t==="centric"&&r==="angleAxis"||t==="radial"&&r==="radiusAxis"},wM=function(t,r,n,a){if(a)return t.map(function(c){return c.coordinate});var o,s,l=t.map(function(c){return c.coordinate===r&&(o=!0),c.coordinate===n&&(s=!0),c.coordinate});return o||l.push(r),s||l.push(n),l},sl=function(t,r,n){if(!t)return null;var a=t.scale,o=t.duplicateDomain,s=t.type,l=t.range,c=t.realScaleType==="scaleBand"?a.bandwidth()/2:2,u=(r||n)&&s==="category"&&a.bandwidth?a.bandwidth()/c:0;if(u=t.axisType==="angleAxis"&&l?.length>=2?Mi(l[0]-l[1])*2*u:u,r&&(t.ticks||t.niceTicks)){var d=(t.ticks||t.niceTicks).map(function(f){var h=o?o.indexOf(f):f;return{coordinate:a(h)+u,value:f,offset:u}});return d.filter(function(f){return!Mp(f.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(f,h){return{coordinate:a(f)+u,value:f,index:h,offset:u}}):a.ticks&&!n?a.ticks(t.tickCount).map(function(f){return{coordinate:a(f)+u,value:f,offset:u}}):a.domain().map(function(f,h){return{coordinate:a(f)+u,value:o?o[f]:f,index:h,offset:u}})},M1=new WeakMap,jm=function(t,r){if(typeof r!="function")return t;M1.has(t)||M1.set(t,new WeakMap);var n=M1.get(t);if(n.has(r))return n.get(r);var a=function(){t.apply(void 0,arguments),r.apply(void 0,arguments)};return n.set(r,a),a},jM=function(t,r,n){var a=t.scale,o=t.type,s=t.layout,l=t.axisType;if(a==="auto")return s==="radial"&&l==="radiusAxis"?{scale:Xh(),realScaleType:"band"}:s==="radial"&&l==="angleAxis"?{scale:Ng(),realScaleType:"linear"}:o==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?{scale:Eh(),realScaleType:"point"}:o==="category"?{scale:Xh(),realScaleType:"band"}:{scale:Ng(),realScaleType:"linear"};if(Gc(a)){var c="scale".concat(Vv(a));return{scale:(yk[c]||Eh)(),realScaleType:yk[c]?c:"point"}}return Tr(a)?{scale:a}:{scale:Eh(),realScaleType:"point"}},Dk=1e-4,SM=function(t){var r=t.domain();if(!(!r||r.length<=2)){var n=r.length,a=t.range(),o=Math.min(a[0],a[1])-Dk,s=Math.max(a[0],a[1])+Dk,l=t(r[0]),c=t(r[n-1]);(l<o||l>s||c<o||c>s)&&t.domain([r[0],r[n-1]])}},yY=function(t,r){if(!t)return null;for(var n=0,a=t.length;n<a;n++)if(t[n].item===r)return t[n].position;return null},xY=function(t,r){if(!r||r.length!==2||!Dt(r[0])||!Dt(r[1]))return t;var n=Math.min(r[0],r[1]),a=Math.max(r[0],r[1]),o=[t[0],t[1]];return(!Dt(t[0])||t[0]<n)&&(o[0]=n),(!Dt(t[1])||t[1]>a)&&(o[1]=a),o[0]>a&&(o[0]=a),o[1]<n&&(o[1]=n),o},bY=function(t){var r=t.length;if(!(r<=0))for(var n=0,a=t[0].length;n<a;++n)for(var o=0,s=0,l=0;l<r;++l){var c=Mp(t[l][n][1])?t[l][n][0]:t[l][n][1];c>=0?(t[l][n][0]=o,t[l][n][1]=o+c,o=t[l][n][1]):(t[l][n][0]=s,t[l][n][1]=s+c,s=t[l][n][1])}},_Y=function(t){var r=t.length;if(!(r<=0))for(var n=0,a=t[0].length;n<a;++n)for(var o=0,s=0;s<r;++s){var l=Mp(t[s][n][1])?t[s][n][0]:t[s][n][1];l>=0?(t[s][n][0]=o,t[s][n][1]=o+l,o=t[s][n][1]):(t[s][n][0]=0,t[s][n][1]=0)}},wY={sign:bY,expand:cU,none:ed,silhouette:uU,wiggle:dU,positive:_Y},jY=function(t,r,n){var a=r.map(function(l){return l.props.dataKey}),o=wY[n],s=lU().keys(a).value(function(l,c){return+Wa(l,c,0)}).order(i_).offset(o);return s(t)},SY=function(t,r,n,a,o,s){if(!t)return null;var l=s?r.reverse():r,c={},u=l.reduce(function(f,h){var p,v=(p=h.type)!==null&&p!==void 0&&p.defaultProps?ha(ha({},h.type.defaultProps),h.props):h.props,m=v.stackId,y=v.hide;if(y)return f;var b=v[n],_=f[b]||{hasStack:!1,stackGroups:{}};if(Ha(m)){var w=_.stackGroups[m]||{numericAxisId:n,cateAxisId:a,items:[]};w.items.push(h),_.hasStack=!0,_.stackGroups[m]=w}else _.stackGroups[qd("_stackId_")]={numericAxisId:n,cateAxisId:a,items:[h]};return ha(ha({},f),{},Gu({},b,_))},c),d={};return Object.keys(u).reduce(function(f,h){var p=u[h];if(p.hasStack){var v={};p.stackGroups=Object.keys(p.stackGroups).reduce(function(m,y){var b=p.stackGroups[y];return ha(ha({},m),{},Gu({},y,{numericAxisId:n,cateAxisId:a,items:b.items,stackedData:jY(t,b.items,o)}))},v)}return ha(ha({},f),{},Gu({},h,p))},d)},CM=function(t,r){var n=r.realScaleType,a=r.type,o=r.tickCount,s=r.originalDomain,l=r.allowDecimals,c=n||r.scale;if(c!=="auto"&&c!=="linear")return null;if(o&&a==="number"&&s&&(s[0]==="auto"||s[1]==="auto")){var u=t.domain();if(!u.length)return null;var d=qG(u,o,l);return t.domain([ly(d),sy(d)]),{niceTicks:d}}if(o&&a==="number"){var f=t.domain(),h=FG(f,o,l);return{niceTicks:h}}return null};function Mk(e){var t=e.axis,r=e.ticks,n=e.bandSize,a=e.entry,o=e.index,s=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!Fr(a[t.dataKey])){var l=mg(r,"value",a[t.dataKey]);if(l)return l.coordinate+n/2}return r[o]?r[o].coordinate+n/2:null}var c=Wa(a,Fr(s)?t.dataKey:s);return Fr(c)?null:t.scale(c)}var Lk=function(t){var r=t.axis,n=t.ticks,a=t.offset,o=t.bandSize,s=t.entry,l=t.index;if(r.type==="category")return n[l]?n[l].coordinate+a:null;var c=Wa(s,r.dataKey,r.domain[l]);return Fr(c)?null:r.scale(c)-o/2+a},CY=function(t){var r=t.numericAxis,n=r.scale.domain();if(r.type==="number"){var a=Math.min(n[0],n[1]),o=Math.max(n[0],n[1]);return a<=0&&o>=0?0:o<0?o:a}return n[0]},AY=function(t,r){var n,a=(n=t.type)!==null&&n!==void 0&&n.defaultProps?ha(ha({},t.type.defaultProps),t.props):t.props,o=a.stackId;if(Ha(o)){var s=r[o];if(s){var l=s.items.indexOf(t);return l>=0?s.stackedData[l]:null}}return null},PY=function(t){return t.reduce(function(r,n){return[ly(n.concat([r[0]]).filter(Dt)),sy(n.concat([r[1]]).filter(Dt))]},[1/0,-1/0])},AM=function(t,r,n){return Object.keys(t).reduce(function(a,o){var s=t[o],l=s.stackedData,c=l.reduce(function(u,d){var f=PY(d.slice(r,n+1));return[Math.min(u[0],f[0]),Math.max(u[1],f[1])]},[1/0,-1/0]);return[Math.min(c[0],a[0]),Math.max(c[1],a[1])]},[1/0,-1/0]).map(function(a){return a===1/0||a===-1/0?0:a})},Rk=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,qk=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,E_=function(t,r,n){if(Tr(t))return t(r,n);if(!Array.isArray(t))return r;var a=[];if(Dt(t[0]))a[0]=n?t[0]:Math.min(t[0],r[0]);else if(Rk.test(t[0])){var o=+Rk.exec(t[0])[1];a[0]=r[0]-o}else Tr(t[0])?a[0]=t[0](r[0]):a[0]=r[0];if(Dt(t[1]))a[1]=n?t[1]:Math.max(t[1],r[1]);else if(qk.test(t[1])){var s=+qk.exec(t[1])[1];a[1]=r[1]+s}else Tr(t[1])?a[1]=t[1](r[1]):a[1]=r[1];return a},$g=function(t,r,n){if(t&&t.scale&&t.scale.bandwidth){var a=t.scale.bandwidth();if(!n||a>0)return a}if(t&&r&&r.length>=2){for(var o=Cj(r,function(f){return f.coordinate}),s=1/0,l=1,c=o.length;l<c;l++){var u=o[l],d=o[l-1];s=Math.min((u.coordinate||0)-(d.coordinate||0),s)}return s===1/0?0:s}return n?void 0:0},Fk=function(t,r,n){return!t||!t.length||Bp(t,Co(n,"type.defaultProps.domain"))?r:t},PM=function(t,r){var n=t.type.defaultProps?ha(ha({},t.type.defaultProps),t.props):t.props,a=n.dataKey,o=n.name,s=n.unit,l=n.formatter,c=n.tooltipType,u=n.chartType,d=n.hide;return ha(ha({},gr(t,!1)),{},{dataKey:a,unit:s,formatter:l,name:o||a,color:Xj(t),value:Wa(r,a),type:c,payload:r,chartType:u,hide:d})};function op(e){"@babel/helpers - typeof";return op=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},op(e)}function $k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function nl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$k(Object(r),!0).forEach(function(n){OM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$k(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function OM(e,t,r){return t=OY(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function OY(e){var t=kY(e,"string");return op(t)=="symbol"?t:t+""}function kY(e,t){if(op(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(op(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function EY(e,t){return DY(e)||NY(e,t)||IY(e,t)||TY()}function TY(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function IY(e,t){if(e){if(typeof e=="string")return Bk(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Bk(e,t)}}function Bk(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function NY(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function DY(e){if(Array.isArray(e))return e}var Bg=Math.PI/180,MY=function(t){return t*180/Math.PI},Fn=function(t,r,n,a){return{x:t+Math.cos(-Bg*a)*n,y:r+Math.sin(-Bg*a)*n}},kM=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(n.left||0)-(n.right||0)),Math.abs(r-(n.top||0)-(n.bottom||0)))/2},LY=function(t,r,n,a,o){var s=t.width,l=t.height,c=t.startAngle,u=t.endAngle,d=Li(t.cx,s,s/2),f=Li(t.cy,l,l/2),h=kM(s,l,n),p=Li(t.innerRadius,h,0),v=Li(t.outerRadius,h,h*.8),m=Object.keys(r);return m.reduce(function(y,b){var _=r[b],w=_.domain,A=_.reversed,P;if(Fr(_.range))a==="angleAxis"?P=[c,u]:a==="radiusAxis"&&(P=[p,v]),A&&(P=[P[1],P[0]]);else{P=_.range;var E=P,T=EY(E,2);c=T[0],u=T[1]}var S=jM(_,o),I=S.realScaleType,U=S.scale;U.domain(w).range(P),SM(U);var O=CM(U,nl(nl({},_),{},{realScaleType:I})),M=nl(nl(nl({},_),O),{},{range:P,radius:v,realScaleType:I,scale:U,cx:d,cy:f,innerRadius:p,outerRadius:v,startAngle:c,endAngle:u});return nl(nl({},y),{},OM({},b,M))},{})},RY=function(t,r){var n=t.x,a=t.y,o=r.x,s=r.y;return Math.sqrt(Math.pow(n-o,2)+Math.pow(a-s,2))},qY=function(t,r){var n=t.x,a=t.y,o=r.cx,s=r.cy,l=RY({x:n,y:a},{x:o,y:s});if(l<=0)return{radius:l};var c=(n-o)/l,u=Math.acos(c);return a>s&&(u=2*Math.PI-u),{radius:l,angle:MY(u),angleInRadian:u}},FY=function(t){var r=t.startAngle,n=t.endAngle,a=Math.floor(r/360),o=Math.floor(n/360),s=Math.min(a,o);return{startAngle:r-s*360,endAngle:n-s*360}},$Y=function(t,r){var n=r.startAngle,a=r.endAngle,o=Math.floor(n/360),s=Math.floor(a/360),l=Math.min(o,s);return t+l*360},Uk=function(t,r){var n=t.x,a=t.y,o=qY({x:n,y:a},r),s=o.radius,l=o.angle,c=r.innerRadius,u=r.outerRadius;if(s<c||s>u)return!1;if(s===0)return!0;var d=FY(r),f=d.startAngle,h=d.endAngle,p=l,v;if(f<=h){for(;p>h;)p-=360;for(;p<f;)p+=360;v=p>=f&&p<=h}else{for(;p>f;)p-=360;for(;p<h;)p+=360;v=p>=h&&p<=f}return v?nl(nl({},r),{},{radius:s,angle:$Y(p,r)}):null},EM=function(t){return!x.isValidElement(t)&&!Tr(t)&&typeof t!="boolean"?t.className:""};function sp(e){"@babel/helpers - typeof";return sp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sp(e)}var BY=["offset"];function UY(e){return VY(e)||HY(e)||WY(e)||zY()}function zY(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function WY(e,t){if(e){if(typeof e=="string")return T_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T_(e,t)}}function HY(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function VY(e){if(Array.isArray(e))return T_(e)}function T_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function GY(e,t){if(e==null)return{};var r=YY(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function YY(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function zk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ua(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?zk(Object(r),!0).forEach(function(n){KY(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function KY(e,t,r){return t=QY(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function QY(e){var t=XY(e,"string");return sp(t)=="symbol"?t:t+""}function XY(e,t){if(sp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(sp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function lp(){return lp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lp.apply(this,arguments)}var JY=function(t){var r=t.value,n=t.formatter,a=Fr(t.children)?r:t.children;return Tr(n)?n(a):a},ZY=function(t,r){var n=Mi(r-t),a=Math.min(Math.abs(r-t),360);return n*a},eK=function(t,r,n){var a=t.position,o=t.viewBox,s=t.offset,l=t.className,c=o,u=c.cx,d=c.cy,f=c.innerRadius,h=c.outerRadius,p=c.startAngle,v=c.endAngle,m=c.clockWise,y=(f+h)/2,b=ZY(p,v),_=b>=0?1:-1,w,A;a==="insideStart"?(w=p+_*s,A=m):a==="insideEnd"?(w=v-_*s,A=!m):a==="end"&&(w=v+_*s,A=m),A=b<=0?A:!A;var P=Fn(u,d,y,w),E=Fn(u,d,y,w+(A?1:-1)*359),T="M".concat(P.x,",").concat(P.y,`
    A`).concat(y,",").concat(y,",0,1,").concat(A?0:1,`,
    `).concat(E.x,",").concat(E.y),S=Fr(t.id)?qd("recharts-radial-line-"):t.id;return Ae.createElement("text",lp({},n,{dominantBaseline:"central",className:Pr("recharts-radial-bar-label",l)}),Ae.createElement("defs",null,Ae.createElement("path",{id:S,d:T})),Ae.createElement("textPath",{xlinkHref:"#".concat(S)},r))},tK=function(t){var r=t.viewBox,n=t.offset,a=t.position,o=r,s=o.cx,l=o.cy,c=o.innerRadius,u=o.outerRadius,d=o.startAngle,f=o.endAngle,h=(d+f)/2;if(a==="outside"){var p=Fn(s,l,u+n,h),v=p.x,m=p.y;return{x:v,y:m,textAnchor:v>=s?"start":"end",verticalAnchor:"middle"}}if(a==="center")return{x:s,y:l,textAnchor:"middle",verticalAnchor:"middle"};if(a==="centerTop")return{x:s,y:l,textAnchor:"middle",verticalAnchor:"start"};if(a==="centerBottom")return{x:s,y:l,textAnchor:"middle",verticalAnchor:"end"};var y=(c+u)/2,b=Fn(s,l,y,h),_=b.x,w=b.y;return{x:_,y:w,textAnchor:"middle",verticalAnchor:"middle"}},rK=function(t){var r=t.viewBox,n=t.parentViewBox,a=t.offset,o=t.position,s=r,l=s.x,c=s.y,u=s.width,d=s.height,f=d>=0?1:-1,h=f*a,p=f>0?"end":"start",v=f>0?"start":"end",m=u>=0?1:-1,y=m*a,b=m>0?"end":"start",_=m>0?"start":"end";if(o==="top"){var w={x:l+u/2,y:c-f*a,textAnchor:"middle",verticalAnchor:p};return Ua(Ua({},w),n?{height:Math.max(c-n.y,0),width:u}:{})}if(o==="bottom"){var A={x:l+u/2,y:c+d+h,textAnchor:"middle",verticalAnchor:v};return Ua(Ua({},A),n?{height:Math.max(n.y+n.height-(c+d),0),width:u}:{})}if(o==="left"){var P={x:l-y,y:c+d/2,textAnchor:b,verticalAnchor:"middle"};return Ua(Ua({},P),n?{width:Math.max(P.x-n.x,0),height:d}:{})}if(o==="right"){var E={x:l+u+y,y:c+d/2,textAnchor:_,verticalAnchor:"middle"};return Ua(Ua({},E),n?{width:Math.max(n.x+n.width-E.x,0),height:d}:{})}var T=n?{width:u,height:d}:{};return o==="insideLeft"?Ua({x:l+y,y:c+d/2,textAnchor:_,verticalAnchor:"middle"},T):o==="insideRight"?Ua({x:l+u-y,y:c+d/2,textAnchor:b,verticalAnchor:"middle"},T):o==="insideTop"?Ua({x:l+u/2,y:c+h,textAnchor:"middle",verticalAnchor:v},T):o==="insideBottom"?Ua({x:l+u/2,y:c+d-h,textAnchor:"middle",verticalAnchor:p},T):o==="insideTopLeft"?Ua({x:l+y,y:c+h,textAnchor:_,verticalAnchor:v},T):o==="insideTopRight"?Ua({x:l+u-y,y:c+h,textAnchor:b,verticalAnchor:v},T):o==="insideBottomLeft"?Ua({x:l+y,y:c+d-h,textAnchor:_,verticalAnchor:p},T):o==="insideBottomRight"?Ua({x:l+u-y,y:c+d-h,textAnchor:b,verticalAnchor:p},T):Rd(o)&&(Dt(o.x)||Mc(o.x))&&(Dt(o.y)||Mc(o.y))?Ua({x:l+Li(o.x,u),y:c+Li(o.y,d),textAnchor:"end",verticalAnchor:"end"},T):Ua({x:l+u/2,y:c+d/2,textAnchor:"middle",verticalAnchor:"middle"},T)},nK=function(t){return"cx"in t&&Dt(t.cx)};function Za(e){var t=e.offset,r=t===void 0?5:t,n=GY(e,BY),a=Ua({offset:r},n),o=a.viewBox,s=a.position,l=a.value,c=a.children,u=a.content,d=a.className,f=d===void 0?"":d,h=a.textBreakAll;if(!o||Fr(l)&&Fr(c)&&!x.isValidElement(u)&&!Tr(u))return null;if(x.isValidElement(u))return x.cloneElement(u,a);var p;if(Tr(u)){if(p=x.createElement(u,a),x.isValidElement(p))return p}else p=JY(a);var v=nK(o),m=gr(a,!0);if(v&&(s==="insideStart"||s==="insideEnd"||s==="end"))return eK(a,p,m);var y=v?tK(a):rK(a);return Ae.createElement(Kc,lp({className:Pr("recharts-label",f)},m,y,{breakAll:h}),p)}Za.displayName="Label";var TM=function(t){var r=t.cx,n=t.cy,a=t.angle,o=t.startAngle,s=t.endAngle,l=t.r,c=t.radius,u=t.innerRadius,d=t.outerRadius,f=t.x,h=t.y,p=t.top,v=t.left,m=t.width,y=t.height,b=t.clockWise,_=t.labelViewBox;if(_)return _;if(Dt(m)&&Dt(y)){if(Dt(f)&&Dt(h))return{x:f,y:h,width:m,height:y};if(Dt(p)&&Dt(v))return{x:p,y:v,width:m,height:y}}return Dt(f)&&Dt(h)?{x:f,y:h,width:0,height:0}:Dt(r)&&Dt(n)?{cx:r,cy:n,startAngle:o||a||0,endAngle:s||a||0,innerRadius:u||0,outerRadius:d||c||l||0,clockWise:b}:t.viewBox?t.viewBox:{}},aK=function(t,r){return t?t===!0?Ae.createElement(Za,{key:"label-implicit",viewBox:r}):Ha(t)?Ae.createElement(Za,{key:"label-implicit",viewBox:r,value:t}):x.isValidElement(t)?t.type===Za?x.cloneElement(t,{key:"label-implicit",viewBox:r}):Ae.createElement(Za,{key:"label-implicit",content:t,viewBox:r}):Tr(t)?Ae.createElement(Za,{key:"label-implicit",content:t,viewBox:r}):Rd(t)?Ae.createElement(Za,lp({viewBox:r},t,{key:"label-implicit"})):null:null},iK=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&n&&!t.label)return null;var a=t.children,o=TM(t),s=Ao(a,Za).map(function(c,u){return x.cloneElement(c,{viewBox:r||o,key:"label-".concat(u)})});if(!n)return s;var l=aK(t.label,r||o);return[l].concat(UY(s))};Za.parseViewBox=TM;Za.renderCallByParent=iK;var L1,Wk;function oK(){if(Wk)return L1;Wk=1;function e(t){var r=t==null?0:t.length;return r?t[r-1]:void 0}return L1=e,L1}var sK=oK();const lK=Et(sK);function cp(e){"@babel/helpers - typeof";return cp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cp(e)}var cK=["valueAccessor"],uK=["data","dataKey","clockWise","id","textBreakAll"];function dK(e){return mK(e)||pK(e)||hK(e)||fK()}function fK(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hK(e,t){if(e){if(typeof e=="string")return I_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I_(e,t)}}function pK(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function mK(e){if(Array.isArray(e))return I_(e)}function I_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ug(){return Ug=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ug.apply(this,arguments)}function Hk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Vk(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Hk(Object(r),!0).forEach(function(n){gK(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gK(e,t,r){return t=vK(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vK(e){var t=yK(e,"string");return cp(t)=="symbol"?t:t+""}function yK(e,t){if(cp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(cp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Gk(e,t){if(e==null)return{};var r=xK(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function xK(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var bK=function(t){return Array.isArray(t.value)?lK(t.value):t.value};function fl(e){var t=e.valueAccessor,r=t===void 0?bK:t,n=Gk(e,cK),a=n.data,o=n.dataKey,s=n.clockWise,l=n.id,c=n.textBreakAll,u=Gk(n,uK);return!a||!a.length?null:Ae.createElement(cn,{className:"recharts-label-list"},a.map(function(d,f){var h=Fr(o)?r(d,f):Wa(d&&d.payload,o),p=Fr(l)?{}:{id:"".concat(l,"-").concat(f)};return Ae.createElement(Za,Ug({},gr(d,!0),u,p,{parentViewBox:d.parentViewBox,value:h,textBreakAll:c,viewBox:Za.parseViewBox(Fr(s)?d:Vk(Vk({},d),{},{clockWise:s})),key:"label-".concat(f),index:f}))}))}fl.displayName="LabelList";function _K(e,t){return e?e===!0?Ae.createElement(fl,{key:"labelList-implicit",data:t}):Ae.isValidElement(e)||Tr(e)?Ae.createElement(fl,{key:"labelList-implicit",data:t,content:e}):Rd(e)?Ae.createElement(fl,Ug({data:t},e,{key:"labelList-implicit"})):null:null}function wK(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,a=Ao(n,fl).map(function(s,l){return x.cloneElement(s,{data:t,key:"labelList-".concat(l)})});if(!r)return a;var o=_K(e.label,t);return[o].concat(dK(a))}fl.renderCallByParent=wK;function up(e){"@babel/helpers - typeof";return up=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},up(e)}function N_(){return N_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},N_.apply(this,arguments)}function Yk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Kk(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Yk(Object(r),!0).forEach(function(n){jK(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jK(e,t,r){return t=SK(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SK(e){var t=CK(e,"string");return up(t)=="symbol"?t:t+""}function CK(e,t){if(up(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(up(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var AK=function(t,r){var n=Mi(r-t),a=Math.min(Math.abs(r-t),359.999);return n*a},Sm=function(t){var r=t.cx,n=t.cy,a=t.radius,o=t.angle,s=t.sign,l=t.isExternal,c=t.cornerRadius,u=t.cornerIsExternal,d=c*(l?1:-1)+a,f=Math.asin(c/d)/Bg,h=u?o:o+s*f,p=Fn(r,n,d,h),v=Fn(r,n,a,h),m=u?o-s*f:o,y=Fn(r,n,d*Math.cos(f*Bg),m);return{center:p,circleTangency:v,lineTangency:y,theta:f}},IM=function(t){var r=t.cx,n=t.cy,a=t.innerRadius,o=t.outerRadius,s=t.startAngle,l=t.endAngle,c=AK(s,l),u=s+c,d=Fn(r,n,o,s),f=Fn(r,n,o,u),h="M ".concat(d.x,",").concat(d.y,`
    A `).concat(o,",").concat(o,`,0,
    `).concat(+(Math.abs(c)>180),",").concat(+(s>u),`,
    `).concat(f.x,",").concat(f.y,`
  `);if(a>0){var p=Fn(r,n,a,s),v=Fn(r,n,a,u);h+="L ".concat(v.x,",").concat(v.y,`
            A `).concat(a,",").concat(a,`,0,
            `).concat(+(Math.abs(c)>180),",").concat(+(s<=u),`,
            `).concat(p.x,",").concat(p.y," Z")}else h+="L ".concat(r,",").concat(n," Z");return h},PK=function(t){var r=t.cx,n=t.cy,a=t.innerRadius,o=t.outerRadius,s=t.cornerRadius,l=t.forceCornerRadius,c=t.cornerIsExternal,u=t.startAngle,d=t.endAngle,f=Mi(d-u),h=Sm({cx:r,cy:n,radius:o,angle:u,sign:f,cornerRadius:s,cornerIsExternal:c}),p=h.circleTangency,v=h.lineTangency,m=h.theta,y=Sm({cx:r,cy:n,radius:o,angle:d,sign:-f,cornerRadius:s,cornerIsExternal:c}),b=y.circleTangency,_=y.lineTangency,w=y.theta,A=c?Math.abs(u-d):Math.abs(u-d)-m-w;if(A<0)return l?"M ".concat(v.x,",").concat(v.y,`
        a`).concat(s,",").concat(s,",0,0,1,").concat(s*2,`,0
        a`).concat(s,",").concat(s,",0,0,1,").concat(-s*2,`,0
      `):IM({cx:r,cy:n,innerRadius:a,outerRadius:o,startAngle:u,endAngle:d});var P="M ".concat(v.x,",").concat(v.y,`
    A`).concat(s,",").concat(s,",0,0,").concat(+(f<0),",").concat(p.x,",").concat(p.y,`
    A`).concat(o,",").concat(o,",0,").concat(+(A>180),",").concat(+(f<0),",").concat(b.x,",").concat(b.y,`
    A`).concat(s,",").concat(s,",0,0,").concat(+(f<0),",").concat(_.x,",").concat(_.y,`
  `);if(a>0){var E=Sm({cx:r,cy:n,radius:a,angle:u,sign:f,isExternal:!0,cornerRadius:s,cornerIsExternal:c}),T=E.circleTangency,S=E.lineTangency,I=E.theta,U=Sm({cx:r,cy:n,radius:a,angle:d,sign:-f,isExternal:!0,cornerRadius:s,cornerIsExternal:c}),O=U.circleTangency,M=U.lineTangency,L=U.theta,q=c?Math.abs(u-d):Math.abs(u-d)-I-L;if(q<0&&s===0)return"".concat(P,"L").concat(r,",").concat(n,"Z");P+="L".concat(M.x,",").concat(M.y,`
      A`).concat(s,",").concat(s,",0,0,").concat(+(f<0),",").concat(O.x,",").concat(O.y,`
      A`).concat(a,",").concat(a,",0,").concat(+(q>180),",").concat(+(f>0),",").concat(T.x,",").concat(T.y,`
      A`).concat(s,",").concat(s,",0,0,").concat(+(f<0),",").concat(S.x,",").concat(S.y,"Z")}else P+="L".concat(r,",").concat(n,"Z");return P},OK={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},NM=function(t){var r=Kk(Kk({},OK),t),n=r.cx,a=r.cy,o=r.innerRadius,s=r.outerRadius,l=r.cornerRadius,c=r.forceCornerRadius,u=r.cornerIsExternal,d=r.startAngle,f=r.endAngle,h=r.className;if(s<o||d===f)return null;var p=Pr("recharts-sector",h),v=s-o,m=Li(l,v,0,!0),y;return m>0&&Math.abs(d-f)<360?y=PK({cx:n,cy:a,innerRadius:o,outerRadius:s,cornerRadius:Math.min(m,v/2),forceCornerRadius:c,cornerIsExternal:u,startAngle:d,endAngle:f}):y=IM({cx:n,cy:a,innerRadius:o,outerRadius:s,startAngle:d,endAngle:f}),Ae.createElement("path",N_({},gr(r,!0),{className:p,d:y,role:"img"}))};function dp(e){"@babel/helpers - typeof";return dp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dp(e)}function D_(){return D_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},D_.apply(this,arguments)}function Qk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xk(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Qk(Object(r),!0).forEach(function(n){kK(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kK(e,t,r){return t=EK(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function EK(e){var t=TK(e,"string");return dp(t)=="symbol"?t:t+""}function TK(e,t){if(dp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(dp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Jk={curveBasisClosed:XB,curveBasisOpen:JB,curveBasis:QB,curveBumpX:LB,curveBumpY:RB,curveLinearClosed:ZB,curveLinear:Yv,curveMonotoneX:eU,curveMonotoneY:tU,curveNatural:rU,curveStep:nU,curveStepAfter:iU,curveStepBefore:aU},Cm=function(t){return t.x===+t.x&&t.y===+t.y},mf=function(t){return t.x},gf=function(t){return t.y},IK=function(t,r){if(Tr(t))return t;var n="curve".concat(Vv(t));return(n==="curveMonotone"||n==="curveBump")&&r?Jk["".concat(n).concat(r==="vertical"?"Y":"X")]:Jk[n]||Yv},NK=function(t){var r=t.type,n=r===void 0?"linear":r,a=t.points,o=a===void 0?[]:a,s=t.baseLine,l=t.layout,c=t.connectNulls,u=c===void 0?!1:c,d=IK(n,l),f=u?o.filter(function(m){return Cm(m)}):o,h;if(Array.isArray(s)){var p=u?s.filter(function(m){return Cm(m)}):s,v=f.map(function(m,y){return Xk(Xk({},m),{},{base:p[y]})});return l==="vertical"?h=gm().y(gf).x1(mf).x0(function(m){return m.base.x}):h=gm().x(mf).y1(gf).y0(function(m){return m.base.y}),h.defined(Cm).curve(d),h(v)}return l==="vertical"&&Dt(s)?h=gm().y(gf).x1(mf).x0(s):Dt(s)?h=gm().x(mf).y1(gf).y0(s):h=EN().x(mf).y(gf),h.defined(Cm).curve(d),h(f)},zg=function(t){var r=t.className,n=t.points,a=t.path,o=t.pathRef;if((!n||!n.length)&&!a)return null;var s=n&&n.length?NK(t):a;return Ae.createElement("path",D_({},gr(t,!1),gg(t),{className:Pr("recharts-curve",r),d:s,ref:o}))},DK=Object.getOwnPropertyNames,MK=Object.getOwnPropertySymbols,LK=Object.prototype.hasOwnProperty;function Zk(e,t){return function(n,a,o){return e(n,a,o)&&t(n,a,o)}}function Am(e){return function(r,n,a){if(!r||!n||typeof r!="object"||typeof n!="object")return e(r,n,a);var o=a.cache,s=o.get(r),l=o.get(n);if(s&&l)return s===n&&l===r;o.set(r,n),o.set(n,r);var c=e(r,n,a);return o.delete(r),o.delete(n),c}}function e3(e){return DK(e).concat(MK(e))}var RK=Object.hasOwn||function(e,t){return LK.call(e,t)};function lu(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var qK="__v",FK="__o",$K="_owner",t3=Object.getOwnPropertyDescriptor,r3=Object.keys;function BK(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function UK(e,t){return lu(e.getTime(),t.getTime())}function zK(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function WK(e,t){return e===t}function n3(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var a=new Array(n),o=e.entries(),s,l,c=0;(s=o.next())&&!s.done;){for(var u=t.entries(),d=!1,f=0;(l=u.next())&&!l.done;){if(a[f]){f++;continue}var h=s.value,p=l.value;if(r.equals(h[0],p[0],c,f,e,t,r)&&r.equals(h[1],p[1],h[0],p[0],e,t,r)){d=a[f]=!0;break}f++}if(!d)return!1;c++}return!0}var HK=lu;function VK(e,t,r){var n=r3(e),a=n.length;if(r3(t).length!==a)return!1;for(;a-- >0;)if(!DM(e,t,r,n[a]))return!1;return!0}function vf(e,t,r){var n=e3(e),a=n.length;if(e3(t).length!==a)return!1;for(var o,s,l;a-- >0;)if(o=n[a],!DM(e,t,r,o)||(s=t3(e,o),l=t3(t,o),(s||l)&&(!s||!l||s.configurable!==l.configurable||s.enumerable!==l.enumerable||s.writable!==l.writable)))return!1;return!0}function GK(e,t){return lu(e.valueOf(),t.valueOf())}function YK(e,t){return e.source===t.source&&e.flags===t.flags}function a3(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var a=new Array(n),o=e.values(),s,l;(s=o.next())&&!s.done;){for(var c=t.values(),u=!1,d=0;(l=c.next())&&!l.done;){if(!a[d]&&r.equals(s.value,l.value,s.value,l.value,e,t,r)){u=a[d]=!0;break}d++}if(!u)return!1}return!0}function KK(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function QK(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function DM(e,t,r,n){return(n===$K||n===FK||n===qK)&&(e.$$typeof||t.$$typeof)?!0:RK(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}var XK="[object Arguments]",JK="[object Boolean]",ZK="[object Date]",eQ="[object Error]",tQ="[object Map]",rQ="[object Number]",nQ="[object Object]",aQ="[object RegExp]",iQ="[object Set]",oQ="[object String]",sQ="[object URL]",lQ=Array.isArray,i3=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,o3=Object.assign,cQ=Object.prototype.toString.call.bind(Object.prototype.toString);function uQ(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areErrorsEqual,a=e.areFunctionsEqual,o=e.areMapsEqual,s=e.areNumbersEqual,l=e.areObjectsEqual,c=e.arePrimitiveWrappersEqual,u=e.areRegExpsEqual,d=e.areSetsEqual,f=e.areTypedArraysEqual,h=e.areUrlsEqual;return function(v,m,y){if(v===m)return!0;if(v==null||m==null)return!1;var b=typeof v;if(b!==typeof m)return!1;if(b!=="object")return b==="number"?s(v,m,y):b==="function"?a(v,m,y):!1;var _=v.constructor;if(_!==m.constructor)return!1;if(_===Object)return l(v,m,y);if(lQ(v))return t(v,m,y);if(i3!=null&&i3(v))return f(v,m,y);if(_===Date)return r(v,m,y);if(_===RegExp)return u(v,m,y);if(_===Map)return o(v,m,y);if(_===Set)return d(v,m,y);var w=cQ(v);return w===ZK?r(v,m,y):w===aQ?u(v,m,y):w===tQ?o(v,m,y):w===iQ?d(v,m,y):w===nQ?typeof v.then!="function"&&typeof m.then!="function"&&l(v,m,y):w===sQ?h(v,m,y):w===eQ?n(v,m,y):w===XK?l(v,m,y):w===JK||w===rQ||w===oQ?c(v,m,y):!1}}function dQ(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,a={areArraysEqual:n?vf:BK,areDatesEqual:UK,areErrorsEqual:zK,areFunctionsEqual:WK,areMapsEqual:n?Zk(n3,vf):n3,areNumbersEqual:HK,areObjectsEqual:n?vf:VK,arePrimitiveWrappersEqual:GK,areRegExpsEqual:YK,areSetsEqual:n?Zk(a3,vf):a3,areTypedArraysEqual:n?vf:KK,areUrlsEqual:QK};if(r&&(a=o3({},a,r(a))),t){var o=Am(a.areArraysEqual),s=Am(a.areMapsEqual),l=Am(a.areObjectsEqual),c=Am(a.areSetsEqual);a=o3({},a,{areArraysEqual:o,areMapsEqual:s,areObjectsEqual:l,areSetsEqual:c})}return a}function fQ(e){return function(t,r,n,a,o,s,l){return e(t,r,l)}}function hQ(e){var t=e.circular,r=e.comparator,n=e.createState,a=e.equals,o=e.strict;if(n)return function(c,u){var d=n(),f=d.cache,h=f===void 0?t?new WeakMap:void 0:f,p=d.meta;return r(c,u,{cache:h,equals:a,meta:p,strict:o})};if(t)return function(c,u){return r(c,u,{cache:new WeakMap,equals:a,meta:void 0,strict:o})};var s={cache:void 0,equals:a,meta:void 0,strict:o};return function(c,u){return r(c,u,s)}}var pQ=uc();uc({strict:!0});uc({circular:!0});uc({circular:!0,strict:!0});uc({createInternalComparator:function(){return lu}});uc({strict:!0,createInternalComparator:function(){return lu}});uc({circular:!0,createInternalComparator:function(){return lu}});uc({circular:!0,createInternalComparator:function(){return lu},strict:!0});function uc(e){e===void 0&&(e={});var t=e.circular,r=t===void 0?!1:t,n=e.createInternalComparator,a=e.createState,o=e.strict,s=o===void 0?!1:o,l=dQ(e),c=uQ(l),u=n?n(c):fQ(c);return hQ({circular:r,comparator:c,createState:a,equals:u,strict:s})}function mQ(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function s3(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function a(o){r<0&&(r=o),o-r>t?(e(o),r=-1):mQ(a)};requestAnimationFrame(n)}function M_(e){"@babel/helpers - typeof";return M_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M_(e)}function gQ(e){return bQ(e)||xQ(e)||yQ(e)||vQ()}function vQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yQ(e,t){if(e){if(typeof e=="string")return l3(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l3(e,t)}}function l3(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function xQ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function bQ(e){if(Array.isArray(e))return e}function _Q(){var e={},t=function(){return null},r=!1,n=function a(o){if(!r){if(Array.isArray(o)){if(!o.length)return;var s=o,l=gQ(s),c=l[0],u=l.slice(1);if(typeof c=="number"){s3(a.bind(null,u),c);return}a(c),s3(a.bind(null,u));return}M_(o)==="object"&&(e=o,t(e)),typeof o=="function"&&o()}};return{stop:function(){r=!0},start:function(o){r=!1,n(o)},subscribe:function(o){return t=o,function(){t=function(){return null}}}}}function fp(e){"@babel/helpers - typeof";return fp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fp(e)}function c3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function u3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?c3(Object(r),!0).forEach(function(n){MM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function MM(e,t,r){return t=wQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wQ(e){var t=jQ(e,"string");return fp(t)==="symbol"?t:String(t)}function jQ(e,t){if(fp(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(fp(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var SQ=function(t,r){return[Object.keys(t),Object.keys(r)].reduce(function(n,a){return n.filter(function(o){return a.includes(o)})})},CQ=function(t){return t},AQ=function(t){return t.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},Ih=function(t,r){return Object.keys(r).reduce(function(n,a){return u3(u3({},n),{},MM({},a,t(a,r[a])))},{})},d3=function(t,r,n){return t.map(function(a){return"".concat(AQ(a)," ").concat(r,"ms ").concat(n)}).join(",")};function PQ(e,t){return EQ(e)||kQ(e,t)||LM(e,t)||OQ()}function OQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kQ(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function EQ(e){if(Array.isArray(e))return e}function TQ(e){return DQ(e)||NQ(e)||LM(e)||IQ()}function IQ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LM(e,t){if(e){if(typeof e=="string")return L_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return L_(e,t)}}function NQ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function DQ(e){if(Array.isArray(e))return L_(e)}function L_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Wg=1e-4,RM=function(t,r){return[0,3*t,3*r-6*t,3*t-3*r+1]},qM=function(t,r){return t.map(function(n,a){return n*Math.pow(r,a)}).reduce(function(n,a){return n+a})},f3=function(t,r){return function(n){var a=RM(t,r);return qM(a,n)}},MQ=function(t,r){return function(n){var a=RM(t,r),o=[].concat(TQ(a.map(function(s,l){return s*l}).slice(1)),[0]);return qM(o,n)}},h3=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=r[0],o=r[1],s=r[2],l=r[3];if(r.length===1)switch(r[0]){case"linear":a=0,o=0,s=1,l=1;break;case"ease":a=.25,o=.1,s=.25,l=1;break;case"ease-in":a=.42,o=0,s=1,l=1;break;case"ease-out":a=.42,o=0,s=.58,l=1;break;case"ease-in-out":a=0,o=0,s=.58,l=1;break;default:{var c=r[0].split("(");if(c[0]==="cubic-bezier"&&c[1].split(")")[0].split(",").length===4){var u=c[1].split(")")[0].split(",").map(function(y){return parseFloat(y)}),d=PQ(u,4);a=d[0],o=d[1],s=d[2],l=d[3]}}}var f=f3(a,s),h=f3(o,l),p=MQ(a,s),v=function(b){return b>1?1:b<0?0:b},m=function(b){for(var _=b>1?1:b,w=_,A=0;A<8;++A){var P=f(w)-_,E=p(w);if(Math.abs(P-_)<Wg||E<Wg)return h(w);w=v(w-P/E)}return h(w)};return m.isStepper=!1,m},LQ=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.stiff,n=r===void 0?100:r,a=t.damping,o=a===void 0?8:a,s=t.dt,l=s===void 0?17:s,c=function(d,f,h){var p=-(d-f)*n,v=h*o,m=h+(p-v)*l/1e3,y=h*l/1e3+d;return Math.abs(y-f)<Wg&&Math.abs(m)<Wg?[f,0]:[y,m]};return c.isStepper=!0,c.dt=l,c},RQ=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=r[0];if(typeof a=="string")switch(a){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return h3(a);case"spring":return LQ();default:if(a.split("(")[0]==="cubic-bezier")return h3(a)}return typeof a=="function"?a:null};function hp(e){"@babel/helpers - typeof";return hp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hp(e)}function p3(e){return $Q(e)||FQ(e)||FM(e)||qQ()}function qQ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FQ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function $Q(e){if(Array.isArray(e))return q_(e)}function m3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function si(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?m3(Object(r),!0).forEach(function(n){R_(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function R_(e,t,r){return t=BQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function BQ(e){var t=UQ(e,"string");return hp(t)==="symbol"?t:String(t)}function UQ(e,t){if(hp(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(hp(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function zQ(e,t){return VQ(e)||HQ(e,t)||FM(e,t)||WQ()}function WQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FM(e,t){if(e){if(typeof e=="string")return q_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return q_(e,t)}}function q_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function HQ(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function VQ(e){if(Array.isArray(e))return e}var Hg=function(t,r,n){return t+(r-t)*n},F_=function(t){var r=t.from,n=t.to;return r!==n},GQ=function e(t,r,n){var a=Ih(function(o,s){if(F_(s)){var l=t(s.from,s.to,s.velocity),c=zQ(l,2),u=c[0],d=c[1];return si(si({},s),{},{from:u,velocity:d})}return s},r);return n<1?Ih(function(o,s){return F_(s)?si(si({},s),{},{velocity:Hg(s.velocity,a[o].velocity,n),from:Hg(s.from,a[o].from,n)}):s},r):e(t,a,n-1)};const YQ=function(e,t,r,n,a){var o=SQ(e,t),s=o.reduce(function(y,b){return si(si({},y),{},R_({},b,[e[b],t[b]]))},{}),l=o.reduce(function(y,b){return si(si({},y),{},R_({},b,{from:e[b],velocity:0,to:t[b]}))},{}),c=-1,u,d,f=function(){return null},h=function(){return Ih(function(b,_){return _.from},l)},p=function(){return!Object.values(l).filter(F_).length},v=function(b){u||(u=b);var _=b-u,w=_/r.dt;l=GQ(r,l,w),a(si(si(si({},e),t),h())),u=b,p()||(c=requestAnimationFrame(f))},m=function(b){d||(d=b);var _=(b-d)/n,w=Ih(function(P,E){return Hg.apply(void 0,p3(E).concat([r(_)]))},s);if(a(si(si(si({},e),t),w)),_<1)c=requestAnimationFrame(f);else{var A=Ih(function(P,E){return Hg.apply(void 0,p3(E).concat([r(1)]))},s);a(si(si(si({},e),t),A))}};return f=r.isStepper?v:m,function(){return requestAnimationFrame(f),function(){cancelAnimationFrame(c)}}};function cd(e){"@babel/helpers - typeof";return cd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cd(e)}var KQ=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function QQ(e,t){if(e==null)return{};var r=XQ(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function XQ(e,t){if(e==null)return{};var r={},n=Object.keys(e),a,o;for(o=0;o<n.length;o++)a=n[o],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}function R1(e){return tX(e)||eX(e)||ZQ(e)||JQ()}function JQ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ZQ(e,t){if(e){if(typeof e=="string")return $_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $_(e,t)}}function eX(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function tX(e){if(Array.isArray(e))return $_(e)}function $_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function g3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Jo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?g3(Object(r),!0).forEach(function(n){Ph(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ph(e,t,r){return t=$M(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rX(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nX(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,$M(n.key),n)}}function aX(e,t,r){return t&&nX(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function $M(e){var t=iX(e,"string");return cd(t)==="symbol"?t:String(t)}function iX(e,t){if(cd(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(cd(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function oX(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B_(e,t)}function B_(e,t){return B_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},B_(e,t)}function sX(e){var t=lX();return function(){var n=Vg(e),a;if(t){var o=Vg(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return U_(this,a)}}function U_(e,t){if(t&&(cd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return z_(e)}function z_(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Vg(e){return Vg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Vg(e)}var Es=function(e){oX(r,e);var t=sX(r);function r(n,a){var o;rX(this,r),o=t.call(this,n,a);var s=o.props,l=s.isActive,c=s.attributeName,u=s.from,d=s.to,f=s.steps,h=s.children,p=s.duration;if(o.handleStyleChange=o.handleStyleChange.bind(z_(o)),o.changeStyle=o.changeStyle.bind(z_(o)),!l||p<=0)return o.state={style:{}},typeof h=="function"&&(o.state={style:d}),U_(o);if(f&&f.length)o.state={style:f[0].style};else if(u){if(typeof h=="function")return o.state={style:u},U_(o);o.state={style:c?Ph({},c,u):u}}else o.state={style:{}};return o}return aX(r,[{key:"componentDidMount",value:function(){var a=this.props,o=a.isActive,s=a.canBegin;this.mounted=!0,!(!o||!s)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(a){var o=this.props,s=o.isActive,l=o.canBegin,c=o.attributeName,u=o.shouldReAnimate,d=o.to,f=o.from,h=this.state.style;if(l){if(!s){var p={style:c?Ph({},c,d):d};this.state&&h&&(c&&h[c]!==d||!c&&h!==d)&&this.setState(p);return}if(!(pQ(a.to,d)&&a.canBegin&&a.isActive)){var v=!a.canBegin||!a.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var m=v||u?f:a.to;if(this.state&&h){var y={style:c?Ph({},c,m):m};(c&&h[c]!==m||!c&&h!==m)&&this.setState(y)}this.runAnimation(Jo(Jo({},this.props),{},{from:m,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var a=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),a&&a()}},{key:"handleStyleChange",value:function(a){this.changeStyle(a)}},{key:"changeStyle",value:function(a){this.mounted&&this.setState({style:a})}},{key:"runJSAnimation",value:function(a){var o=this,s=a.from,l=a.to,c=a.duration,u=a.easing,d=a.begin,f=a.onAnimationEnd,h=a.onAnimationStart,p=YQ(s,l,RQ(u),c,this.changeStyle),v=function(){o.stopJSAnimation=p()};this.manager.start([h,d,v,c,f])}},{key:"runStepAnimation",value:function(a){var o=this,s=a.steps,l=a.begin,c=a.onAnimationStart,u=s[0],d=u.style,f=u.duration,h=f===void 0?0:f,p=function(m,y,b){if(b===0)return m;var _=y.duration,w=y.easing,A=w===void 0?"ease":w,P=y.style,E=y.properties,T=y.onAnimationEnd,S=b>0?s[b-1]:y,I=E||Object.keys(P);if(typeof A=="function"||A==="spring")return[].concat(R1(m),[o.runJSAnimation.bind(o,{from:S.style,to:P,duration:_,easing:A}),_]);var U=d3(I,_,A),O=Jo(Jo(Jo({},S.style),P),{},{transition:U});return[].concat(R1(m),[O,_,T]).filter(CQ)};return this.manager.start([c].concat(R1(s.reduce(p,[d,Math.max(h,l)])),[a.onAnimationEnd]))}},{key:"runAnimation",value:function(a){this.manager||(this.manager=_Q());var o=a.begin,s=a.duration,l=a.attributeName,c=a.to,u=a.easing,d=a.onAnimationStart,f=a.onAnimationEnd,h=a.steps,p=a.children,v=this.manager;if(this.unSubscribe=v.subscribe(this.handleStyleChange),typeof u=="function"||typeof p=="function"||u==="spring"){this.runJSAnimation(a);return}if(h.length>1){this.runStepAnimation(a);return}var m=l?Ph({},l,c):c,y=d3(Object.keys(m),s,u);v.start([d,o,Jo(Jo({},m),{},{transition:y}),s,f])}},{key:"render",value:function(){var a=this.props,o=a.children;a.begin;var s=a.duration;a.attributeName,a.easing;var l=a.isActive;a.steps,a.from,a.to,a.canBegin,a.onAnimationEnd,a.shouldReAnimate,a.onAnimationReStart;var c=QQ(a,KQ),u=x.Children.count(o),d=this.state.style;if(typeof o=="function")return o(d);if(!l||u===0||s<=0)return o;var f=function(p){var v=p.props,m=v.style,y=m===void 0?{}:m,b=v.className,_=x.cloneElement(p,Jo(Jo({},c),{},{style:Jo(Jo({},y),d),className:b}));return _};return u===1?f(x.Children.only(o)):Ae.createElement("div",null,x.Children.map(o,function(h){return f(h)}))}}]),r}(x.PureComponent);Es.displayName="Animate";Es.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Es.propTypes={from:vn.oneOfType([vn.object,vn.string]),to:vn.oneOfType([vn.object,vn.string]),attributeName:vn.string,duration:vn.number,begin:vn.number,easing:vn.oneOfType([vn.string,vn.func]),steps:vn.arrayOf(vn.shape({duration:vn.number.isRequired,style:vn.object.isRequired,easing:vn.oneOfType([vn.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),vn.func]),properties:vn.arrayOf("string"),onAnimationEnd:vn.func})),children:vn.oneOfType([vn.node,vn.func]),isActive:vn.bool,canBegin:vn.bool,onAnimationEnd:vn.func,shouldReAnimate:vn.bool,onAnimationStart:vn.func,onAnimationReStart:vn.func};function pp(e){"@babel/helpers - typeof";return pp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pp(e)}function Gg(){return Gg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Gg.apply(this,arguments)}function cX(e,t){return hX(e)||fX(e,t)||dX(e,t)||uX()}function uX(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dX(e,t){if(e){if(typeof e=="string")return v3(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return v3(e,t)}}function v3(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function fX(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function hX(e){if(Array.isArray(e))return e}function y3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function x3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?y3(Object(r),!0).forEach(function(n){pX(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function pX(e,t,r){return t=mX(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mX(e){var t=gX(e,"string");return pp(t)=="symbol"?t:t+""}function gX(e,t){if(pp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(pp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var b3=function(t,r,n,a,o){var s=Math.min(Math.abs(n)/2,Math.abs(a)/2),l=a>=0?1:-1,c=n>=0?1:-1,u=a>=0&&n>=0||a<0&&n<0?1:0,d;if(s>0&&o instanceof Array){for(var f=[0,0,0,0],h=0,p=4;h<p;h++)f[h]=o[h]>s?s:o[h];d="M".concat(t,",").concat(r+l*f[0]),f[0]>0&&(d+="A ".concat(f[0],",").concat(f[0],",0,0,").concat(u,",").concat(t+c*f[0],",").concat(r)),d+="L ".concat(t+n-c*f[1],",").concat(r),f[1]>0&&(d+="A ".concat(f[1],",").concat(f[1],",0,0,").concat(u,`,
        `).concat(t+n,",").concat(r+l*f[1])),d+="L ".concat(t+n,",").concat(r+a-l*f[2]),f[2]>0&&(d+="A ".concat(f[2],",").concat(f[2],",0,0,").concat(u,`,
        `).concat(t+n-c*f[2],",").concat(r+a)),d+="L ".concat(t+c*f[3],",").concat(r+a),f[3]>0&&(d+="A ".concat(f[3],",").concat(f[3],",0,0,").concat(u,`,
        `).concat(t,",").concat(r+a-l*f[3])),d+="Z"}else if(s>0&&o===+o&&o>0){var v=Math.min(s,o);d="M ".concat(t,",").concat(r+l*v,`
            A `).concat(v,",").concat(v,",0,0,").concat(u,",").concat(t+c*v,",").concat(r,`
            L `).concat(t+n-c*v,",").concat(r,`
            A `).concat(v,",").concat(v,",0,0,").concat(u,",").concat(t+n,",").concat(r+l*v,`
            L `).concat(t+n,",").concat(r+a-l*v,`
            A `).concat(v,",").concat(v,",0,0,").concat(u,",").concat(t+n-c*v,",").concat(r+a,`
            L `).concat(t+c*v,",").concat(r+a,`
            A `).concat(v,",").concat(v,",0,0,").concat(u,",").concat(t,",").concat(r+a-l*v," Z")}else d="M ".concat(t,",").concat(r," h ").concat(n," v ").concat(a," h ").concat(-n," Z");return d},vX=function(t,r){if(!t||!r)return!1;var n=t.x,a=t.y,o=r.x,s=r.y,l=r.width,c=r.height;if(Math.abs(l)>0&&Math.abs(c)>0){var u=Math.min(o,o+l),d=Math.max(o,o+l),f=Math.min(s,s+c),h=Math.max(s,s+c);return n>=u&&n<=d&&a>=f&&a<=h}return!1},yX={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},Jj=function(t){var r=x3(x3({},yX),t),n=x.useRef(),a=x.useState(-1),o=cX(a,2),s=o[0],l=o[1];x.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var A=n.current.getTotalLength();A&&l(A)}catch{}},[]);var c=r.x,u=r.y,d=r.width,f=r.height,h=r.radius,p=r.className,v=r.animationEasing,m=r.animationDuration,y=r.animationBegin,b=r.isAnimationActive,_=r.isUpdateAnimationActive;if(c!==+c||u!==+u||d!==+d||f!==+f||d===0||f===0)return null;var w=Pr("recharts-rectangle",p);return _?Ae.createElement(Es,{canBegin:s>0,from:{width:d,height:f,x:c,y:u},to:{width:d,height:f,x:c,y:u},duration:m,animationEasing:v,isActive:_},function(A){var P=A.width,E=A.height,T=A.x,S=A.y;return Ae.createElement(Es,{canBegin:s>0,from:"0px ".concat(s===-1?1:s,"px"),to:"".concat(s,"px 0px"),attributeName:"strokeDasharray",begin:y,duration:m,isActive:b,easing:v},Ae.createElement("path",Gg({},gr(r,!0),{className:w,d:b3(T,S,P,E,h),ref:n})))}):Ae.createElement("path",Gg({},gr(r,!0),{className:w,d:b3(c,u,d,f,h)}))},xX=["points","className","baseLinePoints","connectNulls"];function Nu(){return Nu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Nu.apply(this,arguments)}function bX(e,t){if(e==null)return{};var r=_X(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function _X(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function _3(e){return CX(e)||SX(e)||jX(e)||wX()}function wX(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jX(e,t){if(e){if(typeof e=="string")return W_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return W_(e,t)}}function SX(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function CX(e){if(Array.isArray(e))return W_(e)}function W_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var w3=function(t){return t&&t.x===+t.x&&t.y===+t.y},AX=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=[[]];return t.forEach(function(n){w3(n)?r[r.length-1].push(n):r[r.length-1].length>0&&r.push([])}),w3(t[0])&&r[r.length-1].push(t[0]),r[r.length-1].length<=0&&(r=r.slice(0,-1)),r},Nh=function(t,r){var n=AX(t);r&&(n=[n.reduce(function(o,s){return[].concat(_3(o),_3(s))},[])]);var a=n.map(function(o){return o.reduce(function(s,l,c){return"".concat(s).concat(c===0?"M":"L").concat(l.x,",").concat(l.y)},"")}).join("");return n.length===1?"".concat(a,"Z"):a},PX=function(t,r,n){var a=Nh(t,n);return"".concat(a.slice(-1)==="Z"?a.slice(0,-1):a,"L").concat(Nh(r.reverse(),n).slice(1))},OX=function(t){var r=t.points,n=t.className,a=t.baseLinePoints,o=t.connectNulls,s=bX(t,xX);if(!r||!r.length)return null;var l=Pr("recharts-polygon",n);if(a&&a.length){var c=s.stroke&&s.stroke!=="none",u=PX(r,a,o);return Ae.createElement("g",{className:l},Ae.createElement("path",Nu({},gr(s,!0),{fill:u.slice(-1)==="Z"?s.fill:"none",stroke:"none",d:u})),c?Ae.createElement("path",Nu({},gr(s,!0),{fill:"none",d:Nh(r,o)})):null,c?Ae.createElement("path",Nu({},gr(s,!0),{fill:"none",d:Nh(a,o)})):null)}var d=Nh(r,o);return Ae.createElement("path",Nu({},gr(s,!0),{fill:d.slice(-1)==="Z"?s.fill:"none",className:l,d}))};function H_(){return H_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},H_.apply(this,arguments)}var dy=function(t){var r=t.cx,n=t.cy,a=t.r,o=t.className,s=Pr("recharts-dot",o);return r===+r&&n===+n&&a===+a?Ae.createElement("circle",H_({},gr(t,!1),gg(t),{className:s,cx:r,cy:n,r:a})):null};function mp(e){"@babel/helpers - typeof";return mp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mp(e)}var kX=["x","y","top","left","width","height","className"];function V_(){return V_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},V_.apply(this,arguments)}function j3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function EX(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?j3(Object(r),!0).forEach(function(n){TX(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function TX(e,t,r){return t=IX(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function IX(e){var t=NX(e,"string");return mp(t)=="symbol"?t:t+""}function NX(e,t){if(mp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(mp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function DX(e,t){if(e==null)return{};var r=MX(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function MX(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var LX=function(t,r,n,a,o,s){return"M".concat(t,",").concat(o,"v").concat(a,"M").concat(s,",").concat(r,"h").concat(n)},RX=function(t){var r=t.x,n=r===void 0?0:r,a=t.y,o=a===void 0?0:a,s=t.top,l=s===void 0?0:s,c=t.left,u=c===void 0?0:c,d=t.width,f=d===void 0?0:d,h=t.height,p=h===void 0?0:h,v=t.className,m=DX(t,kX),y=EX({x:n,y:o,top:l,left:u,width:f,height:p},m);return!Dt(n)||!Dt(o)||!Dt(f)||!Dt(p)||!Dt(l)||!Dt(u)?null:Ae.createElement("path",V_({},gr(y,!0),{className:Pr("recharts-cross",v),d:LX(n,o,f,p,l,u)}))},q1,S3;function qX(){if(S3)return q1;S3=1;var e=oy(),t=tM(),r=Rs();function n(a,o){return a&&a.length?e(a,r(o,2),t):void 0}return q1=n,q1}var FX=qX();const $X=Et(FX);var F1,C3;function BX(){if(C3)return F1;C3=1;var e=oy(),t=Rs(),r=rM();function n(a,o){return a&&a.length?e(a,t(o,2),r):void 0}return F1=n,F1}var UX=BX();const zX=Et(UX);var WX=["cx","cy","angle","ticks","axisLine"],HX=["ticks","tick","angle","tickFormatter","stroke"];function ud(e){"@babel/helpers - typeof";return ud=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ud(e)}function Dh(){return Dh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Dh.apply(this,arguments)}function A3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function jc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?A3(Object(r),!0).forEach(function(n){fy(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function P3(e,t){if(e==null)return{};var r=VX(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function VX(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function GX(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O3(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,UM(n.key),n)}}function YX(e,t,r){return t&&O3(e.prototype,t),r&&O3(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function KX(e,t,r){return t=Yg(t),QX(e,BM()?Reflect.construct(t,r||[],Yg(e).constructor):t.apply(e,r))}function QX(e,t){if(t&&(ud(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return XX(e)}function XX(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function BM(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(BM=function(){return!!e})()}function Yg(e){return Yg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Yg(e)}function JX(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&G_(e,t)}function G_(e,t){return G_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},G_(e,t)}function fy(e,t,r){return t=UM(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function UM(e){var t=ZX(e,"string");return ud(t)=="symbol"?t:t+""}function ZX(e,t){if(ud(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ud(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var hy=function(e){function t(){return GX(this,t),KX(this,t,arguments)}return JX(t,e),YX(t,[{key:"getTickValueCoord",value:function(n){var a=n.coordinate,o=this.props,s=o.angle,l=o.cx,c=o.cy;return Fn(l,c,a,s)}},{key:"getTickTextAnchor",value:function(){var n=this.props.orientation,a;switch(n){case"left":a="end";break;case"right":a="start";break;default:a="middle";break}return a}},{key:"getViewBox",value:function(){var n=this.props,a=n.cx,o=n.cy,s=n.angle,l=n.ticks,c=$X(l,function(d){return d.coordinate||0}),u=zX(l,function(d){return d.coordinate||0});return{cx:a,cy:o,startAngle:s,endAngle:s,innerRadius:u.coordinate||0,outerRadius:c.coordinate||0}}},{key:"renderAxisLine",value:function(){var n=this.props,a=n.cx,o=n.cy,s=n.angle,l=n.ticks,c=n.axisLine,u=P3(n,WX),d=l.reduce(function(v,m){return[Math.min(v[0],m.coordinate),Math.max(v[1],m.coordinate)]},[1/0,-1/0]),f=Fn(a,o,d[0],s),h=Fn(a,o,d[1],s),p=jc(jc(jc({},gr(u,!1)),{},{fill:"none"},gr(c,!1)),{},{x1:f.x,y1:f.y,x2:h.x,y2:h.y});return Ae.createElement("line",Dh({className:"recharts-polar-radius-axis-line"},p))}},{key:"renderTicks",value:function(){var n=this,a=this.props,o=a.ticks,s=a.tick,l=a.angle,c=a.tickFormatter,u=a.stroke,d=P3(a,HX),f=this.getTickTextAnchor(),h=gr(d,!1),p=gr(s,!1),v=o.map(function(m,y){var b=n.getTickValueCoord(m),_=jc(jc(jc(jc({textAnchor:f,transform:"rotate(".concat(90-l,", ").concat(b.x,", ").concat(b.y,")")},h),{},{stroke:"none",fill:u},p),{},{index:y},b),{},{payload:m});return Ae.createElement(cn,Dh({className:Pr("recharts-polar-radius-axis-tick",EM(s)),key:"tick-".concat(m.coordinate)},Yc(n.props,m,y)),t.renderTickItem(s,_,c?c(m.value,y):m.value))});return Ae.createElement(cn,{className:"recharts-polar-radius-axis-ticks"},v)}},{key:"render",value:function(){var n=this.props,a=n.ticks,o=n.axisLine,s=n.tick;return!a||!a.length?null:Ae.createElement(cn,{className:Pr("recharts-polar-radius-axis",this.props.className)},o&&this.renderAxisLine(),s&&this.renderTicks(),Za.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(n,a,o){var s;return Ae.isValidElement(n)?s=Ae.cloneElement(n,a):Tr(n)?s=n(a):s=Ae.createElement(Kc,Dh({},a,{className:"recharts-polar-radius-axis-tick-value"}),o),s}}])}(x.PureComponent);fy(hy,"displayName","PolarRadiusAxis");fy(hy,"axisType","radiusAxis");fy(hy,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function dd(e){"@babel/helpers - typeof";return dd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dd(e)}function Tc(){return Tc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Tc.apply(this,arguments)}function k3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Sc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?k3(Object(r),!0).forEach(function(n){py(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function eJ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E3(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,WM(n.key),n)}}function tJ(e,t,r){return t&&E3(e.prototype,t),r&&E3(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function rJ(e,t,r){return t=Kg(t),nJ(e,zM()?Reflect.construct(t,r||[],Kg(e).constructor):t.apply(e,r))}function nJ(e,t){if(t&&(dd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return aJ(e)}function aJ(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zM(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(zM=function(){return!!e})()}function Kg(e){return Kg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Kg(e)}function iJ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Y_(e,t)}function Y_(e,t){return Y_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Y_(e,t)}function py(e,t,r){return t=WM(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function WM(e){var t=oJ(e,"string");return dd(t)=="symbol"?t:t+""}function oJ(e,t){if(dd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(dd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var sJ=Math.PI/180,T3=1e-5,my=function(e){function t(){return eJ(this,t),rJ(this,t,arguments)}return iJ(t,e),tJ(t,[{key:"getTickLineCoord",value:function(n){var a=this.props,o=a.cx,s=a.cy,l=a.radius,c=a.orientation,u=a.tickSize,d=u||8,f=Fn(o,s,l,n.coordinate),h=Fn(o,s,l+(c==="inner"?-1:1)*d,n.coordinate);return{x1:f.x,y1:f.y,x2:h.x,y2:h.y}}},{key:"getTickTextAnchor",value:function(n){var a=this.props.orientation,o=Math.cos(-n.coordinate*sJ),s;return o>T3?s=a==="outer"?"start":"end":o<-T3?s=a==="outer"?"end":"start":s="middle",s}},{key:"renderAxisLine",value:function(){var n=this.props,a=n.cx,o=n.cy,s=n.radius,l=n.axisLine,c=n.axisLineType,u=Sc(Sc({},gr(this.props,!1)),{},{fill:"none"},gr(l,!1));if(c==="circle")return Ae.createElement(dy,Tc({className:"recharts-polar-angle-axis-line"},u,{cx:a,cy:o,r:s}));var d=this.props.ticks,f=d.map(function(h){return Fn(a,o,s,h.coordinate)});return Ae.createElement(OX,Tc({className:"recharts-polar-angle-axis-line"},u,{points:f}))}},{key:"renderTicks",value:function(){var n=this,a=this.props,o=a.ticks,s=a.tick,l=a.tickLine,c=a.tickFormatter,u=a.stroke,d=gr(this.props,!1),f=gr(s,!1),h=Sc(Sc({},d),{},{fill:"none"},gr(l,!1)),p=o.map(function(v,m){var y=n.getTickLineCoord(v),b=n.getTickTextAnchor(v),_=Sc(Sc(Sc({textAnchor:b},d),{},{stroke:"none",fill:u},f),{},{index:m,payload:v,x:y.x2,y:y.y2});return Ae.createElement(cn,Tc({className:Pr("recharts-polar-angle-axis-tick",EM(s)),key:"tick-".concat(v.coordinate)},Yc(n.props,v,m)),l&&Ae.createElement("line",Tc({className:"recharts-polar-angle-axis-tick-line"},h,y)),s&&t.renderTickItem(s,_,c?c(v.value,m):v.value))});return Ae.createElement(cn,{className:"recharts-polar-angle-axis-ticks"},p)}},{key:"render",value:function(){var n=this.props,a=n.ticks,o=n.radius,s=n.axisLine;return o<=0||!a||!a.length?null:Ae.createElement(cn,{className:Pr("recharts-polar-angle-axis",this.props.className)},s&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(n,a,o){var s;return Ae.isValidElement(n)?s=Ae.cloneElement(n,a):Tr(n)?s=n(a):s=Ae.createElement(Kc,Tc({},a,{className:"recharts-polar-angle-axis-tick-value"}),o),s}}])}(x.PureComponent);py(my,"displayName","PolarAngleAxis");py(my,"axisType","angleAxis");py(my,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var $1,I3;function lJ(){if(I3)return $1;I3=1;var e=ZN(),t=e(Object.getPrototypeOf,Object);return $1=t,$1}var B1,N3;function cJ(){if(N3)return B1;N3=1;var e=bl(),t=lJ(),r=_l(),n="[object Object]",a=Function.prototype,o=Object.prototype,s=a.toString,l=o.hasOwnProperty,c=s.call(Object);function u(d){if(!r(d)||e(d)!=n)return!1;var f=t(d);if(f===null)return!0;var h=l.call(f,"constructor")&&f.constructor;return typeof h=="function"&&h instanceof h&&s.call(h)==c}return B1=u,B1}var uJ=cJ();const dJ=Et(uJ);var U1,D3;function fJ(){if(D3)return U1;D3=1;var e=bl(),t=_l(),r="[object Boolean]";function n(a){return a===!0||a===!1||t(a)&&e(a)==r}return U1=n,U1}var hJ=fJ();const pJ=Et(hJ);function gp(e){"@babel/helpers - typeof";return gp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gp(e)}function Qg(){return Qg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Qg.apply(this,arguments)}function mJ(e,t){return xJ(e)||yJ(e,t)||vJ(e,t)||gJ()}function gJ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vJ(e,t){if(e){if(typeof e=="string")return M3(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M3(e,t)}}function M3(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function yJ(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function xJ(e){if(Array.isArray(e))return e}function L3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function R3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?L3(Object(r),!0).forEach(function(n){bJ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function bJ(e,t,r){return t=_J(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _J(e){var t=wJ(e,"string");return gp(t)=="symbol"?t:t+""}function wJ(e,t){if(gp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(gp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var q3=function(t,r,n,a,o){var s=n-a,l;return l="M ".concat(t,",").concat(r),l+="L ".concat(t+n,",").concat(r),l+="L ".concat(t+n-s/2,",").concat(r+o),l+="L ".concat(t+n-s/2-a,",").concat(r+o),l+="L ".concat(t,",").concat(r," Z"),l},jJ={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},SJ=function(t){var r=R3(R3({},jJ),t),n=x.useRef(),a=x.useState(-1),o=mJ(a,2),s=o[0],l=o[1];x.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var w=n.current.getTotalLength();w&&l(w)}catch{}},[]);var c=r.x,u=r.y,d=r.upperWidth,f=r.lowerWidth,h=r.height,p=r.className,v=r.animationEasing,m=r.animationDuration,y=r.animationBegin,b=r.isUpdateAnimationActive;if(c!==+c||u!==+u||d!==+d||f!==+f||h!==+h||d===0&&f===0||h===0)return null;var _=Pr("recharts-trapezoid",p);return b?Ae.createElement(Es,{canBegin:s>0,from:{upperWidth:0,lowerWidth:0,height:h,x:c,y:u},to:{upperWidth:d,lowerWidth:f,height:h,x:c,y:u},duration:m,animationEasing:v,isActive:b},function(w){var A=w.upperWidth,P=w.lowerWidth,E=w.height,T=w.x,S=w.y;return Ae.createElement(Es,{canBegin:s>0,from:"0px ".concat(s===-1?1:s,"px"),to:"".concat(s,"px 0px"),attributeName:"strokeDasharray",begin:y,duration:m,easing:v},Ae.createElement("path",Qg({},gr(r,!0),{className:_,d:q3(T,S,A,P,E),ref:n})))}):Ae.createElement("g",null,Ae.createElement("path",Qg({},gr(r,!0),{className:_,d:q3(c,u,d,f,h)})))},CJ=["option","shapeType","propTransformer","activeClassName","isActive"];function vp(e){"@babel/helpers - typeof";return vp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vp(e)}function AJ(e,t){if(e==null)return{};var r=PJ(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function PJ(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function F3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?F3(Object(r),!0).forEach(function(n){OJ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function OJ(e,t,r){return t=kJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kJ(e){var t=EJ(e,"string");return vp(t)=="symbol"?t:t+""}function EJ(e,t){if(vp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(vp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function TJ(e,t){return Xg(Xg({},t),e)}function IJ(e,t){return e==="symbols"}function $3(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return Ae.createElement(Jj,r);case"trapezoid":return Ae.createElement(SJ,r);case"sector":return Ae.createElement(NM,r);case"symbols":if(IJ(t))return Ae.createElement(vj,r);break;default:return null}}function NJ(e){return x.isValidElement(e)?e.props:e}function HM(e){var t=e.option,r=e.shapeType,n=e.propTransformer,a=n===void 0?TJ:n,o=e.activeClassName,s=o===void 0?"recharts-active-shape":o,l=e.isActive,c=AJ(e,CJ),u;if(x.isValidElement(t))u=x.cloneElement(t,Xg(Xg({},c),NJ(t)));else if(Tr(t))u=t(c);else if(dJ(t)&&!pJ(t)){var d=a(t,c);u=Ae.createElement($3,{shapeType:r,elementProps:d})}else{var f=c;u=Ae.createElement($3,{shapeType:r,elementProps:f})}return l?Ae.createElement(cn,{className:s},u):u}function gy(e,t){return t!=null&&"trapezoids"in e.props}function vy(e,t){return t!=null&&"sectors"in e.props}function yp(e,t){return t!=null&&"points"in e.props}function DJ(e,t){var r,n,a=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,o=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return a&&o}function MJ(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function LJ(e,t){var r=e.x===t.x,n=e.y===t.y,a=e.z===t.z;return r&&n&&a}function RJ(e,t){var r;return gy(e,t)?r=DJ:vy(e,t)?r=MJ:yp(e,t)&&(r=LJ),r}function qJ(e,t){var r;return gy(e,t)?r="trapezoids":vy(e,t)?r="sectors":yp(e,t)&&(r="points"),r}function FJ(e,t){if(gy(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(vy(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return yp(e,t)?t.payload:{}}function $J(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,a=qJ(r,t),o=FJ(r,t),s=n.filter(function(c,u){var d=Bp(o,c),f=r.props[a].filter(function(v){var m=RJ(r,t);return m(v,t)}),h=r.props[a].indexOf(f[f.length-1]),p=u===h;return d&&p}),l=n.indexOf(s[s.length-1]);return l}var Km;function fd(e){"@babel/helpers - typeof";return fd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fd(e)}function Du(){return Du=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Du.apply(this,arguments)}function B3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Rn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?B3(Object(r),!0).forEach(function(n){zo(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function BJ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function U3(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,GM(n.key),n)}}function UJ(e,t,r){return t&&U3(e.prototype,t),r&&U3(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function zJ(e,t,r){return t=Jg(t),WJ(e,VM()?Reflect.construct(t,r||[],Jg(e).constructor):t.apply(e,r))}function WJ(e,t){if(t&&(fd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return HJ(e)}function HJ(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function VM(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(VM=function(){return!!e})()}function Jg(e){return Jg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Jg(e)}function VJ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&K_(e,t)}function K_(e,t){return K_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},K_(e,t)}function zo(e,t,r){return t=GM(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function GM(e){var t=GJ(e,"string");return fd(t)=="symbol"?t:t+""}function GJ(e,t){if(fd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(fd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var jl=function(e){function t(r){var n;return BJ(this,t),n=zJ(this,t,[r]),zo(n,"pieRef",null),zo(n,"sectorRefs",[]),zo(n,"id",qd("recharts-pie-")),zo(n,"handleAnimationEnd",function(){var a=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),Tr(a)&&a()}),zo(n,"handleAnimationStart",function(){var a=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),Tr(a)&&a()}),n.state={isAnimationFinished:!r.isAnimationActive,prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,sectorToFocus:0},n}return VJ(t,e),UJ(t,[{key:"isActiveIndex",value:function(n){var a=this.props.activeIndex;return Array.isArray(a)?a.indexOf(n)!==-1:n===a}},{key:"hasActiveIndex",value:function(){var n=this.props.activeIndex;return Array.isArray(n)?n.length!==0:n||n===0}},{key:"renderLabels",value:function(n){var a=this.props.isAnimationActive;if(a&&!this.state.isAnimationFinished)return null;var o=this.props,s=o.label,l=o.labelLine,c=o.dataKey,u=o.valueKey,d=gr(this.props,!1),f=gr(s,!1),h=gr(l,!1),p=s&&s.offsetRadius||20,v=n.map(function(m,y){var b=(m.startAngle+m.endAngle)/2,_=Fn(m.cx,m.cy,m.outerRadius+p,b),w=Rn(Rn(Rn(Rn({},d),m),{},{stroke:"none"},f),{},{index:y,textAnchor:t.getTextAnchor(_.x,m.cx)},_),A=Rn(Rn(Rn(Rn({},d),m),{},{fill:"none",stroke:m.fill},h),{},{index:y,points:[Fn(m.cx,m.cy,m.outerRadius,b),_]}),P=c;return Fr(c)&&Fr(u)?P="value":Fr(c)&&(P=u),Ae.createElement(cn,{key:"label-".concat(m.startAngle,"-").concat(m.endAngle,"-").concat(m.midAngle,"-").concat(y)},l&&t.renderLabelLineItem(l,A,"line"),t.renderLabelItem(s,w,Wa(m,P)))});return Ae.createElement(cn,{className:"recharts-pie-labels"},v)}},{key:"renderSectorsStatically",value:function(n){var a=this,o=this.props,s=o.activeShape,l=o.blendStroke,c=o.inactiveShape;return n.map(function(u,d){if(u?.startAngle===0&&u?.endAngle===0&&n.length!==1)return null;var f=a.isActiveIndex(d),h=c&&a.hasActiveIndex()?c:null,p=f?s:h,v=Rn(Rn({},u),{},{stroke:l?u.fill:u.stroke,tabIndex:-1});return Ae.createElement(cn,Du({ref:function(y){y&&!a.sectorRefs.includes(y)&&a.sectorRefs.push(y)},tabIndex:-1,className:"recharts-pie-sector"},Yc(a.props,u,d),{key:"sector-".concat(u?.startAngle,"-").concat(u?.endAngle,"-").concat(u.midAngle,"-").concat(d)}),Ae.createElement(HM,Du({option:p,isActive:f,shapeType:"sector"},v)))})}},{key:"renderSectorsWithAnimation",value:function(){var n=this,a=this.props,o=a.sectors,s=a.isAnimationActive,l=a.animationBegin,c=a.animationDuration,u=a.animationEasing,d=a.animationId,f=this.state,h=f.prevSectors,p=f.prevIsAnimationActive;return Ae.createElement(Es,{begin:l,duration:c,isActive:s,easing:u,from:{t:0},to:{t:1},key:"pie-".concat(d,"-").concat(p),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(v){var m=v.t,y=[],b=o&&o[0],_=b.startAngle;return o.forEach(function(w,A){var P=h&&h[A],E=A>0?Co(w,"paddingAngle",0):0;if(P){var T=_o(P.endAngle-P.startAngle,w.endAngle-w.startAngle),S=Rn(Rn({},w),{},{startAngle:_+E,endAngle:_+T(m)+E});y.push(S),_=S.endAngle}else{var I=w.endAngle,U=w.startAngle,O=_o(0,I-U),M=O(m),L=Rn(Rn({},w),{},{startAngle:_+E,endAngle:_+M+E});y.push(L),_=L.endAngle}}),Ae.createElement(cn,null,n.renderSectorsStatically(y))})}},{key:"attachKeyboardHandlers",value:function(n){var a=this;n.onkeydown=function(o){if(!o.altKey)switch(o.key){case"ArrowLeft":{var s=++a.state.sectorToFocus%a.sectorRefs.length;a.sectorRefs[s].focus(),a.setState({sectorToFocus:s});break}case"ArrowRight":{var l=--a.state.sectorToFocus<0?a.sectorRefs.length-1:a.state.sectorToFocus%a.sectorRefs.length;a.sectorRefs[l].focus(),a.setState({sectorToFocus:l});break}case"Escape":{a.sectorRefs[a.state.sectorToFocus].blur(),a.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var n=this.props,a=n.sectors,o=n.isAnimationActive,s=this.state.prevSectors;return o&&a&&a.length&&(!s||!Bp(s,a))?this.renderSectorsWithAnimation():this.renderSectorsStatically(a)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var n=this,a=this.props,o=a.hide,s=a.sectors,l=a.className,c=a.label,u=a.cx,d=a.cy,f=a.innerRadius,h=a.outerRadius,p=a.isAnimationActive,v=this.state.isAnimationFinished;if(o||!s||!s.length||!Dt(u)||!Dt(d)||!Dt(f)||!Dt(h))return null;var m=Pr("recharts-pie",l);return Ae.createElement(cn,{tabIndex:this.props.rootTabIndex,className:m,ref:function(b){n.pieRef=b}},this.renderSectors(),c&&this.renderLabels(s),Za.renderCallByParent(this.props,null,!1),(!p||v)&&fl.renderCallByParent(this.props,s,!1))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return a.prevIsAnimationActive!==n.isAnimationActive?{prevIsAnimationActive:n.isAnimationActive,prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:[],isAnimationFinished:!0}:n.isAnimationActive&&n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:a.curSectors,isAnimationFinished:!0}:n.sectors!==a.curSectors?{curSectors:n.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(n,a){return n>a?"start":n<a?"end":"middle"}},{key:"renderLabelLineItem",value:function(n,a,o){if(Ae.isValidElement(n))return Ae.cloneElement(n,a);if(Tr(n))return n(a);var s=Pr("recharts-pie-label-line",typeof n!="boolean"?n.className:"");return Ae.createElement(zg,Du({},a,{key:o,type:"linear",className:s}))}},{key:"renderLabelItem",value:function(n,a,o){if(Ae.isValidElement(n))return Ae.cloneElement(n,a);var s=o;if(Tr(n)&&(s=n(a),Ae.isValidElement(s)))return s;var l=Pr("recharts-pie-label-text",typeof n!="boolean"&&!Tr(n)?n.className:"");return Ae.createElement(Kc,Du({},a,{alignmentBaseline:"middle",className:l}),s)}}])}(x.PureComponent);Km=jl;zo(jl,"displayName","Pie");zo(jl,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!iu.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});zo(jl,"parseDeltaAngle",function(e,t){var r=Mi(t-e),n=Math.min(Math.abs(t-e),360);return r*n});zo(jl,"getRealPieData",function(e){var t=e.data,r=e.children,n=gr(e,!1),a=Ao(r,Zv);return t&&t.length?t.map(function(o,s){return Rn(Rn(Rn({payload:o},n),o),a&&a[s]&&a[s].props)}):a&&a.length?a.map(function(o){return Rn(Rn({},n),o.props)}):[]});zo(jl,"parseCoordinateOfPie",function(e,t){var r=t.top,n=t.left,a=t.width,o=t.height,s=kM(a,o),l=n+Li(e.cx,a,a/2),c=r+Li(e.cy,o,o/2),u=Li(e.innerRadius,s,0),d=Li(e.outerRadius,s,s*.8),f=e.maxRadius||Math.sqrt(a*a+o*o)/2;return{cx:l,cy:c,innerRadius:u,outerRadius:d,maxRadius:f}});zo(jl,"getComposedData",function(e){var t=e.item,r=e.offset,n=t.type.defaultProps!==void 0?Rn(Rn({},t.type.defaultProps),t.props):t.props,a=Km.getRealPieData(n);if(!a||!a.length)return null;var o=n.cornerRadius,s=n.startAngle,l=n.endAngle,c=n.paddingAngle,u=n.dataKey,d=n.nameKey,f=n.valueKey,h=n.tooltipType,p=Math.abs(n.minAngle),v=Km.parseCoordinateOfPie(n,r),m=Km.parseDeltaAngle(s,l),y=Math.abs(m),b=u;Fr(u)&&Fr(f)?(is(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),b="value"):Fr(u)&&(is(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),b=f);var _=a.filter(function(S){return Wa(S,b,0)!==0}).length,w=(y>=360?_:_-1)*c,A=y-_*p-w,P=a.reduce(function(S,I){var U=Wa(I,b,0);return S+(Dt(U)?U:0)},0),E;if(P>0){var T;E=a.map(function(S,I){var U=Wa(S,b,0),O=Wa(S,d,I),M=(Dt(U)?U:0)/P,L;I?L=T.endAngle+Mi(m)*c*(U!==0?1:0):L=s;var q=L+Mi(m)*((U!==0?p:0)+M*A),z=(L+q)/2,K=(v.innerRadius+v.outerRadius)/2,J=[{name:O,value:U,payload:S,dataKey:b,type:h}],R=Fn(v.cx,v.cy,K,z);return T=Rn(Rn(Rn({percent:M,cornerRadius:o,name:O,tooltipPayload:J,midAngle:z,middleRadius:K,tooltipPosition:R},S),v),{},{value:Wa(S,b),startAngle:L,endAngle:q,payload:S,paddingAngle:Mi(m)*c}),T})}return Rn(Rn({},v),{},{sectors:E,data:a})});var z1,z3;function YJ(){if(z3)return z1;z3=1;var e=Math.ceil,t=Math.max;function r(n,a,o,s){for(var l=-1,c=t(e((a-n)/(o||1)),0),u=Array(c);c--;)u[s?c:++l]=n,n+=o;return u}return z1=r,z1}var W1,W3;function YM(){if(W3)return W1;W3=1;var e=mD(),t=1/0,r=17976931348623157e292;function n(a){if(!a)return a===0?a:0;if(a=e(a),a===t||a===-t){var o=a<0?-1:1;return o*r}return a===a?a:0}return W1=n,W1}var H1,H3;function KJ(){if(H3)return H1;H3=1;var e=YJ(),t=Jv(),r=YM();function n(a){return function(o,s,l){return l&&typeof l!="number"&&t(o,s,l)&&(s=l=void 0),o=r(o),s===void 0?(s=o,o=0):s=r(s),l=l===void 0?o<s?1:-1:r(l),e(o,s,l,a)}}return H1=n,H1}var V1,V3;function QJ(){if(V3)return V1;V3=1;var e=KJ(),t=e();return V1=t,V1}var XJ=QJ();const Zg=Et(XJ);function xp(e){"@babel/helpers - typeof";return xp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xp(e)}function G3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Y3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?G3(Object(r),!0).forEach(function(n){KM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function KM(e,t,r){return t=JJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function JJ(e){var t=ZJ(e,"string");return xp(t)=="symbol"?t:t+""}function ZJ(e,t){if(xp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(xp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var eZ=["Webkit","Moz","O","ms"],tZ=function(t,r){var n=t.replace(/(\w)/,function(o){return o.toUpperCase()}),a=eZ.reduce(function(o,s){return Y3(Y3({},o),{},KM({},s+n,r))},{});return a[t]=r,a};function hd(e){"@babel/helpers - typeof";return hd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hd(e)}function ev(){return ev=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ev.apply(this,arguments)}function K3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function G1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?K3(Object(r),!0).forEach(function(n){vo(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rZ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q3(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,XM(n.key),n)}}function nZ(e,t,r){return t&&Q3(e.prototype,t),r&&Q3(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function aZ(e,t,r){return t=tv(t),iZ(e,QM()?Reflect.construct(t,r||[],tv(e).constructor):t.apply(e,r))}function iZ(e,t){if(t&&(hd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return oZ(e)}function oZ(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function QM(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(QM=function(){return!!e})()}function tv(e){return tv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},tv(e)}function sZ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Q_(e,t)}function Q_(e,t){return Q_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Q_(e,t)}function vo(e,t,r){return t=XM(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function XM(e){var t=lZ(e,"string");return hd(t)=="symbol"?t:t+""}function lZ(e,t){if(hd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(hd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var cZ=function(t){var r=t.data,n=t.startIndex,a=t.endIndex,o=t.x,s=t.width,l=t.travellerWidth;if(!r||!r.length)return{};var c=r.length,u=Eh().domain(Zg(0,c)).range([o,o+s-l]),d=u.domain().map(function(f){return u(f)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:u(n),endX:u(a),scale:u,scaleValues:d}},X3=function(t){return t.changedTouches&&!!t.changedTouches.length},pd=function(e){function t(r){var n;return rZ(this,t),n=aZ(this,t,[r]),vo(n,"handleDrag",function(a){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(a):n.state.isSlideMoving&&n.handleSlideDrag(a)}),vo(n,"handleTouchMove",function(a){a.changedTouches!=null&&a.changedTouches.length>0&&n.handleDrag(a.changedTouches[0])}),vo(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var a=n.props,o=a.endIndex,s=a.onDragEnd,l=a.startIndex;s?.({endIndex:o,startIndex:l})}),n.detachDragEndListener()}),vo(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),vo(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),vo(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),vo(n,"handleSlideDragStart",function(a){var o=X3(a)?a.changedTouches[0]:a;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:o.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return sZ(t,e),nZ(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var a=n.startX,o=n.endX,s=this.state.scaleValues,l=this.props,c=l.gap,u=l.data,d=u.length-1,f=Math.min(a,o),h=Math.max(a,o),p=t.getIndexInRange(s,f),v=t.getIndexInRange(s,h);return{startIndex:p-p%c,endIndex:v===d?d:v-v%c}}},{key:"getTextOfTick",value:function(n){var a=this.props,o=a.data,s=a.tickFormatter,l=a.dataKey,c=Wa(o[n],l,n);return Tr(s)?s(c,n):c}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var a=this.state,o=a.slideMoveStartX,s=a.startX,l=a.endX,c=this.props,u=c.x,d=c.width,f=c.travellerWidth,h=c.startIndex,p=c.endIndex,v=c.onChange,m=n.pageX-o;m>0?m=Math.min(m,u+d-f-l,u+d-f-s):m<0&&(m=Math.max(m,u-s,u-l));var y=this.getIndex({startX:s+m,endX:l+m});(y.startIndex!==h||y.endIndex!==p)&&v&&v(y),this.setState({startX:s+m,endX:l+m,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,a){var o=X3(a)?a.changedTouches[0]:a;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:o.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var a=this.state,o=a.brushMoveStartX,s=a.movingTravellerId,l=a.endX,c=a.startX,u=this.state[s],d=this.props,f=d.x,h=d.width,p=d.travellerWidth,v=d.onChange,m=d.gap,y=d.data,b={startX:this.state.startX,endX:this.state.endX},_=n.pageX-o;_>0?_=Math.min(_,f+h-p-u):_<0&&(_=Math.max(_,f-u)),b[s]=u+_;var w=this.getIndex(b),A=w.startIndex,P=w.endIndex,E=function(){var S=y.length-1;return s==="startX"&&(l>c?A%m===0:P%m===0)||l<c&&P===S||s==="endX"&&(l>c?P%m===0:A%m===0)||l>c&&P===S};this.setState(vo(vo({},s,u+_),"brushMoveStartX",n.pageX),function(){v&&E()&&v(w)})}},{key:"handleTravellerMoveKeyboard",value:function(n,a){var o=this,s=this.state,l=s.scaleValues,c=s.startX,u=s.endX,d=this.state[a],f=l.indexOf(d);if(f!==-1){var h=f+n;if(!(h===-1||h>=l.length)){var p=l[h];a==="startX"&&p>=u||a==="endX"&&p<=c||this.setState(vo({},a,p),function(){o.props.onChange(o.getIndex({startX:o.state.startX,endX:o.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,a=n.x,o=n.y,s=n.width,l=n.height,c=n.fill,u=n.stroke;return Ae.createElement("rect",{stroke:u,fill:c,x:a,y:o,width:s,height:l})}},{key:"renderPanorama",value:function(){var n=this.props,a=n.x,o=n.y,s=n.width,l=n.height,c=n.data,u=n.children,d=n.padding,f=x.Children.only(u);return f?Ae.cloneElement(f,{x:a,y:o,width:s,height:l,margin:d,compact:!0,data:c}):null}},{key:"renderTravellerLayer",value:function(n,a){var o,s,l=this,c=this.props,u=c.y,d=c.travellerWidth,f=c.height,h=c.traveller,p=c.ariaLabel,v=c.data,m=c.startIndex,y=c.endIndex,b=Math.max(n,this.props.x),_=G1(G1({},gr(this.props,!1)),{},{x:b,y:u,width:d,height:f}),w=p||"Min value: ".concat((o=v[m])===null||o===void 0?void 0:o.name,", Max value: ").concat((s=v[y])===null||s===void 0?void 0:s.name);return Ae.createElement(cn,{tabIndex:0,role:"slider","aria-label":w,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[a],onTouchStart:this.travellerDragStartHandlers[a],onKeyDown:function(P){["ArrowLeft","ArrowRight"].includes(P.key)&&(P.preventDefault(),P.stopPropagation(),l.handleTravellerMoveKeyboard(P.key==="ArrowRight"?1:-1,a))},onFocus:function(){l.setState({isTravellerFocused:!0})},onBlur:function(){l.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(h,_))}},{key:"renderSlide",value:function(n,a){var o=this.props,s=o.y,l=o.height,c=o.stroke,u=o.travellerWidth,d=Math.min(n,a)+u,f=Math.max(Math.abs(a-n)-u,0);return Ae.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:c,fillOpacity:.2,x:d,y:s,width:f,height:l})}},{key:"renderText",value:function(){var n=this.props,a=n.startIndex,o=n.endIndex,s=n.y,l=n.height,c=n.travellerWidth,u=n.stroke,d=this.state,f=d.startX,h=d.endX,p=5,v={pointerEvents:"none",fill:u};return Ae.createElement(cn,{className:"recharts-brush-texts"},Ae.createElement(Kc,ev({textAnchor:"end",verticalAnchor:"middle",x:Math.min(f,h)-p,y:s+l/2},v),this.getTextOfTick(a)),Ae.createElement(Kc,ev({textAnchor:"start",verticalAnchor:"middle",x:Math.max(f,h)+c+p,y:s+l/2},v),this.getTextOfTick(o)))}},{key:"render",value:function(){var n=this.props,a=n.data,o=n.className,s=n.children,l=n.x,c=n.y,u=n.width,d=n.height,f=n.alwaysShowText,h=this.state,p=h.startX,v=h.endX,m=h.isTextActive,y=h.isSlideMoving,b=h.isTravellerMoving,_=h.isTravellerFocused;if(!a||!a.length||!Dt(l)||!Dt(c)||!Dt(u)||!Dt(d)||u<=0||d<=0)return null;var w=Pr("recharts-brush",o),A=Ae.Children.count(s)===1,P=tZ("userSelect","none");return Ae.createElement(cn,{className:w,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:P},this.renderBackground(),A&&this.renderPanorama(),this.renderSlide(p,v),this.renderTravellerLayer(p,"startX"),this.renderTravellerLayer(v,"endX"),(m||y||b||_||f)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var a=n.x,o=n.y,s=n.width,l=n.height,c=n.stroke,u=Math.floor(o+l/2)-1;return Ae.createElement(Ae.Fragment,null,Ae.createElement("rect",{x:a,y:o,width:s,height:l,fill:c,stroke:"none"}),Ae.createElement("line",{x1:a+1,y1:u,x2:a+s-1,y2:u,fill:"none",stroke:"#fff"}),Ae.createElement("line",{x1:a+1,y1:u+2,x2:a+s-1,y2:u+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,a){var o;return Ae.isValidElement(n)?o=Ae.cloneElement(n,a):Tr(n)?o=n(a):o=t.renderDefaultTraveller(a),o}},{key:"getDerivedStateFromProps",value:function(n,a){var o=n.data,s=n.width,l=n.x,c=n.travellerWidth,u=n.updateId,d=n.startIndex,f=n.endIndex;if(o!==a.prevData||u!==a.prevUpdateId)return G1({prevData:o,prevTravellerWidth:c,prevUpdateId:u,prevX:l,prevWidth:s},o&&o.length?cZ({data:o,width:s,x:l,travellerWidth:c,startIndex:d,endIndex:f}):{scale:null,scaleValues:null});if(a.scale&&(s!==a.prevWidth||l!==a.prevX||c!==a.prevTravellerWidth)){a.scale.range([l,l+s-c]);var h=a.scale.domain().map(function(p){return a.scale(p)});return{prevData:o,prevTravellerWidth:c,prevUpdateId:u,prevX:l,prevWidth:s,startX:a.scale(n.startIndex),endX:a.scale(n.endIndex),scaleValues:h}}return null}},{key:"getIndexInRange",value:function(n,a){for(var o=n.length,s=0,l=o-1;l-s>1;){var c=Math.floor((s+l)/2);n[c]>a?l=c:s=c}return a>=n[l]?l:s}}])}(x.PureComponent);vo(pd,"displayName","Brush");vo(pd,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var Y1,J3;function uZ(){if(J3)return Y1;J3=1;var e=Sj();function t(r,n){var a;return e(r,function(o,s,l){return a=n(o,s,l),!a}),!!a}return Y1=t,Y1}var K1,Z3;function dZ(){if(Z3)return K1;Z3=1;var e=VN(),t=Rs(),r=uZ(),n=eo(),a=Jv();function o(s,l,c){var u=n(s)?e:r;return c&&a(s,l,c)&&(l=void 0),u(s,t(l,3))}return K1=o,K1}var fZ=dZ();const hZ=Et(fZ);var As=function(t,r){var n=t.alwaysShow,a=t.ifOverflow;return n&&(a="extendDomain"),a===r},Q1,e4;function pZ(){if(e4)return Q1;e4=1;var e=uD();function t(r,n,a){n=="__proto__"&&e?e(r,n,{configurable:!0,enumerable:!0,value:a,writable:!0}):r[n]=a}return Q1=t,Q1}var X1,t4;function mZ(){if(t4)return X1;t4=1;var e=pZ(),t=lD(),r=Rs();function n(a,o){var s={};return o=r(o,3),t(a,function(l,c,u){e(s,c,o(l,c,u))}),s}return X1=n,X1}var gZ=mZ();const vZ=Et(gZ);var J1,r4;function yZ(){if(r4)return J1;r4=1;function e(t,r){for(var n=-1,a=t==null?0:t.length;++n<a;)if(!r(t[n],n,t))return!1;return!0}return J1=e,J1}var Z1,n4;function xZ(){if(n4)return Z1;n4=1;var e=Sj();function t(r,n){var a=!0;return e(r,function(o,s,l){return a=!!n(o,s,l),a}),a}return Z1=t,Z1}var e2,a4;function bZ(){if(a4)return e2;a4=1;var e=yZ(),t=xZ(),r=Rs(),n=eo(),a=Jv();function o(s,l,c){var u=n(s)?e:t;return c&&a(s,l,c)&&(l=void 0),u(s,r(l,3))}return e2=o,e2}var _Z=bZ();const JM=Et(_Z);var wZ=["x","y"];function bp(e){"@babel/helpers - typeof";return bp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bp(e)}function X_(){return X_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},X_.apply(this,arguments)}function i4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function yf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?i4(Object(r),!0).forEach(function(n){jZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jZ(e,t,r){return t=SZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SZ(e){var t=CZ(e,"string");return bp(t)=="symbol"?t:t+""}function CZ(e,t){if(bp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(bp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function AZ(e,t){if(e==null)return{};var r=PZ(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function PZ(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function OZ(e,t){var r=e.x,n=e.y,a=AZ(e,wZ),o="".concat(r),s=parseInt(o,10),l="".concat(n),c=parseInt(l,10),u="".concat(t.height||a.height),d=parseInt(u,10),f="".concat(t.width||a.width),h=parseInt(f,10);return yf(yf(yf(yf(yf({},t),a),s?{x:s}:{}),c?{y:c}:{}),{},{height:d,width:h,name:t.name,radius:t.radius})}function o4(e){return Ae.createElement(HM,X_({shapeType:"rectangle",propTransformer:OZ,activeClassName:"recharts-active-bar"},e))}var kZ=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,a){if(typeof t=="number")return t;var o=typeof n=="number";return o?t(n,a):(o||Xc(),r)}},EZ=["value","background"],ZM;function md(e){"@babel/helpers - typeof";return md=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},md(e)}function TZ(e,t){if(e==null)return{};var r=IZ(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function IZ(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function rv(){return rv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},rv.apply(this,arguments)}function s4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function La(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?s4(Object(r),!0).forEach(function(n){Yl(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function NZ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l4(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,tL(n.key),n)}}function DZ(e,t,r){return t&&l4(e.prototype,t),r&&l4(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function MZ(e,t,r){return t=nv(t),LZ(e,eL()?Reflect.construct(t,r||[],nv(e).constructor):t.apply(e,r))}function LZ(e,t){if(t&&(md(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return RZ(e)}function RZ(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function eL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(eL=function(){return!!e})()}function nv(e){return nv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},nv(e)}function qZ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&J_(e,t)}function J_(e,t){return J_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},J_(e,t)}function Yl(e,t,r){return t=tL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tL(e){var t=FZ(e,"string");return md(t)=="symbol"?t:t+""}function FZ(e,t){if(md(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(md(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var vl=function(e){function t(){var r;NZ(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return r=MZ(this,t,[].concat(a)),Yl(r,"state",{isAnimationFinished:!1}),Yl(r,"id",qd("recharts-bar-")),Yl(r,"handleAnimationEnd",function(){var s=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),s&&s()}),Yl(r,"handleAnimationStart",function(){var s=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),s&&s()}),r}return qZ(t,e),DZ(t,[{key:"renderRectanglesStatically",value:function(n){var a=this,o=this.props,s=o.shape,l=o.dataKey,c=o.activeIndex,u=o.activeBar,d=gr(this.props,!1);return n&&n.map(function(f,h){var p=h===c,v=p?u:s,m=La(La(La({},d),f),{},{isActive:p,option:v,index:h,dataKey:l,onAnimationStart:a.handleAnimationStart,onAnimationEnd:a.handleAnimationEnd});return Ae.createElement(cn,rv({className:"recharts-bar-rectangle"},Yc(a.props,f,h),{key:"rectangle-".concat(f?.x,"-").concat(f?.y,"-").concat(f?.value,"-").concat(h)}),Ae.createElement(o4,m))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,a=this.props,o=a.data,s=a.layout,l=a.isAnimationActive,c=a.animationBegin,u=a.animationDuration,d=a.animationEasing,f=a.animationId,h=this.state.prevData;return Ae.createElement(Es,{begin:c,duration:u,isActive:l,easing:d,from:{t:0},to:{t:1},key:"bar-".concat(f),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(p){var v=p.t,m=o.map(function(y,b){var _=h&&h[b];if(_){var w=_o(_.x,y.x),A=_o(_.y,y.y),P=_o(_.width,y.width),E=_o(_.height,y.height);return La(La({},y),{},{x:w(v),y:A(v),width:P(v),height:E(v)})}if(s==="horizontal"){var T=_o(0,y.height),S=T(v);return La(La({},y),{},{y:y.y+y.height-S,height:S})}var I=_o(0,y.width),U=I(v);return La(La({},y),{},{width:U})});return Ae.createElement(cn,null,n.renderRectanglesStatically(m))})}},{key:"renderRectangles",value:function(){var n=this.props,a=n.data,o=n.isAnimationActive,s=this.state.prevData;return o&&a&&a.length&&(!s||!Bp(s,a))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(a)}},{key:"renderBackground",value:function(){var n=this,a=this.props,o=a.data,s=a.dataKey,l=a.activeIndex,c=gr(this.props.background,!1);return o.map(function(u,d){u.value;var f=u.background,h=TZ(u,EZ);if(!f)return null;var p=La(La(La(La(La({},h),{},{fill:"#eee"},f),c),Yc(n.props,u,d)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:s,index:d,className:"recharts-bar-background-rectangle"});return Ae.createElement(o4,rv({key:"background-bar-".concat(d),option:n.props.background,isActive:d===l},p))})}},{key:"renderErrorBar",value:function(n,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,s=o.data,l=o.xAxis,c=o.yAxis,u=o.layout,d=o.children,f=Ao(d,Up);if(!f)return null;var h=u==="vertical"?s[0].height/2:s[0].width/2,p=function(y,b){var _=Array.isArray(y.value)?y.value[1]:y.value;return{x:y.x,y:y.y,value:_,errorVal:Wa(y,b)}},v={clipPath:n?"url(#clipPath-".concat(a,")"):null};return Ae.createElement(cn,v,f.map(function(m){return Ae.cloneElement(m,{key:"error-bar-".concat(a,"-").concat(m.props.dataKey),data:s,xAxis:l,yAxis:c,layout:u,offset:h,dataPointFormatter:p})}))}},{key:"render",value:function(){var n=this.props,a=n.hide,o=n.data,s=n.className,l=n.xAxis,c=n.yAxis,u=n.left,d=n.top,f=n.width,h=n.height,p=n.isAnimationActive,v=n.background,m=n.id;if(a||!o||!o.length)return null;var y=this.state.isAnimationFinished,b=Pr("recharts-bar",s),_=l&&l.allowDataOverflow,w=c&&c.allowDataOverflow,A=_||w,P=Fr(m)?this.id:m;return Ae.createElement(cn,{className:b},_||w?Ae.createElement("defs",null,Ae.createElement("clipPath",{id:"clipPath-".concat(P)},Ae.createElement("rect",{x:_?u:u-f/2,y:w?d:d-h/2,width:_?f:f*2,height:w?h:h*2}))):null,Ae.createElement(cn,{className:"recharts-bar-rectangles",clipPath:A?"url(#clipPath-".concat(P,")"):null},v?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(A,P),(!p||y)&&fl.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:a.curData}:n.data!==a.curData?{curData:n.data}:null}}])}(x.PureComponent);ZM=vl;Yl(vl,"displayName","Bar");Yl(vl,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!iu.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});Yl(vl,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,a=e.bandSize,o=e.xAxis,s=e.yAxis,l=e.xAxisTicks,c=e.yAxisTicks,u=e.stackedData,d=e.dataStartIndex,f=e.displayedData,h=e.offset,p=yY(n,r);if(!p)return null;var v=t.layout,m=r.type.defaultProps,y=m!==void 0?La(La({},m),r.props):r.props,b=y.dataKey,_=y.children,w=y.minPointSize,A=v==="horizontal"?s:o,P=u?A.scale.domain():null,E=CY({numericAxis:A}),T=Ao(_,Zv),S=f.map(function(I,U){var O,M,L,q,z,K;u?O=xY(u[d+U],P):(O=Wa(I,b),Array.isArray(O)||(O=[E,O]));var J=kZ(w,ZM.defaultProps.minPointSize)(O[1],U);if(v==="horizontal"){var R,k=[s.scale(O[0]),s.scale(O[1])],$=k[0],X=k[1];M=Lk({axis:o,ticks:l,bandSize:a,offset:p.offset,entry:I,index:U}),L=(R=X??$)!==null&&R!==void 0?R:void 0,q=p.size;var C=$-X;if(z=Number.isNaN(C)?0:C,K={x:M,y:s.y,width:q,height:s.height},Math.abs(J)>0&&Math.abs(z)<Math.abs(J)){var N=Mi(z||J)*(Math.abs(J)-Math.abs(z));L-=N,z+=N}}else{var H=[o.scale(O[0]),o.scale(O[1])],W=H[0],ne=H[1];if(M=W,L=Lk({axis:s,ticks:c,bandSize:a,offset:p.offset,entry:I,index:U}),q=ne-W,z=p.size,K={x:o.x,y:L,width:o.width,height:z},Math.abs(J)>0&&Math.abs(q)<Math.abs(J)){var se=Mi(q||J)*(Math.abs(J)-Math.abs(q));q+=se}}return La(La(La({},I),{},{x:M,y:L,width:q,height:z,value:u?O:O[1],payload:I,background:K},T&&T[U]&&T[U].props),{},{tooltipPayload:[PM(r,I)],tooltipPosition:{x:M+q/2,y:L+z/2}})});return La({data:S,layout:v},h)});function _p(e){"@babel/helpers - typeof";return _p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_p(e)}function $Z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c4(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,rL(n.key),n)}}function BZ(e,t,r){return t&&c4(e.prototype,t),r&&c4(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function u4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function rs(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?u4(Object(r),!0).forEach(function(n){yy(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yy(e,t,r){return t=rL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rL(e){var t=UZ(e,"string");return _p(t)=="symbol"?t:t+""}function UZ(e,t){if(_p(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(_p(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var nL=function(t,r,n,a,o){var s=t.width,l=t.height,c=t.layout,u=t.children,d=Object.keys(r),f={left:n.left,leftMirror:n.left,right:s-n.right,rightMirror:s-n.right,top:n.top,topMirror:n.top,bottom:l-n.bottom,bottomMirror:l-n.bottom},h=!!yo(u,vl);return d.reduce(function(p,v){var m=r[v],y=m.orientation,b=m.domain,_=m.padding,w=_===void 0?{}:_,A=m.mirror,P=m.reversed,E="".concat(y).concat(A?"Mirror":""),T,S,I,U,O;if(m.type==="number"&&(m.padding==="gap"||m.padding==="no-gap")){var M=b[1]-b[0],L=1/0,q=m.categoricalDomain.sort(oB);if(q.forEach(function(H,W){W>0&&(L=Math.min((H||0)-(q[W-1]||0),L))}),Number.isFinite(L)){var z=L/M,K=m.layout==="vertical"?n.height:n.width;if(m.padding==="gap"&&(T=z*K/2),m.padding==="no-gap"){var J=Li(t.barCategoryGap,z*K),R=z*K/2;T=R-J-(R-J)/K*J}}}a==="xAxis"?S=[n.left+(w.left||0)+(T||0),n.left+n.width-(w.right||0)-(T||0)]:a==="yAxis"?S=c==="horizontal"?[n.top+n.height-(w.bottom||0),n.top+(w.top||0)]:[n.top+(w.top||0)+(T||0),n.top+n.height-(w.bottom||0)-(T||0)]:S=m.range,P&&(S=[S[1],S[0]]);var k=jM(m,o,h),$=k.scale,X=k.realScaleType;$.domain(b).range(S),SM($);var C=CM($,rs(rs({},m),{},{realScaleType:X}));a==="xAxis"?(O=y==="top"&&!A||y==="bottom"&&A,I=n.left,U=f[E]-O*m.height):a==="yAxis"&&(O=y==="left"&&!A||y==="right"&&A,I=f[E]-O*m.width,U=n.top);var N=rs(rs(rs({},m),C),{},{realScaleType:X,x:I,y:U,scale:$,width:a==="xAxis"?n.width:m.width,height:a==="yAxis"?n.height:m.height});return N.bandSize=$g(N,C),!m.hide&&a==="xAxis"?f[E]+=(O?-1:1)*N.height:m.hide||(f[E]+=(O?-1:1)*N.width),rs(rs({},p),{},yy({},v,N))},{})},aL=function(t,r){var n=t.x,a=t.y,o=r.x,s=r.y;return{x:Math.min(n,o),y:Math.min(a,s),width:Math.abs(o-n),height:Math.abs(s-a)}},zZ=function(t){var r=t.x1,n=t.y1,a=t.x2,o=t.y2;return aL({x:r,y:n},{x:a,y:o})},iL=function(){function e(t){$Z(this,e),this.scale=t}return BZ(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.bandAware,o=n.position;if(r!==void 0){if(o)switch(o){case"start":return this.scale(r);case"middle":{var s=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+s}case"end":{var l=this.bandwidth?this.bandwidth():0;return this.scale(r)+l}default:return this.scale(r)}if(a){var c=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+c}return this.scale(r)}}},{key:"isInRange",value:function(r){var n=this.range(),a=n[0],o=n[n.length-1];return a<=o?r>=a&&r<=o:r>=o&&r<=a}}],[{key:"create",value:function(r){return new e(r)}}])}();yy(iL,"EPS",1e-4);var Zj=function(t){var r=Object.keys(t).reduce(function(n,a){return rs(rs({},n),{},yy({},a,iL.create(t[a])))},{});return rs(rs({},r),{},{apply:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=o.bandAware,l=o.position;return vZ(a,function(c,u){return r[u].apply(c,{bandAware:s,position:l})})},isInRange:function(a){return JM(a,function(o,s){return r[s].isInRange(o)})}})};function WZ(e){return(e%180+180)%180}var HZ=function(t){var r=t.width,n=t.height,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=WZ(a),s=o*Math.PI/180,l=Math.atan(n/r),c=s>l&&s<Math.PI-l?n/Math.sin(s):r/Math.cos(s);return Math.abs(c)},t2,d4;function VZ(){if(d4)return t2;d4=1;var e=Rs(),t=Lp(),r=Qv();function n(a){return function(o,s,l){var c=Object(o);if(!t(o)){var u=e(s,3);o=r(o),s=function(f){return u(c[f],f,c)}}var d=a(o,s,l);return d>-1?c[u?o[d]:d]:void 0}}return t2=n,t2}var r2,f4;function GZ(){if(f4)return r2;f4=1;var e=YM();function t(r){var n=e(r),a=n%1;return n===n?a?n-a:n:0}return r2=t,r2}var n2,h4;function YZ(){if(h4)return n2;h4=1;var e=nD(),t=Rs(),r=GZ(),n=Math.max;function a(o,s,l){var c=o==null?0:o.length;if(!c)return-1;var u=l==null?0:r(l);return u<0&&(u=n(c+u,0)),e(o,t(s,3),u)}return n2=a,n2}var a2,p4;function KZ(){if(p4)return a2;p4=1;var e=VZ(),t=YZ(),r=e(t);return a2=r,a2}var QZ=KZ();const XZ=Et(QZ);var JZ=xN();const ZZ=Et(JZ);var eee=ZZ(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),eS=x.createContext(void 0),tS=x.createContext(void 0),oL=x.createContext(void 0),sL=x.createContext({}),lL=x.createContext(void 0),cL=x.createContext(0),uL=x.createContext(0),m4=function(t){var r=t.state,n=r.xAxisMap,a=r.yAxisMap,o=r.offset,s=t.clipPathId,l=t.children,c=t.width,u=t.height,d=eee(o);return Ae.createElement(eS.Provider,{value:n},Ae.createElement(tS.Provider,{value:a},Ae.createElement(sL.Provider,{value:o},Ae.createElement(oL.Provider,{value:d},Ae.createElement(lL.Provider,{value:s},Ae.createElement(cL.Provider,{value:u},Ae.createElement(uL.Provider,{value:c},l)))))))},tee=function(){return x.useContext(lL)},dL=function(t){var r=x.useContext(eS);r==null&&Xc();var n=r[t];return n==null&&Xc(),n},ree=function(){var t=x.useContext(eS);return Vl(t)},nee=function(){var t=x.useContext(tS),r=XZ(t,function(n){return JM(n.domain,Number.isFinite)});return r||Vl(t)},fL=function(t){var r=x.useContext(tS);r==null&&Xc();var n=r[t];return n==null&&Xc(),n},aee=function(){var t=x.useContext(oL);return t},iee=function(){return x.useContext(sL)},rS=function(){return x.useContext(uL)},nS=function(){return x.useContext(cL)};function gd(e){"@babel/helpers - typeof";return gd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gd(e)}function oee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function see(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,pL(n.key),n)}}function lee(e,t,r){return t&&see(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function cee(e,t,r){return t=av(t),uee(e,hL()?Reflect.construct(t,r||[],av(e).constructor):t.apply(e,r))}function uee(e,t){if(t&&(gd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return dee(e)}function dee(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hL=function(){return!!e})()}function av(e){return av=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},av(e)}function fee(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Z_(e,t)}function Z_(e,t){return Z_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Z_(e,t)}function g4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function v4(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?g4(Object(r),!0).forEach(function(n){aS(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function aS(e,t,r){return t=pL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pL(e){var t=hee(e,"string");return gd(t)=="symbol"?t:t+""}function hee(e,t){if(gd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(gd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function pee(e,t){return yee(e)||vee(e,t)||gee(e,t)||mee()}function mee(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gee(e,t){if(e){if(typeof e=="string")return y4(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y4(e,t)}}function y4(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function vee(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function yee(e){if(Array.isArray(e))return e}function ew(){return ew=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ew.apply(this,arguments)}var xee=function(t,r){var n;return Ae.isValidElement(t)?n=Ae.cloneElement(t,r):Tr(t)?n=t(r):n=Ae.createElement("line",ew({},r,{className:"recharts-reference-line-line"})),n},bee=function(t,r,n,a,o,s,l,c,u){var d=o.x,f=o.y,h=o.width,p=o.height;if(n){var v=u.y,m=t.y.apply(v,{position:s});if(As(u,"discard")&&!t.y.isInRange(m))return null;var y=[{x:d+h,y:m},{x:d,y:m}];return c==="left"?y.reverse():y}if(r){var b=u.x,_=t.x.apply(b,{position:s});if(As(u,"discard")&&!t.x.isInRange(_))return null;var w=[{x:_,y:f+p},{x:_,y:f}];return l==="top"?w.reverse():w}if(a){var A=u.segment,P=A.map(function(E){return t.apply(E,{position:s})});return As(u,"discard")&&hZ(P,function(E){return!t.isInRange(E)})?null:P}return null};function _ee(e){var t=e.x,r=e.y,n=e.segment,a=e.xAxisId,o=e.yAxisId,s=e.shape,l=e.className,c=e.alwaysShow,u=tee(),d=dL(a),f=fL(o),h=aee();if(!u||!h)return null;is(c===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var p=Zj({x:d.scale,y:f.scale}),v=Ha(t),m=Ha(r),y=n&&n.length===2,b=bee(p,v,m,y,h,e.position,d.orientation,f.orientation,e);if(!b)return null;var _=pee(b,2),w=_[0],A=w.x,P=w.y,E=_[1],T=E.x,S=E.y,I=As(e,"hidden")?"url(#".concat(u,")"):void 0,U=v4(v4({clipPath:I},gr(e,!0)),{},{x1:A,y1:P,x2:T,y2:S});return Ae.createElement(cn,{className:Pr("recharts-reference-line",l)},xee(s,U),Za.renderCallByParent(e,zZ({x1:A,y1:P,x2:T,y2:S})))}var iS=function(e){function t(){return oee(this,t),cee(this,t,arguments)}return fee(t,e),lee(t,[{key:"render",value:function(){return Ae.createElement(_ee,this.props)}}])}(Ae.Component);aS(iS,"displayName","ReferenceLine");aS(iS,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function tw(){return tw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},tw.apply(this,arguments)}function vd(e){"@babel/helpers - typeof";return vd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vd(e)}function x4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function b4(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?x4(Object(r),!0).forEach(function(n){xy(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function jee(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,gL(n.key),n)}}function See(e,t,r){return t&&jee(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Cee(e,t,r){return t=iv(t),Aee(e,mL()?Reflect.construct(t,r||[],iv(e).constructor):t.apply(e,r))}function Aee(e,t){if(t&&(vd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Pee(e)}function Pee(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mL=function(){return!!e})()}function iv(e){return iv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},iv(e)}function Oee(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&rw(e,t)}function rw(e,t){return rw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},rw(e,t)}function xy(e,t,r){return t=gL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gL(e){var t=kee(e,"string");return vd(t)=="symbol"?t:t+""}function kee(e,t){if(vd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(vd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Eee=function(t){var r=t.x,n=t.y,a=t.xAxis,o=t.yAxis,s=Zj({x:a.scale,y:o.scale}),l=s.apply({x:r,y:n},{bandAware:!0});return As(t,"discard")&&!s.isInRange(l)?null:l},by=function(e){function t(){return wee(this,t),Cee(this,t,arguments)}return Oee(t,e),See(t,[{key:"render",value:function(){var n=this.props,a=n.x,o=n.y,s=n.r,l=n.alwaysShow,c=n.clipPathId,u=Ha(a),d=Ha(o);if(is(l===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!u||!d)return null;var f=Eee(this.props);if(!f)return null;var h=f.x,p=f.y,v=this.props,m=v.shape,y=v.className,b=As(this.props,"hidden")?"url(#".concat(c,")"):void 0,_=b4(b4({clipPath:b},gr(this.props,!0)),{},{cx:h,cy:p});return Ae.createElement(cn,{className:Pr("recharts-reference-dot",y)},t.renderDot(m,_),Za.renderCallByParent(this.props,{x:h-s,y:p-s,width:2*s,height:2*s}))}}])}(Ae.Component);xy(by,"displayName","ReferenceDot");xy(by,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});xy(by,"renderDot",function(e,t){var r;return Ae.isValidElement(e)?r=Ae.cloneElement(e,t):Tr(e)?r=e(t):r=Ae.createElement(dy,tw({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function nw(){return nw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nw.apply(this,arguments)}function yd(e){"@babel/helpers - typeof";return yd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yd(e)}function _4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function w4(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_4(Object(r),!0).forEach(function(n){_y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Tee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Iee(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,yL(n.key),n)}}function Nee(e,t,r){return t&&Iee(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Dee(e,t,r){return t=ov(t),Mee(e,vL()?Reflect.construct(t,r||[],ov(e).constructor):t.apply(e,r))}function Mee(e,t){if(t&&(yd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Lee(e)}function Lee(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vL=function(){return!!e})()}function ov(e){return ov=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ov(e)}function Ree(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&aw(e,t)}function aw(e,t){return aw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},aw(e,t)}function _y(e,t,r){return t=yL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function yL(e){var t=qee(e,"string");return yd(t)=="symbol"?t:t+""}function qee(e,t){if(yd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(yd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Fee=function(t,r,n,a,o){var s=o.x1,l=o.x2,c=o.y1,u=o.y2,d=o.xAxis,f=o.yAxis;if(!d||!f)return null;var h=Zj({x:d.scale,y:f.scale}),p={x:t?h.x.apply(s,{position:"start"}):h.x.rangeMin,y:n?h.y.apply(c,{position:"start"}):h.y.rangeMin},v={x:r?h.x.apply(l,{position:"end"}):h.x.rangeMax,y:a?h.y.apply(u,{position:"end"}):h.y.rangeMax};return As(o,"discard")&&(!h.isInRange(p)||!h.isInRange(v))?null:aL(p,v)},wy=function(e){function t(){return Tee(this,t),Dee(this,t,arguments)}return Ree(t,e),Nee(t,[{key:"render",value:function(){var n=this.props,a=n.x1,o=n.x2,s=n.y1,l=n.y2,c=n.className,u=n.alwaysShow,d=n.clipPathId;is(u===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var f=Ha(a),h=Ha(o),p=Ha(s),v=Ha(l),m=this.props.shape;if(!f&&!h&&!p&&!v&&!m)return null;var y=Fee(f,h,p,v,this.props);if(!y&&!m)return null;var b=As(this.props,"hidden")?"url(#".concat(d,")"):void 0;return Ae.createElement(cn,{className:Pr("recharts-reference-area",c)},t.renderRect(m,w4(w4({clipPath:b},gr(this.props,!0)),y)),Za.renderCallByParent(this.props,y))}}])}(Ae.Component);_y(wy,"displayName","ReferenceArea");_y(wy,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});_y(wy,"renderRect",function(e,t){var r;return Ae.isValidElement(e)?r=Ae.cloneElement(e,t):Tr(e)?r=e(t):r=Ae.createElement(Jj,nw({},t,{className:"recharts-reference-area-rect"})),r});function xL(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],a=0;a<e.length;a+=t)n.push(e[a]);return n}function $ee(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return HZ(n,r)}function Bee(e,t,r){var n=r==="width",a=e.x,o=e.y,s=e.width,l=e.height;return t===1?{start:n?a:o,end:n?a+s:o+l}:{start:n?a+s:o+l,end:n?a:o}}function sv(e,t,r,n,a){if(e*t<e*n||e*t>e*a)return!1;var o=r();return e*(t-e*o/2-n)>=0&&e*(t+e*o/2-a)<=0}function Uee(e,t){return xL(e,t+1)}function zee(e,t,r,n,a){for(var o=(n||[]).slice(),s=t.start,l=t.end,c=0,u=1,d=s,f=function(){var v=n?.[c];if(v===void 0)return{v:xL(n,u)};var m=c,y,b=function(){return y===void 0&&(y=r(v,m)),y},_=v.coordinate,w=c===0||sv(e,_,b,d,l);w||(c=0,d=s,u+=1),w&&(d=_+e*(b()/2+a),c+=u)},h;u<=o.length;)if(h=f(),h)return h.v;return[]}function wp(e){"@babel/helpers - typeof";return wp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wp(e)}function j4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function yi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?j4(Object(r),!0).forEach(function(n){Wee(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Wee(e,t,r){return t=Hee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Hee(e){var t=Vee(e,"string");return wp(t)=="symbol"?t:t+""}function Vee(e,t){if(wp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(wp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Gee(e,t,r,n,a){for(var o=(n||[]).slice(),s=o.length,l=t.start,c=t.end,u=function(h){var p=o[h],v,m=function(){return v===void 0&&(v=r(p,h)),v};if(h===s-1){var y=e*(p.coordinate+e*m()/2-c);o[h]=p=yi(yi({},p),{},{tickCoord:y>0?p.coordinate-y*e:p.coordinate})}else o[h]=p=yi(yi({},p),{},{tickCoord:p.coordinate});var b=sv(e,p.tickCoord,m,l,c);b&&(c=p.tickCoord-e*(m()/2+a),o[h]=yi(yi({},p),{},{isShow:!0}))},d=s-1;d>=0;d--)u(d);return o}function Yee(e,t,r,n,a,o){var s=(n||[]).slice(),l=s.length,c=t.start,u=t.end;if(o){var d=n[l-1],f=r(d,l-1),h=e*(d.coordinate+e*f/2-u);s[l-1]=d=yi(yi({},d),{},{tickCoord:h>0?d.coordinate-h*e:d.coordinate});var p=sv(e,d.tickCoord,function(){return f},c,u);p&&(u=d.tickCoord-e*(f/2+a),s[l-1]=yi(yi({},d),{},{isShow:!0}))}for(var v=o?l-1:l,m=function(_){var w=s[_],A,P=function(){return A===void 0&&(A=r(w,_)),A};if(_===0){var E=e*(w.coordinate-e*P()/2-c);s[_]=w=yi(yi({},w),{},{tickCoord:E<0?w.coordinate-E*e:w.coordinate})}else s[_]=w=yi(yi({},w),{},{tickCoord:w.coordinate});var T=sv(e,w.tickCoord,P,c,u);T&&(c=w.tickCoord+e*(P()/2+a),s[_]=yi(yi({},w),{},{isShow:!0}))},y=0;y<v;y++)m(y);return s}function oS(e,t,r){var n=e.tick,a=e.ticks,o=e.viewBox,s=e.minTickGap,l=e.orientation,c=e.interval,u=e.tickFormatter,d=e.unit,f=e.angle;if(!a||!a.length||!n)return[];if(Dt(c)||iu.isSsr)return Uee(a,typeof c=="number"&&Dt(c)?c:0);var h=[],p=l==="top"||l==="bottom"?"width":"height",v=d&&p==="width"?kh(d,{fontSize:t,letterSpacing:r}):{width:0,height:0},m=function(w,A){var P=Tr(u)?u(w.value,A):w.value;return p==="width"?$ee(kh(P,{fontSize:t,letterSpacing:r}),v,f):kh(P,{fontSize:t,letterSpacing:r})[p]},y=a.length>=2?Mi(a[1].coordinate-a[0].coordinate):1,b=Bee(o,y,p);return c==="equidistantPreserveStart"?zee(y,b,m,a,s):(c==="preserveStart"||c==="preserveStartEnd"?h=Yee(y,b,m,a,s,c==="preserveStartEnd"):h=Gee(y,b,m,a,s),h.filter(function(_){return _.isShow}))}var Kee=["viewBox"],Qee=["viewBox"],Xee=["ticks"];function xd(e){"@babel/helpers - typeof";return xd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xd(e)}function Mu(){return Mu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Mu.apply(this,arguments)}function S4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ni(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?S4(Object(r),!0).forEach(function(n){sS(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function i2(e,t){if(e==null)return{};var r=Jee(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Jee(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Zee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C4(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_L(n.key),n)}}function ete(e,t,r){return t&&C4(e.prototype,t),r&&C4(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function tte(e,t,r){return t=lv(t),rte(e,bL()?Reflect.construct(t,r||[],lv(e).constructor):t.apply(e,r))}function rte(e,t){if(t&&(xd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return nte(e)}function nte(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(bL=function(){return!!e})()}function lv(e){return lv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},lv(e)}function ate(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&iw(e,t)}function iw(e,t){return iw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},iw(e,t)}function sS(e,t,r){return t=_L(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _L(e){var t=ite(e,"string");return xd(t)=="symbol"?t:t+""}function ite(e,t){if(xd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(xd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var zd=function(e){function t(r){var n;return Zee(this,t),n=tte(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return ate(t,e),ete(t,[{key:"shouldComponentUpdate",value:function(n,a){var o=n.viewBox,s=i2(n,Kee),l=this.props,c=l.viewBox,u=i2(l,Qee);return!Hu(o,c)||!Hu(s,u)||!Hu(a,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var a=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];a&&this.setState({fontSize:window.getComputedStyle(a).fontSize,letterSpacing:window.getComputedStyle(a).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var a=this.props,o=a.x,s=a.y,l=a.width,c=a.height,u=a.orientation,d=a.tickSize,f=a.mirror,h=a.tickMargin,p,v,m,y,b,_,w=f?-1:1,A=n.tickSize||d,P=Dt(n.tickCoord)?n.tickCoord:n.coordinate;switch(u){case"top":p=v=n.coordinate,y=s+ +!f*c,m=y-w*A,_=m-w*h,b=P;break;case"left":m=y=n.coordinate,v=o+ +!f*l,p=v-w*A,b=p-w*h,_=P;break;case"right":m=y=n.coordinate,v=o+ +f*l,p=v+w*A,b=p+w*h,_=P;break;default:p=v=n.coordinate,y=s+ +f*c,m=y+w*A,_=m+w*h,b=P;break}return{line:{x1:p,y1:m,x2:v,y2:y},tick:{x:b,y:_}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,a=n.orientation,o=n.mirror,s;switch(a){case"left":s=o?"start":"end";break;case"right":s=o?"end":"start";break;default:s="middle";break}return s}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,a=n.orientation,o=n.mirror,s="end";switch(a){case"left":case"right":s="middle";break;case"top":s=o?"start":"end";break;default:s=o?"end":"start";break}return s}},{key:"renderAxisLine",value:function(){var n=this.props,a=n.x,o=n.y,s=n.width,l=n.height,c=n.orientation,u=n.mirror,d=n.axisLine,f=Ni(Ni(Ni({},gr(this.props,!1)),gr(d,!1)),{},{fill:"none"});if(c==="top"||c==="bottom"){var h=+(c==="top"&&!u||c==="bottom"&&u);f=Ni(Ni({},f),{},{x1:a,y1:o+h*l,x2:a+s,y2:o+h*l})}else{var p=+(c==="left"&&!u||c==="right"&&u);f=Ni(Ni({},f),{},{x1:a+p*s,y1:o,x2:a+p*s,y2:o+l})}return Ae.createElement("line",Mu({},f,{className:Pr("recharts-cartesian-axis-line",Co(d,"className"))}))}},{key:"renderTicks",value:function(n,a,o){var s=this,l=this.props,c=l.tickLine,u=l.stroke,d=l.tick,f=l.tickFormatter,h=l.unit,p=oS(Ni(Ni({},this.props),{},{ticks:n}),a,o),v=this.getTickTextAnchor(),m=this.getTickVerticalAnchor(),y=gr(this.props,!1),b=gr(d,!1),_=Ni(Ni({},y),{},{fill:"none"},gr(c,!1)),w=p.map(function(A,P){var E=s.getTickLineCoord(A),T=E.line,S=E.tick,I=Ni(Ni(Ni(Ni({textAnchor:v,verticalAnchor:m},y),{},{stroke:"none",fill:u},b),S),{},{index:P,payload:A,visibleTicksCount:p.length,tickFormatter:f});return Ae.createElement(cn,Mu({className:"recharts-cartesian-axis-tick",key:"tick-".concat(A.value,"-").concat(A.coordinate,"-").concat(A.tickCoord)},Yc(s.props,A,P)),c&&Ae.createElement("line",Mu({},_,T,{className:Pr("recharts-cartesian-axis-tick-line",Co(c,"className"))})),d&&t.renderTickItem(d,I,"".concat(Tr(f)?f(A.value,P):A.value).concat(h||"")))});return Ae.createElement("g",{className:"recharts-cartesian-axis-ticks"},w)}},{key:"render",value:function(){var n=this,a=this.props,o=a.axisLine,s=a.width,l=a.height,c=a.ticksGenerator,u=a.className,d=a.hide;if(d)return null;var f=this.props,h=f.ticks,p=i2(f,Xee),v=h;return Tr(c)&&(v=h&&h.length>0?c(this.props):c(p)),s<=0||l<=0||!v||!v.length?null:Ae.createElement(cn,{className:Pr("recharts-cartesian-axis",u),ref:function(y){n.layerReference=y}},o&&this.renderAxisLine(),this.renderTicks(v,this.state.fontSize,this.state.letterSpacing),Za.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,a,o){var s;return Ae.isValidElement(n)?s=Ae.cloneElement(n,a):Tr(n)?s=n(a):s=Ae.createElement(Kc,Mu({},a,{className:"recharts-cartesian-axis-tick-value"}),o),s}}])}(x.Component);sS(zd,"displayName","CartesianAxis");sS(zd,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var ote=["x1","y1","x2","y2","key"],ste=["offset"];function Jc(e){"@babel/helpers - typeof";return Jc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jc(e)}function A4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function xi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?A4(Object(r),!0).forEach(function(n){lte(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function lte(e,t,r){return t=cte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cte(e){var t=ute(e,"string");return Jc(t)=="symbol"?t:t+""}function ute(e,t){if(Jc(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Jc(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function qc(){return qc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qc.apply(this,arguments)}function P4(e,t){if(e==null)return{};var r=dte(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function dte(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var fte=function(t){var r=t.fill;if(!r||r==="none")return null;var n=t.fillOpacity,a=t.x,o=t.y,s=t.width,l=t.height,c=t.ry;return Ae.createElement("rect",{x:a,y:o,ry:c,width:s,height:l,stroke:"none",fill:r,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function wL(e,t){var r;if(Ae.isValidElement(e))r=Ae.cloneElement(e,t);else if(Tr(e))r=e(t);else{var n=t.x1,a=t.y1,o=t.x2,s=t.y2,l=t.key,c=P4(t,ote),u=gr(c,!1);u.offset;var d=P4(u,ste);r=Ae.createElement("line",qc({},d,{x1:n,y1:a,x2:o,y2:s,fill:"none",key:l}))}return r}function hte(e){var t=e.x,r=e.width,n=e.horizontal,a=n===void 0?!0:n,o=e.horizontalPoints;if(!a||!o||!o.length)return null;var s=o.map(function(l,c){var u=xi(xi({},e),{},{x1:t,y1:l,x2:t+r,y2:l,key:"line-".concat(c),index:c});return wL(a,u)});return Ae.createElement("g",{className:"recharts-cartesian-grid-horizontal"},s)}function pte(e){var t=e.y,r=e.height,n=e.vertical,a=n===void 0?!0:n,o=e.verticalPoints;if(!a||!o||!o.length)return null;var s=o.map(function(l,c){var u=xi(xi({},e),{},{x1:l,y1:t,x2:l,y2:t+r,key:"line-".concat(c),index:c});return wL(a,u)});return Ae.createElement("g",{className:"recharts-cartesian-grid-vertical"},s)}function mte(e){var t=e.horizontalFill,r=e.fillOpacity,n=e.x,a=e.y,o=e.width,s=e.height,l=e.horizontalPoints,c=e.horizontal,u=c===void 0?!0:c;if(!u||!t||!t.length)return null;var d=l.map(function(h){return Math.round(h+a-a)}).sort(function(h,p){return h-p});a!==d[0]&&d.unshift(0);var f=d.map(function(h,p){var v=!d[p+1],m=v?a+s-h:d[p+1]-h;if(m<=0)return null;var y=p%t.length;return Ae.createElement("rect",{key:"react-".concat(p),y:h,x:n,height:m,width:o,stroke:"none",fill:t[y],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return Ae.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},f)}function gte(e){var t=e.vertical,r=t===void 0?!0:t,n=e.verticalFill,a=e.fillOpacity,o=e.x,s=e.y,l=e.width,c=e.height,u=e.verticalPoints;if(!r||!n||!n.length)return null;var d=u.map(function(h){return Math.round(h+o-o)}).sort(function(h,p){return h-p});o!==d[0]&&d.unshift(0);var f=d.map(function(h,p){var v=!d[p+1],m=v?o+l-h:d[p+1]-h;if(m<=0)return null;var y=p%n.length;return Ae.createElement("rect",{key:"react-".concat(p),x:h,y:s,width:m,height:c,stroke:"none",fill:n[y],fillOpacity:a,className:"recharts-cartesian-grid-bg"})});return Ae.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},f)}var vte=function(t,r){var n=t.xAxis,a=t.width,o=t.height,s=t.offset;return wM(oS(xi(xi(xi({},zd.defaultProps),n),{},{ticks:sl(n,!0),viewBox:{x:0,y:0,width:a,height:o}})),s.left,s.left+s.width,r)},yte=function(t,r){var n=t.yAxis,a=t.width,o=t.height,s=t.offset;return wM(oS(xi(xi(xi({},zd.defaultProps),n),{},{ticks:sl(n,!0),viewBox:{x:0,y:0,width:a,height:o}})),s.top,s.top+s.height,r)},_u={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function cv(e){var t,r,n,a,o,s,l=rS(),c=nS(),u=iee(),d=xi(xi({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:_u.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:_u.fill,horizontal:(n=e.horizontal)!==null&&n!==void 0?n:_u.horizontal,horizontalFill:(a=e.horizontalFill)!==null&&a!==void 0?a:_u.horizontalFill,vertical:(o=e.vertical)!==null&&o!==void 0?o:_u.vertical,verticalFill:(s=e.verticalFill)!==null&&s!==void 0?s:_u.verticalFill,x:Dt(e.x)?e.x:u.left,y:Dt(e.y)?e.y:u.top,width:Dt(e.width)?e.width:u.width,height:Dt(e.height)?e.height:u.height}),f=d.x,h=d.y,p=d.width,v=d.height,m=d.syncWithTicks,y=d.horizontalValues,b=d.verticalValues,_=ree(),w=nee();if(!Dt(p)||p<=0||!Dt(v)||v<=0||!Dt(f)||f!==+f||!Dt(h)||h!==+h)return null;var A=d.verticalCoordinatesGenerator||vte,P=d.horizontalCoordinatesGenerator||yte,E=d.horizontalPoints,T=d.verticalPoints;if((!E||!E.length)&&Tr(P)){var S=y&&y.length,I=P({yAxis:w?xi(xi({},w),{},{ticks:S?y:w.ticks}):void 0,width:l,height:c,offset:u},S?!0:m);is(Array.isArray(I),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Jc(I),"]")),Array.isArray(I)&&(E=I)}if((!T||!T.length)&&Tr(A)){var U=b&&b.length,O=A({xAxis:_?xi(xi({},_),{},{ticks:U?b:_.ticks}):void 0,width:l,height:c,offset:u},U?!0:m);is(Array.isArray(O),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Jc(O),"]")),Array.isArray(O)&&(T=O)}return Ae.createElement("g",{className:"recharts-cartesian-grid"},Ae.createElement(fte,{fill:d.fill,fillOpacity:d.fillOpacity,x:d.x,y:d.y,width:d.width,height:d.height,ry:d.ry}),Ae.createElement(hte,qc({},d,{offset:u,horizontalPoints:E,xAxis:_,yAxis:w})),Ae.createElement(pte,qc({},d,{offset:u,verticalPoints:T,xAxis:_,yAxis:w})),Ae.createElement(mte,qc({},d,{horizontalPoints:E})),Ae.createElement(gte,qc({},d,{verticalPoints:T})))}cv.displayName="CartesianGrid";var xte=["type","layout","connectNulls","ref"],bte=["key"];function bd(e){"@babel/helpers - typeof";return bd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bd(e)}function O4(e,t){if(e==null)return{};var r=_te(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function _te(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Mh(){return Mh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Mh.apply(this,arguments)}function k4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function go(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?k4(Object(r),!0).forEach(function(n){ns(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wu(e){return Cte(e)||Ste(e)||jte(e)||wte()}function wte(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jte(e,t){if(e){if(typeof e=="string")return ow(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ow(e,t)}}function Ste(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Cte(e){if(Array.isArray(e))return ow(e)}function ow(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ate(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E4(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,SL(n.key),n)}}function Pte(e,t,r){return t&&E4(e.prototype,t),r&&E4(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ote(e,t,r){return t=uv(t),kte(e,jL()?Reflect.construct(t,r||[],uv(e).constructor):t.apply(e,r))}function kte(e,t){if(t&&(bd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ete(e)}function Ete(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(jL=function(){return!!e})()}function uv(e){return uv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},uv(e)}function Tte(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&sw(e,t)}function sw(e,t){return sw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},sw(e,t)}function ns(e,t,r){return t=SL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SL(e){var t=Ite(e,"string");return bd(t)=="symbol"?t:t+""}function Ite(e,t){if(bd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(bd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var zp=function(e){function t(){var r;Ate(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return r=Ote(this,t,[].concat(a)),ns(r,"state",{isAnimationFinished:!0,totalLength:0}),ns(r,"generateSimpleStrokeDasharray",function(s,l){return"".concat(l,"px ").concat(s-l,"px")}),ns(r,"getStrokeDasharray",function(s,l,c){var u=c.reduce(function(b,_){return b+_});if(!u)return r.generateSimpleStrokeDasharray(l,s);for(var d=Math.floor(s/u),f=s%u,h=l-s,p=[],v=0,m=0;v<c.length;m+=c[v],++v)if(m+c[v]>f){p=[].concat(wu(c.slice(0,v)),[f-m]);break}var y=p.length%2===0?[0,h]:[h];return[].concat(wu(t.repeat(c,d)),wu(p),y).map(function(b){return"".concat(b,"px")}).join(", ")}),ns(r,"id",qd("recharts-line-")),ns(r,"pathRef",function(s){r.mainCurve=s}),ns(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),ns(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return Tte(t,e),Pte(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,s=o.points,l=o.xAxis,c=o.yAxis,u=o.layout,d=o.children,f=Ao(d,Up);if(!f)return null;var h=function(m,y){return{x:m.x,y:m.y,value:m.value,errorVal:Wa(m.payload,y)}},p={clipPath:n?"url(#clipPath-".concat(a,")"):null};return Ae.createElement(cn,p,f.map(function(v){return Ae.cloneElement(v,{key:"bar-".concat(v.props.dataKey),data:s,xAxis:l,yAxis:c,layout:u,dataPointFormatter:h})}))}},{key:"renderDots",value:function(n,a,o){var s=this.props.isAnimationActive;if(s&&!this.state.isAnimationFinished)return null;var l=this.props,c=l.dot,u=l.points,d=l.dataKey,f=gr(this.props,!1),h=gr(c,!0),p=u.map(function(m,y){var b=go(go(go({key:"dot-".concat(y),r:3},f),h),{},{index:y,cx:m.x,cy:m.y,value:m.value,dataKey:d,payload:m.payload,points:u});return t.renderDotItem(c,b)}),v={clipPath:n?"url(#clipPath-".concat(a?"":"dots-").concat(o,")"):null};return Ae.createElement(cn,Mh({className:"recharts-line-dots",key:"dots"},v),p)}},{key:"renderCurveStatically",value:function(n,a,o,s){var l=this.props,c=l.type,u=l.layout,d=l.connectNulls;l.ref;var f=O4(l,xte),h=go(go(go({},gr(f,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:a?"url(#clipPath-".concat(o,")"):null,points:n},s),{},{type:c,layout:u,connectNulls:d});return Ae.createElement(zg,Mh({},h,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,a){var o=this,s=this.props,l=s.points,c=s.strokeDasharray,u=s.isAnimationActive,d=s.animationBegin,f=s.animationDuration,h=s.animationEasing,p=s.animationId,v=s.animateNewValues,m=s.width,y=s.height,b=this.state,_=b.prevPoints,w=b.totalLength;return Ae.createElement(Es,{begin:d,duration:f,isActive:u,easing:h,from:{t:0},to:{t:1},key:"line-".concat(p),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(A){var P=A.t;if(_){var E=_.length/l.length,T=l.map(function(M,L){var q=Math.floor(L*E);if(_[q]){var z=_[q],K=_o(z.x,M.x),J=_o(z.y,M.y);return go(go({},M),{},{x:K(P),y:J(P)})}if(v){var R=_o(m*2,M.x),k=_o(y/2,M.y);return go(go({},M),{},{x:R(P),y:k(P)})}return go(go({},M),{},{x:M.x,y:M.y})});return o.renderCurveStatically(T,n,a)}var S=_o(0,w),I=S(P),U;if(c){var O="".concat(c).split(/[,\s]+/gim).map(function(M){return parseFloat(M)});U=o.getStrokeDasharray(I,w,O)}else U=o.generateSimpleStrokeDasharray(w,I);return o.renderCurveStatically(l,n,a,{strokeDasharray:U})})}},{key:"renderCurve",value:function(n,a){var o=this.props,s=o.points,l=o.isAnimationActive,c=this.state,u=c.prevPoints,d=c.totalLength;return l&&s&&s.length&&(!u&&d>0||!Bp(u,s))?this.renderCurveWithAnimation(n,a):this.renderCurveStatically(s,n,a)}},{key:"render",value:function(){var n,a=this.props,o=a.hide,s=a.dot,l=a.points,c=a.className,u=a.xAxis,d=a.yAxis,f=a.top,h=a.left,p=a.width,v=a.height,m=a.isAnimationActive,y=a.id;if(o||!l||!l.length)return null;var b=this.state.isAnimationFinished,_=l.length===1,w=Pr("recharts-line",c),A=u&&u.allowDataOverflow,P=d&&d.allowDataOverflow,E=A||P,T=Fr(y)?this.id:y,S=(n=gr(s,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},I=S.r,U=I===void 0?3:I,O=S.strokeWidth,M=O===void 0?2:O,L=mB(s)?s:{},q=L.clipDot,z=q===void 0?!0:q,K=U*2+M;return Ae.createElement(cn,{className:w},A||P?Ae.createElement("defs",null,Ae.createElement("clipPath",{id:"clipPath-".concat(T)},Ae.createElement("rect",{x:A?h:h-p/2,y:P?f:f-v/2,width:A?p:p*2,height:P?v:v*2})),!z&&Ae.createElement("clipPath",{id:"clipPath-dots-".concat(T)},Ae.createElement("rect",{x:h-K/2,y:f-K/2,width:p+K,height:v+K}))):null,!_&&this.renderCurve(E,T),this.renderErrorBar(E,T),(_||s)&&this.renderDots(E,z,T),(!m||b)&&fl.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:a.curPoints}:n.points!==a.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,a){for(var o=n.length%2!==0?[].concat(wu(n),[0]):n,s=[],l=0;l<a;++l)s=[].concat(wu(s),wu(o));return s}},{key:"renderDotItem",value:function(n,a){var o;if(Ae.isValidElement(n))o=Ae.cloneElement(n,a);else if(Tr(n))o=n(a);else{var s=a.key,l=O4(a,bte),c=Pr("recharts-line-dot",typeof n!="boolean"?n.className:"");o=Ae.createElement(dy,Mh({key:s},l,{className:c}))}return o}}])}(x.PureComponent);ns(zp,"displayName","Line");ns(zp,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!iu.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});ns(zp,"getComposedData",function(e){var t=e.props,r=e.xAxis,n=e.yAxis,a=e.xAxisTicks,o=e.yAxisTicks,s=e.dataKey,l=e.bandSize,c=e.displayedData,u=e.offset,d=t.layout,f=c.map(function(h,p){var v=Wa(h,s);return d==="horizontal"?{x:Mk({axis:r,ticks:a,bandSize:l,entry:h,index:p}),y:Fr(v)?null:n.scale(v),value:v,payload:h}:{x:Fr(v)?null:r.scale(v),y:Mk({axis:n,ticks:o,bandSize:l,entry:h,index:p}),value:v,payload:h}});return go({points:f,layout:d},u)});function _d(e){"@babel/helpers - typeof";return _d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_d(e)}function Nte(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Dte(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,PL(n.key),n)}}function Mte(e,t,r){return t&&Dte(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Lte(e,t,r){return t=dv(t),Rte(e,CL()?Reflect.construct(t,r||[],dv(e).constructor):t.apply(e,r))}function Rte(e,t){if(t&&(_d(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return qte(e)}function qte(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function CL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(CL=function(){return!!e})()}function dv(e){return dv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},dv(e)}function Fte(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&lw(e,t)}function lw(e,t){return lw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},lw(e,t)}function AL(e,t,r){return t=PL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function PL(e){var t=$te(e,"string");return _d(t)=="symbol"?t:t+""}function $te(e,t){if(_d(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(_d(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function cw(){return cw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},cw.apply(this,arguments)}function Bte(e){var t=e.xAxisId,r=rS(),n=nS(),a=dL(t);return a==null?null:Ae.createElement(zd,cw({},a,{className:Pr("recharts-".concat(a.axisType," ").concat(a.axisType),a.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(s){return sl(s,!0)}}))}var Zc=function(e){function t(){return Nte(this,t),Lte(this,t,arguments)}return Fte(t,e),Mte(t,[{key:"render",value:function(){return Ae.createElement(Bte,this.props)}}])}(Ae.Component);AL(Zc,"displayName","XAxis");AL(Zc,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function wd(e){"@babel/helpers - typeof";return wd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wd(e)}function Ute(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function zte(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,EL(n.key),n)}}function Wte(e,t,r){return t&&zte(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Hte(e,t,r){return t=fv(t),Vte(e,OL()?Reflect.construct(t,r||[],fv(e).constructor):t.apply(e,r))}function Vte(e,t){if(t&&(wd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Gte(e)}function Gte(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function OL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(OL=function(){return!!e})()}function fv(e){return fv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},fv(e)}function Yte(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&uw(e,t)}function uw(e,t){return uw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},uw(e,t)}function kL(e,t,r){return t=EL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function EL(e){var t=Kte(e,"string");return wd(t)=="symbol"?t:t+""}function Kte(e,t){if(wd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(wd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function dw(){return dw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},dw.apply(this,arguments)}var Qte=function(t){var r=t.yAxisId,n=rS(),a=nS(),o=fL(r);return o==null?null:Ae.createElement(zd,dw({},o,{className:Pr("recharts-".concat(o.axisType," ").concat(o.axisType),o.className),viewBox:{x:0,y:0,width:n,height:a},ticksGenerator:function(l){return sl(l,!0)}}))},eu=function(e){function t(){return Ute(this,t),Hte(this,t,arguments)}return Yte(t,e),Wte(t,[{key:"render",value:function(){return Ae.createElement(Qte,this.props)}}])}(Ae.Component);kL(eu,"displayName","YAxis");kL(eu,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function T4(e){return ere(e)||Zte(e)||Jte(e)||Xte()}function Xte(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Jte(e,t){if(e){if(typeof e=="string")return fw(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fw(e,t)}}function Zte(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ere(e){if(Array.isArray(e))return fw(e)}function fw(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var hw=function(t,r,n,a,o){var s=Ao(t,iS),l=Ao(t,by),c=[].concat(T4(s),T4(l)),u=Ao(t,wy),d="".concat(a,"Id"),f=a[0],h=r;if(c.length&&(h=c.reduce(function(m,y){if(y.props[d]===n&&As(y.props,"extendDomain")&&Dt(y.props[f])){var b=y.props[f];return[Math.min(m[0],b),Math.max(m[1],b)]}return m},h)),u.length){var p="".concat(f,"1"),v="".concat(f,"2");h=u.reduce(function(m,y){if(y.props[d]===n&&As(y.props,"extendDomain")&&Dt(y.props[p])&&Dt(y.props[v])){var b=y.props[p],_=y.props[v];return[Math.min(m[0],b,_),Math.max(m[1],b,_)]}return m},h)}return o&&o.length&&(h=o.reduce(function(m,y){return Dt(y)?[Math.min(m[0],y),Math.max(m[1],y)]:m},h)),h},o2={exports:{}},I4;function tre(){return I4||(I4=1,function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function a(c,u,d){this.fn=c,this.context=u,this.once=d||!1}function o(c,u,d,f,h){if(typeof d!="function")throw new TypeError("The listener must be a function");var p=new a(d,f||c,h),v=r?r+u:u;return c._events[v]?c._events[v].fn?c._events[v]=[c._events[v],p]:c._events[v].push(p):(c._events[v]=p,c._eventsCount++),c}function s(c,u){--c._eventsCount===0?c._events=new n:delete c._events[u]}function l(){this._events=new n,this._eventsCount=0}l.prototype.eventNames=function(){var u=[],d,f;if(this._eventsCount===0)return u;for(f in d=this._events)t.call(d,f)&&u.push(r?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(d)):u},l.prototype.listeners=function(u){var d=r?r+u:u,f=this._events[d];if(!f)return[];if(f.fn)return[f.fn];for(var h=0,p=f.length,v=new Array(p);h<p;h++)v[h]=f[h].fn;return v},l.prototype.listenerCount=function(u){var d=r?r+u:u,f=this._events[d];return f?f.fn?1:f.length:0},l.prototype.emit=function(u,d,f,h,p,v){var m=r?r+u:u;if(!this._events[m])return!1;var y=this._events[m],b=arguments.length,_,w;if(y.fn){switch(y.once&&this.removeListener(u,y.fn,void 0,!0),b){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,d),!0;case 3:return y.fn.call(y.context,d,f),!0;case 4:return y.fn.call(y.context,d,f,h),!0;case 5:return y.fn.call(y.context,d,f,h,p),!0;case 6:return y.fn.call(y.context,d,f,h,p,v),!0}for(w=1,_=new Array(b-1);w<b;w++)_[w-1]=arguments[w];y.fn.apply(y.context,_)}else{var A=y.length,P;for(w=0;w<A;w++)switch(y[w].once&&this.removeListener(u,y[w].fn,void 0,!0),b){case 1:y[w].fn.call(y[w].context);break;case 2:y[w].fn.call(y[w].context,d);break;case 3:y[w].fn.call(y[w].context,d,f);break;case 4:y[w].fn.call(y[w].context,d,f,h);break;default:if(!_)for(P=1,_=new Array(b-1);P<b;P++)_[P-1]=arguments[P];y[w].fn.apply(y[w].context,_)}}return!0},l.prototype.on=function(u,d,f){return o(this,u,d,f,!1)},l.prototype.once=function(u,d,f){return o(this,u,d,f,!0)},l.prototype.removeListener=function(u,d,f,h){var p=r?r+u:u;if(!this._events[p])return this;if(!d)return s(this,p),this;var v=this._events[p];if(v.fn)v.fn===d&&(!h||v.once)&&(!f||v.context===f)&&s(this,p);else{for(var m=0,y=[],b=v.length;m<b;m++)(v[m].fn!==d||h&&!v[m].once||f&&v[m].context!==f)&&y.push(v[m]);y.length?this._events[p]=y.length===1?y[0]:y:s(this,p)}return this},l.prototype.removeAllListeners=function(u){var d;return u?(d=r?r+u:u,this._events[d]&&s(this,d)):(this._events=new n,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=r,l.EventEmitter=l,e.exports=l}(o2)),o2.exports}var rre=tre();const nre=Et(rre);var s2=new nre,l2="recharts.syncMouseEvents";function jp(e){"@babel/helpers - typeof";return jp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jp(e)}function are(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ire(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,TL(n.key),n)}}function ore(e,t,r){return t&&ire(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function c2(e,t,r){return t=TL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function TL(e){var t=sre(e,"string");return jp(t)=="symbol"?t:t+""}function sre(e,t){if(jp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(jp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var lre=function(){function e(){are(this,e),c2(this,"activeIndex",0),c2(this,"coordinateList",[]),c2(this,"layout","horizontal")}return ore(e,[{key:"setDetails",value:function(r){var n,a=r.coordinateList,o=a===void 0?null:a,s=r.container,l=s===void 0?null:s,c=r.layout,u=c===void 0?null:c,d=r.offset,f=d===void 0?null:d,h=r.mouseHandlerCallback,p=h===void 0?null:h;this.coordinateList=(n=o??this.coordinateList)!==null&&n!==void 0?n:[],this.container=l??this.container,this.layout=u??this.layout,this.offset=f??this.offset,this.mouseHandlerCallback=p??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var a=this.container.getBoundingClientRect(),o=a.x,s=a.y,l=a.height,c=this.coordinateList[this.activeIndex].coordinate,u=((r=window)===null||r===void 0?void 0:r.scrollX)||0,d=((n=window)===null||n===void 0?void 0:n.scrollY)||0,f=o+c+u,h=s+this.offset.top+l/2+d;this.mouseHandlerCallback({pageX:f,pageY:h})}}}])}();function cre(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e?.[0],a=e?.[1];if(n&&a&&Dt(n)&&Dt(a))return!0}return!1}function ure(e,t,r,n){var a=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-a:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-a,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function IL(e){var t=e.cx,r=e.cy,n=e.radius,a=e.startAngle,o=e.endAngle,s=Fn(t,r,n,a),l=Fn(t,r,n,o);return{points:[s,l],cx:t,cy:r,radius:n,startAngle:a,endAngle:o}}function dre(e,t,r){var n,a,o,s;if(e==="horizontal")n=t.x,o=n,a=r.top,s=r.top+r.height;else if(e==="vertical")a=t.y,s=a,n=r.left,o=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var l=t.cx,c=t.cy,u=t.innerRadius,d=t.outerRadius,f=t.angle,h=Fn(l,c,u,f),p=Fn(l,c,d,f);n=h.x,a=h.y,o=p.x,s=p.y}else return IL(t);return[{x:n,y:a},{x:o,y:s}]}function Sp(e){"@babel/helpers - typeof";return Sp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sp(e)}function N4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Pm(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?N4(Object(r),!0).forEach(function(n){fre(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function fre(e,t,r){return t=hre(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hre(e){var t=pre(e,"string");return Sp(t)=="symbol"?t:t+""}function pre(e,t){if(Sp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Sp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function mre(e){var t,r,n=e.element,a=e.tooltipEventType,o=e.isActive,s=e.activeCoordinate,l=e.activePayload,c=e.offset,u=e.activeTooltipIndex,d=e.tooltipAxisBandSize,f=e.layout,h=e.chartName,p=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!p||!o||!s||h!=="ScatterChart"&&a!=="axis")return null;var v,m=zg;if(h==="ScatterChart")v=s,m=RX;else if(h==="BarChart")v=ure(f,s,c,d),m=Jj;else if(f==="radial"){var y=IL(s),b=y.cx,_=y.cy,w=y.radius,A=y.startAngle,P=y.endAngle;v={cx:b,cy:_,startAngle:A,endAngle:P,innerRadius:w,outerRadius:w},m=NM}else v={points:dre(f,s,c)},m=zg;var E=Pm(Pm(Pm(Pm({stroke:"#ccc",pointerEvents:"none"},c),v),gr(p,!1)),{},{payload:l,payloadIndex:u,className:Pr("recharts-tooltip-cursor",p.className)});return x.isValidElement(p)?x.cloneElement(p,E):x.createElement(m,E)}var gre=["item"],vre=["children","className","width","height","style","compact","title","desc"];function jd(e){"@babel/helpers - typeof";return jd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jd(e)}function Lu(){return Lu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Lu.apply(this,arguments)}function D4(e,t){return bre(e)||xre(e,t)||DL(e,t)||yre()}function yre(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xre(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function bre(e){if(Array.isArray(e))return e}function M4(e,t){if(e==null)return{};var r=_re(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function _re(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function wre(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function jre(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ML(n.key),n)}}function Sre(e,t,r){return t&&jre(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Cre(e,t,r){return t=hv(t),Are(e,NL()?Reflect.construct(t,r||[],hv(e).constructor):t.apply(e,r))}function Are(e,t){if(t&&(jd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Pre(e)}function Pre(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function NL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(NL=function(){return!!e})()}function hv(e){return hv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},hv(e)}function Ore(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pw(e,t)}function pw(e,t){return pw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},pw(e,t)}function Sd(e){return Tre(e)||Ere(e)||DL(e)||kre()}function kre(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DL(e,t){if(e){if(typeof e=="string")return mw(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mw(e,t)}}function Ere(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Tre(e){if(Array.isArray(e))return mw(e)}function mw(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function L4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ft(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?L4(Object(r),!0).forEach(function(n){xr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xr(e,t,r){return t=ML(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ML(e){var t=Ire(e,"string");return jd(t)=="symbol"?t:t+""}function Ire(e,t){if(jd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(jd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Nre={xAxis:["bottom","top"],yAxis:["left","right"]},Dre={width:"100%",height:"100%"},LL={x:0,y:0};function Om(e){return e}var Mre=function(t,r){return r==="horizontal"?t.x:r==="vertical"?t.y:r==="centric"?t.angle:t.radius},Lre=function(t,r,n,a){var o=r.find(function(d){return d&&d.index===n});if(o){if(t==="horizontal")return{x:o.coordinate,y:a.y};if(t==="vertical")return{x:a.x,y:o.coordinate};if(t==="centric"){var s=o.coordinate,l=a.radius;return ft(ft(ft({},a),Fn(a.cx,a.cy,l,s)),{},{angle:s,radius:l})}var c=o.coordinate,u=a.angle;return ft(ft(ft({},a),Fn(a.cx,a.cy,c,u)),{},{angle:u,radius:c})}return LL},jy=function(t,r){var n=r.graphicalItems,a=r.dataStartIndex,o=r.dataEndIndex,s=(n??[]).reduce(function(l,c){var u=c.props.data;return u&&u.length?[].concat(Sd(l),Sd(u)):l},[]);return s.length>0?s:t&&t.length&&Dt(a)&&Dt(o)?t.slice(a,o+1):[]};function RL(e){return e==="number"?[0,"auto"]:void 0}var gw=function(t,r,n,a){var o=t.graphicalItems,s=t.tooltipAxis,l=jy(r,t);return n<0||!o||!o.length||n>=l.length?null:o.reduce(function(c,u){var d,f=(d=u.props.data)!==null&&d!==void 0?d:r;f&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=n&&(f=f.slice(t.dataStartIndex,t.dataEndIndex+1));var h;if(s.dataKey&&!s.allowDuplicatedCategory){var p=f===void 0?l:f;h=mg(p,s.dataKey,a)}else h=f&&f[n]||l[n];return h?[].concat(Sd(c),[PM(u,h)]):c},[])},R4=function(t,r,n,a){var o=a||{x:t.chartX,y:t.chartY},s=Mre(o,n),l=t.orderedTooltipTicks,c=t.tooltipAxis,u=t.tooltipTicks,d=fY(s,l,u,c);if(d>=0&&u){var f=u[d]&&u[d].value,h=gw(t,r,d,f),p=Lre(n,l,d,o);return{activeTooltipIndex:d,activeLabel:f,activePayload:h,activeCoordinate:p}}return null},Rre=function(t,r){var n=r.axes,a=r.graphicalItems,o=r.axisType,s=r.axisIdKey,l=r.stackGroups,c=r.dataStartIndex,u=r.dataEndIndex,d=t.layout,f=t.children,h=t.stackOffset,p=_M(d,o);return n.reduce(function(v,m){var y,b=m.type.defaultProps!==void 0?ft(ft({},m.type.defaultProps),m.props):m.props,_=b.type,w=b.dataKey,A=b.allowDataOverflow,P=b.allowDuplicatedCategory,E=b.scale,T=b.ticks,S=b.includeHidden,I=b[s];if(v[I])return v;var U=jy(t.data,{graphicalItems:a.filter(function(C){var N,H=s in C.props?C.props[s]:(N=C.type.defaultProps)===null||N===void 0?void 0:N[s];return H===I}),dataStartIndex:c,dataEndIndex:u}),O=U.length,M,L,q;cre(b.domain,A,_)&&(M=E_(b.domain,null,A),p&&(_==="number"||E!=="auto")&&(q=Th(U,w,"category")));var z=RL(_);if(!M||M.length===0){var K,J=(K=b.domain)!==null&&K!==void 0?K:z;if(w){if(M=Th(U,w,_),_==="category"&&p){var R=iB(M);P&&R?(L=M,M=Zg(0,O)):P||(M=Fk(J,M,m).reduce(function(C,N){return C.indexOf(N)>=0?C:[].concat(Sd(C),[N])},[]))}else if(_==="category")P?M=M.filter(function(C){return C!==""&&!Fr(C)}):M=Fk(J,M,m).reduce(function(C,N){return C.indexOf(N)>=0||N===""||Fr(N)?C:[].concat(Sd(C),[N])},[]);else if(_==="number"){var k=vY(U,a.filter(function(C){var N,H,W=s in C.props?C.props[s]:(N=C.type.defaultProps)===null||N===void 0?void 0:N[s],ne="hide"in C.props?C.props.hide:(H=C.type.defaultProps)===null||H===void 0?void 0:H.hide;return W===I&&(S||!ne)}),w,o,d);k&&(M=k)}p&&(_==="number"||E!=="auto")&&(q=Th(U,w,"category"))}else p?M=Zg(0,O):l&&l[I]&&l[I].hasStack&&_==="number"?M=h==="expand"?[0,1]:AM(l[I].stackGroups,c,u):M=bM(U,a.filter(function(C){var N=s in C.props?C.props[s]:C.type.defaultProps[s],H="hide"in C.props?C.props.hide:C.type.defaultProps.hide;return N===I&&(S||!H)}),_,d,!0);if(_==="number")M=hw(f,M,I,o,T),J&&(M=E_(J,M,A));else if(_==="category"&&J){var $=J,X=M.every(function(C){return $.indexOf(C)>=0});X&&(M=$)}}return ft(ft({},v),{},xr({},I,ft(ft({},b),{},{axisType:o,domain:M,categoricalDomain:q,duplicateDomain:L,originalDomain:(y=b.domain)!==null&&y!==void 0?y:z,isCategorical:p,layout:d})))},{})},qre=function(t,r){var n=r.graphicalItems,a=r.Axis,o=r.axisType,s=r.axisIdKey,l=r.stackGroups,c=r.dataStartIndex,u=r.dataEndIndex,d=t.layout,f=t.children,h=jy(t.data,{graphicalItems:n,dataStartIndex:c,dataEndIndex:u}),p=h.length,v=_M(d,o),m=-1;return n.reduce(function(y,b){var _=b.type.defaultProps!==void 0?ft(ft({},b.type.defaultProps),b.props):b.props,w=_[s],A=RL("number");if(!y[w]){m++;var P;return v?P=Zg(0,p):l&&l[w]&&l[w].hasStack?(P=AM(l[w].stackGroups,c,u),P=hw(f,P,w,o)):(P=E_(A,bM(h,n.filter(function(E){var T,S,I=s in E.props?E.props[s]:(T=E.type.defaultProps)===null||T===void 0?void 0:T[s],U="hide"in E.props?E.props.hide:(S=E.type.defaultProps)===null||S===void 0?void 0:S.hide;return I===w&&!U}),"number",d),a.defaultProps.allowDataOverflow),P=hw(f,P,w,o)),ft(ft({},y),{},xr({},w,ft(ft({axisType:o},a.defaultProps),{},{hide:!0,orientation:Co(Nre,"".concat(o,".").concat(m%2),null),domain:P,originalDomain:A,isCategorical:v,layout:d})))}return y},{})},Fre=function(t,r){var n=r.axisType,a=n===void 0?"xAxis":n,o=r.AxisComp,s=r.graphicalItems,l=r.stackGroups,c=r.dataStartIndex,u=r.dataEndIndex,d=t.children,f="".concat(a,"Id"),h=Ao(d,o),p={};return h&&h.length?p=Rre(t,{axes:h,graphicalItems:s,axisType:a,axisIdKey:f,stackGroups:l,dataStartIndex:c,dataEndIndex:u}):s&&s.length&&(p=qre(t,{Axis:o,graphicalItems:s,axisType:a,axisIdKey:f,stackGroups:l,dataStartIndex:c,dataEndIndex:u})),p},$re=function(t){var r=Vl(t),n=sl(r,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:Cj(n,function(a){return a.coordinate}),tooltipAxis:r,tooltipAxisBandSize:$g(r,n)}},q4=function(t){var r=t.children,n=t.defaultShowTooltip,a=yo(r,pd),o=0,s=0;return t.data&&t.data.length!==0&&(s=t.data.length-1),a&&a.props&&(a.props.startIndex>=0&&(o=a.props.startIndex),a.props.endIndex>=0&&(s=a.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:o,dataEndIndex:s,activeTooltipIndex:-1,isTooltipActive:!!n}},Bre=function(t){return!t||!t.length?!1:t.some(function(r){var n=ul(r&&r.type);return n&&n.indexOf("Bar")>=0})},F4=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},Ure=function(t,r){var n=t.props,a=t.graphicalItems,o=t.xAxisMap,s=o===void 0?{}:o,l=t.yAxisMap,c=l===void 0?{}:l,u=n.width,d=n.height,f=n.children,h=n.margin||{},p=yo(f,pd),v=yo(f,Ss),m=Object.keys(c).reduce(function(P,E){var T=c[E],S=T.orientation;return!T.mirror&&!T.hide?ft(ft({},P),{},xr({},S,P[S]+T.width)):P},{left:h.left||0,right:h.right||0}),y=Object.keys(s).reduce(function(P,E){var T=s[E],S=T.orientation;return!T.mirror&&!T.hide?ft(ft({},P),{},xr({},S,Co(P,"".concat(S))+T.height)):P},{top:h.top||0,bottom:h.bottom||0}),b=ft(ft({},y),m),_=b.bottom;p&&(b.bottom+=p.props.height||pd.defaultProps.height),v&&r&&(b=mY(b,a,n,r));var w=u-b.left-b.right,A=d-b.top-b.bottom;return ft(ft({brushBottom:_},b),{},{width:Math.max(w,0),height:Math.max(A,0)})},zre=function(t,r){if(r==="xAxis")return t[r].width;if(r==="yAxis")return t[r].height},lS=function(t){var r=t.chartName,n=t.GraphicalChild,a=t.defaultTooltipEventType,o=a===void 0?"axis":a,s=t.validateTooltipEventTypes,l=s===void 0?["axis"]:s,c=t.axisComponents,u=t.legendContent,d=t.formatAxisMap,f=t.defaultProps,h=function(b,_){var w=_.graphicalItems,A=_.stackGroups,P=_.offset,E=_.updateId,T=_.dataStartIndex,S=_.dataEndIndex,I=b.barSize,U=b.layout,O=b.barGap,M=b.barCategoryGap,L=b.maxBarSize,q=F4(U),z=q.numericAxisName,K=q.cateAxisName,J=Bre(w),R=[];return w.forEach(function(k,$){var X=jy(b.data,{graphicalItems:[k],dataStartIndex:T,dataEndIndex:S}),C=k.type.defaultProps!==void 0?ft(ft({},k.type.defaultProps),k.props):k.props,N=C.dataKey,H=C.maxBarSize,W=C["".concat(z,"Id")],ne=C["".concat(K,"Id")],se={},oe=c.reduce(function(it,st){var vt=_["".concat(st.axisType,"Map")],Ye=C["".concat(st.axisType,"Id")];vt&&vt[Ye]||st.axisType==="zAxis"||Xc();var Ze=vt[Ye];return ft(ft({},it),{},xr(xr({},st.axisType,Ze),"".concat(st.axisType,"Ticks"),sl(Ze)))},se),ae=oe[K],pe=oe["".concat(K,"Ticks")],ge=A&&A[W]&&A[W].hasStack&&AY(k,A[W].stackGroups),Q=ul(k.type).indexOf("Bar")>=0,G=$g(ae,pe),ee=[],le=J&&hY({barSize:I,stackGroups:A,totalSize:zre(oe,K)});if(Q){var V,Ve,Me=Fr(H)?L:H,Fe=(V=(Ve=$g(ae,pe,!0))!==null&&Ve!==void 0?Ve:Me)!==null&&V!==void 0?V:0;ee=pY({barGap:O,barCategoryGap:M,bandSize:Fe!==G?Fe:G,sizeList:le[ne],maxBarSize:Me}),Fe!==G&&(ee=ee.map(function(it){return ft(ft({},it),{},{position:ft(ft({},it.position),{},{offset:it.position.offset-Fe/2})})}))}var Qe=k&&k.type&&k.type.getComposedData;Qe&&R.push({props:ft(ft({},Qe(ft(ft({},oe),{},{displayedData:X,props:b,dataKey:N,item:k,bandSize:G,barPosition:ee,offset:P,stackedData:ge,layout:U,dataStartIndex:T,dataEndIndex:S}))),{},xr(xr(xr({key:k.key||"item-".concat($)},z,oe[z]),K,oe[K]),"animationId",E)),childIndex:yB(k,b.children),item:k})}),R},p=function(b,_){var w=b.props,A=b.dataStartIndex,P=b.dataEndIndex,E=b.updateId;if(!ZC({props:w}))return null;var T=w.children,S=w.layout,I=w.stackOffset,U=w.data,O=w.reverseStackOrder,M=F4(S),L=M.numericAxisName,q=M.cateAxisName,z=Ao(T,n),K=SY(U,z,"".concat(L,"Id"),"".concat(q,"Id"),I,O),J=c.reduce(function(C,N){var H="".concat(N.axisType,"Map");return ft(ft({},C),{},xr({},H,Fre(w,ft(ft({},N),{},{graphicalItems:z,stackGroups:N.axisType===L&&K,dataStartIndex:A,dataEndIndex:P}))))},{}),R=Ure(ft(ft({},J),{},{props:w,graphicalItems:z}),_?.legendBBox);Object.keys(J).forEach(function(C){J[C]=d(w,J[C],R,C.replace("Map",""),r)});var k=J["".concat(q,"Map")],$=$re(k),X=h(w,ft(ft({},J),{},{dataStartIndex:A,dataEndIndex:P,updateId:E,graphicalItems:z,stackGroups:K,offset:R}));return ft(ft({formattedGraphicalItems:X,graphicalItems:z,offset:R,stackGroups:K},$),J)},v=function(y){function b(_){var w,A,P;return wre(this,b),P=Cre(this,b,[_]),xr(P,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),xr(P,"accessibilityManager",new lre),xr(P,"handleLegendBBoxUpdate",function(E){if(E){var T=P.state,S=T.dataStartIndex,I=T.dataEndIndex,U=T.updateId;P.setState(ft({legendBBox:E},p({props:P.props,dataStartIndex:S,dataEndIndex:I,updateId:U},ft(ft({},P.state),{},{legendBBox:E}))))}}),xr(P,"handleReceiveSyncEvent",function(E,T,S){if(P.props.syncId===E){if(S===P.eventEmitterSymbol&&typeof P.props.syncMethod!="function")return;P.applySyncEvent(T)}}),xr(P,"handleBrushChange",function(E){var T=E.startIndex,S=E.endIndex;if(T!==P.state.dataStartIndex||S!==P.state.dataEndIndex){var I=P.state.updateId;P.setState(function(){return ft({dataStartIndex:T,dataEndIndex:S},p({props:P.props,dataStartIndex:T,dataEndIndex:S,updateId:I},P.state))}),P.triggerSyncEvent({dataStartIndex:T,dataEndIndex:S})}}),xr(P,"handleMouseEnter",function(E){var T=P.getMouseInfo(E);if(T){var S=ft(ft({},T),{},{isTooltipActive:!0});P.setState(S),P.triggerSyncEvent(S);var I=P.props.onMouseEnter;Tr(I)&&I(S,E)}}),xr(P,"triggeredAfterMouseMove",function(E){var T=P.getMouseInfo(E),S=T?ft(ft({},T),{},{isTooltipActive:!0}):{isTooltipActive:!1};P.setState(S),P.triggerSyncEvent(S);var I=P.props.onMouseMove;Tr(I)&&I(S,E)}),xr(P,"handleItemMouseEnter",function(E){P.setState(function(){return{isTooltipActive:!0,activeItem:E,activePayload:E.tooltipPayload,activeCoordinate:E.tooltipPosition||{x:E.cx,y:E.cy}}})}),xr(P,"handleItemMouseLeave",function(){P.setState(function(){return{isTooltipActive:!1}})}),xr(P,"handleMouseMove",function(E){E.persist(),P.throttleTriggeredAfterMouseMove(E)}),xr(P,"handleMouseLeave",function(E){P.throttleTriggeredAfterMouseMove.cancel();var T={isTooltipActive:!1};P.setState(T),P.triggerSyncEvent(T);var S=P.props.onMouseLeave;Tr(S)&&S(T,E)}),xr(P,"handleOuterEvent",function(E){var T=vB(E),S=Co(P.props,"".concat(T));if(T&&Tr(S)){var I,U;/.*touch.*/i.test(T)?U=P.getMouseInfo(E.changedTouches[0]):U=P.getMouseInfo(E),S((I=U)!==null&&I!==void 0?I:{},E)}}),xr(P,"handleClick",function(E){var T=P.getMouseInfo(E);if(T){var S=ft(ft({},T),{},{isTooltipActive:!0});P.setState(S),P.triggerSyncEvent(S);var I=P.props.onClick;Tr(I)&&I(S,E)}}),xr(P,"handleMouseDown",function(E){var T=P.props.onMouseDown;if(Tr(T)){var S=P.getMouseInfo(E);T(S,E)}}),xr(P,"handleMouseUp",function(E){var T=P.props.onMouseUp;if(Tr(T)){var S=P.getMouseInfo(E);T(S,E)}}),xr(P,"handleTouchMove",function(E){E.changedTouches!=null&&E.changedTouches.length>0&&P.throttleTriggeredAfterMouseMove(E.changedTouches[0])}),xr(P,"handleTouchStart",function(E){E.changedTouches!=null&&E.changedTouches.length>0&&P.handleMouseDown(E.changedTouches[0])}),xr(P,"handleTouchEnd",function(E){E.changedTouches!=null&&E.changedTouches.length>0&&P.handleMouseUp(E.changedTouches[0])}),xr(P,"handleDoubleClick",function(E){var T=P.props.onDoubleClick;if(Tr(T)){var S=P.getMouseInfo(E);T(S,E)}}),xr(P,"handleContextMenu",function(E){var T=P.props.onContextMenu;if(Tr(T)){var S=P.getMouseInfo(E);T(S,E)}}),xr(P,"triggerSyncEvent",function(E){P.props.syncId!==void 0&&s2.emit(l2,P.props.syncId,E,P.eventEmitterSymbol)}),xr(P,"applySyncEvent",function(E){var T=P.props,S=T.layout,I=T.syncMethod,U=P.state.updateId,O=E.dataStartIndex,M=E.dataEndIndex;if(E.dataStartIndex!==void 0||E.dataEndIndex!==void 0)P.setState(ft({dataStartIndex:O,dataEndIndex:M},p({props:P.props,dataStartIndex:O,dataEndIndex:M,updateId:U},P.state)));else if(E.activeTooltipIndex!==void 0){var L=E.chartX,q=E.chartY,z=E.activeTooltipIndex,K=P.state,J=K.offset,R=K.tooltipTicks;if(!J)return;if(typeof I=="function")z=I(R,E);else if(I==="value"){z=-1;for(var k=0;k<R.length;k++)if(R[k].value===E.activeLabel){z=k;break}}var $=ft(ft({},J),{},{x:J.left,y:J.top}),X=Math.min(L,$.x+$.width),C=Math.min(q,$.y+$.height),N=R[z]&&R[z].value,H=gw(P.state,P.props.data,z),W=R[z]?{x:S==="horizontal"?R[z].coordinate:X,y:S==="horizontal"?C:R[z].coordinate}:LL;P.setState(ft(ft({},E),{},{activeLabel:N,activeCoordinate:W,activePayload:H,activeTooltipIndex:z}))}else P.setState(E)}),xr(P,"renderCursor",function(E){var T,S=P.state,I=S.isTooltipActive,U=S.activeCoordinate,O=S.activePayload,M=S.offset,L=S.activeTooltipIndex,q=S.tooltipAxisBandSize,z=P.getTooltipEventType(),K=(T=E.props.active)!==null&&T!==void 0?T:I,J=P.props.layout,R=E.key||"_recharts-cursor";return Ae.createElement(mre,{key:R,activeCoordinate:U,activePayload:O,activeTooltipIndex:L,chartName:r,element:E,isActive:K,layout:J,offset:M,tooltipAxisBandSize:q,tooltipEventType:z})}),xr(P,"renderPolarAxis",function(E,T,S){var I=Co(E,"type.axisType"),U=Co(P.state,"".concat(I,"Map")),O=E.type.defaultProps,M=O!==void 0?ft(ft({},O),E.props):E.props,L=U&&U[M["".concat(I,"Id")]];return x.cloneElement(E,ft(ft({},L),{},{className:Pr(I,L.className),key:E.key||"".concat(T,"-").concat(S),ticks:sl(L,!0)}))}),xr(P,"renderPolarGrid",function(E){var T=E.props,S=T.radialLines,I=T.polarAngles,U=T.polarRadius,O=P.state,M=O.radiusAxisMap,L=O.angleAxisMap,q=Vl(M),z=Vl(L),K=z.cx,J=z.cy,R=z.innerRadius,k=z.outerRadius;return x.cloneElement(E,{polarAngles:Array.isArray(I)?I:sl(z,!0).map(function($){return $.coordinate}),polarRadius:Array.isArray(U)?U:sl(q,!0).map(function($){return $.coordinate}),cx:K,cy:J,innerRadius:R,outerRadius:k,key:E.key||"polar-grid",radialLines:S})}),xr(P,"renderLegend",function(){var E=P.state.formattedGraphicalItems,T=P.props,S=T.children,I=T.width,U=T.height,O=P.props.margin||{},M=I-(O.left||0)-(O.right||0),L=yM({children:S,formattedGraphicalItems:E,legendWidth:M,legendContent:u});if(!L)return null;var q=L.item,z=M4(L,gre);return x.cloneElement(q,ft(ft({},z),{},{chartWidth:I,chartHeight:U,margin:O,onBBoxUpdate:P.handleLegendBBoxUpdate}))}),xr(P,"renderTooltip",function(){var E,T=P.props,S=T.children,I=T.accessibilityLayer,U=yo(S,xo);if(!U)return null;var O=P.state,M=O.isTooltipActive,L=O.activeCoordinate,q=O.activePayload,z=O.activeLabel,K=O.offset,J=(E=U.props.active)!==null&&E!==void 0?E:M;return x.cloneElement(U,{viewBox:ft(ft({},K),{},{x:K.left,y:K.top}),active:J,label:z,payload:J?q:[],coordinate:L,accessibilityLayer:I})}),xr(P,"renderBrush",function(E){var T=P.props,S=T.margin,I=T.data,U=P.state,O=U.offset,M=U.dataStartIndex,L=U.dataEndIndex,q=U.updateId;return x.cloneElement(E,{key:E.key||"_recharts-brush",onChange:jm(P.handleBrushChange,E.props.onChange),data:I,x:Dt(E.props.x)?E.props.x:O.left,y:Dt(E.props.y)?E.props.y:O.top+O.height+O.brushBottom-(S.bottom||0),width:Dt(E.props.width)?E.props.width:O.width,startIndex:M,endIndex:L,updateId:"brush-".concat(q)})}),xr(P,"renderReferenceElement",function(E,T,S){if(!E)return null;var I=P,U=I.clipPathId,O=P.state,M=O.xAxisMap,L=O.yAxisMap,q=O.offset,z=E.type.defaultProps||{},K=E.props,J=K.xAxisId,R=J===void 0?z.xAxisId:J,k=K.yAxisId,$=k===void 0?z.yAxisId:k;return x.cloneElement(E,{key:E.key||"".concat(T,"-").concat(S),xAxis:M[R],yAxis:L[$],viewBox:{x:q.left,y:q.top,width:q.width,height:q.height},clipPathId:U})}),xr(P,"renderActivePoints",function(E){var T=E.item,S=E.activePoint,I=E.basePoint,U=E.childIndex,O=E.isRange,M=[],L=T.props.key,q=T.item.type.defaultProps!==void 0?ft(ft({},T.item.type.defaultProps),T.item.props):T.item.props,z=q.activeDot,K=q.dataKey,J=ft(ft({index:U,dataKey:K,cx:S.x,cy:S.y,r:4,fill:Xj(T.item),strokeWidth:2,stroke:"#fff",payload:S.payload,value:S.value},gr(z,!1)),gg(z));return M.push(b.renderActiveDot(z,J,"".concat(L,"-activePoint-").concat(U))),I?M.push(b.renderActiveDot(z,ft(ft({},J),{},{cx:I.x,cy:I.y}),"".concat(L,"-basePoint-").concat(U))):O&&M.push(null),M}),xr(P,"renderGraphicChild",function(E,T,S){var I=P.filterFormatItem(E,T,S);if(!I)return null;var U=P.getTooltipEventType(),O=P.state,M=O.isTooltipActive,L=O.tooltipAxis,q=O.activeTooltipIndex,z=O.activeLabel,K=P.props.children,J=yo(K,xo),R=I.props,k=R.points,$=R.isRange,X=R.baseLine,C=I.item.type.defaultProps!==void 0?ft(ft({},I.item.type.defaultProps),I.item.props):I.item.props,N=C.activeDot,H=C.hide,W=C.activeBar,ne=C.activeShape,se=!!(!H&&M&&J&&(N||W||ne)),oe={};U!=="axis"&&J&&J.props.trigger==="click"?oe={onClick:jm(P.handleItemMouseEnter,E.props.onClick)}:U!=="axis"&&(oe={onMouseLeave:jm(P.handleItemMouseLeave,E.props.onMouseLeave),onMouseEnter:jm(P.handleItemMouseEnter,E.props.onMouseEnter)});var ae=x.cloneElement(E,ft(ft({},I.props),oe));function pe(st){return typeof L.dataKey=="function"?L.dataKey(st.payload):null}if(se)if(q>=0){var ge,Q;if(L.dataKey&&!L.allowDuplicatedCategory){var G=typeof L.dataKey=="function"?pe:"payload.".concat(L.dataKey.toString());ge=mg(k,G,z),Q=$&&X&&mg(X,G,z)}else ge=k?.[q],Q=$&&X&&X[q];if(ne||W){var ee=E.props.activeIndex!==void 0?E.props.activeIndex:q;return[x.cloneElement(E,ft(ft(ft({},I.props),oe),{},{activeIndex:ee})),null,null]}if(!Fr(ge))return[ae].concat(Sd(P.renderActivePoints({item:I,activePoint:ge,basePoint:Q,childIndex:q,isRange:$})))}else{var le,V=(le=P.getItemByXY(P.state.activeCoordinate))!==null&&le!==void 0?le:{graphicalItem:ae},Ve=V.graphicalItem,Me=Ve.item,Fe=Me===void 0?E:Me,Qe=Ve.childIndex,it=ft(ft(ft({},I.props),oe),{},{activeIndex:Qe});return[x.cloneElement(Fe,it),null,null]}return $?[ae,null,null]:[ae,null]}),xr(P,"renderCustomized",function(E,T,S){return x.cloneElement(E,ft(ft({key:"recharts-customized-".concat(S)},P.props),P.state))}),xr(P,"renderMap",{CartesianGrid:{handler:Om,once:!0},ReferenceArea:{handler:P.renderReferenceElement},ReferenceLine:{handler:Om},ReferenceDot:{handler:P.renderReferenceElement},XAxis:{handler:Om},YAxis:{handler:Om},Brush:{handler:P.renderBrush,once:!0},Bar:{handler:P.renderGraphicChild},Line:{handler:P.renderGraphicChild},Area:{handler:P.renderGraphicChild},Radar:{handler:P.renderGraphicChild},RadialBar:{handler:P.renderGraphicChild},Scatter:{handler:P.renderGraphicChild},Pie:{handler:P.renderGraphicChild},Funnel:{handler:P.renderGraphicChild},Tooltip:{handler:P.renderCursor,once:!0},PolarGrid:{handler:P.renderPolarGrid,once:!0},PolarAngleAxis:{handler:P.renderPolarAxis},PolarRadiusAxis:{handler:P.renderPolarAxis},Customized:{handler:P.renderCustomized}}),P.clipPathId="".concat((w=_.id)!==null&&w!==void 0?w:qd("recharts"),"-clip"),P.throttleTriggeredAfterMouseMove=gD(P.triggeredAfterMouseMove,(A=_.throttleDelay)!==null&&A!==void 0?A:1e3/60),P.state={},P}return Ore(b,y),Sre(b,[{key:"componentDidMount",value:function(){var w,A;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(w=this.props.margin.left)!==null&&w!==void 0?w:0,top:(A=this.props.margin.top)!==null&&A!==void 0?A:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var w=this.props,A=w.children,P=w.data,E=w.height,T=w.layout,S=yo(A,xo);if(S){var I=S.props.defaultIndex;if(!(typeof I!="number"||I<0||I>this.state.tooltipTicks.length-1)){var U=this.state.tooltipTicks[I]&&this.state.tooltipTicks[I].value,O=gw(this.state,P,I,U),M=this.state.tooltipTicks[I].coordinate,L=(this.state.offset.top+E)/2,q=T==="horizontal",z=q?{x:M,y:L}:{y:M,x:L},K=this.state.formattedGraphicalItems.find(function(R){var k=R.item;return k.type.name==="Scatter"});K&&(z=ft(ft({},z),K.props.points[I].tooltipPosition),O=K.props.points[I].tooltipPayload);var J={activeTooltipIndex:I,isTooltipActive:!0,activeLabel:U,activePayload:O,activeCoordinate:z};this.setState(J),this.renderCursor(S),this.accessibilityManager.setIndex(I)}}}},{key:"getSnapshotBeforeUpdate",value:function(w,A){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==A.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==w.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==w.margin){var P,E;this.accessibilityManager.setDetails({offset:{left:(P=this.props.margin.left)!==null&&P!==void 0?P:0,top:(E=this.props.margin.top)!==null&&E!==void 0?E:0}})}return null}},{key:"componentDidUpdate",value:function(w){J2([yo(w.children,xo)],[yo(this.props.children,xo)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var w=yo(this.props.children,xo);if(w&&typeof w.props.shared=="boolean"){var A=w.props.shared?"axis":"item";return l.indexOf(A)>=0?A:o}return o}},{key:"getMouseInfo",value:function(w){if(!this.container)return null;var A=this.container,P=A.getBoundingClientRect(),E=a9(P),T={chartX:Math.round(w.pageX-E.left),chartY:Math.round(w.pageY-E.top)},S=P.width/A.offsetWidth||1,I=this.inRange(T.chartX,T.chartY,S);if(!I)return null;var U=this.state,O=U.xAxisMap,M=U.yAxisMap,L=this.getTooltipEventType(),q=R4(this.state,this.props.data,this.props.layout,I);if(L!=="axis"&&O&&M){var z=Vl(O).scale,K=Vl(M).scale,J=z&&z.invert?z.invert(T.chartX):null,R=K&&K.invert?K.invert(T.chartY):null;return ft(ft({},T),{},{xValue:J,yValue:R},q)}return q?ft(ft({},T),q):null}},{key:"inRange",value:function(w,A){var P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,E=this.props.layout,T=w/P,S=A/P;if(E==="horizontal"||E==="vertical"){var I=this.state.offset,U=T>=I.left&&T<=I.left+I.width&&S>=I.top&&S<=I.top+I.height;return U?{x:T,y:S}:null}var O=this.state,M=O.angleAxisMap,L=O.radiusAxisMap;if(M&&L){var q=Vl(M);return Uk({x:T,y:S},q)}return null}},{key:"parseEventsOfWrapper",value:function(){var w=this.props.children,A=this.getTooltipEventType(),P=yo(w,xo),E={};P&&A==="axis"&&(P.props.trigger==="click"?E={onClick:this.handleClick}:E={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var T=gg(this.props,this.handleOuterEvent);return ft(ft({},T),E)}},{key:"addListener",value:function(){s2.on(l2,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){s2.removeListener(l2,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(w,A,P){for(var E=this.state.formattedGraphicalItems,T=0,S=E.length;T<S;T++){var I=E[T];if(I.item===w||I.props.key===w.key||A===ul(I.item.type)&&P===I.childIndex)return I}return null}},{key:"renderClipPath",value:function(){var w=this.clipPathId,A=this.state.offset,P=A.left,E=A.top,T=A.height,S=A.width;return Ae.createElement("defs",null,Ae.createElement("clipPath",{id:w},Ae.createElement("rect",{x:P,y:E,height:T,width:S})))}},{key:"getXScales",value:function(){var w=this.state.xAxisMap;return w?Object.entries(w).reduce(function(A,P){var E=D4(P,2),T=E[0],S=E[1];return ft(ft({},A),{},xr({},T,S.scale))},{}):null}},{key:"getYScales",value:function(){var w=this.state.yAxisMap;return w?Object.entries(w).reduce(function(A,P){var E=D4(P,2),T=E[0],S=E[1];return ft(ft({},A),{},xr({},T,S.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(w){var A;return(A=this.state.xAxisMap)===null||A===void 0||(A=A[w])===null||A===void 0?void 0:A.scale}},{key:"getYScaleByAxisId",value:function(w){var A;return(A=this.state.yAxisMap)===null||A===void 0||(A=A[w])===null||A===void 0?void 0:A.scale}},{key:"getItemByXY",value:function(w){var A=this.state,P=A.formattedGraphicalItems,E=A.activeItem;if(P&&P.length)for(var T=0,S=P.length;T<S;T++){var I=P[T],U=I.props,O=I.item,M=O.type.defaultProps!==void 0?ft(ft({},O.type.defaultProps),O.props):O.props,L=ul(O.type);if(L==="Bar"){var q=(U.data||[]).find(function(R){return vX(w,R)});if(q)return{graphicalItem:I,payload:q}}else if(L==="RadialBar"){var z=(U.data||[]).find(function(R){return Uk(w,R)});if(z)return{graphicalItem:I,payload:z}}else if(gy(I,E)||vy(I,E)||yp(I,E)){var K=$J({graphicalItem:I,activeTooltipItem:E,itemData:M.data}),J=M.activeIndex===void 0?K:M.activeIndex;return{graphicalItem:ft(ft({},I),{},{childIndex:J}),payload:yp(I,E)?M.data[K]:I.props.data[K]}}}return null}},{key:"render",value:function(){var w=this;if(!ZC(this))return null;var A=this.props,P=A.children,E=A.className,T=A.width,S=A.height,I=A.style,U=A.compact,O=A.title,M=A.desc,L=M4(A,vre),q=gr(L,!1);if(U)return Ae.createElement(m4,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ae.createElement(e_,Lu({},q,{width:T,height:S,title:O,desc:M}),this.renderClipPath(),tA(P,this.renderMap)));if(this.props.accessibilityLayer){var z,K;q.tabIndex=(z=this.props.tabIndex)!==null&&z!==void 0?z:0,q.role=(K=this.props.role)!==null&&K!==void 0?K:"application",q.onKeyDown=function(R){w.accessibilityManager.keyboardEvent(R)},q.onFocus=function(){w.accessibilityManager.focus()}}var J=this.parseEventsOfWrapper();return Ae.createElement(m4,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ae.createElement("div",Lu({className:Pr("recharts-wrapper",E),style:ft({position:"relative",cursor:"default",width:T,height:S},I)},J,{ref:function(k){w.container=k}}),Ae.createElement(e_,Lu({},q,{width:T,height:S,title:O,desc:M,style:Dre}),this.renderClipPath(),tA(P,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(x.Component);xr(v,"displayName",r),xr(v,"defaultProps",ft({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},f)),xr(v,"getDerivedStateFromProps",function(y,b){var _=y.dataKey,w=y.data,A=y.children,P=y.width,E=y.height,T=y.layout,S=y.stackOffset,I=y.margin,U=b.dataStartIndex,O=b.dataEndIndex;if(b.updateId===void 0){var M=q4(y);return ft(ft(ft({},M),{},{updateId:0},p(ft(ft({props:y},M),{},{updateId:0}),b)),{},{prevDataKey:_,prevData:w,prevWidth:P,prevHeight:E,prevLayout:T,prevStackOffset:S,prevMargin:I,prevChildren:A})}if(_!==b.prevDataKey||w!==b.prevData||P!==b.prevWidth||E!==b.prevHeight||T!==b.prevLayout||S!==b.prevStackOffset||!Hu(I,b.prevMargin)){var L=q4(y),q={chartX:b.chartX,chartY:b.chartY,isTooltipActive:b.isTooltipActive},z=ft(ft({},R4(b,w,T)),{},{updateId:b.updateId+1}),K=ft(ft(ft({},L),q),z);return ft(ft(ft({},K),p(ft({props:y},K),b)),{},{prevDataKey:_,prevData:w,prevWidth:P,prevHeight:E,prevLayout:T,prevStackOffset:S,prevMargin:I,prevChildren:A})}if(!J2(A,b.prevChildren)){var J,R,k,$,X=yo(A,pd),C=X&&(J=(R=X.props)===null||R===void 0?void 0:R.startIndex)!==null&&J!==void 0?J:U,N=X&&(k=($=X.props)===null||$===void 0?void 0:$.endIndex)!==null&&k!==void 0?k:O,H=C!==U||N!==O,W=!Fr(w),ne=W&&!H?b.updateId:b.updateId+1;return ft(ft({updateId:ne},p(ft(ft({props:y},b),{},{updateId:ne,dataStartIndex:C,dataEndIndex:N}),b)),{},{prevChildren:A,dataStartIndex:C,dataEndIndex:N})}return null}),xr(v,"renderActiveDot",function(y,b,_){var w;return x.isValidElement(y)?w=x.cloneElement(y,b):Tr(y)?w=y(b):w=Ae.createElement(dy,b),Ae.createElement(cn,{className:"recharts-active-dot",key:_},w)});var m=x.forwardRef(function(b,_){return Ae.createElement(v,Lu({},b,{ref:_}))});return m.displayName=v.displayName,m},Wre=lS({chartName:"LineChart",GraphicalChild:zp,axisComponents:[{axisType:"xAxis",AxisComp:Zc},{axisType:"yAxis",AxisComp:eu}],formatAxisMap:nL}),qL=lS({chartName:"BarChart",GraphicalChild:vl,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:Zc},{axisType:"yAxis",AxisComp:eu}],formatAxisMap:nL}),Hre=lS({chartName:"PieChart",GraphicalChild:jl,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:my},{axisType:"radiusAxis",AxisComp:hy}],formatAxisMap:LY,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const u2=()=>Math.random().toString(36).slice(2),Vre=({open:e,onOpen:t,onClose:r,panelWidth:n=360,rightOffset:a=24,desktopTopOffset:o=72,desktopWidth:s,onDesktopResize:l,desktopMinWidth:c=280,desktopMaxWidth:u=640,desktopHandleWidth:d=12,desktopBottomOffset:f=32})=>{const{user:h}=Jn(),[p,v]=x.useState(!1),[m,y]=x.useState(""),[b,_]=x.useState([]),w=x.useRef(null),A=gI(),P=o8(A.breakpoints.up("md")),[E,T]=x.useState(n),S=x.useRef(0),I=x.useRef(n),[U,O]=x.useState(!1),[M,L]=x.useState({}),q=x.useMemo(()=>Math.min(u,Math.max(c,typeof s=="number"?s:E)),[s,E,u,c]),z=x.useMemo(()=>`calc(100vh - ${o+f}px)`,[f,o]),K=o+72;x.useEffect(()=>{_([]),y("")},[h?.id]),x.useEffect(()=>{w.current&&(w.current.scrollTop=w.current.scrollHeight)},[b,e]),x.useEffect(()=>{typeof s=="number"&&T(s)},[s]),x.useEffect(()=>{if(!U)return;let se=null,oe=null;const ae=()=>{if(oe==null)return;const Q=oe;oe=null,l?l(Q):T(Q),se=null},pe=Q=>{const G=S.current-Q.clientX;oe=Math.min(u,Math.max(c,I.current+G)),se==null&&(se=requestAnimationFrame(ae))},ge=()=>{O(!1),document.body.style.userSelect="",document.body.style.cursor=""};return window.addEventListener("mousemove",pe),window.addEventListener("mouseup",ge),()=>{window.removeEventListener("mousemove",pe),window.removeEventListener("mouseup",ge),se!=null&&cancelAnimationFrame(se)}},[u,c,U,l]),x.useEffect(()=>()=>{document.body.style.userSelect="",document.body.style.cursor=""},[]);const J=x.useCallback(se=>{P&&(se.preventDefault(),S.current=se.clientX,I.current=q,O(!0),document.body.style.userSelect="none",document.body.style.cursor="col-resize")},[q,P]),R=x.useCallback(async()=>{const se=m.trim();if(!se||p)return;const oe={id:u2(),role:"user",text:se};_(ae=>[...ae,oe]),y(""),v(!0);try{const ae=await v$(se),pe={id:u2(),role:"assistant",text:ae?.text||"",rows:ae?.rows||void 0};_(ge=>[...ge,pe])}catch{_(pe=>[...pe,{id:u2(),role:"assistant",text:"Error contacting assistant. Please try again."}])}finally{v(!1)}},[m,p]),k=x.useCallback(se=>{se.preventDefault(),R()},[R]);if(!h)return null;function $(se){if(!se||se.length===0)return{};const oe=se[0],ae=Object.keys(oe);let pe,ge;for(const Q of ae){const G=oe[Q];pe===void 0&&(typeof G=="string"||G instanceof Date)&&(pe=Q)}for(const Q of ae){const G=oe[Q];if(typeof G=="number"){ge=Q;break}ge===void 0&&typeof G=="string"&&!isNaN(Number(G))&&(ge=Q)}return pe||(pe=ae.find(Q=>!isNaN(Date.parse(String(oe[Q]))))||ae.find(Q=>typeof oe[Q]=="string")),ge||(ge=ae.find(Q=>typeof oe[Q]=="number")),{xKey:pe,yKey:ge}}function X(se,oe,ae){const pe=new Map;for(const ge of se){const Q=ge?.[oe],G=Q==null?"":String(Q),ee=ge?.[ae],le=typeof ee=="number"?ee:Number(ee);isFinite(le)&&pe.set(G,(pe.get(G)||0)+le)}return Array.from(pe.entries()).map(([ge,Q])=>({[oe]:ge,[ae]:Number(Q.toFixed(2))}))}function C(se,oe,ae,pe="chart_data"){try{const ge=`${oe},${ae}`,Q=se.map(Ve=>{const Me=String(Ve[oe]).replace(/"/g,'""'),Fe=Number(Ve[ae]);return`"${Me}",${isFinite(Fe)?Fe.toFixed(2):""}`}),G=[ge,...Q].join(`
`),ee=new Blob([G],{type:"text/csv;charset=utf-8;"}),le=URL.createObjectURL(ee),V=document.createElement("a");V.href=le,V.download=`${pe}.csv`,document.body.appendChild(V),V.click(),document.body.removeChild(V),URL.revokeObjectURL(le)}catch{}}function N(se,oe){if(oe&&Array.isArray(oe)&&oe.length>0){const ae=se.match(/(^|\n)\s*Headline\s*:[^\n]*/i);if(ae)return ae[0].replace(/^\s*/,"").trim();const pe=se.split(/\r?\n/)[0]?.trim()??"";return pe.length>0?pe:""}return se}const H=i.jsxs(Z,{sx:{px:2.5,py:1.75,display:"flex",alignItems:"center",gap:1.5,background:`linear-gradient(135deg, ${pn(A.palette.primary.main,.95)}, ${pn(A.palette.primary.dark,.9)})`,color:A.palette.primary.contrastText},children:[i.jsx(kp,{sx:{bgcolor:pn("#ffffff",.2)},children:i.jsx(u$,{fontSize:"small"})}),i.jsxs(Z,{sx:{flex:1},children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:"Aiven Assistant"}),i.jsx(B,{variant:"caption",sx:{opacity:.85},children:"Your workspace copilot for instant answers"})]}),i.jsx(vr,{size:"small",onClick:r,sx:{color:"inherit"},children:i.jsx(aj,{fontSize:"small"})})]}),W=i.jsxs(Z,{ref:w,sx:{flex:1,px:2.5,py:2,background:`radial-gradient(circle at top right, ${pn(A.palette.primary.light,.14)} 0%, transparent 60%)`,overflowY:"auto"},children:[b.length===0&&i.jsxs(Z,{sx:{textAlign:"center",py:4,px:2,color:"text.secondary"},children:[i.jsx(B,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:"Welcome! Ask anything about your operations."}),i.jsx(B,{variant:"body2",children:"Try Show me overdue tasks for this week or How do I add a purchase order?. This chat clears automatically when you sign out."})]}),b.map(se=>{const oe=se.role==="user",ae=N(se.text,se.rows);return i.jsx(Z,{sx:{mb:2,display:"flex",justifyContent:oe?"flex-end":"flex-start"},children:i.jsxs(Z,{sx:{maxWidth:"80%",px:1.75,py:1.25,borderRadius:3,background:oe?`linear-gradient(135deg, ${A.palette.primary.main}, ${A.palette.primary.dark})`:pn(A.palette.background.paper,.95),color:oe?A.palette.primary.contrastText:A.palette.text.primary,boxShadow:oe?"0 12px 25px rgba(28, 97, 234, 0.35)":`0 8px 16px ${pn(A.palette.common.black,.08)}`,border:oe?"none":`1px solid ${pn(A.palette.primary.main,.15)}`,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[ae?i.jsx(B,{variant:"body2",children:ae}):null,se.rows&&Array.isArray(se.rows)&&se.rows.length>0&&i.jsxs(Z,{sx:{mt:1.5,borderRadius:2,border:`1px solid ${pn(A.palette.primary.main,.2)}`,backgroundColor:pn(A.palette.background.default,.95),overflow:"hidden"},children:[i.jsxs(Z,{sx:{px:1,py:.75,borderBottom:`1px solid ${pn(A.palette.primary.main,.1)}`,backgroundColor:pn(A.palette.primary.light,.1),display:"flex",alignItems:"center",justifyContent:"space-between",gap:1},children:[i.jsx(B,{variant:"caption",sx:{fontWeight:600,letterSpacing:.5},children:"Data preview"}),i.jsx(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:i.jsx(xe,{size:"small",variant:"outlined",startIcon:i.jsx(h$,{fontSize:"small"}),onClick:()=>{L(pe=>{const ge=pe[se.id]||{open:!1},Q=!ge.open,G=$(se.rows);return{...pe,[se.id]:{open:Q,xKey:ge.xKey||G.xKey,yKey:ge.yKey||G.yKey,chartType:ge.chartType||"bar",showLabels:ge.showLabels??!0}}})},children:M[se.id]?.open?"Hide chart":"Visualize"})})]}),i.jsx(Z,{sx:{maxHeight:160,overflow:"auto"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[i.jsx("thead",{children:i.jsx("tr",{children:Object.keys(se.rows[0]).slice(0,6).map(pe=>i.jsx("th",{style:{textAlign:"left",padding:"6px 8px",borderBottom:`1px solid ${pn(A.palette.divider,.7)}`,fontWeight:600},children:pe},pe))})}),i.jsx("tbody",{children:se.rows.slice(0,10).map((pe,ge)=>i.jsx("tr",{children:Object.keys(se.rows[0]).slice(0,6).map(Q=>i.jsx("td",{style:{padding:"6px 8px",borderBottom:`1px solid ${pn(A.palette.divider,.4)}`},children:String(pe[Q])},Q))},ge))})]})}),M[se.id]?.open&&i.jsx(Z,{sx:{p:1.25,borderTop:`1px solid ${pn(A.palette.primary.main,.1)}`},children:(()=>{const pe=M[se.id]||{},ge=se.rows[0],Q=Object.keys(ge),G=Q.filter(Qe=>typeof ge[Qe]=="number"||!isNaN(Number(ge[Qe]))),ee=pe.xKey&&Q.includes(pe.xKey)?pe.xKey:$(se.rows).xKey,le=pe.yKey&&Q.includes(pe.yKey)?pe.yKey:$(se.rows).yKey,V=pe.chartType||"bar",Ve=pe.showLabels!==!1,Me=ee&&le,Fe=Me?X(se.rows,ee,le):[];return i.jsxs(i.Fragment,{children:[i.jsxs(Z,{sx:{display:"flex",gap:1.5,mb:1,flexWrap:"wrap",alignItems:"center"},children:[i.jsxs(Pe,{select:!0,size:"small",label:"Chart type",value:V,onChange:Qe=>L(it=>({...it,[se.id]:{...it[se.id]??{},open:!0,chartType:Qe.target.value,xKey:ee,yKey:le}})),SelectProps:{native:!0},sx:{minWidth:140},children:[i.jsx("option",{value:"bar",children:"Bar"}),i.jsx("option",{value:"line",children:"Line"}),i.jsx("option",{value:"pie",children:"Pie"})]}),i.jsxs(Pe,{select:!0,size:"small",label:"X axis",value:ee||"",onChange:Qe=>L(it=>({...it,[se.id]:{...it[se.id]??{},open:!0,xKey:Qe.target.value,yKey:le}})),SelectProps:{native:!0},sx:{minWidth:160},children:[i.jsx("option",{value:"",disabled:!0,children:"Select field"}),Q.map(Qe=>i.jsx("option",{value:Qe,children:Qe},Qe))]}),i.jsxs(Pe,{select:!0,size:"small",label:"Y value",value:le||"",onChange:Qe=>L(it=>({...it,[se.id]:{...it[se.id]??{},open:!0,xKey:ee,yKey:Qe.target.value}})),SelectProps:{native:!0},sx:{minWidth:160},children:[i.jsx("option",{value:"",disabled:!0,children:"Select field"}),G.map(Qe=>i.jsx("option",{value:Qe,children:Qe},Qe))]}),i.jsx(ui,{sx:{ml:.5},control:i.jsx(ac,{size:"small",checked:Ve,onChange:Qe=>L(it=>({...it,[se.id]:{...it[se.id]??{},open:!0,showLabels:Qe.target.checked}}))}),label:"Labels"}),i.jsx(xe,{size:"small",variant:"text",startIcon:i.jsx(g$,{fontSize:"small"}),onClick:()=>Fe&&ee&&le&&C(Fe,ee,le),children:"Download CSV"})]}),Me?i.jsx(Z,{sx:{height:260},children:i.jsx(vD,{width:"100%",height:"100%",children:V==="bar"?i.jsxs(qL,{data:Fe,layout:"vertical",margin:{left:12,right:16,top:8,bottom:8},children:[i.jsx(cv,{strokeDasharray:"3 3"}),i.jsx(Zc,{type:"number",tick:Ve?{fontSize:11}:!1}),i.jsx(eu,{type:"category",dataKey:ee,width:160,tick:Ve?{fontSize:12}:!1}),i.jsx(xo,{}),Ve&&i.jsx(Ss,{}),i.jsx(vl,{dataKey:le,fill:A.palette.primary.main})]}):V==="line"?i.jsxs(Wre,{data:Fe,margin:{left:8,right:16,top:8,bottom:8},children:[i.jsx(cv,{strokeDasharray:"3 3"}),i.jsx(Zc,{dataKey:ee,interval:0,tick:Ve?{fontSize:11}:!1,height:40}),i.jsx(eu,{tick:Ve?void 0:!1}),i.jsx(xo,{}),Ve&&i.jsx(Ss,{}),i.jsx(zp,{type:"monotone",dataKey:le,stroke:A.palette.primary.main,strokeWidth:2,dot:{r:2}})]}):i.jsxs(Hre,{children:[i.jsx(xo,{}),Ve&&i.jsx(Ss,{}),i.jsx(jl,{data:Fe,dataKey:le,nameKey:ee,outerRadius:90,children:Fe.map((Qe,it)=>i.jsx(Zv,{fill:A.palette.primary[it%2===0?"main":"light"]},`cell-${it}`))})]})})}):i.jsx(B,{variant:"caption",color:"text.secondary",children:"Pick an x (category/date) and a numeric y field to chart."})]})})()})]})]})},se.id)}),p&&i.jsxs(Z,{sx:{display:"flex",gap:1,alignItems:"center",color:"text.secondary",mt:1},children:[i.jsx(er,{size:18,thickness:5}),i.jsx(B,{variant:"body2",children:"Aiven is thinking..."})]})]}),ne=i.jsxs(Z,{component:"form",onSubmit:k,sx:{p:2,display:"flex",alignItems:"center",gap:1.25,backgroundColor:pn(A.palette.background.paper,.98)},children:[i.jsx(Pe,{fullWidth:!0,size:"small",placeholder:"Ask Aiven anything about your data or workflows...",value:m,onChange:se=>y(se.target.value),InputProps:{sx:{borderRadius:3,backgroundColor:pn(A.palette.background.default,.9),boxShadow:`inset 0 0 0 1px ${pn(A.palette.primary.main,.08)}`}}}),i.jsx(vr,{type:"submit",color:"primary",disabled:p||!m.trim(),sx:{bgcolor:p||!m.trim()?"action.disabledBackground":A.palette.primary.main,color:p||!m.trim()?"text.disabled":A.palette.primary.contrastText,"&:hover":p||!m.trim()?void 0:{bgcolor:A.palette.primary.dark,color:A.palette.primary.contrastText},transition:"background-color 0.2s ease, transform 0.2s ease",transform:p||!m.trim()?"none":"translateY(0)",boxShadow:p||!m.trim()?"none":"0 12px 24px rgba(28, 97, 234, 0.3)"},children:i.jsx(gN,{})})]});return P?i.jsxs(i.Fragment,{children:[!e&&i.jsx(Z,{sx:{position:"fixed",top:`${K}px`,right:`${a}px`,zIndex:1400,display:"flex",justifyContent:"flex-end",alignItems:"flex-start"},children:i.jsx(Z,{onClick:t,role:"button",tabIndex:0,onKeyDown:se=>{(se.key==="Enter"||se.key===" ")&&(se.preventDefault(),t())},sx:{width:44,px:1,py:2,borderTopLeftRadius:16,borderBottomLeftRadius:16,background:`linear-gradient(135deg, ${A.palette.primary.main}, ${A.palette.primary.dark})`,boxShadow:"0 18px 35px rgba(28, 97, 234, 0.35)",color:A.palette.primary.contrastText,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",outline:"none"},children:i.jsx(B,{variant:"button",sx:{writingMode:"vertical-rl",transform:"rotate(180deg)",letterSpacing:1,fontWeight:600},children:"Aiven Assistant"})})}),e&&i.jsxs(Z,{sx:{position:"fixed",top:`${o}px`,right:`${a}px`,zIndex:1500,display:"flex",flexDirection:"row-reverse",alignItems:"stretch",height:z,maxHeight:z,minWidth:`${q+d}px`},children:[i.jsxs(bt,{elevation:0,sx:{width:`${q}px`,height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",borderRadius:0,borderLeft:`1px solid ${pn(A.palette.divider,.7)}`,borderRight:"none",borderTop:"none",borderBottom:"none",boxShadow:"none",backgroundColor:A.palette.background.paper},children:[H,i.jsx(Vn,{sx:{borderColor:pn("#fff",.18)}}),W,i.jsx(Vn,{}),ne]}),i.jsx(Z,{onMouseDown:J,role:"presentation",sx:{width:`${d}px`,cursor:"col-resize",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:pn(A.palette.background.paper,.6),borderTopLeftRadius:12,borderBottomLeftRadius:12,border:`1px solid ${pn(A.palette.primary.main,.15)}`,borderRight:"none",ml:"-1px",height:"100%","&:hover":{backgroundColor:pn(A.palette.primary.main,.12)}},children:i.jsx(Z,{sx:{width:4,height:28,borderRadius:999,backgroundColor:pn(A.palette.text.primary,.3)}})})]})]}):i.jsxs(i.Fragment,{children:[!e&&i.jsx(Hn,{title:"Ask Aiven Assistant",children:i.jsx(s8,{onClick:t,sx:{position:"fixed",bottom:32,right:32,zIndex:1400,background:`linear-gradient(135deg, ${A.palette.primary.main}, ${A.palette.primary.dark})`,color:A.palette.primary.contrastText,boxShadow:"0 18px 35px rgba(28, 97, 234, 0.35)","&:hover":{background:`linear-gradient(135deg, ${A.palette.primary.dark}, ${A.palette.primary.main})`}},children:i.jsx(n$,{})})}),i.jsx(l8,{direction:"left",in:e,mountOnEnter:!0,unmountOnExit:!0,children:i.jsx(Z,{sx:{position:"fixed",top:0,bottom:0,right:0,width:"100%",zIndex:1500,display:"flex",flexDirection:"column"},children:i.jsxs(bt,{elevation:12,sx:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",borderRadius:0,border:`1px solid ${pn(A.palette.primary.main,.2)}`,backgroundColor:pn(A.palette.background.paper,.96),backdropFilter:"blur(10px)"},children:[H,i.jsx(Vn,{sx:{borderColor:pn("#fff",.18)}}),W,i.jsx(Vn,{}),ne]})})})]})},ju=240,$4=360,B4=0,Gre=0,Yre=0,U4=12,z4=280,W4=640,Kre=()=>{const[e,t]=Ae.useState(!1),r=kn(),n=Ds(),{logout:a,user:o}=Jn(),{unreadConversationCount:s}=mN(),[l,c]=x.useState(0),[u,d]=x.useState(!1),[f,h]=x.useState($4),[p,v]=x.useState(!!window.__backendUnavailableSince),[m,y]=x.useState(typeof navigator<"u"?navigator.onLine===!1:!1);x.useEffect(()=>{let M=!0;const L=async()=>{try{const z=await Sh();M&&c(z)}catch{}},q=setInterval(L,15e3);return L(),()=>{M=!1,clearInterval(q)}},[]),x.useEffect(()=>{const M=()=>y(!0),L=()=>y(!1),q=()=>v(!0),z=()=>v(!1);return window.addEventListener("offline",M),window.addEventListener("online",L),window.addEventListener("backend:unavailable",q),window.addEventListener("backend:available",z),()=>{window.removeEventListener("offline",M),window.removeEventListener("online",L),window.removeEventListener("backend:unavailable",q),window.removeEventListener("backend:available",z)}},[]);const b=()=>{t(!e)},_=()=>{a(),r("/login")},w=M=>"type"in M&&M.type==="header",A=x.useMemo(()=>({text:"Messages",icon:i.jsx(c8,{}),path:"/messaging",showUnreadDot:s>0}),[s]),P=M=>M,E=x.useMemo(()=>[{type:"header",text:"Dashboard"},{text:"Dashboard",icon:i.jsx(L2,{}),path:"/dashboard"},{text:"Tasks",icon:i.jsx(XS,{}),path:"/tasks"},A,{type:"header",text:"Purchasing"},{text:"Purchase Orders",icon:i.jsx(Bu,{}),path:"/open-purchase-orders"},{text:"Invoice Automator",icon:i.jsx(sg,{}),path:"/invoice-automator"},{text:"Return Orders",icon:i.jsx(lg,{}),path:"/return-orders"},{text:"Parts to Order",icon:i.jsx(li,{}),path:"/parts-to-order"},{text:"Vendors",icon:i.jsx(vI,{}),path:"/vendors"},{type:"header",text:"Sales"},{text:"Quotes",icon:i.jsx(R2,{}),path:"/quotes"},{text:"Sales Orders",icon:i.jsx(xs,{}),path:"/open-sales-orders"},{text:"Invoices",icon:i.jsx(xs,{}),path:"/invoices"},{text:"Customers",icon:i.jsx(Fh,{}),path:"/customers"},{type:"header",text:"Products & Inventory"},{text:"Products",icon:i.jsx(yI,{}),path:"/products"},{text:"Smart Search",icon:i.jsx(JS,{}),path:"/inventory/smart-search"},{text:"Stock",icon:i.jsx(li,{}),path:"/inventory"},{text:"Supply",icon:i.jsx(li,{}),path:"/supply"},{text:"Service",icon:i.jsx(li,{}),path:"/service"},{type:"header",text:"Time Tracking"},{text:"Attendance",icon:i.jsx(Nc,{}),path:"/attendance"},{text:"Time Tracking",icon:i.jsx(Nc,{}),path:"/time-tracking"},{text:"Time Tracking Reports",icon:i.jsx(xI,{}),path:"/time-tracking/reports"},{type:"header",text:"Human Resources"},{text:"Employees",icon:i.jsx(bI,{}),path:"/employees"},{text:"Profile Documents",icon:i.jsx(u8,{}),path:"/profile-documents"},{text:"Leave Management",icon:i.jsx(_I,{}),path:"/leave-management"},{text:"Mobile User Access",icon:i.jsx(Fh,{}),path:"/mobile-user-access"},{type:"header",text:"Settings"},{text:"Business Profile",icon:i.jsx(Vw,{}),path:"/business-profile"},{text:"Accounting",icon:i.jsx(cg,{}),path:"/qbo-account-mapping"},{text:"Global Variables",icon:i.jsx(cg,{}),path:"/margin-schedule"},{text:"Field Visibility",icon:i.jsx(wI,{}),path:"/field-visibility"},{text:"Email Settings",icon:i.jsx(ug,{}),path:"/email-settings"},{text:"Backup Management",icon:i.jsx(Gw,{}),path:"/backup-management"}],[A]),T=Ae.useMemo(()=>{if(o?.access_role==="Time Tracking")return[{type:"header",text:"Dashboard"},{text:"Attendance",icon:i.jsx(Nc,{}),path:"/attendance"},{text:"Time Tracking",icon:i.jsx(Nc,{}),path:"/time-tracking"},A,{type:"header",text:"Sales"},{text:"Sales Orders",icon:i.jsx(xs,{}),path:"/open-sales-orders"}];const M=[{type:"header",text:"Main"},{text:"Dashboard",icon:i.jsx(L2,{}),path:"/"},{text:"Tasks",icon:i.jsx(XS,{}),path:"/tasks"},A];return o?.access_role==="Sales and Purchase"?[...M,{type:"header",text:"Sales & Purchase"},{text:"Sales Orders",icon:i.jsx(xs,{}),path:"/open-sales-orders"},{text:"Invoices",icon:i.jsx(xs,{}),path:"/invoices"},{text:"Purchase Orders",icon:i.jsx(Bu,{}),path:"/open-purchase-orders"},{text:"Invoice Automator",icon:i.jsx(sg,{}),path:"/invoice-automator"},{text:"Return Orders",icon:i.jsx(lg,{}),path:"/return-orders"},{text:"Parts to Order",icon:i.jsx(li,{}),path:"/parts-to-order"},{type:"header",text:"Inventory"},{text:"Smart Search",icon:i.jsx(JS,{}),path:"/inventory/smart-search"},{text:"Stock",icon:i.jsx(li,{}),path:"/inventory"},{text:"Supply",icon:i.jsx(li,{}),path:"/supply"},{text:"Service",icon:i.jsx(li,{}),path:"/service"},{type:"header",text:"Settings"},{text:"Email Settings",icon:i.jsx(ug,{}),path:"/email-settings"}]:E},[o,E,A]),S=i.jsxs("div",{children:[i.jsx(rx,{}),i.jsx(pa,{children:T.map((M,L)=>{if(w(M))return i.jsx(d8,{sx:{bgcolor:"inherit",color:"text.secondary",fontWeight:"bold",fontSize:13,textAlign:"left",pl:2},children:M.text},`header-${M.text}-${L}`);const q=M;return i.jsxs(Sa,{onClick:()=>{const z=P(q.path);n.pathname!==z&&r(z),t(!1)},sx:{cursor:"pointer"},children:[i.jsx(f8,{children:q.showUnreadDot?i.jsx(Yw,{color:"error",variant:"dot",overlap:"circular",children:q.icon}):q.icon}),i.jsx(Qn,{primary:q.text,primaryTypographyProps:q.showUnreadDot?{fontWeight:600}:void 0})]},q.path||`${q.text}-${L}`)})})]}),I=f+B4+U4,U=`${I}px`,O=u?`calc(100% - ${ju}px - ${I}px)`:`calc(100% - ${ju}px)`;return i.jsxs(Z,{sx:{display:"flex"},children:[i.jsx(h8,{position:"fixed",sx:{left:{xs:0,sm:`${ju}px`},right:{xs:0,sm:u?U:0},width:{xs:"100%",sm:"auto"},transition:"right 0.2s ease"},children:i.jsxs(rx,{children:[i.jsx(xe,{color:"inherit",startIcon:i.jsx(jI,{}),onClick:()=>r(-1),sx:{mr:2,display:{xs:"none",sm:"inline-flex"}},children:"Back"}),i.jsx(vr,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:b,sx:{mr:2,display:{sm:"none"}},children:i.jsx(p8,{})}),i.jsxs(Z,{sx:{marginLeft:"auto",display:"flex",alignItems:"center",gap:2},children:[(p||m)&&i.jsx(Hn,{title:"We could not reach the server. Check your connection; pending events will sync automatically when back online.",children:i.jsxs(Z,{sx:{bgcolor:"orange",color:"black",px:1.5,py:.5,borderRadius:1,fontSize:12},children:["Offline",l?` - Pending: ${l}`:""]})}),i.jsx(xe,{color:"inherit",onClick:_,startIcon:i.jsx(m8,{}),children:"Logout"})]})]})}),i.jsxs(Z,{component:"nav",sx:{width:{sm:ju},flexShrink:{sm:0}},children:[i.jsx(ZS,{variant:"temporary",open:e,onClose:b,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",sm:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:ju}},children:S}),i.jsx(ZS,{variant:"permanent",sx:{display:{xs:"none",sm:"block"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:ju}},open:!0,children:S})]}),i.jsxs(Z,{component:"main",sx:{flexGrow:1,p:3,width:{xs:"100%",sm:O},transition:"width 0.2s ease"},children:[i.jsx(rx,{}),i.jsx(Mq,{})]}),i.jsx(Vre,{open:u,onOpen:()=>d(!0),onClose:()=>d(!1),panelWidth:$4,rightOffset:B4,desktopTopOffset:Gre,desktopWidth:f,onDesktopResize:M=>h(Math.min(Math.max(M,z4),W4)),desktopMinWidth:z4,desktopMaxWidth:W4,desktopHandleWidth:U4,desktopBottomOffset:Yre})]})},Qre=()=>{const e=kn(),{login:t}=Jn(),[r,n]=x.useState({email:"",password:""}),[a,o]=x.useState(null),[s,l]=x.useState(null),[c,u]=x.useState(!1),[d,f]=x.useState(!1);x.useEffect(()=>{const v=localStorage.getItem("rememberedEmail"),m=localStorage.getItem("rememberedPassword");v&&m&&(n({email:v,password:m}),f(!0));const y=localStorage.getItem("authRedirectMessage");y&&(l(y),localStorage.removeItem("authRedirectMessage"))},[]);const h=v=>{const{name:m,value:y}=v.target;n(b=>({...b,[m]:y}))},p=async v=>{v.preventDefault(),o(null),l(null),u(!0),d?(localStorage.setItem("rememberedEmail",r.email),localStorage.setItem("rememberedPassword",r.password)):(localStorage.removeItem("rememberedEmail"),localStorage.removeItem("rememberedPassword"));try{const m=await ve.post("/api/auth/login",r),{sessionToken:y,refreshToken:b,user:_}=m.data;t(y,b,_),_.access_role==="Time Tracking"?e("/time-tracking"):_.access_role==="Quotes"?e("/quotes"):e("/")}catch(m){console.error("Login error:",m);try{const y=localStorage.getItem("user"),b=y?JSON.parse(y):null,_=localStorage.getItem("sessionToken"),w=localStorage.getItem("refreshToken");if(b&&b.access_role==="Time Tracking"&&_&&w){e("/time-tracking");return}}catch{}navigator.onLine===!1?o("You appear to be offline. Reconnect to sign in or try again once you have internet."):o(m.response?.data?.message||"Failed to login. Please try again.")}finally{u(!1)}};return i.jsx(rr,{component:"main",maxWidth:"xs",children:i.jsx(Z,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:i.jsxs(bt,{elevation:3,sx:{padding:4,display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[i.jsx(B,{component:"h1",variant:"h5",gutterBottom:!0,children:"Sign In"}),s&&i.jsx(Pt,{severity:"info",sx:{width:"100%",mb:2},children:s}),a&&i.jsx(Pt,{severity:"error",sx:{width:"100%",mb:2},children:a}),i.jsxs(Z,{component:"form",onSubmit:p,sx:{mt:1,width:"100%"},children:[i.jsx(Pe,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:r.email,onChange:h}),i.jsx(Pe,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:r.password,onChange:h}),i.jsx(ui,{control:i.jsx(Xi,{value:"remember",color:"primary",checked:d,onChange:v=>f(v.target.checked)}),label:"Remember me"}),i.jsx(xe,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:c,children:c?"Signing in...":"Sign In"}),i.jsx(Z,{sx:{textAlign:"center"},children:i.jsx(g8,{component:BI,to:"/register",variant:"body2",children:"Don't have an account? Register your company"})})]})]})})})},Xre=()=>{const e=kn(),{login:t}=Jn(),[r,n]=x.useState({companyName:"",adminUsername:"",adminEmail:"",adminPassword:"",confirmPassword:""}),[a,o]=x.useState(null),[s,l]=x.useState(!1),c=d=>{const{name:f,value:h}=d.target;n(p=>({...p,[f]:h}))},u=async d=>{if(d.preventDefault(),o(null),r.adminPassword!==r.confirmPassword){o("Passwords do not match");return}l(!0);try{const f=await ve.post("/api/auth/register-company",{company_name:r.companyName,admin_username:r.adminUsername,admin_email:r.adminEmail,admin_password:r.adminPassword}),{sessionToken:h,refreshToken:p,user:v}=f.data;t(h,p,v),e("/dashboard")}catch(f){console.error("Registration error:",f),o(f.response?.data?.message||"Failed to register company. Please try again.")}finally{l(!1)}};return i.jsx(rr,{component:"main",maxWidth:"sm",children:i.jsx(Z,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:i.jsxs(bt,{elevation:3,sx:{padding:4,display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[i.jsx(B,{component:"h1",variant:"h5",gutterBottom:!0,children:"Register Your Company"}),a&&i.jsx(Pt,{severity:"error",sx:{width:"100%",mb:2},children:a}),i.jsxs(Z,{component:"form",onSubmit:u,sx:{mt:3,width:"100%"},children:[i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{required:!0,fullWidth:!0,label:"Company Name",name:"companyName",value:r.companyName,onChange:c})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{required:!0,fullWidth:!0,label:"Admin Username",name:"adminUsername",value:r.adminUsername,onChange:c})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{required:!0,fullWidth:!0,label:"Admin Email",name:"adminEmail",type:"email",value:r.adminEmail,onChange:c})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{required:!0,fullWidth:!0,label:"Admin Password",name:"adminPassword",type:"password",value:r.adminPassword,onChange:c})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{required:!0,fullWidth:!0,label:"Confirm Password",name:"confirmPassword",type:"password",value:r.confirmPassword,onChange:c})})]}),i.jsx(xe,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:s,children:s?"Registering...":"Register Company"})]})]})})})};var xf={},H4;function Jre(){if(H4)return xf;H4=1;var e=ir();Object.defineProperty(xf,"__esModule",{value:!0}),xf.default=void 0;var t=e(sr()),r=or();return xf.default=(0,t.default)((0,r.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),xf}var Zre=Jre();const Ts=Et(Zre);var bf={},V4;function ene(){if(V4)return bf;V4=1;var e=ir();Object.defineProperty(bf,"__esModule",{value:!0}),bf.default=void 0;var t=e(sr()),r=or();return bf.default=(0,t.default)((0,r.jsx)("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m0 4c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3m6 12H6v-1.4c0-2 4-3.1 6-3.1s6 1.1 6 3.1z"}),"AssignmentInd"),bf}var tne=ene();const rne=Et(tne);var _f={},G4;function nne(){if(G4)return _f;G4=1;var e=ir();Object.defineProperty(_f,"__esModule",{value:!0}),_f.default=void 0;var t=e(sr()),r=or();return _f.default=(0,t.default)((0,r.jsx)("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 18H4V8h16z"}),"CalendarToday"),_f}var ane=nne();const FL=Et(ane);var wf={},Y4;function ine(){if(Y4)return wf;Y4=1;var e=ir();Object.defineProperty(wf,"__esModule",{value:!0}),wf.default=void 0;var t=e(sr()),r=or();return wf.default=(0,t.default)([(0,r.jsx)("path",{d:"M12 5.99 19.53 19H4.47zM12 2 1 21h22z"},"0"),(0,r.jsx)("path",{d:"M13 16h-2v2h2zm0-6h-2v5h2z"},"1")],"WarningAmber"),wf}var one=ine();const $L=Et(one);var jf={},K4;function sne(){if(K4)return jf;K4=1;var e=ir();Object.defineProperty(jf,"__esModule",{value:!0}),jf.default=void 0;var t=e(sr()),r=or();return jf.default=(0,t.default)((0,r.jsx)("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-6 15h-2v-2h2zm0-4h-2V8h2zm-1-9c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"}),"AssignmentLate"),jf}var lne=sne();const cne=Et(lne);var Sf={},Q4;function une(){if(Q4)return Sf;Q4=1;var e=ir();Object.defineProperty(Sf,"__esModule",{value:!0}),Sf.default=void 0;var t=e(sr()),r=or();return Sf.default=(0,t.default)((0,r.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"ReportProblem"),Sf}var dne=une();const fne=Et(dne),hne=[{key:"myOpen",label:"My open tasks",icon:i.jsx(rne,{fontSize:"large"}),palette:"info"},{key:"myDueToday",label:"My tasks due today",icon:i.jsx(FL,{fontSize:"large"}),palette:"warning"},{key:"myOverdue",label:"My overdue tasks",icon:i.jsx($L,{fontSize:"large"}),palette:"error"},{key:"assignedByMeOverdue",label:"Overdue tasks I assigned",icon:i.jsx(cne,{fontSize:"large"}),palette:"secondary"},{key:"allOverdue",label:"All overdue tasks",icon:i.jsx(fne,{fontSize:"large"}),palette:"error"}],BL=({summary:e,loading:t,onRefresh:r,onViewTasks:n})=>{const a=e?.total??0;return i.jsxs(Rr,{sx:{borderRadius:3,overflow:"hidden",position:"relative",boxShadow:"0 24px 60px -32px rgba(15, 23, 42, 0.45)"},children:[i.jsx(Z,{sx:{position:"absolute",inset:0,background:"linear-gradient(140deg, rgba(59, 130, 246, 0.12) 0%, rgba(99, 102, 241, 0.08) 45%, rgba(168, 85, 247, 0.05) 100%)",pointerEvents:"none"}}),i.jsxs(Hr,{sx:{position:"relative",p:{xs:3,md:4}},children:[i.jsxs(ut,{direction:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},spacing:3,children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"overline",color:"text.secondary",sx:{letterSpacing:1.2},children:"Team workload snapshot"}),i.jsx(B,{variant:"h4",sx:{fontWeight:600},children:"Task overview"}),i.jsxs(B,{variant:"body1",color:"text.secondary",sx:{mt:.5},children:["Tracking ",i.jsx("strong",{children:a})," task",a===1?"":"s"," across your workspace."]})]}),i.jsxs(ut,{direction:{xs:"column",sm:"row"},spacing:1.5,width:{xs:"100%",sm:"auto"},children:[r&&i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Ts,{}),onClick:r,disabled:t,sx:{width:{xs:"100%",sm:"auto"}},children:"Refresh"}),n&&i.jsx(xe,{variant:"contained",onClick:n,sx:{width:{xs:"100%",sm:"auto"}},children:"View tasks"})]})]}),i.jsx(Z,{sx:{mt:4},children:t?i.jsx(Z,{display:"flex",justifyContent:"center",py:4,children:i.jsx(er,{})}):e?i.jsx(Z,{sx:{display:"grid",gap:2.5,gridTemplateColumns:{xs:"repeat(1, minmax(0, 1fr))",sm:"repeat(2, minmax(0, 1fr))",md:"repeat(3, minmax(0, 1fr))",lg:"repeat(5, minmax(0, 1fr))"}},children:hne.map(o=>i.jsxs(Z,{sx:s=>({borderRadius:3,p:3,display:"flex",flexDirection:"column",gap:1,border:`1px solid ${pn(s.palette[o.palette].main,.28)}`,background:`linear-gradient(135deg, ${pn(s.palette[o.palette].main,.18)} 0%, ${pn(s.palette[o.palette].main,.06)} 100%)`,boxShadow:`0 12px 30px -20px ${pn(s.palette[o.palette].main,.6)}`,color:s.palette.text.primary}),children:[i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:1.25},children:[i.jsx(Z,{sx:s=>({display:"inline-flex",alignItems:"center",justifyContent:"center",width:40,height:40,borderRadius:"50%",backgroundColor:pn(s.palette[o.palette].main,.2),color:s.palette[o.palette].dark}),children:o.icon}),i.jsx(B,{variant:"subtitle2",color:"text.secondary",children:o.label})]}),i.jsx(B,{variant:"h4",sx:{fontWeight:600},children:e[o.key]??0})]},o.key))}):i.jsx(B,{variant:"body2",color:"text.secondary",children:"Task data is not available yet. Create your first task to populate this overview."})})]})]})},pne=e=>{if(!e)return{};const t={};return e.status&&e.status.length>0&&(t.status=e.status.join(",")),typeof e.assignedTo=="number"&&(t.assignedTo=String(e.assignedTo)),e.dueFrom&&(t.dueFrom=e.dueFrom),e.dueTo&&(t.dueTo=e.dueTo),e.search&&(t.search=e.search.trim()),typeof e.includeCompleted=="boolean"&&(t.includeCompleted=String(e.includeCompleted)),typeof e.includeArchived=="boolean"&&(t.includeArchived=String(e.includeArchived)),t},mne=async e=>(await ve.get("/api/tasks",{params:pne(e)})).data.tasks,gne=async e=>(await ve.get(`/api/tasks/${e}/overview`)).data,vne=async e=>(await ve.post("/api/tasks",e)).data,yne=async(e,t)=>(await ve.put(`/api/tasks/${e}`,t)).data,xne=async(e,t)=>(await ve.patch(`/api/tasks/${e}/assignments`,{assigneeIds:t})).data,bne=async(e,t)=>(await ve.patch(`/api/tasks/${e}/complete`,{completed:t})).data,_ne=async(e,t)=>(await ve.post(`/api/tasks/${e}/notes`,{note:t})).data,wne=async e=>{await ve.delete(`/api/tasks/${e}`)},vw=async()=>(await ve.get("/api/tasks/summary")).data,jne=async()=>(await ve.get("/api/tasks/assignees")).data.assignees,Sne={Purchasing:i.jsx(Bu,{sx:{color:"primary.main"}}),Sales:i.jsx(xs,{sx:{color:"primary.main"}}),"Products & Inventory":i.jsx(li,{sx:{color:"primary.main"}}),"Time Tracking":i.jsx(Nc,{sx:{color:"primary.main"}}),"Human Resources":i.jsx(Fh,{sx:{color:"primary.main"}}),Settings:i.jsx(Vw,{sx:{color:"primary.main"}})},X4=()=>{const e=kn(),t=gI(),{user:r}=Jn(),[n,a]=x.useState(null),[o,s]=x.useState(!1),l=x.useCallback(async()=>{s(!0);try{const d=await vw();a(d)}catch(d){console.error("Failed to load task summary",d)}finally{s(!1)}},[]);x.useEffect(()=>{l()},[l]),console.log("[LandingPage] user:",r);let u=[{title:"Purchasing",items:[{title:"Purchase Orders",description:"Manage purchase orders",icon:i.jsx(Bu,{sx:{fontSize:40,color:"primary.main"}}),path:"/open-purchase-orders"},{title:"Invoice Automator",description:"Create purchase orders from invoice emails",icon:i.jsx(sg,{sx:{fontSize:40,color:"primary.main"}}),path:"/invoice-automator"},{title:"Return Orders",description:"Track vendor returns tied to POs",icon:i.jsx(lg,{sx:{fontSize:40,color:"primary.main"}}),path:"/return-orders"},{title:"Parts to Order",description:"Manage parts ordering",icon:i.jsx(li,{sx:{fontSize:40,color:"primary.main"}}),path:"/parts-to-order"},{title:"Vendors",description:"Manage your vendors",icon:i.jsx(vI,{sx:{fontSize:40,color:"primary.main"}}),path:"/vendors"}]},{title:"Sales",items:[{title:"Quotes",description:"Manage and track quotes",icon:i.jsx(R2,{sx:{fontSize:40,color:"primary.main"}}),path:"/quotes"},{title:"Sales Orders",description:"Manage sales orders",icon:i.jsx(xs,{sx:{fontSize:40,color:"primary.main"}}),path:"/open-sales-orders"},{title:"Invoices",description:"Track and edit invoices",icon:i.jsx(xs,{sx:{fontSize:40,color:"primary.main"}}),path:"/invoices"},{title:"Customers",description:"Track and manage your customer relationships",icon:i.jsx(Fh,{sx:{fontSize:40,color:"primary.main"}}),path:"/customers"}]},{title:"Products & Inventory",items:[{title:"Products",description:"Manage your products",icon:i.jsx(yI,{sx:{fontSize:40,color:"primary.main"}}),path:"/products"},{title:"Stock",description:"Manage your product inventory and stock levels",icon:i.jsx(li,{sx:{fontSize:40,color:"primary.main"}}),path:"/inventory"},{title:"Supply",description:"Manage supply and materials",icon:i.jsx(li,{sx:{fontSize:40,color:"primary.main"}}),path:"/supply"},{title:"Service",description:"Manage service line items",icon:i.jsx(li,{sx:{fontSize:40,color:"primary.main"}}),path:"/service"}]},{title:"Time Tracking",items:[{title:"Attendance",description:"View and manage attendance records",icon:i.jsx(Nc,{sx:{fontSize:40,color:"primary.main"}}),path:"/attendance"},{title:"Time Tracking",description:"Track employee time and project hours",icon:i.jsx(Nc,{sx:{fontSize:40,color:"primary.main"}}),path:"/time-tracking"},{title:"Time Tracking Reports",description:"View and export time tracking reports",icon:i.jsx(xI,{sx:{fontSize:40,color:"primary.main"}}),path:"/time-tracking/reports"}]},{title:"Human Resources",items:[{title:"Employees",description:"Manage employee accounts and roles",icon:i.jsx(bI,{sx:{fontSize:40,color:"primary.main"}}),path:"/employees"},{title:"Profile Documents",description:"Manage and track employee document access and read status",icon:i.jsx(Bu,{sx:{fontSize:40,color:"primary.main"}}),path:"/profile-documents"},{title:"Leave Management",description:"Manage employee leave requests and approvals",icon:i.jsx(_I,{sx:{fontSize:40,color:"primary.main"}}),path:"/leave-management"},{title:"Mobile User Access",description:"Manage mobile user access to profiles",icon:i.jsx(Fh,{sx:{fontSize:40,color:"primary.main"}}),path:"/mobile-user-access"}]},{title:"Settings",items:[{title:"Business Profile",description:"Manage your company information and settings",icon:i.jsx(Vw,{sx:{fontSize:40,color:"primary.main"}}),path:"/business-profile"},{title:"Accounting",description:"Configure QuickBooks account mappings",icon:i.jsx(cg,{sx:{fontSize:40,color:"primary.main"}}),path:"/qbo-account-mapping"},{title:"Global Variables",description:"Set and manage margin, labour, and overhead rates",icon:i.jsx(cg,{sx:{fontSize:40,color:"primary.main"}}),path:"/margin-schedule"},{title:"Email Settings",description:"Configure system email settings",icon:i.jsx(ug,{sx:{fontSize:40,color:"primary.main"}}),path:"/email-settings"},{title:"Backup Management",description:"Manage system backups and restores",icon:i.jsx(Gw,{sx:{fontSize:40,color:"primary.main"}}),path:"/backup-management"}]}];return r?.access_role==="Sales and Purchase"&&(u=[{title:"Sales & Purchase",items:[{title:"Sales Orders",description:"Manage sales orders",icon:i.jsx(xs,{sx:{fontSize:40,color:"primary.main"}}),path:"/open-sales-orders"},{title:"Invoices",description:"Track and edit invoices",icon:i.jsx(xs,{sx:{fontSize:40,color:"primary.main"}}),path:"/invoices"},{title:"Purchase Orders",description:"Manage purchase orders",icon:i.jsx(Bu,{sx:{fontSize:40,color:"primary.main"}}),path:"/open-purchase-orders"},{title:"Invoice Automator",description:"Create purchase orders from invoice emails",icon:i.jsx(sg,{sx:{fontSize:40,color:"primary.main"}}),path:"/invoice-automator"},{title:"Return Orders",description:"Track vendor returns tied to POs",icon:i.jsx(lg,{sx:{fontSize:40,color:"primary.main"}}),path:"/return-orders"},{title:"Parts to Order",description:"View parts that need to be ordered",icon:i.jsx(li,{sx:{fontSize:40,color:"primary.main"}}),path:"/parts-to-order"}]},{title:"Inventory",items:[{title:"Stock",description:"Manage your product inventory and stock levels",icon:i.jsx(li,{sx:{fontSize:40,color:"primary.main"}}),path:"/inventory"},{title:"Supply",description:"Manage supply and materials",icon:i.jsx(li,{sx:{fontSize:40,color:"primary.main"}}),path:"/supply"},{title:"Service",description:"Manage service line items",icon:i.jsx(li,{sx:{fontSize:40,color:"primary.main"}}),path:"/service"}]},{title:"Settings",items:[{title:"Email Settings",description:"Configure your email settings",icon:i.jsx(ug,{sx:{fontSize:40,color:"primary.main"}}),path:"/email-settings"}]}]),r?.access_role==="Quotes"&&(u=[{title:"Quotes",items:[{title:"Quotes",description:"Manage and track quotes",icon:i.jsx(R2,{sx:{fontSize:40,color:"primary.main"}}),path:"/quotes"}]}]),console.log("[LandingPage] filteredSections:",u),i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{background:`linear-gradient(90deg, ${t.palette.primary.main} 0%, ${t.palette.secondary.main} 100%)`,borderRadius:3,p:4,mb:6,color:t.palette.primary.contrastText,boxShadow:3,textAlign:"center"},children:[i.jsx(B,{variant:"h3",component:"h1",gutterBottom:!0,sx:{color:"inherit"},children:"Welcome to Aiven"}),i.jsx(B,{variant:"h5",component:"h2",gutterBottom:!0,sx:{color:"inherit",opacity:.85},children:"Your all-in-one business management solution"})]}),i.jsx(Z,{sx:{mb:6},children:i.jsx(BL,{summary:n,loading:o,onRefresh:l,onViewTasks:()=>e("/tasks")})}),u.map((d,f)=>i.jsx(e5,{in:!0,timeout:700+f*200,children:i.jsxs(Z,{sx:{mt:6,mb:4,p:3,borderRadius:3,background:t.palette.mode==="light"?t.palette.grey[50]:t.palette.grey[900],boxShadow:1},children:[i.jsxs(Z,{sx:{display:"flex",alignItems:"center",mb:2},children:[i.jsx(kp,{sx:{bgcolor:"primary.main",mr:2},children:Sne[d.title]||i.jsx(L2,{sx:{color:"primary.main"}})}),i.jsx(B,{variant:"h4",component:"h2",sx:{color:"primary.main",fontWeight:600},children:d.title})]}),i.jsx(ie,{container:!0,spacing:4,children:d.items.map((h,p)=>i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(e5,{in:!0,timeout:900+p*150,children:i.jsx(Rr,{sx:{height:"100%",display:"flex",flexDirection:"column",borderRadius:2,boxShadow:2,transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-6px) scale(1.03)",boxShadow:6,cursor:"pointer"},bgcolor:"background.paper"},onClick:()=>e(h.path),tabIndex:0,role:"button","aria-label":h.title,children:i.jsxs(Hr,{sx:{flexGrow:1,textAlign:"center"},children:[h.icon,i.jsx(B,{gutterBottom:!0,variant:"h5",component:"h2",children:h.title}),i.jsx(B,{children:h.description})]})})})},p))}),f<u.length-1&&i.jsx(Vn,{sx:{mt:4,mb:2}})]})},d.title))]})};var Cf={},J4;function Cne(){if(J4)return Cf;J4=1;var e=ir();Object.defineProperty(Cf,"__esModule",{value:!0}),Cf.default=void 0;var t=e(sr()),r=or();return Cf.default=(0,t.default)((0,r.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),Cf}var Ane=Cne();const ga=Et(Ane);var Af={},Z4;function Pne(){if(Z4)return Af;Z4=1;var e=ir();Object.defineProperty(Af,"__esModule",{value:!0}),Af.default=void 0;var t=e(sr()),r=or();return Af.default=(0,t.default)((0,r.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),Af}var One=Pne();const Cp=Et(One);var Pf={},eE;function kne(){if(eE)return Pf;eE=1;var e=ir();Object.defineProperty(Pf,"__esModule",{value:!0}),Pf.default=void 0;var t=e(sr()),r=or();return Pf.default=(0,t.default)((0,r.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),Pf}var Ene=kne();const tu=Et(Ene),Ap=e=>typeof e=="number"&&!isNaN(e),Uc=e=>typeof e=="string",jo=e=>typeof e=="function",Qm=e=>Uc(e)||jo(e)?e:null,yw=e=>x.isValidElement(e)||Uc(e)||jo(e)||Ap(e);function Tne(e,t,r){r===void 0&&(r=300);const{scrollHeight:n,style:a}=e;requestAnimationFrame(()=>{a.minHeight="initial",a.height=n+"px",a.transition=`all ${r}ms`,requestAnimationFrame(()=>{a.height="0",a.padding="0",a.margin="0",setTimeout(t,r)})})}function Sy(e){let{enter:t,exit:r,appendPosition:n=!1,collapse:a=!0,collapseDuration:o=300}=e;return function(s){let{children:l,position:c,preventExitTransition:u,done:d,nodeRef:f,isIn:h,playToast:p}=s;const v=n?`${t}--${c}`:t,m=n?`${r}--${c}`:r,y=x.useRef(0);return x.useLayoutEffect(()=>{const b=f.current,_=v.split(" "),w=A=>{A.target===f.current&&(p(),b.removeEventListener("animationend",w),b.removeEventListener("animationcancel",w),y.current===0&&A.type!=="animationcancel"&&b.classList.remove(..._))};b.classList.add(..._),b.addEventListener("animationend",w),b.addEventListener("animationcancel",w)},[]),x.useEffect(()=>{const b=f.current,_=()=>{b.removeEventListener("animationend",_),a?Tne(b,d,o):d()};h||(u?_():(y.current=1,b.className+=` ${m}`,b.addEventListener("animationend",_)))},[h]),Ae.createElement(Ae.Fragment,null,l)}}function tE(e,t){return e!=null?{content:e.content,containerId:e.props.containerId,id:e.props.toastId,theme:e.props.theme,type:e.props.type,data:e.props.data||{},isLoading:e.props.isLoading,icon:e.props.icon,status:t}:{}}const Di=new Map;let Pp=[];const xw=new Set,Ine=e=>xw.forEach(t=>t(e)),UL=()=>Di.size>0;function zL(e,t){var r;if(t)return!((r=Di.get(t))==null||!r.isToastActive(e));let n=!1;return Di.forEach(a=>{a.isToastActive(e)&&(n=!0)}),n}function WL(e,t){yw(e)&&(UL()||Pp.push({content:e,options:t}),Di.forEach(r=>{r.buildToast(e,t)}))}function rE(e,t){Di.forEach(r=>{t!=null&&t!=null&&t.containerId?t?.containerId===r.id&&r.toggle(e,t?.id):r.toggle(e,t?.id)})}function Nne(e){const{subscribe:t,getSnapshot:r,setProps:n}=x.useRef(function(o){const s=o.containerId||1;return{subscribe(l){const c=function(d,f,h){let p=1,v=0,m=[],y=[],b=[],_=f;const w=new Map,A=new Set,P=()=>{b=Array.from(w.values()),A.forEach(S=>S())},E=S=>{y=S==null?[]:y.filter(I=>I!==S),P()},T=S=>{const{toastId:I,onOpen:U,updateId:O,children:M}=S.props,L=O==null;S.staleId&&w.delete(S.staleId),w.set(I,S),y=[...y,S.props.toastId].filter(q=>q!==S.staleId),P(),h(tE(S,L?"added":"updated")),L&&jo(U)&&U(x.isValidElement(M)&&M.props)};return{id:d,props:_,observe:S=>(A.add(S),()=>A.delete(S)),toggle:(S,I)=>{w.forEach(U=>{I!=null&&I!==U.props.toastId||jo(U.toggle)&&U.toggle(S)})},removeToast:E,toasts:w,clearQueue:()=>{v-=m.length,m=[]},buildToast:(S,I)=>{if((C=>{let{containerId:N,toastId:H,updateId:W}=C;const ne=N?N!==d:d!==1,se=w.has(H)&&W==null;return ne||se})(I))return;const{toastId:U,updateId:O,data:M,staleId:L,delay:q}=I,z=()=>{E(U)},K=O==null;K&&v++;const J={..._,style:_.toastStyle,key:p++,...Object.fromEntries(Object.entries(I).filter(C=>{let[N,H]=C;return H!=null})),toastId:U,updateId:O,data:M,closeToast:z,isIn:!1,className:Qm(I.className||_.toastClassName),bodyClassName:Qm(I.bodyClassName||_.bodyClassName),progressClassName:Qm(I.progressClassName||_.progressClassName),autoClose:!I.isLoading&&(R=I.autoClose,k=_.autoClose,R===!1||Ap(R)&&R>0?R:k),deleteToast(){const C=w.get(U),{onClose:N,children:H}=C.props;jo(N)&&N(x.isValidElement(H)&&H.props),h(tE(C,"removed")),w.delete(U),v--,v<0&&(v=0),m.length>0?T(m.shift()):P()}};var R,k;J.closeButton=_.closeButton,I.closeButton===!1||yw(I.closeButton)?J.closeButton=I.closeButton:I.closeButton===!0&&(J.closeButton=!yw(_.closeButton)||_.closeButton);let $=S;x.isValidElement(S)&&!Uc(S.type)?$=x.cloneElement(S,{closeToast:z,toastProps:J,data:M}):jo(S)&&($=S({closeToast:z,toastProps:J,data:M}));const X={content:$,props:J,staleId:L};_.limit&&_.limit>0&&v>_.limit&&K?m.push(X):Ap(q)?setTimeout(()=>{T(X)},q):T(X)},setProps(S){_=S},setToggle:(S,I)=>{w.get(S).toggle=I},isToastActive:S=>y.some(I=>I===S),getSnapshot:()=>b}}(s,o,Ine);Di.set(s,c);const u=c.observe(l);return Pp.forEach(d=>WL(d.content,d.options)),Pp=[],()=>{u(),Di.delete(s)}},setProps(l){var c;(c=Di.get(s))==null||c.setProps(l)},getSnapshot(){var l;return(l=Di.get(s))==null?void 0:l.getSnapshot()}}}(e)).current;n(e);const a=x.useSyncExternalStore(t,r,r);return{getToastToRender:function(o){if(!a)return[];const s=new Map;return e.newestOnTop&&a.reverse(),a.forEach(l=>{const{position:c}=l.props;s.has(c)||s.set(c,[]),s.get(c).push(l)}),Array.from(s,l=>o(l[0],l[1]))},isToastActive:zL,count:a?.length}}function Dne(e){const[t,r]=x.useState(!1),[n,a]=x.useState(!1),o=x.useRef(null),s=x.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:l,pauseOnHover:c,closeToast:u,onClick:d,closeOnClick:f}=e;var h,p;function v(){r(!0)}function m(){r(!1)}function y(w){const A=o.current;s.canDrag&&A&&(s.didMove=!0,t&&m(),s.delta=e.draggableDirection==="x"?w.clientX-s.start:w.clientY-s.start,s.start!==w.clientX&&(s.canCloseOnClick=!1),A.style.transform=`translate3d(${e.draggableDirection==="x"?`${s.delta}px, var(--y)`:`0, calc(${s.delta}px + var(--y))`},0)`,A.style.opacity=""+(1-Math.abs(s.delta/s.removalDistance)))}function b(){document.removeEventListener("pointermove",y),document.removeEventListener("pointerup",b);const w=o.current;if(s.canDrag&&s.didMove&&w){if(s.canDrag=!1,Math.abs(s.delta)>s.removalDistance)return a(!0),e.closeToast(),void e.collapseAll();w.style.transition="transform 0.2s, opacity 0.2s",w.style.removeProperty("transform"),w.style.removeProperty("opacity")}}(p=Di.get((h={id:e.toastId,containerId:e.containerId,fn:r}).containerId||1))==null||p.setToggle(h.id,h.fn),x.useEffect(()=>{if(e.pauseOnFocusLoss)return document.hasFocus()||m(),window.addEventListener("focus",v),window.addEventListener("blur",m),()=>{window.removeEventListener("focus",v),window.removeEventListener("blur",m)}},[e.pauseOnFocusLoss]);const _={onPointerDown:function(w){if(e.draggable===!0||e.draggable===w.pointerType){s.didMove=!1,document.addEventListener("pointermove",y),document.addEventListener("pointerup",b);const A=o.current;s.canCloseOnClick=!0,s.canDrag=!0,A.style.transition="none",e.draggableDirection==="x"?(s.start=w.clientX,s.removalDistance=A.offsetWidth*(e.draggablePercent/100)):(s.start=w.clientY,s.removalDistance=A.offsetHeight*(e.draggablePercent===80?1.5*e.draggablePercent:e.draggablePercent)/100)}},onPointerUp:function(w){const{top:A,bottom:P,left:E,right:T}=o.current.getBoundingClientRect();w.nativeEvent.type!=="touchend"&&e.pauseOnHover&&w.clientX>=E&&w.clientX<=T&&w.clientY>=A&&w.clientY<=P?m():v()}};return l&&c&&(_.onMouseEnter=m,e.stacked||(_.onMouseLeave=v)),f&&(_.onClick=w=>{d&&d(w),s.canCloseOnClick&&u()}),{playToast:v,pauseToast:m,isRunning:t,preventExitTransition:n,toastRef:o,eventHandlers:_}}function Mne(e){let{delay:t,isRunning:r,closeToast:n,type:a="default",hide:o,className:s,style:l,controlledProgress:c,progress:u,rtl:d,isIn:f,theme:h}=e;const p=o||c&&u===0,v={...l,animationDuration:`${t}ms`,animationPlayState:r?"running":"paused"};c&&(v.transform=`scaleX(${u})`);const m=Pr("Toastify__progress-bar",c?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${h}`,`Toastify__progress-bar--${a}`,{"Toastify__progress-bar--rtl":d}),y=jo(s)?s({rtl:d,type:a,defaultClassName:m}):Pr(m,s),b={[c&&u>=1?"onTransitionEnd":"onAnimationEnd"]:c&&u<1?null:()=>{f&&n()}};return Ae.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":p},Ae.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${h} Toastify__progress-bar--${a}`}),Ae.createElement("div",{role:"progressbar","aria-hidden":p?"true":"false","aria-label":"notification timer",className:y,style:v,...b}))}let Lne=1;const HL=()=>""+Lne++;function Rne(e){return e&&(Uc(e.toastId)||Ap(e.toastId))?e.toastId:HL()}function Lh(e,t){return WL(e,t),t.toastId}function pv(e,t){return{...t,type:t&&t.type||e,toastId:Rne(t)}}function km(e){return(t,r)=>Lh(t,pv(e,r))}function me(e,t){return Lh(e,pv("default",t))}me.loading=(e,t)=>Lh(e,pv("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...t})),me.promise=function(e,t,r){let n,{pending:a,error:o,success:s}=t;a&&(n=Uc(a)?me.loading(a,r):me.loading(a.render,{...r,...a}));const l={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},c=(d,f,h)=>{if(f==null)return void me.dismiss(n);const p={type:d,...l,...r,data:h},v=Uc(f)?{render:f}:f;return n?me.update(n,{...p,...v}):me(v.render,{...p,...v}),h},u=jo(e)?e():e;return u.then(d=>c("success",s,d)).catch(d=>c("error",o,d)),u},me.success=km("success"),me.info=km("info"),me.error=km("error"),me.warning=km("warning"),me.warn=me.warning,me.dark=(e,t)=>Lh(e,pv("default",{theme:"dark",...t})),me.dismiss=function(e){(function(t){var r;if(UL()){if(t==null||Uc(r=t)||Ap(r))Di.forEach(n=>{n.removeToast(t)});else if(t&&("containerId"in t||"id"in t)){const n=Di.get(t.containerId);n?n.removeToast(t.id):Di.forEach(a=>{a.removeToast(t.id)})}}else Pp=Pp.filter(n=>t!=null&&n.options.toastId!==t)})(e)},me.clearWaitingQueue=function(e){e===void 0&&(e={}),Di.forEach(t=>{!t.props.limit||e.containerId&&t.id!==e.containerId||t.clearQueue()})},me.isActive=zL,me.update=function(e,t){t===void 0&&(t={});const r=((n,a)=>{var o;let{containerId:s}=a;return(o=Di.get(s||1))==null?void 0:o.toasts.get(n)})(e,t);if(r){const{props:n,content:a}=r,o={delay:100,...n,...t,toastId:t.toastId||e,updateId:HL()};o.toastId!==e&&(o.staleId=e);const s=o.render||a;delete o.render,Lh(s,o)}},me.done=e=>{me.update(e,{progress:1})},me.onChange=function(e){return xw.add(e),()=>{xw.delete(e)}},me.play=e=>rE(!0,e),me.pause=e=>rE(!1,e);const qne=typeof window<"u"?x.useLayoutEffect:x.useEffect,Em=e=>{let{theme:t,type:r,isLoading:n,...a}=e;return Ae.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:t==="colored"?"currentColor":`var(--toastify-icon-color-${r})`,...a})},d2={info:function(e){return Ae.createElement(Em,{...e},Ae.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(e){return Ae.createElement(Em,{...e},Ae.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(e){return Ae.createElement(Em,{...e},Ae.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(e){return Ae.createElement(Em,{...e},Ae.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return Ae.createElement("div",{className:"Toastify__spinner"})}},Fne=e=>{const{isRunning:t,preventExitTransition:r,toastRef:n,eventHandlers:a,playToast:o}=Dne(e),{closeButton:s,children:l,autoClose:c,onClick:u,type:d,hideProgressBar:f,closeToast:h,transition:p,position:v,className:m,style:y,bodyClassName:b,bodyStyle:_,progressClassName:w,progressStyle:A,updateId:P,role:E,progress:T,rtl:S,toastId:I,deleteToast:U,isIn:O,isLoading:M,closeOnClick:L,theme:q}=e,z=Pr("Toastify__toast",`Toastify__toast-theme--${q}`,`Toastify__toast--${d}`,{"Toastify__toast--rtl":S},{"Toastify__toast--close-on-click":L}),K=jo(m)?m({rtl:S,position:v,type:d,defaultClassName:z}):Pr(z,m),J=function(X){let{theme:C,type:N,isLoading:H,icon:W}=X,ne=null;const se={theme:C,type:N};return W===!1||(jo(W)?ne=W({...se,isLoading:H}):x.isValidElement(W)?ne=x.cloneElement(W,se):H?ne=d2.spinner():(oe=>oe in d2)(N)&&(ne=d2[N](se))),ne}(e),R=!!T||!c,k={closeToast:h,type:d,theme:q};let $=null;return s===!1||($=jo(s)?s(k):x.isValidElement(s)?x.cloneElement(s,k):function(X){let{closeToast:C,theme:N,ariaLabel:H="close"}=X;return Ae.createElement("button",{className:`Toastify__close-button Toastify__close-button--${N}`,type:"button",onClick:W=>{W.stopPropagation(),C(W)},"aria-label":H},Ae.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},Ae.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}(k)),Ae.createElement(p,{isIn:O,done:U,position:v,preventExitTransition:r,nodeRef:n,playToast:o},Ae.createElement("div",{id:I,onClick:u,"data-in":O,className:K,...a,style:y,ref:n},Ae.createElement("div",{...O&&{role:E},className:jo(b)?b({type:d}):Pr("Toastify__toast-body",b),style:_},J!=null&&Ae.createElement("div",{className:Pr("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!M})},J),Ae.createElement("div",null,l)),$,Ae.createElement(Mne,{...P&&!R?{key:`pb-${P}`}:{},rtl:S,theme:q,delay:c,isRunning:t,isIn:O,closeToast:h,hide:f,type:d,style:A,className:w,controlledProgress:R,progress:T||0})))},Cy=function(e,t){return t===void 0&&(t=!1),{enter:`Toastify--animate Toastify__${e}-enter`,exit:`Toastify--animate Toastify__${e}-exit`,appendPosition:t}},$ne=Sy(Cy("bounce",!0));Sy(Cy("slide",!0));Sy(Cy("zoom"));Sy(Cy("flip"));const Bne={position:"top-right",transition:$ne,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"};function Une(e){let t={...Bne,...e};const r=e.stacked,[n,a]=x.useState(!0),o=x.useRef(null),{getToastToRender:s,isToastActive:l,count:c}=Nne(t),{className:u,style:d,rtl:f,containerId:h}=t;function p(m){const y=Pr("Toastify__toast-container",`Toastify__toast-container--${m}`,{"Toastify__toast-container--rtl":f});return jo(u)?u({position:m,rtl:f,defaultClassName:y}):Pr(y,Qm(u))}function v(){r&&(a(!0),me.play())}return qne(()=>{if(r){var m;const y=o.current.querySelectorAll('[data-in="true"]'),b=12,_=(m=t.position)==null?void 0:m.includes("top");let w=0,A=0;Array.from(y).reverse().forEach((P,E)=>{const T=P;T.classList.add("Toastify__toast--stacked"),E>0&&(T.dataset.collapsed=`${n}`),T.dataset.pos||(T.dataset.pos=_?"top":"bot");const S=w*(n?.2:1)+(n?0:b*E);T.style.setProperty("--y",`${_?S:-1*S}px`),T.style.setProperty("--g",`${b}`),T.style.setProperty("--s",""+(1-(n?A:0))),w+=T.offsetHeight,A+=.025})}},[n,c,r]),Ae.createElement("div",{ref:o,className:"Toastify",id:h,onMouseEnter:()=>{r&&(a(!1),me.pause())},onMouseLeave:v},s((m,y)=>{const b=y.length?{...d}:{...d,pointerEvents:"none"};return Ae.createElement("div",{className:p(m),style:b,key:`container-${m}`},y.map(_=>{let{content:w,props:A}=_;return Ae.createElement(Fne,{...A,stacked:r,collapseAll:v,isIn:l(A.toastId,A.containerId),style:A.style,key:`toast-${A.key}`},w)}))}))}const Kl="/assets/default-logo-BbiCiEKs.png",za=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),zne=e=>{const t=Number(e);if(!Number.isFinite(t))return"0.00";let n=Number(t.toFixed(4)).toFixed(4);if(n=n.replace(/0+$/,""),n.endsWith(".")&&(n=n.slice(0,-1)),!n.includes("."))return`${n}.00`;const[a,o]=n.split(".");return o.length<2?`${a}.${o.padEnd(2,"0")}`:n},nE=e=>{if(console.log("getLogoUrl called with:",e),!e)return console.log("No logo URL provided, using default"),Kl;if(e.startsWith("http://")||e.startsWith("https://"))return console.log("Logo URL is already a full URL:",e),e;if(e.includes("\\")||e.includes(":/")||e.includes(":\\")){const n=e.split(/[\\\/]/).pop()||e;if(console.log("Extracted filename from Windows path:",n),!n||n===e)return console.warn("Could not extract valid filename from Windows path, using default"),Kl;const{baseURL:a}=Wu(),o=`${a.replace(/\/$/,"")}/uploads/${n}`;return console.log("Built final URL from Windows path:",o),o}if(e.startsWith("/")){const n=e.split("/").pop()||e;if(console.log("Extracted filename from Unix path:",n),!n||n===e)return console.warn("Could not extract valid filename from Unix path, using default"),Kl;const{baseURL:a}=Wu(),o=`${a.replace(/\/$/,"")}/uploads/${n}`;return console.log("Built final URL from Unix path:",o),o}if(e.includes("\\")||e.includes(":/")||e.includes(":\\"))return console.warn("Invalid filename format, using default"),Kl;const{baseURL:t}=Wu(),r=`${t.replace(/\/$/,"")}/uploads/${e}`;return console.log("Built final URL from filename:",r),r};Wu().baseURL;const Wne=()=>{kn();const[e,t]=x.useState({id:"",business_name:"",street_address:"",city:"",province:"",country:"",postal_code:"",telephone_number:"",email:"",business_number:"",website:"",logo_url:"",geo_fence_enabled:!1,geo_fence_center_latitude:"",geo_fence_center_longitude:"",geo_fence_radius_meters:"",created_at:"",updated_at:""}),[r,n]=x.useState(!1),[a,o]=x.useState(null),[s,l]=x.useState(null),[c,u]=x.useState(!1),d=w=>({id:w.id||"",business_name:w.business_name||"",street_address:w.street_address||"",city:w.city||"",province:w.province||"",country:w.country||"",postal_code:w.postal_code||"",telephone_number:w.telephone_number||"",email:w.email||"",business_number:w.business_number||"",website:w.website||"",logo_url:w.logo_url||"",geo_fence_enabled:!!w.geo_fence_enabled,geo_fence_center_latitude:w.geo_fence_center_latitude??"",geo_fence_center_longitude:w.geo_fence_center_longitude??"",geo_fence_radius_meters:w.geo_fence_radius_meters??"",created_at:w.created_at||"",updated_at:w.updated_at||""});x.useEffect(()=>{f()},[]);const f=async()=>{try{const w=await ve.get("/api/business-profile");console.log("Business Profile API Response:",w.data),console.log("Logo URL from API:",w.data.logo_url),t(d(w.data))}catch(w){if(w.response?.status===404){u(!0);return}console.error("Error fetching business profile:",w),me.error("Failed to load business profile")}},h=w=>{const{name:A,value:P}=w.target;t(E=>({...E,[A]:P}))},p=w=>{if(w.target.files&&w.target.files[0]){const A=w.target.files[0];o(A);const P=URL.createObjectURL(A);l(P)}},v=async()=>{if(e.logo_url)try{n(!0),await ve.delete("/api/business-profile/logo"),t(w=>({...w,logo_url:""})),me.success("Logo deleted successfully")}catch(w){console.error("Error deleting logo:",w),me.error("Failed to delete logo")}finally{n(!1)}},m=async w=>{w.preventDefault(),n(!0);try{const A=new FormData;Object.entries(e).forEach(([P,E])=>{let T=P;switch(P){case"business_name":T="business_name";break;case"street_address":T="street_address";break;case"telephone_number":T="telephone_number";break;case"business_number":T="business_number";break;case"email":T="email";break;case"website":T="website";break;case"city":T="city";break;case"province":T="province";break;case"country":T="country";break;case"postal_code":T="postal_code";break;case"logo_url":return;case"id":case"created_at":case"updated_at":return}E!=null&&A.append(T,E)}),a&&A.append("logo",a),console.log("Form data being sent:");for(let[P,E]of A.entries())console.log(`${P}:`,E);await ve.post("/api/business-profile",A,{headers:{"Content-Type":"multipart/form-data"}}),me.success("Business profile updated successfully"),u(!1),o(null),l(null),f()}catch(A){console.error("Error updating business profile:",A),console.error("Error response:",A.response),console.error("Error message:",A.message),A.response?.status===401?me.error("Authentication failed. Please log in again."):A.response?.status===403?me.error("Access denied. You do not have permission to update the business profile."):A.response?.status===404?me.error("Business profile endpoint not found. Please check your API configuration."):A.response?.status===500?me.error("Server error. Please try again later."):A.code==="NETWORK_ERROR"?me.error("Network error. Please check your connection and try again."):A.message?.includes("timeout")?me.error("Request timed out. Please try again."):me.error(`Failed to update business profile: ${A.response?.data?.error||A.message||"Unknown error"}`)}finally{n(!1)}},y=()=>{u(!1),o(null),l(null),e.id?f():t({id:"",business_name:"",street_address:"",city:"",province:"",country:"",postal_code:"",telephone_number:"",email:"",business_number:"",logo_url:"",geo_fence_enabled:!1,geo_fence_center_latitude:"",geo_fence_center_longitude:"",geo_fence_radius_meters:"",created_at:"",updated_at:""})};if(r)return i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:i.jsx(er,{})});const b=()=>{const w=!!e.id;return i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"flex-start",minHeight:"70vh",children:i.jsx(bt,{sx:{p:{xs:2,md:4},width:"100%",maxWidth:650,borderRadius:4,boxShadow:6,bgcolor:"background.paper"},elevation:6,children:i.jsxs(ut,{spacing:4,children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsx(B,{variant:"h5",fontWeight:700,color:"primary.main",children:w?"Current Business Profile":"Business Profile"}),i.jsx(Z,{children:i.jsx(xe,{variant:"contained",startIcon:i.jsx(tu,{}),onClick:()=>u(!0),sx:{borderRadius:2,fontWeight:600},children:w?"Edit Profile":"Create Profile"})})]}),i.jsx(Vn,{sx:{bgcolor:"primary.light",height:3,borderRadius:2}}),w?i.jsxs(i.Fragment,{children:[e.logo_url&&i.jsxs(Z,{display:"flex",flexDirection:"column",alignItems:"center",mb:2,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,color:"primary.dark",gutterBottom:!0,children:"Business Logo"}),i.jsx(Rr,{sx:{maxWidth:180,borderRadius:3,boxShadow:3,border:"2px solid",borderColor:"primary.light",p:1,mb:1,bgcolor:"grey.50"},children:i.jsx(t5,{component:"img",image:e.logo_url?nE(e.logo_url):Kl,onError:A=>A.currentTarget.src=Kl,alt:"Business Logo",sx:{height:120,objectFit:"contain",borderRadius:2,bgcolor:"white"}})})]}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Business Name"}),i.jsx(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:e.business_name})]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Business Number"}),i.jsx(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:e.business_number})]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Address"}),i.jsxs(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:[e.street_address,i.jsx("br",{}),e.city,", ",e.province,e.postal_code?`, ${e.postal_code}`:"",i.jsx("br",{}),e.country]})]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Email"}),i.jsx(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:e.email})]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Telephone"}),i.jsx(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:e.telephone_number})]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Website"}),i.jsx(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:e.website?i.jsx("a",{href:e.website.startsWith("http")?e.website:`https://${e.website}`,target:"_blank",rel:"noopener noreferrer",style:{color:"inherit",textDecoration:"underline"},children:e.website}):"Not provided"})]}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Attendance Geofence"}),e.geo_fence_enabled?i.jsxs(Z,{sx:{p:2,border:"1px solid",borderColor:"primary.light",borderRadius:2,bgcolor:"grey.50"},children:[i.jsx(B,{variant:"body1",fontWeight:600,children:"Enabled"}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Lat: ",e.geo_fence_center_latitude||""," | Lng: ",e.geo_fence_center_longitude||""]}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Radius: ",e.geo_fence_radius_meters||""," meters"]})]}):i.jsx(B,{variant:"body1",fontWeight:500,mb:2,children:"Disabled"})]})]})]}):i.jsxs(Z,{textAlign:"center",py:4,children:[i.jsx(B,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Business Profile Found"}),i.jsx(B,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Create your business profile to get started. This information will be used in your quotes, invoices, and other business documents."}),i.jsx(xe,{variant:"contained",size:"large",startIcon:i.jsx(tu,{}),onClick:()=>u(!0),sx:{borderRadius:2,fontWeight:600},children:"Create Business Profile"})]})]})})})},_=()=>i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"flex-start",minHeight:"70vh",children:i.jsx(bt,{sx:{p:{xs:2,md:4},width:"100%",maxWidth:650,borderRadius:4,boxShadow:6,bgcolor:"background.paper"},elevation:6,component:"form",onSubmit:m,children:i.jsxs(ut,{spacing:4,children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsx(B,{variant:"h5",fontWeight:700,color:"primary.main",children:e.id?"Edit Business Profile":"Create Business Profile"}),i.jsxs(Z,{children:[i.jsx(xe,{variant:"outlined",onClick:y,sx:{borderRadius:2,fontWeight:600,mr:2},children:"Cancel"}),i.jsx(xe,{variant:"contained",type:"submit",disabled:r,sx:{borderRadius:2,fontWeight:600},children:r?i.jsx(er,{size:24}):e.id?"Save Changes":"Create Profile"})]})]}),i.jsx(Vn,{sx:{bgcolor:"primary.light",height:3,borderRadius:2}}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Business Name",name:"business_name",value:e.business_name,onChange:h,fullWidth:!0,required:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Business Number/GST-HST Registration Number",name:"business_number",value:e.business_number,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Street Address",name:"street_address",value:e.street_address,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"City",name:"city",value:e.city,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Province",name:"province",value:e.province,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Country",name:"country",value:e.country,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Postal Code",name:"postal_code",value:e.postal_code,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Telephone Number",name:"telephone_number",value:e.telephone_number,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Email",name:"email",value:e.email,onChange:h,fullWidth:!0,type:"email"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Website",name:"website",value:e.website,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsxs(Z,{sx:{border:"1px solid",borderColor:"divider",borderRadius:2,p:2,bgcolor:"grey.50"},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle1",fontWeight:700,children:"Attendance Geofence"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Require staff to be inside this fence to clock in from the mobile app."})]}),i.jsx(ui,{control:i.jsx(ac,{checked:!!e.geo_fence_enabled,onChange:w=>t(A=>({...A,geo_fence_enabled:w.target.checked}))}),label:e.geo_fence_enabled?"Enabled":"Disabled",sx:{m:0}})]}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"Latitude",name:"geo_fence_center_latitude",value:e.geo_fence_center_latitude??"",onChange:h,fullWidth:!0,type:"number",inputProps:{step:"0.000001",min:-90,max:90},disabled:!e.geo_fence_enabled})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"Longitude",name:"geo_fence_center_longitude",value:e.geo_fence_center_longitude??"",onChange:h,fullWidth:!0,type:"number",inputProps:{step:"0.000001",min:-180,max:180},disabled:!e.geo_fence_enabled})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"Radius (meters)",name:"geo_fence_radius_meters",value:e.geo_fence_radius_meters??"",onChange:h,fullWidth:!0,type:"number",inputProps:{min:1},disabled:!e.geo_fence_enabled,InputProps:{endAdornment:i.jsx(aa,{position:"end",children:"m"})}})})]}),!e.geo_fence_enabled&&i.jsx(Pt,{severity:"info",sx:{mt:2},children:"Geofence is turned off. Clock-in will not check location until you enable it."})]})}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx(B,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Business Logo"}),e.logo_url&&i.jsxs(Z,{display:"flex",flexDirection:"column",alignItems:"center",mb:2,children:[i.jsx(Rr,{sx:{maxWidth:180,borderRadius:3,boxShadow:3,border:"2px solid",borderColor:"primary.light",p:1,mb:1,bgcolor:"grey.50"},children:i.jsx(t5,{component:"img",image:e.logo_url?nE(e.logo_url):Kl,onError:w=>w.currentTarget.src=Kl,alt:"Business Logo",sx:{height:120,objectFit:"contain",borderRadius:2,bgcolor:"white"}})}),i.jsx(xe,{variant:"outlined",color:"error",startIcon:i.jsx(ga,{}),onClick:v,sx:{borderRadius:2,fontWeight:600},children:"Delete Current Logo"})]}),i.jsxs(xe,{variant:"contained",component:"label",startIcon:i.jsx(Cp,{}),sx:{borderRadius:2,fontWeight:600},children:[e.logo_url?"Change Logo":"Upload Logo",i.jsx("input",{type:"file",hidden:!0,onChange:p,accept:"image/*"})]}),s&&i.jsxs(Z,{mt:2,display:"flex",flexDirection:"column",alignItems:"center",children:[i.jsx(B,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"New Logo Preview:"}),i.jsx("img",{src:s,alt:"Logo Preview",style:{maxWidth:"100px",maxHeight:"100px"}})]})]})]})]})})});return i.jsx(rr,{sx:{mt:4,mb:4},children:c?_():b()})};var Of={},aE;function Hne(){if(aE)return Of;aE=1;var e=ir();Object.defineProperty(Of,"__esModule",{value:!0}),Of.default=void 0;var t=e(sr()),r=or();return Of.default=(0,t.default)((0,r.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),Of}var Vne=Hne();const di=Et(Vne);var kf={},iE;function Gne(){if(iE)return kf;iE=1;var e=ir();Object.defineProperty(kf,"__esModule",{value:!0}),kf.default=void 0;var t=e(sr()),r=or();return kf.default=(0,t.default)((0,r.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),kf}var Yne=Gne();const Va=Et(Yne);var Ef={},oE;function Kne(){if(oE)return Ef;oE=1;var e=ir();Object.defineProperty(Ef,"__esModule",{value:!0}),Ef.default=void 0;var t=e(sr()),r=or();return Ef.default=(0,t.default)((0,r.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download"),Ef}var Qne=Kne();const la=Et(Qne);var Tf={},sE;function Xne(){if(sE)return Tf;sE=1;var e=ir();Object.defineProperty(Tf,"__esModule",{value:!0}),Tf.default=void 0;var t=e(sr()),r=or();return Tf.default=(0,t.default)((0,r.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile"),Tf}var Jne=Xne();const VL=Et(Jne),lE=async e=>(await ve.get(`/api/customers/${e}/contacts`)).data,Zne=async(e,t)=>(await ve.post(`/api/customers/${e}/contacts/people`,t)).data,eae=async(e,t,r)=>(await ve.put(`/api/customers/${e}/contacts/people/${t}`,r)).data,tae=async(e,t)=>(await ve.delete(`/api/customers/${e}/contacts/people/${t}`)).data,rae=async(e,t)=>(await ve.post(`/api/customers/${e}/contacts/emails`,t)).data,nae=async(e,t,r)=>(await ve.put(`/api/customers/${e}/contacts/emails/${t}`,r)).data,aae=async(e,t)=>(await ve.delete(`/api/customers/${e}/contacts/emails/${t}`)).data,iae=async(e,t)=>(await ve.post(`/api/customers/${e}/contacts/phones`,t)).data,oae=async(e,t,r)=>(await ve.put(`/api/customers/${e}/contacts/phones/${t}`,r)).data,sae=async(e,t)=>(await ve.delete(`/api/customers/${e}/contacts/phones/${t}`)).data,cS=async()=>(await ve.get("/api/customers")).data,GL=async e=>(await ve.get(`/api/customers/${e}`)).data,YL=async e=>{const t={...e};return t.default_payment_terms_in_days!==void 0&&(t.default_payment_terms_in_days=Number(t.default_payment_terms_in_days)),(await ve.post("/api/customers",t)).data},uS=async(e,t)=>{const r={...t};return r.default_payment_terms_in_days!==void 0&&(r.default_payment_terms_in_days=Number(r.default_payment_terms_in_days)),(await ve.put(`/api/customers/${e}`,r)).data},lae=async e=>{await ve.delete(`/api/customers/${e}`)},cae=async(e,t)=>{const r=new FormData;return r.append("file",e),(await ve.post("/api/customers/import-excel",r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:t})).data},uae=()=>ve.get("/api/customers/import-excel/template",{responseType:"blob"});var Xm={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var dae=Xm.exports,cE;function fae(){return cE||(cE=1,function(e,t){((r,n)=>{e.exports=n()})(dae,function r(){var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},a,o=!n.document&&!!n.postMessage,s=n.IS_PAPA_WORKER||!1,l={},c=0,u={};function d(S){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(I){var U=P(I);U.chunkSize=parseInt(U.chunkSize),I.step||I.chunk||(U.chunkSize=null),this._handle=new m(U),(this._handle.streamer=this)._config=U}).call(this,S),this.parseChunk=function(I,U){var O=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<O){let L=this._config.newline;L||(M=this._config.quoteChar||'"',L=this._handle.guessLineEndings(I,M)),I=[...I.split(L).slice(O)].join(L)}this.isFirstChunk&&T(this._config.beforeFirstChunk)&&(M=this._config.beforeFirstChunk(I))!==void 0&&(I=M),this.isFirstChunk=!1,this._halted=!1;var O=this._partialLine+I,M=(this._partialLine="",this._handle.parse(O,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(I=M.meta.cursor,O=(this._finished||(this._partialLine=O.substring(I-this._baseIndex),this._baseIndex=I),M&&M.data&&(this._rowCount+=M.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),s)n.postMessage({results:M,workerId:u.WORKER_ID,finished:O});else if(T(this._config.chunk)&&!U){if(this._config.chunk(M,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=M=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(M.data),this._completeResults.errors=this._completeResults.errors.concat(M.errors),this._completeResults.meta=M.meta),this._completed||!O||!T(this._config.complete)||M&&M.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),O||M&&M.meta.paused||this._nextChunk(),M}this._halted=!0},this._sendError=function(I){T(this._config.error)?this._config.error(I):s&&this._config.error&&n.postMessage({workerId:u.WORKER_ID,error:I,finished:!1})}}function f(S){var I;(S=S||{}).chunkSize||(S.chunkSize=u.RemoteChunkSize),d.call(this,S),this._nextChunk=o?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(U){this._input=U,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(I=new XMLHttpRequest,this._config.withCredentials&&(I.withCredentials=this._config.withCredentials),o||(I.onload=E(this._chunkLoaded,this),I.onerror=E(this._chunkError,this)),I.open(this._config.downloadRequestBody?"POST":"GET",this._input,!o),this._config.downloadRequestHeaders){var U,O=this._config.downloadRequestHeaders;for(U in O)I.setRequestHeader(U,O[U])}var M;this._config.chunkSize&&(M=this._start+this._config.chunkSize-1,I.setRequestHeader("Range","bytes="+this._start+"-"+M));try{I.send(this._config.downloadRequestBody)}catch(L){this._chunkError(L.message)}o&&I.status===0&&this._chunkError()}},this._chunkLoaded=function(){I.readyState===4&&(I.status<200||400<=I.status?this._chunkError():(this._start+=this._config.chunkSize||I.responseText.length,this._finished=!this._config.chunkSize||this._start>=(U=>(U=U.getResponseHeader("Content-Range"))!==null?parseInt(U.substring(U.lastIndexOf("/")+1)):-1)(I),this.parseChunk(I.responseText)))},this._chunkError=function(U){U=I.statusText||U,this._sendError(new Error(U))}}function h(S){(S=S||{}).chunkSize||(S.chunkSize=u.LocalChunkSize),d.call(this,S);var I,U,O=typeof FileReader<"u";this.stream=function(M){this._input=M,U=M.slice||M.webkitSlice||M.mozSlice,O?((I=new FileReader).onload=E(this._chunkLoaded,this),I.onerror=E(this._chunkError,this)):I=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var M=this._input,L=(this._config.chunkSize&&(L=Math.min(this._start+this._config.chunkSize,this._input.size),M=U.call(M,this._start,L)),I.readAsText(M,this._config.encoding));O||this._chunkLoaded({target:{result:L}})},this._chunkLoaded=function(M){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(M.target.result)},this._chunkError=function(){this._sendError(I.error)}}function p(S){var I;d.call(this,S=S||{}),this.stream=function(U){return I=U,this._nextChunk()},this._nextChunk=function(){var U,O;if(!this._finished)return U=this._config.chunkSize,I=U?(O=I.substring(0,U),I.substring(U)):(O=I,""),this._finished=!I,this.parseChunk(O)}}function v(S){d.call(this,S=S||{});var I=[],U=!0,O=!1;this.pause=function(){d.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){d.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(M){this._input=M,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){O&&I.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),I.length?this.parseChunk(I.shift()):U=!0},this._streamData=E(function(M){try{I.push(typeof M=="string"?M:M.toString(this._config.encoding)),U&&(U=!1,this._checkIsFinished(),this.parseChunk(I.shift()))}catch(L){this._streamError(L)}},this),this._streamError=E(function(M){this._streamCleanUp(),this._sendError(M)},this),this._streamEnd=E(function(){this._streamCleanUp(),O=!0,this._streamData("")},this),this._streamCleanUp=E(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function m(S){var I,U,O,M,L=Math.pow(2,53),q=-L,z=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,K=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,J=this,R=0,k=0,$=!1,X=!1,C=[],N={data:[],errors:[],meta:{}};function H(oe){return S.skipEmptyLines==="greedy"?oe.join("").trim()==="":oe.length===1&&oe[0].length===0}function W(){if(N&&O&&(se("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+u.DefaultDelimiter+"'"),O=!1),S.skipEmptyLines&&(N.data=N.data.filter(function(ge){return!H(ge)})),ne()){let ge=function(Q,G){T(S.transformHeader)&&(Q=S.transformHeader(Q,G)),C.push(Q)};if(N)if(Array.isArray(N.data[0])){for(var oe=0;ne()&&oe<N.data.length;oe++)N.data[oe].forEach(ge);N.data.splice(0,1)}else N.data.forEach(ge)}function ae(ge,Q){for(var G=S.header?{}:[],ee=0;ee<ge.length;ee++){var le=ee,V=ge[ee],V=((Ve,Me)=>(Fe=>(S.dynamicTypingFunction&&S.dynamicTyping[Fe]===void 0&&(S.dynamicTyping[Fe]=S.dynamicTypingFunction(Fe)),(S.dynamicTyping[Fe]||S.dynamicTyping)===!0))(Ve)?Me==="true"||Me==="TRUE"||Me!=="false"&&Me!=="FALSE"&&((Fe=>{if(z.test(Fe)&&(Fe=parseFloat(Fe),q<Fe&&Fe<L))return 1})(Me)?parseFloat(Me):K.test(Me)?new Date(Me):Me===""?null:Me):Me)(le=S.header?ee>=C.length?"__parsed_extra":C[ee]:le,V=S.transform?S.transform(V,le):V);le==="__parsed_extra"?(G[le]=G[le]||[],G[le].push(V)):G[le]=V}return S.header&&(ee>C.length?se("FieldMismatch","TooManyFields","Too many fields: expected "+C.length+" fields but parsed "+ee,k+Q):ee<C.length&&se("FieldMismatch","TooFewFields","Too few fields: expected "+C.length+" fields but parsed "+ee,k+Q)),G}var pe;N&&(S.header||S.dynamicTyping||S.transform)&&(pe=1,!N.data.length||Array.isArray(N.data[0])?(N.data=N.data.map(ae),pe=N.data.length):N.data=ae(N.data,0),S.header&&N.meta&&(N.meta.fields=C),k+=pe)}function ne(){return S.header&&C.length===0}function se(oe,ae,pe,ge){oe={type:oe,code:ae,message:pe},ge!==void 0&&(oe.row=ge),N.errors.push(oe)}T(S.step)&&(M=S.step,S.step=function(oe){N=oe,ne()?W():(W(),N.data.length!==0&&(R+=oe.data.length,S.preview&&R>S.preview?U.abort():(N.data=N.data[0],M(N,J))))}),this.parse=function(oe,ae,pe){var ge=S.quoteChar||'"',ge=(S.newline||(S.newline=this.guessLineEndings(oe,ge)),O=!1,S.delimiter?T(S.delimiter)&&(S.delimiter=S.delimiter(oe),N.meta.delimiter=S.delimiter):((ge=((Q,G,ee,le,V)=>{var Ve,Me,Fe,Qe;V=V||[",","	","|",";",u.RECORD_SEP,u.UNIT_SEP];for(var it=0;it<V.length;it++){for(var st,vt=V[it],Ye=0,Ze=0,We=0,wt=(Fe=void 0,new b({comments:le,delimiter:vt,newline:G,preview:10}).parse(Q)),It=0;It<wt.data.length;It++)ee&&H(wt.data[It])?We++:(st=wt.data[It].length,Ze+=st,Fe===void 0?Fe=st:0<st&&(Ye+=Math.abs(st-Fe),Fe=st));0<wt.data.length&&(Ze/=wt.data.length-We),(Me===void 0||Ye<=Me)&&(Qe===void 0||Qe<Ze)&&1.99<Ze&&(Me=Ye,Ve=vt,Qe=Ze)}return{successful:!!(S.delimiter=Ve),bestDelimiter:Ve}})(oe,S.newline,S.skipEmptyLines,S.comments,S.delimitersToGuess)).successful?S.delimiter=ge.bestDelimiter:(O=!0,S.delimiter=u.DefaultDelimiter),N.meta.delimiter=S.delimiter),P(S));return S.preview&&S.header&&ge.preview++,I=oe,U=new b(ge),N=U.parse(I,ae,pe),W(),$?{meta:{paused:!0}}:N||{meta:{paused:!1}}},this.paused=function(){return $},this.pause=function(){$=!0,U.abort(),I=T(S.chunk)?"":I.substring(U.getCharIndex())},this.resume=function(){J.streamer._halted?($=!1,J.streamer.parseChunk(I,!0)):setTimeout(J.resume,3)},this.aborted=function(){return X},this.abort=function(){X=!0,U.abort(),N.meta.aborted=!0,T(S.complete)&&S.complete(N),I=""},this.guessLineEndings=function(Q,ge){Q=Q.substring(0,1048576);var ge=new RegExp(y(ge)+"([^]*?)"+y(ge),"gm"),pe=(Q=Q.replace(ge,"")).split("\r"),ge=Q.split(`
`),Q=1<ge.length&&ge[0].length<pe[0].length;if(pe.length===1||Q)return`
`;for(var G=0,ee=0;ee<pe.length;ee++)pe[ee][0]===`
`&&G++;return G>=pe.length/2?`\r
`:"\r"}}function y(S){return S.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function b(S){var I=(S=S||{}).delimiter,U=S.newline,O=S.comments,M=S.step,L=S.preview,q=S.fastMode,z=null,K=!1,J=S.quoteChar==null?'"':S.quoteChar,R=J;if(S.escapeChar!==void 0&&(R=S.escapeChar),(typeof I!="string"||-1<u.BAD_DELIMITERS.indexOf(I))&&(I=","),O===I)throw new Error("Comment character same as delimiter");O===!0?O="#":(typeof O!="string"||-1<u.BAD_DELIMITERS.indexOf(O))&&(O=!1),U!==`
`&&U!=="\r"&&U!==`\r
`&&(U=`
`);var k=0,$=!1;this.parse=function(X,C,N){if(typeof X!="string")throw new Error("Input must be a string");var H=X.length,W=I.length,ne=U.length,se=O.length,oe=T(M),ae=[],pe=[],ge=[],Q=k=0;if(!X)return Ye();if(q||q!==!1&&X.indexOf(J)===-1){for(var G=X.split(U),ee=0;ee<G.length;ee++){if(ge=G[ee],k+=ge.length,ee!==G.length-1)k+=U.length;else if(N)return Ye();if(!O||ge.substring(0,se)!==O){if(oe){if(ae=[],Qe(ge.split(I)),Ze(),$)return Ye()}else Qe(ge.split(I));if(L&&L<=ee)return ae=ae.slice(0,L),Ye(!0)}}return Ye()}for(var le=X.indexOf(I,k),V=X.indexOf(U,k),Ve=new RegExp(y(R)+y(J),"g"),Me=X.indexOf(J,k);;)if(X[k]===J)for(Me=k,k++;;){if((Me=X.indexOf(J,Me+1))===-1)return N||pe.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:ae.length,index:k}),st();if(Me===H-1)return st(X.substring(k,Me).replace(Ve,J));if(J===R&&X[Me+1]===R)Me++;else if(J===R||Me===0||X[Me-1]!==R){le!==-1&&le<Me+1&&(le=X.indexOf(I,Me+1));var Fe=it((V=V!==-1&&V<Me+1?X.indexOf(U,Me+1):V)===-1?le:Math.min(le,V));if(X.substr(Me+1+Fe,W)===I){ge.push(X.substring(k,Me).replace(Ve,J)),X[k=Me+1+Fe+W]!==J&&(Me=X.indexOf(J,k)),le=X.indexOf(I,k),V=X.indexOf(U,k);break}if(Fe=it(V),X.substring(Me+1+Fe,Me+1+Fe+ne)===U){if(ge.push(X.substring(k,Me).replace(Ve,J)),vt(Me+1+Fe+ne),le=X.indexOf(I,k),Me=X.indexOf(J,k),oe&&(Ze(),$))return Ye();if(L&&ae.length>=L)return Ye(!0);break}pe.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:ae.length,index:k}),Me++}}else if(O&&ge.length===0&&X.substring(k,k+se)===O){if(V===-1)return Ye();k=V+ne,V=X.indexOf(U,k),le=X.indexOf(I,k)}else if(le!==-1&&(le<V||V===-1))ge.push(X.substring(k,le)),k=le+W,le=X.indexOf(I,k);else{if(V===-1)break;if(ge.push(X.substring(k,V)),vt(V+ne),oe&&(Ze(),$))return Ye();if(L&&ae.length>=L)return Ye(!0)}return st();function Qe(We){ae.push(We),Q=k}function it(We){var wt=0;return wt=We!==-1&&(We=X.substring(Me+1,We))&&We.trim()===""?We.length:wt}function st(We){return N||(We===void 0&&(We=X.substring(k)),ge.push(We),k=H,Qe(ge),oe&&Ze()),Ye()}function vt(We){k=We,Qe(ge),ge=[],V=X.indexOf(U,k)}function Ye(We){if(S.header&&!C&&ae.length&&!K){var wt=ae[0],It=Object.create(null),Ot=new Set(wt);let Wt=!1;for(let jt=0;jt<wt.length;jt++){let lr=wt[jt];if(It[lr=T(S.transformHeader)?S.transformHeader(lr,jt):lr]){let $e,He=It[lr];for(;$e=lr+"_"+He,He++,Ot.has($e););Ot.add($e),wt[jt]=$e,It[lr]++,Wt=!0,(z=z===null?{}:z)[$e]=lr}else It[lr]=1,wt[jt]=lr;Ot.add(lr)}Wt&&console.warn("Duplicate headers found and renamed."),K=!0}return{data:ae,errors:pe,meta:{delimiter:I,linebreak:U,aborted:$,truncated:!!We,cursor:Q+(C||0),renamedHeaders:z}}}function Ze(){M(Ye()),ae=[],pe=[]}},this.abort=function(){$=!0},this.getCharIndex=function(){return k}}function _(S){var I=S.data,U=l[I.workerId],O=!1;if(I.error)U.userError(I.error,I.file);else if(I.results&&I.results.data){var M={abort:function(){O=!0,w(I.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:A,resume:A};if(T(U.userStep)){for(var L=0;L<I.results.data.length&&(U.userStep({data:I.results.data[L],errors:I.results.errors,meta:I.results.meta},M),!O);L++);delete I.results}else T(U.userChunk)&&(U.userChunk(I.results,M,I.file),delete I.results)}I.finished&&!O&&w(I.workerId,I.results)}function w(S,I){var U=l[S];T(U.userComplete)&&U.userComplete(I),U.terminate(),delete l[S]}function A(){throw new Error("Not implemented.")}function P(S){if(typeof S!="object"||S===null)return S;var I,U=Array.isArray(S)?[]:{};for(I in S)U[I]=P(S[I]);return U}function E(S,I){return function(){S.apply(I,arguments)}}function T(S){return typeof S=="function"}return u.parse=function(S,I){var U=(I=I||{}).dynamicTyping||!1;if(T(U)&&(I.dynamicTypingFunction=U,U={}),I.dynamicTyping=U,I.transform=!!T(I.transform)&&I.transform,!I.worker||!u.WORKERS_SUPPORTED)return U=null,u.NODE_STREAM_INPUT,typeof S=="string"?(S=(O=>O.charCodeAt(0)!==65279?O:O.slice(1))(S),U=new(I.download?f:p)(I)):S.readable===!0&&T(S.read)&&T(S.on)?U=new v(I):(n.File&&S instanceof File||S instanceof Object)&&(U=new h(I)),U.stream(S);(U=(()=>{var O;return!!u.WORKERS_SUPPORTED&&(O=(()=>{var M=n.URL||n.webkitURL||null,L=r.toString();return u.BLOB_URL||(u.BLOB_URL=M.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",L,")();"],{type:"text/javascript"})))})(),(O=new n.Worker(O)).onmessage=_,O.id=c++,l[O.id]=O)})()).userStep=I.step,U.userChunk=I.chunk,U.userComplete=I.complete,U.userError=I.error,I.step=T(I.step),I.chunk=T(I.chunk),I.complete=T(I.complete),I.error=T(I.error),delete I.worker,U.postMessage({input:S,config:I,workerId:U.id})},u.unparse=function(S,I){var U=!1,O=!0,M=",",L=`\r
`,q='"',z=q+q,K=!1,J=null,R=!1,k=((()=>{if(typeof I=="object"){if(typeof I.delimiter!="string"||u.BAD_DELIMITERS.filter(function(C){return I.delimiter.indexOf(C)!==-1}).length||(M=I.delimiter),typeof I.quotes!="boolean"&&typeof I.quotes!="function"&&!Array.isArray(I.quotes)||(U=I.quotes),typeof I.skipEmptyLines!="boolean"&&typeof I.skipEmptyLines!="string"||(K=I.skipEmptyLines),typeof I.newline=="string"&&(L=I.newline),typeof I.quoteChar=="string"&&(q=I.quoteChar),typeof I.header=="boolean"&&(O=I.header),Array.isArray(I.columns)){if(I.columns.length===0)throw new Error("Option columns is empty");J=I.columns}I.escapeChar!==void 0&&(z=I.escapeChar+q),I.escapeFormulae instanceof RegExp?R=I.escapeFormulae:typeof I.escapeFormulae=="boolean"&&I.escapeFormulae&&(R=/^[=+\-@\t\r].*$/)}})(),new RegExp(y(q),"g"));if(typeof S=="string"&&(S=JSON.parse(S)),Array.isArray(S)){if(!S.length||Array.isArray(S[0]))return $(null,S,K);if(typeof S[0]=="object")return $(J||Object.keys(S[0]),S,K)}else if(typeof S=="object")return typeof S.data=="string"&&(S.data=JSON.parse(S.data)),Array.isArray(S.data)&&(S.fields||(S.fields=S.meta&&S.meta.fields||J),S.fields||(S.fields=Array.isArray(S.data[0])?S.fields:typeof S.data[0]=="object"?Object.keys(S.data[0]):[]),Array.isArray(S.data[0])||typeof S.data[0]=="object"||(S.data=[S.data])),$(S.fields||[],S.data||[],K);throw new Error("Unable to serialize unrecognized input");function $(C,N,H){var W="",ne=(typeof C=="string"&&(C=JSON.parse(C)),typeof N=="string"&&(N=JSON.parse(N)),Array.isArray(C)&&0<C.length),se=!Array.isArray(N[0]);if(ne&&O){for(var oe=0;oe<C.length;oe++)0<oe&&(W+=M),W+=X(C[oe],oe);0<N.length&&(W+=L)}for(var ae=0;ae<N.length;ae++){var pe=(ne?C:N[ae]).length,ge=!1,Q=ne?Object.keys(N[ae]).length===0:N[ae].length===0;if(H&&!ne&&(ge=H==="greedy"?N[ae].join("").trim()==="":N[ae].length===1&&N[ae][0].length===0),H==="greedy"&&ne){for(var G=[],ee=0;ee<pe;ee++){var le=se?C[ee]:ee;G.push(N[ae][le])}ge=G.join("").trim()===""}if(!ge){for(var V=0;V<pe;V++){0<V&&!Q&&(W+=M);var Ve=ne&&se?C[V]:V;W+=X(N[ae][Ve],V)}ae<N.length-1&&(!H||0<pe&&!Q)&&(W+=L)}}return W}function X(C,N){var H,W;return C==null?"":C.constructor===Date?JSON.stringify(C).slice(1,25):(W=!1,R&&typeof C=="string"&&R.test(C)&&(C="'"+C,W=!0),H=C.toString().replace(k,z),(W=W||U===!0||typeof U=="function"&&U(C,N)||Array.isArray(U)&&U[N]||((ne,se)=>{for(var oe=0;oe<se.length;oe++)if(-1<ne.indexOf(se[oe]))return!0;return!1})(H,u.BAD_DELIMITERS)||-1<H.indexOf(M)||H.charAt(0)===" "||H.charAt(H.length-1)===" ")?q+H+q:H)}},u.RECORD_SEP="",u.UNIT_SEP="",u.BYTE_ORDER_MARK="\uFEFF",u.BAD_DELIMITERS=["\r",`
`,'"',u.BYTE_ORDER_MARK],u.WORKERS_SUPPORTED=!o&&!!n.Worker,u.NODE_STREAM_INPUT=1,u.LocalChunkSize=10485760,u.RemoteChunkSize=5242880,u.DefaultDelimiter=",",u.Parser=b,u.ParserHandle=m,u.NetworkStreamer=f,u.FileStreamer=h,u.StringStreamer=p,u.ReadableStreamStreamer=v,n.jQuery&&((a=n.jQuery).fn.parse=function(S){var I=S.config||{},U=[];return this.each(function(L){if(!(a(this).prop("tagName").toUpperCase()==="INPUT"&&a(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var q=0;q<this.files.length;q++)U.push({file:this.files[q],inputElem:this,instanceConfig:a.extend({},I)})}),O(),this;function O(){if(U.length===0)T(S.complete)&&S.complete();else{var L,q,z,K,J=U[0];if(T(S.before)){var R=S.before(J.file,J.inputElem);if(typeof R=="object"){if(R.action==="abort")return L="AbortError",q=J.file,z=J.inputElem,K=R.reason,void(T(S.error)&&S.error({name:L},q,z,K));if(R.action==="skip")return void M();typeof R.config=="object"&&(J.instanceConfig=a.extend(J.instanceConfig,R.config))}else if(R==="skip")return void M()}var k=J.instanceConfig.complete;J.instanceConfig.complete=function($){T(k)&&k($,J.file,J.inputElem),M()},u.parse(J.file,J.instanceConfig)}}function M(){U.splice(0,1),O()}}),s&&(n.onmessage=function(S){S=S.data,u.WORKER_ID===void 0&&S&&(u.WORKER_ID=S.workerId),typeof S.input=="string"?n.postMessage({workerId:u.WORKER_ID,results:u.parse(S.input,S.config),finished:!0}):(n.File&&S.input instanceof File||S.input instanceof Object)&&(S=u.parse(S.input,S.config))&&n.postMessage({workerId:u.WORKER_ID,results:S,finished:!0})}),(f.prototype=Object.create(d.prototype)).constructor=f,(h.prototype=Object.create(d.prototype)).constructor=h,(p.prototype=Object.create(p.prototype)).constructor=p,(v.prototype=Object.create(d.prototype)).constructor=v,u})}(Xm)),Xm.exports}var hae=fae();const Sl=Et(hae),KL=async()=>{try{const e=await ve.get("/api/business-profile");return{city:e.data.city||"",province:e.data.province||"",country:e.data.country||""}}catch(e){return console.error("Error fetching business profile:",e),{city:"",province:"",country:""}}};function Ay(e,t){const[r,n]=x.useState(e);return x.useEffect(()=>{const a=setTimeout(()=>{n(e)},t);return()=>{clearTimeout(a)}},[e,t]),r}const uE={customer_id:"",customer_name:"",contact_person:"",email:"",phone_number:"",street_address:"",city:"",province:"",country:"",postal_code:"",default_payment_terms_in_days:30,website:"",general_notes:""},Wd=({open:e,onClose:t,onSave:r,initialCustomer:n,isEditMode:a=!1,loading:o=!1,onUseExisting:s})=>{const[l,c]=x.useState(uE),[u,d]=x.useState(null),[f,h]=x.useState({}),p=Ay(l,300),[v,m]=x.useState([]),[y,b]=x.useState(null),[_,w]=x.useState([]),[A,P]=x.useState([]),[E,T]=x.useState([]),[S,I]=x.useState(""),[U,O]=x.useState(""),[M,L]=x.useState(""),[q,z]=x.useState(""),K=async()=>{try{const G=await KL();c(ee=>({...ee,city:G.city,province:G.province,country:G.country}))}catch(G){console.error("Error autofilling from business profile:",G)}};x.useEffect(()=>{if(e){const G={...uE,...n};c(G),d(null),(async()=>{try{const le=await ve.get("/api/customers");m(le.data||[])}catch{}})(),!a&&(!n?.city||n.city==="")&&(!n?.province||n.province==="")&&(!n?.country||n.country==="")&&K();const ee=n?.customer_id;a&&ee?(async()=>{try{const le=await lE(ee);w(le.people||[]),P(le.emails||[]),T(le.phones||[])}catch{}})():(w([]),P([]),T([]))}},[e,n,a]);const J=G=>{const{name:ee,value:le}=G.target;c(V=>({...V,[ee]:le})),f[ee]&&h(V=>({...V,[ee]:void 0}))},R=()=>l.customer_name.trim()?(d(null),!0):(d("Customer name is required"),!1),k=()=>{R()&&r(l)},$=G=>G.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim().toUpperCase(),X=(G,ee)=>{const le=Math.floor(Math.max(G.length,ee.length)/2)-1;if(le<0)return 0;const V=new Array(G.length).fill(!1),Ve=new Array(ee.length).fill(!1);let Me=0;for(let We=0;We<G.length;We++){const wt=Math.max(0,We-le),It=Math.min(We+le+1,ee.length);for(let Ot=wt;Ot<It;Ot++)if(!Ve[Ot]&&G[We]===ee[Ot]){V[We]=!0,Ve[Ot]=!0,Me++;break}}if(Me===0)return 0;const Fe=[],Qe=[];for(let We=0;We<G.length;We++)V[We]&&Fe.push(G[We]);for(let We=0;We<ee.length;We++)Ve[We]&&Qe.push(ee[We]);let it=0;for(let We=0;We<Fe.length;We++)Fe[We]!==Qe[We]&&it++;it=Math.floor(it/2);const st=(Me/G.length+Me/ee.length+(Me-it)/Me)/3;let vt=0;const Ye=4;for(let We=0;We<Math.min(Ye,G.length,ee.length)&&G[We]===ee[We];We++)vt++;return st+vt*.1*(1-st)};x.useEffect(()=>{if(!e)return;const G={};p.email&&p.email.trim().length>0&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p.email.trim())||(G.email="Invalid email format"));let ee=null,le=0;if(p.customer_name&&p.customer_name.trim().length>0){const V=$(p.customer_name),Ve=(n?.customer_id??p.customer_id)||"";for(const Me of v){if(String(Me.customer_id)===String(Ve||""))continue;const Qe=$(Me.customer_name||""),st=Qe===V?1:X(Qe,V);st>le&&(le=st,ee=Me)}le>=.92&&(G.customer_name="A similar customer already exists")}b(le>=.92&&ee?ee:null),h(V=>({...V,...G}))},[p,e]);const C=n?.customer_id,N=async()=>{if(!(!a||!C))try{const G=await lE(C);w(G.people||[]),P(G.emails||[]),T(G.phones||[])}catch{}},H=async()=>{!C||!S.trim()||(await Zne(C,{name:S.trim()}),I(""),N())},W=async G=>{C&&(await eae(C,G,{is_preferred:!0}),N())},ne=async G=>{C&&(await tae(C,G),N())},se=async()=>{!C||!U.trim()||(await rae(C,{email:U.trim()}),O(""),N())},oe=async G=>{C&&(await nae(C,G,{is_preferred:!0}),N())},ae=async G=>{C&&(await aae(C,G),N())},pe=async()=>{!C||!M.trim()||(await iae(C,{phone:M.trim(),label:q.trim()||void 0}),L(""),z(""),N())},ge=async G=>{C&&(await oae(C,G,{is_preferred:!0}),N())},Q=async G=>{C&&(await sae(C,G),N())};return i.jsxs(dr,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,children:[i.jsx(fr,{children:a?"Edit Customer":"Add New Customer"}),i.jsxs(hr,{children:[i.jsxs(ie,{container:!0,spacing:2,sx:{mt:1},children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"customer_name",label:"Customer Name",value:l.customer_name,onChange:J,fullWidth:!0,required:!0,error:!!f.customer_name,helperText:f.customer_name,autoFocus:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"contact_person",label:"Contact Person",value:l.contact_person,onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"email",label:"Email",type:"email",value:l.email,onChange:J,fullWidth:!0,error:!!f.email,helperText:f.email})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"phone_number",label:"Phone Number",value:l.phone_number,onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{name:"street_address",label:"Street Address",value:l.street_address,onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"city",label:"City",value:l.city,onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"province",label:"Province/State",value:l.province,onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"country",label:"Country",value:l.country,onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"postal_code",label:"Postal Code",value:l.postal_code,onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"default_payment_terms_in_days",label:"Payment Terms (days)",type:"number",value:l.default_payment_terms_in_days??"",onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{name:"website",label:"Website",value:l.website,onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{name:"general_notes",label:"General Notes",value:l.general_notes,onChange:J,fullWidth:!0,multiline:!0,minRows:4})}),a&&C&&i.jsx(ie,{item:!0,xs:12,children:i.jsxs(Z,{sx:{mt:2},children:[i.jsx(B,{variant:"h6",sx:{mb:1},children:"Contacts"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"People"}),i.jsxs(ut,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Pe,{size:"small",label:"Name",value:S,onChange:G=>I(G.target.value),fullWidth:!0}),i.jsx(xe,{variant:"outlined",size:"small",onClick:H,children:"Add"})]}),i.jsxs(ut,{spacing:1,children:[_.map(G=>i.jsxs(ut,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[G.name," ",G.is_preferred?"(Preferred)":""]}),!G.is_preferred&&i.jsx(xe,{size:"small",onClick:()=>W(G.id),children:"Set Preferred"}),i.jsx(xe,{size:"small",color:"error",onClick:()=>ne(G.id),children:"Remove"})]},G.id)),_.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No people yet."})]})]}),i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"Emails"}),i.jsxs(ut,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Pe,{size:"small",label:"Email",value:U,onChange:G=>O(G.target.value),fullWidth:!0}),i.jsx(xe,{variant:"outlined",size:"small",onClick:se,children:"Add"})]}),i.jsxs(ut,{spacing:1,children:[A.map(G=>i.jsxs(ut,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[G.email," ",G.is_preferred?"(Preferred)":""]}),!G.is_preferred&&i.jsx(xe,{size:"small",onClick:()=>oe(G.id),children:"Set Preferred"}),i.jsx(xe,{size:"small",color:"error",onClick:()=>ae(G.id),children:"Remove"})]},G.id)),A.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No emails yet."})]})]}),i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"Phones"}),i.jsxs(ut,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Pe,{size:"small",label:"Phone",value:M,onChange:G=>L(G.target.value),fullWidth:!0}),i.jsx(Pe,{size:"small",label:"Label",value:q,onChange:G=>z(G.target.value),sx:{width:120}}),i.jsx(xe,{variant:"outlined",size:"small",onClick:pe,children:"Add"})]}),i.jsxs(ut,{spacing:1,children:[E.map(G=>i.jsxs(ut,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[G.phone,G.label?` (${G.label})`:""," ",G.is_preferred?"(Preferred)":""]}),!G.is_preferred&&i.jsx(xe,{size:"small",onClick:()=>ge(G.id),children:"Set Preferred"}),i.jsx(xe,{size:"small",color:"error",onClick:()=>Q(G.id),children:"Remove"})]},G.id)),E.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No phones yet."})]})]})]})]})})]}),u&&i.jsx("div",{style:{color:"red",marginTop:8},children:u}),y&&i.jsxs("div",{style:{marginTop:12},children:[i.jsxs("div",{style:{color:"#b26a00",marginBottom:8},children:['Looks like "',y.customer_name,'" already exists.']}),typeof s=="function"&&i.jsx(xe,{variant:"outlined",size:"small",onClick:()=>{s(y)},children:"Use existing"})]})]}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:t,children:"Cancel"}),i.jsx(xe,{onClick:k,variant:"contained",disabled:o,children:a?"Save Changes":"Add Customer"})]})]})},pae=()=>{kn();const[e,t]=x.useState([]),[r,n]=x.useState(""),[a,o]=x.useState(null),[s,l]=x.useState(null),[c,u]=x.useState(!1),[d,f]=x.useState({pageSize:10,page:0}),[h,p]=x.useState(!1),[v,m]=x.useState(!1),[y,b]=x.useState(0),[_,w]=x.useState(null),[A,P]=x.useState(!1),E=x.useRef(null);x.useEffect(()=>{T()},[]);const T=async()=>{try{const k=await cS();t(k)}catch(k){console.error("Error fetching customers:",k),me.error("Failed to fetch customers")}},S=async k=>{if(window.confirm("Are you sure you want to delete this customer?"))try{await lae(k),t($=>$.filter(X=>X.id!==k)),me.success("Customer deleted successfully")}catch($){console.error("Error deleting customer:",$),me.error("Failed to delete customer")}},I=k=>{o(k),l({...k}),p(!0),u(!0)},U=()=>{u(!1),o(null),l(null)},O=async()=>{try{const k=await uae(),$=new Blob([k.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),X=window.URL.createObjectURL($),C=document.createElement("a");C.href=X,C.download="customer_import_template.xlsx",document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL(X)}catch(k){console.error("Error downloading template",k),me.error("Failed to download template")}},M=()=>{E.current?.click()},L=async k=>{const $=k.target.files?.[0];$&&(await q($),k.target.value="")},q=async k=>{m(!0),b(0),w(null);try{const $=await cae(k,X=>{if(X?.total){const C=Math.round(X.loaded*90/X.total);b(C)}});b(100),w($),P(!0),Array.isArray($?.createdCustomers)&&$.createdCustomers.length>0?t(X=>[...X,...$.createdCustomers]):T(),me.success("Customer import completed")}catch($){console.error("Error uploading Excel:",$);const X=$?.response?.data,C=X?.error||"Failed to import customers";w({error:C,errors:X?.errors||[],warnings:X?.warnings||[]}),P(!0),me.error(C)}finally{m(!1),b(0)}},z=()=>{P(!1),w(null)},K=e.filter(k=>k.customer_name.toLowerCase().includes(r.toLowerCase())||k.email?.toLowerCase().includes(r.toLowerCase())||k.phone_number?.toLowerCase().includes(r.toLowerCase())||`${k.street_address}, ${k.city}, ${k.province}, ${k.country}`.toLowerCase().includes(r.toLowerCase())),J=[{field:"customer_name",headerName:"Customer Name",flex:1.5},{field:"contact_person",headerName:"Contact Person",flex:1},{field:"email",headerName:"Email",flex:1.5},{field:"phone_number",headerName:"Phone Number",flex:1},{field:"actions",headerName:"Actions",width:80,sortable:!1,renderCell:k=>i.jsx(vr,{size:"small",color:"error",onClick:$=>{$.stopPropagation(),S(k.row.id)},children:i.jsx(ga,{})})}],R=()=>{const k=K.map(N=>({customer_name:N.customer_name,contact_person:N.contact_person,email:N.email,phone_number:N.phone_number})),$=Sl.unparse(k),X=new Blob([$],{type:"text/csv;charset=utf-8;"}),C=document.createElement("a");if(C.download!==void 0){const N=URL.createObjectURL(X);C.setAttribute("href",N),C.setAttribute("download","customer_list.csv"),C.style.visibility="hidden",document.body.appendChild(C),C.click(),document.body.removeChild(C)}};return i.jsx(rr,{maxWidth:"xl",children:i.jsxs(Z,{sx:{my:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Customer List"}),i.jsxs(ut,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:()=>{l({id:"",customer_id:"",customer_name:"",email:"",phone:"",phone_number:"",address:"",street_address:"",city:"",state:"",province:"",country:"",postal_code:"",contact_person:"",website:"",general_notes:"",created_at:"",updated_at:""}),p(!1),u(!0)},children:"New Customer"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(VL,{}),onClick:M,children:"Import Excel"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:O,children:"Download Template"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:R,children:"Export CSV"})]}),i.jsx("input",{type:"file",accept:".xlsx,.xls",ref:E,style:{display:"none"},onChange:L}),v&&i.jsxs(bt,{sx:{p:2,mb:2},children:[i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Uploading Excel file..."}),i.jsx(Td,{variant:"determinate",value:y}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[y,"% complete"]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(Pe,{fullWidth:!0,variant:"outlined",placeholder:"Search customers...",value:r,onChange:k=>n(k.target.value),InputProps:{startAdornment:i.jsx(aa,{position:"start",children:i.jsx(di,{})})},sx:{mb:2}}),i.jsx(Po,{rows:K,columns:J,pageSizeOptions:[10,25,50],paginationModel:d,onPaginationModelChange:f,getRowId:k=>k.id,loading:!1,disableRowSelectionOnClick:!0,onRowClick:k=>I(k.row),sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),i.jsxs(dr,{open:A,onClose:z,maxWidth:"md",fullWidth:!0,children:[i.jsx(fr,{children:_?.error?"Import Failed":"Import Completed"}),i.jsx(hr,{children:_&&i.jsxs(Z,{children:[_.error?i.jsx(Pt,{severity:"error",sx:{mb:2},children:_.error}):i.jsx(Pt,{severity:"success",sx:{mb:2},children:_.message||"Customers imported successfully"}),_.summary&&i.jsx(Z,{sx:{mb:3},children:i.jsxs(ie,{container:!0,spacing:1,children:[i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(ot,{label:`Total rows: ${_.summary.totalRows||0}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(ot,{label:`Accepted: ${_.summary.acceptedRows||0}`,color:"info"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(ot,{label:`Created: ${_.summary.created||0}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(ot,{label:`Skipped: ${_.summary.skipped||0}`,color:"warning"})})]})}),_.errors&&_.errors.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"error",gutterBottom:!0,children:["Errors (",_.errors.length,")"]}),i.jsx(pa,{dense:!0,children:_.errors.map((k,$)=>i.jsx(Sa,{children:i.jsx(Qn,{primary:k})},$))})]}),_.warnings&&_.warnings.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"warning.main",gutterBottom:!0,children:["Warnings (",_.warnings.length,")"]}),i.jsx(pa,{dense:!0,children:_.warnings.map((k,$)=>i.jsx(Sa,{children:i.jsx(Qn,{primary:k})},$))})]})]})}),i.jsx(_r,{children:i.jsx(xe,{onClick:z,variant:"contained",children:"Close"})})]}),i.jsx(Wd,{open:c,onClose:U,onSave:async k=>{try{if(h&&s)await uS(s.id,k),t($=>$.map(X=>X.id===s.id?{...X,...k}:X)),me.success("Customer updated successfully");else{const $=await YL(k);t(X=>[...X,$]),me.success("Customer created successfully")}U()}catch($){console.error("Error saving customer:",$),me.error(h?"Failed to update customer":"Failed to create customer")}},initialCustomer:s||{},isEditMode:h})]})})},dE=async e=>(await ve.get("/api/invoices",{params:e})).data,mae=async e=>(await ve.get(`/api/invoices/${e}`)).data,gae=async e=>(await ve.post("/api/invoices",e)).data,vae=async(e,t)=>(await ve.put("/api/invoices/"+e,t)).data,yae=async e=>(await ve.delete("/api/invoices/"+e)).data,xae=async(e,t)=>ve.get(`/api/invoices/customers/${e}/statement`,{params:{month:t},responseType:"blob"}),bae=async e=>ve.get("/api/invoices/statement",{params:e,responseType:"blob"}),_ae=async()=>ve.get("/api/invoices/csv-template",{responseType:"blob"}),wae=async e=>{const t=new FormData;return t.append("file",e),(await ve.post("/api/invoices/upload-csv",t,{headers:{"Content-Type":"multipart/form-data"}})).data},jae=async e=>{const t=new FormData;return t.append("file",e),(await ve.post("/api/invoices/upload-unit-numbers",t,{headers:{"Content-Type":"multipart/form-data"}})).data},Sae=()=>{const{id:e}=Ms(),t=kn(),r=e==="new";console.log("Debug - URL id parameter:",e),console.log("Debug - isNewCustomer calculated:",r);const[n,a]=x.useState(!1),[o,s]=x.useState(!1),[l,c]=x.useState(null),[u,d]=x.useState(!1),[f,h]=x.useState(()=>Rt().format("YYYY-MM")),[p,v]=x.useState({customer_name:"",email:"",phone_number:"",street_address:"",city:"",province:"",country:"",postal_code:"",contact_person:"",website:"",general_notes:"",default_payment_terms_in_days:30});x.useEffect(()=>{!r&&e?m():r&&d(!0)},[e,r]);const m=async()=>{a(!0);try{if(!e)throw new Error("Customer ID is required");const _=await GL(e);v(_)}catch(_){console.error("Error fetching customer:",_),c("Failed to load customer data"),me.error("Failed to load customer data")}finally{a(!1)}},y=async()=>{if(e)try{const _=await xae(Number(e),f),w=new Blob([_.data],{type:"application/pdf"}),A=window.URL.createObjectURL(w),P=document.createElement("a");P.href=A,P.download=`statement-${p.customer_name||"customer"}-${f||"current"}.pdf`,P.click(),window.URL.revokeObjectURL(A)}catch(_){console.error("Error downloading statement:",_),me.error("Failed to download statement")}},b=()=>{t("/customers")};return n?i.jsx(rr,{maxWidth:"md",children:i.jsx(Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:i.jsx(er,{})})}):i.jsx(rr,{maxWidth:"md",children:i.jsxs(Z,{sx:{my:4},children:[i.jsxs(Z,{sx:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:2,mb:3},children:[i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(xe,{startIcon:i.jsx(jI,{}),onClick:b,sx:{mr:0},children:"Back to Customers"}),i.jsx(B,{variant:"h4",component:"h1",children:r?"Add New Customer":"Edit Customer"})]}),!r&&i.jsxs(ut,{direction:"row",spacing:1,alignItems:"center",sx:{marginLeft:{xs:0,sm:"auto"}},children:[i.jsx(Pe,{label:"Statement Month",type:"month",size:"small",value:f,onChange:_=>h(_.target.value),InputLabelProps:{shrink:!0}}),i.jsx(xe,{variant:"outlined",onClick:y,children:"Download Monthly Statement"})]})]}),l&&i.jsx(Pt,{severity:"error",sx:{mb:2},children:l}),i.jsx(Wd,{open:u,onClose:()=>{d(!1),b()},onSave:async _=>{s(!0);try{r?(await YL(_),me.success("Customer created successfully")):(await uS(e,_),me.success("Customer updated successfully")),t("/customers")}catch{me.error("Failed to save customer")}finally{s(!1)}},initialCustomer:r?{}:p,isEditMode:!r,loading:o})]})})},Cae=async()=>(await ve.get("/api/vendors")).data,fE=async e=>(await ve.get(`/api/vendors/${e}/contacts`)).data,Aae=async(e,t)=>(await ve.post(`/api/vendors/${e}/contacts/people`,t)).data,Pae=async(e,t,r)=>(await ve.put(`/api/vendors/${e}/contacts/people/${t}`,r)).data,Oae=async(e,t)=>(await ve.delete(`/api/vendors/${e}/contacts/people/${t}`)).data,kae=async(e,t)=>(await ve.post(`/api/vendors/${e}/contacts/emails`,t)).data,Eae=async(e,t,r)=>(await ve.put(`/api/vendors/${e}/contacts/emails/${t}`,r)).data,Tae=async(e,t)=>(await ve.delete(`/api/vendors/${e}/contacts/emails/${t}`)).data,Iae=async(e,t)=>(await ve.post(`/api/vendors/${e}/contacts/phones`,t)).data,Nae=async(e,t,r)=>(await ve.put(`/api/vendors/${e}/contacts/phones/${t}`,r)).data,Dae=async(e,t)=>(await ve.delete(`/api/vendors/${e}/contacts/phones/${t}`)).data,Mae=async(e,t)=>{const r=new FormData;return r.append("file",e),(await ve.post("/api/vendors/import-excel",r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:t})).data},Lae=()=>ve.get("/api/vendors/import-excel/template",{responseType:"blob"}),hE={vendor_name:"",street_address:"",city:"",province:"",country:"",postal_code:"",contact_person:"",telephone_number:"",email:"",website:""},QL=({open:e,onClose:t,onSave:r,initialVendor:n,isEditMode:a=!1,loading:o=!1})=>{const[s,l]=x.useState(hE),[c,u]=x.useState({}),d=Ay(s,300),[f,h]=x.useState([]),[p,v]=x.useState([]),[m,y]=x.useState([]),[b,_]=x.useState([]),[w,A]=x.useState(""),[P,E]=x.useState(""),[T,S]=x.useState(""),[I,U]=x.useState("");x.useEffect(()=>{if(e){console.log("UnifiedVendorDialog: Setting vendor with initialVendor:",n);const W={...hE,...n};l(W),!a&&!n?.city&&!n?.province&&!n?.country&&L(),(async()=>{try{const se=await ve.get("/api/vendors");h(se.data||[])}catch{}})();const ne=n?.vendor_id;a&&ne?(async()=>{try{const se=await fE(ne);v(se.people||[]),y(se.emails||[]),_(se.phones||[])}catch{}})():(v([]),y([]),_([]))}},[e,n,a]);const O=W=>{const{name:ne,value:se}=W.target;l(oe=>({...oe,[ne]:se})),c[ne]&&u(oe=>({...oe,[ne]:void 0}))},M=()=>{r(s)};x.useEffect(()=>{if(!e)return;const W={};if(d.email&&d.email.trim().length>0&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email.trim())||(W.email="Invalid email format")),d.vendor_name&&d.vendor_name.trim().length>0){const ne=d.vendor_name.trim().toLowerCase();f.some(oe=>(oe.vendor_name||"").trim().toLowerCase()===ne)&&!a&&(W.vendor_name="Vendor name already exists")}u(ne=>({...ne,...W}))},[d,e,a,f]);const L=async()=>{try{const W=await KL();l(ne=>({...ne,city:W.city,province:W.province,country:W.country})),console.log("Autofilled vendor form with business profile data:",W)}catch(W){console.error("Error autofilling from business profile:",W)}},q=n?.vendor_id,z=async()=>{if(!(!a||!q))try{const W=await fE(q);v(W.people||[]),y(W.emails||[]),_(W.phones||[])}catch{}},K=async()=>{!q||!w.trim()||(await Aae(q,{name:w.trim()}),A(""),z())},J=async W=>{q&&(await Pae(q,W,{is_preferred:!0}),z())},R=async W=>{q&&(await Oae(q,W),z())},k=async()=>{!q||!P.trim()||(await kae(q,{email:P.trim()}),E(""),z())},$=async W=>{q&&(await Eae(q,W,{is_preferred:!0}),z())},X=async W=>{q&&(await Tae(q,W),z())},C=async()=>{!q||!T.trim()||(await Iae(q,{phone:T.trim(),label:I.trim()||void 0}),S(""),U(""),z())},N=async W=>{q&&(await Nae(q,W,{is_preferred:!0}),z())},H=async W=>{q&&(await Dae(q,W),z())};return i.jsxs(dr,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,sx:{zIndex:W=>W.zIndex.modal+5},children:[i.jsx(fr,{children:a?"Edit Vendor":"Add New Vendor"}),i.jsx(hr,{sx:{form:{autoComplete:"off"}},children:i.jsxs(ie,{container:!0,spacing:2,sx:{mt:1},children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"vendor_name",label:"Vendor Name",value:s.vendor_name,onChange:O,fullWidth:!0,required:!0,error:!!c.vendor_name,helperText:c.vendor_name,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"contact_person",label:"Contact Person",value:s.contact_person,onChange:O,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"email",label:"Email",type:"email",value:s.email,onChange:O,fullWidth:!0,error:!!c.email,helperText:c.email,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"telephone_number",label:"Telephone",value:s.telephone_number,onChange:O,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{name:"street_address",label:"Street Address",value:s.street_address,onChange:O,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"city",label:"City",value:s.city,onChange:O,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"province",label:"Province/State",value:s.province,onChange:O,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"country",label:"Country",value:s.country,onChange:O,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"postal_code",label:"Postal Code",value:s.postal_code,onChange:O,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{name:"website",label:"Website",value:s.website,onChange:O,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),a&&q&&i.jsx(ie,{item:!0,xs:12,children:i.jsxs(Z,{sx:{mt:2},children:[i.jsx(B,{variant:"h6",sx:{mb:1},children:"Contacts"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"People"}),i.jsxs(ut,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Pe,{size:"small",label:"Name",value:w,onChange:W=>A(W.target.value),fullWidth:!0}),i.jsx(xe,{variant:"outlined",size:"small",onClick:K,children:"Add"})]}),i.jsxs(ut,{spacing:1,children:[p.map(W=>i.jsxs(ut,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[W.name," ",W.is_preferred?"(Preferred)":""]}),!W.is_preferred&&i.jsx(xe,{size:"small",onClick:()=>J(W.id),children:"Set Preferred"}),i.jsx(xe,{size:"small",color:"error",onClick:()=>R(W.id),children:"Remove"})]},W.id)),p.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No people yet."})]})]}),i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"Emails"}),i.jsxs(ut,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Pe,{size:"small",label:"Email",value:P,onChange:W=>E(W.target.value),fullWidth:!0}),i.jsx(xe,{variant:"outlined",size:"small",onClick:k,children:"Add"})]}),i.jsxs(ut,{spacing:1,children:[m.map(W=>i.jsxs(ut,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[W.email," ",W.is_preferred?"(Preferred)":""]}),!W.is_preferred&&i.jsx(xe,{size:"small",onClick:()=>$(W.id),children:"Set Preferred"}),i.jsx(xe,{size:"small",color:"error",onClick:()=>X(W.id),children:"Remove"})]},W.id)),m.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No emails yet."})]})]}),i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"Phones"}),i.jsxs(ut,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Pe,{size:"small",label:"Phone",value:T,onChange:W=>S(W.target.value),fullWidth:!0}),i.jsx(Pe,{size:"small",label:"Label",value:I,onChange:W=>U(W.target.value),sx:{width:120}}),i.jsx(xe,{variant:"outlined",size:"small",onClick:C,children:"Add"})]}),i.jsxs(ut,{spacing:1,children:[b.map(W=>i.jsxs(ut,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[W.phone,W.label?` (${W.label})`:""," ",W.is_preferred?"(Preferred)":""]}),!W.is_preferred&&i.jsx(xe,{size:"small",onClick:()=>N(W.id),children:"Set Preferred"}),i.jsx(xe,{size:"small",color:"error",onClick:()=>H(W.id),children:"Remove"})]},W.id)),b.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No phones yet."})]})]})]})]})})]})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:t,children:"Cancel"}),i.jsx(xe,{onClick:M,variant:"contained",disabled:o,children:a?"Save Changes":"Add Vendor"})]})]})},Rae=()=>{const[e,t]=x.useState(""),[r,n]=x.useState([]),[a,o]=x.useState(!1),[s,l]=x.useState({page:0,pageSize:10}),[c,u]=x.useState(!1),[d,f]=x.useState(!1),[h,p]=x.useState({}),[v,m]=x.useState(!1),[y,b]=x.useState(0),[_,w]=x.useState(null),[A,P]=x.useState(!1),E=x.useRef(null),T=r.filter(k=>(k.vendor_name||"").toLowerCase().includes(e.toLowerCase())||(k.contact_person||"").toLowerCase().includes(e.toLowerCase())||(k.email||"").toLowerCase().includes(e.toLowerCase())),S=[{field:"vendor_name",headerName:"Vendor Name",flex:1.5},{field:"contact_person",headerName:"Contact Person",flex:1},{field:"email",headerName:"Email",flex:1.5},{field:"telephone_number",headerName:"Phone Number",flex:1},{field:"actions",headerName:"Actions",width:100,sortable:!1,renderCell:k=>i.jsx(vr,{size:"small",color:"error",onClick:$=>{$.stopPropagation(),J(k.row.vendor_id)},children:i.jsx(ga,{})})}],I=async()=>{o(!0);try{const $=(await Cae()).map(X=>({...X,id:X.vendor_id}));n($)}catch{me.error("Failed to fetch vendors.")}finally{o(!1)}};x.useEffect(()=>{I()},[]);const U=(k=null)=>{k?(f(!0),p(k)):(f(!1),p({vendor_name:"",street_address:"",city:"",province:"",country:"",contact_person:"",telephone_number:"",email:"",website:"",postal_code:""})),u(!0)},O=()=>{u(!1),p({})},M=()=>{E.current?.click()},L=async k=>{const $=k.target.files?.[0];$&&(await q($),k.target.value="")},q=async k=>{m(!0),b(0),w(null);try{const $=await Mae(k,X=>{if(X?.total){const C=Math.round(X.loaded*90/X.total);b(C)}});if(b(100),w($),P(!0),Array.isArray($?.createdVendors)&&$.createdVendors.length>0){const X=$.createdVendors.map(C=>({...C,id:C.vendor_id??C.id}));n(C=>[...C,...X])}else I();me.success("Vendor import completed")}catch($){console.error("Error uploading Excel:",$);const X=$?.response?.data,C=X?.error||"Failed to import vendors";w({error:C,errors:X?.errors||[],warnings:X?.warnings||[]}),P(!0),me.error(C)}finally{m(!1),b(0)}},z=async()=>{try{const k=await Lae(),$=new Blob([k.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),X=window.URL.createObjectURL($),C=document.createElement("a");C.href=X,C.download="vendor_import_template.xlsx",document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL(X)}catch(k){console.error("Error downloading vendor template",k),me.error("Failed to download vendor template")}},K=()=>{P(!1),w(null)},J=async k=>{if(window.confirm("Are you sure you want to delete this vendor?"))try{await ve.delete(`/api/vendors/${k}`),me.success("Vendor deleted successfully!"),I()}catch($){$ instanceof ci?me.error($.response?.data?.error||"Failed to delete vendor."):me.error("An unexpected error occurred while deleting the vendor.")}},R=()=>{const k=Sl.unparse(T),$=new Blob([k],{type:"text/csv;charset=utf-8;"}),X=document.createElement("a");if(X.download!==void 0){const C=URL.createObjectURL($);X.setAttribute("href",C),X.setAttribute("download","vendor_list.csv"),X.style.visibility="hidden",document.body.appendChild(X),X.click(),document.body.removeChild(X)}};return i.jsxs(rr,{maxWidth:"xl",children:[i.jsxs(Z,{sx:{my:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Vendor Management"}),i.jsxs(ut,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:()=>U(),children:"New Vendor"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(VL,{}),onClick:M,children:"Import Excel"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:z,children:"Download Template"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:R,children:"Export CSV"})]}),i.jsx("input",{type:"file",accept:".xlsx,.xls",ref:E,style:{display:"none"},onChange:L}),v&&i.jsxs(bt,{sx:{p:2,mb:2},children:[i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Uploading Excel file..."}),i.jsx(Td,{variant:"determinate",value:y}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[y,"% complete"]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2,width:"100%"},children:[i.jsx(Pe,{fullWidth:!0,variant:"outlined",placeholder:"Search vendors...",value:e,onChange:k=>t(k.target.value),InputProps:{startAdornment:i.jsx(aa,{position:"start",children:i.jsx(di,{})})},sx:{mb:2}}),i.jsx(Po,{rows:T,columns:S,loading:a,paginationModel:s,onPaginationModelChange:l,pageSizeOptions:[10,25,50],getRowId:k=>k.vendor_id,onRowClick:k=>U(k.row),disableRowSelectionOnClick:!0,sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),i.jsxs(dr,{open:A,onClose:K,maxWidth:"md",fullWidth:!0,children:[i.jsx(fr,{children:_?.error?"Import Failed":"Import Completed"}),i.jsx(hr,{children:_&&i.jsxs(Z,{children:[_.error?i.jsx(Pt,{severity:"error",sx:{mb:2},children:_.error}):i.jsx(Pt,{severity:"success",sx:{mb:2},children:_.message||"Vendors imported successfully"}),_.summary&&i.jsx(Z,{sx:{mb:3},children:i.jsxs(ie,{container:!0,spacing:1,children:[i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(ot,{label:`Total rows: ${_.summary.totalRows||0}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(ot,{label:`Accepted: ${_.summary.acceptedRows||0}`,color:"info"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(ot,{label:`Created: ${_.summary.created||0}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(ot,{label:`Skipped: ${_.summary.skipped||0}`,color:"warning"})})]})}),_.errors&&_.errors.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"error",gutterBottom:!0,children:["Errors (",_.errors.length,")"]}),i.jsx(pa,{dense:!0,children:_.errors.map((k,$)=>i.jsx(Sa,{children:i.jsx(Qn,{primary:k})},$))})]}),_.warnings&&_.warnings.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"warning.main",gutterBottom:!0,children:["Warnings (",_.warnings.length,")"]}),i.jsx(pa,{dense:!0,children:_.warnings.map((k,$)=>i.jsx(Sa,{children:i.jsx(Qn,{primary:k})},$))})]})]})}),i.jsx(_r,{children:i.jsx(xe,{onClick:K,variant:"contained",children:"Close"})})]})]}),i.jsx(QL,{open:c,onClose:O,onSave:async k=>{try{d?(await ve.put(`/api/vendors/${h.vendor_id}`,k),me.success("Vendor updated successfully!")):(await ve.post("/api/vendors",k),me.success("Vendor added successfully!")),O(),I()}catch($){$ instanceof ci?me.error($.response?.data?.error||`Failed to ${d?"update":"add"} vendor.`):me.error(`An unexpected error occurred while ${d?"updating":"adding"} the vendor.`)}},initialVendor:h,isEditMode:d})]})},qae=()=>{const{id:e}=Ms();return i.jsx(rr,{maxWidth:"md",children:i.jsxs(Z,{sx:{my:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Vendor Detail Page"}),i.jsxs(bt,{sx:{p:3},children:[i.jsxs(B,{variant:"h6",children:["Vendor ID: ",e]}),i.jsx(B,{variant:"body1",children:"This is a placeholder for the Vendor Detail Page."})]})]})})},Fae=()=>{const{id:e}=Ms();return i.jsx(rr,{maxWidth:"md",children:i.jsxs(Z,{sx:{my:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Product Detail Page"}),i.jsxs(bt,{sx:{p:3},children:[i.jsxs(B,{variant:"h6",children:["Product ID: ",e]}),i.jsx(B,{variant:"body1",children:"This is a placeholder for the Product Detail Page."})]})]})})};var If={},pE;function $ae(){if(pE)return If;pE=1;var e=ir();Object.defineProperty(If,"__esModule",{value:!0}),If.default=void 0;var t=e(sr()),r=or();return If.default=(0,t.default)((0,r.jsx)("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"}),"Upload"),If}var Bae=$ae();const Cd=Et(Bae),Py=async e=>{const t=e?{partType:e}:{};return(await ve.get("/api/inventory",{params:t})).data},Uae=async()=>Py("stock"),zae=async()=>Py("supply"),Wae=async()=>Py("service"),XL=async e=>(await ve.get(`/api/inventory/${encodeURIComponent(e)}`)).data,JL=async e=>(await ve.post("/api/inventory/cleanup-enforce",{partType:e,apply:!1})).data,dS=async(e,t)=>(await ve.post("/api/inventory/cleanup-enforce",{partType:e,apply:!0,merges:t})).data,Jm=async e=>(await ve.get(`/api/inventory/${encodeURIComponent(e)}/vendors`)).data,Tm=async e=>(await ve.get(`/api/inventory/part/${e}/vendors`)).data,Hae=async(e,t)=>(await ve.post(`/api/inventory/${encodeURIComponent(e)}/vendors`,t)).data,Vae=async(e,t)=>(await ve.post(`/api/inventory/part/${e}/vendors`,t)).data,Gae=async(e,t,r)=>(await ve.put(`/api/inventory/${encodeURIComponent(e)}/vendors/${t}`,r)).data,Yae=async(e,t,r)=>(await ve.put(`/api/inventory/part/${e}/vendors/${t}`,r)).data,Kae=async(e,t)=>(await ve.delete(`/api/inventory/${encodeURIComponent(e)}/vendors/${t}`)).data,Qae=async(e,t)=>(await ve.delete(`/api/inventory/part/${e}/vendors/${t}`)).data,Xae=async()=>(await ve.get("/api/categories")).data,Jae=async e=>(await ve.post("/api/categories",e)).data.category,mE=async(e,t)=>{const r=t?{reassign:"true"}:{};await ve.delete(`/api/categories/${e}`,{params:r})},f2="__ADD_NEW_CATEGORY__",Zae=({value:e,onChange:t,label:r="Category",error:n,errorMessage:a,fullWidth:o=!0,disabled:s})=>{const[l,c]=x.useState([]),[u,d]=x.useState(!1),[f,h]=x.useState(!1),[p,v]=x.useState(""),[m,y]=x.useState(""),[b,_]=x.useState(!1),{user:w}=Jn();x.useEffect(()=>{let S=!0;return(async()=>{d(!0);try{const U=await Xae();S&&c(U)}catch(U){console.error("CategorySelect: failed to load categories",U),me.error("Failed to load categories")}finally{S&&d(!1)}})(),()=>{S=!1}},[]);const A=x.useMemo(()=>{const S=l.map(I=>I.category_name);return S.some(I=>I.toLowerCase()==="uncategorized")||S.unshift("Uncategorized"),S.sort((I,U)=>I.localeCompare(U))},[l]),P=S=>{const I=S.target.value;if(I===f2){h(!0);return}t(I)},E=async(S,I)=>{if(I?.preventDefault(),I?.stopPropagation(),S.category_name.toLowerCase()==="uncategorized"){me.warn('Cannot delete the default "Uncategorized" category');return}if(w?.access_role!=="Admin"){me.error("Only Admin users can delete categories");return}if(window.confirm(`Delete category "${S.category_name}"? This cannot be undone.`))try{await mE(S.category_id),c(O=>O.filter(M=>M.category_id!==S.category_id)),e&&e.toLowerCase()===S.category_name.toLowerCase()&&t("Uncategorized"),me.success("Category deleted")}catch(O){const M=O?.response?.data;if(M?.error==="Cannot delete category"&&M?.suggestion){if(window.confirm(`${M.details}

${M.suggestion}

Would you like to reassign all items to "Uncategorized" and delete the category?`))try{await mE(S.category_id,!0),c(q=>q.filter(z=>z.category_id!==S.category_id)),e&&e.toLowerCase()===S.category_name.toLowerCase()&&t("Uncategorized"),me.success(M.details?`Category deleted. ${M.details}`:"Category deleted")}catch(q){const z=q?.response?.data?.error||"Failed to delete category";me.error(z)}}else{const L=M?.error||"Failed to delete category";me.error(L)}}},T=async()=>{const S=p.trim();if(!S){me.warn("Please enter a category name");return}if(A.some(I=>I.toLowerCase()===S.toLowerCase())){me.warn("Category already exists");return}_(!0);try{const I=m.trim(),U=await Jae({category_name:S,description:I||void 0});c(O=>[...O,U]),h(!1),v(""),y(""),t(U.category_name),me.success("Category added")}catch(I){console.error("CategorySelect: failed to create category",I),me.error("Failed to add category")}finally{_(!1)}};return i.jsxs(i.Fragment,{children:[i.jsxs(Pe,{label:r,value:e,onChange:P,select:!0,fullWidth:o,required:!0,error:!!n,helperText:a,disabled:s||u,children:[l.slice().sort((S,I)=>S.category_name.localeCompare(I.category_name)).map(S=>i.jsxs(Jt,{value:S.category_name,sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("span",{children:S.category_name}),w?.access_role==="Admin"&&S.category_name.toLowerCase()!=="uncategorized"&&i.jsx(vr,{"aria-label":`Delete ${S.category_name}`,size:"small",edge:"end",onClick:I=>E(S,I),sx:{ml:2,color:"error.main"},children:i.jsx(ga,{fontSize:"small"})})]},S.category_id)),i.jsx(Jt,{value:f2,children:"+ Add new category"},f2)]}),i.jsxs(dr,{open:f,onClose:()=>h(!1),maxWidth:"xs",fullWidth:!0,children:[i.jsx(fr,{children:"Add New Category"}),i.jsx(hr,{children:i.jsxs(ut,{spacing:2,sx:{mt:1},children:[i.jsx(Pe,{label:"Category Name",value:p,onChange:S=>v(S.target.value),autoFocus:!0,fullWidth:!0}),i.jsx(Pe,{label:"Description (optional)",value:m,onChange:S=>y(S.target.value),fullWidth:!0,multiline:!0,minRows:2})]})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:()=>h(!1),disabled:b,children:"Cancel"}),i.jsx(xe,{onClick:T,variant:"contained",disabled:b,children:"Save"})]})]})]})},h2=["Each","cm","ft","ft^2","kg","pcs","L"],eie=["stock","supply","service"],ec=({open:e,onClose:t,onSave:r,initialPart:n,isEditMode:a=!1,title:o})=>{const{user:s}=Jn(),[l,c]=x.useState({part_number:"",part_description:"",unit:h2[0],last_unit_cost:"",quantity_on_hand:"",reorder_point:"",part_type:"stock",category:"Uncategorized",...n||{}}),[u,d]=x.useState({}),[f,h]=x.useState(!1),p=x.useRef(null),[v,m]=x.useState(null),y=x.useRef(null);x.useEffect(()=>{e&&(c({part_id:n?.part_id,part_number:n?.part_number||"",part_description:n?.part_description||"",unit:n?.unit||h2[0],last_unit_cost:n?.last_unit_cost||"",quantity_on_hand:n?.quantity_on_hand||"",reorder_point:n?.reorder_point||"",part_type:n?.part_type||"stock",category:n?.category||"Uncategorized"}),d({}),h(!1),m(null))},[e,n?.part_id,n?.part_number]),x.useEffect(()=>{e&&p.current&&setTimeout(()=>p.current?.focus(),100)},[e]);const b=(C,N)=>{C==="part_number"&&(N=N.toUpperCase()),c(C==="part_type"&&(N==="supply"||N==="service")?H=>({...H,[C]:N,quantity_on_hand:"NA"}):H=>({...H,[C]:N})),u[C]&&d(H=>({...H,[C]:void 0}))};x.useEffect(()=>{if(!e)return;const C=(l.part_number||"").trim();if(y.current&&window.clearTimeout(y.current),!C){m(null);return}return y.current=window.setTimeout(async()=>{try{const N=await XL(C),H=N?.item||N,W=String(H?.part_number||"").toUpperCase(),ne=String(n?.part_number||"").toUpperCase(),se=H?.part_id,oe=ne&&ne===W;W&&W===C.toUpperCase()&&!oe&&(!l.part_id||l.part_id!==se)?m(`Part number ${W} already exists. Saving will update that part.`):m(null)}catch{m(null)}},400),()=>{y.current&&window.clearTimeout(y.current)}},[l.part_number,l.part_id,e,n?.part_number]);const _=()=>{const C={};if(l.part_number.trim()||(C.part_number="Part Number is required"),l.part_description.trim()||(C.part_description="Part Description is required"),l.unit||(C.unit="Unit is required"),l.part_type||(C.part_type="Part Type is required"),["stock","supply","service"].includes(l.part_type)||(C.part_type='Part Type must be either "stock", "supply", or "service"'),(!l.category||l.category.trim()==="")&&(C.category="Category is required"),!(l.part_type==="supply"||l.part_type==="service")){const W=parseFloat(String(l.quantity_on_hand));l.quantity_on_hand!==""&&(isNaN(W)||W<0)&&(C.quantity_on_hand="Quantity on Hand must be a valid number >= 0")}const N=parseFloat(String(l.last_unit_cost));l.last_unit_cost!==""&&isNaN(N)&&(C.last_unit_cost="Last Unit Cost must be a valid number");const H=parseFloat(String(l.reorder_point));return l.reorder_point!==""&&isNaN(H)&&(C.reorder_point="Reorder Point must be a valid number"),d(C),Object.keys(C).length===0},w=async()=>{if(!_()){me.error("Please correct the errors before saving.");return}h(!0);try{const C={...l,part_number:l.part_number.trim().toUpperCase(),part_description:l.part_description.trim(),unit:l.unit.trim(),last_unit_cost:l.last_unit_cost===""?null:parseFloat(String(l.last_unit_cost)),quantity_on_hand:l.part_type==="supply"||l.part_type==="service"?"NA":l.quantity_on_hand===""?0:parseFloat(String(l.quantity_on_hand)),reorder_point:l.reorder_point===""?null:parseFloat(String(l.reorder_point)),part_type:l.part_type.trim(),category:l.category.trim()},N=await r(C);N?.warning&&me.warning(N.warning),me.success(`Part ${a?"updated":"added"} successfully!`),t()}catch(C){console.error("Error saving part:",C);let N=`Failed to ${a?"update":"add"} part.`;C.response?.data?.error?N=C.response.data.error:C.response?.data?.message&&(N=C.response.data.message),C.response?.status===409||N.includes("Part number already exists")||N.includes("duplicate key value")||N.includes("already exists")?(d(H=>({...H,part_number:"Part number already exists. Please use a unique part number."})),me.error("Part number already exists. Please use a unique part number.")):me.error(N)}finally{h(!1)}},A=()=>{f||t()},P=o||(a?"Edit Part":"Add New Part"),[E,T]=x.useState([]),[S,I]=x.useState([]),[U,O]=x.useState(""),[M,L]=x.useState(""),[q,z]=x.useState(""),[K,J]=x.useState(!1),R=!!l.part_id;x.useEffect(()=>{e&&(async()=>{try{const C=await ve.get("/api/vendors");I(C.data||[])}catch{}})()},[e]),x.useEffect(()=>{if(!e)return;const C=l.part_id;if(!C){T([]);return}(async()=>{try{const N=await Tm(C);T(N||[])}catch{T([])}})()},[e,l.part_id]);const k=async()=>{const C=String(l.part_number||"").trim().toUpperCase();if(C){if(!U||!M.trim()){me.error("Select a vendor and enter vendor part number");return}try{const N={vendor_id:Number(U),vendor_part_number:M.trim().toUpperCase(),vendor_part_description:q||void 0,preferred:K};if(l.part_id){await Vae(l.part_id,N);const H=await Tm(l.part_id);T(H||[])}else{await Hae(C,N);const H=await Jm(C);T(H||[])}O(""),L(""),z(""),J(!1),me.success("Vendor mapping added")}catch(N){me.error(N?.response?.data?.error||"Failed to add vendor mapping")}}},$=async C=>{try{if(l.part_id){await Yae(l.part_id,C.id,{preferred:!C.preferred});const N=await Tm(l.part_id);T(N||[])}else{await Gae(l.part_number.toUpperCase(),C.id,{preferred:!C.preferred});const N=await Jm(l.part_number.toUpperCase());T(N||[])}}catch{me.error("Failed to update preferred")}},X=async C=>{if(window.confirm("Remove this vendor mapping?"))try{if(l.part_id){await Qae(l.part_id,C.id);const N=await Tm(l.part_id);T(N||[])}else{await Kae(l.part_number.toUpperCase(),C.id);const N=await Jm(l.part_number.toUpperCase());T(N||[])}}catch{me.error("Failed to delete mapping")}};return i.jsxs(dr,{open:e,onClose:A,maxWidth:"md",fullWidth:!0,children:[i.jsx(fr,{children:P}),i.jsx(hr,{children:i.jsxs(ut,{spacing:3,sx:{mt:1},children:[i.jsxs(ie,{container:!0,spacing:2,children:[i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(Pe,{label:"Part Number",value:l.part_number,onChange:C=>b("part_number",C.target.value),fullWidth:!0,required:!0,error:!!u.part_number,helperText:u.part_number,inputRef:p}),!u.part_number&&v&&i.jsx(Pt,{severity:"warning",sx:{mt:1},children:v})]}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Part Type",value:l.part_type,onChange:C=>b("part_type",C.target.value),select:!0,fullWidth:!0,required:!0,error:!!u.part_type,helperText:u.part_type,children:eie.map(C=>i.jsx(Jt,{value:C,children:C.charAt(0).toUpperCase()+C.slice(1)},C))})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Zae,{label:"Category",value:l.category,onChange:C=>b("category",C),error:!!u.category,errorMessage:u.category})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Part Description",value:l.part_description,onChange:C=>b("part_description",C.target.value),fullWidth:!0,required:!0,error:!!u.part_description,helperText:u.part_description,multiline:!0,rows:2})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"Unit",value:l.unit,onChange:C=>b("unit",C.target.value),select:!0,fullWidth:!0,required:!0,error:!!u.unit,helperText:u.unit,children:h2.map(C=>i.jsx(Jt,{value:C,children:C},C))})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"Last Unit Cost",value:l.last_unit_cost,onChange:C=>b("last_unit_cost",C.target.value),type:"number",fullWidth:!0,error:!!u.last_unit_cost,helperText:u.last_unit_cost,inputProps:{step:"0.01",min:"0"}})}),l.part_type==="stock"&&i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"Quantity on Hand",value:l.quantity_on_hand,onChange:C=>b("quantity_on_hand",C.target.value),type:"number",fullWidth:!0,error:!!u.quantity_on_hand,helperText:u.quantity_on_hand,inputProps:{step:"1",min:"0"},disabled:s?.access_role==="Sales and Purchase"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Reorder Point",value:l.reorder_point,onChange:C=>b("reorder_point",C.target.value),type:"number",fullWidth:!0,error:!!u.reorder_point,helperText:u.reorder_point,inputProps:{step:"1",min:"0"}})})]}),Object.keys(u).length>0&&i.jsx(Pt,{severity:"error",children:i.jsx(B,{variant:"body2",children:"Please correct the errors above before saving."})}),i.jsxs(Z,{children:[i.jsx(B,{variant:"h6",sx:{mb:1},children:"Vendors"}),!R&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"Save the part first to manage vendor mappings."}),R&&i.jsxs(i.Fragment,{children:[i.jsxs(ie,{container:!0,spacing:1,sx:{mb:1},children:[i.jsx(ie,{item:!0,xs:12,sm:3,children:i.jsxs(Pe,{label:"Vendor",select:!0,value:U,onChange:C=>O(C.target.value===""?"":Number(C.target.value)),fullWidth:!0,SelectProps:{native:!0},children:[i.jsx("option",{value:""}),S.map(C=>i.jsx("option",{value:C.vendor_id,children:C.vendor_name},C.vendor_id))]})}),i.jsx(ie,{item:!0,xs:12,sm:3,children:i.jsx(Pe,{label:"Vendor Part #",value:M,onChange:C=>L(C.target.value),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"Vendor Part Description",value:q,onChange:C=>z(C.target.value),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:2,children:i.jsx(xe,{variant:"outlined",onClick:()=>J(C=>!C),fullWidth:!0,children:K?"Preferred ":"Preferred"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(xe,{variant:"contained",onClick:k,children:"Add Vendor Mapping"})})]}),E.length===0?i.jsx(B,{variant:"body2",color:"text.secondary",children:"No vendor mappings yet."}):i.jsxs(ie,{container:!0,spacing:1,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsxs(ie,{container:!0,spacing:1,sx:{fontWeight:600,mb:1},children:[i.jsx(ie,{item:!0,xs:12,sm:2.5,children:"Vendor"}),i.jsx(ie,{item:!0,xs:12,sm:2.5,children:"Vendor Part #"}),i.jsx(ie,{item:!0,xs:12,sm:3,children:"Description"}),i.jsx(ie,{item:!0,xs:12,sm:1,children:"Pref"}),i.jsx(ie,{item:!0,xs:12,sm:3,children:"Actions"})]})}),E.map(C=>i.jsx(ie,{item:!0,xs:12,children:i.jsxs(ie,{container:!0,spacing:1,alignItems:"center",sx:{py:1,borderBottom:"1px solid #e0e0e0"},children:[i.jsx(ie,{item:!0,xs:12,sm:2.5,children:i.jsx(B,{variant:"body2",noWrap:!0,children:C.vendor_name||C.vendor_id})}),i.jsx(ie,{item:!0,xs:12,sm:2.5,children:i.jsx(B,{variant:"body2",noWrap:!0,children:C.vendor_part_number})}),i.jsx(ie,{item:!0,xs:12,sm:3,children:i.jsx(B,{variant:"body2",noWrap:!0,children:C.vendor_part_description||""})}),i.jsx(ie,{item:!0,xs:12,sm:1,sx:{textAlign:"center"},children:C.preferred?"":""}),i.jsx(ie,{item:!0,xs:12,sm:3,children:i.jsxs(ut,{direction:"row",spacing:1,sx:{flexWrap:"wrap"},children:[i.jsx(xe,{size:"small",variant:"outlined",onClick:()=>$(C),sx:{minWidth:"fit-content"},children:C.preferred?"Unset":"Set Preferred"}),i.jsx(xe,{size:"small",color:"error",variant:"outlined",onClick:()=>X(C),sx:{minWidth:"fit-content"},children:"Remove"})]})})]})},C.id))]})]})]})]})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:A,disabled:f,children:"Cancel"}),i.jsx(xe,{onClick:w,variant:"contained",disabled:f,children:f?"Saving...":a?"Update Part":"Save Part"})]})]})},tie=()=>{const[e,t]=x.useState(""),[r,n]=x.useState([]),[a,o]=x.useState(!1),[s,l]=x.useState(!1),[c,u]=x.useState(null),[d,f]=x.useState(!1),[h,p]=x.useState(0),[v,m]=x.useState(null),[y,b]=x.useState(!1),_=x.useRef(null),[w,A]=x.useState(!1),[P,E]=x.useState(null),[T,S]=x.useState(!1),[I,U]=x.useState(null),[O,M]=x.useState(!1),[L,q]=x.useState({page:0,pageSize:10}),{user:z}=Jn(),K=async()=>{o(!0);try{const ee=await Uae();console.log("Raw inventory response:",ee),ee.length>0&&console.log("Sample inventory item from frontend:",{part_id:ee[0].part_id,part_number:ee[0].part_number,last_unit_cost:ee[0].last_unit_cost,last_unit_cost_type:typeof ee[0].last_unit_cost,quantity_on_hand:ee[0].quantity_on_hand,quantity_on_hand_type:typeof ee[0].quantity_on_hand});const le=ee.map((V,Ve)=>({...V,id:V.part_number||Ve}));n(le)}catch(ee){console.error("Error fetching inventory:",ee)}finally{o(!1)}};x.useEffect(()=>{K();const ee=()=>K();return window.addEventListener("inventory-updated",ee),()=>window.removeEventListener("inventory-updated",ee)},[]);const J=r.filter(ee=>ee.part_number?.toUpperCase().includes(e.toUpperCase())||ee.part_description?.toLowerCase().includes(e.toLowerCase())),R=[{field:"part_number",headerName:"Part #",flex:1,headerAlign:"left",editable:!0},{field:"part_description",headerName:"Part Description",flex:2,headerAlign:"left"},{field:"category",headerName:"Category",flex:1,headerAlign:"left"},{field:"quantity_on_hand",headerName:"Quantity on Hand",flex:1,type:"number",editable:z?.access_role!=="Sales and Purchase",align:"center",headerAlign:"left"},{field:"unit",headerName:"UOM",flex:.5,headerAlign:"left"},{field:"last_unit_cost",headerName:"Last Unit Cost",flex:1,type:"number",editable:!0,align:"center",headerAlign:"left",valueFormatter:ee=>`$${(Number(ee.value)||0).toFixed(2)}`,valueGetter:ee=>Number(ee.value)||0},{field:"reorder_point",headerName:"Reorder Point",flex:.75,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"value",headerName:"Value",flex:1,type:"number",valueGetter:ee=>{const le=Number(ee.row.quantity_on_hand)||0,V=Number(ee.row.last_unit_cost)||0;return le*V},valueFormatter:ee=>`$${(Number(ee.value)||0).toFixed(2)}`,headerAlign:"center",align:"center"},{field:"actions",headerName:"Actions",width:100,headerAlign:"left",sortable:!1,renderCell:ee=>i.jsx(vr,{size:"small",color:"error",onClick:le=>{le.stopPropagation(),k(ee.row.part_number)},children:i.jsx(ga,{fontSize:"medium",sx:{fontSize:28}})})}].filter(Boolean),k=async ee=>{if(window.confirm(`Are you sure you want to delete part ${ee}?`))try{console.log(`Deleting part: ${ee}`);const le=await ve.delete(`/api/inventory/${encodeURIComponent(ee)}`);console.log(`Part ${ee} deleted successfully:`,le.data),alert(`Part ${ee} deleted successfully!`),K()}catch(le){console.error(`Error deleting part ${ee}:`,le),alert(`Error deleting part ${ee}. Please check the console.`)}},$=async(ee,le)=>{console.log("Attempting to update row:",ee);const V={};if(ee.part_number!==le.part_number){const Me=String(ee.part_number).trim().toUpperCase();if(!Me)return alert("Part number cannot be empty."),Promise.reject("Invalid part number");V.part_number=Me}if(ee.quantity_on_hand!==le.quantity_on_hand){if(z?.access_role==="Sales and Purchase")return alert("Sales and Purchase users cannot modify quantity on hand for existing parts."),Promise.reject("Access denied");const Me=parseFloat(String(ee.quantity_on_hand));if(isNaN(Me))return alert("Invalid quantity value. Please enter a valid number."),Promise.reject("Invalid quantity");V.quantity_on_hand=Me}if(ee.reorder_point!==le.reorder_point){const Me=parseFloat(String(ee.reorder_point));if(isNaN(Me))return alert("Invalid reorder point value. Please enter a valid number."),Promise.reject("Invalid reorder point");V.reorder_point=Me}if(ee.last_unit_cost!==le.last_unit_cost){const Me=parseFloat(String(ee.last_unit_cost));if(isNaN(Me))return alert("Invalid last unit cost value. Please enter a valid number."),Promise.reject("Invalid last unit cost");V.last_unit_cost=Me}if(ee.category!==le.category&&(V.category=ee.category),Object.keys(V).length===0)return console.log("No fields changed."),ee;const Ve=le.part_number;try{console.log(" processRowUpdate: Sending PUT request"),console.log(" URL:",`/api/inventory/${encodeURIComponent(Ve)}`),console.log(" Request body:",V),console.log(" Old part number:",le.part_number),console.log(" New part number:",ee.part_number);const Me=await ve.put(`/api/inventory/${encodeURIComponent(Ve)}`,V);return console.log(`Inventory updated for part ${Ve}:`,Me.data),alert(`Part ${Ve} updated successfully!`),await K(),Me.data.updatedItem||ee}catch(Me){return console.error(`Error updating inventory for part ${Ve}:`,Me),Me instanceof ci&&Me.response&&Me.response.data&&Me.response.data.error?alert(`Error updating inventory: ${Me.response.data.error}`):alert(`Error updating inventory for part ${Ve}. Please check the console.`),Promise.reject(Me)}},X=()=>{const ee=J.map(Me=>({...Me,value:(Number(Me.quantity_on_hand)||0)*(Number(Me.last_unit_cost)||0)})),le=Sl.unparse(ee),V=new Blob([le],{type:"text/csv;charset=utf-8;"}),Ve=document.createElement("a");if(Ve.download!==void 0){const Me=URL.createObjectURL(V);Ve.setAttribute("href",Me),Ve.setAttribute("download","inventory_list.csv"),Ve.style.visibility="hidden",document.body.appendChild(Ve),Ve.click()}},C=()=>{u(null),l(!0)},N=async ee=>{const le={...ee,part_number:ee.part_number.trim().toUpperCase(),part_description:ee.part_description.trim(),unit:ee.unit.trim(),part_type:ee.part_type.trim()};try{let V;if(c){const Ve={...le,part_number:le.part_number};console.log('dY"? Frontend: Sending PUT request'),console.log('dY"< URL:',`/api/inventory/${encodeURIComponent(c.part_number)}`),console.log('dY"< Request body:',Ve),console.log('dY"< Original part number:',c.part_number),console.log('dY"< New part number:',le.part_number),V=await ve.put(`/api/inventory/${encodeURIComponent(c.part_number)}`,Ve)}else V=await ve.post("/api/inventory",le);return K(),V.data}catch(V){throw V}},H=()=>{l(!1),u(null)},W=ee=>{u({part_id:ee.row.part_id,part_number:ee.row.part_number,part_description:ee.row.part_description||"",unit:ee.row.unit||"Each",last_unit_cost:ee.row.last_unit_cost||"",quantity_on_hand:ee.row.quantity_on_hand||"",reorder_point:ee.row.reorder_point||"",part_type:ee.row.part_type||"stock",category:ee.row.category||"Uncategorized"}),l(!0)},ne=()=>{_.current?.click()},se=async ee=>{const le=ee.target.files?.[0];if(le){if(!le.name.endsWith(".csv")&&le.type!=="text/csv"){alert("Please select a valid CSV file");return}if(le.size>5*1024*1024){alert("File size must be less than 5MB");return}await oe(le)}},oe=async ee=>{f(!0),p(0),m(null);const le=new FormData;le.append("csvFile",ee);try{const V=setInterval(()=>{p(Me=>Me>=90?(clearInterval(V),90):Me+10)},200),Ve=await ve.post("/api/inventory/upload-csv",le,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:Me=>{if(Me.total){const Fe=Math.round(Me.loaded*90/Me.total);p(Fe)}}});clearInterval(V),p(100),m(Ve.data),b(!0),setTimeout(()=>{K()},1e3)}catch(V){console.error("Error uploading CSV:",V),V instanceof ci&&V.response?.data?m({error:"Upload failed",errors:V.response.data.errors||[V.response.data.error||"Unknown error"],warnings:V.response.data.warnings||[]}):m({error:"Upload failed",errors:["An unexpected error occurred during upload"]}),b(!0)}finally{f(!1),p(0),_.current&&(_.current.value="")}},ae=async()=>{try{const ee=await ve.get("/api/inventory/csv-template",{responseType:"blob"}),le=window.URL.createObjectURL(new Blob([ee.data])),V=document.createElement("a");V.href=le,V.setAttribute("download","inventory_template.csv"),document.body.appendChild(V),V.click(),V.remove(),window.URL.revokeObjectURL(le)}catch(ee){console.error("Error downloading template:",ee),alert("Error downloading template")}},pe=()=>{b(!1),m(null)},ge=async()=>{A(!0);try{const ee=[],le=[],V=Qe=>{const it=[],st=[];let vt=String(Qe||"");const Ye=vt,Ze=vt.replace(/\s+/g,"");Ze!==vt&&it.push("Removed spaces"),vt=Ze;const We=vt.toUpperCase();We!==vt&&it.push("Converted to uppercase"),vt=We;const wt=vt.replace(/[^A-Z0-9\/()]/g,"");wt!==vt&&it.push("Removed punctuation excluding ( ) /"),vt=wt;const It=vt;return vt=vt.replace(/(\d)\/(1\d|\d)/g,(Ot,Wt,jt,lr,$e)=>{const He=$e[lr-1]||"",Je=$e[lr+Ot.length]||"";return He==="("&&Je===")"?Ot:`(${Wt}/${jt})`}),vt!==It&&it.push("Wrapped fractions with parentheses"),vt.includes("/")&&(/^[A-Z]{3,}/.test(vt)||/[A-Z]{3,}$/.test(vt))&&st.push("Description text detected with fraction"),/\d\.|\.\d/.test(vt)&&st.push("Decimal detected; consider fraction"),{cleaned:vt,actions:it,warnings:st,original:Ye}},Ve=r.map(Qe=>{const it=V(Qe.part_number);return(it.cleaned!==Qe.part_number||it.actions.length>0)&&ee.push({part_number:Qe.part_number,cleaned_part_number:it.cleaned,actions:it.actions}),it.warnings.length>0&&le.push({part_number:Qe.part_number,warnings:it.warnings}),{...Qe,_clean:it.cleaned}}),Me={};Ve.forEach(Qe=>{Me[Qe._clean]||(Me[Qe._clean]=[]),Me[Qe._clean].push(Qe)});const Fe=Object.entries(Me).filter(([,Qe])=>Qe.length>1).map(([,Qe])=>{const it=Qe.map(Ye=>({part_number:Ye.part_number,unit:Ye.unit})),st=Qe[0].part_number,vt=new Set(Qe.map(Ye=>Ye.unit)).size>1;return{proposedKeep:st,candidates:it,unitMismatch:vt}});U({fixes:ee,flags:le,duplicateGroups:Fe}),M(!0)}catch(ee){console.error("Error during cleanup preview:",ee),alert("Failed to analyze inventory for cleanup.")}finally{A(!1)}},Q=async()=>{if(!I)return;const ee=(I.duplicateGroups||[]).map(le=>({keepPartNumber:le.proposedKeep,mergePartNumbers:le.candidates.map(V=>V.part_number).filter(V=>V!==le.proposedKeep)}));A(!0);try{const le=await dS("stock",ee);M(!1),E(le),S(!0),await K()}catch(le){console.error("Error applying cleanup:",le),alert("Failed to apply cleanup.")}finally{A(!1)}},G=()=>{S(!1),E(null)};return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4},children:[i.jsxs(Z,{sx:{mb:4},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Stock"}),i.jsxs(ut,{direction:"row",spacing:2,children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:C,children:"New Part"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Cd,{}),onClick:ne,children:"Upload CSV"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:ae,children:"Download Template"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:X,children:"Export CSV"}),i.jsx(xe,{variant:"outlined",color:"warning",onClick:ge,disabled:w,startIcon:w?i.jsx(er,{size:20}):i.jsx(ga,{}),children:w?"Cleaning...":"Clean"})]})]}),i.jsx("input",{type:"file",ref:_,onChange:se,accept:".csv",style:{display:"none"}}),d&&i.jsxs(bt,{sx:{p:2,mb:2},children:[i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Uploading CSV file..."}),i.jsx(Td,{variant:"determinate",value:h}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[h,"% complete"]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(Pe,{fullWidth:!0,variant:"outlined",placeholder:"Search stock...",value:e,onChange:ee=>t(ee.target.value),InputProps:{startAdornment:i.jsx(aa,{position:"start",children:i.jsx(di,{})})},sx:{mb:2}}),i.jsx(Po,{rows:J,columns:R,loading:a,paginationModel:L,onPaginationModelChange:ee=>q(ee),pageSizeOptions:[10,20,50],processRowUpdate:$,getRowId:ee=>ee.id,onRowClick:(ee,le)=>{const V=le.target;V.closest('.MuiDataGrid-cell[data-field="part_number"]')||V.closest('.MuiDataGrid-cell[data-field="quantity_on_hand"]')||V.closest('.MuiDataGrid-cell[data-field="last_unit_cost"]')||V.closest('.MuiDataGrid-cell[data-field="reorder_point"]')||W(ee)},sx:{cursor:"pointer","& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})})]}),i.jsxs(dr,{open:O,onClose:()=>M(!1),maxWidth:"md",fullWidth:!0,children:[i.jsx(fr,{children:"Clean and Enforce Rules (Preview)"}),i.jsx(hr,{children:I?i.jsxs(Z,{children:[i.jsx(B,{variant:"h6",children:"Fixes"}),i.jsx(pa,{dense:!0,children:(I.fixes||[]).slice(0,200).map((ee,le)=>i.jsx(Sa,{button:!0,onClick:()=>{const V=r.find(Ve=>Ve.part_number===ee.part_number);V&&(u({part_id:V.part_id,part_number:V.part_number,part_description:V.part_description||"",unit:V.unit||"Each",last_unit_cost:V.last_unit_cost||"",quantity_on_hand:V.quantity_on_hand||"",reorder_point:V.reorder_point||"",part_type:V.part_type||"stock",category:V.category||"Uncategorized"}),l(!0))},children:i.jsx(Qn,{primary:`${ee.part_number} -> ${ee.cleaned_part_number}`,secondary:(ee.actions||[]).join(", ")})},le))}),I.flags&&I.flags.length>0&&i.jsxs(i.Fragment,{children:[i.jsx(B,{variant:"h6",sx:{mt:2},children:"Flags"}),i.jsx(pa,{dense:!0,children:(I.flags||[]).map((ee,le)=>i.jsx(Sa,{button:!0,onClick:()=>{const V=r.find(Ve=>Ve.part_number===ee.part_number);V&&(u({part_id:V.part_id,part_number:V.part_number,part_description:V.part_description||"",unit:V.unit||"Each",last_unit_cost:V.last_unit_cost||"",quantity_on_hand:V.quantity_on_hand||"",reorder_point:V.reorder_point||"",part_type:V.part_type||"stock",category:V.category||"Uncategorized"}),l(!0))},children:i.jsx(Qn,{primary:`${ee.part_number}`,secondary:(ee.warnings||[]).join(", ")})},le))})]}),i.jsx(B,{variant:"h6",sx:{mt:2},children:"Potential Duplicates"}),i.jsx(pa,{dense:!0,children:(I.duplicateGroups||[]).map((ee,le)=>i.jsx(Sa,{children:i.jsx(Qn,{primary:`Keep ${ee.proposedKeep}  merge ${ee.candidates.map(V=>V.part_number).filter(V=>V!==ee.proposedKeep).join(", ")||"none"}`,secondary:ee.unitMismatch?"Unit mismatch detected - will not merge differing units":void 0})},le))})]}):i.jsx(B,{children:"Loading preview..."})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:()=>M(!1),children:"Cancel"}),i.jsx(xe,{onClick:Q,variant:"contained",disabled:w,children:"Apply"})]})]}),i.jsx(ec,{open:s,onClose:H,onSave:N,initialPart:c||void 0,isEditMode:!!c,title:c?"Edit Inventory Part":"Add New Inventory Part"}),i.jsxs(dr,{open:y,onClose:pe,maxWidth:"md",fullWidth:!0,children:[i.jsx(fr,{children:v?.error?"Upload Failed":"Upload Completed"}),i.jsx(hr,{children:v&&i.jsxs(Z,{children:[v.error?i.jsx(Pt,{severity:"error",sx:{mb:2},children:v.error}):i.jsx(Pt,{severity:"success",sx:{mb:2},children:v.message}),v.summary&&i.jsxs(Z,{sx:{mb:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Summary"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Total: ${v.summary.totalProcessed}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`New: ${v.summary.newItems}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Updated: ${v.summary.updatedItems}`,color:"info"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Vendor Mappings: ${v.summary.vendorMappings||0}`,color:"secondary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Errors: ${v.summary.errors}`,color:"error"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Warnings: ${v.summary.warnings}`,color:"warning"})})]})]}),v.errors&&v.errors.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"error",gutterBottom:!0,children:["Errors (",v.errors.length,")"]}),i.jsx(pa,{dense:!0,children:v.errors.map((ee,le)=>i.jsx(Sa,{children:i.jsx(Qn,{primary:ee})},le))})]}),v.warnings&&v.warnings.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"warning.main",gutterBottom:!0,children:["Warnings (",v.warnings.length,")"]}),i.jsx(pa,{dense:!0,children:v.warnings.map((ee,le)=>i.jsx(Sa,{children:i.jsx(Qn,{primary:ee})},le))})]})]})}),i.jsx(_r,{children:i.jsx(xe,{onClick:pe,variant:"contained",children:"Close"})})]}),i.jsxs(dr,{open:T,onClose:G,maxWidth:"sm",fullWidth:!0,children:[i.jsx(fr,{children:P?.error?"Cleanup Failed":"Cleanup Completed"}),i.jsx(hr,{children:P&&i.jsxs(Z,{children:[P.error?i.jsxs(Pt,{severity:"error",sx:{mb:2},children:[P.message,P.details&&i.jsxs(B,{variant:"body2",sx:{mt:1},children:["Details: ",P.details]})]}):i.jsx(Pt,{severity:"success",sx:{mb:2},children:P.message}),P.summary&&i.jsxs(Z,{sx:{mb:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Summary"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:4,children:i.jsx(ot,{label:`Total: ${P.summary.totalProcessed}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:4,children:i.jsx(ot,{label:`Updated: ${P.summary.itemsUpdated}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:4,children:i.jsx(ot,{label:`Errors: ${P.summary.errors}`,color:"error"})})]})]})]})}),i.jsx(_r,{children:i.jsx(xe,{onClick:G,variant:"contained",children:"Close"})})]})]})},rie=()=>{const[e,t]=x.useState(""),[r,n]=x.useState([]),[a,o]=x.useState(!1),[s,l]=x.useState(!1),[c,u]=x.useState(null),[d,f]=x.useState(!1),[h,p]=x.useState(0),[v,m]=x.useState(null),[y,b]=x.useState(!1),_=x.useRef(null),[w,A]=x.useState({page:0,pageSize:10}),[P,E]=x.useState(!1),[T,S]=x.useState(null),[I,U]=x.useState(!1),[O,M]=x.useState(null),[L,q]=x.useState(!1),z=async()=>{o(!0);try{const G=(await zae()).map((ee,le)=>({...ee,id:ee.part_number||le}));n(G)}catch(Q){console.error("Error fetching supply inventory:",Q)}finally{o(!1)}};x.useEffect(()=>{z();const Q=()=>z();return window.addEventListener("supply-updated",Q),()=>window.removeEventListener("supply-updated",Q)},[]);const K=r.filter(Q=>Q.part_number?.toUpperCase().includes(e.toUpperCase())||Q.part_description?.toLowerCase().includes(e.toLowerCase())),J=[{field:"part_number",headerName:"Part #",flex:1,headerAlign:"left",editable:!0},{field:"part_description",headerName:"Part Description",flex:2,headerAlign:"left"},{field:"category",headerName:"Category",flex:1,headerAlign:"left"},{field:"unit",headerName:"UOM",flex:.5,headerAlign:"left"},{field:"last_unit_cost",headerName:"Last Unit Cost",flex:1,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"reorder_point",headerName:"Reorder Point",flex:.75,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"part_type",headerName:"Type",flex:.5,headerAlign:"left"},{field:"value",headerName:"Value",flex:1,type:"number",valueGetter:Q=>{const G=Q.row.quantity_on_hand==="NA"?0:Number(Q.row.quantity_on_hand)||0,ee=Number(Q.row.last_unit_cost)||0;return G*ee},valueFormatter:Q=>`$${(Number(Q.value)||0).toFixed(2)}`,headerAlign:"center",align:"center"},{field:"actions",headerName:"Actions",width:100,headerAlign:"left",sortable:!1,renderCell:Q=>i.jsx(vr,{size:"small",color:"error",onClick:G=>{G.stopPropagation(),R(Q.row.part_number)},children:i.jsx(ga,{fontSize:"medium",sx:{fontSize:28}})})}],R=async Q=>{if(window.confirm(`Are you sure you want to delete part ${Q}?`))try{console.log(`Deleting part: ${Q}`);const G=await ve.delete(`/api/inventory/${encodeURIComponent(Q)}`);console.log(`Part ${Q} deleted successfully:`,G.data),alert(`Part ${Q} deleted successfully!`),z()}catch(G){console.error(`Error deleting part ${Q}:`,G),alert(`Error deleting part ${Q}. Please check the console.`)}},k=async(Q,G)=>{console.log("Attempting to update row:",Q);const ee={};if(Q.part_number!==G.part_number){const V=String(Q.part_number).trim().toUpperCase();if(!V)return alert("Part number cannot be empty."),Promise.reject("Invalid part number");ee.part_number=V}if(Q.reorder_point!==G.reorder_point){const V=parseFloat(String(Q.reorder_point));if(isNaN(V))return alert("Invalid reorder point value. Please enter a valid number."),Promise.reject("Invalid reorder point");ee.reorder_point=V}if(Q.last_unit_cost!==G.last_unit_cost){const V=parseFloat(String(Q.last_unit_cost));if(isNaN(V))return alert("Invalid last unit cost value. Please enter a valid number."),Promise.reject("Invalid last unit cost");ee.last_unit_cost=V}if(Q.category!==G.category&&(ee.category=Q.category),Object.keys(ee).length===0)return console.log("No fields changed."),Q;const le=ee.part_number?G.part_number:Q.part_number;try{const V=await ve.put(`/api/inventory/${encodeURIComponent(le)}`,ee);return console.log(`Supply inventory updated for part ${le}:`,V.data),alert(`Part ${le} updated successfully!`),await z(),V.data.updatedItem||Q}catch(V){return console.error(`Error updating supply inventory for part ${le}:`,V),V instanceof ci&&V.response&&V.response.data&&V.response.data.error?alert(`Error updating inventory: ${V.response.data.error}`):alert(`Error updating inventory for part ${le}. Please check the console.`),Promise.reject(V)}},$=()=>{const Q=K.map(V=>({...V,value:(V.quantity_on_hand==="NA"?0:Number(V.quantity_on_hand)||0)*(Number(V.last_unit_cost)||0)})),G=Sl.unparse(Q),ee=new Blob([G],{type:"text/csv;charset=utf-8;"}),le=document.createElement("a");if(le.download!==void 0){const V=URL.createObjectURL(ee);le.setAttribute("href",V),le.setAttribute("download","supply_list.csv"),le.style.visibility="hidden",document.body.appendChild(le),le.click()}},X=()=>{u({part_number:"",part_description:"",unit:"",last_unit_cost:"",quantity_on_hand:"NA",reorder_point:"",part_type:"supply",category:"Uncategorized"}),l(!0)},C=async()=>{E(!0);try{const Q=await JL("supply");S(Q?.preview||Q),U(!0)}catch(Q){console.error("Error during cleanup preview:",Q),alert("Failed to analyze supply for cleanup.")}finally{E(!1)}},N=async()=>{if(!T)return;const Q=(T.duplicateGroups||[]).map(G=>({keepPartNumber:G.proposedKeep,mergePartNumbers:G.candidates.map(ee=>ee.part_number).filter(ee=>ee!==G.proposedKeep)}));E(!0);try{const G=await dS("supply",Q);U(!1),M(G),q(!0),await z()}catch(G){console.error("Error applying cleanup:",G),alert("Failed to apply cleanup.")}finally{E(!1)}},H=async Q=>{const G={...Q,part_number:Q.part_number.trim().toUpperCase(),part_description:Q.part_description.trim(),unit:Q.unit.trim(),part_type:Q.part_type.trim()};try{if(c){const{part_number:ee,...le}=G;await ve.put(`/api/inventory/${encodeURIComponent(ee)}`,le)}else await ve.post("/api/inventory",G);z()}catch(ee){throw ee}},W=()=>{l(!1),u(null)},ne=Q=>{u({part_id:Q.row.part_id,part_number:Q.row.part_number,part_description:Q.row.part_description||"",unit:Q.row.unit||"Each",last_unit_cost:Q.row.last_unit_cost||"",quantity_on_hand:Q.row.quantity_on_hand||"",reorder_point:Q.row.reorder_point||"",part_type:Q.row.part_type||"supply",category:Q.row.category||"Uncategorized"}),l(!0)},se=()=>{_.current?.click()},oe=async Q=>{const G=Q.target.files?.[0];if(G){if(!G.name.endsWith(".csv")&&G.type!=="text/csv"){alert("Please select a valid CSV file");return}if(G.size>5*1024*1024){alert("File size must be less than 5MB");return}await ae(G)}},ae=async Q=>{f(!0),p(0),m(null);const G=new FormData;G.append("csvFile",Q);try{const ee=setInterval(()=>{p(V=>V>=90?(clearInterval(ee),90):V+10)},200),le=await ve.post("/api/inventory/upload-csv",G,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:V=>{if(V.total){const Ve=Math.round(V.loaded*90/V.total);p(Ve)}}});clearInterval(ee),p(100),m(le.data),b(!0),setTimeout(()=>{z()},1e3)}catch(ee){console.error("Error uploading CSV:",ee),ee instanceof ci&&ee.response?.data?m({error:"Upload failed",errors:ee.response.data.errors||[ee.response.data.error||"Unknown error"],warnings:ee.response.data.warnings||[]}):m({error:"Upload failed",errors:["An unexpected error occurred during upload"]}),b(!0)}finally{f(!1),p(0),_.current&&(_.current.value="")}},pe=async()=>{try{const Q=await ve.get("/api/inventory/csv-template",{responseType:"blob"}),G=window.URL.createObjectURL(new Blob([Q.data])),ee=document.createElement("a");ee.href=G,ee.setAttribute("download","supply_template.csv"),document.body.appendChild(ee),ee.click(),ee.remove(),window.URL.revokeObjectURL(G)}catch(Q){console.error("Error downloading template:",Q),alert("Error downloading template")}},ge=()=>{b(!1),m(null)};return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4},children:[i.jsxs(Z,{sx:{mb:4},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Supply List"}),i.jsxs(ut,{direction:"row",spacing:2,children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:X,children:"New Part"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Cd,{}),onClick:se,children:"Upload CSV"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:pe,children:"Download Template"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:$,children:"Export CSV"}),i.jsx(xe,{variant:"outlined",color:"warning",onClick:C,disabled:P,startIcon:i.jsx(ga,{}),children:P?"Cleaning...":"Clean"})]})]}),i.jsx("input",{type:"file",ref:_,onChange:oe,accept:".csv",style:{display:"none"}}),d&&i.jsxs(bt,{sx:{p:2,mb:2},children:[i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Uploading CSV file..."}),i.jsx(Td,{variant:"determinate",value:h}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[h,"% complete"]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(Pe,{fullWidth:!0,variant:"outlined",placeholder:"Search supply...",value:e,onChange:Q=>t(Q.target.value),InputProps:{startAdornment:i.jsx(aa,{position:"start",children:i.jsx(di,{})})},sx:{mb:2}}),i.jsx(Po,{rows:K,columns:J,loading:a,paginationModel:w,onPaginationModelChange:Q=>A(Q),pageSizeOptions:[10,20,50],processRowUpdate:k,getRowId:Q=>Q.id,onRowClick:(Q,G)=>{const ee=G.target;ee.closest('.MuiDataGrid-cell[data-field="part_number"]')||ee.closest('.MuiDataGrid-cell[data-field="last_unit_cost"]')||ee.closest('.MuiDataGrid-cell[data-field="reorder_point"]')||ne(Q)},sx:{cursor:"pointer","& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})})]}),i.jsx(ec,{open:s,onClose:W,onSave:H,initialPart:c||void 0,isEditMode:!!c,title:c?"Edit Supply Part":"Add New Supply Part"}),i.jsxs(dr,{open:y,onClose:ge,maxWidth:"md",fullWidth:!0,children:[i.jsx(fr,{children:v?.error?"Upload Failed":"Upload Completed"}),i.jsx(hr,{children:v&&i.jsxs(Z,{children:[v.error?i.jsx(Pt,{severity:"error",sx:{mb:2},children:v.error}):i.jsx(Pt,{severity:"success",sx:{mb:2},children:v.message}),v.summary&&i.jsxs(Z,{sx:{mb:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Summary"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Total: ${v.summary.totalProcessed}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`New: ${v.summary.newItems}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Updated: ${v.summary.updatedItems}`,color:"info"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Vendor Mappings: ${v.summary.vendorMappings||0}`,color:"secondary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Errors: ${v.summary.errors}`,color:"error"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Warnings: ${v.summary.warnings}`,color:"warning"})})]})]}),v.errors&&v.errors.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"error",gutterBottom:!0,children:["Errors (",v.errors.length,")"]}),i.jsx(pa,{dense:!0,children:v.errors.map((Q,G)=>i.jsx(Sa,{children:i.jsx(Qn,{primary:Q})},G))})]}),v.warnings&&v.warnings.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"warning.main",gutterBottom:!0,children:["Warnings (",v.warnings.length,")"]}),i.jsx(pa,{dense:!0,children:v.warnings.map((Q,G)=>i.jsx(Sa,{children:i.jsx(Qn,{primary:Q})},G))})]})]})}),i.jsx(_r,{children:i.jsx(xe,{onClick:ge,variant:"contained",children:"Close"})})]}),i.jsxs(dr,{open:I,onClose:()=>U(!1),maxWidth:"md",fullWidth:!0,children:[i.jsx(fr,{children:"Clean and Enforce Rules (Preview)"}),i.jsx(hr,{children:T?i.jsxs(Z,{children:[i.jsx(B,{variant:"h6",children:"Fixes"}),i.jsx(pa,{dense:!0,children:(T.fixes||[]).slice(0,200).map((Q,G)=>i.jsx(Sa,{children:i.jsx(Qn,{primary:`${Q.part_number} -> ${Q.cleaned_part_number}`,secondary:(Q.actions||[]).join(", ")})},G))}),i.jsx(B,{variant:"h6",sx:{mt:2},children:"Potential Duplicates"}),i.jsx(pa,{dense:!0,children:(T.duplicateGroups||[]).map((Q,G)=>i.jsx(Sa,{children:i.jsx(Qn,{primary:`Keep ${Q.proposedKeep}  merge ${Q.candidates.map(ee=>ee.part_number).filter(ee=>ee!==Q.proposedKeep).join(", ")||"none"}`,secondary:Q.unitMismatch?"Unit mismatch detected - will not merge differing units":void 0})},G))})]}):i.jsx(B,{children:"Loading preview..."})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:()=>U(!1),children:"Cancel"}),i.jsx(xe,{onClick:N,variant:"contained",disabled:P,children:"Apply"})]})]}),i.jsxs(dr,{open:L,onClose:()=>q(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(fr,{children:"Cleanup Completed"}),i.jsx(hr,{children:O?i.jsxs(Z,{children:[i.jsx(Pt,{severity:"success",sx:{mb:2},children:"Cleanup applied successfully."}),i.jsxs(B,{variant:"body2",children:["Fixes applied: ",O?.applied?.fixesApplied||0]}),i.jsxs(B,{variant:"body2",children:["Fixes skipped: ",O?.applied?.fixesSkipped||0]}),i.jsxs(B,{variant:"body2",children:["Merged groups: ",O?.applied?.mergedGroups||0]}),i.jsxs(B,{variant:"body2",children:["Merged items: ",O?.applied?.mergedItems||0]})]}):i.jsx(B,{children:"Loading..."})}),i.jsx(_r,{children:i.jsx(xe,{onClick:()=>q(!1),variant:"contained",children:"Close"})})]})]})},nie=()=>{const[e,t]=x.useState(""),[r,n]=x.useState([]),[a,o]=x.useState(!1),[s,l]=x.useState(!1),[c,u]=x.useState(null),[d,f]=x.useState(!1),[h,p]=x.useState(0),[v,m]=x.useState(null),[y,b]=x.useState(!1),_=x.useRef(null),[w,A]=x.useState({page:0,pageSize:10}),[P,E]=x.useState(!1),[T,S]=x.useState(null),[I,U]=x.useState(!1),[O,M]=x.useState(null),[L,q]=x.useState(!1),z=async()=>{o(!0);try{const G=(await Wae()).map((ee,le)=>({...ee,id:ee.part_number||le}));n(G)}catch(Q){console.error("Error fetching service inventory:",Q)}finally{o(!1)}};x.useEffect(()=>{z();const Q=()=>z();return window.addEventListener("service-updated",Q),()=>window.removeEventListener("service-updated",Q)},[]);const K=r.filter(Q=>Q.part_number?.toUpperCase().includes(e.toUpperCase())||Q.part_description?.toLowerCase().includes(e.toLowerCase())),J=[{field:"part_number",headerName:"Part #",flex:1,headerAlign:"left",editable:!0},{field:"part_description",headerName:"Part Description",flex:2,headerAlign:"left"},{field:"category",headerName:"Category",flex:1,headerAlign:"left"},{field:"unit",headerName:"UOM",flex:.5,headerAlign:"left"},{field:"last_unit_cost",headerName:"Last Unit Cost",flex:1,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"reorder_point",headerName:"Reorder Point",flex:.75,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"part_type",headerName:"Type",flex:.5,headerAlign:"left"},{field:"value",headerName:"Value",flex:1,type:"number",valueGetter:Q=>{const G=Q.row.quantity_on_hand==="NA"?0:Number(Q.row.quantity_on_hand)||0,ee=Number(Q.row.last_unit_cost)||0;return G*ee},valueFormatter:Q=>`$${(Number(Q.value)||0).toFixed(2)}`,headerAlign:"center",align:"center"},{field:"actions",headerName:"Actions",width:100,headerAlign:"left",sortable:!1,renderCell:Q=>i.jsx(vr,{size:"small",color:"error",onClick:G=>{G.stopPropagation(),R(Q.row.part_number)},children:i.jsx(ga,{fontSize:"medium",sx:{fontSize:28}})})}],R=async Q=>{if(window.confirm(`Are you sure you want to delete part ${Q}?`))try{console.log(`Deleting part: ${Q}`);const G=await ve.delete(`/api/inventory/${encodeURIComponent(Q)}`);console.log(`Part ${Q} deleted successfully:`,G.data),alert(`Part ${Q} deleted successfully!`),z()}catch(G){console.error(`Error deleting part ${Q}:`,G),alert(`Error deleting part ${Q}. Please check the console.`)}},k=async(Q,G)=>{console.log("Attempting to update row:",Q);const ee={};if(Q.part_number!==G.part_number){const V=String(Q.part_number).trim().toUpperCase();if(!V)return alert("Part number cannot be empty."),Promise.reject("Invalid part number");ee.part_number=V}if(Q.reorder_point!==G.reorder_point){const V=parseFloat(String(Q.reorder_point));if(isNaN(V))return alert("Invalid reorder point value. Please enter a valid number."),Promise.reject("Invalid reorder point");ee.reorder_point=V}if(Q.last_unit_cost!==G.last_unit_cost){const V=parseFloat(String(Q.last_unit_cost));if(isNaN(V))return alert("Invalid last unit cost value. Please enter a valid number."),Promise.reject("Invalid last unit cost");ee.last_unit_cost=V}if(Q.category!==G.category&&(ee.category=Q.category),Object.keys(ee).length===0)return console.log("No fields changed."),Q;const le=ee.part_number?G.part_number:Q.part_number;try{const V=await ve.put(`/api/inventory/${encodeURIComponent(le)}`,ee);return console.log(`Service inventory updated for part ${le}:`,V.data),alert(`Part ${le} updated successfully!`),await z(),V.data.updatedItem||Q}catch(V){return console.error(`Error updating service inventory for part ${le}:`,V),V instanceof ci&&V.response&&V.response.data&&V.response.data.error?alert(`Error updating inventory: ${V.response.data.error}`):alert(`Error updating inventory for part ${le}. Please check the console.`),Promise.reject(V)}},$=()=>{const Q=K.map(V=>({...V,value:(V.quantity_on_hand==="NA"?0:Number(V.quantity_on_hand)||0)*(Number(V.last_unit_cost)||0)})),G=Sl.unparse(Q),ee=new Blob([G],{type:"text/csv;charset=utf-8;"}),le=document.createElement("a");if(le.download!==void 0){const V=URL.createObjectURL(ee);le.setAttribute("href",V),le.setAttribute("download","service_list.csv"),le.style.visibility="hidden",document.body.appendChild(le),le.click()}},X=()=>{u({part_number:"",part_description:"",unit:"",last_unit_cost:"",quantity_on_hand:"NA",reorder_point:"",part_type:"service",category:"Uncategorized"}),l(!0)},C=async()=>{E(!0);try{const Q=await JL("service");S(Q?.preview||Q),U(!0)}catch(Q){console.error("Error during cleanup preview:",Q),alert("Failed to analyze service for cleanup.")}finally{E(!1)}},N=async()=>{if(!T)return;const Q=(T.duplicateGroups||[]).map(G=>({keepPartNumber:G.proposedKeep,mergePartNumbers:G.candidates.map(ee=>ee.part_number).filter(ee=>ee!==G.proposedKeep)}));E(!0);try{const G=await dS("service",Q);U(!1),M(G),q(!0),await z()}catch(G){console.error("Error applying cleanup:",G),alert("Failed to apply cleanup.")}finally{E(!1)}},H=async Q=>{const G={...Q,part_number:Q.part_number.trim().toUpperCase(),part_description:Q.part_description.trim(),unit:Q.unit.trim(),part_type:Q.part_type.trim()};try{if(c){const{part_number:ee,...le}=G;await ve.put(`/api/inventory/${encodeURIComponent(ee)}`,le)}else await ve.post("/api/inventory",G);z()}catch(ee){throw ee}},W=()=>{l(!1),u(null)},ne=Q=>{u({part_id:Q.row.part_id,part_number:Q.row.part_number,part_description:Q.row.part_description||"",unit:Q.row.unit||"Each",last_unit_cost:Q.row.last_unit_cost||"",quantity_on_hand:Q.row.quantity_on_hand||"",reorder_point:Q.row.reorder_point||"",part_type:Q.row.part_type||"service",category:Q.row.category||"Uncategorized"}),l(!0)},se=()=>{_.current?.click()},oe=async Q=>{const G=Q.target.files?.[0];if(G){if(!G.name.endsWith(".csv")&&G.type!=="text/csv"){alert("Please select a valid CSV file");return}if(G.size>5*1024*1024){alert("File size must be less than 5MB");return}await ae(G)}},ae=async Q=>{f(!0),p(0),m(null);const G=new FormData;G.append("csvFile",Q);try{const ee=setInterval(()=>{p(V=>V>=90?(clearInterval(ee),90):V+10)},200),le=await ve.post("/api/inventory/upload-csv",G,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:V=>{if(V.total){const Ve=Math.round(V.loaded*90/V.total);p(Ve)}}});clearInterval(ee),p(100),m(le.data),b(!0),setTimeout(()=>{z()},1e3)}catch(ee){console.error("Error uploading CSV:",ee),ee instanceof ci&&ee.response?.data?m({error:"Upload failed",errors:ee.response.data.errors||[ee.response.data.error||"Unknown error"],warnings:ee.response.data.warnings||[]}):m({error:"Upload failed",errors:["An unexpected error occurred during upload"]}),b(!0)}finally{f(!1),p(0),_.current&&(_.current.value="")}},pe=async()=>{try{const Q=await ve.get("/api/inventory/csv-template",{responseType:"blob"}),G=window.URL.createObjectURL(new Blob([Q.data])),ee=document.createElement("a");ee.href=G,ee.setAttribute("download","service_template.csv"),document.body.appendChild(ee),ee.click(),ee.remove(),window.URL.revokeObjectURL(G)}catch(Q){console.error("Error downloading template:",Q),alert("Error downloading template")}},ge=()=>{b(!1),m(null)};return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4},children:[i.jsxs(Z,{sx:{mb:4},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Service List"}),i.jsxs(ut,{direction:"row",spacing:2,children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:X,children:"New Part"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Cd,{}),onClick:se,children:"Upload CSV"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:pe,children:"Download Template"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:$,children:"Export CSV"}),i.jsx(xe,{variant:"outlined",color:"warning",onClick:C,disabled:P,startIcon:i.jsx(ga,{}),children:P?"Cleaning...":"Clean"})]})]}),i.jsx("input",{type:"file",ref:_,onChange:oe,accept:".csv",style:{display:"none"}}),d&&i.jsxs(bt,{sx:{p:2,mb:2},children:[i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Uploading CSV file..."}),i.jsx(Td,{variant:"determinate",value:h}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[h,"% complete"]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(Pe,{fullWidth:!0,variant:"outlined",placeholder:"Search service...",value:e,onChange:Q=>t(Q.target.value),InputProps:{startAdornment:i.jsx(aa,{position:"start",children:i.jsx(di,{})})},sx:{mb:2}}),i.jsx(Po,{rows:K,columns:J,loading:a,paginationModel:w,onPaginationModelChange:Q=>A(Q),pageSizeOptions:[10,20,50],processRowUpdate:k,getRowId:Q=>Q.id,onRowClick:(Q,G)=>{const ee=G.target;ee.closest('.MuiDataGrid-cell[data-field="part_number"]')||ee.closest('.MuiDataGrid-cell[data-field="last_unit_cost"]')||ee.closest('.MuiDataGrid-cell[data-field="reorder_point"]')||ne(Q)},sx:{cursor:"pointer","& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})})]}),i.jsx(ec,{open:s,onClose:W,onSave:H,initialPart:c||void 0,isEditMode:!!c,title:c?"Edit Service Part":"Add New Service Part"}),i.jsxs(dr,{open:y,onClose:ge,maxWidth:"md",fullWidth:!0,children:[i.jsx(fr,{children:v?.error?"Upload Failed":"Upload Completed"}),i.jsx(hr,{children:v&&i.jsxs(Z,{children:[v.error?i.jsx(Pt,{severity:"error",sx:{mb:2},children:v.error}):i.jsx(Pt,{severity:"success",sx:{mb:2},children:v.message}),v.summary&&i.jsxs(Z,{sx:{mb:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Summary"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Total: ${v.summary.totalProcessed}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`New: ${v.summary.newItems}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Updated: ${v.summary.updatedItems}`,color:"info"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Vendor Mappings: ${v.summary.vendorMappings||0}`,color:"secondary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Errors: ${v.summary.errors}`,color:"error"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Warnings: ${v.summary.warnings}`,color:"warning"})})]})]}),v.errors&&v.errors.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"error",gutterBottom:!0,children:["Errors (",v.errors.length,")"]}),i.jsx(pa,{dense:!0,children:v.errors.map((Q,G)=>i.jsx(Sa,{children:i.jsx(Qn,{primary:Q})},G))})]}),v.warnings&&v.warnings.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"warning.main",gutterBottom:!0,children:["Warnings (",v.warnings.length,")"]}),i.jsx(pa,{dense:!0,children:v.warnings.map((Q,G)=>i.jsx(Sa,{children:i.jsx(Qn,{primary:Q})},G))})]})]})}),i.jsx(_r,{children:i.jsx(xe,{onClick:ge,variant:"contained",children:"Close"})})]}),i.jsxs(dr,{open:I,onClose:()=>U(!1),maxWidth:"md",fullWidth:!0,children:[i.jsx(fr,{children:"Clean and Enforce Rules (Preview)"}),i.jsx(hr,{children:T?i.jsxs(Z,{children:[i.jsx(B,{variant:"h6",children:"Fixes"}),i.jsx(pa,{dense:!0,children:(T.fixes||[]).slice(0,200).map((Q,G)=>i.jsx(Sa,{children:i.jsx(Qn,{primary:`${Q.part_number} -> ${Q.cleaned_part_number}`,secondary:(Q.actions||[]).join(", ")})},G))}),i.jsx(B,{variant:"h6",sx:{mt:2},children:"Potential Duplicates"}),i.jsx(pa,{dense:!0,children:(T.duplicateGroups||[]).map((Q,G)=>i.jsx(Sa,{children:i.jsx(Qn,{primary:`Keep ${Q.proposedKeep}  merge ${Q.candidates.map(ee=>ee.part_number).filter(ee=>ee!==Q.proposedKeep).join(", ")||"none"}`,secondary:Q.unitMismatch?"Unit mismatch detected - will not merge differing units":void 0})},G))})]}):i.jsx(B,{children:"Loading preview..."})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:()=>U(!1),children:"Cancel"}),i.jsx(xe,{onClick:N,variant:"contained",disabled:P,children:"Apply"})]})]}),i.jsxs(dr,{open:L,onClose:()=>q(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(fr,{children:"Cleanup Completed"}),i.jsx(hr,{children:O?i.jsxs(Z,{children:[i.jsx(Pt,{severity:"success",sx:{mb:2},children:"Cleanup applied successfully."}),i.jsxs(B,{variant:"body2",children:["Fixes applied: ",O?.applied?.fixesApplied||0]}),i.jsxs(B,{variant:"body2",children:["Fixes skipped: ",O?.applied?.fixesSkipped||0]}),i.jsxs(B,{variant:"body2",children:["Merged groups: ",O?.applied?.mergedGroups||0]}),i.jsxs(B,{variant:"body2",children:["Merged items: ",O?.applied?.mergedItems||0]})]}):i.jsx(B,{children:"Loading..."})}),i.jsx(_r,{children:i.jsx(xe,{onClick:()=>q(!1),variant:"contained",children:"Close"})})]})]})};function nn(e){if(e===null||e===!0||e===!1)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function Ft(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function qt(e){Ft(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||mn(e)==="object"&&t==="[object Date]"?new Date(e.getTime()):typeof e=="number"||t==="[object Number]"?new Date(e):((typeof e=="string"||t==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function Zm(e,t){Ft(2,arguments);var r=qt(e),n=nn(t);return isNaN(n)?new Date(NaN):(n&&r.setDate(r.getDate()+n),r)}function eg(e,t){Ft(2,arguments);var r=qt(e),n=nn(t);if(isNaN(n))return new Date(NaN);if(!n)return r;var a=r.getDate(),o=new Date(r.getTime());o.setMonth(r.getMonth()+n+1,0);var s=o.getDate();return a>=s?o:(r.setFullYear(o.getFullYear(),o.getMonth(),a),r)}function Oy(e,t){Ft(2,arguments);var r=qt(e).getTime(),n=nn(t);return new Date(r+n)}var aie=36e5;function iie(e,t){Ft(2,arguments);var r=nn(t);return Oy(e,r*aie)}var oie={};function cs(){return oie}function zc(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=cs(),f=nn((r=(n=(a=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&a!==void 0?a:d.weekStartsOn)!==null&&n!==void 0?n:(c=d.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=qt(e),p=h.getDay(),v=(p<f?7:0)+p-f;return h.setDate(h.getDate()-v),h.setHours(0,0,0,0),h}function Ad(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function Pd(e){Ft(1,arguments);var t=qt(e);return t.setHours(0,0,0,0),t}var sie=864e5;function lie(e,t){Ft(2,arguments);var r=Pd(e),n=Pd(t),a=r.getTime()-Ad(r),o=n.getTime()-Ad(n);return Math.round((a-o)/sie)}var cie=6e4;function uie(e,t){Ft(2,arguments);var r=nn(t);return Oy(e,r*cie)}function die(e,t){Ft(2,arguments);var r=nn(t);return Oy(e,r*1e3)}function fie(e,t){Ft(2,arguments);var r=nn(t),n=r*7;return Zm(e,n)}function gE(e,t){Ft(2,arguments);var r=nn(t);return eg(e,r*12)}function Yu(e,t){Ft(2,arguments);var r=qt(e),n=qt(t),a=r.getTime()-n.getTime();return a<0?-1:a>0?1:a}var ky=6e4,Ey=36e5,hie=1e3;function pie(e,t){Ft(2,arguments);var r=Pd(e),n=Pd(t);return r.getTime()===n.getTime()}function mie(e){return Ft(1,arguments),e instanceof Date||mn(e)==="object"&&Object.prototype.toString.call(e)==="[object Date]"}function ZL(e){if(Ft(1,arguments),!mie(e)&&typeof e!="number")return!1;var t=qt(e);return!isNaN(Number(t))}function gie(e,t){Ft(2,arguments);var r=qt(e),n=qt(t),a=r.getFullYear()-n.getFullYear(),o=r.getMonth()-n.getMonth();return a*12+o}function vie(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getFullYear()-n.getFullYear()}function vE(e,t){var r=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return r<0?-1:r>0?1:r}function e6(e,t){Ft(2,arguments);var r=qt(e),n=qt(t),a=vE(r,n),o=Math.abs(lie(r,n));r.setDate(r.getDate()-a*o);var s=+(vE(r,n)===-a),l=a*(o-s);return l===0?0:l}function Ty(e,t){return Ft(2,arguments),qt(e).getTime()-qt(t).getTime()}var yE={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(t){return t<0?Math.ceil(t):Math.floor(t)}},yie="trunc";function Wp(e){return e?yE[e]:yE[yie]}function xie(e,t,r){Ft(2,arguments);var n=Ty(e,t)/Ey;return Wp(void 0)(n)}function bie(e,t,r){Ft(2,arguments);var n=Ty(e,t)/ky;return Wp(void 0)(n)}function bw(e){Ft(1,arguments);var t=qt(e);return t.setHours(23,59,59,999),t}function _w(e){Ft(1,arguments);var t=qt(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function _ie(e){Ft(1,arguments);var t=qt(e);return bw(t).getTime()===_w(t).getTime()}function t6(e,t){Ft(2,arguments);var r=qt(e),n=qt(t),a=Yu(r,n),o=Math.abs(gie(r,n)),s;if(o<1)s=0;else{r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-a*o);var l=Yu(r,n)===-a;_ie(qt(e))&&o===1&&Yu(e,n)===1&&(l=!1),s=a*(o-Number(l))}return s===0?0:s}function wie(e,t,r){Ft(2,arguments);var n=t6(e,t)/3;return Wp(void 0)(n)}function jie(e,t,r){Ft(2,arguments);var n=Ty(e,t)/1e3;return Wp(void 0)(n)}function Sie(e,t,r){Ft(2,arguments);var n=e6(e,t)/7;return Wp(void 0)(n)}function Cie(e,t){Ft(2,arguments);var r=qt(e),n=qt(t),a=Yu(r,n),o=Math.abs(vie(r,n));r.setFullYear(1584),n.setFullYear(1584);var s=Yu(r,n)===-a,l=a*(o-Number(s));return l===0?0:l}function Aie(e,t){var r;Ft(1,arguments);var n=e||{},a=qt(n.start),o=qt(n.end),s=o.getTime();if(!(a.getTime()<=s))throw new RangeError("Invalid interval");var l=[],c=a;c.setHours(0,0,0,0);var u=Number((r=void 0)!==null&&r!==void 0?r:1);if(u<1||isNaN(u))throw new RangeError("`options.step` must be a number greater than 1");for(;c.getTime()<=s;)l.push(qt(c)),c.setDate(c.getDate()+u),c.setHours(0,0,0,0);return l}function xE(e){Ft(1,arguments);var t=qt(e);return t.setDate(1),t.setHours(0,0,0,0),t}function p2(e){Ft(1,arguments);var t=qt(e),r=t.getFullYear();return t.setFullYear(r+1,0,0),t.setHours(23,59,59,999),t}function Im(e){Ft(1,arguments);var t=qt(e),r=new Date(0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}function m2(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=cs(),f=nn((r=(n=(a=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&a!==void 0?a:d.weekStartsOn)!==null&&n!==void 0?n:(c=d.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=qt(e),p=h.getDay(),v=(p<f?-7:0)+6-(p-f);return h.setDate(h.getDate()+v),h.setHours(23,59,59,999),h}function r6(e,t){Ft(2,arguments);var r=nn(t);return Oy(e,-r)}var Pie=864e5;function Oie(e){Ft(1,arguments);var t=qt(e),r=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var n=t.getTime(),a=r-n;return Math.floor(a/Pie)+1}function Od(e){Ft(1,arguments);var t=1,r=qt(e),n=r.getUTCDay(),a=(n<t?7:0)+n-t;return r.setUTCDate(r.getUTCDate()-a),r.setUTCHours(0,0,0,0),r}function n6(e){Ft(1,arguments);var t=qt(e),r=t.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(r+1,0,4),n.setUTCHours(0,0,0,0);var a=Od(n),o=new Date(0);o.setUTCFullYear(r,0,4),o.setUTCHours(0,0,0,0);var s=Od(o);return t.getTime()>=a.getTime()?r+1:t.getTime()>=s.getTime()?r:r-1}function kie(e){Ft(1,arguments);var t=n6(e),r=new Date(0);r.setUTCFullYear(t,0,4),r.setUTCHours(0,0,0,0);var n=Od(r);return n}var Eie=6048e5;function a6(e){Ft(1,arguments);var t=qt(e),r=Od(t).getTime()-kie(t).getTime();return Math.round(r/Eie)+1}function ru(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=cs(),f=nn((r=(n=(a=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&a!==void 0?a:d.weekStartsOn)!==null&&n!==void 0?n:(c=d.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=qt(e),p=h.getUTCDay(),v=(p<f?7:0)+p-f;return h.setUTCDate(h.getUTCDate()-v),h.setUTCHours(0,0,0,0),h}function fS(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=qt(e),f=d.getUTCFullYear(),h=cs(),p=nn((r=(n=(a=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&a!==void 0?a:h.firstWeekContainsDate)!==null&&n!==void 0?n:(c=h.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&r!==void 0?r:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var v=new Date(0);v.setUTCFullYear(f+1,0,p),v.setUTCHours(0,0,0,0);var m=ru(v,t),y=new Date(0);y.setUTCFullYear(f,0,p),y.setUTCHours(0,0,0,0);var b=ru(y,t);return d.getTime()>=m.getTime()?f+1:d.getTime()>=b.getTime()?f:f-1}function Tie(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=cs(),f=nn((r=(n=(a=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&a!==void 0?a:d.firstWeekContainsDate)!==null&&n!==void 0?n:(c=d.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&r!==void 0?r:1),h=fS(e,t),p=new Date(0);p.setUTCFullYear(h,0,f),p.setUTCHours(0,0,0,0);var v=ru(p,t);return v}var Iie=6048e5;function i6(e,t){Ft(1,arguments);var r=qt(e),n=ru(r,t).getTime()-Tie(r,t).getTime();return Math.round(n/Iie)+1}function Yr(e,t){for(var r=e<0?"-":"",n=Math.abs(e).toString();n.length<t;)n="0"+n;return r+n}var Bl={y:function(t,r){var n=t.getUTCFullYear(),a=n>0?n:1-n;return Yr(r==="yy"?a%100:a,r.length)},M:function(t,r){var n=t.getUTCMonth();return r==="M"?String(n+1):Yr(n+1,2)},d:function(t,r){return Yr(t.getUTCDate(),r.length)},a:function(t,r){var n=t.getUTCHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h:function(t,r){return Yr(t.getUTCHours()%12||12,r.length)},H:function(t,r){return Yr(t.getUTCHours(),r.length)},m:function(t,r){return Yr(t.getUTCMinutes(),r.length)},s:function(t,r){return Yr(t.getUTCSeconds(),r.length)},S:function(t,r){var n=r.length,a=t.getUTCMilliseconds(),o=Math.floor(a*Math.pow(10,n-3));return Yr(o,r.length)}},Su={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Nie={G:function(t,r,n){var a=t.getUTCFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return n.era(a,{width:"abbreviated"});case"GGGGG":return n.era(a,{width:"narrow"});case"GGGG":default:return n.era(a,{width:"wide"})}},y:function(t,r,n){if(r==="yo"){var a=t.getUTCFullYear(),o=a>0?a:1-a;return n.ordinalNumber(o,{unit:"year"})}return Bl.y(t,r)},Y:function(t,r,n,a){var o=fS(t,a),s=o>0?o:1-o;if(r==="YY"){var l=s%100;return Yr(l,2)}return r==="Yo"?n.ordinalNumber(s,{unit:"year"}):Yr(s,r.length)},R:function(t,r){var n=n6(t);return Yr(n,r.length)},u:function(t,r){var n=t.getUTCFullYear();return Yr(n,r.length)},Q:function(t,r,n){var a=Math.ceil((t.getUTCMonth()+1)/3);switch(r){case"Q":return String(a);case"QQ":return Yr(a,2);case"Qo":return n.ordinalNumber(a,{unit:"quarter"});case"QQQ":return n.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(a,{width:"wide",context:"formatting"})}},q:function(t,r,n){var a=Math.ceil((t.getUTCMonth()+1)/3);switch(r){case"q":return String(a);case"qq":return Yr(a,2);case"qo":return n.ordinalNumber(a,{unit:"quarter"});case"qqq":return n.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(a,{width:"wide",context:"standalone"})}},M:function(t,r,n){var a=t.getUTCMonth();switch(r){case"M":case"MM":return Bl.M(t,r);case"Mo":return n.ordinalNumber(a+1,{unit:"month"});case"MMM":return n.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(a,{width:"wide",context:"formatting"})}},L:function(t,r,n){var a=t.getUTCMonth();switch(r){case"L":return String(a+1);case"LL":return Yr(a+1,2);case"Lo":return n.ordinalNumber(a+1,{unit:"month"});case"LLL":return n.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(a,{width:"wide",context:"standalone"})}},w:function(t,r,n,a){var o=i6(t,a);return r==="wo"?n.ordinalNumber(o,{unit:"week"}):Yr(o,r.length)},I:function(t,r,n){var a=a6(t);return r==="Io"?n.ordinalNumber(a,{unit:"week"}):Yr(a,r.length)},d:function(t,r,n){return r==="do"?n.ordinalNumber(t.getUTCDate(),{unit:"date"}):Bl.d(t,r)},D:function(t,r,n){var a=Oie(t);return r==="Do"?n.ordinalNumber(a,{unit:"dayOfYear"}):Yr(a,r.length)},E:function(t,r,n){var a=t.getUTCDay();switch(r){case"E":case"EE":case"EEE":return n.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(a,{width:"short",context:"formatting"});case"EEEE":default:return n.day(a,{width:"wide",context:"formatting"})}},e:function(t,r,n,a){var o=t.getUTCDay(),s=(o-a.weekStartsOn+8)%7||7;switch(r){case"e":return String(s);case"ee":return Yr(s,2);case"eo":return n.ordinalNumber(s,{unit:"day"});case"eee":return n.day(o,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(o,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(o,{width:"short",context:"formatting"});case"eeee":default:return n.day(o,{width:"wide",context:"formatting"})}},c:function(t,r,n,a){var o=t.getUTCDay(),s=(o-a.weekStartsOn+8)%7||7;switch(r){case"c":return String(s);case"cc":return Yr(s,r.length);case"co":return n.ordinalNumber(s,{unit:"day"});case"ccc":return n.day(o,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(o,{width:"narrow",context:"standalone"});case"cccccc":return n.day(o,{width:"short",context:"standalone"});case"cccc":default:return n.day(o,{width:"wide",context:"standalone"})}},i:function(t,r,n){var a=t.getUTCDay(),o=a===0?7:a;switch(r){case"i":return String(o);case"ii":return Yr(o,r.length);case"io":return n.ordinalNumber(o,{unit:"day"});case"iii":return n.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(a,{width:"short",context:"formatting"});case"iiii":default:return n.day(a,{width:"wide",context:"formatting"})}},a:function(t,r,n){var a=t.getUTCHours(),o=a/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},b:function(t,r,n){var a=t.getUTCHours(),o;switch(a===12?o=Su.noon:a===0?o=Su.midnight:o=a/12>=1?"pm":"am",r){case"b":case"bb":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},B:function(t,r,n){var a=t.getUTCHours(),o;switch(a>=17?o=Su.evening:a>=12?o=Su.afternoon:a>=4?o=Su.morning:o=Su.night,r){case"B":case"BB":case"BBB":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},h:function(t,r,n){if(r==="ho"){var a=t.getUTCHours()%12;return a===0&&(a=12),n.ordinalNumber(a,{unit:"hour"})}return Bl.h(t,r)},H:function(t,r,n){return r==="Ho"?n.ordinalNumber(t.getUTCHours(),{unit:"hour"}):Bl.H(t,r)},K:function(t,r,n){var a=t.getUTCHours()%12;return r==="Ko"?n.ordinalNumber(a,{unit:"hour"}):Yr(a,r.length)},k:function(t,r,n){var a=t.getUTCHours();return a===0&&(a=24),r==="ko"?n.ordinalNumber(a,{unit:"hour"}):Yr(a,r.length)},m:function(t,r,n){return r==="mo"?n.ordinalNumber(t.getUTCMinutes(),{unit:"minute"}):Bl.m(t,r)},s:function(t,r,n){return r==="so"?n.ordinalNumber(t.getUTCSeconds(),{unit:"second"}):Bl.s(t,r)},S:function(t,r){return Bl.S(t,r)},X:function(t,r,n,a){var o=a._originalDate||t,s=o.getTimezoneOffset();if(s===0)return"Z";switch(r){case"X":return _E(s);case"XXXX":case"XX":return kc(s);case"XXXXX":case"XXX":default:return kc(s,":")}},x:function(t,r,n,a){var o=a._originalDate||t,s=o.getTimezoneOffset();switch(r){case"x":return _E(s);case"xxxx":case"xx":return kc(s);case"xxxxx":case"xxx":default:return kc(s,":")}},O:function(t,r,n,a){var o=a._originalDate||t,s=o.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+bE(s,":");case"OOOO":default:return"GMT"+kc(s,":")}},z:function(t,r,n,a){var o=a._originalDate||t,s=o.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+bE(s,":");case"zzzz":default:return"GMT"+kc(s,":")}},t:function(t,r,n,a){var o=a._originalDate||t,s=Math.floor(o.getTime()/1e3);return Yr(s,r.length)},T:function(t,r,n,a){var o=a._originalDate||t,s=o.getTime();return Yr(s,r.length)}};function bE(e,t){var r=e>0?"-":"+",n=Math.abs(e),a=Math.floor(n/60),o=n%60;if(o===0)return r+String(a);var s=t;return r+String(a)+s+Yr(o,2)}function _E(e,t){if(e%60===0){var r=e>0?"-":"+";return r+Yr(Math.abs(e)/60,2)}return kc(e,t)}function kc(e,t){var r=t||"",n=e>0?"-":"+",a=Math.abs(e),o=Yr(Math.floor(a/60),2),s=Yr(a%60,2);return n+o+r+s}var wE=function(t,r){switch(t){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},o6=function(t,r){switch(t){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},Die=function(t,r){var n=t.match(/(P+)(p+)?/)||[],a=n[1],o=n[2];if(!o)return wE(t,r);var s;switch(a){case"P":s=r.dateTime({width:"short"});break;case"PP":s=r.dateTime({width:"medium"});break;case"PPP":s=r.dateTime({width:"long"});break;case"PPPP":default:s=r.dateTime({width:"full"});break}return s.replace("{{date}}",wE(a,r)).replace("{{time}}",o6(o,r))},ww={p:o6,P:Die},Mie=["D","DD"],Lie=["YY","YYYY"];function s6(e){return Mie.indexOf(e)!==-1}function l6(e){return Lie.indexOf(e)!==-1}function mv(e,t,r){if(e==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var Rie={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},qie=function(t,r,n){var a,o=Rie[t];return typeof o=="string"?a=o:r===1?a=o.one:a=o.other.replace("{{count}}",r.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+a:a+" ago":a};function g2(e){return function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.width?String(t.width):e.defaultWidth,n=e.formats[r]||e.formats[e.defaultWidth];return n}}var Fie={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},$ie={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Bie={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Uie={date:g2({formats:Fie,defaultWidth:"full"}),time:g2({formats:$ie,defaultWidth:"full"}),dateTime:g2({formats:Bie,defaultWidth:"full"})},zie={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Wie=function(t,r,n,a){return zie[t]};function Nf(e){return function(t,r){var n=r!=null&&r.context?String(r.context):"standalone",a;if(n==="formatting"&&e.formattingValues){var o=e.defaultFormattingWidth||e.defaultWidth,s=r!=null&&r.width?String(r.width):o;a=e.formattingValues[s]||e.formattingValues[o]}else{var l=e.defaultWidth,c=r!=null&&r.width?String(r.width):e.defaultWidth;a=e.values[c]||e.values[l]}var u=e.argumentCallback?e.argumentCallback(t):t;return a[u]}}var Hie={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Vie={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Gie={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Yie={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Kie={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Qie={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Xie=function(t,r){var n=Number(t),a=n%100;if(a>20||a<10)switch(a%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},Jie={ordinalNumber:Xie,era:Nf({values:Hie,defaultWidth:"wide"}),quarter:Nf({values:Vie,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:Nf({values:Gie,defaultWidth:"wide"}),day:Nf({values:Yie,defaultWidth:"wide"}),dayPeriod:Nf({values:Kie,defaultWidth:"wide",formattingValues:Qie,defaultFormattingWidth:"wide"})};function Df(e){return function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=r.width,a=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],o=t.match(a);if(!o)return null;var s=o[0],l=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(l)?eoe(l,function(f){return f.test(s)}):Zie(l,function(f){return f.test(s)}),u;u=e.valueCallback?e.valueCallback(c):c,u=r.valueCallback?r.valueCallback(u):u;var d=t.slice(s.length);return{value:u,rest:d}}}function Zie(e,t){for(var r in e)if(e.hasOwnProperty(r)&&t(e[r]))return r}function eoe(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return r}function toe(e){return function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.match(e.matchPattern);if(!n)return null;var a=n[0],o=t.match(e.parsePattern);if(!o)return null;var s=e.valueCallback?e.valueCallback(o[0]):o[0];s=r.valueCallback?r.valueCallback(s):s;var l=t.slice(a.length);return{value:s,rest:l}}}var roe=/^(\d+)(th|st|nd|rd)?/i,noe=/\d+/i,aoe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},ioe={any:[/^b/i,/^(a|c)/i]},ooe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},soe={any:[/1/i,/2/i,/3/i,/4/i]},loe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},coe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},uoe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},doe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},foe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},hoe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},poe={ordinalNumber:toe({matchPattern:roe,parsePattern:noe,valueCallback:function(t){return parseInt(t,10)}}),era:Df({matchPatterns:aoe,defaultMatchWidth:"wide",parsePatterns:ioe,defaultParseWidth:"any"}),quarter:Df({matchPatterns:ooe,defaultMatchWidth:"wide",parsePatterns:soe,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:Df({matchPatterns:loe,defaultMatchWidth:"wide",parsePatterns:coe,defaultParseWidth:"any"}),day:Df({matchPatterns:uoe,defaultMatchWidth:"wide",parsePatterns:doe,defaultParseWidth:"any"}),dayPeriod:Df({matchPatterns:foe,defaultMatchWidth:"any",parsePatterns:hoe,defaultParseWidth:"any"})},Iy={code:"en-US",formatDistance:qie,formatLong:Uie,formatRelative:Wie,localize:Jie,match:poe,options:{weekStartsOn:0,firstWeekContainsDate:1}},moe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,goe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,voe=/^'([^]*?)'?$/,yoe=/''/g,xoe=/[a-zA-Z]/;function Ru(e,t,r){var n,a,o,s,l,c,u,d,f,h,p,v,m,y,b,_,w,A;Ft(2,arguments);var P=String(t),E=cs(),T=(n=(a=r?.locale)!==null&&a!==void 0?a:E.locale)!==null&&n!==void 0?n:Iy,S=nn((o=(s=(l=(c=r?.firstWeekContainsDate)!==null&&c!==void 0?c:r==null||(u=r.locale)===null||u===void 0||(d=u.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&l!==void 0?l:E.firstWeekContainsDate)!==null&&s!==void 0?s:(f=E.locale)===null||f===void 0||(h=f.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&o!==void 0?o:1);if(!(S>=1&&S<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var I=nn((p=(v=(m=(y=r?.weekStartsOn)!==null&&y!==void 0?y:r==null||(b=r.locale)===null||b===void 0||(_=b.options)===null||_===void 0?void 0:_.weekStartsOn)!==null&&m!==void 0?m:E.weekStartsOn)!==null&&v!==void 0?v:(w=E.locale)===null||w===void 0||(A=w.options)===null||A===void 0?void 0:A.weekStartsOn)!==null&&p!==void 0?p:0);if(!(I>=0&&I<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!T.localize)throw new RangeError("locale must contain localize property");if(!T.formatLong)throw new RangeError("locale must contain formatLong property");var U=qt(e);if(!ZL(U))throw new RangeError("Invalid time value");var O=Ad(U),M=r6(U,O),L={firstWeekContainsDate:S,weekStartsOn:I,locale:T,_originalDate:U},q=P.match(goe).map(function(z){var K=z[0];if(K==="p"||K==="P"){var J=ww[K];return J(z,T.formatLong)}return z}).join("").match(moe).map(function(z){if(z==="''")return"'";var K=z[0];if(K==="'")return boe(z);var J=Nie[K];if(J)return!(r!=null&&r.useAdditionalWeekYearTokens)&&l6(z)&&mv(z,t,String(e)),!(r!=null&&r.useAdditionalDayOfYearTokens)&&s6(z)&&mv(z,t,String(e)),J(M,z,T.localize,L);if(K.match(xoe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+K+"`");return z}).join("");return q}function boe(e){var t=e.match(voe);return t?t[1].replace(yoe,"'"):e}function hS(e,t){if(e==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}function _oe(e){return hS({},e)}var jE=1e3*60,gv=60*24,SE=gv*30,CE=gv*365;function woe(e,t,r){var n,a,o;Ft(2,arguments);var s=cs(),l=(n=(a=r?.locale)!==null&&a!==void 0?a:s.locale)!==null&&n!==void 0?n:Iy;if(!l.formatDistance)throw new RangeError("locale must contain localize.formatDistance property");var c=Yu(e,t);if(isNaN(c))throw new RangeError("Invalid time value");var u=hS(_oe(r),{addSuffix:!!r?.addSuffix,comparison:c}),d,f;c>0?(d=qt(t),f=qt(e)):(d=qt(e),f=qt(t));var h=String((o=r?.roundingMethod)!==null&&o!==void 0?o:"round"),p;if(h==="floor")p=Math.floor;else if(h==="ceil")p=Math.ceil;else if(h==="round")p=Math.round;else throw new RangeError("roundingMethod must be 'floor', 'ceil' or 'round'");var v=f.getTime()-d.getTime(),m=v/jE,y=Ad(f)-Ad(d),b=(v-y)/jE,_=r?.unit,w;if(_?w=String(_):m<1?w="second":m<60?w="minute":m<gv?w="hour":b<SE?w="day":b<CE?w="month":w="year",w==="second"){var A=p(v/1e3);return l.formatDistance("xSeconds",A,u)}else if(w==="minute"){var P=p(m);return l.formatDistance("xMinutes",P,u)}else if(w==="hour"){var E=p(m/60);return l.formatDistance("xHours",E,u)}else if(w==="day"){var T=p(b/gv);return l.formatDistance("xDays",T,u)}else if(w==="month"){var S=p(b/SE);return S===12&&_!=="month"?l.formatDistance("xYears",1,u):l.formatDistance("xMonths",S,u)}else if(w==="year"){var I=p(b/CE);return l.formatDistance("xYears",I,u)}throw new RangeError("unit must be 'second', 'minute', 'hour', 'day', 'month' or 'year'")}function joe(e,t){return Ft(1,arguments),woe(e,Date.now(),t)}function Soe(e,t){var r,n;Ft(1,arguments);var a=qt(e);if(isNaN(a.getTime()))throw new RangeError("Invalid time value");var o=String((r=t?.format)!==null&&r!==void 0?r:"extended"),s=String((n=t?.representation)!==null&&n!==void 0?n:"complete");if(o!=="extended"&&o!=="basic")throw new RangeError("format must be 'extended' or 'basic'");if(s!=="date"&&s!=="time"&&s!=="complete")throw new RangeError("representation must be 'date', 'time', or 'complete'");var l="",c="",u=o==="extended"?"-":"",d=o==="extended"?":":"";if(s!=="time"){var f=Yr(a.getDate(),2),h=Yr(a.getMonth()+1,2),p=Yr(a.getFullYear(),4);l="".concat(p).concat(u).concat(h).concat(u).concat(f)}if(s!=="date"){var v=a.getTimezoneOffset();if(v!==0){var m=Math.abs(v),y=Yr(Math.floor(m/60),2),b=Yr(m%60,2),_=v<0?"+":"-";c="".concat(_).concat(y,":").concat(b)}else c="Z";var w=Yr(a.getHours(),2),A=Yr(a.getMinutes(),2),P=Yr(a.getSeconds(),2),E=l===""?"":"T",T=[w,A,P].join(d);l="".concat(l).concat(E).concat(T).concat(c)}return l}function Coe(e){Ft(1,arguments);var t=qt(e),r=t.getDate();return r}function c6(e){Ft(1,arguments);var t=qt(e),r=t.getFullYear(),n=t.getMonth(),a=new Date(0);return a.setFullYear(r,n+1,0),a.setHours(0,0,0,0),a.getDate()}function Aoe(e){Ft(1,arguments);var t=qt(e),r=t.getHours();return r}function Poe(e){Ft(1,arguments);var t=qt(e),r=t.getMilliseconds();return r}function Ooe(e){Ft(1,arguments);var t=qt(e),r=t.getMinutes();return r}function koe(e){Ft(1,arguments);var t=qt(e),r=t.getMonth();return r}function Eoe(e){Ft(1,arguments);var t=qt(e),r=t.getSeconds();return r}function Toe(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=qt(e),f=d.getFullYear(),h=cs(),p=nn((r=(n=(a=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&a!==void 0?a:h.firstWeekContainsDate)!==null&&n!==void 0?n:(c=h.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&r!==void 0?r:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var v=new Date(0);v.setFullYear(f+1,0,p),v.setHours(0,0,0,0);var m=zc(v,t),y=new Date(0);y.setFullYear(f,0,p),y.setHours(0,0,0,0);var b=zc(y,t);return d.getTime()>=m.getTime()?f+1:d.getTime()>=b.getTime()?f:f-1}function Ioe(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=cs(),f=nn((r=(n=(a=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&a!==void 0?a:d.firstWeekContainsDate)!==null&&n!==void 0?n:(c=d.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&r!==void 0?r:1),h=Toe(e,t),p=new Date(0);p.setFullYear(h,0,f),p.setHours(0,0,0,0);var v=zc(p,t);return v}var Noe=6048e5;function Doe(e,t){Ft(1,arguments);var r=qt(e),n=zc(r,t).getTime()-Ioe(r,t).getTime();return Math.round(n/Noe)+1}function Moe(e){return Ft(1,arguments),qt(e).getFullYear()}function v2(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getTime()>n.getTime()}function Mf(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getTime()<n.getTime()}function Loe(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getTime()===n.getTime()}function AE(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Roe(e,t){if(e){if(typeof e=="string")return AE(e,t);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?AE(e,t):void 0}}function PE(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Roe(e))||t){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var u=r.next();return s=u.done,u},e:function(u){l=!0,o=u},f:function(){try{s||r.return==null||r.return()}finally{if(l)throw o}}}}function an(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v8(e,t)}function vv(e){return vv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vv(e)}function u6(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(u6=function(){return!!e})()}function qoe(e,t){if(t&&(mn(t)=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Kt(e)}function on(e){var t=u6();return function(){var r,n=vv(e);if(t){var a=vv(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return qoe(this,r)}}function Jr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Foe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,SI(n.key),n)}}function Zr(e,t,r){return t&&Foe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ht(e,t,r){return(t=SI(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var $oe=10,d6=function(){function e(){Jr(this,e),Ht(this,"priority",void 0),Ht(this,"subPriority",0)}return Zr(e,[{key:"validate",value:function(r,n){return!0}}]),e}(),Boe=function(e){an(r,e);var t=on(r);function r(n,a,o,s,l){var c;return Jr(this,r),c=t.call(this),c.value=n,c.validateValue=a,c.setValue=o,c.priority=s,l&&(c.subPriority=l),c}return Zr(r,[{key:"validate",value:function(a,o){return this.validateValue(a,this.value,o)}},{key:"set",value:function(a,o,s){return this.setValue(a,o,this.value,s)}}]),r}(d6),Uoe=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",$oe),Ht(Kt(n),"subPriority",-1),n}return Zr(r,[{key:"set",value:function(a,o){if(o.timestampIsSet)return a;var s=new Date(0);return s.setFullYear(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()),s.setHours(a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),s}}]),r}(d6),gn=function(){function e(){Jr(this,e),Ht(this,"incompatibleTokens",void 0),Ht(this,"priority",void 0),Ht(this,"subPriority",void 0)}return Zr(e,[{key:"run",value:function(r,n,a,o){var s=this.parse(r,n,a,o);return s?{setter:new Boe(s.value,this.validate,this.set,this.priority,this.subPriority),rest:s.rest}:null}},{key:"validate",value:function(r,n,a){return!0}}]),e}(),zoe=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",140),Ht(Kt(n),"incompatibleTokens",["R","u","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){switch(o){case"G":case"GG":case"GGG":return s.era(a,{width:"abbreviated"})||s.era(a,{width:"narrow"});case"GGGGG":return s.era(a,{width:"narrow"});case"GGGG":default:return s.era(a,{width:"wide"})||s.era(a,{width:"abbreviated"})||s.era(a,{width:"narrow"})}}},{key:"set",value:function(a,o,s){return o.era=s,a.setUTCFullYear(s,0,1),a.setUTCHours(0,0,0,0),a}}]),r}(gn),Ca={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},bs={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function Aa(e,t){return e&&{value:t(e.value),rest:e.rest}}function na(e,t){var r=t.match(e);return r?{value:parseInt(r[0],10),rest:t.slice(r[0].length)}:null}function _s(e,t){var r=t.match(e);if(!r)return null;if(r[0]==="Z")return{value:0,rest:t.slice(1)};var n=r[1]==="+"?1:-1,a=r[2]?parseInt(r[2],10):0,o=r[3]?parseInt(r[3],10):0,s=r[5]?parseInt(r[5],10):0;return{value:n*(a*Ey+o*ky+s*hie),rest:t.slice(r[0].length)}}function f6(e){return na(Ca.anyDigitsSigned,e)}function va(e,t){switch(e){case 1:return na(Ca.singleDigit,t);case 2:return na(Ca.twoDigits,t);case 3:return na(Ca.threeDigits,t);case 4:return na(Ca.fourDigits,t);default:return na(new RegExp("^\\d{1,"+e+"}"),t)}}function yv(e,t){switch(e){case 1:return na(Ca.singleDigitSigned,t);case 2:return na(Ca.twoDigitsSigned,t);case 3:return na(Ca.threeDigitsSigned,t);case 4:return na(Ca.fourDigitsSigned,t);default:return na(new RegExp("^-?\\d{1,"+e+"}"),t)}}function pS(e){switch(e){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function h6(e,t){var r=t>0,n=r?t:1-t,a;if(n<=50)a=e||100;else{var o=n+50,s=Math.floor(o/100)*100,l=e>=o%100;a=e+s-(l?100:0)}return r?a:1-a}function p6(e){return e%400===0||e%4===0&&e%100!==0}var Woe=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",130),Ht(Kt(n),"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){var l=function(u){return{year:u,isTwoDigitYear:o==="yy"}};switch(o){case"y":return Aa(va(4,a),l);case"yo":return Aa(s.ordinalNumber(a,{unit:"year"}),l);default:return Aa(va(o.length,a),l)}}},{key:"validate",value:function(a,o){return o.isTwoDigitYear||o.year>0}},{key:"set",value:function(a,o,s){var l=a.getUTCFullYear();if(s.isTwoDigitYear){var c=h6(s.year,l);return a.setUTCFullYear(c,0,1),a.setUTCHours(0,0,0,0),a}var u=!("era"in o)||o.era===1?s.year:1-s.year;return a.setUTCFullYear(u,0,1),a.setUTCHours(0,0,0,0),a}}]),r}(gn),Hoe=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",130),Ht(Kt(n),"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){var l=function(u){return{year:u,isTwoDigitYear:o==="YY"}};switch(o){case"Y":return Aa(va(4,a),l);case"Yo":return Aa(s.ordinalNumber(a,{unit:"year"}),l);default:return Aa(va(o.length,a),l)}}},{key:"validate",value:function(a,o){return o.isTwoDigitYear||o.year>0}},{key:"set",value:function(a,o,s,l){var c=fS(a,l);if(s.isTwoDigitYear){var u=h6(s.year,c);return a.setUTCFullYear(u,0,l.firstWeekContainsDate),a.setUTCHours(0,0,0,0),ru(a,l)}var d=!("era"in o)||o.era===1?s.year:1-s.year;return a.setUTCFullYear(d,0,l.firstWeekContainsDate),a.setUTCHours(0,0,0,0),ru(a,l)}}]),r}(gn),Voe=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",130),Ht(Kt(n),"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o){return yv(o==="R"?4:o.length,a)}},{key:"set",value:function(a,o,s){var l=new Date(0);return l.setUTCFullYear(s,0,4),l.setUTCHours(0,0,0,0),Od(l)}}]),r}(gn),Goe=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",130),Ht(Kt(n),"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o){return yv(o==="u"?4:o.length,a)}},{key:"set",value:function(a,o,s){return a.setUTCFullYear(s,0,1),a.setUTCHours(0,0,0,0),a}}]),r}(gn),Yoe=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",120),Ht(Kt(n),"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){switch(o){case"Q":case"QQ":return va(o.length,a);case"Qo":return s.ordinalNumber(a,{unit:"quarter"});case"QQQ":return s.quarter(a,{width:"abbreviated",context:"formatting"})||s.quarter(a,{width:"narrow",context:"formatting"});case"QQQQQ":return s.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(a,{width:"wide",context:"formatting"})||s.quarter(a,{width:"abbreviated",context:"formatting"})||s.quarter(a,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(a,o){return o>=1&&o<=4}},{key:"set",value:function(a,o,s){return a.setUTCMonth((s-1)*3,1),a.setUTCHours(0,0,0,0),a}}]),r}(gn),Koe=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",120),Ht(Kt(n),"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){switch(o){case"q":case"qq":return va(o.length,a);case"qo":return s.ordinalNumber(a,{unit:"quarter"});case"qqq":return s.quarter(a,{width:"abbreviated",context:"standalone"})||s.quarter(a,{width:"narrow",context:"standalone"});case"qqqqq":return s.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(a,{width:"wide",context:"standalone"})||s.quarter(a,{width:"abbreviated",context:"standalone"})||s.quarter(a,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(a,o){return o>=1&&o<=4}},{key:"set",value:function(a,o,s){return a.setUTCMonth((s-1)*3,1),a.setUTCHours(0,0,0,0),a}}]),r}(gn),Qoe=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]),Ht(Kt(n),"priority",110),n}return Zr(r,[{key:"parse",value:function(a,o,s){var l=function(u){return u-1};switch(o){case"M":return Aa(na(Ca.month,a),l);case"MM":return Aa(va(2,a),l);case"Mo":return Aa(s.ordinalNumber(a,{unit:"month"}),l);case"MMM":return s.month(a,{width:"abbreviated",context:"formatting"})||s.month(a,{width:"narrow",context:"formatting"});case"MMMMM":return s.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(a,{width:"wide",context:"formatting"})||s.month(a,{width:"abbreviated",context:"formatting"})||s.month(a,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(a,o){return o>=0&&o<=11}},{key:"set",value:function(a,o,s){return a.setUTCMonth(s,1),a.setUTCHours(0,0,0,0),a}}]),r}(gn),Xoe=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",110),Ht(Kt(n),"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){var l=function(u){return u-1};switch(o){case"L":return Aa(na(Ca.month,a),l);case"LL":return Aa(va(2,a),l);case"Lo":return Aa(s.ordinalNumber(a,{unit:"month"}),l);case"LLL":return s.month(a,{width:"abbreviated",context:"standalone"})||s.month(a,{width:"narrow",context:"standalone"});case"LLLLL":return s.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(a,{width:"wide",context:"standalone"})||s.month(a,{width:"abbreviated",context:"standalone"})||s.month(a,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(a,o){return o>=0&&o<=11}},{key:"set",value:function(a,o,s){return a.setUTCMonth(s,1),a.setUTCHours(0,0,0,0),a}}]),r}(gn);function Joe(e,t,r){Ft(2,arguments);var n=qt(e),a=nn(t),o=i6(n,r)-a;return n.setUTCDate(n.getUTCDate()-o*7),n}var Zoe=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",100),Ht(Kt(n),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){switch(o){case"w":return na(Ca.week,a);case"wo":return s.ordinalNumber(a,{unit:"week"});default:return va(o.length,a)}}},{key:"validate",value:function(a,o){return o>=1&&o<=53}},{key:"set",value:function(a,o,s,l){return ru(Joe(a,s,l),l)}}]),r}(gn);function ese(e,t){Ft(2,arguments);var r=qt(e),n=nn(t),a=a6(r)-n;return r.setUTCDate(r.getUTCDate()-a*7),r}var tse=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",100),Ht(Kt(n),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){switch(o){case"I":return na(Ca.week,a);case"Io":return s.ordinalNumber(a,{unit:"week"});default:return va(o.length,a)}}},{key:"validate",value:function(a,o){return o>=1&&o<=53}},{key:"set",value:function(a,o,s){return Od(ese(a,s))}}]),r}(gn),rse=[31,28,31,30,31,30,31,31,30,31,30,31],nse=[31,29,31,30,31,30,31,31,30,31,30,31],ase=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",90),Ht(Kt(n),"subPriority",1),Ht(Kt(n),"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){switch(o){case"d":return na(Ca.date,a);case"do":return s.ordinalNumber(a,{unit:"date"});default:return va(o.length,a)}}},{key:"validate",value:function(a,o){var s=a.getUTCFullYear(),l=p6(s),c=a.getUTCMonth();return l?o>=1&&o<=nse[c]:o>=1&&o<=rse[c]}},{key:"set",value:function(a,o,s){return a.setUTCDate(s),a.setUTCHours(0,0,0,0),a}}]),r}(gn),ise=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",90),Ht(Kt(n),"subpriority",1),Ht(Kt(n),"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){switch(o){case"D":case"DD":return na(Ca.dayOfYear,a);case"Do":return s.ordinalNumber(a,{unit:"date"});default:return va(o.length,a)}}},{key:"validate",value:function(a,o){var s=a.getUTCFullYear(),l=p6(s);return l?o>=1&&o<=366:o>=1&&o<=365}},{key:"set",value:function(a,o,s){return a.setUTCMonth(0,s),a.setUTCHours(0,0,0,0),a}}]),r}(gn);function mS(e,t,r){var n,a,o,s,l,c,u,d;Ft(2,arguments);var f=cs(),h=nn((n=(a=(o=(s=r?.weekStartsOn)!==null&&s!==void 0?s:r==null||(l=r.locale)===null||l===void 0||(c=l.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&o!==void 0?o:f.weekStartsOn)!==null&&a!==void 0?a:(u=f.locale)===null||u===void 0||(d=u.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&n!==void 0?n:0);if(!(h>=0&&h<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var p=qt(e),v=nn(t),m=p.getUTCDay(),y=v%7,b=(y+7)%7,_=(b<h?7:0)+v-m;return p.setUTCDate(p.getUTCDate()+_),p}var ose=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",90),Ht(Kt(n),"incompatibleTokens",["D","i","e","c","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){switch(o){case"E":case"EE":case"EEE":return s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"});case"EEEEE":return s.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"});case"EEEE":default:return s.day(a,{width:"wide",context:"formatting"})||s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(a,o){return o>=0&&o<=6}},{key:"set",value:function(a,o,s,l){return a=mS(a,s,l),a.setUTCHours(0,0,0,0),a}}]),r}(gn),sse=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",90),Ht(Kt(n),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s,l){var c=function(d){var f=Math.floor((d-1)/7)*7;return(d+l.weekStartsOn+6)%7+f};switch(o){case"e":case"ee":return Aa(va(o.length,a),c);case"eo":return Aa(s.ordinalNumber(a,{unit:"day"}),c);case"eee":return s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"});case"eeeee":return s.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"});case"eeee":default:return s.day(a,{width:"wide",context:"formatting"})||s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(a,o){return o>=0&&o<=6}},{key:"set",value:function(a,o,s,l){return a=mS(a,s,l),a.setUTCHours(0,0,0,0),a}}]),r}(gn),lse=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",90),Ht(Kt(n),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s,l){var c=function(d){var f=Math.floor((d-1)/7)*7;return(d+l.weekStartsOn+6)%7+f};switch(o){case"c":case"cc":return Aa(va(o.length,a),c);case"co":return Aa(s.ordinalNumber(a,{unit:"day"}),c);case"ccc":return s.day(a,{width:"abbreviated",context:"standalone"})||s.day(a,{width:"short",context:"standalone"})||s.day(a,{width:"narrow",context:"standalone"});case"ccccc":return s.day(a,{width:"narrow",context:"standalone"});case"cccccc":return s.day(a,{width:"short",context:"standalone"})||s.day(a,{width:"narrow",context:"standalone"});case"cccc":default:return s.day(a,{width:"wide",context:"standalone"})||s.day(a,{width:"abbreviated",context:"standalone"})||s.day(a,{width:"short",context:"standalone"})||s.day(a,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(a,o){return o>=0&&o<=6}},{key:"set",value:function(a,o,s,l){return a=mS(a,s,l),a.setUTCHours(0,0,0,0),a}}]),r}(gn);function cse(e,t){Ft(2,arguments);var r=nn(t);r%7===0&&(r=r-7);var n=1,a=qt(e),o=a.getUTCDay(),s=r%7,l=(s+7)%7,c=(l<n?7:0)+r-o;return a.setUTCDate(a.getUTCDate()+c),a}var use=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",90),Ht(Kt(n),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){var l=function(u){return u===0?7:u};switch(o){case"i":case"ii":return va(o.length,a);case"io":return s.ordinalNumber(a,{unit:"day"});case"iii":return Aa(s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"}),l);case"iiiii":return Aa(s.day(a,{width:"narrow",context:"formatting"}),l);case"iiiiii":return Aa(s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"}),l);case"iiii":default:return Aa(s.day(a,{width:"wide",context:"formatting"})||s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"}),l)}}},{key:"validate",value:function(a,o){return o>=1&&o<=7}},{key:"set",value:function(a,o,s){return a=cse(a,s),a.setUTCHours(0,0,0,0),a}}]),r}(gn),dse=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",80),Ht(Kt(n),"incompatibleTokens",["b","B","H","k","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){switch(o){case"a":case"aa":case"aaa":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaaa":return s.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(a,{width:"wide",context:"formatting"})||s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(a,o,s){return a.setUTCHours(pS(s),0,0,0),a}}]),r}(gn),fse=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",80),Ht(Kt(n),"incompatibleTokens",["a","B","H","k","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){switch(o){case"b":case"bb":case"bbb":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbbb":return s.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(a,{width:"wide",context:"formatting"})||s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(a,o,s){return a.setUTCHours(pS(s),0,0,0),a}}]),r}(gn),hse=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",80),Ht(Kt(n),"incompatibleTokens",["a","b","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){switch(o){case"B":case"BB":case"BBB":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBBB":return s.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(a,{width:"wide",context:"formatting"})||s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(a,o,s){return a.setUTCHours(pS(s),0,0,0),a}}]),r}(gn),pse=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",70),Ht(Kt(n),"incompatibleTokens",["H","K","k","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){switch(o){case"h":return na(Ca.hour12h,a);case"ho":return s.ordinalNumber(a,{unit:"hour"});default:return va(o.length,a)}}},{key:"validate",value:function(a,o){return o>=1&&o<=12}},{key:"set",value:function(a,o,s){var l=a.getUTCHours()>=12;return l&&s<12?a.setUTCHours(s+12,0,0,0):!l&&s===12?a.setUTCHours(0,0,0,0):a.setUTCHours(s,0,0,0),a}}]),r}(gn),mse=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",70),Ht(Kt(n),"incompatibleTokens",["a","b","h","K","k","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){switch(o){case"H":return na(Ca.hour23h,a);case"Ho":return s.ordinalNumber(a,{unit:"hour"});default:return va(o.length,a)}}},{key:"validate",value:function(a,o){return o>=0&&o<=23}},{key:"set",value:function(a,o,s){return a.setUTCHours(s,0,0,0),a}}]),r}(gn),gse=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",70),Ht(Kt(n),"incompatibleTokens",["h","H","k","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){switch(o){case"K":return na(Ca.hour11h,a);case"Ko":return s.ordinalNumber(a,{unit:"hour"});default:return va(o.length,a)}}},{key:"validate",value:function(a,o){return o>=0&&o<=11}},{key:"set",value:function(a,o,s){var l=a.getUTCHours()>=12;return l&&s<12?a.setUTCHours(s+12,0,0,0):a.setUTCHours(s,0,0,0),a}}]),r}(gn),vse=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",70),Ht(Kt(n),"incompatibleTokens",["a","b","h","H","K","t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){switch(o){case"k":return na(Ca.hour24h,a);case"ko":return s.ordinalNumber(a,{unit:"hour"});default:return va(o.length,a)}}},{key:"validate",value:function(a,o){return o>=1&&o<=24}},{key:"set",value:function(a,o,s){var l=s<=24?s%24:s;return a.setUTCHours(l,0,0,0),a}}]),r}(gn),yse=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",60),Ht(Kt(n),"incompatibleTokens",["t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){switch(o){case"m":return na(Ca.minute,a);case"mo":return s.ordinalNumber(a,{unit:"minute"});default:return va(o.length,a)}}},{key:"validate",value:function(a,o){return o>=0&&o<=59}},{key:"set",value:function(a,o,s){return a.setUTCMinutes(s,0,0),a}}]),r}(gn),xse=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",50),Ht(Kt(n),"incompatibleTokens",["t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o,s){switch(o){case"s":return na(Ca.second,a);case"so":return s.ordinalNumber(a,{unit:"second"});default:return va(o.length,a)}}},{key:"validate",value:function(a,o){return o>=0&&o<=59}},{key:"set",value:function(a,o,s){return a.setUTCSeconds(s,0),a}}]),r}(gn),bse=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",30),Ht(Kt(n),"incompatibleTokens",["t","T"]),n}return Zr(r,[{key:"parse",value:function(a,o){var s=function(c){return Math.floor(c*Math.pow(10,-o.length+3))};return Aa(va(o.length,a),s)}},{key:"set",value:function(a,o,s){return a.setUTCMilliseconds(s),a}}]),r}(gn),_se=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",10),Ht(Kt(n),"incompatibleTokens",["t","T","x"]),n}return Zr(r,[{key:"parse",value:function(a,o){switch(o){case"X":return _s(bs.basicOptionalMinutes,a);case"XX":return _s(bs.basic,a);case"XXXX":return _s(bs.basicOptionalSeconds,a);case"XXXXX":return _s(bs.extendedOptionalSeconds,a);case"XXX":default:return _s(bs.extended,a)}}},{key:"set",value:function(a,o,s){return o.timestampIsSet?a:new Date(a.getTime()-s)}}]),r}(gn),wse=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",10),Ht(Kt(n),"incompatibleTokens",["t","T","X"]),n}return Zr(r,[{key:"parse",value:function(a,o){switch(o){case"x":return _s(bs.basicOptionalMinutes,a);case"xx":return _s(bs.basic,a);case"xxxx":return _s(bs.basicOptionalSeconds,a);case"xxxxx":return _s(bs.extendedOptionalSeconds,a);case"xxx":default:return _s(bs.extended,a)}}},{key:"set",value:function(a,o,s){return o.timestampIsSet?a:new Date(a.getTime()-s)}}]),r}(gn),jse=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",40),Ht(Kt(n),"incompatibleTokens","*"),n}return Zr(r,[{key:"parse",value:function(a){return f6(a)}},{key:"set",value:function(a,o,s){return[new Date(s*1e3),{timestampIsSet:!0}]}}]),r}(gn),Sse=function(e){an(r,e);var t=on(r);function r(){var n;Jr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Kt(n),"priority",20),Ht(Kt(n),"incompatibleTokens","*"),n}return Zr(r,[{key:"parse",value:function(a){return f6(a)}},{key:"set",value:function(a,o,s){return[new Date(s),{timestampIsSet:!0}]}}]),r}(gn),Cse={G:new zoe,y:new Woe,Y:new Hoe,R:new Voe,u:new Goe,Q:new Yoe,q:new Koe,M:new Qoe,L:new Xoe,w:new Zoe,I:new tse,d:new ase,D:new ise,E:new ose,e:new sse,c:new lse,i:new use,a:new dse,b:new fse,B:new hse,h:new pse,H:new mse,K:new gse,k:new vse,m:new yse,s:new xse,S:new bse,X:new _se,x:new wse,t:new jse,T:new Sse},Ase=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Pse=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ose=/^'([^]*?)'?$/,kse=/''/g,Ese=/\S/,Tse=/[a-zA-Z]/;function Ise(e,t,r,n){var a,o,s,l,c,u,d,f,h,p,v,m,y,b,_,w,A,P;Ft(3,arguments);var E=String(e),T=String(t),S=cs(),I=(a=(o=n?.locale)!==null&&o!==void 0?o:S.locale)!==null&&a!==void 0?a:Iy;if(!I.match)throw new RangeError("locale must contain match property");var U=nn((s=(l=(c=(u=n?.firstWeekContainsDate)!==null&&u!==void 0?u:n==null||(d=n.locale)===null||d===void 0||(f=d.options)===null||f===void 0?void 0:f.firstWeekContainsDate)!==null&&c!==void 0?c:S.firstWeekContainsDate)!==null&&l!==void 0?l:(h=S.locale)===null||h===void 0||(p=h.options)===null||p===void 0?void 0:p.firstWeekContainsDate)!==null&&s!==void 0?s:1);if(!(U>=1&&U<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var O=nn((v=(m=(y=(b=n?.weekStartsOn)!==null&&b!==void 0?b:n==null||(_=n.locale)===null||_===void 0||(w=_.options)===null||w===void 0?void 0:w.weekStartsOn)!==null&&y!==void 0?y:S.weekStartsOn)!==null&&m!==void 0?m:(A=S.locale)===null||A===void 0||(P=A.options)===null||P===void 0?void 0:P.weekStartsOn)!==null&&v!==void 0?v:0);if(!(O>=0&&O<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(T==="")return E===""?qt(r):new Date(NaN);var M={firstWeekContainsDate:U,weekStartsOn:O,locale:I},L=[new Uoe],q=T.match(Pse).map(function(oe){var ae=oe[0];if(ae in ww){var pe=ww[ae];return pe(oe,I.formatLong)}return oe}).join("").match(Ase),z=[],K=PE(q),J;try{var R=function(){var ae=J.value;!(n!=null&&n.useAdditionalWeekYearTokens)&&l6(ae)&&mv(ae,T,e),!(n!=null&&n.useAdditionalDayOfYearTokens)&&s6(ae)&&mv(ae,T,e);var pe=ae[0],ge=Cse[pe];if(ge){var Q=ge.incompatibleTokens;if(Array.isArray(Q)){var G=z.find(function(le){return Q.includes(le.token)||le.token===pe});if(G)throw new RangeError("The format string mustn't contain `".concat(G.fullToken,"` and `").concat(ae,"` at the same time"))}else if(ge.incompatibleTokens==="*"&&z.length>0)throw new RangeError("The format string mustn't contain `".concat(ae,"` and any other token at the same time"));z.push({token:pe,fullToken:ae});var ee=ge.run(E,ae,I.match,M);if(!ee)return{v:new Date(NaN)};L.push(ee.setter),E=ee.rest}else{if(pe.match(Tse))throw new RangeError("Format string contains an unescaped latin alphabet character `"+pe+"`");if(ae==="''"?ae="'":pe==="'"&&(ae=Nse(ae)),E.indexOf(ae)===0)E=E.slice(ae.length);else return{v:new Date(NaN)}}};for(K.s();!(J=K.n()).done;){var k=R();if(mn(k)==="object")return k.v}}catch(oe){K.e(oe)}finally{K.f()}if(E.length>0&&Ese.test(E))return new Date(NaN);var $=L.map(function(oe){return oe.priority}).sort(function(oe,ae){return ae-oe}).filter(function(oe,ae,pe){return pe.indexOf(oe)===ae}).map(function(oe){return L.filter(function(ae){return ae.priority===oe}).sort(function(ae,pe){return pe.subPriority-ae.subPriority})}).map(function(oe){return oe[0]}),X=qt(r);if(isNaN(X.getTime()))return new Date(NaN);var C=r6(X,Ad(X)),N={},H=PE($),W;try{for(H.s();!(W=H.n()).done;){var ne=W.value;if(!ne.validate(C,M))return new Date(NaN);var se=ne.set(C,N,M);Array.isArray(se)?(C=se[0],hS(N,se[1])):C=se}}catch(oe){H.e(oe)}finally{H.f()}return C}function Nse(e){return e.match(Ose)[1].replace(kse,"'")}function OE(e){Ft(1,arguments);var t=qt(e);return t.setMinutes(0,0,0),t}function Dse(e,t){Ft(2,arguments);var r=OE(e),n=OE(t);return r.getTime()===n.getTime()}function Mse(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getFullYear()===n.getFullYear()&&r.getMonth()===n.getMonth()}function Lse(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getFullYear()===n.getFullYear()}function Rse(e,t){Ft(2,arguments);var r=qt(e).getTime(),n=qt(t.start).getTime(),a=qt(t.end).getTime();if(!(n<=a))throw new RangeError("Invalid interval");return r>=n&&r<=a}function qse(e,t){var r;Ft(1,arguments);var n=nn((r=void 0)!==null&&r!==void 0?r:2);if(n!==2&&n!==1&&n!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var a=Use(e),o;if(a.date){var s=zse(a.date,n);o=Wse(s.restDateString,s.year)}if(!o||isNaN(o.getTime()))return new Date(NaN);var l=o.getTime(),c=0,u;if(a.time&&(c=Hse(a.time),isNaN(c)))return new Date(NaN);if(a.timezone){if(u=Vse(a.timezone),isNaN(u))return new Date(NaN)}else{var d=new Date(l+c),f=new Date(0);return f.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),f.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),f}return new Date(l+c+u)}var Nm={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Fse=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,$se=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Bse=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Use(e){var t={},r=e.split(Nm.dateTimeDelimiter),n;if(r.length>2)return t;if(/:/.test(r[0])?n=r[0]:(t.date=r[0],n=r[1],Nm.timeZoneDelimiter.test(t.date)&&(t.date=e.split(Nm.timeZoneDelimiter)[0],n=e.substr(t.date.length,e.length))),n){var a=Nm.timezone.exec(n);a?(t.time=n.replace(a[1],""),t.timezone=a[1]):t.time=n}return t}function zse(e,t){var r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=e.match(r);if(!n)return{year:NaN,restDateString:""};var a=n[1]?parseInt(n[1]):null,o=n[2]?parseInt(n[2]):null;return{year:o===null?a:o*100,restDateString:e.slice((n[1]||n[2]).length)}}function Wse(e,t){if(t===null)return new Date(NaN);var r=e.match(Fse);if(!r)return new Date(NaN);var n=!!r[4],a=Lf(r[1]),o=Lf(r[2])-1,s=Lf(r[3]),l=Lf(r[4]),c=Lf(r[5])-1;if(n)return Xse(t,l,c)?Gse(t,l,c):new Date(NaN);var u=new Date(0);return!Kse(t,o,s)||!Qse(t,a)?new Date(NaN):(u.setUTCFullYear(t,o,Math.max(a,s)),u)}function Lf(e){return e?parseInt(e):1}function Hse(e){var t=e.match($se);if(!t)return NaN;var r=y2(t[1]),n=y2(t[2]),a=y2(t[3]);return Jse(r,n,a)?r*Ey+n*ky+a*1e3:NaN}function y2(e){return e&&parseFloat(e.replace(",","."))||0}function Vse(e){if(e==="Z")return 0;var t=e.match(Bse);if(!t)return 0;var r=t[1]==="+"?-1:1,n=parseInt(t[2]),a=t[3]&&parseInt(t[3])||0;return Zse(n,a)?r*(n*Ey+a*ky):NaN}function Gse(e,t,r){var n=new Date(0);n.setUTCFullYear(e,0,4);var a=n.getUTCDay()||7,o=(t-1)*7+r+1-a;return n.setUTCDate(n.getUTCDate()+o),n}var Yse=[31,null,31,30,31,30,31,31,30,31,30,31];function m6(e){return e%400===0||e%4===0&&e%100!==0}function Kse(e,t,r){return t>=0&&t<=11&&r>=1&&r<=(Yse[t]||(m6(e)?29:28))}function Qse(e,t){return t>=1&&t<=(m6(e)?366:365)}function Xse(e,t,r){return t>=1&&t<=53&&r>=0&&r<=6}function Jse(e,t,r){return e===24?t===0&&r===0:r>=0&&r<60&&t>=0&&t<60&&e>=0&&e<25}function Zse(e,t){return t>=0&&t<=59}function ele(e,t){Ft(2,arguments);var r=qt(e),n=nn(t),a=r.getFullYear(),o=r.getDate(),s=new Date(0);s.setFullYear(a,n,15),s.setHours(0,0,0,0);var l=c6(s);return r.setMonth(n,Math.min(o,l)),r}function tle(e,t){Ft(2,arguments);var r=qt(e),n=nn(t);return r.setDate(n),r}function rle(e,t){Ft(2,arguments);var r=qt(e),n=nn(t);return r.setHours(n),r}function nle(e,t){Ft(2,arguments);var r=qt(e),n=nn(t);return r.setMilliseconds(n),r}function ale(e,t){Ft(2,arguments);var r=qt(e),n=nn(t);return r.setMinutes(n),r}function ile(e,t){Ft(2,arguments);var r=qt(e),n=nn(t);return r.setSeconds(n),r}function ole(e,t){Ft(2,arguments);var r=qt(e),n=nn(t);return isNaN(r.getTime())?new Date(NaN):(r.setFullYear(n),r)}const Oh=e=>{const t=(e??"").toString().trim().toLowerCase();return t==="approved"?"Approved":t==="rejected"?"Rejected":"Open"},kE=e=>{const t=Number(e);return isFinite(t)?new Intl.NumberFormat("en-CA",{maximumFractionDigits:0}).format(t):""},sle=()=>{const e=kn(),[t,r]=x.useState([]),[n,a]=x.useState(""),[o,s]=x.useState("Open"),[l,c]=x.useState({page:0,pageSize:10}),[u,d]=x.useState(null),[f,h]=x.useState(null);x.useEffect(()=>{p()},[]);const p=async()=>{try{const T=((await ve.get("/api/quotes")).data||[]).map(S=>({...S,status:Oh(S.status)}));r(T)}catch(E){console.error("Error fetching quotes:",E),d("Failed to fetch quotes")}},v=async E=>{if(window.confirm("Are you sure you want to delete this quote?"))try{await ve.delete(`/api/quotes/${E}`),h("Quote deleted successfully"),p()}catch{d("Failed to delete quote")}},m=()=>{const E=t.map(O=>({"Quote #":O.quote_number,Customer:O.customer_name,Product:O.product_name,Make:O.vehicle_make||"",Model:O.vehicle_model||"","Est. Price":kE(O.estimated_cost),"Quote Date":O.quote_date?Ru(new Date(O.quote_date),"MM/dd/yyyy"):"","Valid Until":O.valid_until?Ru(new Date(O.valid_until),"MM/dd/yyyy"):"",Status:O.status})),T=Sl.unparse(E),S=new Blob([T],{type:"text/csv;charset=utf-8;"}),I=document.createElement("a"),U=URL.createObjectURL(S);I.setAttribute("href",U),I.setAttribute("download","quotes.csv"),I.style.visibility="hidden",document.body.appendChild(I),I.click(),document.body.removeChild(I)},y=n.toLowerCase(),b=x.useMemo(()=>{const E=t.filter(T=>T.status===o);return y?E.filter(T=>T.quote_number?.toLowerCase?.().includes(y)||T.customer_name?.toLowerCase?.().includes(y)||T.product_name?.toLowerCase?.().includes(y)||T.vehicle_make?.toLowerCase?.().includes(y)||T.vehicle_model?.toLowerCase?.().includes(y)):E},[t,o,y]),_=E=>{switch(E){case"Approved":return{backgroundColor:"rgba(76, 175, 80, 0.12)",color:"#2e7d32"};case"Rejected":return{backgroundColor:"rgba(244, 67, 54, 0.12)",color:"#c62828"};default:return{backgroundColor:"rgba(33, 150, 243, 0.12)",color:"#1565c0"}}},w=b.map(E=>({...E,id:E.quote_id})),A=[{field:"quote_number",headerName:"Quote #",flex:1.05,minWidth:150,valueFormatter:E=>E.value?String(E.value).replace("QO-",""):""},{field:"customer_name",headerName:"Customer",flex:1.2,minWidth:170},{field:"product_name",headerName:"Product",flex:1.1,minWidth:160},{field:"vehicle_make",headerName:"Make",flex:.9,minWidth:130},{field:"vehicle_model",headerName:"Model",flex:.9,minWidth:130},{field:"estimated_cost",headerName:"Est. Price",type:"number",flex:.8,minWidth:110,headerAlign:"left",align:"left",valueFormatter:E=>kE(E.value)},{field:"quote_date",headerName:"Quote Date",flex:.95,minWidth:130,valueFormatter:E=>E.value?Ru(new Date(E.value),"yyyy-MM-dd"):""},{field:"valid_until",headerName:"Valid Until",flex:.95,minWidth:130,valueFormatter:E=>E.value?Ru(new Date(E.value),"yyyy-MM-dd"):""},{field:"status",headerName:"Status",flex:.8,minWidth:130,sortable:!1,renderCell:E=>{const T=E.value,S=_(T);return i.jsx(ot,{label:T,size:"small",sx:{fontWeight:600,...S}})}},{field:"actions",headerName:"Actions",width:120,flex:0,sortable:!1,filterable:!1,disableColumnMenu:!0,renderCell:E=>i.jsx(Z,{sx:{display:"flex",alignItems:"center"},children:i.jsx(Hn,{title:"Delete",children:i.jsx(vr,{size:"small",color:"error",onClick:T=>{T.stopPropagation();const S=E.row.quote_id;v(S)},children:i.jsx(ga,{})})})})}],P=E=>{const T=E.row;e(`/quotes/${T.quote_id}`)};return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Quotes"}),i.jsxs(ut,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:()=>e("/quotes/new"),children:"New Quote"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:m,children:"Export CSV"})]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsxs(ut,{direction:"row",spacing:3,sx:{mb:3},children:[i.jsx(Pe,{label:"Search",value:n,onChange:E=>a(E.target.value),InputProps:{startAdornment:i.jsx(aa,{position:"start",children:i.jsx(di,{sx:{fontSize:32}})}),sx:{fontSize:22,height:56}},sx:{minWidth:340,maxWidth:400,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"medium",variant:"outlined"}),i.jsx(ot,{label:"Open",onClick:()=>s("Open"),color:o==="Open"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),i.jsx(ot,{label:"Approved",onClick:()=>s("Approved"),color:o==="Approved"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),i.jsx(ot,{label:"Rejected",onClick:()=>s("Rejected"),color:o==="Rejected"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}})]}),i.jsx(Po,{rows:w,columns:A,paginationModel:l,onPaginationModelChange:c,pageSizeOptions:[10,25,50],getRowId:E=>E.id,onRowClick:P,disableRowSelectionOnClick:!0,hideFooterSelectedRowCount:!0,initialState:{sorting:{sortModel:[{field:"quote_number",sort:"desc"}]}},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224,224,224,1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224,224,224,1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"},cursor:"pointer"}})]})}),i.jsx(hl,{open:!!f,autoHideDuration:6e3,onClose:()=>h(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Pt,{onClose:()=>h(null),severity:"success",sx:{width:"100%"},children:f})}),i.jsx(hl,{open:!!u,autoHideDuration:6e3,onClose:()=>d(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Pt,{onClose:()=>d(null),severity:"error",sx:{width:"100%"},children:u})})]})};var Rf={},EE;function lle(){if(EE)return Rf;EE=1;var e=ir();Object.defineProperty(Rf,"__esModule",{value:!0}),Rf.default=void 0;var t=e(sr()),r=or();return Rf.default=(0,t.default)((0,r.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),Rf}var cle=lle();const Is=Et(cle);var qf={},TE;function ule(){if(TE)return qf;TE=1;var e=ir();Object.defineProperty(qf,"__esModule",{value:!0}),qf.default=void 0;var t=e(sr()),r=or();return qf.default=(0,t.default)((0,r.jsx)("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"}),"DoneAll"),qf}var dle=ule();const xv=Et(dle);var Ff={},IE;function fle(){if(IE)return Ff;IE=1;var e=ir();Object.defineProperty(Ff,"__esModule",{value:!0}),Ff.default=void 0;var t=e(sr()),r=or();return Ff.default=(0,t.default)((0,r.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Email"),Ff}var hle=fle();const gS=Et(hle);var $f={},NE;function ple(){if(NE)return $f;NE=1;var e=ir();Object.defineProperty($f,"__esModule",{value:!0}),$f.default=void 0;var t=e(sr()),r=or();return $f.default=(0,t.default)((0,r.jsx)("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"AddCircleOutline"),$f}var mle=ple();const Zl=Et(mle);var Bf={},DE;function gle(){if(DE)return Bf;DE=1;var e=ir();Object.defineProperty(Bf,"__esModule",{value:!0}),Bf.default=void 0;var t=e(sr()),r=or();return Bf.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12m8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8"}),"Block"),Bf}var vle=gle();const yle=Et(vle);var Uf={},ME;function xle(){if(ME)return Uf;ME=1;var e=ir();Object.defineProperty(Uf,"__esModule",{value:!0}),Uf.default=void 0;var t=e(sr()),r=or();return Uf.default=(0,t.default)((0,r.jsx)("path",{d:"M10 10.02h5V21h-5zM17 21h3c1.1 0 2-.9 2-2v-9h-5zm3-18H5c-1.1 0-2 .9-2 2v3h19V5c0-1.1-.9-2-2-2M3 19c0 1.1.9 2 2 2h3V10H3z"}),"TableChart"),Uf}var ble=xle();const g6=Et(ble),_le="modulepreload",wle=function(e){return"/"+e},LE={},jw=function(t,r,n){let a=Promise.resolve();if(r&&r.length>0){let c=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),l=s?.nonce||s?.getAttribute("nonce");a=c(r.map(u=>{if(u=wle(u),u in LE)return;LE[u]=!0;const d=u.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${f}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":_le,d||(h.as="script"),h.crossOrigin="",h.href=u,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((p,v)=>{h.addEventListener("load",p),h.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(s){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s}return a.then(s=>{for(const l of s||[])l.status==="rejected"&&o(l.reason);return t().catch(o)})};var _i=Uint8Array,So=Uint16Array,vS=Int32Array,Ny=new _i([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Dy=new _i([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Sw=new _i([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),v6=function(e,t){for(var r=new So(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var a=new vS(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)a[o]=o-r[n]<<5|n;return{b:r,r:a}},y6=v6(Ny,2),x6=y6.b,Cw=y6.r;x6[28]=258,Cw[258]=28;var b6=v6(Dy,0),jle=b6.b,RE=b6.r,Aw=new So(32768);for(var Wn=0;Wn<32768;++Wn){var Ul=(Wn&43690)>>1|(Wn&21845)<<1;Ul=(Ul&52428)>>2|(Ul&13107)<<2,Ul=(Ul&61680)>>4|(Ul&3855)<<4,Aw[Wn]=((Ul&65280)>>8|(Ul&255)<<8)>>1}var Ps=function(e,t,r){for(var n=e.length,a=0,o=new So(t);a<n;++a)e[a]&&++o[e[a]-1];var s=new So(t);for(a=1;a<t;++a)s[a]=s[a-1]+o[a-1]<<1;var l;if(r){l=new So(1<<t);var c=15-t;for(a=0;a<n;++a)if(e[a])for(var u=a<<4|e[a],d=t-e[a],f=s[e[a]-1]++<<d,h=f|(1<<d)-1;f<=h;++f)l[Aw[f]>>c]=u}else for(l=new So(n),a=0;a<n;++a)e[a]&&(l[a]=Aw[s[e[a]-1]++]>>15-e[a]);return l},tc=new _i(288);for(var Wn=0;Wn<144;++Wn)tc[Wn]=8;for(var Wn=144;Wn<256;++Wn)tc[Wn]=9;for(var Wn=256;Wn<280;++Wn)tc[Wn]=7;for(var Wn=280;Wn<288;++Wn)tc[Wn]=8;var Op=new _i(32);for(var Wn=0;Wn<32;++Wn)Op[Wn]=5;var Sle=Ps(tc,9,0),Cle=Ps(tc,9,1),Ale=Ps(Op,5,0),Ple=Ps(Op,5,1),x2=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},Zo=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(t&7)&r},b2=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(t&7)},yS=function(e){return(e+7)/8|0},_6=function(e,t,r){return(r==null||r>e.length)&&(r=e.length),new _i(e.subarray(t,r))},Ole=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ts=function(e,t,r){var n=new Error(t||Ole[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,ts),!r)throw n;return n},kle=function(e,t,r,n){var a=e.length,o=0;if(!a||t.f&&!t.l)return r||new _i(0);var s=!r,l=s||t.i!=2,c=t.i;s&&(r=new _i(a*3));var u=function(ge){var Q=r.length;if(ge>Q){var G=new _i(Math.max(Q*2,ge));G.set(r),r=G}},d=t.f||0,f=t.p||0,h=t.b||0,p=t.l,v=t.d,m=t.m,y=t.n,b=a*8;do{if(!p){d=Zo(e,f,1);var _=Zo(e,f+1,3);if(f+=3,_)if(_==1)p=Cle,v=Ple,m=9,y=5;else if(_==2){var E=Zo(e,f,31)+257,T=Zo(e,f+10,15)+4,S=E+Zo(e,f+5,31)+1;f+=14;for(var I=new _i(S),U=new _i(19),O=0;O<T;++O)U[Sw[O]]=Zo(e,f+O*3,7);f+=T*3;for(var M=x2(U),L=(1<<M)-1,q=Ps(U,M,1),O=0;O<S;){var z=q[Zo(e,f,L)];f+=z&15;var w=z>>4;if(w<16)I[O++]=w;else{var K=0,J=0;for(w==16?(J=3+Zo(e,f,3),f+=2,K=I[O-1]):w==17?(J=3+Zo(e,f,7),f+=3):w==18&&(J=11+Zo(e,f,127),f+=7);J--;)I[O++]=K}}var R=I.subarray(0,E),k=I.subarray(E);m=x2(R),y=x2(k),p=Ps(R,m,1),v=Ps(k,y,1)}else ts(1);else{var w=yS(f)+4,A=e[w-4]|e[w-3]<<8,P=w+A;if(P>a){c&&ts(0);break}l&&u(h+A),r.set(e.subarray(w,P),h),t.b=h+=A,t.p=f=P*8,t.f=d;continue}if(f>b){c&&ts(0);break}}l&&u(h+131072);for(var $=(1<<m)-1,X=(1<<y)-1,C=f;;C=f){var K=p[b2(e,f)&$],N=K>>4;if(f+=K&15,f>b){c&&ts(0);break}if(K||ts(2),N<256)r[h++]=N;else if(N==256){C=f,p=null;break}else{var H=N-254;if(N>264){var O=N-257,W=Ny[O];H=Zo(e,f,(1<<W)-1)+x6[O],f+=W}var ne=v[b2(e,f)&X],se=ne>>4;ne||ts(3),f+=ne&15;var k=jle[se];if(se>3){var W=Dy[se];k+=b2(e,f)&(1<<W)-1,f+=W}if(f>b){c&&ts(0);break}l&&u(h+131072);var oe=h+H;if(h<k){var ae=o-k,pe=Math.min(k,oe);for(ae+h<0&&ts(3);h<pe;++h)r[h]=n[ae+h]}for(;h<oe;++h)r[h]=r[h-k]}}t.l=p,t.p=C,t.b=h,t.f=d,p&&(d=1,t.m=m,t.d=v,t.n=y)}while(!d);return h!=r.length&&s?_6(r,0,h):r.subarray(0,h)},Zs=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8},zf=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8,e[n+2]|=r>>16},_2=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var a=r.length,o=r.slice();if(!a)return{t:j6,l:0};if(a==1){var s=new _i(r[0].s+1);return s[r[0].s]=1,{t:s,l:1}}r.sort(function(P,E){return P.f-E.f}),r.push({s:-1,f:25001});var l=r[0],c=r[1],u=0,d=1,f=2;for(r[0]={s:-1,f:l.f+c.f,l,r:c};d!=a-1;)l=r[r[u].f<r[f].f?u++:f++],c=r[u!=d&&r[u].f<r[f].f?u++:f++],r[d++]={s:-1,f:l.f+c.f,l,r:c};for(var h=o[0].s,n=1;n<a;++n)o[n].s>h&&(h=o[n].s);var p=new So(h+1),v=Pw(r[d-1],p,0);if(v>t){var n=0,m=0,y=v-t,b=1<<y;for(o.sort(function(E,T){return p[T.s]-p[E.s]||E.f-T.f});n<a;++n){var _=o[n].s;if(p[_]>t)m+=b-(1<<v-p[_]),p[_]=t;else break}for(m>>=y;m>0;){var w=o[n].s;p[w]<t?m-=1<<t-p[w]++-1:++n}for(;n>=0&&m;--n){var A=o[n].s;p[A]==t&&(--p[A],++m)}v=t}return{t:new _i(p),l:v}},Pw=function(e,t,r){return e.s==-1?Math.max(Pw(e.l,t,r+1),Pw(e.r,t,r+1)):t[e.s]=r},qE=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new So(++t),n=0,a=e[0],o=1,s=function(c){r[n++]=c},l=1;l<=t;++l)if(e[l]==a&&l!=t)++o;else{if(!a&&o>2){for(;o>138;o-=138)s(32754);o>2&&(s(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(s(a),--o;o>6;o-=6)s(8304);o>2&&(s(o-3<<5|8208),o=0)}for(;o--;)s(a);o=1,a=e[l]}return{c:r.subarray(0,n),n:t}},Wf=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},w6=function(e,t,r){var n=r.length,a=yS(t+2);e[a]=n&255,e[a+1]=n>>8,e[a+2]=e[a]^255,e[a+3]=e[a+1]^255;for(var o=0;o<n;++o)e[a+o+4]=r[o];return(a+4+n)*8},FE=function(e,t,r,n,a,o,s,l,c,u,d){Zs(t,d++,r),++a[256];for(var f=_2(a,15),h=f.t,p=f.l,v=_2(o,15),m=v.t,y=v.l,b=qE(h),_=b.c,w=b.n,A=qE(m),P=A.c,E=A.n,T=new So(19),S=0;S<_.length;++S)++T[_[S]&31];for(var S=0;S<P.length;++S)++T[P[S]&31];for(var I=_2(T,7),U=I.t,O=I.l,M=19;M>4&&!U[Sw[M-1]];--M);var L=u+5<<3,q=Wf(a,tc)+Wf(o,Op)+s,z=Wf(a,h)+Wf(o,m)+s+14+3*M+Wf(T,U)+2*T[16]+3*T[17]+7*T[18];if(c>=0&&L<=q&&L<=z)return w6(t,d,e.subarray(c,c+u));var K,J,R,k;if(Zs(t,d,1+(z<q)),d+=2,z<q){K=Ps(h,p,0),J=h,R=Ps(m,y,0),k=m;var $=Ps(U,O,0);Zs(t,d,w-257),Zs(t,d+5,E-1),Zs(t,d+10,M-4),d+=14;for(var S=0;S<M;++S)Zs(t,d+3*S,U[Sw[S]]);d+=3*M;for(var X=[_,P],C=0;C<2;++C)for(var N=X[C],S=0;S<N.length;++S){var H=N[S]&31;Zs(t,d,$[H]),d+=U[H],H>15&&(Zs(t,d,N[S]>>5&127),d+=N[S]>>12)}}else K=Sle,J=tc,R=Ale,k=Op;for(var S=0;S<l;++S){var W=n[S];if(W>255){var H=W>>18&31;zf(t,d,K[H+257]),d+=J[H+257],H>7&&(Zs(t,d,W>>23&31),d+=Ny[H]);var ne=W&31;zf(t,d,R[ne]),d+=k[ne],ne>3&&(zf(t,d,W>>5&8191),d+=Dy[ne])}else zf(t,d,K[W]),d+=J[W]}return zf(t,d,K[256]),d+J[256]},Ele=new vS([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),j6=new _i(0),Tle=function(e,t,r,n,a,o){var s=o.z||e.length,l=new _i(n+s+5*(1+Math.ceil(s/7e3))+a),c=l.subarray(n,l.length-a),u=o.l,d=(o.r||0)&7;if(t){d&&(c[0]=o.r>>3);for(var f=Ele[t-1],h=f>>13,p=f&8191,v=(1<<r)-1,m=o.p||new So(32768),y=o.h||new So(v+1),b=Math.ceil(r/3),_=2*b,w=function(ee){return(e[ee]^e[ee+1]<<b^e[ee+2]<<_)&v},A=new vS(25e3),P=new So(288),E=new So(32),T=0,S=0,I=o.i||0,U=0,O=o.w||0,M=0;I+2<s;++I){var L=w(I),q=I&32767,z=y[L];if(m[q]=z,y[L]=q,O<=I){var K=s-I;if((T>7e3||U>24576)&&(K>423||!u)){d=FE(e,c,0,A,P,E,S,U,M,I-M,d),U=T=S=0,M=I;for(var J=0;J<286;++J)P[J]=0;for(var J=0;J<30;++J)E[J]=0}var R=2,k=0,$=p,X=q-z&32767;if(K>2&&L==w(I-X))for(var C=Math.min(h,K)-1,N=Math.min(32767,I),H=Math.min(258,K);X<=N&&--$&&q!=z;){if(e[I+R]==e[I+R-X]){for(var W=0;W<H&&e[I+W]==e[I+W-X];++W);if(W>R){if(R=W,k=X,W>C)break;for(var ne=Math.min(X,W-2),se=0,J=0;J<ne;++J){var oe=I-X+J&32767,ae=m[oe],pe=oe-ae&32767;pe>se&&(se=pe,z=oe)}}}q=z,z=m[q],X+=q-z&32767}if(k){A[U++]=268435456|Cw[R]<<18|RE[k];var ge=Cw[R]&31,Q=RE[k]&31;S+=Ny[ge]+Dy[Q],++P[257+ge],++E[Q],O=I+R,++T}else A[U++]=e[I],++P[e[I]]}}for(I=Math.max(I,O);I<s;++I)A[U++]=e[I],++P[e[I]];d=FE(e,c,u,A,P,E,S,U,M,I-M,d),u||(o.r=d&7|c[d/8|0]<<3,d-=7,o.h=y,o.p=m,o.i=I,o.w=O)}else{for(var I=o.w||0;I<s+u;I+=65535){var G=I+65535;G>=s&&(c[d/8|0]=u,G=s),d=w6(c,d+1,e.subarray(I,G))}o.i=s}return _6(l,0,n+yS(d)+a)},S6=function(){var e=1,t=0;return{p:function(r){for(var n=e,a=t,o=r.length|0,s=0;s!=o;){for(var l=Math.min(s+2655,o);s<l;++s)a+=n+=r[s];n=(n&65535)+15*(n>>16),a=(a&65535)+15*(a>>16)}e=n,t=a},d:function(){return e%=65521,t%=65521,(e&255)<<24|(e&65280)<<8|(t&255)<<8|t>>8}}},Ile=function(e,t,r,n,a){if(!a&&(a={l:1},t.dictionary)){var o=t.dictionary.subarray(-32768),s=new _i(o.length+e.length);s.set(o),s.set(e,o.length),e=s,a.w=o.length}return Tle(e,t.level==null?6:t.level,t.mem==null?a.l?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):20:12+t.mem,r,n,a)},C6=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},Nle=function(e,t){var r=t.level,n=r==0?0:r<6?1:r==9?3:2;if(e[0]=120,e[1]=n<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var a=S6();a.p(t.dictionary),C6(e,2,a.d())}},Dle=function(e,t){return((e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31)&&ts(6,"invalid zlib data"),(e[1]>>5&1)==1&&ts(6,"invalid zlib data: "+(e[1]&32?"need":"unexpected")+" dictionary"),(e[1]>>3&4)+2};function Ow(e,t){t||(t={});var r=S6();r.p(e);var n=Ile(e,t,t.dictionary?6:2,4);return Nle(n,t),C6(n,n.length-4,r.d()),n}function Mle(e,t){return kle(e.subarray(Dle(e),-4),{i:2},t,t)}var Lle=typeof TextDecoder<"u"&&new TextDecoder,Rle=0;try{Lle.decode(j6,{stream:!0}),Rle=1}catch{}var Cr=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function w2(){Cr.console&&typeof Cr.console.log=="function"&&Cr.console.log.apply(Cr.console,arguments)}var Pn={log:w2,warn:function(e){Cr.console&&(typeof Cr.console.warn=="function"?Cr.console.warn.apply(Cr.console,arguments):w2.call(null,arguments))},error:function(e){Cr.console&&(typeof Cr.console.error=="function"?Cr.console.error.apply(Cr.console,arguments):w2(e))}};function j2(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){Ec(n.response,t,r)},n.onerror=function(){Pn.error("could not download file")},n.send()}function $E(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function Dm(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var Rh,kw,Ec=Cr.saveAs||((typeof window>"u"?"undefined":mn(window))!=="object"||window!==Cr?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(e,t,r){var n=Cr.URL||Cr.webkitURL,a=document.createElement("a");t=t||e.name||"download",a.download=t,a.rel="noopener",typeof e=="string"?(a.href=e,a.origin!==location.origin?$E(a.href)?j2(e,t,r):Dm(a,a.target="_blank"):Dm(a)):(a.href=n.createObjectURL(e),setTimeout(function(){n.revokeObjectURL(a.href)},4e4),setTimeout(function(){Dm(a)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,r){if(t=t||e.name||"download",typeof e=="string")if($E(e))j2(e,t,r);else{var n=document.createElement("a");n.href=e,n.target="_blank",setTimeout(function(){Dm(n)})}else navigator.msSaveOrOpenBlob(function(a,o){return o===void 0?o={autoBom:!1}:mn(o)!=="object"&&(Pn.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}(e,r),t)}:function(e,t,r,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof e=="string")return j2(e,t,r);var a=e.type==="application/octet-stream",o=/constructor/i.test(Cr.HTMLElement)||Cr.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);if((s||a&&o)&&(typeof FileReader>"u"?"undefined":mn(FileReader))==="object"){var l=new FileReader;l.onloadend=function(){var d=l.result;d=s?d:d.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=d:location=d,n=null},l.readAsDataURL(e)}else{var c=Cr.URL||Cr.webkitURL,u=c.createObjectURL(e);n?n.location=u:location.href=u,n=null,setTimeout(function(){c.revokeObjectURL(u)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function A6(e){var t;e=e||"",this.ok=!1,e.charAt(0)=="#"&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],n=0;n<r.length;n++){var a=r[n].re,o=r[n].process,s=a.exec(e);s&&(t=o(s),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var l=this.r.toString(16),c=this.g.toString(16),u=this.b.toString(16);return l.length==1&&(l="0"+l),c.length==1&&(c="0"+c),u.length==1&&(u="0"+u),"#"+l+c+u}}/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function S2(e,t){var r=e[0],n=e[1],a=e[2],o=e[3];r=pi(r,n,a,o,t[0],7,-680876936),o=pi(o,r,n,a,t[1],12,-389564586),a=pi(a,o,r,n,t[2],17,606105819),n=pi(n,a,o,r,t[3],22,-1044525330),r=pi(r,n,a,o,t[4],7,-176418897),o=pi(o,r,n,a,t[5],12,1200080426),a=pi(a,o,r,n,t[6],17,-1473231341),n=pi(n,a,o,r,t[7],22,-45705983),r=pi(r,n,a,o,t[8],7,1770035416),o=pi(o,r,n,a,t[9],12,-1958414417),a=pi(a,o,r,n,t[10],17,-42063),n=pi(n,a,o,r,t[11],22,-1990404162),r=pi(r,n,a,o,t[12],7,1804603682),o=pi(o,r,n,a,t[13],12,-40341101),a=pi(a,o,r,n,t[14],17,-1502002290),r=mi(r,n=pi(n,a,o,r,t[15],22,1236535329),a,o,t[1],5,-165796510),o=mi(o,r,n,a,t[6],9,-1069501632),a=mi(a,o,r,n,t[11],14,643717713),n=mi(n,a,o,r,t[0],20,-373897302),r=mi(r,n,a,o,t[5],5,-701558691),o=mi(o,r,n,a,t[10],9,38016083),a=mi(a,o,r,n,t[15],14,-660478335),n=mi(n,a,o,r,t[4],20,-405537848),r=mi(r,n,a,o,t[9],5,568446438),o=mi(o,r,n,a,t[14],9,-1019803690),a=mi(a,o,r,n,t[3],14,-187363961),n=mi(n,a,o,r,t[8],20,1163531501),r=mi(r,n,a,o,t[13],5,-1444681467),o=mi(o,r,n,a,t[2],9,-51403784),a=mi(a,o,r,n,t[7],14,1735328473),r=gi(r,n=mi(n,a,o,r,t[12],20,-1926607734),a,o,t[5],4,-378558),o=gi(o,r,n,a,t[8],11,-2022574463),a=gi(a,o,r,n,t[11],16,1839030562),n=gi(n,a,o,r,t[14],23,-35309556),r=gi(r,n,a,o,t[1],4,-1530992060),o=gi(o,r,n,a,t[4],11,1272893353),a=gi(a,o,r,n,t[7],16,-155497632),n=gi(n,a,o,r,t[10],23,-1094730640),r=gi(r,n,a,o,t[13],4,681279174),o=gi(o,r,n,a,t[0],11,-358537222),a=gi(a,o,r,n,t[3],16,-722521979),n=gi(n,a,o,r,t[6],23,76029189),r=gi(r,n,a,o,t[9],4,-640364487),o=gi(o,r,n,a,t[12],11,-421815835),a=gi(a,o,r,n,t[15],16,530742520),r=vi(r,n=gi(n,a,o,r,t[2],23,-995338651),a,o,t[0],6,-198630844),o=vi(o,r,n,a,t[7],10,1126891415),a=vi(a,o,r,n,t[14],15,-1416354905),n=vi(n,a,o,r,t[5],21,-57434055),r=vi(r,n,a,o,t[12],6,1700485571),o=vi(o,r,n,a,t[3],10,-1894986606),a=vi(a,o,r,n,t[10],15,-1051523),n=vi(n,a,o,r,t[1],21,-2054922799),r=vi(r,n,a,o,t[8],6,1873313359),o=vi(o,r,n,a,t[15],10,-30611744),a=vi(a,o,r,n,t[6],15,-1560198380),n=vi(n,a,o,r,t[13],21,1309151649),r=vi(r,n,a,o,t[4],6,-145523070),o=vi(o,r,n,a,t[11],10,-1120210379),a=vi(a,o,r,n,t[2],15,718787259),n=vi(n,a,o,r,t[9],21,-343485551),e[0]=Ql(r,e[0]),e[1]=Ql(n,e[1]),e[2]=Ql(a,e[2]),e[3]=Ql(o,e[3])}function My(e,t,r,n,a,o){return t=Ql(Ql(t,e),Ql(n,o)),Ql(t<<a|t>>>32-a,r)}function pi(e,t,r,n,a,o,s){return My(t&r|~t&n,e,t,a,o,s)}function mi(e,t,r,n,a,o,s){return My(t&n|r&~n,e,t,a,o,s)}function gi(e,t,r,n,a,o,s){return My(t^r^n,e,t,a,o,s)}function vi(e,t,r,n,a,o,s){return My(r^(t|~n),e,t,a,o,s)}function P6(e){var t,r=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)S2(n,qle(e.substring(t-64,t)));e=e.substring(t-64);var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)a[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(S2(n,a),t=0;t<16;t++)a[t]=0;return a[14]=8*r,S2(n,a),n}function qle(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}Rh=Cr.atob.bind(Cr),kw=Cr.btoa.bind(Cr);var BE="0123456789abcdef".split("");function Fle(e){for(var t="",r=0;r<4;r++)t+=BE[e>>8*r+4&15]+BE[e>>8*r&15];return t}function $le(e){return String.fromCharCode((255&e)>>0,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function Ew(e){return P6(e).map($le).join("")}var Ble=function(e){for(var t=0;t<e.length;t++)e[t]=Fle(e[t]);return e.join("")}(P6("hello"))!="5d41402abc4b2a76b9719d911017c592";function Ql(e,t){if(Ble){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}return e+t&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function Tw(e,t){var r,n,a,o;if(e!==r){for(var s=(a=e,o=1+(256/e.length>>0),new Array(o+1).join(a)),l=[],c=0;c<256;c++)l[c]=c;var u=0;for(c=0;c<256;c++){var d=l[c];u=(u+d+s.charCodeAt(c))%256,l[c]=l[u],l[u]=d}r=e,n=l}else l=n;var f=t.length,h=0,p=0,v="";for(c=0;c<f;c++)p=(p+(d=l[h=(h+1)%256]))%256,l[h]=l[p],l[p]=d,s=l[(l[h]+l[p])%256],v+=String.fromCharCode(t.charCodeAt(c)^s);return v}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var UE={print:4,modify:8,copy:16,"annot-forms":32};function ku(e,t,r,n){this.v=1,this.r=2;var a=192;e.forEach(function(l){if(UE.perm!==void 0)throw new Error("Invalid permission: "+l);a+=UE[l]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var o=(t+this.padding).substr(0,32),s=(r+this.padding).substr(0,32);this.O=this.processOwnerPassword(o,s),this.P=-(1+(255^a)),this.encryptionKey=Ew(o+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=Tw(this.encryptionKey,this.padding)}function Eu(e){if(/[^\u0000-\u00ff]/.test(e))throw new Error("Invalid PDF Name Object: "+e+", Only accept ASCII characters.");for(var t="",r=e.length,n=0;n<r;n++){var a=e.charCodeAt(n);a<33||a===35||a===37||a===40||a===41||a===47||a===60||a===62||a===91||a===93||a===123||a===125||a>126?t+="#"+("0"+a.toString(16)).slice(-2):t+=e[n]}return t}function zE(e){if(mn(e)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(r,n,a){if(a=a||!1,typeof r!="string"||typeof n!="function"||typeof a!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(r)||(t[r]={});var o=Math.random().toString(35);return t[r][o]=[n,!!a],o},this.unsubscribe=function(r){for(var n in t)if(t[n][r])return delete t[n][r],Object.keys(t[n]).length===0&&delete t[n],!0;return!1},this.publish=function(r){if(t.hasOwnProperty(r)){var n=Array.prototype.slice.call(arguments,1),a=[];for(var o in t[r]){var s=t[r][o];try{s[0].apply(e,n)}catch(l){Cr.console&&Pn.error("jsPDF PubSub Error",l.message,l)}s[1]&&a.push(o)}a.length&&a.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function bv(e){if(!(this instanceof bv))return new bv(e);var t="opacity,stroke-opacity".split(",");for(var r in e)e.hasOwnProperty(r)&&t.indexOf(r)>=0&&(this[r]=e[r]);this.id="",this.objectNumber=-1}function O6(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function Ic(e,t,r,n,a){if(!(this instanceof Ic))return new Ic(e,t,r,n,a);this.type=e==="axial"?2:3,this.coords=t,this.colors=r,O6.call(this,n,a)}function qu(e,t,r,n,a){if(!(this instanceof qu))return new qu(e,t,r,n,a);this.boundingBox=e,this.xStep=t,this.yStep=r,this.stream="",this.cloneIndex=0,O6.call(this,n,a)}function br(e){var t,r=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],a=arguments[2],o=arguments[3],s=[],l=1,c=16,u="S",d=null;mn(e=e||{})==="object"&&(r=e.orientation,n=e.unit||n,a=e.format||a,o=e.compress||e.compressPdf||o,(d=e.encryption||null)!==null&&(d.userPassword=d.userPassword||"",d.ownerPassword=d.ownerPassword||"",d.userPermissions=d.userPermissions||[]),l=typeof e.userUnit=="number"?Math.abs(e.userUnit):1,e.precision!==void 0&&(t=e.precision),e.floatPrecision!==void 0&&(c=e.floatPrecision),u=e.defaultPathOperation||"S"),s=e.filters||(o===!0?["FlateEncode"]:s),n=n||"mm",r=(""+(r||"P")).toLowerCase();var f=e.putOnlyUsedFonts||!1,h={},p={internal:{},__private__:{}};p.__private__.PubSub=zE;var v="1.3",m=p.__private__.getPdfVersion=function(){return v};p.__private__.setPdfVersion=function(D){v=D};var y={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};p.__private__.getPageFormats=function(){return y};var b=p.__private__.getPageFormat=function(D){return y[D]};a=a||"a4";var _={COMPAT:"compat",ADVANCED:"advanced"},w=_.COMPAT;function A(){this.saveGraphicsState(),V(new Zt(jt,0,0,-jt,0,ii()*jt).toString()+" cm"),this.setFontSize(this.getFontSize()/jt),u="n",w=_.ADVANCED}function P(){this.restoreGraphicsState(),u="S",w=_.COMPAT}var E=p.__private__.combineFontStyleAndFontWeight=function(D,re){if(D=="bold"&&re=="normal"||D=="bold"&&re==400||D=="normal"&&re=="italic"||D=="bold"&&re=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return re&&(D=re==400||re==="normal"?D==="italic"?"italic":"normal":re!=700&&re!=="bold"||D!=="normal"?(re==700?"bold":re)+""+D:"bold"),D};p.advancedAPI=function(D){var re=w===_.COMPAT;return re&&A.call(this),typeof D!="function"||(D(this),re&&P.call(this)),this},p.compatAPI=function(D){var re=w===_.ADVANCED;return re&&P.call(this),typeof D!="function"||(D(this),re&&A.call(this)),this},p.isAdvancedAPI=function(){return w===_.ADVANCED};var T,S=function(D){if(w!==_.ADVANCED)throw new Error(D+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},I=p.roundToPrecision=p.__private__.roundToPrecision=function(D,re){var Ce=t||re;if(isNaN(D)||isNaN(Ce))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return D.toFixed(Ce).replace(/0+$/,"")};T=p.hpf=p.__private__.hpf=typeof c=="number"?function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return I(D,c)}:c==="smart"?function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return I(D,D>-1&&D<1?16:5)}:function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return I(D,16)};var U=p.f2=p.__private__.f2=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.f2");return I(D,2)},O=p.__private__.f3=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.f3");return I(D,3)},M=p.scale=p.__private__.scale=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.scale");return w===_.COMPAT?D*jt:w===_.ADVANCED?D:void 0},L=function(D){return w===_.COMPAT?ii()-D:w===_.ADVANCED?D:void 0},q=function(D){return M(L(D))};p.__private__.setPrecision=p.setPrecision=function(D){typeof parseInt(D,10)=="number"&&(t=parseInt(D,10))};var z,K="00000000000000000000000000000000",J=p.__private__.getFileId=function(){return K},R=p.__private__.setFileId=function(D){return K=D!==void 0&&/^[a-fA-F0-9]{32}$/.test(D)?D.toUpperCase():K.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),d!==null&&(Bn=new ku(d.userPermissions,d.userPassword,d.ownerPassword,K)),K};p.setFileId=function(D){return R(D),this},p.getFileId=function(){return J()};var k=p.__private__.convertDateToPDFDate=function(D){var re=D.getTimezoneOffset(),Ce=re<0?"+":"-",Ne=Math.floor(Math.abs(re/60)),Ke=Math.abs(re%60),dt=[Ce,H(Ne),"'",H(Ke),"'"].join("");return["D:",D.getFullYear(),H(D.getMonth()+1),H(D.getDate()),H(D.getHours()),H(D.getMinutes()),H(D.getSeconds()),dt].join("")},$=p.__private__.convertPDFDateToDate=function(D){var re=parseInt(D.substr(2,4),10),Ce=parseInt(D.substr(6,2),10)-1,Ne=parseInt(D.substr(8,2),10),Ke=parseInt(D.substr(10,2),10),dt=parseInt(D.substr(12,2),10),At=parseInt(D.substr(14,2),10);return new Date(re,Ce,Ne,Ke,dt,At,0)},X=p.__private__.setCreationDate=function(D){var re;if(D===void 0&&(D=new Date),D instanceof Date)re=k(D);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(D))throw new Error("Invalid argument passed to jsPDF.setCreationDate");re=D}return z=re},C=p.__private__.getCreationDate=function(D){var re=z;return D==="jsDate"&&(re=$(z)),re};p.setCreationDate=function(D){return X(D),this},p.getCreationDate=function(D){return C(D)};var N,H=p.__private__.padd2=function(D){return("0"+parseInt(D)).slice(-2)},W=p.__private__.padd2Hex=function(D){return("00"+(D=D.toString())).substr(D.length)},ne=0,se=[],oe=[],ae=0,pe=[],ge=[],Q=!1,G=oe,ee=function(){ne=0,ae=0,oe=[],se=[],pe=[],_e=en(),Te=en()};p.__private__.setCustomOutputDestination=function(D){Q=!0,G=D};var le=function(D){Q||(G=D)};p.__private__.resetCustomOutputDestination=function(){Q=!1,G=oe};var V=p.__private__.out=function(D){return D=D.toString(),ae+=D.length+1,G.push(D),G},Ve=p.__private__.write=function(D){return V(arguments.length===1?D.toString():Array.prototype.join.call(arguments," "))},Me=p.__private__.getArrayBuffer=function(D){for(var re=D.length,Ce=new ArrayBuffer(re),Ne=new Uint8Array(Ce);re--;)Ne[re]=D.charCodeAt(re);return Ce},Fe=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];p.__private__.getStandardFonts=function(){return Fe};var Qe=e.fontSize||16;p.__private__.setFontSize=p.setFontSize=function(D){return Qe=w===_.ADVANCED?D/jt:D,this};var it,st=p.__private__.getFontSize=p.getFontSize=function(){return w===_.COMPAT?Qe:Qe*jt},vt=e.R2L||!1;p.__private__.setR2L=p.setR2L=function(D){return vt=D,this},p.__private__.getR2L=p.getR2L=function(){return vt};var Ye,Ze=p.__private__.setZoomMode=function(D){var re=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(D))it=D;else if(isNaN(D)){if(re.indexOf(D)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+D+'" is not recognized.');it=D}else it=parseInt(D,10)};p.__private__.getZoomMode=function(){return it};var We,wt=p.__private__.setPageMode=function(D){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(D)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+D+'" is not recognized.');Ye=D};p.__private__.getPageMode=function(){return Ye};var It=p.__private__.setLayoutMode=function(D){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(D)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+D+'" is not recognized.');We=D};p.__private__.getLayoutMode=function(){return We},p.__private__.setDisplayMode=p.setDisplayMode=function(D,re,Ce){return Ze(D),It(re),wt(Ce),this};var Ot={title:"",subject:"",author:"",keywords:"",creator:""};p.__private__.getDocumentProperty=function(D){if(Object.keys(Ot).indexOf(D)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return Ot[D]},p.__private__.getDocumentProperties=function(){return Ot},p.__private__.setDocumentProperties=p.setProperties=p.setDocumentProperties=function(D){for(var re in Ot)Ot.hasOwnProperty(re)&&D[re]&&(Ot[re]=D[re]);return this},p.__private__.setDocumentProperty=function(D,re){if(Object.keys(Ot).indexOf(D)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return Ot[D]=re};var Wt,jt,lr,$e,He,Je={},Ue={},ht=[],at={},St={},Tt={},Yt={},Or=null,Dr=0,tr=[],wr=new zE(p),Ir=e.hotfixes||[],dn={},ka={},En=[],Zt=function D(re,Ce,Ne,Ke,dt,At){if(!(this instanceof D))return new D(re,Ce,Ne,Ke,dt,At);isNaN(re)&&(re=1),isNaN(Ce)&&(Ce=0),isNaN(Ne)&&(Ne=0),isNaN(Ke)&&(Ke=1),isNaN(dt)&&(dt=0),isNaN(At)&&(At=0),this._matrix=[re,Ce,Ne,Ke,dt,At]};Object.defineProperty(Zt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(D){this._matrix[0]=D}}),Object.defineProperty(Zt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(D){this._matrix[1]=D}}),Object.defineProperty(Zt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(D){this._matrix[2]=D}}),Object.defineProperty(Zt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(D){this._matrix[3]=D}}),Object.defineProperty(Zt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(D){this._matrix[4]=D}}),Object.defineProperty(Zt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(D){this._matrix[5]=D}}),Object.defineProperty(Zt.prototype,"a",{get:function(){return this._matrix[0]},set:function(D){this._matrix[0]=D}}),Object.defineProperty(Zt.prototype,"b",{get:function(){return this._matrix[1]},set:function(D){this._matrix[1]=D}}),Object.defineProperty(Zt.prototype,"c",{get:function(){return this._matrix[2]},set:function(D){this._matrix[2]=D}}),Object.defineProperty(Zt.prototype,"d",{get:function(){return this._matrix[3]},set:function(D){this._matrix[3]=D}}),Object.defineProperty(Zt.prototype,"e",{get:function(){return this._matrix[4]},set:function(D){this._matrix[4]=D}}),Object.defineProperty(Zt.prototype,"f",{get:function(){return this._matrix[5]},set:function(D){this._matrix[5]=D}}),Object.defineProperty(Zt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Zt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Zt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Zt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Zt.prototype.join=function(D){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(T).join(D)},Zt.prototype.multiply=function(D){var re=D.sx*this.sx+D.shy*this.shx,Ce=D.sx*this.shy+D.shy*this.sy,Ne=D.shx*this.sx+D.sy*this.shx,Ke=D.shx*this.shy+D.sy*this.sy,dt=D.tx*this.sx+D.ty*this.shx+this.tx,At=D.tx*this.shy+D.ty*this.sy+this.ty;return new Zt(re,Ce,Ne,Ke,dt,At)},Zt.prototype.decompose=function(){var D=this.sx,re=this.shy,Ce=this.shx,Ne=this.sy,Ke=this.tx,dt=this.ty,At=Math.sqrt(D*D+re*re),zt=(D/=At)*Ce+(re/=At)*Ne;Ce-=D*zt,Ne-=re*zt;var nr=Math.sqrt(Ce*Ce+Ne*Ne);return zt/=nr,D*(Ne/=nr)<re*(Ce/=nr)&&(D=-D,re=-re,zt=-zt,At=-At),{scale:new Zt(At,0,0,nr,0,0),translate:new Zt(1,0,0,1,Ke,dt),rotate:new Zt(D,re,-re,D,0,0),skew:new Zt(1,0,zt,1,0,0)}},Zt.prototype.toString=function(D){return this.join(" ")},Zt.prototype.inversed=function(){var D=this.sx,re=this.shy,Ce=this.shx,Ne=this.sy,Ke=this.tx,dt=this.ty,At=1/(D*Ne-re*Ce),zt=Ne*At,nr=-re*At,Er=-Ce*At,Sr=D*At;return new Zt(zt,nr,Er,Sr,-zt*Ke-Er*dt,-nr*Ke-Sr*dt)},Zt.prototype.applyToPoint=function(D){var re=D.x*this.sx+D.y*this.shx+this.tx,Ce=D.x*this.shy+D.y*this.sy+this.ty;return new Fa(re,Ce)},Zt.prototype.applyToRectangle=function(D){var re=this.applyToPoint(D),Ce=this.applyToPoint(new Fa(D.x+D.w,D.y+D.h));return new zi(re.x,re.y,Ce.x-re.x,Ce.y-re.y)},Zt.prototype.clone=function(){var D=this.sx,re=this.shy,Ce=this.shx,Ne=this.sy,Ke=this.tx,dt=this.ty;return new Zt(D,re,Ce,Ne,Ke,dt)},p.Matrix=Zt;var Xr=p.matrixMult=function(D,re){return re.multiply(D)},Gn=new Zt(1,0,0,1,0,0);p.unitMatrix=p.identityMatrix=Gn;var Tn=function(D,re){if(!St[D]){var Ce=(re instanceof Ic?"Sh":"P")+(Object.keys(at).length+1).toString(10);re.id=Ce,St[D]=Ce,at[Ce]=re,wr.publish("addPattern",re)}};p.ShadingPattern=Ic,p.TilingPattern=qu,p.addShadingPattern=function(D,re){return S("addShadingPattern()"),Tn(D,re),this},p.beginTilingPattern=function(D){S("beginTilingPattern()"),Io(D.boundingBox[0],D.boundingBox[1],D.boundingBox[2]-D.boundingBox[0],D.boundingBox[3]-D.boundingBox[1],D.matrix)},p.endTilingPattern=function(D,re){S("endTilingPattern()"),re.stream=ge[N].join(`
`),Tn(D,re),wr.publish("endTilingPattern",re),En.pop().restore()};var Wr=p.__private__.newObject=function(){var D=en();return Se(D,!0),D},en=p.__private__.newObjectDeferred=function(){return ne++,se[ne]=function(){return ae},ne},Se=function(D,re){return re=typeof re=="boolean"&&re,se[D]=ae,re&&V(D+" 0 obj"),D},Ge=p.__private__.newAdditionalObject=function(){var D={objId:en(),content:""};return pe.push(D),D},_e=en(),Te=en(),nt=p.__private__.decodeColorString=function(D){var re=D.split(" ");if(re.length!==2||re[1]!=="g"&&re[1]!=="G")re.length===5&&(re[4]==="k"||re[4]==="K")&&(re=[(1-re[0])*(1-re[3]),(1-re[1])*(1-re[3]),(1-re[2])*(1-re[3]),"r"]);else{var Ce=parseFloat(re[0]);re=[Ce,Ce,Ce,"r"]}for(var Ne="#",Ke=0;Ke<3;Ke++)Ne+=("0"+Math.floor(255*parseFloat(re[Ke])).toString(16)).slice(-2);return Ne},mt=p.__private__.encodeColorString=function(D){var re;typeof D=="string"&&(D={ch1:D});var Ce=D.ch1,Ne=D.ch2,Ke=D.ch3,dt=D.ch4,At=D.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Ce=="string"&&Ce.charAt(0)!=="#"){var zt=new A6(Ce);if(zt.ok)Ce=zt.toHex();else if(!/^\d*\.?\d*$/.test(Ce))throw new Error('Invalid color "'+Ce+'" passed to jsPDF.encodeColorString.')}if(typeof Ce=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Ce)&&(Ce="#"+Ce[1]+Ce[1]+Ce[2]+Ce[2]+Ce[3]+Ce[3]),typeof Ce=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Ce)){var nr=parseInt(Ce.substr(1),16);Ce=nr>>16&255,Ne=nr>>8&255,Ke=255&nr}if(Ne===void 0||dt===void 0&&Ce===Ne&&Ne===Ke)if(typeof Ce=="string")re=Ce+" "+At[0];else switch(D.precision){case 2:re=U(Ce/255)+" "+At[0];break;case 3:default:re=O(Ce/255)+" "+At[0]}else if(dt===void 0||mn(dt)==="object"){if(dt&&!isNaN(dt.a)&&dt.a===0)return re=["1.","1.","1.",At[1]].join(" ");if(typeof Ce=="string")re=[Ce,Ne,Ke,At[1]].join(" ");else switch(D.precision){case 2:re=[U(Ce/255),U(Ne/255),U(Ke/255),At[1]].join(" ");break;default:case 3:re=[O(Ce/255),O(Ne/255),O(Ke/255),At[1]].join(" ")}}else if(typeof Ce=="string")re=[Ce,Ne,Ke,dt,At[2]].join(" ");else switch(D.precision){case 2:re=[U(Ce),U(Ne),U(Ke),U(dt),At[2]].join(" ");break;case 3:default:re=[O(Ce),O(Ne),O(Ke),O(dt),At[2]].join(" ")}return re},Mt=p.__private__.getFilters=function(){return s},Nr=p.__private__.putStream=function(D){var re=(D=D||{}).data||"",Ce=D.filters||Mt(),Ne=D.alreadyAppliedFilters||[],Ke=D.addLength1||!1,dt=re.length,At=D.objectId,zt=function($a){return $a};if(d!==null&&At===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");d!==null&&(zt=Bn.encryptor(At,0));var nr={};Ce===!0&&(Ce=["FlateEncode"]);var Er=D.additionalKeyValues||[],Sr=(nr=br.API.processDataByFilters!==void 0?br.API.processDataByFilters(re,Ce):{data:re,reverseChain:[]}).reverseChain+(Array.isArray(Ne)?Ne.join(" "):Ne.toString());if(nr.data.length!==0&&(Er.push({key:"Length",value:nr.data.length}),Ke===!0&&Er.push({key:"Length1",value:dt})),Sr.length!=0)if(Sr.split("/").length-1==1)Er.push({key:"Filter",value:Sr});else{Er.push({key:"Filter",value:"["+Sr+"]"});for(var Kr=0;Kr<Er.length;Kr+=1)if(Er[Kr].key==="DecodeParms"){for(var Dn=[],Un=0;Un<nr.reverseChain.split("/").length-1;Un+=1)Dn.push("null");Dn.push(Er[Kr].value),Er[Kr].value="["+Dn.join(" ")+"]"}}V("<<");for(var ra=0;ra<Er.length;ra++)V("/"+Er[ra].key+" "+Er[ra].value);V(">>"),nr.data.length!==0&&(V("stream"),V(zt(nr.data)),V("endstream"))},Ar=p.__private__.putPage=function(D){var re=D.number,Ce=D.data,Ne=D.objId,Ke=D.contentsObjId;Se(Ne,!0),V("<</Type /Page"),V("/Parent "+D.rootDictionaryObjId+" 0 R"),V("/Resources "+D.resourceDictionaryObjId+" 0 R"),V("/MediaBox ["+parseFloat(T(D.mediaBox.bottomLeftX))+" "+parseFloat(T(D.mediaBox.bottomLeftY))+" "+T(D.mediaBox.topRightX)+" "+T(D.mediaBox.topRightY)+"]"),D.cropBox!==null&&V("/CropBox ["+T(D.cropBox.bottomLeftX)+" "+T(D.cropBox.bottomLeftY)+" "+T(D.cropBox.topRightX)+" "+T(D.cropBox.topRightY)+"]"),D.bleedBox!==null&&V("/BleedBox ["+T(D.bleedBox.bottomLeftX)+" "+T(D.bleedBox.bottomLeftY)+" "+T(D.bleedBox.topRightX)+" "+T(D.bleedBox.topRightY)+"]"),D.trimBox!==null&&V("/TrimBox ["+T(D.trimBox.bottomLeftX)+" "+T(D.trimBox.bottomLeftY)+" "+T(D.trimBox.topRightX)+" "+T(D.trimBox.topRightY)+"]"),D.artBox!==null&&V("/ArtBox ["+T(D.artBox.bottomLeftX)+" "+T(D.artBox.bottomLeftY)+" "+T(D.artBox.topRightX)+" "+T(D.artBox.topRightY)+"]"),typeof D.userUnit=="number"&&D.userUnit!==1&&V("/UserUnit "+D.userUnit),wr.publish("putPage",{objId:Ne,pageContext:tr[re],pageNumber:re,page:Ce}),V("/Contents "+Ke+" 0 R"),V(">>"),V("endobj");var dt=Ce.join(`
`);return w===_.ADVANCED&&(dt+=`
Q`),Se(Ke,!0),Nr({data:dt,filters:Mt(),objectId:Ke}),V("endobj"),Ne},$r=p.__private__.putPages=function(){var D,re,Ce=[];for(D=1;D<=Dr;D++)tr[D].objId=en(),tr[D].contentsObjId=en();for(D=1;D<=Dr;D++)Ce.push(Ar({number:D,data:ge[D],objId:tr[D].objId,contentsObjId:tr[D].contentsObjId,mediaBox:tr[D].mediaBox,cropBox:tr[D].cropBox,bleedBox:tr[D].bleedBox,trimBox:tr[D].trimBox,artBox:tr[D].artBox,userUnit:tr[D].userUnit,rootDictionaryObjId:_e,resourceDictionaryObjId:Te}));Se(_e,!0),V("<</Type /Pages");var Ne="/Kids [";for(re=0;re<Dr;re++)Ne+=Ce[re]+" 0 R ";V(Ne+"]"),V("/Count "+Dr),V(">>"),V("endobj"),wr.publish("postPutPages")},Vr=function(D){wr.publish("putFont",{font:D,out:V,newObject:Wr,putStream:Nr}),D.isAlreadyPutted!==!0&&(D.objectNumber=Wr(),V("<<"),V("/Type /Font"),V("/BaseFont /"+Eu(D.postScriptName)),V("/Subtype /Type1"),typeof D.encoding=="string"&&V("/Encoding /"+D.encoding),V("/FirstChar 32"),V("/LastChar 255"),V(">>"),V("endobj"))},In=function(){for(var D in Je)Je.hasOwnProperty(D)&&(f===!1||f===!0&&h.hasOwnProperty(D))&&Vr(Je[D])},$n=function(D){D.objectNumber=Wr();var re=[];re.push({key:"Type",value:"/XObject"}),re.push({key:"Subtype",value:"/Form"}),re.push({key:"BBox",value:"["+[T(D.x),T(D.y),T(D.x+D.width),T(D.y+D.height)].join(" ")+"]"}),re.push({key:"Matrix",value:"["+D.matrix.toString()+"]"});var Ce=D.pages[1].join(`
`);Nr({data:Ce,additionalKeyValues:re,objectId:D.objectNumber}),V("endobj")},ca=function(){for(var D in dn)dn.hasOwnProperty(D)&&$n(dn[D])},fi=function(D,re){var Ce,Ne=[],Ke=1/(re-1);for(Ce=0;Ce<1;Ce+=Ke)Ne.push(Ce);if(Ne.push(1),D[0].offset!=0){var dt={offset:0,color:D[0].color};D.unshift(dt)}if(D[D.length-1].offset!=1){var At={offset:1,color:D[D.length-1].color};D.push(At)}for(var zt="",nr=0,Er=0;Er<Ne.length;Er++){for(Ce=Ne[Er];Ce>D[nr+1].offset;)nr++;var Sr=D[nr].offset,Kr=(Ce-Sr)/(D[nr+1].offset-Sr),Dn=D[nr].color,Un=D[nr+1].color;zt+=W(Math.round((1-Kr)*Dn[0]+Kr*Un[0]).toString(16))+W(Math.round((1-Kr)*Dn[1]+Kr*Un[1]).toString(16))+W(Math.round((1-Kr)*Dn[2]+Kr*Un[2]).toString(16))}return zt.trim()},ro=function(D,re){re||(re=21);var Ce=Wr(),Ne=fi(D.colors,re),Ke=[];Ke.push({key:"FunctionType",value:"0"}),Ke.push({key:"Domain",value:"[0.0 1.0]"}),Ke.push({key:"Size",value:"["+re+"]"}),Ke.push({key:"BitsPerSample",value:"8"}),Ke.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Ke.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Nr({data:Ne,additionalKeyValues:Ke,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Ce}),V("endobj"),D.objectNumber=Wr(),V("<< /ShadingType "+D.type),V("/ColorSpace /DeviceRGB");var dt="/Coords ["+T(parseFloat(D.coords[0]))+" "+T(parseFloat(D.coords[1]))+" ";D.type===2?dt+=T(parseFloat(D.coords[2]))+" "+T(parseFloat(D.coords[3])):dt+=T(parseFloat(D.coords[2]))+" "+T(parseFloat(D.coords[3]))+" "+T(parseFloat(D.coords[4]))+" "+T(parseFloat(D.coords[5])),V(dt+="]"),D.matrix&&V("/Matrix ["+D.matrix.toString()+"]"),V("/Function "+Ce+" 0 R"),V("/Extend [true true]"),V(">>"),V("endobj")},qi=function(D,re){var Ce=en(),Ne=Wr();re.push({resourcesOid:Ce,objectOid:Ne}),D.objectNumber=Ne;var Ke=[];Ke.push({key:"Type",value:"/Pattern"}),Ke.push({key:"PatternType",value:"1"}),Ke.push({key:"PaintType",value:"1"}),Ke.push({key:"TilingType",value:"1"}),Ke.push({key:"BBox",value:"["+D.boundingBox.map(T).join(" ")+"]"}),Ke.push({key:"XStep",value:T(D.xStep)}),Ke.push({key:"YStep",value:T(D.yStep)}),Ke.push({key:"Resources",value:Ce+" 0 R"}),D.matrix&&Ke.push({key:"Matrix",value:"["+D.matrix.toString()+"]"}),Nr({data:D.stream,additionalKeyValues:Ke,objectId:D.objectNumber}),V("endobj")},Nn=function(D){var re;for(re in at)at.hasOwnProperty(re)&&(at[re]instanceof Ic?ro(at[re]):at[re]instanceof qu&&qi(at[re],D))},Fi=function(D){for(var re in D.objectNumber=Wr(),V("<<"),D)switch(re){case"opacity":V("/ca "+U(D[re]));break;case"stroke-opacity":V("/CA "+U(D[re]))}V(">>"),V("endobj")},wi=function(){var D;for(D in Tt)Tt.hasOwnProperty(D)&&Fi(Tt[D])},Xe=function(){for(var D in V("/XObject <<"),dn)dn.hasOwnProperty(D)&&dn[D].objectNumber>=0&&V("/"+D+" "+dn[D].objectNumber+" 0 R");wr.publish("putXobjectDict"),V(">>")},Vt=function(){Bn.oid=Wr(),V("<<"),V("/Filter /Standard"),V("/V "+Bn.v),V("/R "+Bn.r),V("/U <"+Bn.toHexString(Bn.U)+">"),V("/O <"+Bn.toHexString(Bn.O)+">"),V("/P "+Bn.P),V(">>"),V("endobj")},ar=function(){for(var D in V("/Font <<"),Je)Je.hasOwnProperty(D)&&(f===!1||f===!0&&h.hasOwnProperty(D))&&V("/"+D+" "+Je[D].objectNumber+" 0 R");V(">>")},qr=function(){if(Object.keys(at).length>0){for(var D in V("/Shading <<"),at)at.hasOwnProperty(D)&&at[D]instanceof Ic&&at[D].objectNumber>=0&&V("/"+D+" "+at[D].objectNumber+" 0 R");wr.publish("putShadingPatternDict"),V(">>")}},kr=function(D){if(Object.keys(at).length>0){for(var re in V("/Pattern <<"),at)at.hasOwnProperty(re)&&at[re]instanceof p.TilingPattern&&at[re].objectNumber>=0&&at[re].objectNumber<D&&V("/"+re+" "+at[re].objectNumber+" 0 R");wr.publish("putTilingPatternDict"),V(">>")}},wn=function(){if(Object.keys(Tt).length>0){var D;for(D in V("/ExtGState <<"),Tt)Tt.hasOwnProperty(D)&&Tt[D].objectNumber>=0&&V("/"+D+" "+Tt[D].objectNumber+" 0 R");wr.publish("putGStateDict"),V(">>")}},Mr=function(D){Se(D.resourcesOid,!0),V("<<"),V("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),ar(),qr(),kr(D.objectOid),wn(),Xe(),V(">>"),V("endobj")},Zn=function(){var D=[];In(),wi(),ca(),Nn(D),wr.publish("putResources"),D.forEach(Mr),Mr({resourcesOid:Te,objectOid:Number.MAX_SAFE_INTEGER}),wr.publish("postPutResources")},xn=function(){wr.publish("putAdditionalObjects");for(var D=0;D<pe.length;D++){var re=pe[D];Se(re.objId,!0),V(re.content),V("endobj")}wr.publish("postPutAdditionalObjects")},Ea=function(D){Ue[D.fontName]=Ue[D.fontName]||{},Ue[D.fontName][D.fontStyle]=D.id},Ta=function(D,re,Ce,Ne,Ke){var dt={id:"F"+(Object.keys(Je).length+1).toString(10),postScriptName:D,fontName:re,fontStyle:Ce,encoding:Ne,isStandardFont:Ke||!1,metadata:{}};return wr.publish("addFont",{font:dt,instance:this}),Je[dt.id]=dt,Ea(dt),dt.id},ti=function(D){for(var re=0,Ce=Fe.length;re<Ce;re++){var Ne=Ta.call(this,D[re][0],D[re][1],D[re][2],Fe[re][3],!0);f===!1&&(h[Ne]=!0);var Ke=D[re][0].split("-");Ea({id:Ne,fontName:Ke[0],fontStyle:Ke[1]||""})}wr.publish("addFonts",{fonts:Je,dictionary:Ue})},ea=function(D){return D.foo=function(){try{return D.apply(this,arguments)}catch(Ne){var re=Ne.stack||"";~re.indexOf(" at ")&&(re=re.split(" at ")[1]);var Ce="Error in function "+re.split(`
`)[0].split("<")[0]+": "+Ne.message;if(!Cr.console)throw new Error(Ce);Cr.console.error(Ce,Ne),Cr.alert&&alert(Ce)}},D.foo.bar=D,D.foo},Cn=function(D,re){var Ce,Ne,Ke,dt,At,zt,nr,Er,Sr;if(Ke=(re=re||{}).sourceEncoding||"Unicode",At=re.outputEncoding,(re.autoencode||At)&&Je[Wt].metadata&&Je[Wt].metadata[Ke]&&Je[Wt].metadata[Ke].encoding&&(dt=Je[Wt].metadata[Ke].encoding,!At&&Je[Wt].encoding&&(At=Je[Wt].encoding),!At&&dt.codePages&&(At=dt.codePages[0]),typeof At=="string"&&(At=dt[At]),At)){for(nr=!1,zt=[],Ce=0,Ne=D.length;Ce<Ne;Ce++)(Er=At[D.charCodeAt(Ce)])?zt.push(String.fromCharCode(Er)):zt.push(D[Ce]),zt[Ce].charCodeAt(0)>>8&&(nr=!0);D=zt.join("")}for(Ce=D.length;nr===void 0&&Ce!==0;)D.charCodeAt(Ce-1)>>8&&(nr=!0),Ce--;if(!nr)return D;for(zt=re.noBOM?[]:[254,255],Ce=0,Ne=D.length;Ce<Ne;Ce++){if((Sr=(Er=D.charCodeAt(Ce))>>8)>>8)throw new Error("Character at position "+Ce+" of string '"+D+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");zt.push(Sr),zt.push(Er-(Sr<<8))}return String.fromCharCode.apply(void 0,zt)},Gr=p.__private__.pdfEscape=p.pdfEscape=function(D,re){return Cn(D,re).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},no=p.__private__.beginPage=function(D){ge[++Dr]=[],tr[Dr]={objId:0,contentsObjId:0,userUnit:Number(l),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(D[0]),topRightY:Number(D[1])}},ji(Dr),le(ge[N])},ao=function(D,re){var Ce,Ne,Ke;switch(r=re||r,typeof D=="string"&&(Ce=b(D.toLowerCase()),Array.isArray(Ce)&&(Ne=Ce[0],Ke=Ce[1])),Array.isArray(D)&&(Ne=D[0]*jt,Ke=D[1]*jt),isNaN(Ne)&&(Ne=a[0],Ke=a[1]),(Ne>14400||Ke>14400)&&(Pn.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Ne=Math.min(14400,Ne),Ke=Math.min(14400,Ke)),a=[Ne,Ke],r.substr(0,1)){case"l":Ke>Ne&&(a=[Ke,Ne]);break;case"p":Ne>Ke&&(a=[Ke,Ne])}no(a),Us(Bs),V(Lt),Pi!==0&&V(Pi+" J"),ai!==0&&V(ai+" j"),wr.publish("addPage",{pageNumber:Dr})},io=function(D){D>0&&D<=Dr&&(ge.splice(D,1),tr.splice(D,1),Dr--,N>Dr&&(N=Dr),this.setPage(N))},ji=function(D){D>0&&D<=Dr&&(N=D)},oo=p.__private__.getNumberOfPages=p.getNumberOfPages=function(){return ge.length-1},hi=function(D,re,Ce){var Ne,Ke=void 0;return Ce=Ce||{},D=D!==void 0?D:Je[Wt].fontName,re=re!==void 0?re:Je[Wt].fontStyle,Ne=D.toLowerCase(),Ue[Ne]!==void 0&&Ue[Ne][re]!==void 0?Ke=Ue[Ne][re]:Ue[D]!==void 0&&Ue[D][re]!==void 0?Ke=Ue[D][re]:Ce.disableWarning===!1&&Pn.warn("Unable to look up font label for font '"+D+"', '"+re+"'. Refer to getFontList() for available fonts."),Ke||Ce.noFallback||(Ke=Ue.times[re])==null&&(Ke=Ue.times.normal),Ke},Oo=p.__private__.putInfo=function(){var D=Wr(),re=function(Ne){return Ne};for(var Ce in d!==null&&(re=Bn.encryptor(D,0)),V("<<"),V("/Producer ("+Gr(re("jsPDF "+br.version))+")"),Ot)Ot.hasOwnProperty(Ce)&&Ot[Ce]&&V("/"+Ce.substr(0,1).toUpperCase()+Ce.substr(1)+" ("+Gr(re(Ot[Ce]))+")");V("/CreationDate ("+Gr(re(z))+")"),V(">>"),V("endobj")},$i=p.__private__.putCatalog=function(D){var re=(D=D||{}).rootDictionaryObjId||_e;switch(Wr(),V("<<"),V("/Type /Catalog"),V("/Pages "+re+" 0 R"),it||(it="fullwidth"),it){case"fullwidth":V("/OpenAction [3 0 R /FitH null]");break;case"fullheight":V("/OpenAction [3 0 R /FitV null]");break;case"fullpage":V("/OpenAction [3 0 R /Fit]");break;case"original":V("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Ce=""+it;Ce.substr(Ce.length-1)==="%"&&(it=parseInt(it)/100),typeof it=="number"&&V("/OpenAction [3 0 R /XYZ null null "+U(it)+"]")}switch(We||(We="continuous"),We){case"continuous":V("/PageLayout /OneColumn");break;case"single":V("/PageLayout /SinglePage");break;case"two":case"twoleft":V("/PageLayout /TwoColumnLeft");break;case"tworight":V("/PageLayout /TwoColumnRight")}Ye&&V("/PageMode /"+Ye),wr.publish("putCatalog"),V(">>"),V("endobj")},fs=p.__private__.putTrailer=function(){V("trailer"),V("<<"),V("/Size "+(ne+1)),V("/Root "+ne+" 0 R"),V("/Info "+(ne-1)+" 0 R"),d!==null&&V("/Encrypt "+Bn.oid+" 0 R"),V("/ID [ <"+K+"> <"+K+"> ]"),V(">>")},so=p.__private__.putHeader=function(){V("%PDF-"+v),V("%")},hs=p.__private__.putXRef=function(){var D="0000000000";V("xref"),V("0 "+(ne+1)),V("0000000000 65535 f ");for(var re=1;re<=ne;re++)typeof se[re]=="function"?V((D+se[re]()).slice(-10)+" 00000 n "):se[re]!==void 0?V((D+se[re]).slice(-10)+" 00000 n "):V("0000000000 00000 n ")},Ya=p.__private__.buildDocument=function(){ee(),le(oe),wr.publish("buildDocument"),so(),$r(),xn(),Zn(),d!==null&&Vt(),Oo(),$i();var D=ae;return hs(),fs(),V("startxref"),V(""+D),V("%%EOF"),le(ge[N]),oe.join(`
`)},lo=p.__private__.getBlob=function(D){return new Blob([Me(D)],{type:"application/pdf"})},ri=p.output=p.__private__.output=ea(function(D,re){switch(typeof(re=re||{})=="string"?re={filename:re}:re.filename=re.filename||"generated.pdf",D){case void 0:return Ya();case"save":p.save(re.filename);break;case"arraybuffer":return Me(Ya());case"blob":return lo(Ya());case"bloburi":case"bloburl":if(Cr.URL!==void 0&&typeof Cr.URL.createObjectURL=="function")return Cr.URL&&Cr.URL.createObjectURL(lo(Ya()))||void 0;Pn.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Ce="",Ne=Ya();try{Ce=kw(Ne)}catch{Ce=kw(unescape(encodeURIComponent(Ne)))}return"data:application/pdf;filename="+re.filename+";base64,"+Ce;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Cr)==="[object Window]"){var Ke="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",dt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';re.pdfObjectUrl&&(Ke=re.pdfObjectUrl,dt="");var At='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Ke+'"'+dt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(re)+");<\/script></body></html>",zt=Cr.open();return zt!==null&&zt.document.write(At),zt}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Cr)==="[object Window]"){var nr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(re.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+re.filename+'" width="500px" height="400px" /></body></html>',Er=Cr.open();if(Er!==null){Er.document.write(nr);var Sr=this;Er.document.documentElement.querySelector("#pdfViewer").onload=function(){Er.document.title=re.filename,Er.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Sr.output("bloburl"))}}return Er}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Cr)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Kr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",re)+'"></iframe></body></html>',Dn=Cr.open();if(Dn!==null&&(Dn.document.write(Kr),Dn.document.title=re.filename),Dn||typeof safari>"u")return Dn;break;case"datauri":case"dataurl":return Cr.document.location.href=this.output("datauristring",re);default:return null}}),dc=function(D){return Array.isArray(Ir)===!0&&Ir.indexOf(D)>-1};switch(n){case"pt":jt=1;break;case"mm":jt=72/25.4;break;case"cm":jt=72/2.54;break;case"in":jt=72;break;case"px":jt=dc("px_scaling")==1?.75:96/72;break;case"pc":case"em":jt=12;break;case"ex":jt=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);jt=n}var Bn=null;X(),R();var Yo=function(D){return d!==null?Bn.encryptor(D,0):function(re){return re}},ko=p.__private__.getPageInfo=p.getPageInfo=function(D){if(isNaN(D)||D%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:tr[D].objId,pageNumber:D,pageContext:tr[D]}},yr=p.__private__.getPageInfoByObjId=function(D){if(isNaN(D)||D%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var re in tr)if(tr[re].objId===D)break;return ko(re)},Cl=p.__private__.getCurrentPageInfo=p.getCurrentPageInfo=function(){return{objId:tr[N].objId,pageNumber:N,pageContext:tr[N]}};p.addPage=function(){return ao.apply(this,arguments),this},p.setPage=function(){return ji.apply(this,arguments),le.call(this,ge[N]),this},p.insertPage=function(D){return this.addPage(),this.movePage(N,D),this},p.movePage=function(D,re){var Ce,Ne;if(D>re){Ce=ge[D],Ne=tr[D];for(var Ke=D;Ke>re;Ke--)ge[Ke]=ge[Ke-1],tr[Ke]=tr[Ke-1];ge[re]=Ce,tr[re]=Ne,this.setPage(re)}else if(D<re){Ce=ge[D],Ne=tr[D];for(var dt=D;dt<re;dt++)ge[dt]=ge[dt+1],tr[dt]=tr[dt+1];ge[re]=Ce,tr[re]=Ne,this.setPage(re)}return this},p.deletePage=function(){return io.apply(this,arguments),this},p.__private__.text=p.text=function(D,re,Ce,Ne,Ke){var dt,At,zt,nr,Er,Sr,Kr,Dn,Un,ra=(Ne=Ne||{}).scope||this;if(typeof D=="number"&&typeof re=="number"&&(typeof Ce=="string"||Array.isArray(Ce))){var $a=Ce;Ce=re,re=D,D=$a}if(arguments[3]instanceof Zt?(S("The transform parameter of text() with a Matrix value"),Un=Ke):(zt=arguments[4],nr=arguments[5],mn(Kr=arguments[3])==="object"&&Kr!==null||(typeof zt=="string"&&(nr=zt,zt=null),typeof Kr=="string"&&(nr=Kr,Kr=null),typeof Kr=="number"&&(zt=Kr,Kr=null),Ne={flags:Kr,angle:zt,align:nr})),isNaN(re)||isNaN(Ce)||D==null)throw new Error("Invalid arguments passed to jsPDF.text");if(D.length===0)return ra;var Na="",fo=!1,ki=typeof Ne.lineHeightFactor=="number"?Ne.lineHeightFactor:Ai,No=ra.internal.scaleFactor;function uu(Mn){return Mn=Mn.split("	").join(Array(Ne.TabLen||9).join(" ")),Gr(Mn,Kr)}function mc(Mn){for(var Ln,ba=Mn.concat(),Ba=[],Ys=ba.length;Ys--;)typeof(Ln=ba.shift())=="string"?Ba.push(Ln):Array.isArray(Mn)&&(Ln.length===1||Ln[1]===void 0&&Ln[2]===void 0)?Ba.push(Ln[0]):Ba.push([Ln[0],Ln[1],Ln[2]]);return Ba}function Pl(Mn,Ln){var ba;if(typeof Mn=="string")ba=Ln(Mn)[0];else if(Array.isArray(Mn)){for(var Ba,Ys,Yd=Mn.concat(),pu=[],Gp=Yd.length;Gp--;)typeof(Ba=Yd.shift())=="string"?pu.push(Ln(Ba)[0]):Array.isArray(Ba)&&typeof Ba[0]=="string"&&(Ys=Ln(Ba[0],Ba[1],Ba[2]),pu.push([Ys[0],Ys[1],Ys[2]]));ba=pu}return ba}var Ol=!1,gc=!0;if(typeof D=="string")Ol=!0;else if(Array.isArray(D)){var kl=D.concat();At=[];for(var zs,ua=kl.length;ua--;)(typeof(zs=kl.shift())!="string"||Array.isArray(zs)&&typeof zs[0]!="string")&&(gc=!1);Ol=gc}if(Ol===!1)throw new Error('Type of text must be string or Array. "'+D+'" is not recognized.');typeof D=="string"&&(D=D.match(/[\r?\n]/)?D.split(/\r\n|\r|\n/g):[D]);var El=Qe/ra.internal.scaleFactor,de=El*(ki-1);switch(Ne.baseline){case"bottom":Ce-=de;break;case"top":Ce+=El-de;break;case"hanging":Ce+=El-2*de;break;case"middle":Ce+=El/2-de}if((Sr=Ne.maxWidth||0)>0&&(typeof D=="string"?D=ra.splitTextToSize(D,Sr):Object.prototype.toString.call(D)==="[object Array]"&&(D=D.reduce(function(Mn,Ln){return Mn.concat(ra.splitTextToSize(Ln,Sr))},[]))),dt={text:D,x:re,y:Ce,options:Ne,mutex:{pdfEscape:Gr,activeFontKey:Wt,fonts:Je,activeFontSize:Qe}},wr.publish("preProcessText",dt),D=dt.text,zt=(Ne=dt.options).angle,!(Un instanceof Zt)&&zt&&typeof zt=="number"){zt*=Math.PI/180,Ne.rotationDirection===0&&(zt=-zt),w===_.ADVANCED&&(zt=-zt);var he=Math.cos(zt),Ee=Math.sin(zt);Un=new Zt(he,Ee,-Ee,he,0,0)}else zt&&zt instanceof Zt&&(Un=zt);w!==_.ADVANCED||Un||(Un=Gn),(Er=Ne.charSpace||ta)!==void 0&&(Na+=T(M(Er))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Dn=Ne.horizontalScale)!==void 0&&(Na+=T(100*Dn)+` Tz
`),Ne.lang;var ke=-1,rt=Ne.renderingMode!==void 0?Ne.renderingMode:Ne.stroke,_t=ra.internal.getCurrentPageInfo().pageContext;switch(rt){case 0:case!1:case"fill":ke=0;break;case 1:case!0:case"stroke":ke=1;break;case 2:case"fillThenStroke":ke=2;break;case 3:case"invisible":ke=3;break;case 4:case"fillAndAddForClipping":ke=4;break;case 5:case"strokeAndAddPathForClipping":ke=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":ke=6;break;case 7:case"addToPathForClipping":ke=7}var Bt=_t.usedRenderingMode!==void 0?_t.usedRenderingMode:-1;ke!==-1?Na+=ke+` Tr
`:Bt!==-1&&(Na+=`0 Tr
`),ke!==-1&&(_t.usedRenderingMode=ke),nr=Ne.align||"left";var Nt,cr=Qe*ki,Kn=ra.internal.pageSize.getWidth(),ya=Je[Wt];Er=Ne.charSpace||ta,Sr=Ne.maxWidth||0,Kr=Object.assign({autoencode:!0,noBOM:!0},Ne.flags);var Vi=[],Ws=function(Mn){return ra.getStringUnitWidth(Mn,{font:ya,charSpace:Er,fontSize:Qe,doKerning:!1})*Qe/No};if(Object.prototype.toString.call(D)==="[object Array]"){var Gi;At=mc(D),nr!=="left"&&(Nt=At.map(Ws));var Ei,Tl=0;if(nr==="right"){re-=Nt[0],D=[],ua=At.length;for(var Hs=0;Hs<ua;Hs++)Hs===0?(Ei=Le(re),Gi=De(Ce)):(Ei=M(Tl-Nt[Hs]),Gi=-cr),D.push([At[Hs],Ei,Gi]),Tl=Nt[Hs]}else if(nr==="center"){re-=Nt[0]/2,D=[],ua=At.length;for(var Vs=0;Vs<ua;Vs++)Vs===0?(Ei=Le(re),Gi=De(Ce)):(Ei=M((Tl-Nt[Vs])/2),Gi=-cr),D.push([At[Vs],Ei,Gi]),Tl=Nt[Vs]}else if(nr==="left"){D=[],ua=At.length;for(var du=0;du<ua;du++)D.push(At[du])}else if(nr==="justify"&&ya.encoding==="Identity-H"){D=[],ua=At.length,Sr=Sr!==0?Sr:Kn;for(var Gs=0,xa=0;xa<ua;xa++)if(Gi=xa===0?De(Ce):-cr,Ei=xa===0?Le(re):Gs,xa<ua-1){var Hd=M((Sr-Nt[xa])/(At[xa].split(" ").length-1)),Ti=At[xa].split(" ");D.push([Ti[0]+" ",Ei,Gi]),Gs=0;for(var Do=1;Do<Ti.length;Do++){var fu=(Ws(Ti[Do-1]+" "+Ti[Do])-Ws(Ti[Do]))*No+Hd;Do==Ti.length-1?D.push([Ti[Do],fu,0]):D.push([Ti[Do]+" ",fu,0]),Gs-=fu}}else D.push([At[xa],Ei,Gi]);D.push(["",Gs,0])}else{if(nr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(D=[],ua=At.length,Sr=Sr!==0?Sr:Kn,xa=0;xa<ua;xa++)Gi=xa===0?De(Ce):-cr,Ei=xa===0?Le(re):0,xa<ua-1?Vi.push(T(M((Sr-Nt[xa])/(At[xa].split(" ").length-1)))):Vi.push(0),D.push([At[xa],Ei,Gi])}}var Vp=typeof Ne.R2L=="boolean"?Ne.R2L:vt;Vp===!0&&(D=Pl(D,function(Mn,Ln,ba){return[Mn.split("").reverse().join(""),Ln,ba]})),dt={text:D,x:re,y:Ce,options:Ne,mutex:{pdfEscape:Gr,activeFontKey:Wt,fonts:Je,activeFontSize:Qe}},wr.publish("postProcessText",dt),D=dt.text,fo=dt.mutex.isHex||!1;var Vd=Je[Wt].encoding;Vd!=="WinAnsiEncoding"&&Vd!=="StandardEncoding"||(D=Pl(D,function(Mn,Ln,ba){return[uu(Mn),Ln,ba]})),At=mc(D),D=[];for(var vc,yc,Il,xc=0,hu=1,bc=Array.isArray(At[0])?hu:xc,Nl="",Gd=function(Mn,Ln,ba){var Ba="";return ba instanceof Zt?(ba=typeof Ne.angle=="number"?Xr(ba,new Zt(1,0,0,1,Mn,Ln)):Xr(new Zt(1,0,0,1,Mn,Ln),ba),w===_.ADVANCED&&(ba=Xr(new Zt(1,0,0,-1,0,0),ba)),Ba=ba.join(" ")+` Tm
`):Ba=T(Mn)+" "+T(Ln)+` Td
`,Ba},Mo=0;Mo<At.length;Mo++){switch(Nl="",bc){case hu:Il=(fo?"<":"(")+At[Mo][0]+(fo?">":")"),vc=parseFloat(At[Mo][1]),yc=parseFloat(At[Mo][2]);break;case xc:Il=(fo?"<":"(")+At[Mo]+(fo?">":")"),vc=Le(re),yc=De(Ce)}Vi!==void 0&&Vi[Mo]!==void 0&&(Nl=Vi[Mo]+` Tw
`),Mo===0?D.push(Nl+Gd(vc,yc,Un)+Il):bc===xc?D.push(Nl+Il):bc===hu&&D.push(Nl+Gd(vc,yc,Un)+Il)}D=bc===xc?D.join(` Tj
T* `):D.join(` Tj
`),D+=` Tj
`;var Lo=`BT
/`;return Lo+=Wt+" "+Qe+` Tf
`,Lo+=T(Qe*ki)+` TL
`,Lo+=zr+`
`,Lo+=Na,Lo+=D,V(Lo+="ET"),h[Wt]=!0,ra};var fc=p.__private__.clip=p.clip=function(D){return V(D==="evenodd"?"W*":"W"),this};p.clipEvenOdd=function(){return fc("evenodd")},p.__private__.discardPath=p.discardPath=function(){return V("n"),this};var Si=p.__private__.isValidStyle=function(D){var re=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(D)!==-1&&(re=!0),re};p.__private__.setDefaultPathOperation=p.setDefaultPathOperation=function(D){return Si(D)&&(u=D),this};var Fs=p.__private__.getStyle=p.getStyle=function(D){var re=u;switch(D){case"D":case"S":re="S";break;case"F":re="f";break;case"FD":case"DF":re="B";break;case"f":case"f*":case"B":case"B*":re=D}return re},Ci=p.close=function(){return V("h"),this};p.stroke=function(){return V("S"),this},p.fill=function(D){return Ko("f",D),this},p.fillEvenOdd=function(D){return Ko("f*",D),this},p.fillStroke=function(D){return Ko("B",D),this},p.fillStrokeEvenOdd=function(D){return Ko("B*",D),this};var Ko=function(D,re){mn(re)==="object"?hc(re,D):V(D)},ni=function(D){D===null||w===_.ADVANCED&&D===void 0||(D=Fs(D),V(D))};function Bi(D,re,Ce,Ne,Ke){var dt=new qu(re||this.boundingBox,Ce||this.xStep,Ne||this.yStep,this.gState,Ke||this.matrix);dt.stream=this.stream;var At=D+"$$"+this.cloneIndex+++"$$";return Tn(At,dt),dt}var hc=function(D,re){var Ce=St[D.key],Ne=at[Ce];if(Ne instanceof Ic)V("q"),V($s(re)),Ne.gState&&p.setGState(Ne.gState),V(D.matrix.toString()+" cm"),V("/"+Ce+" sh"),V("Q");else if(Ne instanceof qu){var Ke=new Zt(1,0,0,-1,0,ii());D.matrix&&(Ke=Ke.multiply(D.matrix||Gn),Ce=Bi.call(Ne,D.key,D.boundingBox,D.xStep,D.yStep,Ke).id),V("q"),V("/Pattern cs"),V("/"+Ce+" scn"),Ne.gState&&p.setGState(Ne.gState),V(re),V("Q")}},$s=function(D){switch(D){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},co=p.moveTo=function(D,re){return V(T(M(D))+" "+T(q(re))+" m"),this},Eo=p.lineTo=function(D,re){return V(T(M(D))+" "+T(q(re))+" l"),this},To=p.curveTo=function(D,re,Ce,Ne,Ke,dt){return V([T(M(D)),T(q(re)),T(M(Ce)),T(q(Ne)),T(M(Ke)),T(q(dt)),"c"].join(" ")),this};p.__private__.line=p.line=function(D,re,Ce,Ne,Ke){if(isNaN(D)||isNaN(re)||isNaN(Ce)||isNaN(Ne)||!Si(Ke))throw new Error("Invalid arguments passed to jsPDF.line");return w===_.COMPAT?this.lines([[Ce-D,Ne-re]],D,re,[1,1],Ke||"S"):this.lines([[Ce-D,Ne-re]],D,re,[1,1]).stroke()},p.__private__.lines=p.lines=function(D,re,Ce,Ne,Ke,dt){var At,zt,nr,Er,Sr,Kr,Dn,Un,ra,$a,Na,fo;if(typeof D=="number"&&(fo=Ce,Ce=re,re=D,D=fo),Ne=Ne||[1,1],dt=dt||!1,isNaN(re)||isNaN(Ce)||!Array.isArray(D)||!Array.isArray(Ne)||!Si(Ke)||typeof dt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(co(re,Ce),At=Ne[0],zt=Ne[1],Er=D.length,$a=re,Na=Ce,nr=0;nr<Er;nr++)(Sr=D[nr]).length===2?($a=Sr[0]*At+$a,Na=Sr[1]*zt+Na,Eo($a,Na)):(Kr=Sr[0]*At+$a,Dn=Sr[1]*zt+Na,Un=Sr[2]*At+$a,ra=Sr[3]*zt+Na,$a=Sr[4]*At+$a,Na=Sr[5]*zt+Na,To(Kr,Dn,Un,ra,$a,Na));return dt&&Ci(),ni(Ke),this},p.path=function(D){for(var re=0;re<D.length;re++){var Ce=D[re],Ne=Ce.c;switch(Ce.op){case"m":co(Ne[0],Ne[1]);break;case"l":Eo(Ne[0],Ne[1]);break;case"c":To.apply(this,Ne);break;case"h":Ci()}}return this},p.__private__.rect=p.rect=function(D,re,Ce,Ne,Ke){if(isNaN(D)||isNaN(re)||isNaN(Ce)||isNaN(Ne)||!Si(Ke))throw new Error("Invalid arguments passed to jsPDF.rect");return w===_.COMPAT&&(Ne=-Ne),V([T(M(D)),T(q(re)),T(M(Ce)),T(M(Ne)),"re"].join(" ")),ni(Ke),this},p.__private__.triangle=p.triangle=function(D,re,Ce,Ne,Ke,dt,At){if(isNaN(D)||isNaN(re)||isNaN(Ce)||isNaN(Ne)||isNaN(Ke)||isNaN(dt)||!Si(At))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Ce-D,Ne-re],[Ke-Ce,dt-Ne],[D-Ke,re-dt]],D,re,[1,1],At,!0),this},p.__private__.roundedRect=p.roundedRect=function(D,re,Ce,Ne,Ke,dt,At){if(isNaN(D)||isNaN(re)||isNaN(Ce)||isNaN(Ne)||isNaN(Ke)||isNaN(dt)||!Si(At))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var zt=4/3*(Math.SQRT2-1);return Ke=Math.min(Ke,.5*Ce),dt=Math.min(dt,.5*Ne),this.lines([[Ce-2*Ke,0],[Ke*zt,0,Ke,dt-dt*zt,Ke,dt],[0,Ne-2*dt],[0,dt*zt,-Ke*zt,dt,-Ke,dt],[2*Ke-Ce,0],[-Ke*zt,0,-Ke,-dt*zt,-Ke,-dt],[0,2*dt-Ne],[0,-dt*zt,Ke*zt,-dt,Ke,-dt]],D+Ke,re,[1,1],At,!0),this},p.__private__.ellipse=p.ellipse=function(D,re,Ce,Ne,Ke){if(isNaN(D)||isNaN(re)||isNaN(Ce)||isNaN(Ne)||!Si(Ke))throw new Error("Invalid arguments passed to jsPDF.ellipse");var dt=4/3*(Math.SQRT2-1)*Ce,At=4/3*(Math.SQRT2-1)*Ne;return co(D+Ce,re),To(D+Ce,re-At,D+dt,re-Ne,D,re-Ne),To(D-dt,re-Ne,D-Ce,re-At,D-Ce,re),To(D-Ce,re+At,D-dt,re+Ne,D,re+Ne),To(D+dt,re+Ne,D+Ce,re+At,D+Ce,re),ni(Ke),this},p.__private__.circle=p.circle=function(D,re,Ce,Ne){if(isNaN(D)||isNaN(re)||isNaN(Ce)||!Si(Ne))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(D,re,Ce,Ce,Ne)},p.setFont=function(D,re,Ce){return Ce&&(re=E(re,Ce)),Wt=hi(D,re,{disableWarning:!1}),this};var Al=p.__private__.getFont=p.getFont=function(){return Je[hi.apply(p,arguments)]};p.__private__.getFontList=p.getFontList=function(){var D,re,Ce={};for(D in Ue)if(Ue.hasOwnProperty(D))for(re in Ce[D]=[],Ue[D])Ue[D].hasOwnProperty(re)&&Ce[D].push(re);return Ce},p.addFont=function(D,re,Ce,Ne,Ke){var dt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&dt.indexOf(arguments[3])!==-1?Ke=arguments[3]:arguments[3]&&dt.indexOf(arguments[3])==-1&&(Ce=E(Ce,Ne)),Ke=Ke||"Identity-H",Ta.call(this,D,re,Ce,Ke)};var Ai,Bs=e.lineWidth||.200025,Ui=p.__private__.getLineWidth=p.getLineWidth=function(){return Bs},Us=p.__private__.setLineWidth=p.setLineWidth=function(D){return Bs=D,V(T(M(D))+" w"),this};p.__private__.setLineDash=br.API.setLineDash=br.API.setLineDashPattern=function(D,re){if(D=D||[],re=re||0,isNaN(re)||!Array.isArray(D))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return D=D.map(function(Ce){return T(M(Ce))}).join(" "),re=T(M(re)),V("["+D+"] "+re+" d"),this};var be=p.__private__.getLineHeight=p.getLineHeight=function(){return Qe*Ai};p.__private__.getLineHeight=p.getLineHeight=function(){return Qe*Ai};var je=p.__private__.setLineHeightFactor=p.setLineHeightFactor=function(D){return typeof(D=D||1.15)=="number"&&(Ai=D),this},Ie=p.__private__.getLineHeightFactor=p.getLineHeightFactor=function(){return Ai};je(e.lineHeight);var Le=p.__private__.getHorizontalCoordinate=function(D){return M(D)},De=p.__private__.getVerticalCoordinate=function(D){return w===_.ADVANCED?D:tr[N].mediaBox.topRightY-tr[N].mediaBox.bottomLeftY-M(D)},pt=p.__private__.getHorizontalCoordinateString=p.getHorizontalCoordinateString=function(D){return T(Le(D))},kt=p.__private__.getVerticalCoordinateString=p.getVerticalCoordinateString=function(D){return T(De(D))},Lt=e.strokeColor||"0 G";p.__private__.getStrokeColor=p.getDrawColor=function(){return nt(Lt)},p.__private__.setStrokeColor=p.setDrawColor=function(D,re,Ce,Ne){return Lt=mt({ch1:D,ch2:re,ch3:Ce,ch4:Ne,pdfColorType:"draw",precision:2}),V(Lt),this};var jr=e.fillColor||"0 g";p.__private__.getFillColor=p.getFillColor=function(){return nt(jr)},p.__private__.setFillColor=p.setFillColor=function(D,re,Ce,Ne){return jr=mt({ch1:D,ch2:re,ch3:Ce,ch4:Ne,pdfColorType:"fill",precision:2}),V(jr),this};var zr=e.textColor||"0 g",fn=p.__private__.getTextColor=p.getTextColor=function(){return nt(zr)};p.__private__.setTextColor=p.setTextColor=function(D,re,Ce,Ne){return zr=mt({ch1:D,ch2:re,ch3:Ce,ch4:Ne,pdfColorType:"text",precision:3}),this};var ta=e.charSpace,Yn=p.__private__.getCharSpace=p.getCharSpace=function(){return parseFloat(ta||0)};p.__private__.setCharSpace=p.setCharSpace=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return ta=D,this};var Pi=0;p.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},p.__private__.setLineCap=p.setLineCap=function(D){var re=p.CapJoinStyles[D];if(re===void 0)throw new Error("Line cap style of '"+D+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Pi=re,V(re+" J"),this};var ai=0;p.__private__.setLineJoin=p.setLineJoin=function(D){var re=p.CapJoinStyles[D];if(re===void 0)throw new Error("Line join style of '"+D+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return ai=re,V(re+" j"),this},p.__private__.setLineMiterLimit=p.__private__.setMiterLimit=p.setLineMiterLimit=p.setMiterLimit=function(D){if(D=D||0,isNaN(D))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return V(T(M(D))+" M"),this},p.GState=bv,p.setGState=function(D){(D=typeof D=="string"?Tt[Yt[D]]:Ia(null,D)).equals(Or)||(V("/"+D.id+" gs"),Or=D)};var Ia=function(D,re){if(!D||!Yt[D]){var Ce=!1;for(var Ne in Tt)if(Tt.hasOwnProperty(Ne)&&Tt[Ne].equals(re)){Ce=!0;break}if(Ce)re=Tt[Ne];else{var Ke="GS"+(Object.keys(Tt).length+1).toString(10);Tt[Ke]=re,re.id=Ke}return D&&(Yt[D]=re.id),wr.publish("addGState",re),re}};p.addGState=function(D,re){return Ia(D,re),this},p.saveGraphicsState=function(){return V("q"),ht.push({key:Wt,size:Qe,color:zr}),this},p.restoreGraphicsState=function(){V("Q");var D=ht.pop();return Wt=D.key,Qe=D.size,zr=D.color,Or=null,this},p.setCurrentTransformationMatrix=function(D){return V(D.toString()+" cm"),this},p.comment=function(D){return V("#"+D),this};var Fa=function(D,re){var Ce=D||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Ce},set:function(dt){isNaN(dt)||(Ce=parseFloat(dt))}});var Ne=re||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Ne},set:function(dt){isNaN(dt)||(Ne=parseFloat(dt))}});var Ke="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Ke},set:function(dt){Ke=dt.toString()}}),this},zi=function(D,re,Ce,Ne){Fa.call(this,D,re),this.type="rect";var Ke=Ce||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Ke},set:function(At){isNaN(At)||(Ke=parseFloat(At))}});var dt=Ne||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return dt},set:function(At){isNaN(At)||(dt=parseFloat(At))}}),this},uo=function(){this.page=Dr,this.currentPage=N,this.pages=ge.slice(0),this.pagesContext=tr.slice(0),this.x=lr,this.y=$e,this.matrix=He,this.width=Hi(N),this.height=ii(N),this.outputDestination=G,this.id="",this.objectNumber=-1};uo.prototype.restore=function(){Dr=this.page,N=this.currentPage,tr=this.pagesContext,ge=this.pages,lr=this.x,$e=this.y,He=this.matrix,ps(N,this.width),pc(N,this.height),G=this.outputDestination};var Io=function(D,re,Ce,Ne,Ke){En.push(new uo),Dr=N=0,ge=[],lr=D,$e=re,He=Ke,no([Ce,Ne])},Oi=function(D){if(ka[D])En.pop().restore();else{var re=new uo,Ce="Xo"+(Object.keys(dn).length+1).toString(10);re.id=Ce,ka[D]=Ce,dn[Ce]=re,wr.publish("addFormObject",re),En.pop().restore()}};for(var Wi in p.beginFormObject=function(D,re,Ce,Ne,Ke){return Io(D,re,Ce,Ne,Ke),this},p.endFormObject=function(D){return Oi(D),this},p.doFormObject=function(D,re){var Ce=dn[ka[D]];return V("q"),V(re.toString()+" cm"),V("/"+Ce.id+" Do"),V("Q"),this},p.getFormObject=function(D){var re=dn[ka[D]];return{x:re.x,y:re.y,width:re.width,height:re.height,matrix:re.matrix}},p.save=function(D,re){return D=D||"generated.pdf",(re=re||{}).returnPromise=re.returnPromise||!1,re.returnPromise===!1?(Ec(lo(Ya()),D),typeof Ec.unload=="function"&&Cr.setTimeout&&setTimeout(Ec.unload,911),this):new Promise(function(Ce,Ne){try{var Ke=Ec(lo(Ya()),D);typeof Ec.unload=="function"&&Cr.setTimeout&&setTimeout(Ec.unload,911),Ce(Ke)}catch(dt){Ne(dt.message)}})},br.API)br.API.hasOwnProperty(Wi)&&(Wi==="events"&&br.API.events.length?function(D,re){var Ce,Ne,Ke;for(Ke=re.length-1;Ke!==-1;Ke--)Ce=re[Ke][0],Ne=re[Ke][1],D.subscribe.apply(D,[Ce].concat(typeof Ne=="function"?[Ne]:Ne))}(wr,br.API.events):p[Wi]=br.API[Wi]);var Hi=p.getPageWidth=function(D){return(tr[D=D||N].mediaBox.topRightX-tr[D].mediaBox.bottomLeftX)/jt},ps=p.setPageWidth=function(D,re){tr[D].mediaBox.topRightX=re*jt+tr[D].mediaBox.bottomLeftX},ii=p.getPageHeight=function(D){return(tr[D=D||N].mediaBox.topRightY-tr[D].mediaBox.bottomLeftY)/jt},pc=p.setPageHeight=function(D,re){tr[D].mediaBox.topRightY=re*jt+tr[D].mediaBox.bottomLeftY};return p.internal={pdfEscape:Gr,getStyle:Fs,getFont:Al,getFontSize:st,getCharSpace:Yn,getTextColor:fn,getLineHeight:be,getLineHeightFactor:Ie,getLineWidth:Ui,write:Ve,getHorizontalCoordinate:Le,getVerticalCoordinate:De,getCoordinateString:pt,getVerticalCoordinateString:kt,collections:{},newObject:Wr,newAdditionalObject:Ge,newObjectDeferred:en,newObjectDeferredBegin:Se,getFilters:Mt,putStream:Nr,events:wr,scaleFactor:jt,pageSize:{getWidth:function(){return Hi(N)},setWidth:function(D){ps(N,D)},getHeight:function(){return ii(N)},setHeight:function(D){pc(N,D)}},encryptionOptions:d,encryption:Bn,getEncryptor:Yo,output:ri,getNumberOfPages:oo,pages:ge,out:V,f2:U,f3:O,getPageInfo:ko,getPageInfoByObjId:yr,getCurrentPageInfo:Cl,getPDFVersion:m,Point:Fa,Rectangle:zi,Matrix:Zt,hasHotfix:dc},Object.defineProperty(p.internal.pageSize,"width",{get:function(){return Hi(N)},set:function(D){ps(N,D)},enumerable:!0,configurable:!0}),Object.defineProperty(p.internal.pageSize,"height",{get:function(){return ii(N)},set:function(D){pc(N,D)},enumerable:!0,configurable:!0}),ti.call(p,Fe),Wt="F1",ao(a,r),wr.publish("initialized"),p}ku.prototype.lsbFirstWord=function(e){return String.fromCharCode(e>>0&255,e>>8&255,e>>16&255,e>>24&255)},ku.prototype.toHexString=function(e){return e.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},ku.prototype.hexToBytes=function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(String.fromCharCode(parseInt(e.substr(r,2),16)));return t.join("")},ku.prototype.processOwnerPassword=function(e,t){return Tw(Ew(t).substr(0,5),e)},ku.prototype.encryptor=function(e,t){var r=Ew(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(n){return Tw(r,n)}},bv.prototype.equals=function(e){var t,r="id,objectNumber,equals";if(!e||mn(e)!==mn(this))return!1;var n=0;for(t in this)if(!(r.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t)||this[t]!==e[t])return!1;n++}for(t in e)e.hasOwnProperty(t)&&r.indexOf(t)<0&&n--;return n===0},br.API={events:[]},br.version="3.0.1";var fa=br.API,xS=1,cu=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Cu=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Lr=function(e){return e.toFixed(2)},zl=function(e){return e.toFixed(5)};fa.__acroform__={};var to=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},WE=function(e){return e*xS},ys=function(e){var t=new E6,r=Xt.internal.getHeight(e)||0,n=Xt.internal.getWidth(e)||0;return t.BBox=[0,0,Number(Lr(n)),Number(Lr(r))],t},Ule=fa.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|=1<<t},zle=fa.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&=~(1<<t)},Wle=fa.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return(e&1<<t)==0?0:1},_a=fa.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Wle(e,t-1)},wa=fa.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Ule(e,t-1)},ja=fa.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return zle(e,t-1)},Hle=fa.__acroform__.calculateCoordinates=function(e,t){var r=t.internal.getHorizontalCoordinate,n=t.internal.getVerticalCoordinate,a=e[0],o=e[1],s=e[2],l=e[3],c={};return c.lowerLeft_X=r(a)||0,c.lowerLeft_Y=n(o+l)||0,c.upperRight_X=r(a+s)||0,c.upperRight_Y=n(o)||0,[Number(Lr(c.lowerLeft_X)),Number(Lr(c.lowerLeft_Y)),Number(Lr(c.upperRight_X)),Number(Lr(c.upperRight_Y))]},Vle=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],r=e._V||e.DV,n=Iw(e,r),a=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+a+" "+Lr(n.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(n.text),t.push("ET"),t.push("Q"),t.push("EMC");var o=ys(e);return o.scope=e.scope,o.stream=t.join(`
`),o}},Iw=function(e,t){var r=e.fontSize===0?e.maxFontSize:e.fontSize,n={text:"",fontSize:""},a=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");a=e.multiline?a.map(function(O){return O.split(`
`)}):a.map(function(O){return[O]});var o=r,s=Xt.internal.getHeight(e)||0;s=s<0?-s:s;var l=Xt.internal.getWidth(e)||0;l=l<0?-l:l;var c=function(O,M,L){if(O+1<a.length){var q=M+" "+a[O+1][0];return Mm(q,e,L).width<=l-4}return!1};o++;e:for(;o>0;){t="",o--;var u,d,f=Mm("3",e,o).height,h=e.multiline?s-o:(s-f)/2,p=h+=2,v=0,m=0,y=0;if(o<=0){t=`(...) Tj
`,t+="% Width of Text: "+Mm(t,e,o=12).width+", FieldWidth:"+l+`
`;break}for(var b="",_=0,w=0;w<a.length;w++)if(a.hasOwnProperty(w)){var A=!1;if(a[w].length!==1&&y!==a[w].length-1){if((f+2)*(_+2)+2>s)continue e;b+=a[w][y],A=!0,m=w,w--}else{b=(b+=a[w][y]+" ").substr(b.length-1)==" "?b.substr(0,b.length-1):b;var P=parseInt(w),E=c(P,b,o),T=w>=a.length-1;if(E&&!T){b+=" ",y=0;continue}if(E||T){if(T)m=P;else if(e.multiline&&(f+2)*(_+2)+2>s)continue e}else{if(!e.multiline||(f+2)*(_+2)+2>s)continue e;m=P}}for(var S="",I=v;I<=m;I++){var U=a[I];if(e.multiline){if(I===m){S+=U[y]+" ",y=(y+1)%U.length;continue}if(I===v){S+=U[U.length-1]+" ";continue}}S+=U[0]+" "}switch(S=S.substr(S.length-1)==" "?S.substr(0,S.length-1):S,d=Mm(S,e,o).width,e.textAlign){case"right":u=l-d-2;break;case"center":u=(l-d)/2;break;case"left":default:u=2}t+=Lr(u)+" "+Lr(p)+` Td
`,t+="("+cu(S)+`) Tj
`,t+=-Lr(u)+` 0 Td
`,p=-(o+2),d=0,v=A?m:m+1,_++,b=""}break}return n.text=t,n.fontSize=o,n},Mm=function(e,t,r){var n=t.scope.internal.getFont(t.fontName,t.fontStyle),a=t.scope.getStringUnitWidth(e,{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r);return{height:t.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r)*1.5,width:a}},Gle={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Yle=function(e,t){var r={type:"reference",object:e};t.internal.getPageInfo(e.page).pageContext.annotations.find(function(n){return n.type===r.type&&n.object===r.object})===void 0&&t.internal.getPageInfo(e.page).pageContext.annotations.push(r)},Kle=function(e,t){for(var r in e)if(e.hasOwnProperty(r)){var n=r,a=e[r];t.internal.newObjectDeferredBegin(a.objId,!0),mn(a)==="object"&&typeof a.putStream=="function"&&a.putStream(),delete e[n]}},Qle=function(e,t){if(t.scope=e,e.internal!==void 0&&(e.internal.acroformPlugin===void 0||e.internal.acroformPlugin.isInitialized===!1)){if(us.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify(Gle)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");xS=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new T6,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",function(){(function(r){r.internal.events.unsubscribe(r.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete r.internal.acroformPlugin.acroFormDictionaryRoot._eventID,r.internal.acroformPlugin.printedOut=!0})(e)}),e.internal.events.subscribe("buildDocument",function(){(function(r){r.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=r.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var a in n)if(n.hasOwnProperty(a)){var o=n[a];o.objId=void 0,o.hasAnnotation&&Yle(o,r)}})(e)}),e.internal.events.subscribe("putCatalog",function(){(function(r){if(r.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");r.internal.write("/AcroForm "+r.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(e)}),e.internal.events.subscribe("postPutPages",function(r){(function(n,a){var o=!n;for(var s in n||(a.internal.newObjectDeferredBegin(a.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),a.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||a.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(s)){var l=n[s],c=[],u=l.Rect;if(l.Rect&&(l.Rect=Hle(l.Rect,a)),a.internal.newObjectDeferredBegin(l.objId,!0),l.DA=Xt.createDefaultAppearanceStream(l),mn(l)==="object"&&typeof l.getKeyValueListForStream=="function"&&(c=l.getKeyValueListForStream()),l.Rect=u,l.hasAppearanceStream&&!l.appearanceStreamContent){var d=Vle(l);c.push({key:"AP",value:"<</N "+d+">>"}),a.internal.acroformPlugin.xForms.push(d)}if(l.appearanceStreamContent){var f="";for(var h in l.appearanceStreamContent)if(l.appearanceStreamContent.hasOwnProperty(h)){var p=l.appearanceStreamContent[h];if(f+="/"+h+" ",f+="<<",Object.keys(p).length>=1||Array.isArray(p)){for(var s in p)if(p.hasOwnProperty(s)){var v=p[s];typeof v=="function"&&(v=v.call(a,l)),f+="/"+s+" "+v+" ",a.internal.acroformPlugin.xForms.indexOf(v)>=0||a.internal.acroformPlugin.xForms.push(v)}}else typeof(v=p)=="function"&&(v=v.call(a,l)),f+="/"+s+" "+v,a.internal.acroformPlugin.xForms.indexOf(v)>=0||a.internal.acroformPlugin.xForms.push(v);f+=">>"}c.push({key:"AP",value:`<<
`+f+">>"})}a.internal.putStream({additionalKeyValues:c,objectId:l.objId}),a.internal.out("endobj")}o&&Kle(a.internal.acroformPlugin.xForms,a)})(r,e)}),e.internal.acroformPlugin.isInitialized=!0}},k6=fa.__acroform__.arrayToPdfArray=function(e,t,r){var n=function(s){return s};if(Array.isArray(e)){for(var a="[",o=0;o<e.length;o++)switch(o!==0&&(a+=" "),mn(e[o])){case"boolean":case"number":case"object":a+=e[o].toString();break;case"string":e[o].substr(0,1)!=="/"?(t!==void 0&&r&&(n=r.internal.getEncryptor(t)),a+="("+cu(n(e[o].toString()))+")"):a+=e[o].toString()}return a+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},C2=function(e,t,r){var n=function(a){return a};return t!==void 0&&r&&(n=r.internal.getEncryptor(t)),(e=e||"").toString(),e="("+cu(n(e))+")"},js=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};js.prototype.toString=function(){return this.objId+" 0 R"},js.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},js.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter(function(o){return o!="content"&&o!="appearanceStreamContent"&&o!="scope"&&o!="objId"&&o.substring(0,1)!="_"});for(var r in t)if(Object.getOwnPropertyDescriptor(this,t[r]).configurable===!1){var n=t[r],a=this[n];a&&(Array.isArray(a)?e.push({key:n,value:k6(a,this.objId,this.scope)}):a instanceof js?(a.scope=this.scope,e.push({key:n,value:a.objId+" 0 R"})):typeof a!="function"&&e.push({key:n,value:a}))}return e};var E6=function(){js.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(r){e=r.trim()},get:function(){return e||null}})};to(E6,js);var T6=function(){js.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var r=function(n){return n};return this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),"("+cu(r(e))+")"}},set:function(r){e=r}})};to(T6,js);var us=function e(){js.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(b){if(isNaN(b))throw new Error('Invalid value "'+b+'" for attribute F supplied.');t=b}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!_a(t,3)},set:function(b){b?this.F=wa(t,3):this.F=ja(t,3)}});var r=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return r},set:function(b){if(isNaN(b))throw new Error('Invalid value "'+b+'" for attribute Ff supplied.');r=b}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(b){n=b!==void 0?b:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(b){n[0]=b}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(b){n[1]=b}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(b){n[2]=b}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(b){n[3]=b}});var a="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return a},set:function(b){switch(b){case"/Btn":case"/Tx":case"/Ch":case"/Sig":a=b;break;default:throw new Error('Invalid value "'+b+'" for attribute FT supplied.')}}});var o=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!o||o.length<1){if(this instanceof _v)return;o="FieldObject"+e.FieldNum++}var b=function(_){return _};return this.scope&&(b=this.scope.internal.getEncryptor(this.objId)),"("+cu(b(o))+")"},set:function(b){o=b.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return o},set:function(b){o=b}});var s="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return s},set:function(b){s=b}});var l="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return l},set:function(b){l=b}});var c=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return c},set:function(b){c=b}});var u=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return u===void 0?50/xS:u},set:function(b){u=b}});var d="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return d},set:function(b){d=b}});var f="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!f||this instanceof _v||this instanceof Wc))return C2(f,this.objId,this.scope)},set:function(b){b=b.toString(),f=b}});var h=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(h)return this instanceof Ja?h:C2(h,this.objId,this.scope)},set:function(b){b=b.toString(),h=this instanceof Ja?b:b.substr(0,1)==="("?Cu(b.substr(1,b.length-2)):Cu(b)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ja?Cu(h.substr(1,h.length-1)):h},set:function(b){b=b.toString(),h=this instanceof Ja?"/"+b:b}});var p=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(p)return p},set:function(b){this.V=b}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(p)return this instanceof Ja?p:C2(p,this.objId,this.scope)},set:function(b){b=b.toString(),p=this instanceof Ja?b:b.substr(0,1)==="("?Cu(b.substr(1,b.length-2)):Cu(b)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ja?Cu(p.substr(1,p.length-1)):p},set:function(b){b=b.toString(),p=this instanceof Ja?"/"+b:b}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var v,m=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return m},set:function(b){b=!!b,m=b}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(v)return v},set:function(b){v=b}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,1)},set:function(b){b?this.Ff=wa(this.Ff,1):this.Ff=ja(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,2)},set:function(b){b?this.Ff=wa(this.Ff,2):this.Ff=ja(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,3)},set:function(b){b?this.Ff=wa(this.Ff,3):this.Ff=ja(this.Ff,3)}});var y=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(y!==null)return y},set:function(b){if([0,1,2].indexOf(b)===-1)throw new Error('Invalid value "'+b+'" for attribute Q supplied.');y=b}}),Object.defineProperty(this,"textAlign",{get:function(){var b;switch(y){case 0:default:b="left";break;case 1:b="center";break;case 2:b="right"}return b},configurable:!0,enumerable:!0,set:function(b){switch(b){case"right":case 2:y=2;break;case"center":case 1:y=1;break;case"left":case 0:default:y=0}}})};to(us,js);var Ku=function(){us.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(r){e=r}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return k6(t,this.objId,this.scope)},set:function(r){var n,a;a=[],typeof(n=r)=="string"&&(a=function(o,s,l){l||(l=1);for(var c,u=[];c=s.exec(o);)u.push(c[l]);return u}(n,/\((.*?)\)/g)),t=a}}),this.getOptions=function(){return t},this.setOptions=function(r){t=r,this.sort&&t.sort()},this.addOption=function(r){r=(r=r||"").toString(),t.push(r),this.sort&&t.sort()},this.removeOption=function(r,n){for(n=n||!1,r=(r=r||"").toString();t.indexOf(r)!==-1&&(t.splice(t.indexOf(r),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,18)},set:function(r){r?this.Ff=wa(this.Ff,18):this.Ff=ja(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,19)},set:function(r){this.combo===!0&&(r?this.Ff=wa(this.Ff,19):this.Ff=ja(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,20)},set:function(r){r?(this.Ff=wa(this.Ff,20),t.sort()):this.Ff=ja(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,22)},set:function(r){r?this.Ff=wa(this.Ff,22):this.Ff=ja(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,23)},set:function(r){r?this.Ff=wa(this.Ff,23):this.Ff=ja(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,27)},set:function(r){r?this.Ff=wa(this.Ff,27):this.Ff=ja(this.Ff,27)}}),this.hasAppearanceStream=!1};to(Ku,us);var Qu=function(){Ku.call(this),this.fontName="helvetica",this.combo=!1};to(Qu,Ku);var Xu=function(){Qu.call(this),this.combo=!0};to(Xu,Qu);var tg=function(){Xu.call(this),this.edit=!0};to(tg,Xu);var Ja=function(){us.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,15)},set:function(r){r?this.Ff=wa(this.Ff,15):this.Ff=ja(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,16)},set:function(r){r?this.Ff=wa(this.Ff,16):this.Ff=ja(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,17)},set:function(r){r?this.Ff=wa(this.Ff,17):this.Ff=ja(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,26)},set:function(r){r?this.Ff=wa(this.Ff,26):this.Ff=ja(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(o){return o};if(this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var n,a=[];for(n in a.push("<<"),t)a.push("/"+n+" ("+cu(r(t[n]))+")");return a.push(">>"),a.join(`
`)}},set:function(r){mn(r)==="object"&&(t=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(r){typeof r=="string"&&(t.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(r){e="/"+r}})};to(Ja,us);var rg=function(){Ja.call(this),this.pushButton=!0};to(rg,Ja);var Ju=function(){Ja.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t!==void 0?t:[]}})};to(Ju,Ja);var _v=function(){var e,t;us.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(a){e=a}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(a){t=a}});var r,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var a=function(l){return l};this.scope&&(a=this.scope.internal.getEncryptor(this.objId));var o,s=[];for(o in s.push("<<"),n)s.push("/"+o+" ("+cu(a(n[o]))+")");return s.push(">>"),s.join(`
`)},set:function(a){mn(a)==="object"&&(n=a)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(a){typeof a=="string"&&(n.CA=a)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(a){r=a}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(a){r="/"+a}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Xt.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};to(_v,us),Ju.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var r=this.Kids[t];r.appearanceStreamContent=e.createAppearanceStream(r.optionName),r.caption=e.getCA()}},Ju.prototype.createOption=function(e){var t=new _v;return t.Parent=this,t.optionName=e,this.Kids.push(t),Xle.call(this.scope,t),t};var ng=function(){Ja.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Xt.CheckBox.createAppearanceStream()};to(ng,Ja);var Wc=function(){us.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,13)},set:function(t){t?this.Ff=wa(this.Ff,13):this.Ff=ja(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,21)},set:function(t){t?this.Ff=wa(this.Ff,21):this.Ff=ja(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,23)},set:function(t){t?this.Ff=wa(this.Ff,23):this.Ff=ja(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,24)},set:function(t){t?this.Ff=wa(this.Ff,24):this.Ff=ja(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,25)},set:function(t){t?this.Ff=wa(this.Ff,25):this.Ff=ja(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,26)},set:function(t){t?this.Ff=wa(this.Ff,26):this.Ff=ja(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};to(Wc,us);var ag=function(){Wc.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!_a(this.Ff,14)},set:function(e){e?this.Ff=wa(this.Ff,14):this.Ff=ja(this.Ff,14)}}),this.password=!0};to(ag,Wc);var Xt={CheckBox:{createAppearanceStream:function(){return{N:{On:Xt.CheckBox.YesNormal},D:{On:Xt.CheckBox.YesPushDown,Off:Xt.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=[],n=e.scope.internal.getFont(e.fontName,e.fontStyle).id,a=e.scope.__private__.encodeColorString(e.color),o=Iw(e,e.caption);return r.push("0.749023 g"),r.push("0 0 "+Lr(Xt.internal.getWidth(e))+" "+Lr(Xt.internal.getHeight(e))+" re"),r.push("f"),r.push("BMC"),r.push("q"),r.push("0 0 1 rg"),r.push("/"+n+" "+Lr(o.fontSize)+" Tf "+a),r.push("BT"),r.push(o.text),r.push("ET"),r.push("Q"),r.push("EMC"),t.stream=r.join(`
`),t},YesNormal:function(e){var t=ys(e);t.scope=e.scope;var r=e.scope.internal.getFont(e.fontName,e.fontStyle).id,n=e.scope.__private__.encodeColorString(e.color),a=[],o=Xt.internal.getHeight(e),s=Xt.internal.getWidth(e),l=Iw(e,e.caption);return a.push("1 g"),a.push("0 0 "+Lr(s)+" "+Lr(o)+" re"),a.push("f"),a.push("q"),a.push("0 0 1 rg"),a.push("0 0 "+Lr(s-1)+" "+Lr(o-1)+" re"),a.push("W"),a.push("n"),a.push("0 g"),a.push("BT"),a.push("/"+r+" "+Lr(l.fontSize)+" Tf "+n),a.push(l.text),a.push("ET"),a.push("Q"),t.stream=a.join(`
`),t},OffPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+Lr(Xt.internal.getWidth(e))+" "+Lr(Xt.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:Xt.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=Xt.RadioButton.Circle.YesNormal,t.D[e]=Xt.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=ys(e);t.scope=e.scope;var r=[],n=Xt.internal.getWidth(e)<=Xt.internal.getHeight(e)?Xt.internal.getWidth(e)/4:Xt.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var a=Xt.internal.Bezier_C,o=Number((n*a).toFixed(5));return r.push("q"),r.push("1 0 0 1 "+zl(Xt.internal.getWidth(e)/2)+" "+zl(Xt.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),r.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),r.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),r.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=[],n=Xt.internal.getWidth(e)<=Xt.internal.getHeight(e)?Xt.internal.getWidth(e)/4:Xt.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var a=Number((2*n).toFixed(5)),o=Number((a*Xt.internal.Bezier_C).toFixed(5)),s=Number((n*Xt.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+zl(Xt.internal.getWidth(e)/2)+" "+zl(Xt.internal.getHeight(e)/2)+" cm"),r.push(a+" 0 m"),r.push(a+" "+o+" "+o+" "+a+" 0 "+a+" c"),r.push("-"+o+" "+a+" -"+a+" "+o+" -"+a+" 0 c"),r.push("-"+a+" -"+o+" -"+o+" -"+a+" 0 -"+a+" c"),r.push(o+" -"+a+" "+a+" -"+o+" "+a+" 0 c"),r.push("f"),r.push("Q"),r.push("0 g"),r.push("q"),r.push("1 0 0 1 "+zl(Xt.internal.getWidth(e)/2)+" "+zl(Xt.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),r.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),r.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),r.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},OffPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=[],n=Xt.internal.getWidth(e)<=Xt.internal.getHeight(e)?Xt.internal.getWidth(e)/4:Xt.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var a=Number((2*n).toFixed(5)),o=Number((a*Xt.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+zl(Xt.internal.getWidth(e)/2)+" "+zl(Xt.internal.getHeight(e)/2)+" cm"),r.push(a+" 0 m"),r.push(a+" "+o+" "+o+" "+a+" 0 "+a+" c"),r.push("-"+o+" "+a+" -"+a+" "+o+" -"+a+" 0 c"),r.push("-"+a+" -"+o+" -"+o+" -"+a+" 0 -"+a+" c"),r.push(o+" -"+a+" "+a+" -"+o+" "+a+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:Xt.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=Xt.RadioButton.Cross.YesNormal,t.D[e]=Xt.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=ys(e);t.scope=e.scope;var r=[],n=Xt.internal.calculateCross(e);return r.push("q"),r.push("1 1 "+Lr(Xt.internal.getWidth(e)-2)+" "+Lr(Xt.internal.getHeight(e)-2)+" re"),r.push("W"),r.push("n"),r.push(Lr(n.x1.x)+" "+Lr(n.x1.y)+" m"),r.push(Lr(n.x2.x)+" "+Lr(n.x2.y)+" l"),r.push(Lr(n.x4.x)+" "+Lr(n.x4.y)+" m"),r.push(Lr(n.x3.x)+" "+Lr(n.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=Xt.internal.calculateCross(e),n=[];return n.push("0.749023 g"),n.push("0 0 "+Lr(Xt.internal.getWidth(e))+" "+Lr(Xt.internal.getHeight(e))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+Lr(Xt.internal.getWidth(e)-2)+" "+Lr(Xt.internal.getHeight(e)-2)+" re"),n.push("W"),n.push("n"),n.push(Lr(r.x1.x)+" "+Lr(r.x1.y)+" m"),n.push(Lr(r.x2.x)+" "+Lr(r.x2.y)+" l"),n.push(Lr(r.x4.x)+" "+Lr(r.x4.y)+" m"),n.push(Lr(r.x3.x)+" "+Lr(r.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join(`
`),t},OffPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+Lr(Xt.internal.getWidth(e))+" "+Lr(Xt.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,r=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+r}};Xt.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=Xt.internal.getWidth(e),r=Xt.internal.getHeight(e),n=Math.min(t,r);return{x1:{x:(t-n)/2,y:(r-n)/2+n},x2:{x:(t-n)/2+n,y:(r-n)/2},x3:{x:(t-n)/2,y:(r-n)/2},x4:{x:(t-n)/2+n,y:(r-n)/2+n}}}},Xt.internal.getWidth=function(e){var t=0;return mn(e)==="object"&&(t=WE(e.Rect[2])),t},Xt.internal.getHeight=function(e){var t=0;return mn(e)==="object"&&(t=WE(e.Rect[3])),t};var Xle=fa.addField=function(e){if(Qle(this,e),!(e instanceof us))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};fa.AcroFormChoiceField=Ku,fa.AcroFormListBox=Qu,fa.AcroFormComboBox=Xu,fa.AcroFormEditBox=tg,fa.AcroFormButton=Ja,fa.AcroFormPushButton=rg,fa.AcroFormRadioButton=Ju,fa.AcroFormCheckBox=ng,fa.AcroFormTextField=Wc,fa.AcroFormPasswordField=ag,fa.AcroFormAppearance=Xt,fa.AcroForm={ChoiceField:Ku,ListBox:Qu,ComboBox:Xu,EditBox:tg,Button:Ja,PushButton:rg,RadioButton:Ju,CheckBox:ng,TextField:Wc,PasswordField:ag,Appearance:Xt},br.AcroForm={ChoiceField:Ku,ListBox:Qu,ComboBox:Xu,EditBox:tg,Button:Ja,PushButton:rg,RadioButton:Ju,CheckBox:ng,TextField:Wc,PasswordField:ag,Appearance:Xt};br.AcroForm;function I6(e){return e.reduce(function(t,r,n){return t[r]=n,t},{})}(function(e){e.__addimage__={};var t="UNKNOWN",r={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},n=e.__addimage__.getImageFileTypeByImageData=function(O,M){var L,q,z,K,J,R=t;if((M=M||t)==="RGBA"||O.data!==void 0&&O.data instanceof Uint8ClampedArray&&"height"in O&&"width"in O)return"RGBA";if(E(O))for(J in r)for(z=r[J],L=0;L<z.length;L+=1){for(K=!0,q=0;q<z[L].length;q+=1)if(z[L][q]!==void 0&&z[L][q]!==O[q]){K=!1;break}if(K===!0){R=J;break}}else for(J in r)for(z=r[J],L=0;L<z.length;L+=1){for(K=!0,q=0;q<z[L].length;q+=1)if(z[L][q]!==void 0&&z[L][q]!==O.charCodeAt(q)){K=!1;break}if(K===!0){R=J;break}}return R===t&&M!==t&&(R=M),R},a=function O(M){for(var L=this.internal.write,q=this.internal.putStream,z=(0,this.internal.getFilters)();z.indexOf("FlateEncode")!==-1;)z.splice(z.indexOf("FlateEncode"),1);M.objectId=this.internal.newObject();var K=[];if(K.push({key:"Type",value:"/XObject"}),K.push({key:"Subtype",value:"/Image"}),K.push({key:"Width",value:M.width}),K.push({key:"Height",value:M.height}),M.colorSpace===y.INDEXED?K.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(M.palette.length/3-1)+" "+("sMask"in M&&M.sMask!==void 0?M.objectId+2:M.objectId+1)+" 0 R]"}):(K.push({key:"ColorSpace",value:"/"+M.colorSpace}),M.colorSpace===y.DEVICE_CMYK&&K.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),K.push({key:"BitsPerComponent",value:M.bitsPerComponent}),"decodeParameters"in M&&M.decodeParameters!==void 0&&K.push({key:"DecodeParms",value:"<<"+M.decodeParameters+">>"}),"transparency"in M&&Array.isArray(M.transparency)){for(var J="",R=0,k=M.transparency.length;R<k;R++)J+=M.transparency[R]+" "+M.transparency[R]+" ";K.push({key:"Mask",value:"["+J+"]"})}M.sMask!==void 0&&K.push({key:"SMask",value:M.objectId+1+" 0 R"});var $=M.filter!==void 0?["/"+M.filter]:void 0;if(q({data:M.data,additionalKeyValues:K,alreadyAppliedFilters:$,objectId:M.objectId}),L("endobj"),"sMask"in M&&M.sMask!==void 0){var X="/Predictor "+M.predictor+" /Colors 1 /BitsPerComponent "+M.bitsPerComponent+" /Columns "+M.width,C={width:M.width,height:M.height,colorSpace:"DeviceGray",bitsPerComponent:M.bitsPerComponent,decodeParameters:X,data:M.sMask};"filter"in M&&(C.filter=M.filter),O.call(this,C)}if(M.colorSpace===y.INDEXED){var N=this.internal.newObject();q({data:S(new Uint8Array(M.palette)),objectId:N}),L("endobj")}},o=function(){var O=this.internal.collections.addImage_images;for(var M in O)a.call(this,O[M])},s=function(){var O,M=this.internal.collections.addImage_images,L=this.internal.write;for(var q in M)L("/I"+(O=M[q]).index,O.objectId,"0","R")},l=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",s))},c=function(){var O=this.internal.collections.addImage_images;return l.call(this),O},u=function(){return Object.keys(this.internal.collections.addImage_images).length},d=function(O){return typeof e["process"+O.toUpperCase()]=="function"},f=function(O){return mn(O)==="object"&&O.nodeType===1},h=function(O,M){if(O.nodeName==="IMG"&&O.hasAttribute("src")){var L=""+O.getAttribute("src");if(L.indexOf("data:image/")===0)return Rh(unescape(L).split("base64,").pop());var q=e.loadFile(L,!0);if(q!==void 0)return q}if(O.nodeName==="CANVAS"){if(O.width===0||O.height===0)throw new Error("Given canvas must have data. Canvas width: "+O.width+", height: "+O.height);var z;switch(M){case"PNG":z="image/png";break;case"WEBP":z="image/webp";break;case"JPEG":case"JPG":default:z="image/jpeg"}return Rh(O.toDataURL(z,1).split("base64,").pop())}},p=function(O){var M=this.internal.collections.addImage_images;if(M){for(var L in M)if(O===M[L].alias)return M[L]}},v=function(O,M,L){return O||M||(O=-96,M=-96),O<0&&(O=-1*L.width*72/O/this.internal.scaleFactor),M<0&&(M=-1*L.height*72/M/this.internal.scaleFactor),O===0&&(O=M*L.width/L.height),M===0&&(M=O*L.height/L.width),[O,M]},m=function(O,M,L,q,z,K){var J=v.call(this,L,q,z),R=this.internal.getCoordinateString,k=this.internal.getVerticalCoordinateString,$=c.call(this);if(L=J[0],q=J[1],$[z.index]=z,K){K*=Math.PI/180;var X=Math.cos(K),C=Math.sin(K),N=function(W){return W.toFixed(4)},H=[N(X),N(C),N(-1*C),N(X),0,0,"cm"]}this.internal.write("q"),K?(this.internal.write([1,"0","0",1,R(O),k(M+q),"cm"].join(" ")),this.internal.write(H.join(" ")),this.internal.write([R(L),"0","0",R(q),"0","0","cm"].join(" "))):this.internal.write([R(L),"0","0",R(q),R(O),k(M+q),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+z.index+" Do"),this.internal.write("Q")},y=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var b=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},_=e.__addimage__.sHashCode=function(O){var M,L,q=0;if(typeof O=="string")for(L=O.length,M=0;M<L;M++)q=(q<<5)-q+O.charCodeAt(M),q|=0;else if(E(O))for(L=O.byteLength/2,M=0;M<L;M++)q=(q<<5)-q+O[M],q|=0;return q},w=e.__addimage__.validateStringAsBase64=function(O){(O=O||"").toString().trim();var M=!0;return O.length===0&&(M=!1),O.length%4!=0&&(M=!1),/^[A-Za-z0-9+/]+$/.test(O.substr(0,O.length-2))===!1&&(M=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(O.substr(-2))===!1&&(M=!1),M},A=e.__addimage__.extractImageFromDataUrl=function(O){if(O==null||!(O=O.trim()).startsWith("data:"))return null;var M=O.indexOf(",");return M<0?null:O.substring(0,M).trim().endsWith("base64")?O.substring(M+1):null},P=e.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};e.__addimage__.isArrayBuffer=function(O){return P()&&O instanceof ArrayBuffer};var E=e.__addimage__.isArrayBufferView=function(O){return P()&&typeof Uint32Array<"u"&&(O instanceof Int8Array||O instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&O instanceof Uint8ClampedArray||O instanceof Int16Array||O instanceof Uint16Array||O instanceof Int32Array||O instanceof Uint32Array||O instanceof Float32Array||O instanceof Float64Array)},T=e.__addimage__.binaryStringToUint8Array=function(O){for(var M=O.length,L=new Uint8Array(M),q=0;q<M;q++)L[q]=O.charCodeAt(q);return L},S=e.__addimage__.arrayBufferToBinaryString=function(O){for(var M="",L=E(O)?O:new Uint8Array(O),q=0;q<L.length;q+=8192)M+=String.fromCharCode.apply(null,L.subarray(q,q+8192));return M};e.addImage=function(){var O,M,L,q,z,K,J,R,k;if(typeof arguments[1]=="number"?(M=t,L=arguments[1],q=arguments[2],z=arguments[3],K=arguments[4],J=arguments[5],R=arguments[6],k=arguments[7]):(M=arguments[1],L=arguments[2],q=arguments[3],z=arguments[4],K=arguments[5],J=arguments[6],R=arguments[7],k=arguments[8]),mn(O=arguments[0])==="object"&&!f(O)&&"imageData"in O){var $=O;O=$.imageData,M=$.format||M||t,L=$.x||L||0,q=$.y||q||0,z=$.w||$.width||z,K=$.h||$.height||K,J=$.alias||J,R=$.compression||R,k=$.rotation||$.angle||k}var X=this.internal.getFilters();if(R===void 0&&X.indexOf("FlateEncode")!==-1&&(R="SLOW"),isNaN(L)||isNaN(q))throw new Error("Invalid coordinates passed to jsPDF.addImage");l.call(this);var C=I.call(this,O,M,J,R);return m.call(this,L,q,z,K,C,k),this};var I=function(O,M,L,q){var z,K,J;if(typeof O=="string"&&n(O)===t){O=unescape(O);var R=U(O,!1);(R!==""||(R=e.loadFile(O,!0))!==void 0)&&(O=R)}if(f(O)&&(O=h(O,M)),M=n(O,M),!d(M))throw new Error("addImage does not support files of type '"+M+"', please ensure that a plugin for '"+M+"' support is added.");if(((J=L)==null||J.length===0)&&(L=function(k){return typeof k=="string"||E(k)?_(k):E(k.data)?_(k.data):null}(O)),(z=p.call(this,L))||(P()&&(O instanceof Uint8Array||M==="RGBA"||(K=O,O=T(O))),z=this["process"+M.toUpperCase()](O,u.call(this),L,function(k){return k&&typeof k=="string"&&(k=k.toUpperCase()),k in e.image_compression?k:b.NONE}(q),K)),!z)throw new Error("An unknown error occurred whilst processing the image.");return z},U=e.__addimage__.convertBase64ToBinaryString=function(O,M){M=typeof M!="boolean"||M;var L,q="";if(typeof O=="string"){var z;L=(z=A(O))!==null&&z!==void 0?z:O;try{q=Rh(L)}catch(K){if(M)throw w(L)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+K.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return q};e.getImageProperties=function(O){var M,L,q="";if(f(O)&&(O=h(O)),typeof O=="string"&&n(O)===t&&((q=U(O,!1))===""&&(q=e.loadFile(O)||""),O=q),L=n(O),!d(L))throw new Error("addImage does not support files of type '"+L+"', please ensure that a plugin for '"+L+"' support is added.");if(!P()||O instanceof Uint8Array||(O=T(O)),!(M=this["process"+L.toUpperCase()](O)))throw new Error("An unknown error occurred whilst processing the image");return M.fileType=L,M}})(br.API),function(e){var t=function(r){if(r!==void 0&&r!="")return!0};br.API.events.push(["addPage",function(r){this.internal.getPageInfo(r.pageNumber).pageContext.annotations=[]}]),e.events.push(["putPage",function(r){for(var n,a,o,s=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,c=this.internal.getPageInfoByObjId(r.objId),u=r.pageContext.annotations,d=!1,f=0;f<u.length&&!d;f++)switch((n=u[f]).type){case"link":(t(n.options.url)||t(n.options.pageNumber))&&(d=!0);break;case"reference":case"text":case"freetext":d=!0}if(d!=0){this.internal.write("/Annots [");for(var h=0;h<u.length;h++){n=u[h];var p=this.internal.pdfEscape,v=this.internal.getEncryptor(r.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var m=this.internal.newAdditionalObject(),y=this.internal.newAdditionalObject(),b=this.internal.getEncryptor(m.objId),_=n.title||"Note";o="<</Type /Annot /Subtype /Text "+(a="/Rect ["+s(n.bounds.x)+" "+l(n.bounds.y+n.bounds.h)+" "+s(n.bounds.x+n.bounds.w)+" "+l(n.bounds.y)+"] ")+"/Contents ("+p(b(n.contents))+")",o+=" /Popup "+y.objId+" 0 R",o+=" /P "+c.objId+" 0 R",o+=" /T ("+p(b(_))+") >>",m.content=o;var w=m.objId+" 0 R";o="<</Type /Annot /Subtype /Popup "+(a="/Rect ["+s(n.bounds.x+30)+" "+l(n.bounds.y+n.bounds.h)+" "+s(n.bounds.x+n.bounds.w+30)+" "+l(n.bounds.y)+"] ")+" /Parent "+w,n.open&&(o+=" /Open true"),o+=" >>",y.content=o,this.internal.write(m.objId,"0 R",y.objId,"0 R");break;case"freetext":a="/Rect ["+s(n.bounds.x)+" "+l(n.bounds.y)+" "+s(n.bounds.x+n.bounds.w)+" "+l(n.bounds.y+n.bounds.h)+"] ";var A=n.color||"#000000";o="<</Type /Annot /Subtype /FreeText "+a+"/Contents ("+p(v(n.contents))+")",o+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+A+")",o+=" /Border [0 0 0]",o+=" >>",this.internal.write(o);break;case"link":if(n.options.name){var P=this.annotations._nameMap[n.options.name];n.options.pageNumber=P.page,n.options.top=P.y}else n.options.top||(n.options.top=0);if(a="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",o="",n.options.url)o="<</Type /Annot /Subtype /Link "+a+"/Border [0 0 0] /A <</S /URI /URI ("+p(v(n.options.url))+") >>";else if(n.options.pageNumber)switch(o="<</Type /Annot /Subtype /Link "+a+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":o+=" /Fit]";break;case"FitH":o+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,o+=" /FitV "+n.options.left+"]";break;case"XYZ":default:var E=l(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),o+=" /XYZ "+n.options.left+" "+E+" "+n.options.zoom+"]"}o!=""&&(o+=" >>",this.internal.write(o))}}this.internal.write("]")}}]),e.createAnnotation=function(r){var n=this.internal.getCurrentPageInfo();switch(r.type){case"link":this.link(r.bounds.x,r.bounds.y,r.bounds.w,r.bounds.h,r);break;case"text":case"freetext":n.pageContext.annotations.push(r)}},e.link=function(r,n,a,o,s){var l=this.internal.getCurrentPageInfo(),c=this.internal.getCoordinateString,u=this.internal.getVerticalCoordinateString;l.pageContext.annotations.push({finalBounds:{x:c(r),y:u(n),w:c(r+a),h:u(n+o)},options:s,type:"link"})},e.textWithLink=function(r,n,a,o){var s,l,c=this.getTextWidth(r),u=this.internal.getLineHeight()/this.internal.scaleFactor;if(o.maxWidth!==void 0){l=o.maxWidth;var d=this.splitTextToSize(r,l).length;s=Math.ceil(u*d)}else l=c,s=u;return this.text(r,n,a,o),a+=.2*u,o.align==="center"&&(n-=c/2),o.align==="right"&&(n-=c),this.link(n,a-u,l,s,o),c},e.getTextWidth=function(r){var n=this.internal.getFontSize();return this.getStringUnitWidth(r)*n/this.internal.scaleFactor}}(br.API),function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},r={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},a=[1570,1571,1573,1575];e.__arabicParser__={};var o=e.__arabicParser__.isInArabicSubstitutionA=function(m){return t[m.charCodeAt(0)]!==void 0},s=e.__arabicParser__.isArabicLetter=function(m){return typeof m=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(m)},l=e.__arabicParser__.isArabicEndLetter=function(m){return s(m)&&o(m)&&t[m.charCodeAt(0)].length<=2},c=e.__arabicParser__.isArabicAlfLetter=function(m){return s(m)&&a.indexOf(m.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(m){return s(m)&&o(m)&&t[m.charCodeAt(0)].length>=1};var u=e.__arabicParser__.arabicLetterHasFinalForm=function(m){return s(m)&&o(m)&&t[m.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(m){return s(m)&&o(m)&&t[m.charCodeAt(0)].length>=3};var d=e.__arabicParser__.arabicLetterHasMedialForm=function(m){return s(m)&&o(m)&&t[m.charCodeAt(0)].length==4},f=e.__arabicParser__.resolveLigatures=function(m){var y=0,b=r,_="",w=0;for(y=0;y<m.length;y+=1)b[m.charCodeAt(y)]!==void 0?(w++,typeof(b=b[m.charCodeAt(y)])=="number"&&(_+=String.fromCharCode(b),b=r,w=0),y===m.length-1&&(b=r,_+=m.charAt(y-(w-1)),y-=w-1,w=0)):(b=r,_+=m.charAt(y-w),y-=w,w=0);return _};e.__arabicParser__.isArabicDiacritic=function(m){return m!==void 0&&n[m.charCodeAt(0)]!==void 0};var h=e.__arabicParser__.getCorrectForm=function(m,y,b){return s(m)?o(m)===!1?-1:!u(m)||!s(y)&&!s(b)||!s(b)&&l(y)||l(m)&&!s(y)||l(m)&&c(y)||l(m)&&l(y)?0:d(m)&&s(y)&&!l(y)&&s(b)&&u(b)?3:l(m)||!s(b)?1:2:-1},p=function(m){var y=0,b=0,_=0,w="",A="",P="",E=(m=m||"").split("\\s+"),T=[];for(y=0;y<E.length;y+=1){for(T.push(""),b=0;b<E[y].length;b+=1)w=E[y][b],A=E[y][b-1],P=E[y][b+1],s(w)?(_=h(w,A,P),T[y]+=_!==-1?String.fromCharCode(t[w.charCodeAt(0)][_]):w):T[y]+=w;T[y]=f(T[y])}return T.join(" ")},v=e.__arabicParser__.processArabic=e.processArabic=function(){var m,y=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,b=[];if(Array.isArray(y)){var _=0;for(b=[],_=0;_<y.length;_+=1)Array.isArray(y[_])?b.push([p(y[_][0]),y[_][1],y[_][2]]):b.push([p(y[_])]);m=b}else m=p(y);return typeof arguments[0]=="string"?m:(arguments[0].text=m,arguments[0])};e.events.push(["preProcessText",v])}(br.API),br.API.autoPrint=function(e){var t;switch((e=e||{}).variant=e.variant||"non-conform",e.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})}return this},function(e){var t=function(){var r=void 0;Object.defineProperty(this,"pdf",{get:function(){return r},set:function(l){r=l}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(l){n=isNaN(l)||Number.isInteger(l)===!1||l<0?150:l,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var a=300;Object.defineProperty(this,"height",{get:function(){return a},set:function(l){a=isNaN(l)||Number.isInteger(l)===!1||l<0?300:l,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=a+1)}});var o=[];Object.defineProperty(this,"childNodes",{get:function(){return o},set:function(l){o=l}});var s={};Object.defineProperty(this,"style",{get:function(){return s},set:function(l){s=l}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(r,n){var a;if((r=r||"2d")!=="2d")return null;for(a in n)this.pdf.context2d.hasOwnProperty(a)&&(this.pdf.context2d[a]=n[a]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(br.API),function(e){var t={left:0,top:0,bottom:0,right:0},r=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),a.call(this))},a=function(){this.internal.__cell__.lastCell=new o,this.internal.__cell__.pages=1},o=function(){var c=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return c},set:function(m){c=m}});var u=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return u},set:function(m){u=m}});var d=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return d},set:function(m){d=m}});var f=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return f},set:function(m){f=m}});var h=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return h},set:function(m){h=m}});var p=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return p},set:function(m){p=m}});var v=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return v},set:function(m){v=m}}),this};o.prototype.clone=function(){return new o(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},o.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(c){return n.call(this),this.internal.__cell__.headerFunction=typeof c=="function"?c:void 0,this},e.getTextDimensions=function(c,u){n.call(this);var d=(u=u||{}).fontSize||this.getFontSize(),f=u.font||this.getFont(),h=u.scaleFactor||this.internal.scaleFactor,p=0,v=0,m=0,y=this;if(!Array.isArray(c)&&typeof c!="string"){if(typeof c!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");c=String(c)}var b=u.maxWidth;b>0?typeof c=="string"?c=this.splitTextToSize(c,b):Object.prototype.toString.call(c)==="[object Array]"&&(c=c.reduce(function(w,A){return w.concat(y.splitTextToSize(A,b))},[])):c=Array.isArray(c)?c:[c];for(var _=0;_<c.length;_++)p<(m=this.getStringUnitWidth(c[_],{font:f})*d)&&(p=m);return p!==0&&(v=c.length),{w:p/=h,h:Math.max((v*d*this.getLineHeightFactor()-d*(this.getLineHeightFactor()-1))/h,0)}},e.cellAddPage=function(){n.call(this),this.addPage();var c=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new o(c.left,c.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var s=e.cell=function(){var c;c=arguments[0]instanceof o?arguments[0]:new o(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var u=this.internal.__cell__.lastCell,d=this.internal.__cell__.padding,f=this.internal.__cell__.margins||t,h=this.internal.__cell__.tableHeaderRow,p=this.internal.__cell__.printHeaders;return u.lineNumber!==void 0&&(u.lineNumber===c.lineNumber?(c.x=(u.x||0)+(u.width||0),c.y=u.y||0):u.y+u.height+c.height+f.bottom>this.getPageHeight()?(this.cellAddPage(),c.y=f.top,p&&h&&(this.printHeaderRow(c.lineNumber,!0),c.y+=h[0].height)):c.y=u.y+u.height||c.y),c.text[0]!==void 0&&(this.rect(c.x,c.y,c.width,c.height,r===!0?"FD":void 0),c.align==="right"?this.text(c.text,c.x+c.width-d,c.y+d,{align:"right",baseline:"top"}):c.align==="center"?this.text(c.text,c.x+c.width/2,c.y+d,{align:"center",baseline:"top",maxWidth:c.width-d-d}):this.text(c.text,c.x+d,c.y+d,{align:"left",baseline:"top",maxWidth:c.width-d-d})),this.internal.__cell__.lastCell=c,this};e.table=function(c,u,d,f,h){if(n.call(this),!d)throw new Error("No data for PDF table.");var p,v,m,y,b=[],_=[],w=[],A={},P={},E=[],T=[],S=(h=h||{}).autoSize||!1,I=h.printHeaders!==!1,U=h.css&&h.css["font-size"]!==void 0?16*h.css["font-size"]:h.fontSize||12,O=h.margins||Object.assign({width:this.getPageWidth()},t),M=typeof h.padding=="number"?h.padding:3,L=h.headerBackgroundColor||"#c8c8c8",q=h.headerTextColor||"#000";if(a.call(this),this.internal.__cell__.printHeaders=I,this.internal.__cell__.margins=O,this.internal.__cell__.table_font_size=U,this.internal.__cell__.padding=M,this.internal.__cell__.headerBackgroundColor=L,this.internal.__cell__.headerTextColor=q,this.setFontSize(U),f==null)_=b=Object.keys(d[0]),w=b.map(function(){return"left"});else if(Array.isArray(f)&&mn(f[0])==="object")for(b=f.map(function($){return $.name}),_=f.map(function($){return $.prompt||$.name||""}),w=f.map(function($){return $.align||"left"}),p=0;p<f.length;p+=1)P[f[p].name]=f[p].width*(19.049976/25.4);else Array.isArray(f)&&typeof f[0]=="string"&&(_=b=f,w=b.map(function(){return"left"}));if(S||Array.isArray(f)&&typeof f[0]=="string")for(p=0;p<b.length;p+=1){for(A[y=b[p]]=d.map(function($){return $[y]}),this.setFont(void 0,"bold"),E.push(this.getTextDimensions(_[p],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),v=A[y],this.setFont(void 0,"normal"),m=0;m<v.length;m+=1)E.push(this.getTextDimensions(v[m],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);P[y]=Math.max.apply(null,E)+M+M,E=[]}if(I){var z={};for(p=0;p<b.length;p+=1)z[b[p]]={},z[b[p]].text=_[p],z[b[p]].align=w[p];var K=l.call(this,z,P);T=b.map(function($){return new o(c,u,P[$],K,z[$].text,void 0,z[$].align)}),this.setTableHeaderRow(T),this.printHeaderRow(1,!1)}var J=f.reduce(function($,X){return $[X.name]=X.align,$},{});for(p=0;p<d.length;p+=1){"rowStart"in h&&h.rowStart instanceof Function&&h.rowStart({row:p,data:d[p]},this);var R=l.call(this,d[p],P);for(m=0;m<b.length;m+=1){var k=d[p][b[m]];"cellStart"in h&&h.cellStart instanceof Function&&h.cellStart({row:p,col:m,data:k},this),s.call(this,new o(c,u,P[b[m]],R,k,p+2,J[b[m]]))}}return this.internal.__cell__.table_x=c,this.internal.__cell__.table_y=u,this};var l=function(c,u){var d=this.internal.__cell__.padding,f=this.internal.__cell__.table_font_size,h=this.internal.scaleFactor;return Object.keys(c).map(function(p){var v=c[p];return this.splitTextToSize(v.hasOwnProperty("text")?v.text:v,u[p]-d-d)},this).map(function(p){return this.getLineHeightFactor()*p.length*f/h+d+d},this).reduce(function(p,v){return Math.max(p,v)},0)};e.setTableHeaderRow=function(c){n.call(this),this.internal.__cell__.tableHeaderRow=c},e.printHeaderRow=function(c,u){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var d;if(r=!0,typeof this.internal.__cell__.headerFunction=="function"){var f=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new o(f[0],f[1],f[2],f[3],void 0,-1)}this.setFont(void 0,"bold");for(var h=[],p=0;p<this.internal.__cell__.tableHeaderRow.length;p+=1){d=this.internal.__cell__.tableHeaderRow[p].clone(),u&&(d.y=this.internal.__cell__.margins.top||0,h.push(d)),d.lineNumber=c;var v=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),s.call(this,d),this.setTextColor(v)}h.length>0&&this.setTableHeaderRow(h),this.setFont(void 0,"normal"),r=!1}}(br.API);var N6={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},D6=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],Nw=I6(D6),M6=[100,200,300,400,500,600,700,800,900],Jle=I6(M6);function Dw(e){var t=e.family.replace(/"|'/g,"").toLowerCase(),r=function(o){return N6[o=o||"normal"]?o:"normal"}(e.style),n=function(o){if(!o)return 400;if(typeof o=="number")return o>=100&&o<=900&&o%100==0?o:400;if(/^\d00$/.test(o))return parseInt(o);switch(o){case"bold":return 700;case"normal":default:return 400}}(e.weight),a=function(o){return typeof Nw[o=o||"normal"]=="number"?o:"normal"}(e.stretch);return{family:t,style:r,weight:n,stretch:a,src:e.src||[],ref:e.ref||{name:t,style:[a,r,n].join(" ")}}}function HE(e,t,r,n){var a;for(a=r;a>=0&&a<t.length;a+=n)if(e[t[a]])return e[t[a]];for(a=r;a>=0&&a<t.length;a-=n)if(e[t[a]])return e[t[a]]}var Zle={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},VE={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function GE(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function ece(e,t,r){for(var n=(r=r||{}).defaultFontFamily||"times",a=Object.assign({},Zle,r.genericFontFamilies||{}),o=null,s=null,l=0;l<t.length;++l)if(a[(o=Dw(t[l])).family]&&(o.family=a[o.family]),e.hasOwnProperty(o.family)){s=e[o.family];break}if(!(s=s||e[n]))throw new Error("Could not find a font-family for the rule '"+GE(o)+"' and default family '"+n+"'.");if(s=function(c,u){if(u[c])return u[c];var d=Nw[c],f=d<=Nw.normal?-1:1,h=HE(u,D6,d,f);if(!h)throw new Error("Could not find a matching font-stretch value for "+c);return h}(o.stretch,s),s=function(c,u){if(u[c])return u[c];for(var d=N6[c],f=0;f<d.length;++f)if(u[d[f]])return u[d[f]];throw new Error("Could not find a matching font-style for "+c)}(o.style,s),!(s=function(c,u){if(u[c])return u[c];if(c===400&&u[500])return u[500];if(c===500&&u[400])return u[400];var d=Jle[c],f=HE(u,M6,d,c<400?-1:1);if(!f)throw new Error("Could not find a matching font-weight for value "+c);return f}(o.weight,s)))throw new Error("Failed to resolve a font for the rule '"+GE(o)+"'.");return s}function YE(e){return e.trimLeft()}function tce(e,t){for(var r=0;r<e.length;){if(e.charAt(r)===t)return[e.substring(0,r),e.substring(r+1)];r+=1}return null}function rce(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],e.substring(t[0].length)]}var Lm,KE,QE,A2=["times"];(function(e){var t,r,n,a,o,s,l,c,u,d=function(C){return C=C||{},this.isStrokeTransparent=C.isStrokeTransparent||!1,this.strokeOpacity=C.strokeOpacity||1,this.strokeStyle=C.strokeStyle||"#000000",this.fillStyle=C.fillStyle||"#000000",this.isFillTransparent=C.isFillTransparent||!1,this.fillOpacity=C.fillOpacity||1,this.font=C.font||"10px sans-serif",this.textBaseline=C.textBaseline||"alphabetic",this.textAlign=C.textAlign||"left",this.lineWidth=C.lineWidth||1,this.lineJoin=C.lineJoin||"miter",this.lineCap=C.lineCap||"butt",this.path=C.path||[],this.transform=C.transform!==void 0?C.transform.clone():new c,this.globalCompositeOperation=C.globalCompositeOperation||"normal",this.globalAlpha=C.globalAlpha||1,this.clip_path=C.clip_path||[],this.currentPoint=C.currentPoint||new s,this.miterLimit=C.miterLimit||10,this.lastPoint=C.lastPoint||new s,this.lineDashOffset=C.lineDashOffset||0,this.lineDash=C.lineDash||[],this.margin=C.margin||[0,0,0,0],this.prevPageLastElemOffset=C.prevPageLastElemOffset||0,this.ignoreClearRect=typeof C.ignoreClearRect!="boolean"||C.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new f(this),t=this.internal.f2,r=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,a=this.internal.getHorizontalCoordinate,o=this.internal.getVerticalCoordinate,s=this.internal.Point,l=this.internal.Rectangle,c=this.internal.Matrix,u=new d}]);var f=function(C){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var N=C;Object.defineProperty(this,"pdf",{get:function(){return N}});var H=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return H},set:function(le){H=!!le}});var W=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return W},set:function(le){W=!!le}});var ne=0;Object.defineProperty(this,"posX",{get:function(){return ne},set:function(le){isNaN(le)||(ne=le)}});var se=0;Object.defineProperty(this,"posY",{get:function(){return se},set:function(le){isNaN(le)||(se=le)}}),Object.defineProperty(this,"margin",{get:function(){return u.margin},set:function(le){var V;typeof le=="number"?V=[le,le,le,le]:((V=new Array(4))[0]=le[0],V[1]=le.length>=2?le[1]:V[0],V[2]=le.length>=3?le[2]:V[0],V[3]=le.length>=4?le[3]:V[1]),u.margin=V}});var oe=!1;Object.defineProperty(this,"autoPaging",{get:function(){return oe},set:function(le){oe=le}});var ae=0;Object.defineProperty(this,"lastBreak",{get:function(){return ae},set:function(le){ae=le}});var pe=[];Object.defineProperty(this,"pageBreaks",{get:function(){return pe},set:function(le){pe=le}}),Object.defineProperty(this,"ctx",{get:function(){return u},set:function(le){le instanceof d&&(u=le)}}),Object.defineProperty(this,"path",{get:function(){return u.path},set:function(le){u.path=le}});var ge=[];Object.defineProperty(this,"ctxStack",{get:function(){return ge},set:function(le){ge=le}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(le){var V;V=h(le),this.ctx.fillStyle=V.style,this.ctx.isFillTransparent=V.a===0,this.ctx.fillOpacity=V.a,this.pdf.setFillColor(V.r,V.g,V.b,{a:V.a}),this.pdf.setTextColor(V.r,V.g,V.b,{a:V.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(le){var V=h(le);this.ctx.strokeStyle=V.style,this.ctx.isStrokeTransparent=V.a===0,this.ctx.strokeOpacity=V.a,V.a===0?this.pdf.setDrawColor(255,255,255):(V.a,this.pdf.setDrawColor(V.r,V.g,V.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(le){["butt","round","square"].indexOf(le)!==-1&&(this.ctx.lineCap=le,this.pdf.setLineCap(le))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(le){isNaN(le)||(this.ctx.lineWidth=le,this.pdf.setLineWidth(le))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(le){["bevel","round","miter"].indexOf(le)!==-1&&(this.ctx.lineJoin=le,this.pdf.setLineJoin(le))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(le){isNaN(le)||(this.ctx.miterLimit=le,this.pdf.setMiterLimit(le))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(le){this.ctx.textBaseline=le}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(le){["right","end","center","left","start"].indexOf(le)!==-1&&(this.ctx.textAlign=le)}});var Q=null;function G(le,V){if(Q===null){var Ve=function(Me){var Fe=[];return Object.keys(Me).forEach(function(Qe){Me[Qe].forEach(function(it){var st=null;switch(it){case"bold":st={family:Qe,weight:"bold"};break;case"italic":st={family:Qe,style:"italic"};break;case"bolditalic":st={family:Qe,weight:"bold",style:"italic"};break;case"":case"normal":st={family:Qe}}st!==null&&(st.ref={name:Qe,style:it},Fe.push(st))})}),Fe}(le.getFontList());Q=function(Me){for(var Fe={},Qe=0;Qe<Me.length;++Qe){var it=Dw(Me[Qe]),st=it.family,vt=it.stretch,Ye=it.style,Ze=it.weight;Fe[st]=Fe[st]||{},Fe[st][vt]=Fe[st][vt]||{},Fe[st][vt][Ye]=Fe[st][vt][Ye]||{},Fe[st][vt][Ye][Ze]=it}return Fe}(Ve.concat(V))}return Q}var ee=null;Object.defineProperty(this,"fontFaces",{get:function(){return ee},set:function(le){Q=null,ee=le}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(le){var V;if(this.ctx.font=le,(V=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(le))!==null){var Ve=V[1];V[2];var Me=V[3],Fe=V[4];V[5];var Qe=V[6],it=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Fe)[2];Fe=Math.floor(it==="px"?parseFloat(Fe)*this.pdf.internal.scaleFactor:it==="em"?parseFloat(Fe)*this.pdf.getFontSize():parseFloat(Fe)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Fe);var st=function(Ot){var Wt,jt,lr=[],$e=Ot.trim();if($e==="")return A2;if($e in VE)return[VE[$e]];for(;$e!=="";){switch(jt=null,Wt=($e=YE($e)).charAt(0)){case'"':case"'":jt=tce($e.substring(1),Wt);break;default:jt=rce($e)}if(jt===null||(lr.push(jt[0]),($e=YE(jt[1]))!==""&&$e.charAt(0)!==","))return A2;$e=$e.replace(/^,/,"")}return lr}(Qe);if(this.fontFaces){var vt=ece(G(this.pdf,this.fontFaces),st.map(function(Ot){return{family:Ot,stretch:"normal",weight:Me,style:Ve}}));this.pdf.setFont(vt.ref.name,vt.ref.style)}else{var Ye="";(Me==="bold"||parseInt(Me,10)>=700||Ve==="bold")&&(Ye="bold"),Ve==="italic"&&(Ye+="italic"),Ye.length===0&&(Ye="normal");for(var Ze="",We={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},wt=0;wt<st.length;wt++){if(this.pdf.internal.getFont(st[wt],Ye,{noFallback:!0,disableWarning:!0})!==void 0){Ze=st[wt];break}if(Ye==="bolditalic"&&this.pdf.internal.getFont(st[wt],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Ze=st[wt],Ye="bold";else if(this.pdf.internal.getFont(st[wt],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Ze=st[wt],Ye="normal";break}}if(Ze===""){for(var It=0;It<st.length;It++)if(We[st[It]]){Ze=We[st[It]];break}}Ze=Ze===""?"Times":Ze,this.pdf.setFont(Ze,Ye)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(le){this.ctx.globalCompositeOperation=le}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(le){this.ctx.globalAlpha=le}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(le){this.ctx.lineDashOffset=le,X.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(le){this.ctx.lineDash=le,X.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(le){this.ctx.ignoreClearRect=!!le}})};f.prototype.setLineDash=function(C){this.lineDash=C},f.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},f.prototype.fill=function(){A.call(this,"fill",!1)},f.prototype.stroke=function(){A.call(this,"stroke",!1)},f.prototype.beginPath=function(){this.path=[{type:"begin"}]},f.prototype.moveTo=function(C,N){if(isNaN(C)||isNaN(N))throw Pn.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var H=this.ctx.transform.applyToPoint(new s(C,N));this.path.push({type:"mt",x:H.x,y:H.y}),this.ctx.lastPoint=new s(C,N)},f.prototype.closePath=function(){var C=new s(0,0),N=0;for(N=this.path.length-1;N!==-1;N--)if(this.path[N].type==="begin"&&mn(this.path[N+1])==="object"&&typeof this.path[N+1].x=="number"){C=new s(this.path[N+1].x,this.path[N+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new s(C.x,C.y)},f.prototype.lineTo=function(C,N){if(isNaN(C)||isNaN(N))throw Pn.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var H=this.ctx.transform.applyToPoint(new s(C,N));this.path.push({type:"lt",x:H.x,y:H.y}),this.ctx.lastPoint=new s(H.x,H.y)},f.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),A.call(this,null,!0)},f.prototype.quadraticCurveTo=function(C,N,H,W){if(isNaN(H)||isNaN(W)||isNaN(C)||isNaN(N))throw Pn.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var ne=this.ctx.transform.applyToPoint(new s(H,W)),se=this.ctx.transform.applyToPoint(new s(C,N));this.path.push({type:"qct",x1:se.x,y1:se.y,x:ne.x,y:ne.y}),this.ctx.lastPoint=new s(ne.x,ne.y)},f.prototype.bezierCurveTo=function(C,N,H,W,ne,se){if(isNaN(ne)||isNaN(se)||isNaN(C)||isNaN(N)||isNaN(H)||isNaN(W))throw Pn.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var oe=this.ctx.transform.applyToPoint(new s(ne,se)),ae=this.ctx.transform.applyToPoint(new s(C,N)),pe=this.ctx.transform.applyToPoint(new s(H,W));this.path.push({type:"bct",x1:ae.x,y1:ae.y,x2:pe.x,y2:pe.y,x:oe.x,y:oe.y}),this.ctx.lastPoint=new s(oe.x,oe.y)},f.prototype.arc=function(C,N,H,W,ne,se){if(isNaN(C)||isNaN(N)||isNaN(H)||isNaN(W)||isNaN(ne))throw Pn.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(se=!!se,!this.ctx.transform.isIdentity){var oe=this.ctx.transform.applyToPoint(new s(C,N));C=oe.x,N=oe.y;var ae=this.ctx.transform.applyToPoint(new s(0,H)),pe=this.ctx.transform.applyToPoint(new s(0,0));H=Math.sqrt(Math.pow(ae.x-pe.x,2)+Math.pow(ae.y-pe.y,2))}Math.abs(ne-W)>=2*Math.PI&&(W=0,ne=2*Math.PI),this.path.push({type:"arc",x:C,y:N,radius:H,startAngle:W,endAngle:ne,counterclockwise:se})},f.prototype.arcTo=function(C,N,H,W,ne){throw new Error("arcTo not implemented.")},f.prototype.rect=function(C,N,H,W){if(isNaN(C)||isNaN(N)||isNaN(H)||isNaN(W))throw Pn.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(C,N),this.lineTo(C+H,N),this.lineTo(C+H,N+W),this.lineTo(C,N+W),this.lineTo(C,N),this.lineTo(C+H,N),this.lineTo(C,N)},f.prototype.fillRect=function(C,N,H,W){if(isNaN(C)||isNaN(N)||isNaN(H)||isNaN(W))throw Pn.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!p.call(this)){var ne={};this.lineCap!=="butt"&&(ne.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(ne.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(C,N,H,W),this.fill(),ne.hasOwnProperty("lineCap")&&(this.lineCap=ne.lineCap),ne.hasOwnProperty("lineJoin")&&(this.lineJoin=ne.lineJoin)}},f.prototype.strokeRect=function(C,N,H,W){if(isNaN(C)||isNaN(N)||isNaN(H)||isNaN(W))throw Pn.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");v.call(this)||(this.beginPath(),this.rect(C,N,H,W),this.stroke())},f.prototype.clearRect=function(C,N,H,W){if(isNaN(C)||isNaN(N)||isNaN(H)||isNaN(W))throw Pn.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(C,N,H,W))},f.prototype.save=function(C){C=typeof C!="boolean"||C;for(var N=this.pdf.internal.getCurrentPageInfo().pageNumber,H=0;H<this.pdf.internal.getNumberOfPages();H++)this.pdf.setPage(H+1),this.pdf.internal.out("q");if(this.pdf.setPage(N),C){this.ctx.fontSize=this.pdf.internal.getFontSize();var W=new d(this.ctx);this.ctxStack.push(this.ctx),this.ctx=W}},f.prototype.restore=function(C){C=typeof C!="boolean"||C;for(var N=this.pdf.internal.getCurrentPageInfo().pageNumber,H=0;H<this.pdf.internal.getNumberOfPages();H++)this.pdf.setPage(H+1),this.pdf.internal.out("Q");this.pdf.setPage(N),C&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},f.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var h=function(C){var N,H,W,ne;if(C.isCanvasGradient===!0&&(C=C.getColor()),!C)return{r:0,g:0,b:0,a:0,style:C};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(C))N=0,H=0,W=0,ne=0;else{var se=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(C);if(se!==null)N=parseInt(se[1]),H=parseInt(se[2]),W=parseInt(se[3]),ne=1;else if((se=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(C))!==null)N=parseInt(se[1]),H=parseInt(se[2]),W=parseInt(se[3]),ne=parseFloat(se[4]);else{if(ne=1,typeof C=="string"&&C.charAt(0)!=="#"){var oe=new A6(C);C=oe.ok?oe.toHex():"#000000"}C.length===4?(N=C.substring(1,2),N+=N,H=C.substring(2,3),H+=H,W=C.substring(3,4),W+=W):(N=C.substring(1,3),H=C.substring(3,5),W=C.substring(5,7)),N=parseInt(N,16),H=parseInt(H,16),W=parseInt(W,16)}}return{r:N,g:H,b:W,a:ne,style:C}},p=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},v=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};f.prototype.fillText=function(C,N,H,W){if(isNaN(N)||isNaN(H)||typeof C!="string")throw Pn.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(W=isNaN(W)?void 0:W,!p.call(this)){var ne=R(this.ctx.transform.rotation),se=this.ctx.transform.scaleX;M.call(this,{text:C,x:N,y:H,scale:se,angle:ne,align:this.textAlign,maxWidth:W})}},f.prototype.strokeText=function(C,N,H,W){if(isNaN(N)||isNaN(H)||typeof C!="string")throw Pn.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!v.call(this)){W=isNaN(W)?void 0:W;var ne=R(this.ctx.transform.rotation),se=this.ctx.transform.scaleX;M.call(this,{text:C,x:N,y:H,scale:se,renderingMode:"stroke",angle:ne,align:this.textAlign,maxWidth:W})}},f.prototype.measureText=function(C){if(typeof C!="string")throw Pn.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var N=this.pdf,H=this.pdf.internal.scaleFactor,W=N.internal.getFontSize(),ne=N.getStringUnitWidth(C)*W/N.internal.scaleFactor,se=function(oe){var ae=(oe=oe||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return ae}}),this};return new se({width:ne*=Math.round(96*H/72*1e4)/1e4})},f.prototype.scale=function(C,N){if(isNaN(C)||isNaN(N))throw Pn.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var H=new c(C,0,0,N,0,0);this.ctx.transform=this.ctx.transform.multiply(H)},f.prototype.rotate=function(C){if(isNaN(C))throw Pn.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var N=new c(Math.cos(C),Math.sin(C),-Math.sin(C),Math.cos(C),0,0);this.ctx.transform=this.ctx.transform.multiply(N)},f.prototype.translate=function(C,N){if(isNaN(C)||isNaN(N))throw Pn.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var H=new c(1,0,0,1,C,N);this.ctx.transform=this.ctx.transform.multiply(H)},f.prototype.transform=function(C,N,H,W,ne,se){if(isNaN(C)||isNaN(N)||isNaN(H)||isNaN(W)||isNaN(ne)||isNaN(se))throw Pn.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var oe=new c(C,N,H,W,ne,se);this.ctx.transform=this.ctx.transform.multiply(oe)},f.prototype.setTransform=function(C,N,H,W,ne,se){C=isNaN(C)?1:C,N=isNaN(N)?0:N,H=isNaN(H)?0:H,W=isNaN(W)?1:W,ne=isNaN(ne)?0:ne,se=isNaN(se)?0:se,this.ctx.transform=new c(C,N,H,W,ne,se)};var m=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};f.prototype.drawImage=function(C,N,H,W,ne,se,oe,ae,pe){var ge=this.pdf.getImageProperties(C),Q=1,G=1,ee=1,le=1;W!==void 0&&ae!==void 0&&(ee=ae/W,le=pe/ne,Q=ge.width/W*ae/W,G=ge.height/ne*pe/ne),se===void 0&&(se=N,oe=H,N=0,H=0),W!==void 0&&ae===void 0&&(ae=W,pe=ne),W===void 0&&ae===void 0&&(ae=ge.width,pe=ge.height);for(var V,Ve=this.ctx.transform.decompose(),Me=R(Ve.rotate.shx),Fe=new c,Qe=(Fe=(Fe=(Fe=Fe.multiply(Ve.translate)).multiply(Ve.skew)).multiply(Ve.scale)).applyToRectangle(new l(se-N*ee,oe-H*le,W*Q,ne*G)),it=y.call(this,Qe),st=[],vt=0;vt<it.length;vt+=1)st.indexOf(it[vt])===-1&&st.push(it[vt]);if(w(st),this.autoPaging)for(var Ye=st[0],Ze=st[st.length-1],We=Ye;We<Ze+1;We++){this.pdf.setPage(We);var wt=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],It=We===1?this.posY+this.margin[0]:this.margin[0],Ot=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Wt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],jt=We===1?0:Ot+(We-2)*Wt;if(this.ctx.clip_path.length!==0){var lr=this.path;V=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=_(V,this.posX+this.margin[3],-jt+It+this.ctx.prevPageLastElemOffset),P.call(this,"fill",!0),this.path=lr}var $e=JSON.parse(JSON.stringify(Qe));$e=_([$e],this.posX+this.margin[3],-jt+It+this.ctx.prevPageLastElemOffset)[0];var He=(We>Ye||We<Ze)&&m.call(this);He&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],wt,Wt,null).clip().discardPath()),this.pdf.addImage(C,"JPEG",$e.x,$e.y,$e.w,$e.h,null,null,Me),He&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(C,"JPEG",Qe.x,Qe.y,Qe.w,Qe.h,null,null,Me)};var y=function(C,N,H){var W=[];N=N||this.pdf.internal.pageSize.width,H=H||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var ne=this.posY+this.ctx.prevPageLastElemOffset;switch(C.type){default:case"mt":case"lt":W.push(Math.floor((C.y+ne)/H)+1);break;case"arc":W.push(Math.floor((C.y+ne-C.radius)/H)+1),W.push(Math.floor((C.y+ne+C.radius)/H)+1);break;case"qct":var se=k(this.ctx.lastPoint.x,this.ctx.lastPoint.y,C.x1,C.y1,C.x,C.y);W.push(Math.floor((se.y+ne)/H)+1),W.push(Math.floor((se.y+se.h+ne)/H)+1);break;case"bct":var oe=$(this.ctx.lastPoint.x,this.ctx.lastPoint.y,C.x1,C.y1,C.x2,C.y2,C.x,C.y);W.push(Math.floor((oe.y+ne)/H)+1),W.push(Math.floor((oe.y+oe.h+ne)/H)+1);break;case"rect":W.push(Math.floor((C.y+ne)/H)+1),W.push(Math.floor((C.y+C.h+ne)/H)+1)}for(var ae=0;ae<W.length;ae+=1)for(;this.pdf.internal.getNumberOfPages()<W[ae];)b.call(this);return W},b=function(){var C=this.fillStyle,N=this.strokeStyle,H=this.font,W=this.lineCap,ne=this.lineWidth,se=this.lineJoin;this.pdf.addPage(),this.fillStyle=C,this.strokeStyle=N,this.font=H,this.lineCap=W,this.lineWidth=ne,this.lineJoin=se},_=function(C,N,H){for(var W=0;W<C.length;W++)switch(C[W].type){case"bct":C[W].x2+=N,C[W].y2+=H;case"qct":C[W].x1+=N,C[W].y1+=H;case"mt":case"lt":case"arc":default:C[W].x+=N,C[W].y+=H}return C},w=function(C){return C.sort(function(N,H){return N-H})},A=function(C,N){for(var H,W,ne=this.fillStyle,se=this.strokeStyle,oe=this.lineCap,ae=this.lineWidth,pe=Math.abs(ae*this.ctx.transform.scaleX),ge=this.lineJoin,Q=JSON.parse(JSON.stringify(this.path)),G=JSON.parse(JSON.stringify(this.path)),ee=[],le=0;le<G.length;le++)if(G[le].x!==void 0)for(var V=y.call(this,G[le]),Ve=0;Ve<V.length;Ve+=1)ee.indexOf(V[Ve])===-1&&ee.push(V[Ve]);for(var Me=0;Me<ee.length;Me++)for(;this.pdf.internal.getNumberOfPages()<ee[Me];)b.call(this);if(w(ee),this.autoPaging)for(var Fe=ee[0],Qe=ee[ee.length-1],it=Fe;it<Qe+1;it++){this.pdf.setPage(it),this.fillStyle=ne,this.strokeStyle=se,this.lineCap=oe,this.lineWidth=pe,this.lineJoin=ge;var st=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],vt=it===1?this.posY+this.margin[0]:this.margin[0],Ye=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ze=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],We=it===1?0:Ye+(it-2)*Ze;if(this.ctx.clip_path.length!==0){var wt=this.path;H=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=_(H,this.posX+this.margin[3],-We+vt+this.ctx.prevPageLastElemOffset),P.call(this,C,!0),this.path=wt}if(W=JSON.parse(JSON.stringify(Q)),this.path=_(W,this.posX+this.margin[3],-We+vt+this.ctx.prevPageLastElemOffset),N===!1||it===0){var It=(it>Fe||it<Qe)&&m.call(this);It&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],st,Ze,null).clip().discardPath()),P.call(this,C,N),It&&this.pdf.restoreGraphicsState()}this.lineWidth=ae}else this.lineWidth=pe,P.call(this,C,N),this.lineWidth=ae;this.path=Q},P=function(C,N){if((C!=="stroke"||N||!v.call(this))&&(C==="stroke"||N||!p.call(this))){for(var H,W,ne=[],se=this.path,oe=0;oe<se.length;oe++){var ae=se[oe];switch(ae.type){case"begin":ne.push({begin:!0});break;case"close":ne.push({close:!0});break;case"mt":ne.push({start:ae,deltas:[],abs:[]});break;case"lt":var pe=ne.length;if(se[oe-1]&&!isNaN(se[oe-1].x)&&(H=[ae.x-se[oe-1].x,ae.y-se[oe-1].y],pe>0)){for(;pe>=0;pe--)if(ne[pe-1].close!==!0&&ne[pe-1].begin!==!0){ne[pe-1].deltas.push(H),ne[pe-1].abs.push(ae);break}}break;case"bct":H=[ae.x1-se[oe-1].x,ae.y1-se[oe-1].y,ae.x2-se[oe-1].x,ae.y2-se[oe-1].y,ae.x-se[oe-1].x,ae.y-se[oe-1].y],ne[ne.length-1].deltas.push(H);break;case"qct":var ge=se[oe-1].x+2/3*(ae.x1-se[oe-1].x),Q=se[oe-1].y+2/3*(ae.y1-se[oe-1].y),G=ae.x+2/3*(ae.x1-ae.x),ee=ae.y+2/3*(ae.y1-ae.y),le=ae.x,V=ae.y;H=[ge-se[oe-1].x,Q-se[oe-1].y,G-se[oe-1].x,ee-se[oe-1].y,le-se[oe-1].x,V-se[oe-1].y],ne[ne.length-1].deltas.push(H);break;case"arc":ne.push({deltas:[],abs:[],arc:!0}),Array.isArray(ne[ne.length-1].abs)&&ne[ne.length-1].abs.push(ae)}}W=N?null:C==="stroke"?"stroke":"fill";for(var Ve=!1,Me=0;Me<ne.length;Me++)if(ne[Me].arc)for(var Fe=ne[Me].abs,Qe=0;Qe<Fe.length;Qe++){var it=Fe[Qe];it.type==="arc"?S.call(this,it.x,it.y,it.radius,it.startAngle,it.endAngle,it.counterclockwise,void 0,N,!Ve):L.call(this,it.x,it.y),Ve=!0}else if(ne[Me].close===!0)this.pdf.internal.out("h"),Ve=!1;else if(ne[Me].begin!==!0){var st=ne[Me].start.x,vt=ne[Me].start.y;q.call(this,ne[Me].deltas,st,vt),Ve=!0}W&&I.call(this,W),N&&U.call(this)}},E=function(C){var N=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,H=N*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return C-H;case"top":return C+N-H;case"hanging":return C+N-2*H;case"middle":return C+N/2-H;case"ideographic":return C;case"alphabetic":default:return C}},T=function(C){return C+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};f.prototype.createLinearGradient=function(){var C=function(){};return C.colorStops=[],C.addColorStop=function(N,H){this.colorStops.push([N,H])},C.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},C.isCanvasGradient=!0,C},f.prototype.createPattern=function(){return this.createLinearGradient()},f.prototype.createRadialGradient=function(){return this.createLinearGradient()};var S=function(C,N,H,W,ne,se,oe,ae,pe){for(var ge=K.call(this,H,W,ne,se),Q=0;Q<ge.length;Q++){var G=ge[Q];Q===0&&(pe?O.call(this,G.x1+C,G.y1+N):L.call(this,G.x1+C,G.y1+N)),z.call(this,C,N,G.x2,G.y2,G.x3,G.y3,G.x4,G.y4)}ae?U.call(this):I.call(this,oe)},I=function(C){switch(C){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},U=function(){this.pdf.clip(),this.pdf.discardPath()},O=function(C,N){this.pdf.internal.out(r(C)+" "+n(N)+" m")},M=function(C){var N;switch(C.align){case"right":case"end":N="right";break;case"center":N="center";break;case"left":case"start":default:N="left"}var H=this.pdf.getTextDimensions(C.text),W=E.call(this,C.y),ne=T.call(this,W)-H.h,se=this.ctx.transform.applyToPoint(new s(C.x,W)),oe=this.ctx.transform.decompose(),ae=new c;ae=(ae=(ae=ae.multiply(oe.translate)).multiply(oe.skew)).multiply(oe.scale);for(var pe,ge,Q,G=this.ctx.transform.applyToRectangle(new l(C.x,W,H.w,H.h)),ee=ae.applyToRectangle(new l(C.x,ne,H.w,H.h)),le=y.call(this,ee),V=[],Ve=0;Ve<le.length;Ve+=1)V.indexOf(le[Ve])===-1&&V.push(le[Ve]);if(w(V),this.autoPaging)for(var Me=V[0],Fe=V[V.length-1],Qe=Me;Qe<Fe+1;Qe++){this.pdf.setPage(Qe);var it=Qe===1?this.posY+this.margin[0]:this.margin[0],st=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],vt=this.pdf.internal.pageSize.height-this.margin[2],Ye=vt-this.margin[0],Ze=this.pdf.internal.pageSize.width-this.margin[1],We=Ze-this.margin[3],wt=Qe===1?0:st+(Qe-2)*Ye;if(this.ctx.clip_path.length!==0){var It=this.path;pe=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=_(pe,this.posX+this.margin[3],-1*wt+it),P.call(this,"fill",!0),this.path=It}var Ot=_([JSON.parse(JSON.stringify(ee))],this.posX+this.margin[3],-wt+it+this.ctx.prevPageLastElemOffset)[0];C.scale>=.01&&(ge=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ge*C.scale),Q=this.lineWidth,this.lineWidth=Q*C.scale);var Wt=this.autoPaging!=="text";if(Wt||Ot.y+Ot.h<=vt){if(Wt||Ot.y>=it&&Ot.x<=Ze){var jt=Wt?C.text:this.pdf.splitTextToSize(C.text,C.maxWidth||Ze-Ot.x)[0],lr=_([JSON.parse(JSON.stringify(G))],this.posX+this.margin[3],-wt+it+this.ctx.prevPageLastElemOffset)[0],$e=Wt&&(Qe>Me||Qe<Fe)&&m.call(this);$e&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],We,Ye,null).clip().discardPath()),this.pdf.text(jt,lr.x,lr.y,{angle:C.angle,align:N,renderingMode:C.renderingMode}),$e&&this.pdf.restoreGraphicsState()}}else Ot.y<vt&&(this.ctx.prevPageLastElemOffset+=vt-Ot.y);C.scale>=.01&&(this.pdf.setFontSize(ge),this.lineWidth=Q)}else C.scale>=.01&&(ge=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ge*C.scale),Q=this.lineWidth,this.lineWidth=Q*C.scale),this.pdf.text(C.text,se.x+this.posX,se.y+this.posY,{angle:C.angle,align:N,renderingMode:C.renderingMode,maxWidth:C.maxWidth}),C.scale>=.01&&(this.pdf.setFontSize(ge),this.lineWidth=Q)},L=function(C,N,H,W){H=H||0,W=W||0,this.pdf.internal.out(r(C+H)+" "+n(N+W)+" l")},q=function(C,N,H){return this.pdf.lines(C,N,H,null,null)},z=function(C,N,H,W,ne,se,oe,ae){this.pdf.internal.out([t(a(H+C)),t(o(W+N)),t(a(ne+C)),t(o(se+N)),t(a(oe+C)),t(o(ae+N)),"c"].join(" "))},K=function(C,N,H,W){for(var ne=2*Math.PI,se=Math.PI/2;N>H;)N-=ne;var oe=Math.abs(H-N);oe<ne&&W&&(oe=ne-oe);for(var ae=[],pe=W?-1:1,ge=N;oe>1e-5;){var Q=ge+pe*Math.min(oe,se);ae.push(J.call(this,C,ge,Q)),oe-=Math.abs(Q-ge),ge=Q}return ae},J=function(C,N,H){var W=(H-N)/2,ne=C*Math.cos(W),se=C*Math.sin(W),oe=ne,ae=-se,pe=oe*oe+ae*ae,ge=pe+oe*ne+ae*se,Q=4/3*(Math.sqrt(2*pe*ge)-ge)/(oe*se-ae*ne),G=oe-Q*ae,ee=ae+Q*oe,le=G,V=-ee,Ve=W+N,Me=Math.cos(Ve),Fe=Math.sin(Ve);return{x1:C*Math.cos(N),y1:C*Math.sin(N),x2:G*Me-ee*Fe,y2:G*Fe+ee*Me,x3:le*Me-V*Fe,y3:le*Fe+V*Me,x4:C*Math.cos(H),y4:C*Math.sin(H)}},R=function(C){return 180*C/Math.PI},k=function(C,N,H,W,ne,se){var oe=C+.5*(H-C),ae=N+.5*(W-N),pe=ne+.5*(H-ne),ge=se+.5*(W-se),Q=Math.min(C,ne,oe,pe),G=Math.max(C,ne,oe,pe),ee=Math.min(N,se,ae,ge),le=Math.max(N,se,ae,ge);return new l(Q,ee,G-Q,le-ee)},$=function(C,N,H,W,ne,se,oe,ae){var pe,ge,Q,G,ee,le,V,Ve,Me,Fe,Qe,it,st,vt,Ye=H-C,Ze=W-N,We=ne-H,wt=se-W,It=oe-ne,Ot=ae-se;for(ge=0;ge<41;ge++)Me=(V=(Q=C+(pe=ge/40)*Ye)+pe*((ee=H+pe*We)-Q))+pe*(ee+pe*(ne+pe*It-ee)-V),Fe=(Ve=(G=N+pe*Ze)+pe*((le=W+pe*wt)-G))+pe*(le+pe*(se+pe*Ot-le)-Ve),ge==0?(Qe=Me,it=Fe,st=Me,vt=Fe):(Qe=Math.min(Qe,Me),it=Math.min(it,Fe),st=Math.max(st,Me),vt=Math.max(vt,Fe));return new l(Math.round(Qe),Math.round(it),Math.round(st-Qe),Math.round(vt-it))},X=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var C,N,H=(C=this.ctx.lineDash,N=this.ctx.lineDashOffset,JSON.stringify({lineDash:C,lineDashOffset:N}));this.prevLineDash!==H&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=H)}}})(br.API),function(e){var t=function(o){var s,l,c,u,d,f,h,p,v,m;for(l=[],c=0,u=(o+=s="\0\0\0\0".slice(o.length%4||4)).length;u>c;c+=4)(d=(o.charCodeAt(c)<<24)+(o.charCodeAt(c+1)<<16)+(o.charCodeAt(c+2)<<8)+o.charCodeAt(c+3))!==0?(f=(d=((d=((d=((d=(d-(m=d%85))/85)-(v=d%85))/85)-(p=d%85))/85)-(h=d%85))/85)%85,l.push(f+33,h+33,p+33,v+33,m+33)):l.push(122);return function(y,b){for(var _=b;_>0;_--)y.pop()}(l,s.length),String.fromCharCode.apply(String,l)+"~>"},r=function(o){var s,l,c,u,d,f=String,h="length",p=255,v="charCodeAt",m="slice",y="replace";for(o[m](-2),o=o[m](0,-2)[y](/\s/g,"")[y]("z","!!!!!"),c=[],u=0,d=(o+=s="uuuuu"[m](o[h]%5||5))[h];d>u;u+=5)l=52200625*(o[v](u)-33)+614125*(o[v](u+1)-33)+7225*(o[v](u+2)-33)+85*(o[v](u+3)-33)+(o[v](u+4)-33),c.push(p&l>>24,p&l>>16,p&l>>8,p&l);return function(b,_){for(var w=_;w>0;w--)b.pop()}(c,s[h]),f.fromCharCode.apply(f,c)},n=function(o){var s=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((o=o.replace(/\s/g,"")).indexOf(">")!==-1&&(o=o.substr(0,o.indexOf(">"))),o.length%2&&(o+="0"),s.test(o)===!1)return"";for(var l="",c=0;c<o.length;c+=2)l+=String.fromCharCode("0x"+(o[c]+o[c+1]));return l},a=function(o){for(var s=new Uint8Array(o.length),l=o.length;l--;)s[l]=o.charCodeAt(l);return o=(s=Ow(s)).reduce(function(c,u){return c+String.fromCharCode(u)},"")};e.processDataByFilters=function(o,s){var l=0,c=o||"",u=[];for(typeof(s=s||[])=="string"&&(s=[s]),l=0;l<s.length;l+=1)switch(s[l]){case"ASCII85Decode":case"/ASCII85Decode":c=r(c),u.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":c=t(c),u.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":c=n(c),u.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":c=c.split("").map(function(d){return("0"+d.charCodeAt().toString(16)).slice(-2)}).join("")+">",u.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":c=a(c),u.push("/FlateDecode");break;default:throw new Error('The filter: "'+s[l]+'" is not implemented')}return{data:c,reverseChain:u.reverse().join(" ")}}}(br.API),function(e){e.loadFile=function(t,r,n){return function(a,o,s){o=o!==!1,s=typeof s=="function"?s:function(){};var l=void 0;try{l=function(c,u,d){var f=new XMLHttpRequest,h=0,p=function(v){var m=v.length,y=[],b=String.fromCharCode;for(h=0;h<m;h+=1)y.push(b(255&v.charCodeAt(h)));return y.join("")};if(f.open("GET",c,!u),f.overrideMimeType("text/plain; charset=x-user-defined"),u===!1&&(f.onload=function(){f.status===200?d(p(this.responseText)):d(void 0)}),f.send(null),u&&f.status===200)return p(f.responseText)}(a,o,s)}catch{}return l}(t,r,n)},e.loadImageFile=e.loadFile}(br.API),function(e){function t(){return(Cr.html2canvas?Promise.resolve(Cr.html2canvas):jw(()=>import("./html2canvas.esm-BfxBtG_O.js"),[])).catch(function(s){return Promise.reject(new Error("Could not load html2canvas: "+s))}).then(function(s){return s.default?s.default:s})}function r(){return(Cr.DOMPurify?Promise.resolve(Cr.DOMPurify):jw(()=>import("./purify.es-CQJ0hv7W.js"),[])).catch(function(s){return Promise.reject(new Error("Could not load dompurify: "+s))}).then(function(s){return s.default?s.default:s})}var n=function(s){var l=mn(s);return l==="undefined"?"undefined":l==="string"||s instanceof String?"string":l==="number"||s instanceof Number?"number":l==="function"||s instanceof Function?"function":s&&s.constructor===Array?"array":s&&s.nodeType===1?"element":l==="object"?"object":"unknown"},a=function(s,l){var c=document.createElement(s);for(var u in l.className&&(c.className=l.className),l.innerHTML&&l.dompurify&&(c.innerHTML=l.dompurify.sanitize(l.innerHTML)),l.style)c.style[u]=l.style[u];return c},o=function s(l){var c=Object.assign(s.convert(Promise.resolve()),JSON.parse(JSON.stringify(s.template))),u=s.convert(Promise.resolve(),c);return u=(u=u.setProgress(1,s,1,[s])).set(l)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(s,l){return s.__proto__=l||o.prototype,s},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(s,l){return this.then(function(){switch(l=l||function(c){switch(n(c)){case"string":return"string";case"element":return c.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(s)){case"string":return this.then(r).then(function(c){return this.set({src:a("div",{innerHTML:s,dompurify:c})})});case"element":return this.set({src:s});case"canvas":return this.set({canvas:s});case"img":return this.set({img:s});default:return this.error("Unknown source type.")}})},o.prototype.to=function(s){switch(s){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var s={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},l=function c(u,d){for(var f=u.nodeType===3?document.createTextNode(u.nodeValue):u.cloneNode(!1),h=u.firstChild;h;h=h.nextSibling)d!==!0&&h.nodeType===1&&h.nodeName==="SCRIPT"||f.appendChild(c(h,d));return u.nodeType===1&&(u.nodeName==="CANVAS"?(f.width=u.width,f.height=u.height,f.getContext("2d").drawImage(u,0,0)):u.nodeName!=="TEXTAREA"&&u.nodeName!=="SELECT"||(f.value=u.value),f.addEventListener("load",function(){f.scrollTop=u.scrollTop,f.scrollLeft=u.scrollLeft},!0)),f}(this.prop.src,this.opt.html2canvas.javascriptEnabled);l.tagName==="BODY"&&(s.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=a("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=a("div",{className:"html2pdf__container",style:s}),this.prop.container.appendChild(l),this.prop.container.firstChild.appendChild(a("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var s=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(s).then(t).then(function(l){var c=Object.assign({},this.opt.html2canvas);return delete c.onrendered,l(this.prop.container,c)}).then(function(l){(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var s=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(s).then(t).then(function(l){var c=this.opt.jsPDF,u=this.opt.fontFaces,d=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,f=Object.assign({async:!0,allowTaint:!0,scale:d,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete f.onrendered,c.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,c.context2d.posX=this.opt.x,c.context2d.posY=this.opt.y,c.context2d.margin=this.opt.margin,c.context2d.fontFaces=u,u)for(var h=0;h<u.length;++h){var p=u[h],v=p.src.find(function(m){return m.format==="truetype"});v&&c.addFont(v.url,p.ref.name,p.ref.style)}return f.windowHeight=f.windowHeight||0,f.windowHeight=f.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):f.windowHeight,c.context2d.save(!0),l(this.prop.container,f)}).then(function(l){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var s=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=s})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(s,l,c){return(c=c||"pdf").toLowerCase()==="img"||c.toLowerCase()==="image"?this.outputImg(s,l):this.outputPdf(s,l)},o.prototype.outputPdf=function(s,l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(s,l)})},o.prototype.outputImg=function(s){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(s){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+s+'" is not supported.'}})},o.prototype.save=function(s){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(s?{filename:s}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(s){if(n(s)!=="object")return this;var l=Object.keys(s||{}).map(function(c){if(c in o.template.prop)return function(){this.prop[c]=s[c]};switch(c){case"margin":return this.setMargin.bind(this,s.margin);case"jsPDF":return function(){return this.opt.jsPDF=s.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,s.pageSize);default:return function(){this.opt[c]=s[c]}}},this);return this.then(function(){return this.thenList(l)})},o.prototype.get=function(s,l){return this.then(function(){var c=s in o.template.prop?this.prop[s]:this.opt[s];return l?l(c):c})},o.prototype.setMargin=function(s){return this.then(function(){switch(n(s)){case"number":s=[s,s,s,s];case"array":if(s.length===2&&(s=[s[0],s[1],s[0],s[1]]),s.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=s}).then(this.setPageSize)},o.prototype.setPageSize=function(s){function l(c,u){return Math.floor(c*u/72*96)}return this.then(function(){(s=s||br.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(s.inner={width:s.width-this.opt.margin[1]-this.opt.margin[3],height:s.height-this.opt.margin[0]-this.opt.margin[2]},s.inner.px={width:l(s.inner.width,s.k),height:l(s.inner.height,s.k)},s.inner.ratio=s.inner.height/s.inner.width),this.prop.pageSize=s})},o.prototype.setProgress=function(s,l,c,u){return s!=null&&(this.progress.val=s),l!=null&&(this.progress.state=l),c!=null&&(this.progress.n=c),u!=null&&(this.progress.stack=u),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(s,l,c,u){return this.setProgress(s?this.progress.val+s:null,l||null,c?this.progress.n+c:null,u?this.progress.stack.concat(u):null)},o.prototype.then=function(s,l){var c=this;return this.thenCore(s,l,function(u,d){return c.updateProgress(null,null,1,[u]),Promise.prototype.then.call(this,function(f){return c.updateProgress(null,u),f}).then(u,d).then(function(f){return c.updateProgress(1),f})})},o.prototype.thenCore=function(s,l,c){c=c||Promise.prototype.then,s&&(s=s.bind(this)),l&&(l=l.bind(this));var u=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:o.convert(Object.assign({},this),Promise.prototype),d=c.call(u,s,l);return o.convert(d,this.__proto__)},o.prototype.thenExternal=function(s,l){return Promise.prototype.then.call(this,s,l)},o.prototype.thenList=function(s){var l=this;return s.forEach(function(c){l=l.thenCore(c)}),l},o.prototype.catch=function(s){s&&(s=s.bind(this));var l=Promise.prototype.catch.call(this,s);return o.convert(l,this)},o.prototype.catchExternal=function(s){return Promise.prototype.catch.call(this,s)},o.prototype.error=function(s){return this.then(function(){throw new Error(s)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,br.getPageSize=function(s,l,c){if(mn(s)==="object"){var u=s;s=u.orientation,l=u.unit||l,c=u.format||c}l=l||"mm",c=c||"a4",s=(""+(s||"P")).toLowerCase();var d,f=(""+c).toLowerCase(),h={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(l){case"pt":d=1;break;case"mm":d=72/25.4;break;case"cm":d=72/2.54;break;case"in":d=72;break;case"px":d=.75;break;case"pc":case"em":d=12;break;case"ex":d=6;break;default:throw"Invalid unit: "+l}var p,v=0,m=0;if(h.hasOwnProperty(f))v=h[f][1]/d,m=h[f][0]/d;else try{v=c[1],m=c[0]}catch{throw new Error("Invalid format: "+c)}if(s==="p"||s==="portrait")s="p",m>v&&(p=m,m=v,v=p);else{if(s!=="l"&&s!=="landscape")throw"Invalid orientation: "+s;s="l",v>m&&(p=m,m=v,v=p)}return{width:m,height:v,unit:l,k:d,orientation:s}},e.html=function(s,l){(l=l||{}).callback=l.callback||function(){},l.html2canvas=l.html2canvas||{},l.html2canvas.canvas=l.html2canvas.canvas||this.canvas,l.jsPDF=l.jsPDF||this,l.fontFaces=l.fontFaces?l.fontFaces.map(Dw):null;var c=new o(l);return l.worker?c:c.from(s).doCallback()}}(br.API),br.API.addJS=function(e){return QE=e,this.internal.events.subscribe("postPutResources",function(){Lm=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Lm+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),KE=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+QE+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Lm!==void 0&&KE!==void 0&&this.internal.out("/Names <</JavaScript "+Lm+" 0 R>>")}),this},function(e){var t;e.events.push(["postPutResources",function(){var r=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var a=r.outline.render().split(/\r\n/),o=0;o<a.length;o++){var s=a[o],l=n.exec(s);if(l!=null){var c=l[1];r.internal.newObjectDeferredBegin(c,!1)}r.internal.write(s)}if(this.outline.createNamedDestinations){var u=this.internal.pages.length,d=[];for(o=0;o<u;o++){var f=r.internal.newObject();d.push(f);var h=r.internal.getPageInfo(o+1);r.internal.write("<< /D["+h.objId+" 0 R /XYZ null null null]>> endobj")}var p=r.internal.newObject();for(r.internal.write("<< /Names [ "),o=0;o<d.length;o++)r.internal.write("(page_"+(o+1)+")"+d[o]+" 0 R");r.internal.write(" ] >>","endobj"),t=r.internal.newObject(),r.internal.write("<< /Dests "+p+" 0 R"),r.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var r=this;r.outline={createNamedDestinations:!1,root:{children:[]}},r.outline.add=function(n,a,o){var s={title:a,options:o,children:[]};return n==null&&(n=this.root),n.children.push(s),s},r.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=r,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},r.outline.genIds_r=function(n){n.id=r.internal.newObjectDeferred();for(var a=0;a<n.children.length;a++)this.genIds_r(n.children[a])},r.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},r.outline.renderItems=function(n){for(var a=this.ctx.pdf.internal.getVerticalCoordinateString,o=0;o<n.children.length;o++){var s=n.children[o];this.objStart(s),this.line("/Title "+this.makeString(s.title)),this.line("/Parent "+this.makeRef(n)),o>0&&this.line("/Prev "+this.makeRef(n.children[o-1])),o<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[o+1])),s.children.length>0&&(this.line("/First "+this.makeRef(s.children[0])),this.line("/Last "+this.makeRef(s.children[s.children.length-1])));var l=this.count=this.count_r({count:0},s);if(l>0&&this.line("/Count "+l),s.options&&s.options.pageNumber){var c=r.internal.getPageInfo(s.options.pageNumber);this.line("/Dest ["+c.objId+" 0 R /XYZ 0 "+a(0)+" 0]")}this.objEnd()}for(var u=0;u<n.children.length;u++)this.renderItems(n.children[u])},r.outline.line=function(n){this.ctx.val+=n+`\r
`},r.outline.makeRef=function(n){return n.id+" 0 R"},r.outline.makeString=function(n){return"("+r.internal.pdfEscape(n)+")"},r.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},r.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},r.outline.count_r=function(n,a){for(var o=0;o<a.children.length;o++)n.count++,this.count_r(n,a.children[o]);return n.count}}])}(br.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(r,n,a,o,s,l){var c,u=this.decode.DCT_DECODE,d=null;if(typeof r=="string"||this.__addimage__.isArrayBuffer(r)||this.__addimage__.isArrayBufferView(r)){switch(r=s||r,r=this.__addimage__.isArrayBuffer(r)?new Uint8Array(r):r,(c=function(f){for(var h,p=256*f.charCodeAt(4)+f.charCodeAt(5),v=f.length,m={width:0,height:0,numcomponents:1},y=4;y<v;y+=2){if(y+=p,t.indexOf(f.charCodeAt(y+1))!==-1){h=256*f.charCodeAt(y+5)+f.charCodeAt(y+6),m={width:256*f.charCodeAt(y+7)+f.charCodeAt(y+8),height:h,numcomponents:f.charCodeAt(y+9)};break}p=256*f.charCodeAt(y+2)+f.charCodeAt(y+3)}return m}(r=this.__addimage__.isArrayBufferView(r)?this.__addimage__.arrayBufferToBinaryString(r):r)).numcomponents){case 1:l=this.color_spaces.DEVICE_GRAY;break;case 4:l=this.color_spaces.DEVICE_CMYK;break;case 3:l=this.color_spaces.DEVICE_RGB}d={data:r,width:c.width,height:c.height,colorSpace:l,bitsPerComponent:8,filter:u,index:n,alias:a}}return d}}(br.API);var Au,Rm,XE,JE,ZE,nce=function(){var e,t,r;function n(o){var s,l,c,u,d,f,h,p,v,m,y,b,_,w;for(this.data=o,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},f=null;;){switch(s=this.readUInt32(),v=(function(){var A,P;for(P=[],A=0;A<4;++A)P.push(String.fromCharCode(this.data[this.pos++]));return P}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(s);break;case"fcTL":f&&this.animation.frames.push(f),this.pos+=4,f={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},d=this.readUInt16(),u=this.readUInt16()||100,f.delay=1e3*d/u,f.disposeOp=this.data[this.pos++],f.blendOp=this.data[this.pos++],f.data=[];break;case"IDAT":case"fdAT":for(v==="fdAT"&&(this.pos+=4,s-=4),o=f?.data||this.imgData,b=0;0<=s?b<s:b>s;0<=s?++b:--b)o.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(c=this.palette.length/3,this.transparency.indexed=this.read(s),this.transparency.indexed.length>c)throw new Error("More transparent colors than palette size");if((m=c-this.transparency.indexed.length)>0)for(_=0;0<=m?_<m:_>m;0<=m?++_:--_)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(s)[0];break;case 2:this.transparency.rgb=this.read(s)}break;case"tEXt":h=(y=this.read(s)).indexOf(0),p=String.fromCharCode.apply(String,y.slice(0,h)),this.text[p]=String.fromCharCode.apply(String,y.slice(h+1));break;case"IEND":return f&&this.animation.frames.push(f),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(w=this.colorType)===4||w===6,l=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*l,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=s}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}n.prototype.read=function(o){var s,l;for(l=[],s=0;0<=o?s<o:s>o;0<=o?++s:--s)l.push(this.data[this.pos++]);return l},n.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.decodePixels=function(o){var s=this.pixelBitlength/8,l=new Uint8Array(this.width*this.height*s),c=0,u=this;if(o==null&&(o=this.imgData),o.length===0)return new Uint8Array(0);function d(f,h,p,v){var m,y,b,_,w,A,P,E,T,S,I,U,O,M,L,q,z,K,J,R,k,$=Math.ceil((u.width-f)/p),X=Math.ceil((u.height-h)/v),C=u.width==$&&u.height==X;for(M=s*$,U=C?l:new Uint8Array(M*X),A=o.length,O=0,y=0;O<X&&c<A;){switch(o[c++]){case 0:for(_=z=0;z<M;_=z+=1)U[y++]=o[c++];break;case 1:for(_=K=0;K<M;_=K+=1)m=o[c++],w=_<s?0:U[y-s],U[y++]=(m+w)%256;break;case 2:for(_=J=0;J<M;_=J+=1)m=o[c++],b=(_-_%s)/s,L=O&&U[(O-1)*M+b*s+_%s],U[y++]=(L+m)%256;break;case 3:for(_=R=0;R<M;_=R+=1)m=o[c++],b=(_-_%s)/s,w=_<s?0:U[y-s],L=O&&U[(O-1)*M+b*s+_%s],U[y++]=(m+Math.floor((w+L)/2))%256;break;case 4:for(_=k=0;k<M;_=k+=1)m=o[c++],b=(_-_%s)/s,w=_<s?0:U[y-s],O===0?L=q=0:(L=U[(O-1)*M+b*s+_%s],q=b&&U[(O-1)*M+(b-1)*s+_%s]),P=w+L-q,E=Math.abs(P-w),S=Math.abs(P-L),I=Math.abs(P-q),T=E<=S&&E<=I?w:S<=I?L:q,U[y++]=(m+T)%256;break;default:throw new Error("Invalid filter algorithm: "+o[c-1])}if(!C){var N=((h+O*v)*u.width+f)*s,H=O*M;for(_=0;_<$;_+=1){for(var W=0;W<s;W+=1)l[N++]=U[H++];N+=(p-1)*s}}O++}}return o=Mle(o),u.interlaceMethod==1?(d(0,0,8,8),d(4,0,8,8),d(0,4,4,8),d(2,0,4,4),d(0,2,2,4),d(1,0,2,2),d(0,1,1,2)):d(0,0,1,1),l},n.prototype.decodePalette=function(){var o,s,l,c,u,d,f,h,p;for(l=this.palette,d=this.transparency.indexed||[],u=new Uint8Array((d.length||0)+l.length),c=0,o=0,s=f=0,h=l.length;f<h;s=f+=3)u[c++]=l[s],u[c++]=l[s+1],u[c++]=l[s+2],u[c++]=(p=d[o++])!=null?p:255;return u},n.prototype.copyToImageData=function(o,s){var l,c,u,d,f,h,p,v,m,y,b;if(c=this.colors,m=null,l=this.hasAlphaChannel,this.palette.length&&(m=(b=this._decodedPalette)!=null?b:this._decodedPalette=this.decodePalette(),c=4,l=!0),v=(u=o.data||o).length,f=m||s,d=h=0,c===1)for(;d<v;)p=m?4*s[d/4]:h,y=f[p++],u[d++]=y,u[d++]=y,u[d++]=y,u[d++]=l?f[p++]:255,h=p;else for(;d<v;)p=m?4*s[d/4]:h,u[d++]=f[p++],u[d++]=f[p++],u[d++]=f[p++],u[d++]=l?f[p++]:255,h=p},n.prototype.decode=function(){var o;return o=new Uint8Array(this.width*this.height*4),this.copyToImageData(o,this.decodePixels()),o};var a=function(){if(Object.prototype.toString.call(Cr)==="[object Window]"){try{t=Cr.document.createElement("canvas"),r=t.getContext("2d")}catch{return!1}return!0}return!1};return a(),e=function(o){var s;if(a()===!0)return r.width=o.width,r.height=o.height,r.clearRect(0,0,o.width,o.height),r.putImageData(o,0,0),(s=new Image).src=t.toDataURL(),s;throw new Error("This method requires a Browser with Canvas-capability.")},n.prototype.decodeFrames=function(o){var s,l,c,u,d,f,h,p;if(this.animation){for(p=[],l=d=0,f=(h=this.animation.frames).length;d<f;l=++d)s=h[l],c=o.createImageData(s.width,s.height),u=this.decodePixels(new Uint8Array(s.data)),this.copyToImageData(c,u),s.imageData=c,p.push(s.image=e(c));return p}},n.prototype.renderFrame=function(o,s){var l,c,u;return l=(c=this.animation.frames)[s],u=c[s-1],s===0&&o.clearRect(0,0,this.width,this.height),u?.disposeOp===1?o.clearRect(u.xOffset,u.yOffset,u.width,u.height):u?.disposeOp===2&&o.putImageData(u.imageData,u.xOffset,u.yOffset),l.blendOp===0&&o.clearRect(l.xOffset,l.yOffset,l.width,l.height),o.drawImage(l.image,l.xOffset,l.yOffset)},n.prototype.animate=function(o){var s,l,c,u,d,f,h=this;return l=0,f=this.animation,u=f.numFrames,c=f.frames,d=f.numPlays,(s=function(){var p,v;if(p=l++%u,v=c[p],h.renderFrame(o,p),u>1&&l/u<d)return h.animation._timeout=setTimeout(s,v.delay)})()},n.prototype.stopAnimation=function(){var o;return clearTimeout((o=this.animation)!=null?o._timeout:void 0)},n.prototype.render=function(o){var s,l;return o._png&&o._png.stopAnimation(),o._png=this,o.width=this.width,o.height=this.height,s=o.getContext("2d"),this.animation?(this.decodeFrames(s),this.animate(s)):(l=s.createImageData(this.width,this.height),this.copyToImageData(l,this.decodePixels()),s.putImageData(l,0,0))},n}();/**
 * @license
 *
 * Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 *//**
 * @license
 * (c) Dean McNamee <dean@gmail.com>, 2013.
 *
 * https://github.com/deanm/omggif
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
 * including animation and compression.  It does not rely on any specific
 * underlying system, so should run in the browser, Node, or Plask.
 */function ace(e){var t=0;if(e[t++]!==71||e[t++]!==73||e[t++]!==70||e[t++]!==56||(e[t++]+1&253)!=56||e[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var r=e[t++]|e[t++]<<8,n=e[t++]|e[t++]<<8,a=e[t++],o=a>>7,s=1<<(7&a)+1;e[t++],e[t++];var l=null,c=null;o&&(l=t,c=s,t+=3*s);var u=!0,d=[],f=0,h=null,p=0,v=null;for(this.width=r,this.height=n;u&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(e[t]!==11||e[t+1]==78&&e[t+2]==69&&e[t+3]==84&&e[t+4]==83&&e[t+5]==67&&e[t+6]==65&&e[t+7]==80&&e[t+8]==69&&e[t+9]==50&&e[t+10]==46&&e[t+11]==48&&e[t+12]==3&&e[t+13]==1&&e[t+16]==0)t+=14,v=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((O=e[t++])>=0))throw Error("Invalid block size");if(O===0)break;t+=O}break;case 249:if(e[t++]!==4||e[t+4]!==0)throw new Error("Invalid graphics extension block.");var m=e[t++];f=e[t++]|e[t++]<<8,h=e[t++],(1&m)==0&&(h=null),p=m>>2&7,t++;break;case 254:for(;;){if(!((O=e[t++])>=0))throw Error("Invalid block size");if(O===0)break;t+=O}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var y=e[t++]|e[t++]<<8,b=e[t++]|e[t++]<<8,_=e[t++]|e[t++]<<8,w=e[t++]|e[t++]<<8,A=e[t++],P=A>>6&1,E=1<<(7&A)+1,T=l,S=c,I=!1;A>>7&&(I=!0,T=t,S=E,t+=3*E);var U=t;for(t++;;){var O;if(!((O=e[t++])>=0))throw Error("Invalid block size");if(O===0)break;t+=O}d.push({x:y,y:b,width:_,height:w,has_local_palette:I,palette_offset:T,palette_size:S,data_offset:U,data_length:t-U,transparent_index:h,interlaced:!!P,delay:f,disposal:p});break;case 59:u=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return d.length},this.loopCount=function(){return v},this.frameInfo=function(M){if(M<0||M>=d.length)throw new Error("Frame index out of range.");return d[M]},this.decodeAndBlitFrameBGRA=function(M,L){var q=this.frameInfo(M),z=q.width*q.height,K=new Uint8Array(z);eT(e,q.data_offset,K,z);var J=q.palette_offset,R=q.transparent_index;R===null&&(R=256);var k=q.width,$=r-k,X=k,C=4*(q.y*r+q.x),N=4*((q.y+q.height)*r+q.x),H=C,W=4*$;q.interlaced===!0&&(W+=4*r*7);for(var ne=8,se=0,oe=K.length;se<oe;++se){var ae=K[se];if(X===0&&(X=k,(H+=W)>=N&&(W=4*$+4*r*(ne-1),H=C+(k+$)*(ne<<1),ne>>=1)),ae===R)H+=4;else{var pe=e[J+3*ae],ge=e[J+3*ae+1],Q=e[J+3*ae+2];L[H++]=Q,L[H++]=ge,L[H++]=pe,L[H++]=255}--X}},this.decodeAndBlitFrameRGBA=function(M,L){var q=this.frameInfo(M),z=q.width*q.height,K=new Uint8Array(z);eT(e,q.data_offset,K,z);var J=q.palette_offset,R=q.transparent_index;R===null&&(R=256);var k=q.width,$=r-k,X=k,C=4*(q.y*r+q.x),N=4*((q.y+q.height)*r+q.x),H=C,W=4*$;q.interlaced===!0&&(W+=4*r*7);for(var ne=8,se=0,oe=K.length;se<oe;++se){var ae=K[se];if(X===0&&(X=k,(H+=W)>=N&&(W=4*$+4*r*(ne-1),H=C+(k+$)*(ne<<1),ne>>=1)),ae===R)H+=4;else{var pe=e[J+3*ae],ge=e[J+3*ae+1],Q=e[J+3*ae+2];L[H++]=pe,L[H++]=ge,L[H++]=Q,L[H++]=255}--X}}}function eT(e,t,r,n){for(var a=e[t++],o=1<<a,s=o+1,l=s+1,c=a+1,u=(1<<c)-1,d=0,f=0,h=0,p=e[t++],v=new Int32Array(4096),m=null;;){for(;d<16&&p!==0;)f|=e[t++]<<d,d+=8,p===1?p=e[t++]:--p;if(d<c)break;var y=f&u;if(f>>=c,d-=c,y!==o){if(y===s)break;for(var b=y<l?y:m,_=0,w=b;w>o;)w=v[w]>>8,++_;var A=w;if(h+_+(b!==y?1:0)>n)return void Pn.log("Warning, gif stream longer than expected.");r[h++]=A;var P=h+=_;for(b!==y&&(r[h++]=A),w=b;_--;)w=v[w],r[--P]=255&w,w>>=8;m!==null&&l<4096&&(v[l++]=m<<8|A,l>=u+1&&c<12&&(++c,u=u<<1|1)),m=y}else l=s+1,u=(1<<(c=a+1))-1,m=null}return h!==n&&Pn.log("Warning, gif stream shorter than expected."),r}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function P2(e){var t,r,n,a,o,s=Math.floor,l=new Array(64),c=new Array(64),u=new Array(64),d=new Array(64),f=new Array(65535),h=new Array(65535),p=new Array(64),v=new Array(64),m=[],y=0,b=7,_=new Array(64),w=new Array(64),A=new Array(64),P=new Array(256),E=new Array(2048),T=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],S=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],I=[0,1,2,3,4,5,6,7,8,9,10,11],U=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],O=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],M=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],L=[0,1,2,3,4,5,6,7,8,9,10,11],q=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],z=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function K(C,N){for(var H=0,W=0,ne=new Array,se=1;se<=16;se++){for(var oe=1;oe<=C[se];oe++)ne[N[W]]=[],ne[N[W]][0]=H,ne[N[W]][1]=se,W++,H++;H*=2}return ne}function J(C){for(var N=C[0],H=C[1]-1;H>=0;)N&1<<H&&(y|=1<<b),H--,--b<0&&(y==255?(R(255),R(0)):R(y),b=7,y=0)}function R(C){m.push(C)}function k(C){R(C>>8&255),R(255&C)}function $(C,N,H,W,ne){for(var se,oe=ne[0],ae=ne[240],pe=function(Fe,Qe){var it,st,vt,Ye,Ze,We,wt,It,Ot,Wt,jt=0;for(Ot=0;Ot<8;++Ot){it=Fe[jt],st=Fe[jt+1],vt=Fe[jt+2],Ye=Fe[jt+3],Ze=Fe[jt+4],We=Fe[jt+5],wt=Fe[jt+6];var lr=it+(It=Fe[jt+7]),$e=it-It,He=st+wt,Je=st-wt,Ue=vt+We,ht=vt-We,at=Ye+Ze,St=Ye-Ze,Tt=lr+at,Yt=lr-at,Or=He+Ue,Dr=He-Ue;Fe[jt]=Tt+Or,Fe[jt+4]=Tt-Or;var tr=.707106781*(Dr+Yt);Fe[jt+2]=Yt+tr,Fe[jt+6]=Yt-tr;var wr=.382683433*((Tt=St+ht)-(Dr=Je+$e)),Ir=.5411961*Tt+wr,dn=1.306562965*Dr+wr,ka=.707106781*(Or=ht+Je),En=$e+ka,Zt=$e-ka;Fe[jt+5]=Zt+Ir,Fe[jt+3]=Zt-Ir,Fe[jt+1]=En+dn,Fe[jt+7]=En-dn,jt+=8}for(jt=0,Ot=0;Ot<8;++Ot){it=Fe[jt],st=Fe[jt+8],vt=Fe[jt+16],Ye=Fe[jt+24],Ze=Fe[jt+32],We=Fe[jt+40],wt=Fe[jt+48];var Xr=it+(It=Fe[jt+56]),Gn=it-It,Tn=st+wt,Wr=st-wt,en=vt+We,Se=vt-We,Ge=Ye+Ze,_e=Ye-Ze,Te=Xr+Ge,nt=Xr-Ge,mt=Tn+en,Mt=Tn-en;Fe[jt]=Te+mt,Fe[jt+32]=Te-mt;var Nr=.707106781*(Mt+nt);Fe[jt+16]=nt+Nr,Fe[jt+48]=nt-Nr;var Ar=.382683433*((Te=_e+Se)-(Mt=Wr+Gn)),$r=.5411961*Te+Ar,Vr=1.306562965*Mt+Ar,In=.707106781*(mt=Se+Wr),$n=Gn+In,ca=Gn-In;Fe[jt+40]=ca+$r,Fe[jt+24]=ca-$r,Fe[jt+8]=$n+Vr,Fe[jt+56]=$n-Vr,jt++}for(Ot=0;Ot<64;++Ot)Wt=Fe[Ot]*Qe[Ot],p[Ot]=Wt>0?Wt+.5|0:Wt-.5|0;return p}(C,N),ge=0;ge<64;++ge)v[T[ge]]=pe[ge];var Q=v[0]-H;H=v[0],Q==0?J(W[0]):(J(W[h[se=32767+Q]]),J(f[se]));for(var G=63;G>0&&v[G]==0;)G--;if(G==0)return J(oe),H;for(var ee,le=1;le<=G;){for(var V=le;v[le]==0&&le<=G;)++le;var Ve=le-V;if(Ve>=16){ee=Ve>>4;for(var Me=1;Me<=ee;++Me)J(ae);Ve&=15}se=32767+v[le],J(ne[(Ve<<4)+h[se]]),J(f[se]),le++}return G!=63&&J(oe),H}function X(C){C=Math.min(Math.max(C,1),100),o!=C&&(function(N){for(var H=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],W=0;W<64;W++){var ne=s((H[W]*N+50)/100);ne=Math.min(Math.max(ne,1),255),l[T[W]]=ne}for(var se=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],oe=0;oe<64;oe++){var ae=s((se[oe]*N+50)/100);ae=Math.min(Math.max(ae,1),255),c[T[oe]]=ae}for(var pe=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],ge=0,Q=0;Q<8;Q++)for(var G=0;G<8;G++)u[ge]=1/(l[T[ge]]*pe[Q]*pe[G]*8),d[ge]=1/(c[T[ge]]*pe[Q]*pe[G]*8),ge++}(C<50?Math.floor(5e3/C):Math.floor(200-2*C)),o=C)}this.encode=function(C,N){N&&X(N),m=new Array,y=0,b=7,k(65496),k(65504),k(16),R(74),R(70),R(73),R(70),R(0),R(1),R(1),R(0),k(1),k(1),R(0),R(0),function(){k(65499),k(132),R(0);for(var st=0;st<64;st++)R(l[st]);R(1);for(var vt=0;vt<64;vt++)R(c[vt])}(),function(st,vt){k(65472),k(17),R(8),k(vt),k(st),R(3),R(1),R(17),R(0),R(2),R(17),R(1),R(3),R(17),R(1)}(C.width,C.height),function(){k(65476),k(418),R(0);for(var st=0;st<16;st++)R(S[st+1]);for(var vt=0;vt<=11;vt++)R(I[vt]);R(16);for(var Ye=0;Ye<16;Ye++)R(U[Ye+1]);for(var Ze=0;Ze<=161;Ze++)R(O[Ze]);R(1);for(var We=0;We<16;We++)R(M[We+1]);for(var wt=0;wt<=11;wt++)R(L[wt]);R(17);for(var It=0;It<16;It++)R(q[It+1]);for(var Ot=0;Ot<=161;Ot++)R(z[Ot])}(),k(65498),k(12),R(3),R(1),R(0),R(2),R(17),R(3),R(17),R(0),R(63),R(0);var H=0,W=0,ne=0;y=0,b=7,this.encode.displayName="_encode_";for(var se,oe,ae,pe,ge,Q,G,ee,le,V=C.data,Ve=C.width,Me=C.height,Fe=4*Ve,Qe=0;Qe<Me;){for(se=0;se<Fe;){for(ge=Fe*Qe+se,G=-1,ee=0,le=0;le<64;le++)Q=ge+(ee=le>>3)*Fe+(G=4*(7&le)),Qe+ee>=Me&&(Q-=Fe*(Qe+1+ee-Me)),se+G>=Fe&&(Q-=se+G-Fe+4),oe=V[Q++],ae=V[Q++],pe=V[Q++],_[le]=(E[oe]+E[ae+256>>0]+E[pe+512>>0]>>16)-128,w[le]=(E[oe+768>>0]+E[ae+1024>>0]+E[pe+1280>>0]>>16)-128,A[le]=(E[oe+1280>>0]+E[ae+1536>>0]+E[pe+1792>>0]>>16)-128;H=$(_,u,H,t,n),W=$(w,d,W,r,a),ne=$(A,d,ne,r,a),se+=32}Qe+=8}if(b>=0){var it=[];it[1]=b+1,it[0]=(1<<b+1)-1,J(it)}return k(65497),new Uint8Array(m)},e=e||50,function(){for(var C=String.fromCharCode,N=0;N<256;N++)P[N]=C(N)}(),t=K(S,I),r=K(M,L),n=K(U,O),a=K(q,z),function(){for(var C=1,N=2,H=1;H<=15;H++){for(var W=C;W<N;W++)h[32767+W]=H,f[32767+W]=[],f[32767+W][1]=H,f[32767+W][0]=W;for(var ne=-(N-1);ne<=-C;ne++)h[32767+ne]=H,f[32767+ne]=[],f[32767+ne][1]=H,f[32767+ne][0]=N-1+ne;C<<=1,N<<=1}}(),function(){for(var C=0;C<256;C++)E[C]=19595*C,E[C+256>>0]=38470*C,E[C+512>>0]=7471*C+32768,E[C+768>>0]=-11059*C,E[C+1024>>0]=-21709*C,E[C+1280>>0]=32768*C+8421375,E[C+1536>>0]=-27439*C,E[C+1792>>0]=-5329*C}(),X(e)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function es(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function tT(e){function t(S){if(!S)throw Error("assert :P")}function r(S,I,U){for(var O=0;4>O;O++)if(S[I+O]!=U.charCodeAt(O))return!0;return!1}function n(S,I,U,O,M){for(var L=0;L<M;L++)S[I+L]=U[O+L]}function a(S,I,U,O){for(var M=0;M<O;M++)S[I+M]=U}function o(S){return new Int32Array(S)}function s(S,I){for(var U=[],O=0;O<S;O++)U.push(new I);return U}function l(S,I){var U=[];return function O(M,L,q){for(var z=q[L],K=0;K<z&&(M.push(q.length>L+1?[]:new I),!(q.length<L+1));K++)O(M[K],L+1,q)}(U,0,S),U}var c=function(){var S=this;function I(g,j){for(var F=1<<j-1>>>0;g&F;)F>>>=1;return F?(g&F-1)+F:g}function U(g,j,F,Y,te){t(!(Y%F));do g[j+(Y-=F)]=te;while(0<Y)}function O(g,j,F,Y,te){if(t(2328>=te),512>=te)var ce=o(512);else if((ce=o(te))==null)return 0;return function(ue,fe,ye,we,Re,et){var tt,ze,xt=fe,ct=1<<ye,qe=o(16),Be=o(16);for(t(Re!=0),t(we!=null),t(ue!=null),t(0<ye),ze=0;ze<Re;++ze){if(15<we[ze])return 0;++qe[we[ze]]}if(qe[0]==Re)return 0;for(Be[1]=0,tt=1;15>tt;++tt){if(qe[tt]>1<<tt)return 0;Be[tt+1]=Be[tt]+qe[tt]}for(ze=0;ze<Re;++ze)tt=we[ze],0<we[ze]&&(et[Be[tt]++]=ze);if(Be[15]==1)return(we=new M).g=0,we.value=et[0],U(ue,xt,1,ct,we),ct;var gt,Ct=-1,yt=ct-1,Gt=0,$t=1,pr=1,Ut=1<<ye;for(ze=0,tt=1,Re=2;tt<=ye;++tt,Re<<=1){if($t+=pr<<=1,0>(pr-=qe[tt]))return 0;for(;0<qe[tt];--qe[tt])(we=new M).g=tt,we.value=et[ze++],U(ue,xt+Gt,Re,Ut,we),Gt=I(Gt,tt)}for(tt=ye+1,Re=2;15>=tt;++tt,Re<<=1){if($t+=pr<<=1,0>(pr-=qe[tt]))return 0;for(;0<qe[tt];--qe[tt]){if(we=new M,(Gt&yt)!=Ct){for(xt+=Ut,gt=1<<(Ct=tt)-ye;15>Ct&&!(0>=(gt-=qe[Ct]));)++Ct,gt<<=1;ct+=Ut=1<<(gt=Ct-ye),ue[fe+(Ct=Gt&yt)].g=gt+ye,ue[fe+Ct].value=xt-fe-Ct}we.g=tt-ye,we.value=et[ze++],U(ue,xt+(Gt>>ye),Re,Ut,we),Gt=I(Gt,tt)}}return $t!=2*Be[15]-1?0:ct}(g,j,F,Y,te,ce)}function M(){this.value=this.g=0}function L(){this.value=this.g=0}function q(){this.G=s(5,M),this.H=o(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=s(ua,L)}function z(g,j,F,Y){t(g!=null),t(j!=null),t(2147483648>Y),g.Ca=254,g.I=0,g.b=-8,g.Ka=0,g.oa=j,g.pa=F,g.Jd=j,g.Yc=F+Y,g.Zc=4<=Y?F+Y-4+1:F,se(g)}function K(g,j){for(var F=0;0<j--;)F|=ae(g,128)<<j;return F}function J(g,j){var F=K(g,j);return oe(g)?-F:F}function R(g,j,F,Y){var te,ce=0;for(t(g!=null),t(j!=null),t(4294967288>Y),g.Sb=Y,g.Ra=0,g.u=0,g.h=0,4<Y&&(Y=4),te=0;te<Y;++te)ce+=j[F+te]<<8*te;g.Ra=ce,g.bb=Y,g.oa=j,g.pa=F}function k(g){for(;8<=g.u&&g.bb<g.Sb;)g.Ra>>>=8,g.Ra+=g.oa[g.pa+g.bb]<<he-8>>>0,++g.bb,g.u-=8;H(g)&&(g.h=1,g.u=0)}function $(g,j){if(t(0<=j),!g.h&&j<=de){var F=N(g)&El[j];return g.u+=j,k(g),F}return g.h=1,g.u=0}function X(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function C(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function N(g){return g.Ra>>>(g.u&he-1)>>>0}function H(g){return t(g.bb<=g.Sb),g.h||g.bb==g.Sb&&g.u>he}function W(g,j){g.u=j,g.h=H(g)}function ne(g){g.u>=Ee&&(t(g.u>=Ee),k(g))}function se(g){t(g!=null&&g.oa!=null),g.pa<g.Zc?(g.I=(g.oa[g.pa++]|g.I<<8)>>>0,g.b+=8):(t(g!=null&&g.oa!=null),g.pa<g.Yc?(g.b+=8,g.I=g.oa[g.pa++]|g.I<<8):g.Ka?g.b=0:(g.I<<=8,g.b+=8,g.Ka=1))}function oe(g){return K(g,1)}function ae(g,j){var F=g.Ca;0>g.b&&se(g);var Y=g.b,te=F*j>>>8,ce=(g.I>>>Y>te)+0;for(ce?(F-=te,g.I-=te+1<<Y>>>0):F=te+1,Y=F,te=0;256<=Y;)te+=8,Y>>=8;return Y=7^te+ke[Y],g.b-=Y,g.Ca=(F<<Y)-1,ce}function pe(g,j,F){g[j+0]=F>>24&255,g[j+1]=F>>16&255,g[j+2]=F>>8&255,g[j+3]=F>>0&255}function ge(g,j){return g[j+0]<<0|g[j+1]<<8}function Q(g,j){return ge(g,j)|g[j+2]<<16}function G(g,j){return ge(g,j)|ge(g,j+2)<<16}function ee(g,j){var F=1<<j;return t(g!=null),t(0<j),g.X=o(F),g.X==null?0:(g.Mb=32-j,g.Xa=j,1)}function le(g,j){t(g!=null),t(j!=null),t(g.Xa==j.Xa),n(j.X,0,g.X,0,1<<j.Xa)}function V(){this.X=[],this.Xa=this.Mb=0}function Ve(g,j,F,Y){t(F!=null),t(Y!=null);var te=F[0],ce=Y[0];return te==0&&(te=(g*ce+j/2)/j),ce==0&&(ce=(j*te+g/2)/g),0>=te||0>=ce?0:(F[0]=te,Y[0]=ce,1)}function Me(g,j){return g+(1<<j)-1>>>j}function Fe(g,j){return((4278255360&g)+(4278255360&j)>>>0&4278255360)+((16711935&g)+(16711935&j)>>>0&16711935)>>>0}function Qe(g,j){S[j]=function(F,Y,te,ce,ue,fe,ye){var we;for(we=0;we<ue;++we){var Re=S[g](fe[ye+we-1],te,ce+we);fe[ye+we]=Fe(F[Y+we],Re)}}}function it(){this.ud=this.hd=this.jd=0}function st(g,j){return((4278124286&(g^j))>>>1)+(g&j)>>>0}function vt(g){return 0<=g&&256>g?g:0>g?0:255<g?255:void 0}function Ye(g,j){return vt(g+(g-j+.5>>1))}function Ze(g,j,F){return Math.abs(j-F)-Math.abs(g-F)}function We(g,j,F,Y,te,ce,ue){for(Y=ce[ue-1],F=0;F<te;++F)ce[ue+F]=Y=Fe(g[j+F],Y)}function wt(g,j,F,Y,te){var ce;for(ce=0;ce<F;++ce){var ue=g[j+ce],fe=ue>>8&255,ye=16711935&(ye=(ye=16711935&ue)+((fe<<16)+fe));Y[te+ce]=(4278255360&ue)+ye>>>0}}function It(g,j){j.jd=g>>0&255,j.hd=g>>8&255,j.ud=g>>16&255}function Ot(g,j,F,Y,te,ce){var ue;for(ue=0;ue<Y;++ue){var fe=j[F+ue],ye=fe>>>8,we=fe,Re=255&(Re=(Re=fe>>>16)+((g.jd<<24>>24)*(ye<<24>>24)>>>5));we=255&(we=(we=we+((g.hd<<24>>24)*(ye<<24>>24)>>>5))+((g.ud<<24>>24)*(Re<<24>>24)>>>5)),te[ce+ue]=(4278255360&fe)+(Re<<16)+we}}function Wt(g,j,F,Y,te){S[j]=function(ce,ue,fe,ye,we,Re,et,tt,ze){for(ye=et;ye<tt;++ye)for(et=0;et<ze;++et)we[Re++]=te(fe[Y(ce[ue++])])},S[g]=function(ce,ue,fe,ye,we,Re,et){var tt=8>>ce.b,ze=ce.Ea,xt=ce.K[0],ct=ce.w;if(8>tt)for(ce=(1<<ce.b)-1,ct=(1<<tt)-1;ue<fe;++ue){var qe,Be=0;for(qe=0;qe<ze;++qe)qe&ce||(Be=Y(ye[we++])),Re[et++]=te(xt[Be&ct]),Be>>=tt}else S["VP8LMapColor"+F](ye,we,xt,ct,Re,et,ue,fe,ze)}}function jt(g,j,F,Y,te){for(F=j+F;j<F;){var ce=g[j++];Y[te++]=ce>>16&255,Y[te++]=ce>>8&255,Y[te++]=ce>>0&255}}function lr(g,j,F,Y,te){for(F=j+F;j<F;){var ce=g[j++];Y[te++]=ce>>16&255,Y[te++]=ce>>8&255,Y[te++]=ce>>0&255,Y[te++]=ce>>24&255}}function $e(g,j,F,Y,te){for(F=j+F;j<F;){var ce=(ue=g[j++])>>16&240|ue>>12&15,ue=ue>>0&240|ue>>28&15;Y[te++]=ce,Y[te++]=ue}}function He(g,j,F,Y,te){for(F=j+F;j<F;){var ce=(ue=g[j++])>>16&248|ue>>13&7,ue=ue>>5&224|ue>>3&31;Y[te++]=ce,Y[te++]=ue}}function Je(g,j,F,Y,te){for(F=j+F;j<F;){var ce=g[j++];Y[te++]=ce>>0&255,Y[te++]=ce>>8&255,Y[te++]=ce>>16&255}}function Ue(g,j,F,Y,te,ce){if(ce==0)for(F=j+F;j<F;)pe(Y,((ce=g[j++])[0]>>24|ce[1]>>8&65280|ce[2]<<8&16711680|ce[3]<<24)>>>0),te+=32;else n(Y,te,g,j,F)}function ht(g,j){S[j][0]=S[g+"0"],S[j][1]=S[g+"1"],S[j][2]=S[g+"2"],S[j][3]=S[g+"3"],S[j][4]=S[g+"4"],S[j][5]=S[g+"5"],S[j][6]=S[g+"6"],S[j][7]=S[g+"7"],S[j][8]=S[g+"8"],S[j][9]=S[g+"9"],S[j][10]=S[g+"10"],S[j][11]=S[g+"11"],S[j][12]=S[g+"12"],S[j][13]=S[g+"13"],S[j][14]=S[g+"0"],S[j][15]=S[g+"0"]}function at(g){return g==By||g==Uy||g==Zp||g==zy}function St(){this.eb=[],this.size=this.A=this.fb=0}function Tt(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Yt(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new St,this.f.kb=new Tt,this.sd=null}function Or(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Dr(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function tr(g){return alert("todo:WebPSamplerProcessPlane"),g.T}function wr(g,j){var F=g.T,Y=j.ba.f.RGBA,te=Y.eb,ce=Y.fb+g.ka*Y.A,ue=qo[j.ba.S],fe=g.y,ye=g.O,we=g.f,Re=g.N,et=g.ea,tt=g.W,ze=j.cc,xt=j.dc,ct=j.Mc,qe=j.Nc,Be=g.ka,gt=g.ka+g.T,Ct=g.U,yt=Ct+1>>1;for(Be==0?ue(fe,ye,null,null,we,Re,et,tt,we,Re,et,tt,te,ce,null,null,Ct):(ue(j.ec,j.fc,fe,ye,ze,xt,ct,qe,we,Re,et,tt,te,ce-Y.A,te,ce,Ct),++F);Be+2<gt;Be+=2)ze=we,xt=Re,ct=et,qe=tt,Re+=g.Rc,tt+=g.Rc,ce+=2*Y.A,ue(fe,(ye+=2*g.fa)-g.fa,fe,ye,ze,xt,ct,qe,we,Re,et,tt,te,ce-Y.A,te,ce,Ct);return ye+=g.fa,g.j+gt<g.o?(n(j.ec,j.fc,fe,ye,Ct),n(j.cc,j.dc,we,Re,yt),n(j.Mc,j.Nc,et,tt,yt),F--):1&gt||ue(fe,ye,null,null,we,Re,et,tt,we,Re,et,tt,te,ce+Y.A,null,null,Ct),F}function Ir(g,j,F){var Y=g.F,te=[g.J];if(Y!=null){var ce=g.U,ue=j.ba.S,fe=ue==Jp||ue==Zp;j=j.ba.f.RGBA;var ye=[0],we=g.ka;ye[0]=g.T,g.Kb&&(we==0?--ye[0]:(--we,te[0]-=g.width),g.j+g.ka+g.T==g.o&&(ye[0]=g.o-g.j-we));var Re=j.eb;we=j.fb+we*j.A,g=Ln(Y,te[0],g.width,ce,ye,Re,we+(fe?0:3),j.A),t(F==ye),g&&at(ue)&&Lo(Re,we,fe,ce,ye,j.A)}return 0}function dn(g){var j=g.ma,F=j.ba.S,Y=11>F,te=F==Qp||F==Xp||F==Jp||F==$y||F==12||at(F);if(j.memory=null,j.Ib=null,j.Jb=null,j.Nd=null,!gc(j.Oa,g,te?11:12))return 0;if(te&&at(F)&&At(),g.da)alert("todo:use_scaling");else{if(Y){if(j.Ib=tr,g.Kb){if(F=g.U+1>>1,j.memory=o(g.U+2*F),j.memory==null)return 0;j.ec=j.memory,j.fc=0,j.cc=j.ec,j.dc=j.fc+g.U,j.Mc=j.cc,j.Nc=j.dc+F,j.Ib=wr,At()}}else alert("todo:EmitYUV");te&&(j.Jb=Ir,Y&&Ke())}if(Y&&!NS){for(g=0;256>g;++g)RR[g]=89858*(g-128)+tm>>em,$R[g]=-22014*(g-128)+tm,FR[g]=-45773*(g-128),qR[g]=113618*(g-128)+tm>>em;for(g=Qd;g<Vy;++g)j=76283*(g-16)+tm>>em,BR[g-Qd]=ki(j,255),UR[g-Qd]=ki(j+8>>4,15);NS=1}return 1}function ka(g){var j=g.ma,F=g.U,Y=g.T;return t(!(1&g.ka)),0>=F||0>=Y?0:(F=j.Ib(g,j),j.Jb!=null&&j.Jb(g,j,F),j.Dc+=F,1)}function En(g){g.ma.memory=null}function Zt(g,j,F,Y){return $(g,8)!=47?0:(j[0]=$(g,14)+1,F[0]=$(g,14)+1,Y[0]=$(g,1),$(g,3)!=0?0:!g.h)}function Xr(g,j){if(4>g)return g+1;var F=g-2>>1;return(2+(1&g)<<F)+$(j,F)+1}function Gn(g,j){return 120<j?j-120:1<=(F=((F=jR[j-1])>>4)*g+(8-(15&F)))?F:1;var F}function Tn(g,j,F){var Y=N(F),te=g[j+=255&Y].g-8;return 0<te&&(W(F,F.u+8),Y=N(F),j+=g[j].value,j+=Y&(1<<te)-1),W(F,F.u+g[j].g),g[j].value}function Wr(g,j,F){return F.g+=g.g,F.value+=g.value<<j>>>0,t(8>=F.g),g.g}function en(g,j,F){var Y=g.xc;return t((j=Y==0?0:g.vc[g.md*(F>>Y)+(j>>Y)])<g.Wb),g.Ya[j]}function Se(g,j,F,Y){var te=g.ab,ce=g.c*j,ue=g.C;j=ue+j;var fe=F,ye=Y;for(Y=g.Ta,F=g.Ua;0<te--;){var we=g.gc[te],Re=ue,et=j,tt=fe,ze=ye,xt=(ye=Y,fe=F,we.Ea);switch(t(Re<et),t(et<=we.nc),we.hc){case 2:Bt(tt,ze,(et-Re)*xt,ye,fe);break;case 0:var ct=Re,qe=et,Be=ye,gt=fe,Ct=(Ut=we).Ea;ct==0&&(rt(tt,ze,null,null,1,Be,gt),We(tt,ze+1,0,0,Ct-1,Be,gt+1),ze+=Ct,gt+=Ct,++ct);for(var yt=1<<Ut.b,Gt=yt-1,$t=Me(Ct,Ut.b),pr=Ut.K,Ut=Ut.w+(ct>>Ut.b)*$t;ct<qe;){var hn=pr,bn=Ut,rn=1;for(_t(tt,ze,Be,gt-Ct,1,Be,gt);rn<Ct;){var Qr=(rn&~Gt)+yt;Qr>Ct&&(Qr=Ct),(0,Vi[hn[bn++]>>8&15])(tt,ze+ +rn,Be,gt+rn-Ct,Qr-rn,Be,gt+rn),rn=Qr}ze+=Ct,gt+=Ct,++ct&Gt||(Ut+=$t)}et!=we.nc&&n(ye,fe-xt,ye,fe+(et-Re-1)*xt,xt);break;case 1:for(xt=tt,qe=ze,Ct=(tt=we.Ea)-(gt=tt&~(Be=(ze=1<<we.b)-1)),ct=Me(tt,we.b),yt=we.K,we=we.w+(Re>>we.b)*ct;Re<et;){for(Gt=yt,$t=we,pr=new it,Ut=qe+gt,hn=qe+tt;qe<Ut;)It(Gt[$t++],pr),Ws(pr,xt,qe,ze,ye,fe),qe+=ze,fe+=ze;qe<hn&&(It(Gt[$t++],pr),Ws(pr,xt,qe,Ct,ye,fe),qe+=Ct,fe+=Ct),++Re&Be||(we+=ct)}break;case 3:if(tt==ye&&ze==fe&&0<we.b){for(qe=ye,tt=xt=fe+(et-Re)*xt-(gt=(et-Re)*Me(we.Ea,we.b)),ze=ye,Be=fe,ct=[],gt=(Ct=gt)-1;0<=gt;--gt)ct[gt]=ze[Be+gt];for(gt=Ct-1;0<=gt;--gt)qe[tt+gt]=ct[gt];Nt(we,Re,et,ye,xt,ye,fe)}else Nt(we,Re,et,tt,ze,ye,fe)}fe=Y,ye=F}ye!=F&&n(Y,F,fe,ye,ce)}function Ge(g,j){var F=g.V,Y=g.Ba+g.c*g.C,te=j-g.C;if(t(j<=g.l.o),t(16>=te),0<te){var ce=g.l,ue=g.Ta,fe=g.Ua,ye=ce.width;if(Se(g,te,F,Y),te=fe=[fe],t((F=g.C)<(Y=j)),t(ce.v<ce.va),Y>ce.o&&(Y=ce.o),F<ce.j){var we=ce.j-F;F=ce.j,te[0]+=we*ye}if(F>=Y?F=0:(te[0]+=4*ce.v,ce.ka=F-ce.j,ce.U=ce.va-ce.v,ce.T=Y-F,F=1),F){if(fe=fe[0],11>(F=g.ca).S){var Re=F.f.RGBA,et=(Y=F.S,te=ce.U,ce=ce.T,we=Re.eb,Re.A),tt=ce;for(Re=Re.fb+g.Ma*Re.A;0<tt--;){var ze=ue,xt=fe,ct=te,qe=we,Be=Re;switch(Y){case Kp:Gi(ze,xt,ct,qe,Be);break;case Qp:Ei(ze,xt,ct,qe,Be);break;case By:Ei(ze,xt,ct,qe,Be),Lo(qe,Be,0,ct,1,0);break;case SS:Vs(ze,xt,ct,qe,Be);break;case Xp:Ue(ze,xt,ct,qe,Be,1);break;case Uy:Ue(ze,xt,ct,qe,Be,1),Lo(qe,Be,0,ct,1,0);break;case Jp:Ue(ze,xt,ct,qe,Be,0);break;case Zp:Ue(ze,xt,ct,qe,Be,0),Lo(qe,Be,1,ct,1,0);break;case $y:Tl(ze,xt,ct,qe,Be);break;case zy:Tl(ze,xt,ct,qe,Be),Mn(qe,Be,ct,1,0);break;case CS:Hs(ze,xt,ct,qe,Be);break;default:t(0)}fe+=ye,Re+=et}g.Ma+=ce}else alert("todo:EmitRescaledRowsYUVA");t(g.Ma<=F.height)}}g.C=j,t(g.C<=g.i)}function _e(g){var j;if(0<g.ua)return 0;for(j=0;j<g.Wb;++j){var F=g.Ya[j].G,Y=g.Ya[j].H;if(0<F[1][Y[1]+0].g||0<F[2][Y[2]+0].g||0<F[3][Y[3]+0].g)return 0}return 1}function Te(g,j,F,Y,te,ce){if(g.Z!=0){var ue=g.qd,fe=g.rd;for(t(Ml[g.Z]!=null);j<F;++j)Ml[g.Z](ue,fe,Y,te,Y,te,ce),ue=Y,fe=te,te+=ce;g.qd=ue,g.rd=fe}}function nt(g,j){var F=g.l.ma,Y=F.Z==0||F.Z==1?g.l.j:g.C;if(Y=g.C<Y?Y:g.C,t(j<=g.l.o),j>Y){var te=g.l.width,ce=F.ca,ue=F.tb+te*Y,fe=g.V,ye=g.Ba+g.c*Y,we=g.gc;t(g.ab==1),t(we[0].hc==3),Kn(we[0],Y,j,fe,ye,ce,ue),Te(F,Y,j,ce,ue,te)}g.C=g.Ma=j}function mt(g,j,F,Y,te,ce,ue){var fe=g.$/Y,ye=g.$%Y,we=g.m,Re=g.s,et=F+g.$,tt=et;te=F+Y*te;var ze=F+Y*ce,xt=280+Re.ua,ct=g.Pb?fe:16777216,qe=0<Re.ua?Re.Wa:null,Be=Re.wc,gt=et<ze?en(Re,ye,fe):null;t(g.C<ce),t(ze<=te);var Ct=!1;e:for(;;){for(;Ct||et<ze;){var yt=0;if(fe>=ct){var Gt=et-F;t((ct=g).Pb),ct.wd=ct.m,ct.xd=Gt,0<ct.s.ua&&le(ct.s.Wa,ct.s.vb),ct=fe+CR}if(ye&Be||(gt=en(Re,ye,fe)),t(gt!=null),gt.Qb&&(j[et]=gt.qb,Ct=!0),!Ct)if(ne(we),gt.jc){yt=we,Gt=j;var $t=et,pr=gt.pd[N(yt)&ua-1];t(gt.jc),256>pr.g?(W(yt,yt.u+pr.g),Gt[$t]=pr.value,yt=0):(W(yt,yt.u+pr.g-256),t(256<=pr.value),yt=pr.value),yt==0&&(Ct=!0)}else yt=Tn(gt.G[0],gt.H[0],we);if(we.h)break;if(Ct||256>yt){if(!Ct)if(gt.nd)j[et]=(gt.qb|yt<<8)>>>0;else{if(ne(we),Ct=Tn(gt.G[1],gt.H[1],we),ne(we),Gt=Tn(gt.G[2],gt.H[2],we),$t=Tn(gt.G[3],gt.H[3],we),we.h)break;j[et]=($t<<24|Ct<<16|yt<<8|Gt)>>>0}if(Ct=!1,++et,++ye>=Y&&(ye=0,++fe,ue!=null&&fe<=ce&&!(fe%16)&&ue(g,fe),qe!=null))for(;tt<et;)yt=j[tt++],qe.X[(506832829*yt&4294967295)>>>qe.Mb]=yt}else if(280>yt){if(yt=Xr(yt-256,we),Gt=Tn(gt.G[4],gt.H[4],we),ne(we),Gt=Gn(Y,Gt=Xr(Gt,we)),we.h)break;if(et-F<Gt||te-et<yt)break e;for($t=0;$t<yt;++$t)j[et+$t]=j[et+$t-Gt];for(et+=yt,ye+=yt;ye>=Y;)ye-=Y,++fe,ue!=null&&fe<=ce&&!(fe%16)&&ue(g,fe);if(t(et<=te),ye&Be&&(gt=en(Re,ye,fe)),qe!=null)for(;tt<et;)yt=j[tt++],qe.X[(506832829*yt&4294967295)>>>qe.Mb]=yt}else{if(!(yt<xt))break e;for(Ct=yt-280,t(qe!=null);tt<et;)yt=j[tt++],qe.X[(506832829*yt&4294967295)>>>qe.Mb]=yt;yt=et,t(!(Ct>>>(Gt=qe).Xa)),j[yt]=Gt.X[Ct],Ct=!0}Ct||t(we.h==H(we))}if(g.Pb&&we.h&&et<te)t(g.m.h),g.a=5,g.m=g.wd,g.$=g.xd,0<g.s.ua&&le(g.s.vb,g.s.Wa);else{if(we.h)break e;ue?.(g,fe>ce?ce:fe),g.a=0,g.$=et-F}return 1}return g.a=3,0}function Mt(g){t(g!=null),g.vc=null,g.yc=null,g.Ya=null;var j=g.Wa;j!=null&&(j.X=null),g.vb=null,t(g!=null)}function Nr(){var g=new Oi;return g==null?null:(g.a=0,g.xb=OS,ht("Predictor","VP8LPredictors"),ht("Predictor","VP8LPredictors_C"),ht("PredictorAdd","VP8LPredictorsAdd"),ht("PredictorAdd","VP8LPredictorsAdd_C"),Bt=wt,Ws=Ot,Gi=jt,Ei=lr,Tl=$e,Hs=He,Vs=Je,S.VP8LMapColor32b=cr,S.VP8LMapColor8b=ya,g)}function Ar(g,j,F,Y,te){var ce=1,ue=[g],fe=[j],ye=Y.m,we=Y.s,Re=null,et=0;e:for(;;){if(F)for(;ce&&$(ye,1);){var tt=ue,ze=fe,xt=Y,ct=1,qe=xt.m,Be=xt.gc[xt.ab],gt=$(qe,2);if(xt.Oc&1<<gt)ce=0;else{switch(xt.Oc|=1<<gt,Be.hc=gt,Be.Ea=tt[0],Be.nc=ze[0],Be.K=[null],++xt.ab,t(4>=xt.ab),gt){case 0:case 1:Be.b=$(qe,3)+2,ct=Ar(Me(Be.Ea,Be.b),Me(Be.nc,Be.b),0,xt,Be.K),Be.K=Be.K[0];break;case 3:var Ct,yt=$(qe,8)+1,Gt=16<yt?0:4<yt?1:2<yt?2:3;if(tt[0]=Me(Be.Ea,Gt),Be.b=Gt,Ct=ct=Ar(yt,1,0,xt,Be.K)){var $t,pr=yt,Ut=Be,hn=1<<(8>>Ut.b),bn=o(hn);if(bn==null)Ct=0;else{var rn=Ut.K[0],Qr=Ut.w;for(bn[0]=Ut.K[0][0],$t=1;$t<1*pr;++$t)bn[$t]=Fe(rn[Qr+$t],bn[$t-1]);for(;$t<4*hn;++$t)bn[$t]=0;Ut.K[0]=null,Ut.K[0]=bn,Ct=1}}ct=Ct;break;case 2:break;default:t(0)}ce=ct}}if(ue=ue[0],fe=fe[0],ce&&$(ye,1)&&!(ce=1<=(et=$(ye,4))&&11>=et)){Y.a=3;break e}var An;if(An=ce)t:{var jn,Br,Da,Yi=Y,Ma=ue,Ki=fe,_n=et,po=F,mo=Yi.m,Ka=Yi.s,oi=[null],Ii=1,Fo=0,ms=SR[_n];r:for(;;){if(po&&$(mo,1)){var Qa=$(mo,3)+2,Qs=Me(Ma,Qa),_c=Me(Ki,Qa),mu=Qs*_c;if(!Ar(Qs,_c,0,Yi,oi))break r;for(oi=oi[0],Ka.xc=Qa,jn=0;jn<mu;++jn){var Ll=oi[jn]>>8&65535;oi[jn]=Ll,Ll>=Ii&&(Ii=Ll+1)}}if(mo.h)break r;for(Br=0;5>Br;++Br){var da=AS[Br];!Br&&0<_n&&(da+=1<<_n),Fo<da&&(Fo=da)}var Gy=s(Ii*ms,M),LS=Ii,RS=s(LS,q);if(RS==null)var nm=null;else t(65536>=LS),nm=RS;var Xd=o(Fo);if(nm==null||Xd==null||Gy==null){Yi.a=1;break r}var am=Gy;for(jn=Da=0;jn<Ii;++jn){var Xo=nm[jn],gu=Xo.G,vu=Xo.H,qS=0,im=1,FS=0;for(Br=0;5>Br;++Br){da=AS[Br],gu[Br]=am,vu[Br]=Da,!Br&&0<_n&&(da+=1<<_n);a:{var om,Yy=da,sm=Yi,Jd=Xd,HR=am,VR=Da,Ky=0,Rl=sm.m,GR=$(Rl,1);if(a(Jd,0,0,Yy),GR){var YR=$(Rl,1)+1,KR=$(Rl,1),$S=$(Rl,KR==0?1:8);Jd[$S]=1,YR==2&&(Jd[$S=$(Rl,8)]=1);var lm=1}else{var BS=o(19),US=$(Rl,4)+4;if(19<US){sm.a=3;var cm=0;break a}for(om=0;om<US;++om)BS[wR[om]]=$(Rl,3);var Qy=void 0,Zd=void 0,zS=sm,QR=BS,um=Yy,WS=Jd,Xy=0,ql=zS.m,HS=8,VS=s(128,M);n:for(;O(VS,0,7,QR,19);){if($(ql,1)){var XR=2+2*$(ql,3);if((Qy=2+$(ql,XR))>um)break n}else Qy=um;for(Zd=0;Zd<um&&Qy--;){ne(ql);var GS=VS[0+(127&N(ql))];W(ql,ql.u+GS.g);var yu=GS.value;if(16>yu)WS[Zd++]=yu,yu!=0&&(HS=yu);else{var JR=yu==16,YS=yu-16,ZR=bR[YS],KS=$(ql,xR[YS])+ZR;if(Zd+KS>um)break n;for(var e8=JR?HS:0;0<KS--;)WS[Zd++]=e8}}Xy=1;break n}Xy||(zS.a=3),lm=Xy}(lm=lm&&!Rl.h)&&(Ky=O(HR,VR,8,Jd,Yy)),lm&&Ky!=0?cm=Ky:(sm.a=3,cm=0)}if(cm==0)break r;if(im&&_R[Br]==1&&(im=am[Da].g==0),qS+=am[Da].g,Da+=cm,3>=Br){var ef,Jy=Xd[0];for(ef=1;ef<da;++ef)Xd[ef]>Jy&&(Jy=Xd[ef]);FS+=Jy}}if(Xo.nd=im,Xo.Qb=0,im&&(Xo.qb=(gu[3][vu[3]+0].value<<24|gu[1][vu[1]+0].value<<16|gu[2][vu[2]+0].value)>>>0,qS==0&&256>gu[0][vu[0]+0].value&&(Xo.Qb=1,Xo.qb+=gu[0][vu[0]+0].value<<8)),Xo.jc=!Xo.Qb&&6>FS,Xo.jc){var dm,Xs=Xo;for(dm=0;dm<ua;++dm){var Fl=dm,$l=Xs.pd[Fl],fm=Xs.G[0][Xs.H[0]+Fl];256<=fm.value?($l.g=fm.g+256,$l.value=fm.value):($l.g=0,$l.value=0,Fl>>=Wr(fm,8,$l),Fl>>=Wr(Xs.G[1][Xs.H[1]+Fl],16,$l),Fl>>=Wr(Xs.G[2][Xs.H[2]+Fl],0,$l),Wr(Xs.G[3][Xs.H[3]+Fl],24,$l))}}}Ka.vc=oi,Ka.Wb=Ii,Ka.Ya=nm,Ka.yc=Gy,An=1;break t}An=0}if(!(ce=An)){Y.a=3;break e}if(0<et){if(we.ua=1<<et,!ee(we.Wa,et)){Y.a=1,ce=0;break e}}else we.ua=0;var Zy=Y,QS=ue,t8=fe,ex=Zy.s,tx=ex.xc;if(Zy.c=QS,Zy.i=t8,ex.md=Me(QS,tx),ex.wc=tx==0?-1:(1<<tx)-1,F){Y.xb=IR;break e}if((Re=o(ue*fe))==null){Y.a=1,ce=0;break e}ce=(ce=mt(Y,Re,0,ue,fe,fe,null))&&!ye.h;break e}return ce?(te!=null?te[0]=Re:(t(Re==null),t(F)),Y.$=0,F||Mt(we)):Mt(we),ce}function $r(g,j){var F=g.c*g.i,Y=F+j+16*j;return t(g.c<=j),g.V=o(Y),g.V==null?(g.Ta=null,g.Ua=0,g.a=1,0):(g.Ta=g.V,g.Ua=g.Ba+F+j,1)}function Vr(g,j){var F=g.C,Y=j-F,te=g.V,ce=g.Ba+g.c*F;for(t(j<=g.l.o);0<Y;){var ue=16<Y?16:Y,fe=g.l.ma,ye=g.l.width,we=ye*ue,Re=fe.ca,et=fe.tb+ye*F,tt=g.Ta,ze=g.Ua;Se(g,ue,te,ce),ba(tt,ze,Re,et,we),Te(fe,F,F+ue,Re,et,ye),Y-=ue,te+=ue*g.c,F+=ue}t(F==j),g.C=g.Ma=j}function In(){this.ub=this.yd=this.td=this.Rb=0}function $n(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function ca(){this.Fb=this.Bb=this.Cb=0,this.Zb=o(4),this.Lb=o(4)}function fi(){this.Yb=function(){var g=[];return function j(F,Y,te){for(var ce=te[Y],ue=0;ue<ce&&(F.push(te.length>Y+1?[]:0),!(te.length<Y+1));ue++)j(F[ue],Y+1,te)}(g,0,[3,11]),g}()}function ro(){this.jb=o(3),this.Wc=l([4,8],fi),this.Xc=l([4,17],fi)}function qi(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new o(4),this.od=new o(4)}function Nn(){this.ld=this.La=this.dd=this.tc=0}function Fi(){this.Na=this.la=0}function wi(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Xe(){this.ad=o(384),this.Za=0,this.Ob=o(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Vt(){this.uc=this.M=this.Nb=0,this.wa=Array(new Nn),this.Y=0,this.ya=Array(new Xe),this.aa=0,this.l=new kr}function ar(){this.y=o(16),this.f=o(8),this.ea=o(8)}function qr(){this.cb=this.a=0,this.sc="",this.m=new X,this.Od=new In,this.Kc=new $n,this.ed=new qi,this.Qa=new ca,this.Ic=this.$c=this.Aa=0,this.D=new Vt,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=s(8,X),this.ia=0,this.pb=s(4,wi),this.Pa=new ro,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new ar),this.Hd=0,this.rb=Array(new Fi),this.sb=0,this.wa=Array(new Nn),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Xe),this.L=this.aa=0,this.gd=l([4,2],Nn),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function kr(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function wn(){var g=new qr;return g!=null&&(g.a=0,g.sc="OK",g.cb=0,g.Xb=0,Kd||(Kd=Ea)),g}function Mr(g,j,F){return g.a==0&&(g.a=j,g.sc=F,g.cb=0),0}function Zn(g,j,F){return 3<=F&&g[j+0]==157&&g[j+1]==1&&g[j+2]==42}function xn(g,j){if(g==null)return 0;if(g.a=0,g.sc="OK",j==null)return Mr(g,2,"null VP8Io passed to VP8GetHeaders()");var F=j.data,Y=j.w,te=j.ha;if(4>te)return Mr(g,7,"Truncated header.");var ce=F[Y+0]|F[Y+1]<<8|F[Y+2]<<16,ue=g.Od;if(ue.Rb=!(1&ce),ue.td=ce>>1&7,ue.yd=ce>>4&1,ue.ub=ce>>5,3<ue.td)return Mr(g,3,"Incorrect keyframe parameters.");if(!ue.yd)return Mr(g,4,"Frame not displayable.");Y+=3,te-=3;var fe=g.Kc;if(ue.Rb){if(7>te)return Mr(g,7,"cannot parse picture header");if(!Zn(F,Y,te))return Mr(g,3,"Bad code word");fe.c=16383&(F[Y+4]<<8|F[Y+3]),fe.Td=F[Y+4]>>6,fe.i=16383&(F[Y+6]<<8|F[Y+5]),fe.Ud=F[Y+6]>>6,Y+=7,te-=7,g.za=fe.c+15>>4,g.Ub=fe.i+15>>4,j.width=fe.c,j.height=fe.i,j.Da=0,j.j=0,j.v=0,j.va=j.width,j.o=j.height,j.da=0,j.ib=j.width,j.hb=j.height,j.U=j.width,j.T=j.height,a((ce=g.Pa).jb,0,255,ce.jb.length),t((ce=g.Qa)!=null),ce.Cb=0,ce.Bb=0,ce.Fb=1,a(ce.Zb,0,0,ce.Zb.length),a(ce.Lb,0,0,ce.Lb)}if(ue.ub>te)return Mr(g,7,"bad partition length");z(ce=g.m,F,Y,ue.ub),Y+=ue.ub,te-=ue.ub,ue.Rb&&(fe.Ld=oe(ce),fe.Kd=oe(ce)),fe=g.Qa;var ye,we=g.Pa;if(t(ce!=null),t(fe!=null),fe.Cb=oe(ce),fe.Cb){if(fe.Bb=oe(ce),oe(ce)){for(fe.Fb=oe(ce),ye=0;4>ye;++ye)fe.Zb[ye]=oe(ce)?J(ce,7):0;for(ye=0;4>ye;++ye)fe.Lb[ye]=oe(ce)?J(ce,6):0}if(fe.Bb)for(ye=0;3>ye;++ye)we.jb[ye]=oe(ce)?K(ce,8):255}else fe.Bb=0;if(ce.Ka)return Mr(g,3,"cannot parse segment header");if((fe=g.ed).zd=oe(ce),fe.Tb=K(ce,6),fe.wb=K(ce,3),fe.Pc=oe(ce),fe.Pc&&oe(ce)){for(we=0;4>we;++we)oe(ce)&&(fe.vd[we]=J(ce,6));for(we=0;4>we;++we)oe(ce)&&(fe.od[we]=J(ce,6))}if(g.L=fe.Tb==0?0:fe.zd?1:2,ce.Ka)return Mr(g,3,"cannot parse filter header");var Re=te;if(te=ye=Y,Y=ye+Re,fe=Re,g.Xb=(1<<K(g.m,2))-1,Re<3*(we=g.Xb))F=7;else{for(ye+=3*we,fe-=3*we,Re=0;Re<we;++Re){var et=F[te+0]|F[te+1]<<8|F[te+2]<<16;et>fe&&(et=fe),z(g.Jc[+Re],F,ye,et),ye+=et,fe-=et,te+=3}z(g.Jc[+we],F,ye,fe),F=ye<Y?0:5}if(F!=0)return Mr(g,F,"cannot parse partitions");for(F=K(ye=g.m,7),te=oe(ye)?J(ye,4):0,Y=oe(ye)?J(ye,4):0,fe=oe(ye)?J(ye,4):0,we=oe(ye)?J(ye,4):0,ye=oe(ye)?J(ye,4):0,Re=g.Qa,et=0;4>et;++et){if(Re.Cb){var tt=Re.Zb[et];Re.Fb||(tt+=F)}else{if(0<et){g.pb[et]=g.pb[0];continue}tt=F}var ze=g.pb[et];ze.Sc[0]=Wy[ki(tt+te,127)],ze.Sc[1]=Hy[ki(tt+0,127)],ze.Eb[0]=2*Wy[ki(tt+Y,127)],ze.Eb[1]=101581*Hy[ki(tt+fe,127)]>>16,8>ze.Eb[1]&&(ze.Eb[1]=8),ze.Qc[0]=Wy[ki(tt+we,117)],ze.Qc[1]=Hy[ki(tt+ye,127)],ze.lc=tt+ye}if(!ue.Rb)return Mr(g,4,"Not a key frame.");for(oe(ce),ue=g.Pa,F=0;4>F;++F){for(te=0;8>te;++te)for(Y=0;3>Y;++Y)for(fe=0;11>fe;++fe)we=ae(ce,ER[F][te][Y][fe])?K(ce,8):OR[F][te][Y][fe],ue.Wc[F][te].Yb[Y][fe]=we;for(te=0;17>te;++te)ue.Xc[F][te]=ue.Wc[F][TR[te]]}return g.kc=oe(ce),g.kc&&(g.Bd=K(ce,8)),g.cb=1}function Ea(g,j,F,Y,te,ce,ue){var fe=j[te].Yb[F];for(F=0;16>te;++te){if(!ae(g,fe[F+0]))return te;for(;!ae(g,fe[F+1]);)if(fe=j[++te].Yb[0],F=0,te==16)return 16;var ye=j[te+1].Yb;if(ae(g,fe[F+2])){var we=g,Re=0;if(ae(we,(tt=fe)[(et=F)+3]))if(ae(we,tt[et+6])){for(fe=0,et=2*(Re=ae(we,tt[et+8]))+(tt=ae(we,tt[et+9+Re])),Re=0,tt=AR[et];tt[fe];++fe)Re+=Re+ae(we,tt[fe]);Re+=3+(8<<et)}else ae(we,tt[et+7])?(Re=7+2*ae(we,165),Re+=ae(we,145)):Re=5+ae(we,159);else Re=ae(we,tt[et+4])?3+ae(we,tt[et+5]):2;fe=ye[2]}else Re=1,fe=ye[1];ye=ue+PR[te],0>(we=g).b&&se(we);var et,tt=we.b,ze=(et=we.Ca>>1)-(we.I>>tt)>>31;--we.b,we.Ca+=ze,we.Ca|=1,we.I-=(et+1&ze)<<tt,ce[ye]=((Re^ze)-ze)*Y[(0<te)+0]}return 16}function Ta(g){var j=g.rb[g.sb-1];j.la=0,j.Na=0,a(g.zc,0,0,g.zc.length),g.ja=0}function ti(g,j){if(g==null)return 0;if(j==null)return Mr(g,2,"NULL VP8Io parameter in VP8Decode().");if(!g.cb&&!xn(g,j))return 0;if(t(g.cb),j.ac==null||j.ac(j)){j.ob&&(g.L=0);var F=rm[g.L];if(g.L==2?(g.yb=0,g.zb=0):(g.yb=j.v-F>>4,g.zb=j.j-F>>4,0>g.yb&&(g.yb=0),0>g.zb&&(g.zb=0)),g.Va=j.o+15+F>>4,g.Hb=j.va+15+F>>4,g.Hb>g.za&&(g.Hb=g.za),g.Va>g.Ub&&(g.Va=g.Ub),0<g.L){var Y=g.ed;for(F=0;4>F;++F){var te;if(g.Qa.Cb){var ce=g.Qa.Lb[F];g.Qa.Fb||(ce+=Y.Tb)}else ce=Y.Tb;for(te=0;1>=te;++te){var ue=g.gd[F][te],fe=ce;if(Y.Pc&&(fe+=Y.vd[0],te&&(fe+=Y.od[0])),0<(fe=0>fe?0:63<fe?63:fe)){var ye=fe;0<Y.wb&&(ye=4<Y.wb?ye>>2:ye>>1)>9-Y.wb&&(ye=9-Y.wb),1>ye&&(ye=1),ue.dd=ye,ue.tc=2*fe+ye,ue.ld=40<=fe?2:15<=fe?1:0}else ue.tc=0;ue.La=te}}}F=0}else Mr(g,6,"Frame setup failed"),F=g.a;if(F=F==0){if(F){g.$c=0,0<g.Aa||(g.Ic=WR);e:{F=g.Ic,Y=4*(ye=g.za);var we=32*ye,Re=ye+1,et=0<g.L?ye*(0<g.Aa?2:1):0,tt=(g.Aa==2?2:1)*ye;if((ue=Y+832+(te=3*(16*F+rm[g.L])/2*we)+(ce=g.Fa!=null&&0<g.Fa.length?g.Kc.c*g.Kc.i:0))!=ue)F=0;else{if(ue>g.Vb){if(g.Vb=0,g.Ec=o(ue),g.Fc=0,g.Ec==null){F=Mr(g,1,"no memory during frame initialization.");break e}g.Vb=ue}ue=g.Ec,fe=g.Fc,g.Ac=ue,g.Bc=fe,fe+=Y,g.Gd=s(we,ar),g.Hd=0,g.rb=s(Re+1,Fi),g.sb=1,g.wa=et?s(et,Nn):null,g.Y=0,g.D.Nb=0,g.D.wa=g.wa,g.D.Y=g.Y,0<g.Aa&&(g.D.Y+=ye),t(!0),g.oc=ue,g.pc=fe,fe+=832,g.ya=s(tt,Xe),g.aa=0,g.D.ya=g.ya,g.D.aa=g.aa,g.Aa==2&&(g.D.aa+=ye),g.R=16*ye,g.B=8*ye,ye=(we=rm[g.L])*g.R,we=we/2*g.B,g.sa=ue,g.ta=fe+ye,g.qa=g.sa,g.ra=g.ta+16*F*g.R+we,g.Ha=g.qa,g.Ia=g.ra+8*F*g.B+we,g.$c=0,fe+=te,g.mb=ce?ue:null,g.nb=ce?fe:null,t(fe+ce<=g.Fc+g.Vb),Ta(g),a(g.Ac,g.Bc,0,Y),F=1}}if(F){if(j.ka=0,j.y=g.sa,j.O=g.ta,j.f=g.qa,j.N=g.ra,j.ea=g.Ha,j.Vd=g.Ia,j.fa=g.R,j.Rc=g.B,j.F=null,j.J=0,!Gp){for(F=-255;255>=F;++F)Ba[255+F]=0>F?-F:F;for(F=-1020;1020>=F;++F)Ys[1020+F]=-128>F?-128:127<F?127:F;for(F=-112;112>=F;++F)Yd[112+F]=-16>F?-16:15<F?15:F;for(F=-255;510>=F;++F)pu[255+F]=0>F?0:255<F?255:F;Gp=1}du=Oo,Gs=io,Hd=ji,Ti=oo,Do=hi,xa=ao,fu=jr,Vp=zr,Vd=Yn,vc=Pi,yc=fn,Il=ta,xc=ai,hu=Ia,bc=Ie,Nl=Le,Gd=De,Mo=pt,Qo[0]=Si,Qo[1]=fs,Qo[2]=Cl,Qo[3]=fc,Qo[4]=Fs,Qo[5]=Ko,Qo[6]=Ci,Qo[7]=ni,Qo[8]=hc,Qo[9]=Bi,Dl[0]=dc,Dl[1]=hs,Dl[2]=Ya,Dl[3]=lo,Dl[4]=Bn,Dl[5]=Yo,Dl[6]=ko,Ks[0]=To,Ks[1]=so,Ks[2]=$s,Ks[3]=co,Ks[4]=Ai,Ks[5]=Al,Ks[6]=Bs,F=1}else F=0}F&&(F=function(ze,xt){for(ze.M=0;ze.M<ze.Va;++ze.M){var ct,qe=ze.Jc[ze.M&ze.Xb],Be=ze.m,gt=ze;for(ct=0;ct<gt.za;++ct){var Ct=Be,yt=gt,Gt=yt.Ac,$t=yt.Bc+4*ct,pr=yt.zc,Ut=yt.ya[yt.aa+ct];if(yt.Qa.Bb?Ut.$b=ae(Ct,yt.Pa.jb[0])?2+ae(Ct,yt.Pa.jb[2]):ae(Ct,yt.Pa.jb[1]):Ut.$b=0,yt.kc&&(Ut.Ad=ae(Ct,yt.Bd)),Ut.Za=!ae(Ct,145)+0,Ut.Za){var hn=Ut.Ob,bn=0;for(yt=0;4>yt;++yt){var rn,Qr=pr[0+yt];for(rn=0;4>rn;++rn){Qr=kR[Gt[$t+rn]][Qr];for(var An=PS[ae(Ct,Qr[0])];0<An;)An=PS[2*An+ae(Ct,Qr[An])];Qr=-An,Gt[$t+rn]=Qr}n(hn,bn,Gt,$t,4),bn+=4,pr[0+yt]=Qr}}else Qr=ae(Ct,156)?ae(Ct,128)?1:3:ae(Ct,163)?2:0,Ut.Ob[0]=Qr,a(Gt,$t,Qr,4),a(pr,0,Qr,4);Ut.Dd=ae(Ct,142)?ae(Ct,114)?ae(Ct,183)?1:3:2:0}if(gt.m.Ka)return Mr(ze,7,"Premature end-of-partition0 encountered.");for(;ze.ja<ze.za;++ze.ja){if(gt=qe,Ct=(Be=ze).rb[Be.sb-1],Gt=Be.rb[Be.sb+Be.ja],ct=Be.ya[Be.aa+Be.ja],$t=Be.kc?ct.Ad:0)Ct.la=Gt.la=0,ct.Za||(Ct.Na=Gt.Na=0),ct.Hc=0,ct.Gc=0,ct.ia=0;else{var jn,Br;if(Ct=Gt,Gt=gt,$t=Be.Pa.Xc,pr=Be.ya[Be.aa+Be.ja],Ut=Be.pb[pr.$b],yt=pr.ad,hn=0,bn=Be.rb[Be.sb-1],Qr=rn=0,a(yt,hn,0,384),pr.Za)var Da=0,Yi=$t[3];else{An=o(16);var Ma=Ct.Na+bn.Na;if(Ma=Kd(Gt,$t[1],Ma,Ut.Eb,0,An,0),Ct.Na=bn.Na=(0<Ma)+0,1<Ma)du(An,0,yt,hn);else{var Ki=An[0]+3>>3;for(An=0;256>An;An+=16)yt[hn+An]=Ki}Da=1,Yi=$t[0]}var _n=15&Ct.la,po=15&bn.la;for(An=0;4>An;++An){var mo=1&po;for(Ki=Br=0;4>Ki;++Ki)_n=_n>>1|(mo=(Ma=Kd(Gt,Yi,Ma=mo+(1&_n),Ut.Sc,Da,yt,hn))>Da)<<7,Br=Br<<2|(3<Ma?3:1<Ma?2:yt[hn+0]!=0),hn+=16;_n>>=4,po=po>>1|mo<<7,rn=(rn<<8|Br)>>>0}for(Yi=_n,Da=po>>4,jn=0;4>jn;jn+=2){for(Br=0,_n=Ct.la>>4+jn,po=bn.la>>4+jn,An=0;2>An;++An){for(mo=1&po,Ki=0;2>Ki;++Ki)Ma=mo+(1&_n),_n=_n>>1|(mo=0<(Ma=Kd(Gt,$t[2],Ma,Ut.Qc,0,yt,hn)))<<3,Br=Br<<2|(3<Ma?3:1<Ma?2:yt[hn+0]!=0),hn+=16;_n>>=2,po=po>>1|mo<<5}Qr|=Br<<4*jn,Yi|=_n<<4<<jn,Da|=(240&po)<<jn}Ct.la=Yi,bn.la=Da,pr.Hc=rn,pr.Gc=Qr,pr.ia=43690&Qr?0:Ut.ia,$t=!(rn|Qr)}if(0<Be.L&&(Be.wa[Be.Y+Be.ja]=Be.gd[ct.$b][ct.Za],Be.wa[Be.Y+Be.ja].La|=!$t),gt.Ka)return Mr(ze,7,"Premature end-of-file encountered.")}if(Ta(ze),Be=xt,gt=1,ct=(qe=ze).D,Ct=0<qe.L&&qe.M>=qe.zb&&qe.M<=qe.Va,qe.Aa==0)e:{if(ct.M=qe.M,ct.uc=Ct,Pl(qe,ct),gt=1,ct=(Br=qe.D).Nb,Ct=(Qr=rm[qe.L])*qe.R,Gt=Qr/2*qe.B,An=16*ct*qe.R,Ki=8*ct*qe.B,$t=qe.sa,pr=qe.ta-Ct+An,Ut=qe.qa,yt=qe.ra-Gt+Ki,hn=qe.Ha,bn=qe.Ia-Gt+Ki,po=(_n=Br.M)==0,rn=_n>=qe.Va-1,qe.Aa==2&&Pl(qe,Br),Br.uc)for(mo=(Ma=qe).D.M,t(Ma.D.uc),Br=Ma.yb;Br<Ma.Hb;++Br){Da=Br,Yi=mo;var Ka=(oi=(da=Ma).D).Nb;jn=da.R;var oi=oi.wa[oi.Y+Da],Ii=da.sa,Fo=da.ta+16*Ka*jn+16*Da,ms=oi.dd,Qa=oi.tc;if(Qa!=0)if(t(3<=Qa),da.L==1)0<Da&&Nl(Ii,Fo,jn,Qa+4),oi.La&&Mo(Ii,Fo,jn,Qa),0<Yi&&bc(Ii,Fo,jn,Qa+4),oi.La&&Gd(Ii,Fo,jn,Qa);else{var Qs=da.B,_c=da.qa,mu=da.ra+8*Ka*Qs+8*Da,Ll=da.Ha,da=da.Ia+8*Ka*Qs+8*Da;Ka=oi.ld,0<Da&&(Vp(Ii,Fo,jn,Qa+4,ms,Ka),vc(_c,mu,Ll,da,Qs,Qa+4,ms,Ka)),oi.La&&(Il(Ii,Fo,jn,Qa,ms,Ka),hu(_c,mu,Ll,da,Qs,Qa,ms,Ka)),0<Yi&&(fu(Ii,Fo,jn,Qa+4,ms,Ka),Vd(_c,mu,Ll,da,Qs,Qa+4,ms,Ka)),oi.La&&(yc(Ii,Fo,jn,Qa,ms,Ka),xc(_c,mu,Ll,da,Qs,Qa,ms,Ka))}}if(qe.ia&&alert("todo:DitherRow"),Be.put!=null){if(Br=16*_n,_n=16*(_n+1),po?(Be.y=qe.sa,Be.O=qe.ta+An,Be.f=qe.qa,Be.N=qe.ra+Ki,Be.ea=qe.Ha,Be.W=qe.Ia+Ki):(Br-=Qr,Be.y=$t,Be.O=pr,Be.f=Ut,Be.N=yt,Be.ea=hn,Be.W=bn),rn||(_n-=Qr),_n>Be.o&&(_n=Be.o),Be.F=null,Be.J=null,qe.Fa!=null&&0<qe.Fa.length&&Br<_n&&(Be.J=pc(qe,Be,Br,_n-Br),Be.F=qe.mb,Be.F==null&&Be.F.length==0)){gt=Mr(qe,3,"Could not decode alpha data.");break e}Br<Be.j&&(Qr=Be.j-Br,Br=Be.j,t(!(1&Qr)),Be.O+=qe.R*Qr,Be.N+=qe.B*(Qr>>1),Be.W+=qe.B*(Qr>>1),Be.F!=null&&(Be.J+=Be.width*Qr)),Br<_n&&(Be.O+=Be.v,Be.N+=Be.v>>1,Be.W+=Be.v>>1,Be.F!=null&&(Be.J+=Be.v),Be.ka=Br-Be.j,Be.U=Be.va-Be.v,Be.T=_n-Br,gt=Be.put(Be))}ct+1!=qe.Ic||rn||(n(qe.sa,qe.ta-Ct,$t,pr+16*qe.R,Ct),n(qe.qa,qe.ra-Gt,Ut,yt+8*qe.B,Gt),n(qe.Ha,qe.Ia-Gt,hn,bn+8*qe.B,Gt))}if(!gt)return Mr(ze,6,"Output aborted.")}return 1}(g,j)),j.bc!=null&&j.bc(j),F&=1}return F?(g.cb=0,F):0}function ea(g,j,F,Y,te){te=g[j+F+32*Y]+(te>>3),g[j+F+32*Y]=-256&te?0>te?0:255:te}function Cn(g,j,F,Y,te,ce){ea(g,j,0,F,Y+te),ea(g,j,1,F,Y+ce),ea(g,j,2,F,Y-ce),ea(g,j,3,F,Y-te)}function Gr(g){return(20091*g>>16)+g}function no(g,j,F,Y){var te,ce=0,ue=o(16);for(te=0;4>te;++te){var fe=g[j+0]+g[j+8],ye=g[j+0]-g[j+8],we=(35468*g[j+4]>>16)-Gr(g[j+12]),Re=Gr(g[j+4])+(35468*g[j+12]>>16);ue[ce+0]=fe+Re,ue[ce+1]=ye+we,ue[ce+2]=ye-we,ue[ce+3]=fe-Re,ce+=4,j++}for(te=ce=0;4>te;++te)fe=(g=ue[ce+0]+4)+ue[ce+8],ye=g-ue[ce+8],we=(35468*ue[ce+4]>>16)-Gr(ue[ce+12]),ea(F,Y,0,0,fe+(Re=Gr(ue[ce+4])+(35468*ue[ce+12]>>16))),ea(F,Y,1,0,ye+we),ea(F,Y,2,0,ye-we),ea(F,Y,3,0,fe-Re),ce++,Y+=32}function ao(g,j,F,Y){var te=g[j+0]+4,ce=35468*g[j+4]>>16,ue=Gr(g[j+4]),fe=35468*g[j+1]>>16;Cn(F,Y,0,te+ue,g=Gr(g[j+1]),fe),Cn(F,Y,1,te+ce,g,fe),Cn(F,Y,2,te-ce,g,fe),Cn(F,Y,3,te-ue,g,fe)}function io(g,j,F,Y,te){no(g,j,F,Y),te&&no(g,j+16,F,Y+4)}function ji(g,j,F,Y){Gs(g,j+0,F,Y,1),Gs(g,j+32,F,Y+128,1)}function oo(g,j,F,Y){var te;for(g=g[j+0]+4,te=0;4>te;++te)for(j=0;4>j;++j)ea(F,Y,j,te,g)}function hi(g,j,F,Y){g[j+0]&&Ti(g,j+0,F,Y),g[j+16]&&Ti(g,j+16,F,Y+4),g[j+32]&&Ti(g,j+32,F,Y+128),g[j+48]&&Ti(g,j+48,F,Y+128+4)}function Oo(g,j,F,Y){var te,ce=o(16);for(te=0;4>te;++te){var ue=g[j+0+te]+g[j+12+te],fe=g[j+4+te]+g[j+8+te],ye=g[j+4+te]-g[j+8+te],we=g[j+0+te]-g[j+12+te];ce[0+te]=ue+fe,ce[8+te]=ue-fe,ce[4+te]=we+ye,ce[12+te]=we-ye}for(te=0;4>te;++te)ue=(g=ce[0+4*te]+3)+ce[3+4*te],fe=ce[1+4*te]+ce[2+4*te],ye=ce[1+4*te]-ce[2+4*te],we=g-ce[3+4*te],F[Y+0]=ue+fe>>3,F[Y+16]=we+ye>>3,F[Y+32]=ue-fe>>3,F[Y+48]=we-ye>>3,Y+=64}function $i(g,j,F){var Y,te=j-32,ce=ho,ue=255-g[te-1];for(Y=0;Y<F;++Y){var fe,ye=ce,we=ue+g[j-1];for(fe=0;fe<F;++fe)g[j+fe]=ye[we+g[te+fe]];j+=32}}function fs(g,j){$i(g,j,4)}function so(g,j){$i(g,j,8)}function hs(g,j){$i(g,j,16)}function Ya(g,j){var F;for(F=0;16>F;++F)n(g,j+32*F,g,j-32,16)}function lo(g,j){var F;for(F=16;0<F;--F)a(g,j,g[j-1],16),j+=32}function ri(g,j,F){var Y;for(Y=0;16>Y;++Y)a(j,F+32*Y,g,16)}function dc(g,j){var F,Y=16;for(F=0;16>F;++F)Y+=g[j-1+32*F]+g[j+F-32];ri(Y>>5,g,j)}function Bn(g,j){var F,Y=8;for(F=0;16>F;++F)Y+=g[j-1+32*F];ri(Y>>4,g,j)}function Yo(g,j){var F,Y=8;for(F=0;16>F;++F)Y+=g[j+F-32];ri(Y>>4,g,j)}function ko(g,j){ri(128,g,j)}function yr(g,j,F){return g+2*j+F+2>>2}function Cl(g,j){var F,Y=j-32;for(Y=new Uint8Array([yr(g[Y-1],g[Y+0],g[Y+1]),yr(g[Y+0],g[Y+1],g[Y+2]),yr(g[Y+1],g[Y+2],g[Y+3]),yr(g[Y+2],g[Y+3],g[Y+4])]),F=0;4>F;++F)n(g,j+32*F,Y,0,Y.length)}function fc(g,j){var F=g[j-1],Y=g[j-1+32],te=g[j-1+64],ce=g[j-1+96];pe(g,j+0,16843009*yr(g[j-1-32],F,Y)),pe(g,j+32,16843009*yr(F,Y,te)),pe(g,j+64,16843009*yr(Y,te,ce)),pe(g,j+96,16843009*yr(te,ce,ce))}function Si(g,j){var F,Y=4;for(F=0;4>F;++F)Y+=g[j+F-32]+g[j-1+32*F];for(Y>>=3,F=0;4>F;++F)a(g,j+32*F,Y,4)}function Fs(g,j){var F=g[j-1+0],Y=g[j-1+32],te=g[j-1+64],ce=g[j-1-32],ue=g[j+0-32],fe=g[j+1-32],ye=g[j+2-32],we=g[j+3-32];g[j+0+96]=yr(Y,te,g[j-1+96]),g[j+1+96]=g[j+0+64]=yr(F,Y,te),g[j+2+96]=g[j+1+64]=g[j+0+32]=yr(ce,F,Y),g[j+3+96]=g[j+2+64]=g[j+1+32]=g[j+0+0]=yr(ue,ce,F),g[j+3+64]=g[j+2+32]=g[j+1+0]=yr(fe,ue,ce),g[j+3+32]=g[j+2+0]=yr(ye,fe,ue),g[j+3+0]=yr(we,ye,fe)}function Ci(g,j){var F=g[j+1-32],Y=g[j+2-32],te=g[j+3-32],ce=g[j+4-32],ue=g[j+5-32],fe=g[j+6-32],ye=g[j+7-32];g[j+0+0]=yr(g[j+0-32],F,Y),g[j+1+0]=g[j+0+32]=yr(F,Y,te),g[j+2+0]=g[j+1+32]=g[j+0+64]=yr(Y,te,ce),g[j+3+0]=g[j+2+32]=g[j+1+64]=g[j+0+96]=yr(te,ce,ue),g[j+3+32]=g[j+2+64]=g[j+1+96]=yr(ce,ue,fe),g[j+3+64]=g[j+2+96]=yr(ue,fe,ye),g[j+3+96]=yr(fe,ye,ye)}function Ko(g,j){var F=g[j-1+0],Y=g[j-1+32],te=g[j-1+64],ce=g[j-1-32],ue=g[j+0-32],fe=g[j+1-32],ye=g[j+2-32],we=g[j+3-32];g[j+0+0]=g[j+1+64]=ce+ue+1>>1,g[j+1+0]=g[j+2+64]=ue+fe+1>>1,g[j+2+0]=g[j+3+64]=fe+ye+1>>1,g[j+3+0]=ye+we+1>>1,g[j+0+96]=yr(te,Y,F),g[j+0+64]=yr(Y,F,ce),g[j+0+32]=g[j+1+96]=yr(F,ce,ue),g[j+1+32]=g[j+2+96]=yr(ce,ue,fe),g[j+2+32]=g[j+3+96]=yr(ue,fe,ye),g[j+3+32]=yr(fe,ye,we)}function ni(g,j){var F=g[j+0-32],Y=g[j+1-32],te=g[j+2-32],ce=g[j+3-32],ue=g[j+4-32],fe=g[j+5-32],ye=g[j+6-32],we=g[j+7-32];g[j+0+0]=F+Y+1>>1,g[j+1+0]=g[j+0+64]=Y+te+1>>1,g[j+2+0]=g[j+1+64]=te+ce+1>>1,g[j+3+0]=g[j+2+64]=ce+ue+1>>1,g[j+0+32]=yr(F,Y,te),g[j+1+32]=g[j+0+96]=yr(Y,te,ce),g[j+2+32]=g[j+1+96]=yr(te,ce,ue),g[j+3+32]=g[j+2+96]=yr(ce,ue,fe),g[j+3+64]=yr(ue,fe,ye),g[j+3+96]=yr(fe,ye,we)}function Bi(g,j){var F=g[j-1+0],Y=g[j-1+32],te=g[j-1+64],ce=g[j-1+96];g[j+0+0]=F+Y+1>>1,g[j+2+0]=g[j+0+32]=Y+te+1>>1,g[j+2+32]=g[j+0+64]=te+ce+1>>1,g[j+1+0]=yr(F,Y,te),g[j+3+0]=g[j+1+32]=yr(Y,te,ce),g[j+3+32]=g[j+1+64]=yr(te,ce,ce),g[j+3+64]=g[j+2+64]=g[j+0+96]=g[j+1+96]=g[j+2+96]=g[j+3+96]=ce}function hc(g,j){var F=g[j-1+0],Y=g[j-1+32],te=g[j-1+64],ce=g[j-1+96],ue=g[j-1-32],fe=g[j+0-32],ye=g[j+1-32],we=g[j+2-32];g[j+0+0]=g[j+2+32]=F+ue+1>>1,g[j+0+32]=g[j+2+64]=Y+F+1>>1,g[j+0+64]=g[j+2+96]=te+Y+1>>1,g[j+0+96]=ce+te+1>>1,g[j+3+0]=yr(fe,ye,we),g[j+2+0]=yr(ue,fe,ye),g[j+1+0]=g[j+3+32]=yr(F,ue,fe),g[j+1+32]=g[j+3+64]=yr(Y,F,ue),g[j+1+64]=g[j+3+96]=yr(te,Y,F),g[j+1+96]=yr(ce,te,Y)}function $s(g,j){var F;for(F=0;8>F;++F)n(g,j+32*F,g,j-32,8)}function co(g,j){var F;for(F=0;8>F;++F)a(g,j,g[j-1],8),j+=32}function Eo(g,j,F){var Y;for(Y=0;8>Y;++Y)a(j,F+32*Y,g,8)}function To(g,j){var F,Y=8;for(F=0;8>F;++F)Y+=g[j+F-32]+g[j-1+32*F];Eo(Y>>4,g,j)}function Al(g,j){var F,Y=4;for(F=0;8>F;++F)Y+=g[j+F-32];Eo(Y>>3,g,j)}function Ai(g,j){var F,Y=4;for(F=0;8>F;++F)Y+=g[j-1+32*F];Eo(Y>>3,g,j)}function Bs(g,j){Eo(128,g,j)}function Ui(g,j,F){var Y=g[j-F],te=g[j+0],ce=3*(te-Y)+Fy[1020+g[j-2*F]-g[j+F]],ue=Yp[112+(ce+4>>3)];g[j-F]=ho[255+Y+Yp[112+(ce+3>>3)]],g[j+0]=ho[255+te-ue]}function Us(g,j,F,Y){var te=g[j+0],ce=g[j+F];return Ro[255+g[j-2*F]-g[j-F]]>Y||Ro[255+ce-te]>Y}function be(g,j,F,Y){return 4*Ro[255+g[j-F]-g[j+0]]+Ro[255+g[j-2*F]-g[j+F]]<=Y}function je(g,j,F,Y,te){var ce=g[j-3*F],ue=g[j-2*F],fe=g[j-F],ye=g[j+0],we=g[j+F],Re=g[j+2*F],et=g[j+3*F];return 4*Ro[255+fe-ye]+Ro[255+ue-we]>Y?0:Ro[255+g[j-4*F]-ce]<=te&&Ro[255+ce-ue]<=te&&Ro[255+ue-fe]<=te&&Ro[255+et-Re]<=te&&Ro[255+Re-we]<=te&&Ro[255+we-ye]<=te}function Ie(g,j,F,Y){var te=2*Y+1;for(Y=0;16>Y;++Y)be(g,j+Y,F,te)&&Ui(g,j+Y,F)}function Le(g,j,F,Y){var te=2*Y+1;for(Y=0;16>Y;++Y)be(g,j+Y*F,1,te)&&Ui(g,j+Y*F,1)}function De(g,j,F,Y){var te;for(te=3;0<te;--te)Ie(g,j+=4*F,F,Y)}function pt(g,j,F,Y){var te;for(te=3;0<te;--te)Le(g,j+=4,F,Y)}function kt(g,j,F,Y,te,ce,ue,fe){for(ce=2*ce+1;0<te--;){if(je(g,j,F,ce,ue))if(Us(g,j,F,fe))Ui(g,j,F);else{var ye=g,we=j,Re=F,et=ye[we-2*Re],tt=ye[we-Re],ze=ye[we+0],xt=ye[we+Re],ct=ye[we+2*Re],qe=27*(gt=Fy[1020+3*(ze-tt)+Fy[1020+et-xt]])+63>>7,Be=18*gt+63>>7,gt=9*gt+63>>7;ye[we-3*Re]=ho[255+ye[we-3*Re]+gt],ye[we-2*Re]=ho[255+et+Be],ye[we-Re]=ho[255+tt+qe],ye[we+0]=ho[255+ze-qe],ye[we+Re]=ho[255+xt-Be],ye[we+2*Re]=ho[255+ct-gt]}j+=Y}}function Lt(g,j,F,Y,te,ce,ue,fe){for(ce=2*ce+1;0<te--;){if(je(g,j,F,ce,ue))if(Us(g,j,F,fe))Ui(g,j,F);else{var ye=g,we=j,Re=F,et=ye[we-Re],tt=ye[we+0],ze=ye[we+Re],xt=Yp[112+((ct=3*(tt-et))+4>>3)],ct=Yp[112+(ct+3>>3)],qe=xt+1>>1;ye[we-2*Re]=ho[255+ye[we-2*Re]+qe],ye[we-Re]=ho[255+et+ct],ye[we+0]=ho[255+tt-xt],ye[we+Re]=ho[255+ze-qe]}j+=Y}}function jr(g,j,F,Y,te,ce){kt(g,j,F,1,16,Y,te,ce)}function zr(g,j,F,Y,te,ce){kt(g,j,1,F,16,Y,te,ce)}function fn(g,j,F,Y,te,ce){var ue;for(ue=3;0<ue;--ue)Lt(g,j+=4*F,F,1,16,Y,te,ce)}function ta(g,j,F,Y,te,ce){var ue;for(ue=3;0<ue;--ue)Lt(g,j+=4,1,F,16,Y,te,ce)}function Yn(g,j,F,Y,te,ce,ue,fe){kt(g,j,te,1,8,ce,ue,fe),kt(F,Y,te,1,8,ce,ue,fe)}function Pi(g,j,F,Y,te,ce,ue,fe){kt(g,j,1,te,8,ce,ue,fe),kt(F,Y,1,te,8,ce,ue,fe)}function ai(g,j,F,Y,te,ce,ue,fe){Lt(g,j+4*te,te,1,8,ce,ue,fe),Lt(F,Y+4*te,te,1,8,ce,ue,fe)}function Ia(g,j,F,Y,te,ce,ue,fe){Lt(g,j+4,1,te,8,ce,ue,fe),Lt(F,Y+4,1,te,8,ce,ue,fe)}function Fa(){this.ba=new Yt,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Dr,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function zi(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function uo(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Io(){this.ua=0,this.Wa=new V,this.vb=new V,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new q,this.yc=new M}function Oi(){this.xb=this.a=0,this.l=new kr,this.ca=new Yt,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new C,this.Pb=0,this.wd=new C,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Io,this.ab=0,this.gc=s(4,uo),this.Oc=0}function Wi(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new kr,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Hi(g,j,F,Y,te,ce,ue){for(g=g==null?0:g[j+0],j=0;j<ue;++j)te[ce+j]=g+F[Y+j]&255,g=te[ce+j]}function ps(g,j,F,Y,te,ce,ue){var fe;if(g==null)Hi(null,null,F,Y,te,ce,ue);else for(fe=0;fe<ue;++fe)te[ce+fe]=g[j+fe]+F[Y+fe]&255}function ii(g,j,F,Y,te,ce,ue){if(g==null)Hi(null,null,F,Y,te,ce,ue);else{var fe,ye=g[j+0],we=ye,Re=ye;for(fe=0;fe<ue;++fe)we=Re+(ye=g[j+fe])-we,Re=F[Y+fe]+(-256&we?0>we?0:255:we)&255,we=ye,te[ce+fe]=Re}}function pc(g,j,F,Y){var te=j.width,ce=j.o;if(t(g!=null&&j!=null),0>F||0>=Y||F+Y>ce)return null;if(!g.Cc){if(g.ga==null){var ue;if(g.ga=new Wi,(ue=g.ga==null)||(ue=j.width*j.o,t(g.Gb.length==0),g.Gb=o(ue),g.Uc=0,g.Gb==null?ue=0:(g.mb=g.Gb,g.nb=g.Uc,g.rc=null,ue=1),ue=!ue),!ue){ue=g.ga;var fe=g.Fa,ye=g.P,we=g.qc,Re=g.mb,et=g.nb,tt=ye+1,ze=we-1,xt=ue.l;if(t(fe!=null&&Re!=null&&j!=null),Ml[0]=null,Ml[1]=Hi,Ml[2]=ps,Ml[3]=ii,ue.ca=Re,ue.tb=et,ue.c=j.width,ue.i=j.height,t(0<ue.c&&0<ue.i),1>=we)j=0;else if(ue.$a=fe[ye+0]>>0&3,ue.Z=fe[ye+0]>>2&3,ue.Lc=fe[ye+0]>>4&3,ye=fe[ye+0]>>6&3,0>ue.$a||1<ue.$a||4<=ue.Z||1<ue.Lc||ye)j=0;else if(xt.put=ka,xt.ac=dn,xt.bc=En,xt.ma=ue,xt.width=j.width,xt.height=j.height,xt.Da=j.Da,xt.v=j.v,xt.va=j.va,xt.j=j.j,xt.o=j.o,ue.$a)e:{t(ue.$a==1),j=Nr();t:for(;;){if(j==null){j=0;break e}if(t(ue!=null),ue.mc=j,j.c=ue.c,j.i=ue.i,j.l=ue.l,j.l.ma=ue,j.l.width=ue.c,j.l.height=ue.i,j.a=0,R(j.m,fe,tt,ze),!Ar(ue.c,ue.i,1,j,null)||(j.ab==1&&j.gc[0].hc==3&&_e(j.s)?(ue.ic=1,fe=j.c*j.i,j.Ta=null,j.Ua=0,j.V=o(fe),j.Ba=0,j.V==null?(j.a=1,j=0):j=1):(ue.ic=0,j=$r(j,ue.c)),!j))break t;j=1;break e}ue.mc=null,j=0}else j=ze>=ue.c*ue.i;ue=!j}if(ue)return null;g.ga.Lc!=1?g.Ga=0:Y=ce-F}t(g.ga!=null),t(F+Y<=ce);e:{if(j=(fe=g.ga).c,ce=fe.l.o,fe.$a==0){if(tt=g.rc,ze=g.Vc,xt=g.Fa,ye=g.P+1+F*j,we=g.mb,Re=g.nb+F*j,t(ye<=g.P+g.qc),fe.Z!=0)for(t(Ml[fe.Z]!=null),ue=0;ue<Y;++ue)Ml[fe.Z](tt,ze,xt,ye,we,Re,j),tt=we,ze=Re,Re+=j,ye+=j;else for(ue=0;ue<Y;++ue)n(we,Re,xt,ye,j),tt=we,ze=Re,Re+=j,ye+=j;g.rc=tt,g.Vc=ze}else{if(t(fe.mc!=null),j=F+Y,t((ue=fe.mc)!=null),t(j<=ue.i),ue.C>=j)j=1;else if(fe.ic||Ke(),fe.ic){fe=ue.V,tt=ue.Ba,ze=ue.c;var ct=ue.i,qe=(xt=1,ye=ue.$/ze,we=ue.$%ze,Re=ue.m,et=ue.s,ue.$),Be=ze*ct,gt=ze*j,Ct=et.wc,yt=qe<gt?en(et,we,ye):null;t(qe<=Be),t(j<=ct),t(_e(et));t:for(;;){for(;!Re.h&&qe<gt;){if(we&Ct||(yt=en(et,we,ye)),t(yt!=null),ne(Re),256>(ct=Tn(yt.G[0],yt.H[0],Re)))fe[tt+qe]=ct,++qe,++we>=ze&&(we=0,++ye<=j&&!(ye%16)&&nt(ue,ye));else{if(!(280>ct)){xt=0;break t}ct=Xr(ct-256,Re);var Gt,$t=Tn(yt.G[4],yt.H[4],Re);if(ne(Re),!(qe>=($t=Gn(ze,$t=Xr($t,Re)))&&Be-qe>=ct)){xt=0;break t}for(Gt=0;Gt<ct;++Gt)fe[tt+qe+Gt]=fe[tt+qe+Gt-$t];for(qe+=ct,we+=ct;we>=ze;)we-=ze,++ye<=j&&!(ye%16)&&nt(ue,ye);qe<gt&&we&Ct&&(yt=en(et,we,ye))}t(Re.h==H(Re))}nt(ue,ye>j?j:ye);break t}!xt||Re.h&&qe<Be?(xt=0,ue.a=Re.h?5:3):ue.$=qe,j=xt}else j=mt(ue,ue.V,ue.Ba,ue.c,ue.i,j,Vr);if(!j){Y=0;break e}}F+Y>=ce&&(g.Cc=1),Y=1}if(!Y)return null;if(g.Cc&&((Y=g.ga)!=null&&(Y.mc=null),g.ga=null,0<g.Ga))return alert("todo:WebPDequantizeLevels"),null}return g.nb+F*te}function D(g,j,F,Y,te,ce){for(;0<te--;){var ue,fe=g,ye=j+(F?1:0),we=g,Re=j+(F?0:3);for(ue=0;ue<Y;++ue){var et=we[Re+4*ue];et!=255&&(et*=32897,fe[ye+4*ue+0]=fe[ye+4*ue+0]*et>>23,fe[ye+4*ue+1]=fe[ye+4*ue+1]*et>>23,fe[ye+4*ue+2]=fe[ye+4*ue+2]*et>>23)}j+=ce}}function re(g,j,F,Y,te){for(;0<Y--;){var ce;for(ce=0;ce<F;++ce){var ue=g[j+2*ce+0],fe=15&(we=g[j+2*ce+1]),ye=4369*fe,we=(240&we|we>>4)*ye>>16;g[j+2*ce+0]=(240&ue|ue>>4)*ye>>16&240|(15&ue|ue<<4)*ye>>16>>4&15,g[j+2*ce+1]=240&we|fe}j+=te}}function Ce(g,j,F,Y,te,ce,ue,fe){var ye,we,Re=255;for(we=0;we<te;++we){for(ye=0;ye<Y;++ye){var et=g[j+ye];ce[ue+4*ye]=et,Re&=et}j+=F,ue+=fe}return Re!=255}function Ne(g,j,F,Y,te){var ce;for(ce=0;ce<te;++ce)F[Y+ce]=g[j+ce]>>8}function Ke(){Lo=D,Mn=re,Ln=Ce,ba=Ne}function dt(g,j,F){S[g]=function(Y,te,ce,ue,fe,ye,we,Re,et,tt,ze,xt,ct,qe,Be,gt,Ct){var yt,Gt=Ct-1>>1,$t=fe[ye+0]|we[Re+0]<<16,pr=et[tt+0]|ze[xt+0]<<16;t(Y!=null);var Ut=3*$t+pr+131074>>2;for(j(Y[te+0],255&Ut,Ut>>16,ct,qe),ce!=null&&(Ut=3*pr+$t+131074>>2,j(ce[ue+0],255&Ut,Ut>>16,Be,gt)),yt=1;yt<=Gt;++yt){var hn=fe[ye+yt]|we[Re+yt]<<16,bn=et[tt+yt]|ze[xt+yt]<<16,rn=$t+hn+pr+bn+524296,Qr=rn+2*(hn+pr)>>3;Ut=Qr+$t>>1,$t=(rn=rn+2*($t+bn)>>3)+hn>>1,j(Y[te+2*yt-1],255&Ut,Ut>>16,ct,qe+(2*yt-1)*F),j(Y[te+2*yt-0],255&$t,$t>>16,ct,qe+(2*yt-0)*F),ce!=null&&(Ut=rn+pr>>1,$t=Qr+bn>>1,j(ce[ue+2*yt-1],255&Ut,Ut>>16,Be,gt+(2*yt-1)*F),j(ce[ue+2*yt+0],255&$t,$t>>16,Be,gt+(2*yt+0)*F)),$t=hn,pr=bn}1&Ct||(Ut=3*$t+pr+131074>>2,j(Y[te+Ct-1],255&Ut,Ut>>16,ct,qe+(Ct-1)*F),ce!=null&&(Ut=3*pr+$t+131074>>2,j(ce[ue+Ct-1],255&Ut,Ut>>16,Be,gt+(Ct-1)*F)))}}function At(){qo[Kp]=NR,qo[Qp]=kS,qo[SS]=DR,qo[Xp]=ES,qo[Jp]=TS,qo[$y]=IS,qo[CS]=MR,qo[By]=kS,qo[Uy]=ES,qo[Zp]=TS,qo[zy]=IS}function zt(g){return g&-16384?0>g?0:255:g>>LR}function nr(g,j){return zt((19077*g>>8)+(26149*j>>8)-14234)}function Er(g,j,F){return zt((19077*g>>8)-(6419*j>>8)-(13320*F>>8)+8708)}function Sr(g,j){return zt((19077*g>>8)+(33050*j>>8)-17685)}function Kr(g,j,F,Y,te){Y[te+0]=nr(g,F),Y[te+1]=Er(g,j,F),Y[te+2]=Sr(g,j)}function Dn(g,j,F,Y,te){Y[te+0]=Sr(g,j),Y[te+1]=Er(g,j,F),Y[te+2]=nr(g,F)}function Un(g,j,F,Y,te){var ce=Er(g,j,F);j=ce<<3&224|Sr(g,j)>>3,Y[te+0]=248&nr(g,F)|ce>>5,Y[te+1]=j}function ra(g,j,F,Y,te){var ce=240&Sr(g,j)|15;Y[te+0]=240&nr(g,F)|Er(g,j,F)>>4,Y[te+1]=ce}function $a(g,j,F,Y,te){Y[te+0]=255,Kr(g,j,F,Y,te+1)}function Na(g,j,F,Y,te){Dn(g,j,F,Y,te),Y[te+3]=255}function fo(g,j,F,Y,te){Kr(g,j,F,Y,te),Y[te+3]=255}function ki(g,j){return 0>g?0:g>j?j:g}function No(g,j,F){S[g]=function(Y,te,ce,ue,fe,ye,we,Re,et){for(var tt=Re+(-2&et)*F;Re!=tt;)j(Y[te+0],ce[ue+0],fe[ye+0],we,Re),j(Y[te+1],ce[ue+0],fe[ye+0],we,Re+F),te+=2,++ue,++ye,Re+=2*F;1&et&&j(Y[te+0],ce[ue+0],fe[ye+0],we,Re)}}function uu(g,j,F){return F==0?g==0?j==0?6:5:j==0?4:0:F}function mc(g,j,F,Y,te){switch(g>>>30){case 3:Gs(j,F,Y,te,0);break;case 2:xa(j,F,Y,te);break;case 1:Ti(j,F,Y,te)}}function Pl(g,j){var F,Y,te=j.M,ce=j.Nb,ue=g.oc,fe=g.pc+40,ye=g.oc,we=g.pc+584,Re=g.oc,et=g.pc+600;for(F=0;16>F;++F)ue[fe+32*F-1]=129;for(F=0;8>F;++F)ye[we+32*F-1]=129,Re[et+32*F-1]=129;for(0<te?ue[fe-1-32]=ye[we-1-32]=Re[et-1-32]=129:(a(ue,fe-32-1,127,21),a(ye,we-32-1,127,9),a(Re,et-32-1,127,9)),Y=0;Y<g.za;++Y){var tt=j.ya[j.aa+Y];if(0<Y){for(F=-1;16>F;++F)n(ue,fe+32*F-4,ue,fe+32*F+12,4);for(F=-1;8>F;++F)n(ye,we+32*F-4,ye,we+32*F+4,4),n(Re,et+32*F-4,Re,et+32*F+4,4)}var ze=g.Gd,xt=g.Hd+Y,ct=tt.ad,qe=tt.Hc;if(0<te&&(n(ue,fe-32,ze[xt].y,0,16),n(ye,we-32,ze[xt].f,0,8),n(Re,et-32,ze[xt].ea,0,8)),tt.Za){var Be=ue,gt=fe-32+16;for(0<te&&(Y>=g.za-1?a(Be,gt,ze[xt].y[15],4):n(Be,gt,ze[xt+1].y,0,4)),F=0;4>F;F++)Be[gt+128+F]=Be[gt+256+F]=Be[gt+384+F]=Be[gt+0+F];for(F=0;16>F;++F,qe<<=2)Be=ue,gt=fe+DS[F],Qo[tt.Ob[F]](Be,gt),mc(qe,ct,16*+F,Be,gt)}else if(Be=uu(Y,te,tt.Ob[0]),Dl[Be](ue,fe),qe!=0)for(F=0;16>F;++F,qe<<=2)mc(qe,ct,16*+F,ue,fe+DS[F]);for(F=tt.Gc,Be=uu(Y,te,tt.Dd),Ks[Be](ye,we),Ks[Be](Re,et),qe=ct,Be=ye,gt=we,255&(tt=F>>0)&&(170&tt?Hd(qe,256,Be,gt):Do(qe,256,Be,gt)),tt=Re,qe=et,255&(F>>=8)&&(170&F?Hd(ct,320,tt,qe):Do(ct,320,tt,qe)),te<g.Ub-1&&(n(ze[xt].y,0,ue,fe+480,16),n(ze[xt].f,0,ye,we+224,8),n(ze[xt].ea,0,Re,et+224,8)),F=8*ce*g.B,ze=g.sa,xt=g.ta+16*Y+16*ce*g.R,ct=g.qa,tt=g.ra+8*Y+F,qe=g.Ha,Be=g.Ia+8*Y+F,F=0;16>F;++F)n(ze,xt+F*g.R,ue,fe+32*F,16);for(F=0;8>F;++F)n(ct,tt+F*g.B,ye,we+32*F,8),n(qe,Be+F*g.B,Re,et+32*F,8)}}function Ol(g,j,F,Y,te,ce,ue,fe,ye){var we=[0],Re=[0],et=0,tt=ye!=null?ye.kd:0,ze=ye??new zi;if(g==null||12>F)return 7;ze.data=g,ze.w=j,ze.ha=F,j=[j],F=[F],ze.gb=[ze.gb];e:{var xt=j,ct=F,qe=ze.gb;if(t(g!=null),t(ct!=null),t(qe!=null),qe[0]=0,12<=ct[0]&&!r(g,xt[0],"RIFF")){if(r(g,xt[0]+8,"WEBP")){qe=3;break e}var Be=G(g,xt[0]+4);if(12>Be||4294967286<Be){qe=3;break e}if(tt&&Be>ct[0]-8){qe=7;break e}qe[0]=Be,xt[0]+=12,ct[0]-=12}qe=0}if(qe!=0)return qe;for(Be=0<ze.gb[0],F=F[0];;){e:{var gt=g;ct=j,qe=F;var Ct=we,yt=Re,Gt=xt=[0];if((Ut=et=[et])[0]=0,8>qe[0])qe=7;else{if(!r(gt,ct[0],"VP8X")){if(G(gt,ct[0]+4)!=10){qe=3;break e}if(18>qe[0]){qe=7;break e}var $t=G(gt,ct[0]+8),pr=1+Q(gt,ct[0]+12);if(2147483648<=pr*(gt=1+Q(gt,ct[0]+15))){qe=3;break e}Gt!=null&&(Gt[0]=$t),Ct!=null&&(Ct[0]=pr),yt!=null&&(yt[0]=gt),ct[0]+=18,qe[0]-=18,Ut[0]=1}qe=0}}if(et=et[0],xt=xt[0],qe!=0)return qe;if(ct=!!(2&xt),!Be&&et)return 3;if(ce!=null&&(ce[0]=!!(16&xt)),ue!=null&&(ue[0]=ct),fe!=null&&(fe[0]=0),ue=we[0],xt=Re[0],et&&ct&&ye==null){qe=0;break}if(4>F){qe=7;break}if(Be&&et||!Be&&!et&&!r(g,j[0],"ALPH")){F=[F],ze.na=[ze.na],ze.P=[ze.P],ze.Sa=[ze.Sa];e:{$t=g,qe=j,Be=F;var Ut=ze.gb;Ct=ze.na,yt=ze.P,Gt=ze.Sa,pr=22,t($t!=null),t(Be!=null),gt=qe[0];var hn=Be[0];for(t(Ct!=null),t(Gt!=null),Ct[0]=null,yt[0]=null,Gt[0]=0;;){if(qe[0]=gt,Be[0]=hn,8>hn){qe=7;break e}var bn=G($t,gt+4);if(4294967286<bn){qe=3;break e}var rn=8+bn+1&-2;if(pr+=rn,0<Ut&&pr>Ut){qe=3;break e}if(!r($t,gt,"VP8 ")||!r($t,gt,"VP8L")){qe=0;break e}if(hn[0]<rn){qe=7;break e}r($t,gt,"ALPH")||(Ct[0]=$t,yt[0]=gt+8,Gt[0]=bn),gt+=rn,hn-=rn}}if(F=F[0],ze.na=ze.na[0],ze.P=ze.P[0],ze.Sa=ze.Sa[0],qe!=0)break}F=[F],ze.Ja=[ze.Ja],ze.xa=[ze.xa];e:if(Ut=g,qe=j,Be=F,Ct=ze.gb[0],yt=ze.Ja,Gt=ze.xa,$t=qe[0],gt=!r(Ut,$t,"VP8 "),pr=!r(Ut,$t,"VP8L"),t(Ut!=null),t(Be!=null),t(yt!=null),t(Gt!=null),8>Be[0])qe=7;else{if(gt||pr){if(Ut=G(Ut,$t+4),12<=Ct&&Ut>Ct-12){qe=3;break e}if(tt&&Ut>Be[0]-8){qe=7;break e}yt[0]=Ut,qe[0]+=8,Be[0]-=8,Gt[0]=pr}else Gt[0]=5<=Be[0]&&Ut[$t+0]==47&&!(Ut[$t+4]>>5),yt[0]=Be[0];qe=0}if(F=F[0],ze.Ja=ze.Ja[0],ze.xa=ze.xa[0],j=j[0],qe!=0)break;if(4294967286<ze.Ja)return 3;if(fe==null||ct||(fe[0]=ze.xa?2:1),ue=[ue],xt=[xt],ze.xa){if(5>F){qe=7;break}fe=ue,tt=xt,ct=ce,g==null||5>F?g=0:5<=F&&g[j+0]==47&&!(g[j+4]>>5)?(Be=[0],Ut=[0],Ct=[0],R(yt=new C,g,j,F),Zt(yt,Be,Ut,Ct)?(fe!=null&&(fe[0]=Be[0]),tt!=null&&(tt[0]=Ut[0]),ct!=null&&(ct[0]=Ct[0]),g=1):g=0):g=0}else{if(10>F){qe=7;break}fe=xt,g==null||10>F||!Zn(g,j+3,F-3)?g=0:(tt=g[j+0]|g[j+1]<<8|g[j+2]<<16,ct=16383&(g[j+7]<<8|g[j+6]),g=16383&(g[j+9]<<8|g[j+8]),1&tt||3<(tt>>1&7)||!(tt>>4&1)||tt>>5>=ze.Ja||!ct||!g?g=0:(ue&&(ue[0]=ct),fe&&(fe[0]=g),g=1))}if(!g||(ue=ue[0],xt=xt[0],et&&(we[0]!=ue||Re[0]!=xt)))return 3;ye!=null&&(ye[0]=ze,ye.offset=j-ye.w,t(4294967286>j-ye.w),t(ye.offset==ye.ha-F));break}return qe==0||qe==7&&et&&ye==null?(ce!=null&&(ce[0]|=ze.na!=null&&0<ze.na.length),Y!=null&&(Y[0]=ue),te!=null&&(te[0]=xt),0):qe}function gc(g,j,F){var Y=j.width,te=j.height,ce=0,ue=0,fe=Y,ye=te;if(j.Da=g!=null&&0<g.Da,j.Da&&(fe=g.cd,ye=g.bd,ce=g.v,ue=g.j,11>F||(ce&=-2,ue&=-2),0>ce||0>ue||0>=fe||0>=ye||ce+fe>Y||ue+ye>te))return 0;if(j.v=ce,j.j=ue,j.va=ce+fe,j.o=ue+ye,j.U=fe,j.T=ye,j.da=g!=null&&0<g.da,j.da){if(!Ve(fe,ye,F=[g.ib],ce=[g.hb]))return 0;j.ib=F[0],j.hb=ce[0]}return j.ob=g!=null&&g.ob,j.Kb=g==null||!g.Sd,j.da&&(j.ob=j.ib<3*Y/4&&j.hb<3*te/4,j.Kb=0),1}function kl(g){if(g==null)return 2;if(11>g.S){var j=g.f.RGBA;j.fb+=(g.height-1)*j.A,j.A=-j.A}else j=g.f.kb,g=g.height,j.O+=(g-1)*j.fa,j.fa=-j.fa,j.N+=(g-1>>1)*j.Ab,j.Ab=-j.Ab,j.W+=(g-1>>1)*j.Db,j.Db=-j.Db,j.F!=null&&(j.J+=(g-1)*j.lb,j.lb=-j.lb);return 0}function zs(g,j,F,Y){if(Y==null||0>=g||0>=j)return 2;if(F!=null){if(F.Da){var te=F.cd,ce=F.bd,ue=-2&F.v,fe=-2&F.j;if(0>ue||0>fe||0>=te||0>=ce||ue+te>g||fe+ce>j)return 2;g=te,j=ce}if(F.da){if(!Ve(g,j,te=[F.ib],ce=[F.hb]))return 2;g=te[0],j=ce[0]}}Y.width=g,Y.height=j;e:{var ye=Y.width,we=Y.height;if(g=Y.S,0>=ye||0>=we||!(g>=Kp&&13>g))g=2;else{if(0>=Y.Rd&&Y.sd==null){ue=ce=te=j=0;var Re=(fe=ye*MS[g])*we;if(11>g||(ce=(we+1)/2*(j=(ye+1)/2),g==12&&(ue=(te=ye)*we)),(we=o(Re+2*ce+ue))==null){g=1;break e}Y.sd=we,11>g?((ye=Y.f.RGBA).eb=we,ye.fb=0,ye.A=fe,ye.size=Re):((ye=Y.f.kb).y=we,ye.O=0,ye.fa=fe,ye.Fd=Re,ye.f=we,ye.N=0+Re,ye.Ab=j,ye.Cd=ce,ye.ea=we,ye.W=0+Re+ce,ye.Db=j,ye.Ed=ce,g==12&&(ye.F=we,ye.J=0+Re+2*ce),ye.Tc=ue,ye.lb=te)}if(j=1,te=Y.S,ce=Y.width,ue=Y.height,te>=Kp&&13>te)if(11>te)g=Y.f.RGBA,j&=(fe=Math.abs(g.A))*(ue-1)+ce<=g.size,j&=fe>=ce*MS[te],j&=g.eb!=null;else{g=Y.f.kb,fe=(ce+1)/2,Re=(ue+1)/2,ye=Math.abs(g.fa),we=Math.abs(g.Ab);var et=Math.abs(g.Db),tt=Math.abs(g.lb),ze=tt*(ue-1)+ce;j&=ye*(ue-1)+ce<=g.Fd,j&=we*(Re-1)+fe<=g.Cd,j=(j&=et*(Re-1)+fe<=g.Ed)&ye>=ce&we>=fe&et>=fe,j&=g.y!=null,j&=g.f!=null,j&=g.ea!=null,te==12&&(j&=tt>=ce,j&=ze<=g.Tc,j&=g.F!=null)}else j=0;g=j?0:2}}return g!=0||F!=null&&F.fd&&(g=kl(Y)),g}var ua=64,El=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],de=24,he=32,Ee=8,ke=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Qe("Predictor0","PredictorAdd0"),S.Predictor0=function(){return 4278190080},S.Predictor1=function(g){return g},S.Predictor2=function(g,j,F){return j[F+0]},S.Predictor3=function(g,j,F){return j[F+1]},S.Predictor4=function(g,j,F){return j[F-1]},S.Predictor5=function(g,j,F){return st(st(g,j[F+1]),j[F+0])},S.Predictor6=function(g,j,F){return st(g,j[F-1])},S.Predictor7=function(g,j,F){return st(g,j[F+0])},S.Predictor8=function(g,j,F){return st(j[F-1],j[F+0])},S.Predictor9=function(g,j,F){return st(j[F+0],j[F+1])},S.Predictor10=function(g,j,F){return st(st(g,j[F-1]),st(j[F+0],j[F+1]))},S.Predictor11=function(g,j,F){var Y=j[F+0];return 0>=Ze(Y>>24&255,g>>24&255,(j=j[F-1])>>24&255)+Ze(Y>>16&255,g>>16&255,j>>16&255)+Ze(Y>>8&255,g>>8&255,j>>8&255)+Ze(255&Y,255&g,255&j)?Y:g},S.Predictor12=function(g,j,F){var Y=j[F+0];return(vt((g>>24&255)+(Y>>24&255)-((j=j[F-1])>>24&255))<<24|vt((g>>16&255)+(Y>>16&255)-(j>>16&255))<<16|vt((g>>8&255)+(Y>>8&255)-(j>>8&255))<<8|vt((255&g)+(255&Y)-(255&j)))>>>0},S.Predictor13=function(g,j,F){var Y=j[F-1];return(Ye((g=st(g,j[F+0]))>>24&255,Y>>24&255)<<24|Ye(g>>16&255,Y>>16&255)<<16|Ye(g>>8&255,Y>>8&255)<<8|Ye(g>>0&255,Y>>0&255))>>>0};var rt=S.PredictorAdd0;S.PredictorAdd1=We,Qe("Predictor2","PredictorAdd2"),Qe("Predictor3","PredictorAdd3"),Qe("Predictor4","PredictorAdd4"),Qe("Predictor5","PredictorAdd5"),Qe("Predictor6","PredictorAdd6"),Qe("Predictor7","PredictorAdd7"),Qe("Predictor8","PredictorAdd8"),Qe("Predictor9","PredictorAdd9"),Qe("Predictor10","PredictorAdd10"),Qe("Predictor11","PredictorAdd11"),Qe("Predictor12","PredictorAdd12"),Qe("Predictor13","PredictorAdd13");var _t=S.PredictorAdd2;Wt("ColorIndexInverseTransform","MapARGB","32b",function(g){return g>>8&255},function(g){return g}),Wt("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(g){return g},function(g){return g>>8&255});var Bt,Nt=S.ColorIndexInverseTransform,cr=S.MapARGB,Kn=S.VP8LColorIndexInverseTransformAlpha,ya=S.MapAlpha,Vi=S.VP8LPredictorsAdd=[];Vi.length=16,(S.VP8LPredictors=[]).length=16,(S.VP8LPredictorsAdd_C=[]).length=16,(S.VP8LPredictors_C=[]).length=16;var Ws,Gi,Ei,Tl,Hs,Vs,du,Gs,xa,Hd,Ti,Do,fu,Vp,Vd,vc,yc,Il,xc,hu,bc,Nl,Gd,Mo,Lo,Mn,Ln,ba,Ba=o(511),Ys=o(2041),Yd=o(225),pu=o(767),Gp=0,Fy=Ys,Yp=Yd,ho=pu,Ro=Ba,Kp=0,Qp=1,SS=2,Xp=3,Jp=4,$y=5,CS=6,By=7,Uy=8,Zp=9,zy=10,xR=[2,3,7],bR=[3,3,11],AS=[280,256,256,256,40],_R=[0,1,1,1,0],wR=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],jR=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],SR=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],CR=8,Wy=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Hy=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Kd=null,AR=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],PR=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],PS=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],OR=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],kR=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],ER=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],TR=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Dl=[],Qo=[],Ks=[],IR=1,OS=2,Ml=[],qo=[];dt("UpsampleRgbLinePair",Kr,3),dt("UpsampleBgrLinePair",Dn,3),dt("UpsampleRgbaLinePair",fo,4),dt("UpsampleBgraLinePair",Na,4),dt("UpsampleArgbLinePair",$a,4),dt("UpsampleRgba4444LinePair",ra,2),dt("UpsampleRgb565LinePair",Un,2);var NR=S.UpsampleRgbLinePair,DR=S.UpsampleBgrLinePair,kS=S.UpsampleRgbaLinePair,ES=S.UpsampleBgraLinePair,TS=S.UpsampleArgbLinePair,IS=S.UpsampleRgba4444LinePair,MR=S.UpsampleRgb565LinePair,em=16,tm=1<<em-1,Qd=-227,Vy=482,LR=6,NS=0,RR=o(256),qR=o(256),FR=o(256),$R=o(256),BR=o(Vy-Qd),UR=o(Vy-Qd);No("YuvToRgbRow",Kr,3),No("YuvToBgrRow",Dn,3),No("YuvToRgbaRow",fo,4),No("YuvToBgraRow",Na,4),No("YuvToArgbRow",$a,4),No("YuvToRgba4444Row",ra,2),No("YuvToRgb565Row",Un,2);var DS=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],rm=[0,2,8],zR=[8,7,6,4,4,2,2,2,1,1,1,1],WR=1;this.WebPDecodeRGBA=function(g,j,F,Y,te){var ce=Qp,ue=new Fa,fe=new Yt;ue.ba=fe,fe.S=ce,fe.width=[fe.width],fe.height=[fe.height];var ye=fe.width,we=fe.height,Re=new Or;if(Re==null||g==null)var et=2;else t(Re!=null),et=Ol(g,j,F,Re.width,Re.height,Re.Pd,Re.Qd,Re.format,null);if(et!=0?ye=0:(ye!=null&&(ye[0]=Re.width[0]),we!=null&&(we[0]=Re.height[0]),ye=1),ye){fe.width=fe.width[0],fe.height=fe.height[0],Y!=null&&(Y[0]=fe.width),te!=null&&(te[0]=fe.height);e:{if(Y=new kr,(te=new zi).data=g,te.w=j,te.ha=F,te.kd=1,j=[0],t(te!=null),((g=Ol(te.data,te.w,te.ha,null,null,null,j,null,te))==0||g==7)&&j[0]&&(g=4),(j=g)==0){if(t(ue!=null),Y.data=te.data,Y.w=te.w+te.offset,Y.ha=te.ha-te.offset,Y.put=ka,Y.ac=dn,Y.bc=En,Y.ma=ue,te.xa){if((g=Nr())==null){ue=1;break e}if(function(tt,ze){var xt=[0],ct=[0],qe=[0];t:for(;;){if(tt==null)return 0;if(ze==null)return tt.a=2,0;if(tt.l=ze,tt.a=0,R(tt.m,ze.data,ze.w,ze.ha),!Zt(tt.m,xt,ct,qe)){tt.a=3;break t}if(tt.xb=OS,ze.width=xt[0],ze.height=ct[0],!Ar(xt[0],ct[0],1,tt,null))break t;return 1}return t(tt.a!=0),0}(g,Y)){if(Y=(j=zs(Y.width,Y.height,ue.Oa,ue.ba))==0){t:{Y=g;r:for(;;){if(Y==null){Y=0;break t}if(t(Y.s.yc!=null),t(Y.s.Ya!=null),t(0<Y.s.Wb),t((F=Y.l)!=null),t((te=F.ma)!=null),Y.xb!=0){if(Y.ca=te.ba,Y.tb=te.tb,t(Y.ca!=null),!gc(te.Oa,F,Xp)){Y.a=2;break r}if(!$r(Y,F.width)||F.da)break r;if((F.da||at(Y.ca.S))&&Ke(),11>Y.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),Y.ca.f.kb.F!=null&&Ke()),Y.Pb&&0<Y.s.ua&&Y.s.vb.X==null&&!ee(Y.s.vb,Y.s.Wa.Xa)){Y.a=1;break r}Y.xb=0}if(!mt(Y,Y.V,Y.Ba,Y.c,Y.i,F.o,Ge))break r;te.Dc=Y.Ma,Y=1;break t}t(Y.a!=0),Y=0}Y=!Y}Y&&(j=g.a)}else j=g.a}else{if((g=new wn)==null){ue=1;break e}if(g.Fa=te.na,g.P=te.P,g.qc=te.Sa,xn(g,Y)){if((j=zs(Y.width,Y.height,ue.Oa,ue.ba))==0){if(g.Aa=0,F=ue.Oa,t((te=g)!=null),F!=null){if(0<(ye=0>(ye=F.Md)?0:100<ye?255:255*ye/100)){for(we=Re=0;4>we;++we)12>(et=te.pb[we]).lc&&(et.ia=ye*zR[0>et.lc?0:et.lc]>>3),Re|=et.ia;Re&&(alert("todo:VP8InitRandom"),te.ia=1)}te.Ga=F.Id,100<te.Ga?te.Ga=100:0>te.Ga&&(te.Ga=0)}ti(g,Y)||(j=g.a)}}else j=g.a}j==0&&ue.Oa!=null&&ue.Oa.fd&&(j=kl(ue.ba))}ue=j}ce=ue!=0?null:11>ce?fe.f.RGBA.eb:fe.f.kb.y}else ce=null;return ce};var MS=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function u(S,I){for(var U="",O=0;O<4;O++)U+=String.fromCharCode(S[I++]);return U}function d(S,I){return(S[I+0]<<0|S[I+1]<<8|S[I+2]<<16)>>>0}function f(S,I){return(S[I+0]<<0|S[I+1]<<8|S[I+2]<<16|S[I+3]<<24)>>>0}new c;var h=[0],p=[0],v=[],m=new c,y=e,b=function(S,I){var U={},O=0,M=!1,L=0,q=0;if(U.frames=[],!function(N,H,W,ne){for(var se=0;se<ne;se++)if(N[H+se]!=W.charCodeAt(se))return!0;return!1}(S,I,"RIFF",4)){for(f(S,I+=4),I+=8;I<S.length;){var z=u(S,I),K=f(S,I+=4);I+=4;var J=K+(1&K);switch(z){case"VP8 ":case"VP8L":U.frames[O]===void 0&&(U.frames[O]={}),($=U.frames[O]).src_off=M?q:I-8,$.src_size=L+K+8,O++,M&&(M=!1,L=0,q=0);break;case"VP8X":($=U.header={}).feature_flags=S[I];var R=I+4;$.canvas_width=1+d(S,R),R+=3,$.canvas_height=1+d(S,R),R+=3;break;case"ALPH":M=!0,L=J+8,q=I-8;break;case"ANIM":($=U.header).bgcolor=f(S,I),R=I+4,$.loop_count=(X=S)[(C=R)+0]<<0|X[C+1]<<8,R+=2;break;case"ANMF":var k,$;($=U.frames[O]={}).offset_x=2*d(S,I),I+=3,$.offset_y=2*d(S,I),I+=3,$.width=1+d(S,I),I+=3,$.height=1+d(S,I),I+=3,$.duration=d(S,I),I+=3,k=S[I++],$.dispose=1&k,$.blend=k>>1&1}z!="ANMF"&&(I+=J)}var X,C;return U}}(y,0);b.response=y,b.rgbaoutput=!0,b.dataurl=!1;var _=b.header?b.header:null,w=b.frames?b.frames:null;if(_){_.loop_counter=_.loop_count,h=[_.canvas_height],p=[_.canvas_width];for(var A=0;A<w.length&&w[A].blend!=0;A++);}var P=w[0],E=m.WebPDecodeRGBA(y,P.src_off,P.src_size,p,h);P.rgba=E,P.imgwidth=p[0],P.imgheight=h[0];for(var T=0;T<p[0]*h[0]*4;T++)v[T]=E[T];return this.width=p,this.height=h,this.data=v,this}(function(e){var t=function(){return typeof Ow=="function"},r=function(h,p,v,m){var y=4,b=s;switch(m){case e.image_compression.FAST:y=1,b=o;break;case e.image_compression.MEDIUM:y=6,b=l;break;case e.image_compression.SLOW:y=9,b=c}h=n(h,p,v,b);var _=Ow(h,{level:y});return e.__addimage__.arrayBufferToBinaryString(_)},n=function(h,p,v,m){for(var y,b,_,w=h.length/p,A=new Uint8Array(h.length+w),P=d(),E=0;E<w;E+=1){if(_=E*p,y=h.subarray(_,_+p),m)A.set(m(y,v,b),_+E);else{for(var T,S=P.length,I=[];T<S;T+=1)I[T]=P[T](y,v,b);var U=f(I.concat());A.set(I[U],_+E)}b=y}return A},a=function(h){var p=Array.apply([],h);return p.unshift(0),p},o=function(h,p){var v,m=[],y=h.length;m[0]=1;for(var b=0;b<y;b+=1)v=h[b-p]||0,m[b+1]=h[b]-v+256&255;return m},s=function(h,p,v){var m,y=[],b=h.length;y[0]=2;for(var _=0;_<b;_+=1)m=v&&v[_]||0,y[_+1]=h[_]-m+256&255;return y},l=function(h,p,v){var m,y,b=[],_=h.length;b[0]=3;for(var w=0;w<_;w+=1)m=h[w-p]||0,y=v&&v[w]||0,b[w+1]=h[w]+256-(m+y>>>1)&255;return b},c=function(h,p,v){var m,y,b,_,w=[],A=h.length;w[0]=4;for(var P=0;P<A;P+=1)m=h[P-p]||0,y=v&&v[P]||0,b=v&&v[P-p]||0,_=u(m,y,b),w[P+1]=h[P]-_+256&255;return w},u=function(h,p,v){if(h===p&&p===v)return h;var m=Math.abs(p-v),y=Math.abs(h-v),b=Math.abs(h+p-v-v);return m<=y&&m<=b?h:y<=b?p:v},d=function(){return[a,o,s,l,c]},f=function(h){var p=h.map(function(v){return v.reduce(function(m,y){return m+Math.abs(y)},0)});return p.indexOf(Math.min.apply(null,p))};e.processPNG=function(h,p,v,m){var y,b,_,w,A,P,E,T,S,I,U,O,M,L,q,z=this.decode.FLATE_DECODE,K="";if(this.__addimage__.isArrayBuffer(h)&&(h=new Uint8Array(h)),this.__addimage__.isArrayBufferView(h)){if(h=(_=new nce(h)).imgData,b=_.bits,y=_.colorSpace,A=_.colors,[4,6].indexOf(_.colorType)!==-1){if(_.bits===8){S=(T=_.pixelBitlength==32?new Uint32Array(_.decodePixels().buffer):_.pixelBitlength==16?new Uint16Array(_.decodePixels().buffer):new Uint8Array(_.decodePixels().buffer)).length,U=new Uint8Array(S*_.colors),I=new Uint8Array(S);var J,R=_.pixelBitlength-_.bits;for(L=0,q=0;L<S;L++){for(M=T[L],J=0;J<R;)U[q++]=M>>>J&255,J+=_.bits;I[L]=M>>>J&255}}if(_.bits===16){S=(T=new Uint32Array(_.decodePixels().buffer)).length,U=new Uint8Array(S*(32/_.pixelBitlength)*_.colors),I=new Uint8Array(S*(32/_.pixelBitlength)),O=_.colors>1,L=0,q=0;for(var k=0;L<S;)M=T[L++],U[q++]=M>>>0&255,O&&(U[q++]=M>>>16&255,M=T[L++],U[q++]=M>>>0&255),I[k++]=M>>>16&255;b=8}m!==e.image_compression.NONE&&t()?(h=r(U,_.width*_.colors,_.colors,m),E=r(I,_.width,1,m)):(h=U,E=I,z=void 0)}if(_.colorType===3&&(y=this.color_spaces.INDEXED,P=_.palette,_.transparency.indexed)){var $=_.transparency.indexed,X=0;for(L=0,S=$.length;L<S;++L)X+=$[L];if((X/=255)===S-1&&$.indexOf(0)!==-1)w=[$.indexOf(0)];else if(X!==S){for(T=_.decodePixels(),I=new Uint8Array(T.length),L=0,S=T.length;L<S;L++)I[L]=$[T[L]];E=r(I,_.width,1)}}var C=function(N){var H;switch(N){case e.image_compression.FAST:H=11;break;case e.image_compression.MEDIUM:H=13;break;case e.image_compression.SLOW:H=14;break;default:H=12}return H}(m);return z===this.decode.FLATE_DECODE&&(K="/Predictor "+C+" "),K+="/Colors "+A+" /BitsPerComponent "+b+" /Columns "+_.width,(this.__addimage__.isArrayBuffer(h)||this.__addimage__.isArrayBufferView(h))&&(h=this.__addimage__.arrayBufferToBinaryString(h)),(E&&this.__addimage__.isArrayBuffer(E)||this.__addimage__.isArrayBufferView(E))&&(E=this.__addimage__.arrayBufferToBinaryString(E)),{alias:v,data:h,index:p,filter:z,decodeParameters:K,transparency:w,palette:P,sMask:E,predictor:C,width:_.width,height:_.height,bitsPerComponent:b,colorSpace:y}}}})(br.API),function(e){e.processGIF89A=function(t,r,n,a){var o=new ace(t),s=o.width,l=o.height,c=[];o.decodeAndBlitFrameRGBA(0,c);var u={data:c,width:s,height:l},d=new P2(100).encode(u,100);return e.processJPEG.call(this,d,r,n,a)},e.processGIF87A=e.processGIF89A}(br.API),es.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:a,green:n,blue:r,quad:o}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},es.prototype.parseBGR=function(){this.pos=this.offset;try{var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[e]()}catch(r){Pn.log("bit decode error:"+r)}},es.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),r=t%4;for(e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,a=0;a<t;a++)for(var o=this.datav.getUint8(this.pos++,!0),s=n*this.width*4+8*a*4,l=0;l<8&&8*a+l<this.width;l++){var c=this.palette[o>>7-l&1];this.data[s+4*l]=c.blue,this.data[s+4*l+1]=c.green,this.data[s+4*l+2]=c.red,this.data[s+4*l+3]=255}r!==0&&(this.pos+=4-r)}},es.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,a=0;a<e;a++){var o=this.datav.getUint8(this.pos++,!0),s=n*this.width*4+2*a*4,l=o>>4,c=15&o,u=this.palette[l];if(this.data[s]=u.blue,this.data[s+1]=u.green,this.data[s+2]=u.red,this.data[s+3]=255,2*a+1>=this.width)break;u=this.palette[c],this.data[s+4]=u.blue,this.data[s+4+1]=u.green,this.data[s+4+2]=u.red,this.data[s+4+3]=255}t!==0&&(this.pos+=4-t)}},es.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var a=this.datav.getUint8(this.pos++,!0),o=r*this.width*4+4*n;if(a<this.palette.length){var s=this.palette[a];this.data[o]=s.red,this.data[o+1]=s.green,this.data[o+2]=s.blue,this.data[o+3]=255}else this.data[o]=255,this.data[o+1]=255,this.data[o+2]=255,this.data[o+3]=255}e!==0&&(this.pos+=4-e)}},es.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,a=0;a<this.width;a++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var s=(o&t)/t*255|0,l=(o>>5&t)/t*255|0,c=(o>>10&t)/t*255|0,u=o>>15?255:0,d=n*this.width*4+4*a;this.data[d]=c,this.data[d+1]=l,this.data[d+2]=s,this.data[d+3]=u}this.pos+=e}},es.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),r=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var a=this.bottom_up?n:this.height-1-n,o=0;o<this.width;o++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(s&t)/t*255|0,c=(s>>5&r)/r*255|0,u=(s>>11)/t*255|0,d=a*this.width*4+4*o;this.data[d]=u,this.data[d+1]=c,this.data[d+2]=l,this.data[d+3]=255}this.pos+=e}},es.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),s=t*this.width*4+4*r;this.data[s]=o,this.data[s+1]=a,this.data[s+2]=n,this.data[s+3]=255}this.pos+=this.width%4}},es.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),l=t*this.width*4+4*r;this.data[l]=o,this.data[l+1]=a,this.data[l+2]=n,this.data[l+3]=s}},es.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,r,n,a){var o=new es(t,!1),s=o.width,l=o.height,c={data:o.getData(),width:s,height:l},u=new P2(100).encode(c,100);return e.processJPEG.call(this,u,r,n,a)}}(br.API),tT.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,r,n,a){var o=new tT(t),s=o.width,l=o.height,c={data:o.getData(),width:s,height:l},u=new P2(100).encode(c,100);return e.processJPEG.call(this,u,r,n,a)}}(br.API),br.API.processRGBA=function(e,t,r){for(var n=e.data,a=n.length,o=new Uint8Array(a/4*3),s=new Uint8Array(a/4),l=0,c=0,u=0;u<a;u+=4){var d=n[u],f=n[u+1],h=n[u+2],p=n[u+3];o[l++]=d,o[l++]=f,o[l++]=h,s[c++]=p}var v=this.__addimage__.arrayBufferToBinaryString(o);return{alpha:this.__addimage__.arrayBufferToBinaryString(s),data:v,index:t,alias:r,colorSpace:"DeviceRGB",bitsPerComponent:8,width:e.width,height:e.height}},br.API.setLanguage=function(e){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]!==void 0&&(this.internal.languageSettings.languageCode=e,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Au=br.API,Rm=Au.getCharWidthsArray=function(e,t){var r,n,a=(t=t||{}).font||this.internal.getFont(),o=t.fontSize||this.internal.getFontSize(),s=t.charSpace||this.internal.getCharSpace(),l=t.widths?t.widths:a.metadata.Unicode.widths,c=l.fof?l.fof:1,u=t.kerning?t.kerning:a.metadata.Unicode.kerning,d=u.fof?u.fof:1,f=t.doKerning!==!1,h=0,p=e.length,v=0,m=l[0]||c,y=[];for(r=0;r<p;r++)n=e.charCodeAt(r),typeof a.metadata.widthOfString=="function"?y.push((a.metadata.widthOfGlyph(a.metadata.characterToGlyph(n))+s*(1e3/o)||0)/1e3):(h=f&&mn(u[n])==="object"&&!isNaN(parseInt(u[n][v],10))?u[n][v]/d:0,y.push((l[n]||m)/c+h)),v=n;return y},XE=Au.getStringUnitWidth=function(e,t){var r=(t=t||{}).fontSize||this.internal.getFontSize(),n=t.font||this.internal.getFont(),a=t.charSpace||this.internal.getCharSpace();return Au.processArabic&&(e=Au.processArabic(e)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(e,r,a)/r:Rm.apply(this,arguments).reduce(function(o,s){return o+s},0)},JE=function(e,t,r,n){for(var a=[],o=0,s=e.length,l=0;o!==s&&l+t[o]<r;)l+=t[o],o++;a.push(e.slice(0,o));var c=o;for(l=0;o!==s;)l+t[o]>n&&(a.push(e.slice(c,o)),l=0,c=o),l+=t[o],o++;return c!==o&&a.push(e.slice(c,o)),a},ZE=function(e,t,r){r||(r={});var n,a,o,s,l,c,u,d=[],f=[d],h=r.textIndent||0,p=0,v=0,m=e.split(" "),y=Rm.apply(this,[" ",r])[0];if(c=r.lineIndent===-1?m[0].length+2:r.lineIndent||0){var b=Array(c).join(" "),_=[];m.map(function(A){(A=A.split(/\s*\n/)).length>1?_=_.concat(A.map(function(P,E){return(E&&P.length?`
`:"")+P})):_.push(A[0])}),m=_,c=XE.apply(this,[b,r])}for(o=0,s=m.length;o<s;o++){var w=0;if(n=m[o],c&&n[0]==`
`&&(n=n.substr(1),w=1),h+p+(v=(a=Rm.apply(this,[n,r])).reduce(function(A,P){return A+P},0))>t||w){if(v>t){for(l=JE.apply(this,[n,a,t-(h+p),t]),d.push(l.shift()),d=[l.pop()];l.length;)f.push([l.shift()]);v=a.slice(n.length-(d[0]?d[0].length:0)).reduce(function(A,P){return A+P},0)}else d=[n];f.push(d),h=v+c,p=y}else d.push(n),h+=p+v,p=y}return u=c?function(A,P){return(P?b:"")+A.join(" ")}:function(A){return A.join(" ")},f.map(u)},Au.splitTextToSize=function(e,t,r){var n,a=(r=r||{}).fontSize||this.internal.getFontSize(),o=(function(d){if(d.widths&&d.kerning)return{widths:d.widths,kerning:d.kerning};var f=this.internal.getFont(d.fontName,d.fontStyle);return f.metadata.Unicode?{widths:f.metadata.Unicode.widths||{0:1},kerning:f.metadata.Unicode.kerning||{}}:{font:f.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,r);n=Array.isArray(e)?e:String(e).split(/\r?\n/);var s=1*this.internal.scaleFactor*t/a;o.textIndent=r.textIndent?1*r.textIndent*this.internal.scaleFactor/a:0,o.lineIndent=r.lineIndent;var l,c,u=[];for(l=0,c=n.length;l<c;l++)u=u.concat(ZE.apply(this,[n[l],s,o]));return u},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="klmnopqrstuvwxyz",r={},n={},a=0;a<t.length;a++)r[t[a]]="0123456789abcdef"[a],n["0123456789abcdef"[a]]=t[a];var o=function(f){return"0x"+parseInt(f,10).toString(16)},s=e.__fontmetrics__.compress=function(f){var h,p,v,m,y=["{"];for(var b in f){if(h=f[b],isNaN(parseInt(b,10))?p="'"+b+"'":(b=parseInt(b,10),p=(p=o(b).slice(2)).slice(0,-1)+n[p.slice(-1)]),typeof h=="number")h<0?(v=o(h).slice(3),m="-"):(v=o(h).slice(2),m=""),v=m+v.slice(0,-1)+n[v.slice(-1)];else{if(mn(h)!=="object")throw new Error("Don't know what to do with value type "+mn(h)+".");v=s(h)}y.push(p+v)}return y.push("}"),y.join("")},l=e.__fontmetrics__.uncompress=function(f){if(typeof f!="string")throw new Error("Invalid argument passed to uncompress.");for(var h,p,v,m,y={},b=1,_=y,w=[],A="",P="",E=f.length-1,T=1;T<E;T+=1)(m=f[T])=="'"?h?(v=h.join(""),h=void 0):h=[]:h?h.push(m):m=="{"?(w.push([_,v]),_={},v=void 0):m=="}"?((p=w.pop())[0][p[1]]=_,v=void 0,_=p[0]):m=="-"?b=-1:v===void 0?r.hasOwnProperty(m)?(A+=r[m],v=parseInt(A,16)*b,b=1,A=""):A+=m:r.hasOwnProperty(m)?(P+=r[m],_[v]=parseInt(P,16)*b,b=1,v=void 0,P=""):P+=m;return y},c={codePages:["WinAnsiEncoding"],WinAnsiEncoding:l("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},u={Unicode:{Courier:c,"Courier-Bold":c,"Courier-BoldOblique":c,"Courier-Oblique":c,Helvetica:c,"Helvetica-Bold":c,"Helvetica-BoldOblique":c,"Helvetica-Oblique":c,"Times-Roman":c,"Times-Bold":c,"Times-BoldItalic":c,"Times-Italic":c}},d={Unicode:{"Courier-Oblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":l("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":l("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:l("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:l("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":l("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":l("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(f){var h=f.font,p=d.Unicode[h.postScriptName];p&&(h.metadata.Unicode={},h.metadata.Unicode.widths=p.widths,h.metadata.Unicode.kerning=p.kerning);var v=u.Unicode[h.postScriptName];v&&(h.metadata.Unicode.encoding=v,h.encoding=v.codePages[0])}])}(br.API),function(e){var t=function(r){for(var n=r.length,a=new Uint8Array(n),o=0;o<n;o++)a[o]=r.charCodeAt(o);return a};e.API.events.push(["addFont",function(r){var n=void 0,a=r.font,o=r.instance;if(!a.isStandardFont){if(o===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");if(typeof(n=o.existsFileInVFS(a.postScriptName)===!1?o.loadFile(a.postScriptName):o.getFileFromVFS(a.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");(function(s,l){l=/^\x00\x01\x00\x00/.test(l)?t(l):t(Rh(l)),s.metadata=e.API.TTFFont.open(l),s.metadata.Unicode=s.metadata.Unicode||{encoding:{},kerning:{},widths:[]},s.metadata.glyIdsUsed=[0]})(a,n)}}])}(br),function(e){function t(){return(Cr.canvg?Promise.resolve(Cr.canvg):jw(()=>import("./index.es-CxN4jgO7.js"),__vite__mapDeps([0,1,2]))).catch(function(r){return Promise.reject(new Error("Could not load canvg: "+r))}).then(function(r){return r.default?r.default:r})}br.API.addSvgAsImage=function(r,n,a,o,s,l,c,u){if(isNaN(n)||isNaN(a))throw Pn.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(o)||isNaN(s))throw Pn.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var d=document.createElement("canvas");d.width=o,d.height=s;var f=d.getContext("2d");f.fillStyle="#fff",f.fillRect(0,0,d.width,d.height);var h={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},p=this;return t().then(function(v){return v.fromString(f,r,h)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(v){return v.render(h)}).then(function(){p.addImage(d.toDataURL("image/jpeg",1),n,a,o,s,c,u)})}}(),br.API.putTotalPages=function(e){var t,r=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),r=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),r=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var a=0;a<this.internal.pages[n].length;a++)this.internal.pages[n][a]=this.internal.pages[n][a].replace(t,r);return this},br.API.viewerPreferences=function(e,t){var r;e=e||{},t=t||!1;var n,a,o,s={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},l=Object.keys(s),c=[],u=0,d=0,f=0;function h(v,m){var y,b=!1;for(y=0;y<v.length;y+=1)v[y]===m&&(b=!0);return b}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(s)),this.internal.viewerpreferences.isSubscribed=!1),r=this.internal.viewerpreferences.configuration,e==="reset"||t===!0){var p=l.length;for(f=0;f<p;f+=1)r[l[f]].value=r[l[f]].defaultValue,r[l[f]].explicitSet=!1}if(mn(e)==="object"){for(a in e)if(o=e[a],h(l,a)&&o!==void 0){if(r[a].type==="boolean"&&typeof o=="boolean")r[a].value=o;else if(r[a].type==="name"&&h(r[a].valueSet,o))r[a].value=o;else if(r[a].type==="integer"&&Number.isInteger(o))r[a].value=o;else if(r[a].type==="array"){for(u=0;u<o.length;u+=1)if(n=!0,o[u].length===1&&typeof o[u][0]=="number")c.push(String(o[u]-1));else if(o[u].length>1){for(d=0;d<o[u].length;d+=1)typeof o[u][d]!="number"&&(n=!1);n===!0&&c.push([o[u][0]-1,o[u][1]-1].join(" "))}r[a].value="["+c.join(" ")+"]"}else r[a].value=r[a].defaultValue;r[a].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var v,m=[];for(v in r)r[v].explicitSet===!0&&(r[v].type==="name"?m.push("/"+v+" /"+r[v].value):m.push("/"+v+" "+r[v].value));m.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+m.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=r,this},function(e){var t=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',a=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),o=unescape(encodeURIComponent(n)),s=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),l=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),c=unescape(encodeURIComponent("</x:xmpmeta>")),u=o.length+s.length+l.length+a.length+c.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+u+" >>"),this.internal.write("stream"),this.internal.write(a+o+s+l+c),this.internal.write("endstream"),this.internal.write("endobj")},r=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};e.addMetadata=function(n,a){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:a||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",r),this.internal.events.subscribe("postPutResources",t)),this}}(br.API),function(e){var t=e.API,r=t.pdfEscape16=function(o,s){for(var l,c=s.metadata.Unicode.widths,u=["","0","00","000","0000"],d=[""],f=0,h=o.length;f<h;++f){if(l=s.metadata.characterToGlyph(o.charCodeAt(f)),s.metadata.glyIdsUsed.push(l),s.metadata.toUnicode[l]=o.charCodeAt(f),c.indexOf(l)==-1&&(c.push(l),c.push([parseInt(s.metadata.widthOfGlyph(l),10)])),l=="0")return d.join("");l=l.toString(16),d.push(u[4-l.length],l)}return d.join("")},n=function(o){var s,l,c,u,d,f,h;for(d=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,c=[],f=0,h=(l=Object.keys(o).sort(function(p,v){return p-v})).length;f<h;f++)s=l[f],c.length>=100&&(d+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar`,c=[]),o[s]!==void 0&&o[s]!==null&&typeof o[s].toString=="function"&&(u=("0000"+o[s].toString(16)).slice(-4),s=("0000"+(+s).toString(16)).slice(-4),c.push("<"+s+"><"+u+">"));return c.length&&(d+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar
`),d+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(o){(function(s){var l=s.font,c=s.out,u=s.newObject,d=s.putStream;if(l.metadata instanceof e.API.TTFFont&&l.encoding==="Identity-H"){for(var f=l.metadata.Unicode.widths,h=l.metadata.subset.encode(l.metadata.glyIdsUsed,1),p="",v=0;v<h.length;v++)p+=String.fromCharCode(h[v]);var m=u();d({data:p,addLength1:!0,objectId:m}),c("endobj");var y=u();d({data:n(l.metadata.toUnicode),addLength1:!0,objectId:y}),c("endobj");var b=u();c("<<"),c("/Type /FontDescriptor"),c("/FontName /"+Eu(l.fontName)),c("/FontFile2 "+m+" 0 R"),c("/FontBBox "+e.API.PDFObject.convert(l.metadata.bbox)),c("/Flags "+l.metadata.flags),c("/StemV "+l.metadata.stemV),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c(">>"),c("endobj");var _=u();c("<<"),c("/Type /Font"),c("/BaseFont /"+Eu(l.fontName)),c("/FontDescriptor "+b+" 0 R"),c("/W "+e.API.PDFObject.convert(f)),c("/CIDToGIDMap /Identity"),c("/DW 1000"),c("/Subtype /CIDFontType2"),c("/CIDSystemInfo"),c("<<"),c("/Supplement 0"),c("/Registry (Adobe)"),c("/Ordering ("+l.encoding+")"),c(">>"),c(">>"),c("endobj"),l.objectNumber=u(),c("<<"),c("/Type /Font"),c("/Subtype /Type0"),c("/ToUnicode "+y+" 0 R"),c("/BaseFont /"+Eu(l.fontName)),c("/Encoding /"+l.encoding),c("/DescendantFonts ["+_+" 0 R]"),c(">>"),c("endobj"),l.isAlreadyPutted=!0}})(o)}]),t.events.push(["putFont",function(o){(function(s){var l=s.font,c=s.out,u=s.newObject,d=s.putStream;if(l.metadata instanceof e.API.TTFFont&&l.encoding==="WinAnsiEncoding"){for(var f=l.metadata.rawData,h="",p=0;p<f.length;p++)h+=String.fromCharCode(f[p]);var v=u();d({data:h,addLength1:!0,objectId:v}),c("endobj");var m=u();d({data:n(l.metadata.toUnicode),addLength1:!0,objectId:m}),c("endobj");var y=u();c("<<"),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c("/StemV "+l.metadata.stemV),c("/Type /FontDescriptor"),c("/FontFile2 "+v+" 0 R"),c("/Flags 96"),c("/FontBBox "+e.API.PDFObject.convert(l.metadata.bbox)),c("/FontName /"+Eu(l.fontName)),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c(">>"),c("endobj"),l.objectNumber=u();for(var b=0;b<l.metadata.hmtx.widths.length;b++)l.metadata.hmtx.widths[b]=parseInt(l.metadata.hmtx.widths[b]*(1e3/l.metadata.head.unitsPerEm));c("<</Subtype/TrueType/Type/Font/ToUnicode "+m+" 0 R/BaseFont/"+Eu(l.fontName)+"/FontDescriptor "+y+" 0 R/Encoding/"+l.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(l.metadata.hmtx.widths)+">>"),c("endobj"),l.isAlreadyPutted=!0}})(o)}]);var a=function(o){var s,l=o.text||"",c=o.x,u=o.y,d=o.options||{},f=o.mutex||{},h=f.pdfEscape,p=f.activeFontKey,v=f.fonts,m=p,y="",b=0,_="",w=v[m].encoding;if(v[m].encoding!=="Identity-H")return{text:l,x:c,y:u,options:d,mutex:f};for(_=l,m=p,Array.isArray(l)&&(_=l[0]),b=0;b<_.length;b+=1)v[m].metadata.hasOwnProperty("cmap")&&(s=v[m].metadata.cmap.unicode.codeMap[_[b].charCodeAt(0)]),s||_[b].charCodeAt(0)<256&&v[m].metadata.hasOwnProperty("Unicode")?y+=_[b]:y+="";var A="";return parseInt(m.slice(1))<14||w==="WinAnsiEncoding"?A=h(y,m).split("").map(function(P){return P.charCodeAt(0).toString(16)}).join(""):w==="Identity-H"&&(A=r(y,v[m])),f.isHex=!0,{text:A,x:c,y:u,options:d,mutex:f}};t.events.push(["postProcessText",function(o){var s=o.text||"",l=[],c={text:s,x:o.x,y:o.y,options:o.options,mutex:o.mutex};if(Array.isArray(s)){var u=0;for(u=0;u<s.length;u+=1)Array.isArray(s[u])&&s[u].length===3?l.push([a(Object.assign({},c,{text:s[u][0]})).text,s[u][1],s[u][2]]):l.push(a(Object.assign({},c,{text:s[u]})).text);o.text=l}else o.text=a(Object.assign({},c,{text:s})).text}])}(br),function(e){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0},e.addFileToVFS=function(r,n){return t.call(this),this.internal.vFS[r]=n,this},e.getFileFromVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0?this.internal.vFS[r]:null}}(br.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(n){var a,o,s,l,c,u,d,f=t,h=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],p=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],v={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},m={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},y=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],b=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),_=!1,w=0;this.__bidiEngine__={};var A=function(O){var M=O.charCodeAt(),L=M>>8,q=m[L];return q!==void 0?f[256*q+(255&M)]:L===252||L===253?"AL":b.test(L)?"L":L===8?"R":"N"},P=function(O){for(var M,L=0;L<O.length;L++){if((M=A(O.charAt(L)))==="L")return!1;if(M==="R")return!0}return!1},E=function(O,M,L,q){var z,K,J,R,k=M[q];switch(k){case"L":case"R":_=!1;break;case"N":case"AN":break;case"EN":_&&(k="AN");break;case"AL":_=!0,k="R";break;case"WS":k="N";break;case"CS":q<1||q+1>=M.length||(z=L[q-1])!=="EN"&&z!=="AN"||(K=M[q+1])!=="EN"&&K!=="AN"?k="N":_&&(K="AN"),k=K===z?K:"N";break;case"ES":k=(z=q>0?L[q-1]:"B")==="EN"&&q+1<M.length&&M[q+1]==="EN"?"EN":"N";break;case"ET":if(q>0&&L[q-1]==="EN"){k="EN";break}if(_){k="N";break}for(J=q+1,R=M.length;J<R&&M[J]==="ET";)J++;k=J<R&&M[J]==="EN"?"EN":"N";break;case"NSM":if(s&&!l){for(R=M.length,J=q+1;J<R&&M[J]==="NSM";)J++;if(J<R){var $=O[q],X=$>=1425&&$<=2303||$===64286;if(z=M[J],X&&(z==="R"||z==="AL")){k="R";break}}}k=q<1||(z=M[q-1])==="B"?"N":L[q-1];break;case"B":_=!1,a=!0,k=w;break;case"S":o=!0,k="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":_=!1;break;case"BN":k="N"}return k},T=function(O,M,L){var q=O.split("");return L&&S(q,L,{hiLevel:w}),q.reverse(),M&&M.reverse(),q.join("")},S=function(O,M,L){var q,z,K,J,R,k=-1,$=O.length,X=0,C=[],N=w?p:h,H=[];for(_=!1,a=!1,o=!1,z=0;z<$;z++)H[z]=A(O[z]);for(K=0;K<$;K++){if(R=X,C[K]=E(O,H,C,K),q=240&(X=N[R][v[C[K]]]),X&=15,M[K]=J=N[X][5],q>0)if(q===16){for(z=k;z<K;z++)M[z]=1;k=-1}else k=-1;if(N[X][6])k===-1&&(k=K);else if(k>-1){for(z=k;z<K;z++)M[z]=J;k=-1}H[K]==="B"&&(M[K]=0),L.hiLevel|=J}o&&function(W,ne,se){for(var oe=0;oe<se;oe++)if(W[oe]==="S"){ne[oe]=w;for(var ae=oe-1;ae>=0&&W[ae]==="WS";ae--)ne[ae]=w}}(H,M,$)},I=function(O,M,L,q,z){if(!(z.hiLevel<O)){if(O===1&&w===1&&!a)return M.reverse(),void(L&&L.reverse());for(var K,J,R,k,$=M.length,X=0;X<$;){if(q[X]>=O){for(R=X+1;R<$&&q[R]>=O;)R++;for(k=X,J=R-1;k<J;k++,J--)K=M[k],M[k]=M[J],M[J]=K,L&&(K=L[k],L[k]=L[J],L[J]=K);X=R}X++}}},U=function(O,M,L){var q=O.split(""),z={hiLevel:w};return L||(L=[]),S(q,L,z),function(K,J,R){if(R.hiLevel!==0&&d)for(var k,$=0;$<K.length;$++)J[$]===1&&(k=y.indexOf(K[$]))>=0&&(K[$]=y[k+1])}(q,L,z),I(2,q,M,L,z),I(1,q,M,L,z),q.join("")};return this.__bidiEngine__.doBidiReorder=function(O,M,L){if(function(z,K){if(K)for(var J=0;J<z.length;J++)K[J]=J;l===void 0&&(l=P(z)),u===void 0&&(u=P(z))}(O,M),s||!c||u)if(s&&c&&l^u)w=l?1:0,O=T(O,M,L);else if(!s&&c&&u)w=l?1:0,O=U(O,M,L),O=T(O,M);else if(!s||l||c||u){if(s&&!c&&l^u)O=T(O,M),l?(w=0,O=U(O,M,L)):(w=1,O=U(O,M,L),O=T(O,M));else if(s&&l&&!c&&u)w=1,O=U(O,M,L),O=T(O,M);else if(!s&&!c&&l^u){var q=d;l?(w=1,O=U(O,M,L),w=0,d=!1,O=U(O,M,L),d=q):(w=0,O=U(O,M,L),O=T(O,M),w=1,d=!1,O=U(O,M,L),d=q,O=T(O,M))}}else w=0,O=U(O,M,L);else w=l?1:0,O=U(O,M,L);return O},this.__bidiEngine__.setOptions=function(O){O&&(s=O.isInputVisual,c=O.isOutputVisual,l=O.isInputRtl,u=O.isOutputRtl,d=O.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],r=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(n){var a=n.text;n.x,n.y;var o=n.options||{};n.mutex,o.lang;var s=[];if(o.isInputVisual=typeof o.isInputVisual!="boolean"||o.isInputVisual,r.setOptions(o),Object.prototype.toString.call(a)==="[object Array]"){var l=0;for(s=[],l=0;l<a.length;l+=1)Object.prototype.toString.call(a[l])==="[object Array]"?s.push([r.doBidiReorder(a[l][0]),a[l][1],a[l][2]]):s.push([r.doBidiReorder(a[l])]);n.text=s}else n.text=r.doBidiReorder(a);r.setOptions({isInputVisual:!0})}])}(br),br.API.TTFFont=function(){function e(t){var r;if(this.rawData=t,r=this.contents=new rc(t),this.contents.pos=4,r.readString(4)==="ttcf")throw new Error("TTCF not supported.");r.pos=0,this.parse(),this.subset=new xce(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new ice(this.contents),this.head=new sce(this),this.name=new fce(this),this.cmap=new L6(this),this.toUnicode={},this.hhea=new lce(this),this.maxp=new hce(this),this.hmtx=new pce(this),this.post=new uce(this),this.os2=new cce(this),this.loca=new yce(this),this.glyf=new mce(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var t,r,n,a,o;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var s,l,c,u;for(u=[],s=0,l=(c=this.bbox).length;s<l;s++)t=c[s],u.push(Math.round(t*this.scaleFactor));return u}).call(this),this.stemV=0,this.post.exists?(n=255&(a=this.post.italic_angle),(32768&(r=a>>16))!=0&&(r=-(1+(65535^r))),this.italicAngle=+(r+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(o=this.familyClass)===1||o===2||o===3||o===4||o===5||o===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(t){var r;return((r=this.cmap.unicode)!=null?r.codeMap[t]:void 0)||0},e.prototype.widthOfGlyph=function(t){var r;return r=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*r},e.prototype.widthOfString=function(t,r,n){var a,o,s,l;for(s=0,o=0,l=(t=""+t).length;0<=l?o<l:o>l;o=0<=l?++o:--o)a=t.charCodeAt(o),s+=this.widthOfGlyph(this.characterToGlyph(a))+n*(1e3/r)||0;return s*(r/1e3)},e.prototype.lineHeight=function(t,r){var n;return r==null&&(r=!1),n=r?this.lineGap:0,(this.ascender+n-this.decender)/1e3*t},e}();var ds,rc=function(){function e(t){this.data=t??[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(t){return this.data[this.pos++]=t},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},e.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},e.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},e.prototype.readString=function(t){var r,n;for(n=[],r=0;0<=t?r<t:r>t;r=0<=t?++r:--r)n[r]=String.fromCharCode(this.readByte());return n.join("")},e.prototype.writeString=function(t){var r,n,a;for(a=[],r=0,n=t.length;0<=n?r<n:r>n;r=0<=n?++r:--r)a.push(this.writeByte(t.charCodeAt(r)));return a},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(t){return this.writeInt16(t)},e.prototype.readLongLong=function(){var t,r,n,a,o,s,l,c;return t=this.readByte(),r=this.readByte(),n=this.readByte(),a=this.readByte(),o=this.readByte(),s=this.readByte(),l=this.readByte(),c=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^r)+1099511627776*(255^n)+4294967296*(255^a)+16777216*(255^o)+65536*(255^s)+256*(255^l)+(255^c)+1):72057594037927940*t+281474976710656*r+1099511627776*n+4294967296*a+16777216*o+65536*s+256*l+c},e.prototype.writeLongLong=function(t){var r,n;return r=Math.floor(t/4294967296),n=4294967295&t,this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(t){return this.writeInt32(t)},e.prototype.read=function(t){var r,n;for(r=[],n=0;0<=t?n<t:n>t;n=0<=t?++n:--n)r.push(this.readByte());return r},e.prototype.write=function(t){var r,n,a,o;for(o=[],n=0,a=t.length;n<a;n++)r=t[n],o.push(this.writeByte(r));return o},e}(),ice=function(){var e;function t(r){var n,a,o;for(this.scalarType=r.readInt(),this.tableCount=r.readShort(),this.searchRange=r.readShort(),this.entrySelector=r.readShort(),this.rangeShift=r.readShort(),this.tables={},a=0,o=this.tableCount;0<=o?a<o:a>o;a=0<=o?++a:--a)n={tag:r.readString(4),checksum:r.readInt(),offset:r.readInt(),length:r.readInt()},this.tables[n.tag]=n}return t.prototype.encode=function(r){var n,a,o,s,l,c,u,d,f,h,p,v,m;for(m in p=Object.keys(r).length,c=Math.log(2),f=16*Math.floor(Math.log(p)/c),s=Math.floor(f/c),d=16*p-f,(a=new rc).writeInt(this.scalarType),a.writeShort(p),a.writeShort(f),a.writeShort(s),a.writeShort(d),o=16*p,u=a.pos+o,l=null,v=[],r)for(h=r[m],a.writeString(m),a.writeInt(e(h)),a.writeInt(u),a.writeInt(h.length),v=v.concat(h),m==="head"&&(l=u),u+=h.length;u%4;)v.push(0),u++;return a.write(v),n=2981146554-e(a.data),a.pos=l+8,a.writeUInt32(n),a.data},e=function(r){var n,a,o,s;for(r=R6.call(r);r.length%4;)r.push(0);for(o=new rc(r),a=0,n=0,s=r.length;n<s;n=n+=4)a+=o.readUInt32();return 4294967295&a},t}(),oce={}.hasOwnProperty,qs=function(e,t){for(var r in t)oce.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};ds=function(){function e(t){var r;this.file=t,r=this.file.directory.tables[this.tag],this.exists=!!r,r&&(this.offset=r.offset,this.length=r.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var sce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="head",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.revision=r.readInt(),this.checkSumAdjustment=r.readInt(),this.magicNumber=r.readInt(),this.flags=r.readShort(),this.unitsPerEm=r.readShort(),this.created=r.readLongLong(),this.modified=r.readLongLong(),this.xMin=r.readShort(),this.yMin=r.readShort(),this.xMax=r.readShort(),this.yMax=r.readShort(),this.macStyle=r.readShort(),this.lowestRecPPEM=r.readShort(),this.fontDirectionHint=r.readShort(),this.indexToLocFormat=r.readShort(),this.glyphDataFormat=r.readShort()},t.prototype.encode=function(r){var n;return(n=new rc).writeInt(this.version),n.writeInt(this.revision),n.writeInt(this.checkSumAdjustment),n.writeInt(this.magicNumber),n.writeShort(this.flags),n.writeShort(this.unitsPerEm),n.writeLongLong(this.created),n.writeLongLong(this.modified),n.writeShort(this.xMin),n.writeShort(this.yMin),n.writeShort(this.xMax),n.writeShort(this.yMax),n.writeShort(this.macStyle),n.writeShort(this.lowestRecPPEM),n.writeShort(this.fontDirectionHint),n.writeShort(r),n.writeShort(this.glyphDataFormat),n.data},t}(),rT=function(){function e(t,r){var n,a,o,s,l,c,u,d,f,h,p,v,m,y,b,_,w;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=r+t.readInt(),f=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(c=0;c<256;++c)this.codeMap[c]=t.readByte();break;case 4:for(p=t.readUInt16(),h=p/2,t.pos+=6,o=function(){var A,P;for(P=[],c=A=0;0<=h?A<h:A>h;c=0<=h?++A:--A)P.push(t.readUInt16());return P}(),t.pos+=2,m=function(){var A,P;for(P=[],c=A=0;0<=h?A<h:A>h;c=0<=h?++A:--A)P.push(t.readUInt16());return P}(),u=function(){var A,P;for(P=[],c=A=0;0<=h?A<h:A>h;c=0<=h?++A:--A)P.push(t.readUInt16());return P}(),d=function(){var A,P;for(P=[],c=A=0;0<=h?A<h:A>h;c=0<=h?++A:--A)P.push(t.readUInt16());return P}(),a=(this.length-t.pos+this.offset)/2,l=function(){var A,P;for(P=[],c=A=0;0<=a?A<a:A>a;c=0<=a?++A:--A)P.push(t.readUInt16());return P}(),c=b=0,w=o.length;b<w;c=++b)for(y=o[c],n=_=v=m[c];v<=y?_<=y:_>=y;n=v<=y?++_:--_)d[c]===0?s=n+u[c]:(s=l[d[c]/2+(n-v)-(h-c)]||0)!==0&&(s+=u[c]),this.codeMap[n]=65535&s}t.pos=f}return e.encode=function(t,r){var n,a,o,s,l,c,u,d,f,h,p,v,m,y,b,_,w,A,P,E,T,S,I,U,O,M,L,q,z,K,J,R,k,$,X,C,N,H,W,ne,se,oe,ae,pe,ge,Q;switch(q=new rc,s=Object.keys(t).sort(function(G,ee){return G-ee}),r){case"macroman":for(m=0,y=function(){var G=[];for(v=0;v<256;++v)G.push(0);return G}(),_={0:0},o={},z=0,k=s.length;z<k;z++)_[ae=t[a=s[z]]]==null&&(_[ae]=++m),o[a]={old:t[a],new:_[t[a]]},y[a]=_[t[a]];return q.writeUInt16(1),q.writeUInt16(0),q.writeUInt32(12),q.writeUInt16(0),q.writeUInt16(262),q.writeUInt16(0),q.write(y),{charMap:o,subtable:q.data,maxGlyphID:m+1};case"unicode":for(M=[],f=[],w=0,_={},n={},b=u=null,K=0,$=s.length;K<$;K++)_[P=t[a=s[K]]]==null&&(_[P]=++w),n[a]={old:P,new:_[P]},l=_[P]-a,b!=null&&l===u||(b&&f.push(b),M.push(a),u=l),b=a;for(b&&f.push(b),f.push(65535),M.push(65535),U=2*(I=M.length),S=2*Math.pow(Math.log(I)/Math.LN2,2),h=Math.log(S/2)/Math.LN2,T=2*I-S,c=[],E=[],p=[],v=J=0,X=M.length;J<X;v=++J){if(O=M[v],d=f[v],O===65535){c.push(0),E.push(0);break}if(O-(L=n[O].new)>=32768)for(c.push(0),E.push(2*(p.length+I-v)),a=R=O;O<=d?R<=d:R>=d;a=O<=d?++R:--R)p.push(n[a].new);else c.push(L-O),E.push(0)}for(q.writeUInt16(3),q.writeUInt16(1),q.writeUInt32(12),q.writeUInt16(4),q.writeUInt16(16+8*I+2*p.length),q.writeUInt16(0),q.writeUInt16(U),q.writeUInt16(S),q.writeUInt16(h),q.writeUInt16(T),se=0,C=f.length;se<C;se++)a=f[se],q.writeUInt16(a);for(q.writeUInt16(0),oe=0,N=M.length;oe<N;oe++)a=M[oe],q.writeUInt16(a);for(pe=0,H=c.length;pe<H;pe++)l=c[pe],q.writeUInt16(l);for(ge=0,W=E.length;ge<W;ge++)A=E[ge],q.writeUInt16(A);for(Q=0,ne=p.length;Q<ne;Q++)m=p[Q],q.writeUInt16(m);return{charMap:n,subtable:q.data,maxGlyphID:w+1}}},e}(),L6=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="cmap",t.prototype.parse=function(r){var n,a,o;for(r.pos=this.offset,this.version=r.readUInt16(),o=r.readUInt16(),this.tables=[],this.unicode=null,a=0;0<=o?a<o:a>o;a=0<=o?++a:--a)n=new rT(r,this.offset),this.tables.push(n),n.isUnicode&&this.unicode==null&&(this.unicode=n);return!0},t.encode=function(r,n){var a,o;return n==null&&(n="macroman"),a=rT.encode(r,n),(o=new rc).writeUInt16(0),o.writeUInt16(1),a.table=o.data.concat(a.subtable),a},t}(),lce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="hhea",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.ascender=r.readShort(),this.decender=r.readShort(),this.lineGap=r.readShort(),this.advanceWidthMax=r.readShort(),this.minLeftSideBearing=r.readShort(),this.minRightSideBearing=r.readShort(),this.xMaxExtent=r.readShort(),this.caretSlopeRise=r.readShort(),this.caretSlopeRun=r.readShort(),this.caretOffset=r.readShort(),r.pos+=8,this.metricDataFormat=r.readShort(),this.numberOfMetrics=r.readUInt16()},t}(),cce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="OS/2",t.prototype.parse=function(r){if(r.pos=this.offset,this.version=r.readUInt16(),this.averageCharWidth=r.readShort(),this.weightClass=r.readUInt16(),this.widthClass=r.readUInt16(),this.type=r.readShort(),this.ySubscriptXSize=r.readShort(),this.ySubscriptYSize=r.readShort(),this.ySubscriptXOffset=r.readShort(),this.ySubscriptYOffset=r.readShort(),this.ySuperscriptXSize=r.readShort(),this.ySuperscriptYSize=r.readShort(),this.ySuperscriptXOffset=r.readShort(),this.ySuperscriptYOffset=r.readShort(),this.yStrikeoutSize=r.readShort(),this.yStrikeoutPosition=r.readShort(),this.familyClass=r.readShort(),this.panose=function(){var n,a;for(a=[],n=0;n<10;++n)a.push(r.readByte());return a}(),this.charRange=function(){var n,a;for(a=[],n=0;n<4;++n)a.push(r.readInt());return a}(),this.vendorID=r.readString(4),this.selection=r.readShort(),this.firstCharIndex=r.readShort(),this.lastCharIndex=r.readShort(),this.version>0&&(this.ascent=r.readShort(),this.descent=r.readShort(),this.lineGap=r.readShort(),this.winAscent=r.readShort(),this.winDescent=r.readShort(),this.codePageRange=function(){var n,a;for(a=[],n=0;n<2;n=++n)a.push(r.readInt());return a}(),this.version>1))return this.xHeight=r.readShort(),this.capHeight=r.readShort(),this.defaultChar=r.readShort(),this.breakChar=r.readShort(),this.maxContext=r.readShort()},t}(),uce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="post",t.prototype.parse=function(r){var n,a,o;switch(r.pos=this.offset,this.format=r.readInt(),this.italicAngle=r.readInt(),this.underlinePosition=r.readShort(),this.underlineThickness=r.readShort(),this.isFixedPitch=r.readInt(),this.minMemType42=r.readInt(),this.maxMemType42=r.readInt(),this.minMemType1=r.readInt(),this.maxMemType1=r.readInt(),this.format){case 65536:break;case 131072:var s;for(a=r.readUInt16(),this.glyphNameIndex=[],s=0;0<=a?s<a:s>a;s=0<=a?++s:--s)this.glyphNameIndex.push(r.readUInt16());for(this.names=[],o=[];r.pos<this.offset+this.length;)n=r.readByte(),o.push(this.names.push(r.readString(n)));return o;case 151552:return a=r.readUInt16(),this.offsets=r.read(a);case 196608:break;case 262144:return this.map=(function(){var l,c,u;for(u=[],s=l=0,c=this.file.maxp.numGlyphs;0<=c?l<c:l>c;s=0<=c?++l:--l)u.push(r.readUInt32());return u}).call(this)}},t}(),dce=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},fce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="name",t.prototype.parse=function(r){var n,a,o,s,l,c,u,d,f,h,p;for(r.pos=this.offset,r.readShort(),n=r.readShort(),c=r.readShort(),a=[],s=0;0<=n?s<n:s>n;s=0<=n?++s:--s)a.push({platformID:r.readShort(),encodingID:r.readShort(),languageID:r.readShort(),nameID:r.readShort(),length:r.readShort(),offset:this.offset+c+r.readShort()});for(u={},s=f=0,h=a.length;f<h;s=++f)o=a[s],r.pos=o.offset,d=r.readString(o.length),l=new dce(d,o),u[p=o.nameID]==null&&(u[p]=[]),u[o.nameID].push(l);this.strings=u,this.copyright=u[0],this.fontFamily=u[1],this.fontSubfamily=u[2],this.uniqueSubfamily=u[3],this.fontName=u[4],this.version=u[5];try{this.postscriptName=u[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=u[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=u[7],this.manufacturer=u[8],this.designer=u[9],this.description=u[10],this.vendorUrl=u[11],this.designerUrl=u[12],this.license=u[13],this.licenseUrl=u[14],this.preferredFamily=u[15],this.preferredSubfamily=u[17],this.compatibleFull=u[18],this.sampleText=u[19]},t}(),hce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="maxp",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.numGlyphs=r.readUInt16(),this.maxPoints=r.readUInt16(),this.maxContours=r.readUInt16(),this.maxCompositePoints=r.readUInt16(),this.maxComponentContours=r.readUInt16(),this.maxZones=r.readUInt16(),this.maxTwilightPoints=r.readUInt16(),this.maxStorage=r.readUInt16(),this.maxFunctionDefs=r.readUInt16(),this.maxInstructionDefs=r.readUInt16(),this.maxStackElements=r.readUInt16(),this.maxSizeOfInstructions=r.readUInt16(),this.maxComponentElements=r.readUInt16(),this.maxComponentDepth=r.readUInt16()},t}(),pce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="hmtx",t.prototype.parse=function(r){var n,a,o,s,l,c,u;for(r.pos=this.offset,this.metrics=[],n=0,c=this.file.hhea.numberOfMetrics;0<=c?n<c:n>c;n=0<=c?++n:--n)this.metrics.push({advance:r.readUInt16(),lsb:r.readInt16()});for(o=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var d,f;for(f=[],n=d=0;0<=o?d<o:d>o;n=0<=o?++d:--d)f.push(r.readInt16());return f}(),this.widths=(function(){var d,f,h,p;for(p=[],d=0,f=(h=this.metrics).length;d<f;d++)s=h[d],p.push(s.advance);return p}).call(this),a=this.widths[this.widths.length-1],u=[],n=l=0;0<=o?l<o:l>o;n=0<=o?++l:--l)u.push(this.widths.push(a));return u},t.prototype.forGlyph=function(r){return r in this.metrics?this.metrics[r]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[r-this.metrics.length]}},t}(),R6=[].slice,mce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(r){var n,a,o,s,l,c,u,d,f,h;return r in this.cache?this.cache[r]:(s=this.file.loca,n=this.file.contents,a=s.indexOf(r),(o=s.lengthOf(r))===0?this.cache[r]=null:(n.pos=this.offset+a,l=(c=new rc(n.read(o))).readShort(),d=c.readShort(),h=c.readShort(),u=c.readShort(),f=c.readShort(),this.cache[r]=l===-1?new vce(c,d,h,u,f):new gce(c,l,d,h,u,f),this.cache[r]))},t.prototype.encode=function(r,n,a){var o,s,l,c,u;for(l=[],s=[],c=0,u=n.length;c<u;c++)o=r[n[c]],s.push(l.length),o&&(l=l.concat(o.encode(a)));return s.push(l.length),{table:l,offsets:s}},t}(),gce=function(){function e(t,r,n,a,o,s){this.raw=t,this.numberOfContours=r,this.xMin=n,this.yMin=a,this.xMax=o,this.yMax=s,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),vce=function(){function e(t,r,n,a,o){var s,l;for(this.raw=t,this.xMin=r,this.yMin=n,this.xMax=a,this.yMax=o,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],s=this.raw;l=s.readShort(),this.glyphOffsets.push(s.pos),this.glyphIDs.push(s.readUInt16()),32&l;)s.pos+=1&l?4:2,128&l?s.pos+=8:64&l?s.pos+=4:8&l&&(s.pos+=2)}return e.prototype.encode=function(){var t,r,n;for(r=new rc(R6.call(this.raw.data)),t=0,n=this.glyphIDs.length;t<n;++t)r.pos=this.glyphOffsets[t];return r.data},e}(),yce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="loca",t.prototype.parse=function(r){var n,a;return r.pos=this.offset,n=this.file.head.indexToLocFormat,this.offsets=n===0?(function(){var o,s;for(s=[],a=0,o=this.length;a<o;a+=2)s.push(2*r.readUInt16());return s}).call(this):(function(){var o,s;for(s=[],a=0,o=this.length;a<o;a+=4)s.push(r.readUInt32());return s}).call(this)},t.prototype.indexOf=function(r){return this.offsets[r]},t.prototype.lengthOf=function(r){return this.offsets[r+1]-this.offsets[r]},t.prototype.encode=function(r,n){for(var a=new Uint32Array(this.offsets.length),o=0,s=0,l=0;l<a.length;++l)if(a[l]=o,s<n.length&&n[s]==l){++s,a[l]=o;var c=this.offsets[l],u=this.offsets[l+1]-c;u>0&&(o+=u)}for(var d=new Array(4*a.length),f=0;f<a.length;++f)d[4*f+3]=255&a[f],d[4*f+2]=(65280&a[f])>>8,d[4*f+1]=(16711680&a[f])>>16,d[4*f]=(4278190080&a[f])>>24;return d},t}(),xce=function(){function e(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var t,r,n,a,o;for(r in a=this.font.cmap.tables[0].codeMap,t={},o=this.subset)n=o[r],t[r]=a[n];return t},e.prototype.glyphsFor=function(t){var r,n,a,o,s,l,c;for(a={},s=0,l=t.length;s<l;s++)a[o=t[s]]=this.font.glyf.glyphFor(o);for(o in r=[],a)(n=a[o])!=null&&n.compound&&r.push.apply(r,n.glyphIDs);if(r.length>0)for(o in c=this.glyphsFor(r))n=c[o],a[o]=n;return a},e.prototype.encode=function(t,r){var n,a,o,s,l,c,u,d,f,h,p,v,m,y,b;for(a in n=L6.encode(this.generateCmap(),"unicode"),s=this.glyphsFor(t),p={0:0},b=n.charMap)p[(c=b[a]).old]=c.new;for(v in h=n.maxGlyphID,s)v in p||(p[v]=h++);return d=function(_){var w,A;for(w in A={},_)A[_[w]]=w;return A}(p),f=Object.keys(d).sort(function(_,w){return _-w}),m=function(){var _,w,A;for(A=[],_=0,w=f.length;_<w;_++)l=f[_],A.push(d[l]);return A}(),o=this.font.glyf.encode(s,m,p),u=this.font.loca.encode(o.offsets,m),y={cmap:this.font.cmap.raw(),glyf:o.table,loca:u,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(r)},this.font.os2.exists&&(y["OS/2"]=this.font.os2.raw()),this.font.directory.encode(y)},e}();br.API.PDFObject=function(){var e;function t(){}return e=function(r,n){return(Array(n+1).join("0")+r).slice(-n)},t.convert=function(r){var n,a,o,s;if(Array.isArray(r))return"["+function(){var l,c,u;for(u=[],l=0,c=r.length;l<c;l++)n=r[l],u.push(t.convert(n));return u}().join(" ")+"]";if(typeof r=="string")return"/"+r;if(r?.isString)return"("+r+")";if(r instanceof Date)return"(D:"+e(r.getUTCFullYear(),4)+e(r.getUTCMonth(),2)+e(r.getUTCDate(),2)+e(r.getUTCHours(),2)+e(r.getUTCMinutes(),2)+e(r.getUTCSeconds(),2)+"Z)";if({}.toString.call(r)==="[object Object]"){for(a in o=["<<"],r)s=r[a],o.push("/"+a+" "+t.convert(s));return o.push(">>"),o.join(`
`)}return""+r},t}();function q6(e,t,r,n,a){n=n||{};var o=1.15,s=a.internal.scaleFactor,l=a.internal.getFontSize()/s,c=a.getLineHeightFactor?a.getLineHeightFactor():o,u=l*c,d=/\r\n|\r|\n/g,f="",h=1;if((n.valign==="middle"||n.valign==="bottom"||n.halign==="center"||n.halign==="right")&&(f=typeof e=="string"?e.split(d):e,h=f.length||1),r+=l*(2-o),n.valign==="middle"?r-=h/2*u:n.valign==="bottom"&&(r-=h*u),n.halign==="center"||n.halign==="right"){var p=l;if(n.halign==="center"&&(p*=.5),f&&h>=1){for(var v=0;v<f.length;v++)a.text(f[v],t-a.getStringUnitWidth(f[v])*p,r),r+=u;return a}t-=a.getStringUnitWidth(e)*p}return n.halign==="justify"?a.text(e,t,r,{maxWidth:n.maxWidth||100,align:"justify"}):a.text(e,t,r),a}var nT={},Zu=function(){function e(t){this.jsPDFDocument=t,this.userStyles={textColor:t.getTextColor?this.jsPDFDocument.getTextColor():0,fontSize:t.internal.getFontSize(),fontStyle:t.internal.getFont().fontStyle,font:t.internal.getFont().fontName,lineWidth:t.getLineWidth?this.jsPDFDocument.getLineWidth():0,lineColor:t.getDrawColor?this.jsPDFDocument.getDrawColor():0}}return e.setDefaults=function(t,r){r===void 0&&(r=null),r?r.__autoTableDocumentDefaults=t:nT=t},e.unifyColor=function(t){return Array.isArray(t)?t:typeof t=="number"?[t,t,t]:typeof t=="string"?[t]:null},e.prototype.applyStyles=function(t,r){var n,a,o;r===void 0&&(r=!1),t.fontStyle&&this.jsPDFDocument.setFontStyle&&this.jsPDFDocument.setFontStyle(t.fontStyle);var s=this.jsPDFDocument.internal.getFont(),l=s.fontStyle,c=s.fontName;if(t.font&&(c=t.font),t.fontStyle){l=t.fontStyle;var u=this.getFontList()[c];u&&u.indexOf(l)===-1&&this.jsPDFDocument.setFontStyle&&(this.jsPDFDocument.setFontStyle(u[0]),l=u[0])}if(this.jsPDFDocument.setFont(c,l),t.fontSize&&this.jsPDFDocument.setFontSize(t.fontSize),!r){var d=e.unifyColor(t.fillColor);d&&(n=this.jsPDFDocument).setFillColor.apply(n,d),d=e.unifyColor(t.textColor),d&&(a=this.jsPDFDocument).setTextColor.apply(a,d),d=e.unifyColor(t.lineColor),d&&(o=this.jsPDFDocument).setDrawColor.apply(o,d),typeof t.lineWidth=="number"&&this.jsPDFDocument.setLineWidth(t.lineWidth)}},e.prototype.splitTextToSize=function(t,r,n){return this.jsPDFDocument.splitTextToSize(t,r,n)},e.prototype.rect=function(t,r,n,a,o){return this.jsPDFDocument.rect(t,r,n,a,o)},e.prototype.getLastAutoTable=function(){return this.jsPDFDocument.lastAutoTable||null},e.prototype.getTextWidth=function(t){return this.jsPDFDocument.getTextWidth(t)},e.prototype.getDocument=function(){return this.jsPDFDocument},e.prototype.setPage=function(t){this.jsPDFDocument.setPage(t)},e.prototype.addPage=function(){return this.jsPDFDocument.addPage()},e.prototype.getFontList=function(){return this.jsPDFDocument.getFontList()},e.prototype.getGlobalOptions=function(){return nT||{}},e.prototype.getDocumentOptions=function(){return this.jsPDFDocument.__autoTableDocumentDefaults||{}},e.prototype.pageSize=function(){var t=this.jsPDFDocument.internal.pageSize;return t.width==null&&(t={width:t.getWidth(),height:t.getHeight()}),t},e.prototype.scaleFactor=function(){return this.jsPDFDocument.internal.scaleFactor},e.prototype.getLineHeightFactor=function(){var t=this.jsPDFDocument;return t.getLineHeightFactor?t.getLineHeightFactor():1.15},e.prototype.getLineHeight=function(t){return t/this.scaleFactor()*this.getLineHeightFactor()},e.prototype.pageNumber=function(){var t=this.jsPDFDocument.internal.getCurrentPageInfo();return t?t.pageNumber:this.jsPDFDocument.internal.getNumberOfPages()},e}(),Mw=function(e,t){return Mw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},Mw(e,t)};function F6(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Mw(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var $6=function(e){F6(t,e);function t(r){var n=e.call(this)||this;return n._element=r,n}return t}(Array);function bce(e){return{font:"helvetica",fontStyle:"normal",overflow:"linebreak",fillColor:!1,textColor:20,halign:"left",valign:"top",fontSize:10,cellPadding:5/e,lineColor:200,lineWidth:0,cellWidth:"auto",minCellHeight:0,minCellWidth:0}}function _ce(e){var t={striped:{table:{fillColor:255,textColor:80,fontStyle:"normal"},head:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},body:{},foot:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},alternateRow:{fillColor:245}},grid:{table:{fillColor:255,textColor:80,fontStyle:"normal",lineWidth:.1},head:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},body:{},foot:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},alternateRow:{}},plain:{head:{fontStyle:"bold"},foot:{fontStyle:"bold"}}};return t[e]}function wv(e,t,r){r.applyStyles(t,!0);var n=Array.isArray(e)?e:[e],a=n.map(function(o){return r.getTextWidth(o)}).reduce(function(o,s){return Math.max(o,s)},0);return a}function B6(e,t,r,n){var a=t.settings.tableLineWidth,o=t.settings.tableLineColor;e.applyStyles({lineWidth:a,lineColor:o});var s=U6(a,!1);s&&e.rect(r.x,r.y,t.getWidth(e.pageSize().width),n.y-r.y,s)}function U6(e,t){var r=e>0,n=t||t===0;return r&&n?"DF":r?"S":n?"F":null}function Ly(e,t){var r,n,a,o;if(e=e||t,Array.isArray(e)){if(e.length>=4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(e.length===3)return{top:e[0],right:e[1],bottom:e[2],left:e[1]};if(e.length===2)return{top:e[0],right:e[1],bottom:e[0],left:e[1]};e.length===1?e=e[0]:e=t}return typeof e=="object"?(typeof e.vertical=="number"&&(e.top=e.vertical,e.bottom=e.vertical),typeof e.horizontal=="number"&&(e.right=e.horizontal,e.left=e.horizontal),{left:(r=e.left)!==null&&r!==void 0?r:t,top:(n=e.top)!==null&&n!==void 0?n:t,right:(a=e.right)!==null&&a!==void 0?a:t,bottom:(o=e.bottom)!==null&&o!==void 0?o:t}):(typeof e!="number"&&(e=t),{top:e,right:e,bottom:e,left:e})}function z6(e,t){var r=Ly(t.settings.margin,0);return e.pageSize().width-(r.left+r.right)}function wce(e,t,r,n,a){var o={},s=1.3333333333333333,l=O2(t,function(w){return a.getComputedStyle(w).backgroundColor});l!=null&&(o.fillColor=l);var c=O2(t,function(w){return a.getComputedStyle(w).color});c!=null&&(o.textColor=c);var u=Sce(n,r);u&&(o.cellPadding=u);var d="borderTopColor",f=s*r,h=n.borderTopWidth;if(n.borderBottomWidth===h&&n.borderRightWidth===h&&n.borderLeftWidth===h){var p=(parseFloat(h)||0)/f;p&&(o.lineWidth=p)}else o.lineWidth={top:(parseFloat(n.borderTopWidth)||0)/f,right:(parseFloat(n.borderRightWidth)||0)/f,bottom:(parseFloat(n.borderBottomWidth)||0)/f,left:(parseFloat(n.borderLeftWidth)||0)/f},o.lineWidth.top||(o.lineWidth.right?d="borderRightColor":o.lineWidth.bottom?d="borderBottomColor":o.lineWidth.left&&(d="borderLeftColor"));var v=O2(t,function(w){return a.getComputedStyle(w)[d]});v!=null&&(o.lineColor=v);var m=["left","right","center","justify"];m.indexOf(n.textAlign)!==-1&&(o.halign=n.textAlign),m=["middle","bottom","top"],m.indexOf(n.verticalAlign)!==-1&&(o.valign=n.verticalAlign);var y=parseInt(n.fontSize||"");isNaN(y)||(o.fontSize=y/s);var b=jce(n);b&&(o.fontStyle=b);var _=(n.fontFamily||"").toLowerCase();return e.indexOf(_)!==-1&&(o.font=_),o}function jce(e){var t="";return(e.fontWeight==="bold"||e.fontWeight==="bolder"||parseInt(e.fontWeight)>=700)&&(t="bold"),(e.fontStyle==="italic"||e.fontStyle==="oblique")&&(t+="italic"),t}function O2(e,t){var r=W6(e,t);if(!r)return null;var n=r.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*\.?\d*))?\)$/);if(!n||!Array.isArray(n))return null;var a=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])],o=parseInt(n[4]);return o===0||isNaN(a[0])||isNaN(a[1])||isNaN(a[2])?null:a}function W6(e,t){var r=t(e);return r==="rgba(0, 0, 0, 0)"||r==="transparent"||r==="initial"||r==="inherit"?e.parentElement==null?null:W6(e.parentElement,t):r}function Sce(e,t){var r=[e.paddingTop,e.paddingRight,e.paddingBottom,e.paddingLeft],n=96/(72/t),a=(parseInt(e.lineHeight)-parseInt(e.fontSize))/t/2,o=r.map(function(l){return parseInt(l||"0")/n}),s=Ly(o,0);return a>s.top&&(s.top=a),a>s.bottom&&(s.bottom=a),s}function H6(e,t,r,n,a){var o,s;n===void 0&&(n=!1),a===void 0&&(a=!1);var l;typeof t=="string"?l=r.document.querySelector(t):l=t;var c=Object.keys(e.getFontList()),u=e.scaleFactor(),d=[],f=[],h=[];if(!l)return console.error("Html table could not be found with input: ",t),{head:d,body:f,foot:h};for(var p=0;p<l.rows.length;p++){var v=l.rows[p],m=(s=(o=v?.parentElement)===null||o===void 0?void 0:o.tagName)===null||s===void 0?void 0:s.toLowerCase(),y=Cce(c,u,r,v,n,a);y&&(m==="thead"?d.push(y):m==="tfoot"?h.push(y):f.push(y))}return{head:d,body:f,foot:h}}function Cce(e,t,r,n,a,o){for(var s=new $6(n),l=0;l<n.cells.length;l++){var c=n.cells[l],u=r.getComputedStyle(c);if(a||u.display!=="none"){var d=void 0;o&&(d=wce(e,c,t,u,r)),s.push({rowSpan:c.rowSpan,colSpan:c.colSpan,styles:d,_element:c,content:Ace(c)})}}var f=r.getComputedStyle(n);if(s.length>0&&(a||f.display!=="none"))return s}function Ace(e){var t=e.cloneNode(!0);return t.innerHTML=t.innerHTML.replace(/\n/g,"").replace(/ +/g," "),t.innerHTML=t.innerHTML.split(/<br.*?>/).map(function(r){return r.trim()}).join(`
`),t.innerText||t.textContent||""}function Pce(e,t,r){for(var n=0,a=[e,t,r];n<a.length;n++){var o=a[n];o&&typeof o!="object"&&console.error("The options parameter should be of type object, is: "+typeof o),o.startY&&typeof o.startY!="number"&&(console.error("Invalid value for startY option",o.startY),delete o.startY)}}function ll(e,t,r,n,a){if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(e),s=1;s<arguments.length;s++){var l=arguments[s];if(l!=null)for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(o[c]=l[c])}return o}function V6(e,t){var r=new Zu(e),n=r.getDocumentOptions(),a=r.getGlobalOptions();Pce(a,n,t);var o=ll({},a,n,t),s;typeof window<"u"&&(s=window);var l=Oce(a,n,t),c=kce(a,n,t),u=Ece(r,o),d=Ice(r,o,s);return{id:t.tableId,content:d,hooks:c,styles:l,settings:u}}function Oce(e,t,r){for(var n={styles:{},headStyles:{},bodyStyles:{},footStyles:{},alternateRowStyles:{},columnStyles:{}},a=function(c){if(c==="columnStyles"){var u=e[c],d=t[c],f=r[c];n.columnStyles=ll({},u,d,f)}else{var h=[e,t,r],p=h.map(function(v){return v[c]||{}});n[c]=ll({},p[0],p[1],p[2])}},o=0,s=Object.keys(n);o<s.length;o++){var l=s[o];a(l)}return n}function kce(e,t,r){for(var n=[e,t,r],a={didParseCell:[],willDrawCell:[],didDrawCell:[],willDrawPage:[],didDrawPage:[]},o=0,s=n;o<s.length;o++){var l=s[o];l.didParseCell&&a.didParseCell.push(l.didParseCell),l.willDrawCell&&a.willDrawCell.push(l.willDrawCell),l.didDrawCell&&a.didDrawCell.push(l.didDrawCell),l.willDrawPage&&a.willDrawPage.push(l.willDrawPage),l.didDrawPage&&a.didDrawPage.push(l.didDrawPage)}return a}function Ece(e,t){var r,n,a,o,s,l,c,u,d,f,h,p,v=Ly(t.margin,40/e.scaleFactor()),m=(r=Tce(e,t.startY))!==null&&r!==void 0?r:v.top,y;t.showFoot===!0?y="everyPage":t.showFoot===!1?y="never":y=(n=t.showFoot)!==null&&n!==void 0?n:"everyPage";var b;t.showHead===!0?b="everyPage":t.showHead===!1?b="never":b=(a=t.showHead)!==null&&a!==void 0?a:"everyPage";var _=(o=t.useCss)!==null&&o!==void 0?o:!1,w=t.theme||(_?"plain":"striped"),A=!!t.horizontalPageBreak,P=(s=t.horizontalPageBreakRepeat)!==null&&s!==void 0?s:null;return{includeHiddenHtml:(l=t.includeHiddenHtml)!==null&&l!==void 0?l:!1,useCss:_,theme:w,startY:m,margin:v,pageBreak:(c=t.pageBreak)!==null&&c!==void 0?c:"auto",rowPageBreak:(u=t.rowPageBreak)!==null&&u!==void 0?u:"auto",tableWidth:(d=t.tableWidth)!==null&&d!==void 0?d:"auto",showHead:b,showFoot:y,tableLineWidth:(f=t.tableLineWidth)!==null&&f!==void 0?f:0,tableLineColor:(h=t.tableLineColor)!==null&&h!==void 0?h:200,horizontalPageBreak:A,horizontalPageBreakRepeat:P,horizontalPageBreakBehaviour:(p=t.horizontalPageBreakBehaviour)!==null&&p!==void 0?p:"afterAllRows"}}function Tce(e,t){var r=e.getLastAutoTable(),n=e.scaleFactor(),a=e.pageNumber(),o=!1;if(r&&r.startPageNumber){var s=r.startPageNumber+r.pageNumber-1;o=s===a}return typeof t=="number"?t:(t==null||t===!1)&&o&&r?.finalY!=null?r.finalY+20/n:null}function Ice(e,t,r){var n=t.head||[],a=t.body||[],o=t.foot||[];if(t.html){var s=t.includeHiddenHtml;if(r){var l=H6(e,t.html,r,s,t.useCss)||{};n=l.head||n,a=l.body||n,o=l.foot||n}else console.error("Cannot parse html in non browser environment")}var c=t.columns||Nce(n,a,o);return{columns:c,head:n,body:a,foot:o}}function Nce(e,t,r){var n=e[0]||t[0]||r[0]||[],a=[];return Object.keys(n).filter(function(o){return o!=="_element"}).forEach(function(o){var s=1,l;Array.isArray(n)?l=n[parseInt(o)]:l=n[o],typeof l=="object"&&!Array.isArray(l)&&(s=l?.colSpan||1);for(var c=0;c<s;c++){var u=void 0;Array.isArray(n)?u=a.length:u=o+(c>0?"_".concat(c):"");var d={dataKey:u};a.push(d)}}),a}var Lw=function(){function e(t,r,n){this.table=r,this.pageNumber=r.pageNumber,this.settings=r.settings,this.cursor=n,this.doc=t.getDocument()}return e}(),Dce=function(e){F6(t,e);function t(r,n,a,o,s,l){var c=e.call(this,r,n,l)||this;return c.cell=a,c.row=o,c.column=s,c.section=o.section,c}return t}(Lw),Mce=function(){function e(t,r){this.pageNumber=1,this.id=t.id,this.settings=t.settings,this.styles=t.styles,this.hooks=t.hooks,this.columns=r.columns,this.head=r.head,this.body=r.body,this.foot=r.foot}return e.prototype.getHeadHeight=function(t){return this.head.reduce(function(r,n){return r+n.getMaxCellHeight(t)},0)},e.prototype.getFootHeight=function(t){return this.foot.reduce(function(r,n){return r+n.getMaxCellHeight(t)},0)},e.prototype.allRows=function(){return this.head.concat(this.body).concat(this.foot)},e.prototype.callCellHooks=function(t,r,n,a,o,s){for(var l=0,c=r;l<c.length;l++){var u=c[l],d=new Dce(t,this,n,a,o,s),f=u(d)===!1;if(n.text=Array.isArray(n.text)?n.text:[n.text],f)return!1}return!0},e.prototype.callEndPageHooks=function(t,r){t.applyStyles(t.userStyles);for(var n=0,a=this.hooks.didDrawPage;n<a.length;n++){var o=a[n];o(new Lw(t,this,r))}},e.prototype.callWillDrawPageHooks=function(t,r){for(var n=0,a=this.hooks.willDrawPage;n<a.length;n++){var o=a[n];o(new Lw(t,this,r))}},e.prototype.getWidth=function(t){if(typeof this.settings.tableWidth=="number")return this.settings.tableWidth;if(this.settings.tableWidth==="wrap"){var r=this.columns.reduce(function(a,o){return a+o.wrappedWidth},0);return r}else{var n=this.settings.margin;return t-n.left-n.right}},e}(),G6=function(){function e(t,r,n,a,o){o===void 0&&(o=!1),this.height=0,this.raw=t,t instanceof $6&&(this.raw=t._element,this.element=t._element),this.index=r,this.section=n,this.cells=a,this.spansMultiplePages=o}return e.prototype.getMaxCellHeight=function(t){var r=this;return t.reduce(function(n,a){var o;return Math.max(n,((o=r.cells[a.index])===null||o===void 0?void 0:o.height)||0)},0)},e.prototype.hasRowSpan=function(t){var r=this;return t.filter(function(n){var a=r.cells[n.index];return a?a.rowSpan>1:!1}).length>0},e.prototype.canEntireRowFit=function(t,r){return this.getMaxCellHeight(r)<=t},e.prototype.getMinimumRowHeight=function(t,r){var n=this;return t.reduce(function(a,o){var s=n.cells[o.index];if(!s)return 0;var l=r.getLineHeight(s.styles.fontSize),c=s.padding("vertical"),u=c+l;return u>a?u:a},0)},e}(),Y6=function(){function e(t,r,n){var a;this.contentHeight=0,this.contentWidth=0,this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.height=0,this.x=0,this.y=0,this.styles=r,this.section=n,this.raw=t;var o=t;t!=null&&typeof t=="object"&&!Array.isArray(t)?(this.rowSpan=t.rowSpan||1,this.colSpan=t.colSpan||1,o=(a=t.content)!==null&&a!==void 0?a:t,t._element&&(this.raw=t._element)):(this.rowSpan=1,this.colSpan=1);var s=o!=null?""+o:"",l=/\r\n|\r|\n/g;this.text=s.split(l)}return e.prototype.getTextPos=function(){var t;if(this.styles.valign==="top")t=this.y+this.padding("top");else if(this.styles.valign==="bottom")t=this.y+this.height-this.padding("bottom");else{var r=this.height-this.padding("vertical");t=this.y+r/2+this.padding("top")}var n;if(this.styles.halign==="right")n=this.x+this.width-this.padding("right");else if(this.styles.halign==="center"){var a=this.width-this.padding("horizontal");n=this.x+a/2+this.padding("left")}else n=this.x+this.padding("left");return{x:n,y:t}},e.prototype.getContentHeight=function(t,r){r===void 0&&(r=1.15);var n=Array.isArray(this.text)?this.text.length:1,a=this.styles.fontSize/t*r,o=n*a+this.padding("vertical");return Math.max(o,this.styles.minCellHeight)},e.prototype.padding=function(t){var r=Ly(this.styles.cellPadding,0);return t==="vertical"?r.top+r.bottom:t==="horizontal"?r.left+r.right:r[t]},e}(),Lce=function(){function e(t,r,n){this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.dataKey=t,this.raw=r,this.index=n}return e.prototype.getMaxCustomCellWidth=function(t){for(var r=0,n=0,a=t.allRows();n<a.length;n++){var o=a[n],s=o.cells[this.index];s&&typeof s.styles.cellWidth=="number"&&(r=Math.max(r,s.styles.cellWidth))}return r},e}();function Rce(e,t){qce(e,t);var r=[],n=0;t.columns.forEach(function(o){var s=o.getMaxCustomCellWidth(t);s?o.width=s:(o.width=o.wrappedWidth,r.push(o)),n+=o.width});var a=t.getWidth(e.pageSize().width)-n;a&&(a=Rw(r,a,function(o){return Math.max(o.minReadableWidth,o.minWidth)})),a&&(a=Rw(r,a,function(o){return o.minWidth})),a=Math.abs(a),!t.settings.horizontalPageBreak&&a>.1/e.scaleFactor()&&(a=a<1?a:Math.round(a),console.warn("Of the table content, ".concat(a," units width could not fit page"))),$ce(t),Bce(t,e),Fce(t)}function qce(e,t){var r=e.scaleFactor(),n=t.settings.horizontalPageBreak,a=z6(e,t);t.allRows().forEach(function(o){for(var s=0,l=t.columns;s<l.length;s++){var c=l[s],u=o.cells[c.index];if(u){var d=t.hooks.didParseCell;t.callCellHooks(e,d,u,o,c,null);var f=u.padding("horizontal");u.contentWidth=wv(u.text,u.styles,e)+f;var h=wv(u.text.join(" ").split(/[^\S\u00A0]+/),u.styles,e);if(u.minReadableWidth=h+u.padding("horizontal"),typeof u.styles.cellWidth=="number")u.minWidth=u.styles.cellWidth,u.wrappedWidth=u.styles.cellWidth;else if(u.styles.cellWidth==="wrap"||n===!0)u.contentWidth>a?(u.minWidth=a,u.wrappedWidth=a):(u.minWidth=u.contentWidth,u.wrappedWidth=u.contentWidth);else{var p=10/r;u.minWidth=u.styles.minCellWidth||p,u.wrappedWidth=u.contentWidth,u.minWidth>u.wrappedWidth&&(u.wrappedWidth=u.minWidth)}}}}),t.allRows().forEach(function(o){for(var s=0,l=t.columns;s<l.length;s++){var c=l[s],u=o.cells[c.index];if(u&&u.colSpan===1)c.wrappedWidth=Math.max(c.wrappedWidth,u.wrappedWidth),c.minWidth=Math.max(c.minWidth,u.minWidth),c.minReadableWidth=Math.max(c.minReadableWidth,u.minReadableWidth);else{var d=t.styles.columnStyles[c.dataKey]||t.styles.columnStyles[c.index]||{},f=d.cellWidth||d.minCellWidth;f&&typeof f=="number"&&(c.minWidth=f,c.wrappedWidth=f)}u&&(u.colSpan>1&&!c.minWidth&&(c.minWidth=u.minWidth),u.colSpan>1&&!c.wrappedWidth&&(c.wrappedWidth=u.minWidth))}})}function Rw(e,t,r){for(var n=t,a=e.reduce(function(p,v){return p+v.wrappedWidth},0),o=0;o<e.length;o++){var s=e[o],l=s.wrappedWidth/a,c=n*l,u=s.width+c,d=r(s),f=u<d?d:u;t-=f-s.width,s.width=f}if(t=Math.round(t*1e10)/1e10,t){var h=e.filter(function(p){return t<0?p.width>r(p):!0});h.length&&(t=Rw(h,t,r))}return t}function Fce(e){for(var t={},r=1,n=e.allRows(),a=0;a<n.length;a++)for(var o=n[a],s=0,l=e.columns;s<l.length;s++){var c=l[s],u=t[c.index];if(r>1)r--,delete o.cells[c.index];else if(u)u.cell.height+=o.height,r=u.cell.colSpan,delete o.cells[c.index],u.left--,u.left<=1&&delete t[c.index];else{var d=o.cells[c.index];if(!d)continue;if(d.height=o.height,d.rowSpan>1){var f=n.length-a,h=d.rowSpan>f?f:d.rowSpan;t[c.index]={cell:d,left:h,row:o}}}}}function $ce(e){for(var t=e.allRows(),r=0;r<t.length;r++)for(var n=t[r],a=null,o=0,s=0,l=0;l<e.columns.length;l++){var c=e.columns[l];if(s-=1,s>1&&e.columns[l+1])o+=c.width,delete n.cells[c.index];else if(a){var u=a;delete n.cells[c.index],a=null,u.width=c.width+o}else{var u=n.cells[c.index];if(!u)continue;if(s=u.colSpan,o=0,u.colSpan>1){a=u,o+=c.width;continue}u.width=c.width+o}}}function Bce(e,t){for(var r={count:0,height:0},n=0,a=e.allRows();n<a.length;n++){for(var o=a[n],s=0,l=e.columns;s<l.length;s++){var c=l[s],u=o.cells[c.index];if(u){t.applyStyles(u.styles,!0);var d=u.width-u.padding("horizontal");if(u.styles.overflow==="linebreak")u.text=t.splitTextToSize(u.text,d+1/t.scaleFactor(),{fontSize:u.styles.fontSize});else if(u.styles.overflow==="ellipsize")u.text=aT(u.text,d,u.styles,t,"...");else if(u.styles.overflow==="hidden")u.text=aT(u.text,d,u.styles,t,"");else if(typeof u.styles.overflow=="function"){var f=u.styles.overflow(u.text,d);typeof f=="string"?u.text=[f]:u.text=f}u.contentHeight=u.getContentHeight(t.scaleFactor(),t.getLineHeightFactor());var h=u.contentHeight/u.rowSpan;u.rowSpan>1&&r.count*r.height<h*u.rowSpan?r={height:h,count:u.rowSpan}:r&&r.count>0&&r.height>h&&(h=r.height),h>o.height&&(o.height=h)}}r.count--}}function aT(e,t,r,n,a){return e.map(function(o){return Uce(o,t,r,n,a)})}function Uce(e,t,r,n,a){var o=1e4*n.scaleFactor();if(t=Math.ceil(t*o)/o,t>=wv(e,r,n))return e;for(;t<wv(e+a,r,n)&&!(e.length<=1);)e=e.substring(0,e.length-1);return e.trim()+a}function K6(e,t){var r=new Zu(e),n=zce(t,r.scaleFactor()),a=new Mce(t,n);return Rce(r,a),r.applyStyles(r.userStyles),a}function zce(e,t){var r=e.content,n=Hce(r.columns);if(r.head.length===0){var a=iT(n,"head");a&&r.head.push(a)}if(r.foot.length===0){var a=iT(n,"foot");a&&r.foot.push(a)}var o=e.settings.theme,s=e.styles;return{columns:n,head:k2("head",r.head,n,s,o,t),body:k2("body",r.body,n,s,o,t),foot:k2("foot",r.foot,n,s,o,t)}}function k2(e,t,r,n,a,o){var s={},l=t.map(function(c,u){for(var d=0,f={},h=0,p=0,v=0,m=r;v<m.length;v++){var y=m[v];if(s[y.index]==null||s[y.index].left===0)if(p===0){var b=void 0;Array.isArray(c)?b=c[y.index-h-d]:b=c[y.dataKey];var _={};typeof b=="object"&&!Array.isArray(b)&&(_=b?.styles||{});var w=Vce(e,y,u,a,n,o,_),A=new Y6(b,w,e);f[y.dataKey]=A,f[y.index]=A,p=A.colSpan-1,s[y.index]={left:A.rowSpan-1,times:p}}else p--,h++;else s[y.index].left--,p=s[y.index].times,d++}return new G6(c,u,e,f)});return l}function iT(e,t){var r={};return e.forEach(function(n){if(n.raw!=null){var a=Wce(t,n.raw);a!=null&&(r[n.dataKey]=a)}}),Object.keys(r).length>0?r:null}function Wce(e,t){if(e==="head"){if(typeof t=="object")return t.header||null;if(typeof t=="string"||typeof t=="number")return t}else if(e==="foot"&&typeof t=="object")return t.footer;return null}function Hce(e){return e.map(function(t,r){var n,a;return typeof t=="object"?a=(n=t.dataKey)!==null&&n!==void 0?n:r:a=r,new Lce(a,t,r)})}function Vce(e,t,r,n,a,o,s){var l=_ce(n),c;e==="head"?c=a.headStyles:e==="body"?c=a.bodyStyles:e==="foot"&&(c=a.footStyles);var u=ll({},l.table,l[e],a.styles,c),d=a.columnStyles[t.dataKey]||a.columnStyles[t.index]||{},f=e==="body"?d:{},h=e==="body"&&r%2===0?ll({},l.alternateRow,a.alternateRowStyles):{},p=bce(o),v=ll({},p,u,h,f);return ll(v,s)}function Gce(e,t,r){var n;r===void 0&&(r={});var a=z6(e,t),o=new Map,s=[],l=[],c=[];Array.isArray(t.settings.horizontalPageBreakRepeat)?c=t.settings.horizontalPageBreakRepeat:(typeof t.settings.horizontalPageBreakRepeat=="string"||typeof t.settings.horizontalPageBreakRepeat=="number")&&(c=[t.settings.horizontalPageBreakRepeat]),c.forEach(function(h){var p=t.columns.find(function(v){return v.dataKey===h||v.index===h});p&&!o.has(p.index)&&(o.set(p.index,!0),s.push(p.index),l.push(t.columns[p.index]),a-=p.wrappedWidth)});for(var u=!0,d=(n=r?.start)!==null&&n!==void 0?n:0;d<t.columns.length;){if(o.has(d)){d++;continue}var f=t.columns[d].wrappedWidth;if(u||a>=f)u=!1,s.push(d),l.push(t.columns[d]),a-=f;else break;d++}return{colIndexes:s,columns:l,lastIndex:d-1}}function Yce(e,t){for(var r=[],n=0;n<t.columns.length;n++){var a=Gce(e,t,{start:n});a.columns.length&&(r.push(a),n=a.lastIndex)}return r}function Q6(e,t){var r=t.settings,n=r.startY,a=r.margin,o={x:a.left,y:n},s=t.getHeadHeight(t.columns)+t.getFootHeight(t.columns),l=n+a.bottom+s;if(r.pageBreak==="avoid"){var c=t.body,u=c.reduce(function(h,p){return h+p.height},0);l+=u}var d=new Zu(e);(r.pageBreak==="always"||r.startY!=null&&l>d.pageSize().height)&&(J6(d),o.y=a.top),t.callWillDrawPageHooks(d,o);var f=ll({},o);t.startPageNumber=d.pageNumber(),r.horizontalPageBreak?Kce(d,t,f,o):(d.applyStyles(d.userStyles),(r.showHead==="firstPage"||r.showHead==="everyPage")&&t.head.forEach(function(h){return yl(d,t,h,o,t.columns)}),d.applyStyles(d.userStyles),t.body.forEach(function(h,p){var v=p===t.body.length-1;jv(d,t,h,v,f,o,t.columns)}),d.applyStyles(d.userStyles),(r.showFoot==="lastPage"||r.showFoot==="everyPage")&&t.foot.forEach(function(h){return yl(d,t,h,o,t.columns)})),B6(d,t,f,o),t.callEndPageHooks(d,o),t.finalY=o.y,e.lastAutoTable=t,d.applyStyles(d.userStyles)}function Kce(e,t,r,n){var a=Yce(e,t),o=t.settings;if(o.horizontalPageBreakBehaviour==="afterAllRows")a.forEach(function(u,d){e.applyStyles(e.userStyles),d>0?qh(e,t,r,n,u.columns,!0):oT(e,t,n,u.columns),Qce(e,t,r,n,u.columns),E2(e,t,n,u.columns)});else for(var s=-1,l=a[0],c=function(){var u=s;if(l){e.applyStyles(e.userStyles);var d=l.columns;s>=0?qh(e,t,r,n,d,!0):oT(e,t,n,d),u=sT(e,t,s+1,n,d),E2(e,t,n,d)}var f=u-s;a.slice(1).forEach(function(h){e.applyStyles(e.userStyles),qh(e,t,r,n,h.columns,!0),sT(e,t,s+1,n,h.columns,f),E2(e,t,n,h.columns)}),s=u};s<t.body.length-1;)c()}function oT(e,t,r,n){var a=t.settings;e.applyStyles(e.userStyles),(a.showHead==="firstPage"||a.showHead==="everyPage")&&t.head.forEach(function(o){return yl(e,t,o,r,n)})}function Qce(e,t,r,n,a){e.applyStyles(e.userStyles),t.body.forEach(function(o,s){var l=s===t.body.length-1;jv(e,t,o,l,r,n,a)})}function sT(e,t,r,n,a,o){e.applyStyles(e.userStyles),o=o??t.body.length;var s=Math.min(r+o,t.body.length),l=-1;return t.body.slice(r,s).forEach(function(c,u){var d=r+u===t.body.length-1,f=X6(e,t,d,n);c.canEntireRowFit(f,a)&&(yl(e,t,c,n,a),l=r+u)}),l}function E2(e,t,r,n){var a=t.settings;e.applyStyles(e.userStyles),(a.showFoot==="lastPage"||a.showFoot==="everyPage")&&t.foot.forEach(function(o){return yl(e,t,o,r,n)})}function Xce(e,t,r){var n=r.getLineHeight(e.styles.fontSize),a=e.padding("vertical"),o=Math.floor((t-a)/n);return Math.max(0,o)}function Jce(e,t,r,n){var a={};e.spansMultiplePages=!0,e.height=0;for(var o=0,s=0,l=r.columns;s<l.length;s++){var c=l[s],u=e.cells[c.index];if(u){Array.isArray(u.text)||(u.text=[u.text]);var d=new Y6(u.raw,u.styles,u.section);d=ll(d,u),d.text=[];var f=Xce(u,t,n);u.text.length>f&&(d.text=u.text.splice(f,u.text.length));var h=n.scaleFactor(),p=n.getLineHeightFactor();u.contentHeight=u.getContentHeight(h,p),u.contentHeight>=t&&(u.contentHeight=t,d.styles.minCellHeight-=t),u.contentHeight>e.height&&(e.height=u.contentHeight),d.contentHeight=d.getContentHeight(h,p),d.contentHeight>o&&(o=d.contentHeight),a[c.index]=d}}var v=new G6(e.raw,-1,e.section,a,!0);v.height=o;for(var m=0,y=r.columns;m<y.length;m++){var c=y[m],d=v.cells[c.index];d&&(d.height=v.height);var u=e.cells[c.index];u&&(u.height=e.height)}return v}function Zce(e,t,r,n){var a=e.pageSize().height,o=n.settings.margin,s=o.top+o.bottom,l=a-s;t.section==="body"&&(l-=n.getHeadHeight(n.columns)+n.getFootHeight(n.columns));var c=t.getMinimumRowHeight(n.columns,e),u=c<r;if(c>l)return console.error("Will not be able to print row ".concat(t.index," correctly since it's minimum height is larger than page height")),!0;if(!u)return!1;var d=t.hasRowSpan(n.columns),f=t.getMaxCellHeight(n.columns)>l;return f?(d&&console.error("The content of row ".concat(t.index," will not be drawn correctly since drawing rows with a height larger than the page height and has cells with rowspans is not supported.")),!0):!(d||n.settings.rowPageBreak==="avoid")}function jv(e,t,r,n,a,o,s){var l=X6(e,t,n,o);if(r.canEntireRowFit(l,s))yl(e,t,r,o,s);else if(Zce(e,r,l,t)){var c=Jce(r,l,t,e);yl(e,t,r,o,s),qh(e,t,a,o,s),jv(e,t,c,n,a,o,s)}else qh(e,t,a,o,s),jv(e,t,r,n,a,o,s)}function yl(e,t,r,n,a){n.x=t.settings.margin.left;for(var o=0,s=a;o<s.length;o++){var l=s[o],c=r.cells[l.index];if(!c){n.x+=l.width;continue}e.applyStyles(c.styles),c.x=n.x,c.y=n.y;var u=t.callCellHooks(e,t.hooks.willDrawCell,c,r,l,n);if(u===!1){n.x+=l.width;continue}eue(e,c,n);var d=c.getTextPos();q6(c.text,d.x,d.y,{halign:c.styles.halign,valign:c.styles.valign,maxWidth:Math.ceil(c.width-c.padding("left")-c.padding("right"))},e.getDocument()),t.callCellHooks(e,t.hooks.didDrawCell,c,r,l,n),n.x+=l.width}n.y+=r.height}function eue(e,t,r){var n=t.styles;if(e.getDocument().setFillColor(e.getDocument().getFillColor()),typeof n.lineWidth=="number"){var a=U6(n.lineWidth,n.fillColor);a&&e.rect(t.x,r.y,t.width,t.height,a)}else typeof n.lineWidth=="object"&&(n.fillColor&&e.rect(t.x,r.y,t.width,t.height,"F"),tue(e,t,r,n.lineWidth))}function tue(e,t,r,n){var a,o,s,l;n.top&&(a=r.x,o=r.y,s=r.x+t.width,l=r.y,n.right&&(s+=.5*n.right),n.left&&(a-=.5*n.left),c(n.top,a,o,s,l)),n.bottom&&(a=r.x,o=r.y+t.height,s=r.x+t.width,l=r.y+t.height,n.right&&(s+=.5*n.right),n.left&&(a-=.5*n.left),c(n.bottom,a,o,s,l)),n.left&&(a=r.x,o=r.y,s=r.x,l=r.y+t.height,n.top&&(o-=.5*n.top),n.bottom&&(l+=.5*n.bottom),c(n.left,a,o,s,l)),n.right&&(a=r.x+t.width,o=r.y,s=r.x+t.width,l=r.y+t.height,n.top&&(o-=.5*n.top),n.bottom&&(l+=.5*n.bottom),c(n.right,a,o,s,l));function c(u,d,f,h,p){e.getDocument().setLineWidth(u),e.getDocument().line(d,f,h,p,"S")}}function X6(e,t,r,n){var a=t.settings.margin.bottom,o=t.settings.showFoot;return(o==="everyPage"||o==="lastPage"&&r)&&(a+=t.getFootHeight(t.columns)),e.pageSize().height-n.y-a}function qh(e,t,r,n,a,o){a===void 0&&(a=[]),o===void 0&&(o=!1),e.applyStyles(e.userStyles),t.settings.showFoot==="everyPage"&&!o&&t.foot.forEach(function(l){return yl(e,t,l,n,a)}),t.callEndPageHooks(e,n);var s=t.settings.margin;B6(e,t,r,n),J6(e),t.pageNumber++,n.x=s.left,n.y=s.top,r.y=s.top,t.callWillDrawPageHooks(e,n),t.settings.showHead==="everyPage"&&(t.head.forEach(function(l){return yl(e,t,l,n,a)}),e.applyStyles(e.userStyles))}function J6(e){var t=e.pageNumber();e.setPage(t+1);var r=e.pageNumber();return r===t?(e.addPage(),!0):!1}function rue(e){e.API.autoTable=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t[0],a=V6(this,n),o=K6(this,a);return Q6(this,o),this},e.API.lastAutoTable=!1,e.API.autoTableText=function(t,r,n,a){q6(t,r,n,a,this)},e.API.autoTableSetDefaults=function(t){return Zu.setDefaults(t,this),this},e.autoTableSetDefaults=function(t,r){Zu.setDefaults(t,r)},e.API.autoTableHtmlToJson=function(t,r){var n;if(r===void 0&&(r=!1),typeof window>"u")return console.error("Cannot run autoTableHtmlToJson in non browser environment"),null;var a=new Zu(this),o=H6(a,t,window,r,!1),s=o.head,l=o.body,c=((n=s[0])===null||n===void 0?void 0:n.map(function(u){return u.content}))||[];return{columns:c,rows:l,data:l}}}var T2;function nue(e,t){var r=V6(e,t),n=K6(e,r);Q6(e,n)}try{if(typeof window<"u"&&window){var lT=window,cT=lT.jsPDF||((T2=lT.jspdf)===null||T2===void 0?void 0:T2.jsPDF);cT&&rue(cT)}}catch(e){console.error("Could not apply autoTable plugin",e)}const Z6=({open:e,onClose:t,type:r,recordId:n,defaultTo:a,defaultSubject:o,defaultMessage:s,allowMessageEdit:l=!0})=>{const{user:c}=Jn(),[u,d]=x.useState(a||""),[f,h]=x.useState(o||""),[p,v]=x.useState(s||""),[m,y]=x.useState(""),[b,_]=x.useState(!1),[w,A]=x.useState(""),[P,E]=x.useState([]),[T,S]=x.useState("");x.useEffect(()=>{console.log("EmailModal useEffect: open =",e,"defaultTo =",a,"current to =",u),e&&a&&(console.log("Setting to field to:",a),d(a))},[e,a]),x.useEffect(()=>{e&&I()},[e,r]);const I=async()=>{try{const q=await ve.get("/api/email/templates");if(q.data.success){const z=q.data.templates.filter(J=>J.type===r);E(z);const K=z.find(J=>J.is_default);K?(S(K.id),h(K.subject),v(K.html_content)):z.length===0&&(r==="quote"?(h("Quote Information"),v("Please find attached the quote details.")):r==="purchase-order"?(h("Purchase Order Information"),v("Please find attached the purchase order details.")):r==="sales-order"&&(h("Sales Order Information"),v("Please find attached the sales order details.")))}}catch(q){console.error("Error loading templates:",q),r==="quote"?(h("Quote Information"),v("Please find attached the quote details.")):r==="purchase-order"?(h("Purchase Order Information"),v("Please find attached the purchase order details.")):r==="sales-order"&&(h("Sales Order Information"),v("Please find attached the sales order details."))}},U=q=>{if(S(q),q!==""){const z=P.find(K=>K.id===q);z&&(h(z.subject),v(z.html_content))}},O=async()=>{if(r==="custom"){if(!u||!f||!p){A("Please fill in all required fields");return}}else if(!u){A("Please enter a recipient email address");return}_(!0),A("");try{let q="/api/email/send",z={to:u,subject:f,message:p};r!=="custom"&&n&&(q=`/api/email/${r.replace("-","-")}/${n}`,z={to:u,...m&&{customMessage:m}});const K=await ve.post(q,z);K.data.success?(me.success("Email sent successfully!"),t(),d(""),h(""),v(""),y(""),S("")):A(K.data.message||"Failed to send email")}catch(q){console.error("Error sending email:",q),A(q.response?.data?.message||"Failed to send email")}finally{_(!1)}},M=()=>{b||(t(),A(""))},L=()=>{switch(r){case"sales-order":return"Send Sales Order Email";case"purchase-order":return"Send Purchase Order Email";case"quote":return"Send Quote Email";default:return"Send Email"}};return i.jsxs(dr,{open:e,onClose:M,maxWidth:"md",fullWidth:!0,children:[i.jsx(fr,{children:L()}),i.jsx(hr,{children:i.jsxs(Z,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[r!=="custom"&&P.length>0&&i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Email Template"}),i.jsxs(ln,{value:T,onChange:q=>U(q.target.value),label:"Email Template",children:[i.jsx(Jt,{value:"",children:i.jsx("em",{children:"Use default template"})}),P.map(q=>i.jsx(Jt,{value:q.id,children:i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[q.name,q.is_default&&i.jsx(ot,{label:"Default",size:"small",color:"secondary"})]})},q.id))]})]}),i.jsx(Pe,{label:"To",value:u,onChange:q=>d(q.target.value),fullWidth:!0,required:!0,type:"email"}),r==="custom"&&i.jsxs(i.Fragment,{children:[i.jsx(Pe,{label:"Subject",value:f,onChange:q=>h(q.target.value),fullWidth:!0,required:!0}),i.jsx(Pe,{label:"Message",value:p,onChange:q=>v(q.target.value),fullWidth:!0,multiline:!0,rows:6,required:!0})]}),r!=="custom"&&l&&i.jsx(Pe,{label:"Additional Message (Optional)",value:m,onChange:q=>y(q.target.value),fullWidth:!0,multiline:!0,rows:4,helperText:"Add a custom message to include with the email"}),w&&i.jsx(Pt,{severity:"error",sx:{mt:2},children:w})]})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:M,disabled:b,children:"Cancel"}),i.jsx(xe,{onClick:O,variant:"contained",disabled:b,startIcon:b?i.jsx(er,{size:20}):void 0,children:b?"Sending...":"Send Email"})]})]})},uT={product_name:""},bS=({open:e,onClose:t,onSave:r,initialProduct:n,isEditMode:a=!1,loading:o=!1})=>{const[s,l]=x.useState(uT),[c,u]=x.useState(null),d=Ay(s,300);x.useEffect(()=>{e&&(l({...uT,...n}),u(null))},[e,n]);const f=v=>{const{name:m,value:y}=v.target;l(b=>({...b,[m]:y}))},h=()=>s.product_name.trim()?(u(null),!0):(u("Product name is required"),!1),p=()=>{h()&&r(s)};return x.useEffect(()=>{},[d,e]),i.jsxs(dr,{open:e,onClose:t,maxWidth:"sm",fullWidth:!0,children:[i.jsx(fr,{children:a?"Edit Product":"Add New Product"}),i.jsxs(hr,{children:[i.jsx(ie,{container:!0,spacing:2,sx:{mt:1},children:i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{name:"product_name",label:"Product Name",value:s.product_name,onChange:f,fullWidth:!0,required:!0,autoFocus:!0})})}),c&&i.jsx("div",{style:{color:"red",marginTop:8},children:c})]}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:t,children:"Cancel"}),i.jsx(xe,{onClick:p,variant:"contained",disabled:o,children:a?"Save Changes":"Add Product"})]})]})},Ry=({when:e,onSave:t})=>{console.log("[UnsavedChangesGuard] Component rendered with when=",e);const[r,n]=x.useState(!1),[a,o]=x.useState(!1),s=x.useRef(""),l=x.useRef(null),c=x.useRef(!1);x.useEffect(()=>{if(!e)return;s.current=window.location.hash,console.log("[UnsavedChangesGuard] activating interceptors. prevHash=",s.current);const h=_=>_.metaKey||_.ctrlKey||_.shiftKey||_.altKey||_.button!==0,p=_=>{let w=_;for(;w&&w!==document.body;){if(w.tagName==="A")return w;w=w.parentElement}return null},v=_=>{if(!e||r)return;const w=p(_.target);if(!w||h(_))return;const A=w.getAttribute("href")||"";if(!A.startsWith("#"))return;const P=A;if(P!==window.location.hash){if(window.__unsavedGuardAllowNext){console.log("[UnsavedChangesGuard] bypass flag set -> allowing click navigation"),window.__unsavedGuardAllowNext=!1,c.current=!0;return}console.log("[UnsavedChangesGuard] click capture -> intercept anchor to",P),_.preventDefault(),_.stopPropagation(),l.current=P,n(!0)}},m=()=>{if(!e)return;if(window.__unsavedGuardAllowNext){console.log("[UnsavedChangesGuard] bypass flag set -> allowing hashchange"),window.__unsavedGuardAllowNext=!1,c.current=!0,s.current=window.location.hash;return}if(c.current){c.current=!1,s.current=window.location.hash,console.log("[UnsavedChangesGuard] hashchange allowed. prevHash ->",s.current);return}if(r)return;const _=window.location.hash;console.log("[UnsavedChangesGuard] hashchange detected -> attempted",_,"reverting to",s.current),l.current=_,n(!0),setTimeout(()=>{window.location.hash!==s.current&&(window.location.hash=s.current)},0)},y=history.pushState,b=history.replaceState;return history.pushState=function(..._){try{const w=_[2],A=typeof w=="string"?w:w?String(w):"",P=A&&A.includes("#")?A.slice(A.indexOf("#")):A;if(window.__unsavedGuardAllowNext)return console.log("[UnsavedChangesGuard] bypass flag set -> allowing pushState",A),window.__unsavedGuardAllowNext=!1,c.current=!0,y.apply(this,_);if(e&&!c.current){console.log("[UnsavedChangesGuard] pushState intercepted ->",A),l.current=P||null,n(!0);return}}catch{}return y.apply(this,_)},history.replaceState=function(..._){try{const w=_[2],A=typeof w=="string"?w:w?String(w):"",P=A&&A.includes("#")?A.slice(A.indexOf("#")):A;if(window.__unsavedGuardAllowNext)return console.log("[UnsavedChangesGuard] bypass flag set -> allowing replaceState",A),window.__unsavedGuardAllowNext=!1,c.current=!0,b.apply(this,_);if(e&&!c.current){console.log("[UnsavedChangesGuard] replaceState intercepted ->",A),l.current=P||null,n(!0);return}}catch{}return b.apply(this,_)},document.addEventListener("click",v,!0),window.addEventListener("hashchange",m),window.addEventListener("popstate",m),()=>{console.log("[UnsavedChangesGuard] deactivating interceptors"),document.removeEventListener("click",v,!0),window.removeEventListener("hashchange",m),window.removeEventListener("popstate",m),history.pushState=y,history.replaceState=b}},[e,r]),x.useEffect(()=>{console.log("[UnsavedChangesGuard] beforeunload useEffect triggered with when=",e);const h=p=>{e&&(console.log("[UnsavedChangesGuard] beforeunload fired"),p.preventDefault(),p.returnValue="")};return e&&(console.log("[UnsavedChangesGuard] registering beforeunload"),window.addEventListener("beforeunload",h)),()=>{console.log("[UnsavedChangesGuard] removing beforeunload listener"),window.removeEventListener("beforeunload",h)}},[e]);const u=()=>{console.log("[UnsavedChangesGuard] user chose: Stay"),n(!1),l.current=null},d=()=>{console.log("[UnsavedChangesGuard] user chose: Leave -> proceeding to",l.current);const h=l.current;n(!1),h&&(c.current=!0,l.current=null,window.location.hash!==h&&(window.location.hash=h))},f=async()=>{if(console.log("[UnsavedChangesGuard] user chose: Save and leave"),!t){d();return}try{o(!0),await t(),d()}catch(h){console.log("[UnsavedChangesGuard] save failed, staying on page",h),o(!1)}finally{o(!1)}};return i.jsxs(dr,{open:r,onClose:u,maxWidth:"xs",fullWidth:!0,children:[i.jsx(fr,{children:"Unsaved Changes"}),i.jsx(hr,{children:i.jsx(B,{variant:"body2",children:"You have unsaved changes. Would you like to save before leaving this page?"})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:u,children:"Cancel"}),i.jsx(xe,{onClick:d,color:"warning",children:"Leave without saving"}),i.jsx(xe,{onClick:f,variant:"contained",disabled:a,children:a?"Saving":"Save and leave"})]})]})};var Hf={},dT;function aue(){if(dT)return Hf;dT=1;var e=ir();Object.defineProperty(Hf,"__esModule",{value:!0}),Hf.default=void 0;var t=e(sr()),r=or();return Hf.default=(0,t.default)([(0,r.jsx)("path",{d:"M5 5h2v3h10V5h2v6h2V5c0-1.1-.9-2-2-2h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h5v-2H5zm7-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1"},"0"),(0,r.jsx)("path",{d:"m18.01 13-1.42 1.41 1.58 1.58H12v2h6.17l-1.58 1.59 1.42 1.41 3.99-4z"},"1")],"ContentPasteGo"),Hf}var iue=aue();const oue=Et(iue),qm={name:"",content:""},sue={"& textarea":{fontFamily:"Roboto Mono, Consolas, Menlo, monospace",fontSize:14,whiteSpace:"pre"}},lue=({open:e,onClose:t,onTemplateSelected:r,onSuccess:n,onError:a})=>{const[o,s]=x.useState([]),[l,c]=x.useState(!1),[u,d]=x.useState(null),[f,h]=x.useState(!1),[p,v]=x.useState(qm),[m,y]=x.useState({}),[b,_]=x.useState(!1),[w,A]=x.useState(null);x.useEffect(()=>{e&&P()},[e]);const P=async()=>{try{c(!0),d(null);const L=await ve.get("/api/quote-templates"),q=Array.isArray(L.data?.templates)?L.data.templates:[];s(q)}catch(L){console.error("Failed to load quote templates",L);const q=L?.response?.data&&typeof L.response?.data=="object"&&"message"in L.response?.data?(L.response?.data).message:"Failed to load quote templates";d(q),a?.(q)}finally{c(!1)}},E=L=>{L?(A(L),v({name:L.name,content:L.content})):(A(null),v(qm)),y({}),h(!0)},T=()=>{b||(h(!1),A(null),v(qm),y({}))},S=()=>{const L={};return p.name.trim()||(L.name="Template name is required"),p.content.trim()||(L.content="Template content is required"),y(L),Object.keys(L).length===0},I=async()=>{if(S())try{_(!0);const L={name:p.name.trim(),content:p.content};w?(await ve.put(`/api/quote-templates/${w.template_id}`,L),n?.("Template updated successfully")):(await ve.post("/api/quote-templates",L),n?.("Template created successfully")),h(!1),A(null),v(qm),await P()}catch(L){console.error("Failed to save quote template",L);const q=L,z=q.response?.data&&typeof q.response.data=="object"&&"message"in q.response.data?q.response.data.message:"Failed to save quote template";y(K=>({...K,submit:z})),a?.(z)}finally{_(!1)}},U=async L=>{if(window.confirm(`Delete template "${L.name}"?`))try{await ve.delete(`/api/quote-templates/${L.template_id}`),n?.("Template deleted"),await P()}catch(z){console.error("Failed to delete quote template",z);const K=z,J=K.response?.data&&typeof K.response.data=="object"&&"message"in K.response.data?K.response.data.message:"Failed to delete template";a?.(J)}},O=L=>{r(L)},M=x.useMemo(()=>o,[o]);return i.jsxs(dr,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,children:[i.jsxs(fr,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(g6,{color:"primary"}),"Quote Description Templates"]}),i.jsx(hr,{dividers:!0,children:i.jsxs(ut,{spacing:2,sx:{minHeight:260},children:[i.jsxs(ut,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:"Saved templates"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Create reusable descriptions, including ASCII or HTML tables, and insert them into your quotes."})]}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:()=>E(),size:"small",children:"New Template"})]}),l?i.jsx(Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexGrow:1},children:i.jsx(er,{size:32})}):u?i.jsx(Pt,{severity:"error",children:u}):M.length===0?i.jsx(Z,{sx:{textAlign:"center",py:6},children:i.jsx(B,{variant:"body1",color:"text.secondary",children:"No templates yet. Create your first template to speed up quote creation."})}):i.jsx(pa,{sx:{maxHeight:360,overflowY:"auto"},children:M.map((L,q)=>i.jsxs(Ae.Fragment,{children:[i.jsxs(Sa,{alignItems:"flex-start",sx:{alignItems:"flex-start",gap:2},children:[i.jsx(Qn,{primary:i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:L.name}),secondary:i.jsxs(B,{variant:"caption",color:"text.secondary",children:["Updated ",new Date(L.updated_at||L.created_at).toLocaleString()]})}),i.jsxs(ut,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",justifyContent:"flex-end",children:[i.jsx(xe,{variant:"outlined",size:"small",startIcon:i.jsx(oue,{}),onClick:()=>O(L),children:"Insert"}),i.jsx(Hn,{title:"Edit template",children:i.jsx("span",{children:i.jsx(vr,{onClick:()=>E(L),size:"small",children:i.jsx(tu,{fontSize:"small"})})})}),i.jsx(Hn,{title:"Delete template",children:i.jsx("span",{children:i.jsx(vr,{onClick:()=>U(L),size:"small",color:"error",children:i.jsx(ga,{fontSize:"small"})})})})]})]}),q<M.length-1&&i.jsx(Vn,{component:"li"})]},L.template_id))})]})}),i.jsx(_r,{children:i.jsx(xe,{onClick:t,children:"Close"})}),i.jsxs(dr,{open:f,onClose:T,maxWidth:"sm",fullWidth:!0,children:[i.jsx(fr,{children:w?"Edit Template":"New Template"}),i.jsx(hr,{children:i.jsxs(ut,{spacing:2,sx:{mt:1},children:[i.jsx(Pe,{label:"Template Name",value:p.name,onChange:L=>v(q=>({...q,name:L.target.value})),error:!!m.name,helperText:m.name,fullWidth:!0,autoFocus:!0}),i.jsx(Pe,{label:"Template Content",value:p.content,onChange:L=>v(q=>({...q,content:L.target.value})),error:!!m.content,helperText:m.content||"Supports multi-line descriptions and table layouts.",fullWidth:!0,multiline:!0,minRows:8,InputProps:{sx:sue}}),m.submit&&i.jsx(Pt,{severity:"error",children:m.submit})]})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:T,disabled:b,children:"Cancel"}),i.jsx(xe,{onClick:I,variant:"contained",disabled:b,children:b?"Saving":w?"Update Template":"Create Template"})]})]})]})},el={"& .MuiOutlinedInput-root":{height:56,borderRadius:1},"& .MuiInputBase-input":{py:1.25,fontSize:16}},vs={fontSize:18,transform:"translate(14px, 18px) scale(1)","&.MuiInputLabel-shrink":{fontSize:14,transform:"translate(14px, -9px) scale(0.9)"}},Fu=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim().toUpperCase(),cue=e=>{switch(e){case"Approved":return{backgroundColor:"rgba(76, 175, 80, 0.12)",color:"#2e7d32"};case"Rejected":return{backgroundColor:"rgba(244, 67, 54, 0.12)",color:"#c62828"};default:return{backgroundColor:"rgba(33, 150, 243, 0.12)",color:"#1565c0"}}},uue=(e,t)=>{const r=Fu(t);return r?e.map(a=>{const o=Fu(a.label);let s=-1;return o.startsWith(r)?s=3:o.split(" ").some(l=>l.startsWith(r))?s=2:o.includes(r)&&(s=1),{opt:a,score:s}}).filter(a=>a.score>=0).sort((a,o)=>o.score-a.score||a.opt.label.localeCompare(o.opt.label)).slice(0,8).map(a=>a.opt):e.slice(0,8)},fT=()=>{const{id:e}=Ms(),t=kn(),n=!!e&&!(e==="new"),[a,o]=x.useState([]),[s,l]=x.useState([]),[c,u]=x.useState(null),[d,f]=x.useState(null),[h,p]=x.useState(null),[v,m]=x.useState(Rt()),[y,b]=x.useState(Rt().add(30,"day")),[_,w]=x.useState(null),[A,P]=x.useState(""),[E,T]=x.useState(""),[S,I]=x.useState(""),[U,O]=x.useState(""),[M,L]=x.useState(""),[q,z]=x.useState(""),[K,J]=x.useState(!1),[R,k]=x.useState(null),[$,X]=x.useState(null),[C,N]=x.useState(!1),[H,W]=x.useState(""),[ne,se]=x.useState(null),[oe,ae]=x.useState(!1),pe=x.useRef(null),ge=x.useRef(null),[Q,G]=x.useState(!1),[ee,le]=x.useState(""),[V,Ve]=x.useState(null),[Me,Fe]=x.useState(!1),[Qe,it]=x.useState(""),[st,vt]=x.useState(!1),[Ye,Ze]=x.useState(""),[We,wt]=x.useState(!1),[It,Ot]=x.useState(!1),[Wt,jt]=x.useState(!1),[lr,$e]=x.useState(""),[He,Je]=x.useState(!1),[Ue,ht]=x.useState(!1),at=x.useCallback(()=>({customer:d?.id||c?.customer_id||null,product:h?.label||c?.product_name||"",quoteDate:v?.toISOString?.()||c?.quote_date||null,validUntil:y?.toISOString?.()||c?.valid_until||null,estimatedCost:_??c?.estimated_cost??null,productDescription:(A||"").trim(),terms:(E||"").trim(),customerPoNumber:(S||"").trim(),vinNumber:(U||"").trim(),vehicleMake:(M||"").trim(),vehicleModel:(q||"").trim()}),[d,c,h,v,y,_,A,E,S,U,M,q]),St=x.useCallback(_e=>{P(_e.content),Ot(!1),X(`Template "${_e.name}" inserted into the description.`),window.setTimeout(()=>{if(ge.current){const Te=ge.current;Te.focus();try{const nt=_e.content.length;Te.setSelectionRange(nt,nt)}catch{}}},0)},[P,Ot,X]);x.useEffect(()=>{if(He&&lr===""){const _e=JSON.stringify(at());$e(_e),console.log("[QuoteEditor] Initial signature set:",_e)}},[He,lr,at]);const Tt=x.useMemo(()=>JSON.stringify(at()),[at]),Yt=!!lr&&lr!==Tt&&!Ue;x.useEffect(()=>{lr&&console.log("[QuoteEditor] Signature comparison:",{isDirty:Yt,initialSignature:lr.slice(0,100)+"...",currentSignature:Tt.slice(0,100)+"...",signaturesMatch:lr===Tt})},[Yt,lr,Tt]),x.useEffect(()=>{Or(),Dr(),n||Je(!0)},[]),x.useEffect(()=>{!n||!e||(async()=>{try{const _e=await ve.get(`/api/quotes/${e}`),Te={..._e.data,status:Oh(_e.data?.status)};u(Te),f(null),p({label:Te.product_name}),m(Rt(Te.quote_date)),b(Rt(Te.valid_until)),w(Number(Te.estimated_cost??0)),P(Te.product_description||""),T(Te.terms||""),I(Te.customer_po_number||""),O(Te.vin_number||""),L(Te.vehicle_make||""),z(Te.vehicle_model||""),W(Te.customer_name||""),le(Te.product_name||""),Je(!0)}catch(_e){console.error("Failed to load quote:",_e),k("Failed to load quote")}})()},[e,n]),x.useEffect(()=>{if(c&&a.length>0){const _e=a.find(Te=>Te.id===c.customer_id);_e&&f(_e)}},[a,c]),x.useEffect(()=>()=>{ne&&window.clearTimeout(ne),V&&window.clearTimeout(V)},[ne,V]);const Or=async()=>{try{const Te=((await ve.get("/api/customers")).data||[]).map(nt=>({label:nt.customer_name,id:nt.customer_id,email:nt.email}));o(Te)}catch{k("Failed to load customers")}},Dr=async()=>{try{const _e=await ve.get("/api/products");l((_e.data||[]).map(Te=>({label:Te.product_name,id:Te.product_id,description:Te.product_description})))}catch{k("Failed to load products")}},tr=_e=>{const Te=Fu(_e);return a.find(nt=>Fu(nt.label)===Te)||null},wr=async()=>{if(!d||!h||!v||!y||_==null){k("Please fill in all required fields");return}J(!0),ht(!0);try{const _e={customer_id:d.id,product_name:h.label.trim(),quote_date:v.format("YYYY-MM-DD"),valid_until:y.format("YYYY-MM-DD"),estimated_cost:Number(_),product_description:A,terms:E,customer_po_number:S,vin_number:U,vehicle_make:M.trim(),vehicle_model:q.trim(),status:c?.status??"Open"};if(n&&c){const Te=await ve.put(`/api/quotes/${c.quote_id}`,_e);X("Quote updated successfully");const nt=Te?.data;u(nt?Mt=>Mt&&{...Mt,...nt,status:Oh(nt.status??Mt.status)}:Mt=>Mt&&{...Mt,..._e});const mt=JSON.stringify(at());$e(mt),console.log("[QuoteEditor] Signature reset after save:",mt.slice(0,100)+"..."),setTimeout(()=>{window.__unsavedGuardAllowNext=!0},100)}else{if(window.__quoteCreateInFlight){console.log("[QuoteEditor] Skipping duplicate create (in flight)");return}window.__quoteCreateInFlight=!0;const Te=await ve.post("/api/quotes",_e);X("Quote created successfully");const nt=Te?.data??{},mt=nt.quote_id??nt.quoteId??nt.id??nt?.quote?.quote_id;if(mt){const Mt={quote_id:mt,quote_number:nt.quote_number||`Q${mt}`,customer_id:d.id,customer_name:d.label,quote_date:_e.quote_date,valid_until:_e.valid_until,product_name:_e.product_name,product_description:_e.product_description,estimated_cost:_e.estimated_cost,status:"Open",terms:_e.terms,customer_po_number:_e.customer_po_number,vin_number:_e.vin_number,vehicle_make:_e.vehicle_make,vehicle_model:_e.vehicle_model};u(Mt),window.__unsavedGuardAllowNext=!0,t(`/quotes/${mt}`,{replace:!0}),$e(JSON.stringify(at()));return}}}catch(_e){const Te=_e,nt=Te.response?.data&&typeof Te.response.data=="object"&&"message"in Te.response.data?Te.response.data.message:"Failed to save quote";k(nt)}finally{J(!1),ht(!1),window.__quoteCreateInFlight=!1}},Ir=async()=>{if(c)try{const _e=await ve.get(`/api/quotes/${c.quote_id}/pdf`,{responseType:"blob"}),Te=window.URL.createObjectURL(new Blob([_e.data])),nt=document.createElement("a");nt.href=Te,nt.setAttribute("download",`Quote_${c.quote_number}.pdf`),document.body.appendChild(nt),nt.click(),nt.parentNode?.removeChild(nt),window.URL.revokeObjectURL(Te),X("PDF downloaded successfully.")}catch{k("Failed to download PDF. Please try again.")}},dn=()=>{const _e=new br({unit:"pt"}),Te=40,nt=_e.internal.pageSize.getWidth(),mt=nt-Te*2,Mt="Estimate Cost";_e.setFontSize(16),_e.setFont("helvetica","bold"),_e.text(Mt,Te,40),_e.setFontSize(10),_e.setFont("helvetica","normal");let Nr=58;c?.quote_number&&(_e.text(`Quote: ${c.quote_number}`,Te,Nr),Nr+=14),d?.label&&(_e.text(`Customer: ${d.label}`,Te,Nr),Nr+=14),h?.label&&(_e.text(`Product: ${h.label}`,Te,Nr),Nr+=14);const Ar=[["SN","Item Code","Description","Qty","Unit","Unit Price","Line Total"]],$r=[["1","LABOUR","Labour Hours","52.41","hr","40.00","2096.40"],["2","1705110",'48" ALUM UNDERBODY TOOLBOX',"2","Each","1246.94","2493.88"],["3","3X(3/8)","Flatbar","75","ft","3.91","293.25"],["4","2X2X(3/16)AG L","Angle","10","ft","2.68","26.80"],["5","(3/4)(A36/44W)","HR ROUND - ASTM A36/44W","10","ft","1.67","16.70"],["6","5X3X(1/4)ANG LE3","HEAT # 52118708","20","ft","7.01","140.20"],["7","(4-1)(A36/44W)","CHANNEL ASTM A36/44W","100","ft","4.14","414.00"],["8","83021K05","CLOVAPRIME 21 EPOXY PRIM GREY 5 GAL KIT","1","Each","441.29","441.29"],["9","83904K05","GEMINI AMOURSHIELD BLACK 5G KIT","2","Each","639.73","1279.46"],["10","CLS-AS2620C","CR ANTI SAIL BRACKET","3","Each","8.70","26.10"],["11","AUP-IMXGT-2436CD",'1/4" RUBBER BLACK CHEVRO',"3","Each","19.53","58.59"],["12","SUPPLY","Supply","1","Each","209.64","209.64"],["13","OVERHEAD","Overhead Hours","52.41","hr","30.00","1572.30"]],Vr={sn:26,code:80,qty:44,unit:40,unitPrice:72,lineTotal:80},In=Vr.sn+Vr.code+Vr.qty+Vr.unit+Vr.unitPrice+Vr.lineTotal,$n=Math.max(140,mt-In);nue(_e,{head:Ar,body:$r,startY:Math.max(110,Nr+10),margin:{left:Te,right:Te},tableWidth:mt,styles:{fontSize:9,cellPadding:4,overflow:"linebreak"},headStyles:{fillColor:[33,150,243],halign:"center"},columnStyles:{0:{cellWidth:Vr.sn,halign:"right"},1:{cellWidth:Vr.code},2:{cellWidth:$n},3:{cellWidth:Vr.qty,halign:"right"},4:{cellWidth:Vr.unit},5:{cellWidth:Vr.unitPrice,halign:"right"},6:{cellWidth:Vr.lineTotal,halign:"right"}},theme:"striped",didParseCell:wi=>{wi.section==="body"&&[0,3,5,6].includes(wi.column.index)&&(wi.cell.styles.halign="right")}});const ca=_e.lastAutoTable?.finalY||110,fi="Sub Total: 9068.61",ro="Total GST: 453.43",qi="Total: 9522.04";_e.setFont("helvetica","bold"),_e.setFontSize(11);const Nn=nt-Te;_e.text(fi,Nn,ca+24,{align:"right"}),_e.text(ro,Nn,ca+44,{align:"right"}),_e.setFontSize(12),_e.text(qi,Nn,ca+70,{align:"right"});const Fi=c?.quote_number?`Estimate_${c.quote_number}`:"Estimate_Cost";_e.save(`${Fi}.pdf`)},ka=()=>{Wt||(jt(!0),window.setTimeout(()=>{jt(!1);try{dn(),X("Estimate generated successfully.")}catch{k("Failed to generate estimate PDF.")}},15e3))},En=()=>{if(!c?.quote_id){k("Please save the quote before emailing.");return}wt(!0)},Zt=async()=>{if(!c?.quote_id){k("Please save the quote before converting.");return}J(!0);try{const _e=await ve.post(`/api/quotes/${c.quote_id}/convert-to-sales-order`);X("Quote converted to sales order successfully!");const Te=_e?.data?.quote;u(Te?mt=>mt&&{...mt,...Te,status:Oh(Te.status??"Approved")}:mt=>mt&&{...mt,status:"Approved"});const nt=_e.data.salesOrder?.sales_order_id;setTimeout(nt?()=>{t(`/open-sales-orders/${nt}`)}:()=>{t("/open-sales-orders")},1500)}catch(_e){const Te=_e,nt=Te.response?.data&&typeof Te.response.data=="object"&&"message"in Te.response.data?Te.response.data.message:"Failed to convert quote to sales order";k(nt)}finally{J(!1)}},Xr=_e=>{const Te=H.trim(),nt=_e.key==="Enter",mt=_e.key==="Tab",Mt=_e.key==="Escape",Nr=_e.key==="ArrowDown"||_e.key==="ArrowUp";if(Mt){N(!1);return}if(!Nr&&(nt||mt)){if(nt&&_e.ctrlKey&&Te){_e.preventDefault(),ae(!0),it(Te),Fe(!0);return}const Ar=tr(Te);if(C||!Te)return;_e.preventDefault(),Ar?(f(Ar),W(Ar.label)):(ae(!0),it(Te),Fe(!0))}},Gn=_e=>{if(_e.key==="Enter"){_e.preventDefault();const Te=ee.trim();if(!Te)return;const nt=s.find(mt=>mt.label.toLowerCase()===Te.toLowerCase());nt?(p(nt),le(nt.label)):(Ze(Te),vt(!0))}},Tn=n&&c?`Edit Quote: ${c.quote_number}`:n?"Edit Quote":"New Quote",Wr=c?c.status:"Open",en=Wr==="Approved",Se=Wr==="Rejected",Ge=async()=>{if(!c?.quote_id){k("Please save the quote before rejecting.");return}if(window.confirm("Are you sure you want to mark this quote as rejected?")){J(!0);try{const _e=await ve.post(`/api/quotes/${c.quote_id}/reject`),Te=_e?.data?.quote??_e?.data;u(Te?nt=>nt&&{...nt,...Te,status:Oh(Te.status??"Rejected")}:nt=>nt&&{...nt,status:"Rejected"}),X("Quote marked as rejected.")}catch(_e){const Te=_e,nt=Te.response?.data&&typeof Te.response.data=="object"&&"message"in Te.response.data?Te.response.data.message:"Failed to reject quote";k(nt)}finally{J(!1)}}};return i.jsxs(Os,{dateAdapter:oc,children:[i.jsx(Ry,{when:Yt,onSave:wr}),i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4,px:{xs:2,sm:3}},children:[i.jsxs(Z,{sx:{maxWidth:1e3,mx:"auto",mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs(ut,{direction:"row",spacing:1.5,alignItems:"center",children:[i.jsx(B,{variant:"h5",sx:{fontWeight:700},children:Tn}),n&&c&&i.jsx(ot,{label:Wr,sx:{fontWeight:600,...cue(Wr)}})]}),i.jsxs(ut,{direction:"row",spacing:1.25,children:[i.jsx(xe,{variant:"contained",color:"primary",startIcon:i.jsx(Is,{}),onClick:wr,disabled:K,children:n?"SAVE CHANGES":"CREATE QUOTE"}),n&&c&&i.jsxs(i.Fragment,{children:[i.jsx(xe,{variant:"contained",color:"primary",startIcon:i.jsx(xv,{}),onClick:Zt,disabled:K||en||Se,children:"CONVERT TO SO"}),i.jsx(xe,{variant:"contained",color:"error",startIcon:i.jsx(yle,{}),onClick:Ge,disabled:K||en||Se,children:"MARK REJECTED"}),i.jsx(xe,{variant:"contained",color:"primary",startIcon:i.jsx(la,{}),onClick:Ir,children:"DOWNLOAD PDF"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(gS,{}),sx:{backgroundColor:"#ff9800","&:hover":{backgroundColor:"#f57c00"}},onClick:En,children:"EMAIL QUOTE"})]})]})]}),i.jsx(Z,{sx:{maxWidth:1e3,mx:"auto",mt:1.5},children:i.jsx(bt,{sx:{p:3,backgroundColor:"#fff"},elevation:3,children:i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(Ra,{open:C,onOpen:()=>N(!0),onClose:()=>N(!1),autoHighlight:!0,options:a,value:d,onChange:(_e,Te)=>{if(oe){ae(!1);return}Te&&Te.isNew?(Fe(!0),it(H),f(null),W("")):f(Te)},filterOptions:(_e,Te)=>{const nt=uue(_e,Te.inputValue||""),mt=!!(Te.inputValue&&a.some(Nr=>Fu(Nr.label)===Fu(Te.inputValue))),Mt=[...nt];return(Te.inputValue||"").trim()!==""&&!mt&&Mt.push({label:`Add "${Te.inputValue}" as New Customer`,isNew:!0}),nt.length===0&&(Te.inputValue||"").trim()!==""&&!mt,Mt},inputValue:H,onInputChange:(_e,Te,nt)=>{if(W(Te),ne&&window.clearTimeout(ne),nt==="reset")return;if(Te.trim().length>0){const Mt=window.setTimeout(()=>N(!0),180);se(Mt)}else N(!1)},getOptionLabel:_e=>typeof _e=="string"?_e:_e.label,isOptionEqualToValue:(_e,Te)=>_e.id===Te?.id,renderOption:(_e,Te)=>{const nt=Te.isNew,{key:mt,...Mt}=_e;return i.jsxs("li",{...Mt,style:{display:"flex",alignItems:"center",opacity:nt?.9:1},children:[nt&&i.jsx(Zl,{fontSize:"small",style:{marginRight:8,color:"#666"}}),i.jsx("span",{children:Te.label})]},mt)},renderInput:_e=>{const Te=!!_e.inputProps?.value,nt=!!d||Te;return i.jsx(Pe,{..._e,label:"Customer",fullWidth:!0,required:!0,onKeyDown:Xr,onBlur:()=>{if(!d){const mt=H.trim();if(mt){const Mt=tr(mt);Mt&&(f(Mt),W(Mt.label))}}},inputRef:mt=>{pe.current=mt},sx:el,InputLabelProps:{..._e.InputLabelProps,sx:vs,shrink:nt}})}})}),i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(Pe,{label:"Customer PO #",fullWidth:!0,value:S,onChange:_e=>I(_e.target.value),sx:el,InputLabelProps:{sx:vs}})}),i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(Pe,{label:"Estimated Price",type:"number",value:_??"",onChange:_e=>w(_e.target.value===""?null:parseFloat(_e.target.value)),fullWidth:!0,required:!0,InputProps:{startAdornment:i.jsx(aa,{position:"start",children:"$"})},inputProps:{step:"0.01",onWheel:_e=>_e.currentTarget.blur()},sx:el,InputLabelProps:{sx:vs}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Ra,{disablePortal:!0,open:Q,onOpen:()=>G(!0),onClose:()=>G(!1),autoHighlight:!0,options:s,value:h,onChange:(_e,Te)=>{if(Te&&Te.isNew){const nt=Te.inputValue?.toString?.()||ee.trim();vt(!0),Ze(nt),p(null),le(""),G(!1)}else p(Te),G(!1)},filterOptions:(_e,Te)=>{const nt=_e.filter(mt=>mt.label.toLowerCase().includes(Te.inputValue.toLowerCase()));return Te.inputValue!==""&&!_e.some(mt=>mt.label.toLowerCase()===Te.inputValue.toLowerCase())&&nt.push({label:`Add "${Te.inputValue}"`,isNew:!0,inputValue:Te.inputValue}),nt},inputValue:ee,onInputChange:(_e,Te,nt)=>{if(le(Te),Ze(Te),V&&window.clearTimeout(V),nt==="reset")return;if(Te.trim().length>0){const Mt=window.setTimeout(()=>G(!0),180);Ve(Mt)}else G(!1)},getOptionLabel:_e=>typeof _e=="string"?_e:_e.label,isOptionEqualToValue:(_e,Te)=>_e.id===Te?.id,renderInput:_e=>{const Te=!!_e.inputProps?.value,nt=!!h||Te;return i.jsx(Pe,{..._e,label:"Product",fullWidth:!0,required:!0,onKeyDown:Gn,onBlur:()=>{if(!h){const mt=ee.trim();if(mt){const Mt=s.find(Nr=>Nr.label.toLowerCase()===mt.toLowerCase());Mt&&(p(Mt),le(Mt.label))}}},sx:el,InputLabelProps:{..._e.InputLabelProps,sx:vs,shrink:nt}})}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Pe,{label:"VIN #",fullWidth:!0,placeholder:"Optional",value:U,onChange:_e=>O(_e.target.value),sx:el,InputLabelProps:{sx:vs}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Pe,{label:"Make",fullWidth:!0,value:M,onChange:_e=>L(_e.target.value),sx:el,InputLabelProps:{sx:vs}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Pe,{label:"Model",fullWidth:!0,value:q,onChange:_e=>z(_e.target.value),sx:el,InputLabelProps:{sx:vs}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(os,{label:"Quote Date",value:v,onChange:_e=>m(_e),slotProps:{textField:{fullWidth:!0,sx:el,InputLabelProps:{sx:vs}}}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(os,{label:"Valid Until",value:y,onChange:_e=>b(_e),slotProps:{textField:{fullWidth:!0,sx:el,InputLabelProps:{sx:vs}}}})}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsxs(ut,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:"Product Description"}),i.jsx(xe,{variant:"outlined",size:"small",startIcon:i.jsx(g6,{fontSize:"small"}),onClick:()=>Ot(!0),children:"Templates"})]}),i.jsx(Pe,{placeholder:"Add the quote details here...",fullWidth:!0,multiline:!0,minRows:6,value:A,onChange:_e=>P(_e.target.value),inputRef:ge,sx:{"& .MuiOutlinedInput-root":{borderRadius:1},"& textarea":{fontSize:15,fontFamily:"Roboto Mono, Consolas, Menlo, monospace",whiteSpace:"pre-wrap"}}}),i.jsxs(Z,{sx:{mt:1.5,display:"flex",alignItems:"center",gap:1.5},children:[i.jsx(xe,{variant:"contained",color:"secondary",onClick:ka,disabled:Wt,children:"ESTIMATE COST"}),Wt&&i.jsxs(ut,{direction:"row",alignItems:"center",spacing:1,children:[i.jsx(er,{size:22}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Generating estimate"})]})]})]}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Terms and Conditions",fullWidth:!0,multiline:!0,minRows:4,value:E,onChange:_e=>T(_e.target.value),sx:{"& .MuiOutlinedInput-root":{borderRadius:1},"& .MuiOutlinedInput-input":{fontSize:15}},InputLabelProps:{sx:vs,shrink:!0}})})]})})}),i.jsx(lue,{open:It,onClose:()=>Ot(!1),onTemplateSelected:St,onSuccess:_e=>X(_e),onError:_e=>k(_e)}),i.jsx(Z6,{open:We,onClose:()=>wt(!1),type:"quote",recordId:c?.quote_id,defaultTo:d?.email||"",allowMessageEdit:!0}),i.jsx(Wd,{open:Me,onClose:()=>Fe(!1),onSave:async _e=>{try{const nt=(await ve.post("/api/customers",_e)).data,mt={label:nt.customer_name,id:nt.customer_id,email:nt.email||_e.email};o(Mt=>[...Mt,mt]),f(mt),Fe(!1),W(mt.label)}catch{k("Failed to add customer")}},initialCustomer:{customer_name:Qe},isEditMode:!1}),i.jsx(bS,{open:st,onClose:()=>vt(!1),onSave:async _e=>{try{const Te=await ve.post("/api/products",_e),nt={label:_e.product_name,id:Te.data.product_id,description:_e.product_name};l(mt=>[...mt,nt]),p(nt),le(nt.label),vt(!1),Ze("")}catch{k("Failed to add product.")}},initialProduct:{product_name:Ye||ee},isEditMode:!1}),i.jsx(hl,{open:!!$,autoHideDuration:6e3,onClose:()=>X(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Pt,{onClose:()=>X(null),severity:"success",sx:{width:"100%"},children:$})}),i.jsx(hl,{open:!!R,autoHideDuration:6e3,onClose:()=>k(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Pt,{onClose:()=>k(null),severity:"error",sx:{width:"100%"},children:R})})]})]})},due=({conversations:e,activeConversationId:t,onSelect:r,onStartConversation:n,isLoading:a=!1,unreadConversationIds:o})=>{const[s,l]=x.useState(""),c=x.useMemo(()=>new Set(o??[]),[o]),u=x.useMemo(()=>{const d=s.trim().toLowerCase();return d?e.filter(f=>{const h=f.displayName.toLowerCase(),p=f.participantNames.toLowerCase();return h.includes(d)||p.includes(d)}):e},[e,s]);return i.jsxs(Z,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[i.jsxs(ut,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:2,sx:{mb:2},children:[i.jsx(B,{variant:"h6",component:"h2",children:"Conversations"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Tv,{}),onClick:n,size:"small",children:"New"})]}),i.jsx(Pe,{fullWidth:!0,size:"small",placeholder:"Search conversations",value:s,onChange:d=>l(d.target.value),sx:{mb:2}}),i.jsx(Vn,{}),i.jsx(Z,{sx:{flexGrow:1,overflowY:"auto"},children:a?i.jsx(Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",py:4},children:i.jsx(er,{size:32})}):u.length===0?i.jsx(Z,{sx:{textAlign:"center",py:6,px:2},children:i.jsx(B,{variant:"body2",color:"text.secondary",children:s?"No conversations match your search.":"Start a new conversation to begin messaging."})}):i.jsx(pa,{disablePadding:!0,children:u.map(d=>{const f=d.lastMessage?.content,h=d.lastMessageAt||d.updatedAt||d.createdAt,p=joe(new Date(h),{addSuffix:!0}),v=c.has(d.id);return i.jsxs(Ae.Fragment,{children:[i.jsxs(y8,{selected:d.id===t,alignItems:"flex-start",onClick:()=>r(d.id),sx:{py:1.5,"&.Mui-selected":{backgroundColor:"action.selected"},bgcolor:v?"action.hover":void 0,"& .MuiListItemText-secondary":{display:"-webkit-box",overflow:"hidden",WebkitBoxOrient:"vertical",WebkitLineClamp:2}},children:[i.jsx(x8,{children:i.jsx(kp,{children:d.displayName.charAt(0).toUpperCase()})}),i.jsx(Qn,{primary:i.jsxs(ut,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:1,children:[i.jsx(B,{variant:"subtitle1",noWrap:!0,sx:{fontWeight:v?600:500},children:d.displayName}),i.jsxs(ut,{direction:"row",alignItems:"center",spacing:1.25,sx:{flexShrink:0},children:[v&&i.jsx(Z,{component:"span",sx:{width:8,height:8,borderRadius:"50%",bgcolor:"primary.main"}}),i.jsx(B,{variant:"caption",color:"text.secondary",children:p})]})]}),secondaryTypographyProps:{fontWeight:v?600:void 0},secondary:f||"No messages yet"})]}),i.jsx(Vn,{component:"li"})]},d.id)})})})]})},fue=({onSendMessage:e,disabled:t=!1,placeholder:r="Type your message...",withTopBorder:n=!0})=>{const[a,o]=x.useState(""),s=()=>{a.trim()&&!t&&(e(a.trim()),o(""))},l=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),s())};return i.jsx(bt,{elevation:0,sx:{px:{xs:2,sm:3},py:2.5,borderTop:n?"1px solid":"none",borderColor:"divider",bgcolor:"transparent",backdropFilter:"blur(6px)"},children:i.jsxs(Z,{sx:{display:"flex",alignItems:{xs:"stretch",sm:"center"},gap:1.5,bgcolor:"rgba(255, 255, 255, 0.92)",borderRadius:3,px:{xs:1.5,sm:2.5},py:{xs:1.25,sm:1.5},border:"1px solid rgba(148, 163, 184, 0.25)",boxShadow:"0 18px 36px -28px rgba(15, 23, 42, 0.4)"},children:[i.jsx(Pe,{fullWidth:!0,multiline:!0,maxRows:4,value:a,onChange:c=>o(c.target.value),onKeyDown:l,placeholder:r,disabled:t,variant:"standard",size:"medium",sx:{"& .MuiInputBase-root":{fontSize:15,lineHeight:1.7,"&::before, &::after":{display:"none"}},"& textarea":{padding:0}}}),i.jsx(Hn,{title:"Send message",children:i.jsx("span",{children:i.jsx(vr,{onClick:s,disabled:!a.trim()||t,sx:{bgcolor:"primary.main",color:"common.white",p:1.4,borderRadius:"18px",transition:"transform 0.2s ease, box-shadow 0.2s ease",boxShadow:c=>`0 16px 32px -18px ${c.palette.primary.main}`,"&:hover":{bgcolor:"primary.dark",transform:"translateY(-1px)",boxShadow:c=>`0 20px 38px -20px ${c.palette.primary.dark}`},"&.Mui-disabled":{bgcolor:"grey.200",color:"grey.500",boxShadow:"none",transform:"none"}},children:i.jsx(b8,{fontSize:"small"})})})})]})})};var Vf={},hT;function hue(){if(hT)return Vf;hT=1;var e=ir();Object.defineProperty(Vf,"__esModule",{value:!0}),Vf.default=void 0;var t=e(sr()),r=or();return Vf.default=(0,t.default)((0,r.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"}),"DeleteOutlineOutlined"),Vf}var pue=hue();const mue=Et(pue),gue=e=>{try{return Ru(new Date(e),"MMM d, yyyy h:mm a")}catch{return e}},vue=({conversation:e,messages:t,currentUserId:r,isLoading:n,isSending:a,onSendMessage:o,onDeleteMessage:s})=>{const l=x.useRef(null);x.useEffect(()=>{const u=l.current;u&&(u.scrollTop=u.scrollHeight)},[t.length,n]);const c=x.useMemo(()=>e?e.otherParticipants.length>0?e.otherParticipants.map(u=>u.username||u.email||"Unknown user").join(", "):e.participantNames:"",[e]);return e?i.jsxs(bt,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[i.jsxs(Z,{sx:{p:2},children:[i.jsx(B,{variant:"h6",component:"h2",children:e.displayName}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:c})]}),i.jsx(Vn,{}),i.jsx(Z,{ref:l,sx:{flexGrow:1,overflowY:"auto",p:2},children:n?i.jsx(Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:i.jsx(er,{size:36})}):t.length===0?i.jsx(Z,{sx:{textAlign:"center",color:"text.secondary",mt:6},children:i.jsx(B,{variant:"body2",children:"No messages yet. Start the conversation below."})}):i.jsx(ut,{spacing:2,children:t.map(u=>{const d=r!==null&&u.senderId===r,f=!!u.isDeletedForUser,h=d?"flex-end":"flex-start",p=u.error?"error.light":f?"grey.300":d?"primary.main":"grey.100",v=u.error?"error.dark":f?"text.secondary":d?"common.white":"text.primary",m=!f&&!u.error&&!u.pending&&typeof u.id=="number",y=f?d?"You deleted this message":"Message deleted":u.content;return i.jsx(Z,{sx:{display:"flex",justifyContent:h},children:i.jsxs(Z,{sx:{maxWidth:"75%",display:"flex",flexDirection:"column",gap:.5},children:[i.jsxs(bt,{elevation:d?3:1,sx:{p:1.5,bgcolor:p,color:v,borderRadius:2,border:u.error?"1px solid":"none",borderColor:u.error?"error.main":void 0,position:"relative"},children:[i.jsxs(ut,{spacing:.5,children:[i.jsx(B,{variant:"caption",sx:{opacity:d?.85:.6},children:u.senderName||(d?"You":"Unknown user")}),i.jsx(B,{variant:"body2",sx:{whiteSpace:"pre-wrap",fontStyle:f?"italic":"normal"},children:y}),i.jsx(B,{variant:"caption",sx:{opacity:d?.85:.6,textAlign:"right"},children:gue(u.createdAt)})]}),m&&i.jsx(Hn,{title:"Delete for me",children:i.jsx(vr,{size:"small",onClick:()=>s(Number(u.id)),sx:{position:"absolute",top:4,right:4,color:d?"common.white":"text.secondary",bgcolor:d?"rgba(255,255,255,0.1)":"transparent","&:hover":{bgcolor:d?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.04)"}},children:i.jsx(mue,{fontSize:"inherit"})})})]}),u.pending&&!u.error&&i.jsx(ot,{label:"Sending...",size:"small",color:"default",sx:{alignSelf:d?"flex-end":"flex-start",mt:.5}}),u.error&&i.jsx(B,{variant:"caption",color:"error",sx:{alignSelf:d?"flex-end":"flex-start"},children:"Failed to send. Please try again."})]})},u.id)})})}),i.jsx(Vn,{}),i.jsx(fue,{onSendMessage:u=>o(u),disabled:a})]}):i.jsx(bt,{sx:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",p:4},children:i.jsx(B,{variant:"body1",color:"text.secondary",align:"center",children:"Select a conversation to view messages or start a new chat."})})},yue=()=>{const{user:e}=Jn(),t=e?Number(e.id):null,{conversations:r,isLoadingConversations:n,activeConversationId:a,selectConversation:o,messagesByConversation:s,isLoadingMessages:l,sendMessage:c,createConversation:u,loadMessages:d,deleteMessage:f,unreadConversationIds:h}=mN(),[p,v]=x.useState([]),[m,y]=x.useState(!1),[b,_]=x.useState(!1),[w,A]=x.useState([]),[P,E]=x.useState(""),[T,S]=x.useState(!1),[I,U]=x.useState(!1);x.useEffect(()=>{let $=!0;return(async()=>{try{y(!0);const C=await ve.get("/api/employees");if(!$)return;const H=(Array.isArray(C.data)?C.data:[]).map(W=>({id:Number(W.id),username:W.username??null,email:W.email??null,access_role:W.access_role})).filter(W=>W.id!==t).sort((W,ne)=>{const se=(W.username||W.email||"").toLowerCase(),oe=(ne.username||ne.email||"").toLowerCase();return se.localeCompare(oe)});v(H)}catch(C){console.error("Failed to load employees",C),me.error("Unable to load team members.")}finally{$&&y(!1)}})(),()=>{$=!1}},[t]);const O=x.useMemo(()=>r.find($=>$.id===a),[a,r]),M=a?s[a]??[]:[],L=a?!!l[a]:!1,q=()=>{A([]),E(""),_(!0)},z=()=>{T||_(!1)},K=async()=>{if(w.length===0){me.error("Select at least one teammate to start a conversation.");return}const $=w.map(C=>C.id),X=$.length>1?"group":"direct";if(X==="group"&&!P.trim()){me.error("Enter a name for the group conversation.");return}try{S(!0);const C=await u({participantIds:$,title:X==="group"?P.trim():void 0,type:X}),{conversation:N,created:H}=C;me.success(H?"Conversation created successfully.":"Conversation already existed. Opening chat."),_(!1),A([]),E(""),await d(N.id,{force:!0})}catch(C){console.error("Failed to create conversation",C),me.error("Unable to start conversation. Please try again.")}finally{S(!1)}},J=async $=>{if(!a){me.error("Select a conversation before sending a message.");return}try{U(!0),await c(a,$)}catch(X){console.error("Failed to send message",X),me.error("Failed to send message. Please try again.")}finally{U(!1)}},R=async $=>{if(!a){me.error("Select a conversation before deleting a message.");return}try{await f(a,$),me.info("Message deleted for you.")}catch(X){console.error("Failed to delete message",X),me.error("Unable to delete message. Please try again.")}},k=x.useMemo(()=>p,[p]);return i.jsxs(Z,{sx:{display:"flex",flexDirection:"column",height:"100%",p:{xs:2,md:3},gap:3},children:[i.jsxs(ut,{spacing:1,children:[i.jsx(B,{variant:"h4",component:"h1",children:"Messaging"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Collaborate with your team using direct messages and group chats."})]}),i.jsxs(bt,{elevation:0,sx:{flexGrow:1,minHeight:{xs:480,md:540},display:"flex",flexDirection:{xs:"column",md:"row"},borderRadius:3,overflow:"hidden",border:"1px solid",borderColor:"divider",backgroundColor:"background.paper"},children:[i.jsx(Z,{sx:{width:{xs:"100%",md:340},flexShrink:0,borderRight:{md:"1px solid",xs:"none"},borderColor:"divider",backgroundColor:"background.default"},children:i.jsx(Z,{sx:{height:"100%",p:{xs:2,md:2.5}},children:i.jsx(due,{conversations:r,activeConversationId:a,onSelect:o,onStartConversation:q,isLoading:n,unreadConversationIds:h})})}),i.jsx(Vn,{orientation:"vertical",flexItem:!0,sx:{display:{xs:"none",md:"block"}}}),i.jsx(Z,{sx:{flex:1,p:{xs:2,md:2.5},display:"flex",flexDirection:"column",backgroundColor:"background.paper"},children:i.jsx(vue,{conversation:O,messages:M,currentUserId:t,isLoading:L,isSending:I,onSendMessage:J,onDeleteMessage:R})})]}),i.jsxs(dr,{open:b,onClose:z,fullWidth:!0,maxWidth:"sm",children:[i.jsx(fr,{children:"Start a Conversation"}),i.jsx(hr,{dividers:!0,children:i.jsxs(ut,{spacing:2,sx:{mt:1},children:[i.jsx(Ra,{multiple:!0,options:k,value:w,onChange:($,X)=>A(X),getOptionLabel:$=>$.username||$.email||`User ${$.id}`,renderOption:($,X)=>x.createElement("li",{...$,key:X.id},i.jsxs(ut,{spacing:.25,children:[i.jsx(B,{variant:"body2",children:X.username||X.email||`User ${X.id}`}),X.email&&i.jsx(B,{variant:"caption",color:"text.secondary",children:X.email})]})),filterSelectedOptions:!0,renderInput:$=>i.jsx(Pe,{...$,label:"Participants",placeholder:"Select team members",helperText:"Choose one teammate for a direct chat or multiple for a group conversation."}),loading:m,loadingText:"Loading team members..."}),w.length>1&&i.jsx(Pe,{label:"Group name",value:P,onChange:$=>E($.target.value),placeholder:"e.g., Operations Leads",inputProps:{maxLength:80}})]})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:z,disabled:T,children:"Cancel"}),i.jsx(xe,{variant:"contained",onClick:K,disabled:T||w.length===0||w.length>1&&!P.trim(),children:T?"Creating":"Start"})]})]})]})};var Gf={},pT;function xue(){if(pT)return Gf;pT=1;var e=ir();Object.defineProperty(Gf,"__esModule",{value:!0}),Gf.default=void 0;var t=e(sr()),r=or();return Gf.default=(0,t.default)((0,r.jsx)("path",{d:"m19 9 1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25zm-7.5.5L9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12zM19 15l-1.25 2.75L15 19l2.75 1.25L19 23l1.25-2.75L23 19l-2.75-1.25z"}),"AutoAwesome"),Gf}var bue=xue();const qw=Et(bue);var Yf={},mT;function _ue(){if(mT)return Yf;mT=1;var e=ir();Object.defineProperty(Yf,"__esModule",{value:!0}),Yf.default=void 0;var t=e(sr()),r=or();return Yf.default=(0,t.default)([(0,r.jsx)("path",{d:"M21 8c-1.45 0-2.26 1.44-1.93 2.51l-3.55 3.56c-.3-.09-.74-.09-1.04 0l-2.55-2.55C12.27 10.45 11.46 9 10 9c-1.45 0-2.27 1.44-1.93 2.52l-4.56 4.55C2.44 15.74 1 16.55 1 18c0 1.1.9 2 2 2 1.45 0 2.26-1.44 1.93-2.51l4.55-4.56c.3.09.74.09 1.04 0l2.55 2.55C12.73 16.55 13.54 18 15 18c1.45 0 2.27-1.44 1.93-2.52l3.56-3.55c1.07.33 2.51-.48 2.51-1.93 0-1.1-.9-2-2-2"},"0"),(0,r.jsx)("path",{d:"m15 9 .94-2.07L18 6l-2.06-.93L15 3l-.92 2.07L12 6l2.08.93zM3.5 11 4 9l2-.5L4 8l-.5-2L3 8l-2 .5L3 9z"},"1")],"Insights"),Yf}var wue=_ue();const jue=Et(wue);var Kf={},gT;function Sue(){if(gT)return Kf;gT=1;var e=ir();Object.defineProperty(Kf,"__esModule",{value:!0}),Kf.default=void 0;var t=e(sr()),r=or();return Kf.default=(0,t.default)((0,r.jsx)("path",{d:"M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2m-5 12H9v-2h6zm5-7H4V4l16-.02z"}),"Inventory"),Kf}var Cue=Sue();const Aue=Et(Cue);var Qf={},vT;function Pue(){if(vT)return Qf;vT=1;var e=ir();Object.defineProperty(Qf,"__esModule",{value:!0}),Qf.default=void 0;var t=e(sr()),r=or();return Qf.default=(0,t.default)((0,r.jsx)("path",{d:"M4.25 5.61C6.27 8.2 10 13 10 13v6c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-6s3.72-4.8 5.74-7.39c.51-.66.04-1.61-.79-1.61H5.04c-.83 0-1.3.95-.79 1.61"}),"FilterAlt"),Qf}var Oue=Pue();const kue=Et(Oue),xl={version:"1.0",domain:"truck_trailer_fabrication",description:"Master synonym + normalization dictionary for searching truck/trailer fabrication parts by description and number.",abbreviation_map:{GR:["grade"],GR2:["grade 2"],GR5:["grade 5"],GR8:["grade 8","high tensile"],G2:["grade 2"],G5:["grade 5"],G8:["grade 8"],NC:["national coarse","coarse thread"],NF:["national fine","fine thread"],UNC:["unified national coarse"],UNF:["unified national fine"],UN:["unified thread"],STOVER:["prevailing torque","locknut"],LOCKNUT:["lock nut","torque nut"],CSK:["countersunk"],PL:["plow","plow bolt"],HD:["heavy duty"],HT:["high tensile"],HEX:["hex head","hexagon head"],HHCS:["hex head cap screw"],CAP:["cap screw","cap bolt"],BOLT:["bolt","cap screw"],SCREW:["screw"],ROD:["rod","ready rod","all-thread"],RR:["ready rod","all-thread"],RRD:["ready rod","all-thread"],NUT:["nut"],WASH:["washer"],WASHER:["washer"],STL:["steel"],AL:["aluminum"],ALUM:["aluminum"],SS:["stainless steel"],SS304:["stainless steel 304"],SS316:["stainless steel 316"],GALV:["galvanized"],GALVANIZING:["galvanized coating","zinc rich coating"],ZINC:["zinc plated"],BRZ:["bronze"],BRASS:["brass"],COP:["copper"],HR:["hot rolled"],HRS:["hot rolled steel"],CR:["cold rolled"],HSS:["hollow structural section"],QT:["quenched and tempered"],QT100:["quenched and tempered 100 ksi plate"],A36:["ASTM A36 structural steel"],A53:["ASTM A53 pipe"],A500:["ASTM A500 tube"],CSA:["canadian standards association"],ASTM:["american society for testing and materials"],GA:["gauge"],GAUGE:["gauge"],SCH:["schedule"],OD:["outside diameter"],ID:["inside diameter"],NPT:["national pipe thread tapered"],MPT:["male pipe thread"],FPT:["female pipe thread"],M:["male"],F:["female"],MNPT:["male npt"],FNPT:["female npt"],ELB:["elbow"],ELBOW:["elbow"],TEE:["tee"],CAPS:["caps","end caps"],FLG:["flange"],FLANGE:["flange"],TTMA:["ttma flange pattern"],VALVE:["valve"],CHK:["check"],DC:["dual check","direct current (context dependent)"],CV:["check valve"],STT:["stop turn tail"],"ST/T":["stop tail turn"],"STT/T":["stop tail turn"],"B/U":["back up"],BACKUP:["back up"],BU:["back up"],CLR:["clearance"],MARKER:["marker light"],IDLF:["identification light function"],LED:["led","light emitting diode"],INCAND:["incandescent"],LAMP:["light","lamp"],LIC:["license"],LICENCE:["license"],PLUG:["plug"],PIGTAIL:["pigtail harness"],JBOX:["junction box"],JUNCTION:["junction"],"JUNCTION BOX":["junction box"],CABLE:["cable","wire"],WIRE:["wire"],SYNFLEX:["air brake nylon hose"],AIRLINE:["air line"],AB:["air brake"],ABS:["anti lock brake system"],AXL:["axle"],AXLE:["axle"],SPR:["spring"],EQ:["equalizer"],EQUALIZER:["equalizer"],HUB:["hub"],DRUM:["drum"],SHOE:["brake shoe"],LINED:["lined"],GLAD:["gladhand"],GH:["gladhand"],CAM:["camshaft","s-cam"],SLACK:["slack adjuster"],SUSP:["suspension"],SUSPENSION:["suspension"],JACK:["jack"],DL:["dropleg"],DROPLEG:["dropleg"],LEG:["leg"],COUPLER:["coupler"],EYE:["lunette eye"],LUNETTE:["lunette ring"],ADJ:["adjustable"],ADJUST:["adjustable"],"25K":["25000 lb","25,000 lb"],"20K":["20000 lb","20,000 lb"],TUBE:["tube"],TUBING:["tubing"],PIPE:["pipe"],CH:["channel"],CHANNEL:["channel"],ANG:["angle"],ANGLE:["angle"],PLATE:["plate"],BAR:["bar"],FLAT:["flat bar"],FB:["flat bar"],DECK:["decking"],DECKING:["decking"],FIR:["douglas fir"],"T&G":["tongue and groove"],"S-DRY":["surface dry"],"S DRY":["surface dry"],INV:["invoice"],PO:["purchase order"],ENV:["environmental"],ECO:["environmental"],FEE:["fee"],KIT:["kit"],ASSY:["assembly"],ASSM:["assembly"],ASM:["assembly"],WLD:["welded"],WELD:["weld"],WELDED:["welded"],GLV:["gloves"],GLVS:["gloves"],OZ:["ounce"],LB:["pound"],PK:["pack"],BG:["bag"],EA:["each"],EACH:["each"],FT:["foot","feet"],IN:["inch","inches"],MM:["millimeter","millimetre"],CM:["centimeter","centimetre"],WHEEL:["wheel"],RIM:["rim"],TIRE:["tire"],TYRE:["tire"],RECYCLE:["recycle"],RECYCLING:["recycling"],ECOFEE:["environmental fee","tire levy"]},material_grade_map:{A36:["mild steel","astm a36"],A53:["astm a53 pipe","standard pipe"],A500B:["astm a500 grade b tube"],HSS:["structural tube","hollow structural section"],QT100:["quenched and tempered 100 ksi plate"],"350W":["csa g40.21 350w structural steel"],"44W":["csa g40.21 44w structural steel"],"50W":["csa g40.21 50w structural steel"],"CSA G40.21":["csa g40.21 structural steel specification"],"H.S.S":["hollow structural section"],FIR:["douglas fir lumber"],SPF:["spruce pine fir lumber"]},finish_map:{"HOT DIP GALV":["hot dip galvanized"],GALV:["galvanized"],GALVANIZED:["galvanized"],"ZINC PLATED":["zinc plated"],ZP:["zinc plated"],PRIMED:["shop primed"],PRIMER:["primer coated"],PAINTED:["painted finish"],PLAIN:["no coating","mill finish"],MILL:["mill finish"],"BRIGHT GALVANIZING":["zinc rich galvanizing spray","cold galvanizing"],"SS POLISHED":["polished stainless"]},thread_map:{NC:["coarse","unc"],NF:["fine","unf"],UNC:["coarse","unified coarse"],UNF:["fine","unified fine"],NPT:["tapered pipe thread"],NPS:["straight pipe thread"],MPT:["male npt","male pipe thread"],FPT:["female pipe thread"],NS:["national special thread"],DRYSEAL:["nptf","dryseal pipe thread"]},product_type_keywords:{fasteners:["bolt","cap screw","screw","machine screw","ready rod","all-thread","nut","stover","locknut","jam nut","flange nut","washer","flat washer","lock washer","split lock","rivets","blind rivet","huck","pins","cotter pin","hitch pin","spring pin"],structural_steel:["plate","qt100","qt 100","hss","tube","tubing","pipe","channel","c-channel","c shape","angle","angle iron","flat bar","round bar","square bar","frame rail","rail","decking","t&g","checker plate","floor plate"],lumber:["2x4","2x6","2x8","fir","spf","decking","t&g","tongue and groove","spruce","pine"],trailer_running_gear:["axle","hub","drum","rotor","spindle","bearing","seal","dust cap","spring","leaf spring","equalizer","hanger","shackle","u-bolt","u bolt","torque arm","suspension"],brake_system:["air tank","air brake","hose","air line","synflex","gladhand","slack adjuster","brake shoe","cam","s-cam","valve","relay valve","foot valve","abs","anti lock","chamber","brake kit","anti lock brakes kit"],lighting_electrical:["led","lamp","light","marker","clearance","stop","tail","turn","stt","b/u","backup","license","pigtail","plug","connector","junction box","cable","wire","trailer cable","7-way","7way","4-way","4way","breakaway","battery box","battery"],coupling_jacks:["jack","dropleg","drop leg","sidewind","topwind","jack foot","coupler","ball coupler","lunette","eye coupler","adjustable coupler","pintle","kingpin"],body_components:["fender","fender steps","stake pocket","rub rail","d-ring","tie down","winch","winch track","bumper","step","ladder","toolbox","door latch","hinge","hood catch"],consumables:["grinding wheel","cutting disc","wire wheel","welding rod","mig wire","anti-seize","grease","spray paint","primer","galvanizing spray","shop towels","gloves","zip tie","shrink tube"],fluid_lubricants:["10w30","15w40","gear oil","hydraulic oil","grease","brake cleaner","penetrant","anti-seize","silicone"],documentation_misc:["invoice","po","document holder","registration tube","permit holder","label","tag"]},tire_wheel_keywords:{rim:["wheel rim","steel rim"],"steel rim":["steel wheel","rim steel"],hub_pilot:["hub piloted","piloted wheel"],stud_pilot:["stud piloted"],tire:["tire","tyre"],recycling_fee:["tire recycling","eco fee","environmental fee","tire levy"]},pipe_tube_patterns:{pipe_designation_keywords:["a53","schedule","sch","pipe","nom","nominal"],tube_designation_keywords:["hss","rect tube","square tube","round tube","a500"],common_schedules:["10","20","40","80"],examples:['2" sch 40 pipe',"2in sch40 a53","3 x 2 x 0.250 hss","3x2x1/4 hss"]},dimension_patterns:[{name:"fractional_dia_by_length_inch",description:"Patterns like 3/8X1, 3/8 X 1-1/2, 1/2-13 x 2",regexes:["(?<diameter>\\d+/\\d+|\\d+\\.?\\d*)(?:\\s*[xX-]\\s*)(?<length>\\d+/\\d+|\\d+\\.?\\d*)"],normalized_form:"{diameter} x {length} in"},{name:"nominal_pipe_size_with_schedule",description:'Pipe like 2" SCH 40, 0 2 P 2(nom) X .154 (SCH 40)',regexes:['(?<nominal>\\d+(?:/\\d+)?)\\s*\\"?\\s*(?:NOM|nom)?\\s*(?:X|x)?\\s*(?<wall>\\d*\\.?\\d+)?\\s*\\(?(?:SCH|Sch|schedule)\\s*(?<schedule>10|20|40|80)\\)?'],normalized_form:"{nominal} in pipe SCH {schedule}"},{name:"rectangular_hss",description:"Rectangular hollow section, e.g., 3 X 2 X .250 HSS",regexes:["(?<depth>\\d+\\.?\\d*)\\s*[xX]\\s*(?<width>\\d+\\.?\\d*)\\s*[xX]\\s*(?<thickness>\\d*\\.?\\d+)\\s*(?:HSS|hss)?"],normalized_form:"HSS {depth} x {width} x {thickness}"},{name:"plate_thickness",description:"Plate like 1/4 PL, 3/8 PLATE, .250 PL",regexes:["(?<thickness>\\d+/\\d+|\\d*\\.?\\d+)\\s*(?:PL|plate|PLT)"],normalized_form:"{thickness} in plate"},{name:"ga_thickness",description:"Gauge thickness e.g., 14 GA, 11 GA",regexes:["(?<gauge>\\d+)\\s*(?:GA|ga|gauge)"],normalized_form:"{gauge} gauge"},{name:"lumber_2x",description:"Lumber e.g., 2X6-16, 2x8x12",regexes:["2\\s*[xX]\\s*(?<width>\\d+)\\s*(?:[-xX]\\s*(?<length>\\d+))?"],normalized_form:"2 x {width}{length_ft}",length_ft_suffix:" ft"}],part_number_normalization:{strip_characters:[" ","	",`
`,"\r"],collapse_characters_to_dash:["_","/"],remove_leading_zeros:!0,case:"upper",examples_equivalent:[["01202616A","1202616-A"],["066366630152","66366630152"],["01-117","01117"]]},description_normalization:{to_upper:!0,replace_characters:{"":'"',"":'"',"":"'","":"-","":"x"},collapse_whitespace:!0,remove_punctuation_except:["/","-",'"',"."]},unit_map:{EA:"each",EACH:"each",PC:"each",PCS:"each",FT:"foot",IN:"inch",'"':"inch",MM:"millimeter",CM:"centimeter",M:"meter",PK:"pack",PKG:"package",BG:"bag",SET:"set",LB:"pound",OZ:"ounce",GAL:"gallon",L:"liter"},stopwords:["THE","AND","&","OF","FOR","WITH","W/","IN","ON","OR","TO","BY","EA","EACH","NEW","OLD","ASSY","KIT"],category_inference_rules:[{category:"fasteners",if_description_contains_any:["BOLT","SCREW","NUT","WASHER","RIVET","READY ROD","ALL THREAD","STOVER"]},{category:"structural_steel",if_description_contains_any:["HSS","PLATE","ANGLE","CHANNEL","TUBE","PIPE","FRAME RAIL","QT100","A36","A53","350W","50W"]},{category:"lighting_electrical",if_description_contains_any:["LED","LAMP","LIGHT","MARKER","CLEARANCE","STT","STOP","TAIL","TURN","B/U","BACK UP","JUNCTION BOX","PIGTAIL","CABLE","WIRE"]},{category:"brake_system",if_description_contains_any:["AIR BRAKE","SYNFLEX","GLADHAND","SLACK ADJ","BRAKE SHOE","CAM","ABS","AIR TANK","CHAMBER"]},{category:"trailer_running_gear",if_description_contains_any:["AXLE","HUB","DRUM","SPINDLE","SPRING","EQUALIZER","HANGER","U-BOLT","U BOLT"]},{category:"coupling_jacks",if_description_contains_any:["JACK","DROPLEG","COUPLER","LUNETTE","EYE COUPLER","PINTLE","KINGPIN"]},{category:"tire_wheel",if_description_contains_any:["RIM","WHEEL","TIRE","HUB PILOT","STUD PILOT","STEEL RIM"]},{category:"consumables",if_description_contains_any:["GRINDING WHEEL","CUT OFF","WIRE WHEEL","SPRAY","PAINT","PRIMER","GALVANIZING","GLVS","GLOVES","SHRINK TUBE","ZIP TIE"]}]},Eue=new Set((xl.stopwords||[]).map(e=>e.toUpperCase())),yT=e=>(e||"").split(/[^A-Za-z0-9]+/).map(t=>t.trim()).filter(Boolean).map(t=>t.toUpperCase()),Tue=e=>{const t=new Map,r=(a,o)=>{if(!a||!o||a===o)return;const s=a.toUpperCase(),l=o.toUpperCase();t.has(s)||t.set(s,new Set),t.get(s).add(l)},n=a=>{a&&Object.entries(a).forEach(([o,s])=>{const l=Array.isArray(s)?s:[s],c=new Set;yT(o).forEach(d=>c.add(d)),l.forEach(d=>yT(String(d)).forEach(f=>c.add(f)));const u=Array.from(c);u.forEach(d=>u.forEach(f=>r(d,f)))})};return n(e.abbreviation_map),n(e.material_grade_map),n(e.finish_map),n(e.thread_map),n(e.unit_map),t},Iue=Tue(xl),_S=(e,t=xl)=>{if(!e)return"";let r=String(e);const n=t.description_normalization?.replace_characters||{};Object.entries(n).forEach(([s,l])=>{const c=String(s),u=String(l);r=r.split(c).join(u)});const a=[...t.description_normalization?.remove_punctuation_except??[]],o=new RegExp(`[^A-Za-z0-9\\s${a.map(s=>"\\"+s).join("")}]+`,"g");return r=r.replace(o," "),t.description_normalization?.collapse_whitespace&&(r=r.replace(/\s+/g," ")),t.description_normalization?.to_upper&&(r=r.toUpperCase()),r.trim()},eR=(e,t=xl)=>{if(!e)return"";let r=String(e);return[...t.part_number_normalization?.strip_characters??[]].forEach(o=>{const s=new RegExp(o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g");r=r.replace(s,"")}),[...t.part_number_normalization?.collapse_characters_to_dash??[]].forEach(o=>{const s=new RegExp(o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g");r=r.replace(s,"-")}),t.part_number_normalization?.remove_leading_zeros&&(r=r.replace(/(^|[^0-9])0+([0-9]+)/g,"$1$2"),r=r.replace(/^0+/,"")),t.part_number_normalization?.case==="upper"&&(r=r.toUpperCase()),r.trim()},Nue=e=>(e.dimension_patterns||[]).map(t=>({...t,regexes:t.regexes.map(r=>new RegExp(r,"gi"))})),Due=Nue(xl),Mue=(e,t)=>{let r=e.normalized_form||"";return r=r.replace(/\{(\w+)\}/g,(n,a)=>t[a]||""),e.length_ft_suffix&&t.length?r=r.replace("{length_ft}",`${t.length}${e.length_ft_suffix}`):r=r.replace("{length_ft}",t.length||""),r.replace(/\s+/g," ").trim().toUpperCase()},tR=e=>{const t=new Set;if(!e)return t;for(const r of Due)for(const n of r.regexes){let a;for(;(a=n.exec(e))!==null;){const o=a.groups||{},s=Mue(r,o);s&&t.add(s)}n.lastIndex=0}return t},rR=e=>_S(e).split(/[^A-Z0-9]+/).map(r=>r.trim()).filter(r=>r.length>0&&!Eue.has(r)),nR=e=>{const t=new Set;for(const r of e){const n=r.toUpperCase();t.add(n);const a=Iue.get(n);a&&a.forEach(o=>t.add(o))}return t},xT=(e,t)=>{const r=new Set;return e.forEach(n=>{t.has(n)&&r.add(n)}),r},Lue=(e,t=xl)=>{if(!e)return;const r=e.toUpperCase();for(const n of t.category_inference_rules||[])if(n.if_description_contains_any?.some(a=>r.includes(a)))return n.category},Rue=(e,t=xl)=>e.map(r=>{const n=`${r.part_number||""} ${r.part_description||""}`,a=nR(rR(n)),o=tR(n),s=eR(r.part_number||"",t),l=_S(r.part_description||"",t),c=r.category||Lue(l,t);return{item:r,tokenSet:a,dimensionSet:o,normalizedPartNumber:s,normalizedDescription:l,categoryHint:c}}),Fw=e=>{const t=_S(e),r=eR(e),n=rR(e),a=nR(n),o=tR(e);return{normalized:t,normalizedPartNumber:r,tokens:n,expandedTokens:Array.from(a),dimensions:Array.from(o)}},que=(e,t)=>{const r=t.trim();if(!r)return[];const{normalized:n,normalizedPartNumber:a,expandedTokens:o,dimensions:s}=Fw(r),l=new Set(o),c=new Set(s),u=[];for(const d of e){const f=xT(d.tokenSet,l),h=xT(d.dimensionSet,c),p=a.length>0&&d.normalizedPartNumber.includes(a),v=n.length>2&&d.normalizedDescription.includes(n);let m=0;if(m+=f.size*2,m+=h.size*3,p&&(m+=5),v&&(m+=2),m>0){const y=d.categoryHint&&(l.has(d.categoryHint.toUpperCase())||n.includes(d.categoryHint.toUpperCase()))?d.categoryHint:void 0;u.push({item:d.item,score:m,matchedTokens:Array.from(f),matchedDimensions:Array.from(h),matchedCategory:y,partNumberMatched:p,descriptionMatched:v})}}return u.sort((d,f)=>f.score-d.score||String(d.item.part_number||"").localeCompare(String(f.item.part_number||"")))},Fue=()=>{const[e,t]=x.useState(""),[r,n]=x.useState("all"),[a,o]=x.useState([]),[s,l]=x.useState(!1),[c,u]=x.useState(null),[d,f]=x.useState([]),[h,p]=x.useState(()=>Fw("")),v=x.useMemo(()=>Rue(a),[a]),m=x.useCallback(async()=>{l(!0),u(null);try{const _=await Py(r==="all"?void 0:r);o(_||[])}catch(_){console.error("Failed to load inventory for smart search",_);const w=_?.response?.data?.message||_?.message||"Could not load inventory. Check your connection and try again.";u(w)}finally{l(!1)}},[r]);x.useEffect(()=>{m()},[m]),x.useEffect(()=>{const _=()=>m();return window.addEventListener("inventory-updated",_),()=>window.removeEventListener("inventory-updated",_)},[m]),x.useEffect(()=>{const _=setTimeout(()=>{p(Fw(e)),f(que(v,e))},180);return()=>clearTimeout(_)},[e,v]);const y=(_,w,A)=>i.jsxs(ut,{direction:"row",spacing:1,flexWrap:"wrap",alignItems:"center",children:[i.jsx(B,{variant:"caption",color:"text.secondary",sx:{minWidth:120,fontWeight:600},children:_}),w.length===0&&A?i.jsx(B,{variant:"caption",color:"text.disabled",children:A}):w.slice(0,24).map(P=>i.jsx(ot,{label:P,size:"small"},`${_}-${P}`))]}),b=x.useMemo(()=>{const _=new Set(h.expandedTokens);return h.tokens.forEach(w=>_.delete(w)),Array.from(_)},[h]);return i.jsxs(Z,{children:[i.jsx(bt,{elevation:0,sx:{p:3,mb:3,borderRadius:3,background:"linear-gradient(120deg, #0f172a, #0b5dab)",color:"white"},children:i.jsxs(ut,{direction:{xs:"column",md:"row"},spacing:2,alignItems:"flex-start",justifyContent:"space-between",children:[i.jsxs(Z,{children:[i.jsxs(ut,{direction:"row",spacing:1,alignItems:"center",mb:1,children:[i.jsx(qw,{fontSize:"small"}),i.jsxs(B,{variant:"body2",sx:{letterSpacing:.5},children:["Dictionary-driven search  v",xl.version]})]}),i.jsx(B,{variant:"h4",fontWeight:800,children:"Smart Inventory Search"}),i.jsx(B,{variant:"body1",sx:{opacity:.8,maxWidth:720,mt:1},children:"Find parts using abbreviations, grades, finishes, or full descriptions. The search engine expands synonyms, grades, and dimensions from the truck/trailer fabrication dictionary before matching against your inventory."})]}),i.jsxs(ut,{spacing:1.5,alignItems:{xs:"flex-start",md:"flex-end"},children:[i.jsx(ot,{icon:i.jsx(Aue,{}),label:`${a.length} parts indexed`,variant:"filled",color:"default",sx:{bgcolor:"rgba(255,255,255,0.12)",color:"white"}}),i.jsx(ot,{icon:i.jsx(jue,{}),label:`Domain: ${xl.domain}`,variant:"outlined",sx:{borderColor:"rgba(255,255,255,0.4)",color:"white"}})]})]})}),i.jsx(bt,{elevation:1,sx:{p:2.5,mb:2.5,borderRadius:3},children:i.jsxs(ut,{spacing:2,children:[i.jsxs(ut,{direction:{xs:"column",md:"row"},spacing:2,alignItems:{xs:"stretch",md:"center"},children:[i.jsx(Z,{sx:{flex:1,position:"relative"},children:i.jsx(Pe,{fullWidth:!0,value:e,onChange:_=>t(_.target.value),placeholder:'Try "gr8 hex bolt 3/8 x 1 galvanized" or "2in sch40 pipe"',InputProps:{startAdornment:i.jsx(di,{sx:{mr:1,color:"text.secondary"}})}})}),i.jsxs(ut,{direction:"row",alignItems:"center",spacing:1,children:[i.jsx(kue,{color:"action"}),i.jsxs(q2,{value:r,exclusive:!0,onChange:(_,w)=>w&&n(w),size:"small",color:"primary",children:[i.jsx(al,{value:"all",children:"All"}),i.jsx(al,{value:"stock",children:"Stock"}),i.jsx(al,{value:"supply",children:"Supply"}),i.jsx(al,{value:"service",children:"Service"})]})]})]}),i.jsx(Vn,{}),i.jsxs(ut,{spacing:1,children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",fontWeight:700,children:"How your query is interpreted"}),y("Normalized",h.normalized?[h.normalized]:[],"No query yet"),y("Part # form",h.normalizedPartNumber?[h.normalizedPartNumber]:[],"Waiting for part # text"),y("Tokens",h.tokens,"No tokens extracted"),y("Synonyms added",b,"No synonym expansions yet"),y("Dimensions",h.dimensions,"No dimensional pattern found")]})]})}),c&&i.jsx(Pt,{severity:"error",sx:{mb:2},children:c}),s&&i.jsx(Td,{sx:{mb:2}}),i.jsx(bt,{elevation:0,sx:{p:2,borderRadius:3,border:"1px solid #e5e7eb",mb:1},children:i.jsxs(ut,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:{xs:"flex-start",sm:"center"},justifyContent:"space-between",children:[i.jsxs(B,{variant:"h6",fontWeight:800,children:["Results ",d.length>0?` ${d.length} matches`:""]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Matching uses abbreviations, finishes, grades, thread types, units, and dimensional patterns from the dictionary."})]})}),d.length===0&&!s?i.jsx(bt,{variant:"outlined",sx:{p:3,borderRadius:3},children:i.jsxs(ut,{direction:"row",spacing:1,alignItems:"center",children:[i.jsx(di,{color:"action"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:'Start typing to see smart matches. Use abbreviations like "GR8", "UNC", "SCH40", or material names like "A36", "HSS".'})]})}):i.jsx(ie,{container:!0,spacing:2,children:d.map(_=>i.jsx(ie,{item:!0,xs:12,md:6,lg:4,children:i.jsxs(bt,{elevation:1,sx:{p:2,height:"100%",borderRadius:3,border:"1px solid #e5e7eb",display:"flex",flexDirection:"column",gap:1},children:[i.jsxs(ut,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:1,children:[i.jsx(B,{variant:"h6",fontWeight:800,sx:{wordBreak:"break-all"},children:_.item.part_number}),i.jsx(ot,{label:`Score ${_.score}`,size:"small",color:"primary"})]}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{minHeight:48},children:_.item.part_description||"No description"}),i.jsxs(ut,{direction:"row",spacing:1,flexWrap:"wrap",children:[_.item.category&&i.jsx(ot,{label:_.item.category,size:"small"}),_.item.part_type&&i.jsx(ot,{label:_.item.part_type,size:"small",variant:"outlined"}),typeof _.item.quantity_on_hand=="number"&&i.jsx(ot,{label:`On hand: ${_.item.quantity_on_hand} ${_.item.unit||""}`.trim(),size:"small",variant:"outlined"}),typeof _.item.last_unit_cost=="number"&&i.jsx(ot,{label:`Last cost: ${_.item.last_unit_cost}`,size:"small",variant:"outlined"})]}),i.jsx(Vn,{}),i.jsxs(ut,{spacing:.5,children:[i.jsx(B,{variant:"caption",color:"text.secondary",fontWeight:700,children:"Match reasons"}),i.jsxs(ut,{direction:"row",spacing:1,flexWrap:"wrap",children:[_.partNumberMatched&&i.jsx(ot,{label:"Part #",size:"small",color:"success",variant:"outlined"}),_.descriptionMatched&&i.jsx(ot,{label:"Description",size:"small",color:"success",variant:"outlined"}),_.matchedTokens.slice(0,6).map(w=>i.jsx(ot,{label:w,size:"small"},`${_.item.part_number}-tok-${w}`)),_.matchedDimensions.slice(0,4).map(w=>i.jsx(ot,{label:w,size:"small",variant:"outlined"},`${_.item.part_number}-dim-${w}`)),_.matchedCategory&&i.jsx(ot,{label:`Category: ${_.matchedCategory}`,size:"small",color:"secondary",variant:"outlined"})]})]})]})},_.item.part_number))}),s&&d.length>0&&i.jsx(Z,{display:"flex",justifyContent:"center",mt:2,children:i.jsx(er,{size:24})})]})},$ue=async()=>(await ve.get("/api/employees")).data,bT=["Admin","Sales and Purchase","Time Tracking","Mobile Time Tracker"],Bue=()=>{const[e,t]=x.useState(""),[r,n]=x.useState(""),[a,o]=x.useState(""),[s,l]=x.useState(""),[c,u]=x.useState("Employee"),[d,f]=x.useState(null),[h,p]=x.useState(null),[v,m]=x.useState([]),[y,b]=x.useState(!0);kn();const[_,w]=x.useState(null),[A,P]=x.useState(""),[E,T]=x.useState(""),[S,I]=x.useState(""),[U,O]=x.useState(!1);x.useEffect(()=>{M()},[]);const M=async()=>{b(!0);try{const R=await $ue();m(R)}catch{f("Failed to fetch employees.")}finally{b(!1)}},L=async R=>{if(R.preventDefault(),f(null),p(null),a!==s){f("Passwords do not match");return}try{const k=await ve.post("/api/employees",{username:e,email:r,password:a,access_role:c});p(k.data.message),t(""),n(""),o(""),l(""),u("Employee"),M()}catch(k){k instanceof ci?f(k.response?.data?.message||"Employee registration failed"):f("An unexpected error occurred")}},q=async R=>{if(window.confirm("Are you sure you want to delete this employee?"))try{await ve.delete(`/api/employees/${R}`),p("Employee deleted successfully"),M()}catch(k){console.error("Error deleting employee:",k),k instanceof ci?f(k.response?.data?.message||"Failed to delete employee"):f("An unexpected error occurred")}},z=R=>{w(R),P(R.username),T(R.access_role),I(""),O(!0)},K=()=>{O(!1),w(null),f(null),p(null)},J=async()=>{if(_){f(null),p(null);try{const R={username:A,access_role:E};S&&(R.password=S);const k=await ve.put(`/api/employees/${_.id}`,R);p(k.data.message||"Employee updated successfully"),M(),K()}catch(R){console.error("Error updating employee:",R),R instanceof ci?f(R.response?.data?.message||"Failed to update employee"):f("An unexpected error occurred")}}};return y?i.jsxs(rr,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(er,{}),i.jsx(B,{children:"Loading employees..."})]}):i.jsxs(rr,{component:"main",maxWidth:"md",children:[i.jsxs(Z,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[i.jsxs(bt,{elevation:6,sx:{p:4,width:"100%",borderRadius:2,mb:4},children:[i.jsx(B,{component:"h1",variant:"h5",sx:{mb:3,textAlign:"center"},children:"Register New Employee"}),i.jsxs(Z,{component:"form",onSubmit:L,noValidate:!0,sx:{mt:1},children:[i.jsx(Pe,{margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Username",name:"username",autoComplete:"new-username",value:e,onChange:R=>t(R.target.value)}),i.jsx(Pe,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"new-email",value:r,onChange:R=>n(R.target.value)}),i.jsx(Pe,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Initial Password",type:"password",id:"password",autoComplete:"new-password",value:a,onChange:R=>o(R.target.value)}),i.jsx(Pe,{margin:"normal",required:!0,fullWidth:!0,name:"confirmPassword",label:"Confirm Initial Password",type:"password",id:"confirmPassword",autoComplete:"new-password",value:s,onChange:R=>l(R.target.value)}),i.jsxs(tn,{fullWidth:!0,margin:"normal",children:[i.jsx(sn,{id:"access-role-label",children:"Access Role"}),i.jsx(ln,{labelId:"access-role-label",id:"access-role",value:c,label:"Access Role",onChange:R=>u(R.target.value),children:bT.map(R=>i.jsx(Jt,{value:R,children:R},R))})]}),i.jsx(xe,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},children:"Register Employee"}),d&&i.jsx(Pt,{severity:"error",sx:{mt:2},children:d}),h&&i.jsx(Pt,{severity:"success",sx:{mt:2},children:h})]})]}),i.jsxs(bt,{elevation:6,sx:{p:4,width:"100%",borderRadius:2},children:[i.jsx(B,{component:"h2",variant:"h5",sx:{mb:3,textAlign:"center"},children:"Existing Employees"}),i.jsx(pa,{children:v.map(R=>i.jsx(Sa,{secondaryAction:i.jsxs(Z,{children:[i.jsx(vr,{edge:"end","aria-label":"edit",onClick:()=>z(R),sx:{mr:1},children:i.jsx(tu,{})}),i.jsx(vr,{edge:"end","aria-label":"delete",onClick:()=>q(R.id),children:i.jsx(ga,{})})]}),children:i.jsx(Qn,{primary:R.username,secondary:`Email: ${R.email} | Role: ${R.role} | Access: ${R.access_role}`})},R.id))})]})]}),i.jsxs(dr,{open:U,onClose:K,children:[i.jsx(fr,{children:"Edit Employee Roles"}),i.jsxs(hr,{children:[_&&i.jsxs(Z,{component:"form",noValidate:!0,sx:{mt:1},children:[i.jsx(Pe,{margin:"normal",fullWidth:!0,id:"edit-username",label:"Username",value:A,onChange:R=>P(R.target.value),variant:"standard"}),i.jsx(Pe,{margin:"normal",fullWidth:!0,id:"edit-email",label:"Email",value:_.email,InputProps:{readOnly:!0,disableUnderline:!0},variant:"standard"}),i.jsx(Pe,{margin:"normal",fullWidth:!0,id:"edit-password",label:"New Password (leave blank to keep current)",type:"password",value:S,onChange:R=>I(R.target.value),variant:"standard"}),i.jsxs(tn,{fullWidth:!0,margin:"normal",children:[i.jsx(sn,{id:"edit-access-role-label",children:"Access Role"}),i.jsx(ln,{labelId:"edit-access-role-label",id:"edit-access-role",value:E,label:"Access Role",onChange:R=>T(R.target.value),children:bT.map(R=>i.jsx(Jt,{value:R,children:R},R))})]})]}),d&&i.jsx(Pt,{severity:"error",sx:{mt:2},children:d}),h&&i.jsx(Pt,{severity:"success",sx:{mt:2},children:h})]}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:K,children:"Cancel"}),i.jsx(xe,{onClick:J,variant:"contained",color:"primary",children:"Save Changes"})]})]})]})},Uue=()=>{const[e,t]=x.useState([]),[r,n]=x.useState(""),[a,o]=x.useState([]),[s,l]=x.useState(!1),[c,u]=x.useState(!1),[d,f]=x.useState(null),[h,p]=x.useState(""),[v,m]=x.useState(!1),[y,b]=x.useState(!1),[_,w]=x.useState(null),[A,P]=x.useState([]),[E,T]=x.useState([]),[S,I]=x.useState("admin");x.useEffect(()=>{U()},[]),x.useEffect(()=>{S==="admin"?M():r?O(r):o([])},[r,S]);const U=async()=>{try{const k=await ve.get("/api/profile-documents/profiles");t(k.data)}catch(k){console.error("Error fetching profiles:",k),me.error("Failed to fetch profiles")}},O=async k=>{l(!0);try{const $=await ve.get(`/api/profile-documents/profile/${k}`);o($.data)}catch($){console.error("Error fetching documents:",$),me.error("Failed to fetch documents")}finally{l(!1)}},M=async()=>{l(!0);try{const $=(await ve.get("/api/profile-documents/all")).data.reduce((C,N)=>{const H=N.id;return C[H]||(C[H]={id:N.id,filename:N.filename,original_filename:N.original_filename,file_size:N.file_size,mime_type:N.mime_type,uploaded_by:N.uploaded_by,uploaded_by_name:N.uploaded_by_name,created_at:N.created_at,visible_to_profiles:[],profile_read_status:{},profile_details:[]}),C[H].visible_to_profiles.push(N.profile_id),C[H].profile_read_status[N.profile_id]=N.has_read,C[H].profile_details.push({profile_id:N.profile_id,profile_name:N.profile_name,has_read:N.has_read,read_at:N.read_at}),C},{}),X=Object.values($);console.log("Grouped documents:",X),o(X)}catch(k){console.error("Error fetching all documents:",k),me.error("Failed to fetch documents")}finally{l(!1)}},L=k=>{const $=k.target.files?.[0];$&&(f($),h||p($.name))},q=async()=>{if(!d||E.length===0){me.error("Please select a file and at least one profile");return}m(!0);try{const k=new FormData;k.append("document",d),k.append("customName",h),k.append("visibleToProfiles",JSON.stringify(E)),(await ve.post("/api/profile-documents/upload",k,{headers:{"Content-Type":"multipart/form-data"}})).data.success&&(me.success("Document uploaded successfully"),u(!1),f(null),p(""),T([]),S==="admin"?M():r&&O(r))}catch(k){console.error("Error uploading document:",k),me.error(k.response?.data?.error||"Failed to upload document")}finally{m(!1)}},z=async k=>{if(window.confirm("Are you sure you want to delete this document?"))try{await ve.delete(`/api/profile-documents/${k}`),me.success("Document deleted successfully"),S==="admin"?M():r&&O(r)}catch($){console.error("Error deleting document:",$),me.error("Failed to delete document")}},K=async k=>{w(k),b(!0);try{const $=await ve.get(`/api/profile-documents/${k.id}/stats`);P($.data)}catch($){console.error("Error fetching document stats:",$),me.error("Failed to fetch document statistics")}},J=k=>{if(k===0)return"0 Bytes";const $=1024,X=["Bytes","KB","MB","GB"],C=Math.floor(Math.log(k)/Math.log($));return parseFloat((k/Math.pow($,C)).toFixed(2))+" "+X[C]},R=k=>new Date(k).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return i.jsxs(Z,{p:3,children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsx(B,{variant:"h4",component:"h1",children:"Profile Documents Management"}),i.jsxs(Z,{display:"flex",gap:2,alignItems:"center",children:[i.jsxs(tn,{size:"small",sx:{minWidth:120},children:[i.jsx(sn,{children:"View Mode"}),i.jsxs(ln,{value:S,onChange:k=>I(k.target.value),label:"View Mode",children:[i.jsx(Jt,{value:"admin",children:"Admin View"}),i.jsx(Jt,{value:"profile",children:"Profile View"})]})]}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Tv,{}),onClick:()=>u(!0),disabled:S==="profile"&&!r,children:"Upload Document"})]})]}),i.jsxs(ie,{container:!0,spacing:3,children:[S==="profile"&&i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(Rr,{children:i.jsxs(Hr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Select Profile"}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Profile"}),i.jsx(ln,{value:r,onChange:k=>n(k.target.value),label:"Profile",children:e.map(k=>i.jsx(Jt,{value:k.id,children:k.name},k.id))})]}),r&&i.jsx(Z,{mt:2,children:i.jsx(B,{variant:"body2",color:"text.secondary",children:e.find(k=>k.id===r)?.email})})]})})}),i.jsx(ie,{item:!0,xs:12,md:S==="profile"?8:12,children:i.jsx(Rr,{children:i.jsxs(Hr,{children:[i.jsxs(B,{variant:"h6",gutterBottom:!0,children:["Documents",i.jsx(ot,{label:`${a.length} documents`,size:"small",sx:{ml:2}})]}),S==="profile"&&!r?i.jsx(Pt,{severity:"info",children:"Please select a profile to view documents."}):s?i.jsx(Z,{display:"flex",justifyContent:"center",p:3,children:i.jsx(er,{})}):a.length===0?i.jsx(Pt,{severity:"info",children:S==="admin"?"No documents found.":"No documents found for this profile."}):i.jsx(ma,{children:i.jsxs(ia,{size:"small",children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{children:"Document Name"}),i.jsx(Oe,{align:"center",children:"Size"}),i.jsx(Oe,{align:"center",children:"Type"}),S==="admin"?i.jsxs(i.Fragment,{children:[i.jsx(Oe,{align:"center",children:"Visible To"}),i.jsx(Oe,{align:"center",children:"Read Status"})]}):i.jsx(Oe,{align:"center",children:"Read Status"}),i.jsx(Oe,{align:"center",children:"Uploaded"}),i.jsx(Oe,{align:"center",children:"Actions"})]})}),i.jsx(sa,{children:a.map(k=>i.jsxs(mr,{children:[i.jsxs(Oe,{children:[i.jsx(B,{variant:"body2",fontWeight:"medium",children:k.original_filename}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:["by ",k.uploaded_by_name]})]}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"body2",children:J(k.file_size)})}),i.jsx(Oe,{align:"center",children:i.jsx(ot,{label:k.mime_type.split("/")[1]?.toUpperCase()||"FILE",size:"small",variant:"outlined"})}),S==="admin"?i.jsxs(i.Fragment,{children:[i.jsx(Oe,{align:"center",children:i.jsx(Z,{display:"flex",flexWrap:"wrap",gap:.5,justifyContent:"center",children:k.profile_details&&k.profile_details.length>0?k.profile_details.map($=>i.jsx(ot,{label:$.profile_name,size:"small",variant:"outlined",color:"primary"},$.profile_id)):k.visible_to_profiles?.map($=>{const X=e.find(C=>C.id===$);return X?i.jsx(ot,{label:X.name,size:"small",variant:"outlined",color:"primary"},$):null})})}),i.jsx(Oe,{align:"center",children:i.jsx(Z,{display:"flex",flexWrap:"wrap",gap:.5,justifyContent:"center",children:k.profile_details&&k.profile_details.length>0?k.profile_details.map($=>i.jsx(ot,{label:$.has_read?"Read":"Unread",size:"small",color:$.has_read?"success":"default",icon:$.has_read?i.jsx(jh,{}):i.jsx(Tu,{}),title:`${$.profile_name}: ${$.has_read?"Read":"Unread"}`},$.profile_id)):k.visible_to_profiles?.map($=>{const X=e.find(N=>N.id===$),C=k.profile_read_status?.[$]||!1;return X?i.jsx(ot,{label:C?"Read":"Unread",size:"small",color:C?"success":"default",icon:C?i.jsx(jh,{}):i.jsx(Tu,{}),title:`${X.name}: ${C?"Read":"Unread"}`},$):null})})})]}):i.jsx(Oe,{align:"center",children:i.jsx(ot,{label:k.profile_read_status?.[r]?"Read":"Unread",size:"small",color:k.profile_read_status?.[r]?"success":"default",icon:k.profile_read_status?.[r]?i.jsx(jh,{}):i.jsx(Tu,{})})}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"body2",children:R(k.created_at)})}),i.jsxs(Oe,{align:"center",children:[i.jsx(vr,{size:"small",onClick:()=>K(k),title:"View Statistics",children:i.jsx(wI,{})}),i.jsx(vr,{size:"small",component:"a",href:`/api/profile-documents/file/${k.id}`,target:"_blank",title:"Download",children:i.jsx(CI,{})}),i.jsx(vr,{size:"small",onClick:()=>z(k.id),title:"Delete",color:"error",children:i.jsx(Id,{})})]})]},k.id))})]})})]})})})]}),i.jsxs(dr,{open:c,onClose:()=>u(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(fr,{children:"Upload Document"}),i.jsx(hr,{children:i.jsxs(Z,{sx:{pt:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Select Profiles"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Choose which profiles can see this document"}),i.jsx(Ep,{children:e.map(k=>i.jsx(ui,{control:i.jsx(Xi,{checked:E.includes(k.id),onChange:$=>{$.target.checked?T([...E,k.id]):T(E.filter(X=>X!==k.id))}}),label:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",children:k.name}),i.jsx(B,{variant:"caption",color:"text.secondary",children:k.email})]})},k.id))}),i.jsx(Pe,{fullWidth:!0,label:"Custom Document Name",value:h,onChange:k=>p(k.target.value),sx:{mb:2,mt:2},helperText:"Leave empty to use original filename"}),i.jsxs(Z,{sx:{mb:2},children:[i.jsx("input",{type:"file",id:"file-upload",onChange:L,style:{display:"none"},accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.gif"}),i.jsx("label",{htmlFor:"file-upload",children:i.jsx(xe,{variant:"outlined",component:"span",startIcon:i.jsx(dg,{}),fullWidth:!0,children:d?d.name:"Select File"})})]}),d&&i.jsxs(Pt,{severity:"info",children:["Selected: ",d.name," (",J(d.size),")"]})]})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:()=>u(!1),disabled:v,children:"Cancel"}),i.jsx(xe,{onClick:q,variant:"contained",disabled:!d||E.length===0||v,startIcon:v?i.jsx(er,{size:20}):i.jsx(dg,{}),children:v?"Uploading...":"Upload"})]})]}),i.jsxs(dr,{open:y,onClose:()=>b(!1),maxWidth:"md",fullWidth:!0,children:[i.jsxs(fr,{children:["Document Statistics: ",_?.original_filename]}),i.jsx(hr,{children:i.jsxs(Z,{sx:{pt:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Profile Read Status"}),i.jsx(B,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"View which profiles can see this document and their read status:"}),_&&i.jsx(ma,{sx:{mt:2},children:i.jsxs(ia,{size:"small",children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{children:"Profile"}),i.jsx(Oe,{children:"Email"}),i.jsx(Oe,{align:"center",children:"Read Status"}),i.jsx(Oe,{align:"center",children:"Read At"})]})}),i.jsx(sa,{children:_.visible_to_profiles?.map(k=>{const $=e.find(N=>N.id===k),X=_.profile_read_status?.[k]||!1,C=A.find(N=>N.profile_id===k);return $?i.jsxs(mr,{children:[i.jsx(Oe,{children:i.jsx(B,{variant:"body2",fontWeight:"medium",children:$.name})}),i.jsx(Oe,{children:i.jsx(B,{variant:"body2",color:"text.secondary",children:$.email})}),i.jsx(Oe,{align:"center",children:i.jsx(ot,{label:X?"Read":"Unread",size:"small",color:X?"success":"default",icon:X?i.jsx(jh,{}):i.jsx(Tu,{})})}),i.jsx(Oe,{align:"center",children:C?i.jsx(B,{variant:"body2",children:R(C.read_at)}):i.jsx(B,{variant:"body2",color:"text.secondary",children:"-"})})]},k):null})})]})})]})}),i.jsx(_r,{children:i.jsx(xe,{onClick:()=>b(!1),children:"Close"})})]})]})},zue=()=>{const[e,t]=x.useState([]),[r,n]=x.useState(!0),[a,o]=x.useState(!1),[s,l]=x.useState(!1),[c,u]=x.useState({margin_id:"",cost_lower_bound:"",cost_upper_bound:"",margin_factor:""}),[d,f]=x.useState(null),[h,p]=x.useState({page:0,pageSize:5}),[v,m]=x.useState(""),[y,b]=x.useState(!1),[_,w]=x.useState(""),[A,P]=x.useState(!1),[E,T]=x.useState(""),[S,I]=x.useState(!1),[U,O]=x.useState(""),[M,L]=x.useState(!1),[q,z]=x.useState(""),[K,J]=x.useState(!1),R=async()=>{try{const V=await ve.get("/api/margin-schedule");t(V.data.map(Ve=>({...Ve,id:Ve.margin_id}))),n(!1),f(null)}catch(V){console.error("Error fetching margin schedules:",V),f("Failed to load margin schedules"),me.error("Failed to load margin schedules"),n(!1)}},k=async()=>{b(!0);try{const V=await ve.get("/api/settings/labour-rate");m(V.data.labour_rate??"")}catch{m("")}finally{b(!1)}},$=async()=>{P(!0);try{const V=await ve.get("/api/settings/overhead-rate");w(V.data.overhead_rate??"")}catch{w("")}finally{P(!1)}},X=async()=>{I(!0);try{const V=await ve.get("/api/settings/supply-rate");T(V.data.supply_rate??"")}catch{T("")}finally{I(!1)}},C=async()=>{L(!0);try{const V=await ve.get("/api/settings/daily-break-start");O(V.data.daily_break_start??"")}catch{O("")}finally{L(!1)}},N=async()=>{J(!0);try{const V=await ve.get("/api/settings/daily-break-end");z(V.data.daily_break_end??"")}catch{z("")}finally{J(!1)}};x.useEffect(()=>{R(),k(),$(),X(),C(),N()},[]);const H=()=>{l(!1),u({margin_id:"",cost_lower_bound:"",cost_upper_bound:"",margin_factor:""}),o(!0)},W=V=>{l(!0),u({margin_id:V.margin_id,cost_lower_bound:String(V.cost_lower_bound),cost_upper_bound:String(V.cost_upper_bound),margin_factor:String(V.margin_factor)}),o(!0)},ne=async V=>{if(window.confirm("Are you sure you want to delete this margin schedule?"))try{await ve.delete(`/api/margin-schedule/${V}`),me.success("Margin schedule deleted successfully"),R()}catch(Ve){console.error("Error deleting margin schedule:",Ve),me.error("Failed to delete margin schedule")}},se=()=>{o(!1)},oe=V=>{const{name:Ve,value:Me}=V.target;u(Fe=>({...Fe,[Ve]:Me}))},ae=async V=>{V.preventDefault();try{s?(await ve.put(`/api/margin-schedule/${c.margin_id}`,{cost_lower_bound:parseFloat(c.cost_lower_bound),cost_upper_bound:parseFloat(c.cost_upper_bound),margin_factor:parseFloat(c.margin_factor)}),me.success("Margin schedule updated successfully")):(await ve.post("/api/margin-schedule",{schedule:[{cost_lower_bound:parseFloat(c.cost_lower_bound),cost_upper_bound:parseFloat(c.cost_upper_bound),margin_factor:parseFloat(c.margin_factor)}]}),me.success("Margin schedule created successfully")),se(),R()}catch(Ve){console.error("Error saving margin schedule:",Ve),me.error("Failed to save margin schedule")}},pe=async()=>{b(!0);try{await ve.put("/api/settings/labour-rate",{labour_rate:Number(v)}),k()}catch{}finally{b(!1)}},ge=async()=>{P(!0);try{await ve.put("/api/settings/overhead-rate",{overhead_rate:Number(_)}),$()}catch{}finally{P(!1)}},Q=async()=>{I(!0);try{await ve.put("/api/settings/supply-rate",{supply_rate:Number(E)}),X(),me.success("Supply rate updated successfully")}catch{me.error("Failed to update supply rate")}finally{I(!1)}},G=async()=>{L(!0);try{await ve.put("/api/settings/daily-break-start",{daily_break_start:U}),C(),me.success("Daily break start time updated successfully")}catch{me.error("Failed to update daily break start time")}finally{L(!1)}},ee=async()=>{J(!0);try{await ve.put("/api/settings/daily-break-end",{daily_break_end:q}),N(),me.success("Daily break end time updated successfully")}catch{me.error("Failed to update daily break end time")}finally{J(!1)}},le=[{field:"margin_id",headerName:"ID",flex:.5,minWidth:60,headerAlign:"center",align:"center"},{field:"cost_lower_bound",headerName:"Cost Lower Bound",flex:1,minWidth:120,type:"number",headerAlign:"center",align:"center"},{field:"cost_upper_bound",headerName:"Cost Upper Bound",flex:1,minWidth:120,type:"number",headerAlign:"center",align:"center"},{field:"margin_factor",headerName:"Margin Factor",flex:1,minWidth:120,type:"number",headerAlign:"center",align:"center"},{field:"actions",headerName:"Actions",width:80,sortable:!1,headerAlign:"center",align:"center",renderCell:V=>i.jsx(vr,{size:"small",color:"error",onClick:Ve=>{Ve.stopPropagation(),ne(V.row.margin_id)},children:i.jsx(ga,{})})}];return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Global Variables"}),i.jsxs(ut,{direction:"row",spacing:2,children:[i.jsx(xe,{variant:"contained",onClick:H,startIcon:i.jsx(Va,{}),children:"New Entry"}),i.jsx(xe,{variant:"contained",onClick:R,children:"Refresh"})]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsx(Z,{sx:{p:2},children:i.jsx(Po,{rows:e,columns:le,getRowId:V=>V.id,paginationModel:h,onPaginationModelChange:V=>p(V),pageSizeOptions:[5,10,20],loading:r,disableRowSelectionOnClick:!0,onRowClick:V=>W(V.row),sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"},cursor:"pointer"}})})}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3,p:2},children:i.jsxs(Z,{sx:{display:"flex",gap:4,alignItems:"flex-start"},children:[i.jsxs(Z,{sx:{flex:1},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Labour Hourly Rate"}),i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(Pe,{label:"Hourly Rate ($)",type:"number",value:v,onChange:V=>m(V.target.value===""?"":Number(V.target.value)),disabled:y,InputProps:{startAdornment:i.jsx(aa,{position:"start",children:"$"})},sx:{maxWidth:200}}),i.jsx(xe,{variant:"contained",onClick:pe,disabled:y||v==="",children:"Save"})]})]}),i.jsxs(Z,{sx:{flex:1},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Overhead Hourly Rate"}),i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(Pe,{label:"Hourly Rate ($)",type:"number",value:_,onChange:V=>w(V.target.value===""?"":Number(V.target.value)),disabled:A,InputProps:{startAdornment:i.jsx(aa,{position:"start",children:"$"})},sx:{maxWidth:200}}),i.jsx(xe,{variant:"contained",onClick:ge,disabled:A||_==="",children:"Save"})]})]}),i.jsxs(Z,{sx:{flex:1},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Supply Percentage"}),i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(Pe,{label:"Percentage (%)",type:"number",value:E,onChange:V=>T(V.target.value===""?"":Number(V.target.value)),disabled:S,InputProps:{endAdornment:i.jsx(aa,{position:"end",children:"%"})},sx:{maxWidth:200}}),i.jsx(xe,{variant:"contained",onClick:Q,disabled:S||E==="",children:"Save"})]})]}),i.jsxs(Z,{sx:{flex:1},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Daily Break Times"}),i.jsxs(Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[i.jsx(Pe,{label:"Break Start (HH:MM)",type:"time",value:U,onChange:V=>O(V.target.value),disabled:M,InputLabelProps:{shrink:!0},sx:{maxWidth:200}}),i.jsx(xe,{variant:"contained",onClick:G,disabled:M||U==="",children:"Save Start"}),i.jsx(Pe,{label:"Break End (HH:MM)",type:"time",value:q,onChange:V=>z(V.target.value),disabled:K,InputLabelProps:{shrink:!0},sx:{maxWidth:200}}),i.jsx(xe,{variant:"contained",onClick:ee,disabled:K||q==="",children:"Save End"})]})]})]})}),i.jsxs(dr,{open:a,onClose:se,children:[i.jsx(fr,{children:s?"Edit Margin Entry":"Add New Margin Entry"}),i.jsx(hr,{children:i.jsxs(ut,{spacing:2,mt:1,children:[i.jsx(Pe,{label:"Cost Lower Bound",name:"cost_lower_bound",value:c.cost_lower_bound,onChange:oe,fullWidth:!0,type:"number"}),i.jsx(Pe,{label:"Cost Upper Bound",name:"cost_upper_bound",value:c.cost_upper_bound,onChange:oe,fullWidth:!0,type:"number"}),i.jsx(Pe,{label:"Margin Factor",name:"margin_factor",value:c.margin_factor,onChange:oe,fullWidth:!0,type:"number"})]})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:se,children:"Cancel"}),i.jsx(xe,{onClick:ae,children:s?"Save Changes":"Add Entry"})]})]})]})};var Xf={},_T;function Wue(){if(_T)return Xf;_T=1;var e=ir();Object.defineProperty(Xf,"__esModule",{value:!0}),Xf.default=void 0;var t=e(sr()),r=or();return Xf.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),Xf}var Hue=Wue();const nc=Et(Hue);var Jf={},wT;function Vue(){if(wT)return Jf;wT=1;var e=ir();Object.defineProperty(Jf,"__esModule",{value:!0}),Jf.default=void 0;var t=e(sr()),r=or();return Jf.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error"),Jf}var Gue=Vue();const qy=Et(Gue);var Zf={},jT;function Yue(){if(jT)return Zf;jT=1;var e=ir();Object.defineProperty(Zf,"__esModule",{value:!0}),Zf.default=void 0;var t=e(sr()),r=or();return Zf.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),Zf}var Kue=Yue();const $w=Et(Kue);var eh={},ST;function Que(){if(ST)return eh;ST=1;var e=ir();Object.defineProperty(eh,"__esModule",{value:!0}),eh.default=void 0;var t=e(sr()),r=or();return eh.default=(0,t.default)((0,r.jsx)("path",{d:"M6 2v6h.01L6 8.01 10 12l-4 4 .01.01H6V22h12v-5.99h-.01L18 16l-4-4 4-3.99-.01-.01H18V2zm10 14.5V20H8v-3.5l4-4zm-4-5-4-4V4h8v3.5z"}),"HourglassEmpty"),eh}var Xue=Que();const aR=Et(Xue);var th={},CT;function Jue(){if(CT)return th;CT=1;var e=ir();Object.defineProperty(th,"__esModule",{value:!0}),th.default=void 0;var t=e(sr()),r=or();return th.default=(0,t.default)((0,r.jsx)("path",{d:"M14.67 5v14H9.33V5zm1 14H21V5h-5.33zm-7.34 0V5H3v14z"}),"ViewColumn"),th}var Zue=Jue();const Bw=Et(Zue),ede=e=>{if(typeof e=="string"){const t=e.trim().toLowerCase();if(["needed","need","required","pending"].includes(t))return"needed";if(["done","complete","completed","sent"].includes(t))return"done";if(["true","t","yes","y","1","on"].includes(t))return"needed";if(["false","f","no","n","0","off",""].includes(t))return""}return typeof e=="boolean"&&e?"needed":""},tde=()=>{const[e,t]=x.useState(""),[r,n]=x.useState([]),[a,o]=x.useState("open"),[s,l]=x.useState(0),c=kn(),u=Ds(),{user:d}=Jn(),[f,h]=x.useState(!1),p="openSalesOrders.columnVisibility",[v,m]=x.useState(()=>{if(typeof window>"u")return{};const R=localStorage.getItem(p);if(R)try{return JSON.parse(R)}catch(k){console.warn("Failed to parse column visibility model, resetting to defaults",k)}return{}}),[y,b]=x.useState(null),[_,w]=x.useState([]);x.useEffect(()=>{typeof window<"u"&&localStorage.setItem(p,JSON.stringify(v))},[v]);const A=(R,k)=>{w(k),b(R.currentTarget)},P=()=>b(null),E=i.jsx(Iv,{open:!!y,anchorEl:y,onClose:P,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:i.jsxs(Z,{sx:{p:2,maxWidth:280},children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1.5},children:"Show / Hide Columns"}),i.jsx(Ep,{children:_.filter(R=>R.field!=="actions").map(R=>i.jsx(ui,{control:i.jsx(Xi,{size:"small",checked:v[R.field]!==!1,onChange:k=>m($=>({...$,[R.field]:k.target.checked}))}),label:R.headerName||R.field},R.field))})]})}),[T,S]=x.useState({page:0,pageSize:10}),I=async(R=a)=>{try{const k=d?.access_role==="Sales and Purchase"?"open":R,X=(await ve.get("/api/sales-orders",{params:{status:k,_ts:Date.now()}})).data.sort((N,H)=>{const W=oe=>{const ae=oe.match(/\d+/);return ae?parseInt(ae[0],10):0},ne=W(N.sales_order_number);return W(H.sales_order_number)-ne}),C=X.map(N=>({...N,id:N.sales_order_id,subtotal:Number(N.subtotal)||0,total_gst_amount:Number(N.total_gst_amount)||0,total_amount:Number(N.total_amount)||0,invoice_status:ede(N.invoice_status??N.invoice_required)}));if(n(C),R==="open"||R==="all"){const H=(R==="open"?X:X.filter(W=>W.status==="Open")).reduce((W,ne)=>{const se=parseFloat(ne.subtotal)||0;return W+se},0);l(H)}else l(0)}catch(k){console.error("Error fetching sales orders:",k),n([]),l(0)}};x.useEffect(()=>{I(a)},[a,d?.access_role]),x.useEffect(()=>{setTimeout(()=>{I(a)},500)},[u.key]),x.useEffect(()=>{const R=()=>I(a),k=()=>{document.visibilityState==="visible"&&I(a)};return window.addEventListener("focus",R),document.addEventListener("visibilitychange",k),()=>{window.removeEventListener("focus",R),document.removeEventListener("visibilitychange",k)}},[a]);const U=async R=>{if(window.confirm("Are you sure you want to close this Sales Order?"))try{const k=await ve.get(`/api/sales-orders/${R}`),{salesOrder:$,lineItems:X}=k.data,{subtotal:C,total_gst_amount:N,total_amount:H,...W}=$;await ve.put(`/api/sales-orders/${R}`,{...W,status:"Closed",lineItems:(X||[]).map(ne=>{const se=String(ne.part_number||"").toUpperCase(),oe={part_number:String(ne.part_number||""),part_description:String(ne.part_description||""),unit:String(ne.unit||""),unit_price:se==="SUPPLY"?0:Number(ne.unit_price)||0,line_amount:Number(ne.line_amount)||0,...ne.part_id?{part_id:Number(ne.part_id)}:{}};if(se==="SUPPLY")return{...oe,unit:"Each",quantity:1};if(se==="LABOUR"||se==="OVERHEAD"){const ae=Number(ne.quantity_sold??ne.quantity??0)||0;return{...oe,quantity:ae}}return{...oe,quantity:Number(ne.quantity_sold??ne.quantity??0)||0}})}),me.success("Sales Order closed successfully!"),I()}catch(k){console.error("Error closing sales order:",k);let $="Failed to close sales order.";k.response?.data?.error?$=k.response.data.error:k.response?.data?.details?$=k.response.data.details:k.response?.data?.message&&($=k.response.data.message),$.toLowerCase().includes("insufficient inventory")||$.toLowerCase().includes("insufficient quantity")||$.toLowerCase().includes("negative inventory")?me.error(`Inventory Error: ${$}`):me.error($)}},O=async R=>{if(window.confirm("Are you sure you want to delete this Sales Order? This action cannot be undone."))try{await ve.delete(`/api/sales-orders/${R}`),me.success("Sales Order deleted successfully!"),I()}catch(k){console.error("Error deleting sales order:",k),me.error("Failed to delete sales order.")}},M=e.toLowerCase(),L=r.filter(R=>[R.sales_order_number,R.customer_name,R.product_name,R.product_description,R.unit_number,R.mileage,R.vin_number,R.sales_date?new Date(R.sales_date).toLocaleDateString():"",R.wanted_by_date?new Date(R.wanted_by_date).toLocaleDateString():"",R.wanted_by_time_of_day].filter(k=>k!=null).some(k=>k.toString().toLowerCase().includes(M))),q=[{field:"sales_order_number",headerName:"Sales Order #",flex:1,minWidth:120,valueFormatter:R=>R.value?String(R.value).replace("SO-",""):""},{field:"sales_date",headerName:"Sales Date",flex:.9,minWidth:130,valueFormatter:R=>R.value?new Date(R.value).toLocaleDateString():""},{field:"wanted_by_date",headerName:"Wanted By Date",flex:.9,minWidth:140,valueFormatter:R=>R.value?new Date(R.value).toLocaleDateString():""},{field:"wanted_by_time_of_day",headerName:"Wanted Time",flex:.8,minWidth:120,valueFormatter:R=>R.value?`${String(R.value).charAt(0).toUpperCase()}${String(R.value).slice(1)}`:""},{field:"customer_name",headerName:"Customer",flex:1.3,minWidth:150},{field:"product_name",headerName:"Product Name",flex:1,minWidth:120},{field:"product_description",headerName:"Product Description",flex:1.5,minWidth:150},{field:"unit_number",headerName:"Unit #",flex:.9,minWidth:110},{field:"mileage",headerName:"Mileage",flex:.8,minWidth:100},{field:"vin_number",headerName:"VIN #",flex:1,minWidth:140},{field:"subtotal",headerName:"Subtotal",flex:.8,minWidth:100,valueFormatter:R=>R.value!=null&&!isNaN(Number(R.value))?`$${Number(R.value).toFixed(2)}`:"$0.00"},{field:"total_amount",headerName:"Total",flex:.8,minWidth:100,valueFormatter:R=>R.value!=null&&!isNaN(Number(R.value))?`$${Number(R.value).toFixed(2)}`:"$0.00"},{field:"status",headerName:"Status",flex:.8,minWidth:100,renderCell:R=>i.jsx(ot,{label:R.value,color:R.value==="Open"?"success":"error",size:"small",variant:"outlined"})},{field:"invoice_status",headerName:"Invoice",flex:.6,minWidth:90,valueFormatter:R=>R.value==="done"?"Done":R.value==="needed"?"Needed":"",renderCell:R=>R.value==="done"?i.jsx(nc,{color:"success",titleAccess:"Invoice done"}):R.value==="needed"?i.jsx($w,{color:"error",titleAccess:"Invoice needed"}):null,sortable:!1},{field:"exported_to_qbo",headerName:"QBO Exported",flex:.8,minWidth:120,renderCell:R=>R.row.exported_to_qbo?i.jsx(nc,{color:"success",titleAccess:"Exported to QuickBooks"}):R.row.qbo_export_status?i.jsx(qy,{color:"error",titleAccess:`QBO Export Error: ${R.row.qbo_export_status}`}):R.row.status==="Closed"?i.jsx(aR,{color:"warning",titleAccess:"Not exported to QuickBooks"}):null},{field:"actions",headerName:"Actions",width:140,sortable:!1,renderCell:R=>i.jsxs(Z,{sx:{display:"flex",gap:.5},children:[R.row.status!=="Closed"&&i.jsx(vr,{size:"small",color:"primary",onClick:k=>{k.stopPropagation(),U(R.row.sales_order_id)},children:i.jsx(aj,{})}),R.row.status!=="Closed"&&i.jsx(vr,{size:"small",color:"error",onClick:k=>{k.stopPropagation(),O(R.row.sales_order_id)},children:i.jsx(ga,{})})]})}],z=()=>{setTimeout(()=>{I()},500)},K=()=>{let R=L;a==="open"?R=L.filter(C=>C.status==="Open"):a==="closed"&&(R=L.filter(C=>C.status==="Closed"));const k=Sl.unparse(R.map(C=>{const N={};return q.forEach(H=>{if(H.field!=="actions"){const W=C[H.field];H.field==="bill_date"||H.field==="sales_date"||H.field==="wanted_by_date"?N[H.headerName]=W?new Date(W).toLocaleDateString():"":H.type==="number"?N[H.headerName]=W!=null&&!isNaN(parseFloat(String(W)))?parseFloat(String(W)).toFixed(2):"":N[H.headerName]=W!==void 0?String(W):""}}),N})),$=new Blob([k],{type:"text/csv;charset=utf-8;"}),X=document.createElement("a");if(X.download!==void 0){const C=URL.createObjectURL($);X.setAttribute("href",C),X.setAttribute("download","open_sales_orders.csv"),X.style.visibility="hidden",document.body.appendChild(X),X.click(),document.body.removeChild(X)}},J=R=>{console.log("OpenSalesOrdersPage: Row clicked:",R.row),console.log("OpenSalesOrdersPage: User role:",d?.access_role),console.log("OpenSalesOrdersPage: Sales order ID:",R.row.sales_order_id);const k=`/open-sales-orders/${R.row.sales_order_id}`;console.log("OpenSalesOrdersPage: Navigating user to:",k),c(k)};return d?.access_role==="Time Tracking"?i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Sales Orders"}),i.jsxs(Z,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:[i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Bw,{}),sx:{mr:1},onClick:R=>A(R,q.filter(k=>k.field!=="actions")),children:"Columns"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),sx:{mr:1},onClick:()=>c("/open-sales-orders/new"),children:"New Sales Order"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Ts,{}),onClick:z,children:"Refresh"})]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(ut,{direction:"row",spacing:3,sx:{mb:2},children:i.jsx(Pe,{label:"Search",variant:"outlined",value:e,onChange:R=>t(R.target.value),InputProps:{startAdornment:i.jsx(aa,{position:"start",children:i.jsx(di,{sx:{fontSize:22}})})},sx:{minWidth:340,maxWidth:400,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"small"})}),i.jsx(Po,{rows:L,columns:q.filter(R=>R.field!=="actions"),loading:!1,columnVisibilityModel:v,onColumnVisibilityModelChange:R=>m(R),paginationModel:T,onPaginationModelChange:S,pageSizeOptions:[10,25,50],getRowId:R=>R.id,onRowClick:J,disableRowSelectionOnClick:!0,initialState:{sorting:{sortModel:[{field:"sales_order_number",sort:"desc"}]}},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),E]}):i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:d?.access_role==="Sales and Purchase"?"Sales Orders (Open Only)":"Sales Orders"}),(a==="open"||a==="all")&&i.jsxs(Z,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[i.jsxs(B,{variant:"h6",component:"div",sx:{fontWeight:"bold",color:"primary.main"},children:["Work In Process: $",s.toFixed(2)]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Total subtotal value of all open sales orders"})]}),i.jsx(Z,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:i.jsxs(ut,{direction:"row",spacing:2,children:[d?.access_role!=="Time Tracking"&&i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:()=>c("/open-sales-orders/new"),children:"New SO"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Bw,{}),onClick:R=>A(R,q),children:"Columns"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:K,children:"Export CSV"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Ts,{}),onClick:z,children:"Refresh"})]})})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsxs(ut,{direction:"row",spacing:3,sx:{mb:2},children:[i.jsx(Pe,{label:"Search",variant:"outlined",value:e,onChange:R=>t(R.target.value),InputProps:{startAdornment:i.jsx(aa,{position:"start",children:i.jsx(di,{sx:{fontSize:22}})})},sx:{minWidth:340,maxWidth:400,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"small"}),d?.access_role!=="Sales and Purchase"&&i.jsx(ot,{label:"All",onClick:()=>o("all"),color:a==="all"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),i.jsx(ot,{label:"Open",onClick:()=>o("open"),color:a==="open"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),d?.access_role!=="Sales and Purchase"&&i.jsx(ot,{label:"Closed",onClick:()=>o("closed"),color:a==="closed"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}})]}),i.jsx(Po,{rows:L,columns:q,loading:!1,columnVisibilityModel:v,onColumnVisibilityModelChange:R=>m(R),paginationModel:T,onPaginationModelChange:S,pageSizeOptions:[10,25,50],getRowId:R=>R.id,onRowClick:J,disableRowSelectionOnClick:!0,initialState:{sorting:{sortModel:[{field:"sales_order_number",sort:"desc"}]}},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),E]})};var rh={},AT;function rde(){if(AT)return rh;AT=1;var e=ir();Object.defineProperty(rh,"__esModule",{value:!0}),rh.default=void 0;var t=e(sr()),r=or();return rh.default=(0,t.default)([(0,r.jsx)("path",{d:"M19.5 3.5 18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2v14H3v3c0 1.66 1.34 3 3 3h12c1.66 0 3-1.34 3-3V2zM19 19c0 .55-.45 1-1 1s-1-.45-1-1v-3H8V5h11z"},"0"),(0,r.jsx)("path",{d:"M9 7h6v2H9zm7 0h2v2h-2zm-7 3h6v2H9zm7 0h2v2h-2z"},"1")],"ReceiptLong"),rh}var nde=rde();const Sv=Et(nde);var nh={},PT;function ade(){if(PT)return nh;PT=1;var e=ir();Object.defineProperty(nh,"__esModule",{value:!0}),nh.default=void 0;var t=e(sr()),r=or();return nh.default=(0,t.default)((0,r.jsx)("path",{d:"M3 17v2h6v-2zM3 5v2h10V5zm10 16v-2h8v-2h-8v-2h-2v6zM7 9v2H3v2h4v2h2V9zm14 4v-2H11v2zm-6-4h2V7h4V5h-4V3h-2z"}),"Tune"),nh}var ide=ade();const ode=Et(ide),$u=(e,t)=>{const r=parseFloat(String(e))||0,n=parseFloat(String(t))||0;return Math.round(r*n*100)/100},bo=e=>{const t=parseFloat(String(e));return isNaN(t)?0:t},kd={salesOrders:{customerPoNumber:!0,quotedPrice:!0,sourceQuote:!0,vin:!0,unitNumber:!0,vehicleMake:!0,vehicleModel:!0,invoiceStatus:!0,wantedByDate:!0,wantedByTimeOfDay:!0,productDescription:!0,terms:!0,mileage:!0,techStory:!0},invoices:{vin:!0,productDescription:!0,unitNumber:!0,vehicleMake:!0,vehicleModel:!0,mileage:!0,techStory:!0}},OT=e=>{const t=kd,r=(n,a)=>{const o={...a};return!n||typeof n!="object"||Object.keys(a).forEach(s=>{const l=n[s];o[s]=typeof l=="boolean"?l:a[s]}),o};return{salesOrders:r(e?.salesOrders,t.salesOrders),invoices:r(e?.invoices,t.invoices)}},Cv={async fetchSettings(){try{const e=await ve.get("/api/settings/field-visibility");return OT(e.data?.settings)}catch(e){return console.warn("Failed to fetch field visibility settings, using defaults",e),{...kd}}},async updateSettings(e){const t=await ve.put("/api/settings/field-visibility",e);return OT(t.data?.settings)}},iR=async e=>(await ve.get(`/api/customers/${e}/vehicle-history`)).data,cl=e=>(e??"").trim().toUpperCase(),sde=e=>e!=null&&!(typeof e=="string"&&e.trim()===""),oR=e=>{const t=[],r=[],n={},a={},o=new Set,s=new Set;return e.forEach(l=>{const c=cl(l.unit_number),u=cl(l.vin_number);c&&!o.has(c)&&l.unit_number&&(t.push(l.unit_number),o.add(c)),u&&!s.has(u)&&l.vin_number&&(r.push(l.vin_number),s.add(u)),c&&u&&l.unit_number&&l.vin_number&&(n[c]||(n[c]=[]),n[c].some(d=>cl(d)===u)||n[c].push(l.vin_number),a[u]||(a[u]=[]),a[u].some(d=>cl(d)===c)||a[u].push(l.unit_number))}),{units:t,vins:r,unitToVins:n,vinToUnits:a}},sR=(e,t,r)=>{const n=cl(t),a=cl(r),o=e.filter(l=>{const c=cl(l.unit_number),u=cl(l.vin_number);return n&&c!==n||a&&u!==a?!1:!!(n||a)}),s=l=>{const c=o.find(u=>sde(u[l]));return c?c[l]:void 0};return{unit_number:s("unit_number"),vin_number:s("vin_number"),vehicle_make:s("vehicle_make"),vehicle_model:s("vehicle_model"),mileage:s("mileage"),product_name:s("product_name"),product_description:s("product_description")}},Av=cl,Fm=["Each","cm","ft","ft^2","kg","pcs","hr","L"],Cc=5,kT=e=>{if(typeof e=="string"){const t=e.trim().toLowerCase();if(["needed","need","required","pending"].includes(t))return"needed";if(["done","complete","completed","sent"].includes(t))return"done";if(["true","t","yes","y","1","on"].includes(t))return"needed";if(["false","f","no","n","0","off",""].includes(t))return""}return typeof e=="boolean"&&e?"needed":""},Pv=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim().toUpperCase(),lde=(e,t,r=8)=>{const n=Pv(t);if(!n)return e.slice(0,r);const a=e.map(o=>{const s=Pv(o.label);let l=-1;return s.startsWith(n)?l=3:s.split(" ").some(c=>c.startsWith(n))?l=2:s.includes(n)&&(l=1),{opt:o,score:l}}).filter(o=>o.score>=0);return a.sort((o,s)=>s.score-o.score||o.opt.label.localeCompare(s.opt.label)),a.slice(0,r).map(o=>o.opt)},cde=e=>e>=4?3:e===3?4:e===2?6:12,ude=()=>{const{id:e}=Ms(),t=e==="new",r=!!e&&/^\d+$/.test(e),n=kn(),{user:a}=Jn(),o=a?.access_role==="Sales and Purchase",s=a?.access_role==="Time Tracking",[l,c]=x.useState([]),[u,d]=x.useState([]),[f,h]=x.useState([]),[p,v]=x.useState(null),[m,y]=x.useState(null),[b,_]=x.useState(null),[w,A]=x.useState(null),[P,E]=x.useState(""),[T,S]=x.useState(!1),[I,U]=x.useState(null),[O,M]=x.useState(!1),L=x.useRef(null),[q,z]=x.useState([]),[K,J]=x.useState(!1),R=x.useRef(null),[k,$]=x.useState(null),[X,C]=x.useState(""),[N,H]=x.useState(!1),[W,ne]=x.useState(null),[se,oe]=x.useState(Rt()),[ae,pe]=x.useState(null),[ge,Q]=x.useState(""),[G,ee]=x.useState(""),[le,V]=x.useState(""),[Ve,Me]=x.useState(""),[Fe,Qe]=x.useState(""),[it,st]=x.useState(""),[vt,Ye]=x.useState(""),[Ze,We]=x.useState(""),[wt,It]=x.useState(""),[Ot,Wt]=x.useState(""),[jt,lr]=x.useState(""),$e=x.useCallback((de,he)=>{It(he??"")},[]),[He,Je]=x.useState(null),[Ue,ht]=x.useState(""),[at,St]=x.useState([]);x.useMemo(()=>at.map(de=>({part_number:de.part_number,part_description:de.part_description,quantity:bo(de.quantity),unit:de.unit,unit_price:de.unit_price})),[at]);const Tt="salesOrderDetail.fieldVisibility",Yt={...kd.salesOrders},[Or,Dr]=x.useState(()=>{if(typeof window>"u")return Yt;try{const de=localStorage.getItem(Tt);if(de){const he=JSON.parse(de);return{...Yt,...he}}}catch(de){console.warn("Failed to read sales order field visibility preferences",de)}return Yt}),[tr,wr]=x.useState(Yt);x.useEffect(()=>{typeof window<"u"&&localStorage.setItem(Tt,JSON.stringify(Or))},[Or]),x.useEffect(()=>{(async()=>{try{const de=await Cv.fetchSettings();wr(de.salesOrders),Dr(he=>{const Ee={...he};let ke=!1;return Object.keys(de.salesOrders).forEach(rt=>{!de.salesOrders[rt]&&Ee[rt]&&(Ee[rt]=!1,ke=!0)}),ke?Ee:he})}catch(de){console.warn("Failed to load admin field visibility defaults; using user preferences",de)}})()},[]);const Ir=x.useMemo(()=>{const de={...Yt};return Object.keys(de).forEach(he=>{de[he]=!!(tr[he]&&Or[he])}),s&&(de.quotedPrice=!1,de.invoiceStatus=!1,de.terms=!1),de},[tr,Or,s]),[dn,ka]=x.useState(null),En=de=>ka(de.currentTarget),Zt=()=>ka(null),Xr=x.useMemo(()=>s?{partNumber:3,description:3,quantity:1.5,availability:1.5,unit:1.5,unitCost:0,amount:0,actions:1.5}:{partNumber:2.5,description:2.5,quantity:1,availability:1,unit:1,unitCost:1.5,amount:1.5,actions:1},[s]),Gn=x.useMemo(()=>{if(!at||at.length===0)return{subtotal:0,total_gst_amount:0,total_amount:0};const de=at.reduce((ke,rt)=>{const _t=rt.line_amount||0;return ke+_t},0),he=de*.05,Ee=de+he;return{subtotal:Math.round(de*100)/100,total_gst_amount:Math.round(he*100)/100,total_amount:Math.round(Ee*100)/100}},[at]),Tn=Gn.subtotal,Wr=Gn.total_gst_amount,en=Gn.total_amount,[Se,Ge]=x.useState(null),[_e,Te]=x.useState(!t),[nt,mt]=x.useState(null),[Mt,Nr]=x.useState(null),[Ar,$r]=x.useState([]),[Vr,In]=x.useState(""),[$n,ca]=x.useState(!1),[fi,ro]=x.useState(!1),qi=x.useCallback(de=>JSON.stringify((de||[]).map(he=>({part_number:(he.part_number||"").trim(),part_description:(he.part_description||"").trim(),quantity:bo(he.quantity),unit:(he.unit||"").trim(),unit_price:bo(he.unit_price)})).sort((he,Ee)=>he.part_number!==Ee.part_number?he.part_number.localeCompare(Ee.part_number):he.quantity-Ee.quantity)),[]),Nn=x.useCallback(()=>({customer:w?{id:w.id,label:w.label}:null,product:k?{id:k.id,label:k.label}:null,salesDate:se?se.toISOString():null,wantedByDate:ae?ae.toISOString():null,wantedByTimeOfDay:Ot,terms:(G||"").trim(),customerPoNumber:(le||"").trim(),vinNumber:(Ve||"").trim(),unitNumber:(Fe||"").trim(),estimatedCost:He!=null?Number(He):null,vehicleMake:(it||"").trim(),vehicleModel:(vt||"").trim(),mileage:Ze===""?"":Number(Ze),invoiceStatus:wt}),[w,k,se,ae,Ot,G,le,Ve,Fe,He,it,vt,Ze,wt]);x.useEffect(()=>{if($n&&Vr===""){const de=JSON.stringify({header:Nn(),lineItems:qi(at)});In(de)}},[$n,Vr,Nn,qi,at]);const Fi=x.useMemo(()=>JSON.stringify({header:Nn(),lineItems:qi(at)}),[Nn,qi,at]),wi=!!Vr&&Vr!==Fi&&!fi,Xe=!!Se&&Se.status?.toLowerCase()==="closed",[Vt,ar]=x.useState([]),[qr,kr]=x.useState([]),[wn,Mr]=x.useState(null),[Zn,xn]=x.useState(null),[Ea,Ta]=x.useState(null),[ti,ea]=x.useState(null),[Cn,Gr]=x.useState(null),[no,ao]=x.useState(null),[io,ji]=x.useState(!1),[oo,hi]=x.useState(null),[Oo,$i]=x.useState(""),[fs,so]=x.useState(!1),[hs,Ya]=x.useState(null),[lo,ri]=x.useState(""),Bn=qr.length>0?8+64*qr.length:0,Yo={p:3,mb:3,border:"1px solid",borderColor:"divider",borderRadius:2,boxShadow:"0 8px 24px rgba(0,0,0,0.06)"},ko={display:"grid",gap:2,gridAutoFlow:"row dense",alignItems:"stretch"},yr={...ko,gridTemplateColumns:{xs:"1fr",sm:"repeat(2, minmax(0, 1fr))",md:"2fr 1fr 1fr"}},Cl={...ko,gridTemplateColumns:{xs:"1fr",sm:"repeat(2, minmax(0, 1fr))",md:"repeat(3, minmax(0, 1fr))",lg:"1.2fr repeat(4, minmax(0, 1fr))"}},fc={...ko,gridTemplateColumns:{xs:"1fr",sm:"repeat(2, minmax(0, 1fr))",md:"repeat(3, minmax(0, 1fr))"}},Si=x.useCallback((de,he)=>{const Ee={},ke=de??Fe,rt=he??Ve;if(de!==void 0&&(Ee.unit=de),he!==void 0&&(Ee.vin=he),q.length&&(ke||rt)){const _t=sR(q,ke,rt);_t.unit_number&&(Ee.unit=_t.unit_number),_t.vin_number&&(Ee.vin=_t.vin_number),_t.vehicle_make&&(Ee.make=_t.vehicle_make),_t.vehicle_model&&(Ee.model=_t.vehicle_model);const Bt=_t.mileage;if(Bt!=null&&String(Bt)!==""){const Nt=Number(Bt);Ee.mileage=Number.isFinite(Nt)?Nt:Bt}}Ee.unit!==void 0&&Qe(Ee.unit),Ee.vin!==void 0&&Me(Ee.vin),Ee.make!==void 0&&st(Ee.make),Ee.model!==void 0&&Ye(Ee.model),Ee.mileage!==void 0&&We(Ee.mileage)},[Fe,q,Ve]),Fs=!!(w?.id||Se?.customer_id);x.useMemo(()=>JSON.stringify(at.map(de=>({part_number:de.part_number,part_description:de.part_description,quantity:de.quantity,unit:de.unit,unit_price:de.unit_price,line_amount:de.line_amount}))),[at]);const{units:Ci,vins:Ko,unitToVins:ni,vinToUnits:Bi}=x.useMemo(()=>oR(q),[q]),hc=x.useMemo(()=>{const de=Av(Fe);return de&&ni[de]?ni[de]:Ko},[Fe,ni,Ko]),$s=x.useMemo(()=>{const de=Av(Ve);return de&&Bi[de]?Bi[de]:Ci},[Ci,Ve,Bi]),co=x.useMemo(()=>{const de={};for(const he of f||[])he?.part_number&&(de[String(he.part_number)]=he.part_description||"");return de},[f]),Eo=x.useCallback((de,he,Ee=!1)=>{const ke=(he.inputValue||"").toUpperCase(),rt=50,_t=[];for(const Nt of de){const cr=String(Nt).toUpperCase(),Kn=(co[Nt]||"").toUpperCase();if((!ke||cr.includes(ke)||Kn.includes(ke))&&(_t.push(Nt),_t.length>=rt))break}const Bt=_t.some(Nt=>String(typeof Nt=="string"?Nt:Nt?.label||"").toUpperCase()===ke);return Ee&&ke&&!Bt&&_t.push({label:`Add "${he.inputValue}" as New Part`,isNew:!0,inputValue:he.inputValue}),_t},[co]),To=(de,he)=>{const Ee=(at[de]?.part_number||"").trim(),ke=he.key==="Enter",rt=he.key==="Tab",_t=he.key==="Escape",Bt=he.key==="ArrowDown"||he.key==="ArrowUp";if(_t){xn(null);return}if(Bt){he.key==="ArrowDown"&&Zn!==de&&xn(de);return}if(!(Zn===de&&(ke||rt))&&(ke||rt)&&Ee){if(ke&&he.ctrlKey){he.preventDefault(),ea(de),$i(Ee.toUpperCase()),hi(de),ji(!0),xn(null);return}!f.find(cr=>cr.part_number.toUpperCase()===Ee.toUpperCase())&&ke&&(he.preventDefault(),ea(de),$i(Ee.toUpperCase()),hi(de),ji(!0),xn(null))}},Al=(de,he)=>{const Ee=(Ar[de]?.part_number||"").trim(),ke=he.key==="Enter",rt=he.key==="Tab",_t=he.key==="Escape",Bt=he.key==="ArrowDown"||he.key==="ArrowUp";if(_t){Gr(null);return}if(Bt){he.key==="ArrowDown"&&Cn!==de&&Gr(de);return}if(!(Cn===de&&(ke||rt))&&(ke||rt)&&Ee){if(ke&&he.ctrlKey){he.preventDefault(),ao(de),ri(Ee.toUpperCase()),Ya(de),so(!0),Gr(null);return}!f.find(cr=>cr.part_number.toUpperCase()===Ee.toUpperCase())&&ke&&(he.preventDefault(),ao(de),ri(Ee.toUpperCase()),Ya(de),so(!0),Gr(null))}},Ai=de=>l.find(he=>Pv(he.label)===Pv(de))||null,[Bs,Ui]=x.useState(!1),[Us,be]=x.useState(""),[je,Ie]=x.useState(!1),[Le,De]=x.useState(""),[pt,kt]=x.useState(!1),[Lt,jr]=x.useState([]),[zr,fn]=x.useState(null),[ta,Yn]=x.useState(!1),[Pi,ai]=x.useState(!1),[Ia,Fa]=x.useState(null),[zi,uo]=x.useState(null),[Io,Oi]=x.useState(!1),[Wi,Hi]=x.useState(!1),[ps,ii]=x.useState(null);x.useEffect(()=>{(async()=>{try{const[de,he,Ee]=await Promise.all([ve.get("/api/customers"),ve.get("/api/products"),ve.get("/api/inventory")]);c(de.data.map(ke=>({label:ke.customer_name,id:ke.customer_id}))),d(he.data.map(ke=>({label:ke.product_name,id:ke.product_id,description:ke.product_description}))),h(Ee.data),t&&ca(!0)}catch(de){console.error("Prefetch failed",de)}})()},[]),x.useEffect(()=>{(async()=>{try{const[de,he,Ee]=await Promise.all([ve.get("/api/settings/labour-rate").catch(()=>({data:{labour_rate:null}})),ve.get("/api/settings/overhead-rate").catch(()=>({data:{overhead_rate:null}})),ve.get("/api/settings/supply-rate").catch(()=>({data:{supply_rate:null}}))]);v(de.data.labour_rate??null),y(he.data.overhead_rate??null),_(Ee.data.supply_rate??null)}catch{}})()},[]);const pc=x.useCallback(async()=>{if(!(Wi||l.length>0)){Hi(!0);try{const de=await ve.get("/api/customers");c(de.data.map(he=>({label:he.customer_name,id:he.customer_id})))}catch(de){console.error("Failed to reload customers",de)}finally{Hi(!1)}}},[l.length,Wi]),D=x.useCallback(async de=>{if(!de){z([]),R.current=null;return}if(!(R.current===de&&q.length)){R.current=de,J(!0);try{const Ee=[...(await iR(de)).records||[]].sort((ke,rt)=>{const _t=ke.activity_date?new Date(ke.activity_date).getTime():0;return(rt.activity_date?new Date(rt.activity_date).getTime():0)-_t});z(Ee)}catch(he){console.error("Failed to load vehicle history for customer",he),z([])}finally{J(!1)}}},[q.length]);x.useEffect(()=>{if(!e||t||!r){t&&(St([{part_number:"",part_description:"",quantity:"",unit:Fm[0],unit_price:0,gst:Cc,line_amount:0}]),ca(!0),ht(""),lr(""));return}(async()=>{Te(!0),mt(null);try{const he=(await ve.get(`/api/sales-orders/${e}`)).data,Ee=kT(he.salesOrder?.invoice_status??he.salesOrder?.invoice_required);Ge(he.salesOrder?{...he.salesOrder,invoice_status:Ee||null}:null),ht(he.salesOrder?.source_quote_number||"");const ke=(he.lineItems||he.salesOrder?.line_items||[]).map(cr=>({part_number:cr.part_number,part_description:cr.part_description,unit:cr.unit,unit_price:cr.unit_price,line_amount:Number(cr.line_amount||0),quantity:cr.part_number==="SUPPLY"?"1":["LABOUR","OVERHEAD"].includes(cr.part_number)?String(cr.quantity_sold||0):String(cr.quantity_sold??cr.quantity??0),gst:Cc,part_id:cr.part_id??void 0}));console.log("[SalesOrderDetail] Raw line items from backend:",he.lineItems),console.log("[SalesOrderDetail] Mapped line items:",ke),St(ke),ar(ke);const rt=(he.partsToOrder||[]).map(cr=>({sales_order_id:parseInt(e),part_number:cr.part_number,part_description:cr.part_description,quantity_to_order:String(cr.quantity_needed||0),unit:cr.unit||"Each",unit_price:Number(cr.unit_price||0),line_amount:Number(cr.line_amount||0)}));$r(rt),oe(Rt(he.salesOrder?.sales_date)),pe(he.salesOrder?.wanted_by_date?Rt(he.salesOrder?.wanted_by_date):null);const _t=he.salesOrder?.wanted_by_time_of_day?String(he.salesOrder.wanted_by_time_of_day).toLowerCase():"";Wt(_t||""),Je(he.salesOrder?.estimated_cost||0),Q(he.salesOrder?.product_description||""),ee(he.salesOrder?.terms||""),V(he.salesOrder?.customer_po_number||""),Me(he.salesOrder?.vin_number||""),Qe(he.salesOrder?.unit_number||""),We(he.salesOrder?.mileage===null||he.salesOrder?.mileage===void 0?"":Number(he.salesOrder.mileage)),st(he.salesOrder?.vehicle_make||""),Ye(he.salesOrder?.vehicle_model||""),It(Ee),lr(he.salesOrder?.tech_story||"");const Bt=l.find(cr=>cr.id===he.salesOrder?.customer_id)||{label:he.salesOrder?.customer_name||"",id:he.salesOrder?.customer_id};A(Bt?.id?Bt:null);const Nt=u.find(cr=>cr.label===he.salesOrder?.product_name)||{label:he.salesOrder?.product_name||""};$(Nt?.label?Nt:null)}catch(de){console.error(de),mt(de?.response?.status===404?"Sales order not found. It may have been deleted.":"Failed to load sales order data. Please try again.")}finally{Te(!1),ca(!0)}})()},[e,t,r]),x.useEffect(()=>{const de=w?.id??Se?.customer_id??null;D(de?Number(de):null)},[w?.id,D,Se?.customer_id]),x.useEffect(()=>{$n&&p!==null&&St(de=>de.map(he=>he.part_number!=="LABOUR"?he:he.unit_price!==p?{...he,unit_price:p}:he))},[p,$n]),x.useEffect(()=>{$n&&m!==null&&St(de=>de.map(he=>he.part_number!=="OVERHEAD"?he:he.unit_price!==m?{...he,unit_price:m}:he))},[m,$n]),x.useEffect(()=>{$n&&St(de=>{const he=de.some(ke=>ke.part_number==="LABOUR"),Ee=de.some(ke=>ke.part_number==="SUPPLY");if(b&&b>0){if(he&&!Ee)return[...de,{part_number:"SUPPLY",part_description:"Supply",quantity:t?"":"1",unit:t?"":"Each",unit_price:0,gst:Cc,line_amount:0}];if(!he&&Ee)return de.filter(ke=>ke.part_number!=="SUPPLY")}else if(Ee)return de.filter(ke=>ke.part_number!=="SUPPLY");return de})},[b,at,$n,t]),x.useEffect(()=>{$n&&(!f||f.length===0||!at||at.length===0||St(de=>{let he=!1;const Ee=de.map(ke=>{if(["LABOUR","OVERHEAD","SUPPLY"].includes(ke.part_number))return ke;const rt=(f||[]).find(Vi=>String(Vi.part_number).trim().toUpperCase()===String(ke.part_number).trim().toUpperCase());if(!rt)return ke;const _t=String(rt.unit||"").trim(),Bt=String(ke.unit||"").trim(),Nt=String(rt.part_description||""),Kn=parseFloat(String(rt.last_unit_cost))||0;let ya=ke;return _t&&_t!==Bt&&(ya={...ya,unit:_t},he=!0),Nt&&Nt!==ke.part_description&&(ya={...ya,part_description:Nt},he=!0),!isNaN(Kn)&&Kn!==ke.unit_price&&(ya={...ya,unit_price:Kn},he=!0),ya});return he?Ee:de}))},[$n,f,at]);const re=de=>f.find(he=>he.part_number===de),Ce=(de,he)=>{St(Ee=>{const ke=[...Ee];if(!he||he.trim()==="")ke[de]={...ke[de],part_number:"",part_description:"",quantity:"",unit:Fm[0],unit_price:0,line_amount:0};else if(he.toUpperCase()==="LABOUR")ke[de]={...ke[de],part_number:"LABOUR",part_description:"Labour",unit:"hr",unit_price:p??0,line_amount:0};else if(he.toUpperCase()==="OVERHEAD")ke[de]={...ke[de],part_number:"OVERHEAD",part_description:"Overhead",unit:"hr",unit_price:m??0,line_amount:0};else if(he.toUpperCase()==="SUPPLY")ke[de]={...ke[de],part_number:"SUPPLY",part_description:"Supply",unit:t?"":"Each",unit_price:0,line_amount:0};else{const rt=re(he);if(rt){const Bt=parseFloat(String(rt.last_unit_cost))||0,Nt=bo(ke[de]?.quantity),cr=$u(Nt,Bt);ke[de]={...ke[de],part_number:he,part_description:rt.part_description||"",unit:rt.unit,unit_price:Bt,line_amount:cr}}else ke[de]={...ke[de],part_number:he,part_description:"Part not found",unit_price:0,line_amount:0}}return ke})},Ne=(de,he,Ee)=>{St(ke=>{const rt=[...ke],_t={...rt[de],[he]:Ee};if(parseFloat(Ee)<=0&&_t.part_number!=="SUPPLY")return rt.filter((Bt,Nt)=>Nt!==de);if(["LABOUR","OVERHEAD"].includes(_t.part_number))return rt[de]=_t,rt;{const Bt=bo(_t.quantity),Nt=bo(_t.unit_price);_t.line_amount=$u(Bt,Nt)}return rt[de]=_t,rt})},Ke=()=>{St(de=>[...de,{part_number:"",part_description:"",quantity:"",unit:Fm[0],unit_price:0,gst:Cc,line_amount:0}])},dt=de=>{St(he=>he.filter((Ee,ke)=>ke!==de))},At=(de,he)=>{if(["LABOUR","OVERHEAD","SUPPLY"].includes(de.part_number))return null;const Ee=f.find(Kn=>Kn.part_number.toLowerCase()===de.part_number.toLowerCase());if(!Ee||Ee.part_type==="supply")return null;const ke=parseFloat(Ee.quantity_on_hand)||0;if(t){const Kn=at.filter(Vi=>Vi.part_number.toLowerCase()===de.part_number.toLowerCase()).reduce((Vi,Ws)=>Vi+(parseFloat(String(Ws.quantity).replace(/[^\d.-]/g,""))||0),0),ya=ke-Kn;return{available:ya<0?Math.floor(ya):Math.round(ya),isNegative:ya<0,currentStock:ke,changeInQuantity:Kn,totalQuantityForPart:Kn,totalOriginalQuantityForPart:0}}const rt=at.filter(Kn=>Kn.part_number.toLowerCase()===de.part_number.toLowerCase()).reduce((Kn,ya)=>Kn+(parseFloat(String(ya.quantity).replace(/[^\d.-]/g,""))||0),0),_t=Vt.filter(Kn=>Kn.part_number.toLowerCase()===de.part_number.toLowerCase()).reduce((Kn,ya)=>Kn+(parseFloat(String(ya.quantity).replace(/[^\d.-]/g,""))||0),0),Bt=rt-_t,Nt=ke-Bt,cr=Nt<0?Math.floor(Nt):Math.round(Nt);return{available:cr,isNegative:cr<0,currentStock:ke,changeInQuantity:Bt,totalQuantityForPart:rt,totalOriginalQuantityForPart:_t}},zt=x.useMemo(()=>at.map((de,he)=>At(de)),[at,f,Vt,t]);x.useEffect(()=>{if(t)return;const de=[];at.forEach((he,Ee)=>{const ke=At(he);ke&&ke.available<0&&de.push({lineItemIndex:Ee,partNumber:he.part_number,partDescription:he.part_description,excessQuantity:Math.abs(ke.available),unit:he.unit})}),kr(de)},[at,f,t]);const nr=()=>{if(at.filter(ke=>!ke.part_number||ke.part_number.trim()==="").length>0)return me.error("Line items with blank part numbers are not allowed."),!1;const he=at.filter(ke=>{if(["LABOUR","OVERHEAD","SUPPLY"].includes(String(ke.part_number).toUpperCase()))return!1;const rt=ke.part_id;if(rt){const Bt=(f||[]).find(Nt=>Nt.part_id===rt);return Bt?Bt.part_type==="supply":!1}const _t=(f||[]).find(Bt=>String(Bt.part_number).toUpperCase()===String(ke.part_number).trim().toUpperCase());return!_t||_t.part_type==="supply"});if(he.length>0){const ke=he.map(rt=>rt.part_number).join(", ");return me.error(`Invalid or supply parts (not allowed): ${ke}`),!1}return at.some((ke,rt)=>{const _t=At(ke);return _t&&_t.available<0})?(ii("Insufficient inventory for one or more parts."),!1):(ii(null),!0)},Er=de=>{const he=de.reduce((Ee,ke)=>{const rt=ke.part_number.trim().toLowerCase();if(!Ee[rt]){const _t=["LABOUR","OVERHEAD","SUPPLY"].includes(ke.part_number.toUpperCase())?null:(f||[]).find(Bt=>String(Bt.part_number).toUpperCase()===ke.part_number.trim().toUpperCase());Ee[rt]={part_number:ke.part_number.trim(),part_description:ke.part_description.trim(),unit:ke.unit.trim(),unit_price:ke.unit_price!=null?Number(ke.unit_price):0,line_amount:0,quantity_sold:0,...ke.part_id?{part_id:ke.part_id}:_t&&_t.part_id?{part_id:_t.part_id}:{}}}if(ke.part_number.toUpperCase()==="SUPPLY")Ee[rt].quantity_sold=1,Ee[rt].unit="Each",Ee[rt].unit_price=0,Ee[rt].line_amount+=Number(ke.line_amount||0);else if(["LABOUR","OVERHEAD"].includes(ke.part_number.toUpperCase())){const _t=parseFloat(String(ke.quantity).replace(/[^\d.-]/g,""))||0;Ee[rt].quantity_sold=_t,Ee[rt].line_amount=Number(ke.line_amount||0)}else{const _t=parseFloat(String(ke.quantity).replace(/[^\d.-]/g,""))||0,Bt=Number.isFinite(_t)?_t:0;Ee[rt].quantity_sold+=Bt,Ee[rt].line_amount+=Bt*(ke.unit_price||0)}return Ee},{});return Object.values(he)},Sr=async()=>{if(!w||!se||!k){me.error("Please fill in required fields.");return}if(!nr())return;const de={customer_id:w?.id,sales_date:se?se.toISOString():new Date().toISOString(),wanted_by_date:ae?ae.format("YYYY-MM-DD"):null,wanted_by_time_of_day:Ot||null,product_name:k?.label?.trim(),product_description:ge.trim(),terms:G.trim(),customer_po_number:le.trim(),vin_number:Ve.trim(),unit_number:Fe.trim(),vehicle_make:it.trim(),vehicle_model:vt.trim(),mileage:Ze===""?null:Number(Ze),invoice_status:wt||null,status:t?"Open":Se?.status||"Open",estimated_cost:He!=null?Number(He):0,lineItems:Er(at),source_quote_number:Ue?.trim()||null,tech_story:jt?.trim()||null};ro(!0);try{if(t){if(window.__soCreateInFlight){console.log("[SO] Skipping duplicate create (in flight)");return}window.__soCreateInFlight=!0;const he=await ve.post("/api/sales-orders",de);me.success("Sales Order created successfully!"),window.__unsavedGuardAllowNext=!0,n(`/open-sales-orders/${he.data.sales_order_id}`)}else{const he=Ar.filter(Ee=>Ee.part_number&&parseFloat(String(Ee.quantity_to_order))>0).map(Ee=>({sales_order_id:Number(e),part_number:Ee.part_number.trim(),part_description:Ee.part_description.trim(),quantity_needed:parseFloat(String(Ee.quantity_to_order))||0,unit:Ee.unit.trim(),unit_price:Ee.unit_price,line_amount:Ee.line_amount}));await ve.put(`/api/sales-orders/${e}`,{...de,partsToOrder:he}),Nr("Sales Order updated successfully!"),setTimeout(()=>{window.__unsavedGuardAllowNext=!0},100),In(JSON.stringify({header:Nn(),lineItems:at,quantityToOrderItems:Ar}));try{const[Ee,ke]=await Promise.all([ve.get(`/api/sales-orders/${e}`),ve.get("/api/inventory")]),rt=Ee.data,_t=kT(rt.salesOrder?.invoice_status??rt.salesOrder?.invoice_required);Ge(rt.salesOrder?{...rt.salesOrder,invoice_status:_t||null}:null),It(_t),ht(rt.salesOrder?.source_quote_number||""),Qe(rt.salesOrder?.unit_number||""),We(rt.salesOrder?.mileage===null||rt.salesOrder?.mileage===void 0?"":Number(rt.salesOrder.mileage));const Bt=(rt.lineItems||rt.salesOrder?.line_items||[]).map(Nt=>({part_number:Nt.part_number,part_description:Nt.part_description,unit:Nt.unit,unit_price:Nt.unit_price,line_amount:Number(Nt.line_amount||0),quantity:Nt.part_number==="SUPPLY"?"1":["LABOUR","OVERHEAD"].includes(Nt.part_number)?String(Nt.quantity_sold||0):String(Nt.quantity_sold??Nt.quantity??0),gst:Cc,part_id:Nt.part_id??void 0}));St(Bt),ar(Bt),h(ke.data)}catch{}}}catch(he){const Ee=he?.response?.data?.error||he?.response?.data?.details||he?.response?.data?.message||"Failed to save sales order.";ii(Ee)}finally{ro(!1),window.__soCreateInFlight=!1}},Kr=async()=>{if(t||!Se)return;const de=at.filter(he=>!["LABOUR","OVERHEAD","SUPPLY"].includes(he.part_number)&&(parseFloat(String(he.quantity).replace(/[^\d.-]/g,""))||0)===0);if(de.length>0){me.error(`Cannot close: line items with 0 quantity: ${de.map(he=>he.part_number).join(", ")}`);return}if(Ar.some(he=>parseFloat(String(he.quantity_to_order))>0)){const he=Ar.filter(Ee=>parseFloat(String(Ee.quantity_to_order))>0).map(Ee=>`${Ee.part_number} (${Ee.quantity_to_order})`).join(", ");me.error(`Cannot close: parts still need to be ordered: ${he}`);return}try{await ve.put(`/api/sales-orders/${Se.sales_order_id}`,{customer_id:Se.customer_id,sales_date:Se.sales_date,product_name:k?.label?.trim()||Se.product_name,product_description:ge.trim(),terms:G.trim(),unit_number:Fe.trim()||Se.unit_number,status:"Closed",estimated_cost:He??Se.estimated_cost,lineItems:Er(at)}),me.success("Sales Order closed successfully!"),Ge(he=>he&&{...he,status:"Closed"})}catch(he){const Ee=he?.response?.data?.error||he?.response?.data?.details||he?.response?.data?.message||"Failed to close sales order.";ii(Ee)}},Dn=async()=>{if(!(t||!Se))try{await ve.put(`/api/sales-orders/${Se.sales_order_id}`,{customer_id:Se.customer_id,sales_date:Se.sales_date,product_name:k?.label?.trim()||Se.product_name,product_description:ge.trim(),terms:G.trim(),unit_number:Fe.trim()||Se.unit_number,status:"Open",estimated_cost:He??Se.estimated_cost,lineItems:Er(at)}),me.success("Sales Order reopened successfully!"),Ge(de=>de&&{...de,status:"Open"}),n(`/open-sales-orders/${Se.sales_order_id}`)}catch(de){const he=de?.response?.data?.error||de?.response?.data?.details||de?.response?.data?.message||"Failed to reopen sales order.";ii(he)}},Un=async()=>{if(t)return await(async()=>(await Sr(),!0))(),void 0;if(Se)try{Se.status?.toLowerCase()!=="closed"&&await Sr();const de=Object.entries(Ir).filter(([,rt])=>rt).map(([rt])=>rt).join(","),he=await ve.get(`/api/sales-orders/${Se.sales_order_id}/pdf`,{responseType:"blob",params:{visibleFields:de}}),Ee=window.URL.createObjectURL(new Blob([he.data],{type:"application/pdf"})),ke=document.createElement("a");ke.href=Ee,ke.download=`sales_order_${Se.sales_order_number}.pdf`,document.body.appendChild(ke),ke.click(),ke.remove(),window.URL.revokeObjectURL(Ee),me.success(Se.status?.toLowerCase()==="closed"?"PDF downloaded.":"Saved and downloaded PDF.")}catch(de){const he=de?.response?.data?.error||de?.response?.data?.details||de?.response?.data?.message||"Failed to save or download PDF.";ii(he)}},ra=async()=>{if(Se){Oi(!0);try{const de=await ve.post(`/api/invoices/from-sales-order/${Se.sales_order_id}`),he=de.data?.invoice_id||de.data?.id||de.data?.invoice?.invoice_id;me.success("Invoice created from this sales order"),he&&n(`/invoices/${he}`),Ge(Ee=>Ee&&{...Ee,invoice_status:"done"})}catch(de){console.error("Failed to create invoice",de);const he=de?.response?.data?.error||"Failed to create invoice";me.error(he)}finally{Oi(!1)}}},$a=async()=>{if(!(t||!Se)){if(Ar.some(de=>parseFloat(String(de.quantity_to_order))>0)){const de=Ar.filter(he=>parseFloat(String(he.quantity_to_order))>0).map(he=>`${he.part_number} (${he.quantity_to_order})`).join(", ");me.error(`Cannot export to QuickBooks: parts to order exist: ${de}`);return}ai(!0),Fa(null),uo(null);try{const de=await ve.post(`/api/sales-orders/${Se.sales_order_id}/export-to-qbo`);uo("Sales Order exported to QuickBooks successfully!"),Ge(he=>he&&{...he,exported_to_qbo:!0,qbo_invoice_id:de.data.qbo_invoice_id,qbo_export_date:new Date().toISOString(),qbo_export_status:"Success"}),me.success("Exported to QuickBooks.")}catch(de){const he=de?.response?.data;if(he?.error==="CUSTOMER_NOT_FOUND")if(window.confirm(`Customer '${he.customerName}' does not exist in QuickBooks.
Create it and export the Sales Order?`))try{const ke=await ve.post(`/api/sales-orders/${Se.sales_order_id}/export-to-qbo-with-customer`,{customerData:he.customerData});me.success("Customer created and Sales Order exported."),uo("Customer created and Sales Order exported."),Ge(rt=>rt&&{...rt,exported_to_qbo:!0,qbo_invoice_id:ke.data.qbo_invoice_id,qbo_export_date:new Date().toISOString(),qbo_export_status:"Success"})}catch(ke){const rt=ke?.response?.data?.error||"Failed to create customer and export to QuickBooks.";Fa(rt),me.error(rt)}else Fa("Export cancelled. Customer must exist in QuickBooks.");else{const Ee=he?.error||he?.message||"Failed to export to QuickBooks.";Fa(Ee),me.error(Ee)}}finally{ai(!1)}}},Na=async()=>{Yn(!0);try{const de=await ve.get("/api/sales-orders");jr(de.data)}catch{me.error("Failed to fetch sales orders for import")}finally{Yn(!1)}},fo=()=>{kt(!0),Na()},ki=async()=>{if(zr){Yn(!0);try{const de=await ve.get(`/api/sales-orders/${zr.sales_order_id}`),ke=(de.data.lineItems||de.data.salesOrder?.line_items||[]).filter(rt=>(rt.part_number||"").toUpperCase()!=="LABOUR").map(rt=>({part_number:rt.part_number,part_description:rt.part_description,quantity:String(t?rt.quantity:rt.quantity_sold??rt.quantity??0),unit:rt.unit,unit_price:rt.unit_price,gst:Cc,line_amount:rt.line_amount,part_id:rt.part_id??void 0}));St(ke),kt(!1),fn(null),me.success("Line items imported!")}catch{me.error("Failed to import line items")}finally{Yn(!1)}}},No=de=>{const he=P.trim(),Ee=de.key==="Enter",ke=de.key==="Tab";if(de.key==="Escape"){S(!1);return}if(Ee||ke){if(Ee&&de.ctrlKey&&he){de.preventDefault(),M(!0),be(he),Ui(!0);return}if(T||!he)return;de.preventDefault();const _t=Ai(he);_t?(A(_t),E(_t.label)):(M(!0),be(he),Ui(!0))}},uu=de=>{if(de.key!=="Enter")return;de.preventDefault();const he=X.trim();if(!he)return;const Ee=u.find(ke=>ke.label.toLowerCase()===he.toLowerCase());Ee?($(Ee),C(Ee.label)):(De(he),Ie(!0))},mc=()=>{if(!Se)return null;const de=at||[];let he=de.reduce((rt,_t)=>rt+(Number(_t.line_amount)||0),0),Ee=he*.05,ke=he+Ee;return isNaN(he)&&(he=0),isNaN(Ee)&&(Ee=0),isNaN(ke)&&(ke=0),i.jsxs(Z,{p:{xs:2,md:4},maxWidth:1e3,mx:"auto",children:[zi&&i.jsx(Pt,{severity:"success",sx:{mb:2},onClose:()=>uo(null),children:zi}),Ia&&i.jsx(Pt,{severity:"error",sx:{mb:2},onClose:()=>Fa(null),children:Ia}),i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Sales Order Details"}),i.jsx(Rr,{variant:"outlined",sx:{mb:3},children:i.jsx(Hr,{children:i.jsxs(ie,{container:!0,spacing:{xs:2,md:3},children:[i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Sales Order #:"})," ",Se.sales_order_number]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Customer:"})," ",Se.customer_name||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Sales Date:"})," ",Se.sales_date?new Date(Se.sales_date).toLocaleDateString():""]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Wanted By:"})," ",Se.wanted_by_date?new Date(Se.wanted_by_date).toLocaleDateString():"N/A",Se.wanted_by_time_of_day?` (${String(Se.wanted_by_time_of_day).charAt(0).toUpperCase()}${String(Se.wanted_by_time_of_day).slice(1)})`:""]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Status:"})," ",Se.status?.toUpperCase()||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"VIN #:"})," ",Se.vin_number||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Unit #:"})," ",Se.unit_number||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Mileage:"})," ",Se.mileage??"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Make:"})," ",Se.vehicle_make||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Model:"})," ",Se.vehicle_model||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Invoice:"})," ",Se.invoice_status==="done"&&i.jsxs(Z,{component:"span",sx:{display:"inline-flex",alignItems:"center",gap:.5},children:[i.jsx(nc,{color:"success",fontSize:"small"})," Done"]}),Se.invoice_status==="needed"&&i.jsxs(Z,{component:"span",sx:{display:"inline-flex",alignItems:"center",gap:.5},children:[i.jsx($w,{color:"error",fontSize:"small"})," Needed"]}),!Se.invoice_status&&""]}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx("b",{children:"Estimated Price:"})," ",za(Se.estimated_cost||0)]}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx("b",{children:"Product Description:"})," ",Se.product_description||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx("b",{children:"Tech Story:"}),i.jsx(Z,{sx:{whiteSpace:"pre-line",mt:.5},children:Se.tech_story||"N/A"})]}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx("b",{children:"Terms:"})," ",Se.terms||"N/A"]}),Se.exported_to_qbo&&i.jsxs(ie,{item:!0,xs:12,children:[i.jsx("b",{children:"QBO Export:"})," Exported",Se.qbo_invoice_id&&` (Invoice ID: ${Se.qbo_invoice_id})`,Se.qbo_export_date&&` on ${new Date(Se.qbo_export_date).toLocaleDateString()}`]})]})})}),i.jsx(B,{variant:"h5",gutterBottom:!0,children:"Items"}),i.jsx(Rr,{variant:"outlined",children:i.jsx(Hr,{children:de.map((rt,_t)=>i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:3,md:2,children:rt.part_number}),i.jsx(ie,{item:!0,xs:6,sm:5,md:4,children:rt.part_description}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1.5,children:rt.quantity}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1.5,children:rt.unit}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1.5,children:za(rt.unit_price)}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1,children:za(rt.line_amount)})]},_t))})}),i.jsxs(Z,{mt:4,display:"flex",flexDirection:"column",alignItems:"flex-end",children:[i.jsxs(B,{variant:"h6",children:["Subtotal: ",za(he)]}),i.jsxs(B,{variant:"h6",children:["Total GST: ",za(Ee)]}),i.jsxs(B,{variant:"h6",children:["Total Amount: ",za(ke)]})]}),i.jsxs(Z,{mt:4,display:"flex",justifyContent:{xs:"center",sm:"flex-end"},gap:2,children:[i.jsx(xe,{variant:"contained",color:"primary",startIcon:i.jsx(la,{}),onClick:Un,children:"Download PDF"}),!Se.exported_to_qbo&&i.jsx(xe,{variant:"contained",color:"success",startIcon:i.jsx(Cp,{}),disabled:Pi,onClick:$a,children:Pi?"Exporting...":"Export to QuickBooks"}),i.jsx(xe,{variant:"contained",color:"secondary",startIcon:i.jsx(Sv,{}),onClick:ra,disabled:Io,children:Io?"Creating Invoice...":"Create Invoice"}),a?.access_role!=="Sales and Purchase"&&i.jsx(xe,{variant:"contained",color:"primary",onClick:Dn,children:"Reopen SO"})]})]})};if(!t&&_e)return i.jsxs(rr,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(er,{}),i.jsx(B,{children:"Loading sales order..."})]});if(!t&&nt)return i.jsxs(rr,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(Pt,{severity:"error",sx:{mb:2},children:nt}),i.jsx(xe,{variant:"contained",onClick:()=>window.location.reload(),sx:{mr:2},children:"Retry"}),i.jsx(xe,{variant:"outlined",onClick:()=>n("/open-sales-orders"),children:"Back to Sales Orders"})]});if(!t&&Xe&&a?.access_role==="Sales and Purchase")return i.jsxs(rr,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(Pt,{severity:"error",sx:{mb:2},children:"Access Denied: Sales and Purchase users cannot view closed sales orders."}),i.jsx(xe,{variant:"outlined",onClick:()=>n("/open-sales-orders"),children:"Back to Sales Orders"})]});if(!t&&Xe)return mc();const Pl=[{key:"customer",element:i.jsx(Ra,{open:T,onOpen:()=>S(!0),onClose:()=>S(!1),autoHighlight:!0,value:w,onChange:(de,he)=>{if(O){M(!1);return}he&&he.isNew?(Ui(!0),be(P),A(null),E(""),S(!1)):(A(he),S(!1))},inputValue:P,onInputChange:(de,he,Ee)=>{if(E(he),I&&window.clearTimeout(I),Ee==="reset")return;if((he||"").trim().length>0){const rt=window.setTimeout(()=>S(!0),200);U(rt)}else S(!1)},options:l,filterOptions:(de,he)=>{const Ee=lde(de,he.inputValue||""),ke=!!Ai(he.inputValue||""),rt=[...Ee];return(he.inputValue||"").trim()!==""&&!ke&&rt.push({label:`Add "${he.inputValue}" as New Customer`,isNew:!0}),rt},getOptionLabel:de=>typeof de=="string"?de:de.label,isOptionEqualToValue:(de,he)=>de.id===he.id,renderOption:(de,he)=>{const Ee=he.isNew,{key:ke,...rt}=de;return i.jsxs("li",{...rt,style:{display:"flex",alignItems:"center",opacity:Ee?.9:1},children:[Ee&&i.jsx(Zl,{fontSize:"small",style:{marginRight:8,color:"#666"}}),i.jsx("span",{children:he.label})]},ke)},renderInput:de=>i.jsx(Pe,{...de,label:"Customer",required:!0,onFocus:pc,onKeyDown:No,onBlur:()=>{if(!w){const he=P.trim();if(he){const Ee=Ai(he);Ee&&(A(Ee),E(Ee.label))}}},inputRef:he=>{L.current=he}})})},Ir.customerPoNumber?{key:"customerPoNumber",element:i.jsx(Pe,{label:"Customer PO #",value:le,onChange:de=>V(de.target.value),fullWidth:!0,placeholder:"Optional"})}:null,Ir.sourceQuote?{key:"sourceQuote",element:i.jsx(Pe,{label:"Source Quote #",value:Ue||"",placeholder:"Not converted from a quote",fullWidth:!0,InputProps:{readOnly:!0}})}:null,!o&&Ir.quotedPrice?{key:"quotedPrice",element:i.jsx(Pe,{label:"Quoted Price",type:"number",value:He??"",onChange:de=>Je(de.target.value?parseFloat(de.target.value):null),fullWidth:!0,InputProps:{startAdornment:i.jsx(aa,{position:"start",children:"$"})},inputProps:{onWheel:de=>de.currentTarget.blur()}})}:null].filter(Boolean),Ol=Fs?i.jsx(Ra,{freeSolo:!0,options:hc,loading:K,value:Ve,onInputChange:(de,he)=>Me(he),onChange:(de,he,Ee)=>{if(Ee==="clear"){Me("");return}Si(void 0,typeof he=="string"?he:he??"")},renderInput:de=>i.jsx(Pe,{...de,label:"VIN #",fullWidth:!0,placeholder:"Optional"})}):i.jsx(Pe,{label:"VIN #",value:Ve,onChange:de=>Me(de.target.value),fullWidth:!0,placeholder:"Optional"}),gc=Fs?i.jsx(Ra,{freeSolo:!0,options:$s,loading:K,value:Fe,onInputChange:(de,he)=>Qe(he),onChange:(de,he,Ee)=>{if(Ee==="clear"){Qe("");return}Si(typeof he=="string"?he:he??"",void 0)},renderInput:de=>i.jsx(Pe,{...de,label:"Unit #",fullWidth:!0,placeholder:"Optional"})}):i.jsx(Pe,{label:"Unit #",value:Fe,onChange:de=>Qe(de.target.value),fullWidth:!0,placeholder:"Optional"}),kl=[Ir.vin?{key:"vin",element:Ol}:null,Ir.unitNumber?{key:"unitNumber",element:gc}:null,Ir.vehicleMake?{key:"vehicleMake",element:i.jsx(Pe,{label:"Make",value:it,onChange:de=>st(de.target.value),fullWidth:!0,placeholder:"Optional"})}:null,Ir.vehicleModel?{key:"vehicleModel",element:i.jsx(Pe,{label:"Model",value:vt,onChange:de=>Ye(de.target.value),fullWidth:!0,placeholder:"Optional"})}:null,Ir.mileage?{key:"mileage",element:i.jsx(Pe,{label:"Mileage",type:"number",value:Ze===""?"":Ze,onChange:de=>We(de.target.value===""?"":Number(de.target.value)),fullWidth:!0,placeholder:"Optional",inputProps:{min:0,step:1}})}:null].filter(Boolean),zs=[{key:"salesDate",element:i.jsx(os,{label:"Sales Date",value:se,onChange:oe,sx:{width:"100%"},slotProps:{textField:{fullWidth:!0,required:!0}}})},Ir.wantedByDate?{key:"wantedByDate",element:i.jsx(os,{label:"Wanted By Date",value:ae,onChange:pe,sx:{width:"100%"},slotProps:{textField:{placeholder:"Optional",fullWidth:!0}}})}:null,Ir.wantedByTimeOfDay?{key:"wantedTimeOfDay",element:i.jsxs(tn,{component:"fieldset",fullWidth:!0,children:[i.jsx(r5,{sx:{mb:1},children:"Wanted Time of Day"}),i.jsxs(q2,{value:Ot||null,exclusive:!0,fullWidth:!0,size:"small",color:"standard","aria-label":"Wanted time of day",onChange:(de,he)=>Wt(he||""),sx:{"& .MuiToggleButtonGroup-grouped":{textTransform:"none",flex:1,gap:0},"& .MuiToggleButtonGroup-grouped:not(:first-of-type)":{marginLeft:0}},children:[i.jsx(al,{value:"morning",children:"Morning"}),i.jsx(al,{value:"afternoon",children:"Afternoon"}),i.jsx(al,{value:"evening",children:"Evening"})]})]})}:null].filter(Boolean),ua=[Ir.invoiceStatus?{key:"invoiceStatus",element:i.jsxs(tn,{component:"fieldset",fullWidth:!0,children:[i.jsx(r5,{sx:{mb:1},children:"Invoice"}),i.jsxs(q2,{value:wt||null,exclusive:!0,fullWidth:!0,size:"small",color:"standard","aria-label":"Invoice status",onChange:$e,sx:{"& .MuiToggleButtonGroup-grouped":{textTransform:"none",flex:1,gap:0},"& .MuiToggleButtonGroup-grouped:not(:first-of-type)":{marginLeft:0},"& .MuiToggleButtonGroup-grouped.Mui-selected":{color:"#fff"},"& .MuiToggleButtonGroup-grouped.Mui-selected.MuiToggleButton-colorError":{bgcolor:de=>de.palette.error.main,"&:hover":{bgcolor:de=>de.palette.error.dark}},"& .MuiToggleButtonGroup-grouped.Mui-selected.MuiToggleButton-colorSuccess":{bgcolor:de=>de.palette.success.main,"&:hover":{bgcolor:de=>de.palette.success.dark}}},children:[i.jsxs(al,{value:"needed",color:"error",children:[i.jsx($w,{fontSize:"small",sx:{mr:1}}),"Needed"]}),i.jsxs(al,{value:"done",color:"success",children:[i.jsx(nc,{fontSize:"small",sx:{mr:1}}),"Done"]})]})]})}:null,Ir.terms?{key:"terms",element:i.jsx(Pe,{label:"Terms",value:G,onChange:de=>ee(de.target.value),fullWidth:!0,multiline:!0,minRows:3,maxRows:8,placeholder:"Enter payment/delivery terms, etc."})}:null].filter(Boolean),El=cde(ua.length||1);return i.jsxs(Os,{dateAdapter:oc,children:[i.jsx(Ry,{when:wi,onSave:Sr}),i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",component:"h1",children:t?"Create Sales Order":`Edit Sales Order${Se?.sales_order_number?`: ${Se.sales_order_number}`:""}`}),i.jsxs(ut,{direction:"row",spacing:1,children:[i.jsx(xe,{variant:"outlined",startIcon:i.jsx(ode,{}),onClick:En,children:"Customize Fields"}),t&&i.jsx(xe,{variant:"outlined",onClick:()=>{A(null),E(""),oe(Rt()),pe(null),Wt(""),$(null),C(""),Q(""),ee(""),V(""),Me(""),Qe(""),st(""),Ye(""),It(""),We(""),Je(null),St([{part_number:"",part_description:"",quantity:"",unit:Fm[0],unit_price:0,gst:Cc,line_amount:0}]),ii(null)},children:"Reset"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:Sr,children:t?"Save Sales Order":"Save Changes"}),!t&&i.jsxs(i.Fragment,{children:[a?.access_role!=="Sales and Purchase"&&i.jsx(xe,{variant:"contained",startIcon:i.jsx(xv,{}),onClick:Kr,children:"Close SO"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(la,{}),onClick:Un,children:"Download PDF"})]})]})]}),i.jsx(Iv,{open:!!dn,anchorEl:dn,onClose:Zt,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:i.jsxs(Z,{sx:{p:2,width:280},children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"Show / Hide Optional Fields"}),i.jsx(Ep,{children:[{key:"customerPoNumber",label:"Customer PO #"},{key:"quotedPrice",label:"Quoted Price"},{key:"sourceQuote",label:"Source Quote #"},{key:"vin",label:"VIN #"},{key:"unitNumber",label:"Unit #"},{key:"mileage",label:"Mileage"},{key:"vehicleMake",label:"Make"},{key:"vehicleModel",label:"Model"},{key:"invoiceStatus",label:"Invoice Status"},{key:"wantedByDate",label:"Wanted By Date"},{key:"wantedByTimeOfDay",label:"Wanted Time of Day"},{key:"productDescription",label:"Product Description"},{key:"techStory",label:"Tech Story"},{key:"terms",label:"Terms"},{key:"techStory",label:"Tech Story"}].filter(({key:de})=>tr[de]).filter(({key:de})=>!(s&&["quotedPrice","invoiceStatus","terms"].includes(de))).map(({key:de,label:he})=>i.jsx(ui,{control:i.jsx(Xi,{size:"small",checked:!!Or[de],onChange:Ee=>Dr(ke=>({...ke,[de]:Ee.target.checked}))}),label:he},de))})]})}),i.jsx(Z,{sx:{mb:2},children:i.jsx(xe,{variant:"outlined",color:"secondary",onClick:fo,children:"Import Line Items"})}),i.jsxs(dr,{open:pt,onClose:()=>kt(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(fr,{children:"Import Line Items from Sales Order"}),i.jsx(hr,{children:ta?i.jsx(Z,{display:"flex",alignItems:"center",justifyContent:"center",minHeight:120,children:i.jsx(er,{})}):i.jsx(Ra,{options:Lt,getOptionLabel:de=>{if(!de)return"";const he=de.sales_order_number||"",Ee=de.customer_name||"",ke=de.status||"";return`${he} - ${Ee}${ke?` (${ke})`:""}`},value:zr,onChange:(de,he)=>fn(he),renderInput:de=>i.jsx(Pe,{...de,label:"Select Sales Order",fullWidth:!0}),isOptionEqualToValue:(de,he)=>de.sales_order_id===he?.sales_order_id})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:()=>kt(!1),children:"Cancel"}),i.jsx(xe,{onClick:ki,disabled:!zr||ta,variant:"contained",children:"Import"})]})]}),ps&&i.jsxs(Pt,{severity:"warning",sx:{mb:3},onClose:()=>ii(null),children:[i.jsx(B,{variant:"body1",sx:{fontWeight:"medium"},children:"Inventory Error"}),i.jsx(B,{variant:"body2",children:ps})]}),i.jsx(Z,{sx:{transform:Bn?`translateY(-${Bn}px)`:"none",transition:"transform 200ms ease"},children:i.jsxs(bt,{sx:Yo,elevation:3,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Customer Information"}),Pl.length?i.jsx(Z,{sx:yr,children:Pl.map(de=>i.jsx(Z,{children:de.element},de.key))}):i.jsx(B,{variant:"body2",color:"text.secondary",children:"No customer fields are enabled."})]})}),kl.length?i.jsxs(bt,{sx:Yo,elevation:3,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Vehicle Details"}),i.jsx(Z,{sx:Cl,children:kl.map(de=>i.jsx(Z,{children:de.element},de.key))})]}):null,i.jsxs(bt,{sx:Yo,elevation:3,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Job & Schedule"}),zs.length?i.jsx(Z,{sx:{...fc,mb:2},children:zs.map(de=>i.jsx(Z,{children:de.element},de.key))}):null,i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ra,{disablePortal:!0,open:N,onOpen:()=>H(!0),onClose:()=>H(!1),autoHighlight:!0,value:k,onChange:(de,he)=>{if(he&&he.isNew){const Ee=he.inputValue?.toString?.()||X.trim();Ie(!0),De(Ee),$(null),C(""),H(!1)}else $(he),H(!1)},inputValue:X,onInputChange:(de,he,Ee)=>{if(C(he),De(he),W&&window.clearTimeout(W),Ee==="reset")return;if((he||"").trim().length>0){const rt=window.setTimeout(()=>H(!0),200);ne(rt)}else H(!1)},options:u,filterOptions:(de,he)=>{const Ee=de.filter(ke=>ke.label.toLowerCase().includes((he.inputValue||"").toLowerCase()));return(he.inputValue||"")!==""&&!de.some(ke=>ke.label.toLowerCase()===(he.inputValue||"").toLowerCase())&&Ee.push({label:`Add "${he.inputValue}"`,isNew:!0,inputValue:he.inputValue}),Ee},getOptionLabel:de=>typeof de=="string"?de:de.label,renderInput:de=>i.jsx(Pe,{...de,label:"Product Name",required:!0,onKeyDown:uu,onBlur:()=>{if(H(!1),!k){const he=X.trim();if(he){const Ee=u.find(ke=>ke.label.toLowerCase()===he.toLowerCase());Ee&&($(Ee),C(Ee.label))}}}}),disabled:!1})}),Ir.productDescription&&i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Product Description",value:ge,onChange:de=>Q(de.target.value),fullWidth:!0,multiline:!0,minRows:2,maxRows:6})}),Ir.techStory&&i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Tech Story",value:jt,onChange:de=>lr(de.target.value),fullWidth:!0,multiline:!0,minRows:4,maxRows:12,placeholder:"Add technician notes for this sales order"})})]})]}),ua.length?i.jsxs(bt,{sx:Yo,elevation:3,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Invoice Status"}),i.jsx(ie,{container:!0,spacing:2,children:ua.map(de=>i.jsx(ie,{item:!0,xs:12,sm:ua.length>1?6:12,md:El,children:de.element},de.key))})]}):null,i.jsxs(Z,{sx:{position:"relative",zIndex:1e3,transform:Bn?`translateY(-${Bn}px)`:"none",transition:"transform 200ms ease"},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Line Items"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Each part number can only appear once. Edit existing line items to change quantities."})]}),i.jsxs(Z,{sx:{position:"relative",mb:3},children:[!t&&qr.length>0&&i.jsx(Z,{sx:{position:"absolute",bottom:"calc(100% + 8px)",left:0,right:0,zIndex:500,display:"flex",flexDirection:"column",gap:1,pointerEvents:"none"},children:qr.map((de,he)=>i.jsx(Pt,{severity:"warning",sx:{width:"100%",boxShadow:2,pointerEvents:"auto","& .MuiAlert-message":{width:"100%",padding:0}},children:i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{width:"100%"},children:[i.jsxs(Z,{children:[i.jsxs(B,{variant:"body2",fontWeight:"medium",children:["Insufficient stock for ",de.partNumber]}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Excess quantity: ",de.excessQuantity," ",de.unit]})]}),i.jsxs(xe,{variant:"contained",size:"small",sx:{whiteSpace:"nowrap"},onClick:()=>Mr(de),children:["Transfer ",de.excessQuantity," to Parts to Order"]})]})},`${de.lineItemIndex}-${he}`))}),i.jsxs(dr,{open:!!wn,onClose:()=>Mr(null),maxWidth:"xs",fullWidth:!0,children:[i.jsx(fr,{children:"Transfer to Parts to Order"}),i.jsx(hr,{children:wn&&i.jsxs(B,{variant:"body2",children:["Transfer ",wn.excessQuantity," ",wn.unit," of ",wn.partNumber," to Parts to Order?"]})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:()=>Mr(null),children:"Cancel"}),i.jsx(xe,{variant:"contained",onClick:()=>{if(!wn)return;const de=wn,he=at[de.lineItemIndex],Ee=de.excessQuantity,ke=f.find(Bt=>Bt.part_number.toLowerCase()===he.part_number.toLowerCase()),rt={sales_order_id:Se?.sales_order_id||0,part_number:he.part_number,part_description:he.part_description,quantity_to_order:String(Ee),unit:he.unit,unit_price:ke?.last_unit_cost||0,line_amount:(ke?.last_unit_cost||0)*Ee};$r(Bt=>[...Bt,rt]);const _t=Math.max(0,(parseFloat(String(he.quantity).replace(/[^\d.-]/g,""))||0)-Ee);St(Bt=>Bt.map((Nt,cr)=>cr===de.lineItemIndex?{...Nt,quantity:String(_t)}:Nt)),kr(Bt=>Bt.filter(Nt=>Nt.lineItemIndex!==de.lineItemIndex)),Mr(null),me.success(`Transferred ${Ee} ${he.unit} of ${he.part_number} to parts to order`)},children:"Confirm"})]})]}),i.jsxs(bt,{sx:{p:3,mb:3},elevation:3,children:[i.jsx(ie,{container:!0,spacing:2,children:at.map((de,he)=>({item:de,originalIndex:he})).sort((de,he)=>{const Ee=["LABOUR","OVERHEAD","SUPPLY"].includes(de.item.part_number),ke=["LABOUR","OVERHEAD","SUPPLY"].includes(he.item.part_number);return Ee&&!ke?1:!Ee&&ke?-1:0}).map(({item:de,originalIndex:he})=>i.jsxs(Ae.Fragment,{children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:Xr.partNumber,children:i.jsx(Ra,{open:Zn===he,onOpen:()=>xn(he),onClose:()=>xn(null),autoHighlight:!0,inputValue:de.part_number,onChange:(Ee,ke)=>{if(typeof ke=="string"){const rt=at.findIndex((_t,Bt)=>Bt!==he&&_t.part_number.trim().toLowerCase()===ke.trim().toLowerCase());if(rt!==-1){me.error(`Part "${ke}" already exists as line item ${rt+1}. Edit that line item instead.`),St(_t=>_t.map((Bt,Nt)=>Nt===he?{...Bt,part_number:"",part_description:""}:Bt)),xn(null);return}Ce(he,ke),xn(null)}else if(ke&&typeof ke=="object"&&"isNew"in ke){const rt=ke.inputValue||"";$i(String(rt).toUpperCase()),hi(he),ji(!0),xn(null)}},onInputChange:(Ee,ke,rt)=>{if(rt==="reset")return;const _t=(ke||"").trim();if(St(Bt=>Bt.map((Nt,cr)=>cr===he?{...Nt,part_number:_t}:Nt)),Ea&&window.clearTimeout(Ea),_t.length>0){const Bt=window.setTimeout(()=>xn(he),200);Ta(Bt)}else xn(null)},options:f.filter(Ee=>Ee.part_type!=="supply").map(Ee=>Ee.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,filterOptions:(Ee,ke)=>Eo(Ee,ke,!0),renderOption:(Ee,ke)=>{const rt=typeof ke=="object"&&ke.isNew,_t=typeof ke=="string"?ke:ke.label,{key:Bt,...Nt}=Ee;return i.jsxs("li",{...Nt,children:[rt&&i.jsx(Zl,{fontSize:"small",style:{marginRight:8,color:"#666"}}),typeof ke=="string"?i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",children:ke}),(()=>{const cr=co[String(ke)]||"";return cr?i.jsx(B,{variant:"caption",color:"text.secondary",children:cr}):null})()]}):_t]},Bt)},renderInput:Ee=>i.jsx(Pe,{...Ee,label:"Part Number",required:!0,fullWidth:!0,onKeyDown:ke=>To(he,ke),onBlur:()=>xn(null)}),onBlur:()=>{const Ee=at[he]?.part_number?.trim().toUpperCase();if(!Ee)return;f.find(rt=>rt.part_number===Ee)?Ce(he,Ee):(hi(he),$i(Ee),ji(!0),xn(null))}})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:Xr.description,children:i.jsx(Pe,{label:"Part Description",value:de.part_description,fullWidth:!0,required:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:Xr.quantity,children:i.jsx(Pe,{label:"Qty",value:de.quantity,onChange:Ee=>Ne(he,"quantity",Ee.target.value),type:"number",fullWidth:!0,required:!0,InputProps:{readOnly:["SUPPLY","LABOUR","OVERHEAD"].includes(de.part_number),disabled:["SUPPLY","LABOUR","OVERHEAD"].includes(de.part_number)},inputProps:{step:1,onWheel:Ee=>Ee.target.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:Xr.availability,children:i.jsx(Pe,{label:"Avail",value:(()=>{const Ee=zt[he];return Ee?Ee.available<0?`${Ee.available} (Insufficient)`:String(Ee.available):"N/A"})(),fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:(()=>{const Ee=zt[he];return Ee?Ee.available>=0?"#e8f5e8":"#ffeaea":"#f5f5f5"})(),"& .MuiInputBase-input":{color:zt[he]?.isNegative?"#d32f2f":"#2e7d32"}}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:Xr.unit,children:i.jsx(Pe,{label:"Unit",value:de.part_number==="SUPPLY"?"":de.unit,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),!s&&i.jsx(ie,{item:!0,xs:12,sm:2,md:Xr.unitCost,children:i.jsx(Pe,{label:"Unit Cost",value:de.part_number==="LABOUR"?p??0:de.part_number==="OVERHEAD"?m??0:de.part_number==="SUPPLY"?"":de.unit_price,type:"number",fullWidth:!0,InputProps:{readOnly:!0,startAdornment:de.part_number!=="SUPPLY"?i.jsx(aa,{position:"start",children:"$"}):void 0,disabled:["LABOUR","OVERHEAD","SUPPLY"].includes(de.part_number)}})}),!s&&i.jsx(ie,{item:!0,xs:6,sm:3,md:Xr.amount,children:i.jsx(Pe,{label:"Amount",value:de.line_amount!=null&&!isNaN(Number(de.line_amount))?Number(de.line_amount).toFixed(2):"0.00",InputProps:{readOnly:!0},fullWidth:!0})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:Xr.actions,sx:{display:"flex",alignItems:"center"},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:()=>dt(he),fullWidth:!0,children:"Remove"})})]},he))}),i.jsx(Z,{sx:{mt:2},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:Ke,children:"Add Line Item"})})]})]}),!s&&i.jsx(bt,{sx:{p:3,mb:3},elevation:3,children:i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Subtotal: ",za(Tn)]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Total GST: ",za(Wr)]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"h6",children:["Total Amount: ",za(en)]})})]})}),!t&&i.jsxs(bt,{sx:{p:3,mb:3,elevation:3,border:"2px solid #b8860b","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#b8860b"},"&:hover fieldset":{borderColor:"#b8860b"}}},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Parts to Order"}),i.jsx(B,{variant:"body2",color:"textSecondary",sx:{mb:2},children:"Add parts that need to be ordered for this sales order. These quantities are aggregated across all sales orders."}),i.jsx(ie,{container:!0,spacing:2,children:Ar.map((de,he)=>i.jsxs(Ae.Fragment,{children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Ra,{open:Cn===he,onOpen:()=>Gr(he),onClose:()=>Gr(null),autoHighlight:!0,value:de.part_number,onChange:(Ee,ke)=>{if(!ke){$r(rt=>{const _t=[...rt];return _t[he]={..._t[he],part_number:"",part_description:"",unit:"Each",unit_price:0,line_amount:0},_t});return}if(typeof ke=="string"){const rt=f.find(_t=>_t.part_number===ke);if(rt){const Bt=parseFloat(String(rt.last_unit_cost))||0;$r(Nt=>{const cr=[...Nt];return cr[he]={...cr[he],part_number:rt.part_number,part_description:rt.part_description,unit:rt.unit||"Each",unit_price:Bt,line_amount:0},cr})}else{$r(Bt=>{const Nt=[...Bt];return Nt[he]={...Nt[he],part_number:ke,part_description:"",unit:"Each",unit_price:0,line_amount:0},Nt});const _t=String(ke).toUpperCase();Ya(he),ri(_t),so(!0)}}else if(ke&&typeof ke=="object"&&"isNew"in ke){const rt=String(ke.inputValue||"").toUpperCase();Ya(he),ri(rt),so(!0)}},onInputChange:(Ee,ke,rt)=>{if($r(Bt=>{const Nt=[...Bt];return Nt[he]={...Nt[he],part_number:(ke||"").toUpperCase()},Nt}),Ea&&window.clearTimeout(Ea),rt==="reset")return;if((ke||"").trim().length>0){const Bt=window.setTimeout(()=>Gr(he),200);Ta(Bt)}else Gr(null)},options:f.filter(Ee=>Ee.part_type!=="supply").map(Ee=>Ee.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,filterOptions:(Ee,ke)=>Eo(Ee,ke,!0),renderOption:(Ee,ke)=>{const rt=typeof ke=="object"&&ke.isNew,_t=typeof ke=="string"?ke:ke.label,{key:Bt,...Nt}=Ee;return i.jsxs("li",{...Nt,children:[rt&&i.jsx(Zl,{fontSize:"small",style:{marginRight:8,color:"#666"}}),typeof ke=="string"?i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",children:ke}),(()=>{const cr=co[String(ke)]||"";return cr?i.jsx(B,{variant:"caption",color:"text.secondary",children:cr}):null})()]}):_t]},Bt)},renderInput:Ee=>i.jsx(Pe,{...Ee,label:"Part Number",fullWidth:!0,required:!0,onKeyDown:ke=>Al(he,ke),onBlur:()=>Gr(null)}),onBlur:()=>{const Ee=(Ar[he]?.part_number||"").trim().toUpperCase();if(!Ee)return;f.find(rt=>rt.part_number===Ee)||(Ya(he),ri(Ee),so(!0),Gr(null))}})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Pe,{label:"Description",value:de.part_description,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#f5f5f5"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Pe,{label:"Qty to Order",value:de.quantity_to_order,onChange:Ee=>{const ke=Ee.target.value;$r(rt=>{const _t=[...rt],Bt=parseFloat(ke)||0,Nt=_t[he].unit_price||0;return _t[he]={..._t[he],quantity_to_order:ke,line_amount:Bt*Nt},_t})},type:"number",fullWidth:!0,required:!0,inputProps:{step:1,min:0,onWheel:Ee=>Ee.target.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Pe,{label:"Unit",value:de.unit,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),i.jsx(ie,{item:!0,xs:12,sm:1.5,children:i.jsx(Pe,{label:"Unit Price",value:de.unit_price,type:"number",fullWidth:!0,InputProps:{readOnly:!0,startAdornment:i.jsx(aa,{position:"start",children:"$"})},sx:{backgroundColor:"#f5f5f5"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Amount",value:de.line_amount,InputProps:{readOnly:!0},fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:1,md:1,sx:{display:"flex",alignItems:"center",gap:2},children:i.jsx(xe,{variant:"outlined",onClick:()=>$r(Ee=>Ee.filter((ke,rt)=>rt!==he)),sx:{flexShrink:0,borderColor:"#b8860b",color:"#b8860b","&:hover":{borderColor:"#8b6914",backgroundColor:"#fff8dc"}},children:"Remove"})})]},he))}),i.jsx(Z,{sx:{mt:2},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:()=>$r(de=>[...de,{sales_order_id:Number(e)||0,part_number:"",part_description:"",quantity_to_order:"",unit:"Each",unit_price:0,line_amount:0}]),children:"Add Parts to Order Item"})})]}),i.jsx(Wd,{open:Bs,onClose:()=>Ui(!1),onSave:async de=>{try{const he=await ve.post("/api/customers",de),Ee={label:de.customer_name,id:he.data.customer_id};c(ke=>[...ke,Ee]),A(Ee),Ui(!1),me.success("Customer added successfully!")}catch{me.error("Failed to add customer.")}},initialCustomer:{customer_name:Us},isEditMode:!1}),i.jsx(bS,{open:je,onClose:()=>Ie(!1),onSave:async de=>{try{const he=await ve.post("/api/products",de),Ee={label:de.product_name,id:he.data.product_id,description:de.product_name};d(ke=>[...ke,Ee]),$(Ee),C(Ee.label),Ie(!1),De(""),me.success("Product added successfully!")}catch{me.error("Failed to add product.")}},initialProduct:{product_name:Le||X},isEditMode:!1}),!t&&i.jsxs(i.Fragment,{children:[Ia&&i.jsx(Pt,{severity:"error",sx:{mb:2},onClose:()=>Fa(null),children:Ia}),i.jsx(hl,{open:!!Mt,autoHideDuration:6e3,onClose:()=>Nr(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Pt,{onClose:()=>Nr(null),severity:"success",sx:{width:"100%"},children:Mt})}),Se?.status?.toLowerCase()==="closed"&&i.jsxs(Z,{display:"flex",justifyContent:"flex-end",gap:2,mb:2,children:[i.jsx(xe,{variant:"contained",color:"secondary",startIcon:i.jsx(Sv,{}),onClick:ra,disabled:Io,children:Io?"Creating Invoice...":"Create Invoice"}),!Se?.exported_to_qbo&&i.jsx(xe,{variant:"contained",color:"success",startIcon:i.jsx(Cp,{}),disabled:Pi,onClick:$a,children:Pi?"Exporting...":"Export to QuickBooks"}),a?.access_role!=="Sales and Purchase"&&i.jsx(xe,{variant:"outlined",onClick:Dn,children:"Reopen SO"})]})]})]}),i.jsx(ec,{open:io,onClose:()=>{ji(!1),hi(null),$i("")},onSave:async de=>{const he=await ve.post("/api/inventory",de),Ee=await ve.get("/api/inventory");h(Ee.data);const ke=he.data.item;oo!==null&&St(rt=>{const _t=[...rt],Nt=parseFloat(String(ke.last_unit_cost))||0;return _t[oo]={..._t[oo],part_number:ke.part_number,part_description:ke.part_description,unit:ke.unit||_t[oo].unit,unit_price:Nt},_t})},title:"Add New Part",initialPart:{part_number:Oo.toUpperCase(),category:"Uncategorized"}}),i.jsx(ec,{open:fs,onClose:()=>{so(!1),Ya(null),ri("")},onSave:async de=>{const he=await ve.post("/api/inventory",de),Ee=await ve.get("/api/inventory");h(Ee.data);const ke=he.data.item;hs!==null&&$r(rt=>{const _t=[...rt],Nt=parseFloat(String(ke.last_unit_cost))||0;return _t[hs]={..._t[hs],part_number:ke.part_number,part_description:ke.part_description,unit:ke.unit||"Each",unit_price:Nt},_t})},title:"Add New Part",initialPart:{part_number:lo.toUpperCase(),category:"Uncategorized"}})]})},dde=async e=>{try{return(await ve.get("/api/purchase-history",{params:e})).data}catch(t){throw console.error("Error fetching purchase orders:",t),t}},fde=async()=>ve.get("/api/purchase-history/csv-template",{responseType:"blob"}),hde=async e=>{const t=new FormData;return t.append("file",e),(await ve.post("/api/purchase-history/upload-csv",t,{headers:{"Content-Type":"multipart/form-data"}})).data},ET=()=>{const[e,t]=x.useState([]),[r,n]=x.useState(!0),[a,o]=x.useState(""),[s,l]=x.useState("open"),[c,u]=x.useState({page:0,pageSize:10}),[d,f]=x.useState(!1),h=x.useRef(null),p=kn();Ds();const{user:v}=Jn(),m=async()=>{n(!0);try{const S=(await ve.get("/api/purchase-history",{params:{status:s,searchTerm:a||void 0}})).data.sort((I,U)=>{const O=q=>{const z=q.match(/\d+/);return z?parseInt(z[0],10):0},M=O(I.purchase_number);return O(U.purchase_number)-M});t(S)}catch(T){console.error("Error fetching purchase orders:",T),t([]),me.error("Failed to fetch purchase orders")}finally{n(!1)}};x.useEffect(()=>{m()},[s,a]);const y=T=>{window.confirm("Are you sure you want to delete this purchase order?")&&b(T)},b=async T=>{try{await ve.delete(`/api/purchase-orders/${T}`),me.success("Purchase order deleted successfully"),m()}catch(S){console.error("Error deleting purchase order:",S),me.error("Failed to delete purchase order")}},_=()=>{let T=e;s==="open"?T=e.filter(O=>O.status==="Open"):s==="closed"&&(T=e.filter(O=>O.status==="Closed"));const S=Sl.unparse(T),I=new Blob([S],{type:"text/csv;charset=utf-8;"}),U=document.createElement("a");U.href=URL.createObjectURL(I),U.download=`purchase_orders_${Rt().format("YYYY-MM-DD")}.csv`,U.click()},w=async()=>{try{const T=await fde(),S=new Blob([T.data],{type:"text/csv"}),I=window.URL.createObjectURL(S),U=document.createElement("a");U.href=I,U.setAttribute("download","purchase_order_import_template.csv"),document.body.appendChild(U),U.click(),U.remove(),window.URL.revokeObjectURL(I)}catch(T){console.error("Error downloading template",T),me.error("Failed to download template")}},A=()=>{h.current?.click()},P=async T=>{const S=T.target.files?.[0];if(S){f(!0);try{const I=await hde(S);me.success(I?.message||"Purchase order CSV uploaded"),I?.warnings?.length&&me.warn(I.warnings.join("; ")),m()}catch(I){console.error("Error uploading purchase order CSV",I);const U=I?.response?.data?.error||"Failed to upload purchase order CSV";me.error(U)}finally{f(!1),T.target.value=""}}},E=[{field:"purchase_number",headerName:"Purchase #",flex:1,minWidth:120,valueFormatter:T=>T.value?String(T.value).replace("PO-",""):""},{field:"vendor_name",headerName:"Vendor",flex:1.3,minWidth:150},{field:"date",headerName:"Date",flex:.9,minWidth:130,valueFormatter:T=>T.value?new Date(T.value).toLocaleDateString():""},{field:"bill_number",headerName:"Bill #",flex:.9,minWidth:100},{field:"subtotal",headerName:"Subtotal",flex:.8,minWidth:100,valueFormatter:T=>T.value!=null&&!isNaN(Number(T.value))?`$${Number(T.value).toFixed(2)}`:"$0.00"},{field:"gst_rate",headerName:"GST Rate (%)",flex:.7,minWidth:80,valueFormatter:T=>T.value!=null&&!isNaN(Number(T.value))?`${Number(T.value).toFixed(2)}%`:"5.00%"},{field:"total_gst_amount",headerName:"GST",flex:.7,minWidth:80,valueFormatter:T=>T.value!=null&&!isNaN(Number(T.value))?`$${Number(T.value).toFixed(2)}`:"$0.00"},{field:"total_amount",headerName:"Total",flex:.8,minWidth:100,valueFormatter:T=>T.value!=null&&!isNaN(Number(T.value))?`$${Number(T.value).toFixed(2)}`:"$0.00"},{field:"status",headerName:"Status",flex:.8,minWidth:100,renderCell:T=>i.jsx(ot,{label:T.value,color:T.value==="Open"?"success":"error",size:"small",variant:"outlined"})},{field:"return_summary",headerName:"Returns",flex:.9,minWidth:150,sortable:!1,renderCell:T=>{const S=T.row.return_requested_count??0,I=T.row.return_returned_count??0;return!S&&!I?i.jsx(B,{variant:"body2",color:"text.secondary",children:"None"}):i.jsxs(ut,{direction:"row",spacing:1,children:[S>0&&i.jsx(ot,{label:`Requested ${S}`,color:"warning",size:"small",variant:"outlined"}),I>0&&i.jsx(ot,{label:`Returned ${I}`,color:"success",size:"small",variant:"outlined"})]})}},{field:"qbo_exported",headerName:"QBO Exported",flex:.8,minWidth:120,renderCell:T=>T.row.exported_to_qbo?i.jsx(nc,{color:"success",titleAccess:"Exported to QuickBooks"}):T.row.qbo_export_status?i.jsx(qy,{color:"error",titleAccess:`QBO Export Error: ${T.row.qbo_export_status}`}):T.row.status==="Closed"?i.jsx(aR,{color:"warning",titleAccess:"Not exported to QuickBooks"}):null},{field:"actions",headerName:"Actions",width:100,sortable:!1,renderCell:T=>i.jsx(Z,{sx:{display:"flex",gap:.5},children:T.row.status!=="Closed"&&i.jsx(vr,{size:"small",color:"error",onClick:S=>{S.stopPropagation(),y(T.row.purchase_id)},children:i.jsx(ga,{})})})}];return i.jsx(rr,{maxWidth:"xl",sx:{mt:4},children:i.jsxs(Z,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:s==="open"?"Open Purchase Orders":s==="closed"?"Purchase Order History":"All Purchase Orders"}),i.jsxs(ut,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[i.jsx("input",{type:"file",accept:".csv,text/csv",ref:h,style:{display:"none"},onChange:P}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:w,children:"PO Template"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Cd,{}),onClick:A,disabled:d,children:d?"Uploading...":"Upload PO CSV"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:()=>p("/open-purchase-orders/new"),children:"New PO"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:_,children:"Export CSV"})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsxs(ut,{direction:"row",spacing:3,sx:{mb:3},children:[i.jsx(Pe,{label:"Search",variant:"outlined",value:a,onChange:T=>o(T.target.value),InputProps:{startAdornment:i.jsx(aa,{position:"start",children:i.jsx(di,{sx:{fontSize:32}})}),sx:{fontSize:22,height:56}},sx:{minWidth:340,maxWidth:400,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"medium"}),i.jsx(ot,{label:"All",onClick:()=>l("all"),color:s==="all"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),i.jsx(ot,{label:"Open",onClick:()=>l("open"),color:s==="open"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),i.jsx(ot,{label:"Closed",onClick:()=>l("closed"),color:s==="closed"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}})]}),i.jsx(Po,{rows:e,columns:E,loading:r,paginationModel:c,onPaginationModelChange:u,pageSizeOptions:[10,25,50],getRowId:T=>T.purchase_id,disableRowSelectionOnClick:!0,initialState:{sorting:{sortModel:[{field:"purchase_number",sort:"desc"}]}},onRowClick:T=>{const S=T.row.status?.toLowerCase();p(S==="closed"?`/purchase-order/${T.row.purchase_id}`:`/open-purchase-orders/${T.row.purchase_id}`)},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"},cursor:"pointer"}})]})})]})})};var ah={},TT;function pde(){if(TT)return ah;TT=1;var e=ir();Object.defineProperty(ah,"__esModule",{value:!0}),ah.default=void 0;var t=e(sr()),r=or();return ah.default=(0,t.default)((0,r.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),ah}var mde=pde();const Hp=Et(mde),gde=async e=>{const t=Array.isArray(e)?e:[e];if(t.length===0)throw new Error("Please select at least one document to analyze.");const r=new FormData;return t.forEach(a=>r.append("documents",a)),t.length===1&&r.append("document",t[0]),(await ve.post("/api/purchase-orders/ocr/upload",r,{headers:{"Content-Type":"multipart/form-data"}})).data};var ih={},IT;function vde(){if(IT)return ih;IT=1;var e=ir();Object.defineProperty(ih,"__esModule",{value:!0}),ih.default=void 0;var t=e(sr()),r=or();return ih.default=(0,t.default)((0,r.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),ih}var yde=vde();const xde=Et(yde);var oh={},NT;function bde(){if(NT)return oh;NT=1;var e=ir();Object.defineProperty(oh,"__esModule",{value:!0}),oh.default=void 0;var t=e(sr()),r=or();return oh.default=(0,t.default)((0,r.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess"),oh}var _de=bde();const wde=Et(_de),jde=({open:e,onClose:t,purchaseOrderId:r,onSuccess:n,onAllocationSaved:a})=>{const[o,s]=x.useState(!1),[l,c]=x.useState(!1),[u,d]=x.useState(null),[f,h]=x.useState({}),[p,v]=x.useState({}),[m,y]=x.useState({}),[b,_]=x.useState(new Set),[w,A]=x.useState(new Set),[P,E]=x.useState(""),[T,S]=x.useState([]);x.useEffect(()=>{e&&r&&(d(null),h({}),v({}),y({}),_(new Set),S([]),A(new Set),E(""),I())},[e,r]);const I=async()=>{s(!0);try{const H=(await ve.get(`/api/purchase-history/${r}/allocation-suggestions`)).data;console.log("Allocation suggestions data:",H),console.log("Number of suggestions:",H.suggestions?.length),H.suggestions?.forEach((pe,ge)=>{console.log(`Suggestion ${ge}: ${pe.part_number} - ${pe.allocation_suggestions?.length} sales orders`),pe.allocation_suggestions?.forEach((Q,G)=>{console.log(`  Allocation ${G}: SO ${Q.sales_order_number}, current_quantity_needed: ${Q.current_quantity_needed}, is_needed: ${Q.is_needed}`)})});const W=new Set,ne=[];for(const pe of H.suggestions||[])try{console.log(`Checking part type for: ${pe.part_number}`);const ge=await XL(pe.part_number);console.log(`Part info for ${pe.part_number}:`,ge),ge.part_type==="supply"?(W.add(pe.part_number),console.log(`Filtering out supply part: ${pe.part_number}`)):(console.log(`Including stock part: ${pe.part_number} (type: ${ge.part_type})`),ne.push(pe))}catch(ge){console.warn(`Could not determine part type for ${pe.part_number}, including it:`,ge),ne.push(pe)}_(W),console.log(`Filtering summary: ${W.size} supply parts filtered out, ${ne.length} stock parts remaining`),console.log("Supply parts filtered:",Array.from(W)),console.log("Stock parts included:",ne.map(pe=>pe.part_number));const se={...H,suggestions:ne};d(se);let oe={},ae={};try{const ge=(await ve.get(`/api/purchase-history/${r}/allocations`)).data||[],Q={};for(const G of ge){const ee=String(G.part_number).toUpperCase();Q[ee]||(Q[ee]={}),Q[ee][G.sales_order_id]=Number(G.allocate_qty)||0}oe={},ae={},ne.forEach(G=>{const ee=G.part_number,le=Q[ee]||{},V={};G.allocation_suggestions.forEach(Me=>{const Fe=le[Me.sales_order_id];V[Me.sales_order_id]=typeof Fe=="number"?Fe:Me.suggested_alloc}),oe[ee]=V;const Ve=Object.values(V).reduce((Me,Fe)=>Me+(Number(Fe)||0),0);ae[ee]=Math.max(0,G.quantity_ordered-Ve)})}catch{oe={},ae={},ne.forEach(ge=>{oe[ge.part_number]={},ge.allocation_suggestions.forEach(G=>{oe[ge.part_number][G.sales_order_id]=G.suggested_alloc});const Q=Object.values(oe[ge.part_number]).reduce((G,ee)=>G+(Number(ee)||0),0);ae[ge.part_number]=Math.max(0,ge.quantity_ordered-Q)})}h(oe),v(ae),A(new Set),S([])}catch(N){console.error("Error fetching allocation suggestions:",N),me.error("Failed to load allocation suggestions")}finally{s(!1)}},U=(N,H,W)=>{if(!u)return{valid:!0};const ne=u.suggestions.find(le=>le.part_number===N);if(!ne)return{valid:!0};const se=ne.allocation_suggestions.find(le=>le.sales_order_id===H);if(!se)return{valid:!0};const oe=se.current_quantity_needed,ae=ne.quantity_ordered,pe=ne.allocation_suggestions.filter(le=>le.is_needed).reduce((le,V)=>le+V.current_quantity_needed,0),ge=ae>=pe,Q=$(N),G=f[N]?.[H]||0,ee=ae-(Q-G);return W>ee?{valid:!1,message:`Cannot allocate more than ${ee} units (exceeds ordered quantity)`}:ge&&se.is_needed&&W<oe?{valid:!1,message:`Cannot allocate less than ${oe} units when surplus exists`}:!ge&&se.is_needed&&W<oe?{valid:!0,warning:`Allocating ${W} units but ${oe} units are needed for quantity to order`}:{valid:!0}},O=(N,H,W)=>{const ne=Math.max(0,W),se=U(N,H,ne);if(!se.valid){me.error(se.message);return}se.warning&&me.warning(se.warning),h(oe=>{const ae={...oe,[N]:{...oe[N],[H]:ne}};if(u){const pe=u.suggestions.find(ge=>ge.part_number===N);if(pe){const ge=ae[N]||{},Q=Object.values(ge).reduce((ee,le)=>ee+le,0),G=Math.max(0,pe.quantity_ordered-Q);v(ee=>({...ee,[N]:G}))}}return ae})},M=N=>{if(!u)return;const H=u.suggestions.find(ge=>ge.part_number===N);if(!H)return;const W=H.quantity_ordered,ne=H.allocation_suggestions.filter(ge=>ge.is_needed).reduce((ge,Q)=>ge+Q.current_quantity_needed,0),se=W>=ne,oe=H.allocation_suggestions.filter(ge=>ge.is_needed).sort((ge,Q)=>ge.sales_order_number.localeCompare(Q.sales_order_number)),ae={};let pe=W;if(se){for(const ge of oe){const Q=ge.current_quantity_needed,G=Math.min(Q,pe);G>0&&(ae[ge.sales_order_id]=G,pe-=G)}if(pe>0)for(const ge of H.allocation_suggestions){if(pe<=0)break;const Q=ae[ge.sales_order_id]||0,G=Math.min(pe,1);ae[ge.sales_order_id]=Q+G,pe-=G}}else for(const ge of oe){if(pe<=0)break;const Q=ge.current_quantity_needed,G=Math.min(Q,pe);G>0&&(ae[ge.sales_order_id]=G,pe-=G)}h(ge=>({...ge,[N]:ae})),v(ge=>({...ge,[N]:pe}))},L=()=>{u&&u.suggestions.forEach(N=>{M(N.part_number)})},q=(N,H)=>{A(W=>{const ne=new Set(W);return H?ne.add(N):ne.delete(N),ne})},z=N=>{if(!u){A(new Set);return}A(N?new Set(u.suggestions.map(H=>H.part_number)):new Set)},K=x.useMemo(()=>{if(!u)return[];const N=new Map;return u.suggestions.forEach(H=>{H.allocation_suggestions.forEach(W=>{N.has(W.sales_order_id)||N.set(W.sales_order_id,{id:W.sales_order_id,label:W.sales_order_number,customer:W.customer_name})})}),Array.from(N.values()).sort((H,W)=>H.label.localeCompare(W.label))},[u]),J=()=>{if(!u)return;const N=Array.from(w);if(N.length===0){me.error("Select at least one part to allocate.");return}if(P===""){me.error("Select a sales order to allocate the selected parts.");return}const H={...f},W={...p};N.forEach(ne=>{const se=u.suggestions.find(pe=>pe.part_number===ne);if(!se)return;const oe={};se.allocation_suggestions.forEach(pe=>{oe[pe.sales_order_id]=pe.sales_order_id===P?se.quantity_ordered:0}),H[ne]=oe;const ae=Object.values(oe).reduce((pe,ge)=>pe+(Number(ge)||0),0);W[ne]=Math.max(0,se.quantity_ordered-ae)}),h(H),v(W),me.success("Selected parts allocated to the chosen sales order.")},R=()=>{const N=[];return u?(u.suggestions.forEach(H=>{const W=H.part_number,ne=H.quantity_ordered,se=f[W]||{},oe=Object.values(se).reduce((ge,Q)=>ge+Q,0);oe>ne&&N.push(`Total allocation (${oe}) exceeds ordered quantity (${ne}) for part ${W}`);const ae=H.allocation_suggestions.filter(ge=>ge.is_needed).reduce((ge,Q)=>ge+Q.current_quantity_needed,0);if(ne>=ae){for(const ge of H.allocation_suggestions)if(ge.is_needed){const Q=se[ge.sales_order_id]||0,G=ge.current_quantity_needed;Q<G&&N.push(`Sales order ${ge.sales_order_number} must receive at least ${G} units when surplus exists`)}}}),S(N),N.length===0):!1},k=async()=>{if(R()){c(!0);try{const N=[];for(const[W,ne]of Object.entries(f))for(const[se,oe]of Object.entries(ne))oe>0&&N.push({sales_order_id:parseInt(se),part_number:W,allocate_qty:oe});const H=await ve.post(`/api/purchase-history/${r}/save-allocations`,{allocations:N,surplusPerPart:p});me.success("Allocations saved successfully"),a&&a(),t()}catch(N){console.error("Error saving allocations:",N);const H=N.response?.data?.error||"Failed to save allocations";me.error(H)}finally{c(!1)}}},$=N=>{const H=f[N]||{};return Object.values(H).reduce((W,ne)=>W+ne,0)},X=N=>{if(!u)return 0;const H=u.suggestions.find(ne=>ne.part_number===N);if(!H)return 0;const W=$(N);return H.quantity_ordered-W},C=N=>{y(H=>({...H,[N]:!H[N]}))};return o?i.jsxs(dr,{open:e,onClose:t,maxWidth:"lg",fullWidth:!0,children:[i.jsx(fr,{children:"Loading Allocation Suggestions..."}),i.jsx(hr,{children:i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:i.jsx(er,{})})})]}):i.jsxs(dr,{open:e,onClose:t,maxWidth:"lg",fullWidth:!0,children:[i.jsxs(fr,{children:["Allocate Purchase Order: ",u?.purchase_order_number]}),i.jsxs(hr,{children:[u&&u.suggestions.length>0&&i.jsxs(bt,{sx:{mb:3,p:2,backgroundColor:"grey.50"},children:[i.jsxs(B,{variant:"h6",gutterBottom:!0,children:["Purchase Order Summary (",u.suggestions.length," parts)"]}),i.jsx(Z,{display:"flex",flexWrap:"wrap",gap:1,children:u.suggestions.map((N,H)=>i.jsx(ot,{label:`${N.part_number}: ${N.quantity_ordered} ordered`,color:"primary",variant:"outlined",size:"small"},`${N.part_number}-${H}`))})]}),b.size>0&&i.jsxs(Pt,{severity:"info",sx:{mb:2},children:[i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"Note:"})," ",b.size," supply part",b.size>1?"s":""," ",b.size>1?"have":"has"," been filtered out from allocation. Supply parts are not tracked for inventory allocation."]}),i.jsx(Z,{mt:1,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Filtered parts: ",Array.from(b).join(", ")]})})]}),T.length>0&&i.jsxs(Pt,{severity:"error",sx:{mb:2},children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Please correct the following errors:"}),T.map((N,H)=>i.jsxs(B,{variant:"body2",children:[" ",N]},H))]}),u&&u.suggestions.length>0&&i.jsx(bt,{sx:{mb:3,p:2},variant:"outlined",children:i.jsxs(ut,{direction:{xs:"column",md:"row"},spacing:2,alignItems:{xs:"flex-start",md:"center"},children:[i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(ui,{control:i.jsx(Xi,{checked:w.size===u.suggestions.length&&u.suggestions.length>0,indeterminate:w.size>0&&w.size<u.suggestions.length,onChange:N=>z(N.target.checked)}),label:"Select all parts"}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:[w.size," selected"]})]}),i.jsxs(tn,{size:"small",sx:{minWidth:220},children:[i.jsx(sn,{id:"bulk-sales-order-label",children:"Sales Order"}),i.jsxs(ln,{labelId:"bulk-sales-order-label",label:"Sales Order",value:P,onChange:N=>E(N.target.value),displayEmpty:!0,children:[i.jsx(Jt,{value:"",children:i.jsx("em",{children:"Select sales order"})}),K.map(N=>i.jsxs(Jt,{value:N.id,children:[N.label,"  ",N.customer]},N.id))]})]}),i.jsx(xe,{variant:"contained",onClick:J,disabled:w.size===0||P==="",children:"Allocate selected parts to sales order"})]})}),u?.suggestions.length===0?i.jsx(Pt,{severity:"info",sx:{mb:2},children:i.jsx(B,{variant:"body1",children:"No parts found in this purchase order to allocate."})}):u?.suggestions.map((N,H)=>i.jsxs(bt,{sx:{mb:2,p:2},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(Xi,{checked:w.has(N.part_number),onChange:W=>q(N.part_number,W.target.checked),inputProps:{"aria-label":`Select part ${N.part_number}`}}),i.jsx(vr,{size:"small",onClick:()=>C(N.part_number),sx:{p:.5},children:m[N.part_number]?i.jsx(wde,{}):i.jsx(xde,{})}),i.jsxs(B,{variant:"h6",children:[N.part_number," - ",N.part_description]})]}),i.jsxs(Z,{display:"flex",gap:1,alignItems:"center",children:[i.jsx(ot,{label:`Ordered: ${N.quantity_ordered}`,color:"primary",variant:"outlined",size:"small"}),i.jsx(ot,{label:`Total Needed: ${N.total_needed}`,color:"secondary",variant:"outlined",size:"small"}),i.jsx(ot,{label:`Remaining: ${X(N.part_number)}`,color:X(N.part_number)<0?"error":"default",variant:"outlined",size:"small"}),i.jsx(xe,{variant:"outlined",size:"small",onClick:()=>M(N.part_number),children:"Auto Allocate (FIFO)"})]})]}),i.jsx(AI,{in:m[N.part_number],children:i.jsx(Z,{mt:2,children:i.jsx(ma,{children:i.jsxs(ia,{size:"small",children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{children:"Sales Order"}),i.jsx(Oe,{children:"Customer"}),i.jsx(Oe,{children:"Date"}),i.jsx(Oe,{align:"right",children:"Quantity to Order"}),i.jsx(Oe,{align:"right",children:"Allocate Qty"}),i.jsx(Oe,{children:"Status"})]})}),i.jsx(sa,{children:N.allocation_suggestions.map(W=>(console.log(`Rendering allocation for SO ${W.sales_order_number}: current_quantity_needed = ${W.current_quantity_needed}, is_needed = ${W.is_needed}`),i.jsxs(mr,{sx:{backgroundColor:W.is_needed?"warning.light":"grey.50","&:hover":{backgroundColor:W.is_needed?"warning.main":"grey.100"},borderLeft:W.is_needed?"4px solid #ff9800":"4px solid transparent"},children:[i.jsx(Oe,{children:i.jsx(B,{variant:"body2",fontWeight:"medium",children:W.sales_order_number})}),i.jsx(Oe,{children:W.customer_name}),i.jsx(Oe,{children:new Date(W.sales_date).toLocaleDateString()}),i.jsx(Oe,{align:"right",children:i.jsx(B,{variant:"body2",color:"black",fontWeight:W.is_needed?"bold":"normal",children:W.current_quantity_needed||0})}),i.jsx(Oe,{align:"right",children:i.jsx(Pe,{type:"number",value:f[N.part_number]?.[W.sales_order_id]||0,onChange:ne=>{const se=parseFloat(ne.target.value)||0;O(N.part_number,W.sales_order_id,se)},onBlur:ne=>{const se=parseFloat(ne.target.value)||0,oe=$(N.part_number),ae=f[N.part_number]?.[W.sales_order_id]||0,pe=N.quantity_ordered-(oe-ae);se>pe&&O(N.part_number,W.sales_order_id,pe)},size:"small",sx:{width:80},inputProps:{min:0,step:1,max:N.quantity_ordered}})}),i.jsx(Oe,{children:i.jsx(ot,{label:W.is_needed?"Needs Part":"No Need",color:W.is_needed?"warning":"default",size:"small",variant:"outlined"})})]},`${N.part_number}-${W.sales_order_id}`)))})]})})})}),i.jsxs(Z,{mt:2,display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsxs(B,{variant:"body2",children:["Total Allocated: ",$(N.part_number)]}),i.jsxs(Z,{display:"flex",alignItems:"center",gap:2,children:[i.jsx(B,{variant:"body2",children:"Surplus to Stock:"}),i.jsx(Pe,{type:"number",value:p[N.part_number]||0,disabled:!0,size:"small",sx:{width:80},inputProps:{min:0,step:1}})]})]})]},`${N.part_number}-${H}`))]}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:t,disabled:l,children:"Cancel"}),i.jsx(xe,{onClick:L,variant:"outlined",disabled:l,sx:{mr:"auto"},children:"Auto Allocate All (FIFO)"}),i.jsx(xe,{onClick:k,variant:"contained",disabled:l||T.length>0,children:l?i.jsx(er,{size:20}):"Save Allocations"})]})]})},Uw=(e,t)=>{const r=parseFloat(String(e))||0,n=parseFloat(String(t))||0;return Math.round(r*n*100)/100},Sde=(e,t=5)=>{const r=e.reduce((o,s)=>{const l=Uw(s.quantity,s.unit_cost);return o+l},0),n=r*(t/100),a=r+n;return{subtotal:Math.round(r*100)/100,total_gst_amount:Math.round(n*100)/100,total_amount:Math.round(a*100)/100}},Cde=(e,t=!1)=>{const r={};e.part_number?.trim()||(r.part_number="Part Number is required"),e.part_description?.trim()||(r.part_description="Part Description is required");const n=parseFloat(String(e.quantity));if((isNaN(n)||n<=0)&&(r.quantity="Quantity must be greater than 0"),t){const a=parseFloat(String(e.unit_cost));(isNaN(a)||a<=0)&&(r.unit_cost="Unit Cost must be greater than 0")}return r},Ade=(e,t,r=!1)=>{const n={};t||(n.vendor="Vendor is required");const a=e.map(s=>Cde(s,r));return a.some(s=>Object.keys(s).length>0)&&(n.lineItems=a),n},tl=e=>{const t=parseFloat(String(e));return isNaN(t)?0:t},rl=["Each","cm","ft","ft^2","kg","pcs","L"],DT=5,MT=()=>{const{id:e}=Ms(),t=kn(),{user:r}=Jn(),n=e==="new";console.log("Is creation mode:",n,"ID:",e);const[a,o]=x.useState(null),[s,l]=x.useState(null),[c,u]=x.useState(Rt()),[d,f]=x.useState(Rt().toISOString()),[h,p]=x.useState(""),[v,m]=x.useState([]),y=Ay(v,300),[b,_]=x.useState([]),[w,A]=x.useState("Open"),[P,E]=x.useState(!1),[T,S]=x.useState(DT),[I,U]=x.useState({}),[O,M]=x.useState(0),[L,q]=x.useState([]),[z,K]=x.useState(""),J=x.useRef(null),[R,k]=x.useState(!1),[$,X]=x.useState(null),[C,N]=x.useState(null),[H,W]=x.useState(!1),[ne,se]=x.useState(!1),[oe,ae]=x.useState([]),[pe,ge]=x.useState({}),[Q,G]=x.useState(null),[ee,le]=x.useState(null),[V,Ve]=x.useState(!1),[Me,Fe]=x.useState(null),Qe=x.useRef(null),[it,st]=x.useState(!0),vt=x.useCallback(async()=>{if(!(ne||L.length>0)){se(!0);try{const be=await ve.get("/api/vendors");q(be.data.map(je=>({label:je.vendor_name,id:je.vendor_id,vendor_code:je.vendor_code||"",isNew:!1})))}catch(be){console.error("Failed to reload vendors",be)}finally{se(!1)}}},[L.length,ne]),Ye=x.useMemo(()=>{const be={};for(const je of oe||[])je?.part_number&&(be[String(je.part_number)]=je.part_description||"");return be},[oe]),Ze=x.useCallback((be,je,Ie=!1)=>{const Le=(je.inputValue||"").toUpperCase(),De=50,pt=[];for(const Lt of be){const jr=String(Lt).toUpperCase(),zr=(Ye[Lt]||"").toUpperCase();if((!Le||jr.includes(Le)||zr.includes(Le))&&(pt.push(Lt),pt.length>=De))break}const kt=pt.some(Lt=>String(typeof Lt=="string"?Lt:Lt?.label||"").toUpperCase()===Le);return Ie&&Le&&!kt&&pt.push({label:`Add "${je.inputValue}" as New Part`,isNew:!0,inputValue:je.inputValue}),pt},[Ye]),[We,wt]=x.useState(!1),[It,Ot]=x.useState(null),[Wt,jt]=x.useState(""),[lr,$e]=x.useState(void 0),[He,Je]=x.useState("manual"),[Ue,ht]=x.useState([]),[at,St]=x.useState(null),[Tt,Yt]=x.useState(null),[Or,Dr]=x.useState(null),[tr,wr]=x.useState({}),[Ir,dn]=x.useState({});x.useMemo(()=>_8(),[]);const[ka,En]=x.useState(null),[Zt,Xr]=x.useState(!1),[Gn,Tn]=x.useState(null),[Wr,en]=x.useState(""),[Se,Ge]=x.useState(!1),[_e,Te]=x.useState(!1);x.useEffect(()=>{n&&c&&f(c.toISOString())},[c,n]);const nt=async()=>{try{console.log("Fetching aggregate quantities...");const be=new AbortController,je=setTimeout(()=>be.abort(),1e4),Ie=await ve.get("/api/sales-orders/parts-to-order/all",{signal:be.signal});clearTimeout(je);const{aggregatedParts:Le}=Ie.data;if(console.log("Full API response:",Ie.data),console.log("Aggregated parts response:",Le),Le&&Le.length>0){const De={};Le.forEach(pt=>{const kt=typeof pt.total_quantity_needed=="string"?parseFloat(pt.total_quantity_needed):pt.total_quantity_needed;De[pt.part_number.toUpperCase()]=kt}),console.log("Calculated quantities:",De),U(De),_(pt=>{const kt=pt.map(Lt=>({...Lt,quantity_to_order:De[Lt.part_number]||0}));return console.log("Updated line items with quantities:",kt),kt})}else console.log("No aggregated parts found, clearing quantities"),U({}),_(De=>De.map(pt=>({...pt,quantity_to_order:0})))}catch(be){console.error("Error fetching aggregate quantities:",be),be.name==="AbortError"&&console.error("Request timed out"),U({}),_(je=>je.map(Ie=>({...Ie,quantity_to_order:0})))}},mt=async()=>{if(console.log("fetchData called. ID:",e),n)try{console.log(" Fetching vendors and inventory for creation mode...");const be=new AbortController,je=setTimeout(()=>be.abort(),15e3),[Ie,Le]=await Promise.all([ve.get("/api/vendors",{signal:be.signal}),ve.get("/api/inventory",{signal:be.signal})]);clearTimeout(je),console.log(" Vendors and inventory fetched successfully"),console.log("Raw vendors data:",Ie.data);const De=Ie.data.map(pt=>({label:pt.vendor_name,id:pt.vendor_id,email:pt.email}));console.log("Mapped vendors:",De),q(De),ae(Le.data),_([]);try{await nt()}catch(pt){console.error("Error fetching aggregate quantities:",pt)}st(!1),Ge(!0),console.log(" Creation mode initialization complete");return}catch(be){console.error(" Error fetching vendors/inventory:",be),be.name==="AbortError"?En("Request timed out. Please try again."):En("Failed to fetch vendors and inventory. Please check your connection and try again."),st(!1);return}try{const[be,je,Ie]=await Promise.all([ve.get(`/api/purchase-orders/${e}`),ve.get("/api/vendors"),ve.get("/api/inventory")]),Le=be.data;if(console.log("Fetched Order Data:",Le),o(Le),Le.vendor_name&&Le.vendor_id){const Lt=je.data.find(jr=>jr.vendor_id===Le.vendor_id);l({label:Le.vendor_name,id:Le.vendor_id,email:Lt?.email})}else if(Le.vendor_id){const Lt=je.data.find(jr=>jr.vendor_id===Le.vendor_id);Lt?l({label:Lt.vendor_name,id:Lt.vendor_id,email:Lt.email}):(!s||!s.id)&&l(null)}else(!s||!s.id)&&l(null);u(Rt(Le.purchase_date)),f(Le.date||Le.purchase_date||null),p(Le.bill_number||""),console.log("Original line items from backend:",Le.lineItems);const De=Le.lineItems.map(Lt=>{const jr={...Lt,quantity:String(Lt.quantity||""),unit_cost:String(Lt.unit_cost||""),line_amount:parseFloat(String(Lt.line_amount??Lt.line_total??0)),quantity_to_order:0};return console.log("Mapped line item:",jr),jr});console.log("Final mapped line items:",De),_(De),m(De);const pt=Le.status==="Closed"?"Closed":"Open";console.log("Setting purchase order status:",pt,"from fetched status:",Le.status),A(pt),E(!1),S(Le.global_gst_rate||DT),console.log("State after setting:",{purchaseOrder:Le,billNumber:Le.bill_number||"",lineItems:Le.lineItems,mappedLineItems:De,subTotal:parseFloat(String(Le.subtotal))||0,totalGSTAmount:parseFloat(String(Le.total_gst_amount))||0,totalAmount:parseFloat(String(Le.total_amount))||0}),console.log("Raw vendors data (edit mode):",je.data);const kt=je.data.map(Lt=>({label:Lt.vendor_name,id:Lt.vendor_id,email:Lt.email}));console.log("Mapped vendors (edit mode):",kt),q(kt),ae(Ie.data),await nt(),st(!1),Ge(!0)}catch(be){console.error("Error fetching data:",be),be instanceof ci&&be.response?.data?.message?En(be.response.data.message):En("An unexpected error occurred")}};x.useEffect(()=>{e&&mt()},[e]),x.useEffect(()=>{console.log("lineItems state changed:",b)},[b]),x.useEffect(()=>{m(b)},[b]),x.useEffect(()=>{k(!1),St(null)},[e]);const Mt=be=>Uw(tl(be.quantity),tl(be.unit_cost)),Nr=x.useMemo(()=>y.map(be=>({part_number:be.part_number,part_description:be.part_description,quantity:tl(be.quantity),unit:be.unit,unit_cost:tl(be.unit_cost)})),[y]),Ar=x.useMemo(()=>Sde(Nr,T),[Nr,T]),$r=Ar.subtotal,Vr=Ar.total_gst_amount,In=Ar.total_amount,$n=x.useCallback(be=>JSON.stringify(be.map(je=>({part_number:je.part_number.trim(),part_description:je.part_description.trim(),quantity:parseFloat(String(je.quantity)),unit:je.unit.trim(),unit_cost:parseFloat(String(je.unit_cost))})).sort((je,Ie)=>je.part_number!==Ie.part_number?je.part_number.localeCompare(Ie.part_number):je.quantity-Ie.quantity)),[]);x.useEffect(()=>{Se&&(!Array.isArray(oe)||oe.length===0||m(be=>{let je=!1;const Ie=be.map(Le=>{const De=String(Le.part_number||"").trim().toUpperCase();if(!De)return Le;const pt=(oe||[]).find(Yn=>String(Yn.part_number).trim().toUpperCase()===De);if(!pt)return Le;let kt=Le;const Lt=String(pt.unit||"").trim(),jr=String(Le.unit||"").trim();Lt&&!jr&&(kt={...kt,unit:Lt},je=!0);const zr=String(pt.part_description||"");zr&&zr!==String(Le.part_description||"")&&(kt={...kt,part_description:zr},je=!0);const fn=parseFloat(String(Le.unit_cost));if(!Number.isFinite(fn)||fn===0){const Yn=parseFloat(String(pt.last_unit_cost))||0;Yn>0&&Yn!==fn&&(kt={...kt,unit_cost:String(Yn)},je=!0)}if(kt!==Le){const Yn=Mt(kt);kt={...kt,line_amount:Yn}}return kt});return je?Ie:be}))},[Se,oe]),x.useEffect(()=>{if(!n&&!it&&a&&Wr===""&&Se){console.log("[PO Detail] Setting initial signature for dirty tracking");const be=JSON.stringify({vendor:s?{id:s.id,label:s.label}:null,billNumber:h.trim(),date:c?.toISOString(),lineItems:$n(b),pickup_time:a.pickup_time||null,pickup_location:a.pickup_location||null,pickup_contact_person:a.pickup_contact_person||null,pickup_phone:a.pickup_phone||null,pickup_instructions:a.pickup_instructions||null,pickup_notes:a.pickup_notes||null,order_placed:a.order_placed||!1,order_placed_at:a.order_placed_at||null,order_placed_by:a.order_placed_by||null,order_placed_method:a.order_placed_method||null,vendor_confirmation_status:a.vendor_confirmation_status||"pending",vendor_confirmation_notes:a.vendor_confirmation_notes||null,vendor_confirmation_date:a.vendor_confirmation_date||null,pricing_updated:a.pricing_updated||!1,pricing_updated_at:a.pricing_updated_at||null,pricing_updated_by:a.pricing_updated_by||null,pricing_updated_method:a.pricing_updated_method||null,quantity_adjusted:a.quantity_adjusted||!1,quantity_adjusted_at:a.quantity_adjusted_at||null,quantity_adjusted_by:a.quantity_adjusted_by||null,quantity_adjusted_method:a.quantity_adjusted_method||null,original_quantities:a.original_quantities||null,adjusted_quantities:a.adjusted_quantities||null,vendor_pricing_notes:a.vendor_pricing_notes||null});en(be)}},[n,it,a,Se,Wr]);const ca=x.useMemo(()=>JSON.stringify({vendor:s?{id:s.id,label:s.label}:null,billNumber:h.trim(),date:c?.toISOString(),lineItems:$n(b),pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null}),[s,h,c,b,a]),fi=!!Wr&&Wr!==ca&&!_e;x.useEffect(()=>{console.log("[PO Detail] isDirty changed:",{isDirty:fi,hasInitialSignature:!!Wr,signaturesMatch:Wr===ca,initialSignature:Wr.slice(0,100)+"...",currentSignature:ca.slice(0,100)+"..."}),console.log("[PO Detail] About to render UnsavedChangesGuard with when=",fi)},[fi,Wr,ca]),x.useEffect(()=>{console.log("Aggregate quantities changed:",I),Object.keys(I).length>0&&_(be=>{const je=be.map(Ie=>{const Le=I[Ie.part_number]||I[Ie.part_number.toUpperCase()]||I[Ie.part_number.toLowerCase()]||0,De=typeof Le=="string"?parseFloat(Le):Le;return{...Ie,quantity_to_order:De}});return console.log("Updated line items from aggregate quantities effect:",je),je})},[I]);const ro=(be,je,Ie)=>{_(Le=>{const De=[...Le];if(!De[be])return console.log("Item at index",be,"not found in handleLineItemChange"),Le;const pt={...De[be],[je]:Ie};return je==="quantity"&&parseFloat(Ie)<=0?De.filter((kt,Lt)=>Lt!==be):((je==="quantity"||je==="unit_cost")&&(pt.line_amount=Mt(pt)),De[be]=pt,De)})},qi=()=>{_(be=>[...be,{part_number:"",part_description:"",quantity:"",unit:rl[0],unit_cost:"",line_amount:0,quantity_to_order:0}])},Nn=be=>{const je=[],Ie=[];if(!be||be.length===0)return{mapped:je,pending:Ie};const Le=De=>De?De.trim().toUpperCase():"";return be.filter(De=>De.description&&De.description.trim().length>0||De.partNumber&&De.partNumber.trim().length>0).forEach(De=>{const pt=tl(De.quantity??0),kt=De.unitCost!==null&&De.unitCost!==void 0&&String(De.unitCost).trim()!=="",Lt=kt?tl(De.unitCost):0,jr=kt?Lt:tl(De.match?.lastUnitCost??0),zr=De.match?.status==="existing"?Le(De.match?.matchedPartNumber||De.partNumber||De.match?.normalizedPartNumber||""):Le(De.match?.suggestedPartNumber||De.partNumber||De.normalizedPartNumber||""),fn=De.description||De.match?.partDescription||"",ta=De.match?.status==="existing"?De.match?.unit||De.unit||rl[0]:De.unit||rl[0],Yn=De.match?.status==="existing"?kt?String(De.unitCost):De.match?.lastUnitCost!=null?String(De.match.lastUnitCost):"":De.unitCost!=null?String(De.unitCost):"",Pi={part_number:zr,part_description:fn,quantity:De.quantity!==null&&De.quantity!==void 0?String(De.quantity):"",unit:ta,unit_cost:Yn,line_amount:Uw(pt,jr),quantity_to_order:0},ai=je.length;if(je.push(Pi),De.match?.status==="missing"&&zr){const Ia={part_number:Le(De.match.suggestedPartNumber||zr),part_description:De.description||"",unit:De.unit||rl[0],last_unit_cost:De.unitCost??"",part_type:"stock",category:"Uncategorized"};Ie.push({index:ai,suggestion:Ia})}else if(De.match?.status==="existing"&&De.match.descriptionMatches===!1){const Ia=`Invoice description for part "${De.match.matchedPartNumber||zr}" differs from inventory. Create a new part using the invoice details?`;if(typeof window<"u"?window.confirm(Ia):!1){const zi={part_number:Le(De.match.suggestedPartNumber||zr),part_description:De.description||"",unit:De.unit||De.match?.unit||rl[0],last_unit_cost:De.unitCost??De.match?.lastUnitCost??"",part_type:"stock",category:"Uncategorized"};Ie.push({index:ai,suggestion:zi})}}}),{mapped:je,pending:Ie}},Fi=async be=>{const je=be.target.files?Array.from(be.target.files):[];if(je.length!==0){Fe(null),Ve(!0);try{const Ie=await gde(je);le(Ie);const Le=je.length>1?`${je.length} documents`:"the uploaded document";me.success(`Gemini analysis completed for ${Le}. Review the detected values before applying them.`)}catch(Ie){console.error("Error processing OCR document:",Ie);let Le="Failed to analyze the document with AI. Please ensure OCR and Gemini are configured on the server.";Ie instanceof ci&&Ie.response?.data?.error?Le=Ie.response.data.error:Ie?.message&&(Le=Ie.message),Fe(Le),me.error(Le)}finally{Ve(!1),be.target&&(be.target.value="")}}},wi=()=>{if(!ee)return;const{normalized:be}=ee.ocr,je=be.vendorMatch,Ie=je?.vendorName||be.vendorName||"";if(je&&je.status==="existing"&&je.vendorId){const Le=L.find(kt=>kt.id===je.vendorId),De=je.matchedVendorName||Ie,pt=je.details?.email||"";if(Le)l(Le),K(Le.label);else{const kt={label:De||Ie,id:je.vendorId,email:pt};q(Lt=>Lt.some(jr=>jr.id===je.vendorId)?Lt:[...Lt,kt]),l(kt),K(kt.label)}De&&me.info(`Matched invoice vendor to "${De}".`)}else if(je&&je.status==="missing"&&Ie){l(null),K(Ie);const Le={vendor_name:Ie,street_address:je.details?.streetAddress||"",city:je.details?.city||"",province:je.details?.province||"",country:je.details?.country||"",postal_code:je.details?.postalCode||"",contact_person:je.details?.contactPerson||"",telephone_number:je.details?.telephone||"",email:je.details?.email||"",website:je.details?.website||""};ni(Le),(typeof window<"u"?window.confirm(`Vendor "${Ie}" was not found. Would you like to add this vendor now?`):!1)?Ci(!0):me.warn(`Vendor "${Ie}" is not in the system. Review the captured details before continuing.`)}else if(Ie){const Le=L.find(De=>De.label.toLowerCase()===Ie.toLowerCase());Le?(l(Le),K(Le.label)):(l(null),K(Ie))}if(be.billNumber&&p(be.billNumber),be.billDate){const Le=Rt(be.billDate);Le.isValid()&&u(Le)}if(typeof be.gstRate=="number"&&!Number.isNaN(be.gstRate)&&S(be.gstRate),be.lineItems?.length){const{mapped:Le,pending:De}=Nn(be.lineItems);Le.length>0&&(_(Le),m(Le)),ht(De)}else ht([]);me.success("OCR data applied. Please review the form before saving.")},Xe=async be=>{const je=be.toUpperCase();if(!pe[je])try{const Ie=await Jm(je);ge(Le=>({...Le,[je]:Ie}))}catch{}},Vt=(be,je)=>{const Ie=pe[be.toUpperCase()]||[];if(Ie.length===0)return be;if(je){const pt=Ie.filter(kt=>kt.vendor_id===je);if(pt.length>0){const kt=pt.find(jr=>jr.preferred);if(kt)return kt.vendor_part_number;const Lt=[...pt].sort((jr,zr)=>(zr.usage_count||0)-(jr.usage_count||0))[0];if(Lt)return Lt.vendor_part_number}}const Le=Ie.find(pt=>pt.preferred);if(Le)return Le.vendor_part_number;const De=[...Ie].sort((pt,kt)=>(kt.usage_count||0)-(pt.usage_count||0))[0];return De?De.vendor_part_number:be};x.useEffect(()=>{s&&_(be=>be.map(je=>{const Ie=(je.part_number||"").toUpperCase(),Le=pe[Ie];if(!Le||Le.length===0)return je;const De=Vt(Ie,s?.id||null);return{...je,part_number:De}}))},[s,pe]);const ar=be=>{_(je=>je.filter((Ie,Le)=>Le!==be))},qr=be=>oe.find(je=>je.part_number===be),kr=(be,je)=>{console.log("handlePartNumberChange called:",{idx:be,newValue:je,inventoryItemsLength:oe.length}),m(Ie=>{const Le=[...Ie],De=Le[be];if(console.log("Current item before change:",De),!De)return console.log("Current item not found, creating default item"),Le[be]={part_number:"",part_description:"",quantity:"",unit:rl[0],unit_cost:"",line_amount:0,quantity_to_order:0},Le;if(je===null||typeof je=="string"&&je.trim()==="")console.log("Resetting line item to empty values"),!De.part_number&&!De.part_description&&!De.quantity&&!De.unit_cost?Le[be]={...De,part_number:"",part_description:"",quantity:"",unit:rl[0],unit_cost:"",line_amount:0,quantity_to_order:0}:console.log("Preserving existing data despite empty input value");else if(typeof je!="string"&&je.isNew){console.log("Opening part dialog for new part"),Ot(be);const pt=je.inputValue||"";jt(pt),$e({part_number:pt.toUpperCase(),category:"Uncategorized"}),Je("manual"),wt(!0)}else if(typeof je=="string"){const pt=qr(je);console.log("Found inventory item:",pt);const kt=I[je]||I[je.toUpperCase()]||I[je.toLowerCase()]||0,Lt=typeof kt=="string"?parseFloat(kt):kt;if(console.log(`Quantity to order for ${je}:`,kt,"as number:",Lt),console.log("Available aggregate quantities keys:",Object.keys(I)),console.log("Looking for part:",je,"in aggregate quantities:",I),pt){const jr=De.unit_cost,zr=!jr||jr===""||jr==="0";Le[be]={...De,part_number:je,part_description:pt.part_description,unit:pt.unit,unit_cost:zr?String(pt.last_unit_cost):jr,quantity_to_order:Lt}}else console.log("Inventory item not found, preserving existing data"),Le[be]={...De,part_number:je,quantity_to_order:Lt}}return Le[be].line_amount=Mt(Le[be]),console.log("Updated item after change:",Le[be]),Le}),typeof je=="string"&&je.trim()!==""&&nt()},wn=async(be,je)=>{if(!be||be.trim()==="")return!1;try{return(await ve.get("/api/purchase-history/check-bill-number",{params:{bill_number:be.trim(),exclude_purchase_id:je}})).data.exists}catch(Ie){return console.error("Error checking duplicate bill number:",Ie),!1}},Mr=(be=!1,je=!1)=>{let Ie={};s||(Ie.vendor="Vendor is required."),c||(Ie.date="Date is required."),be&&!h.trim()&&(Ie.billNumber="Bill Number is required.");const Le=b.map(pt=>({part_number:pt.part_number,part_description:pt.part_description,quantity:tl(pt.quantity),unit:pt.unit,unit_cost:tl(pt.unit_cost)})),De=Ade(Le,s,je);return De.lineItems&&b.length>0&&(Ie.lineItems=De.lineItems),dn(Ie),Ie},Zn=async()=>{const be=Mr(!1,!1);if(Object.keys(be).length>0){me.error("Please correct the errors before saving.");return}if(!(h&&h.trim()&&await wn(h,a?.purchase_id)&&!window.confirm(`Warning: Bill number "${h}" already exists in another purchase order. Do you want to proceed anyway?`))){Te(!0);try{if(n){const je={vendor_id:s?.id,purchase_date:c?.toISOString(),date:d||c?.toISOString(),bill_number:h.trim(),lineItems:b.map(De=>({part_number:De.part_number.trim(),part_description:De.part_description.trim(),unit:De.unit.trim(),quantity:parseFloat(String(De.quantity)),unit_cost:parseFloat(String(De.unit_cost)),line_amount:parseFloat(String(De.line_amount))})),status:"Open",subtotal:$r,total_gst_amount:Vr,total_amount:In,global_gst_rate:T,company_id:r?.company_id,created_by:r?.id,pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null};if(console.log("Creating new purchase order:",je),window.__poCreateInFlight){console.log("[PO] Skipping duplicate create (in flight)");return}window.__poCreateInFlight=!0;const Ie=await ve.post("/api/purchase-orders",je);me.success("Purchase Order created successfully!");const Le=Ie.data.purchase_id;window.__unsavedGuardAllowNext=!0,t(`/open-purchase-orders/${Le}`)}else{const je=w==="Closed"&&P,Ie={...a,vendor_id:s?.id,purchase_date:c?.toISOString(),date:d||c?.toISOString()||a?.date,bill_number:h.trim(),lineItems:b.map(De=>({...De,part_number:De.part_number.trim(),part_description:De.part_description.trim(),unit:De.unit.trim(),quantity:parseFloat(String(De.quantity)),unit_cost:parseFloat(String(De.unit_cost)),line_amount:parseFloat(String(De.line_amount))})),status:w,subtotal:$r,total_gst_amount:Vr,total_amount:In,global_gst_rate:T,gst_rate:T,pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null};console.log("Sending to backend (handleSave):",Ie);const Le=await ve.put(`/api/purchase-orders/${e}`,Ie);Tn("Purchase Order updated successfully!"),je&&(await mt(),E(!1)),setTimeout(()=>{window.__unsavedGuardAllowNext=!0},100),je||en(JSON.stringify({vendor:s,billNumber:h,date:c,lineItems:b,pickup_time:a?.pickup_time,pickup_location:a?.pickup_location,pickup_contact_person:a?.pickup_contact_person,pickup_phone:a?.pickup_phone,pickup_instructions:a?.pickup_instructions,pickup_notes:a?.pickup_notes,order_placed:a?.order_placed,order_placed_at:a?.order_placed_at,order_placed_by:a?.order_placed_by,order_placed_method:a?.order_placed_method,vendor_confirmation_status:a?.vendor_confirmation_status,vendor_confirmation_notes:a?.vendor_confirmation_notes,vendor_confirmation_date:a?.vendor_confirmation_date,pricing_updated:a?.pricing_updated,pricing_updated_at:a?.pricing_updated_at,pricing_updated_by:a?.pricing_updated_by,pricing_updated_method:a?.pricing_updated_method,quantity_adjusted:a?.quantity_adjusted,quantity_adjusted_at:a?.quantity_adjusted_at,quantity_adjusted_by:a?.quantity_adjusted_by,quantity_adjusted_method:a?.quantity_adjusted_method,original_quantities:a?.original_quantities,adjusted_quantities:a?.adjusted_quantities,vendor_pricing_notes:a?.vendor_pricing_notes}))}}catch(je){if(console.error("Error saving Purchase Order:",je),je instanceof ci&&je.response?.data?.error){const Ie=je.response.data,Le=Ie.details?` (${Ie.details})`:"";me.error(`Error saving Purchase Order: ${Ie.error}${Le}`)}else me.error("Error saving Purchase Order. Please try again.")}finally{Te(!1),window.__poCreateInFlight=!1}}},xn=async()=>{if(w==="Closed"&&!(fi&&!window.confirm("Discard your edits to this closed purchase order?")))try{await mt()}finally{E(!1)}},Ea=async()=>{if(!a?.purchase_id){me.error("Purchase order not loaded. Cannot export.");return}if(a.status!=="Closed"){me.error("Only closed purchase orders can be exported to QuickBooks.");return}if(a.exported_to_qbo){me.error("Purchase order has already been exported to QuickBooks.");return}hs(!0);try{const be=await ve.post(`/api/purchase-orders/${a.purchase_id}/export-to-qbo`);me.success("Exported to QuickBooks successfully!"),o(je=>je&&{...je,exported_to_qbo:!0})}catch(be){const je=be?.response?.data?.error||"Failed to export to QuickBooks.";me.error(je)}finally{hs(!1)}},Ta=async()=>{a?.purchase_id&&await ti()},ti=async()=>{if(!a?.purchase_id)return;const be=Mr(!0,!0);if(Object.keys(be).length>0){be.lineItems?.some(Le=>Le.unit_cost)?me.error("Unit cost is required for all line items before closing a purchase order."):(Xr(!0),me.error("A bill number is required to close the purchase order."));return}if(!(await wn(h,a.purchase_id)&&!window.confirm(`Warning: Bill number "${h}" already exists in another purchase order. Do you want to proceed with closing this purchase order anyway?`)))try{const Ie={...a,vendor_id:s?.id,purchase_date:c?.toISOString(),bill_number:h.trim(),lineItems:b.map(De=>({...De,part_number:De.part_number.trim(),part_description:De.part_description.trim(),unit:De.unit.trim(),quantity:parseFloat(String(De.quantity)),unit_cost:parseFloat(String(De.unit_cost)),line_amount:parseFloat(String(De.line_amount))})),status:"Closed",subtotal:$r,total_gst_amount:Vr,total_amount:In,global_gst_rate:T,gst_rate:T,pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null},Le=await ve.put(`/api/purchase-orders/${a.purchase_id}`,Ie);Le.status===200?(console.log("Purchase Order closed:",Le.data),me.success("Purchase Order closed successfully!"),o(De=>De&&{...De,status:"Closed"}),A("Closed"),t(`/open-purchase-orders/${a.purchase_id}`)):me.error("Failed to close purchase order")}catch(Ie){if(console.error("Error closing purchase order:",Ie),Ie instanceof ci&&Ie.response?.data?.error){const Le=Ie.response.data.error;Le.toLowerCase().includes("negative quantity")||Le.toLowerCase().includes("insufficient inventory")||Le.toLowerCase().includes("inventory constraint")?me.error(`Cannot close: ${Le}`):me.error(`Error closing PO: ${Le}`)}else me.error("Failed to close purchase order. Please try again.")}},ea=()=>{t(`/open-purchase-orders/${a?.purchase_id}`)},Cn=()=>{mt(),me.success("Allocation changes saved successfully. Purchase order remains open.")},Gr=async()=>{if(!Mr(!1)){me.error("Please correct the errors before proceeding with allocation.");return}try{const be={...a,vendor_id:s?.id,purchase_date:c?.toISOString(),bill_number:h.trim(),lineItems:b.map(je=>({...je,part_number:je.part_number.trim(),part_description:je.part_description.trim(),unit:je.unit.trim(),quantity:parseFloat(String(je.quantity)),unit_cost:parseFloat(String(je.unit_cost)),line_amount:parseFloat(String(je.line_amount))})),subtotal:$r,total_gst_amount:Vr,total_amount:In,global_gst_rate:T,gst_rate:T,pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null};await ve.put(`/api/purchase-orders/${a.purchase_id}`,be),o(be),oo(!0),me.success("Changes saved successfully. Opening allocation modal...")}catch(be){console.error("Error saving changes before allocation:",be),be instanceof ci&&be.response?.data?.error?me.error(`Error saving changes: ${be.response.data.error}`):me.error("Failed to save changes before allocation. Please try again.")}},no=async()=>{if(!a?.purchase_id){me.error("Purchase order not loaded. Cannot download PDF.");return}try{const be=await ve.get(`/api/purchase-orders/${a.purchase_id}/pdf`,{responseType:"blob"}),je=window.URL.createObjectURL(new Blob([be.data])),Ie=document.createElement("a");Ie.href=je,Ie.download=`purchase_order_${a.purchase_number}.pdf`,document.body.appendChild(Ie),Ie.click(),Ie.remove(),window.URL.revokeObjectURL(je)}catch(be){console.error("Error downloading PDF:",be),me.error("Failed to download PDF. Please try again.")}},ao=async()=>{await Zn(),!(Object.keys(Ir).length>0)&&await no()},io=()=>{if(!a)return;const be=b.map(Ie=>Ie.quantity),je=prompt(`Enter adjusted quantities (comma-separated, e.g., 50,100,25):
Current quantities: `+be.join(", ")+`
Note: Adjust based on vendor minimum orders (e.g., sold by 10ft packs)`);if(je)try{const Ie=je.split(",").map(Le=>parseFloat(Le.trim()));if(Ie.length!==b.length){me.error("Number of quantities must match number of line items");return}_(Le=>Le.map((De,pt)=>({...De,quantity:Ie[pt]}))),o(Le=>Le&&{...Le,quantity_adjusted:!0,quantity_adjusted_at:new Date().toISOString(),quantity_adjusted_by:Number(r?.id),quantity_adjusted_method:"manual",original_quantities:be,adjusted_quantities:Ie}),me.success("Quantities adjusted based on vendor confirmation")}catch{me.error("Invalid quantity format. Please use numbers separated by commas.")}},[ji,oo]=x.useState(!1),[hi,Oo]=x.useState(!1),[$i,fs]=x.useState(""),[so,hs]=x.useState(!1),[Ya,lo]=x.useState(!1),[ri,dc]=x.useState([]),[Bn,Yo]=x.useState(!1),[ko,yr]=x.useState(null),[Cl,fc]=x.useState({}),Si=async()=>{if(a?.purchase_id){Yo(!0),yr(null);try{const be=await ve.get(`/api/purchase-history/${a.purchase_id}/allocations`);dc(be.data||[]);const je=Array.from(new Set((be.data||[]).map(Ie=>Ie.sales_order_id).filter(Boolean)));if(je.length>0)try{const Ie=await Promise.all(je.map(De=>ve.get(`/api/sales-orders/${De}`))),Le={};Ie.forEach((De,pt)=>{const kt=je[pt],Lt=De.data?.salesOrder?.sales_order_number||De.data?.salesOrder?.sales_number||"";Lt&&(Le[kt]=Lt)}),fc(Le)}catch(Ie){console.warn("Unable to fetch one or more sales order numbers:",Ie)}lo(!0)}catch(be){console.error("Error fetching allocations:",be),yr("Failed to load allocations."),lo(!0)}finally{Yo(!1)}}},[Fs,Ci]=x.useState(!1),[Ko,ni]=x.useState({}),Bi=be=>be.normalize("NFD").replace(/[-]/g,"").replace(/[^a-zA-Z0-9\s]/g," ").replace(/\s+/g," ").trim().toUpperCase(),hc=(be,je)=>{const Ie=Bi(je);if(!Ie)return be.slice(0,8);const Le=be.map(De=>{const pt=Bi(De.label);let kt=-1;return pt.startsWith(Ie)?kt=3:pt.split(" ").some(Lt=>Lt.startsWith(Ie))?kt=2:pt.includes(Ie)&&(kt=1),{opt:De,score:kt}}).filter(De=>De.score>=0);return Le.sort((De,pt)=>pt.score-De.score||De.opt.label.localeCompare(pt.opt.label)),Le.slice(0,8).map(De=>De.opt)},$s=be=>{const je=Bi(be);return L.find(Ie=>Bi(Ie.label)===je)||null},co=be=>{const je=Bi(be),Ie=oe.find(Le=>Bi(Le.part_number)===je);return Ie?Ie.part_number:null},Eo=be=>{const je=z.trim(),Ie=be.key==="Enter",Le=be.key==="Tab",De=be.key==="Escape",pt=be.key==="ArrowDown"||be.key==="ArrowUp";if(De){k(!1);return}if(pt){be.key==="ArrowDown"&&!R&&k(!0);return}if(Ie||Le){if(Ie&&be.ctrlKey&&je){be.preventDefault(),W(!0),ni({vendor_name:je}),Ci(!0),k(!1);return}if(R){if(Ie){const Lt=C;Lt&&Lt.isNew&&(be.preventDefault(),W(!0),ni({vendor_name:je}),Ci(!0),k(!1))}return}const kt=$s(je);if(!je)return;be.preventDefault(),kt?(l(kt),K(kt.label)):(W(!0),ni({vendor_name:je}),Ci(!0),k(!1))}},To=(be,je)=>{const Ie=(b[be]?.part_number||"").trim(),Le=je.key==="Enter",De=je.key==="Tab",pt=je.key==="Escape",kt=je.key==="ArrowDown"||je.key==="ArrowUp";if(pt){St(null);return}if(kt){je.key==="ArrowDown"&&at!==be&&St(be);return}if(!(at===be&&(Le||De))&&(Le||De)){if(Le&&je.ctrlKey&&Ie){je.preventDefault(),Dr(be),jt(Ie),Ot(be),$e({part_number:Ie.toUpperCase(),category:"Uncategorized"}),Je("manual"),wt(!0),St(null);return}const Lt=co(Ie);if(!Ie)return;je.preventDefault(),Lt?kr(be,Lt):(Dr(be),jt(Ie),Ot(be),$e({part_number:Ie.toUpperCase(),category:"Uncategorized"}),Je("manual"),wt(!0),St(null))}},Al=()=>{wt(!1),Ot(null),$e(void 0),Je("manual"),jt("")},Ai=be=>{const je=L.find(Ie=>Ie.id===be);return console.log("Getting vendor email for vendor ID:",be),console.log("Selected vendor:",je),console.log("Vendor email:",je?.email),je?.email||""},Bs=async()=>{if(!s?.id){me.error("Please select a vendor first");return}if(n){if(!Mr(!1)){me.error("Please correct the errors before sending email.");return}try{const be={vendor_id:s?.id,purchase_date:c?.toISOString(),bill_number:h.trim(),lineItems:b.map(pt=>({part_number:pt.part_number.trim(),part_description:pt.part_description.trim(),unit:pt.unit.trim(),quantity:parseFloat(String(pt.quantity)),unit_cost:parseFloat(String(pt.unit_cost)),line_amount:parseFloat(String(pt.line_amount))})),status:"Open",subtotal:$r,total_gst_amount:Vr,total_amount:In,global_gst_rate:T,company_id:r?.company_id,created_by:r?.id,pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null};console.log("Creating new purchase order for email:",be);const Ie=(await ve.post("/api/purchase-orders",be)).data;o(Ie);const Le=Ie.purchase_id;t(`/open-purchase-orders/${Le}`);const De=Ai(s.id);fs(De),Oo(!0),me.success("Purchase Order created and email modal opened!")}catch(be){console.error("Error creating Purchase Order for email:",be),be instanceof ci&&be.response?.data?.error?me.error(`Error creating Purchase Order: ${be.response.data.error}`):me.error("Error creating Purchase Order. Please try again.")}}else{const be=Ai(s.id);console.log("Email button clicked - vendor ID:",s.id),console.log("Retrieved email:",be),fs(be),Oo(!0)}};x.useEffect(()=>{console.log("Part modal state changed - openPartDialog:",We,"partNumberForModal:",Wt,"partToAddIndex:",It)},[We,Wt,It]),x.useEffect(()=>{if(!We&&Ue.length>0){const[be,...je]=Ue;ht(je),Ot(be.index),jt(be.suggestion.part_number?String(be.suggestion.part_number):""),$e({part_number:be.suggestion.part_number??"",part_description:be.suggestion.part_description??"",unit:be.suggestion.unit??rl[0],last_unit_cost:be.suggestion.last_unit_cost??"",quantity_on_hand:be.suggestion.quantity_on_hand??"",reorder_point:be.suggestion.reorder_point??"",part_type:be.suggestion.part_type??"stock",category:be.suggestion.category??"Uncategorized"}),Je("ocr"),wt(!0)}},[We,Ue]),x.useEffect(()=>{We&&St(null)},[We]),x.useEffect(()=>{if(s?.id){const be=Ai(s.id);console.log("Vendor changed - updating email:",be),fs(be)}else fs("")},[s,L]);const Ui=()=>{if(!a)return null;const be=b||[];let je=be.reduce((De,pt)=>De+(Number(pt.line_amount)||0),0),Ie=je*(a.global_gst_rate||5)/100,Le=je+Ie;return isNaN(je)&&(je=0),isNaN(Ie)&&(Ie=0),isNaN(Le)&&(Le=0),i.jsxs(Z,{p:{xs:2,md:4},maxWidth:1e3,mx:"auto",children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Purchase Order Details"}),i.jsx(Rr,{variant:"outlined",sx:{mb:3},children:i.jsx(Hr,{children:i.jsxs(ie,{container:!0,spacing:{xs:2,md:3},children:[i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Purchase Order #:"})," ",a.purchase_number]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Vendor:"})," ",a.vendor_name||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Purchase Date:"})," ",a.purchase_date?new Date(a.purchase_date).toLocaleDateString():""]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Transaction Date:"})," ",d?new Date(d).toLocaleDateString():""]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Created On:"})," ",a.created_at?new Date(a.created_at).toLocaleDateString():"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Status:"})," ",a.status?.toUpperCase()||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Bill Number:"})," ",a.bill_number||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"GST Rate:"})," ",(a.global_gst_rate||5).toFixed(2),"%"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"QuickBooks Export:"})," ",a.exported_to_qbo?"Exported":a.qbo_export_status?`Error: ${a.qbo_export_status}`:"Not Exported"]})]})})}),a.return_orders&&i.jsx(Z,{mb:3,children:Us()}),i.jsx(B,{variant:"h5",gutterBottom:!0,children:"Items"}),i.jsx(Rr,{variant:"outlined",children:i.jsx(Hr,{children:be.map((De,pt)=>i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:3,md:2,children:De.part_number}),i.jsx(ie,{item:!0,xs:6,sm:5,md:4,children:De.part_description}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1.5,children:De.quantity}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1.5,children:De.unit}),i.jsxs(ie,{item:!0,xs:4,sm:2,md:1.5,children:["$",zne(Number(De.unit_cost)||0)]}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1,children:za(Number(De.line_amount)||0)})]},pt))})}),i.jsxs(Z,{mt:4,display:"flex",flexDirection:"column",alignItems:"flex-end",children:[i.jsxs(B,{variant:"h6",children:["Subtotal: ",za(je)]}),i.jsxs(B,{variant:"h6",children:["Total GST: ",za(Ie)]}),i.jsxs(B,{variant:"h6",children:["Total Amount: ",za(Le)]})]}),i.jsxs(Z,{mt:4,display:"flex",justifyContent:{xs:"center",sm:"flex-end"},gap:2,children:[i.jsx(xe,{variant:"contained",color:"primary",startIcon:i.jsx(la,{}),onClick:ao,children:"Download PDF"}),!a?.exported_to_qbo&&r?.access_role==="Admin"&&i.jsx(xe,{variant:"contained",color:"success",startIcon:i.jsx(Cp,{}),onClick:Ea,disabled:so,children:so?"Exporting...":"Export to QuickBooks"}),(r?.access_role==="Admin"||r?.access_role==="Sales and Purchase")&&i.jsx(xe,{variant:"contained",color:"secondary",startIcon:i.jsx(tu,{}),onClick:()=>E(!0),children:"Edit"}),i.jsx(xe,{variant:"outlined",color:"primary",onClick:Si,children:"View Allocations"})]}),i.jsxs(dr,{open:Ya,onClose:()=>lo(!1),maxWidth:"md",fullWidth:!0,children:[i.jsx(fr,{children:"Allocations"}),i.jsxs(hr,{dividers:!0,children:[Bn&&i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",py:4,children:i.jsx(er,{})}),!Bn&&ko&&i.jsx(Pt,{severity:"error",children:ko}),!Bn&&!ko&&(()=>{if(!ri||ri.length===0)return i.jsx(B,{variant:"body2",children:"No allocations were saved for this purchase order."});const De=ri.reduce((kt,Lt)=>{const jr=(Lt.part_number||"").toString();return kt[jr]||(kt[jr]=[]),kt[jr].push(Lt),kt},{}),pt=Object.keys(De).sort();return i.jsx(ut,{spacing:3,children:pt.map(kt=>{const Lt=De[kt],jr=Lt.find(fn=>fn.part_description)?.part_description||"",zr=Lt.reduce((fn,ta)=>fn+(Number(ta.allocate_qty)||0),0);return i.jsxs(Z,{children:[i.jsxs(B,{variant:"subtitle1",sx:{fontWeight:"bold"},children:[kt," ",jr?`- ${jr}`:""]}),i.jsx(ma,{component:bt,sx:{mt:1},children:i.jsxs(ia,{size:"small",children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{children:"Sales Order"}),i.jsx(Oe,{children:"Sales Order Number"}),i.jsx(Oe,{align:"right",children:"Allocated Qty"})]})}),i.jsxs(sa,{children:[Lt.map(fn=>i.jsxs(mr,{children:[i.jsxs(Oe,{children:["#",fn.sales_order_id]}),i.jsx(Oe,{children:Cl[fn.sales_order_id]?`SO-${Cl[fn.sales_order_id]}`:"-"}),i.jsx(Oe,{align:"right",children:Number(fn.allocate_qty||0).toFixed(2)})]},fn.allocation_id)),i.jsxs(mr,{children:[i.jsx(Oe,{sx:{fontWeight:600},children:"Total"}),i.jsx(Oe,{align:"right",sx:{fontWeight:600},children:zr.toFixed(2)})]})]})]})})]},kt)})})})()]}),i.jsx(_r,{children:i.jsx(xe,{onClick:()=>lo(!1),children:"Close"})})]})]})},Us=()=>{if(!a)return null;const be=a.return_orders??[],je=a.return_summary??{};return i.jsxs(bt,{sx:{p:3},elevation:1,children:[i.jsxs(ut,{direction:{xs:"column",md:"row"},alignItems:{xs:"flex-start",md:"center"},justifyContent:"space-between",spacing:2,children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"h6",children:"Return Orders"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"View vendor returns associated with this purchase order."})]}),i.jsxs(ut,{direction:"row",spacing:1,children:[i.jsx(ot,{label:`Requested: ${je.requested_count??0}`,color:"warning",variant:"outlined",size:"small"}),i.jsx(ot,{label:`Returned: ${je.returned_count??0}`,color:"success",variant:"outlined",size:"small"}),i.jsx(xe,{variant:"outlined",onClick:()=>t(`/return-orders/new?purchaseId=${a.purchase_id}`),children:"Create Return"})]})]}),be.length===0?i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"No return orders have been logged for this purchase order."}):i.jsx(ma,{component:Z,sx:{mt:2},children:i.jsxs(ia,{size:"small",children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{children:"Return #"}),i.jsx(Oe,{children:"Status"}),i.jsx(Oe,{children:"Requested"}),i.jsx(Oe,{children:"Returned"}),i.jsx(Oe,{align:"right",children:"Total Qty"}),i.jsx(Oe,{align:"right",children:"Actions"})]})}),i.jsx(sa,{children:be.map(Ie=>i.jsxs(mr,{hover:!0,children:[i.jsx(Oe,{children:Ie.return_number}),i.jsx(Oe,{children:i.jsx(ot,{label:Ie.status,size:"small",color:Ie.status==="Returned"?"success":"warning",variant:"outlined"})}),i.jsx(Oe,{children:Ie.requested_at?new Date(Ie.requested_at).toLocaleString():""}),i.jsx(Oe,{children:Ie.returned_at?new Date(Ie.returned_at).toLocaleString():""}),i.jsx(Oe,{align:"right",children:Number(Ie.total_quantity??0).toFixed(2)}),i.jsx(Oe,{align:"right",children:i.jsx(xe,{size:"small",onClick:()=>t(`/return-orders/${Ie.return_id}`),children:"View"})})]},Ie.return_id))})]})})]})};return!n&&!a?i.jsx(Z,{p:4,children:i.jsx(B,{variant:"h5",children:"Loading Purchase Order..."})}):it?i.jsx(Z,{p:4,children:i.jsx(B,{variant:"h5",children:"Loading..."})}):!n&&w==="Closed"&&!P?Ui():i.jsxs(i.Fragment,{children:[i.jsxs(Os,{dateAdapter:oc,children:[i.jsx(Ry,{when:fi,onSave:Zn}),i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:n?"Create New Purchase Order":`Edit Purchase Order: ${a?.purchase_number}`}),!n&&a&&i.jsxs(i.Fragment,{children:[i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2,mt:1},children:[i.jsx(ot,{label:a.order_placed?"Order Placed":"Order Not Placed",color:a.order_placed?"success":"warning",variant:"outlined",size:"small"}),i.jsx(ot,{label:`Vendor: ${a.vendor_confirmation_status||"pending"}`,color:a.vendor_confirmation_status==="confirmed"?"success":a.vendor_confirmation_status==="partial"?"warning":a.vendor_confirmation_status==="unavailable"?"error":"default",variant:"outlined",size:"small"}),a.pricing_updated&&i.jsx(ot,{label:"Pricing Updated",color:"info",variant:"outlined",size:"small"}),a.quantity_adjusted&&i.jsx(ot,{label:"Quantities Adjusted",color:"secondary",variant:"outlined",size:"small"})]}),a.created_at&&i.jsxs(B,{variant:"subtitle1",color:"text.secondary",sx:{mt:1},children:["Created On: ",new Date(a.created_at).toLocaleDateString()]})]})]}),i.jsxs(ut,{direction:"row",spacing:1,children:[i.jsx(xe,{variant:"contained",color:"primary",onClick:Zn,startIcon:i.jsx(Is,{}),children:n?"Create Purchase Order":w==="Closed"&&P?"Save Closed PO Edits":"Save Changes"}),!n&&w==="Closed"&&P&&i.jsx(xe,{variant:"outlined",color:"secondary",onClick:xn,startIcon:i.jsx(Hp,{}),children:"Cancel Edit"}),!n&&i.jsxs(i.Fragment,{children:[w!=="Closed"&&i.jsx(xe,{variant:"contained",color:"primary",onClick:Ta,startIcon:i.jsx(xv,{}),children:"Close PO"}),i.jsx(xe,{variant:"contained",color:"primary",onClick:ao,startIcon:i.jsx(la,{}),children:"Download PDF"}),i.jsx(xe,{variant:"contained",onClick:Bs,startIcon:i.jsx(gS,{}),sx:{backgroundColor:"#ff9800","&:hover":{backgroundColor:"#f57c00"}},children:"Email Vendor"})]})]})]}),!n&&a&&i.jsx(Z,{sx:{mb:3},children:Us()}),Zt&&i.jsxs(Pt,{severity:"warning",sx:{mb:3},onClose:()=>Xr(!1),children:[i.jsx(B,{variant:"body1",sx:{fontWeight:"medium"},children:"Bill Number Required"}),i.jsx(B,{variant:"body2",children:"A bill number is required to close this purchase order. Please enter a bill number before closing."})]}),i.jsx(Rr,{variant:"outlined",sx:{mb:3},children:i.jsxs(Hr,{children:[i.jsxs(ut,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:{xs:"stretch",sm:"center"},children:[i.jsxs(Z,{sx:{flexGrow:1},children:[i.jsx(B,{variant:"h6",children:"Invoice / Packing Slip OCR Prefill"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Upload one or multiple invoice/packing slip images (or a PDF) to extract vendor, bill, and line item details using on-server OCR."})]}),i.jsx("input",{type:"file",accept:"image/*,.pdf",multiple:!0,hidden:!0,ref:Qe,onChange:Fi}),i.jsx(xe,{variant:"contained",color:"secondary",startIcon:i.jsx(Cp,{}),onClick:()=>Qe.current?.click(),disabled:V,children:V?"Processing":"Upload Documents"}),V&&i.jsx(er,{size:24})]}),Me&&i.jsx(Pt,{severity:"error",sx:{mt:2},children:Me}),ee&&i.jsxs(Z,{sx:{mt:3},children:[i.jsxs(ut,{direction:{xs:"column",md:"row"},spacing:2,alignItems:{xs:"flex-start",md:"center"},children:[i.jsxs(Z,{sx:{flexGrow:1},children:[i.jsxs(ut,{direction:"row",spacing:1,alignItems:"center",children:[i.jsx(B,{variant:"subtitle1",children:"Detected Fields"}),i.jsx(ot,{size:"small",color:ee.source==="ai"?"info":"default",variant:ee.source==="ai"?"filled":"outlined",label:ee.source==="ai"?"Gemini AI analysis":"OCR extraction"})]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Review the extracted details and apply them to this purchase order."}),ee.files?.length?i.jsx(ut,{direction:"row",spacing:1,sx:{flexWrap:"wrap",mt:1},children:ee.files.map(be=>i.jsx(ot,{size:"small",label:be.originalName,variant:"outlined"},be.storedName))}):ee.file?i.jsx(B,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:ee.file.originalName}):null]}),i.jsx(ut,{direction:"row",spacing:1,children:i.jsx(xe,{variant:"contained",color:"primary",onClick:wi,children:"Apply to Form"})})]}),i.jsxs(ie,{container:!0,spacing:2,sx:{mt:1},children:[i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsx(B,{variant:"body2",color:"text.secondary",children:"Vendor"}),i.jsx(B,{variant:"body1",children:ee.ocr.normalized.vendorName||"Not detected"}),ee.ocr.normalized.vendorAddress&&i.jsx(B,{variant:"body2",color:"text.secondary",children:ee.ocr.normalized.vendorAddress})]}),i.jsxs(ie,{item:!0,xs:12,md:3,children:[i.jsx(B,{variant:"body2",color:"text.secondary",children:"Bill Number"}),i.jsx(B,{variant:"body1",children:ee.ocr.normalized.billNumber||"Not detected"})]}),i.jsxs(ie,{item:!0,xs:12,md:3,children:[i.jsx(B,{variant:"body2",color:"text.secondary",children:"Bill Date"}),i.jsx(B,{variant:"body1",children:ee.ocr.normalized.billDate||"Not detected"})]})]}),ee.ocr.normalized.lineItems.length>0&&i.jsxs(Z,{sx:{mt:2},children:[i.jsxs(B,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Sample of detected line items (",ee.ocr.normalized.lineItems.length," total)"]}),i.jsx(bt,{variant:"outlined",sx:{maxHeight:200,overflowY:"auto",p:1},children:ee.ocr.normalized.lineItems.slice(0,5).map((be,je)=>i.jsxs(Z,{sx:{py:.5},children:[i.jsxs(B,{variant:"body2",sx:{fontWeight:500},children:[be.partNumber?`${be.partNumber}  `:"",be.description]}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:["Qty: ",be.quantity??"n/a"," | Unit Cost: ",be.unitCost??"n/a"," | Total: ",be.totalCost??"n/a"]})]},`${be.rawLine}-${je}`))})]}),(ee.ocr.warnings.length>0||ee.ocr.notes.length>0)&&i.jsxs(ut,{direction:"row",spacing:1,sx:{mt:2,flexWrap:"wrap"},children:[ee.ocr.warnings.map((be,je)=>i.jsx(ot,{label:be,color:"warning",variant:"outlined",sx:{mr:1,mb:1}},`ocr-warning-${je}`)),ee.ocr.notes.map((be,je)=>i.jsx(ot,{label:be,color:"info",variant:"outlined",sx:{mr:1,mb:1}},`ocr-note-${je}`))]})]})]})}),i.jsx(bt,{sx:{p:3},children:i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ra,{disablePortal:!1,open:R,onOpen:()=>k(!0),onClose:()=>k(!1),autoHighlight:!0,value:s,onChange:(be,je)=>{if(H){W(!1);return}je&&je.isNew?(Ci(!0),ni({vendor_name:z}),l(null),K(""),k(!1)):(l(je),k(!1))},filterOptions:(be,je)=>{const Ie=hc(be,je.inputValue||""),Le=!!$s(je.inputValue||""),De=[...Ie];return(je.inputValue||"").trim()!==""&&!Le&&De.push({label:`Add "${je.inputValue}" as New Vendor`,isNew:!0}),Ie.length===0&&(je.inputValue||"").trim()!==""&&!Le,De},inputValue:z,onInputChange:(be,je,Ie)=>{if(K(je),Ie==="reset")return;(je||"").trim()||k(!1)},options:L,getOptionLabel:be=>typeof be=="string"?be:be.label,isOptionEqualToValue:(be,je)=>be.id===je.id,onHighlightChange:(be,je)=>N(je),ListboxProps:{role:"listbox",style:{maxHeight:320,overflowY:"auto"}},renderOption:(be,je)=>{const Ie=je.isNew,{key:Le,...De}=be;return i.jsxs("li",{...De,style:{display:"flex",alignItems:"center",opacity:Ie?.9:1},children:[Ie&&i.jsx(Zl,{fontSize:"small",style:{marginRight:8,color:"#666"}}),i.jsx("span",{children:je.label})]},Le)},renderInput:be=>i.jsx(Pe,{...be,label:"Vendor",error:!!Ir.vendor,helperText:Ir.vendor,onFocus:vt,onKeyDown:Eo,onBlur:()=>{if(k(!1),!s){const je=z.trim();if(je){const Ie=$s(je);Ie&&(l(Ie),K(Ie.label))}}},inputRef:je=>{J.current=je}})})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"Bill Number",value:h,onChange:be=>{p(be.target.value),be.target.value.trim()!==""&&Xr(!1)},fullWidth:!0,error:!!Ir.billNumber,helperText:Ir.billNumber})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"GST Rate (%)",type:"number",value:T,onChange:be=>S(Number(be.target.value)),fullWidth:!0,inputProps:{min:0,max:100,step:"0.01",readOnly:w==="Closed"&&!P,onWheel:be=>be.currentTarget.blur()},helperText:"Change GST rate if needed (default 5%). This will affect GST and total calculations.",disabled:w==="Closed"&&!P})})]})}),i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:3,mb:2},children:[i.jsx(B,{variant:"h6",children:"Line Items"}),i.jsx(xe,{variant:"contained",onClick:Gr,startIcon:i.jsx(xv,{}),sx:{backgroundColor:n?"#e0e0e0":"#ff9800",color:"#fff","&:hover":{backgroundColor:n?"#e0e0e0":"#f57c00"},"&.Mui-disabled":{color:"#fff"}},disabled:n,children:"  Allocate Parts"})]}),i.jsxs(bt,{sx:{p:3,mb:3,mt:0},elevation:3,children:[i.jsx(ie,{container:!0,spacing:2,children:b.map((be,je)=>i.jsxs(Ae.Fragment,{children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Ra,{disablePortal:!1,open:at===je,onOpen:()=>St(je),onClose:()=>St(null),autoHighlight:!0,value:be.part_number,inputValue:tr[je]??be.part_number,onInputChange:(Ie,Le,De)=>{if(wr(kt=>({...kt,[je]:Le})),De==="reset")return;(Le||"").trim()||St(null)},onChange:(Ie,Le)=>{if(typeof Le=="string"){const De=Le,pt=oe.find(jr=>jr.part_number===De),kt=I[De]||I[De?.toUpperCase?.()||""]||I[De?.toLowerCase?.()||""]||0,Lt=typeof kt=="string"?parseFloat(kt):kt;_(jr=>{const zr=[...jr],fn=zr[je];if(pt){const ta=fn.unit_cost,Pi=String(!ta||ta===""||ta==="0"?pt.last_unit_cost:ta),ai={...fn,part_number:De,part_description:pt.part_description,unit:pt.unit,unit_cost:Pi,quantity_to_order:Lt};if(ai.line_amount=Mt(ai),zr[je]=ai,Xe(pt.part_number),s?.id){const Ia=(()=>{const Fa=pe[pt.part_number.toUpperCase()]||[];if(Fa.length===0)return null;const zi=Fa.filter(Oi=>Oi.vendor_id===s.id);if(zi.length>0){const Oi=zi.find(Hi=>Hi.preferred);if(Oi)return Oi.vendor_part_number;const Wi=[...zi].sort((Hi,ps)=>(ps.usage_count||0)-(Hi.usage_count||0))[0];if(Wi)return Wi.vendor_part_number}const uo=Fa.find(Oi=>Oi.preferred);if(uo)return uo.vendor_part_number;const Io=[...Fa].sort((Oi,Wi)=>(Wi.usage_count||0)-(Oi.usage_count||0))[0];return Io?Io.vendor_part_number:null})();Ia&&(zr[je].part_number=Ia)}}else zr[je]={...fn,part_number:De};return zr}),kr(je,De),St(null),wr(jr=>({...jr,[je]:""}))}else if(Le&&typeof Le=="object"&&"isNew"in Le){const De=Le.inputValue||"";jt(De),Ot(je),$e({part_number:De.toUpperCase(),category:"Uncategorized"}),Je("manual"),wt(!0),St(null),wr(pt=>({...pt,[je]:""}))}},options:oe.map(Ie=>Ie.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,getOptionLabel:Ie=>typeof Ie=="string"?Ie:Ie.label,renderOption:(Ie,Le)=>{const De=typeof Le=="object"&&Le.isNew,pt=typeof Le=="string"?Le:Le.label,{key:kt,...Lt}=Ie;return i.jsxs("li",{...Lt,children:[De&&i.jsx(Zl,{fontSize:"small",style:{marginRight:8,color:"#666"}}),typeof Le=="string"?i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",children:Le}),(()=>{const jr=Ye[String(Le)]||"";return jr?i.jsx(B,{variant:"caption",color:"text.secondary",children:jr}):null})()]}):pt]},kt)},filterOptions:(Ie,Le)=>Ze(Ie,Le,!0),ListboxProps:{role:"listbox",style:{maxHeight:320,overflowY:"auto"}},renderInput:Ie=>i.jsx(Pe,{...Ie,label:"Part Number",fullWidth:!0,required:!0,error:!!Ir.lineItems?.[je]?.part_number,helperText:Ir.lineItems?.[je]?.part_number,onKeyDown:Le=>To(je,Le),onBlur:()=>{St(null);const De=(b[je]?.part_number||"").trim();if(!De)return;const pt=co(De);if(pt){const kt=oe.find(zr=>zr.part_number===pt),Lt=I[pt]||I[pt?.toUpperCase?.()||""]||I[pt?.toLowerCase?.()||""]||0,jr=typeof Lt=="string"?parseFloat(Lt):Lt;_(zr=>{const fn=[...zr],ta=fn[je];if(kt){const Yn=ta.unit_cost,ai=String(!Yn||Yn===""||Yn==="0"?kt.last_unit_cost:Yn),Ia={...ta,part_number:pt,part_description:kt.part_description,unit:kt.unit,unit_cost:ai,quantity_to_order:jr};Ia.line_amount=Mt(Ia),fn[je]=Ia}else fn[je]={...ta,part_number:pt};return fn}),kr(je,pt)}}})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Pe,{label:"Part Description",value:be.part_description,InputProps:{readOnly:!0},fullWidth:!0,error:!!Ir.lineItems?.[je]?.part_description,helperText:Ir.lineItems?.[je]?.part_description})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Pe,{label:"Qty",value:be.quantity,onChange:Ie=>ro(je,"quantity",Ie.target.value),type:"number",fullWidth:!0,required:!0,error:!!Ir.lineItems?.[je]?.quantity,helperText:Ir.lineItems?.[je]?.quantity,inputProps:{step:"1",onWheel:Ie=>Ie.currentTarget.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Pe,{label:"Unit",value:be.unit,select:!0,fullWidth:!0,disabled:!0,InputProps:{readOnly:!0},children:rl.map(Ie=>i.jsx(Jt,{value:Ie,children:Ie},Ie))})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Unit Cost",value:be.unit_cost,onChange:Ie=>ro(je,"unit_cost",Ie.target.value),type:"number",fullWidth:!0,error:!!Ir.lineItems?.[je]?.unit_cost,helperText:Ir.lineItems?.[je]?.unit_cost,inputProps:{step:"0.0001",onWheel:Ie=>Ie.currentTarget.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Amount",value:be.line_amount!=null&&!isNaN(Number(be.line_amount))?Number(be.line_amount).toFixed(2):"0.00",InputProps:{readOnly:!0},fullWidth:!0})}),i.jsxs(ie,{item:!0,xs:12,sm:1,md:1,sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(xe,{variant:"outlined",color:"primary",onClick:()=>ar(je),sx:{flexShrink:0},children:"Remove"}),(()=>{const Ie=n?"Open":w,Le=Ie==="Open"&&typeof be.quantity_to_order=="number"&&be.quantity_to_order>0;return console.log(`Rendering Qty to Order for ${be.part_number}:`,{status:w,isCreationMode:n,effectiveStatus:Ie,quantity_to_order:be.quantity_to_order,type:typeof be.quantity_to_order,shouldShow:Le}),Le?i.jsx(Pe,{label:"Qty to Order",value:be.quantity_to_order,size:"small",InputProps:{readOnly:!0},sx:{backgroundColor:"#fff3cd",minWidth:"120px","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#ffc107"},"&:hover fieldset":{borderColor:"#ffc107"}}}}):null})()]})]},je))}),i.jsx(Z,{sx:{mt:2},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:qi,children:"Add Line Item"})})]}),i.jsx(bt,{sx:{p:3,mb:3},elevation:3,children:i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Subtotal: $",$r!=null&&!isNaN(Number($r))?Number($r).toFixed(2):"0.00"]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Total GST: $",Vr!=null&&!isNaN(Number(Vr))?Number(Vr).toFixed(2):"0.00"]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"h6",children:["Total Amount: $",In!=null&&!isNaN(Number(In))?Number(In).toFixed(2):"0.00"]})})]})}),i.jsx(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:3,mb:2},children:i.jsx(B,{variant:"h6",children:"Pickup Details for Drivers"})}),i.jsx(bt,{sx:{p:3,mb:3},elevation:3,children:i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Pickup Time",placeholder:"e.g., tomorrow at 2 PM, Friday morning",value:a?.pickup_time||"",onChange:be=>{a&&o({...a,pickup_time:be.target.value})},fullWidth:!0,helperText:"When to pick up the order"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Pickup Location",placeholder:"e.g., 123 Main St, Building A, Loading Dock",value:a?.pickup_location||"",onChange:be=>{a&&o({...a,pickup_location:be.target.value})},fullWidth:!0,helperText:"Where to pick up the order"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Contact Person",placeholder:"e.g., John Smith, Warehouse Manager",value:a?.pickup_contact_person||"",onChange:be=>{a&&o({...a,pickup_contact_person:be.target.value})},fullWidth:!0,helperText:"Name of person to contact at pickup location"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Contact Phone",placeholder:"e.g., (555) 123-4567",value:a?.pickup_phone||"",onChange:be=>{a&&o({...a,pickup_phone:be.target.value})},fullWidth:!0,helperText:"Phone number for pickup contact person"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Pickup Instructions",placeholder:"e.g., Use loading dock on east side, call 15 minutes before arrival, parking available in lot B",value:a?.pickup_instructions||"",onChange:be=>{a&&o({...a,pickup_instructions:be.target.value})},fullWidth:!0,multiline:!0,rows:3,helperText:"Special instructions for pickup (parking, loading dock, etc.)"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Pickup Notes",placeholder:"e.g., After-hours pickup available, bring ID, parts are in warehouse section C",value:a?.pickup_notes||"",onChange:be=>{a&&o({...a,pickup_notes:be.target.value})},fullWidth:!0,multiline:!0,rows:2,helperText:"General notes about pickup for drivers"})})]})}),i.jsx(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:3,mb:2},children:i.jsx(B,{variant:"h6",children:"Order Placement Tracking"})}),i.jsx(bt,{sx:{p:3,mb:3},elevation:3,children:i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx("input",{type:"checkbox",checked:a?.order_placed||!1,onChange:be=>{a&&o({...a,order_placed:be.target.checked,order_placed_at:be.target.checked?new Date().toISOString():void 0,order_placed_by:be.target.checked?Number(r?.id):void 0,order_placed_method:be.target.checked?"manual":void 0})},style:{transform:"scale(1.5)"}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:"bold"},children:"Order Placed with Vendor"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:a?.order_placed?`Placed on ${new Date(a.order_placed_at||"").toLocaleDateString()}`:"Order not yet placed"})]})]})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsxs(Pe,{select:!0,label:"Vendor Confirmation Status",value:a?.vendor_confirmation_status||"pending",onChange:be=>{a&&o({...a,vendor_confirmation_status:be.target.value,vendor_confirmation_date:be.target.value!=="pending"?new Date().toISOString():void 0})},fullWidth:!0,helperText:"Current vendor confirmation status",children:[i.jsx(Jt,{value:"pending",children:"Pending"}),i.jsx(Jt,{value:"confirmed",children:"Confirmed"}),i.jsx(Jt,{value:"partial",children:"Partially Available"}),i.jsx(Jt,{value:"unavailable",children:"Unavailable"})]})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Vendor Confirmation Notes",placeholder:"e.g., Parts available, pricing confirmed, minimum order 10ft packs",value:a?.vendor_confirmation_notes||"",onChange:be=>{a&&o({...a,vendor_confirmation_notes:be.target.value})},fullWidth:!0,multiline:!0,rows:2,helperText:"Notes from vendor about order confirmation, availability, and pricing"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx("input",{type:"checkbox",checked:a?.pricing_updated||!1,onChange:be=>{a&&o({...a,pricing_updated:be.target.checked,pricing_updated_at:be.target.checked?new Date().toISOString():void 0,pricing_updated_by:be.target.checked?Number(r?.id):void 0,pricing_updated_method:be.target.checked?"manual":void 0})},style:{transform:"scale(1.5)"}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:"bold"},children:"Pricing Updated"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:a?.pricing_updated?`Updated on ${new Date(a.pricing_updated_at||"").toLocaleDateString()}`:"Pricing not yet updated"})]})]})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx("input",{type:"checkbox",checked:a?.quantity_adjusted||!1,onChange:be=>{a&&o({...a,quantity_adjusted:be.target.checked,quantity_adjusted_at:be.target.checked?new Date().toISOString():void 0,quantity_adjusted_by:be.target.checked?Number(r?.id):void 0,quantity_adjusted_method:be.target.checked?"manual":void 0})},style:{transform:"scale(1.5)"}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:"bold"},children:"Quantities Adjusted"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:a?.quantity_adjusted?`Adjusted on ${new Date(a.quantity_adjusted_at||"").toLocaleDateString()}`:"Quantities not yet adjusted"})]})]})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Vendor Pricing Structure Notes",placeholder:"e.g., Sold by 10ft packs, minimum order 50ft, bulk pricing available over 100ft",value:a?.vendor_pricing_notes||"",onChange:be=>{a&&o({...a,vendor_pricing_notes:be.target.value})},fullWidth:!0,multiline:!0,rows:2,helperText:"Notes about vendor pricing structure, minimum orders, and packaging units"})}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx(Z,{sx:{display:"flex",justifyContent:"center",mt:2},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:io,disabled:!a||b.length===0,sx:{minWidth:"200px"},children:"Adjust Quantities (Vendor Confirmation)"})}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",mt:1},children:"Use this when vendor confirms different quantities (e.g., sold by 10ft packs)"})]}),(a?.original_quantities||a?.adjusted_quantities)&&i.jsxs(ie,{item:!0,xs:12,children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:"bold",mb:2},children:"Quantity Adjustments"}),i.jsx(ie,{container:!0,spacing:2,children:b.map((be,je)=>{const Ie=a?.original_quantities?.[je]||be.quantity,Le=a?.adjusted_quantities?.[je]||be.quantity;return Ie!==Le?i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsxs(bt,{sx:{p:2,backgroundColor:"#f5f5f5"},elevation:1,children:[i.jsx(B,{variant:"body2",sx:{fontWeight:"bold"},children:be.part_number}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Original: ",Ie,"  Adjusted: ",Le]})]})},je):null})})]})]})}),i.jsx(ec,{open:We,onClose:Al,onSave:async be=>{try{const je=await ve.post("/api/inventory",be);console.log("New part added successfully:",je.data);const Ie=await ve.get("/api/inventory");ae(Ie.data);const Le=je.data.item;It!==null&&_(De=>{const pt=[...De];return pt[It]={...pt[It],part_number:Le.part_number,part_description:Le.part_description,unit:Le.unit,unit_cost:String(Le.last_unit_cost),quantity:pt[It].quantity},pt[It].line_amount=Mt(pt[It]),pt}),Al()}catch(je){throw je}},title:He==="ocr"?"Add New Part from OCR":"Add New Part",initialPart:lr??{part_number:Wt.toUpperCase(),category:"Uncategorized"}}),i.jsx(QL,{open:Fs,onClose:()=>{Ci(!1),ni({})},onSave:async be=>{try{const Ie=(await ve.post("/api/vendors",be)).data.vendor;q(Le=>[...Le,{label:Ie.vendor_name,id:Ie.vendor_id,email:Ie.email}]),l({label:Ie.vendor_name,id:Ie.vendor_id,email:Ie.email}),!n&&a&&o(Le=>Le&&{...Le,vendor_id:Ie.vendor_id,vendor_name:Ie.vendor_name}),Ci(!1),ni({}),me.success("Vendor added successfully!")}catch{me.error("Failed to add vendor.")}},initialVendor:Ko,isEditMode:!1}),i.jsx(jde,{open:ji,onClose:()=>oo(!1),purchaseOrderId:a?.purchase_id||0,onSuccess:ea,onAllocationSaved:Cn}),i.jsx(Z6,{open:hi,onClose:()=>Oo(!1),type:"purchase-order",recordId:a?.purchase_id,defaultTo:$i,allowMessageEdit:!0}),hi&&i.jsxs("div",{style:{display:"none"},children:["Debug: vendorEmail = ",$i,", vendor = ",JSON.stringify(s)]})]})]}),i.jsx(hl,{open:!!Gn,autoHideDuration:6e3,onClose:()=>Tn(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Pt,{onClose:()=>Tn(null),severity:"success",sx:{width:"100%"},children:Gn})})]})},Pde=()=>{const e=kn(),[t,r]=x.useState([]),[n,a]=x.useState({totalReceivables:0,totalOverdue:0}),[o,s]=x.useState(!1),[l,c]=x.useState(!0),[u,d]=x.useState(0),f=x.useRef(0),h=200,[p,v]=x.useState([]),[m,y]=x.useState(null),[b,_]=x.useState(""),[w,A]=x.useState(null),[P,E]=x.useState(!1),[T,S]=x.useState(!1),[I,U]=x.useState(""),[O,M]=x.useState("unpaid"),[L,q]=x.useState(()=>{const Ye=new Date;return`${Ye.getFullYear()}-${String(Ye.getMonth()+1).padStart(2,"0")}`}),[z,K]=x.useState(!1),[J,R]=x.useState(!1),k=x.useRef(null),$=x.useRef(null),X="invoices.columnVisibility",[C,N]=x.useState(()=>{if(typeof window>"u")return{};const Ye=localStorage.getItem(X);if(Ye)try{return JSON.parse(Ye)}catch{}return{}}),[H,W]=x.useState(null),[ne,se]=x.useState([]);x.useEffect(()=>{typeof window<"u"&&localStorage.setItem(X,JSON.stringify(C))},[C]),x.useEffect(()=>{(async()=>{try{const Ye=await cS();v(Ye.map(Ze=>({id:Ze.customer_id||Ze.id,label:Ze.customer_name})))}catch(Ye){console.error("Failed to load customers",Ye)}})()},[]),x.useEffect(()=>{(async()=>{if(!m?.id){A(null);return}try{const Ze=await GL(String(m.id));A(Ze)}catch(Ze){console.error("Failed to load customer detail",Ze),A(null)}})()},[m?.id]);const oe=(Ye,Ze)=>{se(Ze),W(Ye.currentTarget)},ae=()=>W(null),pe=x.useMemo(()=>{if(O!=="all")return O==="paid"?"Paid":"Unpaid"},[O]),ge=x.useCallback(async(Ye=!1)=>{const Ze=Ye?0:f.current;Ye&&(f.current=0,d(0),c(!0)),s(!0);try{const We=await dE({customer_id:m?.id,status:pe,limit:h,offset:Ze}),wt=We.invoices.map(Ot=>({...Ot,id:Ot.invoice_id}));r(Ot=>Ye?wt:[...Ot,...wt]),a(We.summary);const It=Ze+wt.length;f.current=It,d(It),c(We.hasMore??wt.length===h)}catch(We){console.error("Failed to load invoices",We),Ye&&(r([]),d(0)),c(!1),a({totalReceivables:0,totalOverdue:0})}finally{s(!1)}},[m?.id,pe]),Q=x.useCallback(async()=>{s(!0);try{const Ye=await dE({customer_id:m?.id,status:pe}),Ze=Ye.invoices.map(We=>({...We,id:We.invoice_id}));r(Ze),a(Ye.summary),f.current=Ze.length,d(Ze.length),c(!1)}catch(Ye){console.error("Failed to load all invoices",Ye),me.error("Failed to load all invoices")}finally{s(!1)}},[m?.id,pe]);x.useEffect(()=>{ge(!0)},[ge,m?.id,pe]);const G=Ye=>{e(`/invoices/${Ye.row.invoice_id}`)},ee=x.useCallback(async Ye=>{if(Ye&&window.confirm("Delete this invoice? This cannot be undone."))try{await yae(Ye),me.success("Invoice deleted."),ge(!0)}catch(Ze){console.error("Failed to delete invoice",Ze),me.error("Failed to delete invoice.")}},[ge]),le=x.useMemo(()=>{const Ye=[{field:"invoice_number",headerName:"Invoice #",flex:1,minWidth:140},{field:"customer_name",headerName:"Customer",flex:1.2,minWidth:160},{field:"sales_order_number",headerName:"SO #",minWidth:140,flex:1},{field:"product_name",headerName:"Product",minWidth:140,flex:1.1},{field:"product_description",headerName:"Product Description",minWidth:200,flex:1.5},{field:"vin_number",headerName:"VIN #",minWidth:120},{field:"unit_number",headerName:"Unit #",minWidth:120},{field:"mileage",headerName:"Mileage",minWidth:110},{field:"vehicle_make",headerName:"Make",minWidth:120},{field:"vehicle_model",headerName:"Model",minWidth:120},{field:"invoice_date",headerName:"Invoice Date",minWidth:130,valueFormatter:We=>We.value?new Date(We.value).toLocaleDateString():""},{field:"due_in",headerName:"Due In",minWidth:140,renderCell:We=>{const wt=We.row.due_date?new Date(We.row.due_date):null;if(!wt)return"";const It=new Date,Ot=wt.getTime()-It.getTime(),Wt=Math.round(Ot/(1e3*60*60*24)),jt=Wt<0,lr=`${Wt} day${Math.abs(Wt)===1?"":"s"}`;return i.jsxs(ut,{direction:"row",spacing:1,alignItems:"center",children:[i.jsx(B,{color:jt?"error":"success.main",fontWeight:600,children:lr}),jt&&i.jsx($L,{color:"error",fontSize:"small"})]})},valueGetter:We=>We.row.due_date||null},{field:"status",headerName:"Status",minWidth:120,renderCell:We=>i.jsx(ot,{label:We.value,color:We.value==="Paid"?"success":"default",size:"small"})},{field:"total_amount",headerName:"Total",minWidth:120,valueFormatter:We=>za(Number(We.value)||0)}],Ze={field:"actions",headerName:"Actions",type:"actions",width:90,getActions:We=>String(We.row.status||"").toLowerCase()!=="unpaid"?[]:[i.jsx(w8,{icon:i.jsx(ga,{color:"error"}),label:"Delete",onClick:wt=>{wt.stopPropagation(),ee(We.row.invoice_id)},showInMenu:!1},"delete")]};return[...Ye,Ze]},[ee]),V=x.useMemo(()=>{const Ye=I.toLowerCase();return t.filter(Ze=>[Ze.invoice_number,Ze.sales_order_number,Ze.customer_name,Ze.product_name,Ze.product_description,Ze.vin_number,Ze.unit_number,Ze.mileage,Ze.vehicle_make,Ze.vehicle_model,Ze.invoice_date?new Date(Ze.invoice_date).toLocaleDateString():"",Ze.due_date?new Date(Ze.due_date).toLocaleDateString():""].filter(We=>We!=null).some(We=>We.toString().toLowerCase().includes(Ye)))},[t,I]),Ve=x.useMemo(()=>t.filter(Ye=>{const Ze=Ye.due_date?new Date(Ye.due_date):null;return Ye.status==="Unpaid"&&Ze&&Ze<new Date}).length,[t]),Me=async()=>{if(!L){me.error("Select a month for the statement.");return}try{const Ye=await bae({month:L,customer_id:m?.id}),Ze=new Blob([Ye.data],{type:"application/pdf"}),We=window.URL.createObjectURL(Ze),wt=document.createElement("a");wt.href=We;const It=m?.label?m.label.replace(/\s+/g,"_"):"all-customers";wt.download=`statement-${It}-${L}.pdf`,wt.click(),window.URL.revokeObjectURL(We),me.success("Statement downloaded.")}catch(Ye){console.error("Error downloading statements",Ye),me.error("Failed to download statement.")}},Fe=async()=>{try{const Ye=await _ae(),Ze=new Blob([Ye.data],{type:"text/csv"}),We=window.URL.createObjectURL(Ze),wt=document.createElement("a");wt.href=We,wt.download="invoice_import_template.csv",wt.click(),window.URL.revokeObjectURL(We),me.success("Template downloaded.")}catch(Ye){console.error("Error downloading template",Ye),me.error("Failed to download template.")}},Qe=()=>{k.current?.click()},it=()=>{$.current?.click()},st=async Ye=>{const Ze=Ye.target.files?.[0];if(Ze){K(!0);try{const We=await wae(Ze);me.success(`Upload complete. Created: ${We.summary?.invoicesCreated??0}, skipped: ${We.summary?.invoicesSkipped??0}`),We.warnings?.length&&console.warn("Invoice CSV upload warnings:",We.warnings),ge(!0)}catch(We){console.error("Error uploading invoice CSV",We);const wt=We?.response?.data?.error||"Failed to upload CSV",It=We?.response?.data?.errors?.[0];me.error(It?`${wt}: ${It}`:wt)}finally{K(!1),k.current&&(k.current.value="")}}},vt=async Ye=>{const Ze=Ye.target.files?.[0];if(Ze){R(!0);try{const We=await jae(Ze),wt=We.summary?.updated??0,It=We.summary?.missingInvoices??We.missingInvoices?.length??0;me.success(`Unit upload complete. Updated: ${wt}${It?`, missing invoices: ${It}`:""}`),We.warnings?.length&&console.warn("Invoice unit CSV warnings:",We.warnings),ge(!0)}catch(We){console.error("Error uploading invoice unit CSV",We);const wt=We?.response?.data?.error||"Failed to upload unit CSV",It=We?.response?.data?.warnings?.[0];me.error(It?`${wt}: ${It}`:wt)}finally{R(!1),$.current&&($.current.value="")}}};return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(ut,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},mb:3,children:[i.jsx(B,{variant:"h4",children:"Invoices"}),i.jsxs(ut,{direction:"row",spacing:1,children:[i.jsx(xe,{startIcon:i.jsx(Bw,{}),variant:"outlined",onClick:Ye=>oe(Ye,le),children:"Columns"}),i.jsx(xe,{startIcon:i.jsx(Ts,{}),variant:"outlined",onClick:()=>ge(!0),children:"Refresh"}),i.jsx(xe,{startIcon:i.jsx(la,{}),variant:"outlined",onClick:Fe,children:"Download Template"}),i.jsx(xe,{startIcon:i.jsx(Cd,{}),variant:"outlined",color:"secondary",onClick:it,disabled:J,children:J?"Uploading units...":"Upload Unit CSV"}),i.jsx(xe,{startIcon:i.jsx(Cd,{}),variant:"outlined",color:"secondary",onClick:Qe,disabled:z,children:z?"Uploading...":"Upload CSV"}),i.jsx(xe,{startIcon:i.jsx(Va,{}),variant:"contained",onClick:()=>e("/invoices/new"),children:"New Invoice"}),i.jsx(xe,{startIcon:i.jsx(la,{}),variant:"outlined",onClick:Me,children:"Download Statement"})]})]}),i.jsx("input",{type:"file",accept:".csv,text/csv",ref:k,style:{display:"none"},onChange:st}),i.jsx("input",{type:"file",accept:".csv,text/csv",ref:$,style:{display:"none"},onChange:vt}),i.jsx(bt,{sx:{mb:3,p:2,border:"1px solid",borderColor:"divider"},children:i.jsxs(ut,{direction:{xs:"column",sm:"row"},spacing:3,alignItems:"flex-start",children:[i.jsxs(Z,{children:[i.jsxs(B,{variant:"h6",sx:{fontWeight:"bold",color:"primary.main"},children:["Total Receivables: ",za(n.totalReceivables)]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Total value of all unpaid invoices"})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle1",children:"Overdue"}),i.jsx(B,{variant:"h6",color:n.totalOverdue>0?"error":"inherit",children:za(n.totalOverdue)})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle1",children:"Overdue Count"}),i.jsx(B,{variant:"h6",children:Ve})]})]})}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsxs(ut,{direction:"row",spacing:3,sx:{mb:2},flexWrap:"wrap",children:[i.jsx(Pe,{label:"Search",variant:"outlined",value:I,onChange:Ye=>U(Ye.target.value),InputProps:{startAdornment:i.jsx(aa,{position:"start",children:i.jsx(di,{sx:{fontSize:22}})})},sx:{minWidth:300,maxWidth:380,"& .MuiInputBase-input":{fontSize:18,py:1.5},"& .MuiInputLabel-root":{fontSize:16}},size:"small"}),i.jsx(Pe,{label:"Statement Month",type:"month",value:L,onChange:Ye=>q(Ye.target.value),size:"small",sx:{minWidth:170},InputLabelProps:{shrink:!0}}),i.jsx(Ra,{options:p,getOptionLabel:Ye=>Ye.label,value:m,inputValue:b,onInputChange:(Ye,Ze)=>_(Ze),onChange:(Ye,Ze)=>y(Ze),renderInput:Ye=>i.jsx(Pe,{...Ye,label:"Customer (optional)",size:"small",placeholder:"Choose customer or leave empty for all",sx:{minWidth:260}}),clearOnBlur:!1}),i.jsx(ot,{label:"All",onClick:()=>M("all"),color:O==="all"?"primary":"default",sx:{fontSize:16,px:3,py:1,minWidth:80,height:40}}),i.jsx(ot,{label:"Unpaid",onClick:()=>M("unpaid"),color:O==="unpaid"?"primary":"default",sx:{fontSize:16,px:3,py:1,minWidth:90,height:40}}),i.jsx(ot,{label:"Paid",onClick:()=>M("paid"),color:O==="paid"?"primary":"default",sx:{fontSize:16,px:3,py:1,minWidth:80,height:40}}),i.jsx(Z,{sx:{flexGrow:1}})]}),w&&i.jsx(bt,{variant:"outlined",sx:{p:2,mb:2,backgroundColor:"#fafafa",borderColor:"divider"},children:i.jsxs(ut,{direction:{xs:"column",md:"row"},spacing:2,justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},children:[i.jsxs(Z,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:1.5,flex:1},children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"caption",color:"text.secondary",children:"Email"}),i.jsx(B,{variant:"body1",children:w.email||""})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"caption",color:"text.secondary",children:"Phone"}),i.jsx(B,{variant:"body1",children:w.phone||w.phone_number||""})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"caption",color:"text.secondary",children:"Payment Terms"}),i.jsx(B,{variant:"body1",children:w.default_payment_terms_in_days!=null?`${w.default_payment_terms_in_days} days`:""})]}),i.jsxs(Z,{sx:{gridColumn:"1 / -1"},children:[i.jsx(B,{variant:"caption",color:"text.secondary",children:"General Notes"}),i.jsx(B,{variant:"body1",sx:{whiteSpace:"pre-wrap"},children:w.general_notes||""})]})]}),i.jsx(xe,{variant:"outlined",onClick:()=>{E(!0)},children:"Edit Customer"})]})}),i.jsx(Po,{rows:V,columns:le,loading:o,density:"comfortable",onRowClick:G,columnVisibilityModel:C,onColumnVisibilityModelChange:Ye=>N(Ye),getRowClassName:Ye=>{const Ze=Ye.row.due_date?new Date(Ye.row.due_date):null;return Ye.row.status==="Unpaid"&&Ze&&Ze<new Date?"overdue-row":""},initialState:{sorting:{sortModel:[{field:"invoice_number",sort:"desc"}]}},sx:{"& .overdue-row":{backgroundColor:"#fff5f5"},"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.05rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}}),i.jsxs(Z,{sx:{mt:2,display:"flex",justifyContent:"center",gap:2,flexWrap:"wrap"},children:[i.jsx(xe,{variant:"outlined",onClick:()=>ge(!1),disabled:o||!l,children:o?"Loading...":l?"Load More":"No more invoices"}),i.jsx(xe,{variant:"contained",onClick:Q,disabled:o,children:o?"Loading...":"Load All"})]})]})}),i.jsx(Iv,{open:!!H,anchorEl:H,onClose:ae,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:i.jsxs(Z,{sx:{p:2,maxWidth:320},children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1.5},children:"Show / Hide Columns"}),i.jsx(Ep,{children:ne.map(Ye=>i.jsx(ui,{control:i.jsx(Xi,{size:"small",checked:C[Ye.field]!==!1,onChange:Ze=>N(We=>({...We,[Ye.field]:Ze.target.checked}))}),label:Ye.headerName||Ye.field},Ye.field))})]})}),i.jsx(Wd,{open:P,onClose:()=>E(!1),isEditMode:!0,loading:T,initialCustomer:w?{customer_id:String(w.customer_id??w.id),customer_name:w.customer_name,contact_person:w.contact_person||"",email:w.email||"",phone_number:w.phone||w.phone_number||"",street_address:w.street_address||w.address||"",city:w.city||"",province:w.province||w.state||"",country:w.country||"",postal_code:w.postal_code||"",default_payment_terms_in_days:w.default_payment_terms_in_days,website:w.website||"",general_notes:w.general_notes||""}:void 0,onSave:async Ye=>{if(!w)return;S(!0);const Ze=Number(w.customer_id??w.id);try{const We=await uS(String(Ze),Ye);A(We),v(wt=>wt.map(It=>It.id===Ze?{...It,label:We.customer_name}:It)),m&&y({...m,label:We.customer_name}),ge(!0),me.success("Customer updated"),E(!1)}catch(We){console.error("Failed to update customer",We);const wt=We?.response?.data?.error||"Failed to update customer";me.error(wt)}finally{S(!1)}}})]})},Ov=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim().toUpperCase(),Ode=(e,t,r=8)=>{const n=Ov(t||"");if(!n)return e.slice(0,r);const a=e.map(o=>{const s=Ov(o.label);let l=-1;return s.startsWith(n)?l=3:s.split(" ").some(c=>c.startsWith(n))?l=2:s.includes(n)&&(l=1),{opt:o,score:l}}).filter(o=>o.score>=0);return a.sort((o,s)=>s.score-o.score||o.opt.label.localeCompare(s.opt.label)),a.slice(0,r).map(o=>o.opt)},I2=()=>({part_id:null,part_number:"",part_description:"",quantity:1,unit:"",unit_price:0,line_amount:0}),kde=()=>{const{id:e}=Ms(),t=e==="new",r=kn(),[n,a]=x.useState({status:"Unpaid",product_name:"",product_description:"",vin_number:"",unit_number:"",vehicle_make:"",vehicle_model:"",source_sales_order_number:"",mileage:"",tech_story:""}),[o,s]=x.useState([I2()]),[l,c]=x.useState([]),[u,d]=x.useState([]),[f,h]=x.useState(null),[p,v]=x.useState(null),[m,y]=x.useState([]),[b,_]=x.useState(null),[w,A]=x.useState(""),[P,E]=x.useState(!1),T=x.useRef(!1),[S,I]=x.useState(!1),[U,O]=x.useState(""),[M,L]=x.useState(Rt()),[q,z]=x.useState(Rt().add(30,"day")),[K,J]=x.useState(!1),[R,k]=x.useState(!t),[$,X]=x.useState(!1),[C,N]=x.useState(null),[H,W]=x.useState(!1),ne="invoiceDetail.fieldVisibility",se={...kd.invoices},[oe,ae]=x.useState(()=>{if(typeof window>"u")return se;const Se=localStorage.getItem(ne);if(Se)try{return{...se,...JSON.parse(Se)}}catch{}return se}),[pe,ge]=x.useState(se),[Q,G]=x.useState(null),[ee,le]=x.useState([]),[V,Ve]=x.useState(!1),Me=x.useRef(null),Fe=x.useMemo(()=>{const Se=o.reduce((Te,nt)=>Te+(Number(nt.line_amount)||0),0),Ge=Math.round(Se*.05*100)/100,_e=Math.round((Se+Ge)*100)/100;return{subtotal:Se,gst:Ge,total:_e}},[o]),Qe=x.useCallback(async()=>{if(!T.current){T.current=!0,E(!0);try{const Ge=(await cS()).map(_e=>({id:_e.customer_id||_e.id,label:_e.customer_name,defaultTerms:Number(_e.default_payment_terms_in_days)||30}));y(Ge)}catch(Se){console.error("Failed to load customers",Se)}finally{T.current=!1,E(!1)}}},[]),it=x.useCallback(async Se=>{if(!Se){le([]),Me.current=null;return}if(!(Me.current===Se&&ee.length)){Me.current=Se,Ve(!0);try{const _e=[...(await iR(Se)).records||[]].sort((Te,nt)=>{const mt=Te.activity_date?new Date(Te.activity_date).getTime():0;return(nt.activity_date?new Date(nt.activity_date).getTime():0)-mt});le(_e)}catch(Ge){console.error("Failed to load vehicle history for customer",Ge),le([])}finally{Ve(!1)}}},[ee.length]);x.useEffect(()=>{Qe()},[Qe]),x.useEffect(()=>{(async()=>{try{const[Se,Ge,_e,Te]=await Promise.all([ve.get("/api/inventory"),ve.get("/api/margin-schedule"),ve.get("/api/settings/labour-charge-rate").catch(()=>({data:{labour_charge_rate:null}})),ve.get("/api/settings/overhead-charge-rate").catch(()=>({data:{overhead_charge_rate:null}}))]);c(Se.data||[]),d(Ge.data||[]),h(_e.data?.labour_charge_rate??null),v(Te.data?.overhead_charge_rate??null)}catch(Se){console.error("Failed to load inventory or margin schedule for invoices",Se)}})()},[]),x.useEffect(()=>{typeof window<"u"&&localStorage.setItem(ne,JSON.stringify(oe))},[oe]),x.useEffect(()=>{(async()=>{try{const Se=await Cv.fetchSettings();ge(Se.invoices),ae(Ge=>{const _e={...Ge};let Te=!1;return Object.keys(Se.invoices).forEach(nt=>{!Se.invoices[nt]&&_e[nt]&&(_e[nt]=!1,Te=!0)}),Te?_e:Ge})}catch(Se){console.warn("Failed to load invoice field visibility defaults; using saved preferences",Se)}})()},[]),x.useEffect(()=>{const Se=b?.id??n.customer_id??null;it(Se?Number(Se):null)},[b?.id,n.customer_id,it]);const st=x.useMemo(()=>{const Se={...se};return Object.keys(Se).forEach(Ge=>{Se[Ge]=!!(pe[Ge]&&oe[Ge])}),Se},[pe,oe]),{units:vt,vins:Ye,unitToVins:Ze,vinToUnits:We}=x.useMemo(()=>oR(ee),[ee]),wt=x.useMemo(()=>{const Se=Av(n.unit_number);return Se&&Ze[Se]?Ze[Se]:Ye},[n.unit_number,Ze,Ye]),It=x.useMemo(()=>{const Se=Av(n.vin_number);return Se&&We[Se]?We[Se]:vt},[n.vin_number,vt,We]),Ot=async Se=>{try{const Ge=await ve.get(`/api/sales-orders/${Se}`),_e=Ge.data?.salesOrder||Ge.data;if(!_e)return;a(Te=>({...Te,product_name:Te.product_name||_e.product_name||"",product_description:Te.product_description||_e.product_description||"",vin_number:Te.vin_number||_e.vin_number||"",unit_number:Te.unit_number||_e.unit_number||"",vehicle_make:Te.vehicle_make||_e.vehicle_make||"",vehicle_model:Te.vehicle_model||_e.vehicle_model||"",mileage:Te.mileage??_e.mileage??"",notes:Te.notes||_e.terms||"",tech_story:Te.tech_story||_e.tech_story||""}))}catch(Ge){console.warn("Failed to pull sales order defaults for invoice",Ge)}};x.useEffect(()=>{!t&&e&&(async()=>{k(!0);try{const Se=await mae(e),Ge=Se.invoice,_e=(Se.lineItems||[]).map(nt=>({invoice_line_item_id:nt.invoice_line_item_id,part_id:nt.part_id??null,part_number:nt.part_number||"",part_description:nt.part_description||"",quantity:Number(nt.quantity)||0,unit:nt.unit||"",unit_price:Number(nt.unit_price)||0,line_amount:Number(nt.line_amount)||Math.round(Number(nt.quantity)*Number(nt.unit_price)*100)/100}));a({...Ge,tech_story:Ge.tech_story||""}),s(_e.length?_e:[I2()]);const Te=Ge.customer_id?{id:Ge.customer_id,label:Ge.customer_name||`Customer ${Ge.customer_id}`,defaultTerms:Number(Ge.payment_terms_in_days)||Number(Ge.default_payment_terms_in_days)||30}:null;_(Te||null),A(Te?.label||""),L(Ge.invoice_date?Rt(Ge.invoice_date):Rt()),z(Ge.due_date?Rt(Ge.due_date):Rt().add(Te?.defaultTerms||30,"day")),Ge.sales_order_id&&Ot(Ge.sales_order_id)}catch(Se){console.error("Failed to load invoice",Se),N("Failed to load invoice")}finally{k(!1)}})()},[e,t]),x.useEffect(()=>{if(!m.length||!n.customer_id)return;const Se=m.find(Ge=>Ge.id===n.customer_id);Se&&(_(Se),A(Se.label))},[m,n.customer_id]),x.useEffect(()=>{t&&!K&&M&&b?.defaultTerms&&z(M.add(b.defaultTerms,"day"))},[b,M,K,t]);const Wt=x.useCallback(Se=>{const Ge=(Se||"").trim().toUpperCase();return l.find(_e=>String(_e.part_number||"").trim().toUpperCase()===Ge)},[l]),jt=x.useCallback((Se,Ge)=>{const _e=u.filter(Mt=>Mt.product_id===(Ge??null)),Te=u.filter(Mt=>Mt.product_id==null),nt=Mt=>{const Nr=[...Mt].sort((Ar,$r)=>Number(Ar.cost_lower_bound??0)-Number($r.cost_lower_bound??0));for(const Ar of Nr){const $r=Number(Ar.cost_lower_bound??0),Vr=Ar.cost_upper_bound==null?null:Number(Ar.cost_upper_bound),In=Number(Ar.margin_factor??1);if(Se>=$r&&(Vr===null||Se<Vr))return Number.isFinite(In)&&In>0?In:1}return 1},mt=_e.length?nt(_e):1;return mt!==1?mt:nt(_e.length?_e:Te)},[u]),lr=x.useCallback((Se,Ge)=>{const _e=(Se||"").trim().toUpperCase();if(_e==="LABOUR"||_e==="LABOR"||_e==="OVERHEAD"||_e==="SUPPLY")return!0;const Te=(Ge||"").toLowerCase();return Te==="labour"||Te==="labor"||Te==="overhead"||Te==="supply"},[]),$e=x.useCallback((Se,Ge)=>{const _e=Ge??(Se.part_number?Wt(Se.part_number):null);if(!_e||lr(Se.part_number,_e.part_type))return{...Se,part_id:_e?.part_id??Se.part_id??null};const Te=Number(_e.last_unit_cost??0);if(!Number.isFinite(Te)||Te<=0)return{...Se,part_id:_e.part_id??Se.part_id??null,part_description:Se.part_description||_e.part_description||"",unit:Se.unit||_e.unit||""};const nt=jt(Te,_e.part_id??null),mt=Math.round(Te*nt*100)/100,Mt=Number(Se.quantity??0),Nr=Math.round(mt*Mt*100)/100;return{...Se,part_id:_e.part_id??Se.part_id??null,part_number:_e.part_number??Se.part_number,part_description:Se.part_description||_e.part_description||"",unit:Se.unit||_e.unit||"",unit_price:mt,line_amount:Mt?Nr:Se.line_amount}},[Wt,jt,lr]);x.useEffect(()=>{t&&l.length&&s(Se=>Se.map(Ge=>{const _e=Ge.part_number?Wt(Ge.part_number):null;return!_e||Ge.unit_price&&Ge.unit_price>0&&Ge.part_id?Ge:$e(Ge,_e)}))},[$e,Wt,l,t]);const He=(Se,Ge,_e)=>{s(Te=>{const nt=[...Te],mt={...nt[Se]};if(Ge==="part_number"){const Mt=String(_e||"").trim();mt.part_number=Mt,mt.part_id=null;const Nr=Mt.toUpperCase();if(!Mt)mt.part_description="",mt.unit="",mt.unit_price=0,mt.line_amount=0;else if(Nr==="LABOUR"||Nr==="LABOR"){const Ar=f??0;mt.unit=mt.unit||"hr",mt.unit_price=Ar;const $r=Number(mt.quantity)||0;mt.line_amount=Math.round($r*Ar*100)/100}else if(Nr==="OVERHEAD"){const Ar=p??0;mt.unit=mt.unit||"hr",mt.unit_price=Ar;const $r=Number(mt.quantity)||0;mt.line_amount=Math.round($r*Ar*100)/100}else{const Ar=Wt(Mt);if(Ar){const $r=$e({...mt,part_number:Mt},Ar);return nt[Se]=$r,nt}!mt.part_description&&!mt.unit_price&&(mt.part_description="",mt.unit_price=0,mt.line_amount=0)}}else if(Ge==="quantity"||Ge==="unit_price"){const Mt=Number(_e);mt[Ge]=Number.isFinite(Mt)?Mt:0,mt.line_amount=Math.round(Number(mt.quantity)*Number(mt.unit_price)*100)/100}else if(Ge==="line_amount"){const Mt=Number(_e);mt.line_amount=Number.isFinite(Mt)?Mt:0}else mt[Ge]=_e;return nt[Se]=mt,nt})},Je=()=>G(null),Ue=()=>s(Se=>[...Se,I2()]),ht=Se=>s(Ge=>Ge.filter((_e,Te)=>Te!==Se)),at=x.useMemo(()=>l.map(Se=>({part_number:Se.part_number,part_description:Se.part_description})),[l]),St=x.useMemo(()=>{const Se={};for(const Ge of l||[])Ge?.part_number&&(Se[String(Ge.part_number)]=Ge.part_description||"");return Se},[l]),Tt=x.useCallback((Se,Ge)=>{const _e=(Ge.inputValue||"").toUpperCase(),Te=[];for(const nt of Se){const mt=String(nt).toUpperCase(),Mt=(St[nt]||"").toUpperCase();if((!_e||mt.includes(_e)||Mt.includes(_e))&&(Te.push(nt),Te.length>=50))break}return _e&&!Te.some(nt=>nt.toUpperCase()===_e)&&Te.push(Ge.inputValue),Te},[St]),Yt=async()=>{if(!b&&!n.customer_id){me.error("Please select a customer");return}const Se={customer_id:b?.id??n.customer_id,invoice_date:M?M.toISOString():void 0,due_date:q?q.toISOString():void 0,status:n.status||"Unpaid",payment_terms_in_days:n.payment_terms_in_days??b?.defaultTerms,notes:n.notes,tech_story:n.tech_story??null,sales_order_id:n.sales_order_id??null,source_sales_order_number:n.source_sales_order_number??null,product_name:n.product_name??"",product_description:n.product_description??"",vin_number:n.vin_number??"",unit_number:n.unit_number??"",vehicle_make:n.vehicle_make??"",vehicle_model:n.vehicle_model??"",mileage:n.mileage===""||n.mileage===null||n.mileage===void 0?null:Number(n.mileage),line_items:o.map(Ge=>({invoice_line_item_id:Ge.invoice_line_item_id,part_id:Ge.part_id,part_number:Ge.part_number,part_description:Ge.part_description,quantity:Number(Ge.quantity)||0,unit:Ge.unit,unit_price:Number(Ge.unit_price)||0,line_amount:Number(Ge.line_amount)||Math.round(Number(Ge.quantity)*Number(Ge.unit_price)*100)/100}))};X(!0);try{if(t){const Ge=await gae(Se);me.success("Invoice created"),r(`/invoices/${Ge.invoice_id}`)}else await vae(n.invoice_id,Se),me.success("Invoice updated")}catch(Ge){console.error("Failed to save invoice",Ge),me.error("Failed to save invoice")}finally{X(!1)}},Or=async()=>{if(!(t||!n.invoice_id)){W(!0);try{const Se=await ve.get(`/api/invoices/${n.invoice_id}/pdf`,{responseType:"blob"}),Ge=window.URL.createObjectURL(new Blob([Se.data],{type:"application/pdf"})),_e=document.createElement("a");_e.href=Ge,_e.download=`${n.invoice_number||"invoice"}.pdf`,document.body.appendChild(_e),_e.click(),_e.remove(),window.URL.revokeObjectURL(Ge)}catch(Se){console.error("Failed to download invoice PDF",Se),me.error("Failed to download invoice PDF")}finally{W(!1)}}},Dr=x.useCallback((Se,Ge)=>{const _e={};if(Se!==void 0&&(_e.unit_number=Se),Ge!==void 0&&(_e.vin_number=Ge),ee.length&&(Se||Ge||n.unit_number||n.vin_number)){const Te=sR(ee,Se??n.unit_number,Ge??n.vin_number);Te.unit_number&&(_e.unit_number=Te.unit_number),Te.vin_number&&(_e.vin_number=Te.vin_number),Te.vehicle_make&&(_e.vehicle_make=Te.vehicle_make),Te.vehicle_model&&(_e.vehicle_model=Te.vehicle_model);const nt=Te.mileage;if(nt!=null&&String(nt)!==""){const mt=Number(nt);_e.mileage=Number.isFinite(mt)?mt:nt}}a(Te=>({...Te,..._e}))},[n.unit_number,n.vin_number,ee]);if(R)return i.jsx(rr,{maxWidth:"md",sx:{mt:6,textAlign:"center"},children:i.jsx(B,{children:"Loading invoice..."})});if(C)return i.jsxs(rr,{maxWidth:"md",sx:{mt:6,textAlign:"center"},children:[i.jsx(B,{color:"error",children:C}),i.jsx(xe,{variant:"outlined",sx:{mt:2},onClick:()=>r("/invoices"),children:"Back to Invoices"})]});const tr=n.status==="Unpaid"&&q&&q.isBefore(Rt(),"day"),wr={p:3,mb:3,border:"1px solid",borderColor:"divider",borderRadius:2,boxShadow:"0 8px 24px rgba(0,0,0,0.06)"},Ir={display:"grid",gap:2,gridAutoFlow:"row dense",alignItems:"stretch"},dn={...Ir,gridTemplateColumns:{xs:"1fr",sm:"repeat(2, minmax(0, 1fr))",md:"2fr 1fr 1fr"}},ka={...Ir,gridTemplateColumns:{xs:"repeat(auto-fit, minmax(200px, 1fr))",md:"repeat(auto-fit, minmax(180px, 1fr))",lg:"repeat(auto-fit, minmax(160px, 1fr))"}},En={...Ir,gridTemplateColumns:{xs:"1fr",sm:"repeat(2, minmax(0, 1fr))",md:"repeat(3, minmax(0, 1fr))"}},Zt=!!(b?.id||n.customer_id),Xr=i.jsx(Ra,{options:m,value:b,inputValue:w,onInputChange:(Se,Ge)=>A(Ge),loading:P,onFocus:Qe,onChange:(Se,Ge)=>{if(!Ge){_(null),a(Te=>({...Te,customer_id:null}));return}if(typeof Ge=="object"&&Ge.isNew){const Te=Ge.inputValue||w||"";O(Te),I(!0);return}const _e=typeof Ge=="string"?m.find(Te=>Te.label===Ge)||null:Ge;_(_e),A(_e?.label||""),_e?.id&&a(Te=>({...Te,customer_id:_e.id}))},getOptionLabel:Se=>typeof Se=="string"?Se:Se.label,isOptionEqualToValue:(Se,Ge)=>Se.id===Ge.id,filterOptions:(Se,Ge)=>{const _e=(Ge.inputValue||"").trim(),Te=Ode(Se,_e,10),nt=Se.some(Mt=>Ov(Mt.label)===Ov(_e)),mt=[...Te];return _e&&!nt&&mt.push({label:`Add "${Ge.inputValue}"`,isNew:!0,id:-1}),mt},renderInput:Se=>i.jsx(Pe,{...Se,label:"Customer",fullWidth:!0})}),Gn=Zt?i.jsx(Ra,{freeSolo:!0,options:wt,loading:V,value:n.vin_number||"",onInputChange:(Se,Ge)=>a(_e=>({..._e,vin_number:Ge})),onChange:(Se,Ge,_e)=>{if(_e==="clear"){a(nt=>({...nt,vin_number:""}));return}Dr(void 0,typeof Ge=="string"?Ge:Ge??"")},renderInput:Se=>i.jsx(Pe,{...Se,label:"VIN #",fullWidth:!0})}):i.jsx(Pe,{label:"VIN #",value:n.vin_number||"",onChange:Se=>a(Ge=>({...Ge,vin_number:Se.target.value})),fullWidth:!0}),Tn=Zt?i.jsx(Ra,{freeSolo:!0,options:It,loading:V,value:n.unit_number||"",onInputChange:(Se,Ge)=>a(_e=>({..._e,unit_number:Ge})),onChange:(Se,Ge,_e)=>{if(_e==="clear"){a(nt=>({...nt,unit_number:""}));return}Dr(typeof Ge=="string"?Ge:Ge??"",void 0)},renderInput:Se=>i.jsx(Pe,{...Se,label:"Unit #",fullWidth:!0})}):i.jsx(Pe,{label:"Unit #",value:n.unit_number||"",onChange:Se=>a(Ge=>({...Ge,unit_number:Se.target.value})),fullWidth:!0}),Wr=[st.vin!==!1?{key:"vin",element:Gn}:null,st.unitNumber!==!1?{key:"unitNumber",element:Tn}:null,st.vehicleMake!==!1?{key:"vehicleMake",element:i.jsx(Pe,{label:"Make",value:n.vehicle_make||"",onChange:Se=>a(Ge=>({...Ge,vehicle_make:Se.target.value})),fullWidth:!0})}:null,st.vehicleModel!==!1?{key:"vehicleModel",element:i.jsx(Pe,{label:"Model",value:n.vehicle_model||"",onChange:Se=>a(Ge=>({...Ge,vehicle_model:Se.target.value})),fullWidth:!0})}:null,st.mileage!==!1?{key:"mileage",element:i.jsx(Pe,{label:"Mileage",type:"number",value:n.mileage??"",onChange:Se=>a(Ge=>({...Ge,mileage:Se.target.value===""?"":Number(Se.target.value)})),fullWidth:!0,inputProps:{step:1,min:0}})}:null].filter(Boolean),en=[{key:"invoiceDate",element:i.jsx(os,{label:"Invoice Date",value:M,onChange:Se=>L(Se),slotProps:{textField:{fullWidth:!0}}})},{key:"dueDate",element:i.jsx(os,{label:"Due Date",value:q,onChange:Se=>{z(Se),J(!0)},slotProps:{textField:{fullWidth:!0}}})}];return i.jsxs(i.Fragment,{children:[i.jsx(Os,{dateAdapter:oc,children:i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",children:t?"New Invoice":`Invoice ${n.invoice_number||""}`}),n.source_sales_order_number&&i.jsxs(ut,{direction:"row",spacing:1,alignItems:"center",sx:{mt:1},children:[i.jsx(B,{variant:"body1",children:"Source Sales Order:"}),i.jsx(xe,{variant:"text",size:"small",startIcon:i.jsx(Sv,{}),onClick:()=>r(`/open-sales-orders/${n.sales_order_id}`),children:n.source_sales_order_number})]})]}),i.jsxs(ut,{direction:"row",spacing:1,children:[tr&&i.jsx(ot,{color:"error",label:"Overdue"}),i.jsx(ot,{color:n.status==="Paid"?"success":"default",label:n.status||"Unpaid",onClick:()=>a(Se=>({...Se,status:Se.status==="Paid"?"Unpaid":"Paid"}))}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Sv,{}),onClick:Or,disabled:H||t,children:H?"Downloading...":"Download PDF"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:Yt,disabled:$,children:$?"Saving...":"Save"}),i.jsx(xe,{variant:"outlined",onClick:Se=>G(Se.currentTarget),children:"Customize Fields"})]})]}),i.jsxs(bt,{sx:wr,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Customer Information"}),i.jsx(Z,{sx:dn,children:i.jsx(Z,{children:Xr})})]}),i.jsxs(bt,{sx:wr,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Vehicle Details"}),i.jsx(Z,{sx:ka,children:Wr.map(Se=>i.jsx(Z,{children:Se.element},Se.key))})]}),i.jsxs(bt,{sx:wr,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Job & Schedule"}),i.jsx(Z,{sx:{...En,mb:2},children:en.map(Se=>i.jsx(Z,{children:Se.element},Se.key))}),i.jsxs(Z,{sx:{display:"grid",gap:2},children:[i.jsx(Pe,{label:"Product",value:n.product_name||"",onChange:Se=>a(Ge=>({...Ge,product_name:Se.target.value})),fullWidth:!0}),st.productDescription!==!1&&i.jsx(Pe,{label:"Product Description",value:n.product_description||"",onChange:Se=>a(Ge=>({...Ge,product_description:Se.target.value})),fullWidth:!0,multiline:!0,minRows:2}),st.techStory!==!1&&i.jsx(Pe,{label:"Tech Story",value:n.tech_story||"",onChange:Se=>a(Ge=>({...Ge,tech_story:Se.target.value})),fullWidth:!0,multiline:!0,minRows:4,placeholder:"Technician notes carried from the sales order"})]})]}),i.jsxs(bt,{sx:wr,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Invoice Terms"}),i.jsx(Pe,{label:"Invoice Terms",multiline:!0,minRows:2,fullWidth:!0,value:n.notes||"",onChange:Se=>a(Ge=>({...Ge,notes:Se.target.value}))})]}),i.jsx(Iv,{open:!!Q,anchorEl:Q,onClose:Je,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:i.jsxs(Z,{sx:{p:2,minWidth:220},children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1.5},children:"Show / Hide Fields"}),i.jsx(Ep,{children:[{key:"vin",label:"VIN #"},{key:"productDescription",label:"Product Description"},{key:"unitNumber",label:"Unit #"},{key:"mileage",label:"Mileage"},{key:"vehicleMake",label:"Make"},{key:"vehicleModel",label:"Model"},{key:"techStory",label:"Tech Story"}].filter(({key:Se})=>pe[Se]).map(({key:Se,label:Ge})=>i.jsx(ui,{control:i.jsx(Xi,{size:"small",checked:!!oe[Se],onChange:_e=>ae(Te=>({...Te,[Se]:_e.target.checked}))}),label:Ge},Se))})]})}),i.jsx(B,{variant:"h6",sx:{mt:2,mb:.5},children:"Line Items"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Each part number can only appear once. Edit existing line items to change quantities."}),i.jsxs(bt,{sx:{p:3,mb:3},elevation:3,children:[i.jsx(ie,{container:!0,spacing:2,children:o.map((Se,Ge)=>i.jsxs(Ae.Fragment,{children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:2.5,children:i.jsx(Ra,{freeSolo:!0,autoHighlight:!0,options:at.map(_e=>_e.part_number),value:Se.part_number||"",onInputChange:(_e,Te)=>He(Ge,"part_number",Te),onChange:(_e,Te)=>He(Ge,"part_number",Te||""),filterOptions:Tt,renderOption:(_e,Te)=>{const nt=St[Te]||"",{key:mt,...Mt}=_e;return i.jsx("li",{...Mt,children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",children:Te}),nt?i.jsx(B,{variant:"caption",color:"text.secondary",children:nt}):null]})},mt)},renderInput:_e=>i.jsx(Pe,{..._e,label:"Part Number *",fullWidth:!0})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3.5,children:i.jsx(Pe,{label:"Part Description *",value:Se.part_description,onChange:_e=>He(Ge,"part_description",_e.target.value),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Pe,{label:"Qty",type:"number",value:Se.quantity,onChange:_e=>He(Ge,"quantity",_e.target.value),fullWidth:!0,inputProps:{step:.01}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Pe,{label:"Unit",value:Se.unit,onChange:_e=>He(Ge,"unit",_e.target.value),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Unit Price",type:"number",value:Se.unit_price,onChange:_e=>He(Ge,"unit_price",_e.target.value),fullWidth:!0,InputProps:{startAdornment:i.jsx(aa,{position:"start",children:"$"})}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Amount",type:"number",value:Se.line_amount,onChange:_e=>He(Ge,"line_amount",_e.target.value),fullWidth:!0,InputProps:{startAdornment:i.jsx(aa,{position:"start",children:"$"})}})}),i.jsx(ie,{item:!0,xs:12,sm:3,md:1,sx:{display:"flex",alignItems:"center"},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:()=>ht(Ge),fullWidth:!0,children:"Remove"})})]},Ge))}),i.jsx(Z,{sx:{mt:2},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:Ue,startIcon:i.jsx(Va,{}),children:"Add Line Item"})})]}),i.jsx(bt,{sx:{p:3,mb:3},elevation:3,children:i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Subtotal: ",za(Fe.subtotal)]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Total GST: ",za(Fe.gst)]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"h6",children:["Total Amount: ",za(Fe.total)]})})]})}),i.jsx(Vn,{sx:{my:3}}),i.jsxs(ut,{direction:"row",spacing:2,children:[i.jsx(xe,{variant:"outlined",onClick:()=>r("/invoices"),children:"Back to Invoices"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:Yt,disabled:$,children:$?"Saving...":"Save Invoice"})]})]})}),i.jsx(Wd,{open:S,onClose:()=>I(!1),onSave:async Se=>{try{const Ge=await ve.post("/api/customers",Se),_e={id:Ge.data.customer_id,label:Se.customer_name,defaultTerms:Number(Ge.data.default_payment_terms_in_days)||30};y(Te=>[...Te,_e]),_(_e),A(_e.label),a(Te=>({...Te,customer_id:_e.id})),I(!1),me.success("Customer added successfully!")}catch{me.error("Failed to add customer.")}},initialCustomer:{customer_name:U},isEditMode:!1})]})};var sh={},LT;function Ede(){if(LT)return sh;LT=1;var e=ir();Object.defineProperty(sh,"__esModule",{value:!0}),sh.default=void 0;var t=e(sr()),r=or();return sh.default=(0,t.default)((0,r.jsx)("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorder"),sh}var Tde=Ede();const Ide=Et(Tde);var lh={},RT;function Nde(){if(RT)return lh;RT=1;var e=ir();Object.defineProperty(lh,"__esModule",{value:!0}),lh.default=void 0;var t=e(sr()),r=or();return lh.default=(0,t.default)((0,r.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),lh}var Dde=Nde();const Mde=Et(Dde);var ch={},qT;function Lde(){if(qT)return ch;qT=1;var e=ir();Object.defineProperty(ch,"__esModule",{value:!0}),ch.default=void 0;var t=e(sr()),r=or();return ch.default=(0,t.default)((0,r.jsx)("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"}),"Mic"),ch}var Rde=Lde();const qde=Et(Rde);var uh={},FT;function Fde(){if(FT)return uh;FT=1;var e=ir();Object.defineProperty(uh,"__esModule",{value:!0}),uh.default=void 0;var t=e(sr()),r=or();return uh.default=(0,t.default)((0,r.jsx)("path",{d:"M6 6h12v12H6z"}),"Stop"),uh}var $de=Fde();const Bde=Et($de);class Ude{mediaRecorder=null;audioChunks=[];isRecording=!1;stream=null;async startRecording(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});const t={mimeType:"audio/webm;codecs=opus",audioBitsPerSecond:16e3};MediaRecorder.isTypeSupported(t.mimeType)||delete t.mimeType,this.mediaRecorder=new MediaRecorder(this.stream,t),this.audioChunks=[],this.isRecording=!0,this.mediaRecorder.ondataavailable=r=>{r.data.size>0&&this.audioChunks.push(r.data)},this.mediaRecorder.start(1e3)}catch(t){throw console.error("Error starting voice recording:",t),new Error("Failed to start voice recording. Please check microphone permissions.")}}async stopRecording(){return new Promise((t,r)=>{if(!this.mediaRecorder||!this.isRecording){r(new Error("No active recording"));return}this.mediaRecorder.onstop=async()=>{try{this.isRecording=!1;const n=new Blob(this.audioChunks,{type:"audio/wav"}),a=await this.processAudioQuery(n);t(a)}catch(n){r(n)}finally{this.cleanup()}},this.mediaRecorder.stop()})}cleanup(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.mediaRecorder=null,this.audioChunks=[],this.isRecording=!1}async processAudioQuery(t){try{if(t.size>1048576)throw new Error(`Audio file too large (${(t.size/1024/1024).toFixed(2)}MB). Please record a shorter message.`);const n=await this.blobToBase64(t);return(await ve.post("/api/voice-search/search-parts",{audioData:n,audioFormat:t.type||"audio/webm"})).data}catch(r){throw console.error("Error processing voice query:",r),r instanceof Error?new Error(r.message):new Error("Failed to process voice query. Please try again.")}}blobToBase64(t){return new Promise((r,n)=>{const a=new FileReader;a.onload=()=>{const s=a.result.split(",")[1];r(s)},a.onerror=n,a.readAsDataURL(t)})}async interpretTextQuery(t){try{return(await ve.post("/api/voice-search/interpret-query",{query:t})).data}catch(r){return console.error("Error interpreting text query:",r),{query:t,searchInPartNumbers:!0,searchInDescriptions:!0,extractedTerms:[t]}}}isRecordingActive(){return this.isRecording}cancelRecording(){this.isRecording&&(this.mediaRecorder?.stop(),this.cleanup())}}const zde=new Ude,Wde=({onSearchTerms:e,disabled:t=!1})=>{const[r,n]=x.useState(!1),[a,o]=x.useState(!1),[s,l]=x.useState(""),c=x.useRef(null),u=x.useRef(null),d=()=>{const m=typeof window<"u"&&window.process&&window.process.type;if(typeof window<"u"&&"webkitSpeechRecognition"in window&&!c.current){const y=window.webkitSpeechRecognition||window.SpeechRecognition;c.current=new y,c.current.continuous=!1,c.current.interimResults=!0,c.current.lang="en-US",m&&console.log("Running in Electron environment"),c.current.onresult=b=>{let _="",w="";for(let A=b.resultIndex;A<b.results.length;A++){const P=b.results[A][0].transcript;b.results[A].isFinal?_+=P:w+=P}l(_+w),_.trim()&&p(_.trim())},c.current.onerror=b=>{console.error("Speech recognition error:",b.error),b.error==="network"?(typeof window<"u"&&window.process&&window.process.type?me.error("Voice recognition network error in Electron. Please try again or use text search."):me.error("Voice recognition requires internet connection. Please try again."),n(!1)):b.error==="not-allowed"?(me.error("Microphone access denied. Please allow microphone access."),n(!1)):b.error==="no-speech"?(me.info("No speech detected. Please try again."),n(!1)):b.error==="audio-capture"?(me.error("Audio capture error. Please check your microphone."),n(!1)):b.error==="service-not-allowed"?(me.error("Voice recognition service not allowed. This is common in Electron apps."),n(!1)):(console.error("Speech recognition error:",b.error),me.error(`Voice recognition error: ${b.error}. Please try again.`),n(!1))},c.current.onend=()=>{n(!1),l("")}}},f=()=>{try{if(!(typeof window<"u"&&("webkitSpeechRecognition"in window||"SpeechRecognition"in window))){me.error("Voice recognition not available in this browser.");return}typeof window<"u"&&window.process&&window.process.type&&me.info("Voice recognition in Electron may have limitations. If it doesn't work, please use text search."),d(),c.current&&(n(!0),l(""),c.current.start(),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{r&&h()},8e3))}catch(m){console.error("Error starting voice recognition:",m),me.error("Failed to start voice recognition."),n(!1)}},h=()=>{c.current&&c.current.stop(),n(!1),u.current&&clearTimeout(u.current)},p=async m=>{try{o(!0),l("");const y=await zde.interpretTextQuery(m);e(y.extractedTerms,{searchInPartNumbers:y.searchInPartNumbers,searchInDescriptions:y.searchInDescriptions}),me.success(`Voice search: "${m}"  ${y.extractedTerms.join(", ")}`)}catch(y){console.error("Error processing voice input:",y),me.error("Failed to process voice input. Please try again.")}finally{o(!1)}},v=()=>{r?h():f()};return i.jsxs(Z,{children:[i.jsx(xe,{variant:"contained",size:"large",onClick:v,disabled:t||a,startIcon:a?i.jsx(er,{size:20,color:"inherit"}):r?i.jsx(Bde,{}):i.jsx(qde,{}),sx:{backgroundColor:r?"error.main":"primary.main",color:"white","&:hover":{backgroundColor:r?"error.dark":"primary.dark"},minWidth:120,height:48},children:a?"Processing...":r?"Stop":"Voice Search"}),r&&i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,mt:1,children:[i.jsx(Z,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:"error.main",animation:"pulse 1s infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.3},"100%":{opacity:1}}}}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:["Listening... ",s&&`"${s}"`]})]})]})},Hde="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),Vde="0123456789".split("");function lR(e,t,r){return`so:${t}:${e}:${r}`}function $T(e,t,r){try{const n=localStorage.getItem(lR(e,t,r));if(!n)return[];const a=JSON.parse(n);return Array.isArray(a)?a:[]}catch{return[]}}function BT(e,t,r,n){try{localStorage.setItem(lR(e,t,r),JSON.stringify(n.slice(0,50)))}catch{}}function cR(){return"partFinder:usage:global"}function uR(e,t){return`partFinder:usage:so:${e}:${t}`}function Gde(){try{const e=localStorage.getItem(cR());return e?JSON.parse(e):{}}catch{return{}}}function Yde(e){try{localStorage.setItem(cR(),JSON.stringify(e))}catch{}}function Kde(e,t){try{const r=localStorage.getItem(uR(e,t));return r?JSON.parse(r):{}}catch{return{}}}function Qde(e,t,r){try{localStorage.setItem(uR(e,t),JSON.stringify(r))}catch{}}function Xde(e){const{open:t,onClose:r,onSelect:n,salesOrderId:a,context:o,inventoryItems:s}=e,[l,c]=x.useState(""),[u,d]=x.useState(""),[f,h]=x.useState([]),[p,v]=x.useState([]),[m,y]=x.useState([]),[b,_]=x.useState({}),[w,A]=x.useState({}),[P,E]=x.useState([]),[T,S]=x.useState(null);x.useEffect(()=>{t&&(v($T("favorites",a,o)),y($T("recents",a,o)),_(Kde(a,o)),A(Gde()))},[t,a,o]);const I=x.useMemo(()=>{const R=l.toUpperCase(),k=new Set(f.map(C=>C.toUpperCase())),$=new Set(P.map(C=>C.toUpperCase())),X=u.trim().toUpperCase();return s.filter(C=>{const N=(C.part_number||"").toUpperCase(),H=(C.part_description||"").toUpperCase();if(R&&!N.startsWith(R)||X&&!(N.includes(X)||H.includes(X)))return!1;for(const W of k)if(!(N.includes(W)||H.includes(W)))return!1;if(P.length>0&&T){let W=!1;for(const ne of $){if(T.searchInPartNumbers&&N.includes(ne)){W=!0;break}if(T.searchInDescriptions&&H.includes(ne)){W=!0;break}}if(!W)return!1}return!0})},[s,l,f,u,P,T]),U=x.useMemo(()=>{const R={},k=new Set(f.map(oe=>oe.toUpperCase())),$=new Set(p),X=new Set(m),C={SS:"STAINLESS",STAIN:"STAINLESS",STAINLESS:"STAINLESS",AL:"ALUMINUM",ALUM:"ALUMINUM",GALV:"GALVANIZED",GALVANIZED:"GALVANIZED",SQ:"SQUARE",RECT:"RECTANGULAR",TUBE:"TUBING"},N=new Set(["TUBING","PIPE","ANGLE","BAR","FLAT","BEAM","CHANNEL","SHEET","PLATE","ROUND","SQUARE","RECTANGULAR"]),H=oe=>C[oe]||oe,W=(oe,ae)=>{const pe=oe.trim();!pe||k.has(pe)||(R[pe]=(R[pe]||0)+ae)},ne=oe=>{const[ae,pe]=oe.split("/").map(Number);return!ae||!pe?null:(ae/pe).toFixed(4).replace(/0+$/,"").replace(/\.$/,"")},se=oe=>{const ae=[];if(!oe)return ae;const pe=oe.toUpperCase().replace(/[\s-]+/g,"").replace(//g,"X").replace(/[()]/g,""),ge=pe.match(/\d+\/\d+/g)??[];if(pe.includes("X")){const Q=pe.split("X");Q.length>=2&&Q.length<=4&&(ae.push(Q.slice(0,2).join("X")),ae.push(Q.join("X")))}return ge.forEach(Q=>{ae.push(Q);const G=ne(Q);G&&ae.push(G)}),(pe.match(/(\d+)GA/g)??[]).forEach(Q=>ae.push(Q)),(pe.match(/SCH\s*\d+/g)??[]).forEach(Q=>ae.push(Q.replace(/\s+/g,""))),(pe.match(/OD\d+(?:\.\d+)?/g)??[]).forEach(Q=>ae.push(Q)),(pe.match(/ID\d+(?:\.\d+)?/g)??[]).forEach(Q=>ae.push(Q)),(pe.match(/\d+(?:\.\d+)?/g)??[]).slice(0,3).forEach(Q=>ae.push(Q)),Array.from(new Set(ae))};for(const oe of I){const pe=String(oe.part_description||"").toUpperCase().split(/[^A-Z0-9]+/).filter(Ze=>Ze.length>=2&&!k.has(Ze)).map(H),ge=b[oe.part_number]?.count||0,Q=w[oe.part_number]?.count||0,G=b[oe.part_number]?.last||0,ee=Date.now(),le=G?(ee-G)/(1e3*60*60*24):365,V=le<=7?1:le<=30?.5:0;let Ve=1+ge*.5+Q*.25+V;$.has(oe.part_number)&&(Ve+=3),X.has(oe.part_number)&&(Ve+=1);const Me=u.trim().toUpperCase(),Fe=(oe.part_number||"").toUpperCase(),Qe=(oe.part_description||"").toUpperCase(),it=Me&&(Fe.startsWith(Me)||Qe.includes(Me))?.5:0,st=[];pe.forEach(Ze=>{N.has(Ze)&&st.push(Ze),W(Ze,Ve*(1+it+(Me&&Ze.includes(Me)?.5:0)))});const vt=Array.from(new Set(pe));vt.forEach(Ze=>vt.forEach(We=>{Ze!==We&&(N.has(Ze)||N.has(We))&&W(`${Ze} ${We}`,Ve*1.2)}));const Ye=se(Fe);Ye.forEach(Ze=>W(Ze,Ve*1.3)),Ye[0]&&st.slice(0,2).forEach(Ze=>W(`${Ze} ${Ye[0]}`,Ve*1.5))}return Object.entries(R).sort((oe,ae)=>ae[1]-oe[1]).slice(0,24).map(([oe])=>oe)},[I,f,p,m,b,w,u]),O=I,M=x.useMemo(()=>O.slice(0,200),[O]),L=R=>{h(k=>k.includes(R)?k.filter($=>$!==R):[...k,R])},q=()=>{c(""),h([]),E([]),S(null)},z=R=>p.includes(R),K=R=>{v(k=>{const $=k.includes(R)?k.filter(X=>X!==R):[R,...k];BT("favorites",a,o,$);try{fetch(`/api/part-finder/${a}/favorite`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({part_number:R,context:o,value:!k.includes(R)})}).catch(()=>{})}catch{}return $})},J=R=>{y(k=>{const $=[R.part_number,...k.filter(X=>X!==R.part_number)].slice(0,20);return BT("recents",a,o,$),$}),_(k=>{const $={...k},X=$[R.part_number]||{count:0,last:0};return X.count+=1,X.last=Date.now(),$[R.part_number]=X,Qde(a,o,$),$}),A(k=>{const $={...k},X=$[R.part_number]||{count:0,last:0};return X.count+=1,X.last=Date.now(),$[R.part_number]=X,Yde($),$}),n(R);try{fetch(`/api/part-finder/${a}/use`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({part_number:R.part_number,context:o})}).catch(()=>{})}catch{}};return i.jsxs(dr,{open:t,onClose:r,maxWidth:"lg",fullWidth:!0,fullScreen:!1,"aria-labelledby":"part-finder-title",children:[i.jsx(fr,{id:"part-finder-title",children:"Find Part"}),i.jsxs(hr,{dividers:!0,children:[i.jsx(Z,{mb:2,children:i.jsxs(Z,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[i.jsx(Pe,{fullWidth:!0,placeholder:"Search by part # or description",value:u,onChange:R=>d(R.target.value),InputProps:{startAdornment:i.jsx(aa,{position:"start",children:i.jsx(di,{})})}}),i.jsx(Wde,{onSearchTerms:(R,k)=>{E(R),S(k)},disabled:!1})]})}),null,i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",mb:2,children:[!!l&&i.jsx(ot,{label:`Prefix: ${l}`,color:"primary",onDelete:()=>c(""),sx:{height:40,borderRadius:2,"& .MuiChip-label":{px:2,py:1,fontSize:16,fontWeight:600}}}),f.map(R=>i.jsx(ot,{label:R,color:"secondary",onDelete:()=>L(R),sx:{height:38,borderRadius:2,"& .MuiChip-label":{px:2,py:1,fontSize:15,fontWeight:600}}},R)),P.length>0&&i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[i.jsx(B,{variant:"caption",color:"text.secondary",children:"Voice:"}),P.map(R=>i.jsx(ot,{label:R,color:"success",variant:"outlined",size:"small",sx:{height:32,"& .MuiChip-label":{px:1.5,py:.5,fontSize:12}}},R)),T&&i.jsxs(B,{variant:"caption",color:"text.secondary",sx:{ml:1},children:["(",T.searchInPartNumbers?"Part#":"",T.searchInPartNumbers&&T.searchInDescriptions?" + ":"",T.searchInDescriptions?"Desc":"",")"]})]}),(!!l||f.length>0||P.length>0)&&i.jsx(xe,{onClick:q,children:"Clear All"})]}),i.jsxs(Z,{display:"flex",gap:2,mb:2,flexWrap:"wrap",children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Part # Starts With"}),i.jsxs(Z,{display:"flex",flexWrap:"wrap",gap:1.5,children:[Hde.map(R=>i.jsx(ot,{label:R,variant:l.startsWith(R)?"filled":"outlined",onClick:()=>c(R),sx:{height:44,borderRadius:2,"& .MuiChip-label":{px:2.25,py:1.25,fontSize:18,fontWeight:700}}},R)),Vde.map(R=>i.jsx(ot,{label:R,variant:l.startsWith(R)?"filled":"outlined",onClick:()=>c(R),sx:{height:44,borderRadius:2,"& .MuiChip-label":{px:2.25,py:1.25,fontSize:18,fontWeight:700}}},R))]})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Description Tokens"}),i.jsx(Z,{display:"flex",flexWrap:"wrap",gap:1.5,children:U.map(R=>i.jsx(ot,{label:R,clickable:!0,color:f.includes(R)?"secondary":"default",onClick:()=>L(R),sx:{height:40,borderRadius:2,"& .MuiChip-label":{px:2,py:1,fontSize:16,fontWeight:600}}},R))})]})]}),i.jsx(Vn,{sx:{my:2}}),i.jsxs(Z,{mb:2,children:[p.length>0&&i.jsxs(Z,{mb:1,children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Favorites for this Sales Order"}),i.jsx(Z,{display:"flex",flexWrap:"wrap",gap:1.25,children:p.map(R=>{const k=s.find($=>$.part_number===R);return k?i.jsx(ot,{label:`${k.part_number}`,onClick:()=>J(k),title:k.part_description,sx:{height:38,borderRadius:2,"& .MuiChip-label":{px:2,py:1,fontSize:15,fontWeight:600}}},R):null})})]}),m.length>0&&i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Recents for this Sales Order"}),i.jsx(Z,{display:"flex",flexWrap:"wrap",gap:1.25,children:m.map(R=>{const k=s.find($=>$.part_number===R);return k?i.jsx(ot,{variant:"outlined",label:`${k.part_number}`,onClick:()=>J(k),title:k.part_description,sx:{height:38,borderRadius:2,"& .MuiChip-label":{px:2,py:1,fontSize:15,fontWeight:600}}},R):null})})]})]}),i.jsxs(ie,{container:!0,spacing:2,children:[M.map(R=>i.jsx(ie,{item:!0,xs:12,sm:6,md:4,lg:3,children:i.jsxs(Z,{sx:{border:"1px solid #ddd",borderRadius:1,p:1.5,display:"flex",flexDirection:"column",gap:1,height:"100%"},children:[i.jsxs(Z,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:700},children:R.part_number}),i.jsx(Hn,{title:z(R.part_number)?"Remove favorite":"Add favorite",children:i.jsx(vr,{size:"small",onClick:()=>K(R.part_number),children:z(R.part_number)?i.jsx(Mde,{color:"warning",fontSize:"small"}):i.jsx(Ide,{fontSize:"small"})})})]}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{minHeight:40},children:R.part_description||""}),i.jsxs(Z,{mt:"auto",display:"flex",gap:1,children:[i.jsx(xe,{variant:"contained",size:"small",onClick:()=>J(R),children:"Add"}),i.jsx(xe,{variant:"outlined",size:"small",onClick:()=>{J(R)},children:"Add & Keep Open"})]})]})},R.part_number)),M.length===0&&i.jsx(ie,{item:!0,xs:12,children:i.jsx(B,{variant:"body2",color:"text.secondary",children:"No parts match the current filters."})})]})]}),i.jsx(_r,{children:i.jsx(xe,{onClick:r,children:"Close"})})]})}const UT=["Each","cm","ft","ft^2","kg","pcs","hr","L"],N2=5,zT=()=>{const{id:e}=Ms(),t=kn(),r=!!e&&/^\d+$/.test(e);console.log("WokerSalesOrderPage: Component rendered with id:",e,"isNumericId:",r),x.useEffect(()=>(console.log("WokerSalesOrderPage: Component mounted"),()=>{console.log("WokerSalesOrderPage: Component unmounted")}),[]);const[n,a]=x.useState(null),[o,s]=x.useState(!0),[l,c]=x.useState(null),[u,d]=x.useState(null),[f,h]=x.useState([]),[p,v]=x.useState(null),[m,y]=x.useState(null),[b,_]=x.useState([]),[w,A]=x.useState([]),[P,E]=x.useState([]),[T,S]=x.useState([]),I=x.useRef(null),U=x.useRef(0);x.useLayoutEffect(()=>{const $e=I.current,He=$e?$e.getBoundingClientRect().height:0,Je=He-U.current;Je!==0&&(window.scrollBy({top:Je,left:0,behavior:"auto"}),U.current=He)},[P.length]);const[O,M]=x.useState(null),[L,q]=x.useState(null),[z,K]=x.useState(null),[J,R]=x.useState(!1),[k,$]=x.useState(null),[X,C]=x.useState(""),[N,H]=x.useState(!1),[W,ne]=x.useState(null),[se,oe]=x.useState(""),[ae,pe]=x.useState(!1),[ge,Q]=x.useState("line"),[G,ee]=x.useState(0),le=$e=>f.find(He=>He.part_number===$e),V=($e,He)=>{const Je=f.find(Or=>Or.part_number.toLowerCase()===$e.part_number.toLowerCase());if(!Je||Je.part_type==="supply")return null;const Ue=parseFloat(Je.quantity_on_hand)||0,ht=b.filter(Or=>Or.part_number.toLowerCase()===$e.part_number.toLowerCase()).reduce((Or,Dr)=>Or+(parseFloat(String(Dr.quantity).replace(/[^\d.-]/g,""))||0),0),at=w.filter(Or=>Or.part_number.toLowerCase()===$e.part_number.toLowerCase()).reduce((Or,Dr)=>Or+(parseFloat(String(Dr.quantity).replace(/[^\d.-]/g,""))||0),0),St=ht-at,Tt=Ue-St,Yt=Tt<0?Math.floor(Tt):Math.round(Tt);return{available:Yt,isNegative:Yt<0,currentStock:Ue,changeInQuantity:St,totalQuantityForPart:ht,totalOriginalQuantityForPart:at}},Ve=($e,He)=>{const Je=b.filter(ht=>ht.part_number.toLowerCase()===$e.part_number.toLowerCase());if(Je.length<=1)return!0;const Ue=Math.max(...Je.map((ht,at)=>b.findIndex(St=>St.part_number.toLowerCase()===$e.part_number.toLowerCase()&&b.indexOf(St)===at)));return He===Ue},Me=x.useMemo(()=>b.map($e=>({part_number:$e.part_number,part_description:$e.part_description,quantity:bo($e.quantity),unit:$e.unit,unit_price:bo($e.unit_price)})),[b]),Fe=x.useMemo(()=>Me.reduce(($e,He)=>$e+$u(He.quantity,He.unit_price),0),[Me]),Qe=x.useMemo(()=>Fe*(N2/100),[Fe]);x.useMemo(()=>Fe+Qe,[Fe,Qe]);const[it,st]=x.useState("");x.useEffect(()=>{n&&st(JSON.stringify({lineItems:b,partsToOrder:T}))},[n]);const vt=!!it&&it!==JSON.stringify({lineItems:b,partsToOrder:T});x.useEffect(()=>{(async()=>{try{const[$e,He,Je]=await Promise.all([ve.get("/api/inventory"),ve.get("/api/settings/labour-rate").catch(()=>({data:{labour_rate:null}})),ve.get("/api/settings/overhead-rate").catch(()=>({data:{overhead_rate:null}}))]);h($e.data),v(He.data.labour_rate??null),y(Je.data.overhead_rate??null)}catch($e){console.error("Prefetch failed",$e)}})()},[]),x.useEffect(()=>{if(console.log("WokerSalesOrderPage: useEffect triggered with id:",e,"isNumericId:",r),!e||!r){console.log("WokerSalesOrderPage: Invalid ID, setting error"),c("Invalid sales order ID."),s(!1);return}(async()=>{console.log("WokerSalesOrderPage: Fetching sales order data for ID:",e),s(!0),c(null);try{console.log("WokerSalesOrderPage: Making API call to /api/sales-orders/${id}");const $e=await ve.get(`/api/sales-orders/${e}`);if(console.log("WokerSalesOrderPage: API response received:",$e),console.log("WokerSalesOrderPage: API response data:",$e.data),!$e.data||!$e.data.salesOrder){console.error("WokerSalesOrderPage: No sales order data in response"),c("Invalid response format from server"),s(!1);return}const He=$e.data.salesOrder;console.log("WokerSalesOrderPage: Parsed sales order:",He),a({sales_order_id:He.sales_order_id,sales_order_number:He.sales_order_number,status:He.status});const Je=($e.data.lineItems||He?.line_items||[]).filter(ht=>!["LABOUR","OVERHEAD","SUPPLY"].includes(ht.part_number?.toUpperCase())).map(ht=>({line_item_id:ht.line_item_id,part_number:ht.part_number,part_description:ht.part_description,unit:ht.unit,unit_price:ht.unit_price,line_amount:ht.line_amount,quantity:String(ht.quantity_sold??ht.quantity??0),gst:N2,part_id:ht.part_id??void 0}));console.log("WokerSalesOrderPage: Loaded line items (filtered):",Je),_(Je),A(Je);const Ue=($e.data.partsToOrder||[]).map(ht=>({sales_order_id:He.sales_order_id,part_number:ht.part_number,part_description:ht.part_description,quantity_to_order:String(ht.quantity_needed??ht.quantity_to_order??""),unit:ht.unit||"Each",unit_price:Number(ht.unit_price||0),line_amount:Number(ht.line_amount||0)}));console.log("WokerSalesOrderPage: Loaded parts to order:",Ue),S(Ue),console.log("WokerSalesOrderPage: Successfully loaded sales order data")}catch($e){console.error("WokerSalesOrderPage: Error loading sales order:",$e),console.error("WokerSalesOrderPage: Error details:",{message:$e?.message,status:$e?.response?.status,statusText:$e?.response?.statusText,data:$e?.response?.data,url:$e?.config?.url}),c($e?.response?.status===404?"Sales order not found. It may have been deleted.":"Failed to load sales order data. Please try again.")}finally{s(!1)}})()},[e,r]),x.useEffect(()=>{p!==null&&_($e=>$e.map(He=>He.part_number==="LABOUR"?{...He,unit_price:p}:He))},[p]),x.useEffect(()=>{m!==null&&_($e=>$e.map(He=>He.part_number==="OVERHEAD"?{...He,unit_price:m}:He))},[m]),x.useEffect(()=>{const $e=[];b.forEach((He,Je)=>{if(Ve(He,Je)){const Ue=V(He);Ue&&Ue.available<0&&$e.push({lineItemIndex:Je,partNumber:He.part_number,partDescription:He.part_description,excessQuantity:Math.abs(Ue.available),unit:He.unit})}}),E($e)},[b,f]);const Ye=($e,He)=>{_(Je=>{const Ue=[...Je];if(!He||He.trim()==="")Ue[$e]={...Ue[$e],part_number:"",part_description:"",quantity:"",unit:UT[0],unit_price:0,line_amount:0};else{const St=le(He);if(St){const Tt=parseFloat(String(St.last_unit_cost))||0;Ue[$e]={...Ue[$e],part_number:He,part_description:St.part_description||"",unit:St.unit||"Each",unit_price:Tt}}else Ue[$e]={...Ue[$e],part_number:He,part_description:"Part not found",unit_price:0}}const ht=bo(Ue[$e].quantity),at=bo(Ue[$e].unit_price);return Ue[$e].line_amount=$u(ht,at),Ue})},Ze=($e,He,Je)=>{_(Ue=>{const ht=[...Ue],at={...ht[$e],[He]:Je};if(parseFloat(Je)<=0)return ht.filter((Yt,Or)=>Or!==$e);const St=bo(at.quantity),Tt=bo(at.unit_price);return at.line_amount=$u(St,Tt),ht[$e]=at,ht})},We=()=>{_($e=>[...$e,{part_number:"",part_description:"",quantity:"",unit:UT[0],unit_price:0,gst:N2,line_amount:0}])},wt=$e=>{_(He=>He.filter((Je,Ue)=>Ue!==$e))},It=()=>{if(b.filter(Ue=>!Ue.part_number||Ue.part_number.trim()==="").length>0)return me.error("Line items with blank part numbers are not allowed."),!1;const He=b.filter(Ue=>{if(["LABOUR","OVERHEAD","SUPPLY"].includes(String(Ue.part_number).toUpperCase()))return!1;const ht=Ue.part_id;if(ht){const St=(f||[]).find(Tt=>Tt.part_id===ht);return St?St.part_type==="supply":!1}const at=(f||[]).find(St=>String(St.part_number).toUpperCase()===String(Ue.part_number).trim().toUpperCase());return!at||at.part_type==="supply"});if(He.length>0){const Ue=He.map(ht=>ht.part_number).join(", ");return me.error(`Invalid or supply parts (not allowed): ${Ue}`),!1}return b.some((Ue,ht)=>{if(!Ve(Ue,ht))return!1;const at=V(Ue);return at&&at.available<0})?(me.error("Insufficient inventory for one or more parts."),!1):!0},Ot=$e=>{const He=$e.reduce((Je,Ue)=>{const ht=Ue.part_number.trim().toLowerCase();if(!Je[ht]){const St=["LABOUR","OVERHEAD","SUPPLY"].includes(Ue.part_number.toUpperCase())?null:(f||[]).find(Tt=>String(Tt.part_number).toUpperCase()===Ue.part_number.trim().toUpperCase());Je[ht]={part_number:Ue.part_number.trim(),part_description:Ue.part_description.trim(),unit:Ue.unit.trim(),unit_price:Ue.unit_price!=null?Number(Ue.unit_price):0,line_amount:0,quantity_sold:0,...Ue.part_id?{part_id:Ue.part_id}:St&&St.part_id?{part_id:St.part_id}:{}}}const at=parseFloat(String(Ue.quantity).replace(/[^\d.-]/g,""))||0;return Je[ht].quantity_sold+=Math.round(at),Je[ht].line_amount+=at*(Ue.unit_price||0),Je},{});return Object.values(He)},Wt=async()=>{if(n&&It())try{const $e={lineItems:Ot(b),partsToOrder:T.filter(He=>He.part_number&&parseFloat(String(He.quantity_to_order))>0).map(He=>({sales_order_id:n.sales_order_id,part_number:He.part_number.trim(),part_description:He.part_description.trim(),quantity_needed:parseFloat(String(He.quantity_to_order))||0,unit:He.unit.trim(),unit_price:He.unit_price,line_amount:He.line_amount}))};await ve.put(`/api/sales-orders/${n.sales_order_id}`,$e),d("Sales Order updated successfully!"),st(JSON.stringify({lineItems:b,partsToOrder:T}));try{const He=await ve.get("/api/inventory");h(He.data)}catch{}}catch($e){const He=$e?.response?.data?.error||$e?.response?.data?.details||$e?.response?.data?.message||"Failed to save sales order.";me.error(He)}},jt=($e,He)=>{const Je=(b[$e]?.part_number||"").trim(),Ue=He.key==="Enter",ht=He.key==="Tab",at=He.key==="Escape",St=He.key==="ArrowDown"||He.key==="ArrowUp";if(at){M(null);return}if(St){He.key==="ArrowDown"&&O!==$e&&M($e);return}if(!(O===$e&&(Ue||ht))&&(Ue||ht)&&Je){if(Ue&&He.ctrlKey){He.preventDefault(),C(Je.toUpperCase()),$($e),R(!0),M(null);return}!f.find(Yt=>Yt.part_number.toUpperCase()===Je.toUpperCase())&&Ue&&(He.preventDefault(),C(Je.toUpperCase()),$($e),R(!0),M(null))}},lr=($e,He)=>{const Je=(T[$e]?.part_number||"").trim(),Ue=He.key==="Enter",ht=He.key==="Tab",at=He.key==="Escape",St=He.key==="ArrowDown"||He.key==="ArrowUp";if(at){q(null);return}if(St){He.key==="ArrowDown"&&L!==$e&&q($e);return}if(!(L===$e&&(Ue||ht))&&(Ue||ht)&&Je){if(Ue&&He.ctrlKey){He.preventDefault(),oe(Je.toUpperCase()),ne($e),H(!0),q(null);return}!f.find(Yt=>Yt.part_number.toUpperCase()===Je.toUpperCase())&&Ue&&(He.preventDefault(),oe(Je.toUpperCase()),ne($e),H(!0),q(null))}};return o?i.jsxs(rr,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(er,{}),i.jsx(B,{children:"Loading sales order..."})]}):l?i.jsxs(rr,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(Pt,{severity:"error",sx:{mb:2},children:l}),i.jsx(xe,{variant:"contained",onClick:()=>window.location.reload(),sx:{mr:2},children:"Retry"}),i.jsx(xe,{variant:"outlined",onClick:()=>t("/open-sales-orders"),children:"Back to Sales Orders"})]}):n?i.jsxs(Os,{dateAdapter:oc,children:[i.jsx(Ry,{when:vt,onSave:Wt}),i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{position:"relative",zIndex:1},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsxs(B,{variant:"h5",sx:{fontWeight:700},children:["Edit Lines & Parts to Order  SO ",n.sales_order_number||n.sales_order_id]}),i.jsx(xe,{variant:"contained",onClick:Wt,children:"Save Changes"})]}),i.jsx(B,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Line Items"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"You can add multiple line items with the same part number. They will be automatically merged on save."})]}),i.jsx(Z,{ref:I,sx:{mb:P.length?2:0,display:P.length?"flex":"none",flexDirection:"column",gap:1},children:P.map(($e,He)=>{const Je=b[$e.lineItemIndex];return!Je||!Ve(Je,$e.lineItemIndex)?null:i.jsx(Pt,{severity:"warning",sx:{width:"100%",boxShadow:2,"& .MuiAlert-message":{width:"100%",padding:0}},children:i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{width:"100%"},children:[i.jsxs(Z,{sx:{flex:1},children:[i.jsxs(B,{variant:"body2",fontWeight:"medium",children:["Insufficient stock for ",$e.partNumber]}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Excess quantity: ",$e.excessQuantity," ",$e.unit]})]}),i.jsxs(xe,{variant:"contained",size:"small",sx:{whiteSpace:"nowrap"},onClick:()=>{const Ue=$e.excessQuantity,ht=f.find(Tt=>Tt.part_number.toLowerCase()===Je.part_number.toLowerCase()),at={sales_order_id:n.sales_order_id,part_number:Je.part_number,part_description:Je.part_description,quantity_to_order:String(Ue),unit:Je.unit,unit_price:ht?.last_unit_cost||0,line_amount:(ht?.last_unit_cost||0)*Ue};S(Tt=>[...Tt,at]);const St=Math.max(0,(parseFloat(String(Je.quantity).replace(/[^\d.-]/g,""))||0)-Ue);_(Tt=>Tt.map((Yt,Or)=>Or===$e.lineItemIndex?{...Yt,quantity:String(St)}:Yt)),E(Tt=>Tt.filter(Yt=>Yt.lineItemIndex!==$e.lineItemIndex)),me.success(`Transferred ${Ue} ${Je.unit} of ${Je.part_number} to parts to order`)},children:["Transfer ",$e.excessQuantity," to Parts to Order"]})]})},`${$e.lineItemIndex}-${He}`)})}),i.jsxs(bt,{sx:{p:3,mb:3},elevation:3,children:[i.jsx(ie,{container:!0,spacing:2,children:b.map(($e,He)=>i.jsxs(Ae.Fragment,{children:[i.jsxs(ie,{item:!0,xs:12,sm:6,md:3.5,children:[i.jsx(Ra,{open:O===He,onOpen:()=>M(He),onClose:()=>M(null),autoHighlight:!0,inputValue:$e.part_number,onChange:(Je,Ue)=>{if(typeof Ue=="string")Ye(He,Ue),M(null);else if(Ue&&typeof Ue=="object"&&"isNew"in Ue){const ht=Ue.inputValue||"";C(String(ht).toUpperCase()),$(He),R(!0),M(null)}},onInputChange:(Je,Ue,ht)=>{if(_(St=>{const Tt=[...St];return Tt[He]={...Tt[He],part_number:(Ue||"").toUpperCase()},Tt}),z&&window.clearTimeout(z),ht==="reset")return;if((Ue||"").trim().length>0){const St=window.setTimeout(()=>M(He),200);K(St)}else M(null)},options:f.filter(Je=>Je.part_type!=="supply").map(Je=>Je.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,filterOptions:(Je,Ue)=>{const ht=(Ue.inputValue||"").toUpperCase(),at=Je.filter(Yt=>{const Or=f.find(Dr=>Dr.part_number===Yt);return Or?String(Yt).toUpperCase().includes(ht)||String(Or.part_description||"").toUpperCase().includes(ht):String(Yt).toUpperCase().includes(ht)}),St=at.some(Yt=>String(Yt).toUpperCase()===ht),Tt=[...at];return ht&&!St&&Tt.push({label:`Add "${Ue.inputValue}" as New Part`,isNew:!0,inputValue:Ue.inputValue}),Tt},renderOption:(Je,Ue)=>{const ht=typeof Ue=="object"&&Ue.isNew,at=typeof Ue=="string"?Ue:Ue.label,{key:St,...Tt}=Je;return i.jsxs("li",{...Tt,children:[ht&&i.jsx(Zl,{fontSize:"small",style:{marginRight:8,color:"#666"}}),typeof Ue=="string"?i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",children:Ue}),(()=>{const Yt=f.find(Or=>Or.part_number===Ue);return Yt?.part_description?i.jsx(B,{variant:"caption",color:"text.secondary",children:Yt.part_description}):null})()]}):at]},St)},renderInput:Je=>i.jsx(Pe,{...Je,label:"Part Number",required:!0,fullWidth:!0,onKeyDown:Ue=>jt(He,Ue),onBlur:()=>M(null)}),onBlur:()=>{const Je=b[He]?.part_number?.trim().toUpperCase();if(!Je)return;f.find(ht=>ht.part_number===Je)?Ye(He,Je):($(He),C(Je),R(!0),M(null))}}),i.jsx(Z,{mt:1,children:i.jsx(xe,{size:"small",variant:"outlined",onClick:()=>{Q("line"),ee(He),pe(!0)},children:"Find Part"})})]}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3.5,children:i.jsx(Pe,{label:"Part Description",value:$e.part_description,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Pe,{label:"Qty",value:$e.quantity,onChange:Je=>Ze(He,"quantity",Je.target.value),type:"number",fullWidth:!0,required:!0,inputProps:{step:1,onWheel:Je=>Je.target.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Avail",value:(()=>{if(!Ve($e,He))return"N/A";const Je=V($e);return Je?Je.available<0?`${Je.available} (Insufficient)`:String(Je.available):"N/A"})(),fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:(()=>{if(!Ve($e,He))return"#f5f5f5";const Je=V($e);return Je?Je.available>=0?"#e8f5e8":"#ffeaea":"#f5f5f5"})(),"& .MuiInputBase-input":{color:Ve($e,He)?V($e)?.isNegative?"#d32f2f":"#2e7d32":"#666"}}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Unit",value:$e.unit,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,sx:{display:"flex",alignItems:"stretch"},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:()=>wt(He),fullWidth:!0,sx:{height:"56px"},children:"Remove"})})]},He))}),i.jsx(Z,{sx:{mt:2},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:We,children:"Add Line Item"})})]}),i.jsxs(bt,{sx:{p:3,mb:3,border:"2px solid #b8860b","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#b8860b"},"&:hover fieldset":{borderColor:"#b8860b"}}},elevation:0,children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Parts to Order"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Add parts that need to be ordered for this sales order. These quantities are aggregated across all sales orders."}),i.jsx(ie,{container:!0,spacing:2,children:T.map(($e,He)=>i.jsxs(Ae.Fragment,{children:[i.jsxs(ie,{item:!0,xs:12,sm:6,md:3.5,children:[i.jsx(Ra,{open:L===He,onOpen:()=>q(He),onClose:()=>q(null),autoHighlight:!0,value:$e.part_number,onChange:(Je,Ue)=>{if(!Ue){S(ht=>{const at=[...ht];return at[He]={...at[He],part_number:"",part_description:"",unit:"Each",unit_price:0,line_amount:0},at});return}if(typeof Ue=="string"){const ht=f.find(at=>at.part_number===Ue);if(ht){const St=parseFloat(String(ht.last_unit_cost))||0;S(Tt=>{const Yt=[...Tt];return Yt[He]={...Yt[He],part_number:ht.part_number,part_description:ht.part_description,unit:ht.unit||"Each",unit_price:St,line_amount:0},Yt})}else{S(St=>{const Tt=[...St];return Tt[He]={...Tt[He],part_number:Ue,part_description:"",unit:"Each",unit_price:0,line_amount:0},Tt});const at=String(Ue).toUpperCase();ne(He),oe(at),H(!0)}}else if(Ue&&typeof Ue=="object"&&"isNew"in Ue){const ht=String(Ue.inputValue||"").toUpperCase();ne(He),oe(ht),H(!0)}},onInputChange:(Je,Ue,ht)=>{if(S(St=>{const Tt=[...St];return Tt[He]={...Tt[He],part_number:(Ue||"").toUpperCase()},Tt}),z&&window.clearTimeout(z),ht==="reset")return;if((Ue||"").trim().length>0){const St=window.setTimeout(()=>q(He),200);K(St)}else q(null)},options:f.filter(Je=>Je.part_type!=="supply").map(Je=>Je.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,filterOptions:(Je,Ue)=>{const ht=(Ue.inputValue||"").toUpperCase(),at=Je.filter(Yt=>{const Or=f.find(Dr=>Dr.part_number===Yt);return Or?String(Yt).toUpperCase().includes(ht)||String(Or.part_description||"").toUpperCase().includes(ht):String(Yt).toUpperCase().includes(ht)}),St=at.some(Yt=>String(Yt).toUpperCase()===ht),Tt=[...at];return ht&&!St&&Tt.push({label:`Add "${Ue.inputValue}" as New Part`,isNew:!0,inputValue:Ue.inputValue}),Tt},renderOption:(Je,Ue)=>{const ht=typeof Ue=="object"&&Ue.isNew,at=typeof Ue=="string"?Ue:Ue.label,{key:St,...Tt}=Je;return i.jsxs("li",{...Tt,children:[ht&&i.jsx(Zl,{fontSize:"small",style:{marginRight:8,color:"#666"}}),typeof Ue=="string"?i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",children:Ue}),(()=>{const Yt=f.find(Or=>Or.part_number===Ue);return Yt?.part_description?i.jsx(B,{variant:"caption",color:"text.secondary",children:Yt.part_description}):null})()]}):at]},St)},renderInput:Je=>i.jsx(Pe,{...Je,label:"Part Number",fullWidth:!0,required:!0,onKeyDown:Ue=>lr(He,Ue),onBlur:()=>q(null)}),onBlur:()=>{const Je=(T[He]?.part_number||"").trim().toUpperCase();if(!Je)return;f.find(ht=>ht.part_number===Je)||(ne(He),oe(Je),H(!0),q(null))}}),i.jsx(Z,{mt:1,children:i.jsx(xe,{size:"small",variant:"outlined",onClick:()=>{Q("pto"),ee(He),pe(!0)},children:"Find Part"})})]}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3.5,children:i.jsx(Pe,{label:"Description",value:$e.part_description,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#f5f5f5"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Qty to Order",value:$e.quantity_to_order,onChange:Je=>{const Ue=Je.target.value;S(ht=>{const at=[...ht],St=parseFloat(Ue)||0,Tt=at[He].unit_price||0;return at[He]={...at[He],quantity_to_order:Ue,line_amount:St*Tt},at})},type:"number",fullWidth:!0,required:!0,inputProps:{step:1,min:0,onWheel:Je=>Je.target.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Unit",value:$e.unit,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),i.jsx(ie,{item:!0,xs:12,sm:1,md:1,sx:{display:"flex",alignItems:"stretch",gap:2},children:i.jsx(xe,{variant:"outlined",onClick:()=>S(Je=>Je.filter((Ue,ht)=>ht!==He)),sx:{height:"56px",flexShrink:0,borderColor:"#b8860b",color:"#b8860b","&:hover":{borderColor:"#8b6914",backgroundColor:"#fff8dc"}},children:"Remove"})})]},He))}),i.jsx(Z,{sx:{mt:2},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:()=>S($e=>[...$e,{sales_order_id:n.sales_order_id,part_number:"",part_description:"",quantity_to_order:"",unit:"Each",unit_price:0,line_amount:0}]),children:"Add Parts to Order Item"})})]}),i.jsxs(Z,{display:"flex",justifyContent:"flex-end",gap:2,children:[i.jsx(xe,{variant:"outlined",onClick:()=>t(`/open-sales-orders/${n.sales_order_id}`),children:"Back to SO"}),i.jsx(xe,{variant:"contained",onClick:Wt,children:"Save Changes"})]}),i.jsx(hl,{open:!!u,autoHideDuration:6e3,onClose:()=>d(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Pt,{onClose:()=>d(null),severity:"success",sx:{width:"100%"},children:u})})]}),i.jsx(ec,{open:J,onClose:()=>{R(!1),$(null),C("")},onSave:async $e=>{const He=await ve.post("/api/inventory",$e),Je=await ve.get("/api/inventory");h(Je.data);const Ue=He.data.item;k!==null&&_(ht=>{const at=[...ht],Tt=parseFloat(String(Ue.last_unit_cost))||0;at[k]={...at[k],part_number:Ue.part_number,part_description:Ue.part_description,unit:Ue.unit||at[k].unit,unit_price:Tt};const Yt=bo(at[k].quantity);return at[k].line_amount=$u(Yt,Tt),at})},title:"Add New Part",initialPart:{part_number:X.toUpperCase(),category:"Uncategorized"}}),i.jsx(Xde,{open:ae,onClose:()=>pe(!1),onSelect:$e=>{if(n)if(ge==="line"){const He=G;_(Je=>{const Ue=[...Je];return Ue[He]?(Ue[He]={...Ue[He],part_number:$e.part_number,part_description:$e.part_description},Ue):Je})}else{const He=G;S(Je=>{const Ue=[...Je];return Ue[He]?(Ue[He]={...Ue[He],part_number:$e.part_number,part_description:$e.part_description},Ue):Je})}},salesOrderId:n?.sales_order_id||0,context:ge,inventoryItems:f.map($e=>({part_number:$e.part_number,part_description:$e.part_description}))}),i.jsx(ec,{open:N,onClose:()=>{H(!1),ne(null),oe("")},onSave:async $e=>{const He=await ve.post("/api/inventory",$e),Je=await ve.get("/api/inventory");h(Je.data);const Ue=He.data.item;W!==null&&S(ht=>{const at=[...ht],Tt=parseFloat(String(Ue.last_unit_cost))||0;at[W]={...at[W],part_number:Ue.part_number,part_description:Ue.part_description,unit:Ue.unit||"Each",unit_price:Tt};const Yt=parseFloat(String(at[W].quantity_to_order))||0;return at[W].line_amount=Yt*Tt,at})},title:"Add New Part",initialPart:{part_number:se.toUpperCase(),category:"Uncategorized"}})]}):null},kv=e=>new Date(e.getTime()-e.getTimezoneOffset()*6e4).toISOString(),dR=()=>crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`;function Hc(e){if(e==null)return null;if(typeof e=="number")return Number.isNaN(e)?null:e;if(typeof e=="string"){const t=e.trim();if(!t)return null;const r=Number(t);if(!Number.isNaN(r))return r;const n=t.match(/^(-?)(\d+):(\d{2})(?::(\d{2})(?:\.\d+)?)?$/);if(n){const o=n[1]==="-"?-1:1,s=parseInt(n[2],10),l=parseInt(n[3],10),c=n[4]?parseInt(n[4],10):0;return Number.isNaN(s)||Number.isNaN(l)||Number.isNaN(c)?null:o*(s+l/60+c/3600)}const a=t.match(/^(-)?P?T?(?:(\d+(?:\.\d+)?)H)?(?:(\d+(?:\.\d+)?)M)?(?:(\d+(?:\.\d+)?)S)?$/i);if(a){const o=a[1]==="-"?-1:1,s=a[2]?parseFloat(a[2]):0,l=a[3]?parseFloat(a[3]):0,c=a[4]?parseFloat(a[4]):0;return[s,l,c].some(u=>Number.isNaN(u))?null:o*(s+l/60+c/3600)}}return null}function Ev(e,t=3){const r=Hc(e);return r!==null&&!Number.isNaN(r)?`${r.toFixed(t)} hrs`:"-"}const wS=async()=>{try{const e=await ve.get("/api/time-tracking/profiles");return localStorage.setItem("tt_profiles_cache",JSON.stringify(e.data)),e.data}catch{const t=localStorage.getItem("tt_profiles_cache");return t?JSON.parse(t):[]}},Jde=async(e,t,r)=>(await ve.post("/api/time-tracking/profiles",{name:e,email:t,phone_number:r})).data,Zde=async(e,t,r,n)=>(await ve.put(`/api/time-tracking/profiles/${e}`,{name:t,email:r,phone_number:n})).data,fR=async()=>{try{const e=await ve.get("/api/time-tracking/sales-orders");return localStorage.setItem("tt_sales_orders_cache",JSON.stringify(e.data)),e.data}catch{const t=localStorage.getItem("tt_sales_orders_cache");return t?JSON.parse(t):[]}},efe=async(e,t)=>{const r={date:e};return t&&(r.profile_id=t),(await ve.get("/api/time-tracking/time-entries",{params:r})).data},tfe=async(e,t)=>{try{return(await ve.post("/api/time-tracking/time-entries/clock-in",{profile_id:e,so_id:t})).data}catch(r){if(r?.response)throw r;if(!!!window?.api?.timeEvents?.insert)throw new Error("Network error: time entry clock-in did not reach the server. Please check your connection and try again.");const a={event_id:dR(),user_id:e,device_id:localStorage.getItem("deviceId")||"unknown-device",type:"time_clock_in",timestamp_utc:kv(new Date),payload_json:JSON.stringify({profile_id:e,so_id:t}),created_at:kv(new Date)};return await window?.api?.timeEvents?.insert?.(a),{id:-Math.floor(Math.random()*1e9),profile_id:e,profile_name:"",sales_order_id:t,sales_order_number:"",clock_in:new Date().toISOString(),clock_out:null,duration:null,unit_price:0,__pending:!0,__pending_event_id:a.event_id}}},rfe=async e=>{try{return(await ve.post(`/api/time-tracking/time-entries/${e}/clock-out`)).data}catch{if(!!!window?.api?.timeEvents?.insert)throw new Error("Network error: time entry clock-out did not reach the server. Please check your connection and try again.");const n={event_id:dR(),device_id:localStorage.getItem("deviceId")||"unknown-device",type:"time_clock_out",timestamp_utc:kv(new Date),payload_json:JSON.stringify({id:e}),created_at:kv(new Date)};return await window?.api?.timeEvents?.insert?.(n),{id:e,clock_out:new Date().toISOString(),__pending:!0,__pending_event_id:n.event_id}}},nfe=async(e,t,r)=>(await ve.put(`/api/time-tracking/time-entries/${e}`,{clock_in:t,clock_out:r})).data,afe=async e=>{await ve.delete(`/api/time-tracking/time-entries/${e}`)},ife=async(e,t,r,n)=>(await ve.post("/api/time-tracking/time-entries/manual",{profile_id:e,sales_order_id:t,clock_in:r,clock_out:n})).data,ofe=async(e,t,r,n)=>(await ve.get("/api/time-tracking/reports/time-entries",{params:{from:e,to:t,profile:r,so:n}})).data,sfe=async(e,t,r,n,a="csv")=>(await ve.get("/api/time-tracking/reports/time-entries/export",{params:{from:e,to:t,profile:r,so:n,format:a},responseType:"blob"})).data,WT=async e=>(await ve.get("/api/time-tracking/time-entries/open",{params:{profile_id:e}})).data,lfe=()=>{const{user:e}=Jn(),[t,r]=x.useState([]),[n,a]=x.useState([]),[o,s]=x.useState([]),[l,c]=x.useState([]),[u,d]=x.useState(""),[f,h]=x.useState(""),[p,v]=x.useState(!0),[m,y]=x.useState(!1),[b,_]=x.useState(null),[w,A]=x.useState(null),P=x.useRef(null),E=L=>{P.current&&window.clearTimeout(P.current),A(L),P.current=window.setTimeout(()=>{A(null),P.current=null},2500)};x.useEffect(()=>()=>{P.current&&window.clearTimeout(P.current)},[]),x.useEffect(()=>{T()},[]),x.useEffect(()=>{u?S():s([])},[u]),x.useEffect(()=>{const L=setInterval(()=>{s(q=>q.map(z=>{if(!z.clock_out){const K=new Date,J=new Date(z.clock_in),R=(K.getTime()-J.getTime())/(1e3*60*60);return{...z,duration:R}}return z})),c(q=>q.map(z=>{if(!z.clock_out){const K=new Date,J=new Date(z.clock_in),R=(K.getTime()-J.getTime())/(1e3*60*60);return{...z,duration:R}}return z}))},1e3);return()=>clearInterval(L)},[]);const T=async()=>{try{v(!0);const[L,q]=await Promise.all([wS(),fR()]);console.log("Sales orders data received:",q),r(L),a(q),I(L),_(null)}catch(L){_("Failed to fetch data. Please try again."),console.error("Error fetching data:",L)}finally{v(!1)}},S=async()=>{if(u)try{const[L,q]=await Promise.all([efe(new Date().toISOString().split("T")[0],u),WT(u)]),z=new Map;[...L,...q].forEach(K=>{z.set(K.id,K)}),s(Array.from(z.values()))}catch(L){_("Failed to fetch time entries. Please try again."),console.error("Error fetching time entries:",L)}},I=async L=>{const q=L||t;if(!q.length){c([]);return}try{y(!0);const z=[];await Promise.all(q.map(async K=>{try{(await WT(K.id)).forEach(R=>{z.push({...R,profile_name:K.name})})}catch(J){console.error(`Failed to fetch open time entries for profile ${K.id}`,J)}})),c(z)}catch(z){console.error("Error fetching active time entries:",z)}finally{y(!1)}},U=async()=>{if(!u||!f){_("Please select both a profile and a sales order");return}if(o.find(q=>q.sales_order_id===f&&!q.clock_out)){_("You are already clocked in for this sales order");return}try{A(null);const q=await tfe(u,f);s([q,...o]),d(""),h(""),s([]),_(null),E("Successfully clocked in."),I()}catch(q){A(null),q.response&&q.response.data&&q.response.data.error.includes("attendance")?_("You must clock in for attendance before you can clock in for a sales order."):_(q?.message||"Failed to clock in. Please try again."),console.error("Error clocking in:",q)}},O=async L=>{try{A(null);const q=await rfe(L);s(o.map(z=>z.id===L?q:z)),d(""),h(""),s([]),_(null),E("Successfully clocked out."),I()}catch(q){A(null),_(q?.message||"Failed to clock out. Please try again."),console.error("Error clocking out:",q)}},M=u&&o.some(L=>L.profile_id===u&&!L.clock_out);return p?i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:i.jsx(er,{})}):i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Time Tracking"}),b&&i.jsx(Pt,{severity:"error",variant:"filled",sx:{mb:2,fontSize:"1.1rem",fontWeight:700,py:2},children:b}),i.jsxs(dr,{open:!!w,onClose:()=>A(null),PaperProps:{sx:{px:6,py:4,textAlign:"center"}},children:[i.jsx(fr,{sx:{fontSize:"2rem"},children:"Success"}),i.jsx(hr,{children:i.jsx(B,{variant:"h4",component:"p",children:w})})]}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(bt,{sx:{p:2},children:[i.jsx(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:i.jsx(B,{variant:"h6",children:"Profile"})}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Select Profile"}),i.jsx(ln,{value:u,label:"Select Profile",onChange:L=>d(L.target.value),sx:{"& .MuiSelect-select":{fontSize:"1.25rem",py:1.5,minHeight:56}},MenuProps:{PaperProps:{sx:{"& .MuiMenuItem-root":{fontSize:"1.25rem",py:1.5,minHeight:56},"& .MuiMenuItem-root.Mui-selected, & .MuiMenuItem-root.Mui-selected:hover":{backgroundColor:"rgba(25, 118, 210, 0.2)",color:"primary.main",fontWeight:700},"& .MuiMenuItem-root:hover":{backgroundColor:"rgba(25, 118, 210, 0.15)"}}}},children:t.map(L=>i.jsx(Jt,{value:L.id,sx:{fontSize:"1.2rem",py:1.25},children:L.name},L.id))})]})]})}),u&&i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(bt,{sx:{p:2},children:[i.jsx(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:i.jsx(B,{variant:"h6",children:"Sales Order"})}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Select Sales Order"}),i.jsx(ln,{value:f,label:"Select Sales Order",onChange:L=>h(L.target.value),sx:{"& .MuiSelect-select":{fontSize:"1.25rem",py:1.5,minHeight:56}},MenuProps:{PaperProps:{sx:{"& .MuiMenuItem-root":{fontSize:"1.25rem",py:1.5,lineHeight:1.3,minHeight:56},"& .MuiMenuItem-root.Mui-selected, & .MuiMenuItem-root.Mui-selected:hover":{backgroundColor:"rgba(25, 118, 210, 0.2)",color:"primary.main",fontWeight:700},"& .MuiMenuItem-root:hover":{backgroundColor:"rgba(25, 118, 210, 0.15)"}}}},children:n.map(L=>{const q=o.some(z=>z.sales_order_id===L.id&&!z.clock_out);return i.jsxs(Jt,{value:L.id,disabled:q,sx:{fontSize:"1.1rem"},children:[`${L.number} - ${L.product_name||"No Product Name"} - ${L.customer_name||"Unknown Customer"}`,q?" - Already Clocked In":""]},L.id)})})]})]})}),u&&f&&i.jsx(ie,{item:!0,xs:12,children:i.jsx(bt,{sx:{p:2},children:i.jsx(Z,{display:"flex",justifyContent:"center",gap:2,children:i.jsx(xe,{variant:"contained",sx:{backgroundColor:"green",px:4,py:2,fontSize:"1.2rem",fontWeight:700,borderRadius:"12px",minWidth:220,"&:hover":{backgroundColor:"darkgreen"}},onClick:U,disabled:M,children:"Clock In"})})})}),u&&i.jsx(ie,{item:!0,xs:12,children:i.jsxs(bt,{sx:{p:2},children:[i.jsxs(B,{variant:"h6",gutterBottom:!0,children:["Today's Time Entries for ",t.find(L=>L.id===u)?.name]}),i.jsx(ma,{children:i.jsxs(ia,{children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Sales Order"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Clock In"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Clock Out"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Duration"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Actions"})]})}),i.jsx(sa,{children:o.map(L=>i.jsxs(mr,{children:[i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:L.sales_order_number}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:new Date(L.clock_in).toLocaleTimeString()}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:L.clock_out?new Date(L.clock_out).toLocaleTimeString():"-"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:Ev(L.duration)}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:!L.clock_out&&i.jsx(xe,{variant:"contained",sx:{backgroundColor:"red",px:3,py:1.5,fontSize:"1.1rem",fontWeight:700,borderRadius:"12px","&:hover":{backgroundColor:"darkred"}},onClick:()=>O(L.id),children:"Clock Out"})})]},L.id))})]})})]})}),i.jsx(ie,{item:!0,xs:12,children:i.jsxs(bt,{sx:{p:2},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[i.jsx(B,{variant:"h6",children:"Active Clock Ins"}),m&&i.jsx(er,{size:24})]}),l.length===0&&!m?i.jsx(B,{color:"text.secondary",children:"No active clock ins."}):i.jsx(ma,{children:i.jsxs(ia,{children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Profile"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Sales Order"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Clock In"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Duration"})]})}),i.jsx(sa,{children:l.map(L=>i.jsxs(mr,{children:[i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:L.profile_name||t.find(q=>q.id===L.profile_id)?.name||"Unknown"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:L.sales_order_number}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:new Date(L.clock_in).toLocaleString()}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:Ev(L.duration)})]},L.id))})]})})]})})]})]})};var $m={exports:{}},HT;function cfe(){return HT||(HT=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(c,u){switch(c){case"P":return u.date({width:"short"});case"PP":return u.date({width:"medium"});case"PPP":return u.date({width:"long"});case"PPPP":default:return u.date({width:"full"})}},n=function(c,u){switch(c){case"p":return u.time({width:"short"});case"pp":return u.time({width:"medium"});case"ppp":return u.time({width:"long"});case"pppp":default:return u.time({width:"full"})}},a=function(c,u){var d=c.match(/(P+)(p+)?/)||[],f=d[1],h=d[2];if(!h)return r(c,u);var p;switch(f){case"P":p=u.dateTime({width:"short"});break;case"PP":p=u.dateTime({width:"medium"});break;case"PPP":p=u.dateTime({width:"long"});break;case"PPPP":default:p=u.dateTime({width:"full"});break}return p.replace("{{date}}",r(f,u)).replace("{{time}}",n(h,u))},o={p:n,P:a},s=o;t.default=s,e.exports=t.default}($m,$m.exports)),$m.exports}var ufe=cfe();const dfe=Et(ufe),ffe={y:{sectionType:"year",contentType:"digit",maxLength:4},yy:"year",yyy:{sectionType:"year",contentType:"digit",maxLength:4},yyyy:"year",M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMMM:{sectionType:"month",contentType:"letter"},MMM:{sectionType:"month",contentType:"letter"},L:{sectionType:"month",contentType:"digit",maxLength:2},LL:"month",LLL:{sectionType:"month",contentType:"letter"},LLLL:{sectionType:"month",contentType:"letter"},d:{sectionType:"day",contentType:"digit",maxLength:2},dd:"day",do:{sectionType:"day",contentType:"digit-with-letter"},E:{sectionType:"weekDay",contentType:"letter"},EE:{sectionType:"weekDay",contentType:"letter"},EEE:{sectionType:"weekDay",contentType:"letter"},EEEE:{sectionType:"weekDay",contentType:"letter"},EEEEE:{sectionType:"weekDay",contentType:"letter"},i:{sectionType:"weekDay",contentType:"digit",maxLength:1},ii:"weekDay",iii:{sectionType:"weekDay",contentType:"letter"},iiii:{sectionType:"weekDay",contentType:"letter"},e:{sectionType:"weekDay",contentType:"digit",maxLength:1},ee:"weekDay",eee:{sectionType:"weekDay",contentType:"letter"},eeee:{sectionType:"weekDay",contentType:"letter"},eeeee:{sectionType:"weekDay",contentType:"letter"},eeeeee:{sectionType:"weekDay",contentType:"letter"},c:{sectionType:"weekDay",contentType:"digit",maxLength:1},cc:"weekDay",ccc:{sectionType:"weekDay",contentType:"letter"},cccc:{sectionType:"weekDay",contentType:"letter"},ccccc:{sectionType:"weekDay",contentType:"letter"},cccccc:{sectionType:"weekDay",contentType:"letter"},a:"meridiem",aa:"meridiem",aaa:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},hfe={year:"yyyy",month:"LLLL",monthShort:"MMM",dayOfMonth:"d",weekday:"EEEE",weekdayShort:"EEEEEE",hours24h:"HH",hours12h:"hh",meridiem:"aa",minutes:"mm",seconds:"ss",fullDate:"PP",fullDateWithWeekday:"PPPP",keyboardDate:"P",shortDate:"MMM d",normalDate:"d MMMM",normalDateWithWeekday:"EEE, MMM d",monthAndYear:"LLLL yyyy",monthAndDate:"MMMM d",fullTime:"p",fullTime12h:"hh:mm aa",fullTime24h:"HH:mm",fullDateTime:"PP p",fullDateTime12h:"PP hh:mm aa",fullDateTime24h:"PP HH:mm",keyboardDateTime:"P p",keyboardDateTime12h:"P hh:mm aa",keyboardDateTime24h:"P HH:mm"};class pfe{constructor(t){this.isMUIAdapter=!0,this.isTimezoneCompatible=!1,this.lib="date-fns",this.locale=void 0,this.formats=void 0,this.formatTokenMap=ffe,this.escapedCharacters={start:"'",end:"'"},this.longFormatters=void 0,this.date=o=>typeof o>"u"?new Date:o===null?null:new Date(o),this.dateWithTimezone=o=>this.date(o),this.getTimezone=()=>"default",this.setTimezone=o=>o,this.toJsDate=o=>o,this.getCurrentLocaleCode=()=>{var o;return((o=this.locale)==null?void 0:o.code)||"en-US"},this.is12HourCycleInCurrentLocale=()=>this.locale?/a/.test(this.locale.formatLong.time({width:"short"})):!0,this.expandFormat=o=>{const s=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g;return o.match(s).map(l=>{const c=l[0];if(c==="p"||c==="P"){const u=this.longFormatters[c];return u(l,this.locale.formatLong)}return l}).join("")},this.getFormatHelperText=o=>this.expandFormat(o).replace(/(aaa|aa|a)/g,"(a|p)m").toLocaleLowerCase(),this.isNull=o=>o===null,this.formatNumber=o=>o,this.getMeridiemText=o=>o==="am"?"AM":"PM";const{locale:r,formats:n,longFormatters:a}=t;this.locale=r,this.formats=mI({},hfe,n),this.longFormatters=a}}class VT extends pfe{constructor({locale:t,formats:r}={}){if(typeof Zm!="function")throw new Error(["MUI: The `date-fns` package v3.x is not compatible with this adapter.","Please, install v2.x of the package or use the `AdapterDateFnsV3` instead."].join(`
`));super({locale:t??Iy,formats:r,longFormatters:dfe}),this.parseISO=n=>qse(n),this.toISO=n=>Soe(n,{format:"extended"}),this.parse=(n,a)=>n===""?null:Ise(n,a,new Date,{locale:this.locale}),this.isValid=n=>ZL(this.date(n)),this.format=(n,a)=>this.formatByString(n,this.formats[a]),this.formatByString=(n,a)=>Ru(n,a,{locale:this.locale}),this.getDiff=(n,a,o)=>{switch(o){case"years":return Cie(n,this.date(a));case"quarters":return wie(n,this.date(a));case"months":return t6(n,this.date(a));case"weeks":return Sie(n,this.date(a));case"days":return e6(n,this.date(a));case"hours":return xie(n,this.date(a));case"minutes":return bie(n,this.date(a));case"seconds":return jie(n,this.date(a));default:return Ty(n,this.date(a))}},this.isEqual=(n,a)=>n===null&&a===null?!0:Loe(n,a),this.isSameYear=(n,a)=>Lse(n,a),this.isSameMonth=(n,a)=>Mse(n,a),this.isSameDay=(n,a)=>pie(n,a),this.isSameHour=(n,a)=>Dse(n,a),this.isAfter=(n,a)=>v2(n,a),this.isAfterYear=(n,a)=>v2(n,p2(a)),this.isAfterDay=(n,a)=>v2(n,bw(a)),this.isBefore=(n,a)=>Mf(n,a),this.isBeforeYear=(n,a)=>Mf(n,Im(a)),this.isBeforeDay=(n,a)=>Mf(n,Pd(a)),this.isWithinRange=(n,[a,o])=>Rse(n,{start:a,end:o}),this.startOfYear=n=>Im(n),this.startOfMonth=n=>xE(n),this.startOfWeek=n=>zc(n,{locale:this.locale}),this.startOfDay=n=>Pd(n),this.endOfYear=n=>p2(n),this.endOfMonth=n=>_w(n),this.endOfWeek=n=>m2(n,{locale:this.locale}),this.endOfDay=n=>bw(n),this.addYears=(n,a)=>gE(n,a),this.addMonths=(n,a)=>eg(n,a),this.addWeeks=(n,a)=>fie(n,a),this.addDays=(n,a)=>Zm(n,a),this.addHours=(n,a)=>iie(n,a),this.addMinutes=(n,a)=>uie(n,a),this.addSeconds=(n,a)=>die(n,a),this.getYear=n=>Moe(n),this.getMonth=n=>koe(n),this.getDate=n=>Coe(n),this.getHours=n=>Aoe(n),this.getMinutes=n=>Ooe(n),this.getSeconds=n=>Eoe(n),this.getMilliseconds=n=>Poe(n),this.setYear=(n,a)=>ole(n,a),this.setMonth=(n,a)=>ele(n,a),this.setDate=(n,a)=>tle(n,a),this.setHours=(n,a)=>rle(n,a),this.setMinutes=(n,a)=>ale(n,a),this.setSeconds=(n,a)=>ile(n,a),this.setMilliseconds=(n,a)=>nle(n,a),this.getDaysInMonth=n=>c6(n),this.getNextMonth=n=>eg(n,1),this.getPreviousMonth=n=>eg(n,-1),this.getMonthArray=n=>{const o=[Im(n)];for(;o.length<12;){const s=o[o.length-1];o.push(this.getNextMonth(s))}return o},this.mergeDateAndTime=(n,a)=>this.setSeconds(this.setMinutes(this.setHours(n,this.getHours(a)),this.getMinutes(a)),this.getSeconds(a)),this.getWeekdays=()=>{const n=new Date;return Aie({start:zc(n,{locale:this.locale}),end:m2(n,{locale:this.locale})}).map(a=>this.formatByString(a,"EEEEEE"))},this.getWeekArray=n=>{const a=zc(xE(n),{locale:this.locale}),o=m2(_w(n),{locale:this.locale});let s=0,l=a;const c=[];for(;Mf(l,o);){const u=Math.floor(s/7);c[u]=c[u]||[],c[u].push(l),l=Zm(l,1),s+=1}return c},this.getWeekNumber=n=>Doe(n,{locale:this.locale}),this.getYearRange=(n,a)=>{const o=Im(n),s=p2(a),l=[];let c=o;for(;Mf(c,s);)l.push(c),c=gE(c,1);return l}}}const Ed=e=>new Date(e.getTime()-e.getTimezoneOffset()*6e4).toISOString(),jS=()=>crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,mfe=()=>new Promise((e,t)=>{if(typeof navigator>"u"||!navigator?.geolocation)return t(new Error("Location services are unavailable in this environment."));navigator.geolocation.getCurrentPosition(r=>e({latitude:r.coords.latitude,longitude:r.coords.longitude}),r=>t(r),{enableHighAccuracy:!0,timeout:1e4})}),gfe=()=>{try{const e=typeof navigator<"u"&&(navigator.userAgent||navigator.vendor)||"";if(e&&/android|iphone|ipad|ipod|mobile/i.test(e))return!0;if(typeof window<"u"&&window.matchMedia)return window.matchMedia("(max-width: 768px)").matches}catch{}return!1},vfe=async()=>{try{return(await ve.get("/api/attendance/geofence")).data}catch{return null}},yfe=async e=>(await ve.get("/api/attendance",{params:{profile_id:e}})).data,xfe=async e=>{const t=gfe(),r=t?await vfe():null,n=!!(t&&r?.enabled&&r?.configured);let a=null;if(n)try{a=await mfe()}catch(s){const l=s?.message||"Location access is required to clock in because geofencing is enabled. Please allow location permissions and try again.",c=new Error(l);throw c.code="GEOFENCE_LOCATION_REQUIRED",c}const o={profile_id:e};a&&(o.latitude=a.latitude,o.longitude=a.longitude);try{return(await ve.post("/api/attendance/clock-in",o)).data}catch(s){if(s?.response)throw s;if(!!!window?.api?.timeEvents?.insert)throw new Error("Network error: clock-in did not reach the server. Please check your connection and try again.");const c={...o},u={event_id:jS(),user_id:e,device_id:localStorage.getItem("deviceId")||"unknown-device",type:"attendance_clock_in",timestamp_utc:Ed(new Date),payload_json:JSON.stringify(c),created_at:Ed(new Date)};return await window?.api?.timeEvents?.insert?.(u),{id:-Math.floor(Math.random()*1e9),profile_id:e,clock_in:new Date().toISOString(),clock_out:null,duration:null,__pending:!0,__pending_event_id:u.event_id}}},bfe=async e=>{try{return(await ve.post("/api/attendance/clock-out",{shift_id:e})).data}catch{if(!!!window?.api?.timeEvents?.insert)throw new Error("Network error: clock-out did not reach the server. Please check your connection and try again.");const n={event_id:jS(),user_id:void 0,device_id:localStorage.getItem("deviceId")||"unknown-device",type:"attendance_clock_out",timestamp_utc:Ed(new Date),payload_json:JSON.stringify({shift_id:e}),created_at:Ed(new Date)};return await window?.api?.timeEvents?.insert?.(n),{id:e,clock_out:new Date().toISOString(),__pending:!0,__pending_event_id:n.event_id}}},_fe=async(e,t,r)=>{try{return(await ve.post("/api/attendance/manual",{profile_id:e,clock_in:t,clock_out:r})).data}catch(n){throw n}},wfe=async(e,t,r)=>{try{return(await ve.put(`/api/attendance/${e}`,{clock_in:t,clock_out:r})).data}catch(n){if(n?.response)throw n;const a={event_id:jS(),device_id:localStorage.getItem("deviceId")||"unknown-device",type:"attendance_update",timestamp_utc:Ed(new Date),payload_json:JSON.stringify({shift_id:e,clock_in:t,clock_out:r}),created_at:Ed(new Date)};return await window?.api?.timeEvents?.insert?.(a),{id:e,clock_in:t,clock_out:r,__pending:!0,__pending_event_id:a.event_id}}},jfe=async(e,t,r)=>(await ve.get("/api/attendance",{params:{profile_id:e,from:t,to:r}})).data,Sfe=async e=>(await ve.get("/api/attendance/active",{params:{profile_id:e}})).data,Cfe=async e=>{await ve.delete(`/api/attendance/${e}`)};function Hl(e){if(!e)return"";const t=new Date(e),r=t.getTimezoneOffset()*6e4;return new Date(t.getTime()-r).toISOString().slice(0,16)}function Pu(e){return e?new Date(e).toISOString():null}function zw(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}function dh(e){const t=zw(e),r=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${r}-${n}-${a}`}const GT=["#2563eb","#22c55e","#f97316","#06b6d4","#eab308","#8b5cf6","#ef4444","#0ea5e9","#d946ef","#14b8a6"],Afe="#9ca3af",Pfe=()=>{const[e,t]=x.useState([]),[r,n]=x.useState([]),[a,o]=x.useState([]),[s,l]=x.useState(""),[c,u]=x.useState(""),d=new Date,f=new Date;f.setDate(d.getDate()-1);const h=new Date;h.setDate(f.getDate()-13);const[p,v]=x.useState(h),[m,y]=x.useState(f),[b,_]=x.useState(!0),[w,A]=x.useState(null),[P,E]=x.useState(null),[T,S]=x.useState(""),[I,U]=x.useState(""),[O,M]=x.useState(null),[L,q]=x.useState([]),[z,K]=x.useState({}),[J,R]=x.useState([]),[k,$]=x.useState(null),[X,C]=x.useState(null),[N,H]=x.useState(""),[W,ne]=x.useState(""),[se,oe]=x.useState(!1),[ae,pe]=x.useState(!0),[ge,Q]=x.useState(!1),[G,ee]=x.useState(null),[le,V]=x.useState(""),[Ve,Me]=x.useState(""),[Fe,Qe]=x.useState(""),[it,st]=x.useState(!1),[vt,Ye]=x.useState(!1),[Ze,We]=x.useState(""),[wt,It]=x.useState(""),[Ot,Wt]=x.useState(""),[jt,lr]=x.useState(!1),[$e,He]=x.useState(null),[Je,Ue]=x.useState(!1),[ht,at]=x.useState(null),[St,Tt]=x.useState(null),[Yt,Or]=x.useState(!1),[Dr,tr]=x.useState(null),[wr,Ir]=x.useState(null),[dn,ka]=x.useState(null),En=x.useMemo(()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"}catch(Xe){return console.warn("Unable to determine browser timezone, defaulting to UTC.",Xe),"UTC"}},[]);x.useEffect(()=>{Zt()},[]);const Zt=async()=>{try{_(!0);const[Xe,Vt]=await Promise.all([wS(),fR()]);t(Xe),n(Vt);const[ar,qr]=await Promise.all([ve.get("/api/settings/daily-break-start").catch(()=>null),ve.get("/api/settings/daily-break-end").catch(()=>null)]);Ir(ar?.data?.daily_break_start??null),ka(qr?.data?.daily_break_end??null),A(null)}catch(Xe){A("Failed to fetch data. Please try again."),console.error("Error fetching data:",Xe)}finally{_(!1)}},Xr=async()=>{if(!p||!m){A("Please select a date range");return}try{_(!0);const Xe=zw(p),Vt=new Date(m.getFullYear(),m.getMonth(),m.getDate()+1),ar=dh(Xe),qr=dh(Vt);console.log("Requesting shifts for:",ar,qr);const kr={from_date:ar,to_date:qr};s&&(kr.profile_id=s),c&&(kr.sales_order_id=c);const wn=await ofe(ar,qr,s||void 0,c||void 0);if(o(wn),c)q([]),K({}),R([]);else{const Zn=(await jfe(s||void 0,ar,qr)).map(Cn=>({...Cn,id:Number(Cn.id),profile_id:Number(Cn.profile_id)}));console.log("Fetched shifts:",Zn),q(Zn);const xn=[];let Ea=new Date(Xe);const Ta=new Date(Vt);for(;Ea<Ta;){const Gr={date:dh(Ea)};s&&(Gr.profile_id=s);const no=await ve.get("/api/time-tracking/time-entries",{params:Gr});xn.push(...no.data),Ea.setDate(Ea.getDate()+1)}const ti={},ea=[];Zn.forEach(Cn=>{const Gr=Number(Cn.id);Number.isNaN(Gr)||(ti[Gr]=[])}),xn.forEach(Cn=>{const Gr=new Date(Cn.clock_in).getTime(),no=Number(Cn.profile_id);let ao=!1;for(const io of Zn){const ji=Number(io.id);if(Number.isNaN(ji))continue;const oo=new Date(io.clock_in).getTime(),hi=io.clock_out?new Date(io.clock_out).getTime():null,Oo=Number(io.profile_id);if(hi&&!Number.isNaN(no)&&!Number.isNaN(Oo)&&no===Oo&&Gr>=oo&&Gr<hi){ti[ji].push(Cn),ao=!0;break}}ao||ea.push(Cn)}),K(ti),R(ea)}A(null)}catch(Xe){A("Failed to generate report. Please try again."),console.error("Error generating report:",Xe)}finally{_(!1)}},Gn=async Xe=>{if(!p||!m){A("Please select both from and to dates");return}try{const Vt=zw(p),ar=new Date(m.getFullYear(),m.getMonth(),m.getDate()+1),qr=dh(Vt),kr=dh(ar),wn=await sfe(qr,kr,s||void 0,c||void 0,Xe),Mr=c?`time-entries-report-so-${c}.${Xe}`:`time-entries-report.${Xe}`;Ofe(wn,Mr)}catch(Vt){A("Failed to export report. Please try again."),console.error("Error exporting report:",Vt)}},Tn=async()=>{if(P){M(null),A(null);try{const Xe=Pu(T),Vt=Pu(I),ar=await nfe(P.id,Xe,Vt);o(a.map(qr=>qr.id===P.id?{...qr,clock_in:ar.clock_in,clock_out:ar.clock_out,duration:ar.duration}:qr)),M(null),E(null),A(null)}catch(Xe){const ar=(Xe?.response?.data?.message??Xe?.response?.data?.error)||"Failed to update time entry. Please try again.";M(ar),A(ar),console.error("Error updating time entry:",Xe)}}},Wr=Xe=>{ee(Xe),Q(!0),V(c!==""?c:""),Me(Xe.clock_in?Hl(Xe.clock_in):""),Qe(Xe.clock_out?Hl(Xe.clock_out):""),A(null)},en=()=>{Q(!1),ee(null),Me(""),Qe(""),V(c!==""?c:""),st(!1)},Se=async()=>{if(!G||le===""||!Ve||!Fe)return;const Xe=Pu(Ve),Vt=Pu(Fe);if(!(!Xe||!Vt)){st(!0),A(null);try{await ife(G.profile_id,Number(le),Xe,Vt),en(),await Xr()}catch(ar){const qr=ar?.response?.data?.message||ar?.response?.data?.error||"Failed to create time entry. Please try again.";A(qr),console.error("Error creating manual time entry:",ar)}finally{st(!1)}}},Ge=Xe=>{at(null),A(null),He(Xe)},_e=()=>{Je||(He(null),at(null))},Te=async()=>{if(!$e)return;const Xe=$e.id;Ue(!0),at(null),A(null);try{await afe(Xe),He(null),await Xr()}catch(Vt){const ar=Vt?.response?.data?.message||Vt?.response?.data?.error||"Failed to delete time entry.";at(ar),A(ar)}finally{Ue(!1)}},nt=Xe=>{tr(null),A(null),Tt(Xe)},mt=()=>{Yt||(Tt(null),tr(null))},Mt=async()=>{if(!St)return;const Xe=St.id;Or(!0),tr(null),A(null);try{await Cfe(Xe),Tt(null),await Xr()}catch(Vt){const ar=Vt?.response?.data?.message||Vt?.response?.data?.error||"Failed to delete shift.";tr(ar),A(ar)}finally{Or(!1)}};x.useEffect(()=>{X&&(H(X.clock_in?Hl(X.clock_in):""),ne(X.clock_out?Hl(X.clock_out):""))},[X]);const{stackedChartData:Nr,salesOrderKeys:Ar,salesOrderColorMap:$r}=x.useMemo(()=>{const Xe=new Set,Vt=new Map;L.forEach(kr=>{const wn=Number(kr.id),Mr=Number(kr.profile_id);if(Number.isNaN(wn)||Number.isNaN(Mr)||!kr.clock_in||!kr.clock_out)return;const Zn=kr.profile_name||e.find(ti=>ti.id===Mr)?.name||`Profile ${Mr}`,xn=Ww(kr.duration,kr.clock_in,kr.clock_out,wr,dn,En),Ea=z[wn]||[],Ta=Vt.get(Mr)||{profileName:Zn,total:0,salesOrders:{}};Ta.total+=xn,Ea.forEach(ti=>{const ea=ti.sales_order_number||`SO ${ti.sales_order_id||"Unknown"}`,Cn=Hc(ti.duration),Gr=Cn!==null?Cn:0;Ta.salesOrders[ea]=(Ta.salesOrders[ea]||0)+Gr,Xe.add(ea)}),Vt.set(Mr,Ta)});const ar=Array.from(Vt.values()).map(kr=>{const wn=Object.values(kr.salesOrders).reduce((Zn,xn)=>Zn+xn,0),Mr=Math.max(0,kr.total-wn);return{profileName:kr.profileName,...kr.salesOrders,Idle:Mr}}),qr={Idle:Afe};return Array.from(Xe).forEach((kr,wn)=>{qr[kr]=GT[wn%GT.length]}),{stackedChartData:ar,salesOrderKeys:Array.from(Xe),salesOrderColorMap:qr}},[En,dn,wr,e,z,L]),Vr=({active:Xe,payload:Vt,label:ar})=>{if(!Xe||!Vt?.length)return null;const qr=Vt.filter(kr=>kr?.value&&kr.value>1e-4);return qr.length?i.jsxs(bt,{sx:{p:1.5},elevation:3,children:[i.jsx(B,{variant:"subtitle2",fontWeight:700,children:ar}),qr.map(kr=>i.jsxs(B,{variant:"body2",children:[kr.name,": ",Number(kr.value).toFixed(2)," hrs"]},kr.name))]}):null},In=Math.max(320,Nr.length*80);if(b)return i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:i.jsx(er,{})});const $n=Ve?new Date(Ve):null,ca=Fe?new Date(Fe):null,fi=!!(G&&le!==""&&$n&&ca&&ca.getTime()>$n.getTime()),ro=G?G.profile_name||e.find(Xe=>Xe.id===G.profile_id)?.name||`Profile ${G.profile_id}`:"",qi=St?St.profile_name||e.find(Xe=>Xe.id===St.profile_id)?.name||`Profile ${St.profile_id}`:"",Nn={};L.forEach(Xe=>{if(Xe.clock_in&&Xe.clock_out){const Vt=Number(Xe.id);if(Number.isNaN(Vt))return;const ar=Number(Xe.profile_id);if(Number.isNaN(ar))return;new Date(Xe.clock_in).getTime(),new Date(Xe.clock_out).getTime();const qr=Ww(Xe.duration,Xe.clock_in,Xe.clock_out,wr,dn,En),kr=z[Vt]||[];let wn=0;kr.forEach(Ea=>{const Ta=Hc(Ea.duration);wn+=Ta!==null?Ta:0});const Mr=Math.max(0,qr-wn),Zn=Math.min(qr,8),xn=Math.max(0,qr-8);Nn[ar]||(Nn[ar]={hours:0,idle:0,regular:0,overtime:0}),Nn[ar].hours+=qr,Nn[ar].idle+=Mr,Nn[ar].regular+=Zn,Nn[ar].overtime+=xn}});let Fi={},wi={};return c&&a.forEach(Xe=>{const Vt=Xe.profile_name||"Unknown",ar=Hc(Xe.duration),qr=ar!==null?ar:0;Fi[Vt]=(Fi[Vt]||0)+qr,wi[Vt]||(wi[Vt]=[]),wi[Vt].push({date:Xe.date,duration:qr})}),i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsx(B,{variant:"h4",gutterBottom:!0,sx:{fontSize:"2.5rem"},children:"Time Tracking Reports"}),w&&i.jsx(Pt,{severity:"error",sx:{mb:2},children:w}),i.jsx(Z,{mb:3,children:i.jsxs(bt,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,sx:{fontSize:"1.5rem"},children:"Hours by Profile (Attendance vs Sales Orders)"}),Nr.length>0?i.jsx(Z,{sx:{width:"100%",height:In},children:i.jsx(vD,{children:i.jsxs(qL,{data:Nr,layout:"vertical",margin:{top:16,right:24,left:24,bottom:16},children:[i.jsx(cv,{strokeDasharray:"3 3"}),i.jsx(Zc,{type:"number",tickFormatter:Xe=>`${Xe}h`}),i.jsx(eu,{dataKey:"profileName",type:"category",width:180}),i.jsx(xo,{content:Vr}),i.jsx(Ss,{wrapperStyle:{paddingTop:8}}),Ar.map(Xe=>i.jsx(vl,{dataKey:Xe,stackId:"hours",fill:$r[Xe]},Xe)),i.jsx(vl,{dataKey:"Idle",stackId:"hours",fill:$r.Idle})]})})}):i.jsx(B,{variant:"body1",sx:{color:"text.secondary"},children:"Generate a report to see attendance hours stacked by sales order and idle time."})]})}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsxs(bt,{sx:{p:2},children:[i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:2,children:i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{shrink:!0,children:"Profile"}),i.jsxs(ln,{value:s,label:"Profile",onChange:Xe=>l(Xe.target.value),displayEmpty:!0,sx:{"& .MuiSelect-select":{fontSize:"1.2rem"}},children:[i.jsx(Jt,{value:"",sx:{fontSize:"1.2rem"},children:"All Profiles"}),e.map(Xe=>i.jsx(Jt,{value:Xe.id,sx:{fontSize:"1.1rem"},children:Xe.name},Xe.id))]})]})}),i.jsx(ie,{item:!0,xs:12,md:2,children:i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{shrink:!0,children:"Sales Order"}),i.jsxs(ln,{value:c,label:"Sales Order",onChange:Xe=>u(Xe.target.value),displayEmpty:!0,sx:{"& .MuiSelect-select":{fontSize:"1.2rem"}},children:[i.jsx(Jt,{value:"",sx:{fontSize:"1.2rem"},children:"All Sales Orders"}),r.map(Xe=>i.jsx(Jt,{value:Xe.id,sx:{fontSize:"1.1rem"},children:`${Xe.number} - ${Xe.product_name||"No Product Name"} - ${Xe.customer_name||"Unknown Customer"}`},Xe.id))]})]})}),i.jsx(ie,{item:!0,xs:12,md:2,children:i.jsx(Os,{dateAdapter:VT,children:i.jsx(os,{label:"From Date",value:p,onChange:Xe=>v(Xe),slotProps:{textField:{fullWidth:!0}}})})}),i.jsx(ie,{item:!0,xs:12,md:2,children:i.jsx(Os,{dateAdapter:VT,children:i.jsx(os,{label:"To Date",value:m,onChange:Xe=>y(Xe),slotProps:{textField:{fullWidth:!0}}})})})]}),i.jsxs(Z,{display:"flex",justifyContent:"center",gap:2,mt:2,children:[i.jsx(xe,{variant:"contained",color:"secondary",onClick:()=>{We(s===""?"":s),It(""),Wt(""),A(null),Ye(!0)},children:"Add Shift"}),i.jsx(xe,{variant:"contained",color:"primary",onClick:Xr,children:"Generate Report"}),i.jsx(xe,{variant:"outlined",onClick:()=>Gn("csv"),children:"Export CSV"}),i.jsx(xe,{variant:"outlined",onClick:()=>Gn("pdf"),children:"Download PDF"})]})]})}),i.jsx(ie,{item:!0,xs:12,children:c?i.jsxs(bt,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,sx:{fontSize:"1.5rem"},children:"Time Entries Report for Sales Order"}),i.jsx(Z,{mb:2,children:i.jsxs(bt,{elevation:2,sx:{p:2,background:"#ede9fe",borderLeft:"6px solid #7c3aed"},children:[i.jsx(B,{variant:"h6",color:"#7c3aed",fontWeight:700,sx:{fontSize:"1.5rem"},children:"Total Hours by Profile on Sales Order"}),Object.entries(Fi).map(([Xe,Vt])=>i.jsxs(B,{variant:"body1",sx:{ml:2,fontSize:"1.2rem"},children:[" ",Xe,": ",Vt.toFixed(2)," hrs"]},Xe))]})}),i.jsxs(bt,{elevation:3,sx:{p:2,mb:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Time Entries for Sales Order"}),i.jsx(ma,{children:i.jsxs(ia,{children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Profile"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Date"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Clock In"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Clock Out"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Duration"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Actions"})]})}),i.jsx(sa,{children:a.map(Xe=>i.jsxs(mr,{children:[i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:Xe.profile_name}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:new Date(Xe.date).toLocaleDateString()}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:new Date(Xe.clock_in).toLocaleTimeString()}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:Xe.clock_out?new Date(Xe.clock_out).toLocaleTimeString():"-"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:Ev(Xe.duration)}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:Xe.clock_out&&i.jsx(xe,{variant:"text",startIcon:i.jsx(Tp,{}),onClick:()=>{M(null),A(null),E(Xe),S(Hl(Xe.clock_in)),U(Hl(Xe.clock_out))},sx:{ml:1},children:"Edit"})})]},Xe.id))})]})})]})]}):i.jsxs(bt,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,sx:{fontSize:"1.5rem"},children:"Time Entries Report"}),i.jsx(Z,{display:"flex",alignItems:"center",mb:2,children:i.jsx(ui,{control:i.jsx(ac,{checked:ae,onChange:Xe=>pe(Xe.target.checked),color:"primary"}),label:i.jsx(B,{sx:{fontSize:"1.1rem"},children:"Show time entry breakdown"})})}),L.length>0&&i.jsx(Z,{mb:2,children:i.jsxs(bt,{elevation:2,sx:{p:2,background:"#ede9fe",borderLeft:"6px solid #7c3aed"},children:[i.jsx(B,{variant:"h6",color:"#7c3aed",fontWeight:700,children:"Summary of Shift Hours by Profile"}),i.jsx(ma,{component:bt,sx:{mt:2},children:i.jsxs(ia,{size:"small",children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Profile Name"}),i.jsx(Oe,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Total hr"}),i.jsx(Oe,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Idle hr"}),i.jsx(Oe,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Regular hr"}),i.jsx(Oe,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Overtime hr"})]})}),i.jsx(sa,{children:Object.entries(Nn).map(([Xe,Vt])=>{const qr=L.find(kr=>kr.profile_id===Number(Xe))?.profile_name||e.find(kr=>kr.id===Number(Xe))?.name||`Profile ${Xe}`;return i.jsxs(mr,{children:[i.jsx(Oe,{sx:{fontSize:"1.2rem"},children:qr}),i.jsx(Oe,{sx:{fontSize:"1.2rem"},children:Vt.hours.toFixed(2)}),i.jsx(Oe,{sx:{fontSize:"1.2rem"},children:Vt.idle.toFixed(2)}),i.jsx(Oe,{sx:{fontSize:"1.2rem"},children:Vt.regular.toFixed(2)}),i.jsx(Oe,{sx:{fontSize:"1.2rem"},children:Vt.overtime.toFixed(2)})]},Xe)})})]})})]})}),L.length===0&&!b&&i.jsx(Pt,{severity:"info",sx:{mb:2},children:"No shifts found"}),L.map(Xe=>{const Vt=Number(Xe.id);return Number.isNaN(Vt)?null:i.jsx(Dfe,{shift:Xe,entries:z[Vt]||[],expanded:k===Vt,onExpand:()=>$(k===Vt?null:Vt),onAddEntry:Wr,setEditEntry:E,setEditClockIn:S,setEditClockOut:U,profiles:e,setEditShift:C,showBreakdown:ae,setEditEntryError:M,setError:A,onDeleteShift:nt,onDeleteEntry:Ge,dailyBreakStart:wr,dailyBreakEnd:dn,timeZone:En},Vt)}),J.length>0&&i.jsx(bt,{elevation:3,sx:{mb:2,borderLeft:"6px solid #a21caf",background:"#f3e8ff"},children:i.jsxs(Z,{p:2,children:[i.jsx(B,{variant:"subtitle1",fontWeight:700,color:"#a21caf",sx:{fontSize:"1.2rem"},children:"Unscheduled Entries"}),i.jsx(pR,{entries:J,setEditEntry:E,setEditClockIn:S,setEditClockOut:U,setEditEntryError:M,setError:A,onDeleteEntry:Ge})]})})]})})]}),i.jsxs(dr,{open:ge,onClose:en,children:[i.jsx(fr,{children:"Add Time Entry"}),i.jsxs(hr,{children:[G&&i.jsx(B,{variant:"body2",sx:{mb:2},children:`Profile: ${ro} | Shift Date: ${new Date(G.clock_in).toLocaleDateString()}`}),i.jsxs(tn,{fullWidth:!0,sx:{mb:2},children:[i.jsx(sn,{id:"add-entry-sales-order-label",children:"Sales Order"}),i.jsxs(ln,{labelId:"add-entry-sales-order-label",value:le,label:"Sales Order",displayEmpty:!0,onChange:Xe=>{const Vt=Xe.target.value;V(Vt===""?"":Number(Vt))},children:[i.jsx(Jt,{value:"",disabled:!0,children:i.jsx("em",{children:"Select a Sales Order"})}),r.map(Xe=>i.jsx(Jt,{value:Xe.id,children:`${Xe.number} - ${Xe.product_name||"No Product Name"} - ${Xe.customer_name||"Unknown Customer"}`},Xe.id))]})]}),i.jsx(Pe,{label:"Clock In",type:"datetime-local",value:Ve,onChange:Xe=>Me(Xe.target.value),fullWidth:!0,sx:{mb:2}}),i.jsx(Pe,{label:"Clock Out",type:"datetime-local",value:Fe,onChange:Xe=>Qe(Xe.target.value),fullWidth:!0})]}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:en,disabled:it,children:"Cancel"}),i.jsx(xe,{onClick:Se,variant:"contained",disabled:!fi||it,children:"Save"})]})]}),i.jsxs(dr,{open:!!P,onClose:()=>{E(null),M(null)},children:[i.jsx(fr,{children:"Edit Time Entry"}),i.jsxs(hr,{children:[O&&i.jsx(Pt,{severity:"error",sx:{mb:2},children:O}),i.jsx(Pe,{label:"Clock In",type:"datetime-local",value:T,onChange:Xe=>S(Xe.target.value),fullWidth:!0,sx:{mb:2}}),i.jsx(Pe,{label:"Clock Out",type:"datetime-local",value:I,onChange:Xe=>U(Xe.target.value),fullWidth:!0})]}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:()=>{E(null),M(null)},children:"Cancel"}),i.jsx(xe,{onClick:Tn,variant:"contained",startIcon:i.jsx(PI,{}),children:"Save"})]})]}),i.jsxs(dr,{open:!!$e,onClose:_e,children:[i.jsx(fr,{children:"Delete Time Entry"}),i.jsxs(hr,{children:[ht&&i.jsx(Pt,{severity:"error",sx:{mb:2},children:ht}),$e&&i.jsxs(B,{variant:"body2",children:["Are you sure you want to delete the entry for sales order ",$e.sales_order_number," on"," ",new Date($e.clock_in).toLocaleString(),"?"]})]}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:_e,disabled:Je,children:"Cancel"}),i.jsx(xe,{onClick:Te,variant:"contained",color:"error",disabled:Je,children:"Delete"})]})]}),i.jsxs(dr,{open:vt,onClose:()=>{jt||Ye(!1)},children:[i.jsx(fr,{children:"Add Shift"}),i.jsxs(hr,{children:[i.jsxs(tn,{fullWidth:!0,sx:{mb:2},children:[i.jsx(sn,{id:"add-shift-profile-label",children:"Profile"}),i.jsxs(ln,{labelId:"add-shift-profile-label",value:Ze,label:"Profile",onChange:Xe=>We(Xe.target.value),displayEmpty:!0,renderValue:Xe=>{if(Xe==null)return i.jsx("em",{children:"Select Profile"});if(typeof Xe=="string"&&Xe==="")return i.jsx("em",{children:"Select Profile"});const Vt=e.find(ar=>ar.id===Number(Xe));return Vt?Vt.name:String(Xe)},children:[i.jsx(Jt,{value:"",children:i.jsx("em",{children:"Select Profile"})}),e.map(Xe=>i.jsx(Jt,{value:Xe.id,children:Xe.name},Xe.id))]})]}),i.jsx(Pe,{label:"Clock In",type:"datetime-local",value:wt,onChange:Xe=>It(Xe.target.value),fullWidth:!0,sx:{mb:2},InputLabelProps:{shrink:!0}}),i.jsx(Pe,{label:"Clock Out",type:"datetime-local",value:Ot,onChange:Xe=>Wt(Xe.target.value),fullWidth:!0,InputLabelProps:{shrink:!0}})]}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:()=>{jt||Ye(!1)},children:"Cancel"}),i.jsx(xe,{onClick:async()=>{if(Ze===""||!wt||!Ot)return;const Xe=Pu(wt),Vt=Pu(Ot);if(!Xe||!Vt){A("Please provide valid shift times.");return}lr(!0);try{await _fe(Ze,Xe,Vt),Ye(!1),It(""),Wt(""),A(null),await Xr()}catch(ar){const qr=ar?.response?.data?.message||ar?.response?.data?.error||"Failed to create shift.";A(qr)}finally{lr(!1)}},variant:"contained",color:"primary",disabled:jt||Ze===""||!wt||!Ot,children:"Save"})]})]}),i.jsxs(dr,{open:!!X,onClose:()=>C(null),children:[i.jsx(fr,{children:"Edit Shift"}),i.jsxs(hr,{children:[i.jsx(Pe,{label:"Clock In",type:"datetime-local",value:N,onChange:Xe=>H(Xe.target.value),fullWidth:!0,sx:{mb:2}}),i.jsx(Pe,{label:"Clock Out",type:"datetime-local",value:W,onChange:Xe=>ne(Xe.target.value),fullWidth:!0})]}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:()=>C(null),children:"Cancel"}),i.jsx(xe,{onClick:async()=>{if(X){oe(!0);try{await wfe(X.id,new Date(N).toISOString(),new Date(W).toISOString()),C(null),oe(!1),await Xr()}catch(Xe){oe(!1);const Vt=Xe?.response?.data?.message||Xe?.response?.data?.error||"Failed to update shift.";A(Vt)}}},variant:"contained",color:"primary",disabled:se,children:"Save"})]})]}),i.jsxs(dr,{open:!!St,onClose:mt,children:[i.jsx(fr,{children:"Delete Shift"}),i.jsxs(hr,{children:[Dr&&i.jsx(Pt,{severity:"error",sx:{mb:2},children:Dr}),St&&i.jsxs(B,{variant:"body2",children:["Are you sure you want to delete the shift for ",qi," on"," ",new Date(St.clock_in).toLocaleString(),"? Any associated time entries must be removed first."]})]}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:mt,disabled:Yt,children:"Cancel"}),i.jsx(xe,{onClick:Mt,variant:"contained",color:"error",disabled:Yt,children:"Delete"})]})]})]})};function Ofe(e,t){const r=window.URL.createObjectURL(e),n=document.createElement("a");n.href=r,n.download=t,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(r),document.body.removeChild(n)}function Ww(e,t,r,n,a,o){const s=Hc(e);if(s!==null&&!Number.isNaN(s))return s;if(!t||!r)return 0;const l=new Date(t),c=new Date(r);return Number.isNaN(l.getTime())||Number.isNaN(c.getTime())||c.getTime()<=l.getTime()?0:kfe(l,c,n,a,o)}function kfe(e,t,r,n,a){let o=t.getTime()-e.getTime();if(r&&n){const l=Efe(a),c=Tfe(e,t,r,n,l);o-=c}const s=Math.max(0,o/(1e3*60*60));return Math.round(s*100)/100}function Efe(e){const t=(e||"").trim();if(!t)return"UTC";try{return new Intl.DateTimeFormat("en-US",{timeZone:t}),t}catch{return console.warn(`Invalid timezone "${t}" supplied. Falling back to UTC.`),"UTC"}}function Tfe(e,t,r,n,a){let o=0;if(t.getUTCDate()!==e.getUTCDate()||t.getUTCMonth()!==e.getUTCMonth()||t.getUTCFullYear()!==e.getUTCFullYear()){const l=Math.round((Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())-Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()))/864e5);for(let c=0;c<=l;c++){const u=hR(e,c),{start:d,end:f}=YT(u,r,n,a),h=Math.max(e.getTime(),d.getTime()),p=Math.min(t.getTime(),f.getTime());p>h&&(o+=p-h)}}else{const{start:l,end:c}=YT(e,r,n,a),u=Math.max(e.getTime(),l.getTime()),d=Math.min(t.getTime(),c.getTime());d>u&&(o+=d-u)}return Math.max(0,o)}function YT(e,t,r,n){const a=D2(e,t,n);let o=D2(e,r,n);return o.getTime()<=a.getTime()&&(o=D2(hR(e,1),r,n)),{start:a,end:o}}function D2(e,t,r){const[n="0",a="0"]=t.split(":"),o=Number(n),s=Number(a);if(Number.isNaN(o)||Number.isNaN(s))return new Date(e.getTime());const{year:l,month:c,day:u}=Ife(e,r),d=new Date(Date.UTC(l,c-1,u,o,s,0,0)),f=Nfe(d,r);return new Date(d.getTime()-f*60*1e3)}function Ife(e,t){const a=new Intl.DateTimeFormat("en-US",{timeZone:t,year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(e).reduce((o,s)=>(s.type!=="literal"&&(o[s.type]=s.value),o),{});return{year:Number(a.year),month:Number(a.month),day:Number(a.day)}}function Nfe(e,t){const a=new Intl.DateTimeFormat("en-US",{timeZone:t,hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).formatToParts(e).reduce((s,l)=>(l.type!=="literal"&&(s[l.type]=l.value),s),{});return(Date.UTC(Number(a.year),Number(a.month)-1,Number(a.day),Number(a.hour),Number(a.minute),Number(a.second))-e.getTime())/(1e3*60)}function hR(e,t){const r=new Date(e.getTime());return r.setUTCDate(r.getUTCDate()+t),r}function Dfe({shift:e,entries:t,expanded:r,onExpand:n,onAddEntry:a,setEditEntry:o,setEditClockIn:s,setEditClockOut:l,profiles:c,setEditShift:u,showBreakdown:d,setEditEntryError:f,setError:h,onDeleteShift:p,onDeleteEntry:v,dailyBreakStart:m,dailyBreakEnd:y,timeZone:b}){const _=new Date(e.clock_in),w=e.clock_out?new Date(e.clock_out):null,A=Ww(e.duration,e.clock_in,e.clock_out,m,y,b),P=e.profile_name||c.find(S=>S.id===e.profile_id)?.name||`Profile ${e.profile_id}`;let E=0;t.forEach(S=>{const I=Hc(S.duration);E+=I!==null?I:0});const T=Math.max(0,A-E);return i.jsx(bt,{elevation:3,sx:{mb:2,borderLeft:"6px solid #7c3aed",background:r?"#f3e8ff":"white"},children:i.jsxs(Z,{p:2,children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsxs(B,{variant:"subtitle1",fontWeight:700,color:"#7c3aed",sx:{fontSize:"1.2rem"},children:["Profile: ",P,"  Date: ",_.toLocaleDateString()]}),i.jsxs(Z,{display:"flex",gap:1,children:[d&&i.jsx(xe,{variant:"contained",color:"primary",size:"small",onClick:n,children:r?"Hide Entries":"Show Entries"}),i.jsx(xe,{variant:"outlined",color:"primary",size:"small",onClick:()=>a(e),children:"Add Entry"}),i.jsx(xe,{variant:"contained",color:"primary",size:"small",onClick:()=>u(e),children:"Edit Shift"}),i.jsx(xe,{variant:"outlined",color:"error",size:"small",onClick:()=>p(e),startIcon:i.jsx(Id,{}),children:"Delete Shift"})]})]}),i.jsxs(B,{variant:"body1",sx:{mt:1,fontSize:"1.1rem"},children:["Shift: ",_.toLocaleTimeString(),"  ",w?w.toLocaleTimeString():"-"," (",A.toFixed(2)," hrs)"]}),d&&i.jsxs(Z,{sx:{mt:1,ml:2},children:[t.map((S,I)=>{const U=Hc(S.duration),O=U!==null?U:0,M=new Date(S.clock_in),L=S.clock_out?new Date(S.clock_out):null;return i.jsxs(B,{variant:"body2",sx:{fontSize:"1.1rem"},children:[" ",S.sales_order_number,": ",M.toLocaleTimeString(),"  ",L?L.toLocaleTimeString():"-"," (",O.toFixed(3)," hrs)"]},S.id||I)}),T>0&&i.jsxs(B,{variant:"body2",sx:{fontSize:"1.1rem"},children:[" Idle: ",T.toFixed(3)," hrs"]})]}),d&&r&&i.jsx(pR,{entries:t,setEditEntry:o,setEditClockIn:s,setEditClockOut:l,setEditEntryError:f,setError:h,onDeleteEntry:v})]})})}function pR({entries:e,setEditEntry:t,setEditClockIn:r,setEditClockOut:n,setEditEntryError:a,setError:o,onDeleteEntry:s}){return i.jsx(ma,{sx:{mt:1,mb:1},children:i.jsxs(ia,{size:"small",children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{children:"Sales Order"}),i.jsx(Oe,{children:"Clock In"}),i.jsx(Oe,{children:"Clock Out"}),i.jsx(Oe,{children:"Duration"}),i.jsx(Oe,{children:"Actions"})]})}),i.jsx(sa,{children:e.map(l=>i.jsxs(mr,{children:[i.jsx(Oe,{children:l.sales_order_number}),i.jsx(Oe,{children:new Date(l.clock_in).toLocaleTimeString()}),i.jsx(Oe,{children:l.clock_out?new Date(l.clock_out).toLocaleTimeString():"-"}),i.jsx(Oe,{children:Ev(l.duration)}),i.jsxs(Oe,{children:[l.clock_out&&i.jsx(xe,{variant:"text",startIcon:i.jsx(Tp,{}),onClick:()=>{a(null),o(null),t(l),r(Hl(l.clock_in)),n(Hl(l.clock_out))},sx:{ml:1},children:"Edit"}),s&&i.jsx(xe,{variant:"text",color:"error",startIcon:i.jsx(Id,{}),onClick:()=>s(l),sx:{ml:l.clock_out?1:0},children:"Delete"})]})]},l.id))})]})})}const Wo={submitRequest:async e=>(await ve.post("/api/leave-management/request",e)).data,getMyRequests:async()=>(await ve.get("/api/leave-management/my-requests")).data,getAllRequests:async()=>(await ve.get("/api/leave-management/all-requests")).data,getCalendar:async(e,t)=>{const r={};return e&&(r.start_date=e),t&&(r.end_date=t),(await ve.get("/api/leave-management/calendar",{params:r})).data},approveRequest:async(e,t,r,n)=>(await ve.post(`/api/leave-management/approve/${e}`,{admin_notes:t,proposed_start_date:r,proposed_end_date:n})).data,denyRequest:async(e,t)=>(await ve.post(`/api/leave-management/deny/${e}`,{admin_notes:t})).data,proposeVacationDates:async(e,t,r,n)=>(await ve.post(`/api/leave-management/propose/${e}`,{proposed_start_date:t,proposed_end_date:r,admin_notes:n})).data,getProfiles:async()=>(await ve.get("/api/leave-management/profiles")).data,getLeaveHistory:async()=>(await ve.get("/api/leave-management/history")).data,getVacationSettings:async()=>(await ve.get("/api/leave-management/vacation-settings")).data,updateVacationSettings:async e=>(await ve.put("/api/leave-management/vacation-settings",{reset_date:e})).data,updateEmployeeVacationDays:async(e,t)=>(await ve.put(`/api/leave-management/profiles/${e}/vacation-days`,{total_vacation_days:t})).data,resetAllVacationDays:async()=>(await ve.post("/api/leave-management/reset-vacation-days")).data,getLeaveStatistics:async()=>(await ve.get("/api/leave-management/statistics")).data},Mfe=()=>{const{user:e}=Jn(),t=kn(),[r,n]=x.useState([]),[a,o]=x.useState([]),[s,l]=x.useState(!0),[c,u]=x.useState(null),[d,f]=x.useState(()=>{const k=Rt(),$=k.day();return k.subtract($,"day").startOf("day")}),[h,p]=x.useState({open:!1,requestId:0,action:"approve"}),[v,m]=x.useState(""),[y,b]=x.useState(null),[_,w]=x.useState(null),[A,P]=x.useState(!1),[E,T]=x.useState(!0);x.useEffect(()=>{console.log("LeaveManagementPage - User data:",e),(e?.access_role==="Admin"||e?.access_role==="Time Tracking")&&S()},[e]);const S=async()=>{try{console.log("LeaveManagementPage - Fetching data..."),l(!0);const[k,$]=await Promise.all([Wo.getAllRequests(),Wo.getProfiles()]);console.log("LeaveManagementPage - Data received:",{requestsData:k,profilesData:$}),n(k||[]),o($||[]),u(null)}catch(k){console.error("LeaveManagementPage - Error fetching data:",k),u(k.response?.data?.message||"Failed to load data. Please try again.")}finally{l(!1)}},I=()=>{const k=[],$=Rt();for(let X=0;X<7;X++){const C=d.add(X,"day"),N=C.isSame($,"day"),H=r.filter(W=>{if(W.status!=="approved")return!1;const ne=Rt(W.start_date),se=Rt(W.end_date);return(ne.isSame(C,"day")||ne.isBefore(C))&&(se.isSame(C,"day")||se.isAfter(C))}).map(W=>W.profile_name);k.push({date:C,isToday:N,hasTimeOff:H.length>0,timeOffProfiles:H})}return k},U=k=>{f(k==="prev"?$=>$.subtract(7,"day"):$=>$.add(7,"day"))},O=()=>{const k=Rt(),$=k.day();f(k.subtract($,"day").startOf("day"))},M=()=>{const k=d.add(6,"day");return r.filter($=>{if($.status!=="approved")return!1;const X=Rt($.start_date),C=Rt($.end_date);return(X.isSame(k,"day")||X.isBefore(k))&&(C.isSame(d,"day")||C.isAfter(d))}).map($=>({profileName:$.profile_name,startDate:Rt($.start_date),endDate:Rt($.end_date),requestType:$.request_type,reason:$.reason})).sort(($,X)=>$.startDate.valueOf()-X.startDate.valueOf())},L=()=>{const k=Rt(),$=k.startOf("month"),X=k.endOf("month");return r.filter(N=>{if(N.status!=="approved")return!1;const H=Rt(N.start_date),W=Rt(N.end_date);return(H.isSame(X,"day")||H.isBefore(X))&&(W.isSame($,"day")||W.isAfter($))}).map(N=>({profileName:N.profile_name,startDate:Rt(N.start_date),endDate:Rt(N.end_date),requestType:N.request_type})).sort((N,H)=>N.startDate.valueOf()-H.startDate.valueOf())},q=()=>{const k=L();if(k.length===0)return"No employees on leave this month";const $=new Map;return k.forEach(C=>{$.has(C.profileName)||$.set(C.profileName,[]),$.get(C.profileName).push(C)}),Array.from($.entries()).map(([C,N])=>{const H=N.map(W=>{const ne=W.startDate.format("MMM D"),se=W.endDate.format("MMM D");return`${ne}-${se}`}).join(", ");return`${C}: ${H}`}).slice(0,3).join("  ")},z=(k,$)=>{p({open:!0,requestId:k,action:$}),m(""),b(null),w(null)},K=async()=>{P(!0);try{const{requestId:k,action:$}=h;if($==="approve")await Wo.approveRequest(k,v,y?.format("YYYY-MM-DD"),_?.format("YYYY-MM-DD"));else if($==="deny")await Wo.denyRequest(k,v);else if($==="propose"){if(!y||!_){u("Please enter both start and end dates"),P(!1);return}if(_.isBefore(y)){u("End date cannot be before start date"),P(!1);return}await Wo.proposeVacationDates(k,y.format("YYYY-MM-DD"),_.format("YYYY-MM-DD"),v)}p({open:!1,requestId:0,action:"approve"}),await S()}catch(k){u(k.response?.data?.message||"Action failed. Please try again.")}finally{P(!1)}},J=k=>{const X={pending:{color:"warning",label:"Pending"},approved:{color:"success",label:"Approved"},denied:{color:"error",label:"Denied"},modified:{color:"info",label:"Modified"}}[k]||{color:"default",label:k};return i.jsx(ot,{label:X.label,color:X.color,size:"small"})},R=k=>({vacation:"Vacation",sick:"Sick Day",personal:"Personal",bereavement:"Bereavement"})[k]||k;return e?e.access_role!=="Admin"&&e.access_role!=="Time Tracking"?i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(Pt,{severity:"error",children:"Access denied. Admin or Time Tracking privileges required to view this page."})}):s?i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:i.jsx(er,{})})}):i.jsx(Os,{dateAdapter:oc,children:i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsxs(B,{variant:"h4",component:"h1",children:["Leave Management",e.access_role==="Admin"?" (Admin)":" (View Only)"]}),i.jsxs(Z,{display:"flex",gap:2,children:[i.jsx(xe,{variant:"outlined",startIcon:i.jsx(F2,{}),onClick:()=>t("/leave-history"),children:"View History"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Uu,{}),onClick:()=>t("/vacation-days-management"),children:"Manage Vacation Days"})]})]}),i.jsx(B,{variant:"body1",color:"text.secondary",paragraph:!0,children:q()}),c&&i.jsx(Pt,{severity:"error",sx:{mb:2},children:c}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsxs(bt,{sx:{p:3},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsxs(B,{variant:"h6",children:[i.jsx(zu,{sx:{mr:1,verticalAlign:"middle"}}),"Weekly Leave Schedule"]}),i.jsxs(Z,{display:"flex",gap:1,children:[i.jsx(xe,{variant:"outlined",size:"small",onClick:()=>U("prev"),startIcon:i.jsx(j8,{}),children:"Previous Week"}),i.jsx(xe,{variant:"outlined",size:"small",onClick:O,startIcon:i.jsx(S8,{}),children:"Today"}),i.jsx(xe,{variant:"outlined",size:"small",onClick:()=>U("next"),endIcon:i.jsx(C8,{}),children:"Next Week"})]})]}),i.jsxs(B,{variant:"body2",color:"text.secondary",mb:3,children:["Week of ",d.format("MMMM D, YYYY")]}),i.jsx(Z,{sx:{overflowX:"auto"},children:i.jsx(ma,{component:bt,variant:"outlined",children:i.jsxs(ia,{size:"small",children:[i.jsx(oa,{children:i.jsxs(mr,{sx:{backgroundColor:"grey.50"},children:[i.jsx(Oe,{sx:{fontWeight:"bold",minWidth:140},children:"Employee Name"}),I().map((k,$)=>i.jsx(Oe,{align:"center",sx:{fontWeight:"bold",minWidth:70},children:i.jsxs(Z,{children:[i.jsx(B,{variant:"caption",display:"block",sx:{fontWeight:"bold"},children:k.date.format("ddd")}),i.jsx(B,{variant:"body2",children:k.date.format("MMM D")}),k.isToday&&i.jsx(B,{variant:"caption",display:"block",sx:{color:"primary.main",fontWeight:"bold"},children:"Today"})]})},$))]})}),i.jsxs(sa,{children:[M().map((k,$)=>i.jsxs(mr,{hover:!0,children:[i.jsx(Oe,{sx:{fontWeight:"medium"},children:k.profileName}),I().map((X,C)=>{const N=(k.startDate.isSame(X.date,"day")||k.startDate.isBefore(X.date))&&(k.endDate.isSame(X.date,"day")||k.endDate.isAfter(X.date));return i.jsx(Oe,{align:"center",sx:{backgroundColor:N?"error.light":"inherit",color:N?"error.dark":"text.primary",fontWeight:N?"medium":"normal"},children:N?i.jsxs(Z,{children:[i.jsx(B,{variant:"caption",display:"block",sx:{fontWeight:"bold",textTransform:"capitalize"},children:R(k.requestType)}),k.reason&&i.jsx(Hn,{title:k.reason,children:i.jsx(B,{variant:"caption",sx:{opacity:.75},children:k.reason.length>8?k.reason.substring(0,8)+"...":k.reason})})]}):i.jsx(B,{variant:"body2",color:"text.secondary",children:"-"})},C)})]},$)),M().length===0&&i.jsx(mr,{children:i.jsx(Oe,{colSpan:8,align:"center",sx:{py:4},children:i.jsxs(Z,{sx:{textAlign:"center"},children:[i.jsx(zu,{sx:{fontSize:48,color:"text.secondary",mb:2}}),i.jsx(B,{color:"text.secondary",children:"No employees on leave this week"})]})})})]})]})})})]})}),i.jsx(ie,{item:!0,xs:12,children:i.jsxs(bt,{sx:{p:3},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsxs(B,{variant:"h6",children:[i.jsx(A8,{sx:{mr:1,verticalAlign:"middle"}}),"Leave Requests",e.access_role!=="Admin"&&i.jsx(B,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:1},children:"View-only mode. Admin actions are restricted to administrators."})]}),i.jsxs(Z,{display:"flex",alignItems:"center",gap:2,children:[i.jsx(B,{variant:"body2",color:"text.secondary",children:"Show:"}),i.jsx(xe,{variant:E?"contained":"outlined",size:"small",onClick:()=>T(!0),sx:{minWidth:100},children:"Pending"}),i.jsx(xe,{variant:E?"outlined":"contained",size:"small",onClick:()=>T(!1),sx:{minWidth:100},children:"All"})]})]}),i.jsx(ma,{children:i.jsxs(ia,{children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{sx:{fontWeight:"bold"},children:"Employee"}),i.jsx(Oe,{sx:{fontWeight:"bold"},children:"Type"}),i.jsx(Oe,{sx:{fontWeight:"bold"},children:"Dates"}),i.jsx(Oe,{sx:{fontWeight:"bold"},children:"Days"}),i.jsx(Oe,{sx:{fontWeight:"bold"},children:"Status"}),i.jsx(Oe,{sx:{fontWeight:"bold"},children:"Reason"}),i.jsx(Oe,{sx:{fontWeight:"bold"},children:"Admin Notes"}),i.jsx(Oe,{sx:{fontWeight:"bold"},children:"Actions"})]})}),i.jsx(sa,{children:(()=>{const k=E?r.filter($=>$.status==="pending"):r;return k.length===0?i.jsx(mr,{children:i.jsx(Oe,{colSpan:8,align:"center",sx:{py:4},children:i.jsx(B,{color:"text.secondary",children:E?"No pending leave requests found":"No leave requests found"})})}):k.map($=>i.jsxs(mr,{hover:!0,children:[i.jsx(Oe,{children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",sx:{fontWeight:"medium"},children:$.profile_name}),i.jsx(B,{variant:"caption",color:"text.secondary",children:$.user_email})]})}),i.jsx(Oe,{children:i.jsx(ot,{label:R($.request_type),size:"small",variant:"outlined"})}),i.jsxs(Oe,{children:[i.jsx(B,{variant:"body2",children:Rt($.start_date).format("MMM D, YYYY")}),i.jsxs(B,{variant:"body2",children:["to ",Rt($.end_date).format("MMM D, YYYY")]})]}),i.jsx(Oe,{children:i.jsxs(B,{variant:"body2",children:[$.total_days," day",$.total_days!==1?"s":""]})}),i.jsx(Oe,{children:J($.status)}),i.jsx(Oe,{children:i.jsx(B,{variant:"body2",sx:{maxWidth:200},children:$.reason||"-"})}),i.jsx(Oe,{children:i.jsx(B,{variant:"body2",sx:{maxWidth:200},children:$.admin_notes||"-"})}),i.jsx(Oe,{children:$.status==="pending"&&e.access_role==="Admin"&&i.jsxs(Z,{display:"flex",gap:1,children:[i.jsx(Hn,{title:"Approve Request",children:i.jsx(vr,{color:"success",size:"small",onClick:()=>z($.request_id,"approve"),children:i.jsx(jh,{})})}),i.jsx(Hn,{title:"Deny Request",children:i.jsx(vr,{color:"error",size:"small",onClick:()=>z($.request_id,"deny"),children:i.jsx(Tu,{})})}),($.request_type==="vacation"||$.request_type==="personal"||$.request_type==="bereavement")&&i.jsx(Hn,{title:"Propose Dates",children:i.jsx(vr,{color:"info",size:"small",onClick:()=>z($.request_id,"propose"),children:i.jsx(zu,{})})})]})})]},$.request_id))})()})]})})]})})]}),i.jsxs(dr,{open:h.open,onClose:()=>p({open:!1,requestId:0,action:"approve"}),maxWidth:"sm",fullWidth:!0,children:[i.jsx(fr,{children:h.action==="approve"?"Approve Request":h.action==="deny"?"Deny Request":"Propose Dates"}),i.jsx(hr,{children:i.jsxs(Z,{sx:{pt:2},children:[(h.action==="propose"||h.action==="approve")&&i.jsx(Z,{sx:{mb:3},children:i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,children:i.jsx(os,{label:h.action==="propose"?"Proposed Start Date":"Proposed Start Date (Optional)",value:y,onChange:k=>b(k),slotProps:{textField:{fullWidth:!0,size:"small"}}})}),i.jsx(ie,{item:!0,xs:6,children:i.jsx(os,{label:h.action==="propose"?"Proposed End Date":"Proposed End Date (Optional)",value:_,onChange:k=>w(k),minDate:y,disabled:!y,slotProps:{textField:{fullWidth:!0,size:"small"}}})})]})}),i.jsx(Pe,{fullWidth:!0,multiline:!0,rows:3,label:"Admin Notes",value:v,onChange:k=>m(k.target.value),placeholder:"Add notes about this decision...",variant:"outlined",size:"small"})]})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:()=>p({open:!1,requestId:0,action:"approve"}),disabled:A,children:"Cancel"}),i.jsx(xe,{onClick:K,disabled:A,variant:"contained",color:h.action==="deny"?"error":"primary",children:A?"Processing...":h.action==="approve"?"Approve":h.action==="deny"?"Deny":"Propose"})]})]})]})}):i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsxs(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:[i.jsx(er,{}),i.jsx(B,{variant:"body2",sx:{ml:2},children:"Loading user data..."})]})})},Lfe=()=>{const{user:e}=Jn(),[t,r]=x.useState([]),[n,a]=x.useState(null),[o,s]=x.useState(!0),[l,c]=x.useState(null);x.useEffect(()=>{(e?.access_role==="Admin"||e?.access_role==="Time Tracking")&&u()},[e]);const u=async()=>{try{s(!0);const[v,m]=await Promise.all([Wo.getLeaveHistory(),Wo.getLeaveStatistics()]);r(v||[]),a(m),c(null)}catch(v){console.error("Error fetching leave history:",v),c(v.response?.data?.message||"Failed to load leave history. Please try again.")}finally{s(!1)}},d=v=>Rt(v+"-01").format("MMMM YYYY"),f=v=>{let m=0;return Object.values(v.months).forEach(y=>{m+=y.total_days}),m},h=()=>{const v=new Set;return t.forEach(m=>{Object.keys(m.months).forEach(y=>v.add(y))}),Array.from(v).sort().reverse()};if(!e)return i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsxs(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:[i.jsx(er,{}),i.jsx(B,{variant:"body2",sx:{ml:2},children:"Loading user data..."})]})});if(e.access_role!=="Admin"&&e.access_role!=="Time Tracking")return i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(Pt,{severity:"error",children:"Access denied. Admin or Time Tracking privileges required to view this page."})});if(o)return i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:i.jsx(er,{})})});const p=h();return i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(B,{variant:"h4",component:"h1",gutterBottom:!0,children:[i.jsx(F2,{sx:{mr:1,verticalAlign:"middle"}}),"Leave History (Past 12 Months)"]}),i.jsx(B,{variant:"body1",color:"text.secondary",paragraph:!0,children:"View leave history for all employees over the past 12 months"}),l&&i.jsx(Pt,{severity:"error",sx:{mb:2},children:l}),t.length===0?i.jsxs(bt,{sx:{p:4,textAlign:"center"},children:[i.jsx(F2,{sx:{fontSize:64,color:"text.secondary",mb:2}}),i.jsx(B,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Leave History Found"}),i.jsx(B,{color:"text.secondary",children:"No approved leave requests found in the past 12 months."})]}):i.jsxs(Z,{children:[i.jsxs(ie,{container:!0,spacing:3,sx:{mb:4},children:[i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(Rr,{children:i.jsx(Hr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(OI,{sx:{fontSize:40,color:"primary.main",mr:2}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",component:"div",children:n?.employees_with_leave_this_month||0}),i.jsx(B,{color:"text.secondary",children:"Employees with Leave This Month"})]})]})})})}),i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(Rr,{children:i.jsx(Hr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(zu,{sx:{fontSize:40,color:"success.main",mr:2}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",component:"div",children:n?.total_days_this_month||0}),i.jsx(B,{color:"text.secondary",children:"Total Days of Leave This Month"})]})]})})})}),i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(Rr,{children:i.jsx(Hr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(kI,{sx:{fontSize:40,color:"info.main",mr:2}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",component:"div",children:n?.total_days_past_12_months||0}),i.jsx(B,{color:"text.secondary",children:"Total Days of Leave (Past 12 Months)"})]})]})})})})]}),t.map(v=>i.jsxs(P8,{sx:{mb:2},children:[i.jsx(O8,{expandIcon:i.jsx(EI,{}),children:i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"h6",children:v.profile_name}),i.jsx(B,{variant:"body2",color:"text.secondary",children:v.profile_email})]}),i.jsxs(Z,{display:"flex",alignItems:"center",gap:2,children:[i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Total: ",f(v).toFixed(1)," days"]}),i.jsx(ot,{label:`${Object.keys(v.months).length} months`,size:"small",variant:"outlined"})]})]})}),i.jsx(k8,{children:i.jsx(ma,{component:bt,variant:"outlined",children:i.jsxs(ia,{size:"small",children:[i.jsx(oa,{children:i.jsxs(mr,{sx:{backgroundColor:"grey.50"},children:[i.jsx(Oe,{sx:{fontWeight:"bold"},children:"Month"}),i.jsx(Oe,{align:"center",sx:{fontWeight:"bold"},children:"Vacation"}),i.jsx(Oe,{align:"center",sx:{fontWeight:"bold"},children:"Sick"}),i.jsx(Oe,{align:"center",sx:{fontWeight:"bold"},children:"Personal"}),i.jsx(Oe,{align:"center",sx:{fontWeight:"bold"},children:"Bereavement"}),i.jsx(Oe,{align:"center",sx:{fontWeight:"bold"},children:"Total"})]})}),i.jsx(sa,{children:p.map(m=>{const y=v.months[m];return!y||y.total_days===0?null:i.jsxs(mr,{hover:!0,children:[i.jsx(Oe,{sx:{fontWeight:"medium"},children:d(m)}),i.jsx(Oe,{align:"center",children:y.vacation_days>0?i.jsx(ot,{label:y.vacation_days,size:"small",color:"success",variant:"outlined"}):"-"}),i.jsx(Oe,{align:"center",children:y.sick_days>0?i.jsx(ot,{label:y.sick_days,size:"small",color:"error",variant:"outlined"}):"-"}),i.jsx(Oe,{align:"center",children:y.personal_days>0?i.jsx(ot,{label:y.personal_days,size:"small",color:"info",variant:"outlined"}):"-"}),i.jsx(Oe,{align:"center",children:y.bereavement_days>0?i.jsx(ot,{label:y.bereavement_days,size:"small",color:"warning",variant:"outlined"}):"-"}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"body2",sx:{fontWeight:"bold"},children:y.total_days})})]},m)})})]})})})]},v.profile_id))]})]})},Rfe=()=>{const{user:e}=Jn(),[t,r]=x.useState([]),[n,a]=x.useState(null),[o,s]=x.useState(!0),[l,c]=x.useState(null),[u,d]=x.useState(null),[f,h]=x.useState(0),[p,v]=x.useState(!1),[m,y]=x.useState(null),[b,_]=x.useState(!1);x.useEffect(()=>{e?.access_role==="Admin"&&w()},[e]);const w=async()=>{try{s(!0);const[L,q]=await Promise.all([Wo.getProfiles(),Wo.getVacationSettings()]);r(L||[]),a(q),c(null)}catch(L){console.error("Error fetching data:",L),c(L.response?.data?.message||"Failed to load data. Please try again.")}finally{s(!1)}},A=L=>{d(L.id),h(L.total_vacation_days||L.vacation_days_available||20)},P=async()=>{if(!u)return;const L=Math.round(f);try{_(!0),await Wo.updateEmployeeVacationDays(u,L),await w(),d(null),h(0)}catch(q){c(q.response?.data?.message||"Failed to update vacation days.")}finally{_(!1)}},E=()=>{d(null),h(0)},T=()=>{y(n?.reset_date?Rt(n.reset_date):null),v(!0)},S=async()=>{if(!m){c("Please select a reset date.");return}try{_(!0),await Wo.updateVacationSettings(m.format("YYYY-MM-DD")),await w(),v(!1)}catch(L){c(L.response?.data?.message||"Failed to update settings.")}finally{_(!1)}},I=async()=>{if(window.confirm("This will reset vacation days for ALL employees. Are you sure?"))try{_(!0),await Wo.resetAllVacationDays(),await w()}catch(L){c(L.response?.data?.message||"Failed to reset vacation days.")}finally{_(!1)}};if(!e)return i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsxs(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:[i.jsx(er,{}),i.jsx(B,{variant:"body2",sx:{ml:2},children:"Loading user data..."})]})});if(e.access_role!=="Admin")return i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(Pt,{severity:"error",children:"Access denied. Admin privileges required to view this page."})});if(o)return i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:i.jsx(er,{})})});const U=t.length,O=t.reduce((L,q)=>L+(q.total_vacation_days||q.vacation_days_available||20),0),M=t.reduce((L,q)=>L+Math.round(q.days_used||0),0);return i.jsx(Os,{dateAdapter:oc,children:i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsxs(B,{variant:"h4",component:"h1",children:[i.jsx(Uu,{sx:{mr:1,verticalAlign:"middle"}}),"Vacation Days Management"]}),i.jsxs(Z,{display:"flex",gap:2,children:[i.jsx(xe,{variant:"outlined",startIcon:i.jsx(zu,{}),onClick:T,children:"Reset Settings"}),i.jsx(xe,{variant:"contained",color:"warning",startIcon:i.jsx(Kw,{}),onClick:I,disabled:b,children:"Reset All Days"})]})]}),i.jsx(B,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Manage vacation days allocation for each employee and set the global reset date."}),l&&i.jsx(Pt,{severity:"error",sx:{mb:2},children:l}),i.jsxs(ie,{container:!0,spacing:3,sx:{mb:4},children:[i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsx(Rr,{children:i.jsx(Hr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(OI,{sx:{fontSize:40,color:"primary.main",mr:2}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",component:"div",children:U}),i.jsx(B,{color:"text.secondary",children:"Total Employees"})]})]})})})}),i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsx(Rr,{children:i.jsx(Hr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(zu,{sx:{fontSize:40,color:"success.main",mr:2}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",component:"div",children:O}),i.jsx(B,{color:"text.secondary",children:"Total Days Allocated"})]})]})})})}),i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsx(Rr,{children:i.jsx(Hr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(kI,{sx:{fontSize:40,color:"info.main",mr:2}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",component:"div",children:M}),i.jsx(B,{color:"text.secondary",children:"Days Used"})]})]})})})}),i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsx(Rr,{children:i.jsx(Hr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(Uu,{sx:{fontSize:40,color:"warning.main",mr:2}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"h6",component:"div",children:n?.reset_date?Rt(n.reset_date).format("MMM D, YYYY"):"Not Set"}),i.jsx(B,{color:"text.secondary",children:"Reset Date"})]})]})})})})]}),i.jsxs(bt,{sx:{p:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Employee Vacation Days"}),i.jsx(ma,{children:i.jsxs(ia,{children:[i.jsx(oa,{children:i.jsxs(mr,{sx:{backgroundColor:"grey.50"},children:[i.jsx(Oe,{sx:{fontWeight:"bold"},children:"Employee"}),i.jsx(Oe,{align:"center",sx:{fontWeight:"bold"},children:"Total Days"}),i.jsx(Oe,{align:"center",sx:{fontWeight:"bold"},children:"Days Used"}),i.jsx(Oe,{align:"center",sx:{fontWeight:"bold"},children:"Days Remaining"}),i.jsx(Oe,{align:"center",sx:{fontWeight:"bold"},children:"Reset Date"}),i.jsx(Oe,{align:"center",sx:{fontWeight:"bold"},children:"Actions"})]})}),i.jsx(sa,{children:t.map(L=>i.jsxs(mr,{hover:!0,children:[i.jsx(Oe,{children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",sx:{fontWeight:"medium"},children:L.name}),i.jsx(B,{variant:"caption",color:"text.secondary",children:L.email})]})}),i.jsx(Oe,{align:"center",children:u===L.id?i.jsx(Pe,{type:"number",value:f,onChange:q=>h(Math.max(0,parseInt(q.target.value)||0)),size:"small",sx:{width:80},inputProps:{min:0,step:1}}):i.jsx(B,{variant:"body2",sx:{fontWeight:"bold"},children:L.total_vacation_days||L.vacation_days_available||20})}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"body2",color:"text.secondary",children:Math.round(L.days_used||0)})}),i.jsx(Oe,{align:"center",children:i.jsx(ot,{label:Math.round(L.days_remaining||L.vacation_days_available||20),size:"small",color:L.days_remaining&&L.days_remaining<5?"warning":"success",variant:"outlined"})}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"body2",color:"text.secondary",children:L.reset_date?Rt(L.reset_date).format("MMM D, YYYY"):"-"})}),i.jsx(Oe,{align:"center",children:u===L.id?i.jsxs(Z,{display:"flex",gap:1,children:[i.jsx(Hn,{title:"Save",children:i.jsx(vr,{color:"success",size:"small",onClick:P,disabled:b,children:i.jsx(PI,{})})}),i.jsx(Hn,{title:"Cancel",children:i.jsx(vr,{color:"error",size:"small",onClick:E,disabled:b,children:i.jsx(Tu,{})})})]}):i.jsx(Hn,{title:"Edit Vacation Days",children:i.jsx(vr,{color:"primary",size:"small",onClick:()=>A(L),children:i.jsx(Tp,{})})})})]},L.id))})]})})]}),i.jsxs(dr,{open:p,onClose:()=>v(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(fr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(Uu,{sx:{mr:1}}),"Vacation Reset Settings"]})}),i.jsx(hr,{children:i.jsxs(Z,{sx:{pt:2},children:[i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Set the date when vacation days will reset for all employees. This date will be the same for everyone and will repeat on the same month and day every year (e.g., January 1st, July 1st, etc.)."}),i.jsx(os,{label:"Reset Date",value:m,onChange:L=>y(L),slotProps:{textField:{fullWidth:!0,size:"small"}}}),m&&i.jsxs(Pt,{severity:"info",sx:{mt:2},children:["Vacation days will reset on ",m.format("MMMM D")," every year for all employees."]})]})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:()=>v(!1),disabled:b,children:"Cancel"}),i.jsx(xe,{onClick:S,disabled:b||!m,variant:"contained",children:b?"Saving...":"Save Settings"})]})]})]})})},qfe=async()=>(await ve.get("/api/products")).data,Ffe=()=>{const[e,t]=x.useState([]),[r,n]=x.useState(!1),[a,o]=x.useState(null),[s,l]=x.useState({page:0,pageSize:10}),[c,u]=x.useState(""),[d,f]=x.useState(!1),[h,p]=x.useState(null),[v,m]=x.useState(null);x.useEffect(()=>{y()},[]);const y=async()=>{n(!0),o(null);try{const S=[...await qfe()].sort((I,U)=>Number(U.product_id)-Number(I.product_id));t(S)}catch{o("Failed to fetch products"),me.error("Failed to fetch products")}finally{n(!1)}},b=e.filter(T=>{const S=c.toLowerCase();return T.product_name?.toLowerCase().includes(S)||T.product_description?.toLowerCase?.().includes(S)||String(T.product_id??"").toLowerCase().includes(S)}),_=async T=>{if(window.confirm("Are you sure you want to delete this product?"))try{await ve.delete(`/api/products/${T}`),t(S=>S.filter(I=>I.product_id!==T)),me.success("Product deleted successfully")}catch{me.error("Failed to delete product")}},w=()=>{const T=b.map(M=>({"Product ID":M.product_id,"Product Name":M.product_name,"Product Description":M.product_description??""})),S=Sl.unparse(T),I=new Blob([S],{type:"text/csv;charset=utf-8;"}),U=document.createElement("a"),O=URL.createObjectURL(I);U.href=O,U.setAttribute("download","products.csv"),U.style.visibility="hidden",document.body.appendChild(U),U.click(),document.body.removeChild(U),m("Products exported to CSV.")},A=()=>f(!0),P=()=>f(!1),E=[{field:"product_id",headerName:"Product ID",flex:.8,minWidth:110},{field:"product_name",headerName:"Product Name",flex:1.4,minWidth:200},{field:"product_description",headerName:"Product Description",flex:2,minWidth:250,valueGetter:T=>T.row.product_description??""},{field:"actions",headerName:"Actions",width:90,sortable:!1,filterable:!1,disableColumnMenu:!0,renderCell:T=>i.jsx(vr,{size:"small",color:"error",onClick:S=>{S.stopPropagation(),_(T.row.product_id)},children:i.jsx(ga,{})})}];return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Product List"}),i.jsx(Z,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:i.jsxs(ut,{direction:"row",spacing:2,children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:A,children:"New Product"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:w,children:"Export CSV"})]})})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(Pe,{fullWidth:!0,label:"Search",variant:"outlined",value:c,onChange:T=>u(T.target.value),InputProps:{startAdornment:i.jsx(aa,{position:"start",children:i.jsx(di,{sx:{fontSize:22}})})},sx:{mb:2,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"small"}),i.jsx(Po,{rows:b.map(T=>({...T,id:T.product_id})),columns:E,loading:r,paginationModel:s,onPaginationModelChange:l,pageSizeOptions:[10,25,50],getRowId:T=>T.id,disableRowSelectionOnClick:!0,initialState:{sorting:{sortModel:[{field:"product_id",sort:"desc"}]}},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),h&&i.jsx(Pt,{severity:"error",sx:{mt:2},onClose:()=>p(null),children:h}),v&&i.jsx(Pt,{severity:"success",sx:{mt:2},onClose:()=>m(null),children:v}),a&&i.jsx(B,{color:"error",children:a}),i.jsx(bS,{open:d,onClose:P,onSave:async T=>{try{await ve.post("/api/products",T),me.success("Product added successfully!"),f(!1),y()}catch{me.error("Failed to add product")}},isEditMode:!1})]})},$fe=({open:e,onClose:t,onSettingsSaved:r})=>{const[n,a]=x.useState({customBackupDir:"",customRestoreDir:""}),[o,s]=x.useState(!1),[l,c]=x.useState(!1),[u,d]=x.useState(null),[f,h]=x.useState(!1);x.useEffect(()=>{e&&p()},[e]);const p=async()=>{s(!0);try{const w=await ve.get("/api/backup/settings");a(w.data)}catch(w){console.error("Error fetching backup settings:",w),me.error("Failed to load backup settings")}finally{s(!1)}},v=async()=>{c(!0);try{await ve.post("/api/backup/settings",n),me.success("Backup settings saved successfully!"),r(),t()}catch(w){console.error("Error saving backup settings:",w),me.error("Failed to save backup settings")}finally{c(!1)}},m=w=>{const A=w.target.files?.[0];A&&d(A)},y=async()=>{if(!u){me.error("Please select a backup file to upload");return}h(!0);try{const w=new FormData;w.append("backup",u);const A=await ve.post("/api/backup/upload",w,{headers:{"Content-Type":"multipart/form-data"}});me.success("Backup uploaded successfully!"),d(null),r(),t()}catch(w){console.error("Error uploading backup:",w),me.error("Failed to upload backup file")}finally{h(!1)}},b=async()=>{try{if(window.api?.browseDirectory){const w=await window.api.browseDirectory({title:"Select Restore Directory"});w.success&&w.directory&&a(A=>({...A,customRestoreDir:w.directory}))}else me.info("Please enter the restore directory path manually")}catch(w){console.error("Error browsing restore directory:",w),me.error("Failed to browse directory")}},_=async()=>{try{if(window.api?.browseDirectory){const w=await window.api.browseDirectory({title:"Select Backup Directory"});w.success&&w.directory&&a(A=>({...A,customBackupDir:w.directory}))}else me.info("In web version, please enter the backup directory path manually. Example: C:\\MyBackups or /home/user/backups")}catch(w){console.error("Error browsing backup directory:",w),me.error("Failed to browse directory")}};return i.jsxs(dr,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,children:[i.jsx(fr,{children:i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[i.jsx(Uu,{}),"Backup Settings"]})}),i.jsx(hr,{children:o?i.jsx(Z,{sx:{display:"flex",justifyContent:"center",p:3},children:i.jsx(er,{})}):i.jsxs(Z,{sx:{mt:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Custom Backup Directory"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Set a custom directory where backups will be stored on the server device. Note: Backups are created on the server, not your local device. The directory must be accessible from the server where the application is running."}),i.jsxs(ie,{container:!0,spacing:2,alignItems:"center",children:[i.jsx(ie,{item:!0,xs:!0,children:i.jsx(Pe,{fullWidth:!0,label:"Backup Directory Path",value:n.customBackupDir,onChange:w=>a(A=>({...A,customBackupDir:w.target.value})),placeholder:"e.g., C:\\MyBackups or /home/user/backups",helperText:n.customBackupDir?`Backups will be stored in: ${n.customBackupDir}`:"Leave empty to use default backup location (backups folder in server directory)"})}),i.jsx(ie,{item:!0,children:i.jsx(Hn,{title:"Browse for backup directory (Desktop app only)",children:i.jsx(vr,{onClick:_,children:i.jsx(n5,{})})})})]}),!n.customBackupDir&&i.jsxs(Pt,{severity:"info",sx:{mt:1},children:[i.jsx(nx,{children:"Default Backup Location"}),"Backups will be stored in the default location: ",i.jsx("strong",{children:"backups/"})," folder in the server directory. To use a custom location, enter a valid directory path above."]}),n.customBackupDir&&!n.customDirExists&&i.jsxs(Pt,{severity:"warning",sx:{mt:1},children:[i.jsx(nx,{children:"Directory Not Found"}),"The specified backup directory does not exist: ",i.jsx("strong",{children:n.customBackupDir}),"Backups will fall back to the default location until this directory is created."]}),n.currentBackupDir&&i.jsxs(Pt,{severity:"success",sx:{mt:1},children:[i.jsx(nx,{children:"Current Backup Location"}),"Backups are currently being stored in: ",i.jsx("strong",{children:n.currentBackupDir})]}),i.jsx(Vn,{sx:{my:3}}),i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Custom Restore Directory"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Set a custom directory on the server to look for backup files when restoring. Note: This directory must be accessible from the server."}),i.jsxs(ie,{container:!0,spacing:2,alignItems:"center",children:[i.jsx(ie,{item:!0,xs:!0,children:i.jsx(Pe,{fullWidth:!0,label:"Restore Directory Path",value:n.customRestoreDir,onChange:w=>a(A=>({...A,customRestoreDir:w.target.value})),placeholder:"e.g., C:\\ExternalBackups or /home/user/external-backups",helperText:"Leave empty to use default restore location"})}),i.jsx(ie,{item:!0,children:i.jsx(Hn,{title:"Browse for restore directory",children:i.jsx(vr,{onClick:b,children:i.jsx(n5,{})})})})]}),i.jsx(Vn,{sx:{my:3}}),i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Upload External Backup"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Upload a backup file from your device to restore from"}),i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsxs(xe,{variant:"outlined",component:"label",startIcon:i.jsx(dg,{}),disabled:f,children:["Select Backup File",i.jsx("input",{type:"file",hidden:!0,accept:".zip,.sql,.json",onChange:m})]}),u&&i.jsxs(B,{variant:"body2",children:["Selected: ",u.name]}),u&&i.jsx(xe,{variant:"contained",onClick:y,disabled:f,startIcon:f?i.jsx(er,{size:20}):i.jsx(dg,{}),children:f?"Uploading...":"Upload & Restore"})]}),i.jsx(Pt,{severity:"info",sx:{mt:2},children:i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"Note:"})," Custom directories must be accessible by the application. Make sure the directories exist and have proper read/write permissions."]})})]})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:t,children:"Cancel"}),i.jsx(xe,{onClick:v,variant:"contained",disabled:l||o,startIcon:l?i.jsx(er,{size:20}):void 0,children:l?"Saving...":"Save Settings"})]})]})},Bfe=()=>{const[e,t]=x.useState([]),[r,n]=x.useState(null),[a,o]=x.useState(!1),[s,l]=x.useState(!1),[c,u]=x.useState(null),[d,f]=x.useState(null),[h,p]=x.useState(null),[v,m]=x.useState(!1),y=async()=>{o(!0);try{const[I,U]=await Promise.all([ve.get("/api/backup/list"),ve.get("/api/backup/stats")]);t(I.data.backups),n(U.data)}catch(I){console.error("Error fetching backups:",I),me.error("Failed to fetch backups")}finally{o(!1)}};x.useEffect(()=>{y()},[]);const b=async()=>{l(!0);try{const I=await ve.post("/api/backup/create");me.success("Backup created successfully!"),y()}catch(I){console.error("Error creating backup:",I),me.error("Failed to create backup")}finally{l(!1)}},_=async I=>{try{const U=await ve.get(`/api/backup/download/${I}`,{responseType:"blob"}),O=window.URL.createObjectURL(new Blob([U.data])),M=document.createElement("a");M.href=O,M.setAttribute("download",I),document.body.appendChild(M),M.click(),M.remove(),window.URL.revokeObjectURL(O),me.success("Backup downloaded successfully!")}catch(U){console.error("Error downloading backup:",U),me.error("Failed to download backup")}},w=async I=>{try{await ve.delete(`/api/backup/delete/${I}`),me.success("Backup deleted successfully!"),f(null),y()}catch(U){console.error("Error deleting backup:",U),me.error("Failed to delete backup")}},A=async I=>{u(I.manifest);try{const O=(await ve.post(`/api/backup/restore/${I.manifest}`)).data.results,M=Object.values(O).filter(q=>q==="success").length,L=Object.keys(O).length;M===L?me.success("Backup restored successfully! Please refresh the page."):me.warning(`Restore completed with ${M}/${L} components successful`),p(null),u(null)}catch(U){console.error("Error restoring backup:",U),me.error("Failed to restore backup"),u(null)}},P=I=>{if(I===0)return"0 Bytes";const U=1024,O=["Bytes","KB","MB","GB"],M=Math.floor(Math.log(I)/Math.log(U));return parseFloat((I/Math.pow(U,M)).toFixed(2))+" "+O[M]},E=I=>I.replace(/(\d{4}-\d{2}-\d{2})T(\d{2})-(\d{2})-(\d{2})-(\d{3})Z/,"$1T$2:$3:$4.$5Z"),T=I=>new Date(E(I)).toLocaleString(),S=I=>{const U=I.components,O=Object.keys(U).length;return`${Object.values(U).filter(L=>L!==null).length}/${O}`};return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Backup Management"}),i.jsx(B,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:"Create, manage, and restore backups of your application data"})]}),r&&i.jsxs(ie,{container:!0,spacing:3,sx:{mb:4},children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Rr,{children:i.jsxs(Hr,{children:[i.jsx(B,{color:"text.secondary",gutterBottom:!0,children:"Total Backups"}),i.jsx(B,{variant:"h4",component:"div",children:r.total_backups})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Rr,{children:i.jsxs(Hr,{children:[i.jsx(B,{color:"text.secondary",gutterBottom:!0,children:"Total Size"}),i.jsx(B,{variant:"h4",component:"div",children:P(r.total_size)})]})})})]}),i.jsxs(Z,{sx:{mb:3,display:"flex",gap:2,flexWrap:"wrap"},children:[i.jsx(xe,{variant:"contained",startIcon:s?i.jsx(er,{size:20}):i.jsx(Gw,{}),onClick:b,disabled:s,children:s?"Creating Backup...":"Create Backup"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Kw,{}),onClick:y,disabled:a,children:"Refresh"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Uu,{}),onClick:()=>m(!0),children:"Backup Settings"})]}),i.jsx(Pt,{severity:"warning",sx:{mb:3},children:i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"Important:"})," Restoring a backup will overwrite your current data. Make sure you have a backup of your current data before proceeding."]})}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden"},children:i.jsx(ma,{children:i.jsxs(ia,{children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{children:"Date & Time"}),i.jsx(Oe,{children:"Components"}),i.jsx(Oe,{children:"Size"}),i.jsx(Oe,{children:"System Info"}),i.jsx(Oe,{align:"center",children:"Actions"})]})}),i.jsx(sa,{children:a?i.jsx(mr,{children:i.jsx(Oe,{colSpan:5,align:"center",children:i.jsx(er,{})})}):e.length===0?i.jsx(mr,{children:i.jsx(Oe,{colSpan:5,align:"center",children:i.jsx(B,{variant:"body2",color:"text.secondary",children:"No backups found. Create your first backup to get started."})})}):e.map(I=>i.jsxs(mr,{hover:!0,children:[i.jsx(Oe,{children:i.jsx(B,{variant:"body2",children:T(I.timestamp)})}),i.jsxs(Oe,{children:[i.jsxs(Z,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[I.components.database&&i.jsx(ot,{label:"Database",size:"small",color:"primary"}),I.components.uploads&&i.jsx(ot,{label:"Uploads",size:"small",color:"secondary"}),I.components.config&&i.jsx(ot,{label:"Config",size:"small",color:"default"})]}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[S(I)," components available"]})]}),i.jsx(Oe,{children:i.jsx(B,{variant:"body2",children:P(I.size)})}),i.jsx(Oe,{children:i.jsxs(B,{variant:"caption",color:"text.secondary",children:[I.system_info.platform,"  ",I.system_info.arch]})}),i.jsx(Oe,{align:"center",children:i.jsxs(Z,{sx:{display:"flex",gap:1,justifyContent:"center"},children:[i.jsx(Hn,{title:"Download Backup",children:i.jsx(vr,{size:"small",onClick:()=>_(I.manifest),children:i.jsx(CI,{})})}),i.jsx(Hn,{title:"Restore Backup",children:i.jsx(vr,{size:"small",color:"primary",onClick:()=>p(I),children:i.jsx(a5,{})})}),i.jsx(Hn,{title:"Delete Backup",children:i.jsx(vr,{size:"small",color:"error",onClick:()=>f(I.manifest),children:i.jsx(Id,{})})})]})})]},I.manifest))})]})})}),i.jsxs(dr,{open:!!d,onClose:()=>f(null),children:[i.jsx(fr,{children:"Delete Backup"}),i.jsx(hr,{children:i.jsx(B,{children:"Are you sure you want to delete this backup? This action cannot be undone."})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:()=>f(null),children:"Cancel"}),i.jsx(xe,{onClick:()=>d&&w(d),color:"error",variant:"contained",children:"Delete"})]})]}),i.jsxs(dr,{open:!!h,onClose:()=>p(null),maxWidth:"sm",fullWidth:!0,children:[i.jsx(fr,{children:i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[i.jsx(E8,{color:"warning"}),"Restore Backup"]})}),i.jsxs(hr,{children:[i.jsx(Pt,{severity:"warning",sx:{mb:2},children:i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"Warning:"})," This will overwrite your current data with the backup from"," ",h?T(h.timestamp):"","."]})}),i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Backup components:"}),i.jsxs(Z,{sx:{display:"flex",gap:1,mb:2},children:[h?.components.database&&i.jsx(ot,{label:"Database",size:"small",color:"primary"}),h?.components.uploads&&i.jsx(ot,{label:"Uploads",size:"small",color:"secondary"}),h?.components.config&&i.jsx(ot,{label:"Config",size:"small",color:"default"})]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Make sure you have a backup of your current data before proceeding."})]}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:()=>p(null),children:"Cancel"}),i.jsx(xe,{onClick:()=>h&&A(h),color:"warning",variant:"contained",disabled:c===h?.manifest,startIcon:c===h?.manifest?i.jsx(er,{size:20}):i.jsx(a5,{}),children:c===h?.manifest?"Restoring...":"Restore"})]})]}),i.jsx($fe,{open:v,onClose:()=>m(!1),onSettingsSaved:y})]})},Ufe=()=>{const{user:e}=Jn(),[t,r]=x.useState([]),[n,a]=x.useState([]),[o,s]=x.useState([]),[l,c]=x.useState(""),[u,d]=x.useState(!0),[f,h]=x.useState(!1),[p,v]=x.useState(null),[m,y]=x.useState(!1),[b,_]=x.useState({name:"",email:"",phone_number:""}),[w,A]=x.useState(null),[P,E]=x.useState(!1),[T,S]=x.useState(null),I=x.useRef(null),U=(k,$)=>k?.response?.data?.message||k?.response?.data?.error||k?.message||$,O=k=>{I.current&&window.clearTimeout(I.current),S(k),I.current=window.setTimeout(()=>{S(null),I.current=null},2500)};x.useEffect(()=>()=>{I.current&&window.clearTimeout(I.current)},[]),x.useEffect(()=>{M()},[]),x.useEffect(()=>{l?L():a([])},[l]),x.useEffect(()=>{const k=setInterval(()=>{a($=>$.map(X=>{if(!X.clock_out){const C=new Date,N=new Date(X.clock_in),H=(C.getTime()-N.getTime())/(1e3*60*60);return{...X,duration:H}}return X})),s($=>$.map(X=>{if(!X.clock_out){const C=new Date,N=new Date(X.clock_in),H=(C.getTime()-N.getTime())/(1e3*60*60);return{...X,duration:H}}return X}))},1e3);return()=>clearInterval(k)},[]);const M=async()=>{try{d(!0);const k=await wS();r(k),q(k),v(null)}catch(k){v("Failed to fetch data. Please try again."),console.error("Error fetching data:",k)}finally{d(!1)}},L=async()=>{if(l)try{const k=await yfe(l);a(k);const $=new Date;$.setDate($.getDate()-1);const X=k.find(C=>!C.clock_out&&new Date(C.clock_in).toDateString()!==new Date().toDateString());E(!!X)}catch(k){v("Failed to fetch shifts. Please try again."),console.error("Error fetching shifts:",k)}},q=async k=>{const $=k||t;if(!$.length){s([]);return}try{h(!0);const X=[];await Promise.all($.map(async C=>{try{const N=await Sfe(C.id);N&&X.push({...N,profile_name:C.name})}catch(N){console.error(`Failed to fetch active shift for profile ${C.id}`,N)}})),s(X)}catch(X){console.error("Error fetching active shifts:",X)}finally{h(!1)}},z=async()=>{if(!l){v("Please select a profile");return}if(n.some(k=>!k.clock_out)){v("You are already clocked in. Please clock out first.");return}try{S(null);const k=await xfe(l);a([k,...n]),v(null),c(""),a([]),O("Successfully clocked in."),q()}catch(k){S(null),v(U(k,"Failed to clock in. Please try again.")),console.error("Error clocking in:",k)}},K=async k=>{try{S(null);const $=await bfe(k);a(n.map(X=>X.id===k?$:X)),v(null),c(""),a([]),O("Successfully clocked out."),q()}catch($){S(null),v(U($,"Failed to clock out. Please try again.")),console.error("Error clocking out:",$)}},J=async()=>{if(!b.name||!b.email){v("Name and email are required");return}try{let k;w?(k=await Zde(w,b.name,b.email,b.phone_number||void 0),r($=>$.map(X=>X.id===w?k:X)),me.success("Profile updated")):(k=await Jde(b.name,b.email,b.phone_number||void 0),r([...t,k]),me.success("Profile created")),y(!1),_({name:"",email:"",phone_number:""}),A(null),v(null)}catch(k){v("Failed to save profile. Please try again."),console.error("Error saving profile:",k)}},R=l&&n.some(k=>k.profile_id===l&&!k.clock_out);return u?i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:i.jsx(er,{})}):i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Attendance (Shift Tracking)"}),p&&i.jsx(Pt,{severity:"error",variant:"filled",sx:{mb:2,fontSize:"1.1rem",fontWeight:700,py:2},children:p}),P&&i.jsx(Pt,{severity:"warning",sx:{mb:2},children:"You have an unclosed shift from a previous day. Please clock out before starting a new shift."}),i.jsxs(dr,{open:!!T,onClose:()=>S(null),PaperProps:{sx:{px:6,py:4,textAlign:"center"}},children:[i.jsx(fr,{sx:{fontSize:"2rem"},children:"Success"}),i.jsx(hr,{children:i.jsx(B,{variant:"h4",component:"p",children:T})})]}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(bt,{sx:{p:2},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[i.jsx(B,{variant:"h6",children:"Profile"}),e?.access_role!=="Time Tracking"&&i.jsx(xe,{startIcon:i.jsx(Tv,{}),onClick:()=>{A(null),_({name:"",email:"",phone_number:""}),y(!0)},children:"Add Profile"})]}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Select Profile"}),i.jsx(ln,{value:l,label:"Select Profile",onChange:k=>c(k.target.value),sx:{"& .MuiSelect-select":{fontSize:"1.25rem",py:1.5,minHeight:56}},MenuProps:{PaperProps:{sx:{"& .MuiMenuItem-root":{fontSize:"1.25rem",py:1.5,minHeight:56},"& .MuiMenuItem-root.Mui-selected, & .MuiMenuItem-root.Mui-selected:hover":{backgroundColor:"rgba(25, 118, 210, 0.2)",color:"primary.main",fontWeight:700},"& .MuiMenuItem-root:hover":{backgroundColor:"rgba(25, 118, 210, 0.15)"}}}},renderValue:k=>{const $=t.find(X=>X.id===k);return $?$.name:""},children:t.map(k=>i.jsxs(Jt,{value:k.id,sx:{fontSize:"1.1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("span",{children:k.name}),e?.access_role==="Admin"&&i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(vr,{"aria-label":`Edit ${k.name}`,size:"small",edge:"end",onClick:$=>{$.preventDefault(),$.stopPropagation(),A(k.id),_({name:k.name||"",email:k.email||"",phone_number:k.phone_number||""}),y(!0)},sx:{color:"primary.main"},children:i.jsx(Tp,{fontSize:"small"})}),i.jsx(vr,{"aria-label":`Delete ${k.name}`,size:"small",edge:"end",onClick:async $=>{if($.preventDefault(),$.stopPropagation(),!!window.confirm(`Delete profile "${k.name}"? This cannot be undone.`))try{await ve.delete(`/api/time-tracking/profiles/${k.id}`),r(C=>C.filter(N=>N.id!==k.id)),l===k.id&&c(""),me.success("Profile deleted")}catch(C){const N=C?.response?.data?.error||"Failed to delete profile";me.error(N)}},sx:{color:"error.main"},children:i.jsx(Id,{fontSize:"small"})})]})]},k.id))})]})]})}),l&&!R&&i.jsx(ie,{item:!0,xs:12,children:i.jsx(bt,{sx:{p:2},children:i.jsx(Z,{display:"flex",justifyContent:"center",gap:2,children:i.jsx(xe,{variant:"contained",sx:{backgroundColor:"green",px:4,py:2,fontSize:"1.2rem",fontWeight:700,borderRadius:"12px",minWidth:220,"&:hover":{backgroundColor:"darkgreen"}},onClick:z,children:"Clock In"})})})}),l&&i.jsx(ie,{item:!0,xs:12,children:i.jsxs(bt,{sx:{p:2},children:[i.jsx(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:i.jsxs(B,{variant:"h6",gutterBottom:!0,children:["Shift History for ",t.find(k=>k.id===l)?.name]})}),i.jsx(ma,{children:i.jsxs(ia,{children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Clock In"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Clock Out"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Duration"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Actions"})]})}),i.jsx(sa,{children:n.map(k=>{const $=new Date(k.clock_in),X=k.clock_out?new Date(k.clock_out):null,C=k.duration!==null&&k.duration!==void 0?Number(k.duration):null;return i.jsxs(mr,{children:[i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:$.toLocaleString()}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:X?X.toLocaleString():"-"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:C!==null?`${C.toFixed(2)} hrs`:"-"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:!k.clock_out&&i.jsx(xe,{variant:"contained",sx:{backgroundColor:"red",px:3,py:1.5,fontSize:"1.1rem",fontWeight:700,borderRadius:"12px","&:hover":{backgroundColor:"darkred"}},onClick:()=>K(k.id),children:"Clock Out"})})]},k.id)})})]})})]})}),i.jsx(ie,{item:!0,xs:12,children:i.jsxs(bt,{sx:{p:2},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[i.jsx(B,{variant:"h6",children:"Active Clock Ins"}),f&&i.jsx(er,{size:24})]}),o.length===0&&!f?i.jsx(B,{color:"text.secondary",children:"No active clock ins."}):i.jsx(ma,{children:i.jsxs(ia,{children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Profile"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Clock In"}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:"Duration"})]})}),i.jsx(sa,{children:o.map(k=>{const $=k.duration!==null&&k.duration!==void 0?Number(k.duration):null;return i.jsxs(mr,{children:[i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:k.profile_name}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:new Date(k.clock_in).toLocaleString()}),i.jsx(Oe,{sx:{fontSize:"1.1rem"},children:$!==null?`${$.toFixed(2)} hrs`:"-"})]},k.id)})})]})})]})})]}),i.jsxs(dr,{open:m,onClose:()=>y(!1),children:[i.jsx(fr,{children:w?"Edit Profile":"Add Profile"}),i.jsxs(hr,{children:[i.jsx(Pe,{label:"Name",value:b.name,onChange:k=>_({...b,name:k.target.value}),fullWidth:!0,sx:{mb:2}}),i.jsx(Pe,{label:"Email",value:b.email,onChange:k=>_({...b,email:k.target.value}),fullWidth:!0,sx:{mb:2}}),i.jsx(Pe,{label:"Phone Number",value:b.phone_number,onChange:k=>_({...b,phone_number:k.target.value}),fullWidth:!0})]}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:()=>y(!1),children:"Cancel"}),i.jsx(xe,{onClick:J,variant:"contained",children:"Save"})]})]})]})};var fh={},KT;function zfe(){if(KT)return fh;KT=1;var e=ir();Object.defineProperty(fh,"__esModule",{value:!0}),fh.default=void 0;var t=e(sr()),r=or();return fh.default=(0,t.default)((0,r.jsx)("path",{d:"M4 10h3v7H4zm6.5 0h3v7h-3zM2 19h20v3H2zm15-9h3v7h-3zm-5-9L2 6v2h20V6z"}),"AccountBalance"),fh}var Wfe=zfe();const Hw=Et(Wfe),Hfe=()=>{const e=kn(),[t,r]=x.useState(!0),[n,a]=x.useState(!1),[o,s]=x.useState([]),[l,c]=x.useState({}),[u,d]=x.useState(null),[f,h]=x.useState(null),[p,v]=x.useState(""),[m,y]=x.useState(""),[b,_]=x.useState(""),[w,A]=x.useState(""),[P,E]=x.useState(""),[T,S]=x.useState(""),[I,U]=x.useState(""),[O,M]=x.useState(""),[L,q]=x.useState(""),[z,K]=x.useState(""),[J,R]=x.useState(""),[k,$]=x.useState(""),[X,C]=x.useState(!1),[N,H]=x.useState(""),[W,ne]=x.useState("");x.useEffect(()=>{oe()},[]);const se=()=>{const ee=`${Wu().baseURL}/api/qbo/auth`;window.location.href=ee},oe=async()=>{r(!0);try{const G=await ve.get("/api/qbo-accounts/test-connection");if(h(G.data),G.data.connected){const ee=await ve.get("/api/qbo-accounts/accounts");s(ee.data.accounts),c(ee.data.accountTypes);const le=await ve.get("/api/qbo-accounts/mapping");le.data.mapping&&(d(le.data.mapping),v(le.data.mapping.qbo_inventory_account_id),y(le.data.mapping.qbo_gst_account_id),_(le.data.mapping.qbo_ap_account_id),A(le.data.mapping.qbo_supply_expense_account_id||""),E(le.data.mapping.qbo_sales_account_id||""),S(le.data.mapping.qbo_labour_sales_account_id||""),U(le.data.mapping.qbo_ar_account_id||""),M(le.data.mapping.qbo_cogs_account_id||""),q(le.data.mapping.qbo_cost_of_labour_account_id||""),K(le.data.mapping.qbo_cost_of_materials_account_id||""),R(le.data.mapping.qbo_labour_expense_reduction_account_id||""),$(le.data.mapping.qbo_overhead_cogs_account_id||""))}}catch(G){console.error("Error loading QBO data:",G),me.error("Failed to load QuickBooks data")}finally{r(!1)}},ae=async()=>{if(!p||!m||!b){me.error("Please select all required accounts");return}a(!0);try{const G=await ve.post("/api/qbo-accounts/mapping",{qbo_inventory_account_id:p,qbo_gst_account_id:m,qbo_ap_account_id:b,qbo_supply_expense_account_id:w,qbo_sales_account_id:P,qbo_labour_sales_account_id:T,qbo_ar_account_id:I,qbo_cogs_account_id:O,qbo_cost_of_labour_account_id:L,qbo_cost_of_materials_account_id:z,qbo_labour_expense_reduction_account_id:J,qbo_overhead_cogs_account_id:k});d(G.data.mapping),me.success("Account mapping saved successfully")}catch(G){console.error("Error saving mapping:",G),me.error("Failed to save account mapping")}finally{a(!1)}},pe=G=>{const ee=G.AccountNumber?`#${G.AccountNumber}`:"";return`${G.Name} ${ee} (${G.AccountType})`},ge=G=>{let ee=o.filter(le=>le.Classification===G);if(W){const le=W.toLowerCase();ee=ee.filter(V=>V.Name.toLowerCase().includes(le)||V.AccountNumber&&V.AccountNumber.includes(le)||V.Description&&V.Description.toLowerCase().includes(le))}return ee},Q=()=>i.jsxs(dr,{open:X,onClose:()=>C(!1),maxWidth:"md",fullWidth:!0,children:[i.jsxs(fr,{children:["QuickBooks Accounts - ",N]}),i.jsx(hr,{children:i.jsx(Z,{sx:{mt:2},children:l[N]?.map(G=>i.jsx(Rr,{sx:{mb:1,p:2},children:i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"h6",children:G.Name}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Type: ",G.AccountType," | Subtype: ",G.AccountSubType]}),G.AccountNumber&&i.jsxs(B,{variant:"body2",color:"primary",fontWeight:500,children:["Account #: ",G.AccountNumber]}),G.Description&&i.jsx(B,{variant:"body2",color:"text.secondary",children:G.Description})]}),i.jsx(ot,{label:G.AccountNumber||"No Number",size:"small",color:G.AccountNumber?"primary":"default",variant:"outlined"})]})},G.Id))})}),i.jsx(_r,{children:i.jsx(xe,{onClick:()=>C(!1),children:"Close"})})]});return t?i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:i.jsx(er,{})}):i.jsxs(rr,{maxWidth:"lg",sx:{py:4},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(xe,{startIcon:i.jsx(Hp,{}),onClick:()=>e("/business-profile"),sx:{mr:2},children:"Back"}),i.jsx(B,{variant:"h4",component:"h1",children:"QuickBooks Account Mapping"})]}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Hw,{}),onClick:se,sx:{borderRadius:2,fontWeight:600},children:"Connect to QuickBooks"})]}),f&&i.jsx(Rr,{sx:{mb:3},children:i.jsxs(Hr,{children:[i.jsxs(Z,{display:"flex",alignItems:"center",gap:2,children:[f.connected?i.jsx(nc,{color:"success"}):i.jsx(qy,{color:"error"}),i.jsx(B,{variant:"h6",children:f.connected?"Connected to QuickBooks":"Not Connected"})]}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mt:1},children:f.message}),f.connected&&f.realmId&&i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Realm ID: ",f.realmId]})]})}),f?.connected?i.jsxs(i.Fragment,{children:[i.jsx(ie,{container:!0,spacing:3,sx:{mb:3},children:Object.entries(l).map(([G,ee])=>i.jsx(ie,{item:!0,xs:12,sm:6,md:4,children:i.jsx(Rr,{children:i.jsxs(Hr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:G}),i.jsx(B,{variant:"h4",color:"primary",children:ee.length}),i.jsx(xe,{size:"small",onClick:()=>{H(G),C(!0)},sx:{mt:1},children:"View Accounts"})]})})},G))}),i.jsxs(bt,{sx:{p:3},children:[i.jsx(B,{variant:"h5",gutterBottom:!0,children:"Map QuickBooks Accounts"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Select the QuickBooks accounts that correspond to your business accounts. Different companies use different account names, so choose the accounts that make sense for your business."}),i.jsxs(Pt,{severity:"info",sx:{mb:3},children:[i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"How this works:"})," Configure your QuickBooks accounts to map to your business transactions. Accounts used by both purchase orders and sales orders are shown at the top."]}),i.jsxs(B,{variant:"body2",sx:{mt:1},children:[i.jsx("strong",{children:"Purchase Orders:"})," Stock items  Inventory Account, Supply items  Supply Expense Account, GST  GST Account, Total  Accounts Payable."]}),i.jsxs(B,{variant:"body2",sx:{mt:1},children:[i.jsx("strong",{children:"Sales Orders:"})," Materials  Sales Account, Labour  Labour Sales Account, GST  GST Account, Total  Accounts Receivable, Costs  COGS Account."]})]}),i.jsx(Z,{sx:{mb:3},children:i.jsx(Pe,{fullWidth:!0,label:"Search accounts by name, number, or description",value:W,onChange:G=>ne(G.target.value),placeholder:"e.g., 1200, Inventory, GST...",size:"small",InputProps:{startAdornment:i.jsx(di,{sx:{mr:1,color:"text.secondary"}})}})}),i.jsx(B,{variant:"h6",sx:{mt:4,mb:2,color:"primary.main"},children:"Shared Accounts (Purchase Orders & Sales Orders)"}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"GST/Tax Account"}),i.jsx(ln,{value:m,onChange:G=>y(G.target.value),label:"GST/Tax Account",children:ge("Liability").map(G=>i.jsx(Jt,{value:G.Id,children:pe(G)},G.Id))})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Account for GST/HST/tax tracking (used by both purchase orders and sales orders)"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Inventory Account"}),i.jsx(ln,{value:p,onChange:G=>v(G.target.value),label:"Inventory Account",children:ge("Asset").map(G=>i.jsx(Jt,{value:G.Id,children:pe(G)},G.Id))})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Account for tracking inventory (stock purchases and sales cost reduction)"})]})]}),i.jsx(B,{variant:"h6",sx:{mt:4,mb:2},children:"Purchase Order Account Mapping"}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Supply Expense Account"}),i.jsxs(ln,{value:w,onChange:G=>A(G.target.value),label:"Supply Expense Account",children:[i.jsx(Jt,{value:"",children:i.jsx("em",{children:"Optional - Select an expense account"})}),ge("Expense").map(G=>i.jsx(Jt,{value:G.Id,children:pe(G)},G.Id))]})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Account for supply items (e.g., Office Supplies, Tools, etc.) - Optional"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Accounts Payable"}),i.jsx(ln,{value:b,onChange:G=>_(G.target.value),label:"Accounts Payable",children:ge("Liability").map(G=>i.jsx(Jt,{value:G.Id,children:pe(G)},G.Id))})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:'Account for tracking vendor payables (usually "Accounts Payable")'})]})]}),i.jsx(B,{variant:"h6",sx:{mt:4,mb:2},children:"Sales Order Account Mapping"}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Sales Account"}),i.jsx(ln,{value:P,onChange:G=>E(G.target.value),label:"Sales Account",children:ge("Revenue").map(G=>i.jsx(Jt,{value:G.Id,children:pe(G)},G.Id))})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Revenue account for sales (e.g., Sales, Revenue, etc.) - Used for invoice creation"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Accounts Receivable"}),i.jsx(ln,{value:I,onChange:G=>U(G.target.value),label:"Accounts Receivable",children:ge("Asset").map(G=>i.jsx(Jt,{value:G.Id,children:pe(G)},G.Id))})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:'Account for tracking customer receivables (usually "Accounts Receivable") - Used for invoice total amount'})]})]}),i.jsx(B,{variant:"h6",sx:{mt:4,mb:2},children:"Cost Accounts (Journal Entries)"}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Cost of Materials"}),i.jsxs(ln,{value:z,onChange:G=>K(G.target.value),label:"Cost of Materials",children:[i.jsx(Jt,{value:"",children:i.jsx("em",{children:"Optional - Select an expense account"})}),ge("Expense").map(G=>i.jsx(Jt,{value:G.Id,children:pe(G)},G.Id))]})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Expense account for tracking cost of materials sold - Used for COGS journal entries - Optional"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Cost of Labour"}),i.jsxs(ln,{value:L,onChange:G=>q(G.target.value),label:"Cost of Labour",children:[i.jsx(Jt,{value:"",children:i.jsx("em",{children:"Optional - Select an expense account"})}),ge("Expense").map(G=>i.jsx(Jt,{value:G.Id,children:pe(G)},G.Id))]})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Expense account for tracking cost of labour sold - Used for COGS journal entries - Optional"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Labour Expense Reduction Account"}),i.jsxs(ln,{value:J,onChange:G=>R(G.target.value),label:"Labour Expense Reduction Account",children:[i.jsx(Jt,{value:"",children:i.jsx("em",{children:"Optional - Select an expense account"})}),ge("Expense").map(G=>i.jsx(Jt,{value:G.Id,children:pe(G)},G.Id))]})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Expense account for reducing labour costs when sold (e.g., Labour Expense, Wages Expense) - Used for COGS journal entries - Optional"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Overhead COGS Account"}),i.jsxs(ln,{value:k,onChange:G=>$(G.target.value),label:"Overhead COGS Account",children:[i.jsx(Jt,{value:"",children:i.jsx("em",{children:"Optional - Select an expense account"})}),ge("Expense").map(G=>i.jsx(Jt,{value:G.Id,children:pe(G)},G.Id))]})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Expense account for tracking overhead costs when sold - Used for COGS journal entries - Optional"})]})]}),i.jsx(Z,{sx:{mt:3,display:"flex",justifyContent:"center"},children:i.jsx(xe,{variant:"outlined",onClick:()=>e("/overhead-management"),sx:{width:"100%",maxWidth:"600px",borderRadius:2,fontWeight:600,py:1.5,fontSize:"1.1rem"},children:"Manage Overhead Settings"})}),i.jsxs(Z,{sx:{mt:3,display:"flex",gap:2},children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:ae,disabled:n||!p||!m||!b,children:n?"Saving...":"Save Mapping"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Ts,{}),onClick:oe,disabled:t,children:"Refresh"})]}),u&&i.jsxs(Z,{sx:{mt:3,p:2,bgcolor:"grey.50",borderRadius:1},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Current Mapping"}),i.jsx(B,{variant:"subtitle2",color:"primary",sx:{mt:2,mb:1},children:"Shared Accounts (Purchase Orders & Sales Orders)"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["GST/Tax: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_gst_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Inventory: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_inventory_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})})]}),i.jsx(B,{variant:"subtitle2",color:"primary",sx:{mt:2,mb:1},children:"Purchase Order Accounts"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Supply Expense: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_supply_expense_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Accounts Payable: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_ap_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})})]}),i.jsx(B,{variant:"subtitle2",color:"primary",sx:{mt:2,mb:1},children:"Sales Order Accounts"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Sales: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_sales_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Accounts Receivable: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_ar_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})})]}),i.jsx(B,{variant:"subtitle2",color:"primary",sx:{mt:2,mb:1},children:"Cost Accounts"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Cost of Materials: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_cost_of_materials_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Cost of Labour: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_cost_of_labour_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Labour Expense Reduction: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_labour_expense_reduction_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Overhead COGS: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_overhead_cogs_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})})]})]})]})]}):i.jsx(Pt,{severity:"warning",sx:{mb:3},children:"Please connect your QuickBooks account first in the Business Profile page."}),Q()]})},Vfe=()=>{const e=kn(),[t,r]=x.useState(!0),[n,a]=x.useState(!1),[o,s]=x.useState([]),[l,c]=x.useState({}),[u,d]=x.useState([]),[f,h]=x.useState(null),[p,v]=x.useState(!1),[m,y]=x.useState(""),[b,_]=x.useState(""),[w,A]=x.useState(!1),[P,E]=x.useState(null),[T,S]=x.useState({expense_account_id:"",percentage:"",description:""});x.useEffect(()=>{I()},[]);const I=async()=>{r(!0);try{const[R,k]=await Promise.all([ve.get("/api/qbo-accounts/accounts"),ve.get("/api/overhead/distribution")]);s(R.data.accounts||[]),c(R.data.accountTypes||{}),d(k.data||[]),h({connected:!0,message:"Connected to QuickBooks"})}catch(R){console.error("Error loading data:",R),h({connected:!1,message:R.response?.data?.error||"Failed to connect to QuickBooks"}),me.error("Failed to load overhead management data")}finally{r(!1)}},U=async()=>{if(!T.expense_account_id||!T.percentage){me.error("Please fill in all required fields");return}const R=parseFloat(T.percentage);if(isNaN(R)||R<=0||R>100){me.error("Percentage must be between 0 and 100");return}const k=u.filter($=>$.id!==P?.id).reduce(($,X)=>$+X.percentage,0);if(k+R>100){me.error(`Total percentage would exceed 100%. Current total: ${k}%, adding: ${R}%`);return}a(!0);try{P?(await ve.put(`/api/overhead/distribution/${P.id}`,{expense_account_id:T.expense_account_id,percentage:R,description:T.description}),me.success("Distribution updated successfully")):(await ve.post("/api/overhead/distribution",{expense_account_id:T.expense_account_id,percentage:R,description:T.description}),me.success("Distribution added successfully")),A(!1),E(null),S({expense_account_id:"",percentage:"",description:""}),I()}catch($){console.error("Error saving distribution:",$),me.error($.response?.data?.error||"Failed to save distribution")}finally{a(!1)}},O=R=>{E(R),S({expense_account_id:R.expense_account_id,percentage:R.percentage.toString(),description:R.description}),A(!0)},M=async R=>{if(window.confirm("Are you sure you want to delete this distribution?"))try{await ve.delete(`/api/overhead/distribution/${R}`),me.success("Distribution deleted successfully"),I()}catch(k){console.error("Error deleting distribution:",k),me.error(k.response?.data?.error||"Failed to delete distribution")}},L=()=>{E(null),S({expense_account_id:"",percentage:"",description:""}),A(!0)},q=R=>`${R.Name} (${R.AccountType})`,z=R=>(l[R]||[]).filter(k=>k.Classification===R).map(k=>({label:q(k),value:k.Id,account:k})),K=()=>i.jsxs(dr,{open:p,onClose:()=>v(!1),maxWidth:"md",fullWidth:!0,children:[i.jsx(fr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(Hw,{}),"QuickBooks Accounts"]})}),i.jsxs(hr,{children:[i.jsx(Z,{mb:2,children:i.jsx(Pe,{fullWidth:!0,label:"Search accounts",value:b,onChange:R=>_(R.target.value),InputProps:{startAdornment:i.jsx(di,{})}})}),i.jsxs(tn,{fullWidth:!0,sx:{mb:2},children:[i.jsx(sn,{children:"Account Type"}),i.jsxs(ln,{value:m,onChange:R=>y(R.target.value),label:"Account Type",children:[i.jsx(Jt,{value:"",children:"All Types"}),i.jsx(Jt,{value:"Asset",children:"Asset"}),i.jsx(Jt,{value:"Liability",children:"Liability"}),i.jsx(Jt,{value:"Equity",children:"Equity"}),i.jsx(Jt,{value:"Revenue",children:"Revenue"}),i.jsx(Jt,{value:"Expense",children:"Expense"})]})]}),i.jsx(Z,{maxHeight:400,overflow:"auto",children:Object.entries(l).map(([R,k])=>{if(m&&R!==m)return null;const $=k.filter(X=>X.Name.toLowerCase().includes(b.toLowerCase())||X.AccountType.toLowerCase().includes(b.toLowerCase()));return $.length===0?null:i.jsxs(Z,{mb:3,children:[i.jsxs(B,{variant:"h6",gutterBottom:!0,children:[R," Accounts (",$.length,")"]}),i.jsx(ie,{container:!0,spacing:1,children:$.map(X=>i.jsx(ie,{item:!0,xs:12,sm:6,md:4,children:i.jsxs(Rr,{variant:"outlined",sx:{p:1},children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:X.Name}),i.jsx(B,{variant:"caption",color:"textSecondary",children:X.AccountType}),X.AccountNumber&&i.jsxs(B,{variant:"caption",display:"block",color:"textSecondary",children:["#",X.AccountNumber]})]})},X.Id))})]},R)})})]}),i.jsx(_r,{children:i.jsx(xe,{onClick:()=>v(!1),children:"Close"})})]}),J=u.reduce((R,k)=>R+k.percentage,0);return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(vr,{onClick:()=>e(-1),children:i.jsx(Hp,{})}),i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Overhead Management"})]}),i.jsxs(ut,{direction:"row",spacing:2,children:[i.jsx(xe,{variant:"outlined",onClick:()=>v(!0),startIcon:i.jsx(Hw,{}),children:"View QBO Accounts"}),i.jsx(xe,{variant:"contained",onClick:L,startIcon:i.jsx(Va,{}),children:"Add Distribution"}),i.jsx(xe,{variant:"outlined",onClick:I,startIcon:i.jsx(Ts,{}),children:"Refresh"})]})]}),f&&i.jsx(Pt,{severity:f.connected?"success":"error",icon:f.connected?i.jsx(nc,{}):i.jsx(qy,{}),sx:{mb:3},children:f.message}),i.jsxs(bt,{sx:{p:3,mb:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Distribution Summary"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Rr,{children:i.jsxs(Hr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Total Distributions"}),i.jsx(B,{variant:"h4",children:u.length})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Rr,{children:i.jsxs(Hr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Total Percentage"}),i.jsxs(B,{variant:"h4",color:J===100?"success.main":"warning.main",children:[J.toFixed(1),"%"]})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Rr,{children:i.jsxs(Hr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Remaining"}),i.jsxs(B,{variant:"h4",color:J>100?"error.main":"text.primary",children:[(100-J).toFixed(1),"%"]})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Rr,{children:i.jsxs(Hr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Status"}),i.jsx(ot,{label:J===100?"Complete":J>100?"Over 100%":"Incomplete",color:J===100?"success":J>100?"error":"warning"})]})})})]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden"},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Expense Distributions"}),t?i.jsx(Z,{display:"flex",justifyContent:"center",p:3,children:i.jsx(er,{})}):u.length===0?i.jsx(Pt,{severity:"info",children:'No expense distributions configured. Click "Add Distribution" to get started.'}):i.jsx(ie,{container:!0,spacing:2,children:u.map(R=>{const k=o.find($=>$.Id===R.expense_account_id);return i.jsx(ie,{item:!0,xs:12,sm:6,md:4,children:i.jsx(Rr,{children:i.jsx(Hr,{children:i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[i.jsxs(Z,{flex:1,children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:R.description||k?.Name||"Unknown Account"}),i.jsxs(B,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:[k?.Name," (",k?.AccountType,")"]}),i.jsx(ot,{label:`${R.percentage}%`,color:"primary",size:"small"})]}),i.jsxs(Z,{children:[i.jsx(vr,{size:"small",onClick:()=>O(R),children:i.jsx(tu,{})}),i.jsx(vr,{size:"small",color:"error",onClick:()=>M(R.id),children:i.jsx(ga,{})})]})]})})})},R.id)})})]})}),i.jsxs(dr,{open:w,onClose:()=>A(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(fr,{children:P?"Edit Distribution":"Add Distribution"}),i.jsx(hr,{children:i.jsxs(ut,{spacing:3,sx:{mt:1},children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Expense Account"}),i.jsx(ln,{value:T.expense_account_id,onChange:R=>S(k=>({...k,expense_account_id:R.target.value})),label:"Expense Account",children:z("Expense").map(R=>i.jsx(Jt,{value:R.value,children:R.label},R.value))})]}),i.jsx(Pe,{label:"Percentage",type:"number",value:T.percentage,onChange:R=>S(k=>({...k,percentage:R.target.value})),inputProps:{min:0,max:100,step:.01},helperText:`Current total: ${J}%${P?` (excluding this item: ${(J-P.percentage).toFixed(1)}%)`:""}`}),i.jsx(Pe,{label:"Description (Optional)",value:T.description,onChange:R=>S(k=>({...k,description:R.target.value})),helperText:"A description to help identify this distribution"})]})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:()=>A(!1),children:"Cancel"}),i.jsx(xe,{onClick:U,variant:"contained",disabled:n||!T.expense_account_id||!T.percentage,startIcon:n?i.jsx(er,{size:20}):i.jsx(Is,{}),children:n?"Saving...":"Save"})]})]}),K()]})},Gfe=()=>{const[e,t]=x.useState(!1),[r,n]=x.useState(!1),[a,o]=x.useState([]),[s,l]=x.useState(new Set),[c,u]=x.useState(new Set),[d,f]=x.useState(!1),[h,p]=x.useState([]),[v,m]=x.useState([]),y=kn();x.useEffect(()=>{b();const O=()=>{console.log(" Parts to order update event received, refreshing data..."),b()};return window.addEventListener("parts-to-order-updated",O),()=>{window.removeEventListener("parts-to-order-updated",O)}},[]);const b=async()=>{t(!0);try{const[O,M]=await Promise.all([ve.get("/api/sales-orders/parts-to-order/all"),ve.get("/api/inventory")]),{individualParts:L,aggregatedParts:q}=O.data,z=M.data||[];m(z);const K=J=>{const R=$=>($||"").replace(/[\-\s"]/g,"").toUpperCase(),k=new Map(z.map($=>[R(String($.part_number)),$]));return J.map($=>{const X=k.get(R($.part_number));if(!X)return $;const C=X.unit||$.unit,N=X.part_description||$.part_description,H=Number(X.last_unit_cost)||Number($.unit_price)||0,W=H*(Number($.total_quantity_needed)||0);return{...$,unit:C,part_description:N,unit_price:H,total_line_amount:W,sales_orders:($.sales_orders||[]).map(ne=>{const se=Number(X.last_unit_cost)||Number(ne.unit_price)||0,oe=se*(Number(ne.quantity_needed)||0);return{...ne,unit:X.unit||ne.unit,unit_price:se,line_amount:oe}})}})};if(q&&q.length>0)o(K(q));else{const J=_(L);o(K(J))}}catch(O){console.error("Error fetching parts to order:",O),me.error("Failed to load parts to order data")}finally{t(!1)}},_=O=>{const M={};return O.forEach(L=>{M[L.part_number]||(M[L.part_number]={part_number:L.part_number,part_description:L.part_description,total_quantity_needed:0,unit:L.unit,unit_price:L.unit_price,total_line_amount:0,sales_orders:[]}),M[L.part_number].total_quantity_needed+=L.quantity_needed,M[L.part_number].total_line_amount+=L.line_amount,M[L.part_number].sales_orders.push(L)}),Object.values(M)},w=O=>{const M=new Set(s);M.has(O)?M.delete(O):M.add(O),l(M)},A=()=>{b()},P=O=>{u(M=>{const L=new Set(M);return L.has(O)?L.delete(O):L.add(O),L})},E=()=>{c.size===a.length?u(new Set):u(new Set(a.map(O=>O.part_number)))},T=()=>{if(c.size===0){me.warning("Please select at least one part to create a purchase order");return}const O=a.filter(M=>c.has(M.part_number));p(O),f(!0)},S=()=>{f(!1),p([])},I=async()=>{if(h.length===0){me.warning("No parts selected for purchase order");return}n(!0);try{const O=await ve.post("/api/purchase-orders/auto-create-from-parts-to-order",{parts:h});if(O.data.success)if(me.success(`Purchase order created successfully! PO Number: ${O.data.purchase_order_number}`),O.data.purchase_orders&&O.data.purchase_orders.length===1){const M=O.data.purchase_orders[0].purchase_id;S(),u(new Set),y(`/open-purchase-orders/${M}`)}else S(),u(new Set),b();else me.error(O.data.message||"Failed to create purchase order")}catch(O){console.error("Error creating purchase order:",O),me.error(O.response?.data?.error||"Failed to create purchase order")}finally{n(!1)}},U=async O=>{let M=a;if(O){const L=a.find(q=>q.part_number===O);if(!L){me.warning(`Part ${O} not found for purchase order creation.`);return}M=[L]}if(M.length===0){me.warning("No parts to order");return}n(!0);try{const L=await ve.post("/api/purchase-orders/auto-create-from-parts-to-order",{parts:M});if(L.data.success)if(me.success(`Purchase order created successfully! PO Number: ${L.data.purchase_order_number}`),L.data.purchase_orders&&L.data.purchase_orders.length===1){const q=L.data.purchase_orders[0].purchase_id;y(`/open-purchase-orders/${q}`)}else b();else me.error(L.data.message||"Failed to create purchase order")}catch(L){console.error("Error creating purchase order:",L),me.error(L.response?.data?.error||"Failed to create purchase order")}finally{n(!1)}};return e?i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:i.jsx(er,{})}):i.jsxs(Z,{p:3,children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsx(B,{variant:"h3",component:"h1",children:"Parts to Order"}),i.jsxs(Z,{display:"flex",gap:2,children:[c.size>0&&i.jsxs(xe,{variant:"contained",color:"primary",startIcon:i.jsx(T8,{}),onClick:T,disabled:r,children:["Create PO (",c.size,")"]}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Kw,{}),onClick:A,children:"Refresh"})]})]}),a.length===0?i.jsx(Pt,{severity:"info",children:"No parts currently need to be ordered."}):i.jsx(ma,{component:bt,children:i.jsxs(ia,{size:"medium",children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{padding:"checkbox",children:i.jsx(Xi,{indeterminate:c.size>0&&c.size<a.length,checked:a.length>0&&c.size===a.length,onChange:E})}),i.jsx(Oe,{children:i.jsx(B,{variant:"h6",fontWeight:"bold"})}),i.jsx(Oe,{children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Part Number"})}),i.jsx(Oe,{children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Description"})}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Quantity to Order"})}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Unit"})}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Unit Price"})}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Total Amount"})}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Actions"})})]})}),i.jsx(sa,{children:a.map(O=>i.jsxs(Ae.Fragment,{children:[i.jsxs(mr,{children:[i.jsx(Oe,{padding:"checkbox",children:i.jsx(Xi,{checked:c.has(O.part_number),onChange:()=>P(O.part_number)})}),i.jsx(Oe,{children:i.jsx(vr,{size:"small",onClick:()=>w(O.part_number),children:s.has(O.part_number)?i.jsx(I8,{}):i.jsx(EI,{})})}),i.jsx(Oe,{children:i.jsx(B,{variant:"body1",fontWeight:"medium",fontSize:"1.1rem",children:O.part_number})}),i.jsx(Oe,{children:i.jsx(B,{variant:"body1",fontSize:"1.1rem",children:O.part_description})}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"body1",fontWeight:"medium",fontSize:"1.1rem",children:Number(O.total_quantity_needed)||0})}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"body1",fontSize:"1.1rem",children:O.unit})}),i.jsx(Oe,{align:"center",children:i.jsxs(B,{variant:"body1",fontSize:"1.1rem",children:["$",(Number(O.unit_price)||0).toFixed(2)]})}),i.jsx(Oe,{align:"center",children:i.jsxs(B,{variant:"body1",fontSize:"1.1rem",children:["$",(Number(O.total_line_amount)||0).toFixed(2)]})}),i.jsx(Oe,{align:"center",children:i.jsx(xe,{variant:"contained",color:"primary",size:"medium",startIcon:i.jsx(i5,{}),onClick:()=>U(O.part_number),disabled:r,children:"Create PO"})})]}),i.jsx(mr,{children:i.jsx(Oe,{style:{paddingBottom:0,paddingTop:0},colSpan:9,children:i.jsx(AI,{in:s.has(O.part_number),timeout:"auto",unmountOnExit:!0,children:i.jsxs(Z,{sx:{margin:1},children:[i.jsx(B,{variant:"h5",gutterBottom:!0,component:"div",children:"Sales Orders Requiring This Part"}),i.jsxs(ia,{size:"medium",children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{children:i.jsx(B,{variant:"subtitle1",fontWeight:"bold",children:"Sales Order"})}),i.jsx(Oe,{children:i.jsx(B,{variant:"subtitle1",fontWeight:"bold",children:"Customer"})}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"subtitle1",fontWeight:"bold",children:"Quantity to Order"})}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"subtitle1",fontWeight:"bold",children:"Unit Price"})}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"subtitle1",fontWeight:"bold",children:"Line Amount"})})]})}),i.jsx(sa,{children:O.sales_orders.map(M=>i.jsxs(mr,{children:[i.jsx(Oe,{children:i.jsx(B,{variant:"body1",fontSize:"1rem",children:M.sales_order_number})}),i.jsx(Oe,{children:i.jsx(B,{variant:"body1",fontSize:"1rem",children:M.customer_name})}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"body1",fontSize:"1rem",children:Number(M.quantity_needed)||0})}),i.jsx(Oe,{align:"center",children:i.jsxs(B,{variant:"body1",fontSize:"1rem",children:["$",(Number(M.unit_price)||0).toFixed(2)]})}),i.jsx(Oe,{align:"center",children:i.jsxs(B,{variant:"body1",fontSize:"1rem",children:["$",(Number(M.line_amount)||0).toFixed(2)]})})]},`${M.sales_order_id}-${M.part_number}`))})]})]})})})})]},O.part_number))})]})}),i.jsxs(dr,{open:d,onClose:S,maxWidth:"md",fullWidth:!0,children:[i.jsx(fr,{children:"Create Purchase Order"}),i.jsxs(hr,{children:[i.jsx(B,{variant:"body1",sx:{mb:2},children:"Selected parts for purchase order:"}),i.jsx(ma,{component:bt,variant:"outlined",children:i.jsxs(ia,{size:"small",children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{children:"Part Number"}),i.jsx(Oe,{children:"Description"}),i.jsx(Oe,{align:"center",children:"Quantity"}),i.jsx(Oe,{align:"center",children:"Unit"}),i.jsx(Oe,{align:"center",children:"Unit Price"}),i.jsx(Oe,{align:"center",children:"Total"})]})}),i.jsx(sa,{children:h.map(O=>i.jsxs(mr,{children:[i.jsx(Oe,{children:i.jsx(B,{variant:"body2",fontWeight:"medium",children:O.part_number})}),i.jsx(Oe,{children:i.jsx(B,{variant:"body2",children:O.part_description})}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"body2",children:Number(O.total_quantity_needed)||0})}),i.jsx(Oe,{align:"center",children:i.jsx(B,{variant:"body2",children:O.unit})}),i.jsx(Oe,{align:"center",children:i.jsxs(B,{variant:"body2",children:["$",(Number(O.unit_price)||0).toFixed(2)]})}),i.jsx(Oe,{align:"center",children:i.jsxs(B,{variant:"body2",fontWeight:"medium",children:["$",(Number(O.total_line_amount)||0).toFixed(2)]})})]},O.part_number))})]})}),i.jsx(Z,{sx:{mt:2,p:2,backgroundColor:"grey.50",borderRadius:1},children:i.jsxs(B,{variant:"h6",align:"right",children:["Total Amount: $",h.reduce((O,M)=>O+(Number(M.total_line_amount)||0),0).toFixed(2)]})})]}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:S,disabled:r,children:"Cancel"}),i.jsx(xe,{onClick:I,variant:"contained",color:"primary",disabled:r,startIcon:r?i.jsx(er,{size:20}):i.jsx(i5,{}),children:r?"Creating...":"Create Purchase Order"})]})]})]})},Yfe=()=>{const e=kn(),[t,r]=x.useState(!0),[n,a]=x.useState(!1),[o,s]=x.useState([]),[l,c]=x.useState([]),[u,d]=x.useState([]),[f,h]=x.useState(!1),[p,v]=x.useState(""),[m,y]=x.useState("");x.useEffect(()=>{b()},[]);const b=async()=>{r(!0);try{const[E,T,S]=await Promise.all([ve.get("/api/time-tracking/admin/available-users"),ve.get("/api/time-tracking/profiles"),ve.get("/api/time-tracking/admin/user-profile-access")]);s(E.data||[]),c(T.data||[]),d(S.data||[])}catch(E){console.error("Error loading data:",E),me.error("Failed to load mobile user access data")}finally{r(!1)}},_=async()=>{if(!p||!m){me.error("Please select both a user and a profile");return}a(!0);try{await ve.post("/api/time-tracking/admin/user-profile-access",{user_id:p,profile_id:m}),me.success("Profile access granted successfully"),h(!1),v(""),y(""),b()}catch(E){console.error("Error granting access:",E),me.error(E.response?.data?.error||"Failed to grant access")}finally{a(!1)}},w=async E=>{if(window.confirm("Are you sure you want to revoke this profile access?"))try{await ve.delete(`/api/time-tracking/admin/user-profile-access/${E}`),me.success("Profile access revoked successfully"),b()}catch(T){console.error("Error revoking access:",T),me.error(T.response?.data?.error||"Failed to revoke access")}},A=u.filter(E=>E.is_active),P=u.filter(E=>!E.is_active);return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(vr,{onClick:()=>e(-1),children:i.jsx(Hp,{})}),i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Mobile User Access Management"})]}),i.jsxs(ut,{direction:"row",spacing:2,children:[i.jsx(xe,{variant:"contained",onClick:()=>h(!0),startIcon:i.jsx(Va,{}),children:"Grant Access"}),i.jsx(xe,{variant:"outlined",onClick:b,startIcon:i.jsx(Ts,{}),children:"Refresh"})]})]}),i.jsxs(ie,{container:!0,spacing:3,sx:{mb:4},children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Rr,{children:i.jsxs(Hr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Mobile Users"}),i.jsx(B,{variant:"h4",children:o.length})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Rr,{children:i.jsxs(Hr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Available Profiles"}),i.jsx(B,{variant:"h4",children:l.length})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Rr,{children:i.jsxs(Hr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Active Access"}),i.jsx(B,{variant:"h4",color:"success.main",children:A.length})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Rr,{children:i.jsxs(Hr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Revoked Access"}),i.jsx(B,{variant:"h4",color:"text.secondary",children:P.length})]})})})]}),t?i.jsx(Z,{display:"flex",justifyContent:"center",p:3,children:i.jsx(er,{})}):i.jsxs(i.Fragment,{children:[i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Active Profile Access"}),A.length===0?i.jsx(Pt,{severity:"info",children:'No active profile access assignments. Click "Grant Access" to get started.'}):i.jsx(ma,{children:i.jsxs(ia,{children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{children:"Mobile User"}),i.jsx(Oe,{children:"Profile"}),i.jsx(Oe,{children:"Granted By"}),i.jsx(Oe,{children:"Granted At"}),i.jsx(Oe,{children:"Actions"})]})}),i.jsx(sa,{children:A.map(E=>i.jsxs(mr,{children:[i.jsx(Oe,{children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:E.user_email}),i.jsx(ot,{label:E.user_role,size:"small",color:"primary",variant:"outlined"})]})}),i.jsx(Oe,{children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:E.profile_name}),i.jsx(B,{variant:"caption",color:"textSecondary",children:E.profile_email})]})}),i.jsx(Oe,{children:i.jsx(B,{variant:"body2",children:E.granted_by_email||"System"})}),i.jsx(Oe,{children:i.jsx(B,{variant:"body2",children:new Date(E.granted_at).toLocaleDateString()})}),i.jsx(Oe,{children:i.jsx(vr,{color:"error",onClick:()=>w(E.id),title:"Revoke Access",children:i.jsx(ga,{})})})]},E.id))})]})})]})}),P.length>0&&i.jsx(bt,{sx:{width:"100%",overflow:"hidden"},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Revoked Profile Access"}),i.jsx(ma,{children:i.jsxs(ia,{children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{children:"Mobile User"}),i.jsx(Oe,{children:"Profile"}),i.jsx(Oe,{children:"Revoked At"})]})}),i.jsx(sa,{children:P.map(E=>i.jsxs(mr,{children:[i.jsx(Oe,{children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:E.user_email}),i.jsx(ot,{label:E.user_role,size:"small",color:"default",variant:"outlined"})]})}),i.jsx(Oe,{children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:E.profile_name}),i.jsx(B,{variant:"caption",color:"textSecondary",children:E.profile_email})]})}),i.jsx(Oe,{children:i.jsx(B,{variant:"body2",children:new Date(E.updated_at).toLocaleDateString()})})]},E.id))})]})})]})})]}),i.jsxs(dr,{open:f,onClose:()=>h(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(fr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(Va,{}),"Grant Profile Access"]})}),i.jsx(hr,{children:i.jsxs(ut,{spacing:3,sx:{mt:1},children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Mobile User"}),i.jsx(ln,{value:p,onChange:E=>v(Number(E.target.value)),label:"Mobile User",children:o.map(E=>i.jsx(Jt,{value:E.id,children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:E.email}),i.jsx(B,{variant:"caption",color:"textSecondary",children:E.access_role})]})},E.id))})]}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Profile"}),i.jsx(ln,{value:m,onChange:E=>y(Number(E.target.value)),label:"Profile",children:l.map(E=>i.jsx(Jt,{value:E.id,children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:E.name}),i.jsx(B,{variant:"caption",color:"textSecondary",children:E.email})]})},E.id))})]})]})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:()=>h(!1),children:"Cancel"}),i.jsx(xe,{onClick:_,variant:"contained",disabled:n||!p||!m,startIcon:n?i.jsx(er,{size:20}):i.jsx(nc,{}),children:n?"Granting...":"Grant Access"})]})]})]})};var hh={},QT;function Kfe(){if(QT)return hh;QT=1;var e=ir();Object.defineProperty(hh,"__esModule",{value:!0}),hh.default=void 0;var t=e(sr()),r=or();return hh.default=(0,t.default)((0,r.jsx)("path",{d:"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20zm-6 8h-4v-2h4zm0-4h-4v-2h4z"}),"BugReport"),hh}var Qfe=Kfe();const Xfe=Et(Qfe);var ph={},XT;function Jfe(){if(XT)return ph;XT=1;var e=ir();Object.defineProperty(ph,"__esModule",{value:!0}),ph.default=void 0;var t=e(sr()),r=or();return ph.default=(0,t.default)((0,r.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 16H8v-2h8zm0-4H8v-2h8zm-3-5V3.5L18.5 9z"}),"Description"),ph}var Zfe=Jfe();const ehe=Et(Zfe),JT=[{value:"gmail",label:"Gmail",host:"smtp.gmail.com",port:587,secure:!1},{value:"outlook",label:"Outlook/Hotmail",host:"smtp-mail.outlook.com",port:587,secure:!1},{value:"yahoo",label:"Yahoo",host:"smtp.mail.yahoo.com",port:587,secure:!1},{value:"icloud",label:"iCloud",host:"smtp.mail.me.com",port:587,secure:!1},{value:"titan",label:"Titan Email",host:"smtp.titan.email",port:465,secure:!0},{value:"custom",label:"Custom SMTP",host:"",port:587,secure:!1}],the=()=>{const e=kn(),[t,r]=x.useState({email_provider:"gmail",email_host:"smtp.gmail.com",email_port:587,email_secure:!1,email_user:"",email_from:""}),[n,a]=x.useState(""),[o,s]=x.useState(!1),[l,c]=x.useState(!1),[u,d]=x.useState(!1),[f,h]=x.useState("unknown");x.useEffect(()=>{p()},[]);const p=async()=>{try{const A=await ve.get("/api/email/user-settings");if(A.data.success&&A.data.settings){const P=A.data.settings;r({email_provider:P.email_provider,email_host:P.email_host,email_port:P.email_port,email_secure:P.email_secure,email_user:P.email_user,email_from:P.email_from||P.email_user}),d(!0)}}catch(A){console.error("Error loading user email settings:",A)}},v=async()=>{if(!t.email_host||!t.email_port||!t.email_user){me.error("Please fill in all required fields");return}u&&!n&&me.info("Password field is empty - keeping existing password"),s(!0);try{const A={...t,...n&&{email_pass:n}},P=await ve.post("/api/email/user-settings",A);P.data.success?(me.success("Email settings saved successfully!"),d(!0),a(""),h("unknown")):me.error(P.data.message||"Failed to save email settings")}catch(A){console.error("Error saving email settings:",A),me.error(A.response?.data?.message||"Failed to save email settings")}finally{s(!1)}},m=async()=>{if(!u){me.error("Please save your email settings first");return}c(!0);try{const A=await ve.post("/api/email/test-user-connection");A.data.success?(h("connected"),me.success("Email connection test successful!")):(h("failed"),me.error(A.data.message||"Email connection test failed"))}catch(A){console.error("Error testing email connection:",A),h("failed"),me.error(A.response?.data?.message||"Email connection test failed")}finally{c(!1)}},y=A=>{const P=JT.find(E=>E.value===A);P&&r(E=>({...E,email_provider:A,email_host:P.host,email_port:P.port,email_secure:P.secure}))},b=(A,P)=>{r(E=>({...E,[A]:P}))},_=()=>{switch(f){case"connected":return"success";case"failed":return"error";default:return"info"}},w=()=>{switch(f){case"connected":return"Connected";case"failed":return"Connection Failed";default:return"Not Tested"}};return i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{display:"flex",alignItems:"center",mb:3},children:[i.jsx(gS,{sx:{mr:2,fontSize:32}}),i.jsx(B,{variant:"h4",component:"h1",children:"My Email Settings"})]}),i.jsx(Pt,{severity:"info",sx:{mb:3},children:"Configure your personal email settings to send emails from your own email account. These settings are private to your account and will be used when you send emails from the system."}),i.jsxs(Pt,{severity:"warning",sx:{mb:3},children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:i.jsx("strong",{children:"Important for Gmail users:"})}),i.jsxs(B,{variant:"body2",children:[`If you're using Gmail with 2-Factor Authentication, you need to use an "App Password" instead of your regular password.`,i.jsx("br",{})," Go to ",i.jsx("a",{href:"https://myaccount.google.com/apppasswords",target:"_blank",rel:"noopener noreferrer",children:"Google App Passwords"}),i.jsx("br",{}),' Generate an app password for "Mail"',i.jsx("br",{}),' Use that 16-character password in the "App Password" field below']})]}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,md:8,children:i.jsxs(Rr,{children:[i.jsxs(Hr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Email Configuration"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{select:!0,label:"Email Provider",value:t.email_provider,onChange:A=>y(A.target.value),fullWidth:!0,helperText:"Select your email provider or choose Custom for other SMTP servers",children:JT.map(A=>i.jsx(Jt,{value:A.value,children:A.label},A.value))})}),i.jsx(ie,{item:!0,xs:12,sm:8,children:i.jsx(Pe,{label:"SMTP Host",value:t.email_host,onChange:A=>b("email_host",A.target.value),fullWidth:!0,required:!0,disabled:t.email_provider!=="custom"})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"SMTP Port",type:"number",value:t.email_port,onChange:A=>b("email_port",parseInt(A.target.value)),fullWidth:!0,required:!0,disabled:t.email_provider!=="custom"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(ui,{control:i.jsx(ac,{checked:t.email_secure,onChange:A=>b("email_secure",A.target.checked),disabled:t.email_provider!=="custom"}),label:"Use SSL/TLS (usually for port 465)"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Email Address",type:"email",value:t.email_user,onChange:A=>b("email_user",A.target.value),fullWidth:!0,required:!0,helperText:"Your email address for authentication"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:u?"Update App Password":"App Password",type:"password",value:n,onChange:A=>a(A.target.value),fullWidth:!0,required:!u,helperText:u?"Leave blank to keep current password, or enter new password to update":"Your email password or app password (for Gmail with 2FA)"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"From Name (Optional)",value:t.email_from,onChange:A=>b("email_from",A.target.value),fullWidth:!0,helperText:"Display name for outgoing emails (defaults to email address)"})})]})]}),i.jsx($h,{children:i.jsx(xe,{variant:"contained",startIcon:o?i.jsx(er,{size:20}):i.jsx(Is,{}),onClick:v,disabled:o,children:o?"Saving...":"Save Settings"})})]})}),i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsxs(Rr,{children:[i.jsxs(Hr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Connection Status"}),i.jsx(Pt,{severity:_(),sx:{mb:2},children:w()}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Test your email configuration to ensure it works correctly."})]}),i.jsx($h,{children:i.jsx(xe,{variant:"outlined",startIcon:l?i.jsx(er,{size:20}):i.jsx(Xfe,{}),onClick:m,disabled:l||!u,fullWidth:!0,children:l?"Testing...":"Test Connection"})})]}),i.jsx(Rr,{sx:{mt:2},children:i.jsxs(Hr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Setup Instructions"}),i.jsxs(B,{variant:"body2",sx:{mb:1},children:[i.jsx("strong",{children:"Gmail:"})," Use an App Password instead of your regular password."]}),i.jsxs(B,{variant:"body2",sx:{mb:1},children:[i.jsx("strong",{children:"Outlook:"})," Use an App Password for enhanced security."]}),i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"Other providers:"})," Check your email provider's SMTP settings."]})]})}),i.jsx(Rr,{sx:{mt:2,border:"2px solid red"},children:i.jsxs(Hr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Quick Actions"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Manage your email templates and customize email content for different types of communications."}),i.jsx(xe,{fullWidth:!0,variant:"outlined",onClick:()=>e("/email-templates"),startIcon:i.jsx(ehe,{}),sx:{mb:1},color:"primary",children:"Manage Email Templates"})]})})]})]})]})};var mh={},ZT;function rhe(){if(ZT)return mh;ZT=1;var e=ir();Object.defineProperty(mh,"__esModule",{value:!0}),mh.default=void 0;var t=e(sr()),r=or();return mh.default=(0,t.default)((0,r.jsx)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link"),mh}var nhe=rhe();const eI=Et(nhe);var gh={},tI;function ahe(){if(tI)return gh;tI=1;var e=ir();Object.defineProperty(gh,"__esModule",{value:!0}),gh.default=void 0;var t=e(sr()),r=or();return gh.default=(0,t.default)((0,r.jsx)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8m0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4z"}),"Sync"),gh}var ihe=ahe();const ohe=Et(ihe),she=e=>{switch(e){case"created_po":return"success";case"needs_review":return"warning";case"processing":return"info";case"error":return"error";default:return"default"}},lhe=()=>{const[e,t]=x.useState(!1),[r,n]=x.useState(!0),[a,o]=x.useState(!1),[s,l]=x.useState(!1),[c,u]=x.useState(""),[d,f]=x.useState(""),[h,p]=x.useState("imap.titan.email"),[v,m]=x.useState(993),[y,b]=x.useState("smtp.titan.email"),[_,w]=x.useState(465),[A,P]=x.useState("unread:true has:attachment"),[E,T]=x.useState(20),[S,I]=x.useState(!0),[U,O]=x.useState(!1),[M,L]=x.useState(!0),[q,z]=x.useState([]),K=async()=>{n(!0);try{const N=await ve.get("/api/email/titan/status");N.data?.success?t(!!N.data.connected):t(!1)}catch{t(!1)}finally{n(!1)}},J=async()=>{L(!0);try{const N=await ve.get("/api/invoice-automator/ingestions?limit=50");z(Array.isArray(N.data?.ingestions)?N.data.ingestions:[])}catch{me.error("Failed to load ingestions")}finally{L(!1)}};x.useEffect(()=>{K().finally(()=>J())},[]);const R=async()=>{o(!0);try{const N={email:c,password:d,hostImap:h,portImap:v,hostSmtp:y,portSmtp:_},H=await ve.post("/api/email/connect/titan",N);H.data?.success?(me.success("Titan connected"),f(""),await K()):me.error(H.data?.message||"Failed to connect Titan")}catch(N){me.error(N?.response?.data?.message||"Failed to connect Titan")}finally{o(!1)}},k=async()=>{l(!0);try{const N=await ve.post("/api/email/disconnect");N.data?.success?(me.success("Disconnected"),await K()):me.error(N.data?.message||"Failed to disconnect")}catch(N){me.error(N?.response?.data?.message||"Failed to disconnect")}finally{l(!1)}},$=async()=>{O(!0);try{const N=await ve.post("/api/invoice-automator/titan/sync",{query:A,maxMessages:E,autoCreatePurchaseOrders:S});N.data?.success?(me.success(`Synced: ${N.data.processedAttachments||0} attachments, ${N.data.createdPurchaseOrders||0} POs created`),await J()):me.error(N.data?.message||"Sync failed")}catch(N){me.error(N?.response?.data?.message||"Sync failed")}finally{O(!1)}},X=async N=>{try{const H=await ve.post(`/api/invoice-automator/ingestions/${N.id}/create-po`,{});H.data?.success?(me.success("Purchase order created"),await J()):me.error(H.data?.message||"Failed to create purchase order")}catch(H){me.error(H?.response?.data?.message||"Failed to create purchase order")}},C=x.useMemo(()=>q,[q]);return i.jsxs(Z,{p:3,children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Invoice Automator"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Connect a Titan mailbox, scan invoice attachments, run OCR, and create purchase orders automatically when the vendor can be matched."}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,md:5,children:[i.jsxs(Rr,{children:[i.jsxs(Hr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Titan Connection"}),i.jsx(Pt,{severity:e?"success":"warning",sx:{mb:2},children:r?"Checking...":e?"Connected":"Not connected"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Email",value:c,onChange:N=>u(N.target.value),fullWidth:!0,disabled:e})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Password",type:"password",value:d,onChange:N=>f(N.target.value),fullWidth:!0,disabled:e,helperText:e?"Disconnect to update credentials":"Your Titan mailbox password"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"IMAP Host",value:h,onChange:N=>p(N.target.value),fullWidth:!0,disabled:e})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"IMAP Port",type:"number",value:v,onChange:N=>m(Number(N.target.value)),fullWidth:!0,disabled:e})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"SMTP Host",value:y,onChange:N=>b(N.target.value),fullWidth:!0,disabled:e})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"SMTP Port",type:"number",value:_,onChange:N=>w(Number(N.target.value)),fullWidth:!0,disabled:e})})]})]}),i.jsx($h,{children:e?i.jsx(xe,{variant:"outlined",color:"warning",startIcon:s?i.jsx(er,{size:18}):i.jsx(eI,{}),onClick:k,disabled:s,children:s?"Disconnecting...":"Disconnect"}):i.jsx(xe,{variant:"contained",startIcon:a?i.jsx(er,{size:18}):i.jsx(eI,{}),onClick:R,disabled:a||!c||!d,children:a?"Connecting...":"Connect Titan"})})]}),i.jsx(Rr,{sx:{mt:2},children:i.jsxs(Hr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Sync Settings"}),i.jsx(Pe,{label:"Titan Search Query",value:A,onChange:N=>P(N.target.value),fullWidth:!0,sx:{mb:2},helperText:'Examples: `unread:true has:attachment`, `from:"billing@vendor.com" unread:true has:attachment`'}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Max Messages",type:"number",value:E,onChange:N=>T(Number(N.target.value)),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(ui,{control:i.jsx(ac,{checked:S,onChange:N=>I(N.target.checked)}),label:"Auto-create POs"})})]}),i.jsx(Vn,{sx:{my:2}}),i.jsx(xe,{variant:"contained",startIcon:U?i.jsx(er,{size:18}):i.jsx(ohe,{}),onClick:$,disabled:!e||U,fullWidth:!0,children:U?"Syncing...":"Sync Inbox"})]})})]}),i.jsx(ie,{item:!0,xs:12,md:7,children:i.jsx(Rr,{children:i.jsxs(Hr,{children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[i.jsx(B,{variant:"h6",children:"Recent Ingestions"}),i.jsx(xe,{size:"small",onClick:J,disabled:M,children:"Refresh"})]}),M?i.jsx(Z,{display:"flex",justifyContent:"center",py:4,children:i.jsx(er,{})}):C.length===0?i.jsx(Pt,{severity:"info",children:"No ingestions yet. Connect Titan and run a sync."}):i.jsx(Z,{display:"flex",flexDirection:"column",gap:1,children:C.map(N=>{const H=N.ocr_normalized,W=H?.vendorName,ne=H?.billNumber,se=H?.vendorMatch?.status==="existing"?H?.vendorMatch?.vendorId:null,oe=H?.documentType==="invoice",ae=oe&&!N.purchase_id&&(N.status==="needs_review"||N.status==="processed")&&se;return i.jsxs(Rr,{variant:"outlined",children:[i.jsxs(Hr,{sx:{pb:1},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:N.attachment_filename||"attachment"}),i.jsx(ot,{size:"small",label:N.status,color:she(N.status)})]}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:[N.subject||"(no subject)","  ",N.from_address||"unknown sender"]}),i.jsxs(B,{variant:"body2",sx:{mt:1},children:["Vendor: ",W||"","  Bill: ",ne||""]}),N.error?i.jsx(Pt,{severity:"error",sx:{mt:1},children:N.error}):null]}),i.jsxs($h,{sx:{pt:0},children:[N.purchase_id?i.jsx(xe,{size:"small",component:BI,to:`/open-purchase-orders/${N.purchase_id}`,startIcon:i.jsx(qw,{}),children:"Open PO"}):i.jsx(xe,{size:"small",variant:"contained",onClick:()=>X(N),disabled:!ae,startIcon:i.jsx(qw,{}),children:"Create PO"}),!se&&oe?i.jsx(B,{variant:"caption",color:"text.secondary",children:"Vendor not matched (add vendor, then re-sync)"}):null]})]},N.id)})})]})})})]})]})},che=()=>{const{user:e}=Jn(),[t,r]=x.useState([]),[n,a]=x.useState(!0),[o,s]=x.useState(!1),[l,c]=x.useState(null),[u,d]=x.useState({name:"",type:"purchase_order",subject:"",html_content:"",text_content:"",is_default:!1}),[f,h]=x.useState(""),[p,v]=x.useState("");x.useEffect(()=>{m()},[]);const m=async()=>{try{a(!0);const E=await ve.get("/api/email/templates");E.data.success&&r(E.data.templates)}catch(E){console.error("Error loading templates:",E),h("Failed to load email templates")}finally{a(!1)}},y=E=>{E?(c(E),d({name:E.name,type:E.type,subject:E.subject,html_content:E.html_content,text_content:E.text_content||"",is_default:E.is_default})):(c(null),d({name:"",type:"purchase_order",subject:"",html_content:"",text_content:"",is_default:!1})),s(!0)},b=()=>{s(!1),c(null),d({name:"",type:"purchase_order",subject:"",html_content:"",text_content:"",is_default:!1})},_=async()=>{try{l?(await ve.put(`/api/email/templates/${l.id}`,u),v("Email template updated successfully")):(await ve.post("/api/email/templates",u),v("Email template created successfully")),b(),m()}catch(E){console.error("Error saving template:",E),h(E.response?.data?.message||"Failed to save template")}},w=async E=>{if(window.confirm("Are you sure you want to delete this template?"))try{await ve.delete(`/api/email/templates/${E}`),v("Email template deleted successfully"),m()}catch(T){console.error("Error deleting template:",T),h(T.response?.data?.message||"Failed to delete template")}},A=E=>{switch(E){case"purchase_order":return"primary";case"sales_order":return"success";case"quote":return"warning";case"custom":return"info";default:return"default"}},P=E=>{switch(E){case"purchase_order":return"Purchase Order";case"sales_order":return"Sales Order";case"quote":return"Quote";case"custom":return"Custom";default:return E}};return n?i.jsx(rr,{maxWidth:"lg",children:i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Loading..."})}):i.jsxs(rr,{maxWidth:"lg",children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Email Templates"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Tv,{}),onClick:()=>y(),children:"Create Template"})]}),i.jsx(ie,{container:!0,spacing:3,children:t.map(E=>i.jsx(ie,{item:!0,xs:12,md:6,lg:4,children:i.jsx(Rr,{children:i.jsxs(Hr,{children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[i.jsx(B,{variant:"h6",component:"div",children:E.name}),i.jsxs(Z,{children:[i.jsx(vr,{size:"small",onClick:()=>y(E),color:"primary",children:i.jsx(Tp,{})}),i.jsx(vr,{size:"small",onClick:()=>w(E.id),color:"error",children:i.jsx(Id,{})})]})]}),i.jsx(ot,{label:P(E.type),color:A(E.type),size:"small",sx:{mb:1}}),E.is_default&&i.jsx(ot,{label:"Default",color:"secondary",size:"small",sx:{ml:1}}),i.jsxs(B,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[i.jsx("strong",{children:"Subject:"})," ",E.subject]}),i.jsxs(B,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[i.jsx("strong",{children:"Created:"})," ",new Date(E.created_at).toLocaleDateString()]}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:[i.jsx("strong",{children:"Updated:"})," ",new Date(E.updated_at).toLocaleDateString()]})]})})},E.id))}),t.length===0&&i.jsxs(Z,{sx:{textAlign:"center",mt:4},children:[i.jsx(B,{variant:"h6",color:"text.secondary",children:"No email templates found"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Create your first email template to get started"})]}),i.jsxs(dr,{open:o,onClose:b,maxWidth:"md",fullWidth:!0,children:[i.jsx(fr,{children:l?"Edit Email Template":"Create Email Template"}),i.jsx(hr,{children:i.jsxs(Z,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[i.jsx(Pe,{label:"Template Name",value:u.name,onChange:E=>d({...u,name:E.target.value}),fullWidth:!0,required:!0}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{children:"Template Type"}),i.jsxs(ln,{value:u.type,onChange:E=>d({...u,type:E.target.value}),label:"Template Type",children:[i.jsx(Jt,{value:"purchase_order",children:"Purchase Order"}),i.jsx(Jt,{value:"sales_order",children:"Sales Order"}),i.jsx(Jt,{value:"quote",children:"Quote"}),i.jsx(Jt,{value:"custom",children:"Custom"})]})]}),i.jsx(Pe,{label:"Subject",value:u.subject,onChange:E=>d({...u,subject:E.target.value}),fullWidth:!0,required:!0}),i.jsx(Pe,{label:"HTML Content",value:u.html_content,onChange:E=>d({...u,html_content:E.target.value}),fullWidth:!0,multiline:!0,rows:8,required:!0,helperText:"Use HTML formatting for rich email content"}),i.jsx(Pe,{label:"Text Content (Optional)",value:u.text_content,onChange:E=>d({...u,text_content:E.target.value}),fullWidth:!0,multiline:!0,rows:4,helperText:"Plain text version for email clients that don't support HTML"}),i.jsx(ui,{control:i.jsx(ac,{checked:u.is_default,onChange:E=>d({...u,is_default:E.target.checked})}),label:"Set as default template for this type"})]})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:b,children:"Cancel"}),i.jsx(xe,{onClick:_,variant:"contained",children:l?"Update":"Create"})]})]}),i.jsx(hl,{open:!!f,autoHideDuration:6e3,onClose:()=>h(""),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Pt,{onClose:()=>h(""),severity:"error",sx:{width:"100%"},children:f})}),i.jsx(hl,{open:!!p,autoHideDuration:6e3,onClose:()=>v(""),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Pt,{onClose:()=>v(""),severity:"success",sx:{width:"100%"},children:p})})]})};var ig={exports:{}},uhe=ig.exports,rI;function dhe(){return rI||(rI=1,function(e,t){(function(r,n){e.exports=n()})(uhe,function(){return function(r,n,a){r=r||{};var o=n.prototype,s={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function l(u,d,f,h){return o.fromToBase(u,d,f,h)}a.en.relativeTime=s,o.fromToBase=function(u,d,f,h,p){for(var v,m,y,b=f.$locale().relativeTime||s,_=r.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],w=_.length,A=0;A<w;A+=1){var P=_[A];P.d&&(v=h?a(u).diff(f,P.d,!0):f.diff(u,P.d,!0));var E=(r.rounding||Math.round)(Math.abs(v));if(y=v>0,E<=P.r||!P.r){E<=1&&A>0&&(P=_[A-1]);var T=b[P.l];p&&(E=p(""+E)),m=typeof T=="string"?T.replace("%d",E):T(E,d,P.l,y);break}}if(d)return m;var S=y?b.future:b.past;return typeof S=="function"?S(m):S.replace("%s",m)},o.to=function(u,d){return l(u,d,this,!0)},o.from=function(u,d){return l(u,d,this)};var c=function(u){return u.$u?a.utc():a()};o.toNow=function(u){return this.to(c(this),u)},o.fromNow=function(u){return this.from(c(this),u)}}})}(ig)),ig.exports}var fhe=dhe();const mR=Et(fhe),og={async fetchMessages(e,t){return(await ve.get(`/api/tasks/${e}/messages`,{params:t?{after:t}:void 0})).data},async postMessage(e,t){return(await ve.post(`/api/tasks/${e}/messages`,t)).data},async markMessagesRead(e,t){return(await ve.post(`/api/tasks/${e}/messages/mark-read`,{lastMessageId:t})).data},async getTaskDetail(e){return(await ve.get(`/api/tasks/${e}`)).data}};Rt.extend(mR);const gR=e=>[...e].sort((t,r)=>{const n=new Date(t.createdAt).getTime(),a=new Date(r.createdAt).getTime();return n===a?t.id-r.id:n-a}),hhe=(e,t)=>{if(!t.length)return{merged:e,appended:[]};const r=new Map;e.forEach(o=>r.set(o.id,o));const n=[];return t.forEach(o=>{r.has(o.id)||n.push(o),r.set(o.id,o)}),{merged:gR(Array.from(r.values())),appended:n}},phe=({taskId:e,pollIntervalMs:t=15e3,onUnreadChange:r})=>{const{user:n}=Jn(),a=x.useMemo(()=>{if(!n?.id)return null;const C=Number(n.id);return Number.isFinite(C)?C:null},[n?.id]),[o,s]=x.useState([]),[l,c]=x.useState(null),[u,d]=x.useState(0),[f,h]=x.useState(!0),[p,v]=x.useState(!1),[m,y]=x.useState(!1),[b,_]=x.useState(""),[w,A]=x.useState(null),[P,E]=x.useState(null),T=x.useRef(null),S=x.useRef(null),I=x.useRef(!0),U=x.useRef(null),O=x.useCallback(C=>{d(C),r?.(C)},[r]),M=x.useCallback((C=!1)=>{const N=T.current;N&&N.scrollTo({top:N.scrollHeight,behavior:C?"smooth":"auto"})},[]),L=x.useCallback(()=>{const C=T.current;return C?C.scrollHeight-C.scrollTop-C.clientHeight<=120:!0},[]),q=x.useCallback(async C=>{try{const N=await og.markMessagesRead(e,C??void 0);c(N.participant),O(N.unreadCount)}catch(N){console.warn("Failed to update read state for task chat",N)}},[O,e]),z=x.useCallback(C=>{!C.length||I.current||C.filter(N=>N.sender?.userId&&a&&N.sender.userId!==a).forEach(N=>{const H=N.sender?.name||"Task teammate";me.info(`New message from ${H}`)})},[a]),K=x.useCallback((C,N=!1)=>{const H=L();let W=[],ne=U.current;return s(se=>{if(N){const pe=gR(C);return W=pe,ne=pe.length?pe[pe.length-1].id:null,pe}const{merged:oe,appended:ae}=hhe(se,C);return W=ae,ne=oe.length?oe[oe.length-1].id:ne,oe}),ne!=null&&(U.current==null||ne>U.current)&&(U.current=ne),W.length?(z(W),H&&setTimeout(()=>M(!0),50)):H&&N&&setTimeout(()=>M(!0),50),{appended:W,latestId:ne}},[z,M,L]),J=x.useCallback(async C=>{try{C?.initial?h(!0):E(null);const N=C?.forceFull?void 0:U.current??void 0,H=await og.fetchMessages(e,N);c(H.participant),A(H.lastSyncedAt);const{appended:W,latestId:ne}=K(H.messages,!!C?.initial||C?.forceFull);O(H.unreadCount),(H.unreadCount>0||W.length>0)&&ne!=null&&await q(ne),C?.initial&&(I.current=!1)}catch(N){console.error("Failed to load task messages",N);const H=N?.response?.data?.message||"Unable to load task messages.";E(H),C?.initial&&me.error(H)}finally{C?.initial&&h(!1)}},[K,q,O,e]);x.useEffect(()=>(I.current=!0,U.current=null,s([]),c(null),O(0),J({initial:!0,forceFull:!0}).catch(()=>{}),()=>{S.current&&(clearInterval(S.current),S.current=null)}),[J,O,e]),x.useEffect(()=>{if(S.current&&clearInterval(S.current),!(t<=0))return S.current=setInterval(()=>{J({forceFull:!1}).catch(()=>{})},t),()=>{S.current&&(clearInterval(S.current),S.current=null)}},[J,t]);const R=x.useCallback(async C=>{if(C.preventDefault(),!!b.trim())try{y(!0);const N=await og.postMessage(e,{content:b.trim()});c(N.participant),O(N.unreadCount),K([N.message]),U.current=N.message.id,_(""),setTimeout(()=>M(!0),50)}catch(N){console.error("Failed to send message",N),me.error(N?.response?.data?.message||"Failed to send message")}finally{y(!1)}},[K,b,O,M,e]),k=x.useCallback(async()=>{try{v(!0),await J({forceFull:!0})}finally{v(!1)}},[J]),$=x.useMemo(()=>w?`Updated ${Rt(w).fromNow()}`:"Not synced yet",[w]),X=C=>{const N=!!(C.metadata&&C.metadata.agent||C.isSystem),H=!N&&a!=null&&C.sender?.userId===a,W=N?"System":H?"You":C.sender?.name||"Team member",ne=Rt(C.createdAt).format("MMM D, YYYY h:mm A");return i.jsxs(Z,{display:"flex",flexDirection:"column",alignItems:H?"flex-end":"flex-start",mb:2,children:[i.jsx(Z,{sx:{maxWidth:"80%",bgcolor:N?"rgba(25, 118, 210, 0.08)":H?"primary.main":"grey.100",color:N?"text.primary":H?"primary.contrastText":"text.primary",px:2,py:1,borderRadius:2,boxShadow:1,border:N?"1px solid":void 0,borderColor:N?"info.light":void 0},children:i.jsx(B,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:C.content})}),i.jsxs(B,{variant:"caption",color:"text.secondary",sx:{mt:.5},children:[W,"  ",ne]})]},C.id)};return i.jsxs(bt,{elevation:2,sx:{display:"flex",flexDirection:"column",height:"100%"},children:[i.jsxs(Z,{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,py:1.5,children:[i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(B,{variant:"h6",children:"Task chat"}),i.jsx(Yw,{color:"secondary",badgeContent:u,invisible:u===0,children:i.jsx(ot,{label:"Unread",size:"small",variant:u?"filled":"outlined"})})]}),i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,children:[w&&i.jsx(B,{variant:"caption",color:"text.secondary",children:$}),i.jsx(Hn,{title:"Refresh conversation",children:i.jsx("span",{children:i.jsx(vr,{onClick:k,disabled:p||f,size:"small",children:p?i.jsx(er,{size:18}):i.jsx(Ts,{fontSize:"small"})})})})]})]}),i.jsx(Vn,{}),i.jsx(Z,{ref:T,flex:1,overflow:"auto",px:2,py:2,children:f?i.jsx(Z,{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",children:i.jsx(er,{size:32})}):P?i.jsx(B,{color:"error",variant:"body2",children:P}):o.length===0?i.jsx(Z,{textAlign:"center",color:"text.secondary",children:i.jsx(B,{variant:"body2",children:"No messages yet. Start the conversation below."})}):o.map(C=>X(C))}),i.jsx(Vn,{}),i.jsxs(Z,{component:"form",onSubmit:R,display:"flex",gap:1,px:2,py:1.5,children:[i.jsx(Pe,{value:b,onChange:C=>_(C.target.value),placeholder:"Write a message",fullWidth:!0,minRows:2,maxRows:4,multiline:!0,disabled:m}),i.jsx(xe,{type:"submit",variant:"contained",endIcon:m?i.jsx(er,{color:"inherit",size:18}):i.jsx(gN,{}),disabled:m||b.trim().length===0,children:"Send"})]})]})};Rt.extend(mR);const mhe=()=>{const{id:e}=Ms(),t=x.useMemo(()=>{if(!e)return NaN;const v=Number(e);return Number.isFinite(v)?v:NaN},[e]),[r,n]=x.useState(null),[a,o]=x.useState(!0),[s,l]=x.useState(null),[c,u]=x.useState(0),d=x.useCallback(async()=>{if(!Number.isFinite(t)){l("Invalid task identifier"),o(!1);return}try{o(!0),l(null);const v=await og.getTaskDetail(t);n(v)}catch(v){console.error("Failed to load task details",v);const m=v?.response?.data?.message||"Unable to load task details.";l(m),me.error(m)}finally{o(!1)}},[t]);x.useEffect(()=>{d()},[d]);const f=x.useCallback(v=>{u(v)},[]);if(!Number.isFinite(t))return i.jsx(Z,{p:3,children:i.jsx(B,{color:"error",children:"Invalid task identifier."})});if(a)return i.jsx(Z,{p:3,display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40vh",children:i.jsx(er,{})});if(s)return i.jsx(Z,{p:3,children:i.jsx(B,{color:"error",children:s})});if(!r)return null;const{task:h,participants:p}=r;return i.jsxs(Z,{p:3,display:"flex",flexDirection:"column",gap:3,children:[i.jsxs(Z,{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,justifyContent:"space-between",children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:h.title}),i.jsxs(Z,{display:"flex",flexWrap:"wrap",gap:1,alignItems:"center",children:[i.jsx(ot,{label:h.status,color:h.status==="completed"?"success":"default"}),i.jsx(ot,{label:`Priority: ${h.priority??"N/A"}`,variant:"outlined"}),h.dueDate&&i.jsx(ot,{label:`Due ${Rt(h.dueDate).format("MMM D, YYYY")}`,color:"warning"}),c>0&&i.jsx(ot,{label:`${c} unread`,color:"secondary"})]})]}),i.jsxs(Z,{textAlign:{xs:"left",md:"right"},color:"text.secondary",children:[h.updatedAt&&i.jsxs(B,{variant:"body2",children:["Updated ",Rt(h.updatedAt).format("MMM D, YYYY h:mm A")]}),h.createdAt&&i.jsxs(B,{variant:"body2",children:["Created ",Rt(h.createdAt).format("MMM D, YYYY h:mm A")]})]})]}),h.description&&i.jsxs(bt,{variant:"outlined",sx:{p:2},children:[i.jsx(B,{variant:"subtitle1",gutterBottom:!0,children:"Description"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{whiteSpace:"pre-wrap"},children:h.description})]}),i.jsxs(ie,{container:!0,spacing:3,alignItems:"stretch",children:[i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsxs(bt,{variant:"outlined",sx:{p:2,height:"100%"},children:[i.jsx(B,{variant:"subtitle1",gutterBottom:!0,children:"Participants"}),p.length===0?i.jsx(B,{variant:"body2",color:"text.secondary",children:"No participants assigned."}):i.jsx(Z,{display:"flex",flexDirection:"column",gap:1.5,children:p.map(v=>{const m=(v.name||v.email||"T")[0]?.toUpperCase();return i.jsxs(Z,{display:"flex",alignItems:"center",gap:1.5,children:[i.jsx(kp,{sx:{bgcolor:"primary.main"},children:m}),i.jsxs(Z,{flex:1,children:[i.jsx(B,{variant:"body2",children:v.name||"Unnamed user"}),i.jsxs(B,{variant:"caption",color:"text.secondary",display:"block",children:[v.email||"No email","  ",v.role||"Participant"]}),v.lastReadAt&&i.jsxs(B,{variant:"caption",color:"text.secondary",display:"block",children:["Read ",Rt(v.lastReadAt).fromNow()]})]})]},v.id)})})]})}),i.jsx(ie,{item:!0,xs:12,md:8,children:i.jsx(phe,{taskId:t,onUnreadChange:f})})]})]})},nI=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}],ghe=({filters:e,assignees:t,onChange:r,onReset:n})=>{const a=c=>{const u=c.target.value,d=typeof u=="string"?u.split(","):u;r({...e,status:d.filter(Boolean)})},o=c=>{const u=c.target.value;r({...e,assignedTo:u?Number(u):void 0})},s=c=>u=>{r({...e,[c]:u.target.value||void 0})},l=c=>u=>{r({...e,[c]:u.target.checked})};return i.jsx(bt,{variant:"outlined",sx:{p:{xs:2.5,md:3},borderRadius:3,backgroundColor:"background.paper"},children:i.jsxs(ut,{direction:{xs:"column",lg:"row"},spacing:2,useFlexGap:!0,flexWrap:"wrap",alignItems:{xs:"stretch",lg:"flex-end"},children:[i.jsxs(tn,{sx:{minWidth:180,flex:"1 1 200px"},size:"small",children:[i.jsx(sn,{id:"task-status-label",children:"Status"}),i.jsx(ln,{labelId:"task-status-label",multiple:!0,value:e.status??[],onChange:a,input:i.jsx(TI,{label:"Status"}),renderValue:c=>c.map(u=>nI.find(d=>d.value===u)?.label??u).join(", "),children:nI.map(c=>i.jsxs(Jt,{value:c.value,children:[i.jsx(Xi,{checked:e.status?.includes(c.value)??!1}),i.jsx(Qn,{primary:c.label})]},c.value))})]}),i.jsxs(tn,{sx:{minWidth:180,flex:"1 1 200px"},size:"small",children:[i.jsx(sn,{id:"task-assigned-label",children:"Assigned to"}),i.jsxs(ln,{labelId:"task-assigned-label",value:e.assignedTo?String(e.assignedTo):"",label:"Assigned to",onChange:o,children:[i.jsx(Jt,{value:"",children:i.jsx("em",{children:"All team members"})}),t.map(c=>i.jsx(Jt,{value:c.id,children:c.username||c.email},c.id))]})]}),i.jsx(Pe,{label:"Search",size:"small",value:e.search??"",onChange:s("search"),sx:{flex:"1 1 200px"}}),i.jsx(Pe,{label:"Due from",type:"date",size:"small",value:e.dueFrom?.slice(0,10)??"",onChange:s("dueFrom"),InputLabelProps:{shrink:!0},sx:{flex:"1 1 180px"}}),i.jsx(Pe,{label:"Due to",type:"date",size:"small",value:e.dueTo?.slice(0,10)??"",onChange:s("dueTo"),InputLabelProps:{shrink:!0},sx:{flex:"1 1 180px"}}),i.jsxs(Z,{sx:{display:"flex",flexDirection:"column",gap:1,flex:"1 1 220px"},children:[i.jsx(ui,{control:i.jsx(Xi,{checked:e.includeCompleted??!1,onChange:l("includeCompleted")}),label:"Show completed"}),i.jsx(ui,{control:i.jsx(Xi,{checked:e.includeArchived??!1,onChange:l("includeArchived")}),label:"Show archived"})]}),n&&i.jsx(Z,{sx:{display:"flex",alignItems:"center"},children:i.jsx(xe,{variant:"text",onClick:n,color:"secondary",children:"Reset"})})]})})};var vh={},aI;function vhe(){if(aI)return vh;aI=1;var e=ir();Object.defineProperty(vh,"__esModule",{value:!0}),vh.default=void 0;var t=e(sr()),r=or();return vh.default=(0,t.default)((0,r.jsx)("path",{d:"M3 18h12v-2H3zM3 6v2h18V6zm0 7h18v-2H3z"}),"Notes"),vh}var yhe=vhe();const iI=Et(yhe);var yh={},oI;function xhe(){if(oI)return yh;oI=1;var e=ir();Object.defineProperty(yh,"__esModule",{value:!0}),yh.default=void 0;var t=e(sr()),r=or();return yh.default=(0,t.default)([(0,r.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),(0,r.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"Schedule"),yh}var bhe=xhe();const _he=Et(bhe),vR=({completed:e,disabled:t,onToggle:r,label:n})=>{const a=o=>{r(o.target.checked)};return i.jsx(Hn,{title:e?"Mark as incomplete":"Mark as completed",children:i.jsx(ui,{control:i.jsx(ac,{checked:e,onChange:a,disabled:t,color:"success",size:"small"}),label:n??(e?"Completed":"Mark complete")})})},whe={pending:"Pending",in_progress:"In Progress",completed:"Completed",archived:"Archived"},jhe={pending:"warning",in_progress:"info",completed:"success",archived:"default"},yR=e=>e?new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric",year:"numeric"}).format(new Date(e)):"No due date",M2=typeof Intl<"u"&&"RelativeTimeFormat"in Intl?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null,sI=e=>{if(!e)return"Never";const t=new Date(e);if(Number.isNaN(t.getTime())||!M2)return yR(e);const r=t.getTime()-Date.now(),n=Math.abs(r),a=[["day",1e3*60*60*24],["hour",1e3*60*60],["minute",1e3*60]];for(const[o,s]of a)if(n>=s||o==="minute"){const l=Math.round(r/s);return M2.format(l,o)}return M2.format(0,"minute")},She=({tasks:e,onSelect:t,onToggleComplete:r,onEdit:n,onDelete:a})=>e.length===0?i.jsxs(Z,{textAlign:"center",py:6,color:"text.secondary",sx:{border:"1px dashed",borderColor:"divider",borderRadius:3,backgroundColor:"background.paper"},children:[i.jsx(iI,{sx:{fontSize:48,mb:1}}),i.jsx(B,{variant:"h6",children:"No tasks found"}),i.jsx(B,{variant:"body2",children:"Use the New task button above to create your first assignment."})]}):i.jsx(ut,{spacing:2.5,children:e.map(o=>{const s=o.dueDate?new Date(o.dueDate):null,l=Date.now(),c=!!(s&&s.getTime()<l&&o.status!=="completed"),u=s&&o.status!=="completed"?Math.ceil((s.getTime()-l)/(1e3*60*60*24)):null,d=typeof u=="number"&&u>=0&&u<=3,f=c?"error.main":o.status==="completed"?"success.main":d?"warning.main":"info.main";return i.jsxs(Rr,{elevation:0,sx:{position:"relative",borderRadius:3,border:"1px solid",borderColor:"divider",overflow:"hidden",transition:"all 0.2s ease-in-out",backgroundColor:"background.paper","&:hover":{boxShadow:8,transform:"translateY(-2px)"}},children:[i.jsx(Z,{sx:{position:"absolute",top:0,left:0,bottom:0,width:6,bgcolor:f}}),i.jsx(N8,{onClick:()=>t(o),sx:{alignSelf:"stretch"},children:i.jsx(Z,{sx:{p:{xs:2.5,sm:3}},children:i.jsxs(ut,{spacing:2,children:[i.jsxs(ut,{direction:{xs:"column",md:"row"},spacing:1.5,justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},children:[i.jsx(B,{variant:"h6",children:o.title}),i.jsxs(ut,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",useFlexGap:!0,children:[i.jsx(ot,{label:whe[o.status],color:jhe[o.status],size:"small"}),c&&o.status!=="completed"&&i.jsx(ot,{label:"Overdue",color:"error",size:"small",variant:"outlined"}),o.status==="completed"&&i.jsx(ot,{label:`Completed ${sI(o.completedAt)}`,color:"success",size:"small",variant:"outlined"})]})]}),o.description&&i.jsx(B,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:o.description}),i.jsxs(ut,{direction:{xs:"column",md:"row"},spacing:2,justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},children:[i.jsxs(ut,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:[i.jsx(ot,{icon:i.jsx(FL,{fontSize:"small"}),label:yR(o.dueDate),color:c?"error":d?"warning":"default",variant:o.dueDate?"filled":"outlined",size:"small"}),i.jsx(ot,{icon:i.jsx(iI,{fontSize:"small"}),label:`${o.noteCount} note${o.noteCount===1?"":"s"}`,size:"small",variant:"outlined"}),i.jsx(ot,{icon:i.jsx(_he,{fontSize:"small"}),label:`Updated ${sI(o.updatedAt)}`,size:"small",variant:"outlined"})]}),o.assignees.length>0?i.jsx(D8,{max:4,sx:{"& .MuiAvatar-root":{width:32,height:32,fontSize:14}},children:o.assignees.map(h=>i.jsx(Hn,{title:h.username||h.email,children:i.jsx(kp,{children:(h.username||h.email||"?").charAt(0).toUpperCase()})},`${o.id}-assignee-${h.id}`))}):i.jsx(ot,{label:"Unassigned",size:"small",variant:"outlined"})]})]})})}),i.jsx(Vn,{}),i.jsxs($h,{sx:{px:{xs:2,sm:3},py:1.5,justifyContent:"space-between",alignItems:"center"},children:[i.jsx(Z,{onClick:h=>h.stopPropagation(),sx:{display:"flex",alignItems:"center"},children:i.jsx(vR,{completed:o.status==="completed",onToggle:h=>r(o,h),label:o.status==="completed"?"Completed":"Mark complete"})}),i.jsxs(ut,{direction:"row",spacing:1.5,alignItems:"center",children:[i.jsx(Hn,{title:"Edit task",children:i.jsx(vr,{onClick:h=>{h.stopPropagation(),n(o)},children:i.jsx(tu,{})})}),i.jsx(Hn,{title:"Delete task",children:i.jsx(vr,{color:"error",onClick:h=>{h.stopPropagation(),a(o)},children:i.jsx(ga,{})})})]})]})]},o.id)})}),xh=e=>e?new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric"}).format(new Date(e)):"Not set",Che=({open:e,task:t,loading:r,onClose:n,onEdit:a,onToggleComplete:o,onAddNote:s})=>{const[l,c]=x.useState(""),[u,d]=x.useState(!1),[f,h]=x.useState(!1);x.useEffect(()=>{e||(c(""),d(!1),h(!1))},[e]);const p=async()=>{if(l.trim()){d(!0);try{await s(l.trim()),c("")}finally{d(!1)}}},v=async m=>{h(!0);try{await o(m)}finally{h(!1)}};return i.jsxs(dr,{open:e,onClose:n,fullWidth:!0,maxWidth:"md",children:[i.jsxs(fr,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsx(B,{variant:"h6",children:"Task details"}),i.jsx(vr,{onClick:n,children:i.jsx(aj,{})})]}),i.jsx(hr,{dividers:!0,children:r&&!t?i.jsx(B,{variant:"body2",children:"Loading task details"}):t?i.jsxs(ut,{spacing:3,children:[i.jsxs(Z,{children:[i.jsxs(ut,{direction:"row",spacing:2,alignItems:"center",flexWrap:"wrap",children:[i.jsx(B,{variant:"h5",children:t.title}),i.jsx(ot,{label:t.status.replace("_"," "),color:t.status==="completed"?"success":"default"})]}),t.description&&i.jsx(B,{variant:"body1",sx:{mt:1},color:"text.secondary",children:t.description})]}),i.jsxs(ut,{direction:{xs:"column",sm:"row"},spacing:3,children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",children:"Due date"}),i.jsx(B,{variant:"body1",children:xh(t.dueDate)})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",children:"Last updated"}),i.jsx(B,{variant:"body1",children:xh(t.updatedAt)})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",children:"Completed at"}),i.jsx(B,{variant:"body1",children:xh(t.completedAt)})]})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Assigned team members"}),t.assignees.length===0?i.jsx(B,{variant:"body2",color:"text.secondary",children:"No assignees yet."}):i.jsx(ut,{direction:"row",spacing:1,flexWrap:"wrap",children:t.assignees.map(m=>i.jsx(ot,{label:m.username||m.email},m.id))})]}),i.jsx(Vn,{}),i.jsxs(ut,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:{xs:"flex-start",sm:"center"},children:[i.jsx(vR,{completed:t.status==="completed",onToggle:v,disabled:f}),i.jsx(xe,{variant:"outlined",onClick:a,children:"Edit task"})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Notes"}),t.notes&&t.notes.length>0?i.jsx(pa,{dense:!0,children:t.notes.map(m=>i.jsx(Sa,{alignItems:"flex-start",disableGutters:!0,children:i.jsx(Qn,{primary:m.note,secondary:m.authorName?`${m.authorName}  ${xh(m.createdAt)}`:xh(m.createdAt)})},m.id))}):i.jsx(B,{variant:"body2",color:"text.secondary",children:"No notes yet."})]}),i.jsxs(ut,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:{xs:"stretch",sm:"center"},children:[i.jsx(Pe,{label:"Add a note",fullWidth:!0,value:l,onChange:m=>c(m.target.value),multiline:!0,minRows:2}),i.jsx(xe,{variant:"contained",onClick:p,disabled:!l.trim()||u,children:"Add note"})]})]}):i.jsx(B,{variant:"body2",children:"Task not found."})}),i.jsx(_r,{children:i.jsx(xe,{onClick:n,children:"Close"})})]})},Ahe=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}],Phe=e=>{if(!e)return"";try{const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toISOString().slice(0,10)}catch{return""}},Ohe=({open:e,mode:t,initialTask:r,assignees:n,submitting:a,onClose:o,onSubmit:s})=>{const[l,c]=x.useState(""),[u,d]=x.useState(""),[f,h]=x.useState(""),[p,v]=x.useState("pending"),[m,y]=x.useState([]),[b,_]=x.useState(""),[w,A]=x.useState({});x.useEffect(()=>{e&&(t==="edit"&&r?(c(r.title),d(r.description??""),h(Phe(r.dueDate)),v(r.status),y(r.assignees.map(S=>S.id))):(c(""),d(""),h(""),v("pending"),y([])),_(""),A({}))},[e,t,r]);const P=x.useMemo(()=>[...n].sort((S,I)=>(S.username||S.email||"").localeCompare(I.username||I.email||"")),[n]),E=async()=>{const S=l.trim();if(!S){A({title:"Title is required"});return}const I=u.trim(),U={title:S,description:I.length>0?I:null,dueDate:f?new Date(f).toISOString():null,status:p,assigneeIds:m};t==="create"&&b.trim()&&(U.initialNote=b.trim()),await s(U)},T=t==="create"?"Create task":"Edit task";return i.jsxs(dr,{open:e,onClose:o,fullWidth:!0,maxWidth:"sm",children:[i.jsx(fr,{children:T}),i.jsx(hr,{children:i.jsxs(ut,{spacing:3,sx:{mt:1},children:[i.jsx(Pe,{label:"Title",value:l,onChange:S=>c(S.target.value),error:!!w.title,helperText:w.title,required:!0,autoFocus:!0}),i.jsx(Pe,{label:"Description",value:u,onChange:S=>d(S.target.value),multiline:!0,minRows:3}),i.jsx(Pe,{label:"Due date",type:"date",value:f,onChange:S=>h(S.target.value),InputLabelProps:{shrink:!0}}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{id:"task-status-select",children:"Status"}),i.jsx(ln,{labelId:"task-status-select",value:p,label:"Status",onChange:S=>v(S.target.value),children:Ahe.map(S=>i.jsx(Jt,{value:S.value,children:S.label},S.value))})]}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(sn,{id:"task-assignees-label",children:"Assign to"}),i.jsx(ln,{labelId:"task-assignees-label",multiple:!0,value:m.map(String),onChange:S=>{const I=S.target.value,U=typeof I=="string"?I.split(","):I;y(U.map(O=>Number(O)).filter(O=>!Number.isNaN(O)))},input:i.jsx(TI,{label:"Assign to"}),renderValue:S=>{const I=S;return I.length===0?"No assignees":I.map(U=>{const O=P.find(M=>M.id===Number(U));return O?.username||O?.email||U}).join(", ")},children:P.map(S=>i.jsx(Jt,{value:String(S.id),children:i.jsx(Qn,{primary:S.username||S.email})},S.id))})]}),t==="create"&&i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Initial note (optional)"}),i.jsx(Pe,{placeholder:"Share context with your team",value:b,onChange:S=>_(S.target.value),fullWidth:!0,multiline:!0,minRows:2})]})]})}),i.jsxs(_r,{children:[i.jsx(xe,{onClick:o,disabled:a,children:"Cancel"}),i.jsx(xe,{onClick:E,variant:"contained",disabled:a,children:t==="create"?"Create task":"Save changes"})]})]})};var bh={},lI;function khe(){if(lI)return bh;lI=1;var e=ir();Object.defineProperty(bh,"__esModule",{value:!0}),bh.default=void 0;var t=e(sr()),r=or();return bh.default=(0,t.default)((0,r.jsx)("path",{d:"M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V10h14zM9 14H7v-2h2zm4 0h-2v-2h2zm4 0h-2v-2h2zm-8 4H7v-2h2zm4 0h-2v-2h2zm4 0h-2v-2h2z"}),"CalendarMonth"),bh}var Ehe=khe();const The=Et(Ehe),Ihe={pending:"Pending",in_progress:"In Progress",completed:"Completed",archived:"Archived"},Nhe={pending:"warning",in_progress:"info",completed:"success",archived:"default"},Dhe=({tasks:e,loading:t,onSelectTask:r})=>{const n=x.useMemo(()=>{const h=new Map;return e.forEach(p=>{if(!p.dueDate)return;const v=Rt(p.dueDate);if(!v.isValid())return;const m=v.format("YYYY-MM-DD"),y=h.get(m)??[];y.push(p),h.set(m,y)}),h.forEach(p=>{p.sort((v,m)=>{const y=Rt(v.dueDate??0).valueOf(),b=Rt(m.dueDate??0).valueOf();return y-b})}),h},[e]),a=x.useMemo(()=>{if(n.size===0)return Rt();const h=Rt().format("YYYY-MM-DD");if(n.has(h))return Rt();const p=Array.from(n.keys()).sort()[0];return p?Rt(p):Rt()},[n]),[o,s]=x.useState(a);x.useEffect(()=>{const h=o.format("YYYY-MM-DD");if(n.size===0||n.has(h))return;const p=Rt(),v=p.format("YYYY-MM-DD");if(n.has(v)){s(p);return}const m=Array.from(n.keys()).sort()[0];m&&s(Rt(m))},[o,n]);const l=o.format("YYYY-MM-DD"),c=n.get(l)??[],u=n.size>0,d=Rt(),f=h=>{const p=h.day.format("YYYY-MM-DD"),v=n.get(p)??[],m=v.length>0,y=v.some(b=>b.dueDate&&Rt(b.dueDate).isBefore(d)&&b.status!=="completed");return i.jsx(Yw,{overlap:"circular",variant:m?"dot":"standard",color:y?"error":"primary",anchorOrigin:{vertical:"bottom",horizontal:"right"},children:i.jsx(L8,{...h,sx:{...m?{fontWeight:600}:null}})},p)};return i.jsx(Rr,{sx:{borderRadius:3,border:"1px solid",borderColor:"divider",boxShadow:"0 24px 60px -36px rgba(15, 23, 42, 0.35)"},children:i.jsxs(Hr,{sx:{p:{xs:3,md:4}},children:[i.jsxs(ut,{direction:"row",spacing:1.5,alignItems:"center",mb:2,children:[i.jsx(The,{color:"primary"}),i.jsx(B,{variant:"h5",component:"h2",sx:{fontWeight:600},children:"Due date calendar"})]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Visualize upcoming deadlines and jump directly to the tasks that need your attention."}),i.jsxs(ut,{direction:{xs:"column",lg:"row"},spacing:{xs:3,lg:4},mt:3,alignItems:{xs:"stretch",lg:"flex-start"},children:[i.jsx(M8,{value:o,onChange:h=>h&&s(h),views:["day"],slots:{day:f},sx:{borderRadius:2,border:"1px solid",borderColor:"divider",p:1.5}}),i.jsxs(Z,{sx:{flex:1,width:"100%"},children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:o.format("MMMM D, YYYY")}),t?i.jsx(Z,{display:"flex",justifyContent:"center",py:4,children:i.jsx(er,{size:28})}):u?c.length===0?i.jsx(Z,{sx:{mt:2,p:3,borderRadius:2,border:"1px dashed",borderColor:"divider",textAlign:"center",color:"text.secondary"},children:i.jsx(B,{variant:"body2",children:"No tasks are due on this day. Select another date to explore upcoming work."})}):i.jsx(ut,{spacing:1.5,mt:2,children:c.map(h=>{const p=Rt(h.dueDate),v=h.dueDate&&p.isBefore(d)&&h.status!=="completed";return i.jsx(Z,{onClick:()=>r?.(h),role:r?"button":void 0,tabIndex:r?0:void 0,onKeyDown:m=>{r&&(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),r(h))},sx:{p:2.25,borderRadius:2,border:"1px solid",borderColor:"divider",backgroundColor:"background.paper",cursor:r?"pointer":"default",transition:"all 0.2s ease-in-out","&:hover":r?{borderColor:"primary.main",boxShadow:3}:void 0},children:i.jsxs(ut,{spacing:1,children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:h.title}),h.description&&i.jsx(B,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:h.description}),i.jsxs(ut,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",useFlexGap:!0,children:[i.jsx(ot,{label:Ihe[h.status],color:Nhe[h.status],size:"small"}),v&&i.jsx(ot,{label:"Overdue",color:"error",size:"small",variant:"outlined"}),h.dueDate&&i.jsx(ot,{label:`Due ${p.format("MMM D, YYYY")}`,color:"info",size:"small",variant:"outlined"})]})]})},h.id)})}):i.jsx(Z,{sx:{mt:2,p:3,borderRadius:2,border:"1px dashed",borderColor:"divider",textAlign:"center",color:"text.secondary"},children:i.jsx(B,{variant:"body2",children:"None of your tasks have due dates yet. Add due dates to see them on the calendar."})})]})]})]})})},cI=e=>[...e].sort((t,r)=>t-r),Mhe=(e,t)=>{if(e.length!==t.length)return!1;const r=cI(e),n=cI(t);return r.every((a,o)=>a===n[o])},uI={includeCompleted:!1,includeArchived:!1},Lhe=()=>{const[e,t]=x.useState([]),[r,n]=x.useState(uI),[a,o]=x.useState([]),[s,l]=x.useState(null),[c,u]=x.useState(!0),[d,f]=x.useState(null),[h,p]=x.useState(null),[v,m]=x.useState(!1),[y,b]=x.useState(!1),[_,w]=x.useState(!1),[A,P]=x.useState("create"),[E,T]=x.useState(!1),[S,I]=x.useState(null),U=x.useCallback(async()=>{u(!0),f(null);try{const[H,W]=await Promise.all([mne(r),vw()]);t(H),l(W)}catch(H){console.error(H),f("Failed to load tasks. Please try again later.")}finally{u(!1)}},[r]),O=x.useCallback(async()=>{try{const H=await vw();l(H)}catch(H){console.error("Failed to refresh task summary",H)}},[]);x.useEffect(()=>{U()},[U]),x.useEffect(()=>{(async()=>{try{const W=await jne();o(W)}catch(W){console.error(W),me.error("Unable to load team members")}})()},[]);const M=H=>{n(H)},L=()=>{n(uI)},q=()=>{U()},z=()=>{P("create"),I(null),w(!0)},K=H=>{P("edit"),I(H),w(!0)},J=async H=>{b(!0);try{const W=await gne(H.id);p(W),m(!0)}catch(W){console.error(W),me.error("Unable to load task details")}finally{b(!1)}},R=x.useCallback(H=>{t(W=>W.some(se=>se.id===H.id)?W.map(se=>se.id===H.id?{...se,...H}:se):[H,...W])},[]),k=async H=>{try{if(T(!0),A==="create"){const W=await vne({...H,description:H.description??null});me.success("Task created successfully"),w(!1),I(null),R(W)}else if(A==="edit"&&S){const W=await yne(S.id,{title:H.title,description:H.description??null,status:H.status,dueDate:H.dueDate??null}),ne=S.assignees?.map(ae=>ae.id)??[],oe=!Mhe(ne,H.assigneeIds)?await xne(S.id,H.assigneeIds):{...W,assignees:S.assignees};me.success("Task updated successfully"),w(!1),I(null),R(oe),p(ae=>ae&&ae.id===oe.id?{...ae,...oe,notes:ae.notes}:ae)}await U()}catch(W){console.error(W),me.error("Failed to save task changes")}finally{T(!1)}},$=async(H,W)=>{try{const ne=await bne(H.id,W);R(ne),p(se=>se&&se.id===ne.id?{...se,...ne,notes:se.notes}:se),me.success(W?"Task marked as completed":"Task reopened"),await O()}catch(ne){console.error(ne),me.error("Failed to update task status")}},X=async H=>{if(window.confirm(`Delete task "${H.title}"? This action cannot be undone.`))try{await wne(H.id),t(ne=>ne.filter(se=>se.id!==H.id)),h?.id===H.id&&(m(!1),p(null)),me.success("Task deleted"),await U()}catch(ne){console.error(ne),me.error("Failed to delete task")}},C=async H=>{if(h)try{const W=await _ne(h.id,H);p(ne=>ne&&{...ne,notes:[W,...ne.notes??[]],noteCount:(ne.noteCount??0)+1,lastNoteAt:W.createdAt}),t(ne=>ne.map(se=>se.id===h.id?{...se,noteCount:se.noteCount+1,lastNoteAt:W.createdAt}:se)),me.success("Note added")}catch(W){console.error(W),me.error("Failed to add note")}},N=x.useMemo(()=>r,[r]);return i.jsxs(rr,{maxWidth:"lg",sx:{py:4},children:[i.jsxs(ut,{spacing:3,children:[i.jsx(BL,{summary:s,loading:c&&e.length===0,onRefresh:q}),i.jsx(Dhe,{tasks:e,loading:c&&e.length===0,onSelectTask:J}),i.jsxs(bt,{sx:{p:{xs:2.5,md:4},borderRadius:3,border:"1px solid",borderColor:"divider",boxShadow:"0 24px 60px -36px rgba(15, 23, 42, 0.45)",background:"linear-gradient(145deg, rgba(15, 118, 110, 0.04) 0%, rgba(30, 64, 175, 0.05) 100%)"},children:[i.jsxs(ut,{direction:{xs:"column",md:"row"},spacing:2,justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Tasks"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Manage assignments, due dates, and shared notes for your team."})]}),i.jsxs(ut,{direction:"row",spacing:1,children:[i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Ts,{}),onClick:q,children:"Refresh"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:z,children:"New task"})]})]}),i.jsx(Z,{sx:{mt:3},children:i.jsx(ghe,{filters:N,assignees:a,onChange:M,onReset:L})}),d&&i.jsx(Pt,{severity:"error",sx:{mt:2},children:d}),i.jsx(Z,{sx:{mt:3},children:c&&e.length===0?i.jsx(Z,{display:"flex",justifyContent:"center",py:6,children:i.jsx(er,{})}):i.jsx(She,{tasks:e,onSelect:J,onToggleComplete:$,onEdit:K,onDelete:X})})]})]}),i.jsx(Che,{open:v,task:h,loading:y,onClose:()=>m(!1),onEdit:()=>{h&&K(h)},onToggleComplete:H=>h?$(h,H):Promise.resolve(),onAddNote:C}),i.jsx(Ohe,{open:_,mode:A,initialTask:S,assignees:a,submitting:E,onClose:()=>w(!1),onSubmit:k})]})},Rhe=async(e="all")=>(await ve.get("/api/return-orders",{params:{status:e}})).data,qhe=async e=>(await ve.get(`/api/return-orders/${e}`)).data,Fhe=async e=>(await ve.post("/api/return-orders",e)).data,$he=async(e,t)=>{await ve.put(`/api/return-orders/${e}`,t)},Bhe=async e=>{await ve.delete(`/api/return-orders/${e}`)},Uhe=async e=>(await ve.get(`/api/return-orders/by-purchase/${e}`)).data,zhe=async(e,t)=>{const n=(await ve.get(`/api/return-orders/purchase/${e}/line-items`,{params:t?{excludeReturnId:t}:void 0})).data;return Array.isArray(n)?n:Array.isArray(n?.items)?n.items:Array.isArray(n?.available_items)?n.available_items:[]},Whe=e=>{if(!e)return;const t=/filename\*=UTF-8''([^;]+)/i.exec(e);if(t?.[1])try{return decodeURIComponent(t[1])}catch{return t[1]}return/filename="?([^";]+)"?/i.exec(e)?.[1]},Hhe=async e=>{try{const t=await ve.get(`/api/return-orders/${e}/pdf`,{responseType:"blob"}),r=new Blob([t.data],{type:"application/pdf"}),n=window.URL.createObjectURL(r),a=Whe(t.headers["content-disposition"])||`return-order-${e}.pdf`,o=document.createElement("a");return o.href=n,o.setAttribute("download",a),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(n),!0}catch(t){return console.error("Failed to download return order PDF",t),!1}},Vhe=[{label:"All",value:"all"},{label:"Return Requested",value:"Requested"},{label:"Returned",value:"Returned"}],Ghe=()=>{const[e,t]=x.useState("Requested"),[r,n]=x.useState(""),[a,o]=x.useState([]),[s,l]=x.useState(!1),[c,u]=x.useState(null),d=kn(),f=x.useCallback(async()=>{l(!0);try{const m=await Rhe(e);o(m)}catch(m){console.error("Failed to load return orders",m),o([])}finally{l(!1)}},[e]);x.useEffect(()=>{f()},[f]);const h=x.useMemo(()=>{if(!r)return a;const m=r.toLowerCase();return a.filter(y=>y.return_number?.toLowerCase().includes(m)||y.purchase_number?.toLowerCase().includes(m)||y.vendor_name?.toLowerCase().includes(m))},[a,r]),p=x.useCallback(async m=>{if(window.confirm(`Delete return order ${m.return_number}? This will restore any associated inventory adjustments.`)){u(m.return_id);try{await Bhe(m.return_id),me.success(`Return order ${m.return_number} deleted.`),await f()}catch(b){console.error("Failed to delete return order",b);const _=b?.response?.data?.error||"Failed to delete return order.";me.error(_)}finally{u(null)}}},[f]),v=[{field:"return_number",headerName:"Return #",flex:1,minWidth:150,renderCell:m=>i.jsx(B,{color:"primary",sx:{cursor:"pointer"},children:m.value})},{field:"purchase_number",headerName:"Purchase Order",flex:1,minWidth:150,renderCell:m=>i.jsx(B,{color:"primary",sx:{cursor:"pointer"},children:m.value||"-"})},{field:"vendor_name",headerName:"Vendor",flex:1.3,minWidth:160,valueGetter:m=>m.value||"No Vendor"},{field:"status",headerName:"Status",flex:.8,minWidth:130,renderCell:m=>i.jsx(ot,{label:m.value,color:m.value==="Returned"?"success":"warning",variant:"outlined",size:"small"})},{field:"requested_at",headerName:"Requested On",flex:.9,minWidth:150,valueFormatter:m=>m.value?Rt(m.value).format("YYYY-MM-DD HH:mm"):""},{field:"returned_at",headerName:"Returned On",flex:.9,minWidth:150,valueFormatter:m=>m.value?Rt(m.value).format("YYYY-MM-DD HH:mm"):""},{field:"total_quantity",headerName:"Total Qty",flex:.6,minWidth:110,type:"number",valueFormatter:m=>Number(m.value??0).toFixed(2)},{field:"actions",headerName:"Actions",sortable:!1,filterable:!1,width:80,renderCell:m=>i.jsx(ut,{direction:"row",spacing:.5,children:i.jsx(vr,{size:"small",color:"error","aria-label":"Delete return order",disabled:c===m.row.return_id,onClick:y=>{y.stopPropagation(),p(m.row)},children:i.jsx(ga,{})})})}];return i.jsx(rr,{maxWidth:"xl",sx:{mt:4},children:i.jsxs(Z,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Return Orders"}),i.jsxs(ut,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:()=>d("/return-orders/new"),children:"New Return Order"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Ts,{}),onClick:f,disabled:s,children:"Refresh"})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsxs(ut,{direction:"row",spacing:3,sx:{mb:3},children:[i.jsx(Pe,{label:"Search",variant:"outlined",value:r,onChange:m=>n(m.target.value),InputProps:{startAdornment:i.jsx(aa,{position:"start",children:i.jsx(di,{sx:{fontSize:32}})}),sx:{fontSize:22,height:56}},sx:{minWidth:340,maxWidth:400,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"medium"}),Vhe.map(m=>i.jsx(ot,{label:m.label,onClick:()=>t(m.value),color:e===m.value?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}},m.value))]}),i.jsx(Po,{rows:h,columns:v,loading:s,getRowId:m=>m.return_id,disableRowSelectionOnClick:!0,onRowClick:m=>d(`/return-orders/${m.row.return_id}`),sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224,224,224,1)",cursor:"pointer"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224,224,224,1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"},cursor:"pointer"}})]})})]})})};function Yhe(){const e=Ds();return x.useMemo(()=>new URLSearchParams(e.search),[e.search])}const dI=()=>{const{id:e}=Ms(),t=kn(),r=Yhe(),n=!e||e==="new",[a,o]=x.useState(!0),[s,l]=x.useState(!1),[c,u]=x.useState([]),[d,f]=x.useState(null),[h,p]=x.useState("Requested"),[v,m]=x.useState(""),[y,b]=x.useState(void 0),[_,w]=x.useState(""),[A,P]=x.useState([]),[E,T]=x.useState(null),[S,I]=x.useState(null),[U,O]=x.useState({}),M=x.useCallback(async()=>{try{const X=(await dde({status:"all"})).map(C=>({label:`${C.purchase_number}  ${C.vendor_name??"No Vendor"}`,purchase_id:C.purchase_id,purchase_number:C.purchase_number,vendor_name:C.vendor_name}));return u(X),X}catch($){return console.error("Failed to load purchase orders",$),u([]),[]}},[]),L=x.useCallback(async $=>{try{const X=await Uhe($),C=X.filter(H=>H.status==="Requested").length,N=X.filter(H=>H.status==="Returned").length;O(H=>({...H,[$]:{requested:C,returned:N}}))}catch(X){console.warn("Unable to load return summary for purchase",X)}},[]),q=x.useCallback(async($,X,C)=>{try{const H=(await zhe($,C))?.map(W=>{const ne=X?.find(se=>se.purchase_line_item_id===W.line_item_id);return{purchase_line_item_id:W.line_item_id,part_number:W.part_number,part_description:W.part_description,unit:W.unit,quantityPurchased:W.quantity,returnable_quantity:W.returnable_quantity,already_requested:W.already_requested,inputQuantity:ne?String(ne.quantity):"",reason:ne?.reason??"",selected:!!ne}});P(H??[])}catch(N){console.error("Failed to load available return items",N),P([])}},[]);x.useEffect(()=>{(async()=>{const X=await M(),C=r.get("purchaseId");if(!n&&e){try{const N=await qhe(Number(e));T(N),p(N.status),m(N.requested_by??""),b(N.requested_at),w(N.notes??"");const H={label:`${N.purchase_number||""}  ${N.vendor_name||"No Vendor"}`,purchase_id:N.purchase_id,purchase_number:N.purchase_number||"",vendor_name:N.vendor_name||void 0};f(H),await q(N.purchase_id,N.line_items,N.return_id),await L(N.purchase_id)}catch(N){console.error("Failed to load return order detail",N),I("Unable to load return order.")}finally{o(!1)}return}if(C){const N=Number(C);if(Number.isFinite(N)){const W=(X.length?X:c).find(ne=>ne.purchase_id===N);W&&(f(W),await q(N),await L(N))}}o(!1)})()},[q,e,n,M,L,r]);const z=async($,X)=>{f(X),X?(await q(X.purchase_id,E?.line_items,E?.return_id??void 0),await L(X.purchase_id)):P([])},K=x.useMemo(()=>A.reduce(($,X)=>{if(!X.selected)return $;const C=parseFloat(X.inputQuantity||"0");return $+(Number.isFinite(C)?C:0)},0),[A]),J=x.useMemo(()=>A.some($=>$.returnable_quantity>0),[A]),R=x.useMemo(()=>A.some($=>$.selected),[A]),k=async()=>{if(I(null),!d){I("Select a purchase order before saving.");return}const $=A.filter(C=>C.selected).map(C=>({purchase_line_item_id:C.purchase_line_item_id,quantity:parseFloat(C.inputQuantity||"0"),reason:C.reason?.trim()?C.reason.trim():void 0,maxQuantity:C.returnable_quantity,part_number:C.part_number})).filter(C=>Number.isFinite(C.quantity)&&C.quantity>0);if($.length===0){I("Select at least one part and enter a quantity to return.");return}for(const C of $)if(C.quantity>(C.maxQuantity??0)+1e-6){I(`Return quantity for part ${C.part_number} exceeds the available quantity.`);return}const X={purchase_id:d.purchase_id,status:h,requested_by:v||void 0,requested_at:y,notes:_||void 0,line_items:$.map(({purchase_line_item_id:C,quantity:N,reason:H})=>({purchase_line_item_id:C,quantity:N,reason:H}))};try{if(l(!0),n){const C=await Fhe(X);me.success(`Return order ${C.return_number} created.`)}else e&&(await $he(Number(e),{status:X.status,requested_by:X.requested_by,requested_at:X.requested_at,notes:X.notes,line_items:X.line_items}),me.success("Return order updated."));t("/return-orders")}catch(C){console.error("Failed to save return order",C);const N=C?.response?.data?.error||"Unable to save return order.";I(N),me.error(N)}finally{l(!1)}};return a?i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:i.jsx(er,{})}):i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsxs(ut,{spacing:3,children:[i.jsxs(ut,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",component:"h1",children:n?"Create Return Order":`Return Order ${E?.return_number??""}`}),d&&i.jsxs(ut,{direction:"row",spacing:1,sx:{mt:1},children:[i.jsx(ot,{label:`Purchase: ${d.purchase_number}`,color:"primary",variant:"outlined"}),i.jsx(ot,{label:`Vendor: ${d.vendor_name??"No Vendor"}`,variant:"outlined",color:"secondary"}),U[d.purchase_id]&&i.jsx(ot,{label:`Returns - Requested: ${U[d.purchase_id].requested}  Completed: ${U[d.purchase_id].returned}`,color:"default",variant:"outlined"})]})]}),i.jsxs(ut,{direction:{xs:"column",sm:"row"},spacing:2,children:[i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Hp,{}),onClick:()=>t("/return-orders"),children:"Back to List"}),!n&&e&&i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:async()=>{await Hhe(Number(e))||me.error("Failed to download return order PDF. Please try again.")},children:"Download"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:k,disabled:s,children:s?"Saving":"Save & Close"})]})]}),S&&i.jsx(Pt,{severity:"error",children:S}),i.jsx(bt,{sx:{p:3},elevation:1,children:i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Ra,{options:c,value:d,onChange:z,getOptionLabel:$=>$.label,renderInput:$=>i.jsx(Pe,{...$,label:"Purchase Order",placeholder:"Select purchase order"}),disabled:!n&&!!E})}),i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsxs(Pe,{select:!0,SelectProps:{native:!0},label:"Status",value:h,onChange:$=>p($.target.value),fullWidth:!0,children:[i.jsx("option",{value:"Requested",children:"Requested"}),i.jsx("option",{value:"Returned",children:"Returned"})]})}),i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsx(Pe,{label:"Requested By",value:v,onChange:$=>m($.target.value),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Pe,{label:"Requested At",type:"datetime-local",fullWidth:!0,value:y?Rt(y).format("YYYY-MM-DDTHH:mm"):"",onChange:$=>b($.target.value?new Date($.target.value).toISOString():void 0),helperText:"Optional timestamp for when the return was requested"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Notes",value:_,onChange:$=>w($.target.value),multiline:!0,rows:3,fullWidth:!0,placeholder:"Add any notes for the vendor or internal team"})})]})}),i.jsx(bt,{sx:{p:3},elevation:1,children:i.jsxs(ut,{spacing:2,children:[i.jsxs(ut,{direction:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},children:[i.jsx(B,{variant:"h6",children:"Return Line Items"}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Total Selected Quantity: ",K.toFixed(2)]})]}),A.length>0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"Check the boxes to add parts to this return, then adjust the quantity being sent back."}),A.length===0?i.jsx(B,{variant:"body2",color:"text.secondary",children:"Select a purchase order to view parts eligible for return."}):i.jsxs(i.Fragment,{children:[!J&&i.jsx(Pt,{severity:"info",children:"All parts on this purchase order have already been requested for return."}),i.jsx(ma,{sx:{maxHeight:420},children:i.jsxs(ia,{size:"small",stickyHeader:!0,children:[i.jsx(oa,{children:i.jsxs(mr,{children:[i.jsx(Oe,{padding:"checkbox",children:"Select"}),i.jsx(Oe,{children:"Part Number"}),i.jsx(Oe,{children:"Description"}),i.jsx(Oe,{align:"right",children:"Purchased"}),i.jsx(Oe,{align:"right",children:"Available"}),i.jsx(Oe,{align:"right",children:"Qty to Return"}),i.jsx(Oe,{children:"Reason"})]})}),i.jsx(sa,{children:A.map($=>{const X=$.returnable_quantity<=0&&!$.selected;return i.jsxs(mr,{hover:!0,selected:$.selected,sx:{"&.Mui-selected":{backgroundColor:C=>C.palette.action.hover}},children:[i.jsx(Oe,{padding:"checkbox",children:i.jsx(Xi,{checked:$.selected,onChange:C=>{const N=C.target.checked;P(H=>H.map(W=>{if(W.purchase_line_item_id!==$.purchase_line_item_id)return W;const ne=W.returnable_quantity>0?String(W.returnable_quantity):"";return{...W,selected:N,inputQuantity:N?W.inputQuantity||ne:"",reason:N?W.reason:""}}))},disabled:X,inputProps:{"aria-label":`Select ${$.part_number}`}})}),i.jsxs(Oe,{children:[i.jsx(B,{variant:"body2",fontWeight:600,children:$.part_number}),$.unit&&i.jsxs(B,{variant:"caption",color:"text.secondary",display:"block",children:["Unit: ",$.unit]})]}),i.jsx(Oe,{children:i.jsx(B,{variant:"body2",children:$.part_description||"-"})}),i.jsx(Oe,{align:"right",children:i.jsx(B,{variant:"body2",children:$.quantityPurchased.toFixed(2)})}),i.jsxs(Oe,{align:"right",children:[i.jsx(B,{variant:"body2",children:$.returnable_quantity.toFixed(2)}),$.already_requested>0&&i.jsxs(B,{variant:"caption",color:"text.secondary",display:"block",children:["Already requested: ",$.already_requested.toFixed(2)]})]}),i.jsx(Oe,{align:"right",sx:{minWidth:140},children:i.jsx(Pe,{type:"number",size:"small",value:$.inputQuantity,onChange:C=>{const N=C.target.value;P(H=>H.map(W=>{if(W.purchase_line_item_id!==$.purchase_line_item_id)return W;const ne=parseFloat(N),se=!Number.isNaN(ne)&&ne>0;return{...W,inputQuantity:N,selected:se?!0:W.selected}}))},inputProps:{min:0,step:.01,max:$.returnable_quantity},fullWidth:!0,disabled:!$.selected})}),i.jsx(Oe,{sx:{minWidth:200},children:i.jsx(Pe,{size:"small",value:$.reason,onChange:C=>{const N=C.target.value;P(H=>H.map(W=>W.purchase_line_item_id===$.purchase_line_item_id?{...W,reason:N}:W))},placeholder:"Optional",fullWidth:!0,disabled:!$.selected,multiline:!0,minRows:1})})]},$.purchase_line_item_id)})})]})})]}),A.length>0&&!R&&J&&i.jsx(Pt,{severity:"info",children:"Select at least one part to include it in the return order."})]})})]})})};var _h={},fI;function Khe(){if(fI)return _h;fI=1;var e=ir();Object.defineProperty(_h,"__esModule",{value:!0}),_h.default=void 0;var t=e(sr()),r=or();return _h.default=(0,t.default)((0,r.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility"),_h}var Qhe=Khe();const hI=Et(Qhe);var wh={},pI;function Xhe(){if(pI)return wh;pI=1;var e=ir();Object.defineProperty(wh,"__esModule",{value:!0}),wh.default=void 0;var t=e(sr()),r=or();return wh.default=(0,t.default)((0,r.jsx)("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"}),"Replay"),wh}var Jhe=Xhe();const Zhe=Et(Jhe),epe=[{key:"customerPoNumber",label:"Customer PO #"},{key:"quotedPrice",label:"Quoted Price"},{key:"sourceQuote",label:"Source Quote"},{key:"vin",label:"VIN #"},{key:"unitNumber",label:"Unit #"},{key:"vehicleMake",label:"Vehicle Make"},{key:"vehicleModel",label:"Vehicle Model"},{key:"invoiceStatus",label:"Invoice Status"},{key:"wantedByDate",label:"Wanted By Date"},{key:"wantedByTimeOfDay",label:"Wanted By Time of Day"},{key:"productDescription",label:"Product Description"},{key:"terms",label:"Terms"},{key:"mileage",label:"Mileage"}],tpe=[{key:"vin",label:"VIN #"},{key:"productDescription",label:"Product Description"},{key:"unitNumber",label:"Unit #"},{key:"vehicleMake",label:"Vehicle Make"},{key:"vehicleModel",label:"Vehicle Model"},{key:"mileage",label:"Mileage"}],rpe=()=>{const{user:e}=Jn(),t=e?.access_role==="Admin",[r,n]=x.useState(kd),[a,o]=x.useState(!0),[s,l]=x.useState(!1),[c,u]=x.useState(null),[d,f]=x.useState(null);x.useEffect(()=>{(async()=>{o(!0),u(null);try{const y=await Cv.fetchSettings();n(y)}catch(y){console.error("Failed to load field visibility settings",y),u("Could not load field visibility settings. Using defaults.")}finally{o(!1)}})()},[]);const h=(y,b)=>(_,w)=>{n(A=>({...A,[y]:{...A[y],[b]:w}}))},p=()=>{n(kd),f(null),u(null)},v=async()=>{if(!t){u("Only admins can change field visibility defaults.");return}l(!0),u(null),f(null);try{const y=await Cv.updateSettings(r);n(y),f("Field visibility updated. Users can still adjust their own view within these limits.")}catch(y){console.error("Failed to save field visibility settings",y),u("Failed to save field visibility settings. Please try again.")}finally{l(!1)}},m=(y,b,_,w)=>i.jsxs(bt,{elevation:2,sx:{p:3},children:[i.jsxs(ut,{direction:"row",spacing:1,alignItems:"center",sx:{mb:1},children:[i.jsx(hI,{color:"primary"}),i.jsx(B,{variant:"h6",children:y})]}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:b}),i.jsx(ie,{container:!0,spacing:2,children:w.map(A=>i.jsx(ie,{item:!0,xs:12,sm:6,md:4,children:i.jsx(ui,{control:i.jsx(ac,{color:"primary",checked:!!r[_][A.key],onChange:h(_,A.key),disabled:!t}),label:A.label})},A.key))})]});return i.jsxs(rr,{maxWidth:"lg",children:[i.jsxs(ut,{direction:"row",alignItems:"center",spacing:1,sx:{mb:2},children:[i.jsx(hI,{color:"primary"}),i.jsx(B,{variant:"h5",children:"Field Visibility"}),i.jsx(ot,{label:"Admin default",color:"primary",size:"small"})]}),i.jsx(B,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Choose which sales order and invoice fields are available to users by default. Users can still hide fields locally with the Customize fields/columns toggles, but cannot turn on anything you disable here."}),c?i.jsx(Pt,{severity:"warning",sx:{mb:2},children:c}):null,d?i.jsx(Pt,{severity:"success",sx:{mb:2},children:d}):null,t?null:i.jsx(Pt,{severity:"info",sx:{mb:2},children:"Only admins can change these defaults. You can view the current configuration below."}),a?i.jsx(Z,{sx:{display:"flex",justifyContent:"center",py:6},children:i.jsx(er,{})}):i.jsxs(ut,{spacing:3,children:[m("Sales Orders","Toggle which optional fields appear on sales orders. These act as the baseline for all users.","salesOrders",epe),i.jsx(Vn,{}),m("Invoices","Toggle which optional fields appear on invoices.","invoices",tpe)]}),i.jsxs(ut,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mt:3},children:[i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Zhe,{}),onClick:p,disabled:!t||a||s,children:"Reset to defaults"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:v,disabled:!t||a||s,children:s?"Saving":"Save"})]})]})},npe=({children:e})=>{const{isAuthenticated:t,user:r}=Jn(),a=Ds().pathname;if(!t)return i.jsx(Ou,{to:"/login",replace:!0});if(r?.access_role==="Time Tracking"){if(a==="/"||a==="/dashboard")return i.jsx(Ou,{to:"/attendance",replace:!0});if(a!=="/time-tracking"&&a!=="/attendance"&&a!=="/messaging"&&!a.startsWith("/open-sales-orders")&&!a.startsWith("/worker-sales-orders"))return i.jsx(Ou,{to:"/attendance",replace:!0})}return r?.access_role==="Sales and Purchase"&&!["/","/open-sales-orders","/invoices","/open-purchase-orders","/purchase-order","/return-orders","/parts-to-order","/inventory","/inventory/smart-search","/supply","/service","/email-settings","/tasks","/messaging"].includes(a)&&!a.startsWith("/open-sales-orders/")&&!a.startsWith("/invoices/")&&!a.startsWith("/open-purchase-orders/")&&!a.startsWith("/purchase-order/")&&!a.startsWith("/return-orders/")?i.jsx(Ou,{to:"/",replace:!0}):r?.access_role==="Quotes"&&a!=="/quotes"&&!a.startsWith("/quotes/")&&a!=="/messaging"?i.jsx(Ou,{to:"/quotes",replace:!0}):i.jsx(i.Fragment,{children:e})},ape=()=>i.jsxs(Rq,{children:[i.jsx(ur,{path:"/login",element:i.jsx(Qre,{})}),i.jsx(ur,{path:"/register",element:i.jsx(Xre,{})}),i.jsxs(ur,{path:"/",element:i.jsx(npe,{children:i.jsx(Kre,{})}),children:[i.jsx(ur,{index:!0,element:i.jsx(X4,{})}),i.jsx(ur,{path:"dashboard",element:i.jsx(X4,{})}),i.jsx(ur,{path:"business-profile",element:i.jsx(Wne,{})}),i.jsx(ur,{path:"qbo-account-mapping",element:i.jsx(Hfe,{})}),i.jsx(ur,{path:"customers",element:i.jsx(pae,{})}),i.jsx(ur,{path:"customers/:id",element:i.jsx(Sae,{})}),i.jsx(ur,{path:"products",element:i.jsx(Ffe,{})}),i.jsx(ur,{path:"products/:id",element:i.jsx(Fae,{})}),i.jsx(ur,{path:"purchase-order",element:i.jsx(ET,{})}),i.jsx(ur,{path:"purchase-order/:id",element:i.jsx(MT,{})}),i.jsx(ur,{path:"open-purchase-orders",element:i.jsx(ET,{})}),i.jsx(ur,{path:"open-purchase-orders/:id",element:i.jsx(MT,{})}),i.jsx(ur,{path:"return-orders",element:i.jsx(Ghe,{})}),i.jsx(ur,{path:"return-orders/new",element:i.jsx(dI,{})}),i.jsx(ur,{path:"return-orders/:id",element:i.jsx(dI,{})}),i.jsx(ur,{path:"vendors",element:i.jsx(Rae,{})}),i.jsx(ur,{path:"vendors/:id",element:i.jsx(qae,{})}),i.jsx(ur,{path:"inventory",element:i.jsx(tie,{})}),i.jsx(ur,{path:"inventory/smart-search",element:i.jsx(Fue,{})}),i.jsx(ur,{path:"supply",element:i.jsx(rie,{})}),i.jsx(ur,{path:"service",element:i.jsx(nie,{})}),i.jsx(ur,{path:"employees",element:i.jsx(Bue,{})}),i.jsx(ur,{path:"profile-documents",element:i.jsx(Uue,{})}),i.jsx(ur,{path:"time-tracking",element:i.jsx(lfe,{})}),i.jsx(ur,{path:"attendance",element:i.jsx(Ufe,{})}),i.jsx(ur,{path:"time-tracking/reports",element:i.jsx(Pfe,{})}),i.jsx(ur,{path:"leave-management",element:i.jsx(Mfe,{})}),i.jsx(ur,{path:"leave-history",element:i.jsx(Lfe,{})}),i.jsx(ur,{path:"vacation-days-management",element:i.jsx(Rfe,{})}),i.jsx(ur,{path:"open-sales-orders",element:i.jsx(tde,{})}),i.jsx(ur,{path:"open-sales-orders/:id",element:i.jsx(ude,{})}),i.jsx(ur,{path:"invoices",element:i.jsx(Pde,{})}),i.jsx(ur,{path:"invoices/:id",element:i.jsx(kde,{})}),i.jsx(ur,{path:"worker-sales-orders",element:i.jsx(zT,{})}),i.jsx(ur,{path:"worker-sales-orders/:id",element:i.jsx(zT,{})}),i.jsx(ur,{path:"quotes",element:i.jsx(sle,{})}),i.jsx(ur,{path:"quotes/new",element:i.jsx(fT,{})}),i.jsx(ur,{path:"quotes/:id",element:i.jsx(fT,{})}),i.jsx(ur,{path:"margin-schedule",element:i.jsx(zue,{})}),i.jsx(ur,{path:"overhead-management",element:i.jsx(Vfe,{})}),i.jsx(ur,{path:"parts-to-order",element:i.jsx(Gfe,{})}),i.jsx(ur,{path:"tasks",element:i.jsx(Lhe,{})}),i.jsx(ur,{path:"backup-management",element:i.jsx(Bfe,{})}),i.jsx(ur,{path:"field-visibility",element:i.jsx(rpe,{})}),i.jsx(ur,{path:"mobile-user-access",element:i.jsx(Yfe,{})}),i.jsx(ur,{path:"email-settings",element:i.jsx(the,{})}),i.jsx(ur,{path:"invoice-automator",element:i.jsx(lhe,{})}),i.jsx(ur,{path:"email-templates",element:i.jsx(che,{})}),i.jsx(ur,{path:"tasks/:id",element:i.jsx(mhe,{})}),i.jsx(ur,{path:"messaging",element:i.jsx(yue,{})})]}),i.jsx(ur,{path:"*",element:i.jsx(Ou,{to:"/",replace:!0})})]}),ipe=()=>{const[e,t]=x.useState(0),[r,n]=x.useState(!!window.__backendUnavailableSince),[a,o]=x.useState(typeof navigator<"u"?navigator.onLine===!1:!1),s=x.useRef(0),l=x.useRef(r),c=x.useRef(a);return x.useEffect(()=>{l.current=r},[r]),x.useEffect(()=>{c.current=a},[a]),x.useEffect(()=>{window.__triggerSync=async()=>{try{await Sh()>0&&!window.__backendUnavailableSince&&!l.current&&!c.current&&(await R5(),t(await Sh()))}catch{}};let u=!0;const d=async()=>{try{const h=await Sh();if(u&&t(h),!window.__backendUnavailableSince&&!l.current&&!c.current&&h>0){await R5();const p=await Sh();u&&t(p)}}catch{}},f=setInterval(d,15e3);return d(),()=>{u=!1,clearInterval(f)}},[]),x.useEffect(()=>{const u=()=>Date.now(),d=()=>{const b=s.current||0,_=u();return _-b<3e3?!1:(s.current=_,!0)},f=()=>{o(!0),d()&&me.warn("You appear to be offline. We will retry automatically.")},h=()=>{o(!1),n(!1),d()&&me.success("Connection restored.")},p=()=>{n(!0),d()&&me.error("Cannot reach the server. We will keep retrying.")},v=()=>{n(!1)},m=b=>{const _=b?.detail;_?.message&&d()&&me.error(_.message)},y=()=>{d()&&me.error("Session expired. Please sign in again.")};return window.addEventListener("offline",f),window.addEventListener("online",h),window.addEventListener("backend:unavailable",p),window.addEventListener("backend:available",v),window.addEventListener("app:error",m),window.addEventListener("auth:expired",y),()=>{window.removeEventListener("offline",f),window.removeEventListener("online",h),window.removeEventListener("backend:unavailable",p),window.removeEventListener("backend:available",v),window.removeEventListener("app:error",m),window.removeEventListener("auth:expired",y)}},[a]),i.jsxs(R8,{theme:k7,children:[i.jsx(q8,{}),i.jsx(A7,{children:i.jsx(O7,{children:i.jsxs(Os,{dateAdapter:oc,children:[i.jsx(Wq,{children:i.jsx(ape,{})}),i.jsx(Une,{position:"top-right",autoClose:3e3,newestOnTop:!1,closeOnClick:!0,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"colored"})]})})})]})};z8.createRoot(document.getElementById("root")).render(i.jsx(ipe,{}));export{Ht as _};
