const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-CRvpoM4X.js","assets/vendor-Bs7gn1Hv.js","assets/mui-CPySk4Sq.js"])))=>i.map(i=>d[i]);
import{r as y,R as c8,j as i,c as u8,b as d8,_ as wI,u as f8,a as cr,d as ur,e as Nr,f as Ce,P as _n,g as jI,h as h8,B as J,i as yn,A as Tp,T as B,I as pr,k as ye,l as Ae,F as ri,S as hl,C as nr,m as En,n as p8,o as m8,p as xt,D as Gn,q as g8,s as R2,t as t5,v as Bu,w as lg,x as cg,y as di,z as SI,L as q2,E as xs,G as $h,H as CI,J as r5,K as Nc,Q as AI,M as PI,N as v8,O as OI,U as Qw,V as ug,W as kI,X as dg,Y as Xw,Z as nx,$ as ga,a0 as y8,a1 as Ca,a2 as x8,a3 as Jw,a4 as Jn,a5 as b8,a6 as TI,a7 as _8,a8 as w8,a9 as n5,aa as ir,ab as Ot,ac as Xi,ad as j8,ae as ie,af as Br,ag as Vr,ah as ct,ai as a5,aj as oa,ak as i5,al as gr,am as vr,an as yr,ao as Cr,ap as Ed,aq as Po,ar as ot,as as tr,at as xn,au as S8,av as Xt,aw as EI,ax as pl,ay as tn,az as fn,aA as hn,aB as Os,aC as Fa,aD as os,aE as Iv,aF as C8,aG as A8,aH as P8,aI as F2,aJ as al,aK as va,aL as sa,aM as la,aN as br,aO as Pe,aP as ca,aQ as jh,aR as Eu,aS as II,aT as Id,aU as Ep,aV as fg,aW as Nv,aX as o5,aY as NI,aZ as O8,a_ as k8,a$ as Ip,b0 as DI,b1 as $2,b2 as Uu,b3 as zu,b4 as T8,b5 as E8,b6 as I8,b7 as N8,b8 as MI,b9 as LI,ba as D8,bb as M8,bc as RI,bd as L8,be as Zw,bf as s5,bg as ax,bh as l5,bi as R8,bj as q8,bk as F8,bl as c5,bm as Bh,bn as qI,bo as $8,bp as B8,bq as U8,br as z8,bs as W8,bt as H8}from"./mui-CPySk4Sq.js";import{a as V8,g as It,b as G8,c as pm}from"./vendor-Bs7gn1Hv.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=r(a);fetch(a.href,o)}})();var mm={},u5;function Y8(){if(u5)return mm;u5=1;var e=V8();return mm.createRoot=e.createRoot,mm.hydrateRoot=e.hydrateRoot,mm}var K8=Y8();const Q8=It(K8);/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Uh(){return Uh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Uh.apply(this,arguments)}var Yl;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Yl||(Yl={}));const d5="popstate";function X8(e){e===void 0&&(e={});function t(a,o){let{pathname:s="/",search:l="",hash:c=""}=nu(a.location.hash.substr(1));return!s.startsWith("/")&&!s.startsWith(".")&&(s="/"+s),B2("",{pathname:s,search:l,hash:c},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function r(a,o){let s=a.document.querySelector("base"),l="";if(s&&s.getAttribute("href")){let c=a.location.href,u=c.indexOf("#");l=u===-1?c:c.slice(0,u)}return l+"#"+(typeof o=="string"?o:hg(o))}function n(a,o){ej(a.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(o)+")")}return Z8(t,r,n,e)}function Oa(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function ej(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function J8(){return Math.random().toString(36).substr(2,8)}function f5(e,t){return{usr:e.state,key:e.key,idx:t}}function B2(e,t,r,n){return r===void 0&&(r=null),Uh({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?nu(t):t,{state:r,key:t&&t.key||n||J8()})}function hg(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function nu(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function Z8(e,t,r,n){n===void 0&&(n={});let{window:a=document.defaultView,v5Compat:o=!1}=n,s=a.history,l=Yl.Pop,c=null,u=d();u==null&&(u=0,s.replaceState(Uh({},s.state,{idx:u}),""));function d(){return(s.state||{idx:null}).idx}function f(){l=Yl.Pop;let x=d(),b=x==null?null:x-u;u=x,c&&c({action:l,location:m.location,delta:b})}function h(x,b){l=Yl.Push;let _=B2(m.location,x,b);r&&r(_,x),u=d()+1;let w=f5(_,u),A=m.createHref(_);try{s.pushState(w,"",A)}catch(O){if(O instanceof DOMException&&O.name==="DataCloneError")throw O;a.location.assign(A)}o&&c&&c({action:l,location:m.location,delta:1})}function p(x,b){l=Yl.Replace;let _=B2(m.location,x,b);r&&r(_,x),u=d();let w=f5(_,u),A=m.createHref(_);s.replaceState(w,"",A),o&&c&&c({action:l,location:m.location,delta:0})}function g(x){let b=a.location.origin!=="null"?a.location.origin:a.location.href,_=typeof x=="string"?x:hg(x);return _=_.replace(/ $/,"%20"),Oa(b,"No window.location.(origin|href) available to create URL for href: "+_),new URL(_,b)}let m={get action(){return l},get location(){return e(a,s)},listen(x){if(c)throw new Error("A history only accepts one active listener");return a.addEventListener(d5,f),c=x,()=>{a.removeEventListener(d5,f),c=null}},createHref(x){return t(a,x)},createURL:g,encodeLocation(x){let b=g(x);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:h,replace:p,go(x){return s.go(x)}};return m}var h5;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(h5||(h5={}));function eq(e,t,r){return r===void 0&&(r="/"),tq(e,t,r)}function tq(e,t,r,n){let a=typeof t=="string"?nu(t):t,o=tj(a.pathname||"/",r);if(o==null)return null;let s=FI(e);rq(s);let l=null;for(let c=0;l==null&&c<s.length;++c){let u=pq(o);l=dq(s[c],u)}return l}function FI(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let a=(o,s,l)=>{let c={relativePath:l===void 0?o.path||"":l,caseSensitive:o.caseSensitive===!0,childrenIndex:s,route:o};c.relativePath.startsWith("/")&&(Oa(c.relativePath.startsWith(n),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(n.length));let u=Jl([n,c.relativePath]),d=r.concat(c);o.children&&o.children.length>0&&(Oa(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),FI(o.children,t,d,u)),!(o.path==null&&!o.index)&&t.push({path:u,score:cq(u,o.index),routesMeta:d})};return e.forEach((o,s)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))a(o,s);else for(let c of $I(o.path))a(o,s,c)}),t}function $I(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,a=r.endsWith("?"),o=r.replace(/\?$/,"");if(n.length===0)return a?[o,""]:[o];let s=$I(n.join("/")),l=[];return l.push(...s.map(c=>c===""?o:[o,c].join("/"))),a&&l.push(...s),l.map(c=>e.startsWith("/")&&c===""?"/":c)}function rq(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:uq(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const nq=/^:[\w-]+$/,aq=3,iq=2,oq=1,sq=10,lq=-2,p5=e=>e==="*";function cq(e,t){let r=e.split("/"),n=r.length;return r.some(p5)&&(n+=lq),t&&(n+=iq),r.filter(a=>!p5(a)).reduce((a,o)=>a+(nq.test(o)?aq:o===""?oq:sq),n)}function uq(e,t){return e.length===t.length&&e.slice(0,-1).every((n,a)=>n===t[a])?e[e.length-1]-t[t.length-1]:0}function dq(e,t,r){let{routesMeta:n}=e,a={},o="/",s=[];for(let l=0;l<n.length;++l){let c=n[l],u=l===n.length-1,d=o==="/"?t:t.slice(o.length)||"/",f=fq({path:c.relativePath,caseSensitive:c.caseSensitive,end:u},d),h=c.route;if(!f)return null;Object.assign(a,f.params),s.push({params:a,pathname:Jl([o,f.pathname]),pathnameBase:yq(Jl([o,f.pathnameBase])),route:h}),f.pathnameBase!=="/"&&(o=Jl([o,f.pathnameBase]))}return s}function fq(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=hq(e.path,e.caseSensitive,e.end),a=t.match(r);if(!a)return null;let o=a[0],s=o.replace(/(.)\/+$/,"$1"),l=a.slice(1);return{params:n.reduce((u,d,f)=>{let{paramName:h,isOptional:p}=d;if(h==="*"){let m=l[f]||"";s=o.slice(0,o.length-m.length).replace(/(.)\/+$/,"$1")}const g=l[f];return p&&!g?u[h]=void 0:u[h]=(g||"").replace(/%2F/g,"/"),u},{}),pathname:o,pathnameBase:s,pattern:e}}function hq(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),ej(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(s,l,c)=>(n.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),a+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?a+="\\/*$":e!==""&&e!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,t?void 0:"i"),n]}function pq(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return ej(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function tj(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function mq(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:a=""}=typeof e=="string"?nu(e):e;return{pathname:r?r.startsWith("/")?r:gq(r,t):t,search:xq(n),hash:bq(a)}}function gq(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(a=>{a===".."?r.length>1&&r.pop():a!=="."&&r.push(a)}),r.length>1?r.join("/"):"/"}function ix(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function vq(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function rj(e,t){let r=vq(e);return t?r.map((n,a)=>a===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function nj(e,t,r,n){n===void 0&&(n=!1);let a;typeof e=="string"?a=nu(e):(a=Uh({},e),Oa(!a.pathname||!a.pathname.includes("?"),ix("?","pathname","search",a)),Oa(!a.pathname||!a.pathname.includes("#"),ix("#","pathname","hash",a)),Oa(!a.search||!a.search.includes("#"),ix("#","search","hash",a)));let o=e===""||a.pathname==="",s=o?"/":a.pathname,l;if(s==null)l=r;else{let f=t.length-1;if(!n&&s.startsWith("..")){let h=s.split("/");for(;h[0]==="..";)h.shift(),f-=1;a.pathname=h.join("/")}l=f>=0?t[f]:"/"}let c=mq(a,l),u=s&&s!=="/"&&s.endsWith("/"),d=(o||s===".")&&r.endsWith("/");return!c.pathname.endsWith("/")&&(u||d)&&(c.pathname+="/"),c}const Jl=e=>e.join("/").replace(/\/\/+/g,"/"),yq=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),xq=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,bq=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function _q(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const BI=["post","put","patch","delete"];new Set(BI);const wq=["get",...BI];new Set(wq);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function zh(){return zh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},zh.apply(this,arguments)}const aj=y.createContext(null),jq=y.createContext(null),ic=y.createContext(null),Dv=y.createContext(null),Ns=y.createContext({outlet:null,matches:[],isDataRoute:!1}),UI=y.createContext(null);function Sq(e,t){let{relative:r}=t===void 0?{}:t;Nd()||Oa(!1);let{basename:n,navigator:a}=y.useContext(ic),{hash:o,pathname:s,search:l}=WI(e,{relative:r}),c=s;return n!=="/"&&(c=s==="/"?n:Jl([n,s])),a.createHref({pathname:c,search:l,hash:o})}function Nd(){return y.useContext(Dv)!=null}function Ds(){return Nd()||Oa(!1),y.useContext(Dv).location}function zI(e){y.useContext(ic).static||y.useLayoutEffect(e)}function Nn(){let{isDataRoute:e}=y.useContext(Ns);return e?Fq():Cq()}function Cq(){Nd()||Oa(!1);let e=y.useContext(aj),{basename:t,future:r,navigator:n}=y.useContext(ic),{matches:a}=y.useContext(Ns),{pathname:o}=Ds(),s=JSON.stringify(rj(a,r.v7_relativeSplatPath)),l=y.useRef(!1);return zI(()=>{l.current=!0}),y.useCallback(function(u,d){if(d===void 0&&(d={}),!l.current)return;if(typeof u=="number"){n.go(u);return}let f=nj(u,JSON.parse(s),o,d.relative==="path");e==null&&t!=="/"&&(f.pathname=f.pathname==="/"?t:Jl([t,f.pathname])),(d.replace?n.replace:n.push)(f,d.state,d)},[t,n,s,o,e])}const Aq=y.createContext(null);function Pq(e){let t=y.useContext(Ns).outlet;return t&&y.createElement(Aq.Provider,{value:e},t)}function Ms(){let{matches:e}=y.useContext(Ns),t=e[e.length-1];return t?t.params:{}}function WI(e,t){let{relative:r}=t===void 0?{}:t,{future:n}=y.useContext(ic),{matches:a}=y.useContext(Ns),{pathname:o}=Ds(),s=JSON.stringify(rj(a,n.v7_relativeSplatPath));return y.useMemo(()=>nj(e,JSON.parse(s),o,r==="path"),[e,s,o,r])}function Oq(e,t){return kq(e,t)}function kq(e,t,r,n){Nd()||Oa(!1);let{navigator:a}=y.useContext(ic),{matches:o}=y.useContext(Ns),s=o[o.length-1],l=s?s.params:{};s&&s.pathname;let c=s?s.pathnameBase:"/";s&&s.route;let u=Ds(),d;if(t){var f;let x=typeof t=="string"?nu(t):t;c==="/"||(f=x.pathname)!=null&&f.startsWith(c)||Oa(!1),d=x}else d=u;let h=d.pathname||"/",p=h;if(c!=="/"){let x=c.replace(/^\//,"").split("/");p="/"+h.replace(/^\//,"").split("/").slice(x.length).join("/")}let g=eq(e,{pathname:p}),m=Dq(g&&g.map(x=>Object.assign({},x,{params:Object.assign({},l,x.params),pathname:Jl([c,a.encodeLocation?a.encodeLocation(x.pathname).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?c:Jl([c,a.encodeLocation?a.encodeLocation(x.pathnameBase).pathname:x.pathnameBase])})),o,r,n);return t&&m?y.createElement(Dv.Provider,{value:{location:zh({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:Yl.Pop}},m):m}function Tq(){let e=qq(),t=_q(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,a={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return y.createElement(y.Fragment,null,y.createElement("h2",null,"Unexpected Application Error!"),y.createElement("h3",{style:{fontStyle:"italic"}},t),r?y.createElement("pre",{style:a},r):null,null)}const Eq=y.createElement(Tq,null);class Iq extends y.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?y.createElement(Ns.Provider,{value:this.props.routeContext},y.createElement(UI.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Nq(e){let{routeContext:t,match:r,children:n}=e,a=y.useContext(aj);return a&&a.static&&a.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=r.route.id),y.createElement(Ns.Provider,{value:t},n)}function Dq(e,t,r,n){var a;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var o;if(!r)return null;if(r.errors)e=r.matches;else if((o=n)!=null&&o.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let s=e,l=(a=r)==null?void 0:a.errors;if(l!=null){let d=s.findIndex(f=>f.route.id&&l?.[f.route.id]!==void 0);d>=0||Oa(!1),s=s.slice(0,Math.min(s.length,d+1))}let c=!1,u=-1;if(r&&n&&n.v7_partialHydration)for(let d=0;d<s.length;d++){let f=s[d];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(u=d),f.route.id){let{loaderData:h,errors:p}=r,g=f.route.loader&&h[f.route.id]===void 0&&(!p||p[f.route.id]===void 0);if(f.route.lazy||g){c=!0,u>=0?s=s.slice(0,u+1):s=[s[0]];break}}}return s.reduceRight((d,f,h)=>{let p,g=!1,m=null,x=null;r&&(p=l&&f.route.id?l[f.route.id]:void 0,m=f.route.errorElement||Eq,c&&(u<0&&h===0?($q("route-fallback"),g=!0,x=null):u===h&&(g=!0,x=f.route.hydrateFallbackElement||null)));let b=t.concat(s.slice(0,h+1)),_=()=>{let w;return p?w=m:g?w=x:f.route.Component?w=y.createElement(f.route.Component,null):f.route.element?w=f.route.element:w=d,y.createElement(Nq,{match:f,routeContext:{outlet:d,matches:b,isDataRoute:r!=null},children:w})};return r&&(f.route.ErrorBoundary||f.route.errorElement||h===0)?y.createElement(Iq,{location:r.location,revalidation:r.revalidation,component:m,error:p,children:_(),routeContext:{outlet:null,matches:b,isDataRoute:!0}}):_()},null)}var HI=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(HI||{}),VI=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(VI||{});function Mq(e){let t=y.useContext(aj);return t||Oa(!1),t}function Lq(e){let t=y.useContext(jq);return t||Oa(!1),t}function Rq(e){let t=y.useContext(Ns);return t||Oa(!1),t}function GI(e){let t=Rq(),r=t.matches[t.matches.length-1];return r.route.id||Oa(!1),r.route.id}function qq(){var e;let t=y.useContext(UI),r=Lq(),n=GI();return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function Fq(){let{router:e}=Mq(HI.UseNavigateStable),t=GI(VI.UseNavigateStable),r=y.useRef(!1);return zI(()=>{r.current=!0}),y.useCallback(function(a,o){o===void 0&&(o={}),r.current&&(typeof a=="number"?e.navigate(a):e.navigate(a,zh({fromRouteId:t},o)))},[e,t])}const m5={};function $q(e,t,r){m5[e]||(m5[e]=!0)}function Bq(e,t){e?.v7_startTransition,e?.v7_relativeSplatPath}function Ou(e){let{to:t,replace:r,state:n,relative:a}=e;Nd()||Oa(!1);let{future:o,static:s}=y.useContext(ic),{matches:l}=y.useContext(Ns),{pathname:c}=Ds(),u=Nn(),d=nj(t,rj(l,o.v7_relativeSplatPath),c,a==="path"),f=JSON.stringify(d);return y.useEffect(()=>u(JSON.parse(f),{replace:r,state:n,relative:a}),[u,f,a,r,n]),null}function Uq(e){return Pq(e.context)}function hr(e){Oa(!1)}function zq(e){let{basename:t="/",children:r=null,location:n,navigationType:a=Yl.Pop,navigator:o,static:s=!1,future:l}=e;Nd()&&Oa(!1);let c=t.replace(/^\/*/,"/"),u=y.useMemo(()=>({basename:c,navigator:o,static:s,future:zh({v7_relativeSplatPath:!1},l)}),[c,l,o,s]);typeof n=="string"&&(n=nu(n));let{pathname:d="/",search:f="",hash:h="",state:p=null,key:g="default"}=n,m=y.useMemo(()=>{let x=tj(d,c);return x==null?null:{location:{pathname:x,search:f,hash:h,state:p,key:g},navigationType:a}},[c,d,f,h,p,g,a]);return m==null?null:y.createElement(ic.Provider,{value:u},y.createElement(Dv.Provider,{children:r,value:m}))}function Wq(e){let{children:t,location:r}=e;return Oq(U2(t),r)}new Promise(()=>{});function U2(e,t){t===void 0&&(t=[]);let r=[];return y.Children.forEach(e,(n,a)=>{if(!y.isValidElement(n))return;let o=[...t,a];if(n.type===y.Fragment){r.push.apply(r,U2(n.props.children,o));return}n.type!==hr&&Oa(!1),!n.props.index||!n.props.children||Oa(!1);let s={id:n.props.id||o.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(s.children=U2(n.props.children,o)),r.push(s)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function z2(){return z2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},z2.apply(this,arguments)}function Hq(e,t){if(e==null)return{};var r={},n=Object.keys(e),a,o;for(o=0;o<n.length;o++)a=n[o],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}function Vq(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Gq(e,t){return e.button===0&&(!t||t==="_self")&&!Vq(e)}const Yq=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Kq="6";try{window.__reactRouterVersion=Kq}catch{}const Qq="startTransition",g5=c8[Qq];function Xq(e){let{basename:t,children:r,future:n,window:a}=e,o=y.useRef();o.current==null&&(o.current=X8({window:a,v5Compat:!0}));let s=o.current,[l,c]=y.useState({action:s.action,location:s.location}),{v7_startTransition:u}=n||{},d=y.useCallback(f=>{u&&g5?g5(()=>c(f)):c(f)},[c,u]);return y.useLayoutEffect(()=>s.listen(d),[s,d]),y.useEffect(()=>Bq(n),[n]),y.createElement(zq,{basename:t,children:r,location:l.location,navigationType:l.action,navigator:s,future:n})}const Jq=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Zq=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,YI=y.forwardRef(function(t,r){let{onClick:n,relative:a,reloadDocument:o,replace:s,state:l,target:c,to:u,preventScrollReset:d,viewTransition:f}=t,h=Hq(t,Yq),{basename:p}=y.useContext(ic),g,m=!1;if(typeof u=="string"&&Zq.test(u)&&(g=u,Jq))try{let w=new URL(window.location.href),A=u.startsWith("//")?new URL(w.protocol+u):new URL(u),O=tj(A.pathname,p);A.origin===w.origin&&O!=null?u=O+A.search+A.hash:m=!0}catch{}let x=Sq(u,{relative:a}),b=eF(u,{replace:s,state:l,target:c,preventScrollReset:d,relative:a,viewTransition:f});function _(w){n&&n(w),w.defaultPrevented||b(w)}return y.createElement("a",z2({},h,{href:g||x,onClick:m||o?n:_,ref:r,target:c}))});var v5;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(v5||(v5={}));var y5;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(y5||(y5={}));function eF(e,t){let{target:r,replace:n,state:a,preventScrollReset:o,relative:s,viewTransition:l}=t===void 0?{}:t,c=Nn(),u=Ds(),d=WI(e,{relative:s});return y.useCallback(f=>{if(Gq(f,r)){f.preventDefault();let h=n!==void 0?n:hg(u)===hg(d);c(e,{replace:h,state:a,preventScrollReset:o,relative:s,viewTransition:l})}},[u,c,d,n,a,r,e,o,s,l])}function KI(e,t){return function(){return e.apply(t,arguments)}}const{toString:tF}=Object.prototype,{getPrototypeOf:ij}=Object,{iterator:Mv,toStringTag:QI}=Symbol,Lv=(e=>t=>{const r=tF.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),ss=e=>(e=e.toLowerCase(),t=>Lv(t)===e),Rv=e=>t=>typeof t===e,{isArray:Dd}=Array,Wh=Rv("undefined");function rF(e){return e!==null&&!Wh(e)&&e.constructor!==null&&!Wh(e.constructor)&&Ji(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const XI=ss("ArrayBuffer");function nF(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&XI(e.buffer),t}const aF=Rv("string"),Ji=Rv("function"),JI=Rv("number"),qv=e=>e!==null&&typeof e=="object",iF=e=>e===!0||e===!1,Um=e=>{if(Lv(e)!=="object")return!1;const t=ij(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(QI in e)&&!(Mv in e)},oF=ss("Date"),sF=ss("File"),lF=ss("Blob"),cF=ss("FileList"),uF=e=>qv(e)&&Ji(e.pipe),dF=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Ji(e.append)&&((t=Lv(e))==="formdata"||t==="object"&&Ji(e.toString)&&e.toString()==="[object FormData]"))},fF=ss("URLSearchParams"),[hF,pF,mF,gF]=["ReadableStream","Request","Response","Headers"].map(ss),vF=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Np(e,t,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let n,a;if(typeof e!="object"&&(e=[e]),Dd(e))for(n=0,a=e.length;n<a;n++)t.call(null,e[n],n,e);else{const o=r?Object.getOwnPropertyNames(e):Object.keys(e),s=o.length;let l;for(n=0;n<s;n++)l=o[n],t.call(null,e[l],l,e)}}function ZI(e,t){t=t.toLowerCase();const r=Object.keys(e);let n=r.length,a;for(;n-- >0;)if(a=r[n],t===a.toLowerCase())return a;return null}const Dc=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,eN=e=>!Wh(e)&&e!==Dc;function W2(){const{caseless:e}=eN(this)&&this||{},t={},r=(n,a)=>{const o=e&&ZI(t,a)||a;Um(t[o])&&Um(n)?t[o]=W2(t[o],n):Um(n)?t[o]=W2({},n):Dd(n)?t[o]=n.slice():t[o]=n};for(let n=0,a=arguments.length;n<a;n++)arguments[n]&&Np(arguments[n],r);return t}const yF=(e,t,r,{allOwnKeys:n}={})=>(Np(t,(a,o)=>{r&&Ji(a)?e[o]=KI(a,r):e[o]=a},{allOwnKeys:n}),e),xF=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),bF=(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},_F=(e,t,r,n)=>{let a,o,s;const l={};if(t=t||{},e==null)return t;do{for(a=Object.getOwnPropertyNames(e),o=a.length;o-- >0;)s=a[o],(!n||n(s,e,t))&&!l[s]&&(t[s]=e[s],l[s]=!0);e=r!==!1&&ij(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},wF=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return n!==-1&&n===r},jF=e=>{if(!e)return null;if(Dd(e))return e;let t=e.length;if(!JI(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},SF=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&ij(Uint8Array)),CF=(e,t)=>{const n=(e&&e[Mv]).call(e);let a;for(;(a=n.next())&&!a.done;){const o=a.value;t.call(e,o[0],o[1])}},AF=(e,t)=>{let r;const n=[];for(;(r=e.exec(t))!==null;)n.push(r);return n},PF=ss("HTMLFormElement"),OF=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,a){return n.toUpperCase()+a}),x5=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),kF=ss("RegExp"),tN=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};Np(r,(a,o)=>{let s;(s=t(a,o,e))!==!1&&(n[o]=s||a)}),Object.defineProperties(e,n)},TF=e=>{tN(e,(t,r)=>{if(Ji(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=e[r];if(Ji(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},EF=(e,t)=>{const r={},n=a=>{a.forEach(o=>{r[o]=!0})};return Dd(e)?n(e):n(String(e).split(t)),r},IF=()=>{},NF=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function DF(e){return!!(e&&Ji(e.append)&&e[QI]==="FormData"&&e[Mv])}const MF=e=>{const t=new Array(10),r=(n,a)=>{if(qv(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[a]=n;const o=Dd(n)?[]:{};return Np(n,(s,l)=>{const c=r(s,a+1);!Wh(c)&&(o[l]=c)}),t[a]=void 0,o}}return n};return r(e,0)},LF=ss("AsyncFunction"),RF=e=>e&&(qv(e)||Ji(e))&&Ji(e.then)&&Ji(e.catch),rN=((e,t)=>e?setImmediate:t?((r,n)=>(Dc.addEventListener("message",({source:a,data:o})=>{a===Dc&&o===r&&n.length&&n.shift()()},!1),a=>{n.push(a),Dc.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",Ji(Dc.postMessage)),qF=typeof queueMicrotask<"u"?queueMicrotask.bind(Dc):typeof process<"u"&&process.nextTick||rN,FF=e=>e!=null&&Ji(e[Mv]),lt={isArray:Dd,isArrayBuffer:XI,isBuffer:rF,isFormData:dF,isArrayBufferView:nF,isString:aF,isNumber:JI,isBoolean:iF,isObject:qv,isPlainObject:Um,isReadableStream:hF,isRequest:pF,isResponse:mF,isHeaders:gF,isUndefined:Wh,isDate:oF,isFile:sF,isBlob:lF,isRegExp:kF,isFunction:Ji,isStream:uF,isURLSearchParams:fF,isTypedArray:SF,isFileList:cF,forEach:Np,merge:W2,extend:yF,trim:vF,stripBOM:xF,inherits:bF,toFlatObject:_F,kindOf:Lv,kindOfTest:ss,endsWith:wF,toArray:jF,forEachEntry:CF,matchAll:AF,isHTMLForm:PF,hasOwnProperty:x5,hasOwnProp:x5,reduceDescriptors:tN,freezeMethods:TF,toObjectSet:EF,toCamelCase:OF,noop:IF,toFiniteNumber:NF,findKey:ZI,global:Dc,isContextDefined:eN,isSpecCompliantForm:DF,toJSONObject:MF,isAsyncFn:LF,isThenable:RF,setImmediate:rN,asap:qF,isIterable:FF};function Wr(e,t,r,n,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),a&&(this.response=a,this.status=a.status?a.status:null)}lt.inherits(Wr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:lt.toJSONObject(this.config),code:this.code,status:this.status}}});const nN=Wr.prototype,aN={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{aN[e]={value:e}});Object.defineProperties(Wr,aN);Object.defineProperty(nN,"isAxiosError",{value:!0});Wr.from=(e,t,r,n,a,o)=>{const s=Object.create(nN);return lt.toFlatObject(e,s,function(c){return c!==Error.prototype},l=>l!=="isAxiosError"),Wr.call(s,e.message,t,r,n,a),s.cause=e,s.name=e.name,o&&Object.assign(s,o),s};const $F=null;function H2(e){return lt.isPlainObject(e)||lt.isArray(e)}function iN(e){return lt.endsWith(e,"[]")?e.slice(0,-2):e}function b5(e,t,r){return e?e.concat(t).map(function(a,o){return a=iN(a),!r&&o?"["+a+"]":a}).join(r?".":""):t}function BF(e){return lt.isArray(e)&&!e.some(H2)}const UF=lt.toFlatObject(lt,{},null,function(t){return/^is[A-Z]/.test(t)});function Fv(e,t,r){if(!lt.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=lt.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,x){return!lt.isUndefined(x[m])});const n=r.metaTokens,a=r.visitor||d,o=r.dots,s=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&lt.isSpecCompliantForm(t);if(!lt.isFunction(a))throw new TypeError("visitor must be a function");function u(g){if(g===null)return"";if(lt.isDate(g))return g.toISOString();if(lt.isBoolean(g))return g.toString();if(!c&&lt.isBlob(g))throw new Wr("Blob is not supported. Use a Buffer instead.");return lt.isArrayBuffer(g)||lt.isTypedArray(g)?c&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function d(g,m,x){let b=g;if(g&&!x&&typeof g=="object"){if(lt.endsWith(m,"{}"))m=n?m:m.slice(0,-2),g=JSON.stringify(g);else if(lt.isArray(g)&&BF(g)||(lt.isFileList(g)||lt.endsWith(m,"[]"))&&(b=lt.toArray(g)))return m=iN(m),b.forEach(function(w,A){!(lt.isUndefined(w)||w===null)&&t.append(s===!0?b5([m],A,o):s===null?m:m+"[]",u(w))}),!1}return H2(g)?!0:(t.append(b5(x,m,o),u(g)),!1)}const f=[],h=Object.assign(UF,{defaultVisitor:d,convertValue:u,isVisitable:H2});function p(g,m){if(!lt.isUndefined(g)){if(f.indexOf(g)!==-1)throw Error("Circular reference detected in "+m.join("."));f.push(g),lt.forEach(g,function(b,_){(!(lt.isUndefined(b)||b===null)&&a.call(t,b,lt.isString(_)?_.trim():_,m,h))===!0&&p(b,m?m.concat(_):[_])}),f.pop()}}if(!lt.isObject(e))throw new TypeError("data must be an object");return p(e),t}function _5(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function oj(e,t){this._pairs=[],e&&Fv(e,this,t)}const oN=oj.prototype;oN.append=function(t,r){this._pairs.push([t,r])};oN.toString=function(t){const r=t?function(n){return t.call(this,n,_5)}:_5;return this._pairs.map(function(a){return r(a[0])+"="+r(a[1])},"").join("&")};function zF(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function sN(e,t,r){if(!t)return e;const n=r&&r.encode||zF;lt.isFunction(r)&&(r={serialize:r});const a=r&&r.serialize;let o;if(a?o=a(t,r):o=lt.isURLSearchParams(t)?t.toString():new oj(t,r).toString(n),o){const s=e.indexOf("#");s!==-1&&(e=e.slice(0,s)),e+=(e.indexOf("?")===-1?"?":"&")+o}return e}class w5{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){lt.forEach(this.handlers,function(n){n!==null&&t(n)})}}const lN={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},WF=typeof URLSearchParams<"u"?URLSearchParams:oj,HF=typeof FormData<"u"?FormData:null,VF=typeof Blob<"u"?Blob:null,GF={isBrowser:!0,classes:{URLSearchParams:WF,FormData:HF,Blob:VF},protocols:["http","https","file","blob","url","data"]},sj=typeof window<"u"&&typeof document<"u",V2=typeof navigator=="object"&&navigator||void 0,YF=sj&&(!V2||["ReactNative","NativeScript","NS"].indexOf(V2.product)<0),KF=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",QF=sj&&window.location.href||"http://localhost",XF=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:sj,hasStandardBrowserEnv:YF,hasStandardBrowserWebWorkerEnv:KF,navigator:V2,origin:QF},Symbol.toStringTag,{value:"Module"})),_i={...XF,...GF};function JF(e,t){return Fv(e,new _i.classes.URLSearchParams,Object.assign({visitor:function(r,n,a,o){return _i.isNode&&lt.isBuffer(r)?(this.append(n,r.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},t))}function ZF(e){return lt.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function e$(e){const t={},r=Object.keys(e);let n;const a=r.length;let o;for(n=0;n<a;n++)o=r[n],t[o]=e[o];return t}function cN(e){function t(r,n,a,o){let s=r[o++];if(s==="__proto__")return!0;const l=Number.isFinite(+s),c=o>=r.length;return s=!s&&lt.isArray(a)?a.length:s,c?(lt.hasOwnProp(a,s)?a[s]=[a[s],n]:a[s]=n,!l):((!a[s]||!lt.isObject(a[s]))&&(a[s]=[]),t(r,n,a[s],o)&&lt.isArray(a[s])&&(a[s]=e$(a[s])),!l)}if(lt.isFormData(e)&&lt.isFunction(e.entries)){const r={};return lt.forEachEntry(e,(n,a)=>{t(ZF(n),a,r,0)}),r}return null}function t$(e,t,r){if(lt.isString(e))try{return(t||JSON.parse)(e),lt.trim(e)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(e)}const Dp={transitional:lN,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",a=n.indexOf("application/json")>-1,o=lt.isObject(t);if(o&&lt.isHTMLForm(t)&&(t=new FormData(t)),lt.isFormData(t))return a?JSON.stringify(cN(t)):t;if(lt.isArrayBuffer(t)||lt.isBuffer(t)||lt.isStream(t)||lt.isFile(t)||lt.isBlob(t)||lt.isReadableStream(t))return t;if(lt.isArrayBufferView(t))return t.buffer;if(lt.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let l;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return JF(t,this.formSerializer).toString();if((l=lt.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Fv(l?{"files[]":t}:t,c&&new c,this.formSerializer)}}return o||a?(r.setContentType("application/json",!1),t$(t)):t}],transformResponse:[function(t){const r=this.transitional||Dp.transitional,n=r&&r.forcedJSONParsing,a=this.responseType==="json";if(lt.isResponse(t)||lt.isReadableStream(t))return t;if(t&&lt.isString(t)&&(n&&!this.responseType||a)){const s=!(r&&r.silentJSONParsing)&&a;try{return JSON.parse(t)}catch(l){if(s)throw l.name==="SyntaxError"?Wr.from(l,Wr.ERR_BAD_RESPONSE,this,null,this.response):l}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:_i.classes.FormData,Blob:_i.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};lt.forEach(["delete","get","head","post","put","patch"],e=>{Dp.headers[e]={}});const r$=lt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),n$=e=>{const t={};let r,n,a;return e&&e.split(`
`).forEach(function(s){a=s.indexOf(":"),r=s.substring(0,a).trim().toLowerCase(),n=s.substring(a+1).trim(),!(!r||t[r]&&r$[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},j5=Symbol("internals");function tf(e){return e&&String(e).trim().toLowerCase()}function zm(e){return e===!1||e==null?e:lt.isArray(e)?e.map(zm):String(e)}function a$(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}const i$=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function ox(e,t,r,n,a){if(lt.isFunction(n))return n.call(this,t,r);if(a&&(t=r),!!lt.isString(t)){if(lt.isString(n))return t.indexOf(n)!==-1;if(lt.isRegExp(n))return n.test(t)}}function o$(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function s$(e,t){const r=lt.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(a,o,s){return this[n].call(this,t,a,o,s)},configurable:!0})})}let Zi=class{constructor(t){t&&this.set(t)}set(t,r,n){const a=this;function o(l,c,u){const d=tf(c);if(!d)throw new Error("header name must be a non-empty string");const f=lt.findKey(a,d);(!f||a[f]===void 0||u===!0||u===void 0&&a[f]!==!1)&&(a[f||c]=zm(l))}const s=(l,c)=>lt.forEach(l,(u,d)=>o(u,d,c));if(lt.isPlainObject(t)||t instanceof this.constructor)s(t,r);else if(lt.isString(t)&&(t=t.trim())&&!i$(t))s(n$(t),r);else if(lt.isObject(t)&&lt.isIterable(t)){let l={},c,u;for(const d of t){if(!lt.isArray(d))throw TypeError("Object iterator must return a key-value pair");l[u=d[0]]=(c=l[u])?lt.isArray(c)?[...c,d[1]]:[c,d[1]]:d[1]}s(l,r)}else t!=null&&o(r,t,n);return this}get(t,r){if(t=tf(t),t){const n=lt.findKey(this,t);if(n){const a=this[n];if(!r)return a;if(r===!0)return a$(a);if(lt.isFunction(r))return r.call(this,a,n);if(lt.isRegExp(r))return r.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=tf(t),t){const n=lt.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||ox(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let a=!1;function o(s){if(s=tf(s),s){const l=lt.findKey(n,s);l&&(!r||ox(n,n[l],l,r))&&(delete n[l],a=!0)}}return lt.isArray(t)?t.forEach(o):o(t),a}clear(t){const r=Object.keys(this);let n=r.length,a=!1;for(;n--;){const o=r[n];(!t||ox(this,this[o],o,t,!0))&&(delete this[o],a=!0)}return a}normalize(t){const r=this,n={};return lt.forEach(this,(a,o)=>{const s=lt.findKey(n,o);if(s){r[s]=zm(a),delete r[o];return}const l=t?o$(o):String(o).trim();l!==o&&delete r[o],r[l]=zm(a),n[l]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return lt.forEach(this,(n,a)=>{n!=null&&n!==!1&&(r[a]=t&&lt.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(a=>n.set(a)),n}static accessor(t){const n=(this[j5]=this[j5]={accessors:{}}).accessors,a=this.prototype;function o(s){const l=tf(s);n[l]||(s$(a,s),n[l]=!0)}return lt.isArray(t)?t.forEach(o):o(t),this}};Zi.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);lt.reduceDescriptors(Zi.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(n){this[r]=n}}});lt.freezeMethods(Zi);function sx(e,t){const r=this||Dp,n=t||r,a=Zi.from(n.headers);let o=n.data;return lt.forEach(e,function(l){o=l.call(r,o,a.normalize(),t?t.status:void 0)}),a.normalize(),o}function uN(e){return!!(e&&e.__CANCEL__)}function Md(e,t,r){Wr.call(this,e??"canceled",Wr.ERR_CANCELED,t,r),this.name="CanceledError"}lt.inherits(Md,Wr,{__CANCEL__:!0});function dN(e,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?e(r):t(new Wr("Request failed with status code "+r.status,[Wr.ERR_BAD_REQUEST,Wr.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function l$(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function c$(e,t){e=e||10;const r=new Array(e),n=new Array(e);let a=0,o=0,s;return t=t!==void 0?t:1e3,function(c){const u=Date.now(),d=n[o];s||(s=u),r[a]=c,n[a]=u;let f=o,h=0;for(;f!==a;)h+=r[f++],f=f%e;if(a=(a+1)%e,a===o&&(o=(o+1)%e),u-s<t)return;const p=d&&u-d;return p?Math.round(h*1e3/p):void 0}}function u$(e,t){let r=0,n=1e3/t,a,o;const s=(u,d=Date.now())=>{r=d,a=null,o&&(clearTimeout(o),o=null),e.apply(null,u)};return[(...u)=>{const d=Date.now(),f=d-r;f>=n?s(u,d):(a=u,o||(o=setTimeout(()=>{o=null,s(a)},n-f)))},()=>a&&s(a)]}const pg=(e,t,r=3)=>{let n=0;const a=c$(50,250);return u$(o=>{const s=o.loaded,l=o.lengthComputable?o.total:void 0,c=s-n,u=a(c),d=s<=l;n=s;const f={loaded:s,total:l,progress:l?s/l:void 0,bytes:c,rate:u||void 0,estimated:u&&l&&d?(l-s)/u:void 0,event:o,lengthComputable:l!=null,[t?"download":"upload"]:!0};e(f)},r)},S5=(e,t)=>{const r=e!=null;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},C5=e=>(...t)=>lt.asap(()=>e(...t)),d$=_i.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,_i.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(_i.origin),_i.navigator&&/(msie|trident)/i.test(_i.navigator.userAgent)):()=>!0,f$=_i.hasStandardBrowserEnv?{write(e,t,r,n,a,o){const s=[e+"="+encodeURIComponent(t)];lt.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),lt.isString(n)&&s.push("path="+n),lt.isString(a)&&s.push("domain="+a),o===!0&&s.push("secure"),document.cookie=s.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function h$(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function p$(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function fN(e,t,r){let n=!h$(t);return e&&(n||r==!1)?p$(e,t):t}const A5=e=>e instanceof Zi?{...e}:e;function Vc(e,t){t=t||{};const r={};function n(u,d,f,h){return lt.isPlainObject(u)&&lt.isPlainObject(d)?lt.merge.call({caseless:h},u,d):lt.isPlainObject(d)?lt.merge({},d):lt.isArray(d)?d.slice():d}function a(u,d,f,h){if(lt.isUndefined(d)){if(!lt.isUndefined(u))return n(void 0,u,f,h)}else return n(u,d,f,h)}function o(u,d){if(!lt.isUndefined(d))return n(void 0,d)}function s(u,d){if(lt.isUndefined(d)){if(!lt.isUndefined(u))return n(void 0,u)}else return n(void 0,d)}function l(u,d,f){if(f in t)return n(u,d);if(f in e)return n(void 0,u)}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:l,headers:(u,d,f)=>a(A5(u),A5(d),f,!0)};return lt.forEach(Object.keys(Object.assign({},e,t)),function(d){const f=c[d]||a,h=f(e[d],t[d],d);lt.isUndefined(h)&&f!==l||(r[d]=h)}),r}const hN=e=>{const t=Vc({},e);let{data:r,withXSRFToken:n,xsrfHeaderName:a,xsrfCookieName:o,headers:s,auth:l}=t;t.headers=s=Zi.from(s),t.url=sN(fN(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&s.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let c;if(lt.isFormData(r)){if(_i.hasStandardBrowserEnv||_i.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if((c=s.getContentType())!==!1){const[u,...d]=c?c.split(";").map(f=>f.trim()).filter(Boolean):[];s.setContentType([u||"multipart/form-data",...d].join("; "))}}if(_i.hasStandardBrowserEnv&&(n&&lt.isFunction(n)&&(n=n(t)),n||n!==!1&&d$(t.url))){const u=a&&o&&f$.read(o);u&&s.set(a,u)}return t},m$=typeof XMLHttpRequest<"u",g$=m$&&function(e){return new Promise(function(r,n){const a=hN(e);let o=a.data;const s=Zi.from(a.headers).normalize();let{responseType:l,onUploadProgress:c,onDownloadProgress:u}=a,d,f,h,p,g;function m(){p&&p(),g&&g(),a.cancelToken&&a.cancelToken.unsubscribe(d),a.signal&&a.signal.removeEventListener("abort",d)}let x=new XMLHttpRequest;x.open(a.method.toUpperCase(),a.url,!0),x.timeout=a.timeout;function b(){if(!x)return;const w=Zi.from("getAllResponseHeaders"in x&&x.getAllResponseHeaders()),O={data:!l||l==="text"||l==="json"?x.responseText:x.response,status:x.status,statusText:x.statusText,headers:w,config:e,request:x};dN(function(E){r(E),m()},function(E){n(E),m()},O),x=null}"onloadend"in x?x.onloadend=b:x.onreadystatechange=function(){!x||x.readyState!==4||x.status===0&&!(x.responseURL&&x.responseURL.indexOf("file:")===0)||setTimeout(b)},x.onabort=function(){x&&(n(new Wr("Request aborted",Wr.ECONNABORTED,e,x)),x=null)},x.onerror=function(){n(new Wr("Network Error",Wr.ERR_NETWORK,e,x)),x=null},x.ontimeout=function(){let A=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const O=a.transitional||lN;a.timeoutErrorMessage&&(A=a.timeoutErrorMessage),n(new Wr(A,O.clarifyTimeoutError?Wr.ETIMEDOUT:Wr.ECONNABORTED,e,x)),x=null},o===void 0&&s.setContentType(null),"setRequestHeader"in x&&lt.forEach(s.toJSON(),function(A,O){x.setRequestHeader(O,A)}),lt.isUndefined(a.withCredentials)||(x.withCredentials=!!a.withCredentials),l&&l!=="json"&&(x.responseType=a.responseType),u&&([h,g]=pg(u,!0),x.addEventListener("progress",h)),c&&x.upload&&([f,p]=pg(c),x.upload.addEventListener("progress",f),x.upload.addEventListener("loadend",p)),(a.cancelToken||a.signal)&&(d=w=>{x&&(n(!w||w.type?new Md(null,e,x):w),x.abort(),x=null)},a.cancelToken&&a.cancelToken.subscribe(d),a.signal&&(a.signal.aborted?d():a.signal.addEventListener("abort",d)));const _=l$(a.url);if(_&&_i.protocols.indexOf(_)===-1){n(new Wr("Unsupported protocol "+_+":",Wr.ERR_BAD_REQUEST,e));return}x.send(o||null)})},v$=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let n=new AbortController,a;const o=function(u){if(!a){a=!0,l();const d=u instanceof Error?u:this.reason;n.abort(d instanceof Wr?d:new Md(d instanceof Error?d.message:d))}};let s=t&&setTimeout(()=>{s=null,o(new Wr(`timeout ${t} of ms exceeded`,Wr.ETIMEDOUT))},t);const l=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(u=>{u.unsubscribe?u.unsubscribe(o):u.removeEventListener("abort",o)}),e=null)};e.forEach(u=>u.addEventListener("abort",o));const{signal:c}=n;return c.unsubscribe=()=>lt.asap(l),c}},y$=function*(e,t){let r=e.byteLength;if(r<t){yield e;return}let n=0,a;for(;n<r;)a=n+t,yield e.slice(n,a),n=a},x$=async function*(e,t){for await(const r of b$(e))yield*y$(r,t)},b$=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},P5=(e,t,r,n)=>{const a=x$(e,t);let o=0,s,l=c=>{s||(s=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:u,value:d}=await a.next();if(u){l(),c.close();return}let f=d.byteLength;if(r){let h=o+=f;r(h)}c.enqueue(new Uint8Array(d))}catch(u){throw l(u),u}},cancel(c){return l(c),a.return()}},{highWaterMark:2})},$v=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",pN=$v&&typeof ReadableStream=="function",_$=$v&&(typeof TextEncoder=="function"?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),mN=(e,...t)=>{try{return!!e(...t)}catch{return!1}},w$=pN&&mN(()=>{let e=!1;const t=new Request(_i.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),O5=64*1024,G2=pN&&mN(()=>lt.isReadableStream(new Response("").body)),mg={stream:G2&&(e=>e.body)};$v&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!mg[t]&&(mg[t]=lt.isFunction(e[t])?r=>r[t]():(r,n)=>{throw new Wr(`Response type '${t}' is not supported`,Wr.ERR_NOT_SUPPORT,n)})})})(new Response);const j$=async e=>{if(e==null)return 0;if(lt.isBlob(e))return e.size;if(lt.isSpecCompliantForm(e))return(await new Request(_i.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(lt.isArrayBufferView(e)||lt.isArrayBuffer(e))return e.byteLength;if(lt.isURLSearchParams(e)&&(e=e+""),lt.isString(e))return(await _$(e)).byteLength},S$=async(e,t)=>{const r=lt.toFiniteNumber(e.getContentLength());return r??j$(t)},C$=$v&&(async e=>{let{url:t,method:r,data:n,signal:a,cancelToken:o,timeout:s,onDownloadProgress:l,onUploadProgress:c,responseType:u,headers:d,withCredentials:f="same-origin",fetchOptions:h}=hN(e);u=u?(u+"").toLowerCase():"text";let p=v$([a,o&&o.toAbortSignal()],s),g;const m=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let x;try{if(c&&w$&&r!=="get"&&r!=="head"&&(x=await S$(d,n))!==0){let O=new Request(t,{method:"POST",body:n,duplex:"half"}),T;if(lt.isFormData(n)&&(T=O.headers.get("content-type"))&&d.setContentType(T),O.body){const[E,S]=S5(x,pg(C5(c)));n=P5(O.body,O5,E,S)}}lt.isString(f)||(f=f?"include":"omit");const b="credentials"in Request.prototype;g=new Request(t,{...h,signal:p,method:r.toUpperCase(),headers:d.normalize().toJSON(),body:n,duplex:"half",credentials:b?f:void 0});let _=await fetch(g,h);const w=G2&&(u==="stream"||u==="response");if(G2&&(l||w&&m)){const O={};["status","statusText","headers"].forEach(I=>{O[I]=_[I]});const T=lt.toFiniteNumber(_.headers.get("content-length")),[E,S]=l&&S5(T,pg(C5(l),!0))||[];_=new Response(P5(_.body,O5,E,()=>{S&&S(),m&&m()}),O)}u=u||"text";let A=await mg[lt.findKey(mg,u)||"text"](_,e);return!w&&m&&m(),await new Promise((O,T)=>{dN(O,T,{data:A,headers:Zi.from(_.headers),status:_.status,statusText:_.statusText,config:e,request:g})})}catch(b){throw m&&m(),b&&b.name==="TypeError"&&/Load failed|fetch/i.test(b.message)?Object.assign(new Wr("Network Error",Wr.ERR_NETWORK,e,g),{cause:b.cause||b}):Wr.from(b,b&&b.code,e,g)}}),Y2={http:$F,xhr:g$,fetch:C$};lt.forEach(Y2,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const k5=e=>`- ${e}`,A$=e=>lt.isFunction(e)||e===null||e===!1,gN={getAdapter:e=>{e=lt.isArray(e)?e:[e];const{length:t}=e;let r,n;const a={};for(let o=0;o<t;o++){r=e[o];let s;if(n=r,!A$(r)&&(n=Y2[(s=String(r)).toLowerCase()],n===void 0))throw new Wr(`Unknown adapter '${s}'`);if(n)break;a[s||"#"+o]=n}if(!n){const o=Object.entries(a).map(([l,c])=>`adapter ${l} `+(c===!1?"is not supported by the environment":"is not available in the build"));let s=t?o.length>1?`since :
`+o.map(k5).join(`
`):" "+k5(o[0]):"as no adapter specified";throw new Wr("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return n},adapters:Y2};function lx(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Md(null,e)}function T5(e){return lx(e),e.headers=Zi.from(e.headers),e.data=sx.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),gN.getAdapter(e.adapter||Dp.adapter)(e).then(function(n){return lx(e),n.data=sx.call(e,e.transformResponse,n),n.headers=Zi.from(n.headers),n},function(n){return uN(n)||(lx(e),n&&n.response&&(n.response.data=sx.call(e,e.transformResponse,n.response),n.response.headers=Zi.from(n.response.headers))),Promise.reject(n)})}const vN="1.10.0",Bv={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Bv[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const E5={};Bv.transitional=function(t,r,n){function a(o,s){return"[Axios v"+vN+"] Transitional option '"+o+"'"+s+(n?". "+n:"")}return(o,s,l)=>{if(t===!1)throw new Wr(a(s," has been removed"+(r?" in "+r:"")),Wr.ERR_DEPRECATED);return r&&!E5[s]&&(E5[s]=!0,console.warn(a(s," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(o,s,l):!0}};Bv.spelling=function(t){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function P$(e,t,r){if(typeof e!="object")throw new Wr("options must be an object",Wr.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let a=n.length;for(;a-- >0;){const o=n[a],s=t[o];if(s){const l=e[o],c=l===void 0||s(l,o,e);if(c!==!0)throw new Wr("option "+o+" must be "+c,Wr.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new Wr("Unknown option "+o,Wr.ERR_BAD_OPTION)}}const Wm={assertOptions:P$,validators:Bv},gs=Wm.validators;let Fc=class{constructor(t){this.defaults=t||{},this.interceptors={request:new w5,response:new w5}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const o=a.stack?a.stack.replace(/^.+\n/,""):"";try{n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=Vc(this.defaults,r);const{transitional:n,paramsSerializer:a,headers:o}=r;n!==void 0&&Wm.assertOptions(n,{silentJSONParsing:gs.transitional(gs.boolean),forcedJSONParsing:gs.transitional(gs.boolean),clarifyTimeoutError:gs.transitional(gs.boolean)},!1),a!=null&&(lt.isFunction(a)?r.paramsSerializer={serialize:a}:Wm.assertOptions(a,{encode:gs.function,serialize:gs.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Wm.assertOptions(r,{baseUrl:gs.spelling("baseURL"),withXsrfToken:gs.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let s=o&&lt.merge(o.common,o[r.method]);o&&lt.forEach(["delete","get","head","post","put","patch","common"],g=>{delete o[g]}),r.headers=Zi.concat(s,o);const l=[];let c=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(r)===!1||(c=c&&m.synchronous,l.unshift(m.fulfilled,m.rejected))});const u=[];this.interceptors.response.forEach(function(m){u.push(m.fulfilled,m.rejected)});let d,f=0,h;if(!c){const g=[T5.bind(this),void 0];for(g.unshift.apply(g,l),g.push.apply(g,u),h=g.length,d=Promise.resolve(r);f<h;)d=d.then(g[f++],g[f++]);return d}h=l.length;let p=r;for(f=0;f<h;){const g=l[f++],m=l[f++];try{p=g(p)}catch(x){m.call(this,x);break}}try{d=T5.call(this,p)}catch(g){return Promise.reject(g)}for(f=0,h=u.length;f<h;)d=d.then(u[f++],u[f++]);return d}getUri(t){t=Vc(this.defaults,t);const r=fN(t.baseURL,t.url,t.allowAbsoluteUrls);return sN(r,t.params,t.paramsSerializer)}};lt.forEach(["delete","get","head","options"],function(t){Fc.prototype[t]=function(r,n){return this.request(Vc(n||{},{method:t,url:r,data:(n||{}).data}))}});lt.forEach(["post","put","patch"],function(t){function r(n){return function(o,s,l){return this.request(Vc(l||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:s}))}}Fc.prototype[t]=r(),Fc.prototype[t+"Form"]=r(!0)});let O$=class yN{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(o){r=o});const n=this;this.promise.then(a=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](a);n._listeners=null}),this.promise.then=a=>{let o;const s=new Promise(l=>{n.subscribe(l),o=l}).then(a);return s.cancel=function(){n.unsubscribe(o)},s},t(function(o,s,l){n.reason||(n.reason=new Md(o,s,l),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new yN(function(a){t=a}),cancel:t}}};function k$(e){return function(r){return e.apply(null,r)}}function T$(e){return lt.isObject(e)&&e.isAxiosError===!0}const K2={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(K2).forEach(([e,t])=>{K2[t]=e});function xN(e){const t=new Fc(e),r=KI(Fc.prototype.request,t);return lt.extend(r,Fc.prototype,t,{allOwnKeys:!0}),lt.extend(r,t,null,{allOwnKeys:!0}),r.create=function(a){return xN(Vc(e,a))},r}const ka=xN(Dp);ka.Axios=Fc;ka.CanceledError=Md;ka.CancelToken=O$;ka.isCancel=uN;ka.VERSION=vN;ka.toFormData=Fv;ka.AxiosError=Wr;ka.Cancel=ka.CanceledError;ka.all=function(t){return Promise.all(t)};ka.spread=k$;ka.isAxiosError=T$;ka.mergeConfig=Vc;ka.AxiosHeaders=Zi;ka.formToJSON=e=>cN(lt.isHTMLForm(e)?new FormData(e):e);ka.getAdapter=gN.getAdapter;ka.HttpStatusCode=K2;ka.default=ka;const{Axios:bpe,AxiosError:fi,CanceledError:_pe,isCancel:wpe,CancelToken:jpe,VERSION:Spe,all:Cpe,Cancel:Ape,isAxiosError:Ppe,spread:Ope,toFormData:kpe,AxiosHeaders:Tpe,HttpStatusCode:Epe,formToJSON:Ipe,getAdapter:Npe,mergeConfig:Dpe}=ka,Q2=typeof window<"u"&&!!window.electronAPI;function E$(e){return e&&e.includes("localhost")&&e.startsWith("https://")?e.replace("https://","http://"):e}console.log("API baseURL:",void 0);console.log("Is Electron:",Q2);const I$={cloudflare:{baseURL:"https://api.yourdomain.com"}};function Wu(){return console.log("Environment variables:",{VITE_API_BASE_URL:void 0,VITE_CLOUDFLARE_URL:void 0,MODE:"production",NODE_ENV:"production",isElectron:Q2}),Q2&&console.log("Running in Electron - checking environment variables"),console.log("Using production config"),{baseURL:E$(I$.cloudflare.baseURL),timeout:12e4}}const I5=Wu(),Ac=(e,t)=>{try{window.dispatchEvent(new CustomEvent(e,{detail:t}))}catch{}},cx=()=>{localStorage.setItem("authRedirectMessage","Your session expired. Please sign in again."),Ac("auth:expired"),localStorage.removeItem("sessionToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),window.location.href="/login"};let gm=null;const ve=ka.create({baseURL:I5.baseURL,timeout:I5.timeout,withCredentials:!0});ve.interceptors.request.use(e=>{const t=localStorage.getItem("sessionToken");t&&(e.headers.Authorization=`Bearer ${t}`);try{const n=localStorage.getItem("user"),o=(n?JSON.parse(n):null)?.company_id;o!=null&&o!==""&&(e.headers["x-tenant-id"]=String(o))}catch{}const r=localStorage.getItem("deviceId");r&&(e.headers["x-device-id"]=r);try{const n=typeof Intl<"u"?Intl.DateTimeFormat().resolvedOptions().timeZone:void 0;n&&(e.headers["x-timezone"]=n)}catch{}return e},e=>Promise.reject(e));ve.interceptors.response.use(e=>{try{window.__backendUnavailableSince=void 0,Ac("backend:available"),Ac("connectivity:online");const t=window.__triggerSync;typeof t=="function"&&setTimeout(()=>{try{t()}catch{}},0)}catch{}return e},async e=>{try{const n=e?.response?.status,a=!e.response&&(e.code==="ECONNABORTED"||e.message?.includes("Network Error"));(typeof n=="number"&&n>=500||a)&&(window.__backendUnavailableSince=window.__backendUnavailableSince||Date.now(),Ac("backend:unavailable",{status:n,networkDown:a}),Ac("connectivity:offline",{reason:"backend"})),typeof navigator<"u"&&navigator&&navigator.onLine===!1&&Ac("connectivity:offline",{reason:"network"})}catch{}const t=e.config;if(e.response?.status===401&&t?.url?.includes("/api/auth/refresh"))return cx(),Promise.reject(e);if(e.response?.status===401&&!t._retry){t._retry=!0;const n=localStorage.getItem("refreshToken");if(n)try{return gm||(gm=ve.post("/api/auth/refresh",{refreshToken:n}).then(a=>{const{sessionToken:o,refreshToken:s}=a.data;return localStorage.setItem("sessionToken",o),localStorage.setItem("refreshToken",s),ve.defaults.headers.common.Authorization=`Bearer ${o}`,o}).catch(a=>{throw cx(),a}).finally(()=>{gm=null})),await gm,ve(t)}catch(a){return Promise.reject(a)}else cx()}const r=e?.response?.data?.message||e?.message||"Request failed. Please check your connection and try again.";return Ac("app:error",{message:r}),Promise.reject(e)});const bN=y.createContext(void 0),N$=({children:e})=>{const[t,r]=y.useState(null),[n,a]=y.useState(!1),[o,s]=y.useState("");y.useEffect(()=>{let p=localStorage.getItem("deviceId");p||(p=crypto.randomUUID(),localStorage.setItem("deviceId",p)),s(p)},[]),y.useEffect(()=>{const p=localStorage.getItem("sessionToken"),g=localStorage.getItem("refreshToken"),m=localStorage.getItem("user");if(p&&g&&m)try{const x=JSON.parse(m);r(x),a(!0),ve.defaults.headers.common.Authorization=`Bearer ${p}`,ve.defaults.headers.common["x-device-id"]=o}catch(x){console.error("Error parsing user data:",x),c()}},[o]);const l=(p,g,m)=>{localStorage.setItem("sessionToken",p),localStorage.setItem("refreshToken",g),localStorage.setItem("user",JSON.stringify(m)),ve.defaults.headers.common.Authorization=`Bearer ${p}`;const x=localStorage.getItem("deviceId");x&&(ve.defaults.headers.common["x-device-id"]=x),r(m),a(!0)},c=()=>{localStorage.removeItem("sessionToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),delete ve.defaults.headers.common.Authorization,r(null),a(!1)},u=async()=>{try{await ve.post("/api/auth/logout-all"),c()}catch(p){console.error("Error logging out from all devices:",p),c()}},d=async()=>{try{const p=localStorage.getItem("refreshToken");if(!p)return!1;const g=await ve.post("/api/auth/refresh",{refreshToken:p}),{sessionToken:m,refreshToken:x}=g.data;return localStorage.setItem("sessionToken",m),localStorage.setItem("refreshToken",x),ve.defaults.headers.common.Authorization=`Bearer ${m}`,!0}catch(p){return console.error("Error refreshing session:",p),c(),!1}},f=async()=>{try{return(await ve.get("/api/auth/sessions")).data}catch(p){return console.error("Error fetching user sessions:",p),[]}},h=async p=>{try{return await ve.delete(`/api/auth/sessions/${p}`),!0}catch(g){return console.error("Error deactivating session:",g),!1}};return i.jsx(bN.Provider,{value:{user:t,isAuthenticated:n,login:l,logout:c,logoutFromAllDevices:u,refreshSession:d,getUserSessions:f,deactivateSession:h,currentDeviceId:o},children:e})},ea=()=>{const e=y.useContext(bN);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e},N5=e=>({id:Number(e.id),companyId:Number(e.companyId??e.company_id),conversationType:e.conversationType??e.conversation_type,title:e.title??null,createdBy:Number(e.createdBy??e.created_by),createdAt:e.createdAt??e.created_at,updatedAt:e.updatedAt??e.updated_at,lastMessageAt:e.lastMessageAt??e.last_message_at??null,participants:Array.isArray(e.participants)?e.participants.map(t=>({id:Number(t.id),username:t.username??null,email:t.email??null,isAdmin:!!(t.isAdmin??t.is_admin??!1)})):[],lastMessage:e.lastMessage?{id:Number(e.lastMessage.id),conversationId:Number(e.lastMessage.conversationId??e.lastMessage.conversation_id??e.id),senderId:e.lastMessage.senderId!==void 0&&e.lastMessage.senderId!==null?Number(e.lastMessage.senderId):null,senderName:e.lastMessage.senderName??null,content:e.lastMessage.isDeletedForUser||e.lastMessage.is_deleted_for_user?"Message deleted":e.lastMessage.content??"",isSystem:!!e.lastMessage.isSystem,createdAt:e.lastMessage.createdAt??"",updatedAt:e.lastMessage.updatedAt??e.lastMessage.createdAt??"",isDeletedForUser:!!(e.lastMessage.isDeletedForUser??e.lastMessage.is_deleted_for_user??!1),deletedAt:e.lastMessage.deletedAt??e.lastMessage.deleted_at??null}:null}),ux=e=>({id:typeof e.id=="number"||typeof e.id=="string"?e.id:Number(e.id),conversationId:Number(e.conversationId??e.conversation_id),senderId:e.senderId!==void 0&&e.senderId!==null?Number(e.senderId):e.sender_id!==void 0&&e.sender_id!==null?Number(e.sender_id):null,senderName:e.senderName??e.sender_name??e.username??null,content:e.isDeletedForUser||e.is_deleted_for_user?"Message deleted":e.content??"",isSystem:!!(e.isSystem??e.is_system??!1),createdAt:e.createdAt??e.created_at??new Date().toISOString(),updatedAt:e.updatedAt??e.updated_at??e.createdAt??e.created_at??new Date().toISOString(),pending:e.pending,error:e.error,isDeletedForUser:!!(e.isDeletedForUser??e.is_deleted_for_user??!1),deletedAt:e.deletedAt??e.deleted_at??null}),rf={async createConversation(e){const t=await ve.post("/api/messaging/conversations",e),{conversation:r,created:n}=t.data;return{conversation:N5(r),created:!!n}},async getConversations(){return((await ve.get("/api/messaging/conversations")).data?.conversations??[]).map(r=>N5(r))},async getMessages(e,t={}){return((await ve.get(`/api/messaging/conversations/${e}/messages`,{params:t})).data?.messages??[]).map(a=>ux(a))},async postMessage(e,t){const r=await ve.post(`/api/messaging/conversations/${e}/messages`,{content:t});return ux(r.data?.message??r.data)},async deleteMessage(e,t){const r=await ve.delete(`/api/messaging/conversations/${e}/messages/${t}`);return ux(r.data?.message??r.data)}},_N=y.createContext(void 0),D$=(e,t)=>{const r=e.participants??[],n=t?r.filter(s=>s.id!==t):r,a=r.map(s=>s.username||s.email||"Unknown user").join(", ");if(e.conversationType==="group"){const s=e.title?.trim(),l=`${r.length} participants`;return{displayName:s||l,otherParticipants:n,participantNames:a}}if(n.length===1){const s=n[0];return{displayName:s.username||s.email||"Direct message",otherParticipants:n,participantNames:a}}return{displayName:n.length>0?n.map(s=>s.username||s.email||"Direct message").join(", "):e.title||"Direct message",otherParticipants:n,participantNames:a}},D5=e=>[...e].sort((t,r)=>{const n=t.lastMessageAt||t.updatedAt||t.createdAt,a=r.lastMessageAt||r.updatedAt||r.createdAt;return new Date(a).getTime()-new Date(n).getTime()}),M$=({children:e})=>{const{isAuthenticated:t,user:r}=ea(),n=r?Number(r.id):null,[a,o]=y.useState([]),[s,l]=y.useState(!1),[c,u]=y.useState({}),[d,f]=y.useState({}),[h,p]=y.useState(null),[g,m]=y.useState({}),[x,b]=y.useState([]),_=y.useRef({});y.useEffect(()=>{_.current=c},[c]);const w=y.useMemo(()=>n?`messaging:last-read:${n}`:null,[n]);y.useEffect(()=>{if(!w){m({});return}try{const R=localStorage.getItem(w);if(R){const F=JSON.parse(R);m(F)}else m({})}catch{m({})}},[w]),y.useEffect(()=>{if(w)try{localStorage.setItem(w,JSON.stringify(g))}catch{}},[g,w]);const A=y.useCallback((R,F)=>{w&&m(W=>{const K=F??new Date().toISOString(),Z=W[R];return Z&&new Date(Z).getTime()>=new Date(K).getTime()?W:{...W,[R]:K}})},[w]),O=y.useCallback(R=>{const{displayName:F,otherParticipants:W,participantNames:K}=D$(R,n);return{...R,displayName:F,otherParticipants:W,participantNames:K}},[n]),T=y.useCallback(async(R={})=>{if(t){R.silent||l(!0);try{const F=await rf.getConversations(),W=D5(F.map(O));o(W)}catch(F){console.error("Failed to load conversations",F)}finally{R.silent||l(!1)}}},[O,t]);y.useEffect(()=>{if(!t){o([]),u({}),l(!1),f({}),p(null),b([]);return}T()},[t,T]),y.useEffect(()=>{if(!t)return;const R=setInterval(()=>{T({silent:!0}).catch(()=>{})},1e4);return()=>clearInterval(R)},[t,T]),y.useEffect(()=>{!t||a.length===0||(!h||!a.some(R=>R.id===h))&&p(a[0].id)},[h,a,t]);const E=y.useCallback(async(R,F={})=>{if(t&&!(!F.force&&_.current[R])){F.silent||f(W=>({...W,[R]:!0}));try{const W=await rf.getMessages(R);u(K=>({...K,[R]:W.map(Z=>({...Z,pending:!1,error:!1}))}))}catch(W){console.error("Failed to load messages",W)}finally{F.silent||f(W=>({...W,[R]:!1}))}}},[t]);y.useEffect(()=>{h&&E(h).catch(()=>{})},[h,E]),y.useEffect(()=>{if(!h||!t)return;const R=setInterval(()=>{E(h,{force:!0,silent:!0}).catch(()=>{})},1e4);return()=>clearInterval(R)},[h,t,E]);const S=y.useCallback(R=>{p(R),R&&E(R).catch(()=>{})},[E]),I=y.useCallback(async(R,F)=>{if(!t||!r)throw new Error("Not authenticated");const W=F.trim();if(!W)throw new Error("Message cannot be empty");const K=`temp-${Date.now()}`,Z={id:K,conversationId:R,senderId:n,senderName:r.username||r.email||null,content:W,isSystem:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),pending:!0};u(D=>{const P=D[R]??[];return{...D,[R]:[...P,Z]}});try{const D=await rf.postMessage(R,W);return u(P=>{const $=P[R]??[];return{...P,[R]:$.map(Q=>Q.id===K?D:Q)}}),await T(),A(R,new Date().toISOString()),D}catch(D){throw u(P=>{const $=P[R]??[];return{...P,[R]:$.map(Q=>Q.id===K?{...Q,pending:!1,error:!0}:Q)}}),D}},[n,t,T,r]),z=y.useCallback(async(R,F)=>{if(!t)throw new Error("Not authenticated");const W=await rf.deleteMessage(R,F);return u(K=>{const Z=K[R]??[];return{...K,[R]:Z.map(D=>Number(D.id)===Number(F)?{...D,...W,id:D.id,content:"Message deleted",isDeletedForUser:!0,deletedAt:W.deletedAt??null,pending:!1,error:!1}:D)}}),T({silent:!0}).catch(()=>{}),W},[t,T]),k=y.useCallback(async R=>{if(!t)throw new Error("Not authenticated");const F=await rf.createConversation(R),W=O(F.conversation);return o(K=>{const Z=K.filter(D=>D.id!==W.id);return D5([W,...Z])}),p(W.id),F.created&&u(K=>({...K,[W.id]:[]})),A(W.id,new Date().toISOString()),{conversation:W,created:F.created}},[O,t,A]);y.useEffect(()=>{if(!t){b([]);return}const R=a.filter(F=>{const W=F.lastMessage;if(!W)return!1;const K=F.lastMessageAt||W.updatedAt||W.createdAt;if(!K)return!1;const Z=new Date(K).getTime();if(!Z||Number.isNaN(Z))return!1;const D=g[F.id]?new Date(g[F.id]).getTime():0;if(D&&D>=Z)return!1;const P=W.senderId!==null&&W.senderId!==void 0?Number(W.senderId):null;return!(P!==null&&n!==null&&P===n)}).map(F=>F.id);b(R)},[a,n,t,g]),y.useEffect(()=>{if(!h)return;const R=a.find(W=>W.id===h);if(!R)return;const F=R.lastMessageAt||R.updatedAt||R.createdAt;F&&A(h,F)},[h,a,A]);const M=y.useMemo(()=>({conversations:a,isLoadingConversations:s,activeConversationId:h,selectConversation:S,messagesByConversation:c,loadMessages:E,isLoadingMessages:d,sendMessage:I,createConversation:k,refreshConversations:T,deleteMessage:z,unreadConversationIds:x,unreadConversationCount:x.length,markConversationRead:A}),[a,s,h,S,c,E,d,I,k,T,z,x,A]);return i.jsx(_N.Provider,{value:M,children:e})},wN=()=>{const e=y.useContext(_N);if(!e)throw new Error("useMessaging must be used within a MessagingProvider");return e},L$=u8({palette:{primary:{main:"#7c3aed"},secondary:{main:"#ffd600"}},typography:{h4:{fontSize:"1.5rem",fontWeight:600},h6:{fontSize:"1.2rem",fontWeight:500}}});var Hm={exports:{}},R$=Hm.exports,M5;function q$(){return M5||(M5=1,function(e,t){(function(r,n){e.exports=n()})(R$,function(){var r=1e3,n=6e4,a=36e5,o="millisecond",s="second",l="minute",c="hour",u="day",d="week",f="month",h="quarter",p="year",g="date",m="Invalid Date",x=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,b=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,_={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(F){var W=["th","st","nd","rd"],K=F%100;return"["+F+(W[(K-20)%10]||W[K]||W[0])+"]"}},w=function(F,W,K){var Z=String(F);return!Z||Z.length>=W?F:""+Array(W+1-Z.length).join(K)+F},A={s:w,z:function(F){var W=-F.utcOffset(),K=Math.abs(W),Z=Math.floor(K/60),D=K%60;return(W<=0?"+":"-")+w(Z,2,"0")+":"+w(D,2,"0")},m:function F(W,K){if(W.date()<K.date())return-F(K,W);var Z=12*(K.year()-W.year())+(K.month()-W.month()),D=W.clone().add(Z,f),P=K-D<0,$=W.clone().add(Z+(P?-1:1),f);return+(-(Z+(K-D)/(P?D-$:$-D))||0)},a:function(F){return F<0?Math.ceil(F)||0:Math.floor(F)},p:function(F){return{M:f,y:p,w:d,d:u,D:g,h:c,m:l,s,ms:o,Q:h}[F]||String(F||"").toLowerCase().replace(/s$/,"")},u:function(F){return F===void 0}},O="en",T={};T[O]=_;var E="$isDayjsObject",S=function(F){return F instanceof M||!(!F||!F[E])},I=function F(W,K,Z){var D;if(!W)return O;if(typeof W=="string"){var P=W.toLowerCase();T[P]&&(D=P),K&&(T[P]=K,D=P);var $=W.split("-");if(!D&&$.length>1)return F($[0])}else{var Q=W.name;T[Q]=W,D=Q}return!Z&&D&&(O=D),D||!Z&&O},z=function(F,W){if(S(F))return F.clone();var K=typeof W=="object"?W:{};return K.date=F,K.args=arguments,new M(K)},k=A;k.l=I,k.i=S,k.w=function(F,W){return z(F,{locale:W.$L,utc:W.$u,x:W.$x,$offset:W.$offset})};var M=function(){function F(K){this.$L=I(K.locale,null,!0),this.parse(K),this.$x=this.$x||K.x||{},this[E]=!0}var W=F.prototype;return W.parse=function(K){this.$d=function(Z){var D=Z.date,P=Z.utc;if(D===null)return new Date(NaN);if(k.u(D))return new Date;if(D instanceof Date)return new Date(D);if(typeof D=="string"&&!/Z$/i.test(D)){var $=D.match(x);if($){var Q=$[2]-1||0,C=($[7]||"0").substring(0,3);return P?new Date(Date.UTC($[1],Q,$[3]||1,$[4]||0,$[5]||0,$[6]||0,C)):new Date($[1],Q,$[3]||1,$[4]||0,$[5]||0,$[6]||0,C)}}return new Date(D)}(K),this.init()},W.init=function(){var K=this.$d;this.$y=K.getFullYear(),this.$M=K.getMonth(),this.$D=K.getDate(),this.$W=K.getDay(),this.$H=K.getHours(),this.$m=K.getMinutes(),this.$s=K.getSeconds(),this.$ms=K.getMilliseconds()},W.$utils=function(){return k},W.isValid=function(){return this.$d.toString()!==m},W.isSame=function(K,Z){var D=z(K);return this.startOf(Z)<=D&&D<=this.endOf(Z)},W.isAfter=function(K,Z){return z(K)<this.startOf(Z)},W.isBefore=function(K,Z){return this.endOf(Z)<z(K)},W.$g=function(K,Z,D){return k.u(K)?this[Z]:this.set(D,K)},W.unix=function(){return Math.floor(this.valueOf()/1e3)},W.valueOf=function(){return this.$d.getTime()},W.startOf=function(K,Z){var D=this,P=!!k.u(Z)||Z,$=k.p(K),Q=function(ae,he){var me=k.w(D.$u?Date.UTC(D.$y,he,ae):new Date(D.$y,he,ae),D);return P?me:me.endOf(u)},C=function(ae,he){return k.w(D.toDate()[ae].apply(D.toDate("s"),(P?[0,0,0,0]:[23,59,59,999]).slice(he)),D)},L=this.$W,H=this.$M,U=this.$D,te="set"+(this.$u?"UTC":"");switch($){case p:return P?Q(1,0):Q(31,11);case f:return P?Q(1,H):Q(0,H+1);case d:var le=this.$locale().weekStart||0,oe=(L<le?L+7:L)-le;return Q(P?U-oe:U+(6-oe),H);case u:case g:return C(te+"Hours",0);case c:return C(te+"Minutes",1);case l:return C(te+"Seconds",2);case s:return C(te+"Milliseconds",3);default:return this.clone()}},W.endOf=function(K){return this.startOf(K,!1)},W.$set=function(K,Z){var D,P=k.p(K),$="set"+(this.$u?"UTC":""),Q=(D={},D[u]=$+"Date",D[g]=$+"Date",D[f]=$+"Month",D[p]=$+"FullYear",D[c]=$+"Hours",D[l]=$+"Minutes",D[s]=$+"Seconds",D[o]=$+"Milliseconds",D)[P],C=P===u?this.$D+(Z-this.$W):Z;if(P===f||P===p){var L=this.clone().set(g,1);L.$d[Q](C),L.init(),this.$d=L.set(g,Math.min(this.$D,L.daysInMonth())).$d}else Q&&this.$d[Q](C);return this.init(),this},W.set=function(K,Z){return this.clone().$set(K,Z)},W.get=function(K){return this[k.p(K)]()},W.add=function(K,Z){var D,P=this;K=Number(K);var $=k.p(Z),Q=function(H){var U=z(P);return k.w(U.date(U.date()+Math.round(H*K)),P)};if($===f)return this.set(f,this.$M+K);if($===p)return this.set(p,this.$y+K);if($===u)return Q(1);if($===d)return Q(7);var C=(D={},D[l]=n,D[c]=a,D[s]=r,D)[$]||1,L=this.$d.getTime()+K*C;return k.w(L,this)},W.subtract=function(K,Z){return this.add(-1*K,Z)},W.format=function(K){var Z=this,D=this.$locale();if(!this.isValid())return D.invalidDate||m;var P=K||"YYYY-MM-DDTHH:mm:ssZ",$=k.z(this),Q=this.$H,C=this.$m,L=this.$M,H=D.weekdays,U=D.months,te=D.meridiem,le=function(he,me,X,G){return he&&(he[me]||he(Z,P))||X[me].slice(0,G)},oe=function(he){return k.s(Q%12||12,he,"0")},ae=te||function(he,me,X){var G=he<12?"AM":"PM";return X?G.toLowerCase():G};return P.replace(b,function(he,me){return me||function(X){switch(X){case"YY":return String(Z.$y).slice(-2);case"YYYY":return k.s(Z.$y,4,"0");case"M":return L+1;case"MM":return k.s(L+1,2,"0");case"MMM":return le(D.monthsShort,L,U,3);case"MMMM":return le(U,L);case"D":return Z.$D;case"DD":return k.s(Z.$D,2,"0");case"d":return String(Z.$W);case"dd":return le(D.weekdaysMin,Z.$W,H,2);case"ddd":return le(D.weekdaysShort,Z.$W,H,3);case"dddd":return H[Z.$W];case"H":return String(Q);case"HH":return k.s(Q,2,"0");case"h":return oe(1);case"hh":return oe(2);case"a":return ae(Q,C,!0);case"A":return ae(Q,C,!1);case"m":return String(C);case"mm":return k.s(C,2,"0");case"s":return String(Z.$s);case"ss":return k.s(Z.$s,2,"0");case"SSS":return k.s(Z.$ms,3,"0");case"Z":return $}return null}(he)||$.replace(":","")})},W.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},W.diff=function(K,Z,D){var P,$=this,Q=k.p(Z),C=z(K),L=(C.utcOffset()-this.utcOffset())*n,H=this-C,U=function(){return k.m($,C)};switch(Q){case p:P=U()/12;break;case f:P=U();break;case h:P=U()/3;break;case d:P=(H-L)/6048e5;break;case u:P=(H-L)/864e5;break;case c:P=H/a;break;case l:P=H/n;break;case s:P=H/r;break;default:P=H}return D?P:k.a(P)},W.daysInMonth=function(){return this.endOf(f).$D},W.$locale=function(){return T[this.$L]},W.locale=function(K,Z){if(!K)return this.$L;var D=this.clone(),P=I(K,Z,!0);return P&&(D.$L=P),D},W.clone=function(){return k.w(this.$d,this)},W.toDate=function(){return new Date(this.valueOf())},W.toJSON=function(){return this.isValid()?this.toISOString():null},W.toISOString=function(){return this.$d.toISOString()},W.toString=function(){return this.$d.toUTCString()},F}(),R=M.prototype;return z.prototype=R,[["$ms",o],["$s",s],["$m",l],["$H",c],["$W",u],["$M",f],["$y",p],["$D",g]].forEach(function(F){R[F[1]]=function(W){return this.$g(W,F[0],F[1])}}),z.extend=function(F,W){return F.$i||(F(W,M,z),F.$i=!0),z},z.locale=I,z.isDayjs=S,z.unix=function(F){return z(1e3*F)},z.en=T[O],z.Ls=T,z.p={},z})}(Hm)),Hm.exports}var F$=q$();const Rt=It(F$);var Vm={exports:{}},$$=Vm.exports,L5;function B$(){return L5||(L5=1,function(e,t){(function(r,n){e.exports=n()})($$,function(){var r="week",n="year";return function(a,o,s){var l=o.prototype;l.week=function(c){if(c===void 0&&(c=null),c!==null)return this.add(7*(c-this.week()),"day");var u=this.$locale().yearStart||1;if(this.month()===11&&this.date()>25){var d=s(this).startOf(n).add(1,n).date(u),f=s(this).endOf(r);if(d.isBefore(f))return 1}var h=s(this).startOf(n).date(u).startOf(r).subtract(1,"millisecond"),p=this.diff(h,r,!0);return p<0?s(this).startOf("week").week():Math.ceil(p)},l.weeks=function(c){return c===void 0&&(c=null),this.week(c)}}})}(Vm)),Vm.exports}var U$=B$();const z$=It(U$);var Gm={exports:{}},W$=Gm.exports,R5;function H$(){return R5||(R5=1,function(e,t){(function(r,n){e.exports=n()})(W$,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},n=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,a=/\d/,o=/\d\d/,s=/\d\d?/,l=/\d*[^-_:/,()\s\d]+/,c={},u=function(x){return(x=+x)+(x>68?1900:2e3)},d=function(x){return function(b){this[x]=+b}},f=[/[+-]\d\d:?(\d\d)?|Z/,function(x){(this.zone||(this.zone={})).offset=function(b){if(!b||b==="Z")return 0;var _=b.match(/([+-]|\d\d)/g),w=60*_[1]+(+_[2]||0);return w===0?0:_[0]==="+"?-w:w}(x)}],h=function(x){var b=c[x];return b&&(b.indexOf?b:b.s.concat(b.f))},p=function(x,b){var _,w=c.meridiem;if(w){for(var A=1;A<=24;A+=1)if(x.indexOf(w(A,0,b))>-1){_=A>12;break}}else _=x===(b?"pm":"PM");return _},g={A:[l,function(x){this.afternoon=p(x,!1)}],a:[l,function(x){this.afternoon=p(x,!0)}],Q:[a,function(x){this.month=3*(x-1)+1}],S:[a,function(x){this.milliseconds=100*+x}],SS:[o,function(x){this.milliseconds=10*+x}],SSS:[/\d{3}/,function(x){this.milliseconds=+x}],s:[s,d("seconds")],ss:[s,d("seconds")],m:[s,d("minutes")],mm:[s,d("minutes")],H:[s,d("hours")],h:[s,d("hours")],HH:[s,d("hours")],hh:[s,d("hours")],D:[s,d("day")],DD:[o,d("day")],Do:[l,function(x){var b=c.ordinal,_=x.match(/\d+/);if(this.day=_[0],b)for(var w=1;w<=31;w+=1)b(w).replace(/\[|\]/g,"")===x&&(this.day=w)}],w:[s,d("week")],ww:[o,d("week")],M:[s,d("month")],MM:[o,d("month")],MMM:[l,function(x){var b=h("months"),_=(h("monthsShort")||b.map(function(w){return w.slice(0,3)})).indexOf(x)+1;if(_<1)throw new Error;this.month=_%12||_}],MMMM:[l,function(x){var b=h("months").indexOf(x)+1;if(b<1)throw new Error;this.month=b%12||b}],Y:[/[+-]?\d+/,d("year")],YY:[o,function(x){this.year=u(x)}],YYYY:[/\d{4}/,d("year")],Z:f,ZZ:f};function m(x){var b,_;b=x,_=c&&c.formats;for(var w=(x=b.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(z,k,M){var R=M&&M.toUpperCase();return k||_[M]||r[M]||_[R].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(F,W,K){return W||K.slice(1)})})).match(n),A=w.length,O=0;O<A;O+=1){var T=w[O],E=g[T],S=E&&E[0],I=E&&E[1];w[O]=I?{regex:S,parser:I}:T.replace(/^\[|\]$/g,"")}return function(z){for(var k={},M=0,R=0;M<A;M+=1){var F=w[M];if(typeof F=="string")R+=F.length;else{var W=F.regex,K=F.parser,Z=z.slice(R),D=W.exec(Z)[0];K.call(k,D),z=z.replace(D,"")}}return function(P){var $=P.afternoon;if($!==void 0){var Q=P.hours;$?Q<12&&(P.hours+=12):Q===12&&(P.hours=0),delete P.afternoon}}(k),k}}return function(x,b,_){_.p.customParseFormat=!0,x&&x.parseTwoDigitYear&&(u=x.parseTwoDigitYear);var w=b.prototype,A=w.parse;w.parse=function(O){var T=O.date,E=O.utc,S=O.args;this.$u=E;var I=S[1];if(typeof I=="string"){var z=S[2]===!0,k=S[3]===!0,M=z||k,R=S[2];k&&(R=S[2]),c=this.$locale(),!z&&R&&(c=_.Ls[R]),this.$d=function(Z,D,P,$){try{if(["x","X"].indexOf(D)>-1)return new Date((D==="X"?1e3:1)*Z);var Q=m(D)(Z),C=Q.year,L=Q.month,H=Q.day,U=Q.hours,te=Q.minutes,le=Q.seconds,oe=Q.milliseconds,ae=Q.zone,he=Q.week,me=new Date,X=H||(C||L?1:me.getDate()),G=C||me.getFullYear(),ee=0;C&&!L||(ee=L>0?L-1:me.getMonth());var se,V=U||0,He=te||0,Ne=le||0,Re=oe||0;return ae?new Date(Date.UTC(G,ee,X,V,He,Ne,Re+60*ae.offset*1e3)):P?new Date(Date.UTC(G,ee,X,V,He,Ne,Re)):(se=new Date(G,ee,X,V,He,Ne,Re),he&&(se=$(se).week(he).toDate()),se)}catch{return new Date("")}}(T,I,E,_),this.init(),R&&R!==!0&&(this.$L=this.locale(R).$L),M&&T!=this.format(I)&&(this.$d=new Date("")),c={}}else if(I instanceof Array)for(var F=I.length,W=1;W<=F;W+=1){S[1]=I[W-1];var K=_.apply(this,S);if(K.isValid()){this.$d=K.$d,this.$L=K.$L,this.init();break}W===F&&(this.$d=new Date(""))}else A.call(this,O)}}})}(Gm)),Gm.exports}var V$=H$();const G$=It(V$);var Ym={exports:{}},Y$=Ym.exports,q5;function K$(){return q5||(q5=1,function(e,t){(function(r,n){e.exports=n()})(Y$,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(n,a,o){var s=a.prototype,l=s.format;o.en.formats=r,s.format=function(c){c===void 0&&(c="YYYY-MM-DDTHH:mm:ssZ");var u=this.$locale().formats,d=function(f,h){return f.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(p,g,m){var x=m&&m.toUpperCase();return g||h[m]||r[m]||h[x].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(b,_,w){return _||w.slice(1)})})}(c,u===void 0?{}:u);return l.call(this,d)}}})}(Ym)),Ym.exports}var Q$=K$();const X$=It(Q$);var Km={exports:{}},J$=Km.exports,F5;function Z$(){return F5||(F5=1,function(e,t){(function(r,n){e.exports=n()})(J$,function(){return function(r,n,a){n.prototype.isBetween=function(o,s,l,c){var u=a(o),d=a(s),f=(c=c||"()")[0]==="(",h=c[1]===")";return(f?this.isAfter(u,l):!this.isBefore(u,l))&&(h?this.isBefore(d,l):!this.isAfter(d,l))||(f?this.isBefore(u,l):!this.isAfter(u,l))&&(h?this.isAfter(d,l):!this.isBefore(d,l))}}})}(Km)),Km.exports}var e7=Z$();const t7=It(e7);Rt.extend(G$);Rt.extend(X$);Rt.extend(t7);const r7=d8(["Your locale has not been found.","Either the locale key is not a supported one. Locales supported by dayjs are available here: https://github.com/iamkun/dayjs/tree/dev/src/locale","Or you forget to import the locale from 'dayjs/locale/{localeUsed}'","fallback on English locale"]),n7={YY:"year",YYYY:{sectionType:"year",contentType:"digit",maxLength:4},M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMM:{sectionType:"month",contentType:"letter"},MMMM:{sectionType:"month",contentType:"letter"},D:{sectionType:"day",contentType:"digit",maxLength:2},DD:"day",Do:{sectionType:"day",contentType:"digit-with-letter"},d:{sectionType:"weekDay",contentType:"digit",maxLength:2},dd:{sectionType:"weekDay",contentType:"letter"},ddd:{sectionType:"weekDay",contentType:"letter"},dddd:{sectionType:"weekDay",contentType:"letter"},A:"meridiem",a:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},a7={year:"YYYY",month:"MMMM",monthShort:"MMM",dayOfMonth:"D",weekday:"dddd",weekdayShort:"dd",hours24h:"HH",hours12h:"hh",meridiem:"A",minutes:"mm",seconds:"ss",fullDate:"ll",fullDateWithWeekday:"dddd, LL",keyboardDate:"L",shortDate:"MMM D",normalDate:"D MMMM",normalDateWithWeekday:"ddd, MMM D",monthAndYear:"MMMM YYYY",monthAndDate:"MMMM D",fullTime:"LT",fullTime12h:"hh:mm A",fullTime24h:"HH:mm",fullDateTime:"lll",fullDateTime12h:"ll hh:mm A",fullDateTime24h:"ll HH:mm",keyboardDateTime:"L LT",keyboardDateTime12h:"L hh:mm A",keyboardDateTime24h:"L HH:mm"},dx=["Missing UTC plugin","To be able to use UTC or timezones, you have to enable the `utc` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-utc"].join(`
`),$5=["Missing timezone plugin","To be able to use timezones, you have to enable both the `utc` and the `timezone` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-timezone"].join(`
`),i7=(e,t)=>t?(...r)=>e(...r).locale(t):e;class oc{constructor({locale:t,formats:r,instance:n}={}){var a;this.isMUIAdapter=!0,this.isTimezoneCompatible=!0,this.lib="dayjs",this.rawDayJsInstance=void 0,this.dayjs=void 0,this.locale=void 0,this.formats=void 0,this.escapedCharacters={start:"[",end:"]"},this.formatTokenMap=n7,this.setLocaleToValue=o=>{const s=this.getCurrentLocaleCode();return s===o.locale()?o:o.locale(s)},this.hasUTCPlugin=()=>typeof Rt.utc<"u",this.hasTimezonePlugin=()=>typeof Rt.tz<"u",this.isSame=(o,s,l)=>{const c=this.setTimezone(s,this.getTimezone(o));return o.format(l)===c.format(l)},this.cleanTimezone=o=>{switch(o){case"default":return;case"system":return Rt.tz.guess();default:return o}},this.createSystemDate=o=>{if(this.rawDayJsInstance)return this.rawDayJsInstance(o);if(this.hasUTCPlugin()&&this.hasTimezonePlugin()){const s=Rt.tz.guess();return s!=="UTC"?Rt.tz(o,s):Rt(o)}return Rt(o)},this.createUTCDate=o=>{if(!this.hasUTCPlugin())throw new Error(dx);return Rt.utc(o)},this.createTZDate=(o,s)=>{if(!this.hasUTCPlugin())throw new Error(dx);if(!this.hasTimezonePlugin())throw new Error($5);const l=o!==void 0&&!o.endsWith("Z");return Rt(o).tz(this.cleanTimezone(s),l)},this.getLocaleFormats=()=>{const o=Rt.Ls,s=this.locale||"en";let l=o[s];return l===void 0&&(r7(),l=o.en),l.formats},this.adjustOffset=o=>{if(!this.hasTimezonePlugin())return o;const s=this.getTimezone(o);if(s!=="UTC"){var l,c;const u=o.tz(this.cleanTimezone(s),!0);if(((l=u.$offset)!=null?l:0)===((c=o.$offset)!=null?c:0))return o;o.$offset=u.$offset}return o},this.date=o=>o===null?null:this.dayjs(o),this.dateWithTimezone=(o,s)=>{if(o===null)return null;let l;return s==="UTC"?l=this.createUTCDate(o):s==="system"||s==="default"&&!this.hasTimezonePlugin()?l=this.createSystemDate(o):l=this.createTZDate(o,s),this.locale===void 0?l:l.locale(this.locale)},this.getTimezone=o=>{if(this.hasTimezonePlugin()){var s;const l=(s=o.$x)==null?void 0:s.$timezone;if(l)return l}return this.hasUTCPlugin()&&o.isUTC()?"UTC":"system"},this.setTimezone=(o,s)=>{if(this.getTimezone(o)===s)return o;if(s==="UTC"){if(!this.hasUTCPlugin())throw new Error(dx);return o.utc()}if(s==="system")return o.local();if(!this.hasTimezonePlugin()){if(s==="default")return o;throw new Error($5)}return Rt.tz(o,this.cleanTimezone(s))},this.toJsDate=o=>o.toDate(),this.parseISO=o=>this.dayjs(o),this.toISO=o=>o.toISOString(),this.parse=(o,s)=>o===""?null:this.dayjs(o,s,this.locale,!0),this.getCurrentLocaleCode=()=>this.locale||"en",this.is12HourCycleInCurrentLocale=()=>/A|a/.test(this.getLocaleFormats().LT||""),this.expandFormat=o=>{const s=this.getLocaleFormats(),l=c=>c.replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(u,d,f)=>d||f.slice(1));return o.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(c,u,d)=>{const f=d&&d.toUpperCase();return u||s[d]||l(s[f])})},this.getFormatHelperText=o=>this.expandFormat(o).replace(/a/gi,"(a|p)m").toLocaleLowerCase(),this.isNull=o=>o===null,this.isValid=o=>this.dayjs(o).isValid(),this.format=(o,s)=>this.formatByString(o,this.formats[s]),this.formatByString=(o,s)=>this.dayjs(o).format(s),this.formatNumber=o=>o,this.getDiff=(o,s,l)=>o.diff(s,l),this.isEqual=(o,s)=>o===null&&s===null?!0:this.dayjs(o).toDate().getTime()===this.dayjs(s).toDate().getTime(),this.isSameYear=(o,s)=>this.isSame(o,s,"YYYY"),this.isSameMonth=(o,s)=>this.isSame(o,s,"YYYY-MM"),this.isSameDay=(o,s)=>this.isSame(o,s,"YYYY-MM-DD"),this.isSameHour=(o,s)=>o.isSame(s,"hour"),this.isAfter=(o,s)=>o>s,this.isAfterYear=(o,s)=>this.hasUTCPlugin()?!this.isSameYear(o,s)&&o.utc()>s.utc():o.isAfter(s,"year"),this.isAfterDay=(o,s)=>this.hasUTCPlugin()?!this.isSameDay(o,s)&&o.utc()>s.utc():o.isAfter(s,"day"),this.isBefore=(o,s)=>o<s,this.isBeforeYear=(o,s)=>this.hasUTCPlugin()?!this.isSameYear(o,s)&&o.utc()<s.utc():o.isBefore(s,"year"),this.isBeforeDay=(o,s)=>this.hasUTCPlugin()?!this.isSameDay(o,s)&&o.utc()<s.utc():o.isBefore(s,"day"),this.isWithinRange=(o,[s,l])=>o>=s&&o<=l,this.startOfYear=o=>this.adjustOffset(o.startOf("year")),this.startOfMonth=o=>this.adjustOffset(o.startOf("month")),this.startOfWeek=o=>this.adjustOffset(o.startOf("week")),this.startOfDay=o=>this.adjustOffset(o.startOf("day")),this.endOfYear=o=>this.adjustOffset(o.endOf("year")),this.endOfMonth=o=>this.adjustOffset(o.endOf("month")),this.endOfWeek=o=>this.adjustOffset(o.endOf("week")),this.endOfDay=o=>this.adjustOffset(o.endOf("day")),this.addYears=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"year"):o.add(s,"year")),this.addMonths=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"month"):o.add(s,"month")),this.addWeeks=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"week"):o.add(s,"week")),this.addDays=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"day"):o.add(s,"day")),this.addHours=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"hour"):o.add(s,"hour")),this.addMinutes=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"minute"):o.add(s,"minute")),this.addSeconds=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"second"):o.add(s,"second")),this.getYear=o=>o.year(),this.getMonth=o=>o.month(),this.getDate=o=>o.date(),this.getHours=o=>o.hour(),this.getMinutes=o=>o.minute(),this.getSeconds=o=>o.second(),this.getMilliseconds=o=>o.millisecond(),this.setYear=(o,s)=>this.adjustOffset(o.set("year",s)),this.setMonth=(o,s)=>this.adjustOffset(o.set("month",s)),this.setDate=(o,s)=>this.adjustOffset(o.set("date",s)),this.setHours=(o,s)=>this.adjustOffset(o.set("hour",s)),this.setMinutes=(o,s)=>this.adjustOffset(o.set("minute",s)),this.setSeconds=(o,s)=>this.adjustOffset(o.set("second",s)),this.setMilliseconds=(o,s)=>this.adjustOffset(o.set("millisecond",s)),this.getDaysInMonth=o=>o.daysInMonth(),this.getNextMonth=o=>this.addMonths(o,1),this.getPreviousMonth=o=>this.addMonths(o,-1),this.getMonthArray=o=>{const l=[o.startOf("year")];for(;l.length<12;){const c=l[l.length-1];l.push(this.addMonths(c,1))}return l},this.mergeDateAndTime=(o,s)=>o.hour(s.hour()).minute(s.minute()).second(s.second()),this.getWeekdays=()=>{const o=this.dayjs().startOf("week");return[0,1,2,3,4,5,6].map(s=>this.formatByString(this.addDays(o,s),"dd"))},this.getWeekArray=o=>{const s=this.setLocaleToValue(o),l=s.startOf("month").startOf("week"),c=s.endOf("month").endOf("week");let u=0,d=l;const f=[];for(;d<c;){const h=Math.floor(u/7);f[h]=f[h]||[],f[h].push(d),d=this.addDays(d,1),u+=1}return f},this.getWeekNumber=o=>o.week(),this.getYearRange=(o,s)=>{const l=o.startOf("year"),c=s.endOf("year"),u=[];let d=l;for(;d<c;)u.push(d),d=this.addYears(d,1);return u},this.getMeridiemText=o=>o==="am"?"AM":"PM",this.rawDayJsInstance=n,this.dayjs=i7((a=this.rawDayJsInstance)!=null?a:Rt,t),this.locale=t,this.formats=wI({},a7,r),Rt.extend(z$)}}const Sh=async()=>{try{const e=await window?.api?.timeEvents?.pendingCount?.();return e?.success?e.count:0}catch{return 0}},o7=async(e=200)=>{const t=await window?.api?.timeEvents?.listPending?.(e);return t?.success?t.rows:[]},B5=async()=>{const e=await o7(200);let t=0,r=0;const n=[];for(const a of e)try{const o=JSON.parse(a.payload_json||"{}");switch(a.type){case"attendance_clock_in":await ve.post("/api/attendance/clock-in",{profile_id:o.profile_id,latitude:o.latitude,longitude:o.longitude});break;case"attendance_clock_out":await ve.post("/api/attendance/clock-out",{shift_id:o.shift_id});break;case"attendance_update":await ve.put(`/api/attendance/${o.shift_id}`,{clock_in:o.clock_in,clock_out:o.clock_out});break;case"time_clock_in":await ve.post("/api/time-tracking/time-entries/clock-in",{profile_id:o.profile_id,so_id:o.so_id});break;case"time_clock_out":await ve.post(`/api/time-tracking/time-entries/${o.id}/clock-out`);break;default:r++;continue}n.push(a.event_id),t++}catch{r++}return n.length&&await window?.api?.timeEvents?.markSynced?.(n),{synced:t,failed:r}};var nf={},fx={};const s7=G8(f8);var U5;function dr(){return U5||(U5=1,function(e){"use client";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=s7}(fx)),fx}var z5;function l7(){if(z5)return nf;z5=1;var e=cr();Object.defineProperty(nf,"__esModule",{value:!0}),nf.default=void 0;var t=e(dr()),r=ur();return nf.default=(0,t.default)((0,r.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 9h12v2H6zm8 5H6v-2h8zm4-6H6V6h12z"}),"Chat"),nf}var c7=l7();const u7=It(c7);var af={},W5;function d7(){if(W5)return af;W5=1;var e=cr();Object.defineProperty(af,"__esModule",{value:!0}),af.default=void 0;var t=e(dr()),r=ur();return af.default=(0,t.default)((0,r.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),af}var f7=d7();const lj=It(f7);var of={},H5;function h7(){if(H5)return of;H5=1;var e=cr();Object.defineProperty(of,"__esModule",{value:!0}),of.default=void 0;var t=e(dr()),r=ur();return of.default=(0,t.default)((0,r.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),of}var p7=h7();const jN=It(p7);var sf={},V5;function m7(){if(V5)return sf;V5=1;var e=cr();Object.defineProperty(sf,"__esModule",{value:!0}),sf.default=void 0;var t=e(dr()),r=ur();return sf.default=(0,t.default)((0,r.jsx)("path",{d:"M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3M7.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S9.83 13 9 13s-1.5-.67-1.5-1.5M16 17H8v-2h8zm-1-4c-.83 0-1.5-.67-1.5-1.5S14.17 10 15 10s1.5.67 1.5 1.5S15.83 13 15 13"}),"SmartToy"),sf}var g7=m7();const v7=It(g7);var lf={},G5;function y7(){if(G5)return lf;G5=1;var e=cr();Object.defineProperty(lf,"__esModule",{value:!0}),lf.default=void 0;var t=e(dr()),r=ur();return lf.default=(0,t.default)((0,r.jsx)("path",{d:"M9 17H7v-7h2zm4 0h-2V7h2zm4 0h-2v-4h2zm2.5 2.1h-15V5h15zm0-16.1h-15c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"}),"InsertChartOutlined"),lf}var x7=y7();const b7=It(x7);var cf={},Y5;function _7(){if(Y5)return cf;Y5=1;var e=cr();Object.defineProperty(cf,"__esModule",{value:!0}),cf.default=void 0;var t=e(dr()),r=ur();return cf.default=(0,t.default)((0,r.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7zm-8 2V5h2v6h1.17L12 13.17 9.83 11zm-6 7h14v2H5z"}),"DownloadOutlined"),cf}var w7=_7();const j7=It(w7);async function S7(e,t){return(await ve.post("/api/assistant",{prompt:e,mode:t})).data}var hx,K5;function eo(){if(K5)return hx;K5=1;var e=Array.isArray;return hx=e,hx}var px,Q5;function SN(){if(Q5)return px;Q5=1;var e=typeof pm=="object"&&pm&&pm.Object===Object&&pm;return px=e,px}var mx,X5;function Ls(){if(X5)return mx;X5=1;var e=SN(),t=typeof self=="object"&&self&&self.Object===Object&&self,r=e||t||Function("return this")();return mx=r,mx}var gx,J5;function Mp(){if(J5)return gx;J5=1;var e=Ls(),t=e.Symbol;return gx=t,gx}var vx,Z5;function C7(){if(Z5)return vx;Z5=1;var e=Mp(),t=Object.prototype,r=t.hasOwnProperty,n=t.toString,a=e?e.toStringTag:void 0;function o(s){var l=r.call(s,a),c=s[a];try{s[a]=void 0;var u=!0}catch{}var d=n.call(s);return u&&(l?s[a]=c:delete s[a]),d}return vx=o,vx}var yx,eC;function A7(){if(eC)return yx;eC=1;var e=Object.prototype,t=e.toString;function r(n){return t.call(n)}return yx=r,yx}var xx,tC;function _l(){if(tC)return xx;tC=1;var e=Mp(),t=C7(),r=A7(),n="[object Null]",a="[object Undefined]",o=e?e.toStringTag:void 0;function s(l){return l==null?l===void 0?a:n:o&&o in Object(l)?t(l):r(l)}return xx=s,xx}var bx,rC;function wl(){if(rC)return bx;rC=1;function e(t){return t!=null&&typeof t=="object"}return bx=e,bx}var _x,nC;function Ld(){if(nC)return _x;nC=1;var e=_l(),t=wl(),r="[object Symbol]";function n(a){return typeof a=="symbol"||t(a)&&e(a)==r}return _x=n,_x}var wx,aC;function cj(){if(aC)return wx;aC=1;var e=eo(),t=Ld(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function a(o,s){if(e(o))return!1;var l=typeof o;return l=="number"||l=="symbol"||l=="boolean"||o==null||t(o)?!0:n.test(o)||!r.test(o)||s!=null&&o in Object(s)}return wx=a,wx}var jx,iC;function sc(){if(iC)return jx;iC=1;function e(t){var r=typeof t;return t!=null&&(r=="object"||r=="function")}return jx=e,jx}var Sx,oC;function uj(){if(oC)return Sx;oC=1;var e=_l(),t=sc(),r="[object AsyncFunction]",n="[object Function]",a="[object GeneratorFunction]",o="[object Proxy]";function s(l){if(!t(l))return!1;var c=e(l);return c==n||c==a||c==r||c==o}return Sx=s,Sx}var Cx,sC;function P7(){if(sC)return Cx;sC=1;var e=Ls(),t=e["__core-js_shared__"];return Cx=t,Cx}var Ax,lC;function O7(){if(lC)return Ax;lC=1;var e=P7(),t=function(){var n=/[^.]+$/.exec(e&&e.keys&&e.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function r(n){return!!t&&t in n}return Ax=r,Ax}var Px,cC;function CN(){if(cC)return Px;cC=1;var e=Function.prototype,t=e.toString;function r(n){if(n!=null){try{return t.call(n)}catch{}try{return n+""}catch{}}return""}return Px=r,Px}var Ox,uC;function k7(){if(uC)return Ox;uC=1;var e=uj(),t=O7(),r=sc(),n=CN(),a=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,s=Function.prototype,l=Object.prototype,c=s.toString,u=l.hasOwnProperty,d=RegExp("^"+c.call(u).replace(a,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function f(h){if(!r(h)||t(h))return!1;var p=e(h)?d:o;return p.test(n(h))}return Ox=f,Ox}var kx,dC;function T7(){if(dC)return kx;dC=1;function e(t,r){return t?.[r]}return kx=e,kx}var Tx,fC;function au(){if(fC)return Tx;fC=1;var e=k7(),t=T7();function r(n,a){var o=t(n,a);return e(o)?o:void 0}return Tx=r,Tx}var Ex,hC;function Uv(){if(hC)return Ex;hC=1;var e=au(),t=e(Object,"create");return Ex=t,Ex}var Ix,pC;function E7(){if(pC)return Ix;pC=1;var e=Uv();function t(){this.__data__=e?e(null):{},this.size=0}return Ix=t,Ix}var Nx,mC;function I7(){if(mC)return Nx;mC=1;function e(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r}return Nx=e,Nx}var Dx,gC;function N7(){if(gC)return Dx;gC=1;var e=Uv(),t="__lodash_hash_undefined__",r=Object.prototype,n=r.hasOwnProperty;function a(o){var s=this.__data__;if(e){var l=s[o];return l===t?void 0:l}return n.call(s,o)?s[o]:void 0}return Dx=a,Dx}var Mx,vC;function D7(){if(vC)return Mx;vC=1;var e=Uv(),t=Object.prototype,r=t.hasOwnProperty;function n(a){var o=this.__data__;return e?o[a]!==void 0:r.call(o,a)}return Mx=n,Mx}var Lx,yC;function M7(){if(yC)return Lx;yC=1;var e=Uv(),t="__lodash_hash_undefined__";function r(n,a){var o=this.__data__;return this.size+=this.has(n)?0:1,o[n]=e&&a===void 0?t:a,this}return Lx=r,Lx}var Rx,xC;function L7(){if(xC)return Rx;xC=1;var e=E7(),t=I7(),r=N7(),n=D7(),a=M7();function o(s){var l=-1,c=s==null?0:s.length;for(this.clear();++l<c;){var u=s[l];this.set(u[0],u[1])}}return o.prototype.clear=e,o.prototype.delete=t,o.prototype.get=r,o.prototype.has=n,o.prototype.set=a,Rx=o,Rx}var qx,bC;function R7(){if(bC)return qx;bC=1;function e(){this.__data__=[],this.size=0}return qx=e,qx}var Fx,_C;function dj(){if(_C)return Fx;_C=1;function e(t,r){return t===r||t!==t&&r!==r}return Fx=e,Fx}var $x,wC;function zv(){if(wC)return $x;wC=1;var e=dj();function t(r,n){for(var a=r.length;a--;)if(e(r[a][0],n))return a;return-1}return $x=t,$x}var Bx,jC;function q7(){if(jC)return Bx;jC=1;var e=zv(),t=Array.prototype,r=t.splice;function n(a){var o=this.__data__,s=e(o,a);if(s<0)return!1;var l=o.length-1;return s==l?o.pop():r.call(o,s,1),--this.size,!0}return Bx=n,Bx}var Ux,SC;function F7(){if(SC)return Ux;SC=1;var e=zv();function t(r){var n=this.__data__,a=e(n,r);return a<0?void 0:n[a][1]}return Ux=t,Ux}var zx,CC;function $7(){if(CC)return zx;CC=1;var e=zv();function t(r){return e(this.__data__,r)>-1}return zx=t,zx}var Wx,AC;function B7(){if(AC)return Wx;AC=1;var e=zv();function t(r,n){var a=this.__data__,o=e(a,r);return o<0?(++this.size,a.push([r,n])):a[o][1]=n,this}return Wx=t,Wx}var Hx,PC;function Wv(){if(PC)return Hx;PC=1;var e=R7(),t=q7(),r=F7(),n=$7(),a=B7();function o(s){var l=-1,c=s==null?0:s.length;for(this.clear();++l<c;){var u=s[l];this.set(u[0],u[1])}}return o.prototype.clear=e,o.prototype.delete=t,o.prototype.get=r,o.prototype.has=n,o.prototype.set=a,Hx=o,Hx}var Vx,OC;function fj(){if(OC)return Vx;OC=1;var e=au(),t=Ls(),r=e(t,"Map");return Vx=r,Vx}var Gx,kC;function U7(){if(kC)return Gx;kC=1;var e=L7(),t=Wv(),r=fj();function n(){this.size=0,this.__data__={hash:new e,map:new(r||t),string:new e}}return Gx=n,Gx}var Yx,TC;function z7(){if(TC)return Yx;TC=1;function e(t){var r=typeof t;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?t!=="__proto__":t===null}return Yx=e,Yx}var Kx,EC;function Hv(){if(EC)return Kx;EC=1;var e=z7();function t(r,n){var a=r.__data__;return e(n)?a[typeof n=="string"?"string":"hash"]:a.map}return Kx=t,Kx}var Qx,IC;function W7(){if(IC)return Qx;IC=1;var e=Hv();function t(r){var n=e(this,r).delete(r);return this.size-=n?1:0,n}return Qx=t,Qx}var Xx,NC;function H7(){if(NC)return Xx;NC=1;var e=Hv();function t(r){return e(this,r).get(r)}return Xx=t,Xx}var Jx,DC;function V7(){if(DC)return Jx;DC=1;var e=Hv();function t(r){return e(this,r).has(r)}return Jx=t,Jx}var Zx,MC;function G7(){if(MC)return Zx;MC=1;var e=Hv();function t(r,n){var a=e(this,r),o=a.size;return a.set(r,n),this.size+=a.size==o?0:1,this}return Zx=t,Zx}var eb,LC;function hj(){if(LC)return eb;LC=1;var e=U7(),t=W7(),r=H7(),n=V7(),a=G7();function o(s){var l=-1,c=s==null?0:s.length;for(this.clear();++l<c;){var u=s[l];this.set(u[0],u[1])}}return o.prototype.clear=e,o.prototype.delete=t,o.prototype.get=r,o.prototype.has=n,o.prototype.set=a,eb=o,eb}var tb,RC;function AN(){if(RC)return tb;RC=1;var e=hj(),t="Expected a function";function r(n,a){if(typeof n!="function"||a!=null&&typeof a!="function")throw new TypeError(t);var o=function(){var s=arguments,l=a?a.apply(this,s):s[0],c=o.cache;if(c.has(l))return c.get(l);var u=n.apply(this,s);return o.cache=c.set(l,u)||c,u};return o.cache=new(r.Cache||e),o}return r.Cache=e,tb=r,tb}var rb,qC;function Y7(){if(qC)return rb;qC=1;var e=AN(),t=500;function r(n){var a=e(n,function(s){return o.size===t&&o.clear(),s}),o=a.cache;return a}return rb=r,rb}var nb,FC;function K7(){if(FC)return nb;FC=1;var e=Y7(),t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,n=e(function(a){var o=[];return a.charCodeAt(0)===46&&o.push(""),a.replace(t,function(s,l,c,u){o.push(c?u.replace(r,"$1"):l||s)}),o});return nb=n,nb}var ab,$C;function pj(){if($C)return ab;$C=1;function e(t,r){for(var n=-1,a=t==null?0:t.length,o=Array(a);++n<a;)o[n]=r(t[n],n,t);return o}return ab=e,ab}var ib,BC;function Q7(){if(BC)return ib;BC=1;var e=Mp(),t=pj(),r=eo(),n=Ld(),a=e?e.prototype:void 0,o=a?a.toString:void 0;function s(l){if(typeof l=="string")return l;if(r(l))return t(l,s)+"";if(n(l))return o?o.call(l):"";var c=l+"";return c=="0"&&1/l==-1/0?"-0":c}return ib=s,ib}var ob,UC;function PN(){if(UC)return ob;UC=1;var e=Q7();function t(r){return r==null?"":e(r)}return ob=t,ob}var sb,zC;function ON(){if(zC)return sb;zC=1;var e=eo(),t=cj(),r=K7(),n=PN();function a(o,s){return e(o)?o:t(o,s)?[o]:r(n(o))}return sb=a,sb}var lb,WC;function Vv(){if(WC)return lb;WC=1;var e=Ld();function t(r){if(typeof r=="string"||e(r))return r;var n=r+"";return n=="0"&&1/r==-1/0?"-0":n}return lb=t,lb}var cb,HC;function mj(){if(HC)return cb;HC=1;var e=ON(),t=Vv();function r(n,a){a=e(a,n);for(var o=0,s=a.length;n!=null&&o<s;)n=n[t(a[o++])];return o&&o==s?n:void 0}return cb=r,cb}var ub,VC;function kN(){if(VC)return ub;VC=1;var e=mj();function t(r,n,a){var o=r==null?void 0:e(r,n);return o===void 0?a:o}return ub=t,ub}var X7=kN();const Co=It(X7);var db,GC;function J7(){if(GC)return db;GC=1;function e(t){return t==null}return db=e,db}var Z7=J7();const Ur=It(Z7);var fb,YC;function eB(){if(YC)return fb;YC=1;var e=_l(),t=eo(),r=wl(),n="[object String]";function a(o){return typeof o=="string"||!t(o)&&r(o)&&e(o)==n}return fb=a,fb}var tB=eB();const Gc=It(tB);var rB=uj();const Rr=It(rB);var nB=sc();const Rd=It(nB);var hb={exports:{}},wn={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KC;function aB(){if(KC)return wn;KC=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),s=Symbol.for("react.context"),l=Symbol.for("react.server_context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.for("react.offscreen"),g;g=Symbol.for("react.module.reference");function m(x){if(typeof x=="object"&&x!==null){var b=x.$$typeof;switch(b){case e:switch(x=x.type,x){case r:case a:case n:case u:case d:return x;default:switch(x=x&&x.$$typeof,x){case l:case s:case c:case h:case f:case o:return x;default:return b}}case t:return b}}}return wn.ContextConsumer=s,wn.ContextProvider=o,wn.Element=e,wn.ForwardRef=c,wn.Fragment=r,wn.Lazy=h,wn.Memo=f,wn.Portal=t,wn.Profiler=a,wn.StrictMode=n,wn.Suspense=u,wn.SuspenseList=d,wn.isAsyncMode=function(){return!1},wn.isConcurrentMode=function(){return!1},wn.isContextConsumer=function(x){return m(x)===s},wn.isContextProvider=function(x){return m(x)===o},wn.isElement=function(x){return typeof x=="object"&&x!==null&&x.$$typeof===e},wn.isForwardRef=function(x){return m(x)===c},wn.isFragment=function(x){return m(x)===r},wn.isLazy=function(x){return m(x)===h},wn.isMemo=function(x){return m(x)===f},wn.isPortal=function(x){return m(x)===t},wn.isProfiler=function(x){return m(x)===a},wn.isStrictMode=function(x){return m(x)===n},wn.isSuspense=function(x){return m(x)===u},wn.isSuspenseList=function(x){return m(x)===d},wn.isValidElementType=function(x){return typeof x=="string"||typeof x=="function"||x===r||x===a||x===n||x===u||x===d||x===p||typeof x=="object"&&x!==null&&(x.$$typeof===h||x.$$typeof===f||x.$$typeof===o||x.$$typeof===s||x.$$typeof===c||x.$$typeof===g||x.getModuleId!==void 0)},wn.typeOf=m,wn}var QC;function iB(){return QC||(QC=1,hb.exports=aB()),hb.exports}var oB=iB(),pb,XC;function TN(){if(XC)return pb;XC=1;var e=_l(),t=wl(),r="[object Number]";function n(a){return typeof a=="number"||t(a)&&e(a)==r}return pb=n,pb}var mb,JC;function sB(){if(JC)return mb;JC=1;var e=TN();function t(r){return e(r)&&r!=+r}return mb=t,mb}var lB=sB();const Lp=It(lB);var cB=TN();const uB=It(cB);var Li=function(t){return t===0?0:t>0?1:-1},Mc=function(t){return Gc(t)&&t.indexOf("%")===t.length-1},Mt=function(t){return uB(t)&&!Lp(t)},Ya=function(t){return Mt(t)||Gc(t)},dB=0,qd=function(t){var r=++dB;return"".concat(t||"").concat(r)},Ri=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!Mt(t)&&!Gc(t))return n;var o;if(Mc(t)){var s=t.indexOf("%");o=r*parseFloat(t.slice(0,s))/100}else o=+t;return Lp(o)&&(o=n),a&&o>r&&(o=r),o},Gl=function(t){if(!t)return null;var r=Object.keys(t);return r&&r.length?t[r[0]]:null},fB=function(t){if(!Array.isArray(t))return!1;for(var r=t.length,n={},a=0;a<r;a++)if(!n[t[a]])n[t[a]]=!0;else return!0;return!1},_o=function(t,r){return Mt(t)&&Mt(r)?function(n){return t+n*(r-t)}:function(){return r}};function gg(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):Co(n,t))===r})}var hB=function(t,r){return Mt(t)&&Mt(r)?t-r:Gc(t)&&Gc(r)?t.localeCompare(r):t instanceof Date&&r instanceof Date?t.getTime()-r.getTime():String(t).localeCompare(String(r))};function Hu(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function X2(e){"@babel/helpers - typeof";return X2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X2(e)}var pB=["viewBox","children"],mB=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],ZC=["points","pathLength"],gb={svg:pB,polygon:ZC,polyline:ZC},gj=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],vg=function(t,r){if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(y.isValidElement(t)&&(n=t.props),!Rd(n))return null;var a={};return Object.keys(n).forEach(function(o){gj.includes(o)&&(a[o]=r||function(s){return n[o](n,s)})}),a},gB=function(t,r,n){return function(a){return t(r,n,a),null}},Yc=function(t,r,n){if(!Rd(t)||X2(t)!=="object")return null;var a=null;return Object.keys(t).forEach(function(o){var s=t[o];gj.includes(o)&&typeof s=="function"&&(a||(a={}),a[o]=gB(s,r,n))}),a},vB=["children"],yB=["children"];function eA(e,t){if(e==null)return{};var r=xB(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function xB(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function J2(e){"@babel/helpers - typeof";return J2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},J2(e)}var tA={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},ul=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},rA=null,vb=null,vj=function e(t){if(t===rA&&Array.isArray(vb))return vb;var r=[];return y.Children.forEach(t,function(n){Ur(n)||(oB.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),vb=r,rA=t,r};function Ao(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(a){return ul(a)}):n=[ul(t)],vj(e).forEach(function(a){var o=Co(a,"type.displayName")||Co(a,"type.name");n.indexOf(o)!==-1&&r.push(a)}),r}function yo(e,t){var r=Ao(e,t);return r&&r[0]}var nA=function(t){if(!t||!t.props)return!1;var r=t.props,n=r.width,a=r.height;return!(!Mt(n)||n<=0||!Mt(a)||a<=0)},bB=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],_B=function(t){return t&&t.type&&Gc(t.type)&&bB.indexOf(t.type)>=0},wB=function(t){return t&&J2(t)==="object"&&"clipDot"in t},jB=function(t,r,n,a){var o,s=(o=gb?.[a])!==null&&o!==void 0?o:[];return r.startsWith("data-")||!Rr(t)&&(a&&s.includes(r)||mB.includes(r))||n&&gj.includes(r)},_r=function(t,r,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var a=t;if(y.isValidElement(t)&&(a=t.props),!Rd(a))return null;var o={};return Object.keys(a).forEach(function(s){var l;jB((l=a)===null||l===void 0?void 0:l[s],s,r,n)&&(o[s]=a[s])}),o},Z2=function e(t,r){if(t===r)return!0;var n=y.Children.count(t);if(n!==y.Children.count(r))return!1;if(n===0)return!0;if(n===1)return aA(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var a=0;a<n;a++){var o=t[a],s=r[a];if(Array.isArray(o)||Array.isArray(s)){if(!e(o,s))return!1}else if(!aA(o,s))return!1}return!0},aA=function(t,r){if(Ur(t)&&Ur(r))return!0;if(!Ur(t)&&!Ur(r)){var n=t.props||{},a=n.children,o=eA(n,vB),s=r.props||{},l=s.children,c=eA(s,yB);return a&&l?Hu(o,c)&&Z2(a,l):!a&&!l?Hu(o,c):!1}return!1},iA=function(t,r){var n=[],a={};return vj(t).forEach(function(o,s){if(_B(o))n.push(o);else if(o){var l=ul(o.type),c=r[l]||{},u=c.handler,d=c.once;if(u&&(!d||!a[l])){var f=u(o,l,s);n.push(f),a[l]=!0}}}),n},SB=function(t){var r=t&&t.type;return r&&tA[r]?tA[r]:null},CB=function(t,r){return vj(r).indexOf(t)},AB=["children","width","height","viewBox","className","style","title","desc"];function e_(){return e_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},e_.apply(this,arguments)}function PB(e,t){if(e==null)return{};var r=OB(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function OB(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function t_(e){var t=e.children,r=e.width,n=e.height,a=e.viewBox,o=e.className,s=e.style,l=e.title,c=e.desc,u=PB(e,AB),d=a||{width:r,height:n,x:0,y:0},f=Nr("recharts-surface",o);return Ce.createElement("svg",e_({},_r(u,!0,"svg"),{className:f,width:r,height:n,style:s,viewBox:"".concat(d.x," ").concat(d.y," ").concat(d.width," ").concat(d.height)}),Ce.createElement("title",null,l),Ce.createElement("desc",null,c),t)}var kB=["children","className"];function r_(){return r_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},r_.apply(this,arguments)}function TB(e,t){if(e==null)return{};var r=EB(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function EB(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var pn=Ce.forwardRef(function(e,t){var r=e.children,n=e.className,a=TB(e,kB),o=Nr("recharts-layer",n);return Ce.createElement("g",r_({className:o},_r(a,!0),{ref:t}),r)}),is=function(t,r){for(var n=arguments.length,a=new Array(n>2?n-2:0),o=2;o<n;o++)a[o-2]=arguments[o]},yb,oA;function IB(){if(oA)return yb;oA=1;function e(t,r,n){var a=-1,o=t.length;r<0&&(r=-r>o?0:o+r),n=n>o?o:n,n<0&&(n+=o),o=r>n?0:n-r>>>0,r>>>=0;for(var s=Array(o);++a<o;)s[a]=t[a+r];return s}return yb=e,yb}var xb,sA;function NB(){if(sA)return xb;sA=1;var e=IB();function t(r,n,a){var o=r.length;return a=a===void 0?o:a,!n&&a>=o?r:e(r,n,a)}return xb=t,xb}var bb,lA;function EN(){if(lA)return bb;lA=1;var e="\\ud800-\\udfff",t="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",a=t+r+n,o="\\ufe0e\\ufe0f",s="\\u200d",l=RegExp("["+s+e+a+o+"]");function c(u){return l.test(u)}return bb=c,bb}var _b,cA;function DB(){if(cA)return _b;cA=1;function e(t){return t.split("")}return _b=e,_b}var wb,uA;function MB(){if(uA)return wb;uA=1;var e="\\ud800-\\udfff",t="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",a=t+r+n,o="\\ufe0e\\ufe0f",s="["+e+"]",l="["+a+"]",c="\\ud83c[\\udffb-\\udfff]",u="(?:"+l+"|"+c+")",d="[^"+e+"]",f="(?:\\ud83c[\\udde6-\\uddff]){2}",h="[\\ud800-\\udbff][\\udc00-\\udfff]",p="\\u200d",g=u+"?",m="["+o+"]?",x="(?:"+p+"(?:"+[d,f,h].join("|")+")"+m+g+")*",b=m+g+x,_="(?:"+[d+l+"?",l,f,h,s].join("|")+")",w=RegExp(c+"(?="+c+")|"+_+b,"g");function A(O){return O.match(w)||[]}return wb=A,wb}var jb,dA;function LB(){if(dA)return jb;dA=1;var e=DB(),t=EN(),r=MB();function n(a){return t(a)?r(a):e(a)}return jb=n,jb}var Sb,fA;function RB(){if(fA)return Sb;fA=1;var e=NB(),t=EN(),r=LB(),n=PN();function a(o){return function(s){s=n(s);var l=t(s)?r(s):void 0,c=l?l[0]:s.charAt(0),u=l?e(l,1).join(""):s.slice(1);return c[o]()+u}}return Sb=a,Sb}var Cb,hA;function qB(){if(hA)return Cb;hA=1;var e=RB(),t=e("toUpperCase");return Cb=t,Cb}var FB=qB();const Gv=It(FB);function $n(e){return function(){return e}}const IN=Math.cos,yg=Math.sin,ls=Math.sqrt,xg=Math.PI,Yv=2*xg,n_=Math.PI,a_=2*n_,Pc=1e-6,$B=a_-Pc;function NN(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function BB(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return NN;const r=10**t;return function(n){this._+=n[0];for(let a=1,o=n.length;a<o;++a)this._+=Math.round(arguments[a]*r)/r+n[a]}}class UB{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?NN:BB(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,a){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+a}`}bezierCurveTo(t,r,n,a,o,s){this._append`C${+t},${+r},${+n},${+a},${this._x1=+o},${this._y1=+s}`}arcTo(t,r,n,a,o){if(t=+t,r=+r,n=+n,a=+a,o=+o,o<0)throw new Error(`negative radius: ${o}`);let s=this._x1,l=this._y1,c=n-t,u=a-r,d=s-t,f=l-r,h=d*d+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(h>Pc)if(!(Math.abs(f*c-u*d)>Pc)||!o)this._append`L${this._x1=t},${this._y1=r}`;else{let p=n-s,g=a-l,m=c*c+u*u,x=p*p+g*g,b=Math.sqrt(m),_=Math.sqrt(h),w=o*Math.tan((n_-Math.acos((m+h-x)/(2*b*_)))/2),A=w/_,O=w/b;Math.abs(A-1)>Pc&&this._append`L${t+A*d},${r+A*f}`,this._append`A${o},${o},0,0,${+(f*p>d*g)},${this._x1=t+O*c},${this._y1=r+O*u}`}}arc(t,r,n,a,o,s){if(t=+t,r=+r,n=+n,s=!!s,n<0)throw new Error(`negative radius: ${n}`);let l=n*Math.cos(a),c=n*Math.sin(a),u=t+l,d=r+c,f=1^s,h=s?a-o:o-a;this._x1===null?this._append`M${u},${d}`:(Math.abs(this._x1-u)>Pc||Math.abs(this._y1-d)>Pc)&&this._append`L${u},${d}`,n&&(h<0&&(h=h%a_+a_),h>$B?this._append`A${n},${n},0,1,${f},${t-l},${r-c}A${n},${n},0,1,${f},${this._x1=u},${this._y1=d}`:h>Pc&&this._append`A${n},${n},0,${+(h>=n_)},${f},${this._x1=t+n*Math.cos(o)},${this._y1=r+n*Math.sin(o)}`)}rect(t,r,n,a){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+a}h${-n}Z`}toString(){return this._}}function yj(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new UB(t)}function xj(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function DN(e){this._context=e}DN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Kv(e){return new DN(e)}function MN(e){return e[0]}function LN(e){return e[1]}function RN(e,t){var r=$n(!0),n=null,a=Kv,o=null,s=yj(l);e=typeof e=="function"?e:e===void 0?MN:$n(e),t=typeof t=="function"?t:t===void 0?LN:$n(t);function l(c){var u,d=(c=xj(c)).length,f,h=!1,p;for(n==null&&(o=a(p=s())),u=0;u<=d;++u)!(u<d&&r(f=c[u],u,c))===h&&((h=!h)?o.lineStart():o.lineEnd()),h&&o.point(+e(f,u,c),+t(f,u,c));if(p)return o=null,p+""||null}return l.x=function(c){return arguments.length?(e=typeof c=="function"?c:$n(+c),l):e},l.y=function(c){return arguments.length?(t=typeof c=="function"?c:$n(+c),l):t},l.defined=function(c){return arguments.length?(r=typeof c=="function"?c:$n(!!c),l):r},l.curve=function(c){return arguments.length?(a=c,n!=null&&(o=a(n)),l):a},l.context=function(c){return arguments.length?(c==null?n=o=null:o=a(n=c),l):n},l}function vm(e,t,r){var n=null,a=$n(!0),o=null,s=Kv,l=null,c=yj(u);e=typeof e=="function"?e:e===void 0?MN:$n(+e),t=typeof t=="function"?t:$n(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?LN:$n(+r);function u(f){var h,p,g,m=(f=xj(f)).length,x,b=!1,_,w=new Array(m),A=new Array(m);for(o==null&&(l=s(_=c())),h=0;h<=m;++h){if(!(h<m&&a(x=f[h],h,f))===b)if(b=!b)p=h,l.areaStart(),l.lineStart();else{for(l.lineEnd(),l.lineStart(),g=h-1;g>=p;--g)l.point(w[g],A[g]);l.lineEnd(),l.areaEnd()}b&&(w[h]=+e(x,h,f),A[h]=+t(x,h,f),l.point(n?+n(x,h,f):w[h],r?+r(x,h,f):A[h]))}if(_)return l=null,_+""||null}function d(){return RN().defined(a).curve(s).context(o)}return u.x=function(f){return arguments.length?(e=typeof f=="function"?f:$n(+f),n=null,u):e},u.x0=function(f){return arguments.length?(e=typeof f=="function"?f:$n(+f),u):e},u.x1=function(f){return arguments.length?(n=f==null?null:typeof f=="function"?f:$n(+f),u):n},u.y=function(f){return arguments.length?(t=typeof f=="function"?f:$n(+f),r=null,u):t},u.y0=function(f){return arguments.length?(t=typeof f=="function"?f:$n(+f),u):t},u.y1=function(f){return arguments.length?(r=f==null?null:typeof f=="function"?f:$n(+f),u):r},u.lineX0=u.lineY0=function(){return d().x(e).y(t)},u.lineY1=function(){return d().x(e).y(r)},u.lineX1=function(){return d().x(n).y(t)},u.defined=function(f){return arguments.length?(a=typeof f=="function"?f:$n(!!f),u):a},u.curve=function(f){return arguments.length?(s=f,o!=null&&(l=s(o)),u):s},u.context=function(f){return arguments.length?(f==null?o=l=null:l=s(o=f),u):o},u}class qN{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function zB(e){return new qN(e,!0)}function WB(e){return new qN(e,!1)}const bj={draw(e,t){const r=ls(t/xg);e.moveTo(r,0),e.arc(0,0,r,0,Yv)}},HB={draw(e,t){const r=ls(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},FN=ls(1/3),VB=FN*2,GB={draw(e,t){const r=ls(t/VB),n=r*FN;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},YB={draw(e,t){const r=ls(t),n=-r/2;e.rect(n,n,r,r)}},KB=.8908130915292852,$N=yg(xg/10)/yg(7*xg/10),QB=yg(Yv/10)*$N,XB=-IN(Yv/10)*$N,JB={draw(e,t){const r=ls(t*KB),n=QB*r,a=XB*r;e.moveTo(0,-r),e.lineTo(n,a);for(let o=1;o<5;++o){const s=Yv*o/5,l=IN(s),c=yg(s);e.lineTo(c*r,-l*r),e.lineTo(l*n-c*a,c*n+l*a)}e.closePath()}},Ab=ls(3),ZB={draw(e,t){const r=-ls(t/(Ab*3));e.moveTo(0,r*2),e.lineTo(-Ab*r,-r),e.lineTo(Ab*r,-r),e.closePath()}},$o=-.5,Bo=ls(3)/2,i_=1/ls(12),eU=(i_/2+1)*3,tU={draw(e,t){const r=ls(t/eU),n=r/2,a=r*i_,o=n,s=r*i_+r,l=-o,c=s;e.moveTo(n,a),e.lineTo(o,s),e.lineTo(l,c),e.lineTo($o*n-Bo*a,Bo*n+$o*a),e.lineTo($o*o-Bo*s,Bo*o+$o*s),e.lineTo($o*l-Bo*c,Bo*l+$o*c),e.lineTo($o*n+Bo*a,$o*a-Bo*n),e.lineTo($o*o+Bo*s,$o*s-Bo*o),e.lineTo($o*l+Bo*c,$o*c-Bo*l),e.closePath()}};function rU(e,t){let r=null,n=yj(a);e=typeof e=="function"?e:$n(e||bj),t=typeof t=="function"?t:$n(t===void 0?64:+t);function a(){let o;if(r||(r=o=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),o)return r=null,o+""||null}return a.type=function(o){return arguments.length?(e=typeof o=="function"?o:$n(o),a):e},a.size=function(o){return arguments.length?(t=typeof o=="function"?o:$n(+o),a):t},a.context=function(o){return arguments.length?(r=o??null,a):r},a}function bg(){}function _g(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function BN(e){this._context=e}BN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:_g(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:_g(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function nU(e){return new BN(e)}function UN(e){this._context=e}UN.prototype={areaStart:bg,areaEnd:bg,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:_g(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function aU(e){return new UN(e)}function zN(e){this._context=e}zN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:_g(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function iU(e){return new zN(e)}function WN(e){this._context=e}WN.prototype={areaStart:bg,areaEnd:bg,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function oU(e){return new WN(e)}function pA(e){return e<0?-1:1}function mA(e,t,r){var n=e._x1-e._x0,a=t-e._x1,o=(e._y1-e._y0)/(n||a<0&&-0),s=(r-e._y1)/(a||n<0&&-0),l=(o*a+s*n)/(n+a);return(pA(o)+pA(s))*Math.min(Math.abs(o),Math.abs(s),.5*Math.abs(l))||0}function gA(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function Pb(e,t,r){var n=e._x0,a=e._y0,o=e._x1,s=e._y1,l=(o-n)/3;e._context.bezierCurveTo(n+l,a+l*t,o-l,s-l*r,o,s)}function wg(e){this._context=e}wg.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Pb(this,this._t0,gA(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Pb(this,gA(this,r=mA(this,e,t)),r);break;default:Pb(this,this._t0,r=mA(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function HN(e){this._context=new VN(e)}(HN.prototype=Object.create(wg.prototype)).point=function(e,t){wg.prototype.point.call(this,t,e)};function VN(e){this._context=e}VN.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,a,o){this._context.bezierCurveTo(t,e,n,r,o,a)}};function sU(e){return new wg(e)}function lU(e){return new HN(e)}function GN(e){this._context=e}GN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=vA(e),a=vA(t),o=0,s=1;s<r;++o,++s)this._context.bezierCurveTo(n[0][o],a[0][o],n[1][o],a[1][o],e[s],t[s]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function vA(e){var t,r=e.length-1,n,a=new Array(r),o=new Array(r),s=new Array(r);for(a[0]=0,o[0]=2,s[0]=e[0]+2*e[1],t=1;t<r-1;++t)a[t]=1,o[t]=4,s[t]=4*e[t]+2*e[t+1];for(a[r-1]=2,o[r-1]=7,s[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=a[t]/o[t-1],o[t]-=n,s[t]-=n*s[t-1];for(a[r-1]=s[r-1]/o[r-1],t=r-2;t>=0;--t)a[t]=(s[t]-a[t+1])/o[t];for(o[r-1]=(e[r]+a[r-1])/2,t=0;t<r-1;++t)o[t]=2*e[t+1]-a[t+1];return[a,o]}function cU(e){return new GN(e)}function Qv(e,t){this._context=e,this._t=t}Qv.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function uU(e){return new Qv(e,.5)}function dU(e){return new Qv(e,0)}function fU(e){return new Qv(e,1)}function ed(e,t){if((s=e.length)>1)for(var r=1,n,a,o=e[t[0]],s,l=o.length;r<s;++r)for(a=o,o=e[t[r]],n=0;n<l;++n)o[n][1]+=o[n][0]=isNaN(a[n][1])?a[n][0]:a[n][1]}function o_(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function hU(e,t){return e[t]}function pU(e){const t=[];return t.key=e,t}function mU(){var e=$n([]),t=o_,r=ed,n=hU;function a(o){var s=Array.from(e.apply(this,arguments),pU),l,c=s.length,u=-1,d;for(const f of o)for(l=0,++u;l<c;++l)(s[l][u]=[0,+n(f,s[l].key,u,o)]).data=f;for(l=0,d=xj(t(s));l<c;++l)s[d[l]].index=l;return r(s,d),s}return a.keys=function(o){return arguments.length?(e=typeof o=="function"?o:$n(Array.from(o)),a):e},a.value=function(o){return arguments.length?(n=typeof o=="function"?o:$n(+o),a):n},a.order=function(o){return arguments.length?(t=o==null?o_:typeof o=="function"?o:$n(Array.from(o)),a):t},a.offset=function(o){return arguments.length?(r=o??ed,a):r},a}function gU(e,t){if((n=e.length)>0){for(var r,n,a=0,o=e[0].length,s;a<o;++a){for(s=r=0;r<n;++r)s+=e[r][a][1]||0;if(s)for(r=0;r<n;++r)e[r][a][1]/=s}ed(e,t)}}function vU(e,t){if((a=e.length)>0){for(var r=0,n=e[t[0]],a,o=n.length;r<o;++r){for(var s=0,l=0;s<a;++s)l+=e[s][r][1]||0;n[r][1]+=n[r][0]=-l/2}ed(e,t)}}function yU(e,t){if(!(!((s=e.length)>0)||!((o=(a=e[t[0]]).length)>0))){for(var r=0,n=1,a,o,s;n<o;++n){for(var l=0,c=0,u=0;l<s;++l){for(var d=e[t[l]],f=d[n][1]||0,h=d[n-1][1]||0,p=(f-h)/2,g=0;g<l;++g){var m=e[t[g]],x=m[n][1]||0,b=m[n-1][1]||0;p+=x-b}c+=f,u+=p*f}a[n-1][1]+=a[n-1][0]=r,c&&(r-=u/c)}a[n-1][1]+=a[n-1][0]=r,ed(e,t)}}function Hh(e){"@babel/helpers - typeof";return Hh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hh(e)}var xU=["type","size","sizeType"];function s_(){return s_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s_.apply(this,arguments)}function yA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function xA(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yA(Object(r),!0).forEach(function(n){bU(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yA(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function bU(e,t,r){return t=_U(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _U(e){var t=wU(e,"string");return Hh(t)=="symbol"?t:t+""}function wU(e,t){if(Hh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Hh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function jU(e,t){if(e==null)return{};var r=SU(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function SU(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var YN={symbolCircle:bj,symbolCross:HB,symbolDiamond:GB,symbolSquare:YB,symbolStar:JB,symbolTriangle:ZB,symbolWye:tU},CU=Math.PI/180,AU=function(t){var r="symbol".concat(Gv(t));return YN[r]||bj},PU=function(t,r,n){if(r==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var a=18*CU;return 1.25*t*t*(Math.tan(a)-Math.tan(a*2)*Math.pow(Math.tan(a),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},OU=function(t,r){YN["symbol".concat(Gv(t))]=r},_j=function(t){var r=t.type,n=r===void 0?"circle":r,a=t.size,o=a===void 0?64:a,s=t.sizeType,l=s===void 0?"area":s,c=jU(t,xU),u=xA(xA({},c),{},{type:n,size:o,sizeType:l}),d=function(){var x=AU(n),b=rU().type(x).size(PU(o,l,n));return b()},f=u.className,h=u.cx,p=u.cy,g=_r(u,!0);return h===+h&&p===+p&&o===+o?Ce.createElement("path",s_({},g,{className:Nr("recharts-symbols",f),transform:"translate(".concat(h,", ").concat(p,")"),d:d()})):null};_j.registerSymbol=OU;function td(e){"@babel/helpers - typeof";return td=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},td(e)}function l_(){return l_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l_.apply(this,arguments)}function bA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function kU(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?bA(Object(r),!0).forEach(function(n){Vh(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bA(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function TU(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function EU(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,QN(n.key),n)}}function IU(e,t,r){return t&&EU(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function NU(e,t,r){return t=jg(t),DU(e,KN()?Reflect.construct(t,r||[],jg(e).constructor):t.apply(e,r))}function DU(e,t){if(t&&(td(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return MU(e)}function MU(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function KN(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(KN=function(){return!!e})()}function jg(e){return jg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},jg(e)}function LU(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c_(e,t)}function c_(e,t){return c_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},c_(e,t)}function Vh(e,t,r){return t=QN(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function QN(e){var t=RU(e,"string");return td(t)=="symbol"?t:t+""}function RU(e,t){if(td(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(td(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Uo=32,wj=function(e){function t(){return TU(this,t),NU(this,t,arguments)}return LU(t,e),IU(t,[{key:"renderIcon",value:function(n){var a=this.props.inactiveColor,o=Uo/2,s=Uo/6,l=Uo/3,c=n.inactive?a:n.color;if(n.type==="plainline")return Ce.createElement("line",{strokeWidth:4,fill:"none",stroke:c,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:o,x2:Uo,y2:o,className:"recharts-legend-icon"});if(n.type==="line")return Ce.createElement("path",{strokeWidth:4,fill:"none",stroke:c,d:"M0,".concat(o,"h").concat(l,`
            A`).concat(s,",").concat(s,",0,1,1,").concat(2*l,",").concat(o,`
            H`).concat(Uo,"M").concat(2*l,",").concat(o,`
            A`).concat(s,",").concat(s,",0,1,1,").concat(l,",").concat(o),className:"recharts-legend-icon"});if(n.type==="rect")return Ce.createElement("path",{stroke:"none",fill:c,d:"M0,".concat(Uo/8,"h").concat(Uo,"v").concat(Uo*3/4,"h").concat(-Uo,"z"),className:"recharts-legend-icon"});if(Ce.isValidElement(n.legendIcon)){var u=kU({},n);return delete u.legendIcon,Ce.cloneElement(n.legendIcon,u)}return Ce.createElement(_j,{fill:c,cx:o,cy:o,size:Uo,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,a=this.props,o=a.payload,s=a.iconSize,l=a.layout,c=a.formatter,u=a.inactiveColor,d={x:0,y:0,width:Uo,height:Uo},f={display:l==="horizontal"?"inline-block":"block",marginRight:10},h={display:"inline-block",verticalAlign:"middle",marginRight:4};return o.map(function(p,g){var m=p.formatter||c,x=Nr(Vh(Vh({"recharts-legend-item":!0},"legend-item-".concat(g),!0),"inactive",p.inactive));if(p.type==="none")return null;var b=Rr(p.value)?null:p.value;is(!Rr(p.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var _=p.inactive?u:p.color;return Ce.createElement("li",l_({className:x,style:f,key:"legend-item-".concat(g)},Yc(n.props,p,g)),Ce.createElement(t_,{width:s,height:s,viewBox:d,style:h},n.renderIcon(p)),Ce.createElement("span",{className:"recharts-legend-item-text",style:{color:_}},m?m(b,p,g):b))})}},{key:"render",value:function(){var n=this.props,a=n.payload,o=n.layout,s=n.align;if(!a||!a.length)return null;var l={padding:0,margin:0,textAlign:o==="horizontal"?s:"left"};return Ce.createElement("ul",{className:"recharts-default-legend",style:l},this.renderItems())}}])}(y.PureComponent);Vh(wj,"displayName","Legend");Vh(wj,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var Ob,_A;function qU(){if(_A)return Ob;_A=1;var e=Wv();function t(){this.__data__=new e,this.size=0}return Ob=t,Ob}var kb,wA;function FU(){if(wA)return kb;wA=1;function e(t){var r=this.__data__,n=r.delete(t);return this.size=r.size,n}return kb=e,kb}var Tb,jA;function $U(){if(jA)return Tb;jA=1;function e(t){return this.__data__.get(t)}return Tb=e,Tb}var Eb,SA;function BU(){if(SA)return Eb;SA=1;function e(t){return this.__data__.has(t)}return Eb=e,Eb}var Ib,CA;function UU(){if(CA)return Ib;CA=1;var e=Wv(),t=fj(),r=hj(),n=200;function a(o,s){var l=this.__data__;if(l instanceof e){var c=l.__data__;if(!t||c.length<n-1)return c.push([o,s]),this.size=++l.size,this;l=this.__data__=new r(c)}return l.set(o,s),this.size=l.size,this}return Ib=a,Ib}var Nb,AA;function XN(){if(AA)return Nb;AA=1;var e=Wv(),t=qU(),r=FU(),n=$U(),a=BU(),o=UU();function s(l){var c=this.__data__=new e(l);this.size=c.size}return s.prototype.clear=t,s.prototype.delete=r,s.prototype.get=n,s.prototype.has=a,s.prototype.set=o,Nb=s,Nb}var Db,PA;function zU(){if(PA)return Db;PA=1;var e="__lodash_hash_undefined__";function t(r){return this.__data__.set(r,e),this}return Db=t,Db}var Mb,OA;function WU(){if(OA)return Mb;OA=1;function e(t){return this.__data__.has(t)}return Mb=e,Mb}var Lb,kA;function JN(){if(kA)return Lb;kA=1;var e=hj(),t=zU(),r=WU();function n(a){var o=-1,s=a==null?0:a.length;for(this.__data__=new e;++o<s;)this.add(a[o])}return n.prototype.add=n.prototype.push=t,n.prototype.has=r,Lb=n,Lb}var Rb,TA;function ZN(){if(TA)return Rb;TA=1;function e(t,r){for(var n=-1,a=t==null?0:t.length;++n<a;)if(r(t[n],n,t))return!0;return!1}return Rb=e,Rb}var qb,EA;function eD(){if(EA)return qb;EA=1;function e(t,r){return t.has(r)}return qb=e,qb}var Fb,IA;function tD(){if(IA)return Fb;IA=1;var e=JN(),t=ZN(),r=eD(),n=1,a=2;function o(s,l,c,u,d,f){var h=c&n,p=s.length,g=l.length;if(p!=g&&!(h&&g>p))return!1;var m=f.get(s),x=f.get(l);if(m&&x)return m==l&&x==s;var b=-1,_=!0,w=c&a?new e:void 0;for(f.set(s,l),f.set(l,s);++b<p;){var A=s[b],O=l[b];if(u)var T=h?u(O,A,b,l,s,f):u(A,O,b,s,l,f);if(T!==void 0){if(T)continue;_=!1;break}if(w){if(!t(l,function(E,S){if(!r(w,S)&&(A===E||d(A,E,c,u,f)))return w.push(S)})){_=!1;break}}else if(!(A===O||d(A,O,c,u,f))){_=!1;break}}return f.delete(s),f.delete(l),_}return Fb=o,Fb}var $b,NA;function HU(){if(NA)return $b;NA=1;var e=Ls(),t=e.Uint8Array;return $b=t,$b}var Bb,DA;function VU(){if(DA)return Bb;DA=1;function e(t){var r=-1,n=Array(t.size);return t.forEach(function(a,o){n[++r]=[o,a]}),n}return Bb=e,Bb}var Ub,MA;function jj(){if(MA)return Ub;MA=1;function e(t){var r=-1,n=Array(t.size);return t.forEach(function(a){n[++r]=a}),n}return Ub=e,Ub}var zb,LA;function GU(){if(LA)return zb;LA=1;var e=Mp(),t=HU(),r=dj(),n=tD(),a=VU(),o=jj(),s=1,l=2,c="[object Boolean]",u="[object Date]",d="[object Error]",f="[object Map]",h="[object Number]",p="[object RegExp]",g="[object Set]",m="[object String]",x="[object Symbol]",b="[object ArrayBuffer]",_="[object DataView]",w=e?e.prototype:void 0,A=w?w.valueOf:void 0;function O(T,E,S,I,z,k,M){switch(S){case _:if(T.byteLength!=E.byteLength||T.byteOffset!=E.byteOffset)return!1;T=T.buffer,E=E.buffer;case b:return!(T.byteLength!=E.byteLength||!k(new t(T),new t(E)));case c:case u:case h:return r(+T,+E);case d:return T.name==E.name&&T.message==E.message;case p:case m:return T==E+"";case f:var R=a;case g:var F=I&s;if(R||(R=o),T.size!=E.size&&!F)return!1;var W=M.get(T);if(W)return W==E;I|=l,M.set(T,E);var K=n(R(T),R(E),I,z,k,M);return M.delete(T),K;case x:if(A)return A.call(T)==A.call(E)}return!1}return zb=O,zb}var Wb,RA;function rD(){if(RA)return Wb;RA=1;function e(t,r){for(var n=-1,a=r.length,o=t.length;++n<a;)t[o+n]=r[n];return t}return Wb=e,Wb}var Hb,qA;function YU(){if(qA)return Hb;qA=1;var e=rD(),t=eo();function r(n,a,o){var s=a(n);return t(n)?s:e(s,o(n))}return Hb=r,Hb}var Vb,FA;function KU(){if(FA)return Vb;FA=1;function e(t,r){for(var n=-1,a=t==null?0:t.length,o=0,s=[];++n<a;){var l=t[n];r(l,n,t)&&(s[o++]=l)}return s}return Vb=e,Vb}var Gb,$A;function QU(){if($A)return Gb;$A=1;function e(){return[]}return Gb=e,Gb}var Yb,BA;function XU(){if(BA)return Yb;BA=1;var e=KU(),t=QU(),r=Object.prototype,n=r.propertyIsEnumerable,a=Object.getOwnPropertySymbols,o=a?function(s){return s==null?[]:(s=Object(s),e(a(s),function(l){return n.call(s,l)}))}:t;return Yb=o,Yb}var Kb,UA;function JU(){if(UA)return Kb;UA=1;function e(t,r){for(var n=-1,a=Array(t);++n<t;)a[n]=r(n);return a}return Kb=e,Kb}var Qb,zA;function ZU(){if(zA)return Qb;zA=1;var e=_l(),t=wl(),r="[object Arguments]";function n(a){return t(a)&&e(a)==r}return Qb=n,Qb}var Xb,WA;function Sj(){if(WA)return Xb;WA=1;var e=ZU(),t=wl(),r=Object.prototype,n=r.hasOwnProperty,a=r.propertyIsEnumerable,o=e(function(){return arguments}())?e:function(s){return t(s)&&n.call(s,"callee")&&!a.call(s,"callee")};return Xb=o,Xb}var Ch={exports:{}},Jb,HA;function ez(){if(HA)return Jb;HA=1;function e(){return!1}return Jb=e,Jb}Ch.exports;var VA;function nD(){return VA||(VA=1,function(e,t){var r=Ls(),n=ez(),a=t&&!t.nodeType&&t,o=a&&!0&&e&&!e.nodeType&&e,s=o&&o.exports===a,l=s?r.Buffer:void 0,c=l?l.isBuffer:void 0,u=c||n;e.exports=u}(Ch,Ch.exports)),Ch.exports}var Zb,GA;function Cj(){if(GA)return Zb;GA=1;var e=9007199254740991,t=/^(?:0|[1-9]\d*)$/;function r(n,a){var o=typeof n;return a=a??e,!!a&&(o=="number"||o!="symbol"&&t.test(n))&&n>-1&&n%1==0&&n<a}return Zb=r,Zb}var e0,YA;function Aj(){if(YA)return e0;YA=1;var e=9007199254740991;function t(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=e}return e0=t,e0}var t0,KA;function tz(){if(KA)return t0;KA=1;var e=_l(),t=Aj(),r=wl(),n="[object Arguments]",a="[object Array]",o="[object Boolean]",s="[object Date]",l="[object Error]",c="[object Function]",u="[object Map]",d="[object Number]",f="[object Object]",h="[object RegExp]",p="[object Set]",g="[object String]",m="[object WeakMap]",x="[object ArrayBuffer]",b="[object DataView]",_="[object Float32Array]",w="[object Float64Array]",A="[object Int8Array]",O="[object Int16Array]",T="[object Int32Array]",E="[object Uint8Array]",S="[object Uint8ClampedArray]",I="[object Uint16Array]",z="[object Uint32Array]",k={};k[_]=k[w]=k[A]=k[O]=k[T]=k[E]=k[S]=k[I]=k[z]=!0,k[n]=k[a]=k[x]=k[o]=k[b]=k[s]=k[l]=k[c]=k[u]=k[d]=k[f]=k[h]=k[p]=k[g]=k[m]=!1;function M(R){return r(R)&&t(R.length)&&!!k[e(R)]}return t0=M,t0}var r0,QA;function aD(){if(QA)return r0;QA=1;function e(t){return function(r){return t(r)}}return r0=e,r0}var Ah={exports:{}};Ah.exports;var XA;function rz(){return XA||(XA=1,function(e,t){var r=SN(),n=t&&!t.nodeType&&t,a=n&&!0&&e&&!e.nodeType&&e,o=a&&a.exports===n,s=o&&r.process,l=function(){try{var c=a&&a.require&&a.require("util").types;return c||s&&s.binding&&s.binding("util")}catch{}}();e.exports=l}(Ah,Ah.exports)),Ah.exports}var n0,JA;function iD(){if(JA)return n0;JA=1;var e=tz(),t=aD(),r=rz(),n=r&&r.isTypedArray,a=n?t(n):e;return n0=a,n0}var a0,ZA;function nz(){if(ZA)return a0;ZA=1;var e=JU(),t=Sj(),r=eo(),n=nD(),a=Cj(),o=iD(),s=Object.prototype,l=s.hasOwnProperty;function c(u,d){var f=r(u),h=!f&&t(u),p=!f&&!h&&n(u),g=!f&&!h&&!p&&o(u),m=f||h||p||g,x=m?e(u.length,String):[],b=x.length;for(var _ in u)(d||l.call(u,_))&&!(m&&(_=="length"||p&&(_=="offset"||_=="parent")||g&&(_=="buffer"||_=="byteLength"||_=="byteOffset")||a(_,b)))&&x.push(_);return x}return a0=c,a0}var i0,eP;function az(){if(eP)return i0;eP=1;var e=Object.prototype;function t(r){var n=r&&r.constructor,a=typeof n=="function"&&n.prototype||e;return r===a}return i0=t,i0}var o0,tP;function oD(){if(tP)return o0;tP=1;function e(t,r){return function(n){return t(r(n))}}return o0=e,o0}var s0,rP;function iz(){if(rP)return s0;rP=1;var e=oD(),t=e(Object.keys,Object);return s0=t,s0}var l0,nP;function oz(){if(nP)return l0;nP=1;var e=az(),t=iz(),r=Object.prototype,n=r.hasOwnProperty;function a(o){if(!e(o))return t(o);var s=[];for(var l in Object(o))n.call(o,l)&&l!="constructor"&&s.push(l);return s}return l0=a,l0}var c0,aP;function Rp(){if(aP)return c0;aP=1;var e=uj(),t=Aj();function r(n){return n!=null&&t(n.length)&&!e(n)}return c0=r,c0}var u0,iP;function Xv(){if(iP)return u0;iP=1;var e=nz(),t=oz(),r=Rp();function n(a){return r(a)?e(a):t(a)}return u0=n,u0}var d0,oP;function sz(){if(oP)return d0;oP=1;var e=YU(),t=XU(),r=Xv();function n(a){return e(a,r,t)}return d0=n,d0}var f0,sP;function lz(){if(sP)return f0;sP=1;var e=sz(),t=1,r=Object.prototype,n=r.hasOwnProperty;function a(o,s,l,c,u,d){var f=l&t,h=e(o),p=h.length,g=e(s),m=g.length;if(p!=m&&!f)return!1;for(var x=p;x--;){var b=h[x];if(!(f?b in s:n.call(s,b)))return!1}var _=d.get(o),w=d.get(s);if(_&&w)return _==s&&w==o;var A=!0;d.set(o,s),d.set(s,o);for(var O=f;++x<p;){b=h[x];var T=o[b],E=s[b];if(c)var S=f?c(E,T,b,s,o,d):c(T,E,b,o,s,d);if(!(S===void 0?T===E||u(T,E,l,c,d):S)){A=!1;break}O||(O=b=="constructor")}if(A&&!O){var I=o.constructor,z=s.constructor;I!=z&&"constructor"in o&&"constructor"in s&&!(typeof I=="function"&&I instanceof I&&typeof z=="function"&&z instanceof z)&&(A=!1)}return d.delete(o),d.delete(s),A}return f0=a,f0}var h0,lP;function cz(){if(lP)return h0;lP=1;var e=au(),t=Ls(),r=e(t,"DataView");return h0=r,h0}var p0,cP;function uz(){if(cP)return p0;cP=1;var e=au(),t=Ls(),r=e(t,"Promise");return p0=r,p0}var m0,uP;function sD(){if(uP)return m0;uP=1;var e=au(),t=Ls(),r=e(t,"Set");return m0=r,m0}var g0,dP;function dz(){if(dP)return g0;dP=1;var e=au(),t=Ls(),r=e(t,"WeakMap");return g0=r,g0}var v0,fP;function fz(){if(fP)return v0;fP=1;var e=cz(),t=fj(),r=uz(),n=sD(),a=dz(),o=_l(),s=CN(),l="[object Map]",c="[object Object]",u="[object Promise]",d="[object Set]",f="[object WeakMap]",h="[object DataView]",p=s(e),g=s(t),m=s(r),x=s(n),b=s(a),_=o;return(e&&_(new e(new ArrayBuffer(1)))!=h||t&&_(new t)!=l||r&&_(r.resolve())!=u||n&&_(new n)!=d||a&&_(new a)!=f)&&(_=function(w){var A=o(w),O=A==c?w.constructor:void 0,T=O?s(O):"";if(T)switch(T){case p:return h;case g:return l;case m:return u;case x:return d;case b:return f}return A}),v0=_,v0}var y0,hP;function hz(){if(hP)return y0;hP=1;var e=XN(),t=tD(),r=GU(),n=lz(),a=fz(),o=eo(),s=nD(),l=iD(),c=1,u="[object Arguments]",d="[object Array]",f="[object Object]",h=Object.prototype,p=h.hasOwnProperty;function g(m,x,b,_,w,A){var O=o(m),T=o(x),E=O?d:a(m),S=T?d:a(x);E=E==u?f:E,S=S==u?f:S;var I=E==f,z=S==f,k=E==S;if(k&&s(m)){if(!s(x))return!1;O=!0,I=!1}if(k&&!I)return A||(A=new e),O||l(m)?t(m,x,b,_,w,A):r(m,x,E,b,_,w,A);if(!(b&c)){var M=I&&p.call(m,"__wrapped__"),R=z&&p.call(x,"__wrapped__");if(M||R){var F=M?m.value():m,W=R?x.value():x;return A||(A=new e),w(F,W,b,_,A)}}return k?(A||(A=new e),n(m,x,b,_,w,A)):!1}return y0=g,y0}var x0,pP;function Pj(){if(pP)return x0;pP=1;var e=hz(),t=wl();function r(n,a,o,s,l){return n===a?!0:n==null||a==null||!t(n)&&!t(a)?n!==n&&a!==a:e(n,a,o,s,r,l)}return x0=r,x0}var b0,mP;function pz(){if(mP)return b0;mP=1;var e=XN(),t=Pj(),r=1,n=2;function a(o,s,l,c){var u=l.length,d=u,f=!c;if(o==null)return!d;for(o=Object(o);u--;){var h=l[u];if(f&&h[2]?h[1]!==o[h[0]]:!(h[0]in o))return!1}for(;++u<d;){h=l[u];var p=h[0],g=o[p],m=h[1];if(f&&h[2]){if(g===void 0&&!(p in o))return!1}else{var x=new e;if(c)var b=c(g,m,p,o,s,x);if(!(b===void 0?t(m,g,r|n,c,x):b))return!1}}return!0}return b0=a,b0}var _0,gP;function lD(){if(gP)return _0;gP=1;var e=sc();function t(r){return r===r&&!e(r)}return _0=t,_0}var w0,vP;function mz(){if(vP)return w0;vP=1;var e=lD(),t=Xv();function r(n){for(var a=t(n),o=a.length;o--;){var s=a[o],l=n[s];a[o]=[s,l,e(l)]}return a}return w0=r,w0}var j0,yP;function cD(){if(yP)return j0;yP=1;function e(t,r){return function(n){return n==null?!1:n[t]===r&&(r!==void 0||t in Object(n))}}return j0=e,j0}var S0,xP;function gz(){if(xP)return S0;xP=1;var e=pz(),t=mz(),r=cD();function n(a){var o=t(a);return o.length==1&&o[0][2]?r(o[0][0],o[0][1]):function(s){return s===a||e(s,a,o)}}return S0=n,S0}var C0,bP;function vz(){if(bP)return C0;bP=1;function e(t,r){return t!=null&&r in Object(t)}return C0=e,C0}var A0,_P;function yz(){if(_P)return A0;_P=1;var e=ON(),t=Sj(),r=eo(),n=Cj(),a=Aj(),o=Vv();function s(l,c,u){c=e(c,l);for(var d=-1,f=c.length,h=!1;++d<f;){var p=o(c[d]);if(!(h=l!=null&&u(l,p)))break;l=l[p]}return h||++d!=f?h:(f=l==null?0:l.length,!!f&&a(f)&&n(p,f)&&(r(l)||t(l)))}return A0=s,A0}var P0,wP;function xz(){if(wP)return P0;wP=1;var e=vz(),t=yz();function r(n,a){return n!=null&&t(n,a,e)}return P0=r,P0}var O0,jP;function bz(){if(jP)return O0;jP=1;var e=Pj(),t=kN(),r=xz(),n=cj(),a=lD(),o=cD(),s=Vv(),l=1,c=2;function u(d,f){return n(d)&&a(f)?o(s(d),f):function(h){var p=t(h,d);return p===void 0&&p===f?r(h,d):e(f,p,l|c)}}return O0=u,O0}var k0,SP;function Fd(){if(SP)return k0;SP=1;function e(t){return t}return k0=e,k0}var T0,CP;function _z(){if(CP)return T0;CP=1;function e(t){return function(r){return r?.[t]}}return T0=e,T0}var E0,AP;function wz(){if(AP)return E0;AP=1;var e=mj();function t(r){return function(n){return e(n,r)}}return E0=t,E0}var I0,PP;function jz(){if(PP)return I0;PP=1;var e=_z(),t=wz(),r=cj(),n=Vv();function a(o){return r(o)?e(n(o)):t(o)}return I0=a,I0}var N0,OP;function Rs(){if(OP)return N0;OP=1;var e=gz(),t=bz(),r=Fd(),n=eo(),a=jz();function o(s){return typeof s=="function"?s:s==null?r:typeof s=="object"?n(s)?t(s[0],s[1]):e(s):a(s)}return N0=o,N0}var D0,kP;function uD(){if(kP)return D0;kP=1;function e(t,r,n,a){for(var o=t.length,s=n+(a?1:-1);a?s--:++s<o;)if(r(t[s],s,t))return s;return-1}return D0=e,D0}var M0,TP;function Sz(){if(TP)return M0;TP=1;function e(t){return t!==t}return M0=e,M0}var L0,EP;function Cz(){if(EP)return L0;EP=1;function e(t,r,n){for(var a=n-1,o=t.length;++a<o;)if(t[a]===r)return a;return-1}return L0=e,L0}var R0,IP;function Az(){if(IP)return R0;IP=1;var e=uD(),t=Sz(),r=Cz();function n(a,o,s){return o===o?r(a,o,s):e(a,t,s)}return R0=n,R0}var q0,NP;function Pz(){if(NP)return q0;NP=1;var e=Az();function t(r,n){var a=r==null?0:r.length;return!!a&&e(r,n,0)>-1}return q0=t,q0}var F0,DP;function Oz(){if(DP)return F0;DP=1;function e(t,r,n){for(var a=-1,o=t==null?0:t.length;++a<o;)if(n(r,t[a]))return!0;return!1}return F0=e,F0}var $0,MP;function kz(){if(MP)return $0;MP=1;function e(){}return $0=e,$0}var B0,LP;function Tz(){if(LP)return B0;LP=1;var e=sD(),t=kz(),r=jj(),n=1/0,a=e&&1/r(new e([,-0]))[1]==n?function(o){return new e(o)}:t;return B0=a,B0}var U0,RP;function Ez(){if(RP)return U0;RP=1;var e=JN(),t=Pz(),r=Oz(),n=eD(),a=Tz(),o=jj(),s=200;function l(c,u,d){var f=-1,h=t,p=c.length,g=!0,m=[],x=m;if(d)g=!1,h=r;else if(p>=s){var b=u?null:a(c);if(b)return o(b);g=!1,h=n,x=new e}else x=u?[]:m;e:for(;++f<p;){var _=c[f],w=u?u(_):_;if(_=d||_!==0?_:0,g&&w===w){for(var A=x.length;A--;)if(x[A]===w)continue e;u&&x.push(w),m.push(_)}else h(x,w,d)||(x!==m&&x.push(w),m.push(_))}return m}return U0=l,U0}var z0,qP;function Iz(){if(qP)return z0;qP=1;var e=Rs(),t=Ez();function r(n,a){return n&&n.length?t(n,e(a,2)):[]}return z0=r,z0}var Nz=Iz();const FP=It(Nz);function dD(e,t,r){return t===!0?FP(e,r):Rr(t)?FP(e,t):e}function rd(e){"@babel/helpers - typeof";return rd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rd(e)}var Dz=["ref"];function $P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Js(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$P(Object(r),!0).forEach(function(n){Jv(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$P(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Mz(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function BP(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,hD(n.key),n)}}function Lz(e,t,r){return t&&BP(e.prototype,t),r&&BP(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Rz(e,t,r){return t=Sg(t),qz(e,fD()?Reflect.construct(t,r||[],Sg(e).constructor):t.apply(e,r))}function qz(e,t){if(t&&(rd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Fz(e)}function Fz(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fD(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(fD=function(){return!!e})()}function Sg(e){return Sg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Sg(e)}function $z(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u_(e,t)}function u_(e,t){return u_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},u_(e,t)}function Jv(e,t,r){return t=hD(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hD(e){var t=Bz(e,"string");return rd(t)=="symbol"?t:t+""}function Bz(e,t){if(rd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(rd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Uz(e,t){if(e==null)return{};var r=zz(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function zz(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Wz(e){return e.value}function Hz(e,t){if(Ce.isValidElement(e))return Ce.cloneElement(e,t);if(typeof e=="function")return Ce.createElement(e,t);t.ref;var r=Uz(t,Dz);return Ce.createElement(wj,r)}var UP=1,Ss=function(e){function t(){var r;Mz(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return r=Rz(this,t,[].concat(a)),Jv(r,"lastBoundingBox",{width:-1,height:-1}),r}return $z(t,e),Lz(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,a=this.getBBox();a?(Math.abs(a.width-this.lastBoundingBox.width)>UP||Math.abs(a.height-this.lastBoundingBox.height)>UP)&&(this.lastBoundingBox.width=a.width,this.lastBoundingBox.height=a.height,n&&n(a)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?Js({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var a=this.props,o=a.layout,s=a.align,l=a.verticalAlign,c=a.margin,u=a.chartWidth,d=a.chartHeight,f,h;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(s==="center"&&o==="vertical"){var p=this.getBBoxSnapshot();f={left:((u||0)-p.width)/2}}else f=s==="right"?{right:c&&c.right||0}:{left:c&&c.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(l==="middle"){var g=this.getBBoxSnapshot();h={top:((d||0)-g.height)/2}}else h=l==="bottom"?{bottom:c&&c.bottom||0}:{top:c&&c.top||0};return Js(Js({},f),h)}},{key:"render",value:function(){var n=this,a=this.props,o=a.content,s=a.width,l=a.height,c=a.wrapperStyle,u=a.payloadUniqBy,d=a.payload,f=Js(Js({position:"absolute",width:s||"auto",height:l||"auto"},this.getDefaultPosition(c)),c);return Ce.createElement("div",{className:"recharts-legend-wrapper",style:f,ref:function(p){n.wrapperNode=p}},Hz(o,Js(Js({},this.props),{},{payload:dD(d,u,Wz)})))}}],[{key:"getWithHeight",value:function(n,a){var o=Js(Js({},this.defaultProps),n.props),s=o.layout;return s==="vertical"&&Mt(n.props.height)?{height:n.props.height}:s==="horizontal"?{width:n.props.width||a}:null}}])}(y.PureComponent);Jv(Ss,"displayName","Legend");Jv(Ss,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var W0,zP;function Vz(){if(zP)return W0;zP=1;var e=Mp(),t=Sj(),r=eo(),n=e?e.isConcatSpreadable:void 0;function a(o){return r(o)||t(o)||!!(n&&o&&o[n])}return W0=a,W0}var H0,WP;function pD(){if(WP)return H0;WP=1;var e=rD(),t=Vz();function r(n,a,o,s,l){var c=-1,u=n.length;for(o||(o=t),l||(l=[]);++c<u;){var d=n[c];a>0&&o(d)?a>1?r(d,a-1,o,s,l):e(l,d):s||(l[l.length]=d)}return l}return H0=r,H0}var V0,HP;function Gz(){if(HP)return V0;HP=1;function e(t){return function(r,n,a){for(var o=-1,s=Object(r),l=a(r),c=l.length;c--;){var u=l[t?c:++o];if(n(s[u],u,s)===!1)break}return r}}return V0=e,V0}var G0,VP;function Yz(){if(VP)return G0;VP=1;var e=Gz(),t=e();return G0=t,G0}var Y0,GP;function mD(){if(GP)return Y0;GP=1;var e=Yz(),t=Xv();function r(n,a){return n&&e(n,a,t)}return Y0=r,Y0}var K0,YP;function Kz(){if(YP)return K0;YP=1;var e=Rp();function t(r,n){return function(a,o){if(a==null)return a;if(!e(a))return r(a,o);for(var s=a.length,l=n?s:-1,c=Object(a);(n?l--:++l<s)&&o(c[l],l,c)!==!1;);return a}}return K0=t,K0}var Q0,KP;function Oj(){if(KP)return Q0;KP=1;var e=mD(),t=Kz(),r=t(e);return Q0=r,Q0}var X0,QP;function gD(){if(QP)return X0;QP=1;var e=Oj(),t=Rp();function r(n,a){var o=-1,s=t(n)?Array(n.length):[];return e(n,function(l,c,u){s[++o]=a(l,c,u)}),s}return X0=r,X0}var J0,XP;function Qz(){if(XP)return J0;XP=1;function e(t,r){var n=t.length;for(t.sort(r);n--;)t[n]=t[n].value;return t}return J0=e,J0}var Z0,JP;function Xz(){if(JP)return Z0;JP=1;var e=Ld();function t(r,n){if(r!==n){var a=r!==void 0,o=r===null,s=r===r,l=e(r),c=n!==void 0,u=n===null,d=n===n,f=e(n);if(!u&&!f&&!l&&r>n||l&&c&&d&&!u&&!f||o&&c&&d||!a&&d||!s)return 1;if(!o&&!l&&!f&&r<n||f&&a&&s&&!o&&!l||u&&a&&s||!c&&s||!d)return-1}return 0}return Z0=t,Z0}var e1,ZP;function Jz(){if(ZP)return e1;ZP=1;var e=Xz();function t(r,n,a){for(var o=-1,s=r.criteria,l=n.criteria,c=s.length,u=a.length;++o<c;){var d=e(s[o],l[o]);if(d){if(o>=u)return d;var f=a[o];return d*(f=="desc"?-1:1)}}return r.index-n.index}return e1=t,e1}var t1,eO;function Zz(){if(eO)return t1;eO=1;var e=pj(),t=mj(),r=Rs(),n=gD(),a=Qz(),o=aD(),s=Jz(),l=Fd(),c=eo();function u(d,f,h){f.length?f=e(f,function(m){return c(m)?function(x){return t(x,m.length===1?m[0]:m)}:m}):f=[l];var p=-1;f=e(f,o(r));var g=n(d,function(m,x,b){var _=e(f,function(w){return w(m)});return{criteria:_,index:++p,value:m}});return a(g,function(m,x){return s(m,x,h)})}return t1=u,t1}var r1,tO;function eW(){if(tO)return r1;tO=1;function e(t,r,n){switch(n.length){case 0:return t.call(r);case 1:return t.call(r,n[0]);case 2:return t.call(r,n[0],n[1]);case 3:return t.call(r,n[0],n[1],n[2])}return t.apply(r,n)}return r1=e,r1}var n1,rO;function tW(){if(rO)return n1;rO=1;var e=eW(),t=Math.max;function r(n,a,o){return a=t(a===void 0?n.length-1:a,0),function(){for(var s=arguments,l=-1,c=t(s.length-a,0),u=Array(c);++l<c;)u[l]=s[a+l];l=-1;for(var d=Array(a+1);++l<a;)d[l]=s[l];return d[a]=o(u),e(n,this,d)}}return n1=r,n1}var a1,nO;function rW(){if(nO)return a1;nO=1;function e(t){return function(){return t}}return a1=e,a1}var i1,aO;function vD(){if(aO)return i1;aO=1;var e=au(),t=function(){try{var r=e(Object,"defineProperty");return r({},"",{}),r}catch{}}();return i1=t,i1}var o1,iO;function nW(){if(iO)return o1;iO=1;var e=rW(),t=vD(),r=Fd(),n=t?function(a,o){return t(a,"toString",{configurable:!0,enumerable:!1,value:e(o),writable:!0})}:r;return o1=n,o1}var s1,oO;function aW(){if(oO)return s1;oO=1;var e=800,t=16,r=Date.now;function n(a){var o=0,s=0;return function(){var l=r(),c=t-(l-s);if(s=l,c>0){if(++o>=e)return arguments[0]}else o=0;return a.apply(void 0,arguments)}}return s1=n,s1}var l1,sO;function iW(){if(sO)return l1;sO=1;var e=nW(),t=aW(),r=t(e);return l1=r,l1}var c1,lO;function oW(){if(lO)return c1;lO=1;var e=Fd(),t=tW(),r=iW();function n(a,o){return r(t(a,o,e),a+"")}return c1=n,c1}var u1,cO;function Zv(){if(cO)return u1;cO=1;var e=dj(),t=Rp(),r=Cj(),n=sc();function a(o,s,l){if(!n(l))return!1;var c=typeof s;return(c=="number"?t(l)&&r(s,l.length):c=="string"&&s in l)?e(l[s],o):!1}return u1=a,u1}var d1,uO;function sW(){if(uO)return d1;uO=1;var e=pD(),t=Zz(),r=oW(),n=Zv(),a=r(function(o,s){if(o==null)return[];var l=s.length;return l>1&&n(o,s[0],s[1])?s=[]:l>2&&n(s[0],s[1],s[2])&&(s=[s[0]]),t(o,e(s,1),[])});return d1=a,d1}var lW=sW();const kj=It(lW);function Gh(e){"@babel/helpers - typeof";return Gh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gh(e)}function d_(){return d_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},d_.apply(this,arguments)}function cW(e,t){return hW(e)||fW(e,t)||dW(e,t)||uW()}function uW(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dW(e,t){if(e){if(typeof e=="string")return dO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dO(e,t)}}function dO(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function fW(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function hW(e){if(Array.isArray(e))return e}function fO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function f1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fO(Object(r),!0).forEach(function(n){pW(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fO(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function pW(e,t,r){return t=mW(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mW(e){var t=gW(e,"string");return Gh(t)=="symbol"?t:t+""}function gW(e,t){if(Gh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Gh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function vW(e){return Array.isArray(e)&&Ya(e[0])&&Ya(e[1])?e.join(" ~ "):e}var yW=function(t){var r=t.separator,n=r===void 0?" : ":r,a=t.contentStyle,o=a===void 0?{}:a,s=t.itemStyle,l=s===void 0?{}:s,c=t.labelStyle,u=c===void 0?{}:c,d=t.payload,f=t.formatter,h=t.itemSorter,p=t.wrapperClassName,g=t.labelClassName,m=t.label,x=t.labelFormatter,b=t.accessibilityLayer,_=b===void 0?!1:b,w=function(){if(d&&d.length){var M={padding:0,margin:0},R=(h?kj(d,h):d).map(function(F,W){if(F.type==="none")return null;var K=f1({display:"block",paddingTop:4,paddingBottom:4,color:F.color||"#000"},l),Z=F.formatter||f||vW,D=F.value,P=F.name,$=D,Q=P;if(Z&&$!=null&&Q!=null){var C=Z(D,P,F,W,d);if(Array.isArray(C)){var L=cW(C,2);$=L[0],Q=L[1]}else $=C}return Ce.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(W),style:K},Ya(Q)?Ce.createElement("span",{className:"recharts-tooltip-item-name"},Q):null,Ya(Q)?Ce.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,Ce.createElement("span",{className:"recharts-tooltip-item-value"},$),Ce.createElement("span",{className:"recharts-tooltip-item-unit"},F.unit||""))});return Ce.createElement("ul",{className:"recharts-tooltip-item-list",style:M},R)}return null},A=f1({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},o),O=f1({margin:0},u),T=!Ur(m),E=T?m:"",S=Nr("recharts-default-tooltip",p),I=Nr("recharts-tooltip-label",g);T&&x&&d!==void 0&&d!==null&&(E=x(m,d));var z=_?{role:"status","aria-live":"assertive"}:{};return Ce.createElement("div",d_({className:S,style:A},z),Ce.createElement("p",{className:I,style:O},Ce.isValidElement(E)?E:"".concat(E)),w())};function Yh(e){"@babel/helpers - typeof";return Yh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yh(e)}function ym(e,t,r){return t=xW(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xW(e){var t=bW(e,"string");return Yh(t)=="symbol"?t:t+""}function bW(e,t){if(Yh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Yh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var uf="recharts-tooltip-wrapper",_W={visibility:"hidden"};function wW(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return Nr(uf,ym(ym(ym(ym({},"".concat(uf,"-right"),Mt(r)&&t&&Mt(t.x)&&r>=t.x),"".concat(uf,"-left"),Mt(r)&&t&&Mt(t.x)&&r<t.x),"".concat(uf,"-bottom"),Mt(n)&&t&&Mt(t.y)&&n>=t.y),"".concat(uf,"-top"),Mt(n)&&t&&Mt(t.y)&&n<t.y))}function hO(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,a=e.offsetTopLeft,o=e.position,s=e.reverseDirection,l=e.tooltipDimension,c=e.viewBox,u=e.viewBoxDimension;if(o&&Mt(o[n]))return o[n];var d=r[n]-l-a,f=r[n]+a;if(t[n])return s[n]?d:f;if(s[n]){var h=d,p=c[n];return h<p?Math.max(f,c[n]):Math.max(d,c[n])}var g=f+l,m=c[n]+u;return g>m?Math.max(d,c[n]):Math.max(f,c[n])}function jW(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function SW(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,a=e.position,o=e.reverseDirection,s=e.tooltipBox,l=e.useTranslate3d,c=e.viewBox,u,d,f;return s.height>0&&s.width>0&&r?(d=hO({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:a,reverseDirection:o,tooltipDimension:s.width,viewBox:c,viewBoxDimension:c.width}),f=hO({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:a,reverseDirection:o,tooltipDimension:s.height,viewBox:c,viewBoxDimension:c.height}),u=jW({translateX:d,translateY:f,useTranslate3d:l})):u=_W,{cssProperties:u,cssClasses:wW({translateX:d,translateY:f,coordinate:r})}}function nd(e){"@babel/helpers - typeof";return nd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nd(e)}function pO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function mO(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?pO(Object(r),!0).forEach(function(n){h_(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pO(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function CW(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function AW(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,xD(n.key),n)}}function PW(e,t,r){return t&&AW(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function OW(e,t,r){return t=Cg(t),kW(e,yD()?Reflect.construct(t,r||[],Cg(e).constructor):t.apply(e,r))}function kW(e,t){if(t&&(nd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return TW(e)}function TW(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yD(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(yD=function(){return!!e})()}function Cg(e){return Cg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Cg(e)}function EW(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f_(e,t)}function f_(e,t){return f_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},f_(e,t)}function h_(e,t,r){return t=xD(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xD(e){var t=IW(e,"string");return nd(t)=="symbol"?t:t+""}function IW(e,t){if(nd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(nd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var gO=1,NW=function(e){function t(){var r;CW(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return r=OW(this,t,[].concat(a)),h_(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),h_(r,"handleKeyDown",function(s){if(s.key==="Escape"){var l,c,u,d;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(l=(c=r.props.coordinate)===null||c===void 0?void 0:c.x)!==null&&l!==void 0?l:0,y:(u=(d=r.props.coordinate)===null||d===void 0?void 0:d.y)!==null&&u!==void 0?u:0}})}}),r}return EW(t,e),PW(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>gO||Math.abs(n.height-this.state.lastBoundingBox.height)>gO)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,a;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((a=this.props.coordinate)===null||a===void 0?void 0:a.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,a=this.props,o=a.active,s=a.allowEscapeViewBox,l=a.animationDuration,c=a.animationEasing,u=a.children,d=a.coordinate,f=a.hasPayload,h=a.isAnimationActive,p=a.offset,g=a.position,m=a.reverseDirection,x=a.useTranslate3d,b=a.viewBox,_=a.wrapperStyle,w=SW({allowEscapeViewBox:s,coordinate:d,offsetTopLeft:p,position:g,reverseDirection:m,tooltipBox:this.state.lastBoundingBox,useTranslate3d:x,viewBox:b}),A=w.cssClasses,O=w.cssProperties,T=mO(mO({transition:h&&o?"transform ".concat(l,"ms ").concat(c):void 0},O),{},{pointerEvents:"none",visibility:!this.state.dismissed&&o&&f?"visible":"hidden",position:"absolute",top:0,left:0},_);return Ce.createElement("div",{tabIndex:-1,className:A,style:T,ref:function(S){n.wrapperNode=S}},u)}}])}(y.PureComponent),DW=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},iu={isSsr:DW()};function ad(e){"@babel/helpers - typeof";return ad=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ad(e)}function vO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function yO(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?vO(Object(r),!0).forEach(function(n){Tj(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vO(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function MW(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function LW(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_D(n.key),n)}}function RW(e,t,r){return t&&LW(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function qW(e,t,r){return t=Ag(t),FW(e,bD()?Reflect.construct(t,r||[],Ag(e).constructor):t.apply(e,r))}function FW(e,t){if(t&&(ad(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $W(e)}function $W(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bD(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(bD=function(){return!!e})()}function Ag(e){return Ag=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ag(e)}function BW(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p_(e,t)}function p_(e,t){return p_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},p_(e,t)}function Tj(e,t,r){return t=_D(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _D(e){var t=UW(e,"string");return ad(t)=="symbol"?t:t+""}function UW(e,t){if(ad(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ad(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function zW(e){return e.dataKey}function WW(e,t){return Ce.isValidElement(e)?Ce.cloneElement(e,t):typeof e=="function"?Ce.createElement(e,t):Ce.createElement(yW,t)}var xo=function(e){function t(){return MW(this,t),qW(this,t,arguments)}return BW(t,e),RW(t,[{key:"render",value:function(){var n=this,a=this.props,o=a.active,s=a.allowEscapeViewBox,l=a.animationDuration,c=a.animationEasing,u=a.content,d=a.coordinate,f=a.filterNull,h=a.isAnimationActive,p=a.offset,g=a.payload,m=a.payloadUniqBy,x=a.position,b=a.reverseDirection,_=a.useTranslate3d,w=a.viewBox,A=a.wrapperStyle,O=g??[];f&&O.length&&(O=dD(g.filter(function(E){return E.value!=null&&(E.hide!==!0||n.props.includeHidden)}),m,zW));var T=O.length>0;return Ce.createElement(NW,{allowEscapeViewBox:s,animationDuration:l,animationEasing:c,isAnimationActive:h,active:o,coordinate:d,hasPayload:T,offset:p,position:x,reverseDirection:b,useTranslate3d:_,viewBox:w,wrapperStyle:A},WW(u,yO(yO({},this.props),{},{payload:O})))}}])}(y.PureComponent);Tj(xo,"displayName","Tooltip");Tj(xo,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!iu.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var h1,xO;function HW(){if(xO)return h1;xO=1;var e=Ls(),t=function(){return e.Date.now()};return h1=t,h1}var p1,bO;function VW(){if(bO)return p1;bO=1;var e=/\s/;function t(r){for(var n=r.length;n--&&e.test(r.charAt(n)););return n}return p1=t,p1}var m1,_O;function GW(){if(_O)return m1;_O=1;var e=VW(),t=/^\s+/;function r(n){return n&&n.slice(0,e(n)+1).replace(t,"")}return m1=r,m1}var g1,wO;function wD(){if(wO)return g1;wO=1;var e=GW(),t=sc(),r=Ld(),n=NaN,a=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,s=/^0o[0-7]+$/i,l=parseInt;function c(u){if(typeof u=="number")return u;if(r(u))return n;if(t(u)){var d=typeof u.valueOf=="function"?u.valueOf():u;u=t(d)?d+"":d}if(typeof u!="string")return u===0?u:+u;u=e(u);var f=o.test(u);return f||s.test(u)?l(u.slice(2),f?2:8):a.test(u)?n:+u}return g1=c,g1}var v1,jO;function YW(){if(jO)return v1;jO=1;var e=sc(),t=HW(),r=wD(),n="Expected a function",a=Math.max,o=Math.min;function s(l,c,u){var d,f,h,p,g,m,x=0,b=!1,_=!1,w=!0;if(typeof l!="function")throw new TypeError(n);c=r(c)||0,e(u)&&(b=!!u.leading,_="maxWait"in u,h=_?a(r(u.maxWait)||0,c):h,w="trailing"in u?!!u.trailing:w);function A(R){var F=d,W=f;return d=f=void 0,x=R,p=l.apply(W,F),p}function O(R){return x=R,g=setTimeout(S,c),b?A(R):p}function T(R){var F=R-m,W=R-x,K=c-F;return _?o(K,h-W):K}function E(R){var F=R-m,W=R-x;return m===void 0||F>=c||F<0||_&&W>=h}function S(){var R=t();if(E(R))return I(R);g=setTimeout(S,T(R))}function I(R){return g=void 0,w&&d?A(R):(d=f=void 0,p)}function z(){g!==void 0&&clearTimeout(g),x=0,d=m=f=g=void 0}function k(){return g===void 0?p:I(t())}function M(){var R=t(),F=E(R);if(d=arguments,f=this,m=R,F){if(g===void 0)return O(m);if(_)return clearTimeout(g),g=setTimeout(S,c),A(m)}return g===void 0&&(g=setTimeout(S,c)),p}return M.cancel=z,M.flush=k,M}return v1=s,v1}var y1,SO;function KW(){if(SO)return y1;SO=1;var e=YW(),t=sc(),r="Expected a function";function n(a,o,s){var l=!0,c=!0;if(typeof a!="function")throw new TypeError(r);return t(s)&&(l="leading"in s?!!s.leading:l,c="trailing"in s?!!s.trailing:c),e(a,o,{leading:l,maxWait:o,trailing:c})}return y1=n,y1}var QW=KW();const jD=It(QW);function Kh(e){"@babel/helpers - typeof";return Kh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kh(e)}function CO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function xm(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CO(Object(r),!0).forEach(function(n){XW(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CO(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function XW(e,t,r){return t=JW(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function JW(e){var t=ZW(e,"string");return Kh(t)=="symbol"?t:t+""}function ZW(e,t){if(Kh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Kh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function e9(e,t){return a9(e)||n9(e,t)||r9(e,t)||t9()}function t9(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function r9(e,t){if(e){if(typeof e=="string")return AO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return AO(e,t)}}function AO(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function n9(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function a9(e){if(Array.isArray(e))return e}var SD=y.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,a=n===void 0?{width:-1,height:-1}:n,o=e.width,s=o===void 0?"100%":o,l=e.height,c=l===void 0?"100%":l,u=e.minWidth,d=u===void 0?0:u,f=e.minHeight,h=e.maxHeight,p=e.children,g=e.debounce,m=g===void 0?0:g,x=e.id,b=e.className,_=e.onResize,w=e.style,A=w===void 0?{}:w,O=y.useRef(null),T=y.useRef();T.current=_,y.useImperativeHandle(t,function(){return Object.defineProperty(O.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),O.current},configurable:!0})});var E=y.useState({containerWidth:a.width,containerHeight:a.height}),S=e9(E,2),I=S[0],z=S[1],k=y.useCallback(function(R,F){z(function(W){var K=Math.round(R),Z=Math.round(F);return W.containerWidth===K&&W.containerHeight===Z?W:{containerWidth:K,containerHeight:Z}})},[]);y.useEffect(function(){var R=function(P){var $,Q=P[0].contentRect,C=Q.width,L=Q.height;k(C,L),($=T.current)===null||$===void 0||$.call(T,C,L)};m>0&&(R=jD(R,m,{trailing:!0,leading:!1}));var F=new ResizeObserver(R),W=O.current.getBoundingClientRect(),K=W.width,Z=W.height;return k(K,Z),F.observe(O.current),function(){F.disconnect()}},[k,m]);var M=y.useMemo(function(){var R=I.containerWidth,F=I.containerHeight;if(R<0||F<0)return null;is(Mc(s)||Mc(c),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,s,c),is(!r||r>0,"The aspect(%s) must be greater than zero.",r);var W=Mc(s)?R:s,K=Mc(c)?F:c;r&&r>0&&(W?K=W/r:K&&(W=K*r),h&&K>h&&(K=h)),is(W>0||K>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,W,K,s,c,d,f,r);var Z=!Array.isArray(p)&&ul(p.type).endsWith("Chart");return Ce.Children.map(p,function(D){return Ce.isValidElement(D)?y.cloneElement(D,xm({width:W,height:K},Z?{style:xm({height:"100%",width:"100%",maxHeight:K,maxWidth:W},D.props.style)}:{})):D})},[r,p,c,h,f,d,I,s]);return Ce.createElement("div",{id:x?"".concat(x):void 0,className:Nr("recharts-responsive-container",b),style:xm(xm({},A),{},{width:s,height:c,minWidth:d,minHeight:f,maxHeight:h}),ref:O},M)}),ey=function(t){return null};ey.displayName="Cell";function Qh(e){"@babel/helpers - typeof";return Qh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qh(e)}function PO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function m_(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?PO(Object(r),!0).forEach(function(n){i9(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):PO(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function i9(e,t,r){return t=o9(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o9(e){var t=s9(e,"string");return Qh(t)=="symbol"?t:t+""}function s9(e,t){if(Qh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Qh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var xu={widthCache:{},cacheCount:0},l9=2e3,c9={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},OO="recharts_measurement_span";function u9(e){var t=m_({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var kh=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||iu.isSsr)return{width:0,height:0};var n=u9(r),a=JSON.stringify({text:t,copyStyle:n});if(xu.widthCache[a])return xu.widthCache[a];try{var o=document.getElementById(OO);o||(o=document.createElement("span"),o.setAttribute("id",OO),o.setAttribute("aria-hidden","true"),document.body.appendChild(o));var s=m_(m_({},c9),n);Object.assign(o.style,s),o.textContent="".concat(t);var l=o.getBoundingClientRect(),c={width:l.width,height:l.height};return xu.widthCache[a]=c,++xu.cacheCount>l9&&(xu.cacheCount=0,xu.widthCache={}),c}catch{return{width:0,height:0}}},d9=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function Xh(e){"@babel/helpers - typeof";return Xh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xh(e)}function Pg(e,t){return m9(e)||p9(e,t)||h9(e,t)||f9()}function f9(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function h9(e,t){if(e){if(typeof e=="string")return kO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kO(e,t)}}function kO(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function p9(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function m9(e){if(Array.isArray(e))return e}function g9(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function TO(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,y9(n.key),n)}}function v9(e,t,r){return t&&TO(e.prototype,t),r&&TO(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function y9(e){var t=x9(e,"string");return Xh(t)=="symbol"?t:t+""}function x9(e,t){if(Xh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Xh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var EO=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,IO=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,b9=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,_9=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,CD={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},w9=Object.keys(CD),Iu="NaN";function j9(e,t){return e*CD[t]}var bm=function(){function e(t,r){g9(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!b9.test(r)&&(this.num=NaN,this.unit=""),w9.includes(r)&&(this.num=j9(t,r),this.unit="px")}return v9(e,[{key:"add",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var n,a=(n=_9.exec(r))!==null&&n!==void 0?n:[],o=Pg(a,3),s=o[1],l=o[2];return new e(parseFloat(s),l??"")}}])}();function AD(e){if(e.includes(Iu))return Iu;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=EO.exec(t))!==null&&r!==void 0?r:[],a=Pg(n,4),o=a[1],s=a[2],l=a[3],c=bm.parse(o??""),u=bm.parse(l??""),d=s==="*"?c.multiply(u):c.divide(u);if(d.isNaN())return Iu;t=t.replace(EO,d.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var f,h=(f=IO.exec(t))!==null&&f!==void 0?f:[],p=Pg(h,4),g=p[1],m=p[2],x=p[3],b=bm.parse(g??""),_=bm.parse(x??""),w=m==="+"?b.add(_):b.subtract(_);if(w.isNaN())return Iu;t=t.replace(IO,w.toString())}return t}var NO=/\(([^()]*)\)/;function S9(e){for(var t=e;t.includes("(");){var r=NO.exec(t),n=Pg(r,2),a=n[1];t=t.replace(NO,AD(a))}return t}function C9(e){var t=e.replace(/\s+/g,"");return t=S9(t),t=AD(t),t}function A9(e){try{return C9(e)}catch{return Iu}}function x1(e){var t=A9(e.slice(5,-1));return t===Iu?"":t}var P9=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],O9=["dx","dy","angle","className","breakAll"];function g_(){return g_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},g_.apply(this,arguments)}function DO(e,t){if(e==null)return{};var r=k9(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function k9(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function MO(e,t){return N9(e)||I9(e,t)||E9(e,t)||T9()}function T9(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function E9(e,t){if(e){if(typeof e=="string")return LO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return LO(e,t)}}function LO(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function I9(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function N9(e){if(Array.isArray(e))return e}var PD=/[ \f\n\r\t\v\u2028\u2029]+/,OD=function(t){var r=t.children,n=t.breakAll,a=t.style;try{var o=[];Ur(r)||(n?o=r.toString().split(""):o=r.toString().split(PD));var s=o.map(function(c){return{word:c,width:kh(c,a).width}}),l=n?0:kh("",a).width;return{wordsWithComputedWidth:s,spaceWidth:l}}catch{return null}},D9=function(t,r,n,a,o){var s=t.maxLines,l=t.children,c=t.style,u=t.breakAll,d=Mt(s),f=l,h=function(){var W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return W.reduce(function(K,Z){var D=Z.word,P=Z.width,$=K[K.length-1];if($&&(a==null||o||$.width+P+n<Number(a)))$.words.push(D),$.width+=P+n;else{var Q={words:[D],width:P};K.push(Q)}return K},[])},p=h(r),g=function(W){return W.reduce(function(K,Z){return K.width>Z.width?K:Z})};if(!d)return p;for(var m="",x=function(W){var K=f.slice(0,W),Z=OD({breakAll:u,style:c,children:K+m}).wordsWithComputedWidth,D=h(Z),P=D.length>s||g(D).width>Number(a);return[P,D]},b=0,_=f.length-1,w=0,A;b<=_&&w<=f.length-1;){var O=Math.floor((b+_)/2),T=O-1,E=x(T),S=MO(E,2),I=S[0],z=S[1],k=x(O),M=MO(k,1),R=M[0];if(!I&&!R&&(b=O+1),I&&R&&(_=O-1),!I&&R){A=z;break}w++}return A||p},RO=function(t){var r=Ur(t)?[]:t.toString().split(PD);return[{words:r}]},M9=function(t){var r=t.width,n=t.scaleToFit,a=t.children,o=t.style,s=t.breakAll,l=t.maxLines;if((r||n)&&!iu.isSsr){var c,u,d=OD({breakAll:s,children:a,style:o});if(d){var f=d.wordsWithComputedWidth,h=d.spaceWidth;c=f,u=h}else return RO(a);return D9({breakAll:s,children:a,maxLines:l,style:o},c,u,r,n)}return RO(a)},qO="#808080",Kc=function(t){var r=t.x,n=r===void 0?0:r,a=t.y,o=a===void 0?0:a,s=t.lineHeight,l=s===void 0?"1em":s,c=t.capHeight,u=c===void 0?"0.71em":c,d=t.scaleToFit,f=d===void 0?!1:d,h=t.textAnchor,p=h===void 0?"start":h,g=t.verticalAnchor,m=g===void 0?"end":g,x=t.fill,b=x===void 0?qO:x,_=DO(t,P9),w=y.useMemo(function(){return M9({breakAll:_.breakAll,children:_.children,maxLines:_.maxLines,scaleToFit:f,style:_.style,width:_.width})},[_.breakAll,_.children,_.maxLines,f,_.style,_.width]),A=_.dx,O=_.dy,T=_.angle,E=_.className,S=_.breakAll,I=DO(_,O9);if(!Ya(n)||!Ya(o))return null;var z=n+(Mt(A)?A:0),k=o+(Mt(O)?O:0),M;switch(m){case"start":M=x1("calc(".concat(u,")"));break;case"middle":M=x1("calc(".concat((w.length-1)/2," * -").concat(l," + (").concat(u," / 2))"));break;default:M=x1("calc(".concat(w.length-1," * -").concat(l,")"));break}var R=[];if(f){var F=w[0].width,W=_.width;R.push("scale(".concat((Mt(W)?W/F:1)/F,")"))}return T&&R.push("rotate(".concat(T,", ").concat(z,", ").concat(k,")")),R.length&&(I.transform=R.join(" ")),Ce.createElement("text",g_({},_r(I,!0),{x:z,y:k,className:Nr("recharts-text",E),textAnchor:p,fill:b.includes("url")?qO:b}),w.map(function(K,Z){var D=K.words.join(S?"":" ");return Ce.createElement("tspan",{x:z,dy:Z===0?M:l,key:"".concat(D,"-").concat(Z)},D)}))};function Zl(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function L9(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Ej(e){let t,r,n;e.length!==2?(t=Zl,r=(l,c)=>Zl(e(l),c),n=(l,c)=>e(l)-c):(t=e===Zl||e===L9?e:R9,r=e,n=e);function a(l,c,u=0,d=l.length){if(u<d){if(t(c,c)!==0)return d;do{const f=u+d>>>1;r(l[f],c)<0?u=f+1:d=f}while(u<d)}return u}function o(l,c,u=0,d=l.length){if(u<d){if(t(c,c)!==0)return d;do{const f=u+d>>>1;r(l[f],c)<=0?u=f+1:d=f}while(u<d)}return u}function s(l,c,u=0,d=l.length){const f=a(l,c,u,d-1);return f>u&&n(l[f-1],c)>-n(l[f],c)?f-1:f}return{left:a,center:s,right:o}}function R9(){return 0}function kD(e){return e===null?NaN:+e}function*q9(e,t){for(let r of e)r!=null&&(r=+r)>=r&&(yield r)}const F9=Ej(Zl),qp=F9.right;Ej(kD).center;class FO extends Map{constructor(t,r=U9){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,a]of t)this.set(n,a)}get(t){return super.get($O(this,t))}has(t){return super.has($O(this,t))}set(t,r){return super.set($9(this,t),r)}delete(t){return super.delete(B9(this,t))}}function $O({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function $9({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function B9({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function U9(e){return e!==null&&typeof e=="object"?e.valueOf():e}function z9(e=Zl){if(e===Zl)return TD;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function TD(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const W9=Math.sqrt(50),H9=Math.sqrt(10),V9=Math.sqrt(2);function Og(e,t,r){const n=(t-e)/Math.max(0,r),a=Math.floor(Math.log10(n)),o=n/Math.pow(10,a),s=o>=W9?10:o>=H9?5:o>=V9?2:1;let l,c,u;return a<0?(u=Math.pow(10,-a)/s,l=Math.round(e*u),c=Math.round(t*u),l/u<e&&++l,c/u>t&&--c,u=-u):(u=Math.pow(10,a)*s,l=Math.round(e/u),c=Math.round(t/u),l*u<e&&++l,c*u>t&&--c),c<l&&.5<=r&&r<2?Og(e,t,r*2):[l,c,u]}function v_(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[a,o,s]=n?Og(t,e,r):Og(e,t,r);if(!(o>=a))return[];const l=o-a+1,c=new Array(l);if(n)if(s<0)for(let u=0;u<l;++u)c[u]=(o-u)/-s;else for(let u=0;u<l;++u)c[u]=(o-u)*s;else if(s<0)for(let u=0;u<l;++u)c[u]=(a+u)/-s;else for(let u=0;u<l;++u)c[u]=(a+u)*s;return c}function y_(e,t,r){return t=+t,e=+e,r=+r,Og(e,t,r)[2]}function x_(e,t,r){t=+t,e=+e,r=+r;const n=t<e,a=n?y_(t,e,r):y_(e,t,r);return(n?-1:1)*(a<0?1/-a:a)}function BO(e,t){let r;for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function UO(e,t){let r;for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function ED(e,t,r=0,n=1/0,a){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(a=a===void 0?TD:z9(a);n>r;){if(n-r>600){const c=n-r+1,u=t-r+1,d=Math.log(c),f=.5*Math.exp(2*d/3),h=.5*Math.sqrt(d*f*(c-f)/c)*(u-c/2<0?-1:1),p=Math.max(r,Math.floor(t-u*f/c+h)),g=Math.min(n,Math.floor(t+(c-u)*f/c+h));ED(e,t,p,g,a)}const o=e[t];let s=r,l=n;for(df(e,r,t),a(e[n],o)>0&&df(e,r,n);s<l;){for(df(e,s,l),++s,--l;a(e[s],o)<0;)++s;for(;a(e[l],o)>0;)--l}a(e[r],o)===0?df(e,r,l):(++l,df(e,l,n)),l<=t&&(r=l+1),t<=l&&(n=l-1)}return e}function df(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function G9(e,t,r){if(e=Float64Array.from(q9(e)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return UO(e);if(t>=1)return BO(e);var n,a=(n-1)*t,o=Math.floor(a),s=BO(ED(e,o).subarray(0,o+1)),l=UO(e.subarray(o+1));return s+(l-s)*(a-o)}}function Y9(e,t,r=kD){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*t,o=Math.floor(a),s=+r(e[o],o,e),l=+r(e[o+1],o+1,e);return s+(l-s)*(a-o)}}function K9(e,t,r){e=+e,t=+t,r=(a=arguments.length)<2?(t=e,e=0,1):a<3?1:+r;for(var n=-1,a=Math.max(0,Math.ceil((t-e)/r))|0,o=new Array(a);++n<a;)o[n]=e+n*r;return o}function Go(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function jl(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const b_=Symbol("implicit");function Ij(){var e=new FO,t=[],r=[],n=b_;function a(o){let s=e.get(o);if(s===void 0){if(n!==b_)return n;e.set(o,s=t.push(o)-1)}return r[s%r.length]}return a.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new FO;for(const s of o)e.has(s)||e.set(s,t.push(s)-1);return a},a.range=function(o){return arguments.length?(r=Array.from(o),a):r.slice()},a.unknown=function(o){return arguments.length?(n=o,a):n},a.copy=function(){return Ij(t,r).unknown(n)},Go.apply(a,arguments),a}function Jh(){var e=Ij().unknown(void 0),t=e.domain,r=e.range,n=0,a=1,o,s,l=!1,c=0,u=0,d=.5;delete e.unknown;function f(){var h=t().length,p=a<n,g=p?a:n,m=p?n:a;o=(m-g)/Math.max(1,h-c+u*2),l&&(o=Math.floor(o)),g+=(m-g-o*(h-c))*d,s=o*(1-c),l&&(g=Math.round(g),s=Math.round(s));var x=K9(h).map(function(b){return g+o*b});return r(p?x.reverse():x)}return e.domain=function(h){return arguments.length?(t(h),f()):t()},e.range=function(h){return arguments.length?([n,a]=h,n=+n,a=+a,f()):[n,a]},e.rangeRound=function(h){return[n,a]=h,n=+n,a=+a,l=!0,f()},e.bandwidth=function(){return s},e.step=function(){return o},e.round=function(h){return arguments.length?(l=!!h,f()):l},e.padding=function(h){return arguments.length?(c=Math.min(1,u=+h),f()):c},e.paddingInner=function(h){return arguments.length?(c=Math.min(1,h),f()):c},e.paddingOuter=function(h){return arguments.length?(u=+h,f()):u},e.align=function(h){return arguments.length?(d=Math.max(0,Math.min(1,h)),f()):d},e.copy=function(){return Jh(t(),[n,a]).round(l).paddingInner(c).paddingOuter(u).align(d)},Go.apply(f(),arguments)}function ID(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return ID(t())},e}function Th(){return ID(Jh.apply(null,arguments).paddingInner(1))}function Nj(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function ND(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function Fp(){}var Zh=.7,kg=1/Zh,Vu="\\s*([+-]?\\d+)\\s*",ep="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Cs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Q9=/^#([0-9a-f]{3,8})$/,X9=new RegExp(`^rgb\\(${Vu},${Vu},${Vu}\\)$`),J9=new RegExp(`^rgb\\(${Cs},${Cs},${Cs}\\)$`),Z9=new RegExp(`^rgba\\(${Vu},${Vu},${Vu},${ep}\\)$`),eH=new RegExp(`^rgba\\(${Cs},${Cs},${Cs},${ep}\\)$`),tH=new RegExp(`^hsl\\(${ep},${Cs},${Cs}\\)$`),rH=new RegExp(`^hsla\\(${ep},${Cs},${Cs},${ep}\\)$`),zO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Nj(Fp,tp,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:WO,formatHex:WO,formatHex8:nH,formatHsl:aH,formatRgb:HO,toString:HO});function WO(){return this.rgb().formatHex()}function nH(){return this.rgb().formatHex8()}function aH(){return DD(this).formatHsl()}function HO(){return this.rgb().formatRgb()}function tp(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=Q9.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?VO(t):r===3?new Qi(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?_m(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?_m(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=X9.exec(e))?new Qi(t[1],t[2],t[3],1):(t=J9.exec(e))?new Qi(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Z9.exec(e))?_m(t[1],t[2],t[3],t[4]):(t=eH.exec(e))?_m(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=tH.exec(e))?KO(t[1],t[2]/100,t[3]/100,1):(t=rH.exec(e))?KO(t[1],t[2]/100,t[3]/100,t[4]):zO.hasOwnProperty(e)?VO(zO[e]):e==="transparent"?new Qi(NaN,NaN,NaN,0):null}function VO(e){return new Qi(e>>16&255,e>>8&255,e&255,1)}function _m(e,t,r,n){return n<=0&&(e=t=r=NaN),new Qi(e,t,r,n)}function iH(e){return e instanceof Fp||(e=tp(e)),e?(e=e.rgb(),new Qi(e.r,e.g,e.b,e.opacity)):new Qi}function __(e,t,r,n){return arguments.length===1?iH(e):new Qi(e,t,r,n??1)}function Qi(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}Nj(Qi,__,ND(Fp,{brighter(e){return e=e==null?kg:Math.pow(kg,e),new Qi(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Zh:Math.pow(Zh,e),new Qi(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Qi($c(this.r),$c(this.g),$c(this.b),Tg(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:GO,formatHex:GO,formatHex8:oH,formatRgb:YO,toString:YO}));function GO(){return`#${Lc(this.r)}${Lc(this.g)}${Lc(this.b)}`}function oH(){return`#${Lc(this.r)}${Lc(this.g)}${Lc(this.b)}${Lc((isNaN(this.opacity)?1:this.opacity)*255)}`}function YO(){const e=Tg(this.opacity);return`${e===1?"rgb(":"rgba("}${$c(this.r)}, ${$c(this.g)}, ${$c(this.b)}${e===1?")":`, ${e})`}`}function Tg(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function $c(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Lc(e){return e=$c(e),(e<16?"0":"")+e.toString(16)}function KO(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new as(e,t,r,n)}function DD(e){if(e instanceof as)return new as(e.h,e.s,e.l,e.opacity);if(e instanceof Fp||(e=tp(e)),!e)return new as;if(e instanceof as)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,a=Math.min(t,r,n),o=Math.max(t,r,n),s=NaN,l=o-a,c=(o+a)/2;return l?(t===o?s=(r-n)/l+(r<n)*6:r===o?s=(n-t)/l+2:s=(t-r)/l+4,l/=c<.5?o+a:2-o-a,s*=60):l=c>0&&c<1?0:s,new as(s,l,c,e.opacity)}function sH(e,t,r,n){return arguments.length===1?DD(e):new as(e,t,r,n??1)}function as(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}Nj(as,sH,ND(Fp,{brighter(e){return e=e==null?kg:Math.pow(kg,e),new as(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Zh:Math.pow(Zh,e),new as(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,a=2*r-n;return new Qi(b1(e>=240?e-240:e+120,a,n),b1(e,a,n),b1(e<120?e+240:e-120,a,n),this.opacity)},clamp(){return new as(QO(this.h),wm(this.s),wm(this.l),Tg(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Tg(this.opacity);return`${e===1?"hsl(":"hsla("}${QO(this.h)}, ${wm(this.s)*100}%, ${wm(this.l)*100}%${e===1?")":`, ${e})`}`}}));function QO(e){return e=(e||0)%360,e<0?e+360:e}function wm(e){return Math.max(0,Math.min(1,e||0))}function b1(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const Dj=e=>()=>e;function lH(e,t){return function(r){return e+r*t}}function cH(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function uH(e){return(e=+e)==1?MD:function(t,r){return r-t?cH(t,r,e):Dj(isNaN(t)?r:t)}}function MD(e,t){var r=t-e;return r?lH(e,r):Dj(isNaN(e)?t:e)}const XO=function e(t){var r=uH(t);function n(a,o){var s=r((a=__(a)).r,(o=__(o)).r),l=r(a.g,o.g),c=r(a.b,o.b),u=MD(a.opacity,o.opacity);return function(d){return a.r=s(d),a.g=l(d),a.b=c(d),a.opacity=u(d),a+""}}return n.gamma=e,n}(1);function dH(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),a;return function(o){for(a=0;a<r;++a)n[a]=e[a]*(1-o)+t[a]*o;return n}}function fH(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function hH(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,a=new Array(n),o=new Array(r),s;for(s=0;s<n;++s)a[s]=$d(e[s],t[s]);for(;s<r;++s)o[s]=t[s];return function(l){for(s=0;s<n;++s)o[s]=a[s](l);return o}}function pH(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function Eg(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function mH(e,t){var r={},n={},a;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(a in t)a in e?r[a]=$d(e[a],t[a]):n[a]=t[a];return function(o){for(a in r)n[a]=r[a](o);return n}}var w_=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,_1=new RegExp(w_.source,"g");function gH(e){return function(){return e}}function vH(e){return function(t){return e(t)+""}}function yH(e,t){var r=w_.lastIndex=_1.lastIndex=0,n,a,o,s=-1,l=[],c=[];for(e=e+"",t=t+"";(n=w_.exec(e))&&(a=_1.exec(t));)(o=a.index)>r&&(o=t.slice(r,o),l[s]?l[s]+=o:l[++s]=o),(n=n[0])===(a=a[0])?l[s]?l[s]+=a:l[++s]=a:(l[++s]=null,c.push({i:s,x:Eg(n,a)})),r=_1.lastIndex;return r<t.length&&(o=t.slice(r),l[s]?l[s]+=o:l[++s]=o),l.length<2?c[0]?vH(c[0].x):gH(t):(t=c.length,function(u){for(var d=0,f;d<t;++d)l[(f=c[d]).i]=f.x(u);return l.join("")})}function $d(e,t){var r=typeof t,n;return t==null||r==="boolean"?Dj(t):(r==="number"?Eg:r==="string"?(n=tp(t))?(t=n,XO):yH:t instanceof tp?XO:t instanceof Date?pH:fH(t)?dH:Array.isArray(t)?hH:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?mH:Eg)(e,t)}function Mj(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function xH(e,t){t===void 0&&(t=e,e=$d);for(var r=0,n=t.length-1,a=t[0],o=new Array(n<0?0:n);r<n;)o[r]=e(a,a=t[++r]);return function(s){var l=Math.max(0,Math.min(n-1,Math.floor(s*=n)));return o[l](s-l)}}function bH(e){return function(){return e}}function Ig(e){return+e}var JO=[0,1];function qi(e){return e}function j_(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:bH(isNaN(t)?NaN:.5)}function _H(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function wH(e,t,r){var n=e[0],a=e[1],o=t[0],s=t[1];return a<n?(n=j_(a,n),o=r(s,o)):(n=j_(n,a),o=r(o,s)),function(l){return o(n(l))}}function jH(e,t,r){var n=Math.min(e.length,t.length)-1,a=new Array(n),o=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<n;)a[s]=j_(e[s],e[s+1]),o[s]=r(t[s],t[s+1]);return function(l){var c=qp(e,l,1,n)-1;return o[c](a[c](l))}}function $p(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function ty(){var e=JO,t=JO,r=$d,n,a,o,s=qi,l,c,u;function d(){var h=Math.min(e.length,t.length);return s!==qi&&(s=_H(e[0],e[h-1])),l=h>2?jH:wH,c=u=null,f}function f(h){return h==null||isNaN(h=+h)?o:(c||(c=l(e.map(n),t,r)))(n(s(h)))}return f.invert=function(h){return s(a((u||(u=l(t,e.map(n),Eg)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,Ig),d()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),d()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),r=Mj,d()},f.clamp=function(h){return arguments.length?(s=h?!0:qi,d()):s!==qi},f.interpolate=function(h){return arguments.length?(r=h,d()):r},f.unknown=function(h){return arguments.length?(o=h,f):o},function(h,p){return n=h,a=p,d()}}function Lj(){return ty()(qi,qi)}function SH(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Ng(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function id(e){return e=Ng(Math.abs(e)),e?e[1]:NaN}function CH(e,t){return function(r,n){for(var a=r.length,o=[],s=0,l=e[0],c=0;a>0&&l>0&&(c+l+1>n&&(l=Math.max(1,n-c)),o.push(r.substring(a-=l,a+l)),!((c+=l+1)>n));)l=e[s=(s+1)%e.length];return o.reverse().join(t)}}function AH(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var PH=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function rp(e){if(!(t=PH.exec(e)))throw new Error("invalid format: "+e);var t;return new Rj({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}rp.prototype=Rj.prototype;function Rj(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Rj.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function OH(e){e:for(var t=e.length,r=1,n=-1,a;r<t;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var LD;function kH(e,t){var r=Ng(e,t);if(!r)return e+"";var n=r[0],a=r[1],o=a-(LD=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,s=n.length;return o===s?n:o>s?n+new Array(o-s+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+Ng(e,Math.max(0,t+o-1))[0]}function ZO(e,t){var r=Ng(e,t);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}const ek={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:SH,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>ZO(e*100,t),r:ZO,s:kH,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function tk(e){return e}var rk=Array.prototype.map,nk=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function TH(e){var t=e.grouping===void 0||e.thousands===void 0?tk:CH(rk.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?tk:AH(rk.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function u(f){f=rp(f);var h=f.fill,p=f.align,g=f.sign,m=f.symbol,x=f.zero,b=f.width,_=f.comma,w=f.precision,A=f.trim,O=f.type;O==="n"?(_=!0,O="g"):ek[O]||(w===void 0&&(w=12),A=!0,O="g"),(x||h==="0"&&p==="=")&&(x=!0,h="0",p="=");var T=m==="$"?r:m==="#"&&/[boxX]/.test(O)?"0"+O.toLowerCase():"",E=m==="$"?n:/[%p]/.test(O)?s:"",S=ek[O],I=/[defgprs%]/.test(O);w=w===void 0?6:/[gprs]/.test(O)?Math.max(1,Math.min(21,w)):Math.max(0,Math.min(20,w));function z(k){var M=T,R=E,F,W,K;if(O==="c")R=S(k)+R,k="";else{k=+k;var Z=k<0||1/k<0;if(k=isNaN(k)?c:S(Math.abs(k),w),A&&(k=OH(k)),Z&&+k==0&&g!=="+"&&(Z=!1),M=(Z?g==="("?g:l:g==="-"||g==="("?"":g)+M,R=(O==="s"?nk[8+LD/3]:"")+R+(Z&&g==="("?")":""),I){for(F=-1,W=k.length;++F<W;)if(K=k.charCodeAt(F),48>K||K>57){R=(K===46?a+k.slice(F+1):k.slice(F))+R,k=k.slice(0,F);break}}}_&&!x&&(k=t(k,1/0));var D=M.length+k.length+R.length,P=D<b?new Array(b-D+1).join(h):"";switch(_&&x&&(k=t(P+k,P.length?b-R.length:1/0),P=""),p){case"<":k=M+k+R+P;break;case"=":k=M+P+k+R;break;case"^":k=P.slice(0,D=P.length>>1)+M+k+R+P.slice(D);break;default:k=P+M+k+R;break}return o(k)}return z.toString=function(){return f+""},z}function d(f,h){var p=u((f=rp(f),f.type="f",f)),g=Math.max(-8,Math.min(8,Math.floor(id(h)/3)))*3,m=Math.pow(10,-g),x=nk[8+g/3];return function(b){return p(m*b)+x}}return{format:u,formatPrefix:d}}var jm,qj,RD;EH({thousands:",",grouping:[3],currency:["$",""]});function EH(e){return jm=TH(e),qj=jm.format,RD=jm.formatPrefix,jm}function IH(e){return Math.max(0,-id(Math.abs(e)))}function NH(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(id(t)/3)))*3-id(Math.abs(e)))}function DH(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,id(t)-id(e))+1}function qD(e,t,r,n){var a=x_(e,t,r),o;switch(n=rp(n??",f"),n.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(o=NH(a,s))&&(n.precision=o),RD(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=DH(a,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=IH(a))&&(n.precision=o-(n.type==="%")*2);break}}return qj(n)}function lc(e){var t=e.domain;return e.ticks=function(r){var n=t();return v_(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var a=t();return qD(a[0],a[a.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),a=0,o=n.length-1,s=n[a],l=n[o],c,u,d=10;for(l<s&&(u=s,s=l,l=u,u=a,a=o,o=u);d-- >0;){if(u=y_(s,l,r),u===c)return n[a]=s,n[o]=l,t(n);if(u>0)s=Math.floor(s/u)*u,l=Math.ceil(l/u)*u;else if(u<0)s=Math.ceil(s*u)/u,l=Math.floor(l*u)/u;else break;c=u}return e},e}function Dg(){var e=Lj();return e.copy=function(){return $p(e,Dg())},Go.apply(e,arguments),lc(e)}function FD(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,Ig),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return FD(e).unknown(t)},e=arguments.length?Array.from(e,Ig):[0,1],lc(r)}function $D(e,t){e=e.slice();var r=0,n=e.length-1,a=e[r],o=e[n],s;return o<a&&(s=r,r=n,n=s,s=a,a=o,o=s),e[r]=t.floor(a),e[n]=t.ceil(o),e}function ak(e){return Math.log(e)}function ik(e){return Math.exp(e)}function MH(e){return-Math.log(-e)}function LH(e){return-Math.exp(-e)}function RH(e){return isFinite(e)?+("1e"+e):e<0?0:e}function qH(e){return e===10?RH:e===Math.E?Math.exp:t=>Math.pow(e,t)}function FH(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function ok(e){return(t,r)=>-e(-t,r)}function Fj(e){const t=e(ak,ik),r=t.domain;let n=10,a,o;function s(){return a=FH(n),o=qH(n),r()[0]<0?(a=ok(a),o=ok(o),e(MH,LH)):e(ak,ik),t}return t.base=function(l){return arguments.length?(n=+l,s()):n},t.domain=function(l){return arguments.length?(r(l),s()):r()},t.ticks=l=>{const c=r();let u=c[0],d=c[c.length-1];const f=d<u;f&&([u,d]=[d,u]);let h=a(u),p=a(d),g,m;const x=l==null?10:+l;let b=[];if(!(n%1)&&p-h<x){if(h=Math.floor(h),p=Math.ceil(p),u>0){for(;h<=p;++h)for(g=1;g<n;++g)if(m=h<0?g/o(-h):g*o(h),!(m<u)){if(m>d)break;b.push(m)}}else for(;h<=p;++h)for(g=n-1;g>=1;--g)if(m=h>0?g/o(-h):g*o(h),!(m<u)){if(m>d)break;b.push(m)}b.length*2<x&&(b=v_(u,d,x))}else b=v_(h,p,Math.min(p-h,x)).map(o);return f?b.reverse():b},t.tickFormat=(l,c)=>{if(l==null&&(l=10),c==null&&(c=n===10?"s":","),typeof c!="function"&&(!(n%1)&&(c=rp(c)).precision==null&&(c.trim=!0),c=qj(c)),l===1/0)return c;const u=Math.max(1,n*l/t.ticks().length);return d=>{let f=d/o(Math.round(a(d)));return f*n<n-.5&&(f*=n),f<=u?c(d):""}},t.nice=()=>r($D(r(),{floor:l=>o(Math.floor(a(l))),ceil:l=>o(Math.ceil(a(l)))})),t}function BD(){const e=Fj(ty()).domain([1,10]);return e.copy=()=>$p(e,BD()).base(e.base()),Go.apply(e,arguments),e}function sk(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function lk(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function $j(e){var t=1,r=e(sk(t),lk(t));return r.constant=function(n){return arguments.length?e(sk(t=+n),lk(t)):t},lc(r)}function UD(){var e=$j(ty());return e.copy=function(){return $p(e,UD()).constant(e.constant())},Go.apply(e,arguments)}function ck(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function $H(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function BH(e){return e<0?-e*e:e*e}function Bj(e){var t=e(qi,qi),r=1;function n(){return r===1?e(qi,qi):r===.5?e($H,BH):e(ck(r),ck(1/r))}return t.exponent=function(a){return arguments.length?(r=+a,n()):r},lc(t)}function Uj(){var e=Bj(ty());return e.copy=function(){return $p(e,Uj()).exponent(e.exponent())},Go.apply(e,arguments),e}function UH(){return Uj.apply(null,arguments).exponent(.5)}function uk(e){return Math.sign(e)*e*e}function zH(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function zD(){var e=Lj(),t=[0,1],r=!1,n;function a(o){var s=zH(e(o));return isNaN(s)?n:r?Math.round(s):s}return a.invert=function(o){return e.invert(uk(o))},a.domain=function(o){return arguments.length?(e.domain(o),a):e.domain()},a.range=function(o){return arguments.length?(e.range((t=Array.from(o,Ig)).map(uk)),a):t.slice()},a.rangeRound=function(o){return a.range(o).round(!0)},a.round=function(o){return arguments.length?(r=!!o,a):r},a.clamp=function(o){return arguments.length?(e.clamp(o),a):e.clamp()},a.unknown=function(o){return arguments.length?(n=o,a):n},a.copy=function(){return zD(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},Go.apply(a,arguments),lc(a)}function WD(){var e=[],t=[],r=[],n;function a(){var s=0,l=Math.max(1,t.length);for(r=new Array(l-1);++s<l;)r[s-1]=Y9(e,s/l);return o}function o(s){return s==null||isNaN(s=+s)?n:t[qp(r,s)]}return o.invertExtent=function(s){var l=t.indexOf(s);return l<0?[NaN,NaN]:[l>0?r[l-1]:e[0],l<r.length?r[l]:e[e.length-1]]},o.domain=function(s){if(!arguments.length)return e.slice();e=[];for(let l of s)l!=null&&!isNaN(l=+l)&&e.push(l);return e.sort(Zl),a()},o.range=function(s){return arguments.length?(t=Array.from(s),a()):t.slice()},o.unknown=function(s){return arguments.length?(n=s,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return WD().domain(e).range(t).unknown(n)},Go.apply(o,arguments)}function HD(){var e=0,t=1,r=1,n=[.5],a=[0,1],o;function s(c){return c!=null&&c<=c?a[qp(n,c,0,r)]:o}function l(){var c=-1;for(n=new Array(r);++c<r;)n[c]=((c+1)*t-(c-r)*e)/(r+1);return s}return s.domain=function(c){return arguments.length?([e,t]=c,e=+e,t=+t,l()):[e,t]},s.range=function(c){return arguments.length?(r=(a=Array.from(c)).length-1,l()):a.slice()},s.invertExtent=function(c){var u=a.indexOf(c);return u<0?[NaN,NaN]:u<1?[e,n[0]]:u>=r?[n[r-1],t]:[n[u-1],n[u]]},s.unknown=function(c){return arguments.length&&(o=c),s},s.thresholds=function(){return n.slice()},s.copy=function(){return HD().domain([e,t]).range(a).unknown(o)},Go.apply(lc(s),arguments)}function VD(){var e=[.5],t=[0,1],r,n=1;function a(o){return o!=null&&o<=o?t[qp(e,o,0,n)]:r}return a.domain=function(o){return arguments.length?(e=Array.from(o),n=Math.min(e.length,t.length-1),a):e.slice()},a.range=function(o){return arguments.length?(t=Array.from(o),n=Math.min(e.length,t.length-1),a):t.slice()},a.invertExtent=function(o){var s=t.indexOf(o);return[e[s-1],e[s]]},a.unknown=function(o){return arguments.length?(r=o,a):r},a.copy=function(){return VD().domain(e).range(t).unknown(r)},Go.apply(a,arguments)}const w1=new Date,j1=new Date;function Ka(e,t,r,n){function a(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return a.floor=o=>(e(o=new Date(+o)),o),a.ceil=o=>(e(o=new Date(o-1)),t(o,1),e(o),o),a.round=o=>{const s=a(o),l=a.ceil(o);return o-s<l-o?s:l},a.offset=(o,s)=>(t(o=new Date(+o),s==null?1:Math.floor(s)),o),a.range=(o,s,l)=>{const c=[];if(o=a.ceil(o),l=l==null?1:Math.floor(l),!(o<s)||!(l>0))return c;let u;do c.push(u=new Date(+o)),t(o,l),e(o);while(u<o&&o<s);return c},a.filter=o=>Ka(s=>{if(s>=s)for(;e(s),!o(s);)s.setTime(s-1)},(s,l)=>{if(s>=s)if(l<0)for(;++l<=0;)for(;t(s,-1),!o(s););else for(;--l>=0;)for(;t(s,1),!o(s););}),r&&(a.count=(o,s)=>(w1.setTime(+o),j1.setTime(+s),e(w1),e(j1),Math.floor(r(w1,j1))),a.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?a.filter(n?s=>n(s)%o===0:s=>a.count(0,s)%o===0):a)),a}const Mg=Ka(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);Mg.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ka(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):Mg);Mg.range;const il=1e3,Ho=il*60,ol=Ho*60,ml=ol*24,zj=ml*7,dk=ml*30,S1=ml*365,Rc=Ka(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*il)},(e,t)=>(t-e)/il,e=>e.getUTCSeconds());Rc.range;const Wj=Ka(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*il)},(e,t)=>{e.setTime(+e+t*Ho)},(e,t)=>(t-e)/Ho,e=>e.getMinutes());Wj.range;const Hj=Ka(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Ho)},(e,t)=>(t-e)/Ho,e=>e.getUTCMinutes());Hj.range;const Vj=Ka(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*il-e.getMinutes()*Ho)},(e,t)=>{e.setTime(+e+t*ol)},(e,t)=>(t-e)/ol,e=>e.getHours());Vj.range;const Gj=Ka(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*ol)},(e,t)=>(t-e)/ol,e=>e.getUTCHours());Gj.range;const Bp=Ka(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Ho)/ml,e=>e.getDate()-1);Bp.range;const ry=Ka(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/ml,e=>e.getUTCDate()-1);ry.range;const GD=Ka(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/ml,e=>Math.floor(e/ml));GD.range;function ou(e){return Ka(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*Ho)/zj)}const ny=ou(0),Lg=ou(1),WH=ou(2),HH=ou(3),od=ou(4),VH=ou(5),GH=ou(6);ny.range;Lg.range;WH.range;HH.range;od.range;VH.range;GH.range;function su(e){return Ka(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/zj)}const ay=su(0),Rg=su(1),YH=su(2),KH=su(3),sd=su(4),QH=su(5),XH=su(6);ay.range;Rg.range;YH.range;KH.range;sd.range;QH.range;XH.range;const Yj=Ka(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());Yj.range;const Kj=Ka(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());Kj.range;const gl=Ka(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());gl.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ka(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});gl.range;const vl=Ka(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());vl.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ka(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});vl.range;function YD(e,t,r,n,a,o){const s=[[Rc,1,il],[Rc,5,5*il],[Rc,15,15*il],[Rc,30,30*il],[o,1,Ho],[o,5,5*Ho],[o,15,15*Ho],[o,30,30*Ho],[a,1,ol],[a,3,3*ol],[a,6,6*ol],[a,12,12*ol],[n,1,ml],[n,2,2*ml],[r,1,zj],[t,1,dk],[t,3,3*dk],[e,1,S1]];function l(u,d,f){const h=d<u;h&&([u,d]=[d,u]);const p=f&&typeof f.range=="function"?f:c(u,d,f),g=p?p.range(u,+d+1):[];return h?g.reverse():g}function c(u,d,f){const h=Math.abs(d-u)/f,p=Ej(([,,x])=>x).right(s,h);if(p===s.length)return e.every(x_(u/S1,d/S1,f));if(p===0)return Mg.every(Math.max(x_(u,d,f),1));const[g,m]=s[h/s[p-1][2]<s[p][2]/h?p-1:p];return g.every(m)}return[l,c]}const[JH,ZH]=YD(vl,Kj,ay,GD,Gj,Hj),[eV,tV]=YD(gl,Yj,ny,Bp,Vj,Wj);function C1(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function A1(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function ff(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function rV(e){var t=e.dateTime,r=e.date,n=e.time,a=e.periods,o=e.days,s=e.shortDays,l=e.months,c=e.shortMonths,u=hf(a),d=pf(a),f=hf(o),h=pf(o),p=hf(s),g=pf(s),m=hf(l),x=pf(l),b=hf(c),_=pf(c),w={a:Z,A:D,b:P,B:$,c:null,d:vk,e:vk,f:CV,g:MV,G:RV,H:wV,I:jV,j:SV,L:KD,m:AV,M:PV,p:Q,q:C,Q:bk,s:_k,S:OV,u:kV,U:TV,V:EV,w:IV,W:NV,x:null,X:null,y:DV,Y:LV,Z:qV,"%":xk},A={a:L,A:H,b:U,B:te,c:null,d:yk,e:yk,f:UV,g:JV,G:eG,H:FV,I:$V,j:BV,L:XD,m:zV,M:WV,p:le,q:oe,Q:bk,s:_k,S:HV,u:VV,U:GV,V:YV,w:KV,W:QV,x:null,X:null,y:XV,Y:ZV,Z:tG,"%":xk},O={a:z,A:k,b:M,B:R,c:F,d:mk,e:mk,f:yV,g:pk,G:hk,H:gk,I:gk,j:pV,L:vV,m:hV,M:mV,p:I,q:fV,Q:bV,s:_V,S:gV,u:sV,U:lV,V:cV,w:oV,W:uV,x:W,X:K,y:pk,Y:hk,Z:dV,"%":xV};w.x=T(r,w),w.X=T(n,w),w.c=T(t,w),A.x=T(r,A),A.X=T(n,A),A.c=T(t,A);function T(ae,he){return function(me){var X=[],G=-1,ee=0,se=ae.length,V,He,Ne;for(me instanceof Date||(me=new Date(+me));++G<se;)ae.charCodeAt(G)===37&&(X.push(ae.slice(ee,G)),(He=fk[V=ae.charAt(++G)])!=null?V=ae.charAt(++G):He=V==="e"?" ":"0",(Ne=he[V])&&(V=Ne(me,He)),X.push(V),ee=G+1);return X.push(ae.slice(ee,G)),X.join("")}}function E(ae,he){return function(me){var X=ff(1900,void 0,1),G=S(X,ae,me+="",0),ee,se;if(G!=me.length)return null;if("Q"in X)return new Date(X.Q);if("s"in X)return new Date(X.s*1e3+("L"in X?X.L:0));if(he&&!("Z"in X)&&(X.Z=0),"p"in X&&(X.H=X.H%12+X.p*12),X.m===void 0&&(X.m="q"in X?X.q:0),"V"in X){if(X.V<1||X.V>53)return null;"w"in X||(X.w=1),"Z"in X?(ee=A1(ff(X.y,0,1)),se=ee.getUTCDay(),ee=se>4||se===0?Rg.ceil(ee):Rg(ee),ee=ry.offset(ee,(X.V-1)*7),X.y=ee.getUTCFullYear(),X.m=ee.getUTCMonth(),X.d=ee.getUTCDate()+(X.w+6)%7):(ee=C1(ff(X.y,0,1)),se=ee.getDay(),ee=se>4||se===0?Lg.ceil(ee):Lg(ee),ee=Bp.offset(ee,(X.V-1)*7),X.y=ee.getFullYear(),X.m=ee.getMonth(),X.d=ee.getDate()+(X.w+6)%7)}else("W"in X||"U"in X)&&("w"in X||(X.w="u"in X?X.u%7:"W"in X?1:0),se="Z"in X?A1(ff(X.y,0,1)).getUTCDay():C1(ff(X.y,0,1)).getDay(),X.m=0,X.d="W"in X?(X.w+6)%7+X.W*7-(se+5)%7:X.w+X.U*7-(se+6)%7);return"Z"in X?(X.H+=X.Z/100|0,X.M+=X.Z%100,A1(X)):C1(X)}}function S(ae,he,me,X){for(var G=0,ee=he.length,se=me.length,V,He;G<ee;){if(X>=se)return-1;if(V=he.charCodeAt(G++),V===37){if(V=he.charAt(G++),He=O[V in fk?he.charAt(G++):V],!He||(X=He(ae,me,X))<0)return-1}else if(V!=me.charCodeAt(X++))return-1}return X}function I(ae,he,me){var X=u.exec(he.slice(me));return X?(ae.p=d.get(X[0].toLowerCase()),me+X[0].length):-1}function z(ae,he,me){var X=p.exec(he.slice(me));return X?(ae.w=g.get(X[0].toLowerCase()),me+X[0].length):-1}function k(ae,he,me){var X=f.exec(he.slice(me));return X?(ae.w=h.get(X[0].toLowerCase()),me+X[0].length):-1}function M(ae,he,me){var X=b.exec(he.slice(me));return X?(ae.m=_.get(X[0].toLowerCase()),me+X[0].length):-1}function R(ae,he,me){var X=m.exec(he.slice(me));return X?(ae.m=x.get(X[0].toLowerCase()),me+X[0].length):-1}function F(ae,he,me){return S(ae,t,he,me)}function W(ae,he,me){return S(ae,r,he,me)}function K(ae,he,me){return S(ae,n,he,me)}function Z(ae){return s[ae.getDay()]}function D(ae){return o[ae.getDay()]}function P(ae){return c[ae.getMonth()]}function $(ae){return l[ae.getMonth()]}function Q(ae){return a[+(ae.getHours()>=12)]}function C(ae){return 1+~~(ae.getMonth()/3)}function L(ae){return s[ae.getUTCDay()]}function H(ae){return o[ae.getUTCDay()]}function U(ae){return c[ae.getUTCMonth()]}function te(ae){return l[ae.getUTCMonth()]}function le(ae){return a[+(ae.getUTCHours()>=12)]}function oe(ae){return 1+~~(ae.getUTCMonth()/3)}return{format:function(ae){var he=T(ae+="",w);return he.toString=function(){return ae},he},parse:function(ae){var he=E(ae+="",!1);return he.toString=function(){return ae},he},utcFormat:function(ae){var he=T(ae+="",A);return he.toString=function(){return ae},he},utcParse:function(ae){var he=E(ae+="",!0);return he.toString=function(){return ae},he}}}var fk={"-":"",_:" ",0:"0"},ni=/^\s*\d+/,nV=/^%/,aV=/[\\^$*+?|[\]().{}]/g;function mn(e,t,r){var n=e<0?"-":"",a=(n?-e:e)+"",o=a.length;return n+(o<r?new Array(r-o+1).join(t)+a:a)}function iV(e){return e.replace(aV,"\\$&")}function hf(e){return new RegExp("^(?:"+e.map(iV).join("|")+")","i")}function pf(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function oV(e,t,r){var n=ni.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function sV(e,t,r){var n=ni.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function lV(e,t,r){var n=ni.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function cV(e,t,r){var n=ni.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function uV(e,t,r){var n=ni.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function hk(e,t,r){var n=ni.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function pk(e,t,r){var n=ni.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function dV(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function fV(e,t,r){var n=ni.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function hV(e,t,r){var n=ni.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function mk(e,t,r){var n=ni.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function pV(e,t,r){var n=ni.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function gk(e,t,r){var n=ni.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function mV(e,t,r){var n=ni.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function gV(e,t,r){var n=ni.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function vV(e,t,r){var n=ni.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function yV(e,t,r){var n=ni.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function xV(e,t,r){var n=nV.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function bV(e,t,r){var n=ni.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function _V(e,t,r){var n=ni.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function vk(e,t){return mn(e.getDate(),t,2)}function wV(e,t){return mn(e.getHours(),t,2)}function jV(e,t){return mn(e.getHours()%12||12,t,2)}function SV(e,t){return mn(1+Bp.count(gl(e),e),t,3)}function KD(e,t){return mn(e.getMilliseconds(),t,3)}function CV(e,t){return KD(e,t)+"000"}function AV(e,t){return mn(e.getMonth()+1,t,2)}function PV(e,t){return mn(e.getMinutes(),t,2)}function OV(e,t){return mn(e.getSeconds(),t,2)}function kV(e){var t=e.getDay();return t===0?7:t}function TV(e,t){return mn(ny.count(gl(e)-1,e),t,2)}function QD(e){var t=e.getDay();return t>=4||t===0?od(e):od.ceil(e)}function EV(e,t){return e=QD(e),mn(od.count(gl(e),e)+(gl(e).getDay()===4),t,2)}function IV(e){return e.getDay()}function NV(e,t){return mn(Lg.count(gl(e)-1,e),t,2)}function DV(e,t){return mn(e.getFullYear()%100,t,2)}function MV(e,t){return e=QD(e),mn(e.getFullYear()%100,t,2)}function LV(e,t){return mn(e.getFullYear()%1e4,t,4)}function RV(e,t){var r=e.getDay();return e=r>=4||r===0?od(e):od.ceil(e),mn(e.getFullYear()%1e4,t,4)}function qV(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+mn(t/60|0,"0",2)+mn(t%60,"0",2)}function yk(e,t){return mn(e.getUTCDate(),t,2)}function FV(e,t){return mn(e.getUTCHours(),t,2)}function $V(e,t){return mn(e.getUTCHours()%12||12,t,2)}function BV(e,t){return mn(1+ry.count(vl(e),e),t,3)}function XD(e,t){return mn(e.getUTCMilliseconds(),t,3)}function UV(e,t){return XD(e,t)+"000"}function zV(e,t){return mn(e.getUTCMonth()+1,t,2)}function WV(e,t){return mn(e.getUTCMinutes(),t,2)}function HV(e,t){return mn(e.getUTCSeconds(),t,2)}function VV(e){var t=e.getUTCDay();return t===0?7:t}function GV(e,t){return mn(ay.count(vl(e)-1,e),t,2)}function JD(e){var t=e.getUTCDay();return t>=4||t===0?sd(e):sd.ceil(e)}function YV(e,t){return e=JD(e),mn(sd.count(vl(e),e)+(vl(e).getUTCDay()===4),t,2)}function KV(e){return e.getUTCDay()}function QV(e,t){return mn(Rg.count(vl(e)-1,e),t,2)}function XV(e,t){return mn(e.getUTCFullYear()%100,t,2)}function JV(e,t){return e=JD(e),mn(e.getUTCFullYear()%100,t,2)}function ZV(e,t){return mn(e.getUTCFullYear()%1e4,t,4)}function eG(e,t){var r=e.getUTCDay();return e=r>=4||r===0?sd(e):sd.ceil(e),mn(e.getUTCFullYear()%1e4,t,4)}function tG(){return"+0000"}function xk(){return"%"}function bk(e){return+e}function _k(e){return Math.floor(+e/1e3)}var bu,ZD,eM;rG({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function rG(e){return bu=rV(e),ZD=bu.format,bu.parse,eM=bu.utcFormat,bu.utcParse,bu}function nG(e){return new Date(e)}function aG(e){return e instanceof Date?+e:+new Date(+e)}function Qj(e,t,r,n,a,o,s,l,c,u){var d=Lj(),f=d.invert,h=d.domain,p=u(".%L"),g=u(":%S"),m=u("%I:%M"),x=u("%I %p"),b=u("%a %d"),_=u("%b %d"),w=u("%B"),A=u("%Y");function O(T){return(c(T)<T?p:l(T)<T?g:s(T)<T?m:o(T)<T?x:n(T)<T?a(T)<T?b:_:r(T)<T?w:A)(T)}return d.invert=function(T){return new Date(f(T))},d.domain=function(T){return arguments.length?h(Array.from(T,aG)):h().map(nG)},d.ticks=function(T){var E=h();return e(E[0],E[E.length-1],T??10)},d.tickFormat=function(T,E){return E==null?O:u(E)},d.nice=function(T){var E=h();return(!T||typeof T.range!="function")&&(T=t(E[0],E[E.length-1],T??10)),T?h($D(E,T)):d},d.copy=function(){return $p(d,Qj(e,t,r,n,a,o,s,l,c,u))},d}function iG(){return Go.apply(Qj(eV,tV,gl,Yj,ny,Bp,Vj,Wj,Rc,ZD).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function oG(){return Go.apply(Qj(JH,ZH,vl,Kj,ay,ry,Gj,Hj,Rc,eM).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function iy(){var e=0,t=1,r,n,a,o,s=qi,l=!1,c;function u(f){return f==null||isNaN(f=+f)?c:s(a===0?.5:(f=(o(f)-r)*a,l?Math.max(0,Math.min(1,f)):f))}u.domain=function(f){return arguments.length?([e,t]=f,r=o(e=+e),n=o(t=+t),a=r===n?0:1/(n-r),u):[e,t]},u.clamp=function(f){return arguments.length?(l=!!f,u):l},u.interpolator=function(f){return arguments.length?(s=f,u):s};function d(f){return function(h){var p,g;return arguments.length?([p,g]=h,s=f(p,g),u):[s(0),s(1)]}}return u.range=d($d),u.rangeRound=d(Mj),u.unknown=function(f){return arguments.length?(c=f,u):c},function(f){return o=f,r=f(e),n=f(t),a=r===n?0:1/(n-r),u}}function cc(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function tM(){var e=lc(iy()(qi));return e.copy=function(){return cc(e,tM())},jl.apply(e,arguments)}function rM(){var e=Fj(iy()).domain([1,10]);return e.copy=function(){return cc(e,rM()).base(e.base())},jl.apply(e,arguments)}function nM(){var e=$j(iy());return e.copy=function(){return cc(e,nM()).constant(e.constant())},jl.apply(e,arguments)}function Xj(){var e=Bj(iy());return e.copy=function(){return cc(e,Xj()).exponent(e.exponent())},jl.apply(e,arguments)}function sG(){return Xj.apply(null,arguments).exponent(.5)}function aM(){var e=[],t=qi;function r(n){if(n!=null&&!isNaN(n=+n))return t((qp(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let a of n)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(Zl),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,a)=>t(a/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(a,o)=>G9(e,o/n))},r.copy=function(){return aM(t).domain(e)},jl.apply(r,arguments)}function oy(){var e=0,t=.5,r=1,n=1,a,o,s,l,c,u=qi,d,f=!1,h;function p(m){return isNaN(m=+m)?h:(m=.5+((m=+d(m))-o)*(n*m<n*o?l:c),u(f?Math.max(0,Math.min(1,m)):m))}p.domain=function(m){return arguments.length?([e,t,r]=m,a=d(e=+e),o=d(t=+t),s=d(r=+r),l=a===o?0:.5/(o-a),c=o===s?0:.5/(s-o),n=o<a?-1:1,p):[e,t,r]},p.clamp=function(m){return arguments.length?(f=!!m,p):f},p.interpolator=function(m){return arguments.length?(u=m,p):u};function g(m){return function(x){var b,_,w;return arguments.length?([b,_,w]=x,u=xH(m,[b,_,w]),p):[u(0),u(.5),u(1)]}}return p.range=g($d),p.rangeRound=g(Mj),p.unknown=function(m){return arguments.length?(h=m,p):h},function(m){return d=m,a=m(e),o=m(t),s=m(r),l=a===o?0:.5/(o-a),c=o===s?0:.5/(s-o),n=o<a?-1:1,p}}function iM(){var e=lc(oy()(qi));return e.copy=function(){return cc(e,iM())},jl.apply(e,arguments)}function oM(){var e=Fj(oy()).domain([.1,1,10]);return e.copy=function(){return cc(e,oM()).base(e.base())},jl.apply(e,arguments)}function sM(){var e=$j(oy());return e.copy=function(){return cc(e,sM()).constant(e.constant())},jl.apply(e,arguments)}function Jj(){var e=Bj(oy());return e.copy=function(){return cc(e,Jj()).exponent(e.exponent())},jl.apply(e,arguments)}function lG(){return Jj.apply(null,arguments).exponent(.5)}const wk=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:Jh,scaleDiverging:iM,scaleDivergingLog:oM,scaleDivergingPow:Jj,scaleDivergingSqrt:lG,scaleDivergingSymlog:sM,scaleIdentity:FD,scaleImplicit:b_,scaleLinear:Dg,scaleLog:BD,scaleOrdinal:Ij,scalePoint:Th,scalePow:Uj,scaleQuantile:WD,scaleQuantize:HD,scaleRadial:zD,scaleSequential:tM,scaleSequentialLog:rM,scaleSequentialPow:Xj,scaleSequentialQuantile:aM,scaleSequentialSqrt:sG,scaleSequentialSymlog:nM,scaleSqrt:UH,scaleSymlog:UD,scaleThreshold:VD,scaleTime:iG,scaleUtc:oG,tickFormat:qD},Symbol.toStringTag,{value:"Module"}));var P1,jk;function sy(){if(jk)return P1;jk=1;var e=Ld();function t(r,n,a){for(var o=-1,s=r.length;++o<s;){var l=r[o],c=n(l);if(c!=null&&(u===void 0?c===c&&!e(c):a(c,u)))var u=c,d=l}return d}return P1=t,P1}var O1,Sk;function lM(){if(Sk)return O1;Sk=1;function e(t,r){return t>r}return O1=e,O1}var k1,Ck;function cG(){if(Ck)return k1;Ck=1;var e=sy(),t=lM(),r=Fd();function n(a){return a&&a.length?e(a,r,t):void 0}return k1=n,k1}var uG=cG();const ly=It(uG);var T1,Ak;function cM(){if(Ak)return T1;Ak=1;function e(t,r){return t<r}return T1=e,T1}var E1,Pk;function dG(){if(Pk)return E1;Pk=1;var e=sy(),t=cM(),r=Fd();function n(a){return a&&a.length?e(a,r,t):void 0}return E1=n,E1}var fG=dG();const cy=It(fG);var I1,Ok;function hG(){if(Ok)return I1;Ok=1;var e=pj(),t=Rs(),r=gD(),n=eo();function a(o,s){var l=n(o)?e:r;return l(o,t(s,3))}return I1=a,I1}var N1,kk;function pG(){if(kk)return N1;kk=1;var e=pD(),t=hG();function r(n,a){return e(t(n,a),1)}return N1=r,N1}var mG=pG();const gG=It(mG);var D1,Tk;function vG(){if(Tk)return D1;Tk=1;var e=Pj();function t(r,n){return e(r,n)}return D1=t,D1}var yG=vG();const Up=It(yG);var Bd=1e9,xG={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},eS,Zn=!0,Vo="[DecimalError] ",Bc=Vo+"Invalid argument: ",Zj=Vo+"Exponent out of range: ",Ud=Math.floor,Oc=Math.pow,bG=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,wo,Za=1e7,Hn=7,uM=9007199254740991,qg=Ud(uM/Hn),Zt={};Zt.absoluteValue=Zt.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Zt.comparedTo=Zt.cmp=function(e){var t,r,n,a,o=this;if(e=new o.constructor(e),o.s!==e.s)return o.s||-e.s;if(o.e!==e.e)return o.e>e.e^o.s<0?1:-1;for(n=o.d.length,a=e.d.length,t=0,r=n<a?n:a;t<r;++t)if(o.d[t]!==e.d[t])return o.d[t]>e.d[t]^o.s<0?1:-1;return n===a?0:n>a^o.s<0?1:-1};Zt.decimalPlaces=Zt.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*Hn;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};Zt.dividedBy=Zt.div=function(e){return dl(this,new this.constructor(e))};Zt.dividedToIntegerBy=Zt.idiv=function(e){var t=this,r=t.constructor;return In(dl(t,new r(e),0,1),r.precision)};Zt.equals=Zt.eq=function(e){return!this.cmp(e)};Zt.exponent=function(){return $a(this)};Zt.greaterThan=Zt.gt=function(e){return this.cmp(e)>0};Zt.greaterThanOrEqualTo=Zt.gte=function(e){return this.cmp(e)>=0};Zt.isInteger=Zt.isint=function(){return this.e>this.d.length-2};Zt.isNegative=Zt.isneg=function(){return this.s<0};Zt.isPositive=Zt.ispos=function(){return this.s>0};Zt.isZero=function(){return this.s===0};Zt.lessThan=Zt.lt=function(e){return this.cmp(e)<0};Zt.lessThanOrEqualTo=Zt.lte=function(e){return this.cmp(e)<1};Zt.logarithm=Zt.log=function(e){var t,r=this,n=r.constructor,a=n.precision,o=a+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(wo))throw Error(Vo+"NaN");if(r.s<1)throw Error(Vo+(r.s?"NaN":"-Infinity"));return r.eq(wo)?new n(0):(Zn=!1,t=dl(np(r,o),np(e,o),o),Zn=!0,In(t,a))};Zt.minus=Zt.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?hM(t,e):dM(t,(e.s=-e.s,e))};Zt.modulo=Zt.mod=function(e){var t,r=this,n=r.constructor,a=n.precision;if(e=new n(e),!e.s)throw Error(Vo+"NaN");return r.s?(Zn=!1,t=dl(r,e,0,1).times(e),Zn=!0,r.minus(t)):In(new n(r),a)};Zt.naturalExponential=Zt.exp=function(){return fM(this)};Zt.naturalLogarithm=Zt.ln=function(){return np(this)};Zt.negated=Zt.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Zt.plus=Zt.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?dM(t,e):hM(t,(e.s=-e.s,e))};Zt.precision=Zt.sd=function(e){var t,r,n,a=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Bc+e);if(t=$a(a)+1,n=a.d.length-1,r=n*Hn+1,n=a.d[n],n){for(;n%10==0;n/=10)r--;for(n=a.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};Zt.squareRoot=Zt.sqrt=function(){var e,t,r,n,a,o,s,l=this,c=l.constructor;if(l.s<1){if(!l.s)return new c(0);throw Error(Vo+"NaN")}for(e=$a(l),Zn=!1,a=Math.sqrt(+l),a==0||a==1/0?(t=ws(l.d),(t.length+e)%2==0&&(t+="0"),a=Math.sqrt(t),e=Ud((e+1)/2)-(e<0||e%2),a==1/0?t="5e"+e:(t=a.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new c(t)):n=new c(a.toString()),r=c.precision,a=s=r+3;;)if(o=n,n=o.plus(dl(l,o,s+2)).times(.5),ws(o.d).slice(0,s)===(t=ws(n.d)).slice(0,s)){if(t=t.slice(s-3,s+1),a==s&&t=="4999"){if(In(o,r+1,0),o.times(o).eq(l)){n=o;break}}else if(t!="9999")break;s+=4}return Zn=!0,In(n,r)};Zt.times=Zt.mul=function(e){var t,r,n,a,o,s,l,c,u,d=this,f=d.constructor,h=d.d,p=(e=new f(e)).d;if(!d.s||!e.s)return new f(0);for(e.s*=d.s,r=d.e+e.e,c=h.length,u=p.length,c<u&&(o=h,h=p,p=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(t=0,a=c+n;a>n;)l=o[a]+p[n]*h[a-n-1]+t,o[a--]=l%Za|0,t=l/Za|0;o[a]=(o[a]+t)%Za|0}for(;!o[--s];)o.pop();return t?++r:o.shift(),e.d=o,e.e=r,Zn?In(e,f.precision):e};Zt.toDecimalPlaces=Zt.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(ks(e,0,Bd),t===void 0?t=n.rounding:ks(t,0,8),In(r,e+$a(r)+1,t))};Zt.toExponential=function(e,t){var r,n=this,a=n.constructor;return e===void 0?r=Qc(n,!0):(ks(e,0,Bd),t===void 0?t=a.rounding:ks(t,0,8),n=In(new a(n),e+1,t),r=Qc(n,!0,e+1)),r};Zt.toFixed=function(e,t){var r,n,a=this,o=a.constructor;return e===void 0?Qc(a):(ks(e,0,Bd),t===void 0?t=o.rounding:ks(t,0,8),n=In(new o(a),e+$a(a)+1,t),r=Qc(n.abs(),!1,e+$a(n)+1),a.isneg()&&!a.isZero()?"-"+r:r)};Zt.toInteger=Zt.toint=function(){var e=this,t=e.constructor;return In(new t(e),$a(e)+1,t.rounding)};Zt.toNumber=function(){return+this};Zt.toPower=Zt.pow=function(e){var t,r,n,a,o,s,l=this,c=l.constructor,u=12,d=+(e=new c(e));if(!e.s)return new c(wo);if(l=new c(l),!l.s){if(e.s<1)throw Error(Vo+"Infinity");return l}if(l.eq(wo))return l;if(n=c.precision,e.eq(wo))return In(l,n);if(t=e.e,r=e.d.length-1,s=t>=r,o=l.s,s){if((r=d<0?-d:d)<=uM){for(a=new c(wo),t=Math.ceil(n/Hn+4),Zn=!1;r%2&&(a=a.times(l),Ik(a.d,t)),r=Ud(r/2),r!==0;)l=l.times(l),Ik(l.d,t);return Zn=!0,e.s<0?new c(wo).div(a):In(a,n)}}else if(o<0)throw Error(Vo+"NaN");return o=o<0&&e.d[Math.max(t,r)]&1?-1:1,l.s=1,Zn=!1,a=e.times(np(l,n+u)),Zn=!0,a=fM(a),a.s=o,a};Zt.toPrecision=function(e,t){var r,n,a=this,o=a.constructor;return e===void 0?(r=$a(a),n=Qc(a,r<=o.toExpNeg||r>=o.toExpPos)):(ks(e,1,Bd),t===void 0?t=o.rounding:ks(t,0,8),a=In(new o(a),e,t),r=$a(a),n=Qc(a,e<=r||r<=o.toExpNeg,e)),n};Zt.toSignificantDigits=Zt.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(ks(e,1,Bd),t===void 0?t=n.rounding:ks(t,0,8)),In(new n(r),e,t)};Zt.toString=Zt.valueOf=Zt.val=Zt.toJSON=Zt[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=$a(e),r=e.constructor;return Qc(e,t<=r.toExpNeg||t>=r.toExpPos)};function dM(e,t){var r,n,a,o,s,l,c,u,d=e.constructor,f=d.precision;if(!e.s||!t.s)return t.s||(t=new d(e)),Zn?In(t,f):t;if(c=e.d,u=t.d,s=e.e,a=t.e,c=c.slice(),o=s-a,o){for(o<0?(n=c,o=-o,l=u.length):(n=u,a=s,l=c.length),s=Math.ceil(f/Hn),l=s>l?s+1:l+1,o>l&&(o=l,n.length=1),n.reverse();o--;)n.push(0);n.reverse()}for(l=c.length,o=u.length,l-o<0&&(o=l,n=u,u=c,c=n),r=0;o;)r=(c[--o]=c[o]+u[o]+r)/Za|0,c[o]%=Za;for(r&&(c.unshift(r),++a),l=c.length;c[--l]==0;)c.pop();return t.d=c,t.e=a,Zn?In(t,f):t}function ks(e,t,r){if(e!==~~e||e<t||e>r)throw Error(Bc+e)}function ws(e){var t,r,n,a=e.length-1,o="",s=e[0];if(a>0){for(o+=s,t=1;t<a;t++)n=e[t]+"",r=Hn-n.length,r&&(o+=Hl(r)),o+=n;s=e[t],n=s+"",r=Hn-n.length,r&&(o+=Hl(r))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}var dl=function(){function e(n,a){var o,s=0,l=n.length;for(n=n.slice();l--;)o=n[l]*a+s,n[l]=o%Za|0,s=o/Za|0;return s&&n.unshift(s),n}function t(n,a,o,s){var l,c;if(o!=s)c=o>s?1:-1;else for(l=c=0;l<o;l++)if(n[l]!=a[l]){c=n[l]>a[l]?1:-1;break}return c}function r(n,a,o){for(var s=0;o--;)n[o]-=s,s=n[o]<a[o]?1:0,n[o]=s*Za+n[o]-a[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,a,o,s){var l,c,u,d,f,h,p,g,m,x,b,_,w,A,O,T,E,S,I=n.constructor,z=n.s==a.s?1:-1,k=n.d,M=a.d;if(!n.s)return new I(n);if(!a.s)throw Error(Vo+"Division by zero");for(c=n.e-a.e,E=M.length,O=k.length,p=new I(z),g=p.d=[],u=0;M[u]==(k[u]||0);)++u;if(M[u]>(k[u]||0)&&--c,o==null?_=o=I.precision:s?_=o+($a(n)-$a(a))+1:_=o,_<0)return new I(0);if(_=_/Hn+2|0,u=0,E==1)for(d=0,M=M[0],_++;(u<O||d)&&_--;u++)w=d*Za+(k[u]||0),g[u]=w/M|0,d=w%M|0;else{for(d=Za/(M[0]+1)|0,d>1&&(M=e(M,d),k=e(k,d),E=M.length,O=k.length),A=E,m=k.slice(0,E),x=m.length;x<E;)m[x++]=0;S=M.slice(),S.unshift(0),T=M[0],M[1]>=Za/2&&++T;do d=0,l=t(M,m,E,x),l<0?(b=m[0],E!=x&&(b=b*Za+(m[1]||0)),d=b/T|0,d>1?(d>=Za&&(d=Za-1),f=e(M,d),h=f.length,x=m.length,l=t(f,m,h,x),l==1&&(d--,r(f,E<h?S:M,h))):(d==0&&(l=d=1),f=M.slice()),h=f.length,h<x&&f.unshift(0),r(m,f,x),l==-1&&(x=m.length,l=t(M,m,E,x),l<1&&(d++,r(m,E<x?S:M,x))),x=m.length):l===0&&(d++,m=[0]),g[u++]=d,l&&m[0]?m[x++]=k[A]||0:(m=[k[A]],x=1);while((A++<O||m[0]!==void 0)&&_--)}return g[0]||g.shift(),p.e=c,In(p,s?o+$a(p)+1:o)}}();function fM(e,t){var r,n,a,o,s,l,c=0,u=0,d=e.constructor,f=d.precision;if($a(e)>16)throw Error(Zj+$a(e));if(!e.s)return new d(wo);for(Zn=!1,l=f,s=new d(.03125);e.abs().gte(.1);)e=e.times(s),u+=5;for(n=Math.log(Oc(2,u))/Math.LN10*2+5|0,l+=n,r=a=o=new d(wo),d.precision=l;;){if(a=In(a.times(e),l),r=r.times(++c),s=o.plus(dl(a,r,l)),ws(s.d).slice(0,l)===ws(o.d).slice(0,l)){for(;u--;)o=In(o.times(o),l);return d.precision=f,t==null?(Zn=!0,In(o,f)):o}o=s}}function $a(e){for(var t=e.e*Hn,r=e.d[0];r>=10;r/=10)t++;return t}function M1(e,t,r){if(t>e.LN10.sd())throw Zn=!0,r&&(e.precision=r),Error(Vo+"LN10 precision limit exceeded");return In(new e(e.LN10),t)}function Hl(e){for(var t="";e--;)t+="0";return t}function np(e,t){var r,n,a,o,s,l,c,u,d,f=1,h=10,p=e,g=p.d,m=p.constructor,x=m.precision;if(p.s<1)throw Error(Vo+(p.s?"NaN":"-Infinity"));if(p.eq(wo))return new m(0);if(t==null?(Zn=!1,u=x):u=t,p.eq(10))return t==null&&(Zn=!0),M1(m,u);if(u+=h,m.precision=u,r=ws(g),n=r.charAt(0),o=$a(p),Math.abs(o)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)p=p.times(e),r=ws(p.d),n=r.charAt(0),f++;o=$a(p),n>1?(p=new m("0."+r),o++):p=new m(n+"."+r.slice(1))}else return c=M1(m,u+2,x).times(o+""),p=np(new m(n+"."+r.slice(1)),u-h).plus(c),m.precision=x,t==null?(Zn=!0,In(p,x)):p;for(l=s=p=dl(p.minus(wo),p.plus(wo),u),d=In(p.times(p),u),a=3;;){if(s=In(s.times(d),u),c=l.plus(dl(s,new m(a),u)),ws(c.d).slice(0,u)===ws(l.d).slice(0,u))return l=l.times(2),o!==0&&(l=l.plus(M1(m,u+2,x).times(o+""))),l=dl(l,new m(f),u),m.precision=x,t==null?(Zn=!0,In(l,x)):l;l=c,a+=2}}function Ek(e,t){var r,n,a;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(a=t.length;t.charCodeAt(a-1)===48;)--a;if(t=t.slice(n,a),t){if(a-=n,r=r-n-1,e.e=Ud(r/Hn),e.d=[],n=(r+1)%Hn,r<0&&(n+=Hn),n<a){for(n&&e.d.push(+t.slice(0,n)),a-=Hn;n<a;)e.d.push(+t.slice(n,n+=Hn));t=t.slice(n),n=Hn-t.length}else n-=a;for(;n--;)t+="0";if(e.d.push(+t),Zn&&(e.e>qg||e.e<-qg))throw Error(Zj+r)}else e.s=0,e.e=0,e.d=[0];return e}function In(e,t,r){var n,a,o,s,l,c,u,d,f=e.d;for(s=1,o=f[0];o>=10;o/=10)s++;if(n=t-s,n<0)n+=Hn,a=t,u=f[d=0];else{if(d=Math.ceil((n+1)/Hn),o=f.length,d>=o)return e;for(u=o=f[d],s=1;o>=10;o/=10)s++;n%=Hn,a=n-Hn+s}if(r!==void 0&&(o=Oc(10,s-a-1),l=u/o%10|0,c=t<0||f[d+1]!==void 0||u%o,c=r<4?(l||c)&&(r==0||r==(e.s<0?3:2)):l>5||l==5&&(r==4||c||r==6&&(n>0?a>0?u/Oc(10,s-a):0:f[d-1])%10&1||r==(e.s<0?8:7))),t<1||!f[0])return c?(o=$a(e),f.length=1,t=t-o-1,f[0]=Oc(10,(Hn-t%Hn)%Hn),e.e=Ud(-t/Hn)||0):(f.length=1,f[0]=e.e=e.s=0),e;if(n==0?(f.length=d,o=1,d--):(f.length=d+1,o=Oc(10,Hn-n),f[d]=a>0?(u/Oc(10,s-a)%Oc(10,a)|0)*o:0),c)for(;;)if(d==0){(f[0]+=o)==Za&&(f[0]=1,++e.e);break}else{if(f[d]+=o,f[d]!=Za)break;f[d--]=0,o=1}for(n=f.length;f[--n]===0;)f.pop();if(Zn&&(e.e>qg||e.e<-qg))throw Error(Zj+$a(e));return e}function hM(e,t){var r,n,a,o,s,l,c,u,d,f,h=e.constructor,p=h.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new h(e),Zn?In(t,p):t;if(c=e.d,f=t.d,n=t.e,u=e.e,c=c.slice(),s=u-n,s){for(d=s<0,d?(r=c,s=-s,l=f.length):(r=f,n=u,l=c.length),a=Math.max(Math.ceil(p/Hn),l)+2,s>a&&(s=a,r.length=1),r.reverse(),a=s;a--;)r.push(0);r.reverse()}else{for(a=c.length,l=f.length,d=a<l,d&&(l=a),a=0;a<l;a++)if(c[a]!=f[a]){d=c[a]<f[a];break}s=0}for(d&&(r=c,c=f,f=r,t.s=-t.s),l=c.length,a=f.length-l;a>0;--a)c[l++]=0;for(a=f.length;a>s;){if(c[--a]<f[a]){for(o=a;o&&c[--o]===0;)c[o]=Za-1;--c[o],c[a]+=Za}c[a]-=f[a]}for(;c[--l]===0;)c.pop();for(;c[0]===0;c.shift())--n;return c[0]?(t.d=c,t.e=n,Zn?In(t,p):t):new h(0)}function Qc(e,t,r){var n,a=$a(e),o=ws(e.d),s=o.length;return t?(r&&(n=r-s)>0?o=o.charAt(0)+"."+o.slice(1)+Hl(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(a<0?"e":"e+")+a):a<0?(o="0."+Hl(-a-1)+o,r&&(n=r-s)>0&&(o+=Hl(n))):a>=s?(o+=Hl(a+1-s),r&&(n=r-a-1)>0&&(o=o+"."+Hl(n))):((n=a+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),r&&(n=r-s)>0&&(a+1===s&&(o+="."),o+=Hl(n))),e.s<0?"-"+o:o}function Ik(e,t){if(e.length>t)return e.length=t,!0}function pM(e){var t,r,n;function a(o){var s=this;if(!(s instanceof a))return new a(o);if(s.constructor=a,o instanceof a){s.s=o.s,s.e=o.e,s.d=(o=o.d)?o.slice():o;return}if(typeof o=="number"){if(o*0!==0)throw Error(Bc+o);if(o>0)s.s=1;else if(o<0)o=-o,s.s=-1;else{s.s=0,s.e=0,s.d=[0];return}if(o===~~o&&o<1e7){s.e=0,s.d=[o];return}return Ek(s,o.toString())}else if(typeof o!="string")throw Error(Bc+o);if(o.charCodeAt(0)===45?(o=o.slice(1),s.s=-1):s.s=1,bG.test(o))Ek(s,o);else throw Error(Bc+o)}if(a.prototype=Zt,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=pM,a.config=a.set=_G,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return a.config(e),a}function _G(e){if(!e||typeof e!="object")throw Error(Vo+"Object expected");var t,r,n,a=["precision",1,Bd,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<a.length;t+=3)if((n=e[r=a[t]])!==void 0)if(Ud(n)===n&&n>=a[t+1]&&n<=a[t+2])this[r]=n;else throw Error(Bc+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(Bc+r+": "+n);return this}var eS=pM(xG);wo=new eS(1);const Pn=eS;function wG(e){return AG(e)||CG(e)||SG(e)||jG()}function jG(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function SG(e,t){if(e){if(typeof e=="string")return S_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return S_(e,t)}}function CG(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function AG(e){if(Array.isArray(e))return S_(e)}function S_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var PG=function(t){return t},mM={},gM=function(t){return t===mM},Nk=function(t){return function r(){return arguments.length===0||arguments.length===1&&gM(arguments.length<=0?void 0:arguments[0])?r:t.apply(void 0,arguments)}},OG=function e(t,r){return t===1?r:Nk(function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];var s=a.filter(function(l){return l!==mM}).length;return s>=t?r.apply(void 0,a):e(t-s,Nk(function(){for(var l=arguments.length,c=new Array(l),u=0;u<l;u++)c[u]=arguments[u];var d=a.map(function(f){return gM(f)?c.shift():f});return r.apply(void 0,wG(d).concat(c))}))})},uy=function(t){return OG(t.length,t)},C_=function(t,r){for(var n=[],a=t;a<r;++a)n[a-t]=a;return n},kG=uy(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),TG=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!r.length)return PG;var a=r.reverse(),o=a[0],s=a.slice(1);return function(){return s.reduce(function(l,c){return c(l)},o.apply(void 0,arguments))}},A_=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},vM=function(t){var r=null,n=null;return function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return r&&o.every(function(l,c){return l===r[c]})||(r=o,n=t.apply(void 0,o)),n}};function EG(e){var t;return e===0?t=1:t=Math.floor(new Pn(e).abs().log(10).toNumber())+1,t}function IG(e,t,r){for(var n=new Pn(e),a=0,o=[];n.lt(t)&&a<1e5;)o.push(n.toNumber()),n=n.add(r),a++;return o}var NG=uy(function(e,t,r){var n=+e,a=+t;return n+r*(a-n)}),DG=uy(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),MG=uy(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const dy={rangeStep:IG,getDigitCount:EG,interpolateNumber:NG,uninterpolateNumber:DG,uninterpolateTruncation:MG};function P_(e){return qG(e)||RG(e)||yM(e)||LG()}function LG(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RG(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function qG(e){if(Array.isArray(e))return O_(e)}function ap(e,t){return BG(e)||$G(e,t)||yM(e,t)||FG()}function FG(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yM(e,t){if(e){if(typeof e=="string")return O_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return O_(e,t)}}function O_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $G(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,a=!1,o=void 0;try{for(var s=e[Symbol.iterator](),l;!(n=(l=s.next()).done)&&(r.push(l.value),!(t&&r.length===t));n=!0);}catch(c){a=!0,o=c}finally{try{!n&&s.return!=null&&s.return()}finally{if(a)throw o}}return r}}function BG(e){if(Array.isArray(e))return e}function xM(e){var t=ap(e,2),r=t[0],n=t[1],a=r,o=n;return r>n&&(a=n,o=r),[a,o]}function bM(e,t,r){if(e.lte(0))return new Pn(0);var n=dy.getDigitCount(e.toNumber()),a=new Pn(10).pow(n),o=e.div(a),s=n!==1?.05:.1,l=new Pn(Math.ceil(o.div(s).toNumber())).add(r).mul(s),c=l.mul(a);return t?c:new Pn(Math.ceil(c))}function UG(e,t,r){var n=1,a=new Pn(e);if(!a.isint()&&r){var o=Math.abs(e);o<1?(n=new Pn(10).pow(dy.getDigitCount(e)-1),a=new Pn(Math.floor(a.div(n).toNumber())).mul(n)):o>1&&(a=new Pn(Math.floor(e)))}else e===0?a=new Pn(Math.floor((t-1)/2)):r||(a=new Pn(Math.floor(e)));var s=Math.floor((t-1)/2),l=TG(kG(function(c){return a.add(new Pn(c-s).mul(n)).toNumber()}),C_);return l(0,t)}function _M(e,t,r,n){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new Pn(0),tickMin:new Pn(0),tickMax:new Pn(0)};var o=bM(new Pn(t).sub(e).div(r-1),n,a),s;e<=0&&t>=0?s=new Pn(0):(s=new Pn(e).add(t).div(2),s=s.sub(new Pn(s).mod(o)));var l=Math.ceil(s.sub(e).div(o).toNumber()),c=Math.ceil(new Pn(t).sub(s).div(o).toNumber()),u=l+c+1;return u>r?_M(e,t,r,n,a+1):(u<r&&(c=t>0?c+(r-u):c,l=t>0?l:l+(r-u)),{step:o,tickMin:s.sub(new Pn(l).mul(o)),tickMax:s.add(new Pn(c).mul(o))})}function zG(e){var t=ap(e,2),r=t[0],n=t[1],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=Math.max(a,2),l=xM([r,n]),c=ap(l,2),u=c[0],d=c[1];if(u===-1/0||d===1/0){var f=d===1/0?[u].concat(P_(C_(0,a-1).map(function(){return 1/0}))):[].concat(P_(C_(0,a-1).map(function(){return-1/0})),[d]);return r>n?A_(f):f}if(u===d)return UG(u,a,o);var h=_M(u,d,s,o),p=h.step,g=h.tickMin,m=h.tickMax,x=dy.rangeStep(g,m.add(new Pn(.1).mul(p)),p);return r>n?A_(x):x}function WG(e,t){var r=ap(e,2),n=r[0],a=r[1],o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=xM([n,a]),l=ap(s,2),c=l[0],u=l[1];if(c===-1/0||u===1/0)return[n,a];if(c===u)return[c];var d=Math.max(t,2),f=bM(new Pn(u).sub(c).div(d-1),o,0),h=[].concat(P_(dy.rangeStep(new Pn(c),new Pn(u).sub(new Pn(.99).mul(f)),f)),[u]);return n>a?A_(h):h}var HG=vM(zG),VG=vM(WG),GG="Invariant failed";function Xc(e,t){throw new Error(GG)}var YG=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function ld(e){"@babel/helpers - typeof";return ld=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ld(e)}function Fg(){return Fg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Fg.apply(this,arguments)}function KG(e,t){return ZG(e)||JG(e,t)||XG(e,t)||QG()}function QG(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XG(e,t){if(e){if(typeof e=="string")return Dk(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Dk(e,t)}}function Dk(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function JG(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function ZG(e){if(Array.isArray(e))return e}function eY(e,t){if(e==null)return{};var r=tY(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function tY(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function rY(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nY(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,SM(n.key),n)}}function aY(e,t,r){return t&&nY(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function iY(e,t,r){return t=$g(t),oY(e,wM()?Reflect.construct(t,r||[],$g(e).constructor):t.apply(e,r))}function oY(e,t){if(t&&(ld(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return sY(e)}function sY(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wM(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(wM=function(){return!!e})()}function $g(e){return $g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},$g(e)}function lY(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&k_(e,t)}function k_(e,t){return k_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},k_(e,t)}function jM(e,t,r){return t=SM(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SM(e){var t=cY(e,"string");return ld(t)=="symbol"?t:t+""}function cY(e,t){if(ld(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ld(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var zp=function(e){function t(){return rY(this,t),iY(this,t,arguments)}return lY(t,e),aY(t,[{key:"render",value:function(){var n=this.props,a=n.offset,o=n.layout,s=n.width,l=n.dataKey,c=n.data,u=n.dataPointFormatter,d=n.xAxis,f=n.yAxis,h=eY(n,YG),p=_r(h,!1);this.props.direction==="x"&&d.type!=="number"&&Xc();var g=c.map(function(m){var x=u(m,l),b=x.x,_=x.y,w=x.value,A=x.errorVal;if(!A)return null;var O=[],T,E;if(Array.isArray(A)){var S=KG(A,2);T=S[0],E=S[1]}else T=E=A;if(o==="vertical"){var I=d.scale,z=_+a,k=z+s,M=z-s,R=I(w-T),F=I(w+E);O.push({x1:F,y1:k,x2:F,y2:M}),O.push({x1:R,y1:z,x2:F,y2:z}),O.push({x1:R,y1:k,x2:R,y2:M})}else if(o==="horizontal"){var W=f.scale,K=b+a,Z=K-s,D=K+s,P=W(w-T),$=W(w+E);O.push({x1:Z,y1:$,x2:D,y2:$}),O.push({x1:K,y1:P,x2:K,y2:$}),O.push({x1:Z,y1:P,x2:D,y2:P})}return Ce.createElement(pn,Fg({className:"recharts-errorBar",key:"bar-".concat(O.map(function(Q){return"".concat(Q.x1,"-").concat(Q.x2,"-").concat(Q.y1,"-").concat(Q.y2)}))},p),O.map(function(Q){return Ce.createElement("line",Fg({},Q,{key:"line-".concat(Q.x1,"-").concat(Q.x2,"-").concat(Q.y1,"-").concat(Q.y2)}))}))});return Ce.createElement(pn,{className:"recharts-errorBars"},g)}}])}(Ce.Component);jM(zp,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});jM(zp,"displayName","ErrorBar");function ip(e){"@babel/helpers - typeof";return ip=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ip(e)}function Mk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function wc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Mk(Object(r),!0).forEach(function(n){uY(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function uY(e,t,r){return t=dY(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dY(e){var t=fY(e,"string");return ip(t)=="symbol"?t:t+""}function fY(e,t){if(ip(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ip(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var CM=function(t){var r=t.children,n=t.formattedGraphicalItems,a=t.legendWidth,o=t.legendContent,s=yo(r,Ss);if(!s)return null;var l=Ss.defaultProps,c=l!==void 0?wc(wc({},l),s.props):{},u;return s.props&&s.props.payload?u=s.props&&s.props.payload:o==="children"?u=(n||[]).reduce(function(d,f){var h=f.item,p=f.props,g=p.sectors||p.data||[];return d.concat(g.map(function(m){return{type:s.props.iconType||h.props.legendType,value:m.name,color:m.fill,payload:m}}))},[]):u=(n||[]).map(function(d){var f=d.item,h=f.type.defaultProps,p=h!==void 0?wc(wc({},h),f.props):{},g=p.dataKey,m=p.name,x=p.legendType,b=p.hide;return{inactive:b,dataKey:g,type:c.iconType||x||"square",color:tS(f),value:m||g,payload:p}}),wc(wc(wc({},c),Ss.getWithHeight(s,a)),{},{payload:u,item:s})};function op(e){"@babel/helpers - typeof";return op=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},op(e)}function Lk(e){return gY(e)||mY(e)||pY(e)||hY()}function hY(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pY(e,t){if(e){if(typeof e=="string")return T_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T_(e,t)}}function mY(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function gY(e){if(Array.isArray(e))return T_(e)}function T_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Rk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ma(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Rk(Object(r),!0).forEach(function(n){Gu(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Gu(e,t,r){return t=vY(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vY(e){var t=yY(e,"string");return op(t)=="symbol"?t:t+""}function yY(e,t){if(op(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(op(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ga(e,t,r){return Ur(e)||Ur(t)?r:Ya(t)?Co(e,t,r):Rr(t)?t(e):r}function Eh(e,t,r,n){var a=gG(e,function(l){return Ga(l,t)});if(r==="number"){var o=a.filter(function(l){return Mt(l)||parseFloat(l)});return o.length?[cy(o),ly(o)]:[1/0,-1/0]}var s=n?a.filter(function(l){return!Ur(l)}):a;return s.map(function(l){return Ya(l)||l instanceof Date?l:""})}var xY=function(t){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,s=-1,l=(r=n?.length)!==null&&r!==void 0?r:0;if(l<=1)return 0;if(o&&o.axisType==="angleAxis"&&Math.abs(Math.abs(o.range[1]-o.range[0])-360)<=1e-6)for(var c=o.range,u=0;u<l;u++){var d=u>0?a[u-1].coordinate:a[l-1].coordinate,f=a[u].coordinate,h=u>=l-1?a[0].coordinate:a[u+1].coordinate,p=void 0;if(Li(f-d)!==Li(h-f)){var g=[];if(Li(h-f)===Li(c[1]-c[0])){p=h;var m=f+c[1]-c[0];g[0]=Math.min(m,(m+d)/2),g[1]=Math.max(m,(m+d)/2)}else{p=d;var x=h+c[1]-c[0];g[0]=Math.min(f,(x+f)/2),g[1]=Math.max(f,(x+f)/2)}var b=[Math.min(f,(p+f)/2),Math.max(f,(p+f)/2)];if(t>b[0]&&t<=b[1]||t>=g[0]&&t<=g[1]){s=a[u].index;break}}else{var _=Math.min(d,h),w=Math.max(d,h);if(t>(_+f)/2&&t<=(w+f)/2){s=a[u].index;break}}}else for(var A=0;A<l;A++)if(A===0&&t<=(n[A].coordinate+n[A+1].coordinate)/2||A>0&&A<l-1&&t>(n[A].coordinate+n[A-1].coordinate)/2&&t<=(n[A].coordinate+n[A+1].coordinate)/2||A===l-1&&t>(n[A].coordinate+n[A-1].coordinate)/2){s=n[A].index;break}return s},tS=function(t){var r,n=t,a=n.type.displayName,o=(r=t.type)!==null&&r!==void 0&&r.defaultProps?ma(ma({},t.type.defaultProps),t.props):t.props,s=o.stroke,l=o.fill,c;switch(a){case"Line":c=s;break;case"Area":case"Radar":c=s&&s!=="none"?s:l;break;default:c=l;break}return c},bY=function(t){var r=t.barSize,n=t.totalSize,a=t.stackGroups,o=a===void 0?{}:a;if(!o)return{};for(var s={},l=Object.keys(o),c=0,u=l.length;c<u;c++)for(var d=o[l[c]].stackGroups,f=Object.keys(d),h=0,p=f.length;h<p;h++){var g=d[f[h]],m=g.items,x=g.cateAxisId,b=m.filter(function(E){return ul(E.type).indexOf("Bar")>=0});if(b&&b.length){var _=b[0].type.defaultProps,w=_!==void 0?ma(ma({},_),b[0].props):b[0].props,A=w.barSize,O=w[x];s[O]||(s[O]=[]);var T=Ur(A)?r:A;s[O].push({item:b[0],stackList:b.slice(1),barSize:Ur(T)?void 0:Ri(T,n,0)})}}return s},_Y=function(t){var r=t.barGap,n=t.barCategoryGap,a=t.bandSize,o=t.sizeList,s=o===void 0?[]:o,l=t.maxBarSize,c=s.length;if(c<1)return null;var u=Ri(r,a,0,!0),d,f=[];if(s[0].barSize===+s[0].barSize){var h=!1,p=a/c,g=s.reduce(function(A,O){return A+O.barSize||0},0);g+=(c-1)*u,g>=a&&(g-=(c-1)*u,u=0),g>=a&&p>0&&(h=!0,p*=.9,g=c*p);var m=(a-g)/2>>0,x={offset:m-u,size:0};d=s.reduce(function(A,O){var T={item:O.item,position:{offset:x.offset+x.size+u,size:h?p:O.barSize}},E=[].concat(Lk(A),[T]);return x=E[E.length-1].position,O.stackList&&O.stackList.length&&O.stackList.forEach(function(S){E.push({item:S,position:x})}),E},f)}else{var b=Ri(n,a,0,!0);a-2*b-(c-1)*u<=0&&(u=0);var _=(a-2*b-(c-1)*u)/c;_>1&&(_>>=0);var w=l===+l?Math.min(_,l):_;d=s.reduce(function(A,O,T){var E=[].concat(Lk(A),[{item:O.item,position:{offset:b+(_+u)*T+(_-w)/2,size:w}}]);return O.stackList&&O.stackList.length&&O.stackList.forEach(function(S){E.push({item:S,position:E[E.length-1].position})}),E},f)}return d},wY=function(t,r,n,a){var o=n.children,s=n.width,l=n.margin,c=s-(l.left||0)-(l.right||0),u=CM({children:o,legendWidth:c});if(u){var d=a||{},f=d.width,h=d.height,p=u.align,g=u.verticalAlign,m=u.layout;if((m==="vertical"||m==="horizontal"&&g==="middle")&&p!=="center"&&Mt(t[p]))return ma(ma({},t),{},Gu({},p,t[p]+(f||0)));if((m==="horizontal"||m==="vertical"&&p==="center")&&g!=="middle"&&Mt(t[g]))return ma(ma({},t),{},Gu({},g,t[g]+(h||0)))}return t},jY=function(t,r,n){return Ur(r)?!0:t==="horizontal"?r==="yAxis":t==="vertical"||n==="x"?r==="xAxis":n==="y"?r==="yAxis":!0},AM=function(t,r,n,a,o){var s=r.props.children,l=Ao(s,zp).filter(function(u){return jY(a,o,u.props.direction)});if(l&&l.length){var c=l.map(function(u){return u.props.dataKey});return t.reduce(function(u,d){var f=Ga(d,n);if(Ur(f))return u;var h=Array.isArray(f)?[cy(f),ly(f)]:[f,f],p=c.reduce(function(g,m){var x=Ga(d,m,0),b=h[0]-Math.abs(Array.isArray(x)?x[0]:x),_=h[1]+Math.abs(Array.isArray(x)?x[1]:x);return[Math.min(b,g[0]),Math.max(_,g[1])]},[1/0,-1/0]);return[Math.min(p[0],u[0]),Math.max(p[1],u[1])]},[1/0,-1/0])}return null},SY=function(t,r,n,a,o){var s=r.map(function(l){return AM(t,l,n,o,a)}).filter(function(l){return!Ur(l)});return s&&s.length?s.reduce(function(l,c){return[Math.min(l[0],c[0]),Math.max(l[1],c[1])]},[1/0,-1/0]):null},PM=function(t,r,n,a,o){var s=r.map(function(c){var u=c.props.dataKey;return n==="number"&&u&&AM(t,c,u,a)||Eh(t,u,n,o)});if(n==="number")return s.reduce(function(c,u){return[Math.min(c[0],u[0]),Math.max(c[1],u[1])]},[1/0,-1/0]);var l={};return s.reduce(function(c,u){for(var d=0,f=u.length;d<f;d++)l[u[d]]||(l[u[d]]=!0,c.push(u[d]));return c},[])},OM=function(t,r){return t==="horizontal"&&r==="xAxis"||t==="vertical"&&r==="yAxis"||t==="centric"&&r==="angleAxis"||t==="radial"&&r==="radiusAxis"},kM=function(t,r,n,a){if(a)return t.map(function(c){return c.coordinate});var o,s,l=t.map(function(c){return c.coordinate===r&&(o=!0),c.coordinate===n&&(s=!0),c.coordinate});return o||l.push(r),s||l.push(n),l},sl=function(t,r,n){if(!t)return null;var a=t.scale,o=t.duplicateDomain,s=t.type,l=t.range,c=t.realScaleType==="scaleBand"?a.bandwidth()/2:2,u=(r||n)&&s==="category"&&a.bandwidth?a.bandwidth()/c:0;if(u=t.axisType==="angleAxis"&&l?.length>=2?Li(l[0]-l[1])*2*u:u,r&&(t.ticks||t.niceTicks)){var d=(t.ticks||t.niceTicks).map(function(f){var h=o?o.indexOf(f):f;return{coordinate:a(h)+u,value:f,offset:u}});return d.filter(function(f){return!Lp(f.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(f,h){return{coordinate:a(f)+u,value:f,index:h,offset:u}}):a.ticks&&!n?a.ticks(t.tickCount).map(function(f){return{coordinate:a(f)+u,value:f,offset:u}}):a.domain().map(function(f,h){return{coordinate:a(f)+u,value:o?o[f]:f,index:h,offset:u}})},L1=new WeakMap,Sm=function(t,r){if(typeof r!="function")return t;L1.has(t)||L1.set(t,new WeakMap);var n=L1.get(t);if(n.has(r))return n.get(r);var a=function(){t.apply(void 0,arguments),r.apply(void 0,arguments)};return n.set(r,a),a},TM=function(t,r,n){var a=t.scale,o=t.type,s=t.layout,l=t.axisType;if(a==="auto")return s==="radial"&&l==="radiusAxis"?{scale:Jh(),realScaleType:"band"}:s==="radial"&&l==="angleAxis"?{scale:Dg(),realScaleType:"linear"}:o==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?{scale:Th(),realScaleType:"point"}:o==="category"?{scale:Jh(),realScaleType:"band"}:{scale:Dg(),realScaleType:"linear"};if(Gc(a)){var c="scale".concat(Gv(a));return{scale:(wk[c]||Th)(),realScaleType:wk[c]?c:"point"}}return Rr(a)?{scale:a}:{scale:Th(),realScaleType:"point"}},qk=1e-4,EM=function(t){var r=t.domain();if(!(!r||r.length<=2)){var n=r.length,a=t.range(),o=Math.min(a[0],a[1])-qk,s=Math.max(a[0],a[1])+qk,l=t(r[0]),c=t(r[n-1]);(l<o||l>s||c<o||c>s)&&t.domain([r[0],r[n-1]])}},CY=function(t,r){if(!t)return null;for(var n=0,a=t.length;n<a;n++)if(t[n].item===r)return t[n].position;return null},AY=function(t,r){if(!r||r.length!==2||!Mt(r[0])||!Mt(r[1]))return t;var n=Math.min(r[0],r[1]),a=Math.max(r[0],r[1]),o=[t[0],t[1]];return(!Mt(t[0])||t[0]<n)&&(o[0]=n),(!Mt(t[1])||t[1]>a)&&(o[1]=a),o[0]>a&&(o[0]=a),o[1]<n&&(o[1]=n),o},PY=function(t){var r=t.length;if(!(r<=0))for(var n=0,a=t[0].length;n<a;++n)for(var o=0,s=0,l=0;l<r;++l){var c=Lp(t[l][n][1])?t[l][n][0]:t[l][n][1];c>=0?(t[l][n][0]=o,t[l][n][1]=o+c,o=t[l][n][1]):(t[l][n][0]=s,t[l][n][1]=s+c,s=t[l][n][1])}},OY=function(t){var r=t.length;if(!(r<=0))for(var n=0,a=t[0].length;n<a;++n)for(var o=0,s=0;s<r;++s){var l=Lp(t[s][n][1])?t[s][n][0]:t[s][n][1];l>=0?(t[s][n][0]=o,t[s][n][1]=o+l,o=t[s][n][1]):(t[s][n][0]=0,t[s][n][1]=0)}},kY={sign:PY,expand:gU,none:ed,silhouette:vU,wiggle:yU,positive:OY},TY=function(t,r,n){var a=r.map(function(l){return l.props.dataKey}),o=kY[n],s=mU().keys(a).value(function(l,c){return+Ga(l,c,0)}).order(o_).offset(o);return s(t)},EY=function(t,r,n,a,o,s){if(!t)return null;var l=s?r.reverse():r,c={},u=l.reduce(function(f,h){var p,g=(p=h.type)!==null&&p!==void 0&&p.defaultProps?ma(ma({},h.type.defaultProps),h.props):h.props,m=g.stackId,x=g.hide;if(x)return f;var b=g[n],_=f[b]||{hasStack:!1,stackGroups:{}};if(Ya(m)){var w=_.stackGroups[m]||{numericAxisId:n,cateAxisId:a,items:[]};w.items.push(h),_.hasStack=!0,_.stackGroups[m]=w}else _.stackGroups[qd("_stackId_")]={numericAxisId:n,cateAxisId:a,items:[h]};return ma(ma({},f),{},Gu({},b,_))},c),d={};return Object.keys(u).reduce(function(f,h){var p=u[h];if(p.hasStack){var g={};p.stackGroups=Object.keys(p.stackGroups).reduce(function(m,x){var b=p.stackGroups[x];return ma(ma({},m),{},Gu({},x,{numericAxisId:n,cateAxisId:a,items:b.items,stackedData:TY(t,b.items,o)}))},g)}return ma(ma({},f),{},Gu({},h,p))},d)},IM=function(t,r){var n=r.realScaleType,a=r.type,o=r.tickCount,s=r.originalDomain,l=r.allowDecimals,c=n||r.scale;if(c!=="auto"&&c!=="linear")return null;if(o&&a==="number"&&s&&(s[0]==="auto"||s[1]==="auto")){var u=t.domain();if(!u.length)return null;var d=HG(u,o,l);return t.domain([cy(d),ly(d)]),{niceTicks:d}}if(o&&a==="number"){var f=t.domain(),h=VG(f,o,l);return{niceTicks:h}}return null};function Fk(e){var t=e.axis,r=e.ticks,n=e.bandSize,a=e.entry,o=e.index,s=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!Ur(a[t.dataKey])){var l=gg(r,"value",a[t.dataKey]);if(l)return l.coordinate+n/2}return r[o]?r[o].coordinate+n/2:null}var c=Ga(a,Ur(s)?t.dataKey:s);return Ur(c)?null:t.scale(c)}var $k=function(t){var r=t.axis,n=t.ticks,a=t.offset,o=t.bandSize,s=t.entry,l=t.index;if(r.type==="category")return n[l]?n[l].coordinate+a:null;var c=Ga(s,r.dataKey,r.domain[l]);return Ur(c)?null:r.scale(c)-o/2+a},IY=function(t){var r=t.numericAxis,n=r.scale.domain();if(r.type==="number"){var a=Math.min(n[0],n[1]),o=Math.max(n[0],n[1]);return a<=0&&o>=0?0:o<0?o:a}return n[0]},NY=function(t,r){var n,a=(n=t.type)!==null&&n!==void 0&&n.defaultProps?ma(ma({},t.type.defaultProps),t.props):t.props,o=a.stackId;if(Ya(o)){var s=r[o];if(s){var l=s.items.indexOf(t);return l>=0?s.stackedData[l]:null}}return null},DY=function(t){return t.reduce(function(r,n){return[cy(n.concat([r[0]]).filter(Mt)),ly(n.concat([r[1]]).filter(Mt))]},[1/0,-1/0])},NM=function(t,r,n){return Object.keys(t).reduce(function(a,o){var s=t[o],l=s.stackedData,c=l.reduce(function(u,d){var f=DY(d.slice(r,n+1));return[Math.min(u[0],f[0]),Math.max(u[1],f[1])]},[1/0,-1/0]);return[Math.min(c[0],a[0]),Math.max(c[1],a[1])]},[1/0,-1/0]).map(function(a){return a===1/0||a===-1/0?0:a})},Bk=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,Uk=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,E_=function(t,r,n){if(Rr(t))return t(r,n);if(!Array.isArray(t))return r;var a=[];if(Mt(t[0]))a[0]=n?t[0]:Math.min(t[0],r[0]);else if(Bk.test(t[0])){var o=+Bk.exec(t[0])[1];a[0]=r[0]-o}else Rr(t[0])?a[0]=t[0](r[0]):a[0]=r[0];if(Mt(t[1]))a[1]=n?t[1]:Math.max(t[1],r[1]);else if(Uk.test(t[1])){var s=+Uk.exec(t[1])[1];a[1]=r[1]+s}else Rr(t[1])?a[1]=t[1](r[1]):a[1]=r[1];return a},Bg=function(t,r,n){if(t&&t.scale&&t.scale.bandwidth){var a=t.scale.bandwidth();if(!n||a>0)return a}if(t&&r&&r.length>=2){for(var o=kj(r,function(f){return f.coordinate}),s=1/0,l=1,c=o.length;l<c;l++){var u=o[l],d=o[l-1];s=Math.min((u.coordinate||0)-(d.coordinate||0),s)}return s===1/0?0:s}return n?void 0:0},zk=function(t,r,n){return!t||!t.length||Up(t,Co(n,"type.defaultProps.domain"))?r:t},DM=function(t,r){var n=t.type.defaultProps?ma(ma({},t.type.defaultProps),t.props):t.props,a=n.dataKey,o=n.name,s=n.unit,l=n.formatter,c=n.tooltipType,u=n.chartType,d=n.hide;return ma(ma({},_r(t,!1)),{},{dataKey:a,unit:s,formatter:l,name:o||a,color:tS(t),value:Ga(r,a),type:c,payload:r,chartType:u,hide:d})};function sp(e){"@babel/helpers - typeof";return sp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sp(e)}function Wk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function nl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Wk(Object(r),!0).forEach(function(n){MM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function MM(e,t,r){return t=MY(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function MY(e){var t=LY(e,"string");return sp(t)=="symbol"?t:t+""}function LY(e,t){if(sp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(sp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function RY(e,t){return BY(e)||$Y(e,t)||FY(e,t)||qY()}function qY(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FY(e,t){if(e){if(typeof e=="string")return Hk(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hk(e,t)}}function Hk(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $Y(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function BY(e){if(Array.isArray(e))return e}var Ug=Math.PI/180,UY=function(t){return t*180/Math.PI},Bn=function(t,r,n,a){return{x:t+Math.cos(-Ug*a)*n,y:r+Math.sin(-Ug*a)*n}},LM=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(n.left||0)-(n.right||0)),Math.abs(r-(n.top||0)-(n.bottom||0)))/2},zY=function(t,r,n,a,o){var s=t.width,l=t.height,c=t.startAngle,u=t.endAngle,d=Ri(t.cx,s,s/2),f=Ri(t.cy,l,l/2),h=LM(s,l,n),p=Ri(t.innerRadius,h,0),g=Ri(t.outerRadius,h,h*.8),m=Object.keys(r);return m.reduce(function(x,b){var _=r[b],w=_.domain,A=_.reversed,O;if(Ur(_.range))a==="angleAxis"?O=[c,u]:a==="radiusAxis"&&(O=[p,g]),A&&(O=[O[1],O[0]]);else{O=_.range;var T=O,E=RY(T,2);c=E[0],u=E[1]}var S=TM(_,o),I=S.realScaleType,z=S.scale;z.domain(w).range(O),EM(z);var k=IM(z,nl(nl({},_),{},{realScaleType:I})),M=nl(nl(nl({},_),k),{},{range:O,radius:g,realScaleType:I,scale:z,cx:d,cy:f,innerRadius:p,outerRadius:g,startAngle:c,endAngle:u});return nl(nl({},x),{},MM({},b,M))},{})},WY=function(t,r){var n=t.x,a=t.y,o=r.x,s=r.y;return Math.sqrt(Math.pow(n-o,2)+Math.pow(a-s,2))},HY=function(t,r){var n=t.x,a=t.y,o=r.cx,s=r.cy,l=WY({x:n,y:a},{x:o,y:s});if(l<=0)return{radius:l};var c=(n-o)/l,u=Math.acos(c);return a>s&&(u=2*Math.PI-u),{radius:l,angle:UY(u),angleInRadian:u}},VY=function(t){var r=t.startAngle,n=t.endAngle,a=Math.floor(r/360),o=Math.floor(n/360),s=Math.min(a,o);return{startAngle:r-s*360,endAngle:n-s*360}},GY=function(t,r){var n=r.startAngle,a=r.endAngle,o=Math.floor(n/360),s=Math.floor(a/360),l=Math.min(o,s);return t+l*360},Vk=function(t,r){var n=t.x,a=t.y,o=HY({x:n,y:a},r),s=o.radius,l=o.angle,c=r.innerRadius,u=r.outerRadius;if(s<c||s>u)return!1;if(s===0)return!0;var d=VY(r),f=d.startAngle,h=d.endAngle,p=l,g;if(f<=h){for(;p>h;)p-=360;for(;p<f;)p+=360;g=p>=f&&p<=h}else{for(;p>f;)p-=360;for(;p<h;)p+=360;g=p>=h&&p<=f}return g?nl(nl({},r),{},{radius:s,angle:GY(p,r)}):null},RM=function(t){return!y.isValidElement(t)&&!Rr(t)&&typeof t!="boolean"?t.className:""};function lp(e){"@babel/helpers - typeof";return lp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lp(e)}var YY=["offset"];function KY(e){return ZY(e)||JY(e)||XY(e)||QY()}function QY(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XY(e,t){if(e){if(typeof e=="string")return I_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I_(e,t)}}function JY(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ZY(e){if(Array.isArray(e))return I_(e)}function I_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function eK(e,t){if(e==null)return{};var r=tK(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function tK(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Gk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ha(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Gk(Object(r),!0).forEach(function(n){rK(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rK(e,t,r){return t=nK(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nK(e){var t=aK(e,"string");return lp(t)=="symbol"?t:t+""}function aK(e,t){if(lp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(lp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function cp(){return cp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},cp.apply(this,arguments)}var iK=function(t){var r=t.value,n=t.formatter,a=Ur(t.children)?r:t.children;return Rr(n)?n(a):a},oK=function(t,r){var n=Li(r-t),a=Math.min(Math.abs(r-t),360);return n*a},sK=function(t,r,n){var a=t.position,o=t.viewBox,s=t.offset,l=t.className,c=o,u=c.cx,d=c.cy,f=c.innerRadius,h=c.outerRadius,p=c.startAngle,g=c.endAngle,m=c.clockWise,x=(f+h)/2,b=oK(p,g),_=b>=0?1:-1,w,A;a==="insideStart"?(w=p+_*s,A=m):a==="insideEnd"?(w=g-_*s,A=!m):a==="end"&&(w=g+_*s,A=m),A=b<=0?A:!A;var O=Bn(u,d,x,w),T=Bn(u,d,x,w+(A?1:-1)*359),E="M".concat(O.x,",").concat(O.y,`
    A`).concat(x,",").concat(x,",0,1,").concat(A?0:1,`,
    `).concat(T.x,",").concat(T.y),S=Ur(t.id)?qd("recharts-radial-line-"):t.id;return Ce.createElement("text",cp({},n,{dominantBaseline:"central",className:Nr("recharts-radial-bar-label",l)}),Ce.createElement("defs",null,Ce.createElement("path",{id:S,d:E})),Ce.createElement("textPath",{xlinkHref:"#".concat(S)},r))},lK=function(t){var r=t.viewBox,n=t.offset,a=t.position,o=r,s=o.cx,l=o.cy,c=o.innerRadius,u=o.outerRadius,d=o.startAngle,f=o.endAngle,h=(d+f)/2;if(a==="outside"){var p=Bn(s,l,u+n,h),g=p.x,m=p.y;return{x:g,y:m,textAnchor:g>=s?"start":"end",verticalAnchor:"middle"}}if(a==="center")return{x:s,y:l,textAnchor:"middle",verticalAnchor:"middle"};if(a==="centerTop")return{x:s,y:l,textAnchor:"middle",verticalAnchor:"start"};if(a==="centerBottom")return{x:s,y:l,textAnchor:"middle",verticalAnchor:"end"};var x=(c+u)/2,b=Bn(s,l,x,h),_=b.x,w=b.y;return{x:_,y:w,textAnchor:"middle",verticalAnchor:"middle"}},cK=function(t){var r=t.viewBox,n=t.parentViewBox,a=t.offset,o=t.position,s=r,l=s.x,c=s.y,u=s.width,d=s.height,f=d>=0?1:-1,h=f*a,p=f>0?"end":"start",g=f>0?"start":"end",m=u>=0?1:-1,x=m*a,b=m>0?"end":"start",_=m>0?"start":"end";if(o==="top"){var w={x:l+u/2,y:c-f*a,textAnchor:"middle",verticalAnchor:p};return Ha(Ha({},w),n?{height:Math.max(c-n.y,0),width:u}:{})}if(o==="bottom"){var A={x:l+u/2,y:c+d+h,textAnchor:"middle",verticalAnchor:g};return Ha(Ha({},A),n?{height:Math.max(n.y+n.height-(c+d),0),width:u}:{})}if(o==="left"){var O={x:l-x,y:c+d/2,textAnchor:b,verticalAnchor:"middle"};return Ha(Ha({},O),n?{width:Math.max(O.x-n.x,0),height:d}:{})}if(o==="right"){var T={x:l+u+x,y:c+d/2,textAnchor:_,verticalAnchor:"middle"};return Ha(Ha({},T),n?{width:Math.max(n.x+n.width-T.x,0),height:d}:{})}var E=n?{width:u,height:d}:{};return o==="insideLeft"?Ha({x:l+x,y:c+d/2,textAnchor:_,verticalAnchor:"middle"},E):o==="insideRight"?Ha({x:l+u-x,y:c+d/2,textAnchor:b,verticalAnchor:"middle"},E):o==="insideTop"?Ha({x:l+u/2,y:c+h,textAnchor:"middle",verticalAnchor:g},E):o==="insideBottom"?Ha({x:l+u/2,y:c+d-h,textAnchor:"middle",verticalAnchor:p},E):o==="insideTopLeft"?Ha({x:l+x,y:c+h,textAnchor:_,verticalAnchor:g},E):o==="insideTopRight"?Ha({x:l+u-x,y:c+h,textAnchor:b,verticalAnchor:g},E):o==="insideBottomLeft"?Ha({x:l+x,y:c+d-h,textAnchor:_,verticalAnchor:p},E):o==="insideBottomRight"?Ha({x:l+u-x,y:c+d-h,textAnchor:b,verticalAnchor:p},E):Rd(o)&&(Mt(o.x)||Mc(o.x))&&(Mt(o.y)||Mc(o.y))?Ha({x:l+Ri(o.x,u),y:c+Ri(o.y,d),textAnchor:"end",verticalAnchor:"end"},E):Ha({x:l+u/2,y:c+d/2,textAnchor:"middle",verticalAnchor:"middle"},E)},uK=function(t){return"cx"in t&&Mt(t.cx)};function ti(e){var t=e.offset,r=t===void 0?5:t,n=eK(e,YY),a=Ha({offset:r},n),o=a.viewBox,s=a.position,l=a.value,c=a.children,u=a.content,d=a.className,f=d===void 0?"":d,h=a.textBreakAll;if(!o||Ur(l)&&Ur(c)&&!y.isValidElement(u)&&!Rr(u))return null;if(y.isValidElement(u))return y.cloneElement(u,a);var p;if(Rr(u)){if(p=y.createElement(u,a),y.isValidElement(p))return p}else p=iK(a);var g=uK(o),m=_r(a,!0);if(g&&(s==="insideStart"||s==="insideEnd"||s==="end"))return sK(a,p,m);var x=g?lK(a):cK(a);return Ce.createElement(Kc,cp({className:Nr("recharts-label",f)},m,x,{breakAll:h}),p)}ti.displayName="Label";var qM=function(t){var r=t.cx,n=t.cy,a=t.angle,o=t.startAngle,s=t.endAngle,l=t.r,c=t.radius,u=t.innerRadius,d=t.outerRadius,f=t.x,h=t.y,p=t.top,g=t.left,m=t.width,x=t.height,b=t.clockWise,_=t.labelViewBox;if(_)return _;if(Mt(m)&&Mt(x)){if(Mt(f)&&Mt(h))return{x:f,y:h,width:m,height:x};if(Mt(p)&&Mt(g))return{x:p,y:g,width:m,height:x}}return Mt(f)&&Mt(h)?{x:f,y:h,width:0,height:0}:Mt(r)&&Mt(n)?{cx:r,cy:n,startAngle:o||a||0,endAngle:s||a||0,innerRadius:u||0,outerRadius:d||c||l||0,clockWise:b}:t.viewBox?t.viewBox:{}},dK=function(t,r){return t?t===!0?Ce.createElement(ti,{key:"label-implicit",viewBox:r}):Ya(t)?Ce.createElement(ti,{key:"label-implicit",viewBox:r,value:t}):y.isValidElement(t)?t.type===ti?y.cloneElement(t,{key:"label-implicit",viewBox:r}):Ce.createElement(ti,{key:"label-implicit",content:t,viewBox:r}):Rr(t)?Ce.createElement(ti,{key:"label-implicit",content:t,viewBox:r}):Rd(t)?Ce.createElement(ti,cp({viewBox:r},t,{key:"label-implicit"})):null:null},fK=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&n&&!t.label)return null;var a=t.children,o=qM(t),s=Ao(a,ti).map(function(c,u){return y.cloneElement(c,{viewBox:r||o,key:"label-".concat(u)})});if(!n)return s;var l=dK(t.label,r||o);return[l].concat(KY(s))};ti.parseViewBox=qM;ti.renderCallByParent=fK;var R1,Yk;function hK(){if(Yk)return R1;Yk=1;function e(t){var r=t==null?0:t.length;return r?t[r-1]:void 0}return R1=e,R1}var pK=hK();const mK=It(pK);function up(e){"@babel/helpers - typeof";return up=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},up(e)}var gK=["valueAccessor"],vK=["data","dataKey","clockWise","id","textBreakAll"];function yK(e){return wK(e)||_K(e)||bK(e)||xK()}function xK(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bK(e,t){if(e){if(typeof e=="string")return N_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return N_(e,t)}}function _K(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function wK(e){if(Array.isArray(e))return N_(e)}function N_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function zg(){return zg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},zg.apply(this,arguments)}function Kk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Qk(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Kk(Object(r),!0).forEach(function(n){jK(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jK(e,t,r){return t=SK(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SK(e){var t=CK(e,"string");return up(t)=="symbol"?t:t+""}function CK(e,t){if(up(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(up(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Xk(e,t){if(e==null)return{};var r=AK(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function AK(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var PK=function(t){return Array.isArray(t.value)?mK(t.value):t.value};function fl(e){var t=e.valueAccessor,r=t===void 0?PK:t,n=Xk(e,gK),a=n.data,o=n.dataKey,s=n.clockWise,l=n.id,c=n.textBreakAll,u=Xk(n,vK);return!a||!a.length?null:Ce.createElement(pn,{className:"recharts-label-list"},a.map(function(d,f){var h=Ur(o)?r(d,f):Ga(d&&d.payload,o),p=Ur(l)?{}:{id:"".concat(l,"-").concat(f)};return Ce.createElement(ti,zg({},_r(d,!0),u,p,{parentViewBox:d.parentViewBox,value:h,textBreakAll:c,viewBox:ti.parseViewBox(Ur(s)?d:Qk(Qk({},d),{},{clockWise:s})),key:"label-".concat(f),index:f}))}))}fl.displayName="LabelList";function OK(e,t){return e?e===!0?Ce.createElement(fl,{key:"labelList-implicit",data:t}):Ce.isValidElement(e)||Rr(e)?Ce.createElement(fl,{key:"labelList-implicit",data:t,content:e}):Rd(e)?Ce.createElement(fl,zg({data:t},e,{key:"labelList-implicit"})):null:null}function kK(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,a=Ao(n,fl).map(function(s,l){return y.cloneElement(s,{data:t,key:"labelList-".concat(l)})});if(!r)return a;var o=OK(e.label,t);return[o].concat(yK(a))}fl.renderCallByParent=kK;function dp(e){"@babel/helpers - typeof";return dp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dp(e)}function D_(){return D_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},D_.apply(this,arguments)}function Jk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Zk(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Jk(Object(r),!0).forEach(function(n){TK(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function TK(e,t,r){return t=EK(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function EK(e){var t=IK(e,"string");return dp(t)=="symbol"?t:t+""}function IK(e,t){if(dp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(dp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var NK=function(t,r){var n=Li(r-t),a=Math.min(Math.abs(r-t),359.999);return n*a},Cm=function(t){var r=t.cx,n=t.cy,a=t.radius,o=t.angle,s=t.sign,l=t.isExternal,c=t.cornerRadius,u=t.cornerIsExternal,d=c*(l?1:-1)+a,f=Math.asin(c/d)/Ug,h=u?o:o+s*f,p=Bn(r,n,d,h),g=Bn(r,n,a,h),m=u?o-s*f:o,x=Bn(r,n,d*Math.cos(f*Ug),m);return{center:p,circleTangency:g,lineTangency:x,theta:f}},FM=function(t){var r=t.cx,n=t.cy,a=t.innerRadius,o=t.outerRadius,s=t.startAngle,l=t.endAngle,c=NK(s,l),u=s+c,d=Bn(r,n,o,s),f=Bn(r,n,o,u),h="M ".concat(d.x,",").concat(d.y,`
    A `).concat(o,",").concat(o,`,0,
    `).concat(+(Math.abs(c)>180),",").concat(+(s>u),`,
    `).concat(f.x,",").concat(f.y,`
  `);if(a>0){var p=Bn(r,n,a,s),g=Bn(r,n,a,u);h+="L ".concat(g.x,",").concat(g.y,`
            A `).concat(a,",").concat(a,`,0,
            `).concat(+(Math.abs(c)>180),",").concat(+(s<=u),`,
            `).concat(p.x,",").concat(p.y," Z")}else h+="L ".concat(r,",").concat(n," Z");return h},DK=function(t){var r=t.cx,n=t.cy,a=t.innerRadius,o=t.outerRadius,s=t.cornerRadius,l=t.forceCornerRadius,c=t.cornerIsExternal,u=t.startAngle,d=t.endAngle,f=Li(d-u),h=Cm({cx:r,cy:n,radius:o,angle:u,sign:f,cornerRadius:s,cornerIsExternal:c}),p=h.circleTangency,g=h.lineTangency,m=h.theta,x=Cm({cx:r,cy:n,radius:o,angle:d,sign:-f,cornerRadius:s,cornerIsExternal:c}),b=x.circleTangency,_=x.lineTangency,w=x.theta,A=c?Math.abs(u-d):Math.abs(u-d)-m-w;if(A<0)return l?"M ".concat(g.x,",").concat(g.y,`
        a`).concat(s,",").concat(s,",0,0,1,").concat(s*2,`,0
        a`).concat(s,",").concat(s,",0,0,1,").concat(-s*2,`,0
      `):FM({cx:r,cy:n,innerRadius:a,outerRadius:o,startAngle:u,endAngle:d});var O="M ".concat(g.x,",").concat(g.y,`
    A`).concat(s,",").concat(s,",0,0,").concat(+(f<0),",").concat(p.x,",").concat(p.y,`
    A`).concat(o,",").concat(o,",0,").concat(+(A>180),",").concat(+(f<0),",").concat(b.x,",").concat(b.y,`
    A`).concat(s,",").concat(s,",0,0,").concat(+(f<0),",").concat(_.x,",").concat(_.y,`
  `);if(a>0){var T=Cm({cx:r,cy:n,radius:a,angle:u,sign:f,isExternal:!0,cornerRadius:s,cornerIsExternal:c}),E=T.circleTangency,S=T.lineTangency,I=T.theta,z=Cm({cx:r,cy:n,radius:a,angle:d,sign:-f,isExternal:!0,cornerRadius:s,cornerIsExternal:c}),k=z.circleTangency,M=z.lineTangency,R=z.theta,F=c?Math.abs(u-d):Math.abs(u-d)-I-R;if(F<0&&s===0)return"".concat(O,"L").concat(r,",").concat(n,"Z");O+="L".concat(M.x,",").concat(M.y,`
      A`).concat(s,",").concat(s,",0,0,").concat(+(f<0),",").concat(k.x,",").concat(k.y,`
      A`).concat(a,",").concat(a,",0,").concat(+(F>180),",").concat(+(f>0),",").concat(E.x,",").concat(E.y,`
      A`).concat(s,",").concat(s,",0,0,").concat(+(f<0),",").concat(S.x,",").concat(S.y,"Z")}else O+="L".concat(r,",").concat(n,"Z");return O},MK={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},$M=function(t){var r=Zk(Zk({},MK),t),n=r.cx,a=r.cy,o=r.innerRadius,s=r.outerRadius,l=r.cornerRadius,c=r.forceCornerRadius,u=r.cornerIsExternal,d=r.startAngle,f=r.endAngle,h=r.className;if(s<o||d===f)return null;var p=Nr("recharts-sector",h),g=s-o,m=Ri(l,g,0,!0),x;return m>0&&Math.abs(d-f)<360?x=DK({cx:n,cy:a,innerRadius:o,outerRadius:s,cornerRadius:Math.min(m,g/2),forceCornerRadius:c,cornerIsExternal:u,startAngle:d,endAngle:f}):x=FM({cx:n,cy:a,innerRadius:o,outerRadius:s,startAngle:d,endAngle:f}),Ce.createElement("path",D_({},_r(r,!0),{className:p,d:x,role:"img"}))};function fp(e){"@babel/helpers - typeof";return fp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fp(e)}function M_(){return M_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},M_.apply(this,arguments)}function e3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function t3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?e3(Object(r),!0).forEach(function(n){LK(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function LK(e,t,r){return t=RK(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function RK(e){var t=qK(e,"string");return fp(t)=="symbol"?t:t+""}function qK(e,t){if(fp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(fp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var r3={curveBasisClosed:aU,curveBasisOpen:iU,curveBasis:nU,curveBumpX:zB,curveBumpY:WB,curveLinearClosed:oU,curveLinear:Kv,curveMonotoneX:sU,curveMonotoneY:lU,curveNatural:cU,curveStep:uU,curveStepAfter:fU,curveStepBefore:dU},Am=function(t){return t.x===+t.x&&t.y===+t.y},mf=function(t){return t.x},gf=function(t){return t.y},FK=function(t,r){if(Rr(t))return t;var n="curve".concat(Gv(t));return(n==="curveMonotone"||n==="curveBump")&&r?r3["".concat(n).concat(r==="vertical"?"Y":"X")]:r3[n]||Kv},$K=function(t){var r=t.type,n=r===void 0?"linear":r,a=t.points,o=a===void 0?[]:a,s=t.baseLine,l=t.layout,c=t.connectNulls,u=c===void 0?!1:c,d=FK(n,l),f=u?o.filter(function(m){return Am(m)}):o,h;if(Array.isArray(s)){var p=u?s.filter(function(m){return Am(m)}):s,g=f.map(function(m,x){return t3(t3({},m),{},{base:p[x]})});return l==="vertical"?h=vm().y(gf).x1(mf).x0(function(m){return m.base.x}):h=vm().x(mf).y1(gf).y0(function(m){return m.base.y}),h.defined(Am).curve(d),h(g)}return l==="vertical"&&Mt(s)?h=vm().y(gf).x1(mf).x0(s):Mt(s)?h=vm().x(mf).y1(gf).y0(s):h=RN().x(mf).y(gf),h.defined(Am).curve(d),h(f)},Wg=function(t){var r=t.className,n=t.points,a=t.path,o=t.pathRef;if((!n||!n.length)&&!a)return null;var s=n&&n.length?$K(t):a;return Ce.createElement("path",M_({},_r(t,!1),vg(t),{className:Nr("recharts-curve",r),d:s,ref:o}))},BK=Object.getOwnPropertyNames,UK=Object.getOwnPropertySymbols,zK=Object.prototype.hasOwnProperty;function n3(e,t){return function(n,a,o){return e(n,a,o)&&t(n,a,o)}}function Pm(e){return function(r,n,a){if(!r||!n||typeof r!="object"||typeof n!="object")return e(r,n,a);var o=a.cache,s=o.get(r),l=o.get(n);if(s&&l)return s===n&&l===r;o.set(r,n),o.set(n,r);var c=e(r,n,a);return o.delete(r),o.delete(n),c}}function a3(e){return BK(e).concat(UK(e))}var WK=Object.hasOwn||function(e,t){return zK.call(e,t)};function lu(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var HK="__v",VK="__o",GK="_owner",i3=Object.getOwnPropertyDescriptor,o3=Object.keys;function YK(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function KK(e,t){return lu(e.getTime(),t.getTime())}function QK(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function XK(e,t){return e===t}function s3(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var a=new Array(n),o=e.entries(),s,l,c=0;(s=o.next())&&!s.done;){for(var u=t.entries(),d=!1,f=0;(l=u.next())&&!l.done;){if(a[f]){f++;continue}var h=s.value,p=l.value;if(r.equals(h[0],p[0],c,f,e,t,r)&&r.equals(h[1],p[1],h[0],p[0],e,t,r)){d=a[f]=!0;break}f++}if(!d)return!1;c++}return!0}var JK=lu;function ZK(e,t,r){var n=o3(e),a=n.length;if(o3(t).length!==a)return!1;for(;a-- >0;)if(!BM(e,t,r,n[a]))return!1;return!0}function vf(e,t,r){var n=a3(e),a=n.length;if(a3(t).length!==a)return!1;for(var o,s,l;a-- >0;)if(o=n[a],!BM(e,t,r,o)||(s=i3(e,o),l=i3(t,o),(s||l)&&(!s||!l||s.configurable!==l.configurable||s.enumerable!==l.enumerable||s.writable!==l.writable)))return!1;return!0}function eQ(e,t){return lu(e.valueOf(),t.valueOf())}function tQ(e,t){return e.source===t.source&&e.flags===t.flags}function l3(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var a=new Array(n),o=e.values(),s,l;(s=o.next())&&!s.done;){for(var c=t.values(),u=!1,d=0;(l=c.next())&&!l.done;){if(!a[d]&&r.equals(s.value,l.value,s.value,l.value,e,t,r)){u=a[d]=!0;break}d++}if(!u)return!1}return!0}function rQ(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function nQ(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function BM(e,t,r,n){return(n===GK||n===VK||n===HK)&&(e.$$typeof||t.$$typeof)?!0:WK(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}var aQ="[object Arguments]",iQ="[object Boolean]",oQ="[object Date]",sQ="[object Error]",lQ="[object Map]",cQ="[object Number]",uQ="[object Object]",dQ="[object RegExp]",fQ="[object Set]",hQ="[object String]",pQ="[object URL]",mQ=Array.isArray,c3=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,u3=Object.assign,gQ=Object.prototype.toString.call.bind(Object.prototype.toString);function vQ(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areErrorsEqual,a=e.areFunctionsEqual,o=e.areMapsEqual,s=e.areNumbersEqual,l=e.areObjectsEqual,c=e.arePrimitiveWrappersEqual,u=e.areRegExpsEqual,d=e.areSetsEqual,f=e.areTypedArraysEqual,h=e.areUrlsEqual;return function(g,m,x){if(g===m)return!0;if(g==null||m==null)return!1;var b=typeof g;if(b!==typeof m)return!1;if(b!=="object")return b==="number"?s(g,m,x):b==="function"?a(g,m,x):!1;var _=g.constructor;if(_!==m.constructor)return!1;if(_===Object)return l(g,m,x);if(mQ(g))return t(g,m,x);if(c3!=null&&c3(g))return f(g,m,x);if(_===Date)return r(g,m,x);if(_===RegExp)return u(g,m,x);if(_===Map)return o(g,m,x);if(_===Set)return d(g,m,x);var w=gQ(g);return w===oQ?r(g,m,x):w===dQ?u(g,m,x):w===lQ?o(g,m,x):w===fQ?d(g,m,x):w===uQ?typeof g.then!="function"&&typeof m.then!="function"&&l(g,m,x):w===pQ?h(g,m,x):w===sQ?n(g,m,x):w===aQ?l(g,m,x):w===iQ||w===cQ||w===hQ?c(g,m,x):!1}}function yQ(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,a={areArraysEqual:n?vf:YK,areDatesEqual:KK,areErrorsEqual:QK,areFunctionsEqual:XK,areMapsEqual:n?n3(s3,vf):s3,areNumbersEqual:JK,areObjectsEqual:n?vf:ZK,arePrimitiveWrappersEqual:eQ,areRegExpsEqual:tQ,areSetsEqual:n?n3(l3,vf):l3,areTypedArraysEqual:n?vf:rQ,areUrlsEqual:nQ};if(r&&(a=u3({},a,r(a))),t){var o=Pm(a.areArraysEqual),s=Pm(a.areMapsEqual),l=Pm(a.areObjectsEqual),c=Pm(a.areSetsEqual);a=u3({},a,{areArraysEqual:o,areMapsEqual:s,areObjectsEqual:l,areSetsEqual:c})}return a}function xQ(e){return function(t,r,n,a,o,s,l){return e(t,r,l)}}function bQ(e){var t=e.circular,r=e.comparator,n=e.createState,a=e.equals,o=e.strict;if(n)return function(c,u){var d=n(),f=d.cache,h=f===void 0?t?new WeakMap:void 0:f,p=d.meta;return r(c,u,{cache:h,equals:a,meta:p,strict:o})};if(t)return function(c,u){return r(c,u,{cache:new WeakMap,equals:a,meta:void 0,strict:o})};var s={cache:void 0,equals:a,meta:void 0,strict:o};return function(c,u){return r(c,u,s)}}var _Q=uc();uc({strict:!0});uc({circular:!0});uc({circular:!0,strict:!0});uc({createInternalComparator:function(){return lu}});uc({strict:!0,createInternalComparator:function(){return lu}});uc({circular:!0,createInternalComparator:function(){return lu}});uc({circular:!0,createInternalComparator:function(){return lu},strict:!0});function uc(e){e===void 0&&(e={});var t=e.circular,r=t===void 0?!1:t,n=e.createInternalComparator,a=e.createState,o=e.strict,s=o===void 0?!1:o,l=yQ(e),c=vQ(l),u=n?n(c):xQ(c);return bQ({circular:r,comparator:c,createState:a,equals:u,strict:s})}function wQ(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function d3(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function a(o){r<0&&(r=o),o-r>t?(e(o),r=-1):wQ(a)};requestAnimationFrame(n)}function L_(e){"@babel/helpers - typeof";return L_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L_(e)}function jQ(e){return PQ(e)||AQ(e)||CQ(e)||SQ()}function SQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CQ(e,t){if(e){if(typeof e=="string")return f3(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f3(e,t)}}function f3(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function AQ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function PQ(e){if(Array.isArray(e))return e}function OQ(){var e={},t=function(){return null},r=!1,n=function a(o){if(!r){if(Array.isArray(o)){if(!o.length)return;var s=o,l=jQ(s),c=l[0],u=l.slice(1);if(typeof c=="number"){d3(a.bind(null,u),c);return}a(c),d3(a.bind(null,u));return}L_(o)==="object"&&(e=o,t(e)),typeof o=="function"&&o()}};return{stop:function(){r=!0},start:function(o){r=!1,n(o)},subscribe:function(o){return t=o,function(){t=function(){return null}}}}}function hp(e){"@babel/helpers - typeof";return hp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hp(e)}function h3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function p3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?h3(Object(r),!0).forEach(function(n){UM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function UM(e,t,r){return t=kQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kQ(e){var t=TQ(e,"string");return hp(t)==="symbol"?t:String(t)}function TQ(e,t){if(hp(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(hp(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var EQ=function(t,r){return[Object.keys(t),Object.keys(r)].reduce(function(n,a){return n.filter(function(o){return a.includes(o)})})},IQ=function(t){return t},NQ=function(t){return t.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},Ih=function(t,r){return Object.keys(r).reduce(function(n,a){return p3(p3({},n),{},UM({},a,t(a,r[a])))},{})},m3=function(t,r,n){return t.map(function(a){return"".concat(NQ(a)," ").concat(r,"ms ").concat(n)}).join(",")};function DQ(e,t){return RQ(e)||LQ(e,t)||zM(e,t)||MQ()}function MQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LQ(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function RQ(e){if(Array.isArray(e))return e}function qQ(e){return BQ(e)||$Q(e)||zM(e)||FQ()}function FQ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zM(e,t){if(e){if(typeof e=="string")return R_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return R_(e,t)}}function $Q(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function BQ(e){if(Array.isArray(e))return R_(e)}function R_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Hg=1e-4,WM=function(t,r){return[0,3*t,3*r-6*t,3*t-3*r+1]},HM=function(t,r){return t.map(function(n,a){return n*Math.pow(r,a)}).reduce(function(n,a){return n+a})},g3=function(t,r){return function(n){var a=WM(t,r);return HM(a,n)}},UQ=function(t,r){return function(n){var a=WM(t,r),o=[].concat(qQ(a.map(function(s,l){return s*l}).slice(1)),[0]);return HM(o,n)}},v3=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=r[0],o=r[1],s=r[2],l=r[3];if(r.length===1)switch(r[0]){case"linear":a=0,o=0,s=1,l=1;break;case"ease":a=.25,o=.1,s=.25,l=1;break;case"ease-in":a=.42,o=0,s=1,l=1;break;case"ease-out":a=.42,o=0,s=.58,l=1;break;case"ease-in-out":a=0,o=0,s=.58,l=1;break;default:{var c=r[0].split("(");if(c[0]==="cubic-bezier"&&c[1].split(")")[0].split(",").length===4){var u=c[1].split(")")[0].split(",").map(function(x){return parseFloat(x)}),d=DQ(u,4);a=d[0],o=d[1],s=d[2],l=d[3]}}}var f=g3(a,s),h=g3(o,l),p=UQ(a,s),g=function(b){return b>1?1:b<0?0:b},m=function(b){for(var _=b>1?1:b,w=_,A=0;A<8;++A){var O=f(w)-_,T=p(w);if(Math.abs(O-_)<Hg||T<Hg)return h(w);w=g(w-O/T)}return h(w)};return m.isStepper=!1,m},zQ=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.stiff,n=r===void 0?100:r,a=t.damping,o=a===void 0?8:a,s=t.dt,l=s===void 0?17:s,c=function(d,f,h){var p=-(d-f)*n,g=h*o,m=h+(p-g)*l/1e3,x=h*l/1e3+d;return Math.abs(x-f)<Hg&&Math.abs(m)<Hg?[f,0]:[x,m]};return c.isStepper=!0,c.dt=l,c},WQ=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=r[0];if(typeof a=="string")switch(a){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return v3(a);case"spring":return zQ();default:if(a.split("(")[0]==="cubic-bezier")return v3(a)}return typeof a=="function"?a:null};function pp(e){"@babel/helpers - typeof";return pp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pp(e)}function y3(e){return GQ(e)||VQ(e)||VM(e)||HQ()}function HQ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VQ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function GQ(e){if(Array.isArray(e))return F_(e)}function x3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ui(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?x3(Object(r),!0).forEach(function(n){q_(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function q_(e,t,r){return t=YQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function YQ(e){var t=KQ(e,"string");return pp(t)==="symbol"?t:String(t)}function KQ(e,t){if(pp(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(pp(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function QQ(e,t){return ZQ(e)||JQ(e,t)||VM(e,t)||XQ()}function XQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VM(e,t){if(e){if(typeof e=="string")return F_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return F_(e,t)}}function F_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function JQ(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function ZQ(e){if(Array.isArray(e))return e}var Vg=function(t,r,n){return t+(r-t)*n},$_=function(t){var r=t.from,n=t.to;return r!==n},eX=function e(t,r,n){var a=Ih(function(o,s){if($_(s)){var l=t(s.from,s.to,s.velocity),c=QQ(l,2),u=c[0],d=c[1];return ui(ui({},s),{},{from:u,velocity:d})}return s},r);return n<1?Ih(function(o,s){return $_(s)?ui(ui({},s),{},{velocity:Vg(s.velocity,a[o].velocity,n),from:Vg(s.from,a[o].from,n)}):s},r):e(t,a,n-1)};const tX=function(e,t,r,n,a){var o=EQ(e,t),s=o.reduce(function(x,b){return ui(ui({},x),{},q_({},b,[e[b],t[b]]))},{}),l=o.reduce(function(x,b){return ui(ui({},x),{},q_({},b,{from:e[b],velocity:0,to:t[b]}))},{}),c=-1,u,d,f=function(){return null},h=function(){return Ih(function(b,_){return _.from},l)},p=function(){return!Object.values(l).filter($_).length},g=function(b){u||(u=b);var _=b-u,w=_/r.dt;l=eX(r,l,w),a(ui(ui(ui({},e),t),h())),u=b,p()||(c=requestAnimationFrame(f))},m=function(b){d||(d=b);var _=(b-d)/n,w=Ih(function(O,T){return Vg.apply(void 0,y3(T).concat([r(_)]))},s);if(a(ui(ui(ui({},e),t),w)),_<1)c=requestAnimationFrame(f);else{var A=Ih(function(O,T){return Vg.apply(void 0,y3(T).concat([r(1)]))},s);a(ui(ui(ui({},e),t),A))}};return f=r.isStepper?g:m,function(){return requestAnimationFrame(f),function(){cancelAnimationFrame(c)}}};function cd(e){"@babel/helpers - typeof";return cd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cd(e)}var rX=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function nX(e,t){if(e==null)return{};var r=aX(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function aX(e,t){if(e==null)return{};var r={},n=Object.keys(e),a,o;for(o=0;o<n.length;o++)a=n[o],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}function q1(e){return lX(e)||sX(e)||oX(e)||iX()}function iX(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oX(e,t){if(e){if(typeof e=="string")return B_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return B_(e,t)}}function sX(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function lX(e){if(Array.isArray(e))return B_(e)}function B_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Jo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?b3(Object(r),!0).forEach(function(n){Ph(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ph(e,t,r){return t=GM(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cX(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function uX(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,GM(n.key),n)}}function dX(e,t,r){return t&&uX(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function GM(e){var t=fX(e,"string");return cd(t)==="symbol"?t:String(t)}function fX(e,t){if(cd(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(cd(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function hX(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&U_(e,t)}function U_(e,t){return U_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},U_(e,t)}function pX(e){var t=mX();return function(){var n=Gg(e),a;if(t){var o=Gg(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return z_(this,a)}}function z_(e,t){if(t&&(cd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return W_(e)}function W_(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Gg(e){return Gg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Gg(e)}var Ts=function(e){hX(r,e);var t=pX(r);function r(n,a){var o;cX(this,r),o=t.call(this,n,a);var s=o.props,l=s.isActive,c=s.attributeName,u=s.from,d=s.to,f=s.steps,h=s.children,p=s.duration;if(o.handleStyleChange=o.handleStyleChange.bind(W_(o)),o.changeStyle=o.changeStyle.bind(W_(o)),!l||p<=0)return o.state={style:{}},typeof h=="function"&&(o.state={style:d}),z_(o);if(f&&f.length)o.state={style:f[0].style};else if(u){if(typeof h=="function")return o.state={style:u},z_(o);o.state={style:c?Ph({},c,u):u}}else o.state={style:{}};return o}return dX(r,[{key:"componentDidMount",value:function(){var a=this.props,o=a.isActive,s=a.canBegin;this.mounted=!0,!(!o||!s)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(a){var o=this.props,s=o.isActive,l=o.canBegin,c=o.attributeName,u=o.shouldReAnimate,d=o.to,f=o.from,h=this.state.style;if(l){if(!s){var p={style:c?Ph({},c,d):d};this.state&&h&&(c&&h[c]!==d||!c&&h!==d)&&this.setState(p);return}if(!(_Q(a.to,d)&&a.canBegin&&a.isActive)){var g=!a.canBegin||!a.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var m=g||u?f:a.to;if(this.state&&h){var x={style:c?Ph({},c,m):m};(c&&h[c]!==m||!c&&h!==m)&&this.setState(x)}this.runAnimation(Jo(Jo({},this.props),{},{from:m,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var a=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),a&&a()}},{key:"handleStyleChange",value:function(a){this.changeStyle(a)}},{key:"changeStyle",value:function(a){this.mounted&&this.setState({style:a})}},{key:"runJSAnimation",value:function(a){var o=this,s=a.from,l=a.to,c=a.duration,u=a.easing,d=a.begin,f=a.onAnimationEnd,h=a.onAnimationStart,p=tX(s,l,WQ(u),c,this.changeStyle),g=function(){o.stopJSAnimation=p()};this.manager.start([h,d,g,c,f])}},{key:"runStepAnimation",value:function(a){var o=this,s=a.steps,l=a.begin,c=a.onAnimationStart,u=s[0],d=u.style,f=u.duration,h=f===void 0?0:f,p=function(m,x,b){if(b===0)return m;var _=x.duration,w=x.easing,A=w===void 0?"ease":w,O=x.style,T=x.properties,E=x.onAnimationEnd,S=b>0?s[b-1]:x,I=T||Object.keys(O);if(typeof A=="function"||A==="spring")return[].concat(q1(m),[o.runJSAnimation.bind(o,{from:S.style,to:O,duration:_,easing:A}),_]);var z=m3(I,_,A),k=Jo(Jo(Jo({},S.style),O),{},{transition:z});return[].concat(q1(m),[k,_,E]).filter(IQ)};return this.manager.start([c].concat(q1(s.reduce(p,[d,Math.max(h,l)])),[a.onAnimationEnd]))}},{key:"runAnimation",value:function(a){this.manager||(this.manager=OQ());var o=a.begin,s=a.duration,l=a.attributeName,c=a.to,u=a.easing,d=a.onAnimationStart,f=a.onAnimationEnd,h=a.steps,p=a.children,g=this.manager;if(this.unSubscribe=g.subscribe(this.handleStyleChange),typeof u=="function"||typeof p=="function"||u==="spring"){this.runJSAnimation(a);return}if(h.length>1){this.runStepAnimation(a);return}var m=l?Ph({},l,c):c,x=m3(Object.keys(m),s,u);g.start([d,o,Jo(Jo({},m),{},{transition:x}),s,f])}},{key:"render",value:function(){var a=this.props,o=a.children;a.begin;var s=a.duration;a.attributeName,a.easing;var l=a.isActive;a.steps,a.from,a.to,a.canBegin,a.onAnimationEnd,a.shouldReAnimate,a.onAnimationReStart;var c=nX(a,rX),u=y.Children.count(o),d=this.state.style;if(typeof o=="function")return o(d);if(!l||u===0||s<=0)return o;var f=function(p){var g=p.props,m=g.style,x=m===void 0?{}:m,b=g.className,_=y.cloneElement(p,Jo(Jo({},c),{},{style:Jo(Jo({},x),d),className:b}));return _};return u===1?f(y.Children.only(o)):Ce.createElement("div",null,y.Children.map(o,function(h){return f(h)}))}}]),r}(y.PureComponent);Ts.displayName="Animate";Ts.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Ts.propTypes={from:_n.oneOfType([_n.object,_n.string]),to:_n.oneOfType([_n.object,_n.string]),attributeName:_n.string,duration:_n.number,begin:_n.number,easing:_n.oneOfType([_n.string,_n.func]),steps:_n.arrayOf(_n.shape({duration:_n.number.isRequired,style:_n.object.isRequired,easing:_n.oneOfType([_n.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),_n.func]),properties:_n.arrayOf("string"),onAnimationEnd:_n.func})),children:_n.oneOfType([_n.node,_n.func]),isActive:_n.bool,canBegin:_n.bool,onAnimationEnd:_n.func,shouldReAnimate:_n.bool,onAnimationStart:_n.func,onAnimationReStart:_n.func};function mp(e){"@babel/helpers - typeof";return mp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mp(e)}function Yg(){return Yg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Yg.apply(this,arguments)}function gX(e,t){return bX(e)||xX(e,t)||yX(e,t)||vX()}function vX(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yX(e,t){if(e){if(typeof e=="string")return _3(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _3(e,t)}}function _3(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function xX(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function bX(e){if(Array.isArray(e))return e}function w3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function j3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?w3(Object(r),!0).forEach(function(n){_X(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _X(e,t,r){return t=wX(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wX(e){var t=jX(e,"string");return mp(t)=="symbol"?t:t+""}function jX(e,t){if(mp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(mp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var S3=function(t,r,n,a,o){var s=Math.min(Math.abs(n)/2,Math.abs(a)/2),l=a>=0?1:-1,c=n>=0?1:-1,u=a>=0&&n>=0||a<0&&n<0?1:0,d;if(s>0&&o instanceof Array){for(var f=[0,0,0,0],h=0,p=4;h<p;h++)f[h]=o[h]>s?s:o[h];d="M".concat(t,",").concat(r+l*f[0]),f[0]>0&&(d+="A ".concat(f[0],",").concat(f[0],",0,0,").concat(u,",").concat(t+c*f[0],",").concat(r)),d+="L ".concat(t+n-c*f[1],",").concat(r),f[1]>0&&(d+="A ".concat(f[1],",").concat(f[1],",0,0,").concat(u,`,
        `).concat(t+n,",").concat(r+l*f[1])),d+="L ".concat(t+n,",").concat(r+a-l*f[2]),f[2]>0&&(d+="A ".concat(f[2],",").concat(f[2],",0,0,").concat(u,`,
        `).concat(t+n-c*f[2],",").concat(r+a)),d+="L ".concat(t+c*f[3],",").concat(r+a),f[3]>0&&(d+="A ".concat(f[3],",").concat(f[3],",0,0,").concat(u,`,
        `).concat(t,",").concat(r+a-l*f[3])),d+="Z"}else if(s>0&&o===+o&&o>0){var g=Math.min(s,o);d="M ".concat(t,",").concat(r+l*g,`
            A `).concat(g,",").concat(g,",0,0,").concat(u,",").concat(t+c*g,",").concat(r,`
            L `).concat(t+n-c*g,",").concat(r,`
            A `).concat(g,",").concat(g,",0,0,").concat(u,",").concat(t+n,",").concat(r+l*g,`
            L `).concat(t+n,",").concat(r+a-l*g,`
            A `).concat(g,",").concat(g,",0,0,").concat(u,",").concat(t+n-c*g,",").concat(r+a,`
            L `).concat(t+c*g,",").concat(r+a,`
            A `).concat(g,",").concat(g,",0,0,").concat(u,",").concat(t,",").concat(r+a-l*g," Z")}else d="M ".concat(t,",").concat(r," h ").concat(n," v ").concat(a," h ").concat(-n," Z");return d},SX=function(t,r){if(!t||!r)return!1;var n=t.x,a=t.y,o=r.x,s=r.y,l=r.width,c=r.height;if(Math.abs(l)>0&&Math.abs(c)>0){var u=Math.min(o,o+l),d=Math.max(o,o+l),f=Math.min(s,s+c),h=Math.max(s,s+c);return n>=u&&n<=d&&a>=f&&a<=h}return!1},CX={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},rS=function(t){var r=j3(j3({},CX),t),n=y.useRef(),a=y.useState(-1),o=gX(a,2),s=o[0],l=o[1];y.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var A=n.current.getTotalLength();A&&l(A)}catch{}},[]);var c=r.x,u=r.y,d=r.width,f=r.height,h=r.radius,p=r.className,g=r.animationEasing,m=r.animationDuration,x=r.animationBegin,b=r.isAnimationActive,_=r.isUpdateAnimationActive;if(c!==+c||u!==+u||d!==+d||f!==+f||d===0||f===0)return null;var w=Nr("recharts-rectangle",p);return _?Ce.createElement(Ts,{canBegin:s>0,from:{width:d,height:f,x:c,y:u},to:{width:d,height:f,x:c,y:u},duration:m,animationEasing:g,isActive:_},function(A){var O=A.width,T=A.height,E=A.x,S=A.y;return Ce.createElement(Ts,{canBegin:s>0,from:"0px ".concat(s===-1?1:s,"px"),to:"".concat(s,"px 0px"),attributeName:"strokeDasharray",begin:x,duration:m,isActive:b,easing:g},Ce.createElement("path",Yg({},_r(r,!0),{className:w,d:S3(E,S,O,T,h),ref:n})))}):Ce.createElement("path",Yg({},_r(r,!0),{className:w,d:S3(c,u,d,f,h)}))},AX=["points","className","baseLinePoints","connectNulls"];function Nu(){return Nu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Nu.apply(this,arguments)}function PX(e,t){if(e==null)return{};var r=OX(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function OX(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function C3(e){return IX(e)||EX(e)||TX(e)||kX()}function kX(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function TX(e,t){if(e){if(typeof e=="string")return H_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H_(e,t)}}function EX(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function IX(e){if(Array.isArray(e))return H_(e)}function H_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var A3=function(t){return t&&t.x===+t.x&&t.y===+t.y},NX=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=[[]];return t.forEach(function(n){A3(n)?r[r.length-1].push(n):r[r.length-1].length>0&&r.push([])}),A3(t[0])&&r[r.length-1].push(t[0]),r[r.length-1].length<=0&&(r=r.slice(0,-1)),r},Nh=function(t,r){var n=NX(t);r&&(n=[n.reduce(function(o,s){return[].concat(C3(o),C3(s))},[])]);var a=n.map(function(o){return o.reduce(function(s,l,c){return"".concat(s).concat(c===0?"M":"L").concat(l.x,",").concat(l.y)},"")}).join("");return n.length===1?"".concat(a,"Z"):a},DX=function(t,r,n){var a=Nh(t,n);return"".concat(a.slice(-1)==="Z"?a.slice(0,-1):a,"L").concat(Nh(r.reverse(),n).slice(1))},MX=function(t){var r=t.points,n=t.className,a=t.baseLinePoints,o=t.connectNulls,s=PX(t,AX);if(!r||!r.length)return null;var l=Nr("recharts-polygon",n);if(a&&a.length){var c=s.stroke&&s.stroke!=="none",u=DX(r,a,o);return Ce.createElement("g",{className:l},Ce.createElement("path",Nu({},_r(s,!0),{fill:u.slice(-1)==="Z"?s.fill:"none",stroke:"none",d:u})),c?Ce.createElement("path",Nu({},_r(s,!0),{fill:"none",d:Nh(r,o)})):null,c?Ce.createElement("path",Nu({},_r(s,!0),{fill:"none",d:Nh(a,o)})):null)}var d=Nh(r,o);return Ce.createElement("path",Nu({},_r(s,!0),{fill:d.slice(-1)==="Z"?s.fill:"none",className:l,d}))};function V_(){return V_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},V_.apply(this,arguments)}var fy=function(t){var r=t.cx,n=t.cy,a=t.r,o=t.className,s=Nr("recharts-dot",o);return r===+r&&n===+n&&a===+a?Ce.createElement("circle",V_({},_r(t,!1),vg(t),{className:s,cx:r,cy:n,r:a})):null};function gp(e){"@babel/helpers - typeof";return gp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gp(e)}var LX=["x","y","top","left","width","height","className"];function G_(){return G_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},G_.apply(this,arguments)}function P3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function RX(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?P3(Object(r),!0).forEach(function(n){qX(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qX(e,t,r){return t=FX(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function FX(e){var t=$X(e,"string");return gp(t)=="symbol"?t:t+""}function $X(e,t){if(gp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(gp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function BX(e,t){if(e==null)return{};var r=UX(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function UX(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var zX=function(t,r,n,a,o,s){return"M".concat(t,",").concat(o,"v").concat(a,"M").concat(s,",").concat(r,"h").concat(n)},WX=function(t){var r=t.x,n=r===void 0?0:r,a=t.y,o=a===void 0?0:a,s=t.top,l=s===void 0?0:s,c=t.left,u=c===void 0?0:c,d=t.width,f=d===void 0?0:d,h=t.height,p=h===void 0?0:h,g=t.className,m=BX(t,LX),x=RX({x:n,y:o,top:l,left:u,width:f,height:p},m);return!Mt(n)||!Mt(o)||!Mt(f)||!Mt(p)||!Mt(l)||!Mt(u)?null:Ce.createElement("path",G_({},_r(x,!0),{className:Nr("recharts-cross",g),d:zX(n,o,f,p,l,u)}))},F1,O3;function HX(){if(O3)return F1;O3=1;var e=sy(),t=lM(),r=Rs();function n(a,o){return a&&a.length?e(a,r(o,2),t):void 0}return F1=n,F1}var VX=HX();const GX=It(VX);var $1,k3;function YX(){if(k3)return $1;k3=1;var e=sy(),t=Rs(),r=cM();function n(a,o){return a&&a.length?e(a,t(o,2),r):void 0}return $1=n,$1}var KX=YX();const QX=It(KX);var XX=["cx","cy","angle","ticks","axisLine"],JX=["ticks","tick","angle","tickFormatter","stroke"];function ud(e){"@babel/helpers - typeof";return ud=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ud(e)}function Dh(){return Dh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Dh.apply(this,arguments)}function T3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function jc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?T3(Object(r),!0).forEach(function(n){hy(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function E3(e,t){if(e==null)return{};var r=ZX(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ZX(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function eJ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I3(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,KM(n.key),n)}}function tJ(e,t,r){return t&&I3(e.prototype,t),r&&I3(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function rJ(e,t,r){return t=Kg(t),nJ(e,YM()?Reflect.construct(t,r||[],Kg(e).constructor):t.apply(e,r))}function nJ(e,t){if(t&&(ud(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return aJ(e)}function aJ(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function YM(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(YM=function(){return!!e})()}function Kg(e){return Kg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Kg(e)}function iJ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Y_(e,t)}function Y_(e,t){return Y_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Y_(e,t)}function hy(e,t,r){return t=KM(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function KM(e){var t=oJ(e,"string");return ud(t)=="symbol"?t:t+""}function oJ(e,t){if(ud(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ud(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var py=function(e){function t(){return eJ(this,t),rJ(this,t,arguments)}return iJ(t,e),tJ(t,[{key:"getTickValueCoord",value:function(n){var a=n.coordinate,o=this.props,s=o.angle,l=o.cx,c=o.cy;return Bn(l,c,a,s)}},{key:"getTickTextAnchor",value:function(){var n=this.props.orientation,a;switch(n){case"left":a="end";break;case"right":a="start";break;default:a="middle";break}return a}},{key:"getViewBox",value:function(){var n=this.props,a=n.cx,o=n.cy,s=n.angle,l=n.ticks,c=GX(l,function(d){return d.coordinate||0}),u=QX(l,function(d){return d.coordinate||0});return{cx:a,cy:o,startAngle:s,endAngle:s,innerRadius:u.coordinate||0,outerRadius:c.coordinate||0}}},{key:"renderAxisLine",value:function(){var n=this.props,a=n.cx,o=n.cy,s=n.angle,l=n.ticks,c=n.axisLine,u=E3(n,XX),d=l.reduce(function(g,m){return[Math.min(g[0],m.coordinate),Math.max(g[1],m.coordinate)]},[1/0,-1/0]),f=Bn(a,o,d[0],s),h=Bn(a,o,d[1],s),p=jc(jc(jc({},_r(u,!1)),{},{fill:"none"},_r(c,!1)),{},{x1:f.x,y1:f.y,x2:h.x,y2:h.y});return Ce.createElement("line",Dh({className:"recharts-polar-radius-axis-line"},p))}},{key:"renderTicks",value:function(){var n=this,a=this.props,o=a.ticks,s=a.tick,l=a.angle,c=a.tickFormatter,u=a.stroke,d=E3(a,JX),f=this.getTickTextAnchor(),h=_r(d,!1),p=_r(s,!1),g=o.map(function(m,x){var b=n.getTickValueCoord(m),_=jc(jc(jc(jc({textAnchor:f,transform:"rotate(".concat(90-l,", ").concat(b.x,", ").concat(b.y,")")},h),{},{stroke:"none",fill:u},p),{},{index:x},b),{},{payload:m});return Ce.createElement(pn,Dh({className:Nr("recharts-polar-radius-axis-tick",RM(s)),key:"tick-".concat(m.coordinate)},Yc(n.props,m,x)),t.renderTickItem(s,_,c?c(m.value,x):m.value))});return Ce.createElement(pn,{className:"recharts-polar-radius-axis-ticks"},g)}},{key:"render",value:function(){var n=this.props,a=n.ticks,o=n.axisLine,s=n.tick;return!a||!a.length?null:Ce.createElement(pn,{className:Nr("recharts-polar-radius-axis",this.props.className)},o&&this.renderAxisLine(),s&&this.renderTicks(),ti.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(n,a,o){var s;return Ce.isValidElement(n)?s=Ce.cloneElement(n,a):Rr(n)?s=n(a):s=Ce.createElement(Kc,Dh({},a,{className:"recharts-polar-radius-axis-tick-value"}),o),s}}])}(y.PureComponent);hy(py,"displayName","PolarRadiusAxis");hy(py,"axisType","radiusAxis");hy(py,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function dd(e){"@babel/helpers - typeof";return dd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dd(e)}function Ec(){return Ec=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ec.apply(this,arguments)}function N3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Sc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?N3(Object(r),!0).forEach(function(n){my(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sJ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function D3(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,XM(n.key),n)}}function lJ(e,t,r){return t&&D3(e.prototype,t),r&&D3(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function cJ(e,t,r){return t=Qg(t),uJ(e,QM()?Reflect.construct(t,r||[],Qg(e).constructor):t.apply(e,r))}function uJ(e,t){if(t&&(dd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return dJ(e)}function dJ(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function QM(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(QM=function(){return!!e})()}function Qg(e){return Qg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Qg(e)}function fJ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&K_(e,t)}function K_(e,t){return K_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},K_(e,t)}function my(e,t,r){return t=XM(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function XM(e){var t=hJ(e,"string");return dd(t)=="symbol"?t:t+""}function hJ(e,t){if(dd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(dd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var pJ=Math.PI/180,M3=1e-5,gy=function(e){function t(){return sJ(this,t),cJ(this,t,arguments)}return fJ(t,e),lJ(t,[{key:"getTickLineCoord",value:function(n){var a=this.props,o=a.cx,s=a.cy,l=a.radius,c=a.orientation,u=a.tickSize,d=u||8,f=Bn(o,s,l,n.coordinate),h=Bn(o,s,l+(c==="inner"?-1:1)*d,n.coordinate);return{x1:f.x,y1:f.y,x2:h.x,y2:h.y}}},{key:"getTickTextAnchor",value:function(n){var a=this.props.orientation,o=Math.cos(-n.coordinate*pJ),s;return o>M3?s=a==="outer"?"start":"end":o<-M3?s=a==="outer"?"end":"start":s="middle",s}},{key:"renderAxisLine",value:function(){var n=this.props,a=n.cx,o=n.cy,s=n.radius,l=n.axisLine,c=n.axisLineType,u=Sc(Sc({},_r(this.props,!1)),{},{fill:"none"},_r(l,!1));if(c==="circle")return Ce.createElement(fy,Ec({className:"recharts-polar-angle-axis-line"},u,{cx:a,cy:o,r:s}));var d=this.props.ticks,f=d.map(function(h){return Bn(a,o,s,h.coordinate)});return Ce.createElement(MX,Ec({className:"recharts-polar-angle-axis-line"},u,{points:f}))}},{key:"renderTicks",value:function(){var n=this,a=this.props,o=a.ticks,s=a.tick,l=a.tickLine,c=a.tickFormatter,u=a.stroke,d=_r(this.props,!1),f=_r(s,!1),h=Sc(Sc({},d),{},{fill:"none"},_r(l,!1)),p=o.map(function(g,m){var x=n.getTickLineCoord(g),b=n.getTickTextAnchor(g),_=Sc(Sc(Sc({textAnchor:b},d),{},{stroke:"none",fill:u},f),{},{index:m,payload:g,x:x.x2,y:x.y2});return Ce.createElement(pn,Ec({className:Nr("recharts-polar-angle-axis-tick",RM(s)),key:"tick-".concat(g.coordinate)},Yc(n.props,g,m)),l&&Ce.createElement("line",Ec({className:"recharts-polar-angle-axis-tick-line"},h,x)),s&&t.renderTickItem(s,_,c?c(g.value,m):g.value))});return Ce.createElement(pn,{className:"recharts-polar-angle-axis-ticks"},p)}},{key:"render",value:function(){var n=this.props,a=n.ticks,o=n.radius,s=n.axisLine;return o<=0||!a||!a.length?null:Ce.createElement(pn,{className:Nr("recharts-polar-angle-axis",this.props.className)},s&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(n,a,o){var s;return Ce.isValidElement(n)?s=Ce.cloneElement(n,a):Rr(n)?s=n(a):s=Ce.createElement(Kc,Ec({},a,{className:"recharts-polar-angle-axis-tick-value"}),o),s}}])}(y.PureComponent);my(gy,"displayName","PolarAngleAxis");my(gy,"axisType","angleAxis");my(gy,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var B1,L3;function mJ(){if(L3)return B1;L3=1;var e=oD(),t=e(Object.getPrototypeOf,Object);return B1=t,B1}var U1,R3;function gJ(){if(R3)return U1;R3=1;var e=_l(),t=mJ(),r=wl(),n="[object Object]",a=Function.prototype,o=Object.prototype,s=a.toString,l=o.hasOwnProperty,c=s.call(Object);function u(d){if(!r(d)||e(d)!=n)return!1;var f=t(d);if(f===null)return!0;var h=l.call(f,"constructor")&&f.constructor;return typeof h=="function"&&h instanceof h&&s.call(h)==c}return U1=u,U1}var vJ=gJ();const yJ=It(vJ);var z1,q3;function xJ(){if(q3)return z1;q3=1;var e=_l(),t=wl(),r="[object Boolean]";function n(a){return a===!0||a===!1||t(a)&&e(a)==r}return z1=n,z1}var bJ=xJ();const _J=It(bJ);function vp(e){"@babel/helpers - typeof";return vp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vp(e)}function Xg(){return Xg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Xg.apply(this,arguments)}function wJ(e,t){return AJ(e)||CJ(e,t)||SJ(e,t)||jJ()}function jJ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function SJ(e,t){if(e){if(typeof e=="string")return F3(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return F3(e,t)}}function F3(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function CJ(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function AJ(e){if(Array.isArray(e))return e}function $3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function B3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$3(Object(r),!0).forEach(function(n){PJ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function PJ(e,t,r){return t=OJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function OJ(e){var t=kJ(e,"string");return vp(t)=="symbol"?t:t+""}function kJ(e,t){if(vp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(vp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var U3=function(t,r,n,a,o){var s=n-a,l;return l="M ".concat(t,",").concat(r),l+="L ".concat(t+n,",").concat(r),l+="L ".concat(t+n-s/2,",").concat(r+o),l+="L ".concat(t+n-s/2-a,",").concat(r+o),l+="L ".concat(t,",").concat(r," Z"),l},TJ={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},EJ=function(t){var r=B3(B3({},TJ),t),n=y.useRef(),a=y.useState(-1),o=wJ(a,2),s=o[0],l=o[1];y.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var w=n.current.getTotalLength();w&&l(w)}catch{}},[]);var c=r.x,u=r.y,d=r.upperWidth,f=r.lowerWidth,h=r.height,p=r.className,g=r.animationEasing,m=r.animationDuration,x=r.animationBegin,b=r.isUpdateAnimationActive;if(c!==+c||u!==+u||d!==+d||f!==+f||h!==+h||d===0&&f===0||h===0)return null;var _=Nr("recharts-trapezoid",p);return b?Ce.createElement(Ts,{canBegin:s>0,from:{upperWidth:0,lowerWidth:0,height:h,x:c,y:u},to:{upperWidth:d,lowerWidth:f,height:h,x:c,y:u},duration:m,animationEasing:g,isActive:b},function(w){var A=w.upperWidth,O=w.lowerWidth,T=w.height,E=w.x,S=w.y;return Ce.createElement(Ts,{canBegin:s>0,from:"0px ".concat(s===-1?1:s,"px"),to:"".concat(s,"px 0px"),attributeName:"strokeDasharray",begin:x,duration:m,easing:g},Ce.createElement("path",Xg({},_r(r,!0),{className:_,d:U3(E,S,A,O,T),ref:n})))}):Ce.createElement("g",null,Ce.createElement("path",Xg({},_r(r,!0),{className:_,d:U3(c,u,d,f,h)})))},IJ=["option","shapeType","propTransformer","activeClassName","isActive"];function yp(e){"@babel/helpers - typeof";return yp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yp(e)}function NJ(e,t){if(e==null)return{};var r=DJ(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function DJ(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function z3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Jg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?z3(Object(r),!0).forEach(function(n){MJ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function MJ(e,t,r){return t=LJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function LJ(e){var t=RJ(e,"string");return yp(t)=="symbol"?t:t+""}function RJ(e,t){if(yp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(yp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function qJ(e,t){return Jg(Jg({},t),e)}function FJ(e,t){return e==="symbols"}function W3(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return Ce.createElement(rS,r);case"trapezoid":return Ce.createElement(EJ,r);case"sector":return Ce.createElement($M,r);case"symbols":if(FJ(t))return Ce.createElement(_j,r);break;default:return null}}function $J(e){return y.isValidElement(e)?e.props:e}function JM(e){var t=e.option,r=e.shapeType,n=e.propTransformer,a=n===void 0?qJ:n,o=e.activeClassName,s=o===void 0?"recharts-active-shape":o,l=e.isActive,c=NJ(e,IJ),u;if(y.isValidElement(t))u=y.cloneElement(t,Jg(Jg({},c),$J(t)));else if(Rr(t))u=t(c);else if(yJ(t)&&!_J(t)){var d=a(t,c);u=Ce.createElement(W3,{shapeType:r,elementProps:d})}else{var f=c;u=Ce.createElement(W3,{shapeType:r,elementProps:f})}return l?Ce.createElement(pn,{className:s},u):u}function vy(e,t){return t!=null&&"trapezoids"in e.props}function yy(e,t){return t!=null&&"sectors"in e.props}function xp(e,t){return t!=null&&"points"in e.props}function BJ(e,t){var r,n,a=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,o=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return a&&o}function UJ(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function zJ(e,t){var r=e.x===t.x,n=e.y===t.y,a=e.z===t.z;return r&&n&&a}function WJ(e,t){var r;return vy(e,t)?r=BJ:yy(e,t)?r=UJ:xp(e,t)&&(r=zJ),r}function HJ(e,t){var r;return vy(e,t)?r="trapezoids":yy(e,t)?r="sectors":xp(e,t)&&(r="points"),r}function VJ(e,t){if(vy(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(yy(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return xp(e,t)?t.payload:{}}function GJ(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,a=HJ(r,t),o=VJ(r,t),s=n.filter(function(c,u){var d=Up(o,c),f=r.props[a].filter(function(g){var m=WJ(r,t);return m(g,t)}),h=r.props[a].indexOf(f[f.length-1]),p=u===h;return d&&p}),l=n.indexOf(s[s.length-1]);return l}var Qm;function fd(e){"@babel/helpers - typeof";return fd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fd(e)}function Du(){return Du=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Du.apply(this,arguments)}function H3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Fn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?H3(Object(r),!0).forEach(function(n){zo(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function YJ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function V3(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,eL(n.key),n)}}function KJ(e,t,r){return t&&V3(e.prototype,t),r&&V3(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function QJ(e,t,r){return t=Zg(t),XJ(e,ZM()?Reflect.construct(t,r||[],Zg(e).constructor):t.apply(e,r))}function XJ(e,t){if(t&&(fd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return JJ(e)}function JJ(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ZM(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ZM=function(){return!!e})()}function Zg(e){return Zg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Zg(e)}function ZJ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Q_(e,t)}function Q_(e,t){return Q_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Q_(e,t)}function zo(e,t,r){return t=eL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function eL(e){var t=eZ(e,"string");return fd(t)=="symbol"?t:t+""}function eZ(e,t){if(fd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(fd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Sl=function(e){function t(r){var n;return YJ(this,t),n=QJ(this,t,[r]),zo(n,"pieRef",null),zo(n,"sectorRefs",[]),zo(n,"id",qd("recharts-pie-")),zo(n,"handleAnimationEnd",function(){var a=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),Rr(a)&&a()}),zo(n,"handleAnimationStart",function(){var a=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),Rr(a)&&a()}),n.state={isAnimationFinished:!r.isAnimationActive,prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,sectorToFocus:0},n}return ZJ(t,e),KJ(t,[{key:"isActiveIndex",value:function(n){var a=this.props.activeIndex;return Array.isArray(a)?a.indexOf(n)!==-1:n===a}},{key:"hasActiveIndex",value:function(){var n=this.props.activeIndex;return Array.isArray(n)?n.length!==0:n||n===0}},{key:"renderLabels",value:function(n){var a=this.props.isAnimationActive;if(a&&!this.state.isAnimationFinished)return null;var o=this.props,s=o.label,l=o.labelLine,c=o.dataKey,u=o.valueKey,d=_r(this.props,!1),f=_r(s,!1),h=_r(l,!1),p=s&&s.offsetRadius||20,g=n.map(function(m,x){var b=(m.startAngle+m.endAngle)/2,_=Bn(m.cx,m.cy,m.outerRadius+p,b),w=Fn(Fn(Fn(Fn({},d),m),{},{stroke:"none"},f),{},{index:x,textAnchor:t.getTextAnchor(_.x,m.cx)},_),A=Fn(Fn(Fn(Fn({},d),m),{},{fill:"none",stroke:m.fill},h),{},{index:x,points:[Bn(m.cx,m.cy,m.outerRadius,b),_]}),O=c;return Ur(c)&&Ur(u)?O="value":Ur(c)&&(O=u),Ce.createElement(pn,{key:"label-".concat(m.startAngle,"-").concat(m.endAngle,"-").concat(m.midAngle,"-").concat(x)},l&&t.renderLabelLineItem(l,A,"line"),t.renderLabelItem(s,w,Ga(m,O)))});return Ce.createElement(pn,{className:"recharts-pie-labels"},g)}},{key:"renderSectorsStatically",value:function(n){var a=this,o=this.props,s=o.activeShape,l=o.blendStroke,c=o.inactiveShape;return n.map(function(u,d){if(u?.startAngle===0&&u?.endAngle===0&&n.length!==1)return null;var f=a.isActiveIndex(d),h=c&&a.hasActiveIndex()?c:null,p=f?s:h,g=Fn(Fn({},u),{},{stroke:l?u.fill:u.stroke,tabIndex:-1});return Ce.createElement(pn,Du({ref:function(x){x&&!a.sectorRefs.includes(x)&&a.sectorRefs.push(x)},tabIndex:-1,className:"recharts-pie-sector"},Yc(a.props,u,d),{key:"sector-".concat(u?.startAngle,"-").concat(u?.endAngle,"-").concat(u.midAngle,"-").concat(d)}),Ce.createElement(JM,Du({option:p,isActive:f,shapeType:"sector"},g)))})}},{key:"renderSectorsWithAnimation",value:function(){var n=this,a=this.props,o=a.sectors,s=a.isAnimationActive,l=a.animationBegin,c=a.animationDuration,u=a.animationEasing,d=a.animationId,f=this.state,h=f.prevSectors,p=f.prevIsAnimationActive;return Ce.createElement(Ts,{begin:l,duration:c,isActive:s,easing:u,from:{t:0},to:{t:1},key:"pie-".concat(d,"-").concat(p),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(g){var m=g.t,x=[],b=o&&o[0],_=b.startAngle;return o.forEach(function(w,A){var O=h&&h[A],T=A>0?Co(w,"paddingAngle",0):0;if(O){var E=_o(O.endAngle-O.startAngle,w.endAngle-w.startAngle),S=Fn(Fn({},w),{},{startAngle:_+T,endAngle:_+E(m)+T});x.push(S),_=S.endAngle}else{var I=w.endAngle,z=w.startAngle,k=_o(0,I-z),M=k(m),R=Fn(Fn({},w),{},{startAngle:_+T,endAngle:_+M+T});x.push(R),_=R.endAngle}}),Ce.createElement(pn,null,n.renderSectorsStatically(x))})}},{key:"attachKeyboardHandlers",value:function(n){var a=this;n.onkeydown=function(o){if(!o.altKey)switch(o.key){case"ArrowLeft":{var s=++a.state.sectorToFocus%a.sectorRefs.length;a.sectorRefs[s].focus(),a.setState({sectorToFocus:s});break}case"ArrowRight":{var l=--a.state.sectorToFocus<0?a.sectorRefs.length-1:a.state.sectorToFocus%a.sectorRefs.length;a.sectorRefs[l].focus(),a.setState({sectorToFocus:l});break}case"Escape":{a.sectorRefs[a.state.sectorToFocus].blur(),a.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var n=this.props,a=n.sectors,o=n.isAnimationActive,s=this.state.prevSectors;return o&&a&&a.length&&(!s||!Up(s,a))?this.renderSectorsWithAnimation():this.renderSectorsStatically(a)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var n=this,a=this.props,o=a.hide,s=a.sectors,l=a.className,c=a.label,u=a.cx,d=a.cy,f=a.innerRadius,h=a.outerRadius,p=a.isAnimationActive,g=this.state.isAnimationFinished;if(o||!s||!s.length||!Mt(u)||!Mt(d)||!Mt(f)||!Mt(h))return null;var m=Nr("recharts-pie",l);return Ce.createElement(pn,{tabIndex:this.props.rootTabIndex,className:m,ref:function(b){n.pieRef=b}},this.renderSectors(),c&&this.renderLabels(s),ti.renderCallByParent(this.props,null,!1),(!p||g)&&fl.renderCallByParent(this.props,s,!1))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return a.prevIsAnimationActive!==n.isAnimationActive?{prevIsAnimationActive:n.isAnimationActive,prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:[],isAnimationFinished:!0}:n.isAnimationActive&&n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:a.curSectors,isAnimationFinished:!0}:n.sectors!==a.curSectors?{curSectors:n.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(n,a){return n>a?"start":n<a?"end":"middle"}},{key:"renderLabelLineItem",value:function(n,a,o){if(Ce.isValidElement(n))return Ce.cloneElement(n,a);if(Rr(n))return n(a);var s=Nr("recharts-pie-label-line",typeof n!="boolean"?n.className:"");return Ce.createElement(Wg,Du({},a,{key:o,type:"linear",className:s}))}},{key:"renderLabelItem",value:function(n,a,o){if(Ce.isValidElement(n))return Ce.cloneElement(n,a);var s=o;if(Rr(n)&&(s=n(a),Ce.isValidElement(s)))return s;var l=Nr("recharts-pie-label-text",typeof n!="boolean"&&!Rr(n)?n.className:"");return Ce.createElement(Kc,Du({},a,{alignmentBaseline:"middle",className:l}),s)}}])}(y.PureComponent);Qm=Sl;zo(Sl,"displayName","Pie");zo(Sl,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!iu.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});zo(Sl,"parseDeltaAngle",function(e,t){var r=Li(t-e),n=Math.min(Math.abs(t-e),360);return r*n});zo(Sl,"getRealPieData",function(e){var t=e.data,r=e.children,n=_r(e,!1),a=Ao(r,ey);return t&&t.length?t.map(function(o,s){return Fn(Fn(Fn({payload:o},n),o),a&&a[s]&&a[s].props)}):a&&a.length?a.map(function(o){return Fn(Fn({},n),o.props)}):[]});zo(Sl,"parseCoordinateOfPie",function(e,t){var r=t.top,n=t.left,a=t.width,o=t.height,s=LM(a,o),l=n+Ri(e.cx,a,a/2),c=r+Ri(e.cy,o,o/2),u=Ri(e.innerRadius,s,0),d=Ri(e.outerRadius,s,s*.8),f=e.maxRadius||Math.sqrt(a*a+o*o)/2;return{cx:l,cy:c,innerRadius:u,outerRadius:d,maxRadius:f}});zo(Sl,"getComposedData",function(e){var t=e.item,r=e.offset,n=t.type.defaultProps!==void 0?Fn(Fn({},t.type.defaultProps),t.props):t.props,a=Qm.getRealPieData(n);if(!a||!a.length)return null;var o=n.cornerRadius,s=n.startAngle,l=n.endAngle,c=n.paddingAngle,u=n.dataKey,d=n.nameKey,f=n.valueKey,h=n.tooltipType,p=Math.abs(n.minAngle),g=Qm.parseCoordinateOfPie(n,r),m=Qm.parseDeltaAngle(s,l),x=Math.abs(m),b=u;Ur(u)&&Ur(f)?(is(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),b="value"):Ur(u)&&(is(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),b=f);var _=a.filter(function(S){return Ga(S,b,0)!==0}).length,w=(x>=360?_:_-1)*c,A=x-_*p-w,O=a.reduce(function(S,I){var z=Ga(I,b,0);return S+(Mt(z)?z:0)},0),T;if(O>0){var E;T=a.map(function(S,I){var z=Ga(S,b,0),k=Ga(S,d,I),M=(Mt(z)?z:0)/O,R;I?R=E.endAngle+Li(m)*c*(z!==0?1:0):R=s;var F=R+Li(m)*((z!==0?p:0)+M*A),W=(R+F)/2,K=(g.innerRadius+g.outerRadius)/2,Z=[{name:k,value:z,payload:S,dataKey:b,type:h}],D=Bn(g.cx,g.cy,K,W);return E=Fn(Fn(Fn({percent:M,cornerRadius:o,name:k,tooltipPayload:Z,midAngle:W,middleRadius:K,tooltipPosition:D},S),g),{},{value:Ga(S,b),startAngle:R,endAngle:F,payload:S,paddingAngle:Li(m)*c}),E})}return Fn(Fn({},g),{},{sectors:T,data:a})});var W1,G3;function tZ(){if(G3)return W1;G3=1;var e=Math.ceil,t=Math.max;function r(n,a,o,s){for(var l=-1,c=t(e((a-n)/(o||1)),0),u=Array(c);c--;)u[s?c:++l]=n,n+=o;return u}return W1=r,W1}var H1,Y3;function tL(){if(Y3)return H1;Y3=1;var e=wD(),t=1/0,r=17976931348623157e292;function n(a){if(!a)return a===0?a:0;if(a=e(a),a===t||a===-t){var o=a<0?-1:1;return o*r}return a===a?a:0}return H1=n,H1}var V1,K3;function rZ(){if(K3)return V1;K3=1;var e=tZ(),t=Zv(),r=tL();function n(a){return function(o,s,l){return l&&typeof l!="number"&&t(o,s,l)&&(s=l=void 0),o=r(o),s===void 0?(s=o,o=0):s=r(s),l=l===void 0?o<s?1:-1:r(l),e(o,s,l,a)}}return V1=n,V1}var G1,Q3;function nZ(){if(Q3)return G1;Q3=1;var e=rZ(),t=e();return G1=t,G1}var aZ=nZ();const ev=It(aZ);function bp(e){"@babel/helpers - typeof";return bp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bp(e)}function X3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function J3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?X3(Object(r),!0).forEach(function(n){rL(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rL(e,t,r){return t=iZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function iZ(e){var t=oZ(e,"string");return bp(t)=="symbol"?t:t+""}function oZ(e,t){if(bp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(bp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var sZ=["Webkit","Moz","O","ms"],lZ=function(t,r){var n=t.replace(/(\w)/,function(o){return o.toUpperCase()}),a=sZ.reduce(function(o,s){return J3(J3({},o),{},rL({},s+n,r))},{});return a[t]=r,a};function hd(e){"@babel/helpers - typeof";return hd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hd(e)}function tv(){return tv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},tv.apply(this,arguments)}function Z3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Y1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Z3(Object(r),!0).forEach(function(n){vo(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function cZ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function eT(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,aL(n.key),n)}}function uZ(e,t,r){return t&&eT(e.prototype,t),r&&eT(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function dZ(e,t,r){return t=rv(t),fZ(e,nL()?Reflect.construct(t,r||[],rv(e).constructor):t.apply(e,r))}function fZ(e,t){if(t&&(hd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return hZ(e)}function hZ(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nL=function(){return!!e})()}function rv(e){return rv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},rv(e)}function pZ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&X_(e,t)}function X_(e,t){return X_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},X_(e,t)}function vo(e,t,r){return t=aL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aL(e){var t=mZ(e,"string");return hd(t)=="symbol"?t:t+""}function mZ(e,t){if(hd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(hd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var gZ=function(t){var r=t.data,n=t.startIndex,a=t.endIndex,o=t.x,s=t.width,l=t.travellerWidth;if(!r||!r.length)return{};var c=r.length,u=Th().domain(ev(0,c)).range([o,o+s-l]),d=u.domain().map(function(f){return u(f)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:u(n),endX:u(a),scale:u,scaleValues:d}},tT=function(t){return t.changedTouches&&!!t.changedTouches.length},pd=function(e){function t(r){var n;return cZ(this,t),n=dZ(this,t,[r]),vo(n,"handleDrag",function(a){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(a):n.state.isSlideMoving&&n.handleSlideDrag(a)}),vo(n,"handleTouchMove",function(a){a.changedTouches!=null&&a.changedTouches.length>0&&n.handleDrag(a.changedTouches[0])}),vo(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var a=n.props,o=a.endIndex,s=a.onDragEnd,l=a.startIndex;s?.({endIndex:o,startIndex:l})}),n.detachDragEndListener()}),vo(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),vo(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),vo(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),vo(n,"handleSlideDragStart",function(a){var o=tT(a)?a.changedTouches[0]:a;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:o.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return pZ(t,e),uZ(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var a=n.startX,o=n.endX,s=this.state.scaleValues,l=this.props,c=l.gap,u=l.data,d=u.length-1,f=Math.min(a,o),h=Math.max(a,o),p=t.getIndexInRange(s,f),g=t.getIndexInRange(s,h);return{startIndex:p-p%c,endIndex:g===d?d:g-g%c}}},{key:"getTextOfTick",value:function(n){var a=this.props,o=a.data,s=a.tickFormatter,l=a.dataKey,c=Ga(o[n],l,n);return Rr(s)?s(c,n):c}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var a=this.state,o=a.slideMoveStartX,s=a.startX,l=a.endX,c=this.props,u=c.x,d=c.width,f=c.travellerWidth,h=c.startIndex,p=c.endIndex,g=c.onChange,m=n.pageX-o;m>0?m=Math.min(m,u+d-f-l,u+d-f-s):m<0&&(m=Math.max(m,u-s,u-l));var x=this.getIndex({startX:s+m,endX:l+m});(x.startIndex!==h||x.endIndex!==p)&&g&&g(x),this.setState({startX:s+m,endX:l+m,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,a){var o=tT(a)?a.changedTouches[0]:a;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:o.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var a=this.state,o=a.brushMoveStartX,s=a.movingTravellerId,l=a.endX,c=a.startX,u=this.state[s],d=this.props,f=d.x,h=d.width,p=d.travellerWidth,g=d.onChange,m=d.gap,x=d.data,b={startX:this.state.startX,endX:this.state.endX},_=n.pageX-o;_>0?_=Math.min(_,f+h-p-u):_<0&&(_=Math.max(_,f-u)),b[s]=u+_;var w=this.getIndex(b),A=w.startIndex,O=w.endIndex,T=function(){var S=x.length-1;return s==="startX"&&(l>c?A%m===0:O%m===0)||l<c&&O===S||s==="endX"&&(l>c?O%m===0:A%m===0)||l>c&&O===S};this.setState(vo(vo({},s,u+_),"brushMoveStartX",n.pageX),function(){g&&T()&&g(w)})}},{key:"handleTravellerMoveKeyboard",value:function(n,a){var o=this,s=this.state,l=s.scaleValues,c=s.startX,u=s.endX,d=this.state[a],f=l.indexOf(d);if(f!==-1){var h=f+n;if(!(h===-1||h>=l.length)){var p=l[h];a==="startX"&&p>=u||a==="endX"&&p<=c||this.setState(vo({},a,p),function(){o.props.onChange(o.getIndex({startX:o.state.startX,endX:o.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,a=n.x,o=n.y,s=n.width,l=n.height,c=n.fill,u=n.stroke;return Ce.createElement("rect",{stroke:u,fill:c,x:a,y:o,width:s,height:l})}},{key:"renderPanorama",value:function(){var n=this.props,a=n.x,o=n.y,s=n.width,l=n.height,c=n.data,u=n.children,d=n.padding,f=y.Children.only(u);return f?Ce.cloneElement(f,{x:a,y:o,width:s,height:l,margin:d,compact:!0,data:c}):null}},{key:"renderTravellerLayer",value:function(n,a){var o,s,l=this,c=this.props,u=c.y,d=c.travellerWidth,f=c.height,h=c.traveller,p=c.ariaLabel,g=c.data,m=c.startIndex,x=c.endIndex,b=Math.max(n,this.props.x),_=Y1(Y1({},_r(this.props,!1)),{},{x:b,y:u,width:d,height:f}),w=p||"Min value: ".concat((o=g[m])===null||o===void 0?void 0:o.name,", Max value: ").concat((s=g[x])===null||s===void 0?void 0:s.name);return Ce.createElement(pn,{tabIndex:0,role:"slider","aria-label":w,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[a],onTouchStart:this.travellerDragStartHandlers[a],onKeyDown:function(O){["ArrowLeft","ArrowRight"].includes(O.key)&&(O.preventDefault(),O.stopPropagation(),l.handleTravellerMoveKeyboard(O.key==="ArrowRight"?1:-1,a))},onFocus:function(){l.setState({isTravellerFocused:!0})},onBlur:function(){l.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(h,_))}},{key:"renderSlide",value:function(n,a){var o=this.props,s=o.y,l=o.height,c=o.stroke,u=o.travellerWidth,d=Math.min(n,a)+u,f=Math.max(Math.abs(a-n)-u,0);return Ce.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:c,fillOpacity:.2,x:d,y:s,width:f,height:l})}},{key:"renderText",value:function(){var n=this.props,a=n.startIndex,o=n.endIndex,s=n.y,l=n.height,c=n.travellerWidth,u=n.stroke,d=this.state,f=d.startX,h=d.endX,p=5,g={pointerEvents:"none",fill:u};return Ce.createElement(pn,{className:"recharts-brush-texts"},Ce.createElement(Kc,tv({textAnchor:"end",verticalAnchor:"middle",x:Math.min(f,h)-p,y:s+l/2},g),this.getTextOfTick(a)),Ce.createElement(Kc,tv({textAnchor:"start",verticalAnchor:"middle",x:Math.max(f,h)+c+p,y:s+l/2},g),this.getTextOfTick(o)))}},{key:"render",value:function(){var n=this.props,a=n.data,o=n.className,s=n.children,l=n.x,c=n.y,u=n.width,d=n.height,f=n.alwaysShowText,h=this.state,p=h.startX,g=h.endX,m=h.isTextActive,x=h.isSlideMoving,b=h.isTravellerMoving,_=h.isTravellerFocused;if(!a||!a.length||!Mt(l)||!Mt(c)||!Mt(u)||!Mt(d)||u<=0||d<=0)return null;var w=Nr("recharts-brush",o),A=Ce.Children.count(s)===1,O=lZ("userSelect","none");return Ce.createElement(pn,{className:w,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:O},this.renderBackground(),A&&this.renderPanorama(),this.renderSlide(p,g),this.renderTravellerLayer(p,"startX"),this.renderTravellerLayer(g,"endX"),(m||x||b||_||f)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var a=n.x,o=n.y,s=n.width,l=n.height,c=n.stroke,u=Math.floor(o+l/2)-1;return Ce.createElement(Ce.Fragment,null,Ce.createElement("rect",{x:a,y:o,width:s,height:l,fill:c,stroke:"none"}),Ce.createElement("line",{x1:a+1,y1:u,x2:a+s-1,y2:u,fill:"none",stroke:"#fff"}),Ce.createElement("line",{x1:a+1,y1:u+2,x2:a+s-1,y2:u+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,a){var o;return Ce.isValidElement(n)?o=Ce.cloneElement(n,a):Rr(n)?o=n(a):o=t.renderDefaultTraveller(a),o}},{key:"getDerivedStateFromProps",value:function(n,a){var o=n.data,s=n.width,l=n.x,c=n.travellerWidth,u=n.updateId,d=n.startIndex,f=n.endIndex;if(o!==a.prevData||u!==a.prevUpdateId)return Y1({prevData:o,prevTravellerWidth:c,prevUpdateId:u,prevX:l,prevWidth:s},o&&o.length?gZ({data:o,width:s,x:l,travellerWidth:c,startIndex:d,endIndex:f}):{scale:null,scaleValues:null});if(a.scale&&(s!==a.prevWidth||l!==a.prevX||c!==a.prevTravellerWidth)){a.scale.range([l,l+s-c]);var h=a.scale.domain().map(function(p){return a.scale(p)});return{prevData:o,prevTravellerWidth:c,prevUpdateId:u,prevX:l,prevWidth:s,startX:a.scale(n.startIndex),endX:a.scale(n.endIndex),scaleValues:h}}return null}},{key:"getIndexInRange",value:function(n,a){for(var o=n.length,s=0,l=o-1;l-s>1;){var c=Math.floor((s+l)/2);n[c]>a?l=c:s=c}return a>=n[l]?l:s}}])}(y.PureComponent);vo(pd,"displayName","Brush");vo(pd,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var K1,rT;function vZ(){if(rT)return K1;rT=1;var e=Oj();function t(r,n){var a;return e(r,function(o,s,l){return a=n(o,s,l),!a}),!!a}return K1=t,K1}var Q1,nT;function yZ(){if(nT)return Q1;nT=1;var e=ZN(),t=Rs(),r=vZ(),n=eo(),a=Zv();function o(s,l,c){var u=n(s)?e:r;return c&&a(s,l,c)&&(l=void 0),u(s,t(l,3))}return Q1=o,Q1}var xZ=yZ();const bZ=It(xZ);var As=function(t,r){var n=t.alwaysShow,a=t.ifOverflow;return n&&(a="extendDomain"),a===r},X1,aT;function _Z(){if(aT)return X1;aT=1;var e=vD();function t(r,n,a){n=="__proto__"&&e?e(r,n,{configurable:!0,enumerable:!0,value:a,writable:!0}):r[n]=a}return X1=t,X1}var J1,iT;function wZ(){if(iT)return J1;iT=1;var e=_Z(),t=mD(),r=Rs();function n(a,o){var s={};return o=r(o,3),t(a,function(l,c,u){e(s,c,o(l,c,u))}),s}return J1=n,J1}var jZ=wZ();const SZ=It(jZ);var Z1,oT;function CZ(){if(oT)return Z1;oT=1;function e(t,r){for(var n=-1,a=t==null?0:t.length;++n<a;)if(!r(t[n],n,t))return!1;return!0}return Z1=e,Z1}var e2,sT;function AZ(){if(sT)return e2;sT=1;var e=Oj();function t(r,n){var a=!0;return e(r,function(o,s,l){return a=!!n(o,s,l),a}),a}return e2=t,e2}var t2,lT;function PZ(){if(lT)return t2;lT=1;var e=CZ(),t=AZ(),r=Rs(),n=eo(),a=Zv();function o(s,l,c){var u=n(s)?e:t;return c&&a(s,l,c)&&(l=void 0),u(s,r(l,3))}return t2=o,t2}var OZ=PZ();const iL=It(OZ);var kZ=["x","y"];function _p(e){"@babel/helpers - typeof";return _p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_p(e)}function J_(){return J_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},J_.apply(this,arguments)}function cT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function yf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?cT(Object(r),!0).forEach(function(n){TZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function TZ(e,t,r){return t=EZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function EZ(e){var t=IZ(e,"string");return _p(t)=="symbol"?t:t+""}function IZ(e,t){if(_p(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(_p(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function NZ(e,t){if(e==null)return{};var r=DZ(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function DZ(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function MZ(e,t){var r=e.x,n=e.y,a=NZ(e,kZ),o="".concat(r),s=parseInt(o,10),l="".concat(n),c=parseInt(l,10),u="".concat(t.height||a.height),d=parseInt(u,10),f="".concat(t.width||a.width),h=parseInt(f,10);return yf(yf(yf(yf(yf({},t),a),s?{x:s}:{}),c?{y:c}:{}),{},{height:d,width:h,name:t.name,radius:t.radius})}function uT(e){return Ce.createElement(JM,J_({shapeType:"rectangle",propTransformer:MZ,activeClassName:"recharts-active-bar"},e))}var LZ=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,a){if(typeof t=="number")return t;var o=typeof n=="number";return o?t(n,a):(o||Xc(),r)}},RZ=["value","background"],oL;function md(e){"@babel/helpers - typeof";return md=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},md(e)}function qZ(e,t){if(e==null)return{};var r=FZ(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function FZ(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function nv(){return nv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nv.apply(this,arguments)}function dT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function qa(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?dT(Object(r),!0).forEach(function(n){Kl(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $Z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fT(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,lL(n.key),n)}}function BZ(e,t,r){return t&&fT(e.prototype,t),r&&fT(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function UZ(e,t,r){return t=av(t),zZ(e,sL()?Reflect.construct(t,r||[],av(e).constructor):t.apply(e,r))}function zZ(e,t){if(t&&(md(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return WZ(e)}function WZ(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function sL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(sL=function(){return!!e})()}function av(e){return av=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},av(e)}function HZ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Z_(e,t)}function Z_(e,t){return Z_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Z_(e,t)}function Kl(e,t,r){return t=lL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lL(e){var t=VZ(e,"string");return md(t)=="symbol"?t:t+""}function VZ(e,t){if(md(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(md(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var yl=function(e){function t(){var r;$Z(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return r=UZ(this,t,[].concat(a)),Kl(r,"state",{isAnimationFinished:!1}),Kl(r,"id",qd("recharts-bar-")),Kl(r,"handleAnimationEnd",function(){var s=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),s&&s()}),Kl(r,"handleAnimationStart",function(){var s=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),s&&s()}),r}return HZ(t,e),BZ(t,[{key:"renderRectanglesStatically",value:function(n){var a=this,o=this.props,s=o.shape,l=o.dataKey,c=o.activeIndex,u=o.activeBar,d=_r(this.props,!1);return n&&n.map(function(f,h){var p=h===c,g=p?u:s,m=qa(qa(qa({},d),f),{},{isActive:p,option:g,index:h,dataKey:l,onAnimationStart:a.handleAnimationStart,onAnimationEnd:a.handleAnimationEnd});return Ce.createElement(pn,nv({className:"recharts-bar-rectangle"},Yc(a.props,f,h),{key:"rectangle-".concat(f?.x,"-").concat(f?.y,"-").concat(f?.value,"-").concat(h)}),Ce.createElement(uT,m))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,a=this.props,o=a.data,s=a.layout,l=a.isAnimationActive,c=a.animationBegin,u=a.animationDuration,d=a.animationEasing,f=a.animationId,h=this.state.prevData;return Ce.createElement(Ts,{begin:c,duration:u,isActive:l,easing:d,from:{t:0},to:{t:1},key:"bar-".concat(f),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(p){var g=p.t,m=o.map(function(x,b){var _=h&&h[b];if(_){var w=_o(_.x,x.x),A=_o(_.y,x.y),O=_o(_.width,x.width),T=_o(_.height,x.height);return qa(qa({},x),{},{x:w(g),y:A(g),width:O(g),height:T(g)})}if(s==="horizontal"){var E=_o(0,x.height),S=E(g);return qa(qa({},x),{},{y:x.y+x.height-S,height:S})}var I=_o(0,x.width),z=I(g);return qa(qa({},x),{},{width:z})});return Ce.createElement(pn,null,n.renderRectanglesStatically(m))})}},{key:"renderRectangles",value:function(){var n=this.props,a=n.data,o=n.isAnimationActive,s=this.state.prevData;return o&&a&&a.length&&(!s||!Up(s,a))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(a)}},{key:"renderBackground",value:function(){var n=this,a=this.props,o=a.data,s=a.dataKey,l=a.activeIndex,c=_r(this.props.background,!1);return o.map(function(u,d){u.value;var f=u.background,h=qZ(u,RZ);if(!f)return null;var p=qa(qa(qa(qa(qa({},h),{},{fill:"#eee"},f),c),Yc(n.props,u,d)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:s,index:d,className:"recharts-bar-background-rectangle"});return Ce.createElement(uT,nv({key:"background-bar-".concat(d),option:n.props.background,isActive:d===l},p))})}},{key:"renderErrorBar",value:function(n,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,s=o.data,l=o.xAxis,c=o.yAxis,u=o.layout,d=o.children,f=Ao(d,zp);if(!f)return null;var h=u==="vertical"?s[0].height/2:s[0].width/2,p=function(x,b){var _=Array.isArray(x.value)?x.value[1]:x.value;return{x:x.x,y:x.y,value:_,errorVal:Ga(x,b)}},g={clipPath:n?"url(#clipPath-".concat(a,")"):null};return Ce.createElement(pn,g,f.map(function(m){return Ce.cloneElement(m,{key:"error-bar-".concat(a,"-").concat(m.props.dataKey),data:s,xAxis:l,yAxis:c,layout:u,offset:h,dataPointFormatter:p})}))}},{key:"render",value:function(){var n=this.props,a=n.hide,o=n.data,s=n.className,l=n.xAxis,c=n.yAxis,u=n.left,d=n.top,f=n.width,h=n.height,p=n.isAnimationActive,g=n.background,m=n.id;if(a||!o||!o.length)return null;var x=this.state.isAnimationFinished,b=Nr("recharts-bar",s),_=l&&l.allowDataOverflow,w=c&&c.allowDataOverflow,A=_||w,O=Ur(m)?this.id:m;return Ce.createElement(pn,{className:b},_||w?Ce.createElement("defs",null,Ce.createElement("clipPath",{id:"clipPath-".concat(O)},Ce.createElement("rect",{x:_?u:u-f/2,y:w?d:d-h/2,width:_?f:f*2,height:w?h:h*2}))):null,Ce.createElement(pn,{className:"recharts-bar-rectangles",clipPath:A?"url(#clipPath-".concat(O,")"):null},g?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(A,O),(!p||x)&&fl.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:a.curData}:n.data!==a.curData?{curData:n.data}:null}}])}(y.PureComponent);oL=yl;Kl(yl,"displayName","Bar");Kl(yl,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!iu.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});Kl(yl,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,a=e.bandSize,o=e.xAxis,s=e.yAxis,l=e.xAxisTicks,c=e.yAxisTicks,u=e.stackedData,d=e.dataStartIndex,f=e.displayedData,h=e.offset,p=CY(n,r);if(!p)return null;var g=t.layout,m=r.type.defaultProps,x=m!==void 0?qa(qa({},m),r.props):r.props,b=x.dataKey,_=x.children,w=x.minPointSize,A=g==="horizontal"?s:o,O=u?A.scale.domain():null,T=IY({numericAxis:A}),E=Ao(_,ey),S=f.map(function(I,z){var k,M,R,F,W,K;u?k=AY(u[d+z],O):(k=Ga(I,b),Array.isArray(k)||(k=[T,k]));var Z=LZ(w,oL.defaultProps.minPointSize)(k[1],z);if(g==="horizontal"){var D,P=[s.scale(k[0]),s.scale(k[1])],$=P[0],Q=P[1];M=$k({axis:o,ticks:l,bandSize:a,offset:p.offset,entry:I,index:z}),R=(D=Q??$)!==null&&D!==void 0?D:void 0,F=p.size;var C=$-Q;if(W=Number.isNaN(C)?0:C,K={x:M,y:s.y,width:F,height:s.height},Math.abs(Z)>0&&Math.abs(W)<Math.abs(Z)){var L=Li(W||Z)*(Math.abs(Z)-Math.abs(W));R-=L,W+=L}}else{var H=[o.scale(k[0]),o.scale(k[1])],U=H[0],te=H[1];if(M=U,R=$k({axis:s,ticks:c,bandSize:a,offset:p.offset,entry:I,index:z}),F=te-U,W=p.size,K={x:o.x,y:R,width:o.width,height:W},Math.abs(Z)>0&&Math.abs(F)<Math.abs(Z)){var le=Li(F||Z)*(Math.abs(Z)-Math.abs(F));F+=le}}return qa(qa(qa({},I),{},{x:M,y:R,width:F,height:W,value:u?k:k[1],payload:I,background:K},E&&E[z]&&E[z].props),{},{tooltipPayload:[DM(r,I)],tooltipPosition:{x:M+F/2,y:R+W/2}})});return qa({data:S,layout:g},h)});function wp(e){"@babel/helpers - typeof";return wp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wp(e)}function GZ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function hT(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,cL(n.key),n)}}function YZ(e,t,r){return t&&hT(e.prototype,t),r&&hT(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function pT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function rs(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?pT(Object(r),!0).forEach(function(n){xy(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xy(e,t,r){return t=cL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cL(e){var t=KZ(e,"string");return wp(t)=="symbol"?t:t+""}function KZ(e,t){if(wp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(wp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var uL=function(t,r,n,a,o){var s=t.width,l=t.height,c=t.layout,u=t.children,d=Object.keys(r),f={left:n.left,leftMirror:n.left,right:s-n.right,rightMirror:s-n.right,top:n.top,topMirror:n.top,bottom:l-n.bottom,bottomMirror:l-n.bottom},h=!!yo(u,yl);return d.reduce(function(p,g){var m=r[g],x=m.orientation,b=m.domain,_=m.padding,w=_===void 0?{}:_,A=m.mirror,O=m.reversed,T="".concat(x).concat(A?"Mirror":""),E,S,I,z,k;if(m.type==="number"&&(m.padding==="gap"||m.padding==="no-gap")){var M=b[1]-b[0],R=1/0,F=m.categoricalDomain.sort(hB);if(F.forEach(function(H,U){U>0&&(R=Math.min((H||0)-(F[U-1]||0),R))}),Number.isFinite(R)){var W=R/M,K=m.layout==="vertical"?n.height:n.width;if(m.padding==="gap"&&(E=W*K/2),m.padding==="no-gap"){var Z=Ri(t.barCategoryGap,W*K),D=W*K/2;E=D-Z-(D-Z)/K*Z}}}a==="xAxis"?S=[n.left+(w.left||0)+(E||0),n.left+n.width-(w.right||0)-(E||0)]:a==="yAxis"?S=c==="horizontal"?[n.top+n.height-(w.bottom||0),n.top+(w.top||0)]:[n.top+(w.top||0)+(E||0),n.top+n.height-(w.bottom||0)-(E||0)]:S=m.range,O&&(S=[S[1],S[0]]);var P=TM(m,o,h),$=P.scale,Q=P.realScaleType;$.domain(b).range(S),EM($);var C=IM($,rs(rs({},m),{},{realScaleType:Q}));a==="xAxis"?(k=x==="top"&&!A||x==="bottom"&&A,I=n.left,z=f[T]-k*m.height):a==="yAxis"&&(k=x==="left"&&!A||x==="right"&&A,I=f[T]-k*m.width,z=n.top);var L=rs(rs(rs({},m),C),{},{realScaleType:Q,x:I,y:z,scale:$,width:a==="xAxis"?n.width:m.width,height:a==="yAxis"?n.height:m.height});return L.bandSize=Bg(L,C),!m.hide&&a==="xAxis"?f[T]+=(k?-1:1)*L.height:m.hide||(f[T]+=(k?-1:1)*L.width),rs(rs({},p),{},xy({},g,L))},{})},dL=function(t,r){var n=t.x,a=t.y,o=r.x,s=r.y;return{x:Math.min(n,o),y:Math.min(a,s),width:Math.abs(o-n),height:Math.abs(s-a)}},QZ=function(t){var r=t.x1,n=t.y1,a=t.x2,o=t.y2;return dL({x:r,y:n},{x:a,y:o})},fL=function(){function e(t){GZ(this,e),this.scale=t}return YZ(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.bandAware,o=n.position;if(r!==void 0){if(o)switch(o){case"start":return this.scale(r);case"middle":{var s=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+s}case"end":{var l=this.bandwidth?this.bandwidth():0;return this.scale(r)+l}default:return this.scale(r)}if(a){var c=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+c}return this.scale(r)}}},{key:"isInRange",value:function(r){var n=this.range(),a=n[0],o=n[n.length-1];return a<=o?r>=a&&r<=o:r>=o&&r<=a}}],[{key:"create",value:function(r){return new e(r)}}])}();xy(fL,"EPS",1e-4);var nS=function(t){var r=Object.keys(t).reduce(function(n,a){return rs(rs({},n),{},xy({},a,fL.create(t[a])))},{});return rs(rs({},r),{},{apply:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=o.bandAware,l=o.position;return SZ(a,function(c,u){return r[u].apply(c,{bandAware:s,position:l})})},isInRange:function(a){return iL(a,function(o,s){return r[s].isInRange(o)})}})};function XZ(e){return(e%180+180)%180}var JZ=function(t){var r=t.width,n=t.height,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=XZ(a),s=o*Math.PI/180,l=Math.atan(n/r),c=s>l&&s<Math.PI-l?n/Math.sin(s):r/Math.cos(s);return Math.abs(c)},r2,mT;function ZZ(){if(mT)return r2;mT=1;var e=Rs(),t=Rp(),r=Xv();function n(a){return function(o,s,l){var c=Object(o);if(!t(o)){var u=e(s,3);o=r(o),s=function(f){return u(c[f],f,c)}}var d=a(o,s,l);return d>-1?c[u?o[d]:d]:void 0}}return r2=n,r2}var n2,gT;function eee(){if(gT)return n2;gT=1;var e=tL();function t(r){var n=e(r),a=n%1;return n===n?a?n-a:n:0}return n2=t,n2}var a2,vT;function tee(){if(vT)return a2;vT=1;var e=uD(),t=Rs(),r=eee(),n=Math.max;function a(o,s,l){var c=o==null?0:o.length;if(!c)return-1;var u=l==null?0:r(l);return u<0&&(u=n(c+u,0)),e(o,t(s,3),u)}return a2=a,a2}var i2,yT;function ree(){if(yT)return i2;yT=1;var e=ZZ(),t=tee(),r=e(t);return i2=r,i2}var nee=ree();const aee=It(nee);var iee=AN();const oee=It(iee);var see=oee(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),aS=y.createContext(void 0),iS=y.createContext(void 0),hL=y.createContext(void 0),pL=y.createContext({}),mL=y.createContext(void 0),gL=y.createContext(0),vL=y.createContext(0),xT=function(t){var r=t.state,n=r.xAxisMap,a=r.yAxisMap,o=r.offset,s=t.clipPathId,l=t.children,c=t.width,u=t.height,d=see(o);return Ce.createElement(aS.Provider,{value:n},Ce.createElement(iS.Provider,{value:a},Ce.createElement(pL.Provider,{value:o},Ce.createElement(hL.Provider,{value:d},Ce.createElement(mL.Provider,{value:s},Ce.createElement(gL.Provider,{value:u},Ce.createElement(vL.Provider,{value:c},l)))))))},lee=function(){return y.useContext(mL)},yL=function(t){var r=y.useContext(aS);r==null&&Xc();var n=r[t];return n==null&&Xc(),n},cee=function(){var t=y.useContext(aS);return Gl(t)},uee=function(){var t=y.useContext(iS),r=aee(t,function(n){return iL(n.domain,Number.isFinite)});return r||Gl(t)},xL=function(t){var r=y.useContext(iS);r==null&&Xc();var n=r[t];return n==null&&Xc(),n},dee=function(){var t=y.useContext(hL);return t},fee=function(){return y.useContext(pL)},oS=function(){return y.useContext(vL)},sS=function(){return y.useContext(gL)};function gd(e){"@babel/helpers - typeof";return gd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gd(e)}function hee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pee(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_L(n.key),n)}}function mee(e,t,r){return t&&pee(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function gee(e,t,r){return t=iv(t),vee(e,bL()?Reflect.construct(t,r||[],iv(e).constructor):t.apply(e,r))}function vee(e,t){if(t&&(gd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return yee(e)}function yee(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(bL=function(){return!!e})()}function iv(e){return iv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},iv(e)}function xee(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ew(e,t)}function ew(e,t){return ew=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},ew(e,t)}function bT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _T(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?bT(Object(r),!0).forEach(function(n){lS(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function lS(e,t,r){return t=_L(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _L(e){var t=bee(e,"string");return gd(t)=="symbol"?t:t+""}function bee(e,t){if(gd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(gd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function _ee(e,t){return Cee(e)||See(e,t)||jee(e,t)||wee()}function wee(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jee(e,t){if(e){if(typeof e=="string")return wT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wT(e,t)}}function wT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function See(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function Cee(e){if(Array.isArray(e))return e}function tw(){return tw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},tw.apply(this,arguments)}var Aee=function(t,r){var n;return Ce.isValidElement(t)?n=Ce.cloneElement(t,r):Rr(t)?n=t(r):n=Ce.createElement("line",tw({},r,{className:"recharts-reference-line-line"})),n},Pee=function(t,r,n,a,o,s,l,c,u){var d=o.x,f=o.y,h=o.width,p=o.height;if(n){var g=u.y,m=t.y.apply(g,{position:s});if(As(u,"discard")&&!t.y.isInRange(m))return null;var x=[{x:d+h,y:m},{x:d,y:m}];return c==="left"?x.reverse():x}if(r){var b=u.x,_=t.x.apply(b,{position:s});if(As(u,"discard")&&!t.x.isInRange(_))return null;var w=[{x:_,y:f+p},{x:_,y:f}];return l==="top"?w.reverse():w}if(a){var A=u.segment,O=A.map(function(T){return t.apply(T,{position:s})});return As(u,"discard")&&bZ(O,function(T){return!t.isInRange(T)})?null:O}return null};function Oee(e){var t=e.x,r=e.y,n=e.segment,a=e.xAxisId,o=e.yAxisId,s=e.shape,l=e.className,c=e.alwaysShow,u=lee(),d=yL(a),f=xL(o),h=dee();if(!u||!h)return null;is(c===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var p=nS({x:d.scale,y:f.scale}),g=Ya(t),m=Ya(r),x=n&&n.length===2,b=Pee(p,g,m,x,h,e.position,d.orientation,f.orientation,e);if(!b)return null;var _=_ee(b,2),w=_[0],A=w.x,O=w.y,T=_[1],E=T.x,S=T.y,I=As(e,"hidden")?"url(#".concat(u,")"):void 0,z=_T(_T({clipPath:I},_r(e,!0)),{},{x1:A,y1:O,x2:E,y2:S});return Ce.createElement(pn,{className:Nr("recharts-reference-line",l)},Aee(s,z),ti.renderCallByParent(e,QZ({x1:A,y1:O,x2:E,y2:S})))}var cS=function(e){function t(){return hee(this,t),gee(this,t,arguments)}return xee(t,e),mee(t,[{key:"render",value:function(){return Ce.createElement(Oee,this.props)}}])}(Ce.Component);lS(cS,"displayName","ReferenceLine");lS(cS,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function rw(){return rw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},rw.apply(this,arguments)}function vd(e){"@babel/helpers - typeof";return vd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vd(e)}function jT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ST(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jT(Object(r),!0).forEach(function(n){by(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Tee(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,jL(n.key),n)}}function Eee(e,t,r){return t&&Tee(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Iee(e,t,r){return t=ov(t),Nee(e,wL()?Reflect.construct(t,r||[],ov(e).constructor):t.apply(e,r))}function Nee(e,t){if(t&&(vd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Dee(e)}function Dee(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(wL=function(){return!!e})()}function ov(e){return ov=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ov(e)}function Mee(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nw(e,t)}function nw(e,t){return nw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},nw(e,t)}function by(e,t,r){return t=jL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jL(e){var t=Lee(e,"string");return vd(t)=="symbol"?t:t+""}function Lee(e,t){if(vd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(vd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Ree=function(t){var r=t.x,n=t.y,a=t.xAxis,o=t.yAxis,s=nS({x:a.scale,y:o.scale}),l=s.apply({x:r,y:n},{bandAware:!0});return As(t,"discard")&&!s.isInRange(l)?null:l},_y=function(e){function t(){return kee(this,t),Iee(this,t,arguments)}return Mee(t,e),Eee(t,[{key:"render",value:function(){var n=this.props,a=n.x,o=n.y,s=n.r,l=n.alwaysShow,c=n.clipPathId,u=Ya(a),d=Ya(o);if(is(l===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!u||!d)return null;var f=Ree(this.props);if(!f)return null;var h=f.x,p=f.y,g=this.props,m=g.shape,x=g.className,b=As(this.props,"hidden")?"url(#".concat(c,")"):void 0,_=ST(ST({clipPath:b},_r(this.props,!0)),{},{cx:h,cy:p});return Ce.createElement(pn,{className:Nr("recharts-reference-dot",x)},t.renderDot(m,_),ti.renderCallByParent(this.props,{x:h-s,y:p-s,width:2*s,height:2*s}))}}])}(Ce.Component);by(_y,"displayName","ReferenceDot");by(_y,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});by(_y,"renderDot",function(e,t){var r;return Ce.isValidElement(e)?r=Ce.cloneElement(e,t):Rr(e)?r=e(t):r=Ce.createElement(fy,rw({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function aw(){return aw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},aw.apply(this,arguments)}function yd(e){"@babel/helpers - typeof";return yd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yd(e)}function CT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function AT(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CT(Object(r),!0).forEach(function(n){wy(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fee(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,CL(n.key),n)}}function $ee(e,t,r){return t&&Fee(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Bee(e,t,r){return t=sv(t),Uee(e,SL()?Reflect.construct(t,r||[],sv(e).constructor):t.apply(e,r))}function Uee(e,t){if(t&&(yd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return zee(e)}function zee(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function SL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(SL=function(){return!!e})()}function sv(e){return sv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},sv(e)}function Wee(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&iw(e,t)}function iw(e,t){return iw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},iw(e,t)}function wy(e,t,r){return t=CL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function CL(e){var t=Hee(e,"string");return yd(t)=="symbol"?t:t+""}function Hee(e,t){if(yd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(yd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Vee=function(t,r,n,a,o){var s=o.x1,l=o.x2,c=o.y1,u=o.y2,d=o.xAxis,f=o.yAxis;if(!d||!f)return null;var h=nS({x:d.scale,y:f.scale}),p={x:t?h.x.apply(s,{position:"start"}):h.x.rangeMin,y:n?h.y.apply(c,{position:"start"}):h.y.rangeMin},g={x:r?h.x.apply(l,{position:"end"}):h.x.rangeMax,y:a?h.y.apply(u,{position:"end"}):h.y.rangeMax};return As(o,"discard")&&(!h.isInRange(p)||!h.isInRange(g))?null:dL(p,g)},jy=function(e){function t(){return qee(this,t),Bee(this,t,arguments)}return Wee(t,e),$ee(t,[{key:"render",value:function(){var n=this.props,a=n.x1,o=n.x2,s=n.y1,l=n.y2,c=n.className,u=n.alwaysShow,d=n.clipPathId;is(u===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var f=Ya(a),h=Ya(o),p=Ya(s),g=Ya(l),m=this.props.shape;if(!f&&!h&&!p&&!g&&!m)return null;var x=Vee(f,h,p,g,this.props);if(!x&&!m)return null;var b=As(this.props,"hidden")?"url(#".concat(d,")"):void 0;return Ce.createElement(pn,{className:Nr("recharts-reference-area",c)},t.renderRect(m,AT(AT({clipPath:b},_r(this.props,!0)),x)),ti.renderCallByParent(this.props,x))}}])}(Ce.Component);wy(jy,"displayName","ReferenceArea");wy(jy,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});wy(jy,"renderRect",function(e,t){var r;return Ce.isValidElement(e)?r=Ce.cloneElement(e,t):Rr(e)?r=e(t):r=Ce.createElement(rS,aw({},t,{className:"recharts-reference-area-rect"})),r});function AL(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],a=0;a<e.length;a+=t)n.push(e[a]);return n}function Gee(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return JZ(n,r)}function Yee(e,t,r){var n=r==="width",a=e.x,o=e.y,s=e.width,l=e.height;return t===1?{start:n?a:o,end:n?a+s:o+l}:{start:n?a+s:o+l,end:n?a:o}}function lv(e,t,r,n,a){if(e*t<e*n||e*t>e*a)return!1;var o=r();return e*(t-e*o/2-n)>=0&&e*(t+e*o/2-a)<=0}function Kee(e,t){return AL(e,t+1)}function Qee(e,t,r,n,a){for(var o=(n||[]).slice(),s=t.start,l=t.end,c=0,u=1,d=s,f=function(){var g=n?.[c];if(g===void 0)return{v:AL(n,u)};var m=c,x,b=function(){return x===void 0&&(x=r(g,m)),x},_=g.coordinate,w=c===0||lv(e,_,b,d,l);w||(c=0,d=s,u+=1),w&&(d=_+e*(b()/2+a),c+=u)},h;u<=o.length;)if(h=f(),h)return h.v;return[]}function jp(e){"@babel/helpers - typeof";return jp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jp(e)}function PT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function xi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?PT(Object(r),!0).forEach(function(n){Xee(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):PT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Xee(e,t,r){return t=Jee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Jee(e){var t=Zee(e,"string");return jp(t)=="symbol"?t:t+""}function Zee(e,t){if(jp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(jp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ete(e,t,r,n,a){for(var o=(n||[]).slice(),s=o.length,l=t.start,c=t.end,u=function(h){var p=o[h],g,m=function(){return g===void 0&&(g=r(p,h)),g};if(h===s-1){var x=e*(p.coordinate+e*m()/2-c);o[h]=p=xi(xi({},p),{},{tickCoord:x>0?p.coordinate-x*e:p.coordinate})}else o[h]=p=xi(xi({},p),{},{tickCoord:p.coordinate});var b=lv(e,p.tickCoord,m,l,c);b&&(c=p.tickCoord-e*(m()/2+a),o[h]=xi(xi({},p),{},{isShow:!0}))},d=s-1;d>=0;d--)u(d);return o}function tte(e,t,r,n,a,o){var s=(n||[]).slice(),l=s.length,c=t.start,u=t.end;if(o){var d=n[l-1],f=r(d,l-1),h=e*(d.coordinate+e*f/2-u);s[l-1]=d=xi(xi({},d),{},{tickCoord:h>0?d.coordinate-h*e:d.coordinate});var p=lv(e,d.tickCoord,function(){return f},c,u);p&&(u=d.tickCoord-e*(f/2+a),s[l-1]=xi(xi({},d),{},{isShow:!0}))}for(var g=o?l-1:l,m=function(_){var w=s[_],A,O=function(){return A===void 0&&(A=r(w,_)),A};if(_===0){var T=e*(w.coordinate-e*O()/2-c);s[_]=w=xi(xi({},w),{},{tickCoord:T<0?w.coordinate-T*e:w.coordinate})}else s[_]=w=xi(xi({},w),{},{tickCoord:w.coordinate});var E=lv(e,w.tickCoord,O,c,u);E&&(c=w.tickCoord+e*(O()/2+a),s[_]=xi(xi({},w),{},{isShow:!0}))},x=0;x<g;x++)m(x);return s}function uS(e,t,r){var n=e.tick,a=e.ticks,o=e.viewBox,s=e.minTickGap,l=e.orientation,c=e.interval,u=e.tickFormatter,d=e.unit,f=e.angle;if(!a||!a.length||!n)return[];if(Mt(c)||iu.isSsr)return Kee(a,typeof c=="number"&&Mt(c)?c:0);var h=[],p=l==="top"||l==="bottom"?"width":"height",g=d&&p==="width"?kh(d,{fontSize:t,letterSpacing:r}):{width:0,height:0},m=function(w,A){var O=Rr(u)?u(w.value,A):w.value;return p==="width"?Gee(kh(O,{fontSize:t,letterSpacing:r}),g,f):kh(O,{fontSize:t,letterSpacing:r})[p]},x=a.length>=2?Li(a[1].coordinate-a[0].coordinate):1,b=Yee(o,x,p);return c==="equidistantPreserveStart"?Qee(x,b,m,a,s):(c==="preserveStart"||c==="preserveStartEnd"?h=tte(x,b,m,a,s,c==="preserveStartEnd"):h=ete(x,b,m,a,s),h.filter(function(_){return _.isShow}))}var rte=["viewBox"],nte=["viewBox"],ate=["ticks"];function xd(e){"@babel/helpers - typeof";return xd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xd(e)}function Mu(){return Mu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Mu.apply(this,arguments)}function OT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Di(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?OT(Object(r),!0).forEach(function(n){dS(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):OT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function o2(e,t){if(e==null)return{};var r=ite(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ite(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function ote(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kT(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,OL(n.key),n)}}function ste(e,t,r){return t&&kT(e.prototype,t),r&&kT(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function lte(e,t,r){return t=cv(t),cte(e,PL()?Reflect.construct(t,r||[],cv(e).constructor):t.apply(e,r))}function cte(e,t){if(t&&(xd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ute(e)}function ute(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function PL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(PL=function(){return!!e})()}function cv(e){return cv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},cv(e)}function dte(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ow(e,t)}function ow(e,t){return ow=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},ow(e,t)}function dS(e,t,r){return t=OL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function OL(e){var t=fte(e,"string");return xd(t)=="symbol"?t:t+""}function fte(e,t){if(xd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(xd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var zd=function(e){function t(r){var n;return ote(this,t),n=lte(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return dte(t,e),ste(t,[{key:"shouldComponentUpdate",value:function(n,a){var o=n.viewBox,s=o2(n,rte),l=this.props,c=l.viewBox,u=o2(l,nte);return!Hu(o,c)||!Hu(s,u)||!Hu(a,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var a=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];a&&this.setState({fontSize:window.getComputedStyle(a).fontSize,letterSpacing:window.getComputedStyle(a).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var a=this.props,o=a.x,s=a.y,l=a.width,c=a.height,u=a.orientation,d=a.tickSize,f=a.mirror,h=a.tickMargin,p,g,m,x,b,_,w=f?-1:1,A=n.tickSize||d,O=Mt(n.tickCoord)?n.tickCoord:n.coordinate;switch(u){case"top":p=g=n.coordinate,x=s+ +!f*c,m=x-w*A,_=m-w*h,b=O;break;case"left":m=x=n.coordinate,g=o+ +!f*l,p=g-w*A,b=p-w*h,_=O;break;case"right":m=x=n.coordinate,g=o+ +f*l,p=g+w*A,b=p+w*h,_=O;break;default:p=g=n.coordinate,x=s+ +f*c,m=x+w*A,_=m+w*h,b=O;break}return{line:{x1:p,y1:m,x2:g,y2:x},tick:{x:b,y:_}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,a=n.orientation,o=n.mirror,s;switch(a){case"left":s=o?"start":"end";break;case"right":s=o?"end":"start";break;default:s="middle";break}return s}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,a=n.orientation,o=n.mirror,s="end";switch(a){case"left":case"right":s="middle";break;case"top":s=o?"start":"end";break;default:s=o?"end":"start";break}return s}},{key:"renderAxisLine",value:function(){var n=this.props,a=n.x,o=n.y,s=n.width,l=n.height,c=n.orientation,u=n.mirror,d=n.axisLine,f=Di(Di(Di({},_r(this.props,!1)),_r(d,!1)),{},{fill:"none"});if(c==="top"||c==="bottom"){var h=+(c==="top"&&!u||c==="bottom"&&u);f=Di(Di({},f),{},{x1:a,y1:o+h*l,x2:a+s,y2:o+h*l})}else{var p=+(c==="left"&&!u||c==="right"&&u);f=Di(Di({},f),{},{x1:a+p*s,y1:o,x2:a+p*s,y2:o+l})}return Ce.createElement("line",Mu({},f,{className:Nr("recharts-cartesian-axis-line",Co(d,"className"))}))}},{key:"renderTicks",value:function(n,a,o){var s=this,l=this.props,c=l.tickLine,u=l.stroke,d=l.tick,f=l.tickFormatter,h=l.unit,p=uS(Di(Di({},this.props),{},{ticks:n}),a,o),g=this.getTickTextAnchor(),m=this.getTickVerticalAnchor(),x=_r(this.props,!1),b=_r(d,!1),_=Di(Di({},x),{},{fill:"none"},_r(c,!1)),w=p.map(function(A,O){var T=s.getTickLineCoord(A),E=T.line,S=T.tick,I=Di(Di(Di(Di({textAnchor:g,verticalAnchor:m},x),{},{stroke:"none",fill:u},b),S),{},{index:O,payload:A,visibleTicksCount:p.length,tickFormatter:f});return Ce.createElement(pn,Mu({className:"recharts-cartesian-axis-tick",key:"tick-".concat(A.value,"-").concat(A.coordinate,"-").concat(A.tickCoord)},Yc(s.props,A,O)),c&&Ce.createElement("line",Mu({},_,E,{className:Nr("recharts-cartesian-axis-tick-line",Co(c,"className"))})),d&&t.renderTickItem(d,I,"".concat(Rr(f)?f(A.value,O):A.value).concat(h||"")))});return Ce.createElement("g",{className:"recharts-cartesian-axis-ticks"},w)}},{key:"render",value:function(){var n=this,a=this.props,o=a.axisLine,s=a.width,l=a.height,c=a.ticksGenerator,u=a.className,d=a.hide;if(d)return null;var f=this.props,h=f.ticks,p=o2(f,ate),g=h;return Rr(c)&&(g=h&&h.length>0?c(this.props):c(p)),s<=0||l<=0||!g||!g.length?null:Ce.createElement(pn,{className:Nr("recharts-cartesian-axis",u),ref:function(x){n.layerReference=x}},o&&this.renderAxisLine(),this.renderTicks(g,this.state.fontSize,this.state.letterSpacing),ti.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,a,o){var s;return Ce.isValidElement(n)?s=Ce.cloneElement(n,a):Rr(n)?s=n(a):s=Ce.createElement(Kc,Mu({},a,{className:"recharts-cartesian-axis-tick-value"}),o),s}}])}(y.Component);dS(zd,"displayName","CartesianAxis");dS(zd,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var hte=["x1","y1","x2","y2","key"],pte=["offset"];function Jc(e){"@babel/helpers - typeof";return Jc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jc(e)}function TT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function bi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?TT(Object(r),!0).forEach(function(n){mte(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function mte(e,t,r){return t=gte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gte(e){var t=vte(e,"string");return Jc(t)=="symbol"?t:t+""}function vte(e,t){if(Jc(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Jc(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function qc(){return qc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qc.apply(this,arguments)}function ET(e,t){if(e==null)return{};var r=yte(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function yte(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var xte=function(t){var r=t.fill;if(!r||r==="none")return null;var n=t.fillOpacity,a=t.x,o=t.y,s=t.width,l=t.height,c=t.ry;return Ce.createElement("rect",{x:a,y:o,ry:c,width:s,height:l,stroke:"none",fill:r,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function kL(e,t){var r;if(Ce.isValidElement(e))r=Ce.cloneElement(e,t);else if(Rr(e))r=e(t);else{var n=t.x1,a=t.y1,o=t.x2,s=t.y2,l=t.key,c=ET(t,hte),u=_r(c,!1);u.offset;var d=ET(u,pte);r=Ce.createElement("line",qc({},d,{x1:n,y1:a,x2:o,y2:s,fill:"none",key:l}))}return r}function bte(e){var t=e.x,r=e.width,n=e.horizontal,a=n===void 0?!0:n,o=e.horizontalPoints;if(!a||!o||!o.length)return null;var s=o.map(function(l,c){var u=bi(bi({},e),{},{x1:t,y1:l,x2:t+r,y2:l,key:"line-".concat(c),index:c});return kL(a,u)});return Ce.createElement("g",{className:"recharts-cartesian-grid-horizontal"},s)}function _te(e){var t=e.y,r=e.height,n=e.vertical,a=n===void 0?!0:n,o=e.verticalPoints;if(!a||!o||!o.length)return null;var s=o.map(function(l,c){var u=bi(bi({},e),{},{x1:l,y1:t,x2:l,y2:t+r,key:"line-".concat(c),index:c});return kL(a,u)});return Ce.createElement("g",{className:"recharts-cartesian-grid-vertical"},s)}function wte(e){var t=e.horizontalFill,r=e.fillOpacity,n=e.x,a=e.y,o=e.width,s=e.height,l=e.horizontalPoints,c=e.horizontal,u=c===void 0?!0:c;if(!u||!t||!t.length)return null;var d=l.map(function(h){return Math.round(h+a-a)}).sort(function(h,p){return h-p});a!==d[0]&&d.unshift(0);var f=d.map(function(h,p){var g=!d[p+1],m=g?a+s-h:d[p+1]-h;if(m<=0)return null;var x=p%t.length;return Ce.createElement("rect",{key:"react-".concat(p),y:h,x:n,height:m,width:o,stroke:"none",fill:t[x],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return Ce.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},f)}function jte(e){var t=e.vertical,r=t===void 0?!0:t,n=e.verticalFill,a=e.fillOpacity,o=e.x,s=e.y,l=e.width,c=e.height,u=e.verticalPoints;if(!r||!n||!n.length)return null;var d=u.map(function(h){return Math.round(h+o-o)}).sort(function(h,p){return h-p});o!==d[0]&&d.unshift(0);var f=d.map(function(h,p){var g=!d[p+1],m=g?o+l-h:d[p+1]-h;if(m<=0)return null;var x=p%n.length;return Ce.createElement("rect",{key:"react-".concat(p),x:h,y:s,width:m,height:c,stroke:"none",fill:n[x],fillOpacity:a,className:"recharts-cartesian-grid-bg"})});return Ce.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},f)}var Ste=function(t,r){var n=t.xAxis,a=t.width,o=t.height,s=t.offset;return kM(uS(bi(bi(bi({},zd.defaultProps),n),{},{ticks:sl(n,!0),viewBox:{x:0,y:0,width:a,height:o}})),s.left,s.left+s.width,r)},Cte=function(t,r){var n=t.yAxis,a=t.width,o=t.height,s=t.offset;return kM(uS(bi(bi(bi({},zd.defaultProps),n),{},{ticks:sl(n,!0),viewBox:{x:0,y:0,width:a,height:o}})),s.top,s.top+s.height,r)},_u={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function uv(e){var t,r,n,a,o,s,l=oS(),c=sS(),u=fee(),d=bi(bi({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:_u.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:_u.fill,horizontal:(n=e.horizontal)!==null&&n!==void 0?n:_u.horizontal,horizontalFill:(a=e.horizontalFill)!==null&&a!==void 0?a:_u.horizontalFill,vertical:(o=e.vertical)!==null&&o!==void 0?o:_u.vertical,verticalFill:(s=e.verticalFill)!==null&&s!==void 0?s:_u.verticalFill,x:Mt(e.x)?e.x:u.left,y:Mt(e.y)?e.y:u.top,width:Mt(e.width)?e.width:u.width,height:Mt(e.height)?e.height:u.height}),f=d.x,h=d.y,p=d.width,g=d.height,m=d.syncWithTicks,x=d.horizontalValues,b=d.verticalValues,_=cee(),w=uee();if(!Mt(p)||p<=0||!Mt(g)||g<=0||!Mt(f)||f!==+f||!Mt(h)||h!==+h)return null;var A=d.verticalCoordinatesGenerator||Ste,O=d.horizontalCoordinatesGenerator||Cte,T=d.horizontalPoints,E=d.verticalPoints;if((!T||!T.length)&&Rr(O)){var S=x&&x.length,I=O({yAxis:w?bi(bi({},w),{},{ticks:S?x:w.ticks}):void 0,width:l,height:c,offset:u},S?!0:m);is(Array.isArray(I),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Jc(I),"]")),Array.isArray(I)&&(T=I)}if((!E||!E.length)&&Rr(A)){var z=b&&b.length,k=A({xAxis:_?bi(bi({},_),{},{ticks:z?b:_.ticks}):void 0,width:l,height:c,offset:u},z?!0:m);is(Array.isArray(k),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Jc(k),"]")),Array.isArray(k)&&(E=k)}return Ce.createElement("g",{className:"recharts-cartesian-grid"},Ce.createElement(xte,{fill:d.fill,fillOpacity:d.fillOpacity,x:d.x,y:d.y,width:d.width,height:d.height,ry:d.ry}),Ce.createElement(bte,qc({},d,{offset:u,horizontalPoints:T,xAxis:_,yAxis:w})),Ce.createElement(_te,qc({},d,{offset:u,verticalPoints:E,xAxis:_,yAxis:w})),Ce.createElement(wte,qc({},d,{horizontalPoints:T})),Ce.createElement(jte,qc({},d,{verticalPoints:E})))}uv.displayName="CartesianGrid";var Ate=["type","layout","connectNulls","ref"],Pte=["key"];function bd(e){"@babel/helpers - typeof";return bd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bd(e)}function IT(e,t){if(e==null)return{};var r=Ote(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Ote(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Mh(){return Mh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Mh.apply(this,arguments)}function NT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function go(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?NT(Object(r),!0).forEach(function(n){ns(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):NT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wu(e){return Ite(e)||Ete(e)||Tte(e)||kte()}function kte(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Tte(e,t){if(e){if(typeof e=="string")return sw(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sw(e,t)}}function Ete(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Ite(e){if(Array.isArray(e))return sw(e)}function sw(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Nte(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function DT(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,EL(n.key),n)}}function Dte(e,t,r){return t&&DT(e.prototype,t),r&&DT(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Mte(e,t,r){return t=dv(t),Lte(e,TL()?Reflect.construct(t,r||[],dv(e).constructor):t.apply(e,r))}function Lte(e,t){if(t&&(bd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Rte(e)}function Rte(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function TL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(TL=function(){return!!e})()}function dv(e){return dv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},dv(e)}function qte(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&lw(e,t)}function lw(e,t){return lw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},lw(e,t)}function ns(e,t,r){return t=EL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function EL(e){var t=Fte(e,"string");return bd(t)=="symbol"?t:t+""}function Fte(e,t){if(bd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(bd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Wp=function(e){function t(){var r;Nte(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return r=Mte(this,t,[].concat(a)),ns(r,"state",{isAnimationFinished:!0,totalLength:0}),ns(r,"generateSimpleStrokeDasharray",function(s,l){return"".concat(l,"px ").concat(s-l,"px")}),ns(r,"getStrokeDasharray",function(s,l,c){var u=c.reduce(function(b,_){return b+_});if(!u)return r.generateSimpleStrokeDasharray(l,s);for(var d=Math.floor(s/u),f=s%u,h=l-s,p=[],g=0,m=0;g<c.length;m+=c[g],++g)if(m+c[g]>f){p=[].concat(wu(c.slice(0,g)),[f-m]);break}var x=p.length%2===0?[0,h]:[h];return[].concat(wu(t.repeat(c,d)),wu(p),x).map(function(b){return"".concat(b,"px")}).join(", ")}),ns(r,"id",qd("recharts-line-")),ns(r,"pathRef",function(s){r.mainCurve=s}),ns(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),ns(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return qte(t,e),Dte(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,s=o.points,l=o.xAxis,c=o.yAxis,u=o.layout,d=o.children,f=Ao(d,zp);if(!f)return null;var h=function(m,x){return{x:m.x,y:m.y,value:m.value,errorVal:Ga(m.payload,x)}},p={clipPath:n?"url(#clipPath-".concat(a,")"):null};return Ce.createElement(pn,p,f.map(function(g){return Ce.cloneElement(g,{key:"bar-".concat(g.props.dataKey),data:s,xAxis:l,yAxis:c,layout:u,dataPointFormatter:h})}))}},{key:"renderDots",value:function(n,a,o){var s=this.props.isAnimationActive;if(s&&!this.state.isAnimationFinished)return null;var l=this.props,c=l.dot,u=l.points,d=l.dataKey,f=_r(this.props,!1),h=_r(c,!0),p=u.map(function(m,x){var b=go(go(go({key:"dot-".concat(x),r:3},f),h),{},{index:x,cx:m.x,cy:m.y,value:m.value,dataKey:d,payload:m.payload,points:u});return t.renderDotItem(c,b)}),g={clipPath:n?"url(#clipPath-".concat(a?"":"dots-").concat(o,")"):null};return Ce.createElement(pn,Mh({className:"recharts-line-dots",key:"dots"},g),p)}},{key:"renderCurveStatically",value:function(n,a,o,s){var l=this.props,c=l.type,u=l.layout,d=l.connectNulls;l.ref;var f=IT(l,Ate),h=go(go(go({},_r(f,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:a?"url(#clipPath-".concat(o,")"):null,points:n},s),{},{type:c,layout:u,connectNulls:d});return Ce.createElement(Wg,Mh({},h,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,a){var o=this,s=this.props,l=s.points,c=s.strokeDasharray,u=s.isAnimationActive,d=s.animationBegin,f=s.animationDuration,h=s.animationEasing,p=s.animationId,g=s.animateNewValues,m=s.width,x=s.height,b=this.state,_=b.prevPoints,w=b.totalLength;return Ce.createElement(Ts,{begin:d,duration:f,isActive:u,easing:h,from:{t:0},to:{t:1},key:"line-".concat(p),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(A){var O=A.t;if(_){var T=_.length/l.length,E=l.map(function(M,R){var F=Math.floor(R*T);if(_[F]){var W=_[F],K=_o(W.x,M.x),Z=_o(W.y,M.y);return go(go({},M),{},{x:K(O),y:Z(O)})}if(g){var D=_o(m*2,M.x),P=_o(x/2,M.y);return go(go({},M),{},{x:D(O),y:P(O)})}return go(go({},M),{},{x:M.x,y:M.y})});return o.renderCurveStatically(E,n,a)}var S=_o(0,w),I=S(O),z;if(c){var k="".concat(c).split(/[,\s]+/gim).map(function(M){return parseFloat(M)});z=o.getStrokeDasharray(I,w,k)}else z=o.generateSimpleStrokeDasharray(w,I);return o.renderCurveStatically(l,n,a,{strokeDasharray:z})})}},{key:"renderCurve",value:function(n,a){var o=this.props,s=o.points,l=o.isAnimationActive,c=this.state,u=c.prevPoints,d=c.totalLength;return l&&s&&s.length&&(!u&&d>0||!Up(u,s))?this.renderCurveWithAnimation(n,a):this.renderCurveStatically(s,n,a)}},{key:"render",value:function(){var n,a=this.props,o=a.hide,s=a.dot,l=a.points,c=a.className,u=a.xAxis,d=a.yAxis,f=a.top,h=a.left,p=a.width,g=a.height,m=a.isAnimationActive,x=a.id;if(o||!l||!l.length)return null;var b=this.state.isAnimationFinished,_=l.length===1,w=Nr("recharts-line",c),A=u&&u.allowDataOverflow,O=d&&d.allowDataOverflow,T=A||O,E=Ur(x)?this.id:x,S=(n=_r(s,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},I=S.r,z=I===void 0?3:I,k=S.strokeWidth,M=k===void 0?2:k,R=wB(s)?s:{},F=R.clipDot,W=F===void 0?!0:F,K=z*2+M;return Ce.createElement(pn,{className:w},A||O?Ce.createElement("defs",null,Ce.createElement("clipPath",{id:"clipPath-".concat(E)},Ce.createElement("rect",{x:A?h:h-p/2,y:O?f:f-g/2,width:A?p:p*2,height:O?g:g*2})),!W&&Ce.createElement("clipPath",{id:"clipPath-dots-".concat(E)},Ce.createElement("rect",{x:h-K/2,y:f-K/2,width:p+K,height:g+K}))):null,!_&&this.renderCurve(T,E),this.renderErrorBar(T,E),(_||s)&&this.renderDots(T,W,E),(!m||b)&&fl.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:a.curPoints}:n.points!==a.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,a){for(var o=n.length%2!==0?[].concat(wu(n),[0]):n,s=[],l=0;l<a;++l)s=[].concat(wu(s),wu(o));return s}},{key:"renderDotItem",value:function(n,a){var o;if(Ce.isValidElement(n))o=Ce.cloneElement(n,a);else if(Rr(n))o=n(a);else{var s=a.key,l=IT(a,Pte),c=Nr("recharts-line-dot",typeof n!="boolean"?n.className:"");o=Ce.createElement(fy,Mh({key:s},l,{className:c}))}return o}}])}(y.PureComponent);ns(Wp,"displayName","Line");ns(Wp,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!iu.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});ns(Wp,"getComposedData",function(e){var t=e.props,r=e.xAxis,n=e.yAxis,a=e.xAxisTicks,o=e.yAxisTicks,s=e.dataKey,l=e.bandSize,c=e.displayedData,u=e.offset,d=t.layout,f=c.map(function(h,p){var g=Ga(h,s);return d==="horizontal"?{x:Fk({axis:r,ticks:a,bandSize:l,entry:h,index:p}),y:Ur(g)?null:n.scale(g),value:g,payload:h}:{x:Ur(g)?null:r.scale(g),y:Fk({axis:n,ticks:o,bandSize:l,entry:h,index:p}),value:g,payload:h}});return go({points:f,layout:d},u)});function _d(e){"@babel/helpers - typeof";return _d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_d(e)}function $te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Bte(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,DL(n.key),n)}}function Ute(e,t,r){return t&&Bte(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function zte(e,t,r){return t=fv(t),Wte(e,IL()?Reflect.construct(t,r||[],fv(e).constructor):t.apply(e,r))}function Wte(e,t){if(t&&(_d(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Hte(e)}function Hte(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function IL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(IL=function(){return!!e})()}function fv(e){return fv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},fv(e)}function Vte(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&cw(e,t)}function cw(e,t){return cw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},cw(e,t)}function NL(e,t,r){return t=DL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function DL(e){var t=Gte(e,"string");return _d(t)=="symbol"?t:t+""}function Gte(e,t){if(_d(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(_d(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function uw(){return uw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},uw.apply(this,arguments)}function Yte(e){var t=e.xAxisId,r=oS(),n=sS(),a=yL(t);return a==null?null:Ce.createElement(zd,uw({},a,{className:Nr("recharts-".concat(a.axisType," ").concat(a.axisType),a.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(s){return sl(s,!0)}}))}var Zc=function(e){function t(){return $te(this,t),zte(this,t,arguments)}return Vte(t,e),Ute(t,[{key:"render",value:function(){return Ce.createElement(Yte,this.props)}}])}(Ce.Component);NL(Zc,"displayName","XAxis");NL(Zc,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function wd(e){"@babel/helpers - typeof";return wd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wd(e)}function Kte(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Qte(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,RL(n.key),n)}}function Xte(e,t,r){return t&&Qte(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Jte(e,t,r){return t=hv(t),Zte(e,ML()?Reflect.construct(t,r||[],hv(e).constructor):t.apply(e,r))}function Zte(e,t){if(t&&(wd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ere(e)}function ere(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ML(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ML=function(){return!!e})()}function hv(e){return hv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},hv(e)}function tre(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&dw(e,t)}function dw(e,t){return dw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},dw(e,t)}function LL(e,t,r){return t=RL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function RL(e){var t=rre(e,"string");return wd(t)=="symbol"?t:t+""}function rre(e,t){if(wd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(wd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function fw(){return fw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fw.apply(this,arguments)}var nre=function(t){var r=t.yAxisId,n=oS(),a=sS(),o=xL(r);return o==null?null:Ce.createElement(zd,fw({},o,{className:Nr("recharts-".concat(o.axisType," ").concat(o.axisType),o.className),viewBox:{x:0,y:0,width:n,height:a},ticksGenerator:function(l){return sl(l,!0)}}))},eu=function(e){function t(){return Kte(this,t),Jte(this,t,arguments)}return tre(t,e),Xte(t,[{key:"render",value:function(){return Ce.createElement(nre,this.props)}}])}(Ce.Component);LL(eu,"displayName","YAxis");LL(eu,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function MT(e){return sre(e)||ore(e)||ire(e)||are()}function are(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ire(e,t){if(e){if(typeof e=="string")return hw(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hw(e,t)}}function ore(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function sre(e){if(Array.isArray(e))return hw(e)}function hw(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var pw=function(t,r,n,a,o){var s=Ao(t,cS),l=Ao(t,_y),c=[].concat(MT(s),MT(l)),u=Ao(t,jy),d="".concat(a,"Id"),f=a[0],h=r;if(c.length&&(h=c.reduce(function(m,x){if(x.props[d]===n&&As(x.props,"extendDomain")&&Mt(x.props[f])){var b=x.props[f];return[Math.min(m[0],b),Math.max(m[1],b)]}return m},h)),u.length){var p="".concat(f,"1"),g="".concat(f,"2");h=u.reduce(function(m,x){if(x.props[d]===n&&As(x.props,"extendDomain")&&Mt(x.props[p])&&Mt(x.props[g])){var b=x.props[p],_=x.props[g];return[Math.min(m[0],b,_),Math.max(m[1],b,_)]}return m},h)}return o&&o.length&&(h=o.reduce(function(m,x){return Mt(x)?[Math.min(m[0],x),Math.max(m[1],x)]:m},h)),h},s2={exports:{}},LT;function lre(){return LT||(LT=1,function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function a(c,u,d){this.fn=c,this.context=u,this.once=d||!1}function o(c,u,d,f,h){if(typeof d!="function")throw new TypeError("The listener must be a function");var p=new a(d,f||c,h),g=r?r+u:u;return c._events[g]?c._events[g].fn?c._events[g]=[c._events[g],p]:c._events[g].push(p):(c._events[g]=p,c._eventsCount++),c}function s(c,u){--c._eventsCount===0?c._events=new n:delete c._events[u]}function l(){this._events=new n,this._eventsCount=0}l.prototype.eventNames=function(){var u=[],d,f;if(this._eventsCount===0)return u;for(f in d=this._events)t.call(d,f)&&u.push(r?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(d)):u},l.prototype.listeners=function(u){var d=r?r+u:u,f=this._events[d];if(!f)return[];if(f.fn)return[f.fn];for(var h=0,p=f.length,g=new Array(p);h<p;h++)g[h]=f[h].fn;return g},l.prototype.listenerCount=function(u){var d=r?r+u:u,f=this._events[d];return f?f.fn?1:f.length:0},l.prototype.emit=function(u,d,f,h,p,g){var m=r?r+u:u;if(!this._events[m])return!1;var x=this._events[m],b=arguments.length,_,w;if(x.fn){switch(x.once&&this.removeListener(u,x.fn,void 0,!0),b){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,d),!0;case 3:return x.fn.call(x.context,d,f),!0;case 4:return x.fn.call(x.context,d,f,h),!0;case 5:return x.fn.call(x.context,d,f,h,p),!0;case 6:return x.fn.call(x.context,d,f,h,p,g),!0}for(w=1,_=new Array(b-1);w<b;w++)_[w-1]=arguments[w];x.fn.apply(x.context,_)}else{var A=x.length,O;for(w=0;w<A;w++)switch(x[w].once&&this.removeListener(u,x[w].fn,void 0,!0),b){case 1:x[w].fn.call(x[w].context);break;case 2:x[w].fn.call(x[w].context,d);break;case 3:x[w].fn.call(x[w].context,d,f);break;case 4:x[w].fn.call(x[w].context,d,f,h);break;default:if(!_)for(O=1,_=new Array(b-1);O<b;O++)_[O-1]=arguments[O];x[w].fn.apply(x[w].context,_)}}return!0},l.prototype.on=function(u,d,f){return o(this,u,d,f,!1)},l.prototype.once=function(u,d,f){return o(this,u,d,f,!0)},l.prototype.removeListener=function(u,d,f,h){var p=r?r+u:u;if(!this._events[p])return this;if(!d)return s(this,p),this;var g=this._events[p];if(g.fn)g.fn===d&&(!h||g.once)&&(!f||g.context===f)&&s(this,p);else{for(var m=0,x=[],b=g.length;m<b;m++)(g[m].fn!==d||h&&!g[m].once||f&&g[m].context!==f)&&x.push(g[m]);x.length?this._events[p]=x.length===1?x[0]:x:s(this,p)}return this},l.prototype.removeAllListeners=function(u){var d;return u?(d=r?r+u:u,this._events[d]&&s(this,d)):(this._events=new n,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=r,l.EventEmitter=l,e.exports=l}(s2)),s2.exports}var cre=lre();const ure=It(cre);var l2=new ure,c2="recharts.syncMouseEvents";function Sp(e){"@babel/helpers - typeof";return Sp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sp(e)}function dre(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fre(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,qL(n.key),n)}}function hre(e,t,r){return t&&fre(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function u2(e,t,r){return t=qL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qL(e){var t=pre(e,"string");return Sp(t)=="symbol"?t:t+""}function pre(e,t){if(Sp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Sp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var mre=function(){function e(){dre(this,e),u2(this,"activeIndex",0),u2(this,"coordinateList",[]),u2(this,"layout","horizontal")}return hre(e,[{key:"setDetails",value:function(r){var n,a=r.coordinateList,o=a===void 0?null:a,s=r.container,l=s===void 0?null:s,c=r.layout,u=c===void 0?null:c,d=r.offset,f=d===void 0?null:d,h=r.mouseHandlerCallback,p=h===void 0?null:h;this.coordinateList=(n=o??this.coordinateList)!==null&&n!==void 0?n:[],this.container=l??this.container,this.layout=u??this.layout,this.offset=f??this.offset,this.mouseHandlerCallback=p??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var a=this.container.getBoundingClientRect(),o=a.x,s=a.y,l=a.height,c=this.coordinateList[this.activeIndex].coordinate,u=((r=window)===null||r===void 0?void 0:r.scrollX)||0,d=((n=window)===null||n===void 0?void 0:n.scrollY)||0,f=o+c+u,h=s+this.offset.top+l/2+d;this.mouseHandlerCallback({pageX:f,pageY:h})}}}])}();function gre(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e?.[0],a=e?.[1];if(n&&a&&Mt(n)&&Mt(a))return!0}return!1}function vre(e,t,r,n){var a=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-a:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-a,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function FL(e){var t=e.cx,r=e.cy,n=e.radius,a=e.startAngle,o=e.endAngle,s=Bn(t,r,n,a),l=Bn(t,r,n,o);return{points:[s,l],cx:t,cy:r,radius:n,startAngle:a,endAngle:o}}function yre(e,t,r){var n,a,o,s;if(e==="horizontal")n=t.x,o=n,a=r.top,s=r.top+r.height;else if(e==="vertical")a=t.y,s=a,n=r.left,o=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var l=t.cx,c=t.cy,u=t.innerRadius,d=t.outerRadius,f=t.angle,h=Bn(l,c,u,f),p=Bn(l,c,d,f);n=h.x,a=h.y,o=p.x,s=p.y}else return FL(t);return[{x:n,y:a},{x:o,y:s}]}function Cp(e){"@babel/helpers - typeof";return Cp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cp(e)}function RT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Om(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?RT(Object(r),!0).forEach(function(n){xre(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xre(e,t,r){return t=bre(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bre(e){var t=_re(e,"string");return Cp(t)=="symbol"?t:t+""}function _re(e,t){if(Cp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Cp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function wre(e){var t,r,n=e.element,a=e.tooltipEventType,o=e.isActive,s=e.activeCoordinate,l=e.activePayload,c=e.offset,u=e.activeTooltipIndex,d=e.tooltipAxisBandSize,f=e.layout,h=e.chartName,p=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!p||!o||!s||h!=="ScatterChart"&&a!=="axis")return null;var g,m=Wg;if(h==="ScatterChart")g=s,m=WX;else if(h==="BarChart")g=vre(f,s,c,d),m=rS;else if(f==="radial"){var x=FL(s),b=x.cx,_=x.cy,w=x.radius,A=x.startAngle,O=x.endAngle;g={cx:b,cy:_,startAngle:A,endAngle:O,innerRadius:w,outerRadius:w},m=$M}else g={points:yre(f,s,c)},m=Wg;var T=Om(Om(Om(Om({stroke:"#ccc",pointerEvents:"none"},c),g),_r(p,!1)),{},{payload:l,payloadIndex:u,className:Nr("recharts-tooltip-cursor",p.className)});return y.isValidElement(p)?y.cloneElement(p,T):y.createElement(m,T)}var jre=["item"],Sre=["children","className","width","height","style","compact","title","desc"];function jd(e){"@babel/helpers - typeof";return jd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jd(e)}function Lu(){return Lu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Lu.apply(this,arguments)}function qT(e,t){return Pre(e)||Are(e,t)||BL(e,t)||Cre()}function Cre(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Are(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function Pre(e){if(Array.isArray(e))return e}function FT(e,t){if(e==null)return{};var r=Ore(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Ore(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function kre(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Tre(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,UL(n.key),n)}}function Ere(e,t,r){return t&&Tre(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ire(e,t,r){return t=pv(t),Nre(e,$L()?Reflect.construct(t,r||[],pv(e).constructor):t.apply(e,r))}function Nre(e,t){if(t&&(jd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Dre(e)}function Dre(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $L(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return($L=function(){return!!e})()}function pv(e){return pv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},pv(e)}function Mre(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mw(e,t)}function mw(e,t){return mw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},mw(e,t)}function Sd(e){return qre(e)||Rre(e)||BL(e)||Lre()}function Lre(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function BL(e,t){if(e){if(typeof e=="string")return gw(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gw(e,t)}}function Rre(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function qre(e){if(Array.isArray(e))return gw(e)}function gw(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ft(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$T(Object(r),!0).forEach(function(n){jr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$T(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jr(e,t,r){return t=UL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function UL(e){var t=Fre(e,"string");return jd(t)=="symbol"?t:t+""}function Fre(e,t){if(jd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(jd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var $re={xAxis:["bottom","top"],yAxis:["left","right"]},Bre={width:"100%",height:"100%"},zL={x:0,y:0};function km(e){return e}var Ure=function(t,r){return r==="horizontal"?t.x:r==="vertical"?t.y:r==="centric"?t.angle:t.radius},zre=function(t,r,n,a){var o=r.find(function(d){return d&&d.index===n});if(o){if(t==="horizontal")return{x:o.coordinate,y:a.y};if(t==="vertical")return{x:a.x,y:o.coordinate};if(t==="centric"){var s=o.coordinate,l=a.radius;return ft(ft(ft({},a),Bn(a.cx,a.cy,l,s)),{},{angle:s,radius:l})}var c=o.coordinate,u=a.angle;return ft(ft(ft({},a),Bn(a.cx,a.cy,c,u)),{},{angle:u,radius:c})}return zL},Sy=function(t,r){var n=r.graphicalItems,a=r.dataStartIndex,o=r.dataEndIndex,s=(n??[]).reduce(function(l,c){var u=c.props.data;return u&&u.length?[].concat(Sd(l),Sd(u)):l},[]);return s.length>0?s:t&&t.length&&Mt(a)&&Mt(o)?t.slice(a,o+1):[]};function WL(e){return e==="number"?[0,"auto"]:void 0}var vw=function(t,r,n,a){var o=t.graphicalItems,s=t.tooltipAxis,l=Sy(r,t);return n<0||!o||!o.length||n>=l.length?null:o.reduce(function(c,u){var d,f=(d=u.props.data)!==null&&d!==void 0?d:r;f&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=n&&(f=f.slice(t.dataStartIndex,t.dataEndIndex+1));var h;if(s.dataKey&&!s.allowDuplicatedCategory){var p=f===void 0?l:f;h=gg(p,s.dataKey,a)}else h=f&&f[n]||l[n];return h?[].concat(Sd(c),[DM(u,h)]):c},[])},BT=function(t,r,n,a){var o=a||{x:t.chartX,y:t.chartY},s=Ure(o,n),l=t.orderedTooltipTicks,c=t.tooltipAxis,u=t.tooltipTicks,d=xY(s,l,u,c);if(d>=0&&u){var f=u[d]&&u[d].value,h=vw(t,r,d,f),p=zre(n,l,d,o);return{activeTooltipIndex:d,activeLabel:f,activePayload:h,activeCoordinate:p}}return null},Wre=function(t,r){var n=r.axes,a=r.graphicalItems,o=r.axisType,s=r.axisIdKey,l=r.stackGroups,c=r.dataStartIndex,u=r.dataEndIndex,d=t.layout,f=t.children,h=t.stackOffset,p=OM(d,o);return n.reduce(function(g,m){var x,b=m.type.defaultProps!==void 0?ft(ft({},m.type.defaultProps),m.props):m.props,_=b.type,w=b.dataKey,A=b.allowDataOverflow,O=b.allowDuplicatedCategory,T=b.scale,E=b.ticks,S=b.includeHidden,I=b[s];if(g[I])return g;var z=Sy(t.data,{graphicalItems:a.filter(function(C){var L,H=s in C.props?C.props[s]:(L=C.type.defaultProps)===null||L===void 0?void 0:L[s];return H===I}),dataStartIndex:c,dataEndIndex:u}),k=z.length,M,R,F;gre(b.domain,A,_)&&(M=E_(b.domain,null,A),p&&(_==="number"||T!=="auto")&&(F=Eh(z,w,"category")));var W=WL(_);if(!M||M.length===0){var K,Z=(K=b.domain)!==null&&K!==void 0?K:W;if(w){if(M=Eh(z,w,_),_==="category"&&p){var D=fB(M);O&&D?(R=M,M=ev(0,k)):O||(M=zk(Z,M,m).reduce(function(C,L){return C.indexOf(L)>=0?C:[].concat(Sd(C),[L])},[]))}else if(_==="category")O?M=M.filter(function(C){return C!==""&&!Ur(C)}):M=zk(Z,M,m).reduce(function(C,L){return C.indexOf(L)>=0||L===""||Ur(L)?C:[].concat(Sd(C),[L])},[]);else if(_==="number"){var P=SY(z,a.filter(function(C){var L,H,U=s in C.props?C.props[s]:(L=C.type.defaultProps)===null||L===void 0?void 0:L[s],te="hide"in C.props?C.props.hide:(H=C.type.defaultProps)===null||H===void 0?void 0:H.hide;return U===I&&(S||!te)}),w,o,d);P&&(M=P)}p&&(_==="number"||T!=="auto")&&(F=Eh(z,w,"category"))}else p?M=ev(0,k):l&&l[I]&&l[I].hasStack&&_==="number"?M=h==="expand"?[0,1]:NM(l[I].stackGroups,c,u):M=PM(z,a.filter(function(C){var L=s in C.props?C.props[s]:C.type.defaultProps[s],H="hide"in C.props?C.props.hide:C.type.defaultProps.hide;return L===I&&(S||!H)}),_,d,!0);if(_==="number")M=pw(f,M,I,o,E),Z&&(M=E_(Z,M,A));else if(_==="category"&&Z){var $=Z,Q=M.every(function(C){return $.indexOf(C)>=0});Q&&(M=$)}}return ft(ft({},g),{},jr({},I,ft(ft({},b),{},{axisType:o,domain:M,categoricalDomain:F,duplicateDomain:R,originalDomain:(x=b.domain)!==null&&x!==void 0?x:W,isCategorical:p,layout:d})))},{})},Hre=function(t,r){var n=r.graphicalItems,a=r.Axis,o=r.axisType,s=r.axisIdKey,l=r.stackGroups,c=r.dataStartIndex,u=r.dataEndIndex,d=t.layout,f=t.children,h=Sy(t.data,{graphicalItems:n,dataStartIndex:c,dataEndIndex:u}),p=h.length,g=OM(d,o),m=-1;return n.reduce(function(x,b){var _=b.type.defaultProps!==void 0?ft(ft({},b.type.defaultProps),b.props):b.props,w=_[s],A=WL("number");if(!x[w]){m++;var O;return g?O=ev(0,p):l&&l[w]&&l[w].hasStack?(O=NM(l[w].stackGroups,c,u),O=pw(f,O,w,o)):(O=E_(A,PM(h,n.filter(function(T){var E,S,I=s in T.props?T.props[s]:(E=T.type.defaultProps)===null||E===void 0?void 0:E[s],z="hide"in T.props?T.props.hide:(S=T.type.defaultProps)===null||S===void 0?void 0:S.hide;return I===w&&!z}),"number",d),a.defaultProps.allowDataOverflow),O=pw(f,O,w,o)),ft(ft({},x),{},jr({},w,ft(ft({axisType:o},a.defaultProps),{},{hide:!0,orientation:Co($re,"".concat(o,".").concat(m%2),null),domain:O,originalDomain:A,isCategorical:g,layout:d})))}return x},{})},Vre=function(t,r){var n=r.axisType,a=n===void 0?"xAxis":n,o=r.AxisComp,s=r.graphicalItems,l=r.stackGroups,c=r.dataStartIndex,u=r.dataEndIndex,d=t.children,f="".concat(a,"Id"),h=Ao(d,o),p={};return h&&h.length?p=Wre(t,{axes:h,graphicalItems:s,axisType:a,axisIdKey:f,stackGroups:l,dataStartIndex:c,dataEndIndex:u}):s&&s.length&&(p=Hre(t,{Axis:o,graphicalItems:s,axisType:a,axisIdKey:f,stackGroups:l,dataStartIndex:c,dataEndIndex:u})),p},Gre=function(t){var r=Gl(t),n=sl(r,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:kj(n,function(a){return a.coordinate}),tooltipAxis:r,tooltipAxisBandSize:Bg(r,n)}},UT=function(t){var r=t.children,n=t.defaultShowTooltip,a=yo(r,pd),o=0,s=0;return t.data&&t.data.length!==0&&(s=t.data.length-1),a&&a.props&&(a.props.startIndex>=0&&(o=a.props.startIndex),a.props.endIndex>=0&&(s=a.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:o,dataEndIndex:s,activeTooltipIndex:-1,isTooltipActive:!!n}},Yre=function(t){return!t||!t.length?!1:t.some(function(r){var n=ul(r&&r.type);return n&&n.indexOf("Bar")>=0})},zT=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},Kre=function(t,r){var n=t.props,a=t.graphicalItems,o=t.xAxisMap,s=o===void 0?{}:o,l=t.yAxisMap,c=l===void 0?{}:l,u=n.width,d=n.height,f=n.children,h=n.margin||{},p=yo(f,pd),g=yo(f,Ss),m=Object.keys(c).reduce(function(O,T){var E=c[T],S=E.orientation;return!E.mirror&&!E.hide?ft(ft({},O),{},jr({},S,O[S]+E.width)):O},{left:h.left||0,right:h.right||0}),x=Object.keys(s).reduce(function(O,T){var E=s[T],S=E.orientation;return!E.mirror&&!E.hide?ft(ft({},O),{},jr({},S,Co(O,"".concat(S))+E.height)):O},{top:h.top||0,bottom:h.bottom||0}),b=ft(ft({},x),m),_=b.bottom;p&&(b.bottom+=p.props.height||pd.defaultProps.height),g&&r&&(b=wY(b,a,n,r));var w=u-b.left-b.right,A=d-b.top-b.bottom;return ft(ft({brushBottom:_},b),{},{width:Math.max(w,0),height:Math.max(A,0)})},Qre=function(t,r){if(r==="xAxis")return t[r].width;if(r==="yAxis")return t[r].height},fS=function(t){var r=t.chartName,n=t.GraphicalChild,a=t.defaultTooltipEventType,o=a===void 0?"axis":a,s=t.validateTooltipEventTypes,l=s===void 0?["axis"]:s,c=t.axisComponents,u=t.legendContent,d=t.formatAxisMap,f=t.defaultProps,h=function(b,_){var w=_.graphicalItems,A=_.stackGroups,O=_.offset,T=_.updateId,E=_.dataStartIndex,S=_.dataEndIndex,I=b.barSize,z=b.layout,k=b.barGap,M=b.barCategoryGap,R=b.maxBarSize,F=zT(z),W=F.numericAxisName,K=F.cateAxisName,Z=Yre(w),D=[];return w.forEach(function(P,$){var Q=Sy(b.data,{graphicalItems:[P],dataStartIndex:E,dataEndIndex:S}),C=P.type.defaultProps!==void 0?ft(ft({},P.type.defaultProps),P.props):P.props,L=C.dataKey,H=C.maxBarSize,U=C["".concat(W,"Id")],te=C["".concat(K,"Id")],le={},oe=c.reduce(function(nt,st){var gt=_["".concat(st.axisType,"Map")],Ge=C["".concat(st.axisType,"Id")];gt&&gt[Ge]||st.axisType==="zAxis"||Xc();var Je=gt[Ge];return ft(ft({},nt),{},jr(jr({},st.axisType,Je),"".concat(st.axisType,"Ticks"),sl(Je)))},le),ae=oe[K],he=oe["".concat(K,"Ticks")],me=A&&A[U]&&A[U].hasStack&&NY(P,A[U].stackGroups),X=ul(P.type).indexOf("Bar")>=0,G=Bg(ae,he),ee=[],se=Z&&bY({barSize:I,stackGroups:A,totalSize:Qre(oe,K)});if(X){var V,He,Ne=Ur(H)?R:H,Re=(V=(He=Bg(ae,he,!0))!==null&&He!==void 0?He:Ne)!==null&&V!==void 0?V:0;ee=_Y({barGap:k,barCategoryGap:M,bandSize:Re!==G?Re:G,sizeList:se[te],maxBarSize:Ne}),Re!==G&&(ee=ee.map(function(nt){return ft(ft({},nt),{},{position:ft(ft({},nt.position),{},{offset:nt.position.offset-Re/2})})}))}var Ke=P&&P.type&&P.type.getComposedData;Ke&&D.push({props:ft(ft({},Ke(ft(ft({},oe),{},{displayedData:Q,props:b,dataKey:L,item:P,bandSize:G,barPosition:ee,offset:O,stackedData:me,layout:z,dataStartIndex:E,dataEndIndex:S}))),{},jr(jr(jr({key:P.key||"item-".concat($)},W,oe[W]),K,oe[K]),"animationId",T)),childIndex:CB(P,b.children),item:P})}),D},p=function(b,_){var w=b.props,A=b.dataStartIndex,O=b.dataEndIndex,T=b.updateId;if(!nA({props:w}))return null;var E=w.children,S=w.layout,I=w.stackOffset,z=w.data,k=w.reverseStackOrder,M=zT(S),R=M.numericAxisName,F=M.cateAxisName,W=Ao(E,n),K=EY(z,W,"".concat(R,"Id"),"".concat(F,"Id"),I,k),Z=c.reduce(function(C,L){var H="".concat(L.axisType,"Map");return ft(ft({},C),{},jr({},H,Vre(w,ft(ft({},L),{},{graphicalItems:W,stackGroups:L.axisType===R&&K,dataStartIndex:A,dataEndIndex:O}))))},{}),D=Kre(ft(ft({},Z),{},{props:w,graphicalItems:W}),_?.legendBBox);Object.keys(Z).forEach(function(C){Z[C]=d(w,Z[C],D,C.replace("Map",""),r)});var P=Z["".concat(F,"Map")],$=Gre(P),Q=h(w,ft(ft({},Z),{},{dataStartIndex:A,dataEndIndex:O,updateId:T,graphicalItems:W,stackGroups:K,offset:D}));return ft(ft({formattedGraphicalItems:Q,graphicalItems:W,offset:D,stackGroups:K},$),Z)},g=function(x){function b(_){var w,A,O;return kre(this,b),O=Ire(this,b,[_]),jr(O,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),jr(O,"accessibilityManager",new mre),jr(O,"handleLegendBBoxUpdate",function(T){if(T){var E=O.state,S=E.dataStartIndex,I=E.dataEndIndex,z=E.updateId;O.setState(ft({legendBBox:T},p({props:O.props,dataStartIndex:S,dataEndIndex:I,updateId:z},ft(ft({},O.state),{},{legendBBox:T}))))}}),jr(O,"handleReceiveSyncEvent",function(T,E,S){if(O.props.syncId===T){if(S===O.eventEmitterSymbol&&typeof O.props.syncMethod!="function")return;O.applySyncEvent(E)}}),jr(O,"handleBrushChange",function(T){var E=T.startIndex,S=T.endIndex;if(E!==O.state.dataStartIndex||S!==O.state.dataEndIndex){var I=O.state.updateId;O.setState(function(){return ft({dataStartIndex:E,dataEndIndex:S},p({props:O.props,dataStartIndex:E,dataEndIndex:S,updateId:I},O.state))}),O.triggerSyncEvent({dataStartIndex:E,dataEndIndex:S})}}),jr(O,"handleMouseEnter",function(T){var E=O.getMouseInfo(T);if(E){var S=ft(ft({},E),{},{isTooltipActive:!0});O.setState(S),O.triggerSyncEvent(S);var I=O.props.onMouseEnter;Rr(I)&&I(S,T)}}),jr(O,"triggeredAfterMouseMove",function(T){var E=O.getMouseInfo(T),S=E?ft(ft({},E),{},{isTooltipActive:!0}):{isTooltipActive:!1};O.setState(S),O.triggerSyncEvent(S);var I=O.props.onMouseMove;Rr(I)&&I(S,T)}),jr(O,"handleItemMouseEnter",function(T){O.setState(function(){return{isTooltipActive:!0,activeItem:T,activePayload:T.tooltipPayload,activeCoordinate:T.tooltipPosition||{x:T.cx,y:T.cy}}})}),jr(O,"handleItemMouseLeave",function(){O.setState(function(){return{isTooltipActive:!1}})}),jr(O,"handleMouseMove",function(T){T.persist(),O.throttleTriggeredAfterMouseMove(T)}),jr(O,"handleMouseLeave",function(T){O.throttleTriggeredAfterMouseMove.cancel();var E={isTooltipActive:!1};O.setState(E),O.triggerSyncEvent(E);var S=O.props.onMouseLeave;Rr(S)&&S(E,T)}),jr(O,"handleOuterEvent",function(T){var E=SB(T),S=Co(O.props,"".concat(E));if(E&&Rr(S)){var I,z;/.*touch.*/i.test(E)?z=O.getMouseInfo(T.changedTouches[0]):z=O.getMouseInfo(T),S((I=z)!==null&&I!==void 0?I:{},T)}}),jr(O,"handleClick",function(T){var E=O.getMouseInfo(T);if(E){var S=ft(ft({},E),{},{isTooltipActive:!0});O.setState(S),O.triggerSyncEvent(S);var I=O.props.onClick;Rr(I)&&I(S,T)}}),jr(O,"handleMouseDown",function(T){var E=O.props.onMouseDown;if(Rr(E)){var S=O.getMouseInfo(T);E(S,T)}}),jr(O,"handleMouseUp",function(T){var E=O.props.onMouseUp;if(Rr(E)){var S=O.getMouseInfo(T);E(S,T)}}),jr(O,"handleTouchMove",function(T){T.changedTouches!=null&&T.changedTouches.length>0&&O.throttleTriggeredAfterMouseMove(T.changedTouches[0])}),jr(O,"handleTouchStart",function(T){T.changedTouches!=null&&T.changedTouches.length>0&&O.handleMouseDown(T.changedTouches[0])}),jr(O,"handleTouchEnd",function(T){T.changedTouches!=null&&T.changedTouches.length>0&&O.handleMouseUp(T.changedTouches[0])}),jr(O,"handleDoubleClick",function(T){var E=O.props.onDoubleClick;if(Rr(E)){var S=O.getMouseInfo(T);E(S,T)}}),jr(O,"handleContextMenu",function(T){var E=O.props.onContextMenu;if(Rr(E)){var S=O.getMouseInfo(T);E(S,T)}}),jr(O,"triggerSyncEvent",function(T){O.props.syncId!==void 0&&l2.emit(c2,O.props.syncId,T,O.eventEmitterSymbol)}),jr(O,"applySyncEvent",function(T){var E=O.props,S=E.layout,I=E.syncMethod,z=O.state.updateId,k=T.dataStartIndex,M=T.dataEndIndex;if(T.dataStartIndex!==void 0||T.dataEndIndex!==void 0)O.setState(ft({dataStartIndex:k,dataEndIndex:M},p({props:O.props,dataStartIndex:k,dataEndIndex:M,updateId:z},O.state)));else if(T.activeTooltipIndex!==void 0){var R=T.chartX,F=T.chartY,W=T.activeTooltipIndex,K=O.state,Z=K.offset,D=K.tooltipTicks;if(!Z)return;if(typeof I=="function")W=I(D,T);else if(I==="value"){W=-1;for(var P=0;P<D.length;P++)if(D[P].value===T.activeLabel){W=P;break}}var $=ft(ft({},Z),{},{x:Z.left,y:Z.top}),Q=Math.min(R,$.x+$.width),C=Math.min(F,$.y+$.height),L=D[W]&&D[W].value,H=vw(O.state,O.props.data,W),U=D[W]?{x:S==="horizontal"?D[W].coordinate:Q,y:S==="horizontal"?C:D[W].coordinate}:zL;O.setState(ft(ft({},T),{},{activeLabel:L,activeCoordinate:U,activePayload:H,activeTooltipIndex:W}))}else O.setState(T)}),jr(O,"renderCursor",function(T){var E,S=O.state,I=S.isTooltipActive,z=S.activeCoordinate,k=S.activePayload,M=S.offset,R=S.activeTooltipIndex,F=S.tooltipAxisBandSize,W=O.getTooltipEventType(),K=(E=T.props.active)!==null&&E!==void 0?E:I,Z=O.props.layout,D=T.key||"_recharts-cursor";return Ce.createElement(wre,{key:D,activeCoordinate:z,activePayload:k,activeTooltipIndex:R,chartName:r,element:T,isActive:K,layout:Z,offset:M,tooltipAxisBandSize:F,tooltipEventType:W})}),jr(O,"renderPolarAxis",function(T,E,S){var I=Co(T,"type.axisType"),z=Co(O.state,"".concat(I,"Map")),k=T.type.defaultProps,M=k!==void 0?ft(ft({},k),T.props):T.props,R=z&&z[M["".concat(I,"Id")]];return y.cloneElement(T,ft(ft({},R),{},{className:Nr(I,R.className),key:T.key||"".concat(E,"-").concat(S),ticks:sl(R,!0)}))}),jr(O,"renderPolarGrid",function(T){var E=T.props,S=E.radialLines,I=E.polarAngles,z=E.polarRadius,k=O.state,M=k.radiusAxisMap,R=k.angleAxisMap,F=Gl(M),W=Gl(R),K=W.cx,Z=W.cy,D=W.innerRadius,P=W.outerRadius;return y.cloneElement(T,{polarAngles:Array.isArray(I)?I:sl(W,!0).map(function($){return $.coordinate}),polarRadius:Array.isArray(z)?z:sl(F,!0).map(function($){return $.coordinate}),cx:K,cy:Z,innerRadius:D,outerRadius:P,key:T.key||"polar-grid",radialLines:S})}),jr(O,"renderLegend",function(){var T=O.state.formattedGraphicalItems,E=O.props,S=E.children,I=E.width,z=E.height,k=O.props.margin||{},M=I-(k.left||0)-(k.right||0),R=CM({children:S,formattedGraphicalItems:T,legendWidth:M,legendContent:u});if(!R)return null;var F=R.item,W=FT(R,jre);return y.cloneElement(F,ft(ft({},W),{},{chartWidth:I,chartHeight:z,margin:k,onBBoxUpdate:O.handleLegendBBoxUpdate}))}),jr(O,"renderTooltip",function(){var T,E=O.props,S=E.children,I=E.accessibilityLayer,z=yo(S,xo);if(!z)return null;var k=O.state,M=k.isTooltipActive,R=k.activeCoordinate,F=k.activePayload,W=k.activeLabel,K=k.offset,Z=(T=z.props.active)!==null&&T!==void 0?T:M;return y.cloneElement(z,{viewBox:ft(ft({},K),{},{x:K.left,y:K.top}),active:Z,label:W,payload:Z?F:[],coordinate:R,accessibilityLayer:I})}),jr(O,"renderBrush",function(T){var E=O.props,S=E.margin,I=E.data,z=O.state,k=z.offset,M=z.dataStartIndex,R=z.dataEndIndex,F=z.updateId;return y.cloneElement(T,{key:T.key||"_recharts-brush",onChange:Sm(O.handleBrushChange,T.props.onChange),data:I,x:Mt(T.props.x)?T.props.x:k.left,y:Mt(T.props.y)?T.props.y:k.top+k.height+k.brushBottom-(S.bottom||0),width:Mt(T.props.width)?T.props.width:k.width,startIndex:M,endIndex:R,updateId:"brush-".concat(F)})}),jr(O,"renderReferenceElement",function(T,E,S){if(!T)return null;var I=O,z=I.clipPathId,k=O.state,M=k.xAxisMap,R=k.yAxisMap,F=k.offset,W=T.type.defaultProps||{},K=T.props,Z=K.xAxisId,D=Z===void 0?W.xAxisId:Z,P=K.yAxisId,$=P===void 0?W.yAxisId:P;return y.cloneElement(T,{key:T.key||"".concat(E,"-").concat(S),xAxis:M[D],yAxis:R[$],viewBox:{x:F.left,y:F.top,width:F.width,height:F.height},clipPathId:z})}),jr(O,"renderActivePoints",function(T){var E=T.item,S=T.activePoint,I=T.basePoint,z=T.childIndex,k=T.isRange,M=[],R=E.props.key,F=E.item.type.defaultProps!==void 0?ft(ft({},E.item.type.defaultProps),E.item.props):E.item.props,W=F.activeDot,K=F.dataKey,Z=ft(ft({index:z,dataKey:K,cx:S.x,cy:S.y,r:4,fill:tS(E.item),strokeWidth:2,stroke:"#fff",payload:S.payload,value:S.value},_r(W,!1)),vg(W));return M.push(b.renderActiveDot(W,Z,"".concat(R,"-activePoint-").concat(z))),I?M.push(b.renderActiveDot(W,ft(ft({},Z),{},{cx:I.x,cy:I.y}),"".concat(R,"-basePoint-").concat(z))):k&&M.push(null),M}),jr(O,"renderGraphicChild",function(T,E,S){var I=O.filterFormatItem(T,E,S);if(!I)return null;var z=O.getTooltipEventType(),k=O.state,M=k.isTooltipActive,R=k.tooltipAxis,F=k.activeTooltipIndex,W=k.activeLabel,K=O.props.children,Z=yo(K,xo),D=I.props,P=D.points,$=D.isRange,Q=D.baseLine,C=I.item.type.defaultProps!==void 0?ft(ft({},I.item.type.defaultProps),I.item.props):I.item.props,L=C.activeDot,H=C.hide,U=C.activeBar,te=C.activeShape,le=!!(!H&&M&&Z&&(L||U||te)),oe={};z!=="axis"&&Z&&Z.props.trigger==="click"?oe={onClick:Sm(O.handleItemMouseEnter,T.props.onClick)}:z!=="axis"&&(oe={onMouseLeave:Sm(O.handleItemMouseLeave,T.props.onMouseLeave),onMouseEnter:Sm(O.handleItemMouseEnter,T.props.onMouseEnter)});var ae=y.cloneElement(T,ft(ft({},I.props),oe));function he(st){return typeof R.dataKey=="function"?R.dataKey(st.payload):null}if(le)if(F>=0){var me,X;if(R.dataKey&&!R.allowDuplicatedCategory){var G=typeof R.dataKey=="function"?he:"payload.".concat(R.dataKey.toString());me=gg(P,G,W),X=$&&Q&&gg(Q,G,W)}else me=P?.[F],X=$&&Q&&Q[F];if(te||U){var ee=T.props.activeIndex!==void 0?T.props.activeIndex:F;return[y.cloneElement(T,ft(ft(ft({},I.props),oe),{},{activeIndex:ee})),null,null]}if(!Ur(me))return[ae].concat(Sd(O.renderActivePoints({item:I,activePoint:me,basePoint:X,childIndex:F,isRange:$})))}else{var se,V=(se=O.getItemByXY(O.state.activeCoordinate))!==null&&se!==void 0?se:{graphicalItem:ae},He=V.graphicalItem,Ne=He.item,Re=Ne===void 0?T:Ne,Ke=He.childIndex,nt=ft(ft(ft({},I.props),oe),{},{activeIndex:Ke});return[y.cloneElement(Re,nt),null,null]}return $?[ae,null,null]:[ae,null]}),jr(O,"renderCustomized",function(T,E,S){return y.cloneElement(T,ft(ft({key:"recharts-customized-".concat(S)},O.props),O.state))}),jr(O,"renderMap",{CartesianGrid:{handler:km,once:!0},ReferenceArea:{handler:O.renderReferenceElement},ReferenceLine:{handler:km},ReferenceDot:{handler:O.renderReferenceElement},XAxis:{handler:km},YAxis:{handler:km},Brush:{handler:O.renderBrush,once:!0},Bar:{handler:O.renderGraphicChild},Line:{handler:O.renderGraphicChild},Area:{handler:O.renderGraphicChild},Radar:{handler:O.renderGraphicChild},RadialBar:{handler:O.renderGraphicChild},Scatter:{handler:O.renderGraphicChild},Pie:{handler:O.renderGraphicChild},Funnel:{handler:O.renderGraphicChild},Tooltip:{handler:O.renderCursor,once:!0},PolarGrid:{handler:O.renderPolarGrid,once:!0},PolarAngleAxis:{handler:O.renderPolarAxis},PolarRadiusAxis:{handler:O.renderPolarAxis},Customized:{handler:O.renderCustomized}}),O.clipPathId="".concat((w=_.id)!==null&&w!==void 0?w:qd("recharts"),"-clip"),O.throttleTriggeredAfterMouseMove=jD(O.triggeredAfterMouseMove,(A=_.throttleDelay)!==null&&A!==void 0?A:1e3/60),O.state={},O}return Mre(b,x),Ere(b,[{key:"componentDidMount",value:function(){var w,A;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(w=this.props.margin.left)!==null&&w!==void 0?w:0,top:(A=this.props.margin.top)!==null&&A!==void 0?A:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var w=this.props,A=w.children,O=w.data,T=w.height,E=w.layout,S=yo(A,xo);if(S){var I=S.props.defaultIndex;if(!(typeof I!="number"||I<0||I>this.state.tooltipTicks.length-1)){var z=this.state.tooltipTicks[I]&&this.state.tooltipTicks[I].value,k=vw(this.state,O,I,z),M=this.state.tooltipTicks[I].coordinate,R=(this.state.offset.top+T)/2,F=E==="horizontal",W=F?{x:M,y:R}:{y:M,x:R},K=this.state.formattedGraphicalItems.find(function(D){var P=D.item;return P.type.name==="Scatter"});K&&(W=ft(ft({},W),K.props.points[I].tooltipPosition),k=K.props.points[I].tooltipPayload);var Z={activeTooltipIndex:I,isTooltipActive:!0,activeLabel:z,activePayload:k,activeCoordinate:W};this.setState(Z),this.renderCursor(S),this.accessibilityManager.setIndex(I)}}}},{key:"getSnapshotBeforeUpdate",value:function(w,A){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==A.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==w.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==w.margin){var O,T;this.accessibilityManager.setDetails({offset:{left:(O=this.props.margin.left)!==null&&O!==void 0?O:0,top:(T=this.props.margin.top)!==null&&T!==void 0?T:0}})}return null}},{key:"componentDidUpdate",value:function(w){Z2([yo(w.children,xo)],[yo(this.props.children,xo)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var w=yo(this.props.children,xo);if(w&&typeof w.props.shared=="boolean"){var A=w.props.shared?"axis":"item";return l.indexOf(A)>=0?A:o}return o}},{key:"getMouseInfo",value:function(w){if(!this.container)return null;var A=this.container,O=A.getBoundingClientRect(),T=d9(O),E={chartX:Math.round(w.pageX-T.left),chartY:Math.round(w.pageY-T.top)},S=O.width/A.offsetWidth||1,I=this.inRange(E.chartX,E.chartY,S);if(!I)return null;var z=this.state,k=z.xAxisMap,M=z.yAxisMap,R=this.getTooltipEventType(),F=BT(this.state,this.props.data,this.props.layout,I);if(R!=="axis"&&k&&M){var W=Gl(k).scale,K=Gl(M).scale,Z=W&&W.invert?W.invert(E.chartX):null,D=K&&K.invert?K.invert(E.chartY):null;return ft(ft({},E),{},{xValue:Z,yValue:D},F)}return F?ft(ft({},E),F):null}},{key:"inRange",value:function(w,A){var O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,T=this.props.layout,E=w/O,S=A/O;if(T==="horizontal"||T==="vertical"){var I=this.state.offset,z=E>=I.left&&E<=I.left+I.width&&S>=I.top&&S<=I.top+I.height;return z?{x:E,y:S}:null}var k=this.state,M=k.angleAxisMap,R=k.radiusAxisMap;if(M&&R){var F=Gl(M);return Vk({x:E,y:S},F)}return null}},{key:"parseEventsOfWrapper",value:function(){var w=this.props.children,A=this.getTooltipEventType(),O=yo(w,xo),T={};O&&A==="axis"&&(O.props.trigger==="click"?T={onClick:this.handleClick}:T={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var E=vg(this.props,this.handleOuterEvent);return ft(ft({},E),T)}},{key:"addListener",value:function(){l2.on(c2,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){l2.removeListener(c2,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(w,A,O){for(var T=this.state.formattedGraphicalItems,E=0,S=T.length;E<S;E++){var I=T[E];if(I.item===w||I.props.key===w.key||A===ul(I.item.type)&&O===I.childIndex)return I}return null}},{key:"renderClipPath",value:function(){var w=this.clipPathId,A=this.state.offset,O=A.left,T=A.top,E=A.height,S=A.width;return Ce.createElement("defs",null,Ce.createElement("clipPath",{id:w},Ce.createElement("rect",{x:O,y:T,height:E,width:S})))}},{key:"getXScales",value:function(){var w=this.state.xAxisMap;return w?Object.entries(w).reduce(function(A,O){var T=qT(O,2),E=T[0],S=T[1];return ft(ft({},A),{},jr({},E,S.scale))},{}):null}},{key:"getYScales",value:function(){var w=this.state.yAxisMap;return w?Object.entries(w).reduce(function(A,O){var T=qT(O,2),E=T[0],S=T[1];return ft(ft({},A),{},jr({},E,S.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(w){var A;return(A=this.state.xAxisMap)===null||A===void 0||(A=A[w])===null||A===void 0?void 0:A.scale}},{key:"getYScaleByAxisId",value:function(w){var A;return(A=this.state.yAxisMap)===null||A===void 0||(A=A[w])===null||A===void 0?void 0:A.scale}},{key:"getItemByXY",value:function(w){var A=this.state,O=A.formattedGraphicalItems,T=A.activeItem;if(O&&O.length)for(var E=0,S=O.length;E<S;E++){var I=O[E],z=I.props,k=I.item,M=k.type.defaultProps!==void 0?ft(ft({},k.type.defaultProps),k.props):k.props,R=ul(k.type);if(R==="Bar"){var F=(z.data||[]).find(function(D){return SX(w,D)});if(F)return{graphicalItem:I,payload:F}}else if(R==="RadialBar"){var W=(z.data||[]).find(function(D){return Vk(w,D)});if(W)return{graphicalItem:I,payload:W}}else if(vy(I,T)||yy(I,T)||xp(I,T)){var K=GJ({graphicalItem:I,activeTooltipItem:T,itemData:M.data}),Z=M.activeIndex===void 0?K:M.activeIndex;return{graphicalItem:ft(ft({},I),{},{childIndex:Z}),payload:xp(I,T)?M.data[K]:I.props.data[K]}}}return null}},{key:"render",value:function(){var w=this;if(!nA(this))return null;var A=this.props,O=A.children,T=A.className,E=A.width,S=A.height,I=A.style,z=A.compact,k=A.title,M=A.desc,R=FT(A,Sre),F=_r(R,!1);if(z)return Ce.createElement(xT,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ce.createElement(t_,Lu({},F,{width:E,height:S,title:k,desc:M}),this.renderClipPath(),iA(O,this.renderMap)));if(this.props.accessibilityLayer){var W,K;F.tabIndex=(W=this.props.tabIndex)!==null&&W!==void 0?W:0,F.role=(K=this.props.role)!==null&&K!==void 0?K:"application",F.onKeyDown=function(D){w.accessibilityManager.keyboardEvent(D)},F.onFocus=function(){w.accessibilityManager.focus()}}var Z=this.parseEventsOfWrapper();return Ce.createElement(xT,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ce.createElement("div",Lu({className:Nr("recharts-wrapper",T),style:ft({position:"relative",cursor:"default",width:E,height:S},I)},Z,{ref:function(P){w.container=P}}),Ce.createElement(t_,Lu({},F,{width:E,height:S,title:k,desc:M,style:Bre}),this.renderClipPath(),iA(O,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(y.Component);jr(g,"displayName",r),jr(g,"defaultProps",ft({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},f)),jr(g,"getDerivedStateFromProps",function(x,b){var _=x.dataKey,w=x.data,A=x.children,O=x.width,T=x.height,E=x.layout,S=x.stackOffset,I=x.margin,z=b.dataStartIndex,k=b.dataEndIndex;if(b.updateId===void 0){var M=UT(x);return ft(ft(ft({},M),{},{updateId:0},p(ft(ft({props:x},M),{},{updateId:0}),b)),{},{prevDataKey:_,prevData:w,prevWidth:O,prevHeight:T,prevLayout:E,prevStackOffset:S,prevMargin:I,prevChildren:A})}if(_!==b.prevDataKey||w!==b.prevData||O!==b.prevWidth||T!==b.prevHeight||E!==b.prevLayout||S!==b.prevStackOffset||!Hu(I,b.prevMargin)){var R=UT(x),F={chartX:b.chartX,chartY:b.chartY,isTooltipActive:b.isTooltipActive},W=ft(ft({},BT(b,w,E)),{},{updateId:b.updateId+1}),K=ft(ft(ft({},R),F),W);return ft(ft(ft({},K),p(ft({props:x},K),b)),{},{prevDataKey:_,prevData:w,prevWidth:O,prevHeight:T,prevLayout:E,prevStackOffset:S,prevMargin:I,prevChildren:A})}if(!Z2(A,b.prevChildren)){var Z,D,P,$,Q=yo(A,pd),C=Q&&(Z=(D=Q.props)===null||D===void 0?void 0:D.startIndex)!==null&&Z!==void 0?Z:z,L=Q&&(P=($=Q.props)===null||$===void 0?void 0:$.endIndex)!==null&&P!==void 0?P:k,H=C!==z||L!==k,U=!Ur(w),te=U&&!H?b.updateId:b.updateId+1;return ft(ft({updateId:te},p(ft(ft({props:x},b),{},{updateId:te,dataStartIndex:C,dataEndIndex:L}),b)),{},{prevChildren:A,dataStartIndex:C,dataEndIndex:L})}return null}),jr(g,"renderActiveDot",function(x,b,_){var w;return y.isValidElement(x)?w=y.cloneElement(x,b):Rr(x)?w=x(b):w=Ce.createElement(fy,b),Ce.createElement(pn,{className:"recharts-active-dot",key:_},w)});var m=y.forwardRef(function(b,_){return Ce.createElement(g,Lu({},b,{ref:_}))});return m.displayName=g.displayName,m},Xre=fS({chartName:"LineChart",GraphicalChild:Wp,axisComponents:[{axisType:"xAxis",AxisComp:Zc},{axisType:"yAxis",AxisComp:eu}],formatAxisMap:uL}),HL=fS({chartName:"BarChart",GraphicalChild:yl,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:Zc},{axisType:"yAxis",AxisComp:eu}],formatAxisMap:uL}),Jre=fS({chartName:"PieChart",GraphicalChild:Sl,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:gy},{axisType:"radiusAxis",AxisComp:py}],formatAxisMap:zY,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const d2=()=>Math.random().toString(36).slice(2),Zre=({open:e,onOpen:t,onClose:r,panelWidth:n=360,rightOffset:a=24,desktopTopOffset:o=72,desktopWidth:s,onDesktopResize:l,desktopMinWidth:c=280,desktopMaxWidth:u=640,desktopHandleWidth:d=12,desktopBottomOffset:f=32})=>{const{user:h}=ea(),[p,g]=y.useState(!1),[m,x]=y.useState(""),[b,_]=y.useState([]),w=y.useRef(null),A=jI(),O=h8(A.breakpoints.up("md")),[T,E]=y.useState(n),S=y.useRef(0),I=y.useRef(n),[z,k]=y.useState(!1),[M,R]=y.useState({}),F=y.useMemo(()=>Math.min(u,Math.max(c,typeof s=="number"?s:T)),[s,T,u,c]),W=y.useMemo(()=>`calc(100vh - ${o+f}px)`,[f,o]),K=o+72;y.useEffect(()=>{_([]),x("")},[h?.id]),y.useEffect(()=>{w.current&&(w.current.scrollTop=w.current.scrollHeight)},[b,e]),y.useEffect(()=>{typeof s=="number"&&E(s)},[s]),y.useEffect(()=>{if(!z)return;let le=null,oe=null;const ae=()=>{if(oe==null)return;const X=oe;oe=null,l?l(X):E(X),le=null},he=X=>{const G=S.current-X.clientX;oe=Math.min(u,Math.max(c,I.current+G)),le==null&&(le=requestAnimationFrame(ae))},me=()=>{k(!1),document.body.style.userSelect="",document.body.style.cursor=""};return window.addEventListener("mousemove",he),window.addEventListener("mouseup",me),()=>{window.removeEventListener("mousemove",he),window.removeEventListener("mouseup",me),le!=null&&cancelAnimationFrame(le)}},[u,c,z,l]),y.useEffect(()=>()=>{document.body.style.userSelect="",document.body.style.cursor=""},[]);const Z=y.useCallback(le=>{O&&(le.preventDefault(),S.current=le.clientX,I.current=F,k(!0),document.body.style.userSelect="none",document.body.style.cursor="col-resize")},[F,O]),D=y.useCallback(async()=>{const le=m.trim();if(!le||p)return;const oe={id:d2(),role:"user",text:le};_(ae=>[...ae,oe]),x(""),g(!0);try{const ae=await S7(le),he={id:d2(),role:"assistant",text:ae?.text||"",rows:ae?.rows||void 0};_(me=>[...me,he])}catch{_(he=>[...he,{id:d2(),role:"assistant",text:"Error contacting assistant. Please try again."}])}finally{g(!1)}},[m,p]),P=y.useCallback(le=>{le.preventDefault(),D()},[D]);if(!h)return null;function $(le){if(!le||le.length===0)return{};const oe=le[0],ae=Object.keys(oe);let he,me;for(const X of ae){const G=oe[X];he===void 0&&(typeof G=="string"||G instanceof Date)&&(he=X)}for(const X of ae){const G=oe[X];if(typeof G=="number"){me=X;break}me===void 0&&typeof G=="string"&&!isNaN(Number(G))&&(me=X)}return he||(he=ae.find(X=>!isNaN(Date.parse(String(oe[X]))))||ae.find(X=>typeof oe[X]=="string")),me||(me=ae.find(X=>typeof oe[X]=="number")),{xKey:he,yKey:me}}function Q(le,oe,ae){const he=new Map;for(const me of le){const X=me?.[oe],G=X==null?"":String(X),ee=me?.[ae],se=typeof ee=="number"?ee:Number(ee);isFinite(se)&&he.set(G,(he.get(G)||0)+se)}return Array.from(he.entries()).map(([me,X])=>({[oe]:me,[ae]:Number(X.toFixed(2))}))}function C(le,oe,ae,he="chart_data"){try{const me=`${oe},${ae}`,X=le.map(He=>{const Ne=String(He[oe]).replace(/"/g,'""'),Re=Number(He[ae]);return`"${Ne}",${isFinite(Re)?Re.toFixed(2):""}`}),G=[me,...X].join(`
`),ee=new Blob([G],{type:"text/csv;charset=utf-8;"}),se=URL.createObjectURL(ee),V=document.createElement("a");V.href=se,V.download=`${he}.csv`,document.body.appendChild(V),V.click(),document.body.removeChild(V),URL.revokeObjectURL(se)}catch{}}function L(le,oe){if(oe&&Array.isArray(oe)&&oe.length>0){const ae=le.match(/(^|\n)\s*Headline\s*:[^\n]*/i);if(ae)return ae[0].replace(/^\s*/,"").trim();const he=le.split(/\r?\n/)[0]?.trim()??"";return he.length>0?he:""}return le}const H=i.jsxs(J,{sx:{px:2.5,py:1.75,display:"flex",alignItems:"center",gap:1.5,background:`linear-gradient(135deg, ${yn(A.palette.primary.main,.95)}, ${yn(A.palette.primary.dark,.9)})`,color:A.palette.primary.contrastText},children:[i.jsx(Tp,{sx:{bgcolor:yn("#ffffff",.2)},children:i.jsx(v7,{fontSize:"small"})}),i.jsxs(J,{sx:{flex:1},children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:"Aiven Assistant"}),i.jsx(B,{variant:"caption",sx:{opacity:.85},children:"Your workspace copilot for instant answers"})]}),i.jsx(pr,{size:"small",onClick:r,sx:{color:"inherit"},children:i.jsx(lj,{fontSize:"small"})})]}),U=i.jsxs(J,{ref:w,sx:{flex:1,px:2.5,py:2,background:`radial-gradient(circle at top right, ${yn(A.palette.primary.light,.14)} 0%, transparent 60%)`,overflowY:"auto"},children:[b.length===0&&i.jsxs(J,{sx:{textAlign:"center",py:4,px:2,color:"text.secondary"},children:[i.jsx(B,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:"Welcome! Ask anything about your operations."}),i.jsx(B,{variant:"body2",children:"Try Show me overdue tasks for this week or How do I add a purchase order?. This chat clears automatically when you sign out."})]}),b.map(le=>{const oe=le.role==="user",ae=L(le.text,le.rows);return i.jsx(J,{sx:{mb:2,display:"flex",justifyContent:oe?"flex-end":"flex-start"},children:i.jsxs(J,{sx:{maxWidth:"80%",px:1.75,py:1.25,borderRadius:3,background:oe?`linear-gradient(135deg, ${A.palette.primary.main}, ${A.palette.primary.dark})`:yn(A.palette.background.paper,.95),color:oe?A.palette.primary.contrastText:A.palette.text.primary,boxShadow:oe?"0 12px 25px rgba(28, 97, 234, 0.35)":`0 8px 16px ${yn(A.palette.common.black,.08)}`,border:oe?"none":`1px solid ${yn(A.palette.primary.main,.15)}`,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[ae?i.jsx(B,{variant:"body2",children:ae}):null,le.rows&&Array.isArray(le.rows)&&le.rows.length>0&&i.jsxs(J,{sx:{mt:1.5,borderRadius:2,border:`1px solid ${yn(A.palette.primary.main,.2)}`,backgroundColor:yn(A.palette.background.default,.95),overflow:"hidden"},children:[i.jsxs(J,{sx:{px:1,py:.75,borderBottom:`1px solid ${yn(A.palette.primary.main,.1)}`,backgroundColor:yn(A.palette.primary.light,.1),display:"flex",alignItems:"center",justifyContent:"space-between",gap:1},children:[i.jsx(B,{variant:"caption",sx:{fontWeight:600,letterSpacing:.5},children:"Data preview"}),i.jsx(J,{sx:{display:"flex",alignItems:"center",gap:1},children:i.jsx(ye,{size:"small",variant:"outlined",startIcon:i.jsx(b7,{fontSize:"small"}),onClick:()=>{R(he=>{const me=he[le.id]||{open:!1},X=!me.open,G=$(le.rows);return{...he,[le.id]:{open:X,xKey:me.xKey||G.xKey,yKey:me.yKey||G.yKey,chartType:me.chartType||"bar",showLabels:me.showLabels??!0}}})},children:M[le.id]?.open?"Hide chart":"Visualize"})})]}),i.jsx(J,{sx:{maxHeight:160,overflow:"auto"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[i.jsx("thead",{children:i.jsx("tr",{children:Object.keys(le.rows[0]).slice(0,6).map(he=>i.jsx("th",{style:{textAlign:"left",padding:"6px 8px",borderBottom:`1px solid ${yn(A.palette.divider,.7)}`,fontWeight:600},children:he},he))})}),i.jsx("tbody",{children:le.rows.slice(0,10).map((he,me)=>i.jsx("tr",{children:Object.keys(le.rows[0]).slice(0,6).map(X=>i.jsx("td",{style:{padding:"6px 8px",borderBottom:`1px solid ${yn(A.palette.divider,.4)}`},children:String(he[X])},X))},me))})]})}),M[le.id]?.open&&i.jsx(J,{sx:{p:1.25,borderTop:`1px solid ${yn(A.palette.primary.main,.1)}`},children:(()=>{const he=M[le.id]||{},me=le.rows[0],X=Object.keys(me),G=X.filter(Ke=>typeof me[Ke]=="number"||!isNaN(Number(me[Ke]))),ee=he.xKey&&X.includes(he.xKey)?he.xKey:$(le.rows).xKey,se=he.yKey&&X.includes(he.yKey)?he.yKey:$(le.rows).yKey,V=he.chartType||"bar",He=he.showLabels!==!1,Ne=ee&&se,Re=Ne?Q(le.rows,ee,se):[];return i.jsxs(i.Fragment,{children:[i.jsxs(J,{sx:{display:"flex",gap:1.5,mb:1,flexWrap:"wrap",alignItems:"center"},children:[i.jsxs(Ae,{select:!0,size:"small",label:"Chart type",value:V,onChange:Ke=>R(nt=>({...nt,[le.id]:{...nt[le.id]??{},open:!0,chartType:Ke.target.value,xKey:ee,yKey:se}})),SelectProps:{native:!0},sx:{minWidth:140},children:[i.jsx("option",{value:"bar",children:"Bar"}),i.jsx("option",{value:"line",children:"Line"}),i.jsx("option",{value:"pie",children:"Pie"})]}),i.jsxs(Ae,{select:!0,size:"small",label:"X axis",value:ee||"",onChange:Ke=>R(nt=>({...nt,[le.id]:{...nt[le.id]??{},open:!0,xKey:Ke.target.value,yKey:se}})),SelectProps:{native:!0},sx:{minWidth:160},children:[i.jsx("option",{value:"",disabled:!0,children:"Select field"}),X.map(Ke=>i.jsx("option",{value:Ke,children:Ke},Ke))]}),i.jsxs(Ae,{select:!0,size:"small",label:"Y value",value:se||"",onChange:Ke=>R(nt=>({...nt,[le.id]:{...nt[le.id]??{},open:!0,xKey:ee,yKey:Ke.target.value}})),SelectProps:{native:!0},sx:{minWidth:160},children:[i.jsx("option",{value:"",disabled:!0,children:"Select field"}),G.map(Ke=>i.jsx("option",{value:Ke,children:Ke},Ke))]}),i.jsx(ri,{sx:{ml:.5},control:i.jsx(hl,{size:"small",checked:He,onChange:Ke=>R(nt=>({...nt,[le.id]:{...nt[le.id]??{},open:!0,showLabels:Ke.target.checked}}))}),label:"Labels"}),i.jsx(ye,{size:"small",variant:"text",startIcon:i.jsx(j7,{fontSize:"small"}),onClick:()=>Re&&ee&&se&&C(Re,ee,se),children:"Download CSV"})]}),Ne?i.jsx(J,{sx:{height:260},children:i.jsx(SD,{width:"100%",height:"100%",children:V==="bar"?i.jsxs(HL,{data:Re,layout:"vertical",margin:{left:12,right:16,top:8,bottom:8},children:[i.jsx(uv,{strokeDasharray:"3 3"}),i.jsx(Zc,{type:"number",tick:He?{fontSize:11}:!1}),i.jsx(eu,{type:"category",dataKey:ee,width:160,tick:He?{fontSize:12}:!1}),i.jsx(xo,{}),He&&i.jsx(Ss,{}),i.jsx(yl,{dataKey:se,fill:A.palette.primary.main})]}):V==="line"?i.jsxs(Xre,{data:Re,margin:{left:8,right:16,top:8,bottom:8},children:[i.jsx(uv,{strokeDasharray:"3 3"}),i.jsx(Zc,{dataKey:ee,interval:0,tick:He?{fontSize:11}:!1,height:40}),i.jsx(eu,{tick:He?void 0:!1}),i.jsx(xo,{}),He&&i.jsx(Ss,{}),i.jsx(Wp,{type:"monotone",dataKey:se,stroke:A.palette.primary.main,strokeWidth:2,dot:{r:2}})]}):i.jsxs(Jre,{children:[i.jsx(xo,{}),He&&i.jsx(Ss,{}),i.jsx(Sl,{data:Re,dataKey:se,nameKey:ee,outerRadius:90,children:Re.map((Ke,nt)=>i.jsx(ey,{fill:A.palette.primary[nt%2===0?"main":"light"]},`cell-${nt}`))})]})})}):i.jsx(B,{variant:"caption",color:"text.secondary",children:"Pick an x (category/date) and a numeric y field to chart."})]})})()})]})]})},le.id)}),p&&i.jsxs(J,{sx:{display:"flex",gap:1,alignItems:"center",color:"text.secondary",mt:1},children:[i.jsx(nr,{size:18,thickness:5}),i.jsx(B,{variant:"body2",children:"Aiven is thinking..."})]})]}),te=i.jsxs(J,{component:"form",onSubmit:P,sx:{p:2,display:"flex",alignItems:"center",gap:1.25,backgroundColor:yn(A.palette.background.paper,.98)},children:[i.jsx(Ae,{fullWidth:!0,size:"small",placeholder:"Ask Aiven anything about your data or workflows...",value:m,onChange:le=>x(le.target.value),InputProps:{sx:{borderRadius:3,backgroundColor:yn(A.palette.background.default,.9),boxShadow:`inset 0 0 0 1px ${yn(A.palette.primary.main,.08)}`}}}),i.jsx(pr,{type:"submit",color:"primary",disabled:p||!m.trim(),sx:{bgcolor:p||!m.trim()?"action.disabledBackground":A.palette.primary.main,color:p||!m.trim()?"text.disabled":A.palette.primary.contrastText,"&:hover":p||!m.trim()?void 0:{bgcolor:A.palette.primary.dark,color:A.palette.primary.contrastText},transition:"background-color 0.2s ease, transform 0.2s ease",transform:p||!m.trim()?"none":"translateY(0)",boxShadow:p||!m.trim()?"none":"0 12px 24px rgba(28, 97, 234, 0.3)"},children:i.jsx(jN,{})})]});return O?i.jsxs(i.Fragment,{children:[!e&&i.jsx(J,{sx:{position:"fixed",top:`${K}px`,right:`${a}px`,zIndex:1400,display:"flex",justifyContent:"flex-end",alignItems:"flex-start"},children:i.jsx(J,{onClick:t,role:"button",tabIndex:0,onKeyDown:le=>{(le.key==="Enter"||le.key===" ")&&(le.preventDefault(),t())},sx:{width:44,px:1,py:2,borderTopLeftRadius:16,borderBottomLeftRadius:16,background:`linear-gradient(135deg, ${A.palette.primary.main}, ${A.palette.primary.dark})`,boxShadow:"0 18px 35px rgba(28, 97, 234, 0.35)",color:A.palette.primary.contrastText,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",outline:"none"},children:i.jsx(B,{variant:"button",sx:{writingMode:"vertical-rl",transform:"rotate(180deg)",letterSpacing:1,fontWeight:600},children:"Aiven Assistant"})})}),e&&i.jsxs(J,{sx:{position:"fixed",top:`${o}px`,right:`${a}px`,zIndex:1500,display:"flex",flexDirection:"row-reverse",alignItems:"stretch",height:W,maxHeight:W,minWidth:`${F+d}px`},children:[i.jsxs(xt,{elevation:0,sx:{width:`${F}px`,height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",borderRadius:0,borderLeft:`1px solid ${yn(A.palette.divider,.7)}`,borderRight:"none",borderTop:"none",borderBottom:"none",boxShadow:"none",backgroundColor:A.palette.background.paper},children:[H,i.jsx(Gn,{sx:{borderColor:yn("#fff",.18)}}),U,i.jsx(Gn,{}),te]}),i.jsx(J,{onMouseDown:Z,role:"presentation",sx:{width:`${d}px`,cursor:"col-resize",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:yn(A.palette.background.paper,.6),borderTopLeftRadius:12,borderBottomLeftRadius:12,border:`1px solid ${yn(A.palette.primary.main,.15)}`,borderRight:"none",ml:"-1px",height:"100%","&:hover":{backgroundColor:yn(A.palette.primary.main,.12)}},children:i.jsx(J,{sx:{width:4,height:28,borderRadius:999,backgroundColor:yn(A.palette.text.primary,.3)}})})]})]}):i.jsxs(i.Fragment,{children:[!e&&i.jsx(En,{title:"Ask Aiven Assistant",children:i.jsx(p8,{onClick:t,sx:{position:"fixed",bottom:32,right:32,zIndex:1400,background:`linear-gradient(135deg, ${A.palette.primary.main}, ${A.palette.primary.dark})`,color:A.palette.primary.contrastText,boxShadow:"0 18px 35px rgba(28, 97, 234, 0.35)","&:hover":{background:`linear-gradient(135deg, ${A.palette.primary.dark}, ${A.palette.primary.main})`}},children:i.jsx(u7,{})})}),i.jsx(m8,{direction:"left",in:e,mountOnEnter:!0,unmountOnExit:!0,children:i.jsx(J,{sx:{position:"fixed",top:0,bottom:0,right:0,width:"100%",zIndex:1500,display:"flex",flexDirection:"column"},children:i.jsxs(xt,{elevation:12,sx:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",borderRadius:0,border:`1px solid ${yn(A.palette.primary.main,.2)}`,backgroundColor:yn(A.palette.background.paper,.96),backdropFilter:"blur(10px)"},children:[H,i.jsx(Gn,{sx:{borderColor:yn("#fff",.18)}}),U,i.jsx(Gn,{}),te]})})})]})},ju=240,WT=360,HT=0,ene=0,tne=0,VT=12,GT=280,YT=640,rne=()=>{const[e,t]=Ce.useState(!1),r=Nn(),n=Ds(),{logout:a,user:o}=ea(),{unreadConversationCount:s}=wN(),[l,c]=y.useState(0),[u,d]=y.useState(!1),[f,h]=y.useState(WT),[p,g]=y.useState(!!window.__backendUnavailableSince),[m,x]=y.useState(typeof navigator<"u"?navigator.onLine===!1:!1);y.useEffect(()=>{let M=!0;const R=async()=>{try{const W=await Sh();M&&c(W)}catch{}},F=setInterval(R,15e3);return R(),()=>{M=!1,clearInterval(F)}},[]),y.useEffect(()=>{const M=()=>x(!0),R=()=>x(!1),F=()=>g(!0),W=()=>g(!1);return window.addEventListener("offline",M),window.addEventListener("online",R),window.addEventListener("backend:unavailable",F),window.addEventListener("backend:available",W),()=>{window.removeEventListener("offline",M),window.removeEventListener("online",R),window.removeEventListener("backend:unavailable",F),window.removeEventListener("backend:available",W)}},[]);const b=()=>{t(!e)},_=()=>{a(),r("/login")},w=M=>"type"in M&&M.type==="header",A=y.useMemo(()=>({text:"Messages",icon:i.jsx(g8,{}),path:"/messaging",showUnreadDot:s>0}),[s]),O=M=>M,T=y.useMemo(()=>[{type:"header",text:"Dashboard"},{text:"Dashboard",icon:i.jsx(R2,{}),path:"/dashboard"},{text:"Tasks",icon:i.jsx(t5,{}),path:"/tasks"},A,{type:"header",text:"Purchasing"},{text:"Purchase Orders",icon:i.jsx(Bu,{}),path:"/open-purchase-orders"},{text:"Invoice Automator",icon:i.jsx(lg,{}),path:"/invoice-automator"},{text:"Return Orders",icon:i.jsx(cg,{}),path:"/return-orders"},{text:"Parts to Order",icon:i.jsx(di,{}),path:"/parts-to-order"},{text:"Vendors",icon:i.jsx(SI,{}),path:"/vendors"},{type:"header",text:"Sales"},{text:"Quotes",icon:i.jsx(q2,{}),path:"/quotes"},{text:"Sales Orders",icon:i.jsx(xs,{}),path:"/open-sales-orders"},{text:"Invoices",icon:i.jsx(xs,{}),path:"/invoices"},{text:"Customers",icon:i.jsx($h,{}),path:"/customers"},{type:"header",text:"Products & Inventory"},{text:"Products",icon:i.jsx(CI,{}),path:"/products"},{text:"Smart Search",icon:i.jsx(r5,{}),path:"/inventory/smart-search"},{text:"Stock",icon:i.jsx(di,{}),path:"/inventory"},{text:"Supply",icon:i.jsx(di,{}),path:"/supply"},{text:"Service",icon:i.jsx(di,{}),path:"/service"},{type:"header",text:"Time Tracking"},{text:"Attendance",icon:i.jsx(Nc,{}),path:"/attendance"},{text:"Time Tracking",icon:i.jsx(Nc,{}),path:"/time-tracking"},{text:"Time Tracking Reports",icon:i.jsx(AI,{}),path:"/time-tracking/reports"},{type:"header",text:"Human Resources"},{text:"Employees",icon:i.jsx(PI,{}),path:"/employees"},{text:"Profile Documents",icon:i.jsx(v8,{}),path:"/profile-documents"},{text:"Leave Management",icon:i.jsx(OI,{}),path:"/leave-management"},{text:"Mobile User Access",icon:i.jsx($h,{}),path:"/mobile-user-access"},{type:"header",text:"Settings"},{text:"Business Profile",icon:i.jsx(Qw,{}),path:"/business-profile"},{text:"Accounting",icon:i.jsx(ug,{}),path:"/qbo-account-mapping"},{text:"Global Variables",icon:i.jsx(ug,{}),path:"/margin-schedule"},{text:"Field Visibility",icon:i.jsx(kI,{}),path:"/field-visibility"},{text:"Email Settings",icon:i.jsx(dg,{}),path:"/email-settings"},{text:"Backup Management",icon:i.jsx(Xw,{}),path:"/backup-management"}],[A]),E=Ce.useMemo(()=>{if(o?.access_role==="Time Tracking")return[{type:"header",text:"Dashboard"},{text:"Attendance",icon:i.jsx(Nc,{}),path:"/attendance"},{text:"Time Tracking",icon:i.jsx(Nc,{}),path:"/time-tracking"},A,{type:"header",text:"Sales"},{text:"Sales Orders",icon:i.jsx(xs,{}),path:"/open-sales-orders"}];const M=[{type:"header",text:"Main"},{text:"Dashboard",icon:i.jsx(R2,{}),path:"/"},{text:"Tasks",icon:i.jsx(t5,{}),path:"/tasks"},A];return o?.access_role==="Sales and Purchase"?[...M,{type:"header",text:"Sales & Purchase"},{text:"Sales Orders",icon:i.jsx(xs,{}),path:"/open-sales-orders"},{text:"Invoices",icon:i.jsx(xs,{}),path:"/invoices"},{text:"Purchase Orders",icon:i.jsx(Bu,{}),path:"/open-purchase-orders"},{text:"Invoice Automator",icon:i.jsx(lg,{}),path:"/invoice-automator"},{text:"Return Orders",icon:i.jsx(cg,{}),path:"/return-orders"},{text:"Parts to Order",icon:i.jsx(di,{}),path:"/parts-to-order"},{type:"header",text:"Inventory"},{text:"Smart Search",icon:i.jsx(r5,{}),path:"/inventory/smart-search"},{text:"Stock",icon:i.jsx(di,{}),path:"/inventory"},{text:"Supply",icon:i.jsx(di,{}),path:"/supply"},{text:"Service",icon:i.jsx(di,{}),path:"/service"},{type:"header",text:"Settings"},{text:"Email Settings",icon:i.jsx(dg,{}),path:"/email-settings"}]:T},[o,T,A]),S=i.jsxs("div",{children:[i.jsx(nx,{}),i.jsx(ga,{children:E.map((M,R)=>{if(w(M))return i.jsx(y8,{sx:{bgcolor:"inherit",color:"text.secondary",fontWeight:"bold",fontSize:13,textAlign:"left",pl:2},children:M.text},`header-${M.text}-${R}`);const F=M;return i.jsxs(Ca,{onClick:()=>{const W=O(F.path);n.pathname!==W&&r(W),t(!1)},sx:{cursor:"pointer"},children:[i.jsx(x8,{children:F.showUnreadDot?i.jsx(Jw,{color:"error",variant:"dot",overlap:"circular",children:F.icon}):F.icon}),i.jsx(Jn,{primary:F.text,primaryTypographyProps:F.showUnreadDot?{fontWeight:600}:void 0})]},F.path||`${F.text}-${R}`)})})]}),I=f+HT+VT,z=`${I}px`,k=u?`calc(100% - ${ju}px - ${I}px)`:`calc(100% - ${ju}px)`;return i.jsxs(J,{sx:{display:"flex"},children:[i.jsx(b8,{position:"fixed",sx:{left:{xs:0,sm:`${ju}px`},right:{xs:0,sm:u?z:0},width:{xs:"100%",sm:"auto"},transition:"right 0.2s ease"},children:i.jsxs(nx,{children:[i.jsx(ye,{color:"inherit",startIcon:i.jsx(TI,{}),onClick:()=>r(-1),sx:{mr:2,display:{xs:"none",sm:"inline-flex"}},children:"Back"}),i.jsx(pr,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:b,sx:{mr:2,display:{sm:"none"}},children:i.jsx(_8,{})}),i.jsxs(J,{sx:{marginLeft:"auto",display:"flex",alignItems:"center",gap:2},children:[(p||m)&&i.jsx(En,{title:"We could not reach the server. Check your connection; pending events will sync automatically when back online.",children:i.jsxs(J,{sx:{bgcolor:"orange",color:"black",px:1.5,py:.5,borderRadius:1,fontSize:12},children:["Offline",l?` - Pending: ${l}`:""]})}),i.jsx(ye,{color:"inherit",onClick:_,startIcon:i.jsx(w8,{}),children:"Logout"})]})]})}),i.jsxs(J,{component:"nav",sx:{width:{sm:ju},flexShrink:{sm:0}},children:[i.jsx(n5,{variant:"temporary",open:e,onClose:b,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",sm:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:ju}},children:S}),i.jsx(n5,{variant:"permanent",sx:{display:{xs:"none",sm:"block"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:ju}},open:!0,children:S})]}),i.jsxs(J,{component:"main",sx:{flexGrow:1,p:3,width:{xs:"100%",sm:k},transition:"width 0.2s ease"},children:[i.jsx(nx,{}),i.jsx(Uq,{})]}),i.jsx(Zre,{open:u,onOpen:()=>d(!0),onClose:()=>d(!1),panelWidth:WT,rightOffset:HT,desktopTopOffset:ene,desktopWidth:f,onDesktopResize:M=>h(Math.min(Math.max(M,GT),YT)),desktopMinWidth:GT,desktopMaxWidth:YT,desktopHandleWidth:VT,desktopBottomOffset:tne})]})},nne=()=>{const e=Nn(),{login:t}=ea(),[r,n]=y.useState({email:"",password:""}),[a,o]=y.useState(null),[s,l]=y.useState(null),[c,u]=y.useState(!1),[d,f]=y.useState(!1);y.useEffect(()=>{const g=localStorage.getItem("rememberedEmail"),m=localStorage.getItem("rememberedPassword");g&&m&&(n({email:g,password:m}),f(!0));const x=localStorage.getItem("authRedirectMessage");x&&(l(x),localStorage.removeItem("authRedirectMessage"))},[]);const h=g=>{const{name:m,value:x}=g.target;n(b=>({...b,[m]:x}))},p=async g=>{g.preventDefault(),o(null),l(null),u(!0),d?(localStorage.setItem("rememberedEmail",r.email),localStorage.setItem("rememberedPassword",r.password)):(localStorage.removeItem("rememberedEmail"),localStorage.removeItem("rememberedPassword"));try{const m=await ve.post("/api/auth/login",r),{sessionToken:x,refreshToken:b,user:_}=m.data;t(x,b,_),_.access_role==="Time Tracking"?e("/time-tracking"):_.access_role==="Quotes"?e("/quotes"):e("/")}catch(m){console.error("Login error:",m);try{const x=localStorage.getItem("user"),b=x?JSON.parse(x):null,_=localStorage.getItem("sessionToken"),w=localStorage.getItem("refreshToken");if(b&&b.access_role==="Time Tracking"&&_&&w){e("/time-tracking");return}}catch{}navigator.onLine===!1?o("You appear to be offline. Reconnect to sign in or try again once you have internet."):o(m.response?.data?.message||"Failed to login. Please try again.")}finally{u(!1)}};return i.jsx(ir,{component:"main",maxWidth:"xs",children:i.jsx(J,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:i.jsxs(xt,{elevation:3,sx:{padding:4,display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[i.jsx(B,{component:"h1",variant:"h5",gutterBottom:!0,children:"Sign In"}),s&&i.jsx(Ot,{severity:"info",sx:{width:"100%",mb:2},children:s}),a&&i.jsx(Ot,{severity:"error",sx:{width:"100%",mb:2},children:a}),i.jsxs(J,{component:"form",onSubmit:p,sx:{mt:1,width:"100%"},children:[i.jsx(Ae,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:r.email,onChange:h}),i.jsx(Ae,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:r.password,onChange:h}),i.jsx(ri,{control:i.jsx(Xi,{value:"remember",color:"primary",checked:d,onChange:g=>f(g.target.checked)}),label:"Remember me"}),i.jsx(ye,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:c,children:c?"Signing in...":"Sign In"}),i.jsx(J,{sx:{textAlign:"center"},children:i.jsx(j8,{component:YI,to:"/register",variant:"body2",children:"Don't have an account? Register your company"})})]})]})})})},ane=()=>{const e=Nn(),{login:t}=ea(),[r,n]=y.useState({companyName:"",adminUsername:"",adminEmail:"",adminPassword:"",confirmPassword:""}),[a,o]=y.useState(null),[s,l]=y.useState(!1),c=d=>{const{name:f,value:h}=d.target;n(p=>({...p,[f]:h}))},u=async d=>{if(d.preventDefault(),o(null),r.adminPassword!==r.confirmPassword){o("Passwords do not match");return}l(!0);try{const f=await ve.post("/api/auth/register-company",{company_name:r.companyName,admin_username:r.adminUsername,admin_email:r.adminEmail,admin_password:r.adminPassword}),{sessionToken:h,refreshToken:p,user:g}=f.data;t(h,p,g),e("/dashboard")}catch(f){console.error("Registration error:",f),o(f.response?.data?.message||"Failed to register company. Please try again.")}finally{l(!1)}};return i.jsx(ir,{component:"main",maxWidth:"sm",children:i.jsx(J,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:i.jsxs(xt,{elevation:3,sx:{padding:4,display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[i.jsx(B,{component:"h1",variant:"h5",gutterBottom:!0,children:"Register Your Company"}),a&&i.jsx(Ot,{severity:"error",sx:{width:"100%",mb:2},children:a}),i.jsxs(J,{component:"form",onSubmit:u,sx:{mt:3,width:"100%"},children:[i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{required:!0,fullWidth:!0,label:"Company Name",name:"companyName",value:r.companyName,onChange:c})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{required:!0,fullWidth:!0,label:"Admin Username",name:"adminUsername",value:r.adminUsername,onChange:c})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{required:!0,fullWidth:!0,label:"Admin Email",name:"adminEmail",type:"email",value:r.adminEmail,onChange:c})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{required:!0,fullWidth:!0,label:"Admin Password",name:"adminPassword",type:"password",value:r.adminPassword,onChange:c})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{required:!0,fullWidth:!0,label:"Confirm Password",name:"confirmPassword",type:"password",value:r.confirmPassword,onChange:c})})]}),i.jsx(ye,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:s,children:s?"Registering...":"Register Company"})]})]})})})};var xf={},KT;function ine(){if(KT)return xf;KT=1;var e=cr();Object.defineProperty(xf,"__esModule",{value:!0}),xf.default=void 0;var t=e(dr()),r=ur();return xf.default=(0,t.default)((0,r.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),xf}var one=ine();const Es=It(one);var bf={},QT;function sne(){if(QT)return bf;QT=1;var e=cr();Object.defineProperty(bf,"__esModule",{value:!0}),bf.default=void 0;var t=e(dr()),r=ur();return bf.default=(0,t.default)((0,r.jsx)("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m0 4c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3m6 12H6v-1.4c0-2 4-3.1 6-3.1s6 1.1 6 3.1z"}),"AssignmentInd"),bf}var lne=sne();const cne=It(lne);var _f={},XT;function une(){if(XT)return _f;XT=1;var e=cr();Object.defineProperty(_f,"__esModule",{value:!0}),_f.default=void 0;var t=e(dr()),r=ur();return _f.default=(0,t.default)((0,r.jsx)("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 18H4V8h16z"}),"CalendarToday"),_f}var dne=une();const VL=It(dne);var wf={},JT;function fne(){if(JT)return wf;JT=1;var e=cr();Object.defineProperty(wf,"__esModule",{value:!0}),wf.default=void 0;var t=e(dr()),r=ur();return wf.default=(0,t.default)([(0,r.jsx)("path",{d:"M12 5.99 19.53 19H4.47zM12 2 1 21h22z"},"0"),(0,r.jsx)("path",{d:"M13 16h-2v2h2zm0-6h-2v5h2z"},"1")],"WarningAmber"),wf}var hne=fne();const GL=It(hne);var jf={},ZT;function pne(){if(ZT)return jf;ZT=1;var e=cr();Object.defineProperty(jf,"__esModule",{value:!0}),jf.default=void 0;var t=e(dr()),r=ur();return jf.default=(0,t.default)((0,r.jsx)("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-6 15h-2v-2h2zm0-4h-2V8h2zm-1-9c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"}),"AssignmentLate"),jf}var mne=pne();const gne=It(mne);var Sf={},eE;function vne(){if(eE)return Sf;eE=1;var e=cr();Object.defineProperty(Sf,"__esModule",{value:!0}),Sf.default=void 0;var t=e(dr()),r=ur();return Sf.default=(0,t.default)((0,r.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"ReportProblem"),Sf}var yne=vne();const xne=It(yne),bne=[{key:"myOpen",label:"My open tasks",icon:i.jsx(cne,{fontSize:"large"}),palette:"info"},{key:"myDueToday",label:"My tasks due today",icon:i.jsx(VL,{fontSize:"large"}),palette:"warning"},{key:"myOverdue",label:"My overdue tasks",icon:i.jsx(GL,{fontSize:"large"}),palette:"error"},{key:"assignedByMeOverdue",label:"Overdue tasks I assigned",icon:i.jsx(gne,{fontSize:"large"}),palette:"secondary"},{key:"allOverdue",label:"All overdue tasks",icon:i.jsx(xne,{fontSize:"large"}),palette:"error"}],YL=({summary:e,loading:t,onRefresh:r,onViewTasks:n})=>{const a=e?.total??0;return i.jsxs(Br,{sx:{borderRadius:3,overflow:"hidden",position:"relative",boxShadow:"0 24px 60px -32px rgba(15, 23, 42, 0.45)"},children:[i.jsx(J,{sx:{position:"absolute",inset:0,background:"linear-gradient(140deg, rgba(59, 130, 246, 0.12) 0%, rgba(99, 102, 241, 0.08) 45%, rgba(168, 85, 247, 0.05) 100%)",pointerEvents:"none"}}),i.jsxs(Vr,{sx:{position:"relative",p:{xs:3,md:4}},children:[i.jsxs(ct,{direction:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},spacing:3,children:[i.jsxs(J,{children:[i.jsx(B,{variant:"overline",color:"text.secondary",sx:{letterSpacing:1.2},children:"Team workload snapshot"}),i.jsx(B,{variant:"h4",sx:{fontWeight:600},children:"Task overview"}),i.jsxs(B,{variant:"body1",color:"text.secondary",sx:{mt:.5},children:["Tracking ",i.jsx("strong",{children:a})," task",a===1?"":"s"," across your workspace."]})]}),i.jsxs(ct,{direction:{xs:"column",sm:"row"},spacing:1.5,width:{xs:"100%",sm:"auto"},children:[r&&i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Es,{}),onClick:r,disabled:t,sx:{width:{xs:"100%",sm:"auto"}},children:"Refresh"}),n&&i.jsx(ye,{variant:"contained",onClick:n,sx:{width:{xs:"100%",sm:"auto"}},children:"View tasks"})]})]}),i.jsx(J,{sx:{mt:4},children:t?i.jsx(J,{display:"flex",justifyContent:"center",py:4,children:i.jsx(nr,{})}):e?i.jsx(J,{sx:{display:"grid",gap:2.5,gridTemplateColumns:{xs:"repeat(1, minmax(0, 1fr))",sm:"repeat(2, minmax(0, 1fr))",md:"repeat(3, minmax(0, 1fr))",lg:"repeat(5, minmax(0, 1fr))"}},children:bne.map(o=>i.jsxs(J,{sx:s=>({borderRadius:3,p:3,display:"flex",flexDirection:"column",gap:1,border:`1px solid ${yn(s.palette[o.palette].main,.28)}`,background:`linear-gradient(135deg, ${yn(s.palette[o.palette].main,.18)} 0%, ${yn(s.palette[o.palette].main,.06)} 100%)`,boxShadow:`0 12px 30px -20px ${yn(s.palette[o.palette].main,.6)}`,color:s.palette.text.primary}),children:[i.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:1.25},children:[i.jsx(J,{sx:s=>({display:"inline-flex",alignItems:"center",justifyContent:"center",width:40,height:40,borderRadius:"50%",backgroundColor:yn(s.palette[o.palette].main,.2),color:s.palette[o.palette].dark}),children:o.icon}),i.jsx(B,{variant:"subtitle2",color:"text.secondary",children:o.label})]}),i.jsx(B,{variant:"h4",sx:{fontWeight:600},children:e[o.key]??0})]},o.key))}):i.jsx(B,{variant:"body2",color:"text.secondary",children:"Task data is not available yet. Create your first task to populate this overview."})})]})]})},_ne=e=>{if(!e)return{};const t={};return e.status&&e.status.length>0&&(t.status=e.status.join(",")),typeof e.assignedTo=="number"&&(t.assignedTo=String(e.assignedTo)),e.dueFrom&&(t.dueFrom=e.dueFrom),e.dueTo&&(t.dueTo=e.dueTo),e.search&&(t.search=e.search.trim()),typeof e.includeCompleted=="boolean"&&(t.includeCompleted=String(e.includeCompleted)),typeof e.includeArchived=="boolean"&&(t.includeArchived=String(e.includeArchived)),t},wne=async e=>(await ve.get("/api/tasks",{params:_ne(e)})).data.tasks,jne=async e=>(await ve.get(`/api/tasks/${e}/overview`)).data,Sne=async e=>(await ve.post("/api/tasks",e)).data,Cne=async(e,t)=>(await ve.put(`/api/tasks/${e}`,t)).data,Ane=async(e,t)=>(await ve.patch(`/api/tasks/${e}/assignments`,{assigneeIds:t})).data,Pne=async(e,t)=>(await ve.patch(`/api/tasks/${e}/complete`,{completed:t})).data,One=async(e,t)=>(await ve.post(`/api/tasks/${e}/notes`,{note:t})).data,kne=async e=>{await ve.delete(`/api/tasks/${e}`)},yw=async()=>(await ve.get("/api/tasks/summary")).data,Tne=async()=>(await ve.get("/api/tasks/assignees")).data.assignees,Ene={Purchasing:i.jsx(Bu,{sx:{color:"primary.main"}}),Sales:i.jsx(xs,{sx:{color:"primary.main"}}),"Products & Inventory":i.jsx(di,{sx:{color:"primary.main"}}),"Time Tracking":i.jsx(Nc,{sx:{color:"primary.main"}}),"Human Resources":i.jsx($h,{sx:{color:"primary.main"}}),Settings:i.jsx(Qw,{sx:{color:"primary.main"}})},tE=()=>{const e=Nn(),t=jI(),{user:r}=ea(),[n,a]=y.useState(null),[o,s]=y.useState(!1),l=y.useCallback(async()=>{s(!0);try{const d=await yw();a(d)}catch(d){console.error("Failed to load task summary",d)}finally{s(!1)}},[]);y.useEffect(()=>{l()},[l]),console.log("[LandingPage] user:",r);let u=[{title:"Purchasing",items:[{title:"Purchase Orders",description:"Manage purchase orders",icon:i.jsx(Bu,{sx:{fontSize:40,color:"primary.main"}}),path:"/open-purchase-orders"},{title:"Invoice Automator",description:"Create purchase orders from invoice emails",icon:i.jsx(lg,{sx:{fontSize:40,color:"primary.main"}}),path:"/invoice-automator"},{title:"Return Orders",description:"Track vendor returns tied to POs",icon:i.jsx(cg,{sx:{fontSize:40,color:"primary.main"}}),path:"/return-orders"},{title:"Parts to Order",description:"Manage parts ordering",icon:i.jsx(di,{sx:{fontSize:40,color:"primary.main"}}),path:"/parts-to-order"},{title:"Vendors",description:"Manage your vendors",icon:i.jsx(SI,{sx:{fontSize:40,color:"primary.main"}}),path:"/vendors"}]},{title:"Sales",items:[{title:"Quotes",description:"Manage and track quotes",icon:i.jsx(q2,{sx:{fontSize:40,color:"primary.main"}}),path:"/quotes"},{title:"Sales Orders",description:"Manage sales orders",icon:i.jsx(xs,{sx:{fontSize:40,color:"primary.main"}}),path:"/open-sales-orders"},{title:"Invoices",description:"Track and edit invoices",icon:i.jsx(xs,{sx:{fontSize:40,color:"primary.main"}}),path:"/invoices"},{title:"Customers",description:"Track and manage your customer relationships",icon:i.jsx($h,{sx:{fontSize:40,color:"primary.main"}}),path:"/customers"}]},{title:"Products & Inventory",items:[{title:"Products",description:"Manage your products",icon:i.jsx(CI,{sx:{fontSize:40,color:"primary.main"}}),path:"/products"},{title:"Stock",description:"Manage your product inventory and stock levels",icon:i.jsx(di,{sx:{fontSize:40,color:"primary.main"}}),path:"/inventory"},{title:"Supply",description:"Manage supply and materials",icon:i.jsx(di,{sx:{fontSize:40,color:"primary.main"}}),path:"/supply"},{title:"Service",description:"Manage service line items",icon:i.jsx(di,{sx:{fontSize:40,color:"primary.main"}}),path:"/service"}]},{title:"Time Tracking",items:[{title:"Attendance",description:"View and manage attendance records",icon:i.jsx(Nc,{sx:{fontSize:40,color:"primary.main"}}),path:"/attendance"},{title:"Time Tracking",description:"Track employee time and project hours",icon:i.jsx(Nc,{sx:{fontSize:40,color:"primary.main"}}),path:"/time-tracking"},{title:"Time Tracking Reports",description:"View and export time tracking reports",icon:i.jsx(AI,{sx:{fontSize:40,color:"primary.main"}}),path:"/time-tracking/reports"}]},{title:"Human Resources",items:[{title:"Employees",description:"Manage employee accounts and roles",icon:i.jsx(PI,{sx:{fontSize:40,color:"primary.main"}}),path:"/employees"},{title:"Profile Documents",description:"Manage and track employee document access and read status",icon:i.jsx(Bu,{sx:{fontSize:40,color:"primary.main"}}),path:"/profile-documents"},{title:"Leave Management",description:"Manage employee leave requests and approvals",icon:i.jsx(OI,{sx:{fontSize:40,color:"primary.main"}}),path:"/leave-management"},{title:"Mobile User Access",description:"Manage mobile user access to profiles",icon:i.jsx($h,{sx:{fontSize:40,color:"primary.main"}}),path:"/mobile-user-access"}]},{title:"Settings",items:[{title:"Business Profile",description:"Manage your company information and settings",icon:i.jsx(Qw,{sx:{fontSize:40,color:"primary.main"}}),path:"/business-profile"},{title:"Accounting",description:"Configure QuickBooks account mappings",icon:i.jsx(ug,{sx:{fontSize:40,color:"primary.main"}}),path:"/qbo-account-mapping"},{title:"Global Variables",description:"Set and manage margin, labour, and overhead rates",icon:i.jsx(ug,{sx:{fontSize:40,color:"primary.main"}}),path:"/margin-schedule"},{title:"Email Settings",description:"Configure system email settings",icon:i.jsx(dg,{sx:{fontSize:40,color:"primary.main"}}),path:"/email-settings"},{title:"Backup Management",description:"Manage system backups and restores",icon:i.jsx(Xw,{sx:{fontSize:40,color:"primary.main"}}),path:"/backup-management"}]}];return r?.access_role==="Sales and Purchase"&&(u=[{title:"Sales & Purchase",items:[{title:"Sales Orders",description:"Manage sales orders",icon:i.jsx(xs,{sx:{fontSize:40,color:"primary.main"}}),path:"/open-sales-orders"},{title:"Invoices",description:"Track and edit invoices",icon:i.jsx(xs,{sx:{fontSize:40,color:"primary.main"}}),path:"/invoices"},{title:"Purchase Orders",description:"Manage purchase orders",icon:i.jsx(Bu,{sx:{fontSize:40,color:"primary.main"}}),path:"/open-purchase-orders"},{title:"Invoice Automator",description:"Create purchase orders from invoice emails",icon:i.jsx(lg,{sx:{fontSize:40,color:"primary.main"}}),path:"/invoice-automator"},{title:"Return Orders",description:"Track vendor returns tied to POs",icon:i.jsx(cg,{sx:{fontSize:40,color:"primary.main"}}),path:"/return-orders"},{title:"Parts to Order",description:"View parts that need to be ordered",icon:i.jsx(di,{sx:{fontSize:40,color:"primary.main"}}),path:"/parts-to-order"}]},{title:"Inventory",items:[{title:"Stock",description:"Manage your product inventory and stock levels",icon:i.jsx(di,{sx:{fontSize:40,color:"primary.main"}}),path:"/inventory"},{title:"Supply",description:"Manage supply and materials",icon:i.jsx(di,{sx:{fontSize:40,color:"primary.main"}}),path:"/supply"},{title:"Service",description:"Manage service line items",icon:i.jsx(di,{sx:{fontSize:40,color:"primary.main"}}),path:"/service"}]},{title:"Settings",items:[{title:"Email Settings",description:"Configure your email settings",icon:i.jsx(dg,{sx:{fontSize:40,color:"primary.main"}}),path:"/email-settings"}]}]),r?.access_role==="Quotes"&&(u=[{title:"Quotes",items:[{title:"Quotes",description:"Manage and track quotes",icon:i.jsx(q2,{sx:{fontSize:40,color:"primary.main"}}),path:"/quotes"}]}]),console.log("[LandingPage] filteredSections:",u),i.jsxs(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(J,{sx:{background:`linear-gradient(90deg, ${t.palette.primary.main} 0%, ${t.palette.secondary.main} 100%)`,borderRadius:3,p:4,mb:6,color:t.palette.primary.contrastText,boxShadow:3,textAlign:"center"},children:[i.jsx(B,{variant:"h3",component:"h1",gutterBottom:!0,sx:{color:"inherit"},children:"Welcome to Aiven"}),i.jsx(B,{variant:"h5",component:"h2",gutterBottom:!0,sx:{color:"inherit",opacity:.85},children:"Your all-in-one business management solution"})]}),i.jsx(J,{sx:{mb:6},children:i.jsx(YL,{summary:n,loading:o,onRefresh:l,onViewTasks:()=>e("/tasks")})}),u.map((d,f)=>i.jsx(a5,{in:!0,timeout:700+f*200,children:i.jsxs(J,{sx:{mt:6,mb:4,p:3,borderRadius:3,background:t.palette.mode==="light"?t.palette.grey[50]:t.palette.grey[900],boxShadow:1},children:[i.jsxs(J,{sx:{display:"flex",alignItems:"center",mb:2},children:[i.jsx(Tp,{sx:{bgcolor:"primary.main",mr:2},children:Ene[d.title]||i.jsx(R2,{sx:{color:"primary.main"}})}),i.jsx(B,{variant:"h4",component:"h2",sx:{color:"primary.main",fontWeight:600},children:d.title})]}),i.jsx(ie,{container:!0,spacing:4,children:d.items.map((h,p)=>i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(a5,{in:!0,timeout:900+p*150,children:i.jsx(Br,{sx:{height:"100%",display:"flex",flexDirection:"column",borderRadius:2,boxShadow:2,transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-6px) scale(1.03)",boxShadow:6,cursor:"pointer"},bgcolor:"background.paper"},onClick:()=>e(h.path),tabIndex:0,role:"button","aria-label":h.title,children:i.jsxs(Vr,{sx:{flexGrow:1,textAlign:"center"},children:[h.icon,i.jsx(B,{gutterBottom:!0,variant:"h5",component:"h2",children:h.title}),i.jsx(B,{children:h.description})]})})})},p))}),f<u.length-1&&i.jsx(Gn,{sx:{mt:4,mb:2}})]})},d.title))]})};var Cf={},rE;function Ine(){if(rE)return Cf;rE=1;var e=cr();Object.defineProperty(Cf,"__esModule",{value:!0}),Cf.default=void 0;var t=e(dr()),r=ur();return Cf.default=(0,t.default)((0,r.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),Cf}var Nne=Ine();const ua=It(Nne);var Af={},nE;function Dne(){if(nE)return Af;nE=1;var e=cr();Object.defineProperty(Af,"__esModule",{value:!0}),Af.default=void 0;var t=e(dr()),r=ur();return Af.default=(0,t.default)((0,r.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),Af}var Mne=Dne();const Ap=It(Mne);var Pf={},aE;function Lne(){if(aE)return Pf;aE=1;var e=cr();Object.defineProperty(Pf,"__esModule",{value:!0}),Pf.default=void 0;var t=e(dr()),r=ur();return Pf.default=(0,t.default)((0,r.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),Pf}var Rne=Lne();const tu=It(Rne),Pp=e=>typeof e=="number"&&!isNaN(e),Uc=e=>typeof e=="string",jo=e=>typeof e=="function",Xm=e=>Uc(e)||jo(e)?e:null,xw=e=>y.isValidElement(e)||Uc(e)||jo(e)||Pp(e);function qne(e,t,r){r===void 0&&(r=300);const{scrollHeight:n,style:a}=e;requestAnimationFrame(()=>{a.minHeight="initial",a.height=n+"px",a.transition=`all ${r}ms`,requestAnimationFrame(()=>{a.height="0",a.padding="0",a.margin="0",setTimeout(t,r)})})}function Cy(e){let{enter:t,exit:r,appendPosition:n=!1,collapse:a=!0,collapseDuration:o=300}=e;return function(s){let{children:l,position:c,preventExitTransition:u,done:d,nodeRef:f,isIn:h,playToast:p}=s;const g=n?`${t}--${c}`:t,m=n?`${r}--${c}`:r,x=y.useRef(0);return y.useLayoutEffect(()=>{const b=f.current,_=g.split(" "),w=A=>{A.target===f.current&&(p(),b.removeEventListener("animationend",w),b.removeEventListener("animationcancel",w),x.current===0&&A.type!=="animationcancel"&&b.classList.remove(..._))};b.classList.add(..._),b.addEventListener("animationend",w),b.addEventListener("animationcancel",w)},[]),y.useEffect(()=>{const b=f.current,_=()=>{b.removeEventListener("animationend",_),a?qne(b,d,o):d()};h||(u?_():(x.current=1,b.className+=` ${m}`,b.addEventListener("animationend",_)))},[h]),Ce.createElement(Ce.Fragment,null,l)}}function iE(e,t){return e!=null?{content:e.content,containerId:e.props.containerId,id:e.props.toastId,theme:e.props.theme,type:e.props.type,data:e.props.data||{},isLoading:e.props.isLoading,icon:e.props.icon,status:t}:{}}const Mi=new Map;let Op=[];const bw=new Set,Fne=e=>bw.forEach(t=>t(e)),KL=()=>Mi.size>0;function QL(e,t){var r;if(t)return!((r=Mi.get(t))==null||!r.isToastActive(e));let n=!1;return Mi.forEach(a=>{a.isToastActive(e)&&(n=!0)}),n}function XL(e,t){xw(e)&&(KL()||Op.push({content:e,options:t}),Mi.forEach(r=>{r.buildToast(e,t)}))}function oE(e,t){Mi.forEach(r=>{t!=null&&t!=null&&t.containerId?t?.containerId===r.id&&r.toggle(e,t?.id):r.toggle(e,t?.id)})}function $ne(e){const{subscribe:t,getSnapshot:r,setProps:n}=y.useRef(function(o){const s=o.containerId||1;return{subscribe(l){const c=function(d,f,h){let p=1,g=0,m=[],x=[],b=[],_=f;const w=new Map,A=new Set,O=()=>{b=Array.from(w.values()),A.forEach(S=>S())},T=S=>{x=S==null?[]:x.filter(I=>I!==S),O()},E=S=>{const{toastId:I,onOpen:z,updateId:k,children:M}=S.props,R=k==null;S.staleId&&w.delete(S.staleId),w.set(I,S),x=[...x,S.props.toastId].filter(F=>F!==S.staleId),O(),h(iE(S,R?"added":"updated")),R&&jo(z)&&z(y.isValidElement(M)&&M.props)};return{id:d,props:_,observe:S=>(A.add(S),()=>A.delete(S)),toggle:(S,I)=>{w.forEach(z=>{I!=null&&I!==z.props.toastId||jo(z.toggle)&&z.toggle(S)})},removeToast:T,toasts:w,clearQueue:()=>{g-=m.length,m=[]},buildToast:(S,I)=>{if((C=>{let{containerId:L,toastId:H,updateId:U}=C;const te=L?L!==d:d!==1,le=w.has(H)&&U==null;return te||le})(I))return;const{toastId:z,updateId:k,data:M,staleId:R,delay:F}=I,W=()=>{T(z)},K=k==null;K&&g++;const Z={..._,style:_.toastStyle,key:p++,...Object.fromEntries(Object.entries(I).filter(C=>{let[L,H]=C;return H!=null})),toastId:z,updateId:k,data:M,closeToast:W,isIn:!1,className:Xm(I.className||_.toastClassName),bodyClassName:Xm(I.bodyClassName||_.bodyClassName),progressClassName:Xm(I.progressClassName||_.progressClassName),autoClose:!I.isLoading&&(D=I.autoClose,P=_.autoClose,D===!1||Pp(D)&&D>0?D:P),deleteToast(){const C=w.get(z),{onClose:L,children:H}=C.props;jo(L)&&L(y.isValidElement(H)&&H.props),h(iE(C,"removed")),w.delete(z),g--,g<0&&(g=0),m.length>0?E(m.shift()):O()}};var D,P;Z.closeButton=_.closeButton,I.closeButton===!1||xw(I.closeButton)?Z.closeButton=I.closeButton:I.closeButton===!0&&(Z.closeButton=!xw(_.closeButton)||_.closeButton);let $=S;y.isValidElement(S)&&!Uc(S.type)?$=y.cloneElement(S,{closeToast:W,toastProps:Z,data:M}):jo(S)&&($=S({closeToast:W,toastProps:Z,data:M}));const Q={content:$,props:Z,staleId:R};_.limit&&_.limit>0&&g>_.limit&&K?m.push(Q):Pp(F)?setTimeout(()=>{E(Q)},F):E(Q)},setProps(S){_=S},setToggle:(S,I)=>{w.get(S).toggle=I},isToastActive:S=>x.some(I=>I===S),getSnapshot:()=>b}}(s,o,Fne);Mi.set(s,c);const u=c.observe(l);return Op.forEach(d=>XL(d.content,d.options)),Op=[],()=>{u(),Mi.delete(s)}},setProps(l){var c;(c=Mi.get(s))==null||c.setProps(l)},getSnapshot(){var l;return(l=Mi.get(s))==null?void 0:l.getSnapshot()}}}(e)).current;n(e);const a=y.useSyncExternalStore(t,r,r);return{getToastToRender:function(o){if(!a)return[];const s=new Map;return e.newestOnTop&&a.reverse(),a.forEach(l=>{const{position:c}=l.props;s.has(c)||s.set(c,[]),s.get(c).push(l)}),Array.from(s,l=>o(l[0],l[1]))},isToastActive:QL,count:a?.length}}function Bne(e){const[t,r]=y.useState(!1),[n,a]=y.useState(!1),o=y.useRef(null),s=y.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:l,pauseOnHover:c,closeToast:u,onClick:d,closeOnClick:f}=e;var h,p;function g(){r(!0)}function m(){r(!1)}function x(w){const A=o.current;s.canDrag&&A&&(s.didMove=!0,t&&m(),s.delta=e.draggableDirection==="x"?w.clientX-s.start:w.clientY-s.start,s.start!==w.clientX&&(s.canCloseOnClick=!1),A.style.transform=`translate3d(${e.draggableDirection==="x"?`${s.delta}px, var(--y)`:`0, calc(${s.delta}px + var(--y))`},0)`,A.style.opacity=""+(1-Math.abs(s.delta/s.removalDistance)))}function b(){document.removeEventListener("pointermove",x),document.removeEventListener("pointerup",b);const w=o.current;if(s.canDrag&&s.didMove&&w){if(s.canDrag=!1,Math.abs(s.delta)>s.removalDistance)return a(!0),e.closeToast(),void e.collapseAll();w.style.transition="transform 0.2s, opacity 0.2s",w.style.removeProperty("transform"),w.style.removeProperty("opacity")}}(p=Mi.get((h={id:e.toastId,containerId:e.containerId,fn:r}).containerId||1))==null||p.setToggle(h.id,h.fn),y.useEffect(()=>{if(e.pauseOnFocusLoss)return document.hasFocus()||m(),window.addEventListener("focus",g),window.addEventListener("blur",m),()=>{window.removeEventListener("focus",g),window.removeEventListener("blur",m)}},[e.pauseOnFocusLoss]);const _={onPointerDown:function(w){if(e.draggable===!0||e.draggable===w.pointerType){s.didMove=!1,document.addEventListener("pointermove",x),document.addEventListener("pointerup",b);const A=o.current;s.canCloseOnClick=!0,s.canDrag=!0,A.style.transition="none",e.draggableDirection==="x"?(s.start=w.clientX,s.removalDistance=A.offsetWidth*(e.draggablePercent/100)):(s.start=w.clientY,s.removalDistance=A.offsetHeight*(e.draggablePercent===80?1.5*e.draggablePercent:e.draggablePercent)/100)}},onPointerUp:function(w){const{top:A,bottom:O,left:T,right:E}=o.current.getBoundingClientRect();w.nativeEvent.type!=="touchend"&&e.pauseOnHover&&w.clientX>=T&&w.clientX<=E&&w.clientY>=A&&w.clientY<=O?m():g()}};return l&&c&&(_.onMouseEnter=m,e.stacked||(_.onMouseLeave=g)),f&&(_.onClick=w=>{d&&d(w),s.canCloseOnClick&&u()}),{playToast:g,pauseToast:m,isRunning:t,preventExitTransition:n,toastRef:o,eventHandlers:_}}function Une(e){let{delay:t,isRunning:r,closeToast:n,type:a="default",hide:o,className:s,style:l,controlledProgress:c,progress:u,rtl:d,isIn:f,theme:h}=e;const p=o||c&&u===0,g={...l,animationDuration:`${t}ms`,animationPlayState:r?"running":"paused"};c&&(g.transform=`scaleX(${u})`);const m=Nr("Toastify__progress-bar",c?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${h}`,`Toastify__progress-bar--${a}`,{"Toastify__progress-bar--rtl":d}),x=jo(s)?s({rtl:d,type:a,defaultClassName:m}):Nr(m,s),b={[c&&u>=1?"onTransitionEnd":"onAnimationEnd"]:c&&u<1?null:()=>{f&&n()}};return Ce.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":p},Ce.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${h} Toastify__progress-bar--${a}`}),Ce.createElement("div",{role:"progressbar","aria-hidden":p?"true":"false","aria-label":"notification timer",className:x,style:g,...b}))}let zne=1;const JL=()=>""+zne++;function Wne(e){return e&&(Uc(e.toastId)||Pp(e.toastId))?e.toastId:JL()}function Lh(e,t){return XL(e,t),t.toastId}function mv(e,t){return{...t,type:t&&t.type||e,toastId:Wne(t)}}function Tm(e){return(t,r)=>Lh(t,mv(e,r))}function ge(e,t){return Lh(e,mv("default",t))}ge.loading=(e,t)=>Lh(e,mv("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...t})),ge.promise=function(e,t,r){let n,{pending:a,error:o,success:s}=t;a&&(n=Uc(a)?ge.loading(a,r):ge.loading(a.render,{...r,...a}));const l={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},c=(d,f,h)=>{if(f==null)return void ge.dismiss(n);const p={type:d,...l,...r,data:h},g=Uc(f)?{render:f}:f;return n?ge.update(n,{...p,...g}):ge(g.render,{...p,...g}),h},u=jo(e)?e():e;return u.then(d=>c("success",s,d)).catch(d=>c("error",o,d)),u},ge.success=Tm("success"),ge.info=Tm("info"),ge.error=Tm("error"),ge.warning=Tm("warning"),ge.warn=ge.warning,ge.dark=(e,t)=>Lh(e,mv("default",{theme:"dark",...t})),ge.dismiss=function(e){(function(t){var r;if(KL()){if(t==null||Uc(r=t)||Pp(r))Mi.forEach(n=>{n.removeToast(t)});else if(t&&("containerId"in t||"id"in t)){const n=Mi.get(t.containerId);n?n.removeToast(t.id):Mi.forEach(a=>{a.removeToast(t.id)})}}else Op=Op.filter(n=>t!=null&&n.options.toastId!==t)})(e)},ge.clearWaitingQueue=function(e){e===void 0&&(e={}),Mi.forEach(t=>{!t.props.limit||e.containerId&&t.id!==e.containerId||t.clearQueue()})},ge.isActive=QL,ge.update=function(e,t){t===void 0&&(t={});const r=((n,a)=>{var o;let{containerId:s}=a;return(o=Mi.get(s||1))==null?void 0:o.toasts.get(n)})(e,t);if(r){const{props:n,content:a}=r,o={delay:100,...n,...t,toastId:t.toastId||e,updateId:JL()};o.toastId!==e&&(o.staleId=e);const s=o.render||a;delete o.render,Lh(s,o)}},ge.done=e=>{ge.update(e,{progress:1})},ge.onChange=function(e){return bw.add(e),()=>{bw.delete(e)}},ge.play=e=>oE(!0,e),ge.pause=e=>oE(!1,e);const Hne=typeof window<"u"?y.useLayoutEffect:y.useEffect,Em=e=>{let{theme:t,type:r,isLoading:n,...a}=e;return Ce.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:t==="colored"?"currentColor":`var(--toastify-icon-color-${r})`,...a})},f2={info:function(e){return Ce.createElement(Em,{...e},Ce.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(e){return Ce.createElement(Em,{...e},Ce.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(e){return Ce.createElement(Em,{...e},Ce.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(e){return Ce.createElement(Em,{...e},Ce.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return Ce.createElement("div",{className:"Toastify__spinner"})}},Vne=e=>{const{isRunning:t,preventExitTransition:r,toastRef:n,eventHandlers:a,playToast:o}=Bne(e),{closeButton:s,children:l,autoClose:c,onClick:u,type:d,hideProgressBar:f,closeToast:h,transition:p,position:g,className:m,style:x,bodyClassName:b,bodyStyle:_,progressClassName:w,progressStyle:A,updateId:O,role:T,progress:E,rtl:S,toastId:I,deleteToast:z,isIn:k,isLoading:M,closeOnClick:R,theme:F}=e,W=Nr("Toastify__toast",`Toastify__toast-theme--${F}`,`Toastify__toast--${d}`,{"Toastify__toast--rtl":S},{"Toastify__toast--close-on-click":R}),K=jo(m)?m({rtl:S,position:g,type:d,defaultClassName:W}):Nr(W,m),Z=function(Q){let{theme:C,type:L,isLoading:H,icon:U}=Q,te=null;const le={theme:C,type:L};return U===!1||(jo(U)?te=U({...le,isLoading:H}):y.isValidElement(U)?te=y.cloneElement(U,le):H?te=f2.spinner():(oe=>oe in f2)(L)&&(te=f2[L](le))),te}(e),D=!!E||!c,P={closeToast:h,type:d,theme:F};let $=null;return s===!1||($=jo(s)?s(P):y.isValidElement(s)?y.cloneElement(s,P):function(Q){let{closeToast:C,theme:L,ariaLabel:H="close"}=Q;return Ce.createElement("button",{className:`Toastify__close-button Toastify__close-button--${L}`,type:"button",onClick:U=>{U.stopPropagation(),C(U)},"aria-label":H},Ce.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},Ce.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}(P)),Ce.createElement(p,{isIn:k,done:z,position:g,preventExitTransition:r,nodeRef:n,playToast:o},Ce.createElement("div",{id:I,onClick:u,"data-in":k,className:K,...a,style:x,ref:n},Ce.createElement("div",{...k&&{role:T},className:jo(b)?b({type:d}):Nr("Toastify__toast-body",b),style:_},Z!=null&&Ce.createElement("div",{className:Nr("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!M})},Z),Ce.createElement("div",null,l)),$,Ce.createElement(Une,{...O&&!D?{key:`pb-${O}`}:{},rtl:S,theme:F,delay:c,isRunning:t,isIn:k,closeToast:h,hide:f,type:d,style:A,className:w,controlledProgress:D,progress:E||0})))},Ay=function(e,t){return t===void 0&&(t=!1),{enter:`Toastify--animate Toastify__${e}-enter`,exit:`Toastify--animate Toastify__${e}-exit`,appendPosition:t}},Gne=Cy(Ay("bounce",!0));Cy(Ay("slide",!0));Cy(Ay("zoom"));Cy(Ay("flip"));const Yne={position:"top-right",transition:Gne,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"};function Kne(e){let t={...Yne,...e};const r=e.stacked,[n,a]=y.useState(!0),o=y.useRef(null),{getToastToRender:s,isToastActive:l,count:c}=$ne(t),{className:u,style:d,rtl:f,containerId:h}=t;function p(m){const x=Nr("Toastify__toast-container",`Toastify__toast-container--${m}`,{"Toastify__toast-container--rtl":f});return jo(u)?u({position:m,rtl:f,defaultClassName:x}):Nr(x,Xm(u))}function g(){r&&(a(!0),ge.play())}return Hne(()=>{if(r){var m;const x=o.current.querySelectorAll('[data-in="true"]'),b=12,_=(m=t.position)==null?void 0:m.includes("top");let w=0,A=0;Array.from(x).reverse().forEach((O,T)=>{const E=O;E.classList.add("Toastify__toast--stacked"),T>0&&(E.dataset.collapsed=`${n}`),E.dataset.pos||(E.dataset.pos=_?"top":"bot");const S=w*(n?.2:1)+(n?0:b*T);E.style.setProperty("--y",`${_?S:-1*S}px`),E.style.setProperty("--g",`${b}`),E.style.setProperty("--s",""+(1-(n?A:0))),w+=E.offsetHeight,A+=.025})}},[n,c,r]),Ce.createElement("div",{ref:o,className:"Toastify",id:h,onMouseEnter:()=>{r&&(a(!1),ge.pause())},onMouseLeave:g},s((m,x)=>{const b=x.length?{...d}:{...d,pointerEvents:"none"};return Ce.createElement("div",{className:p(m),style:b,key:`container-${m}`},x.map(_=>{let{content:w,props:A}=_;return Ce.createElement(Vne,{...A,stacked:r,collapseAll:g,isIn:l(A.toastId,A.containerId),style:A.style,key:`toast-${A.key}`},w)}))}))}const Ql="/assets/default-logo-BbiCiEKs.png",Va=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),Qne=e=>{const t=Number(e);if(!Number.isFinite(t))return"0.00";let n=Number(t.toFixed(4)).toFixed(4);if(n=n.replace(/0+$/,""),n.endsWith(".")&&(n=n.slice(0,-1)),!n.includes("."))return`${n}.00`;const[a,o]=n.split(".");return o.length<2?`${a}.${o.padEnd(2,"0")}`:n},sE=e=>{if(console.log("getLogoUrl called with:",e),!e)return console.log("No logo URL provided, using default"),Ql;if(e.startsWith("http://")||e.startsWith("https://"))return console.log("Logo URL is already a full URL:",e),e;if(e.includes("\\")||e.includes(":/")||e.includes(":\\")){const n=e.split(/[\\\/]/).pop()||e;if(console.log("Extracted filename from Windows path:",n),!n||n===e)return console.warn("Could not extract valid filename from Windows path, using default"),Ql;const{baseURL:a}=Wu(),o=`${a.replace(/\/$/,"")}/uploads/${n}`;return console.log("Built final URL from Windows path:",o),o}if(e.startsWith("/")){const n=e.split("/").pop()||e;if(console.log("Extracted filename from Unix path:",n),!n||n===e)return console.warn("Could not extract valid filename from Unix path, using default"),Ql;const{baseURL:a}=Wu(),o=`${a.replace(/\/$/,"")}/uploads/${n}`;return console.log("Built final URL from Unix path:",o),o}if(e.includes("\\")||e.includes(":/")||e.includes(":\\"))return console.warn("Invalid filename format, using default"),Ql;const{baseURL:t}=Wu(),r=`${t.replace(/\/$/,"")}/uploads/${e}`;return console.log("Built final URL from filename:",r),r};Wu().baseURL;const Xne=()=>{Nn();const[e,t]=y.useState({id:"",business_name:"",street_address:"",city:"",province:"",country:"",postal_code:"",telephone_number:"",email:"",business_number:"",website:"",logo_url:"",geo_fence_enabled:!1,geo_fence_center_latitude:"",geo_fence_center_longitude:"",geo_fence_radius_meters:"",created_at:"",updated_at:""}),[r,n]=y.useState(!1),[a,o]=y.useState(null),[s,l]=y.useState(null),[c,u]=y.useState(!1),d=w=>({id:w.id||"",business_name:w.business_name||"",street_address:w.street_address||"",city:w.city||"",province:w.province||"",country:w.country||"",postal_code:w.postal_code||"",telephone_number:w.telephone_number||"",email:w.email||"",business_number:w.business_number||"",website:w.website||"",logo_url:w.logo_url||"",geo_fence_enabled:!!w.geo_fence_enabled,geo_fence_center_latitude:w.geo_fence_center_latitude??"",geo_fence_center_longitude:w.geo_fence_center_longitude??"",geo_fence_radius_meters:w.geo_fence_radius_meters??"",created_at:w.created_at||"",updated_at:w.updated_at||""});y.useEffect(()=>{f()},[]);const f=async()=>{try{const w=await ve.get("/api/business-profile");console.log("Business Profile API Response:",w.data),console.log("Logo URL from API:",w.data.logo_url),t(d(w.data))}catch(w){if(w.response?.status===404){u(!0);return}console.error("Error fetching business profile:",w),ge.error("Failed to load business profile")}},h=w=>{const{name:A,value:O}=w.target;t(T=>({...T,[A]:O}))},p=w=>{if(w.target.files&&w.target.files[0]){const A=w.target.files[0];o(A);const O=URL.createObjectURL(A);l(O)}},g=async()=>{if(e.logo_url)try{n(!0),await ve.delete("/api/business-profile/logo"),t(w=>({...w,logo_url:""})),ge.success("Logo deleted successfully")}catch(w){console.error("Error deleting logo:",w),ge.error("Failed to delete logo")}finally{n(!1)}},m=async w=>{w.preventDefault(),n(!0);try{const A=new FormData;Object.entries(e).forEach(([O,T])=>{let E=O;switch(O){case"business_name":E="business_name";break;case"street_address":E="street_address";break;case"telephone_number":E="telephone_number";break;case"business_number":E="business_number";break;case"email":E="email";break;case"website":E="website";break;case"city":E="city";break;case"province":E="province";break;case"country":E="country";break;case"postal_code":E="postal_code";break;case"logo_url":return;case"id":case"created_at":case"updated_at":return}T!=null&&A.append(E,T)}),a&&A.append("logo",a),console.log("Form data being sent:");for(let[O,T]of A.entries())console.log(`${O}:`,T);await ve.post("/api/business-profile",A,{headers:{"Content-Type":"multipart/form-data"}}),ge.success("Business profile updated successfully"),u(!1),o(null),l(null),f()}catch(A){console.error("Error updating business profile:",A),console.error("Error response:",A.response),console.error("Error message:",A.message),A.response?.status===401?ge.error("Authentication failed. Please log in again."):A.response?.status===403?ge.error("Access denied. You do not have permission to update the business profile."):A.response?.status===404?ge.error("Business profile endpoint not found. Please check your API configuration."):A.response?.status===500?ge.error("Server error. Please try again later."):A.code==="NETWORK_ERROR"?ge.error("Network error. Please check your connection and try again."):A.message?.includes("timeout")?ge.error("Request timed out. Please try again."):ge.error(`Failed to update business profile: ${A.response?.data?.error||A.message||"Unknown error"}`)}finally{n(!1)}},x=()=>{u(!1),o(null),l(null),e.id?f():t({id:"",business_name:"",street_address:"",city:"",province:"",country:"",postal_code:"",telephone_number:"",email:"",business_number:"",logo_url:"",geo_fence_enabled:!1,geo_fence_center_latitude:"",geo_fence_center_longitude:"",geo_fence_radius_meters:"",created_at:"",updated_at:""})};if(r)return i.jsx(J,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:i.jsx(nr,{})});const b=()=>{const w=!!e.id;return i.jsx(J,{display:"flex",justifyContent:"center",alignItems:"flex-start",minHeight:"70vh",children:i.jsx(xt,{sx:{p:{xs:2,md:4},width:"100%",maxWidth:650,borderRadius:4,boxShadow:6,bgcolor:"background.paper"},elevation:6,children:i.jsxs(ct,{spacing:4,children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsx(B,{variant:"h5",fontWeight:700,color:"primary.main",children:w?"Current Business Profile":"Business Profile"}),i.jsx(J,{children:i.jsx(ye,{variant:"contained",startIcon:i.jsx(tu,{}),onClick:()=>u(!0),sx:{borderRadius:2,fontWeight:600},children:w?"Edit Profile":"Create Profile"})})]}),i.jsx(Gn,{sx:{bgcolor:"primary.light",height:3,borderRadius:2}}),w?i.jsxs(i.Fragment,{children:[e.logo_url&&i.jsxs(J,{display:"flex",flexDirection:"column",alignItems:"center",mb:2,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,color:"primary.dark",gutterBottom:!0,children:"Business Logo"}),i.jsx(Br,{sx:{maxWidth:180,borderRadius:3,boxShadow:3,border:"2px solid",borderColor:"primary.light",p:1,mb:1,bgcolor:"grey.50"},children:i.jsx(i5,{component:"img",image:e.logo_url?sE(e.logo_url):Ql,onError:A=>A.currentTarget.src=Ql,alt:"Business Logo",sx:{height:120,objectFit:"contain",borderRadius:2,bgcolor:"white"}})})]}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Business Name"}),i.jsx(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:e.business_name})]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Business Number"}),i.jsx(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:e.business_number})]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Address"}),i.jsxs(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:[e.street_address,i.jsx("br",{}),e.city,", ",e.province,e.postal_code?`, ${e.postal_code}`:"",i.jsx("br",{}),e.country]})]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Email"}),i.jsx(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:e.email})]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Telephone"}),i.jsx(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:e.telephone_number})]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Website"}),i.jsx(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:e.website?i.jsx("a",{href:e.website.startsWith("http")?e.website:`https://${e.website}`,target:"_blank",rel:"noopener noreferrer",style:{color:"inherit",textDecoration:"underline"},children:e.website}):"Not provided"})]}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Attendance Geofence"}),e.geo_fence_enabled?i.jsxs(J,{sx:{p:2,border:"1px solid",borderColor:"primary.light",borderRadius:2,bgcolor:"grey.50"},children:[i.jsx(B,{variant:"body1",fontWeight:600,children:"Enabled"}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Lat: ",e.geo_fence_center_latitude||""," | Lng: ",e.geo_fence_center_longitude||""]}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Radius: ",e.geo_fence_radius_meters||""," meters"]})]}):i.jsx(B,{variant:"body1",fontWeight:500,mb:2,children:"Disabled"})]})]})]}):i.jsxs(J,{textAlign:"center",py:4,children:[i.jsx(B,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Business Profile Found"}),i.jsx(B,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Create your business profile to get started. This information will be used in your quotes, invoices, and other business documents."}),i.jsx(ye,{variant:"contained",size:"large",startIcon:i.jsx(tu,{}),onClick:()=>u(!0),sx:{borderRadius:2,fontWeight:600},children:"Create Business Profile"})]})]})})})},_=()=>i.jsx(J,{display:"flex",justifyContent:"center",alignItems:"flex-start",minHeight:"70vh",children:i.jsx(xt,{sx:{p:{xs:2,md:4},width:"100%",maxWidth:650,borderRadius:4,boxShadow:6,bgcolor:"background.paper"},elevation:6,component:"form",onSubmit:m,children:i.jsxs(ct,{spacing:4,children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsx(B,{variant:"h5",fontWeight:700,color:"primary.main",children:e.id?"Edit Business Profile":"Create Business Profile"}),i.jsxs(J,{children:[i.jsx(ye,{variant:"outlined",onClick:x,sx:{borderRadius:2,fontWeight:600,mr:2},children:"Cancel"}),i.jsx(ye,{variant:"contained",type:"submit",disabled:r,sx:{borderRadius:2,fontWeight:600},children:r?i.jsx(nr,{size:24}):e.id?"Save Changes":"Create Profile"})]})]}),i.jsx(Gn,{sx:{bgcolor:"primary.light",height:3,borderRadius:2}}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{label:"Business Name",name:"business_name",value:e.business_name,onChange:h,fullWidth:!0,required:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{label:"Business Number/GST-HST Registration Number",name:"business_number",value:e.business_number,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{label:"Street Address",name:"street_address",value:e.street_address,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"City",name:"city",value:e.city,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"Province",name:"province",value:e.province,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"Country",name:"country",value:e.country,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"Postal Code",name:"postal_code",value:e.postal_code,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"Telephone Number",name:"telephone_number",value:e.telephone_number,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"Email",name:"email",value:e.email,onChange:h,fullWidth:!0,type:"email"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"Website",name:"website",value:e.website,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsxs(J,{sx:{border:"1px solid",borderColor:"divider",borderRadius:2,p:2,bgcolor:"grey.50"},children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[i.jsxs(J,{children:[i.jsx(B,{variant:"subtitle1",fontWeight:700,children:"Attendance Geofence"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Require staff to be inside this fence to clock in from the mobile app."})]}),i.jsx(ri,{control:i.jsx(hl,{checked:!!e.geo_fence_enabled,onChange:w=>t(A=>({...A,geo_fence_enabled:w.target.checked}))}),label:e.geo_fence_enabled?"Enabled":"Disabled",sx:{m:0}})]}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{label:"Latitude",name:"geo_fence_center_latitude",value:e.geo_fence_center_latitude??"",onChange:h,fullWidth:!0,type:"number",inputProps:{step:"0.000001",min:-90,max:90},disabled:!e.geo_fence_enabled})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{label:"Longitude",name:"geo_fence_center_longitude",value:e.geo_fence_center_longitude??"",onChange:h,fullWidth:!0,type:"number",inputProps:{step:"0.000001",min:-180,max:180},disabled:!e.geo_fence_enabled})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{label:"Radius (meters)",name:"geo_fence_radius_meters",value:e.geo_fence_radius_meters??"",onChange:h,fullWidth:!0,type:"number",inputProps:{min:1},disabled:!e.geo_fence_enabled,InputProps:{endAdornment:i.jsx(oa,{position:"end",children:"m"})}})})]}),!e.geo_fence_enabled&&i.jsx(Ot,{severity:"info",sx:{mt:2},children:"Geofence is turned off. Clock-in will not check location until you enable it."})]})}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx(B,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Business Logo"}),e.logo_url&&i.jsxs(J,{display:"flex",flexDirection:"column",alignItems:"center",mb:2,children:[i.jsx(Br,{sx:{maxWidth:180,borderRadius:3,boxShadow:3,border:"2px solid",borderColor:"primary.light",p:1,mb:1,bgcolor:"grey.50"},children:i.jsx(i5,{component:"img",image:e.logo_url?sE(e.logo_url):Ql,onError:w=>w.currentTarget.src=Ql,alt:"Business Logo",sx:{height:120,objectFit:"contain",borderRadius:2,bgcolor:"white"}})}),i.jsx(ye,{variant:"outlined",color:"error",startIcon:i.jsx(ua,{}),onClick:g,sx:{borderRadius:2,fontWeight:600},children:"Delete Current Logo"})]}),i.jsxs(ye,{variant:"contained",component:"label",startIcon:i.jsx(Ap,{}),sx:{borderRadius:2,fontWeight:600},children:[e.logo_url?"Change Logo":"Upload Logo",i.jsx("input",{type:"file",hidden:!0,onChange:p,accept:"image/*"})]}),s&&i.jsxs(J,{mt:2,display:"flex",flexDirection:"column",alignItems:"center",children:[i.jsx(B,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"New Logo Preview:"}),i.jsx("img",{src:s,alt:"Logo Preview",style:{maxWidth:"100px",maxHeight:"100px"}})]})]})]})]})})});return i.jsx(ir,{sx:{mt:4,mb:4},children:c?_():b()})};var Of={},lE;function Jne(){if(lE)return Of;lE=1;var e=cr();Object.defineProperty(Of,"__esModule",{value:!0}),Of.default=void 0;var t=e(dr()),r=ur();return Of.default=(0,t.default)((0,r.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),Of}var Zne=Jne();const hi=It(Zne);var kf={},cE;function eae(){if(cE)return kf;cE=1;var e=cr();Object.defineProperty(kf,"__esModule",{value:!0}),kf.default=void 0;var t=e(dr()),r=ur();return kf.default=(0,t.default)((0,r.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),kf}var tae=eae();const Ba=It(tae);var Tf={},uE;function rae(){if(uE)return Tf;uE=1;var e=cr();Object.defineProperty(Tf,"__esModule",{value:!0}),Tf.default=void 0;var t=e(dr()),r=ur();return Tf.default=(0,t.default)((0,r.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download"),Tf}var nae=rae();const da=It(nae);var Ef={},dE;function aae(){if(dE)return Ef;dE=1;var e=cr();Object.defineProperty(Ef,"__esModule",{value:!0}),Ef.default=void 0;var t=e(dr()),r=ur();return Ef.default=(0,t.default)((0,r.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile"),Ef}var iae=aae();const ZL=It(iae),fE=async e=>(await ve.get(`/api/customers/${e}/contacts`)).data,oae=async(e,t)=>(await ve.post(`/api/customers/${e}/contacts/people`,t)).data,sae=async(e,t,r)=>(await ve.put(`/api/customers/${e}/contacts/people/${t}`,r)).data,lae=async(e,t)=>(await ve.delete(`/api/customers/${e}/contacts/people/${t}`)).data,cae=async(e,t)=>(await ve.post(`/api/customers/${e}/contacts/emails`,t)).data,uae=async(e,t,r)=>(await ve.put(`/api/customers/${e}/contacts/emails/${t}`,r)).data,dae=async(e,t)=>(await ve.delete(`/api/customers/${e}/contacts/emails/${t}`)).data,fae=async(e,t)=>(await ve.post(`/api/customers/${e}/contacts/phones`,t)).data,hae=async(e,t,r)=>(await ve.put(`/api/customers/${e}/contacts/phones/${t}`,r)).data,pae=async(e,t)=>(await ve.delete(`/api/customers/${e}/contacts/phones/${t}`)).data,hS=async()=>(await ve.get("/api/customers")).data,e6=async e=>(await ve.get(`/api/customers/${e}`)).data,t6=async e=>{const t={...e};return t.default_payment_terms_in_days!==void 0&&(t.default_payment_terms_in_days=Number(t.default_payment_terms_in_days)),(await ve.post("/api/customers",t)).data},pS=async(e,t)=>{const r={...t};return r.default_payment_terms_in_days!==void 0&&(r.default_payment_terms_in_days=Number(r.default_payment_terms_in_days)),(await ve.put(`/api/customers/${e}`,r)).data},mae=async e=>{await ve.delete(`/api/customers/${e}`)},gae=async(e,t)=>{const r=new FormData;return r.append("file",e),(await ve.post("/api/customers/import-excel",r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:t})).data},vae=()=>ve.get("/api/customers/import-excel/template",{responseType:"blob"});var Jm={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var yae=Jm.exports,hE;function xae(){return hE||(hE=1,function(e,t){((r,n)=>{e.exports=n()})(yae,function r(){var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},a,o=!n.document&&!!n.postMessage,s=n.IS_PAPA_WORKER||!1,l={},c=0,u={};function d(S){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(I){var z=O(I);z.chunkSize=parseInt(z.chunkSize),I.step||I.chunk||(z.chunkSize=null),this._handle=new m(z),(this._handle.streamer=this)._config=z}).call(this,S),this.parseChunk=function(I,z){var k=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<k){let R=this._config.newline;R||(M=this._config.quoteChar||'"',R=this._handle.guessLineEndings(I,M)),I=[...I.split(R).slice(k)].join(R)}this.isFirstChunk&&E(this._config.beforeFirstChunk)&&(M=this._config.beforeFirstChunk(I))!==void 0&&(I=M),this.isFirstChunk=!1,this._halted=!1;var k=this._partialLine+I,M=(this._partialLine="",this._handle.parse(k,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(I=M.meta.cursor,k=(this._finished||(this._partialLine=k.substring(I-this._baseIndex),this._baseIndex=I),M&&M.data&&(this._rowCount+=M.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),s)n.postMessage({results:M,workerId:u.WORKER_ID,finished:k});else if(E(this._config.chunk)&&!z){if(this._config.chunk(M,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=M=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(M.data),this._completeResults.errors=this._completeResults.errors.concat(M.errors),this._completeResults.meta=M.meta),this._completed||!k||!E(this._config.complete)||M&&M.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),k||M&&M.meta.paused||this._nextChunk(),M}this._halted=!0},this._sendError=function(I){E(this._config.error)?this._config.error(I):s&&this._config.error&&n.postMessage({workerId:u.WORKER_ID,error:I,finished:!1})}}function f(S){var I;(S=S||{}).chunkSize||(S.chunkSize=u.RemoteChunkSize),d.call(this,S),this._nextChunk=o?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(z){this._input=z,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(I=new XMLHttpRequest,this._config.withCredentials&&(I.withCredentials=this._config.withCredentials),o||(I.onload=T(this._chunkLoaded,this),I.onerror=T(this._chunkError,this)),I.open(this._config.downloadRequestBody?"POST":"GET",this._input,!o),this._config.downloadRequestHeaders){var z,k=this._config.downloadRequestHeaders;for(z in k)I.setRequestHeader(z,k[z])}var M;this._config.chunkSize&&(M=this._start+this._config.chunkSize-1,I.setRequestHeader("Range","bytes="+this._start+"-"+M));try{I.send(this._config.downloadRequestBody)}catch(R){this._chunkError(R.message)}o&&I.status===0&&this._chunkError()}},this._chunkLoaded=function(){I.readyState===4&&(I.status<200||400<=I.status?this._chunkError():(this._start+=this._config.chunkSize||I.responseText.length,this._finished=!this._config.chunkSize||this._start>=(z=>(z=z.getResponseHeader("Content-Range"))!==null?parseInt(z.substring(z.lastIndexOf("/")+1)):-1)(I),this.parseChunk(I.responseText)))},this._chunkError=function(z){z=I.statusText||z,this._sendError(new Error(z))}}function h(S){(S=S||{}).chunkSize||(S.chunkSize=u.LocalChunkSize),d.call(this,S);var I,z,k=typeof FileReader<"u";this.stream=function(M){this._input=M,z=M.slice||M.webkitSlice||M.mozSlice,k?((I=new FileReader).onload=T(this._chunkLoaded,this),I.onerror=T(this._chunkError,this)):I=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var M=this._input,R=(this._config.chunkSize&&(R=Math.min(this._start+this._config.chunkSize,this._input.size),M=z.call(M,this._start,R)),I.readAsText(M,this._config.encoding));k||this._chunkLoaded({target:{result:R}})},this._chunkLoaded=function(M){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(M.target.result)},this._chunkError=function(){this._sendError(I.error)}}function p(S){var I;d.call(this,S=S||{}),this.stream=function(z){return I=z,this._nextChunk()},this._nextChunk=function(){var z,k;if(!this._finished)return z=this._config.chunkSize,I=z?(k=I.substring(0,z),I.substring(z)):(k=I,""),this._finished=!I,this.parseChunk(k)}}function g(S){d.call(this,S=S||{});var I=[],z=!0,k=!1;this.pause=function(){d.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){d.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(M){this._input=M,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){k&&I.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),I.length?this.parseChunk(I.shift()):z=!0},this._streamData=T(function(M){try{I.push(typeof M=="string"?M:M.toString(this._config.encoding)),z&&(z=!1,this._checkIsFinished(),this.parseChunk(I.shift()))}catch(R){this._streamError(R)}},this),this._streamError=T(function(M){this._streamCleanUp(),this._sendError(M)},this),this._streamEnd=T(function(){this._streamCleanUp(),k=!0,this._streamData("")},this),this._streamCleanUp=T(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function m(S){var I,z,k,M,R=Math.pow(2,53),F=-R,W=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,K=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,Z=this,D=0,P=0,$=!1,Q=!1,C=[],L={data:[],errors:[],meta:{}};function H(oe){return S.skipEmptyLines==="greedy"?oe.join("").trim()==="":oe.length===1&&oe[0].length===0}function U(){if(L&&k&&(le("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+u.DefaultDelimiter+"'"),k=!1),S.skipEmptyLines&&(L.data=L.data.filter(function(me){return!H(me)})),te()){let me=function(X,G){E(S.transformHeader)&&(X=S.transformHeader(X,G)),C.push(X)};if(L)if(Array.isArray(L.data[0])){for(var oe=0;te()&&oe<L.data.length;oe++)L.data[oe].forEach(me);L.data.splice(0,1)}else L.data.forEach(me)}function ae(me,X){for(var G=S.header?{}:[],ee=0;ee<me.length;ee++){var se=ee,V=me[ee],V=((He,Ne)=>(Re=>(S.dynamicTypingFunction&&S.dynamicTyping[Re]===void 0&&(S.dynamicTyping[Re]=S.dynamicTypingFunction(Re)),(S.dynamicTyping[Re]||S.dynamicTyping)===!0))(He)?Ne==="true"||Ne==="TRUE"||Ne!=="false"&&Ne!=="FALSE"&&((Re=>{if(W.test(Re)&&(Re=parseFloat(Re),F<Re&&Re<R))return 1})(Ne)?parseFloat(Ne):K.test(Ne)?new Date(Ne):Ne===""?null:Ne):Ne)(se=S.header?ee>=C.length?"__parsed_extra":C[ee]:se,V=S.transform?S.transform(V,se):V);se==="__parsed_extra"?(G[se]=G[se]||[],G[se].push(V)):G[se]=V}return S.header&&(ee>C.length?le("FieldMismatch","TooManyFields","Too many fields: expected "+C.length+" fields but parsed "+ee,P+X):ee<C.length&&le("FieldMismatch","TooFewFields","Too few fields: expected "+C.length+" fields but parsed "+ee,P+X)),G}var he;L&&(S.header||S.dynamicTyping||S.transform)&&(he=1,!L.data.length||Array.isArray(L.data[0])?(L.data=L.data.map(ae),he=L.data.length):L.data=ae(L.data,0),S.header&&L.meta&&(L.meta.fields=C),P+=he)}function te(){return S.header&&C.length===0}function le(oe,ae,he,me){oe={type:oe,code:ae,message:he},me!==void 0&&(oe.row=me),L.errors.push(oe)}E(S.step)&&(M=S.step,S.step=function(oe){L=oe,te()?U():(U(),L.data.length!==0&&(D+=oe.data.length,S.preview&&D>S.preview?z.abort():(L.data=L.data[0],M(L,Z))))}),this.parse=function(oe,ae,he){var me=S.quoteChar||'"',me=(S.newline||(S.newline=this.guessLineEndings(oe,me)),k=!1,S.delimiter?E(S.delimiter)&&(S.delimiter=S.delimiter(oe),L.meta.delimiter=S.delimiter):((me=((X,G,ee,se,V)=>{var He,Ne,Re,Ke;V=V||[",","	","|",";",u.RECORD_SEP,u.UNIT_SEP];for(var nt=0;nt<V.length;nt++){for(var st,gt=V[nt],Ge=0,Je=0,We=0,_t=(Re=void 0,new b({comments:se,delimiter:gt,newline:G,preview:10}).parse(X)),Nt=0;Nt<_t.data.length;Nt++)ee&&H(_t.data[Nt])?We++:(st=_t.data[Nt].length,Je+=st,Re===void 0?Re=st:0<st&&(Ge+=Math.abs(st-Re),Re=st));0<_t.data.length&&(Je/=_t.data.length-We),(Ne===void 0||Ge<=Ne)&&(Ke===void 0||Ke<Je)&&1.99<Je&&(Ne=Ge,He=gt,Ke=Je)}return{successful:!!(S.delimiter=He),bestDelimiter:He}})(oe,S.newline,S.skipEmptyLines,S.comments,S.delimitersToGuess)).successful?S.delimiter=me.bestDelimiter:(k=!0,S.delimiter=u.DefaultDelimiter),L.meta.delimiter=S.delimiter),O(S));return S.preview&&S.header&&me.preview++,I=oe,z=new b(me),L=z.parse(I,ae,he),U(),$?{meta:{paused:!0}}:L||{meta:{paused:!1}}},this.paused=function(){return $},this.pause=function(){$=!0,z.abort(),I=E(S.chunk)?"":I.substring(z.getCharIndex())},this.resume=function(){Z.streamer._halted?($=!1,Z.streamer.parseChunk(I,!0)):setTimeout(Z.resume,3)},this.aborted=function(){return Q},this.abort=function(){Q=!0,z.abort(),L.meta.aborted=!0,E(S.complete)&&S.complete(L),I=""},this.guessLineEndings=function(X,me){X=X.substring(0,1048576);var me=new RegExp(x(me)+"([^]*?)"+x(me),"gm"),he=(X=X.replace(me,"")).split("\r"),me=X.split(`
`),X=1<me.length&&me[0].length<he[0].length;if(he.length===1||X)return`
`;for(var G=0,ee=0;ee<he.length;ee++)he[ee][0]===`
`&&G++;return G>=he.length/2?`\r
`:"\r"}}function x(S){return S.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function b(S){var I=(S=S||{}).delimiter,z=S.newline,k=S.comments,M=S.step,R=S.preview,F=S.fastMode,W=null,K=!1,Z=S.quoteChar==null?'"':S.quoteChar,D=Z;if(S.escapeChar!==void 0&&(D=S.escapeChar),(typeof I!="string"||-1<u.BAD_DELIMITERS.indexOf(I))&&(I=","),k===I)throw new Error("Comment character same as delimiter");k===!0?k="#":(typeof k!="string"||-1<u.BAD_DELIMITERS.indexOf(k))&&(k=!1),z!==`
`&&z!=="\r"&&z!==`\r
`&&(z=`
`);var P=0,$=!1;this.parse=function(Q,C,L){if(typeof Q!="string")throw new Error("Input must be a string");var H=Q.length,U=I.length,te=z.length,le=k.length,oe=E(M),ae=[],he=[],me=[],X=P=0;if(!Q)return Ge();if(F||F!==!1&&Q.indexOf(Z)===-1){for(var G=Q.split(z),ee=0;ee<G.length;ee++){if(me=G[ee],P+=me.length,ee!==G.length-1)P+=z.length;else if(L)return Ge();if(!k||me.substring(0,le)!==k){if(oe){if(ae=[],Ke(me.split(I)),Je(),$)return Ge()}else Ke(me.split(I));if(R&&R<=ee)return ae=ae.slice(0,R),Ge(!0)}}return Ge()}for(var se=Q.indexOf(I,P),V=Q.indexOf(z,P),He=new RegExp(x(D)+x(Z),"g"),Ne=Q.indexOf(Z,P);;)if(Q[P]===Z)for(Ne=P,P++;;){if((Ne=Q.indexOf(Z,Ne+1))===-1)return L||he.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:ae.length,index:P}),st();if(Ne===H-1)return st(Q.substring(P,Ne).replace(He,Z));if(Z===D&&Q[Ne+1]===D)Ne++;else if(Z===D||Ne===0||Q[Ne-1]!==D){se!==-1&&se<Ne+1&&(se=Q.indexOf(I,Ne+1));var Re=nt((V=V!==-1&&V<Ne+1?Q.indexOf(z,Ne+1):V)===-1?se:Math.min(se,V));if(Q.substr(Ne+1+Re,U)===I){me.push(Q.substring(P,Ne).replace(He,Z)),Q[P=Ne+1+Re+U]!==Z&&(Ne=Q.indexOf(Z,P)),se=Q.indexOf(I,P),V=Q.indexOf(z,P);break}if(Re=nt(V),Q.substring(Ne+1+Re,Ne+1+Re+te)===z){if(me.push(Q.substring(P,Ne).replace(He,Z)),gt(Ne+1+Re+te),se=Q.indexOf(I,P),Ne=Q.indexOf(Z,P),oe&&(Je(),$))return Ge();if(R&&ae.length>=R)return Ge(!0);break}he.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:ae.length,index:P}),Ne++}}else if(k&&me.length===0&&Q.substring(P,P+le)===k){if(V===-1)return Ge();P=V+te,V=Q.indexOf(z,P),se=Q.indexOf(I,P)}else if(se!==-1&&(se<V||V===-1))me.push(Q.substring(P,se)),P=se+U,se=Q.indexOf(I,P);else{if(V===-1)break;if(me.push(Q.substring(P,V)),gt(V+te),oe&&(Je(),$))return Ge();if(R&&ae.length>=R)return Ge(!0)}return st();function Ke(We){ae.push(We),X=P}function nt(We){var _t=0;return _t=We!==-1&&(We=Q.substring(Ne+1,We))&&We.trim()===""?We.length:_t}function st(We){return L||(We===void 0&&(We=Q.substring(P)),me.push(We),P=H,Ke(me),oe&&Je()),Ge()}function gt(We){P=We,Ke(me),me=[],V=Q.indexOf(z,P)}function Ge(We){if(S.header&&!C&&ae.length&&!K){var _t=ae[0],Nt=Object.create(null),kt=new Set(_t);let Vt=!1;for(let jt=0;jt<_t.length;jt++){let Tr=_t[jt];if(Nt[Tr=E(S.transformHeader)?S.transformHeader(Tr,jt):Tr]){let qe,$e=Nt[Tr];for(;qe=Tr+"_"+$e,$e++,kt.has(qe););kt.add(qe),_t[jt]=qe,Nt[Tr]++,Vt=!0,(W=W===null?{}:W)[qe]=Tr}else Nt[Tr]=1,_t[jt]=Tr;kt.add(Tr)}Vt&&console.warn("Duplicate headers found and renamed."),K=!0}return{data:ae,errors:he,meta:{delimiter:I,linebreak:z,aborted:$,truncated:!!We,cursor:X+(C||0),renamedHeaders:W}}}function Je(){M(Ge()),ae=[],he=[]}},this.abort=function(){$=!0},this.getCharIndex=function(){return P}}function _(S){var I=S.data,z=l[I.workerId],k=!1;if(I.error)z.userError(I.error,I.file);else if(I.results&&I.results.data){var M={abort:function(){k=!0,w(I.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:A,resume:A};if(E(z.userStep)){for(var R=0;R<I.results.data.length&&(z.userStep({data:I.results.data[R],errors:I.results.errors,meta:I.results.meta},M),!k);R++);delete I.results}else E(z.userChunk)&&(z.userChunk(I.results,M,I.file),delete I.results)}I.finished&&!k&&w(I.workerId,I.results)}function w(S,I){var z=l[S];E(z.userComplete)&&z.userComplete(I),z.terminate(),delete l[S]}function A(){throw new Error("Not implemented.")}function O(S){if(typeof S!="object"||S===null)return S;var I,z=Array.isArray(S)?[]:{};for(I in S)z[I]=O(S[I]);return z}function T(S,I){return function(){S.apply(I,arguments)}}function E(S){return typeof S=="function"}return u.parse=function(S,I){var z=(I=I||{}).dynamicTyping||!1;if(E(z)&&(I.dynamicTypingFunction=z,z={}),I.dynamicTyping=z,I.transform=!!E(I.transform)&&I.transform,!I.worker||!u.WORKERS_SUPPORTED)return z=null,u.NODE_STREAM_INPUT,typeof S=="string"?(S=(k=>k.charCodeAt(0)!==65279?k:k.slice(1))(S),z=new(I.download?f:p)(I)):S.readable===!0&&E(S.read)&&E(S.on)?z=new g(I):(n.File&&S instanceof File||S instanceof Object)&&(z=new h(I)),z.stream(S);(z=(()=>{var k;return!!u.WORKERS_SUPPORTED&&(k=(()=>{var M=n.URL||n.webkitURL||null,R=r.toString();return u.BLOB_URL||(u.BLOB_URL=M.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",R,")();"],{type:"text/javascript"})))})(),(k=new n.Worker(k)).onmessage=_,k.id=c++,l[k.id]=k)})()).userStep=I.step,z.userChunk=I.chunk,z.userComplete=I.complete,z.userError=I.error,I.step=E(I.step),I.chunk=E(I.chunk),I.complete=E(I.complete),I.error=E(I.error),delete I.worker,z.postMessage({input:S,config:I,workerId:z.id})},u.unparse=function(S,I){var z=!1,k=!0,M=",",R=`\r
`,F='"',W=F+F,K=!1,Z=null,D=!1,P=((()=>{if(typeof I=="object"){if(typeof I.delimiter!="string"||u.BAD_DELIMITERS.filter(function(C){return I.delimiter.indexOf(C)!==-1}).length||(M=I.delimiter),typeof I.quotes!="boolean"&&typeof I.quotes!="function"&&!Array.isArray(I.quotes)||(z=I.quotes),typeof I.skipEmptyLines!="boolean"&&typeof I.skipEmptyLines!="string"||(K=I.skipEmptyLines),typeof I.newline=="string"&&(R=I.newline),typeof I.quoteChar=="string"&&(F=I.quoteChar),typeof I.header=="boolean"&&(k=I.header),Array.isArray(I.columns)){if(I.columns.length===0)throw new Error("Option columns is empty");Z=I.columns}I.escapeChar!==void 0&&(W=I.escapeChar+F),I.escapeFormulae instanceof RegExp?D=I.escapeFormulae:typeof I.escapeFormulae=="boolean"&&I.escapeFormulae&&(D=/^[=+\-@\t\r].*$/)}})(),new RegExp(x(F),"g"));if(typeof S=="string"&&(S=JSON.parse(S)),Array.isArray(S)){if(!S.length||Array.isArray(S[0]))return $(null,S,K);if(typeof S[0]=="object")return $(Z||Object.keys(S[0]),S,K)}else if(typeof S=="object")return typeof S.data=="string"&&(S.data=JSON.parse(S.data)),Array.isArray(S.data)&&(S.fields||(S.fields=S.meta&&S.meta.fields||Z),S.fields||(S.fields=Array.isArray(S.data[0])?S.fields:typeof S.data[0]=="object"?Object.keys(S.data[0]):[]),Array.isArray(S.data[0])||typeof S.data[0]=="object"||(S.data=[S.data])),$(S.fields||[],S.data||[],K);throw new Error("Unable to serialize unrecognized input");function $(C,L,H){var U="",te=(typeof C=="string"&&(C=JSON.parse(C)),typeof L=="string"&&(L=JSON.parse(L)),Array.isArray(C)&&0<C.length),le=!Array.isArray(L[0]);if(te&&k){for(var oe=0;oe<C.length;oe++)0<oe&&(U+=M),U+=Q(C[oe],oe);0<L.length&&(U+=R)}for(var ae=0;ae<L.length;ae++){var he=(te?C:L[ae]).length,me=!1,X=te?Object.keys(L[ae]).length===0:L[ae].length===0;if(H&&!te&&(me=H==="greedy"?L[ae].join("").trim()==="":L[ae].length===1&&L[ae][0].length===0),H==="greedy"&&te){for(var G=[],ee=0;ee<he;ee++){var se=le?C[ee]:ee;G.push(L[ae][se])}me=G.join("").trim()===""}if(!me){for(var V=0;V<he;V++){0<V&&!X&&(U+=M);var He=te&&le?C[V]:V;U+=Q(L[ae][He],V)}ae<L.length-1&&(!H||0<he&&!X)&&(U+=R)}}return U}function Q(C,L){var H,U;return C==null?"":C.constructor===Date?JSON.stringify(C).slice(1,25):(U=!1,D&&typeof C=="string"&&D.test(C)&&(C="'"+C,U=!0),H=C.toString().replace(P,W),(U=U||z===!0||typeof z=="function"&&z(C,L)||Array.isArray(z)&&z[L]||((te,le)=>{for(var oe=0;oe<le.length;oe++)if(-1<te.indexOf(le[oe]))return!0;return!1})(H,u.BAD_DELIMITERS)||-1<H.indexOf(M)||H.charAt(0)===" "||H.charAt(H.length-1)===" ")?F+H+F:H)}},u.RECORD_SEP="",u.UNIT_SEP="",u.BYTE_ORDER_MARK="\uFEFF",u.BAD_DELIMITERS=["\r",`
`,'"',u.BYTE_ORDER_MARK],u.WORKERS_SUPPORTED=!o&&!!n.Worker,u.NODE_STREAM_INPUT=1,u.LocalChunkSize=10485760,u.RemoteChunkSize=5242880,u.DefaultDelimiter=",",u.Parser=b,u.ParserHandle=m,u.NetworkStreamer=f,u.FileStreamer=h,u.StringStreamer=p,u.ReadableStreamStreamer=g,n.jQuery&&((a=n.jQuery).fn.parse=function(S){var I=S.config||{},z=[];return this.each(function(R){if(!(a(this).prop("tagName").toUpperCase()==="INPUT"&&a(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var F=0;F<this.files.length;F++)z.push({file:this.files[F],inputElem:this,instanceConfig:a.extend({},I)})}),k(),this;function k(){if(z.length===0)E(S.complete)&&S.complete();else{var R,F,W,K,Z=z[0];if(E(S.before)){var D=S.before(Z.file,Z.inputElem);if(typeof D=="object"){if(D.action==="abort")return R="AbortError",F=Z.file,W=Z.inputElem,K=D.reason,void(E(S.error)&&S.error({name:R},F,W,K));if(D.action==="skip")return void M();typeof D.config=="object"&&(Z.instanceConfig=a.extend(Z.instanceConfig,D.config))}else if(D==="skip")return void M()}var P=Z.instanceConfig.complete;Z.instanceConfig.complete=function($){E(P)&&P($,Z.file,Z.inputElem),M()},u.parse(Z.file,Z.instanceConfig)}}function M(){z.splice(0,1),k()}}),s&&(n.onmessage=function(S){S=S.data,u.WORKER_ID===void 0&&S&&(u.WORKER_ID=S.workerId),typeof S.input=="string"?n.postMessage({workerId:u.WORKER_ID,results:u.parse(S.input,S.config),finished:!0}):(n.File&&S.input instanceof File||S.input instanceof Object)&&(S=u.parse(S.input,S.config))&&n.postMessage({workerId:u.WORKER_ID,results:S,finished:!0})}),(f.prototype=Object.create(d.prototype)).constructor=f,(h.prototype=Object.create(d.prototype)).constructor=h,(p.prototype=Object.create(p.prototype)).constructor=p,(g.prototype=Object.create(d.prototype)).constructor=g,u})}(Jm)),Jm.exports}var bae=xae();const Cl=It(bae),r6=async()=>{try{const e=await ve.get("/api/business-profile");return{city:e.data.city||"",province:e.data.province||"",country:e.data.country||""}}catch(e){return console.error("Error fetching business profile:",e),{city:"",province:"",country:""}}};function Py(e,t){const[r,n]=y.useState(e);return y.useEffect(()=>{const a=setTimeout(()=>{n(e)},t);return()=>{clearTimeout(a)}},[e,t]),r}const pE={customer_id:"",customer_name:"",contact_person:"",email:"",phone_number:"",street_address:"",city:"",province:"",country:"",postal_code:"",default_payment_terms_in_days:30,website:"",general_notes:""},Wd=({open:e,onClose:t,onSave:r,initialCustomer:n,isEditMode:a=!1,loading:o=!1,onUseExisting:s})=>{const[l,c]=y.useState(pE),[u,d]=y.useState(null),[f,h]=y.useState({}),p=Py(l,300),[g,m]=y.useState([]),[x,b]=y.useState(null),[_,w]=y.useState([]),[A,O]=y.useState([]),[T,E]=y.useState([]),[S,I]=y.useState(""),[z,k]=y.useState(""),[M,R]=y.useState(""),[F,W]=y.useState(""),K=async()=>{try{const G=await r6();c(ee=>({...ee,city:G.city,province:G.province,country:G.country}))}catch(G){console.error("Error autofilling from business profile:",G)}};y.useEffect(()=>{if(e){const G={...pE,...n};c(G),d(null),(async()=>{try{const se=await ve.get("/api/customers");m(se.data||[])}catch{}})(),!a&&(!n?.city||n.city==="")&&(!n?.province||n.province==="")&&(!n?.country||n.country==="")&&K();const ee=n?.customer_id;a&&ee?(async()=>{try{const se=await fE(ee);w(se.people||[]),O(se.emails||[]),E(se.phones||[])}catch{}})():(w([]),O([]),E([]))}},[e,n,a]);const Z=G=>{const{name:ee,value:se}=G.target;c(V=>({...V,[ee]:se})),f[ee]&&h(V=>({...V,[ee]:void 0}))},D=()=>l.customer_name.trim()?(d(null),!0):(d("Customer name is required"),!1),P=()=>{D()&&r(l)},$=G=>G.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim().toUpperCase(),Q=(G,ee)=>{const se=Math.floor(Math.max(G.length,ee.length)/2)-1;if(se<0)return 0;const V=new Array(G.length).fill(!1),He=new Array(ee.length).fill(!1);let Ne=0;for(let We=0;We<G.length;We++){const _t=Math.max(0,We-se),Nt=Math.min(We+se+1,ee.length);for(let kt=_t;kt<Nt;kt++)if(!He[kt]&&G[We]===ee[kt]){V[We]=!0,He[kt]=!0,Ne++;break}}if(Ne===0)return 0;const Re=[],Ke=[];for(let We=0;We<G.length;We++)V[We]&&Re.push(G[We]);for(let We=0;We<ee.length;We++)He[We]&&Ke.push(ee[We]);let nt=0;for(let We=0;We<Re.length;We++)Re[We]!==Ke[We]&&nt++;nt=Math.floor(nt/2);const st=(Ne/G.length+Ne/ee.length+(Ne-nt)/Ne)/3;let gt=0;const Ge=4;for(let We=0;We<Math.min(Ge,G.length,ee.length)&&G[We]===ee[We];We++)gt++;return st+gt*.1*(1-st)};y.useEffect(()=>{if(!e)return;const G={};p.email&&p.email.trim().length>0&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p.email.trim())||(G.email="Invalid email format"));let ee=null,se=0;if(p.customer_name&&p.customer_name.trim().length>0){const V=$(p.customer_name),He=(n?.customer_id??p.customer_id)||"";for(const Ne of g){if(String(Ne.customer_id)===String(He||""))continue;const Ke=$(Ne.customer_name||""),st=Ke===V?1:Q(Ke,V);st>se&&(se=st,ee=Ne)}se>=.92&&(G.customer_name="A similar customer already exists")}b(se>=.92&&ee?ee:null),h(V=>({...V,...G}))},[p,e]);const C=n?.customer_id,L=async()=>{if(!(!a||!C))try{const G=await fE(C);w(G.people||[]),O(G.emails||[]),E(G.phones||[])}catch{}},H=async()=>{!C||!S.trim()||(await oae(C,{name:S.trim()}),I(""),L())},U=async G=>{C&&(await sae(C,G,{is_preferred:!0}),L())},te=async G=>{C&&(await lae(C,G),L())},le=async()=>{!C||!z.trim()||(await cae(C,{email:z.trim()}),k(""),L())},oe=async G=>{C&&(await uae(C,G,{is_preferred:!0}),L())},ae=async G=>{C&&(await dae(C,G),L())},he=async()=>{!C||!M.trim()||(await fae(C,{phone:M.trim(),label:F.trim()||void 0}),R(""),W(""),L())},me=async G=>{C&&(await hae(C,G,{is_preferred:!0}),L())},X=async G=>{C&&(await pae(C,G),L())};return i.jsxs(gr,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,children:[i.jsx(vr,{children:a?"Edit Customer":"Add New Customer"}),i.jsxs(yr,{children:[i.jsxs(ie,{container:!0,spacing:2,sx:{mt:1},children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{name:"customer_name",label:"Customer Name",value:l.customer_name,onChange:Z,fullWidth:!0,required:!0,error:!!f.customer_name,helperText:f.customer_name,autoFocus:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{name:"contact_person",label:"Contact Person",value:l.contact_person,onChange:Z,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{name:"email",label:"Email",type:"email",value:l.email,onChange:Z,fullWidth:!0,error:!!f.email,helperText:f.email})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{name:"phone_number",label:"Phone Number",value:l.phone_number,onChange:Z,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{name:"street_address",label:"Street Address",value:l.street_address,onChange:Z,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{name:"city",label:"City",value:l.city,onChange:Z,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{name:"province",label:"Province/State",value:l.province,onChange:Z,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{name:"country",label:"Country",value:l.country,onChange:Z,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{name:"postal_code",label:"Postal Code",value:l.postal_code,onChange:Z,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{name:"default_payment_terms_in_days",label:"Payment Terms (days)",type:"number",value:l.default_payment_terms_in_days??"",onChange:Z,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{name:"website",label:"Website",value:l.website,onChange:Z,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{name:"general_notes",label:"General Notes",value:l.general_notes,onChange:Z,fullWidth:!0,multiline:!0,minRows:4})}),a&&C&&i.jsx(ie,{item:!0,xs:12,children:i.jsxs(J,{sx:{mt:2},children:[i.jsx(B,{variant:"h6",sx:{mb:1},children:"Contacts"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"People"}),i.jsxs(ct,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Ae,{size:"small",label:"Name",value:S,onChange:G=>I(G.target.value),fullWidth:!0}),i.jsx(ye,{variant:"outlined",size:"small",onClick:H,children:"Add"})]}),i.jsxs(ct,{spacing:1,children:[_.map(G=>i.jsxs(ct,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[G.name," ",G.is_preferred?"(Preferred)":""]}),!G.is_preferred&&i.jsx(ye,{size:"small",onClick:()=>U(G.id),children:"Set Preferred"}),i.jsx(ye,{size:"small",color:"error",onClick:()=>te(G.id),children:"Remove"})]},G.id)),_.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No people yet."})]})]}),i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"Emails"}),i.jsxs(ct,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Ae,{size:"small",label:"Email",value:z,onChange:G=>k(G.target.value),fullWidth:!0}),i.jsx(ye,{variant:"outlined",size:"small",onClick:le,children:"Add"})]}),i.jsxs(ct,{spacing:1,children:[A.map(G=>i.jsxs(ct,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[G.email," ",G.is_preferred?"(Preferred)":""]}),!G.is_preferred&&i.jsx(ye,{size:"small",onClick:()=>oe(G.id),children:"Set Preferred"}),i.jsx(ye,{size:"small",color:"error",onClick:()=>ae(G.id),children:"Remove"})]},G.id)),A.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No emails yet."})]})]}),i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"Phones"}),i.jsxs(ct,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Ae,{size:"small",label:"Phone",value:M,onChange:G=>R(G.target.value),fullWidth:!0}),i.jsx(Ae,{size:"small",label:"Label",value:F,onChange:G=>W(G.target.value),sx:{width:120}}),i.jsx(ye,{variant:"outlined",size:"small",onClick:he,children:"Add"})]}),i.jsxs(ct,{spacing:1,children:[T.map(G=>i.jsxs(ct,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[G.phone,G.label?` (${G.label})`:""," ",G.is_preferred?"(Preferred)":""]}),!G.is_preferred&&i.jsx(ye,{size:"small",onClick:()=>me(G.id),children:"Set Preferred"}),i.jsx(ye,{size:"small",color:"error",onClick:()=>X(G.id),children:"Remove"})]},G.id)),T.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No phones yet."})]})]})]})]})})]}),u&&i.jsx("div",{style:{color:"red",marginTop:8},children:u}),x&&i.jsxs("div",{style:{marginTop:12},children:[i.jsxs("div",{style:{color:"#b26a00",marginBottom:8},children:['Looks like "',x.customer_name,'" already exists.']}),typeof s=="function"&&i.jsx(ye,{variant:"outlined",size:"small",onClick:()=>{s(x)},children:"Use existing"})]})]}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:t,children:"Cancel"}),i.jsx(ye,{onClick:P,variant:"contained",disabled:o,children:a?"Save Changes":"Add Customer"})]})]})},_ae=()=>{Nn();const[e,t]=y.useState([]),[r,n]=y.useState(""),[a,o]=y.useState(null),[s,l]=y.useState(null),[c,u]=y.useState(!1),[d,f]=y.useState({pageSize:10,page:0}),[h,p]=y.useState(!1),[g,m]=y.useState(!1),[x,b]=y.useState(0),[_,w]=y.useState(null),[A,O]=y.useState(!1),T=y.useRef(null);y.useEffect(()=>{E()},[]);const E=async()=>{try{const P=await hS();t(P)}catch(P){console.error("Error fetching customers:",P),ge.error("Failed to fetch customers")}},S=async P=>{if(window.confirm("Are you sure you want to delete this customer?"))try{await mae(P),t($=>$.filter(Q=>Q.id!==P)),ge.success("Customer deleted successfully")}catch($){console.error("Error deleting customer:",$),ge.error("Failed to delete customer")}},I=P=>{o(P),l({...P}),p(!0),u(!0)},z=()=>{u(!1),o(null),l(null)},k=async()=>{try{const P=await vae(),$=new Blob([P.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),Q=window.URL.createObjectURL($),C=document.createElement("a");C.href=Q,C.download="customer_import_template.xlsx",document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL(Q)}catch(P){console.error("Error downloading template",P),ge.error("Failed to download template")}},M=()=>{T.current?.click()},R=async P=>{const $=P.target.files?.[0];$&&(await F($),P.target.value="")},F=async P=>{m(!0),b(0),w(null);try{const $=await gae(P,Q=>{if(Q?.total){const C=Math.round(Q.loaded*90/Q.total);b(C)}});b(100),w($),O(!0),Array.isArray($?.createdCustomers)&&$.createdCustomers.length>0?t(Q=>[...Q,...$.createdCustomers]):E(),ge.success("Customer import completed")}catch($){console.error("Error uploading Excel:",$);const Q=$?.response?.data,C=Q?.error||"Failed to import customers";w({error:C,errors:Q?.errors||[],warnings:Q?.warnings||[]}),O(!0),ge.error(C)}finally{m(!1),b(0)}},W=()=>{O(!1),w(null)},K=e.filter(P=>P.customer_name.toLowerCase().includes(r.toLowerCase())||P.email?.toLowerCase().includes(r.toLowerCase())||P.phone_number?.toLowerCase().includes(r.toLowerCase())||`${P.street_address}, ${P.city}, ${P.province}, ${P.country}`.toLowerCase().includes(r.toLowerCase())),Z=[{field:"customer_name",headerName:"Customer Name",flex:1.5},{field:"contact_person",headerName:"Contact Person",flex:1},{field:"email",headerName:"Email",flex:1.5},{field:"phone_number",headerName:"Phone Number",flex:1},{field:"actions",headerName:"Actions",width:80,sortable:!1,renderCell:P=>i.jsx(pr,{size:"small",color:"error",onClick:$=>{$.stopPropagation(),S(P.row.id)},children:i.jsx(ua,{})})}],D=()=>{const P=K.map(L=>({customer_name:L.customer_name,contact_person:L.contact_person,email:L.email,phone_number:L.phone_number})),$=Cl.unparse(P),Q=new Blob([$],{type:"text/csv;charset=utf-8;"}),C=document.createElement("a");if(C.download!==void 0){const L=URL.createObjectURL(Q);C.setAttribute("href",L),C.setAttribute("download","customer_list.csv"),C.style.visibility="hidden",document.body.appendChild(C),C.click(),document.body.removeChild(C)}};return i.jsx(ir,{maxWidth:"xl",children:i.jsxs(J,{sx:{my:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Customer List"}),i.jsxs(ct,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[i.jsx(ye,{variant:"contained",startIcon:i.jsx(Ba,{}),onClick:()=>{l({id:"",customer_id:"",customer_name:"",email:"",phone:"",phone_number:"",address:"",street_address:"",city:"",state:"",province:"",country:"",postal_code:"",contact_person:"",website:"",general_notes:"",created_at:"",updated_at:""}),p(!1),u(!0)},children:"New Customer"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(ZL,{}),onClick:M,children:"Import Excel"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(da,{}),onClick:k,children:"Download Template"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(da,{}),onClick:D,children:"Export CSV"})]}),i.jsx("input",{type:"file",accept:".xlsx,.xls",ref:T,style:{display:"none"},onChange:R}),g&&i.jsxs(xt,{sx:{p:2,mb:2},children:[i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Uploading Excel file..."}),i.jsx(Ed,{variant:"determinate",value:x}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[x,"% complete"]})]}),i.jsx(xt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(J,{sx:{p:2},children:[i.jsx(Ae,{fullWidth:!0,variant:"outlined",placeholder:"Search customers...",value:r,onChange:P=>n(P.target.value),InputProps:{startAdornment:i.jsx(oa,{position:"start",children:i.jsx(hi,{})})},sx:{mb:2}}),i.jsx(Po,{rows:K,columns:Z,pageSizeOptions:[10,25,50],paginationModel:d,onPaginationModelChange:f,getRowId:P=>P.id,loading:!1,disableRowSelectionOnClick:!0,onRowClick:P=>I(P.row),sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),i.jsxs(gr,{open:A,onClose:W,maxWidth:"md",fullWidth:!0,children:[i.jsx(vr,{children:_?.error?"Import Failed":"Import Completed"}),i.jsx(yr,{children:_&&i.jsxs(J,{children:[_.error?i.jsx(Ot,{severity:"error",sx:{mb:2},children:_.error}):i.jsx(Ot,{severity:"success",sx:{mb:2},children:_.message||"Customers imported successfully"}),_.summary&&i.jsx(J,{sx:{mb:3},children:i.jsxs(ie,{container:!0,spacing:1,children:[i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(ot,{label:`Total rows: ${_.summary.totalRows||0}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(ot,{label:`Accepted: ${_.summary.acceptedRows||0}`,color:"info"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(ot,{label:`Created: ${_.summary.created||0}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(ot,{label:`Skipped: ${_.summary.skipped||0}`,color:"warning"})})]})}),_.errors&&_.errors.length>0&&i.jsxs(J,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"error",gutterBottom:!0,children:["Errors (",_.errors.length,")"]}),i.jsx(ga,{dense:!0,children:_.errors.map((P,$)=>i.jsx(Ca,{children:i.jsx(Jn,{primary:P})},$))})]}),_.warnings&&_.warnings.length>0&&i.jsxs(J,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"warning.main",gutterBottom:!0,children:["Warnings (",_.warnings.length,")"]}),i.jsx(ga,{dense:!0,children:_.warnings.map((P,$)=>i.jsx(Ca,{children:i.jsx(Jn,{primary:P})},$))})]})]})}),i.jsx(Cr,{children:i.jsx(ye,{onClick:W,variant:"contained",children:"Close"})})]}),i.jsx(Wd,{open:c,onClose:z,onSave:async P=>{try{if(h&&s)await pS(s.id,P),t($=>$.map(Q=>Q.id===s.id?{...Q,...P}:Q)),ge.success("Customer updated successfully");else{const $=await t6(P);t(Q=>[...Q,$]),ge.success("Customer created successfully")}z()}catch($){console.error("Error saving customer:",$),ge.error(h?"Failed to update customer":"Failed to create customer")}},initialCustomer:s||{},isEditMode:h})]})})},mE=async e=>(await ve.get("/api/invoices",{params:e})).data,wae=async e=>(await ve.get(`/api/invoices/${e}`)).data,jae=async e=>(await ve.post("/api/invoices",e)).data,Sae=async(e,t)=>(await ve.put("/api/invoices/"+e,t)).data,Cae=async e=>(await ve.delete("/api/invoices/"+e)).data,Aae=async(e,t)=>ve.get(`/api/invoices/customers/${e}/statement`,{params:{month:t},responseType:"blob"}),Pae=async e=>ve.get("/api/invoices/statement",{params:e,responseType:"blob"}),Oae=async()=>ve.get("/api/invoices/csv-template",{responseType:"blob"}),kae=async e=>{const t=new FormData;return t.append("file",e),(await ve.post("/api/invoices/upload-csv",t,{headers:{"Content-Type":"multipart/form-data"}})).data},Tae=async e=>{const t=new FormData;return t.append("file",e),(await ve.post("/api/invoices/upload-unit-numbers",t,{headers:{"Content-Type":"multipart/form-data"}})).data},Eae=()=>{const{id:e}=Ms(),t=Nn(),r=e==="new";console.log("Debug - URL id parameter:",e),console.log("Debug - isNewCustomer calculated:",r);const[n,a]=y.useState(!1),[o,s]=y.useState(!1),[l,c]=y.useState(null),[u,d]=y.useState(!1),[f,h]=y.useState(()=>Rt().format("YYYY-MM")),[p,g]=y.useState({customer_name:"",email:"",phone_number:"",street_address:"",city:"",province:"",country:"",postal_code:"",contact_person:"",website:"",general_notes:"",default_payment_terms_in_days:30});y.useEffect(()=>{!r&&e?m():r&&d(!0)},[e,r]);const m=async()=>{a(!0);try{if(!e)throw new Error("Customer ID is required");const _=await e6(e);g(_)}catch(_){console.error("Error fetching customer:",_),c("Failed to load customer data"),ge.error("Failed to load customer data")}finally{a(!1)}},x=async()=>{if(e)try{const _=await Aae(Number(e),f),w=new Blob([_.data],{type:"application/pdf"}),A=window.URL.createObjectURL(w),O=document.createElement("a");O.href=A,O.download=`statement-${p.customer_name||"customer"}-${f||"current"}.pdf`,O.click(),window.URL.revokeObjectURL(A)}catch(_){console.error("Error downloading statement:",_),ge.error("Failed to download statement")}},b=()=>{t("/customers")};return n?i.jsx(ir,{maxWidth:"md",children:i.jsx(J,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:i.jsx(nr,{})})}):i.jsx(ir,{maxWidth:"md",children:i.jsxs(J,{sx:{my:4},children:[i.jsxs(J,{sx:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:2,mb:3},children:[i.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(ye,{startIcon:i.jsx(TI,{}),onClick:b,sx:{mr:0},children:"Back to Customers"}),i.jsx(B,{variant:"h4",component:"h1",children:r?"Add New Customer":"Edit Customer"})]}),!r&&i.jsxs(ct,{direction:"row",spacing:1,alignItems:"center",sx:{marginLeft:{xs:0,sm:"auto"}},children:[i.jsx(Ae,{label:"Statement Month",type:"month",size:"small",value:f,onChange:_=>h(_.target.value),InputLabelProps:{shrink:!0}}),i.jsx(ye,{variant:"outlined",onClick:x,children:"Download Monthly Statement"})]})]}),l&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:l}),i.jsx(Wd,{open:u,onClose:()=>{d(!1),b()},onSave:async _=>{s(!0);try{r?(await t6(_),ge.success("Customer created successfully")):(await pS(e,_),ge.success("Customer updated successfully")),t("/customers")}catch{ge.error("Failed to save customer")}finally{s(!1)}},initialCustomer:r?{}:p,isEditMode:!r,loading:o})]})})},Iae=async()=>(await ve.get("/api/vendors")).data,gE=async e=>(await ve.get(`/api/vendors/${e}/contacts`)).data,Nae=async(e,t)=>(await ve.post(`/api/vendors/${e}/contacts/people`,t)).data,Dae=async(e,t,r)=>(await ve.put(`/api/vendors/${e}/contacts/people/${t}`,r)).data,Mae=async(e,t)=>(await ve.delete(`/api/vendors/${e}/contacts/people/${t}`)).data,Lae=async(e,t)=>(await ve.post(`/api/vendors/${e}/contacts/emails`,t)).data,Rae=async(e,t,r)=>(await ve.put(`/api/vendors/${e}/contacts/emails/${t}`,r)).data,qae=async(e,t)=>(await ve.delete(`/api/vendors/${e}/contacts/emails/${t}`)).data,Fae=async(e,t)=>(await ve.post(`/api/vendors/${e}/contacts/phones`,t)).data,$ae=async(e,t,r)=>(await ve.put(`/api/vendors/${e}/contacts/phones/${t}`,r)).data,Bae=async(e,t)=>(await ve.delete(`/api/vendors/${e}/contacts/phones/${t}`)).data,Uae=async(e,t)=>{const r=new FormData;return r.append("file",e),(await ve.post("/api/vendors/import-excel",r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:t})).data},zae=()=>ve.get("/api/vendors/import-excel/template",{responseType:"blob"}),vE={vendor_name:"",street_address:"",city:"",province:"",country:"",postal_code:"",contact_person:"",telephone_number:"",email:"",website:""},n6=({open:e,onClose:t,onSave:r,initialVendor:n,isEditMode:a=!1,loading:o=!1})=>{const[s,l]=y.useState(vE),[c,u]=y.useState({}),d=Py(s,300),[f,h]=y.useState([]),[p,g]=y.useState([]),[m,x]=y.useState([]),[b,_]=y.useState([]),[w,A]=y.useState(""),[O,T]=y.useState(""),[E,S]=y.useState(""),[I,z]=y.useState("");y.useEffect(()=>{if(e){console.log("UnifiedVendorDialog: Setting vendor with initialVendor:",n);const U={...vE,...n};l(U),!a&&!n?.city&&!n?.province&&!n?.country&&R(),(async()=>{try{const le=await ve.get("/api/vendors");h(le.data||[])}catch{}})();const te=n?.vendor_id;a&&te?(async()=>{try{const le=await gE(te);g(le.people||[]),x(le.emails||[]),_(le.phones||[])}catch{}})():(g([]),x([]),_([]))}},[e,n,a]);const k=U=>{const{name:te,value:le}=U.target;l(oe=>({...oe,[te]:le})),c[te]&&u(oe=>({...oe,[te]:void 0}))},M=()=>{r(s)};y.useEffect(()=>{if(!e)return;const U={};if(d.email&&d.email.trim().length>0&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email.trim())||(U.email="Invalid email format")),d.vendor_name&&d.vendor_name.trim().length>0){const te=d.vendor_name.trim().toLowerCase();f.some(oe=>(oe.vendor_name||"").trim().toLowerCase()===te)&&!a&&(U.vendor_name="Vendor name already exists")}u(te=>({...te,...U}))},[d,e,a,f]);const R=async()=>{try{const U=await r6();l(te=>({...te,city:U.city,province:U.province,country:U.country})),console.log("Autofilled vendor form with business profile data:",U)}catch(U){console.error("Error autofilling from business profile:",U)}},F=n?.vendor_id,W=async()=>{if(!(!a||!F))try{const U=await gE(F);g(U.people||[]),x(U.emails||[]),_(U.phones||[])}catch{}},K=async()=>{!F||!w.trim()||(await Nae(F,{name:w.trim()}),A(""),W())},Z=async U=>{F&&(await Dae(F,U,{is_preferred:!0}),W())},D=async U=>{F&&(await Mae(F,U),W())},P=async()=>{!F||!O.trim()||(await Lae(F,{email:O.trim()}),T(""),W())},$=async U=>{F&&(await Rae(F,U,{is_preferred:!0}),W())},Q=async U=>{F&&(await qae(F,U),W())},C=async()=>{!F||!E.trim()||(await Fae(F,{phone:E.trim(),label:I.trim()||void 0}),S(""),z(""),W())},L=async U=>{F&&(await $ae(F,U,{is_preferred:!0}),W())},H=async U=>{F&&(await Bae(F,U),W())};return i.jsxs(gr,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,sx:{zIndex:U=>U.zIndex.modal+5},children:[i.jsx(vr,{children:a?"Edit Vendor":"Add New Vendor"}),i.jsx(yr,{sx:{form:{autoComplete:"off"}},children:i.jsxs(ie,{container:!0,spacing:2,sx:{mt:1},children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{name:"vendor_name",label:"Vendor Name",value:s.vendor_name,onChange:k,fullWidth:!0,required:!0,error:!!c.vendor_name,helperText:c.vendor_name,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{name:"contact_person",label:"Contact Person",value:s.contact_person,onChange:k,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{name:"email",label:"Email",type:"email",value:s.email,onChange:k,fullWidth:!0,error:!!c.email,helperText:c.email,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{name:"telephone_number",label:"Telephone",value:s.telephone_number,onChange:k,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{name:"street_address",label:"Street Address",value:s.street_address,onChange:k,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{name:"city",label:"City",value:s.city,onChange:k,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{name:"province",label:"Province/State",value:s.province,onChange:k,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{name:"country",label:"Country",value:s.country,onChange:k,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{name:"postal_code",label:"Postal Code",value:s.postal_code,onChange:k,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{name:"website",label:"Website",value:s.website,onChange:k,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),a&&F&&i.jsx(ie,{item:!0,xs:12,children:i.jsxs(J,{sx:{mt:2},children:[i.jsx(B,{variant:"h6",sx:{mb:1},children:"Contacts"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"People"}),i.jsxs(ct,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Ae,{size:"small",label:"Name",value:w,onChange:U=>A(U.target.value),fullWidth:!0}),i.jsx(ye,{variant:"outlined",size:"small",onClick:K,children:"Add"})]}),i.jsxs(ct,{spacing:1,children:[p.map(U=>i.jsxs(ct,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[U.name," ",U.is_preferred?"(Preferred)":""]}),!U.is_preferred&&i.jsx(ye,{size:"small",onClick:()=>Z(U.id),children:"Set Preferred"}),i.jsx(ye,{size:"small",color:"error",onClick:()=>D(U.id),children:"Remove"})]},U.id)),p.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No people yet."})]})]}),i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"Emails"}),i.jsxs(ct,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Ae,{size:"small",label:"Email",value:O,onChange:U=>T(U.target.value),fullWidth:!0}),i.jsx(ye,{variant:"outlined",size:"small",onClick:P,children:"Add"})]}),i.jsxs(ct,{spacing:1,children:[m.map(U=>i.jsxs(ct,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[U.email," ",U.is_preferred?"(Preferred)":""]}),!U.is_preferred&&i.jsx(ye,{size:"small",onClick:()=>$(U.id),children:"Set Preferred"}),i.jsx(ye,{size:"small",color:"error",onClick:()=>Q(U.id),children:"Remove"})]},U.id)),m.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No emails yet."})]})]}),i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"Phones"}),i.jsxs(ct,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Ae,{size:"small",label:"Phone",value:E,onChange:U=>S(U.target.value),fullWidth:!0}),i.jsx(Ae,{size:"small",label:"Label",value:I,onChange:U=>z(U.target.value),sx:{width:120}}),i.jsx(ye,{variant:"outlined",size:"small",onClick:C,children:"Add"})]}),i.jsxs(ct,{spacing:1,children:[b.map(U=>i.jsxs(ct,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[U.phone,U.label?` (${U.label})`:""," ",U.is_preferred?"(Preferred)":""]}),!U.is_preferred&&i.jsx(ye,{size:"small",onClick:()=>L(U.id),children:"Set Preferred"}),i.jsx(ye,{size:"small",color:"error",onClick:()=>H(U.id),children:"Remove"})]},U.id)),b.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No phones yet."})]})]})]})]})})]})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:t,children:"Cancel"}),i.jsx(ye,{onClick:M,variant:"contained",disabled:o,children:a?"Save Changes":"Add Vendor"})]})]})},Wae=()=>{const[e,t]=y.useState(""),[r,n]=y.useState([]),[a,o]=y.useState(!1),[s,l]=y.useState({page:0,pageSize:10}),[c,u]=y.useState(!1),[d,f]=y.useState(!1),[h,p]=y.useState({}),[g,m]=y.useState(!1),[x,b]=y.useState(0),[_,w]=y.useState(null),[A,O]=y.useState(!1),T=y.useRef(null),E=r.filter(P=>(P.vendor_name||"").toLowerCase().includes(e.toLowerCase())||(P.contact_person||"").toLowerCase().includes(e.toLowerCase())||(P.email||"").toLowerCase().includes(e.toLowerCase())),S=[{field:"vendor_name",headerName:"Vendor Name",flex:1.5},{field:"contact_person",headerName:"Contact Person",flex:1},{field:"email",headerName:"Email",flex:1.5},{field:"telephone_number",headerName:"Phone Number",flex:1},{field:"actions",headerName:"Actions",width:100,sortable:!1,renderCell:P=>i.jsx(pr,{size:"small",color:"error",onClick:$=>{$.stopPropagation(),Z(P.row.vendor_id)},children:i.jsx(ua,{})})}],I=async()=>{o(!0);try{const $=(await Iae()).map(Q=>({...Q,id:Q.vendor_id}));n($)}catch{ge.error("Failed to fetch vendors.")}finally{o(!1)}};y.useEffect(()=>{I()},[]);const z=(P=null)=>{P?(f(!0),p(P)):(f(!1),p({vendor_name:"",street_address:"",city:"",province:"",country:"",contact_person:"",telephone_number:"",email:"",website:"",postal_code:""})),u(!0)},k=()=>{u(!1),p({})},M=()=>{T.current?.click()},R=async P=>{const $=P.target.files?.[0];$&&(await F($),P.target.value="")},F=async P=>{m(!0),b(0),w(null);try{const $=await Uae(P,Q=>{if(Q?.total){const C=Math.round(Q.loaded*90/Q.total);b(C)}});if(b(100),w($),O(!0),Array.isArray($?.createdVendors)&&$.createdVendors.length>0){const Q=$.createdVendors.map(C=>({...C,id:C.vendor_id??C.id}));n(C=>[...C,...Q])}else I();ge.success("Vendor import completed")}catch($){console.error("Error uploading Excel:",$);const Q=$?.response?.data,C=Q?.error||"Failed to import vendors";w({error:C,errors:Q?.errors||[],warnings:Q?.warnings||[]}),O(!0),ge.error(C)}finally{m(!1),b(0)}},W=async()=>{try{const P=await zae(),$=new Blob([P.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),Q=window.URL.createObjectURL($),C=document.createElement("a");C.href=Q,C.download="vendor_import_template.xlsx",document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL(Q)}catch(P){console.error("Error downloading vendor template",P),ge.error("Failed to download vendor template")}},K=()=>{O(!1),w(null)},Z=async P=>{if(window.confirm("Are you sure you want to delete this vendor?"))try{await ve.delete(`/api/vendors/${P}`),ge.success("Vendor deleted successfully!"),I()}catch($){$ instanceof fi?ge.error($.response?.data?.error||"Failed to delete vendor."):ge.error("An unexpected error occurred while deleting the vendor.")}},D=()=>{const P=Cl.unparse(E),$=new Blob([P],{type:"text/csv;charset=utf-8;"}),Q=document.createElement("a");if(Q.download!==void 0){const C=URL.createObjectURL($);Q.setAttribute("href",C),Q.setAttribute("download","vendor_list.csv"),Q.style.visibility="hidden",document.body.appendChild(Q),Q.click(),document.body.removeChild(Q)}};return i.jsxs(ir,{maxWidth:"xl",children:[i.jsxs(J,{sx:{my:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Vendor Management"}),i.jsxs(ct,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[i.jsx(ye,{variant:"contained",startIcon:i.jsx(Ba,{}),onClick:()=>z(),children:"New Vendor"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(ZL,{}),onClick:M,children:"Import Excel"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(da,{}),onClick:W,children:"Download Template"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(da,{}),onClick:D,children:"Export CSV"})]}),i.jsx("input",{type:"file",accept:".xlsx,.xls",ref:T,style:{display:"none"},onChange:R}),g&&i.jsxs(xt,{sx:{p:2,mb:2},children:[i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Uploading Excel file..."}),i.jsx(Ed,{variant:"determinate",value:x}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[x,"% complete"]})]}),i.jsx(xt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(J,{sx:{p:2,width:"100%"},children:[i.jsx(Ae,{fullWidth:!0,variant:"outlined",placeholder:"Search vendors...",value:e,onChange:P=>t(P.target.value),InputProps:{startAdornment:i.jsx(oa,{position:"start",children:i.jsx(hi,{})})},sx:{mb:2}}),i.jsx(Po,{rows:E,columns:S,loading:a,paginationModel:s,onPaginationModelChange:l,pageSizeOptions:[10,25,50],getRowId:P=>P.vendor_id,onRowClick:P=>z(P.row),disableRowSelectionOnClick:!0,sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),i.jsxs(gr,{open:A,onClose:K,maxWidth:"md",fullWidth:!0,children:[i.jsx(vr,{children:_?.error?"Import Failed":"Import Completed"}),i.jsx(yr,{children:_&&i.jsxs(J,{children:[_.error?i.jsx(Ot,{severity:"error",sx:{mb:2},children:_.error}):i.jsx(Ot,{severity:"success",sx:{mb:2},children:_.message||"Vendors imported successfully"}),_.summary&&i.jsx(J,{sx:{mb:3},children:i.jsxs(ie,{container:!0,spacing:1,children:[i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(ot,{label:`Total rows: ${_.summary.totalRows||0}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(ot,{label:`Accepted: ${_.summary.acceptedRows||0}`,color:"info"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(ot,{label:`Created: ${_.summary.created||0}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(ot,{label:`Skipped: ${_.summary.skipped||0}`,color:"warning"})})]})}),_.errors&&_.errors.length>0&&i.jsxs(J,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"error",gutterBottom:!0,children:["Errors (",_.errors.length,")"]}),i.jsx(ga,{dense:!0,children:_.errors.map((P,$)=>i.jsx(Ca,{children:i.jsx(Jn,{primary:P})},$))})]}),_.warnings&&_.warnings.length>0&&i.jsxs(J,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"warning.main",gutterBottom:!0,children:["Warnings (",_.warnings.length,")"]}),i.jsx(ga,{dense:!0,children:_.warnings.map((P,$)=>i.jsx(Ca,{children:i.jsx(Jn,{primary:P})},$))})]})]})}),i.jsx(Cr,{children:i.jsx(ye,{onClick:K,variant:"contained",children:"Close"})})]})]}),i.jsx(n6,{open:c,onClose:k,onSave:async P=>{try{d?(await ve.put(`/api/vendors/${h.vendor_id}`,P),ge.success("Vendor updated successfully!")):(await ve.post("/api/vendors",P),ge.success("Vendor added successfully!")),k(),I()}catch($){$ instanceof fi?ge.error($.response?.data?.error||`Failed to ${d?"update":"add"} vendor.`):ge.error(`An unexpected error occurred while ${d?"updating":"adding"} the vendor.`)}},initialVendor:h,isEditMode:d})]})},Hae=()=>{const{id:e}=Ms();return i.jsx(ir,{maxWidth:"md",children:i.jsxs(J,{sx:{my:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Vendor Detail Page"}),i.jsxs(xt,{sx:{p:3},children:[i.jsxs(B,{variant:"h6",children:["Vendor ID: ",e]}),i.jsx(B,{variant:"body1",children:"This is a placeholder for the Vendor Detail Page."})]})]})})},Vae=()=>{const{id:e}=Ms();return i.jsx(ir,{maxWidth:"md",children:i.jsxs(J,{sx:{my:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Product Detail Page"}),i.jsxs(xt,{sx:{p:3},children:[i.jsxs(B,{variant:"h6",children:["Product ID: ",e]}),i.jsx(B,{variant:"body1",children:"This is a placeholder for the Product Detail Page."})]})]})})};var If={},yE;function Gae(){if(yE)return If;yE=1;var e=cr();Object.defineProperty(If,"__esModule",{value:!0}),If.default=void 0;var t=e(dr()),r=ur();return If.default=(0,t.default)((0,r.jsx)("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"}),"Upload"),If}var Yae=Gae();const Cd=It(Yae),Oy=async e=>{const t=e?{partType:e}:{};return(await ve.get("/api/inventory",{params:t})).data},Kae=async()=>Oy("stock"),Qae=async()=>Oy("supply"),Xae=async()=>Oy("service"),a6=async e=>(await ve.get(`/api/inventory/${encodeURIComponent(e)}`)).data,i6=async e=>(await ve.post("/api/inventory/cleanup-enforce",{partType:e,apply:!1})).data,mS=async(e,t)=>(await ve.post("/api/inventory/cleanup-enforce",{partType:e,apply:!0,merges:t})).data,Zm=async e=>(await ve.get(`/api/inventory/${encodeURIComponent(e)}/vendors`)).data,Im=async e=>(await ve.get(`/api/inventory/part/${e}/vendors`)).data,Jae=async(e,t)=>(await ve.post(`/api/inventory/${encodeURIComponent(e)}/vendors`,t)).data,Zae=async(e,t)=>(await ve.post(`/api/inventory/part/${e}/vendors`,t)).data,eie=async(e,t,r)=>(await ve.put(`/api/inventory/${encodeURIComponent(e)}/vendors/${t}`,r)).data,tie=async(e,t,r)=>(await ve.put(`/api/inventory/part/${e}/vendors/${t}`,r)).data,rie=async(e,t)=>(await ve.delete(`/api/inventory/${encodeURIComponent(e)}/vendors/${t}`)).data,nie=async(e,t)=>(await ve.delete(`/api/inventory/part/${e}/vendors/${t}`)).data,aie=async()=>(await ve.get("/api/categories")).data,iie=async e=>(await ve.post("/api/categories",e)).data.category,xE=async(e,t)=>{const r=t?{reassign:"true"}:{};await ve.delete(`/api/categories/${e}`,{params:r})},h2="__ADD_NEW_CATEGORY__",oie=({value:e,onChange:t,label:r="Category",error:n,errorMessage:a,fullWidth:o=!0,disabled:s})=>{const[l,c]=y.useState([]),[u,d]=y.useState(!1),[f,h]=y.useState(!1),[p,g]=y.useState(""),[m,x]=y.useState(""),[b,_]=y.useState(!1),{user:w}=ea();y.useEffect(()=>{let S=!0;return(async()=>{d(!0);try{const z=await aie();S&&c(z)}catch(z){console.error("CategorySelect: failed to load categories",z),ge.error("Failed to load categories")}finally{S&&d(!1)}})(),()=>{S=!1}},[]);const A=y.useMemo(()=>{const S=l.map(I=>I.category_name);return S.some(I=>I.toLowerCase()==="uncategorized")||S.unshift("Uncategorized"),S.sort((I,z)=>I.localeCompare(z))},[l]),O=S=>{const I=S.target.value;if(I===h2){h(!0);return}t(I)},T=async(S,I)=>{if(I?.preventDefault(),I?.stopPropagation(),S.category_name.toLowerCase()==="uncategorized"){ge.warn('Cannot delete the default "Uncategorized" category');return}if(w?.access_role!=="Admin"){ge.error("Only Admin users can delete categories");return}if(window.confirm(`Delete category "${S.category_name}"? This cannot be undone.`))try{await xE(S.category_id),c(k=>k.filter(M=>M.category_id!==S.category_id)),e&&e.toLowerCase()===S.category_name.toLowerCase()&&t("Uncategorized"),ge.success("Category deleted")}catch(k){const M=k?.response?.data;if(M?.error==="Cannot delete category"&&M?.suggestion){if(window.confirm(`${M.details}

${M.suggestion}

Would you like to reassign all items to "Uncategorized" and delete the category?`))try{await xE(S.category_id,!0),c(F=>F.filter(W=>W.category_id!==S.category_id)),e&&e.toLowerCase()===S.category_name.toLowerCase()&&t("Uncategorized"),ge.success(M.details?`Category deleted. ${M.details}`:"Category deleted")}catch(F){const W=F?.response?.data?.error||"Failed to delete category";ge.error(W)}}else{const R=M?.error||"Failed to delete category";ge.error(R)}}},E=async()=>{const S=p.trim();if(!S){ge.warn("Please enter a category name");return}if(A.some(I=>I.toLowerCase()===S.toLowerCase())){ge.warn("Category already exists");return}_(!0);try{const I=m.trim(),z=await iie({category_name:S,description:I||void 0});c(k=>[...k,z]),h(!1),g(""),x(""),t(z.category_name),ge.success("Category added")}catch(I){console.error("CategorySelect: failed to create category",I),ge.error("Failed to add category")}finally{_(!1)}};return i.jsxs(i.Fragment,{children:[i.jsxs(Ae,{label:r,value:e,onChange:O,select:!0,fullWidth:o,required:!0,error:!!n,helperText:a,disabled:s||u,children:[l.slice().sort((S,I)=>S.category_name.localeCompare(I.category_name)).map(S=>i.jsxs(tr,{value:S.category_name,sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("span",{children:S.category_name}),w?.access_role==="Admin"&&S.category_name.toLowerCase()!=="uncategorized"&&i.jsx(pr,{"aria-label":`Delete ${S.category_name}`,size:"small",edge:"end",onClick:I=>T(S,I),sx:{ml:2,color:"error.main"},children:i.jsx(ua,{fontSize:"small"})})]},S.category_id)),i.jsx(tr,{value:h2,children:"+ Add new category"},h2)]}),i.jsxs(gr,{open:f,onClose:()=>h(!1),maxWidth:"xs",fullWidth:!0,children:[i.jsx(vr,{children:"Add New Category"}),i.jsx(yr,{children:i.jsxs(ct,{spacing:2,sx:{mt:1},children:[i.jsx(Ae,{label:"Category Name",value:p,onChange:S=>g(S.target.value),autoFocus:!0,fullWidth:!0}),i.jsx(Ae,{label:"Description (optional)",value:m,onChange:S=>x(S.target.value),fullWidth:!0,multiline:!0,minRows:2})]})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:()=>h(!1),disabled:b,children:"Cancel"}),i.jsx(ye,{onClick:E,variant:"contained",disabled:b,children:"Save"})]})]})]})},p2=["Each","cm","ft","ft^2","kg","pcs","L"],sie=["stock","supply","service"],tc=({open:e,onClose:t,onSave:r,initialPart:n,isEditMode:a=!1,title:o})=>{const{user:s}=ea(),[l,c]=y.useState({part_number:"",part_description:"",unit:p2[0],last_unit_cost:"",quantity_on_hand:"",reorder_point:"",part_type:"stock",category:"Uncategorized",...n||{}}),[u,d]=y.useState({}),[f,h]=y.useState(!1),p=y.useRef(null),[g,m]=y.useState(null),x=y.useRef(null);y.useEffect(()=>{e&&(c({part_id:n?.part_id,part_number:n?.part_number||"",part_description:n?.part_description||"",unit:n?.unit||p2[0],last_unit_cost:n?.last_unit_cost||"",quantity_on_hand:n?.quantity_on_hand||"",reorder_point:n?.reorder_point||"",part_type:n?.part_type||"stock",category:n?.category||"Uncategorized"}),d({}),h(!1),m(null))},[e,n?.part_id,n?.part_number]),y.useEffect(()=>{e&&p.current&&setTimeout(()=>p.current?.focus(),100)},[e]);const b=(C,L)=>{C==="part_number"&&(L=L.toUpperCase()),c(C==="part_type"&&(L==="supply"||L==="service")?H=>({...H,[C]:L,quantity_on_hand:"NA"}):H=>({...H,[C]:L})),u[C]&&d(H=>({...H,[C]:void 0}))};y.useEffect(()=>{if(!e)return;const C=(l.part_number||"").trim();if(x.current&&window.clearTimeout(x.current),!C){m(null);return}return x.current=window.setTimeout(async()=>{try{const L=await a6(C),H=L?.item||L,U=String(H?.part_number||"").toUpperCase(),te=String(n?.part_number||"").toUpperCase(),le=H?.part_id,oe=te&&te===U;U&&U===C.toUpperCase()&&!oe&&(!l.part_id||l.part_id!==le)?m(`Part number ${U} already exists. Saving will update that part.`):m(null)}catch{m(null)}},400),()=>{x.current&&window.clearTimeout(x.current)}},[l.part_number,l.part_id,e,n?.part_number]);const _=()=>{const C={};if(l.part_number.trim()||(C.part_number="Part Number is required"),l.part_description.trim()||(C.part_description="Part Description is required"),l.unit||(C.unit="Unit is required"),l.part_type||(C.part_type="Part Type is required"),["stock","supply","service"].includes(l.part_type)||(C.part_type='Part Type must be either "stock", "supply", or "service"'),(!l.category||l.category.trim()==="")&&(C.category="Category is required"),!(l.part_type==="supply"||l.part_type==="service")){const U=parseFloat(String(l.quantity_on_hand));l.quantity_on_hand!==""&&(isNaN(U)||U<0)&&(C.quantity_on_hand="Quantity on Hand must be a valid number >= 0")}const L=parseFloat(String(l.last_unit_cost));l.last_unit_cost!==""&&isNaN(L)&&(C.last_unit_cost="Last Unit Cost must be a valid number");const H=parseFloat(String(l.reorder_point));return l.reorder_point!==""&&isNaN(H)&&(C.reorder_point="Reorder Point must be a valid number"),d(C),Object.keys(C).length===0},w=async()=>{if(!_()){ge.error("Please correct the errors before saving.");return}h(!0);try{const C={...l,part_number:l.part_number.trim().toUpperCase(),part_description:l.part_description.trim(),unit:l.unit.trim(),last_unit_cost:l.last_unit_cost===""?null:parseFloat(String(l.last_unit_cost)),quantity_on_hand:l.part_type==="supply"||l.part_type==="service"?"NA":l.quantity_on_hand===""?0:parseFloat(String(l.quantity_on_hand)),reorder_point:l.reorder_point===""?null:parseFloat(String(l.reorder_point)),part_type:l.part_type.trim(),category:l.category.trim()},L=await r(C);L?.warning&&ge.warning(L.warning),ge.success(`Part ${a?"updated":"added"} successfully!`),t()}catch(C){console.error("Error saving part:",C);let L=`Failed to ${a?"update":"add"} part.`;C.response?.data?.error?L=C.response.data.error:C.response?.data?.message&&(L=C.response.data.message),C.response?.status===409||L.includes("Part number already exists")||L.includes("duplicate key value")||L.includes("already exists")?(d(H=>({...H,part_number:"Part number already exists. Please use a unique part number."})),ge.error("Part number already exists. Please use a unique part number.")):ge.error(L)}finally{h(!1)}},A=()=>{f||t()},O=o||(a?"Edit Part":"Add New Part"),[T,E]=y.useState([]),[S,I]=y.useState([]),[z,k]=y.useState(""),[M,R]=y.useState(""),[F,W]=y.useState(""),[K,Z]=y.useState(!1),D=!!l.part_id;y.useEffect(()=>{e&&(async()=>{try{const C=await ve.get("/api/vendors");I(C.data||[])}catch{}})()},[e]),y.useEffect(()=>{if(!e)return;const C=l.part_id;if(!C){E([]);return}(async()=>{try{const L=await Im(C);E(L||[])}catch{E([])}})()},[e,l.part_id]);const P=async()=>{const C=String(l.part_number||"").trim().toUpperCase();if(C){if(!z||!M.trim()){ge.error("Select a vendor and enter vendor part number");return}try{const L={vendor_id:Number(z),vendor_part_number:M.trim().toUpperCase(),vendor_part_description:F||void 0,preferred:K};if(l.part_id){await Zae(l.part_id,L);const H=await Im(l.part_id);E(H||[])}else{await Jae(C,L);const H=await Zm(C);E(H||[])}k(""),R(""),W(""),Z(!1),ge.success("Vendor mapping added")}catch(L){ge.error(L?.response?.data?.error||"Failed to add vendor mapping")}}},$=async C=>{try{if(l.part_id){await tie(l.part_id,C.id,{preferred:!C.preferred});const L=await Im(l.part_id);E(L||[])}else{await eie(l.part_number.toUpperCase(),C.id,{preferred:!C.preferred});const L=await Zm(l.part_number.toUpperCase());E(L||[])}}catch{ge.error("Failed to update preferred")}},Q=async C=>{if(window.confirm("Remove this vendor mapping?"))try{if(l.part_id){await nie(l.part_id,C.id);const L=await Im(l.part_id);E(L||[])}else{await rie(l.part_number.toUpperCase(),C.id);const L=await Zm(l.part_number.toUpperCase());E(L||[])}}catch{ge.error("Failed to delete mapping")}};return i.jsxs(gr,{open:e,onClose:A,maxWidth:"md",fullWidth:!0,children:[i.jsx(vr,{children:O}),i.jsx(yr,{children:i.jsxs(ct,{spacing:3,sx:{mt:1},children:[i.jsxs(ie,{container:!0,spacing:2,children:[i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(Ae,{label:"Part Number",value:l.part_number,onChange:C=>b("part_number",C.target.value),fullWidth:!0,required:!0,error:!!u.part_number,helperText:u.part_number,inputRef:p}),!u.part_number&&g&&i.jsx(Ot,{severity:"warning",sx:{mt:1},children:g})]}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"Part Type",value:l.part_type,onChange:C=>b("part_type",C.target.value),select:!0,fullWidth:!0,required:!0,error:!!u.part_type,helperText:u.part_type,children:sie.map(C=>i.jsx(tr,{value:C,children:C.charAt(0).toUpperCase()+C.slice(1)},C))})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(oie,{label:"Category",value:l.category,onChange:C=>b("category",C),error:!!u.category,errorMessage:u.category})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{label:"Part Description",value:l.part_description,onChange:C=>b("part_description",C.target.value),fullWidth:!0,required:!0,error:!!u.part_description,helperText:u.part_description,multiline:!0,rows:2})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{label:"Unit",value:l.unit,onChange:C=>b("unit",C.target.value),select:!0,fullWidth:!0,required:!0,error:!!u.unit,helperText:u.unit,children:p2.map(C=>i.jsx(tr,{value:C,children:C},C))})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{label:"Last Unit Cost",value:l.last_unit_cost,onChange:C=>b("last_unit_cost",C.target.value),type:"number",fullWidth:!0,error:!!u.last_unit_cost,helperText:u.last_unit_cost,inputProps:{step:"0.01",min:"0"}})}),l.part_type==="stock"&&i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{label:"Quantity on Hand",value:l.quantity_on_hand,onChange:C=>b("quantity_on_hand",C.target.value),type:"number",fullWidth:!0,error:!!u.quantity_on_hand,helperText:u.quantity_on_hand,inputProps:{step:"1",min:"0"},disabled:s?.access_role==="Sales and Purchase"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"Reorder Point",value:l.reorder_point,onChange:C=>b("reorder_point",C.target.value),type:"number",fullWidth:!0,error:!!u.reorder_point,helperText:u.reorder_point,inputProps:{step:"1",min:"0"}})})]}),Object.keys(u).length>0&&i.jsx(Ot,{severity:"error",children:i.jsx(B,{variant:"body2",children:"Please correct the errors above before saving."})}),i.jsxs(J,{children:[i.jsx(B,{variant:"h6",sx:{mb:1},children:"Vendors"}),!D&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"Save the part first to manage vendor mappings."}),D&&i.jsxs(i.Fragment,{children:[i.jsxs(ie,{container:!0,spacing:1,sx:{mb:1},children:[i.jsx(ie,{item:!0,xs:12,sm:3,children:i.jsxs(Ae,{label:"Vendor",select:!0,value:z,onChange:C=>k(C.target.value===""?"":Number(C.target.value)),fullWidth:!0,SelectProps:{native:!0},children:[i.jsx("option",{value:""}),S.map(C=>i.jsx("option",{value:C.vendor_id,children:C.vendor_name},C.vendor_id))]})}),i.jsx(ie,{item:!0,xs:12,sm:3,children:i.jsx(Ae,{label:"Vendor Part #",value:M,onChange:C=>R(C.target.value),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{label:"Vendor Part Description",value:F,onChange:C=>W(C.target.value),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:2,children:i.jsx(ye,{variant:"outlined",onClick:()=>Z(C=>!C),fullWidth:!0,children:K?"Preferred ":"Preferred"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(ye,{variant:"contained",onClick:P,children:"Add Vendor Mapping"})})]}),T.length===0?i.jsx(B,{variant:"body2",color:"text.secondary",children:"No vendor mappings yet."}):i.jsxs(ie,{container:!0,spacing:1,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsxs(ie,{container:!0,spacing:1,sx:{fontWeight:600,mb:1},children:[i.jsx(ie,{item:!0,xs:12,sm:2.5,children:"Vendor"}),i.jsx(ie,{item:!0,xs:12,sm:2.5,children:"Vendor Part #"}),i.jsx(ie,{item:!0,xs:12,sm:3,children:"Description"}),i.jsx(ie,{item:!0,xs:12,sm:1,children:"Pref"}),i.jsx(ie,{item:!0,xs:12,sm:3,children:"Actions"})]})}),T.map(C=>i.jsx(ie,{item:!0,xs:12,children:i.jsxs(ie,{container:!0,spacing:1,alignItems:"center",sx:{py:1,borderBottom:"1px solid #e0e0e0"},children:[i.jsx(ie,{item:!0,xs:12,sm:2.5,children:i.jsx(B,{variant:"body2",noWrap:!0,children:C.vendor_name||C.vendor_id})}),i.jsx(ie,{item:!0,xs:12,sm:2.5,children:i.jsx(B,{variant:"body2",noWrap:!0,children:C.vendor_part_number})}),i.jsx(ie,{item:!0,xs:12,sm:3,children:i.jsx(B,{variant:"body2",noWrap:!0,children:C.vendor_part_description||""})}),i.jsx(ie,{item:!0,xs:12,sm:1,sx:{textAlign:"center"},children:C.preferred?"":""}),i.jsx(ie,{item:!0,xs:12,sm:3,children:i.jsxs(ct,{direction:"row",spacing:1,sx:{flexWrap:"wrap"},children:[i.jsx(ye,{size:"small",variant:"outlined",onClick:()=>$(C),sx:{minWidth:"fit-content"},children:C.preferred?"Unset":"Set Preferred"}),i.jsx(ye,{size:"small",color:"error",variant:"outlined",onClick:()=>Q(C),sx:{minWidth:"fit-content"},children:"Remove"})]})})]})},C.id))]})]})]})]})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:A,disabled:f,children:"Cancel"}),i.jsx(ye,{onClick:w,variant:"contained",disabled:f,children:f?"Saving...":a?"Update Part":"Save Part"})]})]})},lie=()=>{const[e,t]=y.useState(""),[r,n]=y.useState([]),[a,o]=y.useState(!1),[s,l]=y.useState(!1),[c,u]=y.useState(null),[d,f]=y.useState(!1),[h,p]=y.useState(0),[g,m]=y.useState(null),[x,b]=y.useState(!1),_=y.useRef(null),[w,A]=y.useState(!1),[O,T]=y.useState(null),[E,S]=y.useState(!1),[I,z]=y.useState(null),[k,M]=y.useState(!1),[R,F]=y.useState({page:0,pageSize:10}),{user:W}=ea(),K=async()=>{o(!0);try{const ee=await Kae();console.log("Raw inventory response:",ee),ee.length>0&&console.log("Sample inventory item from frontend:",{part_id:ee[0].part_id,part_number:ee[0].part_number,last_unit_cost:ee[0].last_unit_cost,last_unit_cost_type:typeof ee[0].last_unit_cost,quantity_on_hand:ee[0].quantity_on_hand,quantity_on_hand_type:typeof ee[0].quantity_on_hand});const se=ee.map((V,He)=>({...V,id:V.part_number||He}));n(se)}catch(ee){console.error("Error fetching inventory:",ee)}finally{o(!1)}};y.useEffect(()=>{K();const ee=()=>K();return window.addEventListener("inventory-updated",ee),()=>window.removeEventListener("inventory-updated",ee)},[]);const Z=r.filter(ee=>ee.part_number?.toUpperCase().includes(e.toUpperCase())||ee.part_description?.toLowerCase().includes(e.toLowerCase())),D=[{field:"part_number",headerName:"Part #",flex:1,headerAlign:"left",editable:!0},{field:"part_description",headerName:"Part Description",flex:2,headerAlign:"left"},{field:"category",headerName:"Category",flex:1,headerAlign:"left"},{field:"quantity_on_hand",headerName:"Quantity on Hand",flex:1,type:"number",editable:W?.access_role!=="Sales and Purchase",align:"center",headerAlign:"left"},{field:"unit",headerName:"UOM",flex:.5,headerAlign:"left"},{field:"last_unit_cost",headerName:"Last Unit Cost",flex:1,type:"number",editable:!0,align:"center",headerAlign:"left",valueFormatter:ee=>`$${(Number(ee.value)||0).toFixed(2)}`,valueGetter:ee=>Number(ee.value)||0},{field:"reorder_point",headerName:"Reorder Point",flex:.75,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"value",headerName:"Value",flex:1,type:"number",valueGetter:ee=>{const se=Number(ee.row.quantity_on_hand)||0,V=Number(ee.row.last_unit_cost)||0;return se*V},valueFormatter:ee=>`$${(Number(ee.value)||0).toFixed(2)}`,headerAlign:"center",align:"center"},{field:"actions",headerName:"Actions",width:100,headerAlign:"left",sortable:!1,renderCell:ee=>i.jsx(pr,{size:"small",color:"error",onClick:se=>{se.stopPropagation(),P(ee.row.part_number)},children:i.jsx(ua,{fontSize:"medium",sx:{fontSize:28}})})}].filter(Boolean),P=async ee=>{if(window.confirm(`Are you sure you want to delete part ${ee}?`))try{console.log(`Deleting part: ${ee}`);const se=await ve.delete(`/api/inventory/${encodeURIComponent(ee)}`);console.log(`Part ${ee} deleted successfully:`,se.data),alert(`Part ${ee} deleted successfully!`),K()}catch(se){console.error(`Error deleting part ${ee}:`,se),alert(`Error deleting part ${ee}. Please check the console.`)}},$=async(ee,se)=>{console.log("Attempting to update row:",ee);const V={};if(ee.part_number!==se.part_number){const Ne=String(ee.part_number).trim().toUpperCase();if(!Ne)return alert("Part number cannot be empty."),Promise.reject("Invalid part number");V.part_number=Ne}if(ee.quantity_on_hand!==se.quantity_on_hand){if(W?.access_role==="Sales and Purchase")return alert("Sales and Purchase users cannot modify quantity on hand for existing parts."),Promise.reject("Access denied");const Ne=parseFloat(String(ee.quantity_on_hand));if(isNaN(Ne))return alert("Invalid quantity value. Please enter a valid number."),Promise.reject("Invalid quantity");V.quantity_on_hand=Ne}if(ee.reorder_point!==se.reorder_point){const Ne=parseFloat(String(ee.reorder_point));if(isNaN(Ne))return alert("Invalid reorder point value. Please enter a valid number."),Promise.reject("Invalid reorder point");V.reorder_point=Ne}if(ee.last_unit_cost!==se.last_unit_cost){const Ne=parseFloat(String(ee.last_unit_cost));if(isNaN(Ne))return alert("Invalid last unit cost value. Please enter a valid number."),Promise.reject("Invalid last unit cost");V.last_unit_cost=Ne}if(ee.category!==se.category&&(V.category=ee.category),Object.keys(V).length===0)return console.log("No fields changed."),ee;const He=se.part_number;try{console.log(" processRowUpdate: Sending PUT request"),console.log(" URL:",`/api/inventory/${encodeURIComponent(He)}`),console.log(" Request body:",V),console.log(" Old part number:",se.part_number),console.log(" New part number:",ee.part_number);const Ne=await ve.put(`/api/inventory/${encodeURIComponent(He)}`,V);return console.log(`Inventory updated for part ${He}:`,Ne.data),alert(`Part ${He} updated successfully!`),await K(),Ne.data.updatedItem||ee}catch(Ne){return console.error(`Error updating inventory for part ${He}:`,Ne),Ne instanceof fi&&Ne.response&&Ne.response.data&&Ne.response.data.error?alert(`Error updating inventory: ${Ne.response.data.error}`):alert(`Error updating inventory for part ${He}. Please check the console.`),Promise.reject(Ne)}},Q=()=>{const ee=Z.map(Ne=>({...Ne,value:(Number(Ne.quantity_on_hand)||0)*(Number(Ne.last_unit_cost)||0)})),se=Cl.unparse(ee),V=new Blob([se],{type:"text/csv;charset=utf-8;"}),He=document.createElement("a");if(He.download!==void 0){const Ne=URL.createObjectURL(V);He.setAttribute("href",Ne),He.setAttribute("download","inventory_list.csv"),He.style.visibility="hidden",document.body.appendChild(He),He.click()}},C=()=>{u(null),l(!0)},L=async ee=>{const se={...ee,part_number:ee.part_number.trim().toUpperCase(),part_description:ee.part_description.trim(),unit:ee.unit.trim(),part_type:ee.part_type.trim()};try{let V;if(c){const He={...se,part_number:se.part_number};console.log('dY"? Frontend: Sending PUT request'),console.log('dY"< URL:',`/api/inventory/${encodeURIComponent(c.part_number)}`),console.log('dY"< Request body:',He),console.log('dY"< Original part number:',c.part_number),console.log('dY"< New part number:',se.part_number),V=await ve.put(`/api/inventory/${encodeURIComponent(c.part_number)}`,He)}else V=await ve.post("/api/inventory",se);return K(),V.data}catch(V){throw V}},H=()=>{l(!1),u(null)},U=ee=>{u({part_id:ee.row.part_id,part_number:ee.row.part_number,part_description:ee.row.part_description||"",unit:ee.row.unit||"Each",last_unit_cost:ee.row.last_unit_cost||"",quantity_on_hand:ee.row.quantity_on_hand||"",reorder_point:ee.row.reorder_point||"",part_type:ee.row.part_type||"stock",category:ee.row.category||"Uncategorized"}),l(!0)},te=()=>{_.current?.click()},le=async ee=>{const se=ee.target.files?.[0];if(se){if(!se.name.endsWith(".csv")&&se.type!=="text/csv"){alert("Please select a valid CSV file");return}if(se.size>5*1024*1024){alert("File size must be less than 5MB");return}await oe(se)}},oe=async ee=>{f(!0),p(0),m(null);const se=new FormData;se.append("csvFile",ee);try{const V=setInterval(()=>{p(Ne=>Ne>=90?(clearInterval(V),90):Ne+10)},200),He=await ve.post("/api/inventory/upload-csv",se,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:Ne=>{if(Ne.total){const Re=Math.round(Ne.loaded*90/Ne.total);p(Re)}}});clearInterval(V),p(100),m(He.data),b(!0),setTimeout(()=>{K()},1e3)}catch(V){console.error("Error uploading CSV:",V),V instanceof fi&&V.response?.data?m({error:"Upload failed",errors:V.response.data.errors||[V.response.data.error||"Unknown error"],warnings:V.response.data.warnings||[]}):m({error:"Upload failed",errors:["An unexpected error occurred during upload"]}),b(!0)}finally{f(!1),p(0),_.current&&(_.current.value="")}},ae=async()=>{try{const ee=await ve.get("/api/inventory/csv-template",{responseType:"blob"}),se=window.URL.createObjectURL(new Blob([ee.data])),V=document.createElement("a");V.href=se,V.setAttribute("download","inventory_template.csv"),document.body.appendChild(V),V.click(),V.remove(),window.URL.revokeObjectURL(se)}catch(ee){console.error("Error downloading template:",ee),alert("Error downloading template")}},he=()=>{b(!1),m(null)},me=async()=>{A(!0);try{const ee=[],se=[],V=Ke=>{const nt=[],st=[];let gt=String(Ke||"");const Ge=gt,Je=gt.replace(/\s+/g,"");Je!==gt&&nt.push("Removed spaces"),gt=Je;const We=gt.toUpperCase();We!==gt&&nt.push("Converted to uppercase"),gt=We;const _t=gt.replace(/[^A-Z0-9\/()]/g,"");_t!==gt&&nt.push("Removed punctuation excluding ( ) /"),gt=_t;const Nt=gt;return gt=gt.replace(/(\d)\/(1\d|\d)/g,(kt,Vt,jt,Tr,qe)=>{const $e=qe[Tr-1]||"",Xe=qe[Tr+kt.length]||"";return $e==="("&&Xe===")"?kt:`(${Vt}/${jt})`}),gt!==Nt&&nt.push("Wrapped fractions with parentheses"),gt.includes("/")&&(/^[A-Z]{3,}/.test(gt)||/[A-Z]{3,}$/.test(gt))&&st.push("Description text detected with fraction"),/\d\.|\.\d/.test(gt)&&st.push("Decimal detected; consider fraction"),{cleaned:gt,actions:nt,warnings:st,original:Ge}},He=r.map(Ke=>{const nt=V(Ke.part_number);return(nt.cleaned!==Ke.part_number||nt.actions.length>0)&&ee.push({part_number:Ke.part_number,cleaned_part_number:nt.cleaned,actions:nt.actions}),nt.warnings.length>0&&se.push({part_number:Ke.part_number,warnings:nt.warnings}),{...Ke,_clean:nt.cleaned}}),Ne={};He.forEach(Ke=>{Ne[Ke._clean]||(Ne[Ke._clean]=[]),Ne[Ke._clean].push(Ke)});const Re=Object.entries(Ne).filter(([,Ke])=>Ke.length>1).map(([,Ke])=>{const nt=Ke.map(Ge=>({part_number:Ge.part_number,unit:Ge.unit})),st=Ke[0].part_number,gt=new Set(Ke.map(Ge=>Ge.unit)).size>1;return{proposedKeep:st,candidates:nt,unitMismatch:gt}});z({fixes:ee,flags:se,duplicateGroups:Re}),M(!0)}catch(ee){console.error("Error during cleanup preview:",ee),alert("Failed to analyze inventory for cleanup.")}finally{A(!1)}},X=async()=>{if(!I)return;const ee=(I.duplicateGroups||[]).map(se=>({keepPartNumber:se.proposedKeep,mergePartNumbers:se.candidates.map(V=>V.part_number).filter(V=>V!==se.proposedKeep)}));A(!0);try{const se=await mS("stock",ee);M(!1),T(se),S(!0),await K()}catch(se){console.error("Error applying cleanup:",se),alert("Failed to apply cleanup.")}finally{A(!1)}},G=()=>{S(!1),T(null)};return i.jsxs(ir,{maxWidth:"xl",sx:{mt:4},children:[i.jsxs(J,{sx:{mb:4},children:[i.jsxs(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Stock"}),i.jsxs(ct,{direction:"row",spacing:2,children:[i.jsx(ye,{variant:"contained",startIcon:i.jsx(Ba,{}),onClick:C,children:"New Part"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Cd,{}),onClick:te,children:"Upload CSV"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(da,{}),onClick:ae,children:"Download Template"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(da,{}),onClick:Q,children:"Export CSV"}),i.jsx(ye,{variant:"outlined",color:"warning",onClick:me,disabled:w,startIcon:w?i.jsx(nr,{size:20}):i.jsx(ua,{}),children:w?"Cleaning...":"Clean"})]})]}),i.jsx("input",{type:"file",ref:_,onChange:le,accept:".csv",style:{display:"none"}}),d&&i.jsxs(xt,{sx:{p:2,mb:2},children:[i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Uploading CSV file..."}),i.jsx(Ed,{variant:"determinate",value:h}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[h,"% complete"]})]}),i.jsx(xt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(J,{sx:{p:2},children:[i.jsx(Ae,{fullWidth:!0,variant:"outlined",placeholder:"Search stock...",value:e,onChange:ee=>t(ee.target.value),InputProps:{startAdornment:i.jsx(oa,{position:"start",children:i.jsx(hi,{})})},sx:{mb:2}}),i.jsx(Po,{rows:Z,columns:D,loading:a,paginationModel:R,onPaginationModelChange:ee=>F(ee),pageSizeOptions:[10,20,50],processRowUpdate:$,getRowId:ee=>ee.id,onRowClick:(ee,se)=>{const V=se.target;V.closest('.MuiDataGrid-cell[data-field="part_number"]')||V.closest('.MuiDataGrid-cell[data-field="quantity_on_hand"]')||V.closest('.MuiDataGrid-cell[data-field="last_unit_cost"]')||V.closest('.MuiDataGrid-cell[data-field="reorder_point"]')||U(ee)},sx:{cursor:"pointer","& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})})]}),i.jsxs(gr,{open:k,onClose:()=>M(!1),maxWidth:"md",fullWidth:!0,children:[i.jsx(vr,{children:"Clean and Enforce Rules (Preview)"}),i.jsx(yr,{children:I?i.jsxs(J,{children:[i.jsx(B,{variant:"h6",children:"Fixes"}),i.jsx(ga,{dense:!0,children:(I.fixes||[]).slice(0,200).map((ee,se)=>i.jsx(Ca,{button:!0,onClick:()=>{const V=r.find(He=>He.part_number===ee.part_number);V&&(u({part_id:V.part_id,part_number:V.part_number,part_description:V.part_description||"",unit:V.unit||"Each",last_unit_cost:V.last_unit_cost||"",quantity_on_hand:V.quantity_on_hand||"",reorder_point:V.reorder_point||"",part_type:V.part_type||"stock",category:V.category||"Uncategorized"}),l(!0))},children:i.jsx(Jn,{primary:`${ee.part_number} -> ${ee.cleaned_part_number}`,secondary:(ee.actions||[]).join(", ")})},se))}),I.flags&&I.flags.length>0&&i.jsxs(i.Fragment,{children:[i.jsx(B,{variant:"h6",sx:{mt:2},children:"Flags"}),i.jsx(ga,{dense:!0,children:(I.flags||[]).map((ee,se)=>i.jsx(Ca,{button:!0,onClick:()=>{const V=r.find(He=>He.part_number===ee.part_number);V&&(u({part_id:V.part_id,part_number:V.part_number,part_description:V.part_description||"",unit:V.unit||"Each",last_unit_cost:V.last_unit_cost||"",quantity_on_hand:V.quantity_on_hand||"",reorder_point:V.reorder_point||"",part_type:V.part_type||"stock",category:V.category||"Uncategorized"}),l(!0))},children:i.jsx(Jn,{primary:`${ee.part_number}`,secondary:(ee.warnings||[]).join(", ")})},se))})]}),i.jsx(B,{variant:"h6",sx:{mt:2},children:"Potential Duplicates"}),i.jsx(ga,{dense:!0,children:(I.duplicateGroups||[]).map((ee,se)=>i.jsx(Ca,{children:i.jsx(Jn,{primary:`Keep ${ee.proposedKeep}  merge ${ee.candidates.map(V=>V.part_number).filter(V=>V!==ee.proposedKeep).join(", ")||"none"}`,secondary:ee.unitMismatch?"Unit mismatch detected - will not merge differing units":void 0})},se))})]}):i.jsx(B,{children:"Loading preview..."})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:()=>M(!1),children:"Cancel"}),i.jsx(ye,{onClick:X,variant:"contained",disabled:w,children:"Apply"})]})]}),i.jsx(tc,{open:s,onClose:H,onSave:L,initialPart:c||void 0,isEditMode:!!c,title:c?"Edit Inventory Part":"Add New Inventory Part"}),i.jsxs(gr,{open:x,onClose:he,maxWidth:"md",fullWidth:!0,children:[i.jsx(vr,{children:g?.error?"Upload Failed":"Upload Completed"}),i.jsx(yr,{children:g&&i.jsxs(J,{children:[g.error?i.jsx(Ot,{severity:"error",sx:{mb:2},children:g.error}):i.jsx(Ot,{severity:"success",sx:{mb:2},children:g.message}),g.summary&&i.jsxs(J,{sx:{mb:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Summary"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Total: ${g.summary.totalProcessed}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`New: ${g.summary.newItems}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Updated: ${g.summary.updatedItems}`,color:"info"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Vendor Mappings: ${g.summary.vendorMappings||0}`,color:"secondary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Errors: ${g.summary.errors}`,color:"error"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Warnings: ${g.summary.warnings}`,color:"warning"})})]})]}),g.errors&&g.errors.length>0&&i.jsxs(J,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"error",gutterBottom:!0,children:["Errors (",g.errors.length,")"]}),i.jsx(ga,{dense:!0,children:g.errors.map((ee,se)=>i.jsx(Ca,{children:i.jsx(Jn,{primary:ee})},se))})]}),g.warnings&&g.warnings.length>0&&i.jsxs(J,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"warning.main",gutterBottom:!0,children:["Warnings (",g.warnings.length,")"]}),i.jsx(ga,{dense:!0,children:g.warnings.map((ee,se)=>i.jsx(Ca,{children:i.jsx(Jn,{primary:ee})},se))})]})]})}),i.jsx(Cr,{children:i.jsx(ye,{onClick:he,variant:"contained",children:"Close"})})]}),i.jsxs(gr,{open:E,onClose:G,maxWidth:"sm",fullWidth:!0,children:[i.jsx(vr,{children:O?.error?"Cleanup Failed":"Cleanup Completed"}),i.jsx(yr,{children:O&&i.jsxs(J,{children:[O.error?i.jsxs(Ot,{severity:"error",sx:{mb:2},children:[O.message,O.details&&i.jsxs(B,{variant:"body2",sx:{mt:1},children:["Details: ",O.details]})]}):i.jsx(Ot,{severity:"success",sx:{mb:2},children:O.message}),O.summary&&i.jsxs(J,{sx:{mb:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Summary"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:4,children:i.jsx(ot,{label:`Total: ${O.summary.totalProcessed}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:4,children:i.jsx(ot,{label:`Updated: ${O.summary.itemsUpdated}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:4,children:i.jsx(ot,{label:`Errors: ${O.summary.errors}`,color:"error"})})]})]})]})}),i.jsx(Cr,{children:i.jsx(ye,{onClick:G,variant:"contained",children:"Close"})})]})]})},cie=()=>{const[e,t]=y.useState(""),[r,n]=y.useState([]),[a,o]=y.useState(!1),[s,l]=y.useState(!1),[c,u]=y.useState(null),[d,f]=y.useState(!1),[h,p]=y.useState(0),[g,m]=y.useState(null),[x,b]=y.useState(!1),_=y.useRef(null),[w,A]=y.useState({page:0,pageSize:10}),[O,T]=y.useState(!1),[E,S]=y.useState(null),[I,z]=y.useState(!1),[k,M]=y.useState(null),[R,F]=y.useState(!1),W=async()=>{o(!0);try{const G=(await Qae()).map((ee,se)=>({...ee,id:ee.part_number||se}));n(G)}catch(X){console.error("Error fetching supply inventory:",X)}finally{o(!1)}};y.useEffect(()=>{W();const X=()=>W();return window.addEventListener("supply-updated",X),()=>window.removeEventListener("supply-updated",X)},[]);const K=r.filter(X=>X.part_number?.toUpperCase().includes(e.toUpperCase())||X.part_description?.toLowerCase().includes(e.toLowerCase())),Z=[{field:"part_number",headerName:"Part #",flex:1,headerAlign:"left",editable:!0},{field:"part_description",headerName:"Part Description",flex:2,headerAlign:"left"},{field:"category",headerName:"Category",flex:1,headerAlign:"left"},{field:"unit",headerName:"UOM",flex:.5,headerAlign:"left"},{field:"last_unit_cost",headerName:"Last Unit Cost",flex:1,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"reorder_point",headerName:"Reorder Point",flex:.75,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"part_type",headerName:"Type",flex:.5,headerAlign:"left"},{field:"value",headerName:"Value",flex:1,type:"number",valueGetter:X=>{const G=X.row.quantity_on_hand==="NA"?0:Number(X.row.quantity_on_hand)||0,ee=Number(X.row.last_unit_cost)||0;return G*ee},valueFormatter:X=>`$${(Number(X.value)||0).toFixed(2)}`,headerAlign:"center",align:"center"},{field:"actions",headerName:"Actions",width:100,headerAlign:"left",sortable:!1,renderCell:X=>i.jsx(pr,{size:"small",color:"error",onClick:G=>{G.stopPropagation(),D(X.row.part_number)},children:i.jsx(ua,{fontSize:"medium",sx:{fontSize:28}})})}],D=async X=>{if(window.confirm(`Are you sure you want to delete part ${X}?`))try{console.log(`Deleting part: ${X}`);const G=await ve.delete(`/api/inventory/${encodeURIComponent(X)}`);console.log(`Part ${X} deleted successfully:`,G.data),alert(`Part ${X} deleted successfully!`),W()}catch(G){console.error(`Error deleting part ${X}:`,G),alert(`Error deleting part ${X}. Please check the console.`)}},P=async(X,G)=>{console.log("Attempting to update row:",X);const ee={};if(X.part_number!==G.part_number){const V=String(X.part_number).trim().toUpperCase();if(!V)return alert("Part number cannot be empty."),Promise.reject("Invalid part number");ee.part_number=V}if(X.reorder_point!==G.reorder_point){const V=parseFloat(String(X.reorder_point));if(isNaN(V))return alert("Invalid reorder point value. Please enter a valid number."),Promise.reject("Invalid reorder point");ee.reorder_point=V}if(X.last_unit_cost!==G.last_unit_cost){const V=parseFloat(String(X.last_unit_cost));if(isNaN(V))return alert("Invalid last unit cost value. Please enter a valid number."),Promise.reject("Invalid last unit cost");ee.last_unit_cost=V}if(X.category!==G.category&&(ee.category=X.category),Object.keys(ee).length===0)return console.log("No fields changed."),X;const se=ee.part_number?G.part_number:X.part_number;try{const V=await ve.put(`/api/inventory/${encodeURIComponent(se)}`,ee);return console.log(`Supply inventory updated for part ${se}:`,V.data),alert(`Part ${se} updated successfully!`),await W(),V.data.updatedItem||X}catch(V){return console.error(`Error updating supply inventory for part ${se}:`,V),V instanceof fi&&V.response&&V.response.data&&V.response.data.error?alert(`Error updating inventory: ${V.response.data.error}`):alert(`Error updating inventory for part ${se}. Please check the console.`),Promise.reject(V)}},$=()=>{const X=K.map(V=>({...V,value:(V.quantity_on_hand==="NA"?0:Number(V.quantity_on_hand)||0)*(Number(V.last_unit_cost)||0)})),G=Cl.unparse(X),ee=new Blob([G],{type:"text/csv;charset=utf-8;"}),se=document.createElement("a");if(se.download!==void 0){const V=URL.createObjectURL(ee);se.setAttribute("href",V),se.setAttribute("download","supply_list.csv"),se.style.visibility="hidden",document.body.appendChild(se),se.click()}},Q=()=>{u({part_number:"",part_description:"",unit:"",last_unit_cost:"",quantity_on_hand:"NA",reorder_point:"",part_type:"supply",category:"Uncategorized"}),l(!0)},C=async()=>{T(!0);try{const X=await i6("supply");S(X?.preview||X),z(!0)}catch(X){console.error("Error during cleanup preview:",X),alert("Failed to analyze supply for cleanup.")}finally{T(!1)}},L=async()=>{if(!E)return;const X=(E.duplicateGroups||[]).map(G=>({keepPartNumber:G.proposedKeep,mergePartNumbers:G.candidates.map(ee=>ee.part_number).filter(ee=>ee!==G.proposedKeep)}));T(!0);try{const G=await mS("supply",X);z(!1),M(G),F(!0),await W()}catch(G){console.error("Error applying cleanup:",G),alert("Failed to apply cleanup.")}finally{T(!1)}},H=async X=>{const G={...X,part_number:X.part_number.trim().toUpperCase(),part_description:X.part_description.trim(),unit:X.unit.trim(),part_type:X.part_type.trim()};try{if(c){const{part_number:ee,...se}=G;await ve.put(`/api/inventory/${encodeURIComponent(ee)}`,se)}else await ve.post("/api/inventory",G);W()}catch(ee){throw ee}},U=()=>{l(!1),u(null)},te=X=>{u({part_id:X.row.part_id,part_number:X.row.part_number,part_description:X.row.part_description||"",unit:X.row.unit||"Each",last_unit_cost:X.row.last_unit_cost||"",quantity_on_hand:X.row.quantity_on_hand||"",reorder_point:X.row.reorder_point||"",part_type:X.row.part_type||"supply",category:X.row.category||"Uncategorized"}),l(!0)},le=()=>{_.current?.click()},oe=async X=>{const G=X.target.files?.[0];if(G){if(!G.name.endsWith(".csv")&&G.type!=="text/csv"){alert("Please select a valid CSV file");return}if(G.size>5*1024*1024){alert("File size must be less than 5MB");return}await ae(G)}},ae=async X=>{f(!0),p(0),m(null);const G=new FormData;G.append("csvFile",X);try{const ee=setInterval(()=>{p(V=>V>=90?(clearInterval(ee),90):V+10)},200),se=await ve.post("/api/inventory/upload-csv",G,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:V=>{if(V.total){const He=Math.round(V.loaded*90/V.total);p(He)}}});clearInterval(ee),p(100),m(se.data),b(!0),setTimeout(()=>{W()},1e3)}catch(ee){console.error("Error uploading CSV:",ee),ee instanceof fi&&ee.response?.data?m({error:"Upload failed",errors:ee.response.data.errors||[ee.response.data.error||"Unknown error"],warnings:ee.response.data.warnings||[]}):m({error:"Upload failed",errors:["An unexpected error occurred during upload"]}),b(!0)}finally{f(!1),p(0),_.current&&(_.current.value="")}},he=async()=>{try{const X=await ve.get("/api/inventory/csv-template",{responseType:"blob"}),G=window.URL.createObjectURL(new Blob([X.data])),ee=document.createElement("a");ee.href=G,ee.setAttribute("download","supply_template.csv"),document.body.appendChild(ee),ee.click(),ee.remove(),window.URL.revokeObjectURL(G)}catch(X){console.error("Error downloading template:",X),alert("Error downloading template")}},me=()=>{b(!1),m(null)};return i.jsxs(ir,{maxWidth:"xl",sx:{mt:4},children:[i.jsxs(J,{sx:{mb:4},children:[i.jsxs(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Supply List"}),i.jsxs(ct,{direction:"row",spacing:2,children:[i.jsx(ye,{variant:"contained",startIcon:i.jsx(Ba,{}),onClick:Q,children:"New Part"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Cd,{}),onClick:le,children:"Upload CSV"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(da,{}),onClick:he,children:"Download Template"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(da,{}),onClick:$,children:"Export CSV"}),i.jsx(ye,{variant:"outlined",color:"warning",onClick:C,disabled:O,startIcon:i.jsx(ua,{}),children:O?"Cleaning...":"Clean"})]})]}),i.jsx("input",{type:"file",ref:_,onChange:oe,accept:".csv",style:{display:"none"}}),d&&i.jsxs(xt,{sx:{p:2,mb:2},children:[i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Uploading CSV file..."}),i.jsx(Ed,{variant:"determinate",value:h}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[h,"% complete"]})]}),i.jsx(xt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(J,{sx:{p:2},children:[i.jsx(Ae,{fullWidth:!0,variant:"outlined",placeholder:"Search supply...",value:e,onChange:X=>t(X.target.value),InputProps:{startAdornment:i.jsx(oa,{position:"start",children:i.jsx(hi,{})})},sx:{mb:2}}),i.jsx(Po,{rows:K,columns:Z,loading:a,paginationModel:w,onPaginationModelChange:X=>A(X),pageSizeOptions:[10,20,50],processRowUpdate:P,getRowId:X=>X.id,onRowClick:(X,G)=>{const ee=G.target;ee.closest('.MuiDataGrid-cell[data-field="part_number"]')||ee.closest('.MuiDataGrid-cell[data-field="last_unit_cost"]')||ee.closest('.MuiDataGrid-cell[data-field="reorder_point"]')||te(X)},sx:{cursor:"pointer","& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})})]}),i.jsx(tc,{open:s,onClose:U,onSave:H,initialPart:c||void 0,isEditMode:!!c,title:c?"Edit Supply Part":"Add New Supply Part"}),i.jsxs(gr,{open:x,onClose:me,maxWidth:"md",fullWidth:!0,children:[i.jsx(vr,{children:g?.error?"Upload Failed":"Upload Completed"}),i.jsx(yr,{children:g&&i.jsxs(J,{children:[g.error?i.jsx(Ot,{severity:"error",sx:{mb:2},children:g.error}):i.jsx(Ot,{severity:"success",sx:{mb:2},children:g.message}),g.summary&&i.jsxs(J,{sx:{mb:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Summary"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Total: ${g.summary.totalProcessed}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`New: ${g.summary.newItems}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Updated: ${g.summary.updatedItems}`,color:"info"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Vendor Mappings: ${g.summary.vendorMappings||0}`,color:"secondary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Errors: ${g.summary.errors}`,color:"error"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Warnings: ${g.summary.warnings}`,color:"warning"})})]})]}),g.errors&&g.errors.length>0&&i.jsxs(J,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"error",gutterBottom:!0,children:["Errors (",g.errors.length,")"]}),i.jsx(ga,{dense:!0,children:g.errors.map((X,G)=>i.jsx(Ca,{children:i.jsx(Jn,{primary:X})},G))})]}),g.warnings&&g.warnings.length>0&&i.jsxs(J,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"warning.main",gutterBottom:!0,children:["Warnings (",g.warnings.length,")"]}),i.jsx(ga,{dense:!0,children:g.warnings.map((X,G)=>i.jsx(Ca,{children:i.jsx(Jn,{primary:X})},G))})]})]})}),i.jsx(Cr,{children:i.jsx(ye,{onClick:me,variant:"contained",children:"Close"})})]}),i.jsxs(gr,{open:I,onClose:()=>z(!1),maxWidth:"md",fullWidth:!0,children:[i.jsx(vr,{children:"Clean and Enforce Rules (Preview)"}),i.jsx(yr,{children:E?i.jsxs(J,{children:[i.jsx(B,{variant:"h6",children:"Fixes"}),i.jsx(ga,{dense:!0,children:(E.fixes||[]).slice(0,200).map((X,G)=>i.jsx(Ca,{children:i.jsx(Jn,{primary:`${X.part_number} -> ${X.cleaned_part_number}`,secondary:(X.actions||[]).join(", ")})},G))}),i.jsx(B,{variant:"h6",sx:{mt:2},children:"Potential Duplicates"}),i.jsx(ga,{dense:!0,children:(E.duplicateGroups||[]).map((X,G)=>i.jsx(Ca,{children:i.jsx(Jn,{primary:`Keep ${X.proposedKeep}  merge ${X.candidates.map(ee=>ee.part_number).filter(ee=>ee!==X.proposedKeep).join(", ")||"none"}`,secondary:X.unitMismatch?"Unit mismatch detected - will not merge differing units":void 0})},G))})]}):i.jsx(B,{children:"Loading preview..."})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:()=>z(!1),children:"Cancel"}),i.jsx(ye,{onClick:L,variant:"contained",disabled:O,children:"Apply"})]})]}),i.jsxs(gr,{open:R,onClose:()=>F(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(vr,{children:"Cleanup Completed"}),i.jsx(yr,{children:k?i.jsxs(J,{children:[i.jsx(Ot,{severity:"success",sx:{mb:2},children:"Cleanup applied successfully."}),i.jsxs(B,{variant:"body2",children:["Fixes applied: ",k?.applied?.fixesApplied||0]}),i.jsxs(B,{variant:"body2",children:["Fixes skipped: ",k?.applied?.fixesSkipped||0]}),i.jsxs(B,{variant:"body2",children:["Merged groups: ",k?.applied?.mergedGroups||0]}),i.jsxs(B,{variant:"body2",children:["Merged items: ",k?.applied?.mergedItems||0]})]}):i.jsx(B,{children:"Loading..."})}),i.jsx(Cr,{children:i.jsx(ye,{onClick:()=>F(!1),variant:"contained",children:"Close"})})]})]})},uie=()=>{const[e,t]=y.useState(""),[r,n]=y.useState([]),[a,o]=y.useState(!1),[s,l]=y.useState(!1),[c,u]=y.useState(null),[d,f]=y.useState(!1),[h,p]=y.useState(0),[g,m]=y.useState(null),[x,b]=y.useState(!1),_=y.useRef(null),[w,A]=y.useState({page:0,pageSize:10}),[O,T]=y.useState(!1),[E,S]=y.useState(null),[I,z]=y.useState(!1),[k,M]=y.useState(null),[R,F]=y.useState(!1),W=async()=>{o(!0);try{const G=(await Xae()).map((ee,se)=>({...ee,id:ee.part_number||se}));n(G)}catch(X){console.error("Error fetching service inventory:",X)}finally{o(!1)}};y.useEffect(()=>{W();const X=()=>W();return window.addEventListener("service-updated",X),()=>window.removeEventListener("service-updated",X)},[]);const K=r.filter(X=>X.part_number?.toUpperCase().includes(e.toUpperCase())||X.part_description?.toLowerCase().includes(e.toLowerCase())),Z=[{field:"part_number",headerName:"Part #",flex:1,headerAlign:"left",editable:!0},{field:"part_description",headerName:"Part Description",flex:2,headerAlign:"left"},{field:"category",headerName:"Category",flex:1,headerAlign:"left"},{field:"unit",headerName:"UOM",flex:.5,headerAlign:"left"},{field:"last_unit_cost",headerName:"Last Unit Cost",flex:1,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"reorder_point",headerName:"Reorder Point",flex:.75,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"part_type",headerName:"Type",flex:.5,headerAlign:"left"},{field:"value",headerName:"Value",flex:1,type:"number",valueGetter:X=>{const G=X.row.quantity_on_hand==="NA"?0:Number(X.row.quantity_on_hand)||0,ee=Number(X.row.last_unit_cost)||0;return G*ee},valueFormatter:X=>`$${(Number(X.value)||0).toFixed(2)}`,headerAlign:"center",align:"center"},{field:"actions",headerName:"Actions",width:100,headerAlign:"left",sortable:!1,renderCell:X=>i.jsx(pr,{size:"small",color:"error",onClick:G=>{G.stopPropagation(),D(X.row.part_number)},children:i.jsx(ua,{fontSize:"medium",sx:{fontSize:28}})})}],D=async X=>{if(window.confirm(`Are you sure you want to delete part ${X}?`))try{console.log(`Deleting part: ${X}`);const G=await ve.delete(`/api/inventory/${encodeURIComponent(X)}`);console.log(`Part ${X} deleted successfully:`,G.data),alert(`Part ${X} deleted successfully!`),W()}catch(G){console.error(`Error deleting part ${X}:`,G),alert(`Error deleting part ${X}. Please check the console.`)}},P=async(X,G)=>{console.log("Attempting to update row:",X);const ee={};if(X.part_number!==G.part_number){const V=String(X.part_number).trim().toUpperCase();if(!V)return alert("Part number cannot be empty."),Promise.reject("Invalid part number");ee.part_number=V}if(X.reorder_point!==G.reorder_point){const V=parseFloat(String(X.reorder_point));if(isNaN(V))return alert("Invalid reorder point value. Please enter a valid number."),Promise.reject("Invalid reorder point");ee.reorder_point=V}if(X.last_unit_cost!==G.last_unit_cost){const V=parseFloat(String(X.last_unit_cost));if(isNaN(V))return alert("Invalid last unit cost value. Please enter a valid number."),Promise.reject("Invalid last unit cost");ee.last_unit_cost=V}if(X.category!==G.category&&(ee.category=X.category),Object.keys(ee).length===0)return console.log("No fields changed."),X;const se=ee.part_number?G.part_number:X.part_number;try{const V=await ve.put(`/api/inventory/${encodeURIComponent(se)}`,ee);return console.log(`Service inventory updated for part ${se}:`,V.data),alert(`Part ${se} updated successfully!`),await W(),V.data.updatedItem||X}catch(V){return console.error(`Error updating service inventory for part ${se}:`,V),V instanceof fi&&V.response&&V.response.data&&V.response.data.error?alert(`Error updating inventory: ${V.response.data.error}`):alert(`Error updating inventory for part ${se}. Please check the console.`),Promise.reject(V)}},$=()=>{const X=K.map(V=>({...V,value:(V.quantity_on_hand==="NA"?0:Number(V.quantity_on_hand)||0)*(Number(V.last_unit_cost)||0)})),G=Cl.unparse(X),ee=new Blob([G],{type:"text/csv;charset=utf-8;"}),se=document.createElement("a");if(se.download!==void 0){const V=URL.createObjectURL(ee);se.setAttribute("href",V),se.setAttribute("download","service_list.csv"),se.style.visibility="hidden",document.body.appendChild(se),se.click()}},Q=()=>{u({part_number:"",part_description:"",unit:"",last_unit_cost:"",quantity_on_hand:"NA",reorder_point:"",part_type:"service",category:"Uncategorized"}),l(!0)},C=async()=>{T(!0);try{const X=await i6("service");S(X?.preview||X),z(!0)}catch(X){console.error("Error during cleanup preview:",X),alert("Failed to analyze service for cleanup.")}finally{T(!1)}},L=async()=>{if(!E)return;const X=(E.duplicateGroups||[]).map(G=>({keepPartNumber:G.proposedKeep,mergePartNumbers:G.candidates.map(ee=>ee.part_number).filter(ee=>ee!==G.proposedKeep)}));T(!0);try{const G=await mS("service",X);z(!1),M(G),F(!0),await W()}catch(G){console.error("Error applying cleanup:",G),alert("Failed to apply cleanup.")}finally{T(!1)}},H=async X=>{const G={...X,part_number:X.part_number.trim().toUpperCase(),part_description:X.part_description.trim(),unit:X.unit.trim(),part_type:X.part_type.trim()};try{if(c){const{part_number:ee,...se}=G;await ve.put(`/api/inventory/${encodeURIComponent(ee)}`,se)}else await ve.post("/api/inventory",G);W()}catch(ee){throw ee}},U=()=>{l(!1),u(null)},te=X=>{u({part_id:X.row.part_id,part_number:X.row.part_number,part_description:X.row.part_description||"",unit:X.row.unit||"Each",last_unit_cost:X.row.last_unit_cost||"",quantity_on_hand:X.row.quantity_on_hand||"",reorder_point:X.row.reorder_point||"",part_type:X.row.part_type||"service",category:X.row.category||"Uncategorized"}),l(!0)},le=()=>{_.current?.click()},oe=async X=>{const G=X.target.files?.[0];if(G){if(!G.name.endsWith(".csv")&&G.type!=="text/csv"){alert("Please select a valid CSV file");return}if(G.size>5*1024*1024){alert("File size must be less than 5MB");return}await ae(G)}},ae=async X=>{f(!0),p(0),m(null);const G=new FormData;G.append("csvFile",X);try{const ee=setInterval(()=>{p(V=>V>=90?(clearInterval(ee),90):V+10)},200),se=await ve.post("/api/inventory/upload-csv",G,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:V=>{if(V.total){const He=Math.round(V.loaded*90/V.total);p(He)}}});clearInterval(ee),p(100),m(se.data),b(!0),setTimeout(()=>{W()},1e3)}catch(ee){console.error("Error uploading CSV:",ee),ee instanceof fi&&ee.response?.data?m({error:"Upload failed",errors:ee.response.data.errors||[ee.response.data.error||"Unknown error"],warnings:ee.response.data.warnings||[]}):m({error:"Upload failed",errors:["An unexpected error occurred during upload"]}),b(!0)}finally{f(!1),p(0),_.current&&(_.current.value="")}},he=async()=>{try{const X=await ve.get("/api/inventory/csv-template",{responseType:"blob"}),G=window.URL.createObjectURL(new Blob([X.data])),ee=document.createElement("a");ee.href=G,ee.setAttribute("download","service_template.csv"),document.body.appendChild(ee),ee.click(),ee.remove(),window.URL.revokeObjectURL(G)}catch(X){console.error("Error downloading template:",X),alert("Error downloading template")}},me=()=>{b(!1),m(null)};return i.jsxs(ir,{maxWidth:"xl",sx:{mt:4},children:[i.jsxs(J,{sx:{mb:4},children:[i.jsxs(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Service List"}),i.jsxs(ct,{direction:"row",spacing:2,children:[i.jsx(ye,{variant:"contained",startIcon:i.jsx(Ba,{}),onClick:Q,children:"New Part"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Cd,{}),onClick:le,children:"Upload CSV"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(da,{}),onClick:he,children:"Download Template"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(da,{}),onClick:$,children:"Export CSV"}),i.jsx(ye,{variant:"outlined",color:"warning",onClick:C,disabled:O,startIcon:i.jsx(ua,{}),children:O?"Cleaning...":"Clean"})]})]}),i.jsx("input",{type:"file",ref:_,onChange:oe,accept:".csv",style:{display:"none"}}),d&&i.jsxs(xt,{sx:{p:2,mb:2},children:[i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Uploading CSV file..."}),i.jsx(Ed,{variant:"determinate",value:h}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[h,"% complete"]})]}),i.jsx(xt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(J,{sx:{p:2},children:[i.jsx(Ae,{fullWidth:!0,variant:"outlined",placeholder:"Search service...",value:e,onChange:X=>t(X.target.value),InputProps:{startAdornment:i.jsx(oa,{position:"start",children:i.jsx(hi,{})})},sx:{mb:2}}),i.jsx(Po,{rows:K,columns:Z,loading:a,paginationModel:w,onPaginationModelChange:X=>A(X),pageSizeOptions:[10,20,50],processRowUpdate:P,getRowId:X=>X.id,onRowClick:(X,G)=>{const ee=G.target;ee.closest('.MuiDataGrid-cell[data-field="part_number"]')||ee.closest('.MuiDataGrid-cell[data-field="last_unit_cost"]')||ee.closest('.MuiDataGrid-cell[data-field="reorder_point"]')||te(X)},sx:{cursor:"pointer","& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})})]}),i.jsx(tc,{open:s,onClose:U,onSave:H,initialPart:c||void 0,isEditMode:!!c,title:c?"Edit Service Part":"Add New Service Part"}),i.jsxs(gr,{open:x,onClose:me,maxWidth:"md",fullWidth:!0,children:[i.jsx(vr,{children:g?.error?"Upload Failed":"Upload Completed"}),i.jsx(yr,{children:g&&i.jsxs(J,{children:[g.error?i.jsx(Ot,{severity:"error",sx:{mb:2},children:g.error}):i.jsx(Ot,{severity:"success",sx:{mb:2},children:g.message}),g.summary&&i.jsxs(J,{sx:{mb:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Summary"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Total: ${g.summary.totalProcessed}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`New: ${g.summary.newItems}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Updated: ${g.summary.updatedItems}`,color:"info"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Vendor Mappings: ${g.summary.vendorMappings||0}`,color:"secondary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Errors: ${g.summary.errors}`,color:"error"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(ot,{label:`Warnings: ${g.summary.warnings}`,color:"warning"})})]})]}),g.errors&&g.errors.length>0&&i.jsxs(J,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"error",gutterBottom:!0,children:["Errors (",g.errors.length,")"]}),i.jsx(ga,{dense:!0,children:g.errors.map((X,G)=>i.jsx(Ca,{children:i.jsx(Jn,{primary:X})},G))})]}),g.warnings&&g.warnings.length>0&&i.jsxs(J,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"warning.main",gutterBottom:!0,children:["Warnings (",g.warnings.length,")"]}),i.jsx(ga,{dense:!0,children:g.warnings.map((X,G)=>i.jsx(Ca,{children:i.jsx(Jn,{primary:X})},G))})]})]})}),i.jsx(Cr,{children:i.jsx(ye,{onClick:me,variant:"contained",children:"Close"})})]}),i.jsxs(gr,{open:I,onClose:()=>z(!1),maxWidth:"md",fullWidth:!0,children:[i.jsx(vr,{children:"Clean and Enforce Rules (Preview)"}),i.jsx(yr,{children:E?i.jsxs(J,{children:[i.jsx(B,{variant:"h6",children:"Fixes"}),i.jsx(ga,{dense:!0,children:(E.fixes||[]).slice(0,200).map((X,G)=>i.jsx(Ca,{children:i.jsx(Jn,{primary:`${X.part_number} -> ${X.cleaned_part_number}`,secondary:(X.actions||[]).join(", ")})},G))}),i.jsx(B,{variant:"h6",sx:{mt:2},children:"Potential Duplicates"}),i.jsx(ga,{dense:!0,children:(E.duplicateGroups||[]).map((X,G)=>i.jsx(Ca,{children:i.jsx(Jn,{primary:`Keep ${X.proposedKeep}  merge ${X.candidates.map(ee=>ee.part_number).filter(ee=>ee!==X.proposedKeep).join(", ")||"none"}`,secondary:X.unitMismatch?"Unit mismatch detected - will not merge differing units":void 0})},G))})]}):i.jsx(B,{children:"Loading preview..."})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:()=>z(!1),children:"Cancel"}),i.jsx(ye,{onClick:L,variant:"contained",disabled:O,children:"Apply"})]})]}),i.jsxs(gr,{open:R,onClose:()=>F(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(vr,{children:"Cleanup Completed"}),i.jsx(yr,{children:k?i.jsxs(J,{children:[i.jsx(Ot,{severity:"success",sx:{mb:2},children:"Cleanup applied successfully."}),i.jsxs(B,{variant:"body2",children:["Fixes applied: ",k?.applied?.fixesApplied||0]}),i.jsxs(B,{variant:"body2",children:["Fixes skipped: ",k?.applied?.fixesSkipped||0]}),i.jsxs(B,{variant:"body2",children:["Merged groups: ",k?.applied?.mergedGroups||0]}),i.jsxs(B,{variant:"body2",children:["Merged items: ",k?.applied?.mergedItems||0]})]}):i.jsx(B,{children:"Loading..."})}),i.jsx(Cr,{children:i.jsx(ye,{onClick:()=>F(!1),variant:"contained",children:"Close"})})]})]})};function sn(e){if(e===null||e===!0||e===!1)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function Ft(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function qt(e){Ft(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||xn(e)==="object"&&t==="[object Date]"?new Date(e.getTime()):typeof e=="number"||t==="[object Number]"?new Date(e):((typeof e=="string"||t==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function eg(e,t){Ft(2,arguments);var r=qt(e),n=sn(t);return isNaN(n)?new Date(NaN):(n&&r.setDate(r.getDate()+n),r)}function tg(e,t){Ft(2,arguments);var r=qt(e),n=sn(t);if(isNaN(n))return new Date(NaN);if(!n)return r;var a=r.getDate(),o=new Date(r.getTime());o.setMonth(r.getMonth()+n+1,0);var s=o.getDate();return a>=s?o:(r.setFullYear(o.getFullYear(),o.getMonth(),a),r)}function ky(e,t){Ft(2,arguments);var r=qt(e).getTime(),n=sn(t);return new Date(r+n)}var die=36e5;function fie(e,t){Ft(2,arguments);var r=sn(t);return ky(e,r*die)}var hie={};function cs(){return hie}function zc(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=cs(),f=sn((r=(n=(a=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&a!==void 0?a:d.weekStartsOn)!==null&&n!==void 0?n:(c=d.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=qt(e),p=h.getDay(),g=(p<f?7:0)+p-f;return h.setDate(h.getDate()-g),h.setHours(0,0,0,0),h}function Ad(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function Pd(e){Ft(1,arguments);var t=qt(e);return t.setHours(0,0,0,0),t}var pie=864e5;function mie(e,t){Ft(2,arguments);var r=Pd(e),n=Pd(t),a=r.getTime()-Ad(r),o=n.getTime()-Ad(n);return Math.round((a-o)/pie)}var gie=6e4;function vie(e,t){Ft(2,arguments);var r=sn(t);return ky(e,r*gie)}function yie(e,t){Ft(2,arguments);var r=sn(t);return ky(e,r*1e3)}function xie(e,t){Ft(2,arguments);var r=sn(t),n=r*7;return eg(e,n)}function bE(e,t){Ft(2,arguments);var r=sn(t);return tg(e,r*12)}function Yu(e,t){Ft(2,arguments);var r=qt(e),n=qt(t),a=r.getTime()-n.getTime();return a<0?-1:a>0?1:a}var Ty=6e4,Ey=36e5,bie=1e3;function _ie(e,t){Ft(2,arguments);var r=Pd(e),n=Pd(t);return r.getTime()===n.getTime()}function wie(e){return Ft(1,arguments),e instanceof Date||xn(e)==="object"&&Object.prototype.toString.call(e)==="[object Date]"}function o6(e){if(Ft(1,arguments),!wie(e)&&typeof e!="number")return!1;var t=qt(e);return!isNaN(Number(t))}function jie(e,t){Ft(2,arguments);var r=qt(e),n=qt(t),a=r.getFullYear()-n.getFullYear(),o=r.getMonth()-n.getMonth();return a*12+o}function Sie(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getFullYear()-n.getFullYear()}function _E(e,t){var r=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return r<0?-1:r>0?1:r}function s6(e,t){Ft(2,arguments);var r=qt(e),n=qt(t),a=_E(r,n),o=Math.abs(mie(r,n));r.setDate(r.getDate()-a*o);var s=+(_E(r,n)===-a),l=a*(o-s);return l===0?0:l}function Iy(e,t){return Ft(2,arguments),qt(e).getTime()-qt(t).getTime()}var wE={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(t){return t<0?Math.ceil(t):Math.floor(t)}},Cie="trunc";function Hp(e){return e?wE[e]:wE[Cie]}function Aie(e,t,r){Ft(2,arguments);var n=Iy(e,t)/Ey;return Hp(void 0)(n)}function Pie(e,t,r){Ft(2,arguments);var n=Iy(e,t)/Ty;return Hp(void 0)(n)}function _w(e){Ft(1,arguments);var t=qt(e);return t.setHours(23,59,59,999),t}function ww(e){Ft(1,arguments);var t=qt(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function Oie(e){Ft(1,arguments);var t=qt(e);return _w(t).getTime()===ww(t).getTime()}function l6(e,t){Ft(2,arguments);var r=qt(e),n=qt(t),a=Yu(r,n),o=Math.abs(jie(r,n)),s;if(o<1)s=0;else{r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-a*o);var l=Yu(r,n)===-a;Oie(qt(e))&&o===1&&Yu(e,n)===1&&(l=!1),s=a*(o-Number(l))}return s===0?0:s}function kie(e,t,r){Ft(2,arguments);var n=l6(e,t)/3;return Hp(void 0)(n)}function Tie(e,t,r){Ft(2,arguments);var n=Iy(e,t)/1e3;return Hp(void 0)(n)}function Eie(e,t,r){Ft(2,arguments);var n=s6(e,t)/7;return Hp(void 0)(n)}function Iie(e,t){Ft(2,arguments);var r=qt(e),n=qt(t),a=Yu(r,n),o=Math.abs(Sie(r,n));r.setFullYear(1584),n.setFullYear(1584);var s=Yu(r,n)===-a,l=a*(o-Number(s));return l===0?0:l}function Nie(e,t){var r;Ft(1,arguments);var n=e||{},a=qt(n.start),o=qt(n.end),s=o.getTime();if(!(a.getTime()<=s))throw new RangeError("Invalid interval");var l=[],c=a;c.setHours(0,0,0,0);var u=Number((r=void 0)!==null&&r!==void 0?r:1);if(u<1||isNaN(u))throw new RangeError("`options.step` must be a number greater than 1");for(;c.getTime()<=s;)l.push(qt(c)),c.setDate(c.getDate()+u),c.setHours(0,0,0,0);return l}function jE(e){Ft(1,arguments);var t=qt(e);return t.setDate(1),t.setHours(0,0,0,0),t}function m2(e){Ft(1,arguments);var t=qt(e),r=t.getFullYear();return t.setFullYear(r+1,0,0),t.setHours(23,59,59,999),t}function Nm(e){Ft(1,arguments);var t=qt(e),r=new Date(0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}function g2(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=cs(),f=sn((r=(n=(a=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&a!==void 0?a:d.weekStartsOn)!==null&&n!==void 0?n:(c=d.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=qt(e),p=h.getDay(),g=(p<f?-7:0)+6-(p-f);return h.setDate(h.getDate()+g),h.setHours(23,59,59,999),h}function c6(e,t){Ft(2,arguments);var r=sn(t);return ky(e,-r)}var Die=864e5;function Mie(e){Ft(1,arguments);var t=qt(e),r=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var n=t.getTime(),a=r-n;return Math.floor(a/Die)+1}function Od(e){Ft(1,arguments);var t=1,r=qt(e),n=r.getUTCDay(),a=(n<t?7:0)+n-t;return r.setUTCDate(r.getUTCDate()-a),r.setUTCHours(0,0,0,0),r}function u6(e){Ft(1,arguments);var t=qt(e),r=t.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(r+1,0,4),n.setUTCHours(0,0,0,0);var a=Od(n),o=new Date(0);o.setUTCFullYear(r,0,4),o.setUTCHours(0,0,0,0);var s=Od(o);return t.getTime()>=a.getTime()?r+1:t.getTime()>=s.getTime()?r:r-1}function Lie(e){Ft(1,arguments);var t=u6(e),r=new Date(0);r.setUTCFullYear(t,0,4),r.setUTCHours(0,0,0,0);var n=Od(r);return n}var Rie=6048e5;function d6(e){Ft(1,arguments);var t=qt(e),r=Od(t).getTime()-Lie(t).getTime();return Math.round(r/Rie)+1}function ru(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=cs(),f=sn((r=(n=(a=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&a!==void 0?a:d.weekStartsOn)!==null&&n!==void 0?n:(c=d.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=qt(e),p=h.getUTCDay(),g=(p<f?7:0)+p-f;return h.setUTCDate(h.getUTCDate()-g),h.setUTCHours(0,0,0,0),h}function gS(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=qt(e),f=d.getUTCFullYear(),h=cs(),p=sn((r=(n=(a=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&a!==void 0?a:h.firstWeekContainsDate)!==null&&n!==void 0?n:(c=h.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&r!==void 0?r:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var g=new Date(0);g.setUTCFullYear(f+1,0,p),g.setUTCHours(0,0,0,0);var m=ru(g,t),x=new Date(0);x.setUTCFullYear(f,0,p),x.setUTCHours(0,0,0,0);var b=ru(x,t);return d.getTime()>=m.getTime()?f+1:d.getTime()>=b.getTime()?f:f-1}function qie(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=cs(),f=sn((r=(n=(a=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&a!==void 0?a:d.firstWeekContainsDate)!==null&&n!==void 0?n:(c=d.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&r!==void 0?r:1),h=gS(e,t),p=new Date(0);p.setUTCFullYear(h,0,f),p.setUTCHours(0,0,0,0);var g=ru(p,t);return g}var Fie=6048e5;function f6(e,t){Ft(1,arguments);var r=qt(e),n=ru(r,t).getTime()-qie(r,t).getTime();return Math.round(n/Fie)+1}function Yr(e,t){for(var r=e<0?"-":"",n=Math.abs(e).toString();n.length<t;)n="0"+n;return r+n}var Ul={y:function(t,r){var n=t.getUTCFullYear(),a=n>0?n:1-n;return Yr(r==="yy"?a%100:a,r.length)},M:function(t,r){var n=t.getUTCMonth();return r==="M"?String(n+1):Yr(n+1,2)},d:function(t,r){return Yr(t.getUTCDate(),r.length)},a:function(t,r){var n=t.getUTCHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h:function(t,r){return Yr(t.getUTCHours()%12||12,r.length)},H:function(t,r){return Yr(t.getUTCHours(),r.length)},m:function(t,r){return Yr(t.getUTCMinutes(),r.length)},s:function(t,r){return Yr(t.getUTCSeconds(),r.length)},S:function(t,r){var n=r.length,a=t.getUTCMilliseconds(),o=Math.floor(a*Math.pow(10,n-3));return Yr(o,r.length)}},Su={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},$ie={G:function(t,r,n){var a=t.getUTCFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return n.era(a,{width:"abbreviated"});case"GGGGG":return n.era(a,{width:"narrow"});case"GGGG":default:return n.era(a,{width:"wide"})}},y:function(t,r,n){if(r==="yo"){var a=t.getUTCFullYear(),o=a>0?a:1-a;return n.ordinalNumber(o,{unit:"year"})}return Ul.y(t,r)},Y:function(t,r,n,a){var o=gS(t,a),s=o>0?o:1-o;if(r==="YY"){var l=s%100;return Yr(l,2)}return r==="Yo"?n.ordinalNumber(s,{unit:"year"}):Yr(s,r.length)},R:function(t,r){var n=u6(t);return Yr(n,r.length)},u:function(t,r){var n=t.getUTCFullYear();return Yr(n,r.length)},Q:function(t,r,n){var a=Math.ceil((t.getUTCMonth()+1)/3);switch(r){case"Q":return String(a);case"QQ":return Yr(a,2);case"Qo":return n.ordinalNumber(a,{unit:"quarter"});case"QQQ":return n.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(a,{width:"wide",context:"formatting"})}},q:function(t,r,n){var a=Math.ceil((t.getUTCMonth()+1)/3);switch(r){case"q":return String(a);case"qq":return Yr(a,2);case"qo":return n.ordinalNumber(a,{unit:"quarter"});case"qqq":return n.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(a,{width:"wide",context:"standalone"})}},M:function(t,r,n){var a=t.getUTCMonth();switch(r){case"M":case"MM":return Ul.M(t,r);case"Mo":return n.ordinalNumber(a+1,{unit:"month"});case"MMM":return n.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(a,{width:"wide",context:"formatting"})}},L:function(t,r,n){var a=t.getUTCMonth();switch(r){case"L":return String(a+1);case"LL":return Yr(a+1,2);case"Lo":return n.ordinalNumber(a+1,{unit:"month"});case"LLL":return n.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(a,{width:"wide",context:"standalone"})}},w:function(t,r,n,a){var o=f6(t,a);return r==="wo"?n.ordinalNumber(o,{unit:"week"}):Yr(o,r.length)},I:function(t,r,n){var a=d6(t);return r==="Io"?n.ordinalNumber(a,{unit:"week"}):Yr(a,r.length)},d:function(t,r,n){return r==="do"?n.ordinalNumber(t.getUTCDate(),{unit:"date"}):Ul.d(t,r)},D:function(t,r,n){var a=Mie(t);return r==="Do"?n.ordinalNumber(a,{unit:"dayOfYear"}):Yr(a,r.length)},E:function(t,r,n){var a=t.getUTCDay();switch(r){case"E":case"EE":case"EEE":return n.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(a,{width:"short",context:"formatting"});case"EEEE":default:return n.day(a,{width:"wide",context:"formatting"})}},e:function(t,r,n,a){var o=t.getUTCDay(),s=(o-a.weekStartsOn+8)%7||7;switch(r){case"e":return String(s);case"ee":return Yr(s,2);case"eo":return n.ordinalNumber(s,{unit:"day"});case"eee":return n.day(o,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(o,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(o,{width:"short",context:"formatting"});case"eeee":default:return n.day(o,{width:"wide",context:"formatting"})}},c:function(t,r,n,a){var o=t.getUTCDay(),s=(o-a.weekStartsOn+8)%7||7;switch(r){case"c":return String(s);case"cc":return Yr(s,r.length);case"co":return n.ordinalNumber(s,{unit:"day"});case"ccc":return n.day(o,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(o,{width:"narrow",context:"standalone"});case"cccccc":return n.day(o,{width:"short",context:"standalone"});case"cccc":default:return n.day(o,{width:"wide",context:"standalone"})}},i:function(t,r,n){var a=t.getUTCDay(),o=a===0?7:a;switch(r){case"i":return String(o);case"ii":return Yr(o,r.length);case"io":return n.ordinalNumber(o,{unit:"day"});case"iii":return n.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(a,{width:"short",context:"formatting"});case"iiii":default:return n.day(a,{width:"wide",context:"formatting"})}},a:function(t,r,n){var a=t.getUTCHours(),o=a/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},b:function(t,r,n){var a=t.getUTCHours(),o;switch(a===12?o=Su.noon:a===0?o=Su.midnight:o=a/12>=1?"pm":"am",r){case"b":case"bb":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},B:function(t,r,n){var a=t.getUTCHours(),o;switch(a>=17?o=Su.evening:a>=12?o=Su.afternoon:a>=4?o=Su.morning:o=Su.night,r){case"B":case"BB":case"BBB":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},h:function(t,r,n){if(r==="ho"){var a=t.getUTCHours()%12;return a===0&&(a=12),n.ordinalNumber(a,{unit:"hour"})}return Ul.h(t,r)},H:function(t,r,n){return r==="Ho"?n.ordinalNumber(t.getUTCHours(),{unit:"hour"}):Ul.H(t,r)},K:function(t,r,n){var a=t.getUTCHours()%12;return r==="Ko"?n.ordinalNumber(a,{unit:"hour"}):Yr(a,r.length)},k:function(t,r,n){var a=t.getUTCHours();return a===0&&(a=24),r==="ko"?n.ordinalNumber(a,{unit:"hour"}):Yr(a,r.length)},m:function(t,r,n){return r==="mo"?n.ordinalNumber(t.getUTCMinutes(),{unit:"minute"}):Ul.m(t,r)},s:function(t,r,n){return r==="so"?n.ordinalNumber(t.getUTCSeconds(),{unit:"second"}):Ul.s(t,r)},S:function(t,r){return Ul.S(t,r)},X:function(t,r,n,a){var o=a._originalDate||t,s=o.getTimezoneOffset();if(s===0)return"Z";switch(r){case"X":return CE(s);case"XXXX":case"XX":return kc(s);case"XXXXX":case"XXX":default:return kc(s,":")}},x:function(t,r,n,a){var o=a._originalDate||t,s=o.getTimezoneOffset();switch(r){case"x":return CE(s);case"xxxx":case"xx":return kc(s);case"xxxxx":case"xxx":default:return kc(s,":")}},O:function(t,r,n,a){var o=a._originalDate||t,s=o.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+SE(s,":");case"OOOO":default:return"GMT"+kc(s,":")}},z:function(t,r,n,a){var o=a._originalDate||t,s=o.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+SE(s,":");case"zzzz":default:return"GMT"+kc(s,":")}},t:function(t,r,n,a){var o=a._originalDate||t,s=Math.floor(o.getTime()/1e3);return Yr(s,r.length)},T:function(t,r,n,a){var o=a._originalDate||t,s=o.getTime();return Yr(s,r.length)}};function SE(e,t){var r=e>0?"-":"+",n=Math.abs(e),a=Math.floor(n/60),o=n%60;if(o===0)return r+String(a);var s=t;return r+String(a)+s+Yr(o,2)}function CE(e,t){if(e%60===0){var r=e>0?"-":"+";return r+Yr(Math.abs(e)/60,2)}return kc(e,t)}function kc(e,t){var r=t||"",n=e>0?"-":"+",a=Math.abs(e),o=Yr(Math.floor(a/60),2),s=Yr(a%60,2);return n+o+r+s}var AE=function(t,r){switch(t){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},h6=function(t,r){switch(t){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},Bie=function(t,r){var n=t.match(/(P+)(p+)?/)||[],a=n[1],o=n[2];if(!o)return AE(t,r);var s;switch(a){case"P":s=r.dateTime({width:"short"});break;case"PP":s=r.dateTime({width:"medium"});break;case"PPP":s=r.dateTime({width:"long"});break;case"PPPP":default:s=r.dateTime({width:"full"});break}return s.replace("{{date}}",AE(a,r)).replace("{{time}}",h6(o,r))},jw={p:h6,P:Bie},Uie=["D","DD"],zie=["YY","YYYY"];function p6(e){return Uie.indexOf(e)!==-1}function m6(e){return zie.indexOf(e)!==-1}function gv(e,t,r){if(e==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var Wie={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Hie=function(t,r,n){var a,o=Wie[t];return typeof o=="string"?a=o:r===1?a=o.one:a=o.other.replace("{{count}}",r.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+a:a+" ago":a};function v2(e){return function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.width?String(t.width):e.defaultWidth,n=e.formats[r]||e.formats[e.defaultWidth];return n}}var Vie={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Gie={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Yie={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Kie={date:v2({formats:Vie,defaultWidth:"full"}),time:v2({formats:Gie,defaultWidth:"full"}),dateTime:v2({formats:Yie,defaultWidth:"full"})},Qie={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Xie=function(t,r,n,a){return Qie[t]};function Nf(e){return function(t,r){var n=r!=null&&r.context?String(r.context):"standalone",a;if(n==="formatting"&&e.formattingValues){var o=e.defaultFormattingWidth||e.defaultWidth,s=r!=null&&r.width?String(r.width):o;a=e.formattingValues[s]||e.formattingValues[o]}else{var l=e.defaultWidth,c=r!=null&&r.width?String(r.width):e.defaultWidth;a=e.values[c]||e.values[l]}var u=e.argumentCallback?e.argumentCallback(t):t;return a[u]}}var Jie={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Zie={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},eoe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},toe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},roe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},noe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},aoe=function(t,r){var n=Number(t),a=n%100;if(a>20||a<10)switch(a%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},ioe={ordinalNumber:aoe,era:Nf({values:Jie,defaultWidth:"wide"}),quarter:Nf({values:Zie,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:Nf({values:eoe,defaultWidth:"wide"}),day:Nf({values:toe,defaultWidth:"wide"}),dayPeriod:Nf({values:roe,defaultWidth:"wide",formattingValues:noe,defaultFormattingWidth:"wide"})};function Df(e){return function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=r.width,a=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],o=t.match(a);if(!o)return null;var s=o[0],l=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(l)?soe(l,function(f){return f.test(s)}):ooe(l,function(f){return f.test(s)}),u;u=e.valueCallback?e.valueCallback(c):c,u=r.valueCallback?r.valueCallback(u):u;var d=t.slice(s.length);return{value:u,rest:d}}}function ooe(e,t){for(var r in e)if(e.hasOwnProperty(r)&&t(e[r]))return r}function soe(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return r}function loe(e){return function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.match(e.matchPattern);if(!n)return null;var a=n[0],o=t.match(e.parsePattern);if(!o)return null;var s=e.valueCallback?e.valueCallback(o[0]):o[0];s=r.valueCallback?r.valueCallback(s):s;var l=t.slice(a.length);return{value:s,rest:l}}}var coe=/^(\d+)(th|st|nd|rd)?/i,uoe=/\d+/i,doe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},foe={any:[/^b/i,/^(a|c)/i]},hoe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},poe={any:[/1/i,/2/i,/3/i,/4/i]},moe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},goe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},voe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},yoe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},xoe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},boe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},_oe={ordinalNumber:loe({matchPattern:coe,parsePattern:uoe,valueCallback:function(t){return parseInt(t,10)}}),era:Df({matchPatterns:doe,defaultMatchWidth:"wide",parsePatterns:foe,defaultParseWidth:"any"}),quarter:Df({matchPatterns:hoe,defaultMatchWidth:"wide",parsePatterns:poe,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:Df({matchPatterns:moe,defaultMatchWidth:"wide",parsePatterns:goe,defaultParseWidth:"any"}),day:Df({matchPatterns:voe,defaultMatchWidth:"wide",parsePatterns:yoe,defaultParseWidth:"any"}),dayPeriod:Df({matchPatterns:xoe,defaultMatchWidth:"any",parsePatterns:boe,defaultParseWidth:"any"})},Ny={code:"en-US",formatDistance:Hie,formatLong:Kie,formatRelative:Xie,localize:ioe,match:_oe,options:{weekStartsOn:0,firstWeekContainsDate:1}},woe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,joe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Soe=/^'([^]*?)'?$/,Coe=/''/g,Aoe=/[a-zA-Z]/;function Ru(e,t,r){var n,a,o,s,l,c,u,d,f,h,p,g,m,x,b,_,w,A;Ft(2,arguments);var O=String(t),T=cs(),E=(n=(a=r?.locale)!==null&&a!==void 0?a:T.locale)!==null&&n!==void 0?n:Ny,S=sn((o=(s=(l=(c=r?.firstWeekContainsDate)!==null&&c!==void 0?c:r==null||(u=r.locale)===null||u===void 0||(d=u.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&l!==void 0?l:T.firstWeekContainsDate)!==null&&s!==void 0?s:(f=T.locale)===null||f===void 0||(h=f.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&o!==void 0?o:1);if(!(S>=1&&S<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var I=sn((p=(g=(m=(x=r?.weekStartsOn)!==null&&x!==void 0?x:r==null||(b=r.locale)===null||b===void 0||(_=b.options)===null||_===void 0?void 0:_.weekStartsOn)!==null&&m!==void 0?m:T.weekStartsOn)!==null&&g!==void 0?g:(w=T.locale)===null||w===void 0||(A=w.options)===null||A===void 0?void 0:A.weekStartsOn)!==null&&p!==void 0?p:0);if(!(I>=0&&I<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!E.localize)throw new RangeError("locale must contain localize property");if(!E.formatLong)throw new RangeError("locale must contain formatLong property");var z=qt(e);if(!o6(z))throw new RangeError("Invalid time value");var k=Ad(z),M=c6(z,k),R={firstWeekContainsDate:S,weekStartsOn:I,locale:E,_originalDate:z},F=O.match(joe).map(function(W){var K=W[0];if(K==="p"||K==="P"){var Z=jw[K];return Z(W,E.formatLong)}return W}).join("").match(woe).map(function(W){if(W==="''")return"'";var K=W[0];if(K==="'")return Poe(W);var Z=$ie[K];if(Z)return!(r!=null&&r.useAdditionalWeekYearTokens)&&m6(W)&&gv(W,t,String(e)),!(r!=null&&r.useAdditionalDayOfYearTokens)&&p6(W)&&gv(W,t,String(e)),Z(M,W,E.localize,R);if(K.match(Aoe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+K+"`");return W}).join("");return F}function Poe(e){var t=e.match(Soe);return t?t[1].replace(Coe,"'"):e}function vS(e,t){if(e==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}function Ooe(e){return vS({},e)}var PE=1e3*60,vv=60*24,OE=vv*30,kE=vv*365;function koe(e,t,r){var n,a,o;Ft(2,arguments);var s=cs(),l=(n=(a=r?.locale)!==null&&a!==void 0?a:s.locale)!==null&&n!==void 0?n:Ny;if(!l.formatDistance)throw new RangeError("locale must contain localize.formatDistance property");var c=Yu(e,t);if(isNaN(c))throw new RangeError("Invalid time value");var u=vS(Ooe(r),{addSuffix:!!r?.addSuffix,comparison:c}),d,f;c>0?(d=qt(t),f=qt(e)):(d=qt(e),f=qt(t));var h=String((o=r?.roundingMethod)!==null&&o!==void 0?o:"round"),p;if(h==="floor")p=Math.floor;else if(h==="ceil")p=Math.ceil;else if(h==="round")p=Math.round;else throw new RangeError("roundingMethod must be 'floor', 'ceil' or 'round'");var g=f.getTime()-d.getTime(),m=g/PE,x=Ad(f)-Ad(d),b=(g-x)/PE,_=r?.unit,w;if(_?w=String(_):m<1?w="second":m<60?w="minute":m<vv?w="hour":b<OE?w="day":b<kE?w="month":w="year",w==="second"){var A=p(g/1e3);return l.formatDistance("xSeconds",A,u)}else if(w==="minute"){var O=p(m);return l.formatDistance("xMinutes",O,u)}else if(w==="hour"){var T=p(m/60);return l.formatDistance("xHours",T,u)}else if(w==="day"){var E=p(b/vv);return l.formatDistance("xDays",E,u)}else if(w==="month"){var S=p(b/OE);return S===12&&_!=="month"?l.formatDistance("xYears",1,u):l.formatDistance("xMonths",S,u)}else if(w==="year"){var I=p(b/kE);return l.formatDistance("xYears",I,u)}throw new RangeError("unit must be 'second', 'minute', 'hour', 'day', 'month' or 'year'")}function Toe(e,t){return Ft(1,arguments),koe(e,Date.now(),t)}function Eoe(e,t){var r,n;Ft(1,arguments);var a=qt(e);if(isNaN(a.getTime()))throw new RangeError("Invalid time value");var o=String((r=t?.format)!==null&&r!==void 0?r:"extended"),s=String((n=t?.representation)!==null&&n!==void 0?n:"complete");if(o!=="extended"&&o!=="basic")throw new RangeError("format must be 'extended' or 'basic'");if(s!=="date"&&s!=="time"&&s!=="complete")throw new RangeError("representation must be 'date', 'time', or 'complete'");var l="",c="",u=o==="extended"?"-":"",d=o==="extended"?":":"";if(s!=="time"){var f=Yr(a.getDate(),2),h=Yr(a.getMonth()+1,2),p=Yr(a.getFullYear(),4);l="".concat(p).concat(u).concat(h).concat(u).concat(f)}if(s!=="date"){var g=a.getTimezoneOffset();if(g!==0){var m=Math.abs(g),x=Yr(Math.floor(m/60),2),b=Yr(m%60,2),_=g<0?"+":"-";c="".concat(_).concat(x,":").concat(b)}else c="Z";var w=Yr(a.getHours(),2),A=Yr(a.getMinutes(),2),O=Yr(a.getSeconds(),2),T=l===""?"":"T",E=[w,A,O].join(d);l="".concat(l).concat(T).concat(E).concat(c)}return l}function Ioe(e){Ft(1,arguments);var t=qt(e),r=t.getDate();return r}function g6(e){Ft(1,arguments);var t=qt(e),r=t.getFullYear(),n=t.getMonth(),a=new Date(0);return a.setFullYear(r,n+1,0),a.setHours(0,0,0,0),a.getDate()}function Noe(e){Ft(1,arguments);var t=qt(e),r=t.getHours();return r}function Doe(e){Ft(1,arguments);var t=qt(e),r=t.getMilliseconds();return r}function Moe(e){Ft(1,arguments);var t=qt(e),r=t.getMinutes();return r}function Loe(e){Ft(1,arguments);var t=qt(e),r=t.getMonth();return r}function Roe(e){Ft(1,arguments);var t=qt(e),r=t.getSeconds();return r}function qoe(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=qt(e),f=d.getFullYear(),h=cs(),p=sn((r=(n=(a=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&a!==void 0?a:h.firstWeekContainsDate)!==null&&n!==void 0?n:(c=h.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&r!==void 0?r:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var g=new Date(0);g.setFullYear(f+1,0,p),g.setHours(0,0,0,0);var m=zc(g,t),x=new Date(0);x.setFullYear(f,0,p),x.setHours(0,0,0,0);var b=zc(x,t);return d.getTime()>=m.getTime()?f+1:d.getTime()>=b.getTime()?f:f-1}function Foe(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=cs(),f=sn((r=(n=(a=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&a!==void 0?a:d.firstWeekContainsDate)!==null&&n!==void 0?n:(c=d.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&r!==void 0?r:1),h=qoe(e,t),p=new Date(0);p.setFullYear(h,0,f),p.setHours(0,0,0,0);var g=zc(p,t);return g}var $oe=6048e5;function Boe(e,t){Ft(1,arguments);var r=qt(e),n=zc(r,t).getTime()-Foe(r,t).getTime();return Math.round(n/$oe)+1}function Uoe(e){return Ft(1,arguments),qt(e).getFullYear()}function y2(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getTime()>n.getTime()}function Mf(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getTime()<n.getTime()}function zoe(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getTime()===n.getTime()}function TE(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Woe(e,t){if(e){if(typeof e=="string")return TE(e,t);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?TE(e,t):void 0}}function EE(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Woe(e))||t){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var u=r.next();return s=u.done,u},e:function(u){l=!0,o=u},f:function(){try{s||r.return==null||r.return()}finally{if(l)throw o}}}}function ln(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&S8(e,t)}function yv(e){return yv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},yv(e)}function v6(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(v6=function(){return!!e})()}function Hoe(e,t){if(t&&(xn(t)=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Xt(e)}function cn(e){var t=v6();return function(){var r,n=yv(e);if(t){var a=yv(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Hoe(this,r)}}function Zr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Voe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,EI(n.key),n)}}function en(e,t,r){return t&&Voe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Kt(e,t,r){return(t=EI(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Goe=10,y6=function(){function e(){Zr(this,e),Kt(this,"priority",void 0),Kt(this,"subPriority",0)}return en(e,[{key:"validate",value:function(r,n){return!0}}]),e}(),Yoe=function(e){ln(r,e);var t=cn(r);function r(n,a,o,s,l){var c;return Zr(this,r),c=t.call(this),c.value=n,c.validateValue=a,c.setValue=o,c.priority=s,l&&(c.subPriority=l),c}return en(r,[{key:"validate",value:function(a,o){return this.validateValue(a,this.value,o)}},{key:"set",value:function(a,o,s){return this.setValue(a,o,this.value,s)}}]),r}(y6),Koe=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",Goe),Kt(Xt(n),"subPriority",-1),n}return en(r,[{key:"set",value:function(a,o){if(o.timestampIsSet)return a;var s=new Date(0);return s.setFullYear(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()),s.setHours(a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),s}}]),r}(y6),bn=function(){function e(){Zr(this,e),Kt(this,"incompatibleTokens",void 0),Kt(this,"priority",void 0),Kt(this,"subPriority",void 0)}return en(e,[{key:"run",value:function(r,n,a,o){var s=this.parse(r,n,a,o);return s?{setter:new Yoe(s.value,this.validate,this.set,this.priority,this.subPriority),rest:s.rest}:null}},{key:"validate",value:function(r,n,a){return!0}}]),e}(),Qoe=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",140),Kt(Xt(n),"incompatibleTokens",["R","u","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"G":case"GG":case"GGG":return s.era(a,{width:"abbreviated"})||s.era(a,{width:"narrow"});case"GGGGG":return s.era(a,{width:"narrow"});case"GGGG":default:return s.era(a,{width:"wide"})||s.era(a,{width:"abbreviated"})||s.era(a,{width:"narrow"})}}},{key:"set",value:function(a,o,s){return o.era=s,a.setUTCFullYear(s,0,1),a.setUTCHours(0,0,0,0),a}}]),r}(bn),Aa={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},bs={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function Pa(e,t){return e&&{value:t(e.value),rest:e.rest}}function ia(e,t){var r=t.match(e);return r?{value:parseInt(r[0],10),rest:t.slice(r[0].length)}:null}function _s(e,t){var r=t.match(e);if(!r)return null;if(r[0]==="Z")return{value:0,rest:t.slice(1)};var n=r[1]==="+"?1:-1,a=r[2]?parseInt(r[2],10):0,o=r[3]?parseInt(r[3],10):0,s=r[5]?parseInt(r[5],10):0;return{value:n*(a*Ey+o*Ty+s*bie),rest:t.slice(r[0].length)}}function x6(e){return ia(Aa.anyDigitsSigned,e)}function ya(e,t){switch(e){case 1:return ia(Aa.singleDigit,t);case 2:return ia(Aa.twoDigits,t);case 3:return ia(Aa.threeDigits,t);case 4:return ia(Aa.fourDigits,t);default:return ia(new RegExp("^\\d{1,"+e+"}"),t)}}function xv(e,t){switch(e){case 1:return ia(Aa.singleDigitSigned,t);case 2:return ia(Aa.twoDigitsSigned,t);case 3:return ia(Aa.threeDigitsSigned,t);case 4:return ia(Aa.fourDigitsSigned,t);default:return ia(new RegExp("^-?\\d{1,"+e+"}"),t)}}function yS(e){switch(e){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function b6(e,t){var r=t>0,n=r?t:1-t,a;if(n<=50)a=e||100;else{var o=n+50,s=Math.floor(o/100)*100,l=e>=o%100;a=e+s-(l?100:0)}return r?a:1-a}function _6(e){return e%400===0||e%4===0&&e%100!==0}var Xoe=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",130),Kt(Xt(n),"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){var l=function(u){return{year:u,isTwoDigitYear:o==="yy"}};switch(o){case"y":return Pa(ya(4,a),l);case"yo":return Pa(s.ordinalNumber(a,{unit:"year"}),l);default:return Pa(ya(o.length,a),l)}}},{key:"validate",value:function(a,o){return o.isTwoDigitYear||o.year>0}},{key:"set",value:function(a,o,s){var l=a.getUTCFullYear();if(s.isTwoDigitYear){var c=b6(s.year,l);return a.setUTCFullYear(c,0,1),a.setUTCHours(0,0,0,0),a}var u=!("era"in o)||o.era===1?s.year:1-s.year;return a.setUTCFullYear(u,0,1),a.setUTCHours(0,0,0,0),a}}]),r}(bn),Joe=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",130),Kt(Xt(n),"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){var l=function(u){return{year:u,isTwoDigitYear:o==="YY"}};switch(o){case"Y":return Pa(ya(4,a),l);case"Yo":return Pa(s.ordinalNumber(a,{unit:"year"}),l);default:return Pa(ya(o.length,a),l)}}},{key:"validate",value:function(a,o){return o.isTwoDigitYear||o.year>0}},{key:"set",value:function(a,o,s,l){var c=gS(a,l);if(s.isTwoDigitYear){var u=b6(s.year,c);return a.setUTCFullYear(u,0,l.firstWeekContainsDate),a.setUTCHours(0,0,0,0),ru(a,l)}var d=!("era"in o)||o.era===1?s.year:1-s.year;return a.setUTCFullYear(d,0,l.firstWeekContainsDate),a.setUTCHours(0,0,0,0),ru(a,l)}}]),r}(bn),Zoe=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",130),Kt(Xt(n),"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o){return xv(o==="R"?4:o.length,a)}},{key:"set",value:function(a,o,s){var l=new Date(0);return l.setUTCFullYear(s,0,4),l.setUTCHours(0,0,0,0),Od(l)}}]),r}(bn),ese=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",130),Kt(Xt(n),"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o){return xv(o==="u"?4:o.length,a)}},{key:"set",value:function(a,o,s){return a.setUTCFullYear(s,0,1),a.setUTCHours(0,0,0,0),a}}]),r}(bn),tse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",120),Kt(Xt(n),"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"Q":case"QQ":return ya(o.length,a);case"Qo":return s.ordinalNumber(a,{unit:"quarter"});case"QQQ":return s.quarter(a,{width:"abbreviated",context:"formatting"})||s.quarter(a,{width:"narrow",context:"formatting"});case"QQQQQ":return s.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(a,{width:"wide",context:"formatting"})||s.quarter(a,{width:"abbreviated",context:"formatting"})||s.quarter(a,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(a,o){return o>=1&&o<=4}},{key:"set",value:function(a,o,s){return a.setUTCMonth((s-1)*3,1),a.setUTCHours(0,0,0,0),a}}]),r}(bn),rse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",120),Kt(Xt(n),"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"q":case"qq":return ya(o.length,a);case"qo":return s.ordinalNumber(a,{unit:"quarter"});case"qqq":return s.quarter(a,{width:"abbreviated",context:"standalone"})||s.quarter(a,{width:"narrow",context:"standalone"});case"qqqqq":return s.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(a,{width:"wide",context:"standalone"})||s.quarter(a,{width:"abbreviated",context:"standalone"})||s.quarter(a,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(a,o){return o>=1&&o<=4}},{key:"set",value:function(a,o,s){return a.setUTCMonth((s-1)*3,1),a.setUTCHours(0,0,0,0),a}}]),r}(bn),nse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]),Kt(Xt(n),"priority",110),n}return en(r,[{key:"parse",value:function(a,o,s){var l=function(u){return u-1};switch(o){case"M":return Pa(ia(Aa.month,a),l);case"MM":return Pa(ya(2,a),l);case"Mo":return Pa(s.ordinalNumber(a,{unit:"month"}),l);case"MMM":return s.month(a,{width:"abbreviated",context:"formatting"})||s.month(a,{width:"narrow",context:"formatting"});case"MMMMM":return s.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(a,{width:"wide",context:"formatting"})||s.month(a,{width:"abbreviated",context:"formatting"})||s.month(a,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(a,o){return o>=0&&o<=11}},{key:"set",value:function(a,o,s){return a.setUTCMonth(s,1),a.setUTCHours(0,0,0,0),a}}]),r}(bn),ase=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",110),Kt(Xt(n),"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){var l=function(u){return u-1};switch(o){case"L":return Pa(ia(Aa.month,a),l);case"LL":return Pa(ya(2,a),l);case"Lo":return Pa(s.ordinalNumber(a,{unit:"month"}),l);case"LLL":return s.month(a,{width:"abbreviated",context:"standalone"})||s.month(a,{width:"narrow",context:"standalone"});case"LLLLL":return s.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(a,{width:"wide",context:"standalone"})||s.month(a,{width:"abbreviated",context:"standalone"})||s.month(a,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(a,o){return o>=0&&o<=11}},{key:"set",value:function(a,o,s){return a.setUTCMonth(s,1),a.setUTCHours(0,0,0,0),a}}]),r}(bn);function ise(e,t,r){Ft(2,arguments);var n=qt(e),a=sn(t),o=f6(n,r)-a;return n.setUTCDate(n.getUTCDate()-o*7),n}var ose=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",100),Kt(Xt(n),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"w":return ia(Aa.week,a);case"wo":return s.ordinalNumber(a,{unit:"week"});default:return ya(o.length,a)}}},{key:"validate",value:function(a,o){return o>=1&&o<=53}},{key:"set",value:function(a,o,s,l){return ru(ise(a,s,l),l)}}]),r}(bn);function sse(e,t){Ft(2,arguments);var r=qt(e),n=sn(t),a=d6(r)-n;return r.setUTCDate(r.getUTCDate()-a*7),r}var lse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",100),Kt(Xt(n),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"I":return ia(Aa.week,a);case"Io":return s.ordinalNumber(a,{unit:"week"});default:return ya(o.length,a)}}},{key:"validate",value:function(a,o){return o>=1&&o<=53}},{key:"set",value:function(a,o,s){return Od(sse(a,s))}}]),r}(bn),cse=[31,28,31,30,31,30,31,31,30,31,30,31],use=[31,29,31,30,31,30,31,31,30,31,30,31],dse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",90),Kt(Xt(n),"subPriority",1),Kt(Xt(n),"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"d":return ia(Aa.date,a);case"do":return s.ordinalNumber(a,{unit:"date"});default:return ya(o.length,a)}}},{key:"validate",value:function(a,o){var s=a.getUTCFullYear(),l=_6(s),c=a.getUTCMonth();return l?o>=1&&o<=use[c]:o>=1&&o<=cse[c]}},{key:"set",value:function(a,o,s){return a.setUTCDate(s),a.setUTCHours(0,0,0,0),a}}]),r}(bn),fse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",90),Kt(Xt(n),"subpriority",1),Kt(Xt(n),"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"D":case"DD":return ia(Aa.dayOfYear,a);case"Do":return s.ordinalNumber(a,{unit:"date"});default:return ya(o.length,a)}}},{key:"validate",value:function(a,o){var s=a.getUTCFullYear(),l=_6(s);return l?o>=1&&o<=366:o>=1&&o<=365}},{key:"set",value:function(a,o,s){return a.setUTCMonth(0,s),a.setUTCHours(0,0,0,0),a}}]),r}(bn);function xS(e,t,r){var n,a,o,s,l,c,u,d;Ft(2,arguments);var f=cs(),h=sn((n=(a=(o=(s=r?.weekStartsOn)!==null&&s!==void 0?s:r==null||(l=r.locale)===null||l===void 0||(c=l.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&o!==void 0?o:f.weekStartsOn)!==null&&a!==void 0?a:(u=f.locale)===null||u===void 0||(d=u.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&n!==void 0?n:0);if(!(h>=0&&h<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var p=qt(e),g=sn(t),m=p.getUTCDay(),x=g%7,b=(x+7)%7,_=(b<h?7:0)+g-m;return p.setUTCDate(p.getUTCDate()+_),p}var hse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",90),Kt(Xt(n),"incompatibleTokens",["D","i","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"E":case"EE":case"EEE":return s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"});case"EEEEE":return s.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"});case"EEEE":default:return s.day(a,{width:"wide",context:"formatting"})||s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(a,o){return o>=0&&o<=6}},{key:"set",value:function(a,o,s,l){return a=xS(a,s,l),a.setUTCHours(0,0,0,0),a}}]),r}(bn),pse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",90),Kt(Xt(n),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s,l){var c=function(d){var f=Math.floor((d-1)/7)*7;return(d+l.weekStartsOn+6)%7+f};switch(o){case"e":case"ee":return Pa(ya(o.length,a),c);case"eo":return Pa(s.ordinalNumber(a,{unit:"day"}),c);case"eee":return s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"});case"eeeee":return s.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"});case"eeee":default:return s.day(a,{width:"wide",context:"formatting"})||s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(a,o){return o>=0&&o<=6}},{key:"set",value:function(a,o,s,l){return a=xS(a,s,l),a.setUTCHours(0,0,0,0),a}}]),r}(bn),mse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",90),Kt(Xt(n),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s,l){var c=function(d){var f=Math.floor((d-1)/7)*7;return(d+l.weekStartsOn+6)%7+f};switch(o){case"c":case"cc":return Pa(ya(o.length,a),c);case"co":return Pa(s.ordinalNumber(a,{unit:"day"}),c);case"ccc":return s.day(a,{width:"abbreviated",context:"standalone"})||s.day(a,{width:"short",context:"standalone"})||s.day(a,{width:"narrow",context:"standalone"});case"ccccc":return s.day(a,{width:"narrow",context:"standalone"});case"cccccc":return s.day(a,{width:"short",context:"standalone"})||s.day(a,{width:"narrow",context:"standalone"});case"cccc":default:return s.day(a,{width:"wide",context:"standalone"})||s.day(a,{width:"abbreviated",context:"standalone"})||s.day(a,{width:"short",context:"standalone"})||s.day(a,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(a,o){return o>=0&&o<=6}},{key:"set",value:function(a,o,s,l){return a=xS(a,s,l),a.setUTCHours(0,0,0,0),a}}]),r}(bn);function gse(e,t){Ft(2,arguments);var r=sn(t);r%7===0&&(r=r-7);var n=1,a=qt(e),o=a.getUTCDay(),s=r%7,l=(s+7)%7,c=(l<n?7:0)+r-o;return a.setUTCDate(a.getUTCDate()+c),a}var vse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",90),Kt(Xt(n),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){var l=function(u){return u===0?7:u};switch(o){case"i":case"ii":return ya(o.length,a);case"io":return s.ordinalNumber(a,{unit:"day"});case"iii":return Pa(s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"}),l);case"iiiii":return Pa(s.day(a,{width:"narrow",context:"formatting"}),l);case"iiiiii":return Pa(s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"}),l);case"iiii":default:return Pa(s.day(a,{width:"wide",context:"formatting"})||s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"}),l)}}},{key:"validate",value:function(a,o){return o>=1&&o<=7}},{key:"set",value:function(a,o,s){return a=gse(a,s),a.setUTCHours(0,0,0,0),a}}]),r}(bn),yse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",80),Kt(Xt(n),"incompatibleTokens",["b","B","H","k","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"a":case"aa":case"aaa":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaaa":return s.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(a,{width:"wide",context:"formatting"})||s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(a,o,s){return a.setUTCHours(yS(s),0,0,0),a}}]),r}(bn),xse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",80),Kt(Xt(n),"incompatibleTokens",["a","B","H","k","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"b":case"bb":case"bbb":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbbb":return s.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(a,{width:"wide",context:"formatting"})||s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(a,o,s){return a.setUTCHours(yS(s),0,0,0),a}}]),r}(bn),bse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",80),Kt(Xt(n),"incompatibleTokens",["a","b","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"B":case"BB":case"BBB":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBBB":return s.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(a,{width:"wide",context:"formatting"})||s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(a,o,s){return a.setUTCHours(yS(s),0,0,0),a}}]),r}(bn),_se=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",70),Kt(Xt(n),"incompatibleTokens",["H","K","k","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"h":return ia(Aa.hour12h,a);case"ho":return s.ordinalNumber(a,{unit:"hour"});default:return ya(o.length,a)}}},{key:"validate",value:function(a,o){return o>=1&&o<=12}},{key:"set",value:function(a,o,s){var l=a.getUTCHours()>=12;return l&&s<12?a.setUTCHours(s+12,0,0,0):!l&&s===12?a.setUTCHours(0,0,0,0):a.setUTCHours(s,0,0,0),a}}]),r}(bn),wse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",70),Kt(Xt(n),"incompatibleTokens",["a","b","h","K","k","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"H":return ia(Aa.hour23h,a);case"Ho":return s.ordinalNumber(a,{unit:"hour"});default:return ya(o.length,a)}}},{key:"validate",value:function(a,o){return o>=0&&o<=23}},{key:"set",value:function(a,o,s){return a.setUTCHours(s,0,0,0),a}}]),r}(bn),jse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",70),Kt(Xt(n),"incompatibleTokens",["h","H","k","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"K":return ia(Aa.hour11h,a);case"Ko":return s.ordinalNumber(a,{unit:"hour"});default:return ya(o.length,a)}}},{key:"validate",value:function(a,o){return o>=0&&o<=11}},{key:"set",value:function(a,o,s){var l=a.getUTCHours()>=12;return l&&s<12?a.setUTCHours(s+12,0,0,0):a.setUTCHours(s,0,0,0),a}}]),r}(bn),Sse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",70),Kt(Xt(n),"incompatibleTokens",["a","b","h","H","K","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"k":return ia(Aa.hour24h,a);case"ko":return s.ordinalNumber(a,{unit:"hour"});default:return ya(o.length,a)}}},{key:"validate",value:function(a,o){return o>=1&&o<=24}},{key:"set",value:function(a,o,s){var l=s<=24?s%24:s;return a.setUTCHours(l,0,0,0),a}}]),r}(bn),Cse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",60),Kt(Xt(n),"incompatibleTokens",["t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"m":return ia(Aa.minute,a);case"mo":return s.ordinalNumber(a,{unit:"minute"});default:return ya(o.length,a)}}},{key:"validate",value:function(a,o){return o>=0&&o<=59}},{key:"set",value:function(a,o,s){return a.setUTCMinutes(s,0,0),a}}]),r}(bn),Ase=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",50),Kt(Xt(n),"incompatibleTokens",["t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"s":return ia(Aa.second,a);case"so":return s.ordinalNumber(a,{unit:"second"});default:return ya(o.length,a)}}},{key:"validate",value:function(a,o){return o>=0&&o<=59}},{key:"set",value:function(a,o,s){return a.setUTCSeconds(s,0),a}}]),r}(bn),Pse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",30),Kt(Xt(n),"incompatibleTokens",["t","T"]),n}return en(r,[{key:"parse",value:function(a,o){var s=function(c){return Math.floor(c*Math.pow(10,-o.length+3))};return Pa(ya(o.length,a),s)}},{key:"set",value:function(a,o,s){return a.setUTCMilliseconds(s),a}}]),r}(bn),Ose=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",10),Kt(Xt(n),"incompatibleTokens",["t","T","x"]),n}return en(r,[{key:"parse",value:function(a,o){switch(o){case"X":return _s(bs.basicOptionalMinutes,a);case"XX":return _s(bs.basic,a);case"XXXX":return _s(bs.basicOptionalSeconds,a);case"XXXXX":return _s(bs.extendedOptionalSeconds,a);case"XXX":default:return _s(bs.extended,a)}}},{key:"set",value:function(a,o,s){return o.timestampIsSet?a:new Date(a.getTime()-s)}}]),r}(bn),kse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",10),Kt(Xt(n),"incompatibleTokens",["t","T","X"]),n}return en(r,[{key:"parse",value:function(a,o){switch(o){case"x":return _s(bs.basicOptionalMinutes,a);case"xx":return _s(bs.basic,a);case"xxxx":return _s(bs.basicOptionalSeconds,a);case"xxxxx":return _s(bs.extendedOptionalSeconds,a);case"xxx":default:return _s(bs.extended,a)}}},{key:"set",value:function(a,o,s){return o.timestampIsSet?a:new Date(a.getTime()-s)}}]),r}(bn),Tse=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",40),Kt(Xt(n),"incompatibleTokens","*"),n}return en(r,[{key:"parse",value:function(a){return x6(a)}},{key:"set",value:function(a,o,s){return[new Date(s*1e3),{timestampIsSet:!0}]}}]),r}(bn),Ese=function(e){ln(r,e);var t=cn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Kt(Xt(n),"priority",20),Kt(Xt(n),"incompatibleTokens","*"),n}return en(r,[{key:"parse",value:function(a){return x6(a)}},{key:"set",value:function(a,o,s){return[new Date(s),{timestampIsSet:!0}]}}]),r}(bn),Ise={G:new Qoe,y:new Xoe,Y:new Joe,R:new Zoe,u:new ese,Q:new tse,q:new rse,M:new nse,L:new ase,w:new ose,I:new lse,d:new dse,D:new fse,E:new hse,e:new pse,c:new mse,i:new vse,a:new yse,b:new xse,B:new bse,h:new _se,H:new wse,K:new jse,k:new Sse,m:new Cse,s:new Ase,S:new Pse,X:new Ose,x:new kse,t:new Tse,T:new Ese},Nse=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Dse=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Mse=/^'([^]*?)'?$/,Lse=/''/g,Rse=/\S/,qse=/[a-zA-Z]/;function Fse(e,t,r,n){var a,o,s,l,c,u,d,f,h,p,g,m,x,b,_,w,A,O;Ft(3,arguments);var T=String(e),E=String(t),S=cs(),I=(a=(o=n?.locale)!==null&&o!==void 0?o:S.locale)!==null&&a!==void 0?a:Ny;if(!I.match)throw new RangeError("locale must contain match property");var z=sn((s=(l=(c=(u=n?.firstWeekContainsDate)!==null&&u!==void 0?u:n==null||(d=n.locale)===null||d===void 0||(f=d.options)===null||f===void 0?void 0:f.firstWeekContainsDate)!==null&&c!==void 0?c:S.firstWeekContainsDate)!==null&&l!==void 0?l:(h=S.locale)===null||h===void 0||(p=h.options)===null||p===void 0?void 0:p.firstWeekContainsDate)!==null&&s!==void 0?s:1);if(!(z>=1&&z<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var k=sn((g=(m=(x=(b=n?.weekStartsOn)!==null&&b!==void 0?b:n==null||(_=n.locale)===null||_===void 0||(w=_.options)===null||w===void 0?void 0:w.weekStartsOn)!==null&&x!==void 0?x:S.weekStartsOn)!==null&&m!==void 0?m:(A=S.locale)===null||A===void 0||(O=A.options)===null||O===void 0?void 0:O.weekStartsOn)!==null&&g!==void 0?g:0);if(!(k>=0&&k<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(E==="")return T===""?qt(r):new Date(NaN);var M={firstWeekContainsDate:z,weekStartsOn:k,locale:I},R=[new Koe],F=E.match(Dse).map(function(oe){var ae=oe[0];if(ae in jw){var he=jw[ae];return he(oe,I.formatLong)}return oe}).join("").match(Nse),W=[],K=EE(F),Z;try{var D=function(){var ae=Z.value;!(n!=null&&n.useAdditionalWeekYearTokens)&&m6(ae)&&gv(ae,E,e),!(n!=null&&n.useAdditionalDayOfYearTokens)&&p6(ae)&&gv(ae,E,e);var he=ae[0],me=Ise[he];if(me){var X=me.incompatibleTokens;if(Array.isArray(X)){var G=W.find(function(se){return X.includes(se.token)||se.token===he});if(G)throw new RangeError("The format string mustn't contain `".concat(G.fullToken,"` and `").concat(ae,"` at the same time"))}else if(me.incompatibleTokens==="*"&&W.length>0)throw new RangeError("The format string mustn't contain `".concat(ae,"` and any other token at the same time"));W.push({token:he,fullToken:ae});var ee=me.run(T,ae,I.match,M);if(!ee)return{v:new Date(NaN)};R.push(ee.setter),T=ee.rest}else{if(he.match(qse))throw new RangeError("Format string contains an unescaped latin alphabet character `"+he+"`");if(ae==="''"?ae="'":he==="'"&&(ae=$se(ae)),T.indexOf(ae)===0)T=T.slice(ae.length);else return{v:new Date(NaN)}}};for(K.s();!(Z=K.n()).done;){var P=D();if(xn(P)==="object")return P.v}}catch(oe){K.e(oe)}finally{K.f()}if(T.length>0&&Rse.test(T))return new Date(NaN);var $=R.map(function(oe){return oe.priority}).sort(function(oe,ae){return ae-oe}).filter(function(oe,ae,he){return he.indexOf(oe)===ae}).map(function(oe){return R.filter(function(ae){return ae.priority===oe}).sort(function(ae,he){return he.subPriority-ae.subPriority})}).map(function(oe){return oe[0]}),Q=qt(r);if(isNaN(Q.getTime()))return new Date(NaN);var C=c6(Q,Ad(Q)),L={},H=EE($),U;try{for(H.s();!(U=H.n()).done;){var te=U.value;if(!te.validate(C,M))return new Date(NaN);var le=te.set(C,L,M);Array.isArray(le)?(C=le[0],vS(L,le[1])):C=le}}catch(oe){H.e(oe)}finally{H.f()}return C}function $se(e){return e.match(Mse)[1].replace(Lse,"'")}function IE(e){Ft(1,arguments);var t=qt(e);return t.setMinutes(0,0,0),t}function Bse(e,t){Ft(2,arguments);var r=IE(e),n=IE(t);return r.getTime()===n.getTime()}function Use(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getFullYear()===n.getFullYear()&&r.getMonth()===n.getMonth()}function zse(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getFullYear()===n.getFullYear()}function Wse(e,t){Ft(2,arguments);var r=qt(e).getTime(),n=qt(t.start).getTime(),a=qt(t.end).getTime();if(!(n<=a))throw new RangeError("Invalid interval");return r>=n&&r<=a}function Hse(e,t){var r;Ft(1,arguments);var n=sn((r=void 0)!==null&&r!==void 0?r:2);if(n!==2&&n!==1&&n!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var a=Kse(e),o;if(a.date){var s=Qse(a.date,n);o=Xse(s.restDateString,s.year)}if(!o||isNaN(o.getTime()))return new Date(NaN);var l=o.getTime(),c=0,u;if(a.time&&(c=Jse(a.time),isNaN(c)))return new Date(NaN);if(a.timezone){if(u=Zse(a.timezone),isNaN(u))return new Date(NaN)}else{var d=new Date(l+c),f=new Date(0);return f.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),f.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),f}return new Date(l+c+u)}var Dm={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Vse=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Gse=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Yse=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Kse(e){var t={},r=e.split(Dm.dateTimeDelimiter),n;if(r.length>2)return t;if(/:/.test(r[0])?n=r[0]:(t.date=r[0],n=r[1],Dm.timeZoneDelimiter.test(t.date)&&(t.date=e.split(Dm.timeZoneDelimiter)[0],n=e.substr(t.date.length,e.length))),n){var a=Dm.timezone.exec(n);a?(t.time=n.replace(a[1],""),t.timezone=a[1]):t.time=n}return t}function Qse(e,t){var r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=e.match(r);if(!n)return{year:NaN,restDateString:""};var a=n[1]?parseInt(n[1]):null,o=n[2]?parseInt(n[2]):null;return{year:o===null?a:o*100,restDateString:e.slice((n[1]||n[2]).length)}}function Xse(e,t){if(t===null)return new Date(NaN);var r=e.match(Vse);if(!r)return new Date(NaN);var n=!!r[4],a=Lf(r[1]),o=Lf(r[2])-1,s=Lf(r[3]),l=Lf(r[4]),c=Lf(r[5])-1;if(n)return ale(t,l,c)?ele(t,l,c):new Date(NaN);var u=new Date(0);return!rle(t,o,s)||!nle(t,a)?new Date(NaN):(u.setUTCFullYear(t,o,Math.max(a,s)),u)}function Lf(e){return e?parseInt(e):1}function Jse(e){var t=e.match(Gse);if(!t)return NaN;var r=x2(t[1]),n=x2(t[2]),a=x2(t[3]);return ile(r,n,a)?r*Ey+n*Ty+a*1e3:NaN}function x2(e){return e&&parseFloat(e.replace(",","."))||0}function Zse(e){if(e==="Z")return 0;var t=e.match(Yse);if(!t)return 0;var r=t[1]==="+"?-1:1,n=parseInt(t[2]),a=t[3]&&parseInt(t[3])||0;return ole(n,a)?r*(n*Ey+a*Ty):NaN}function ele(e,t,r){var n=new Date(0);n.setUTCFullYear(e,0,4);var a=n.getUTCDay()||7,o=(t-1)*7+r+1-a;return n.setUTCDate(n.getUTCDate()+o),n}var tle=[31,null,31,30,31,30,31,31,30,31,30,31];function w6(e){return e%400===0||e%4===0&&e%100!==0}function rle(e,t,r){return t>=0&&t<=11&&r>=1&&r<=(tle[t]||(w6(e)?29:28))}function nle(e,t){return t>=1&&t<=(w6(e)?366:365)}function ale(e,t,r){return t>=1&&t<=53&&r>=0&&r<=6}function ile(e,t,r){return e===24?t===0&&r===0:r>=0&&r<60&&t>=0&&t<60&&e>=0&&e<25}function ole(e,t){return t>=0&&t<=59}function sle(e,t){Ft(2,arguments);var r=qt(e),n=sn(t),a=r.getFullYear(),o=r.getDate(),s=new Date(0);s.setFullYear(a,n,15),s.setHours(0,0,0,0);var l=g6(s);return r.setMonth(n,Math.min(o,l)),r}function lle(e,t){Ft(2,arguments);var r=qt(e),n=sn(t);return r.setDate(n),r}function cle(e,t){Ft(2,arguments);var r=qt(e),n=sn(t);return r.setHours(n),r}function ule(e,t){Ft(2,arguments);var r=qt(e),n=sn(t);return r.setMilliseconds(n),r}function dle(e,t){Ft(2,arguments);var r=qt(e),n=sn(t);return r.setMinutes(n),r}function fle(e,t){Ft(2,arguments);var r=qt(e),n=sn(t);return r.setSeconds(n),r}function hle(e,t){Ft(2,arguments);var r=qt(e),n=sn(t);return isNaN(r.getTime())?new Date(NaN):(r.setFullYear(n),r)}const Oh=e=>{const t=(e??"").toString().trim().toLowerCase();return t==="approved"?"Approved":t==="rejected"?"Rejected":"Open"},NE=e=>{const t=Number(e);return isFinite(t)?new Intl.NumberFormat("en-CA",{maximumFractionDigits:0}).format(t):""},ple=()=>{const e=Nn(),[t,r]=y.useState([]),[n,a]=y.useState(""),[o,s]=y.useState("Open"),[l,c]=y.useState({page:0,pageSize:10}),[u,d]=y.useState(null),[f,h]=y.useState(null);y.useEffect(()=>{p()},[]);const p=async()=>{try{const E=((await ve.get("/api/quotes")).data||[]).map(S=>({...S,status:Oh(S.status)}));r(E)}catch(T){console.error("Error fetching quotes:",T),d("Failed to fetch quotes")}},g=async T=>{if(window.confirm("Are you sure you want to delete this quote?"))try{await ve.delete(`/api/quotes/${T}`),h("Quote deleted successfully"),p()}catch{d("Failed to delete quote")}},m=()=>{const T=t.map(k=>({"Quote #":k.quote_number,Customer:k.customer_name,Product:k.product_name,Make:k.vehicle_make||"",Model:k.vehicle_model||"","Est. Price":NE(k.estimated_cost),"Quote Date":k.quote_date?Ru(new Date(k.quote_date),"MM/dd/yyyy"):"","Valid Until":k.valid_until?Ru(new Date(k.valid_until),"MM/dd/yyyy"):"",Status:k.status})),E=Cl.unparse(T),S=new Blob([E],{type:"text/csv;charset=utf-8;"}),I=document.createElement("a"),z=URL.createObjectURL(S);I.setAttribute("href",z),I.setAttribute("download","quotes.csv"),I.style.visibility="hidden",document.body.appendChild(I),I.click(),document.body.removeChild(I)},x=n.toLowerCase(),b=y.useMemo(()=>{const T=t.filter(E=>E.status===o);return x?T.filter(E=>E.quote_number?.toLowerCase?.().includes(x)||E.customer_name?.toLowerCase?.().includes(x)||E.product_name?.toLowerCase?.().includes(x)||E.vehicle_make?.toLowerCase?.().includes(x)||E.vehicle_model?.toLowerCase?.().includes(x)):T},[t,o,x]),_=T=>{switch(T){case"Approved":return{backgroundColor:"rgba(76, 175, 80, 0.12)",color:"#2e7d32"};case"Rejected":return{backgroundColor:"rgba(244, 67, 54, 0.12)",color:"#c62828"};default:return{backgroundColor:"rgba(33, 150, 243, 0.12)",color:"#1565c0"}}},w=b.map(T=>({...T,id:T.quote_id})),A=[{field:"quote_number",headerName:"Quote #",flex:1.05,minWidth:150,valueFormatter:T=>T.value?String(T.value).replace("QO-",""):""},{field:"customer_name",headerName:"Customer",flex:1.2,minWidth:170},{field:"product_name",headerName:"Product",flex:1.1,minWidth:160},{field:"vehicle_make",headerName:"Make",flex:.9,minWidth:130},{field:"vehicle_model",headerName:"Model",flex:.9,minWidth:130},{field:"estimated_cost",headerName:"Est. Price",type:"number",flex:.8,minWidth:110,headerAlign:"left",align:"left",valueFormatter:T=>NE(T.value)},{field:"quote_date",headerName:"Quote Date",flex:.95,minWidth:130,valueFormatter:T=>T.value?Ru(new Date(T.value),"yyyy-MM-dd"):""},{field:"valid_until",headerName:"Valid Until",flex:.95,minWidth:130,valueFormatter:T=>T.value?Ru(new Date(T.value),"yyyy-MM-dd"):""},{field:"status",headerName:"Status",flex:.8,minWidth:130,sortable:!1,renderCell:T=>{const E=T.value,S=_(E);return i.jsx(ot,{label:E,size:"small",sx:{fontWeight:600,...S}})}},{field:"actions",headerName:"Actions",width:120,flex:0,sortable:!1,filterable:!1,disableColumnMenu:!0,renderCell:T=>i.jsx(J,{sx:{display:"flex",alignItems:"center"},children:i.jsx(En,{title:"Delete",children:i.jsx(pr,{size:"small",color:"error",onClick:E=>{E.stopPropagation();const S=T.row.quote_id;g(S)},children:i.jsx(ua,{})})})})}],O=T=>{const E=T.row;e(`/quotes/${E.quote_id}`)};return i.jsxs(ir,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(J,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Quotes"}),i.jsxs(ct,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[i.jsx(ye,{variant:"contained",startIcon:i.jsx(Ba,{}),onClick:()=>e("/quotes/new"),children:"New Quote"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(da,{}),onClick:m,children:"Export CSV"})]})]}),i.jsx(xt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(J,{sx:{p:2},children:[i.jsxs(ct,{direction:"row",spacing:3,sx:{mb:3},children:[i.jsx(Ae,{label:"Search",value:n,onChange:T=>a(T.target.value),InputProps:{startAdornment:i.jsx(oa,{position:"start",children:i.jsx(hi,{sx:{fontSize:32}})}),sx:{fontSize:22,height:56}},sx:{minWidth:340,maxWidth:400,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"medium",variant:"outlined"}),i.jsx(ot,{label:"Open",onClick:()=>s("Open"),color:o==="Open"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),i.jsx(ot,{label:"Approved",onClick:()=>s("Approved"),color:o==="Approved"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),i.jsx(ot,{label:"Rejected",onClick:()=>s("Rejected"),color:o==="Rejected"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}})]}),i.jsx(Po,{rows:w,columns:A,paginationModel:l,onPaginationModelChange:c,pageSizeOptions:[10,25,50],getRowId:T=>T.id,onRowClick:O,disableRowSelectionOnClick:!0,hideFooterSelectedRowCount:!0,initialState:{sorting:{sortModel:[{field:"quote_number",sort:"desc"}]}},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224,224,224,1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224,224,224,1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"},cursor:"pointer"}})]})}),i.jsx(pl,{open:!!f,autoHideDuration:6e3,onClose:()=>h(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>h(null),severity:"success",sx:{width:"100%"},children:f})}),i.jsx(pl,{open:!!u,autoHideDuration:6e3,onClose:()=>d(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>d(null),severity:"error",sx:{width:"100%"},children:u})})]})};var Rf={},DE;function mle(){if(DE)return Rf;DE=1;var e=cr();Object.defineProperty(Rf,"__esModule",{value:!0}),Rf.default=void 0;var t=e(dr()),r=ur();return Rf.default=(0,t.default)((0,r.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),Rf}var gle=mle();const Is=It(gle);var qf={},ME;function vle(){if(ME)return qf;ME=1;var e=cr();Object.defineProperty(qf,"__esModule",{value:!0}),qf.default=void 0;var t=e(dr()),r=ur();return qf.default=(0,t.default)((0,r.jsx)("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"}),"DoneAll"),qf}var yle=vle();const bv=It(yle);var Ff={},LE;function xle(){if(LE)return Ff;LE=1;var e=cr();Object.defineProperty(Ff,"__esModule",{value:!0}),Ff.default=void 0;var t=e(dr()),r=ur();return Ff.default=(0,t.default)((0,r.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Email"),Ff}var ble=xle();const bS=It(ble);var $f={},RE;function _le(){if(RE)return $f;RE=1;var e=cr();Object.defineProperty($f,"__esModule",{value:!0}),$f.default=void 0;var t=e(dr()),r=ur();return $f.default=(0,t.default)((0,r.jsx)("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"AddCircleOutline"),$f}var wle=_le();const ec=It(wle);var Bf={},qE;function jle(){if(qE)return Bf;qE=1;var e=cr();Object.defineProperty(Bf,"__esModule",{value:!0}),Bf.default=void 0;var t=e(dr()),r=ur();return Bf.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12m8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8"}),"Block"),Bf}var Sle=jle();const Cle=It(Sle);var Uf={},FE;function Ale(){if(FE)return Uf;FE=1;var e=cr();Object.defineProperty(Uf,"__esModule",{value:!0}),Uf.default=void 0;var t=e(dr()),r=ur();return Uf.default=(0,t.default)((0,r.jsx)("path",{d:"M10 10.02h5V21h-5zM17 21h3c1.1 0 2-.9 2-2v-9h-5zm3-18H5c-1.1 0-2 .9-2 2v3h19V5c0-1.1-.9-2-2-2M3 19c0 1.1.9 2 2 2h3V10H3z"}),"TableChart"),Uf}var Ple=Ale();const Sw=It(Ple),Ole="modulepreload",kle=function(e){return"/"+e},$E={},Cw=function(t,r,n){let a=Promise.resolve();if(r&&r.length>0){let c=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),l=s?.nonce||s?.getAttribute("nonce");a=c(r.map(u=>{if(u=kle(u),u in $E)return;$E[u]=!0;const d=u.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${f}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":Ole,d||(h.as="script"),h.crossOrigin="",h.href=u,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((p,g)=>{h.addEventListener("load",p),h.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(s){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s}return a.then(s=>{for(const l of s||[])l.status==="rejected"&&o(l.reason);return t().catch(o)})};var wi=Uint8Array,So=Uint16Array,_S=Int32Array,Dy=new wi([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),My=new wi([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Aw=new wi([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),j6=function(e,t){for(var r=new So(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var a=new _S(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)a[o]=o-r[n]<<5|n;return{b:r,r:a}},S6=j6(Dy,2),C6=S6.b,Pw=S6.r;C6[28]=258,Pw[258]=28;var A6=j6(My,0),Tle=A6.b,BE=A6.r,Ow=new So(32768);for(var Vn=0;Vn<32768;++Vn){var zl=(Vn&43690)>>1|(Vn&21845)<<1;zl=(zl&52428)>>2|(zl&13107)<<2,zl=(zl&61680)>>4|(zl&3855)<<4,Ow[Vn]=((zl&65280)>>8|(zl&255)<<8)>>1}var Ps=function(e,t,r){for(var n=e.length,a=0,o=new So(t);a<n;++a)e[a]&&++o[e[a]-1];var s=new So(t);for(a=1;a<t;++a)s[a]=s[a-1]+o[a-1]<<1;var l;if(r){l=new So(1<<t);var c=15-t;for(a=0;a<n;++a)if(e[a])for(var u=a<<4|e[a],d=t-e[a],f=s[e[a]-1]++<<d,h=f|(1<<d)-1;f<=h;++f)l[Ow[f]>>c]=u}else for(l=new So(n),a=0;a<n;++a)e[a]&&(l[a]=Ow[s[e[a]-1]++]>>15-e[a]);return l},rc=new wi(288);for(var Vn=0;Vn<144;++Vn)rc[Vn]=8;for(var Vn=144;Vn<256;++Vn)rc[Vn]=9;for(var Vn=256;Vn<280;++Vn)rc[Vn]=7;for(var Vn=280;Vn<288;++Vn)rc[Vn]=8;var kp=new wi(32);for(var Vn=0;Vn<32;++Vn)kp[Vn]=5;var Ele=Ps(rc,9,0),Ile=Ps(rc,9,1),Nle=Ps(kp,5,0),Dle=Ps(kp,5,1),b2=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},Zo=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(t&7)&r},_2=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(t&7)},wS=function(e){return(e+7)/8|0},P6=function(e,t,r){return(r==null||r>e.length)&&(r=e.length),new wi(e.subarray(t,r))},Mle=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ts=function(e,t,r){var n=new Error(t||Mle[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,ts),!r)throw n;return n},Lle=function(e,t,r,n){var a=e.length,o=0;if(!a||t.f&&!t.l)return r||new wi(0);var s=!r,l=s||t.i!=2,c=t.i;s&&(r=new wi(a*3));var u=function(me){var X=r.length;if(me>X){var G=new wi(Math.max(X*2,me));G.set(r),r=G}},d=t.f||0,f=t.p||0,h=t.b||0,p=t.l,g=t.d,m=t.m,x=t.n,b=a*8;do{if(!p){d=Zo(e,f,1);var _=Zo(e,f+1,3);if(f+=3,_)if(_==1)p=Ile,g=Dle,m=9,x=5;else if(_==2){var T=Zo(e,f,31)+257,E=Zo(e,f+10,15)+4,S=T+Zo(e,f+5,31)+1;f+=14;for(var I=new wi(S),z=new wi(19),k=0;k<E;++k)z[Aw[k]]=Zo(e,f+k*3,7);f+=E*3;for(var M=b2(z),R=(1<<M)-1,F=Ps(z,M,1),k=0;k<S;){var W=F[Zo(e,f,R)];f+=W&15;var w=W>>4;if(w<16)I[k++]=w;else{var K=0,Z=0;for(w==16?(Z=3+Zo(e,f,3),f+=2,K=I[k-1]):w==17?(Z=3+Zo(e,f,7),f+=3):w==18&&(Z=11+Zo(e,f,127),f+=7);Z--;)I[k++]=K}}var D=I.subarray(0,T),P=I.subarray(T);m=b2(D),x=b2(P),p=Ps(D,m,1),g=Ps(P,x,1)}else ts(1);else{var w=wS(f)+4,A=e[w-4]|e[w-3]<<8,O=w+A;if(O>a){c&&ts(0);break}l&&u(h+A),r.set(e.subarray(w,O),h),t.b=h+=A,t.p=f=O*8,t.f=d;continue}if(f>b){c&&ts(0);break}}l&&u(h+131072);for(var $=(1<<m)-1,Q=(1<<x)-1,C=f;;C=f){var K=p[_2(e,f)&$],L=K>>4;if(f+=K&15,f>b){c&&ts(0);break}if(K||ts(2),L<256)r[h++]=L;else if(L==256){C=f,p=null;break}else{var H=L-254;if(L>264){var k=L-257,U=Dy[k];H=Zo(e,f,(1<<U)-1)+C6[k],f+=U}var te=g[_2(e,f)&Q],le=te>>4;te||ts(3),f+=te&15;var P=Tle[le];if(le>3){var U=My[le];P+=_2(e,f)&(1<<U)-1,f+=U}if(f>b){c&&ts(0);break}l&&u(h+131072);var oe=h+H;if(h<P){var ae=o-P,he=Math.min(P,oe);for(ae+h<0&&ts(3);h<he;++h)r[h]=n[ae+h]}for(;h<oe;++h)r[h]=r[h-P]}}t.l=p,t.p=C,t.b=h,t.f=d,p&&(d=1,t.m=m,t.d=g,t.n=x)}while(!d);return h!=r.length&&s?P6(r,0,h):r.subarray(0,h)},Zs=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8},zf=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8,e[n+2]|=r>>16},w2=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var a=r.length,o=r.slice();if(!a)return{t:k6,l:0};if(a==1){var s=new wi(r[0].s+1);return s[r[0].s]=1,{t:s,l:1}}r.sort(function(O,T){return O.f-T.f}),r.push({s:-1,f:25001});var l=r[0],c=r[1],u=0,d=1,f=2;for(r[0]={s:-1,f:l.f+c.f,l,r:c};d!=a-1;)l=r[r[u].f<r[f].f?u++:f++],c=r[u!=d&&r[u].f<r[f].f?u++:f++],r[d++]={s:-1,f:l.f+c.f,l,r:c};for(var h=o[0].s,n=1;n<a;++n)o[n].s>h&&(h=o[n].s);var p=new So(h+1),g=kw(r[d-1],p,0);if(g>t){var n=0,m=0,x=g-t,b=1<<x;for(o.sort(function(T,E){return p[E.s]-p[T.s]||T.f-E.f});n<a;++n){var _=o[n].s;if(p[_]>t)m+=b-(1<<g-p[_]),p[_]=t;else break}for(m>>=x;m>0;){var w=o[n].s;p[w]<t?m-=1<<t-p[w]++-1:++n}for(;n>=0&&m;--n){var A=o[n].s;p[A]==t&&(--p[A],++m)}g=t}return{t:new wi(p),l:g}},kw=function(e,t,r){return e.s==-1?Math.max(kw(e.l,t,r+1),kw(e.r,t,r+1)):t[e.s]=r},UE=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new So(++t),n=0,a=e[0],o=1,s=function(c){r[n++]=c},l=1;l<=t;++l)if(e[l]==a&&l!=t)++o;else{if(!a&&o>2){for(;o>138;o-=138)s(32754);o>2&&(s(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(s(a),--o;o>6;o-=6)s(8304);o>2&&(s(o-3<<5|8208),o=0)}for(;o--;)s(a);o=1,a=e[l]}return{c:r.subarray(0,n),n:t}},Wf=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},O6=function(e,t,r){var n=r.length,a=wS(t+2);e[a]=n&255,e[a+1]=n>>8,e[a+2]=e[a]^255,e[a+3]=e[a+1]^255;for(var o=0;o<n;++o)e[a+o+4]=r[o];return(a+4+n)*8},zE=function(e,t,r,n,a,o,s,l,c,u,d){Zs(t,d++,r),++a[256];for(var f=w2(a,15),h=f.t,p=f.l,g=w2(o,15),m=g.t,x=g.l,b=UE(h),_=b.c,w=b.n,A=UE(m),O=A.c,T=A.n,E=new So(19),S=0;S<_.length;++S)++E[_[S]&31];for(var S=0;S<O.length;++S)++E[O[S]&31];for(var I=w2(E,7),z=I.t,k=I.l,M=19;M>4&&!z[Aw[M-1]];--M);var R=u+5<<3,F=Wf(a,rc)+Wf(o,kp)+s,W=Wf(a,h)+Wf(o,m)+s+14+3*M+Wf(E,z)+2*E[16]+3*E[17]+7*E[18];if(c>=0&&R<=F&&R<=W)return O6(t,d,e.subarray(c,c+u));var K,Z,D,P;if(Zs(t,d,1+(W<F)),d+=2,W<F){K=Ps(h,p,0),Z=h,D=Ps(m,x,0),P=m;var $=Ps(z,k,0);Zs(t,d,w-257),Zs(t,d+5,T-1),Zs(t,d+10,M-4),d+=14;for(var S=0;S<M;++S)Zs(t,d+3*S,z[Aw[S]]);d+=3*M;for(var Q=[_,O],C=0;C<2;++C)for(var L=Q[C],S=0;S<L.length;++S){var H=L[S]&31;Zs(t,d,$[H]),d+=z[H],H>15&&(Zs(t,d,L[S]>>5&127),d+=L[S]>>12)}}else K=Ele,Z=rc,D=Nle,P=kp;for(var S=0;S<l;++S){var U=n[S];if(U>255){var H=U>>18&31;zf(t,d,K[H+257]),d+=Z[H+257],H>7&&(Zs(t,d,U>>23&31),d+=Dy[H]);var te=U&31;zf(t,d,D[te]),d+=P[te],te>3&&(zf(t,d,U>>5&8191),d+=My[te])}else zf(t,d,K[U]),d+=Z[U]}return zf(t,d,K[256]),d+Z[256]},Rle=new _S([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),k6=new wi(0),qle=function(e,t,r,n,a,o){var s=o.z||e.length,l=new wi(n+s+5*(1+Math.ceil(s/7e3))+a),c=l.subarray(n,l.length-a),u=o.l,d=(o.r||0)&7;if(t){d&&(c[0]=o.r>>3);for(var f=Rle[t-1],h=f>>13,p=f&8191,g=(1<<r)-1,m=o.p||new So(32768),x=o.h||new So(g+1),b=Math.ceil(r/3),_=2*b,w=function(ee){return(e[ee]^e[ee+1]<<b^e[ee+2]<<_)&g},A=new _S(25e3),O=new So(288),T=new So(32),E=0,S=0,I=o.i||0,z=0,k=o.w||0,M=0;I+2<s;++I){var R=w(I),F=I&32767,W=x[R];if(m[F]=W,x[R]=F,k<=I){var K=s-I;if((E>7e3||z>24576)&&(K>423||!u)){d=zE(e,c,0,A,O,T,S,z,M,I-M,d),z=E=S=0,M=I;for(var Z=0;Z<286;++Z)O[Z]=0;for(var Z=0;Z<30;++Z)T[Z]=0}var D=2,P=0,$=p,Q=F-W&32767;if(K>2&&R==w(I-Q))for(var C=Math.min(h,K)-1,L=Math.min(32767,I),H=Math.min(258,K);Q<=L&&--$&&F!=W;){if(e[I+D]==e[I+D-Q]){for(var U=0;U<H&&e[I+U]==e[I+U-Q];++U);if(U>D){if(D=U,P=Q,U>C)break;for(var te=Math.min(Q,U-2),le=0,Z=0;Z<te;++Z){var oe=I-Q+Z&32767,ae=m[oe],he=oe-ae&32767;he>le&&(le=he,W=oe)}}}F=W,W=m[F],Q+=F-W&32767}if(P){A[z++]=268435456|Pw[D]<<18|BE[P];var me=Pw[D]&31,X=BE[P]&31;S+=Dy[me]+My[X],++O[257+me],++T[X],k=I+D,++E}else A[z++]=e[I],++O[e[I]]}}for(I=Math.max(I,k);I<s;++I)A[z++]=e[I],++O[e[I]];d=zE(e,c,u,A,O,T,S,z,M,I-M,d),u||(o.r=d&7|c[d/8|0]<<3,d-=7,o.h=x,o.p=m,o.i=I,o.w=k)}else{for(var I=o.w||0;I<s+u;I+=65535){var G=I+65535;G>=s&&(c[d/8|0]=u,G=s),d=O6(c,d+1,e.subarray(I,G))}o.i=s}return P6(l,0,n+wS(d)+a)},T6=function(){var e=1,t=0;return{p:function(r){for(var n=e,a=t,o=r.length|0,s=0;s!=o;){for(var l=Math.min(s+2655,o);s<l;++s)a+=n+=r[s];n=(n&65535)+15*(n>>16),a=(a&65535)+15*(a>>16)}e=n,t=a},d:function(){return e%=65521,t%=65521,(e&255)<<24|(e&65280)<<8|(t&255)<<8|t>>8}}},Fle=function(e,t,r,n,a){if(!a&&(a={l:1},t.dictionary)){var o=t.dictionary.subarray(-32768),s=new wi(o.length+e.length);s.set(o),s.set(e,o.length),e=s,a.w=o.length}return qle(e,t.level==null?6:t.level,t.mem==null?a.l?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):20:12+t.mem,r,n,a)},E6=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},$le=function(e,t){var r=t.level,n=r==0?0:r<6?1:r==9?3:2;if(e[0]=120,e[1]=n<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var a=T6();a.p(t.dictionary),E6(e,2,a.d())}},Ble=function(e,t){return((e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31)&&ts(6,"invalid zlib data"),(e[1]>>5&1)==1&&ts(6,"invalid zlib data: "+(e[1]&32?"need":"unexpected")+" dictionary"),(e[1]>>3&4)+2};function Tw(e,t){t||(t={});var r=T6();r.p(e);var n=Fle(e,t,t.dictionary?6:2,4);return $le(n,t),E6(n,n.length-4,r.d()),n}function Ule(e,t){return Lle(e.subarray(Ble(e),-4),{i:2},t,t)}var zle=typeof TextDecoder<"u"&&new TextDecoder,Wle=0;try{zle.decode(k6,{stream:!0}),Wle=1}catch{}var kr=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function j2(){kr.console&&typeof kr.console.log=="function"&&kr.console.log.apply(kr.console,arguments)}var Tn={log:j2,warn:function(e){kr.console&&(typeof kr.console.warn=="function"?kr.console.warn.apply(kr.console,arguments):j2.call(null,arguments))},error:function(e){kr.console&&(typeof kr.console.error=="function"?kr.console.error.apply(kr.console,arguments):j2(e))}};function S2(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){Tc(n.response,t,r)},n.onerror=function(){Tn.error("could not download file")},n.send()}function WE(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function Mm(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var Rh,Ew,Tc=kr.saveAs||((typeof window>"u"?"undefined":xn(window))!=="object"||window!==kr?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(e,t,r){var n=kr.URL||kr.webkitURL,a=document.createElement("a");t=t||e.name||"download",a.download=t,a.rel="noopener",typeof e=="string"?(a.href=e,a.origin!==location.origin?WE(a.href)?S2(e,t,r):Mm(a,a.target="_blank"):Mm(a)):(a.href=n.createObjectURL(e),setTimeout(function(){n.revokeObjectURL(a.href)},4e4),setTimeout(function(){Mm(a)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,r){if(t=t||e.name||"download",typeof e=="string")if(WE(e))S2(e,t,r);else{var n=document.createElement("a");n.href=e,n.target="_blank",setTimeout(function(){Mm(n)})}else navigator.msSaveOrOpenBlob(function(a,o){return o===void 0?o={autoBom:!1}:xn(o)!=="object"&&(Tn.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}(e,r),t)}:function(e,t,r,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof e=="string")return S2(e,t,r);var a=e.type==="application/octet-stream",o=/constructor/i.test(kr.HTMLElement)||kr.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);if((s||a&&o)&&(typeof FileReader>"u"?"undefined":xn(FileReader))==="object"){var l=new FileReader;l.onloadend=function(){var d=l.result;d=s?d:d.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=d:location=d,n=null},l.readAsDataURL(e)}else{var c=kr.URL||kr.webkitURL,u=c.createObjectURL(e);n?n.location=u:location.href=u,n=null,setTimeout(function(){c.revokeObjectURL(u)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function I6(e){var t;e=e||"",this.ok=!1,e.charAt(0)=="#"&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],n=0;n<r.length;n++){var a=r[n].re,o=r[n].process,s=a.exec(e);s&&(t=o(s),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var l=this.r.toString(16),c=this.g.toString(16),u=this.b.toString(16);return l.length==1&&(l="0"+l),c.length==1&&(c="0"+c),u.length==1&&(u="0"+u),"#"+l+c+u}}/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function C2(e,t){var r=e[0],n=e[1],a=e[2],o=e[3];r=mi(r,n,a,o,t[0],7,-680876936),o=mi(o,r,n,a,t[1],12,-389564586),a=mi(a,o,r,n,t[2],17,606105819),n=mi(n,a,o,r,t[3],22,-1044525330),r=mi(r,n,a,o,t[4],7,-176418897),o=mi(o,r,n,a,t[5],12,1200080426),a=mi(a,o,r,n,t[6],17,-1473231341),n=mi(n,a,o,r,t[7],22,-45705983),r=mi(r,n,a,o,t[8],7,1770035416),o=mi(o,r,n,a,t[9],12,-1958414417),a=mi(a,o,r,n,t[10],17,-42063),n=mi(n,a,o,r,t[11],22,-1990404162),r=mi(r,n,a,o,t[12],7,1804603682),o=mi(o,r,n,a,t[13],12,-40341101),a=mi(a,o,r,n,t[14],17,-1502002290),r=gi(r,n=mi(n,a,o,r,t[15],22,1236535329),a,o,t[1],5,-165796510),o=gi(o,r,n,a,t[6],9,-1069501632),a=gi(a,o,r,n,t[11],14,643717713),n=gi(n,a,o,r,t[0],20,-373897302),r=gi(r,n,a,o,t[5],5,-701558691),o=gi(o,r,n,a,t[10],9,38016083),a=gi(a,o,r,n,t[15],14,-660478335),n=gi(n,a,o,r,t[4],20,-405537848),r=gi(r,n,a,o,t[9],5,568446438),o=gi(o,r,n,a,t[14],9,-1019803690),a=gi(a,o,r,n,t[3],14,-187363961),n=gi(n,a,o,r,t[8],20,1163531501),r=gi(r,n,a,o,t[13],5,-1444681467),o=gi(o,r,n,a,t[2],9,-51403784),a=gi(a,o,r,n,t[7],14,1735328473),r=vi(r,n=gi(n,a,o,r,t[12],20,-1926607734),a,o,t[5],4,-378558),o=vi(o,r,n,a,t[8],11,-2022574463),a=vi(a,o,r,n,t[11],16,1839030562),n=vi(n,a,o,r,t[14],23,-35309556),r=vi(r,n,a,o,t[1],4,-1530992060),o=vi(o,r,n,a,t[4],11,1272893353),a=vi(a,o,r,n,t[7],16,-155497632),n=vi(n,a,o,r,t[10],23,-1094730640),r=vi(r,n,a,o,t[13],4,681279174),o=vi(o,r,n,a,t[0],11,-358537222),a=vi(a,o,r,n,t[3],16,-722521979),n=vi(n,a,o,r,t[6],23,76029189),r=vi(r,n,a,o,t[9],4,-640364487),o=vi(o,r,n,a,t[12],11,-421815835),a=vi(a,o,r,n,t[15],16,530742520),r=yi(r,n=vi(n,a,o,r,t[2],23,-995338651),a,o,t[0],6,-198630844),o=yi(o,r,n,a,t[7],10,1126891415),a=yi(a,o,r,n,t[14],15,-1416354905),n=yi(n,a,o,r,t[5],21,-57434055),r=yi(r,n,a,o,t[12],6,1700485571),o=yi(o,r,n,a,t[3],10,-1894986606),a=yi(a,o,r,n,t[10],15,-1051523),n=yi(n,a,o,r,t[1],21,-2054922799),r=yi(r,n,a,o,t[8],6,1873313359),o=yi(o,r,n,a,t[15],10,-30611744),a=yi(a,o,r,n,t[6],15,-1560198380),n=yi(n,a,o,r,t[13],21,1309151649),r=yi(r,n,a,o,t[4],6,-145523070),o=yi(o,r,n,a,t[11],10,-1120210379),a=yi(a,o,r,n,t[2],15,718787259),n=yi(n,a,o,r,t[9],21,-343485551),e[0]=Xl(r,e[0]),e[1]=Xl(n,e[1]),e[2]=Xl(a,e[2]),e[3]=Xl(o,e[3])}function Ly(e,t,r,n,a,o){return t=Xl(Xl(t,e),Xl(n,o)),Xl(t<<a|t>>>32-a,r)}function mi(e,t,r,n,a,o,s){return Ly(t&r|~t&n,e,t,a,o,s)}function gi(e,t,r,n,a,o,s){return Ly(t&n|r&~n,e,t,a,o,s)}function vi(e,t,r,n,a,o,s){return Ly(t^r^n,e,t,a,o,s)}function yi(e,t,r,n,a,o,s){return Ly(r^(t|~n),e,t,a,o,s)}function N6(e){var t,r=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)C2(n,Hle(e.substring(t-64,t)));e=e.substring(t-64);var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)a[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(C2(n,a),t=0;t<16;t++)a[t]=0;return a[14]=8*r,C2(n,a),n}function Hle(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}Rh=kr.atob.bind(kr),Ew=kr.btoa.bind(kr);var HE="0123456789abcdef".split("");function Vle(e){for(var t="",r=0;r<4;r++)t+=HE[e>>8*r+4&15]+HE[e>>8*r&15];return t}function Gle(e){return String.fromCharCode((255&e)>>0,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function Iw(e){return N6(e).map(Gle).join("")}var Yle=function(e){for(var t=0;t<e.length;t++)e[t]=Vle(e[t]);return e.join("")}(N6("hello"))!="5d41402abc4b2a76b9719d911017c592";function Xl(e,t){if(Yle){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}return e+t&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function Nw(e,t){var r,n,a,o;if(e!==r){for(var s=(a=e,o=1+(256/e.length>>0),new Array(o+1).join(a)),l=[],c=0;c<256;c++)l[c]=c;var u=0;for(c=0;c<256;c++){var d=l[c];u=(u+d+s.charCodeAt(c))%256,l[c]=l[u],l[u]=d}r=e,n=l}else l=n;var f=t.length,h=0,p=0,g="";for(c=0;c<f;c++)p=(p+(d=l[h=(h+1)%256]))%256,l[h]=l[p],l[p]=d,s=l[(l[h]+l[p])%256],g+=String.fromCharCode(t.charCodeAt(c)^s);return g}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var VE={print:4,modify:8,copy:16,"annot-forms":32};function ku(e,t,r,n){this.v=1,this.r=2;var a=192;e.forEach(function(l){if(VE.perm!==void 0)throw new Error("Invalid permission: "+l);a+=VE[l]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var o=(t+this.padding).substr(0,32),s=(r+this.padding).substr(0,32);this.O=this.processOwnerPassword(o,s),this.P=-(1+(255^a)),this.encryptionKey=Iw(o+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=Nw(this.encryptionKey,this.padding)}function Tu(e){if(/[^\u0000-\u00ff]/.test(e))throw new Error("Invalid PDF Name Object: "+e+", Only accept ASCII characters.");for(var t="",r=e.length,n=0;n<r;n++){var a=e.charCodeAt(n);a<33||a===35||a===37||a===40||a===41||a===47||a===60||a===62||a===91||a===93||a===123||a===125||a>126?t+="#"+("0"+a.toString(16)).slice(-2):t+=e[n]}return t}function GE(e){if(xn(e)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(r,n,a){if(a=a||!1,typeof r!="string"||typeof n!="function"||typeof a!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(r)||(t[r]={});var o=Math.random().toString(35);return t[r][o]=[n,!!a],o},this.unsubscribe=function(r){for(var n in t)if(t[n][r])return delete t[n][r],Object.keys(t[n]).length===0&&delete t[n],!0;return!1},this.publish=function(r){if(t.hasOwnProperty(r)){var n=Array.prototype.slice.call(arguments,1),a=[];for(var o in t[r]){var s=t[r][o];try{s[0].apply(e,n)}catch(l){kr.console&&Tn.error("jsPDF PubSub Error",l.message,l)}s[1]&&a.push(o)}a.length&&a.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function _v(e){if(!(this instanceof _v))return new _v(e);var t="opacity,stroke-opacity".split(",");for(var r in e)e.hasOwnProperty(r)&&t.indexOf(r)>=0&&(this[r]=e[r]);this.id="",this.objectNumber=-1}function D6(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function Ic(e,t,r,n,a){if(!(this instanceof Ic))return new Ic(e,t,r,n,a);this.type=e==="axial"?2:3,this.coords=t,this.colors=r,D6.call(this,n,a)}function qu(e,t,r,n,a){if(!(this instanceof qu))return new qu(e,t,r,n,a);this.boundingBox=e,this.xStep=t,this.yStep=r,this.stream="",this.cloneIndex=0,D6.call(this,n,a)}function Sr(e){var t,r=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],a=arguments[2],o=arguments[3],s=[],l=1,c=16,u="S",d=null;xn(e=e||{})==="object"&&(r=e.orientation,n=e.unit||n,a=e.format||a,o=e.compress||e.compressPdf||o,(d=e.encryption||null)!==null&&(d.userPassword=d.userPassword||"",d.ownerPassword=d.ownerPassword||"",d.userPermissions=d.userPermissions||[]),l=typeof e.userUnit=="number"?Math.abs(e.userUnit):1,e.precision!==void 0&&(t=e.precision),e.floatPrecision!==void 0&&(c=e.floatPrecision),u=e.defaultPathOperation||"S"),s=e.filters||(o===!0?["FlateEncode"]:s),n=n||"mm",r=(""+(r||"P")).toLowerCase();var f=e.putOnlyUsedFonts||!1,h={},p={internal:{},__private__:{}};p.__private__.PubSub=GE;var g="1.3",m=p.__private__.getPdfVersion=function(){return g};p.__private__.setPdfVersion=function(N){g=N};var x={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};p.__private__.getPageFormats=function(){return x};var b=p.__private__.getPageFormat=function(N){return x[N]};a=a||"a4";var _={COMPAT:"compat",ADVANCED:"advanced"},w=_.COMPAT;function A(){this.saveGraphicsState(),V(new rr(jt,0,0,-jt,0,li()*jt).toString()+" cm"),this.setFontSize(this.getFontSize()/jt),u="n",w=_.ADVANCED}function O(){this.restoreGraphicsState(),u="S",w=_.COMPAT}var T=p.__private__.combineFontStyleAndFontWeight=function(N,ne){if(N=="bold"&&ne=="normal"||N=="bold"&&ne==400||N=="normal"&&ne=="italic"||N=="bold"&&ne=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return ne&&(N=ne==400||ne==="normal"?N==="italic"?"italic":"normal":ne!=700&&ne!=="bold"||N!=="normal"?(ne==700?"bold":ne)+""+N:"bold"),N};p.advancedAPI=function(N){var ne=w===_.COMPAT;return ne&&A.call(this),typeof N!="function"||(N(this),ne&&O.call(this)),this},p.compatAPI=function(N){var ne=w===_.ADVANCED;return ne&&O.call(this),typeof N!="function"||(N(this),ne&&A.call(this)),this},p.isAdvancedAPI=function(){return w===_.ADVANCED};var E,S=function(N){if(w!==_.ADVANCED)throw new Error(N+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},I=p.roundToPrecision=p.__private__.roundToPrecision=function(N,ne){var je=t||ne;if(isNaN(N)||isNaN(je))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return N.toFixed(je).replace(/0+$/,"")};E=p.hpf=p.__private__.hpf=typeof c=="number"?function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.hpf");return I(N,c)}:c==="smart"?function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.hpf");return I(N,N>-1&&N<1?16:5)}:function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.hpf");return I(N,16)};var z=p.f2=p.__private__.f2=function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.f2");return I(N,2)},k=p.__private__.f3=function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.f3");return I(N,3)},M=p.scale=p.__private__.scale=function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.scale");return w===_.COMPAT?N*jt:w===_.ADVANCED?N:void 0},R=function(N){return w===_.COMPAT?li()-N:w===_.ADVANCED?N:void 0},F=function(N){return M(R(N))};p.__private__.setPrecision=p.setPrecision=function(N){typeof parseInt(N,10)=="number"&&(t=parseInt(N,10))};var W,K="00000000000000000000000000000000",Z=p.__private__.getFileId=function(){return K},D=p.__private__.setFileId=function(N){return K=N!==void 0&&/^[a-fA-F0-9]{32}$/.test(N)?N.toUpperCase():K.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),d!==null&&(zn=new ku(d.userPermissions,d.userPassword,d.ownerPassword,K)),K};p.setFileId=function(N){return D(N),this},p.getFileId=function(){return Z()};var P=p.__private__.convertDateToPDFDate=function(N){var ne=N.getTimezoneOffset(),je=ne<0?"+":"-",Ee=Math.floor(Math.abs(ne/60)),Ye=Math.abs(ne%60),dt=[je,H(Ee),"'",H(Ye),"'"].join("");return["D:",N.getFullYear(),H(N.getMonth()+1),H(N.getDate()),H(N.getHours()),H(N.getMinutes()),H(N.getSeconds()),dt].join("")},$=p.__private__.convertPDFDateToDate=function(N){var ne=parseInt(N.substr(2,4),10),je=parseInt(N.substr(6,2),10)-1,Ee=parseInt(N.substr(8,2),10),Ye=parseInt(N.substr(10,2),10),dt=parseInt(N.substr(12,2),10),Pt=parseInt(N.substr(14,2),10);return new Date(ne,je,Ee,Ye,dt,Pt,0)},Q=p.__private__.setCreationDate=function(N){var ne;if(N===void 0&&(N=new Date),N instanceof Date)ne=P(N);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(N))throw new Error("Invalid argument passed to jsPDF.setCreationDate");ne=N}return W=ne},C=p.__private__.getCreationDate=function(N){var ne=W;return N==="jsDate"&&(ne=$(W)),ne};p.setCreationDate=function(N){return Q(N),this},p.getCreationDate=function(N){return C(N)};var L,H=p.__private__.padd2=function(N){return("0"+parseInt(N)).slice(-2)},U=p.__private__.padd2Hex=function(N){return("00"+(N=N.toString())).substr(N.length)},te=0,le=[],oe=[],ae=0,he=[],me=[],X=!1,G=oe,ee=function(){te=0,ae=0,oe=[],le=[],he=[],it=nn(),Ct=nn()};p.__private__.setCustomOutputDestination=function(N){X=!0,G=N};var se=function(N){X||(G=N)};p.__private__.resetCustomOutputDestination=function(){X=!1,G=oe};var V=p.__private__.out=function(N){return N=N.toString(),ae+=N.length+1,G.push(N),G},He=p.__private__.write=function(N){return V(arguments.length===1?N.toString():Array.prototype.join.call(arguments," "))},Ne=p.__private__.getArrayBuffer=function(N){for(var ne=N.length,je=new ArrayBuffer(ne),Ee=new Uint8Array(je);ne--;)Ee[ne]=N.charCodeAt(ne);return je},Re=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];p.__private__.getStandardFonts=function(){return Re};var Ke=e.fontSize||16;p.__private__.setFontSize=p.setFontSize=function(N){return Ke=w===_.ADVANCED?N/jt:N,this};var nt,st=p.__private__.getFontSize=p.getFontSize=function(){return w===_.COMPAT?Ke:Ke*jt},gt=e.R2L||!1;p.__private__.setR2L=p.setR2L=function(N){return gt=N,this},p.__private__.getR2L=p.getR2L=function(){return gt};var Ge,Je=p.__private__.setZoomMode=function(N){var ne=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(N))nt=N;else if(isNaN(N)){if(ne.indexOf(N)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+N+'" is not recognized.');nt=N}else nt=parseInt(N,10)};p.__private__.getZoomMode=function(){return nt};var We,_t=p.__private__.setPageMode=function(N){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(N)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+N+'" is not recognized.');Ge=N};p.__private__.getPageMode=function(){return Ge};var Nt=p.__private__.setLayoutMode=function(N){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(N)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+N+'" is not recognized.');We=N};p.__private__.getLayoutMode=function(){return We},p.__private__.setDisplayMode=p.setDisplayMode=function(N,ne,je){return Je(N),Nt(ne),_t(je),this};var kt={title:"",subject:"",author:"",keywords:"",creator:""};p.__private__.getDocumentProperty=function(N){if(Object.keys(kt).indexOf(N)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return kt[N]},p.__private__.getDocumentProperties=function(){return kt},p.__private__.setDocumentProperties=p.setProperties=p.setDocumentProperties=function(N){for(var ne in kt)kt.hasOwnProperty(ne)&&N[ne]&&(kt[ne]=N[ne]);return this},p.__private__.setDocumentProperty=function(N,ne){if(Object.keys(kt).indexOf(N)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return kt[N]=ne};var Vt,jt,Tr,qe,$e,Xe={},Ue={},ht=[],at={},wt={},Tt={},Jt={},Dr=null,qr=0,ar=[],Er=new GE(p),Ir=e.hotfixes||[],rn={},Ta={},Dn=[],rr=function N(ne,je,Ee,Ye,dt,Pt){if(!(this instanceof N))return new N(ne,je,Ee,Ye,dt,Pt);isNaN(ne)&&(ne=1),isNaN(je)&&(je=0),isNaN(Ee)&&(Ee=0),isNaN(Ye)&&(Ye=1),isNaN(dt)&&(dt=0),isNaN(Pt)&&(Pt=0),this._matrix=[ne,je,Ee,Ye,dt,Pt]};Object.defineProperty(rr.prototype,"sx",{get:function(){return this._matrix[0]},set:function(N){this._matrix[0]=N}}),Object.defineProperty(rr.prototype,"shy",{get:function(){return this._matrix[1]},set:function(N){this._matrix[1]=N}}),Object.defineProperty(rr.prototype,"shx",{get:function(){return this._matrix[2]},set:function(N){this._matrix[2]=N}}),Object.defineProperty(rr.prototype,"sy",{get:function(){return this._matrix[3]},set:function(N){this._matrix[3]=N}}),Object.defineProperty(rr.prototype,"tx",{get:function(){return this._matrix[4]},set:function(N){this._matrix[4]=N}}),Object.defineProperty(rr.prototype,"ty",{get:function(){return this._matrix[5]},set:function(N){this._matrix[5]=N}}),Object.defineProperty(rr.prototype,"a",{get:function(){return this._matrix[0]},set:function(N){this._matrix[0]=N}}),Object.defineProperty(rr.prototype,"b",{get:function(){return this._matrix[1]},set:function(N){this._matrix[1]=N}}),Object.defineProperty(rr.prototype,"c",{get:function(){return this._matrix[2]},set:function(N){this._matrix[2]=N}}),Object.defineProperty(rr.prototype,"d",{get:function(){return this._matrix[3]},set:function(N){this._matrix[3]=N}}),Object.defineProperty(rr.prototype,"e",{get:function(){return this._matrix[4]},set:function(N){this._matrix[4]=N}}),Object.defineProperty(rr.prototype,"f",{get:function(){return this._matrix[5]},set:function(N){this._matrix[5]=N}}),Object.defineProperty(rr.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(rr.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(rr.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(rr.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),rr.prototype.join=function(N){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(E).join(N)},rr.prototype.multiply=function(N){var ne=N.sx*this.sx+N.shy*this.shx,je=N.sx*this.shy+N.shy*this.sy,Ee=N.shx*this.sx+N.sy*this.shx,Ye=N.shx*this.shy+N.sy*this.sy,dt=N.tx*this.sx+N.ty*this.shx+this.tx,Pt=N.tx*this.shy+N.ty*this.sy+this.ty;return new rr(ne,je,Ee,Ye,dt,Pt)},rr.prototype.decompose=function(){var N=this.sx,ne=this.shy,je=this.shx,Ee=this.sy,Ye=this.tx,dt=this.ty,Pt=Math.sqrt(N*N+ne*ne),Wt=(N/=Pt)*je+(ne/=Pt)*Ee;je-=N*Wt,Ee-=ne*Wt;var lr=Math.sqrt(je*je+Ee*Ee);return Wt/=lr,N*(Ee/=lr)<ne*(je/=lr)&&(N=-N,ne=-ne,Wt=-Wt,Pt=-Pt),{scale:new rr(Pt,0,0,lr,0,0),translate:new rr(1,0,0,1,Ye,dt),rotate:new rr(N,ne,-ne,N,0,0),skew:new rr(1,0,Wt,1,0,0)}},rr.prototype.toString=function(N){return this.join(" ")},rr.prototype.inversed=function(){var N=this.sx,ne=this.shy,je=this.shx,Ee=this.sy,Ye=this.tx,dt=this.ty,Pt=1/(N*Ee-ne*je),Wt=Ee*Pt,lr=-ne*Pt,Lr=-je*Pt,Or=N*Pt;return new rr(Wt,lr,Lr,Or,-Wt*Ye-Lr*dt,-lr*Ye-Or*dt)},rr.prototype.applyToPoint=function(N){var ne=N.x*this.sx+N.y*this.shx+this.tx,je=N.x*this.shy+N.y*this.sy+this.ty;return new Ua(ne,je)},rr.prototype.applyToRectangle=function(N){var ne=this.applyToPoint(N),je=this.applyToPoint(new Ua(N.x+N.w,N.y+N.h));return new zi(ne.x,ne.y,je.x-ne.x,je.y-ne.y)},rr.prototype.clone=function(){var N=this.sx,ne=this.shy,je=this.shx,Ee=this.sy,Ye=this.tx,dt=this.ty;return new rr(N,ne,je,Ee,Ye,dt)},p.Matrix=rr;var Kr=p.matrixMult=function(N,ne){return ne.multiply(N)},Yn=new rr(1,0,0,1,0,0);p.unitMatrix=p.identityMatrix=Yn;var Mn=function(N,ne){if(!wt[N]){var je=(ne instanceof Ic?"Sh":"P")+(Object.keys(at).length+1).toString(10);ne.id=je,wt[N]=je,at[je]=ne,Er.publish("addPattern",ne)}};p.ShadingPattern=Ic,p.TilingPattern=qu,p.addShadingPattern=function(N,ne){return S("addShadingPattern()"),Mn(N,ne),this},p.beginTilingPattern=function(N){S("beginTilingPattern()"),Io(N.boundingBox[0],N.boundingBox[1],N.boundingBox[2]-N.boundingBox[0],N.boundingBox[3]-N.boundingBox[1],N.matrix)},p.endTilingPattern=function(N,ne){S("endTilingPattern()"),ne.stream=me[L].join(`
`),Mn(N,ne),Er.publish("endTilingPattern",ne),Dn.pop().restore()};var Qr=p.__private__.newObject=function(){var N=nn();return Se(N,!0),N},nn=p.__private__.newObjectDeferred=function(){return te++,le[te]=function(){return ae},te},Se=function(N,ne){return ne=typeof ne=="boolean"&&ne,le[N]=ae,ne&&V(N+" 0 obj"),N},Ve=p.__private__.newAdditionalObject=function(){var N={objId:nn(),content:""};return he.push(N),N},it=nn(),Ct=nn(),Bt=p.__private__.decodeColorString=function(N){var ne=N.split(" ");if(ne.length!==2||ne[1]!=="g"&&ne[1]!=="G")ne.length===5&&(ne[4]==="k"||ne[4]==="K")&&(ne=[(1-ne[0])*(1-ne[3]),(1-ne[1])*(1-ne[3]),(1-ne[2])*(1-ne[3]),"r"]);else{var je=parseFloat(ne[0]);ne=[je,je,je,"r"]}for(var Ee="#",Ye=0;Ye<3;Ye++)Ee+=("0"+Math.floor(255*parseFloat(ne[Ye])).toString(16)).slice(-2);return Ee},Ht=p.__private__.encodeColorString=function(N){var ne;typeof N=="string"&&(N={ch1:N});var je=N.ch1,Ee=N.ch2,Ye=N.ch3,dt=N.ch4,Pt=N.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof je=="string"&&je.charAt(0)!=="#"){var Wt=new I6(je);if(Wt.ok)je=Wt.toHex();else if(!/^\d*\.?\d*$/.test(je))throw new Error('Invalid color "'+je+'" passed to jsPDF.encodeColorString.')}if(typeof je=="string"&&/^#[0-9A-Fa-f]{3}$/.test(je)&&(je="#"+je[1]+je[1]+je[2]+je[2]+je[3]+je[3]),typeof je=="string"&&/^#[0-9A-Fa-f]{6}$/.test(je)){var lr=parseInt(je.substr(1),16);je=lr>>16&255,Ee=lr>>8&255,Ye=255&lr}if(Ee===void 0||dt===void 0&&je===Ee&&Ee===Ye)if(typeof je=="string")ne=je+" "+Pt[0];else switch(N.precision){case 2:ne=z(je/255)+" "+Pt[0];break;case 3:default:ne=k(je/255)+" "+Pt[0]}else if(dt===void 0||xn(dt)==="object"){if(dt&&!isNaN(dt.a)&&dt.a===0)return ne=["1.","1.","1.",Pt[1]].join(" ");if(typeof je=="string")ne=[je,Ee,Ye,Pt[1]].join(" ");else switch(N.precision){case 2:ne=[z(je/255),z(Ee/255),z(Ye/255),Pt[1]].join(" ");break;default:case 3:ne=[k(je/255),k(Ee/255),k(Ye/255),Pt[1]].join(" ")}}else if(typeof je=="string")ne=[je,Ee,Ye,dt,Pt[2]].join(" ");else switch(N.precision){case 2:ne=[z(je),z(Ee),z(Ye),z(dt),Pt[2]].join(" ");break;case 3:default:ne=[k(je),k(Ee),k(Ye),k(dt),Pt[2]].join(" ")}return ne},mr=p.__private__.getFilters=function(){return s},an=p.__private__.putStream=function(N){var ne=(N=N||{}).data||"",je=N.filters||mr(),Ee=N.alreadyAppliedFilters||[],Ye=N.addLength1||!1,dt=ne.length,Pt=N.objectId,Wt=function(za){return za};if(d!==null&&Pt===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");d!==null&&(Wt=zn.encryptor(Pt,0));var lr={};je===!0&&(je=["FlateEncode"]);var Lr=N.additionalKeyValues||[],Or=(lr=Sr.API.processDataByFilters!==void 0?Sr.API.processDataByFilters(ne,je):{data:ne,reverseChain:[]}).reverseChain+(Array.isArray(Ee)?Ee.join(" "):Ee.toString());if(lr.data.length!==0&&(Lr.push({key:"Length",value:lr.data.length}),Ye===!0&&Lr.push({key:"Length1",value:dt})),Or.length!=0)if(Or.split("/").length-1==1)Lr.push({key:"Filter",value:Or});else{Lr.push({key:"Filter",value:"["+Or+"]"});for(var Xr=0;Xr<Lr.length;Xr+=1)if(Lr[Xr].key==="DecodeParms"){for(var Ln=[],Wn=0;Wn<lr.reverseChain.split("/").length-1;Wn+=1)Ln.push("null");Ln.push(Lr[Xr].value),Lr[Xr].value="["+Ln.join(" ")+"]"}}V("<<");for(var aa=0;aa<Lr.length;aa++)V("/"+Lr[aa].key+" "+Lr[aa].value);V(">>"),lr.data.length!==0&&(V("stream"),V(Wt(lr.data)),V("endstream"))},Be=p.__private__.putPage=function(N){var ne=N.number,je=N.data,Ee=N.objId,Ye=N.contentsObjId;Se(Ee,!0),V("<</Type /Page"),V("/Parent "+N.rootDictionaryObjId+" 0 R"),V("/Resources "+N.resourceDictionaryObjId+" 0 R"),V("/MediaBox ["+parseFloat(E(N.mediaBox.bottomLeftX))+" "+parseFloat(E(N.mediaBox.bottomLeftY))+" "+E(N.mediaBox.topRightX)+" "+E(N.mediaBox.topRightY)+"]"),N.cropBox!==null&&V("/CropBox ["+E(N.cropBox.bottomLeftX)+" "+E(N.cropBox.bottomLeftY)+" "+E(N.cropBox.topRightX)+" "+E(N.cropBox.topRightY)+"]"),N.bleedBox!==null&&V("/BleedBox ["+E(N.bleedBox.bottomLeftX)+" "+E(N.bleedBox.bottomLeftY)+" "+E(N.bleedBox.topRightX)+" "+E(N.bleedBox.topRightY)+"]"),N.trimBox!==null&&V("/TrimBox ["+E(N.trimBox.bottomLeftX)+" "+E(N.trimBox.bottomLeftY)+" "+E(N.trimBox.topRightX)+" "+E(N.trimBox.topRightY)+"]"),N.artBox!==null&&V("/ArtBox ["+E(N.artBox.bottomLeftX)+" "+E(N.artBox.bottomLeftY)+" "+E(N.artBox.topRightX)+" "+E(N.artBox.topRightY)+"]"),typeof N.userUnit=="number"&&N.userUnit!==1&&V("/UserUnit "+N.userUnit),Er.publish("putPage",{objId:Ee,pageContext:ar[ne],pageNumber:ne,page:je}),V("/Contents "+Ye+" 0 R"),V(">>"),V("endobj");var dt=je.join(`
`);return w===_.ADVANCED&&(dt+=`
Q`),Se(Ye,!0),an({data:dt,filters:mr(),objectId:Ye}),V("endobj"),Ee},tt=p.__private__.putPages=function(){var N,ne,je=[];for(N=1;N<=qr;N++)ar[N].objId=nn(),ar[N].contentsObjId=nn();for(N=1;N<=qr;N++)je.push(Be({number:N,data:me[N],objId:ar[N].objId,contentsObjId:ar[N].contentsObjId,mediaBox:ar[N].mediaBox,cropBox:ar[N].cropBox,bleedBox:ar[N].bleedBox,trimBox:ar[N].trimBox,artBox:ar[N].artBox,userUnit:ar[N].userUnit,rootDictionaryObjId:it,resourceDictionaryObjId:Ct}));Se(it,!0),V("<</Type /Pages");var Ee="/Kids [";for(ne=0;ne<qr;ne++)Ee+=je[ne]+" 0 R ";V(Ee+"]"),V("/Count "+qr),V(">>"),V("endobj"),Er.publish("postPutPages")},At=function(N){Er.publish("putFont",{font:N,out:V,newObject:Qr,putStream:an}),N.isAlreadyPutted!==!0&&(N.objectNumber=Qr(),V("<<"),V("/Type /Font"),V("/BaseFont /"+Tu(N.postScriptName)),V("/Subtype /Type1"),typeof N.encoding=="string"&&V("/Encoding /"+N.encoding),V("/FirstChar 32"),V("/LastChar 255"),V(">>"),V("endobj"))},Gt=function(){for(var N in Xe)Xe.hasOwnProperty(N)&&(f===!1||f===!0&&h.hasOwnProperty(N))&&At(Xe[N])},or=function(N){N.objectNumber=Qr();var ne=[];ne.push({key:"Type",value:"/XObject"}),ne.push({key:"Subtype",value:"/Form"}),ne.push({key:"BBox",value:"["+[E(N.x),E(N.y),E(N.x+N.width),E(N.y+N.height)].join(" ")+"]"}),ne.push({key:"Matrix",value:"["+N.matrix.toString()+"]"});var je=N.pages[1].join(`
`);an({data:je,additionalKeyValues:ne,objectId:N.objectNumber}),V("endobj")},un=function(){for(var N in rn)rn.hasOwnProperty(N)&&or(rn[N])},Ea=function(N,ne){var je,Ee=[],Ye=1/(ne-1);for(je=0;je<1;je+=Ye)Ee.push(je);if(Ee.push(1),N[0].offset!=0){var dt={offset:0,color:N[0].color};N.unshift(dt)}if(N[N.length-1].offset!=1){var Pt={offset:1,color:N[N.length-1].color};N.push(Pt)}for(var Wt="",lr=0,Lr=0;Lr<Ee.length;Lr++){for(je=Ee[Lr];je>N[lr+1].offset;)lr++;var Or=N[lr].offset,Xr=(je-Or)/(N[lr+1].offset-Or),Ln=N[lr].color,Wn=N[lr+1].color;Wt+=U(Math.round((1-Xr)*Ln[0]+Xr*Wn[0]).toString(16))+U(Math.round((1-Xr)*Ln[1]+Xr*Wn[1]).toString(16))+U(Math.round((1-Xr)*Ln[2]+Xr*Wn[2]).toString(16))}return Wt.trim()},ro=function(N,ne){ne||(ne=21);var je=Qr(),Ee=Ea(N.colors,ne),Ye=[];Ye.push({key:"FunctionType",value:"0"}),Ye.push({key:"Domain",value:"[0.0 1.0]"}),Ye.push({key:"Size",value:"["+ne+"]"}),Ye.push({key:"BitsPerSample",value:"8"}),Ye.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Ye.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),an({data:Ee,additionalKeyValues:Ye,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:je}),V("endobj"),N.objectNumber=Qr(),V("<< /ShadingType "+N.type),V("/ColorSpace /DeviceRGB");var dt="/Coords ["+E(parseFloat(N.coords[0]))+" "+E(parseFloat(N.coords[1]))+" ";N.type===2?dt+=E(parseFloat(N.coords[2]))+" "+E(parseFloat(N.coords[3])):dt+=E(parseFloat(N.coords[2]))+" "+E(parseFloat(N.coords[3]))+" "+E(parseFloat(N.coords[4]))+" "+E(parseFloat(N.coords[5])),V(dt+="]"),N.matrix&&V("/Matrix ["+N.matrix.toString()+"]"),V("/Function "+je+" 0 R"),V("/Extend [true true]"),V(">>"),V("endobj")},Un=function(N,ne){var je=nn(),Ee=Qr();ne.push({resourcesOid:je,objectOid:Ee}),N.objectNumber=Ee;var Ye=[];Ye.push({key:"Type",value:"/Pattern"}),Ye.push({key:"PatternType",value:"1"}),Ye.push({key:"PaintType",value:"1"}),Ye.push({key:"TilingType",value:"1"}),Ye.push({key:"BBox",value:"["+N.boundingBox.map(E).join(" ")+"]"}),Ye.push({key:"XStep",value:E(N.xStep)}),Ye.push({key:"YStep",value:E(N.yStep)}),Ye.push({key:"Resources",value:je+" 0 R"}),N.matrix&&Ye.push({key:"Matrix",value:"["+N.matrix.toString()+"]"}),an({data:N.stream,additionalKeyValues:Ye,objectId:N.objectNumber}),V("endobj")},Kn=function(N){var ne;for(ne in at)at.hasOwnProperty(ne)&&(at[ne]instanceof Ic?ro(at[ne]):at[ne]instanceof qu&&Un(at[ne],N))},Fi=function(N){for(var ne in N.objectNumber=Qr(),V("<<"),N)switch(ne){case"opacity":V("/ca "+z(N[ne]));break;case"stroke-opacity":V("/CA "+z(N[ne]))}V(">>"),V("endobj")},ji=function(){var N;for(N in Tt)Tt.hasOwnProperty(N)&&Fi(Tt[N])},Qe=function(){for(var N in V("/XObject <<"),rn)rn.hasOwnProperty(N)&&rn[N].objectNumber>=0&&V("/"+N+" "+rn[N].objectNumber+" 0 R");Er.publish("putXobjectDict"),V(">>")},Yt=function(){zn.oid=Qr(),V("<<"),V("/Filter /Standard"),V("/V "+zn.v),V("/R "+zn.r),V("/U <"+zn.toHexString(zn.U)+">"),V("/O <"+zn.toHexString(zn.O)+">"),V("/P "+zn.P),V(">>"),V("endobj")},sr=function(){for(var N in V("/Font <<"),Xe)Xe.hasOwnProperty(N)&&(f===!1||f===!0&&h.hasOwnProperty(N))&&V("/"+N+" "+Xe[N].objectNumber+" 0 R");V(">>")},Mr=function(){if(Object.keys(at).length>0){for(var N in V("/Shading <<"),at)at.hasOwnProperty(N)&&at[N]instanceof Ic&&at[N].objectNumber>=0&&V("/"+N+" "+at[N].objectNumber+" 0 R");Er.publish("putShadingPatternDict"),V(">>")}},Ar=function(N){if(Object.keys(at).length>0){for(var ne in V("/Pattern <<"),at)at.hasOwnProperty(ne)&&at[ne]instanceof p.TilingPattern&&at[ne].objectNumber>=0&&at[ne].objectNumber<N&&V("/"+ne+" "+at[ne].objectNumber+" 0 R");Er.publish("putTilingPatternDict"),V(">>")}},dn=function(){if(Object.keys(Tt).length>0){var N;for(N in V("/ExtGState <<"),Tt)Tt.hasOwnProperty(N)&&Tt[N].objectNumber>=0&&V("/"+N+" "+Tt[N].objectNumber+" 0 R");Er.publish("putGStateDict"),V(">>")}},Fr=function(N){Se(N.resourcesOid,!0),V("<<"),V("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),sr(),Mr(),Ar(N.objectOid),dn(),Qe(),V(">>"),V("endobj")},ta=function(){var N=[];Gt(),ji(),un(),Kn(N),Er.publish("putResources"),N.forEach(Fr),Fr({resourcesOid:Ct,objectOid:Number.MAX_SAFE_INTEGER}),Er.publish("postPutResources")},jn=function(){Er.publish("putAdditionalObjects");for(var N=0;N<he.length;N++){var ne=he[N];Se(ne.objId,!0),V(ne.content),V("endobj")}Er.publish("postPutAdditionalObjects")},Ia=function(N){Ue[N.fontName]=Ue[N.fontName]||{},Ue[N.fontName][N.fontStyle]=N.id},Na=function(N,ne,je,Ee,Ye){var dt={id:"F"+(Object.keys(Xe).length+1).toString(10),postScriptName:N,fontName:ne,fontStyle:je,encoding:Ee,isStandardFont:Ye||!1,metadata:{}};return Er.publish("addFont",{font:dt,instance:this}),Xe[dt.id]=dt,Ia(dt),dt.id},ai=function(N){for(var ne=0,je=Re.length;ne<je;ne++){var Ee=Na.call(this,N[ne][0],N[ne][1],N[ne][2],Re[ne][3],!0);f===!1&&(h[Ee]=!0);var Ye=N[ne][0].split("-");Ia({id:Ee,fontName:Ye[0],fontStyle:Ye[1]||""})}Er.publish("addFonts",{fonts:Xe,dictionary:Ue})},ra=function(N){return N.foo=function(){try{return N.apply(this,arguments)}catch(Ee){var ne=Ee.stack||"";~ne.indexOf(" at ")&&(ne=ne.split(" at ")[1]);var je="Error in function "+ne.split(`
`)[0].split("<")[0]+": "+Ee.message;if(!kr.console)throw new Error(je);kr.console.error(je,Ee),kr.alert&&alert(je)}},N.foo.bar=N,N.foo},On=function(N,ne){var je,Ee,Ye,dt,Pt,Wt,lr,Lr,Or;if(Ye=(ne=ne||{}).sourceEncoding||"Unicode",Pt=ne.outputEncoding,(ne.autoencode||Pt)&&Xe[Vt].metadata&&Xe[Vt].metadata[Ye]&&Xe[Vt].metadata[Ye].encoding&&(dt=Xe[Vt].metadata[Ye].encoding,!Pt&&Xe[Vt].encoding&&(Pt=Xe[Vt].encoding),!Pt&&dt.codePages&&(Pt=dt.codePages[0]),typeof Pt=="string"&&(Pt=dt[Pt]),Pt)){for(lr=!1,Wt=[],je=0,Ee=N.length;je<Ee;je++)(Lr=Pt[N.charCodeAt(je)])?Wt.push(String.fromCharCode(Lr)):Wt.push(N[je]),Wt[je].charCodeAt(0)>>8&&(lr=!0);N=Wt.join("")}for(je=N.length;lr===void 0&&je!==0;)N.charCodeAt(je-1)>>8&&(lr=!0),je--;if(!lr)return N;for(Wt=ne.noBOM?[]:[254,255],je=0,Ee=N.length;je<Ee;je++){if((Or=(Lr=N.charCodeAt(je))>>8)>>8)throw new Error("Character at position "+je+" of string '"+N+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");Wt.push(Or),Wt.push(Lr-(Or<<8))}return String.fromCharCode.apply(void 0,Wt)},Gr=p.__private__.pdfEscape=p.pdfEscape=function(N,ne){return On(N,ne).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},no=p.__private__.beginPage=function(N){me[++qr]=[],ar[qr]={objId:0,contentsObjId:0,userUnit:Number(l),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(N[0]),topRightY:Number(N[1])}},Si(qr),se(me[L])},ao=function(N,ne){var je,Ee,Ye;switch(r=ne||r,typeof N=="string"&&(je=b(N.toLowerCase()),Array.isArray(je)&&(Ee=je[0],Ye=je[1])),Array.isArray(N)&&(Ee=N[0]*jt,Ye=N[1]*jt),isNaN(Ee)&&(Ee=a[0],Ye=a[1]),(Ee>14400||Ye>14400)&&(Tn.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Ee=Math.min(14400,Ee),Ye=Math.min(14400,Ye)),a=[Ee,Ye],r.substr(0,1)){case"l":Ye>Ee&&(a=[Ye,Ee]);break;case"p":Ee>Ye&&(a=[Ye,Ee])}no(a),Us(Bs),V(Lt),Oi!==0&&V(Oi+" J"),si!==0&&V(si+" j"),Er.publish("addPage",{pageNumber:qr})},io=function(N){N>0&&N<=qr&&(me.splice(N,1),ar.splice(N,1),qr--,L>qr&&(L=qr),this.setPage(L))},Si=function(N){N>0&&N<=qr&&(L=N)},oo=p.__private__.getNumberOfPages=p.getNumberOfPages=function(){return me.length-1},pi=function(N,ne,je){var Ee,Ye=void 0;return je=je||{},N=N!==void 0?N:Xe[Vt].fontName,ne=ne!==void 0?ne:Xe[Vt].fontStyle,Ee=N.toLowerCase(),Ue[Ee]!==void 0&&Ue[Ee][ne]!==void 0?Ye=Ue[Ee][ne]:Ue[N]!==void 0&&Ue[N][ne]!==void 0?Ye=Ue[N][ne]:je.disableWarning===!1&&Tn.warn("Unable to look up font label for font '"+N+"', '"+ne+"'. Refer to getFontList() for available fonts."),Ye||je.noFallback||(Ye=Ue.times[ne])==null&&(Ye=Ue.times.normal),Ye},Oo=p.__private__.putInfo=function(){var N=Qr(),ne=function(Ee){return Ee};for(var je in d!==null&&(ne=zn.encryptor(N,0)),V("<<"),V("/Producer ("+Gr(ne("jsPDF "+Sr.version))+")"),kt)kt.hasOwnProperty(je)&&kt[je]&&V("/"+je.substr(0,1).toUpperCase()+je.substr(1)+" ("+Gr(ne(kt[je]))+")");V("/CreationDate ("+Gr(ne(W))+")"),V(">>"),V("endobj")},$i=p.__private__.putCatalog=function(N){var ne=(N=N||{}).rootDictionaryObjId||it;switch(Qr(),V("<<"),V("/Type /Catalog"),V("/Pages "+ne+" 0 R"),nt||(nt="fullwidth"),nt){case"fullwidth":V("/OpenAction [3 0 R /FitH null]");break;case"fullheight":V("/OpenAction [3 0 R /FitV null]");break;case"fullpage":V("/OpenAction [3 0 R /Fit]");break;case"original":V("/OpenAction [3 0 R /XYZ null null 1]");break;default:var je=""+nt;je.substr(je.length-1)==="%"&&(nt=parseInt(nt)/100),typeof nt=="number"&&V("/OpenAction [3 0 R /XYZ null null "+z(nt)+"]")}switch(We||(We="continuous"),We){case"continuous":V("/PageLayout /OneColumn");break;case"single":V("/PageLayout /SinglePage");break;case"two":case"twoleft":V("/PageLayout /TwoColumnLeft");break;case"tworight":V("/PageLayout /TwoColumnRight")}Ge&&V("/PageMode /"+Ge),Er.publish("putCatalog"),V(">>"),V("endobj")},fs=p.__private__.putTrailer=function(){V("trailer"),V("<<"),V("/Size "+(te+1)),V("/Root "+te+" 0 R"),V("/Info "+(te-1)+" 0 R"),d!==null&&V("/Encrypt "+zn.oid+" 0 R"),V("/ID [ <"+K+"> <"+K+"> ]"),V(">>")},so=p.__private__.putHeader=function(){V("%PDF-"+g),V("%")},hs=p.__private__.putXRef=function(){var N="0000000000";V("xref"),V("0 "+(te+1)),V("0000000000 65535 f ");for(var ne=1;ne<=te;ne++)typeof le[ne]=="function"?V((N+le[ne]()).slice(-10)+" 00000 n "):le[ne]!==void 0?V((N+le[ne]).slice(-10)+" 00000 n "):V("0000000000 00000 n ")},Qa=p.__private__.buildDocument=function(){ee(),se(oe),Er.publish("buildDocument"),so(),tt(),jn(),ta(),d!==null&&Yt(),Oo(),$i();var N=ae;return hs(),fs(),V("startxref"),V(""+N),V("%%EOF"),se(me[L]),oe.join(`
`)},lo=p.__private__.getBlob=function(N){return new Blob([Ne(N)],{type:"application/pdf"})},ii=p.output=p.__private__.output=ra(function(N,ne){switch(typeof(ne=ne||{})=="string"?ne={filename:ne}:ne.filename=ne.filename||"generated.pdf",N){case void 0:return Qa();case"save":p.save(ne.filename);break;case"arraybuffer":return Ne(Qa());case"blob":return lo(Qa());case"bloburi":case"bloburl":if(kr.URL!==void 0&&typeof kr.URL.createObjectURL=="function")return kr.URL&&kr.URL.createObjectURL(lo(Qa()))||void 0;Tn.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var je="",Ee=Qa();try{je=Ew(Ee)}catch{je=Ew(unescape(encodeURIComponent(Ee)))}return"data:application/pdf;filename="+ne.filename+";base64,"+je;case"pdfobjectnewwindow":if(Object.prototype.toString.call(kr)==="[object Window]"){var Ye="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",dt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';ne.pdfObjectUrl&&(Ye=ne.pdfObjectUrl,dt="");var Pt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Ye+'"'+dt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(ne)+");<\/script></body></html>",Wt=kr.open();return Wt!==null&&Wt.document.write(Pt),Wt}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(kr)==="[object Window]"){var lr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(ne.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+ne.filename+'" width="500px" height="400px" /></body></html>',Lr=kr.open();if(Lr!==null){Lr.document.write(lr);var Or=this;Lr.document.documentElement.querySelector("#pdfViewer").onload=function(){Lr.document.title=ne.filename,Lr.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Or.output("bloburl"))}}return Lr}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(kr)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Xr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",ne)+'"></iframe></body></html>',Ln=kr.open();if(Ln!==null&&(Ln.document.write(Xr),Ln.document.title=ne.filename),Ln||typeof safari>"u")return Ln;break;case"datauri":case"dataurl":return kr.document.location.href=this.output("datauristring",ne);default:return null}}),dc=function(N){return Array.isArray(Ir)===!0&&Ir.indexOf(N)>-1};switch(n){case"pt":jt=1;break;case"mm":jt=72/25.4;break;case"cm":jt=72/2.54;break;case"in":jt=72;break;case"px":jt=dc("px_scaling")==1?.75:96/72;break;case"pc":case"em":jt=12;break;case"ex":jt=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);jt=n}var zn=null;Q(),D();var Yo=function(N){return d!==null?zn.encryptor(N,0):function(ne){return ne}},ko=p.__private__.getPageInfo=p.getPageInfo=function(N){if(isNaN(N)||N%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:ar[N].objId,pageNumber:N,pageContext:ar[N]}},wr=p.__private__.getPageInfoByObjId=function(N){if(isNaN(N)||N%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var ne in ar)if(ar[ne].objId===N)break;return ko(ne)},Al=p.__private__.getCurrentPageInfo=p.getCurrentPageInfo=function(){return{objId:ar[L].objId,pageNumber:L,pageContext:ar[L]}};p.addPage=function(){return ao.apply(this,arguments),this},p.setPage=function(){return Si.apply(this,arguments),se.call(this,me[L]),this},p.insertPage=function(N){return this.addPage(),this.movePage(L,N),this},p.movePage=function(N,ne){var je,Ee;if(N>ne){je=me[N],Ee=ar[N];for(var Ye=N;Ye>ne;Ye--)me[Ye]=me[Ye-1],ar[Ye]=ar[Ye-1];me[ne]=je,ar[ne]=Ee,this.setPage(ne)}else if(N<ne){je=me[N],Ee=ar[N];for(var dt=N;dt<ne;dt++)me[dt]=me[dt+1],ar[dt]=ar[dt+1];me[ne]=je,ar[ne]=Ee,this.setPage(ne)}return this},p.deletePage=function(){return io.apply(this,arguments),this},p.__private__.text=p.text=function(N,ne,je,Ee,Ye){var dt,Pt,Wt,lr,Lr,Or,Xr,Ln,Wn,aa=(Ee=Ee||{}).scope||this;if(typeof N=="number"&&typeof ne=="number"&&(typeof je=="string"||Array.isArray(je))){var za=je;je=ne,ne=N,N=za}if(arguments[3]instanceof rr?(S("The transform parameter of text() with a Matrix value"),Wn=Ye):(Wt=arguments[4],lr=arguments[5],xn(Xr=arguments[3])==="object"&&Xr!==null||(typeof Wt=="string"&&(lr=Wt,Wt=null),typeof Xr=="string"&&(lr=Xr,Xr=null),typeof Xr=="number"&&(Wt=Xr,Xr=null),Ee={flags:Xr,angle:Wt,align:lr})),isNaN(ne)||isNaN(je)||N==null)throw new Error("Invalid arguments passed to jsPDF.text");if(N.length===0)return aa;var Ma="",fo=!1,Ti=typeof Ee.lineHeightFactor=="number"?Ee.lineHeightFactor:Pi,No=aa.internal.scaleFactor;function uu(Rn){return Rn=Rn.split("	").join(Array(Ee.TabLen||9).join(" ")),Gr(Rn,Xr)}function mc(Rn){for(var qn,_a=Rn.concat(),Wa=[],Ys=_a.length;Ys--;)typeof(qn=_a.shift())=="string"?Wa.push(qn):Array.isArray(Rn)&&(qn.length===1||qn[1]===void 0&&qn[2]===void 0)?Wa.push(qn[0]):Wa.push([qn[0],qn[1],qn[2]]);return Wa}function Ol(Rn,qn){var _a;if(typeof Rn=="string")_a=qn(Rn)[0];else if(Array.isArray(Rn)){for(var Wa,Ys,Yd=Rn.concat(),pu=[],Yp=Yd.length;Yp--;)typeof(Wa=Yd.shift())=="string"?pu.push(qn(Wa)[0]):Array.isArray(Wa)&&typeof Wa[0]=="string"&&(Ys=qn(Wa[0],Wa[1],Wa[2]),pu.push([Ys[0],Ys[1],Ys[2]]));_a=pu}return _a}var kl=!1,gc=!0;if(typeof N=="string")kl=!0;else if(Array.isArray(N)){var Tl=N.concat();Pt=[];for(var zs,fa=Tl.length;fa--;)(typeof(zs=Tl.shift())!="string"||Array.isArray(zs)&&typeof zs[0]!="string")&&(gc=!1);kl=gc}if(kl===!1)throw new Error('Type of text must be string or Array. "'+N+'" is not recognized.');typeof N=="string"&&(N=N.match(/[\r?\n]/)?N.split(/\r\n|\r|\n/g):[N]);var El=Ke/aa.internal.scaleFactor,de=El*(Ti-1);switch(Ee.baseline){case"bottom":je-=de;break;case"top":je+=El-de;break;case"hanging":je+=El-2*de;break;case"middle":je+=El/2-de}if((Or=Ee.maxWidth||0)>0&&(typeof N=="string"?N=aa.splitTextToSize(N,Or):Object.prototype.toString.call(N)==="[object Array]"&&(N=N.reduce(function(Rn,qn){return Rn.concat(aa.splitTextToSize(qn,Or))},[]))),dt={text:N,x:ne,y:je,options:Ee,mutex:{pdfEscape:Gr,activeFontKey:Vt,fonts:Xe,activeFontSize:Ke}},Er.publish("preProcessText",dt),N=dt.text,Wt=(Ee=dt.options).angle,!(Wn instanceof rr)&&Wt&&typeof Wt=="number"){Wt*=Math.PI/180,Ee.rotationDirection===0&&(Wt=-Wt),w===_.ADVANCED&&(Wt=-Wt);var pe=Math.cos(Wt),ke=Math.sin(Wt);Wn=new rr(pe,ke,-ke,pe,0,0)}else Wt&&Wt instanceof rr&&(Wn=Wt);w!==_.ADVANCED||Wn||(Wn=Yn),(Lr=Ee.charSpace||na)!==void 0&&(Ma+=E(M(Lr))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Ln=Ee.horizontalScale)!==void 0&&(Ma+=E(100*Ln)+` Tz
`),Ee.lang;var Oe=-1,rt=Ee.renderingMode!==void 0?Ee.renderingMode:Ee.stroke,bt=aa.internal.getCurrentPageInfo().pageContext;switch(rt){case 0:case!1:case"fill":Oe=0;break;case 1:case!0:case"stroke":Oe=1;break;case 2:case"fillThenStroke":Oe=2;break;case 3:case"invisible":Oe=3;break;case 4:case"fillAndAddForClipping":Oe=4;break;case 5:case"strokeAndAddPathForClipping":Oe=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Oe=6;break;case 7:case"addToPathForClipping":Oe=7}var Ut=bt.usedRenderingMode!==void 0?bt.usedRenderingMode:-1;Oe!==-1?Ma+=Oe+` Tr
`:Ut!==-1&&(Ma+=`0 Tr
`),Oe!==-1&&(bt.usedRenderingMode=Oe),lr=Ee.align||"left";var Dt,fr=Ke*Ti,Xn=aa.internal.pageSize.getWidth(),xa=Xe[Vt];Lr=Ee.charSpace||na,Or=Ee.maxWidth||0,Xr=Object.assign({autoencode:!0,noBOM:!0},Ee.flags);var Vi=[],Ws=function(Rn){return aa.getStringUnitWidth(Rn,{font:xa,charSpace:Lr,fontSize:Ke,doKerning:!1})*Ke/No};if(Object.prototype.toString.call(N)==="[object Array]"){var Gi;Pt=mc(N),lr!=="left"&&(Dt=Pt.map(Ws));var Ei,Il=0;if(lr==="right"){ne-=Dt[0],N=[],fa=Pt.length;for(var Hs=0;Hs<fa;Hs++)Hs===0?(Ei=De(ne),Gi=Ie(je)):(Ei=M(Il-Dt[Hs]),Gi=-fr),N.push([Pt[Hs],Ei,Gi]),Il=Dt[Hs]}else if(lr==="center"){ne-=Dt[0]/2,N=[],fa=Pt.length;for(var Vs=0;Vs<fa;Vs++)Vs===0?(Ei=De(ne),Gi=Ie(je)):(Ei=M((Il-Dt[Vs])/2),Gi=-fr),N.push([Pt[Vs],Ei,Gi]),Il=Dt[Vs]}else if(lr==="left"){N=[],fa=Pt.length;for(var du=0;du<fa;du++)N.push(Pt[du])}else if(lr==="justify"&&xa.encoding==="Identity-H"){N=[],fa=Pt.length,Or=Or!==0?Or:Xn;for(var Gs=0,ba=0;ba<fa;ba++)if(Gi=ba===0?Ie(je):-fr,Ei=ba===0?De(ne):Gs,ba<fa-1){var Hd=M((Or-Dt[ba])/(Pt[ba].split(" ").length-1)),Ii=Pt[ba].split(" ");N.push([Ii[0]+" ",Ei,Gi]),Gs=0;for(var Do=1;Do<Ii.length;Do++){var fu=(Ws(Ii[Do-1]+" "+Ii[Do])-Ws(Ii[Do]))*No+Hd;Do==Ii.length-1?N.push([Ii[Do],fu,0]):N.push([Ii[Do]+" ",fu,0]),Gs-=fu}}else N.push([Pt[ba],Ei,Gi]);N.push(["",Gs,0])}else{if(lr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(N=[],fa=Pt.length,Or=Or!==0?Or:Xn,ba=0;ba<fa;ba++)Gi=ba===0?Ie(je):-fr,Ei=ba===0?De(ne):0,ba<fa-1?Vi.push(E(M((Or-Dt[ba])/(Pt[ba].split(" ").length-1)))):Vi.push(0),N.push([Pt[ba],Ei,Gi])}}var Gp=typeof Ee.R2L=="boolean"?Ee.R2L:gt;Gp===!0&&(N=Ol(N,function(Rn,qn,_a){return[Rn.split("").reverse().join(""),qn,_a]})),dt={text:N,x:ne,y:je,options:Ee,mutex:{pdfEscape:Gr,activeFontKey:Vt,fonts:Xe,activeFontSize:Ke}},Er.publish("postProcessText",dt),N=dt.text,fo=dt.mutex.isHex||!1;var Vd=Xe[Vt].encoding;Vd!=="WinAnsiEncoding"&&Vd!=="StandardEncoding"||(N=Ol(N,function(Rn,qn,_a){return[uu(Rn),qn,_a]})),Pt=mc(N),N=[];for(var vc,yc,Nl,xc=0,hu=1,bc=Array.isArray(Pt[0])?hu:xc,Dl="",Gd=function(Rn,qn,_a){var Wa="";return _a instanceof rr?(_a=typeof Ee.angle=="number"?Kr(_a,new rr(1,0,0,1,Rn,qn)):Kr(new rr(1,0,0,1,Rn,qn),_a),w===_.ADVANCED&&(_a=Kr(new rr(1,0,0,-1,0,0),_a)),Wa=_a.join(" ")+` Tm
`):Wa=E(Rn)+" "+E(qn)+` Td
`,Wa},Mo=0;Mo<Pt.length;Mo++){switch(Dl="",bc){case hu:Nl=(fo?"<":"(")+Pt[Mo][0]+(fo?">":")"),vc=parseFloat(Pt[Mo][1]),yc=parseFloat(Pt[Mo][2]);break;case xc:Nl=(fo?"<":"(")+Pt[Mo]+(fo?">":")"),vc=De(ne),yc=Ie(je)}Vi!==void 0&&Vi[Mo]!==void 0&&(Dl=Vi[Mo]+` Tw
`),Mo===0?N.push(Dl+Gd(vc,yc,Wn)+Nl):bc===xc?N.push(Dl+Nl):bc===hu&&N.push(Dl+Gd(vc,yc,Wn)+Nl)}N=bc===xc?N.join(` Tj
T* `):N.join(` Tj
`),N+=` Tj
`;var Lo=`BT
/`;return Lo+=Vt+" "+Ke+` Tf
`,Lo+=E(Ke*Ti)+` TL
`,Lo+=Hr+`
`,Lo+=Ma,Lo+=N,V(Lo+="ET"),h[Vt]=!0,aa};var fc=p.__private__.clip=p.clip=function(N){return V(N==="evenodd"?"W*":"W"),this};p.clipEvenOdd=function(){return fc("evenodd")},p.__private__.discardPath=p.discardPath=function(){return V("n"),this};var Ci=p.__private__.isValidStyle=function(N){var ne=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(N)!==-1&&(ne=!0),ne};p.__private__.setDefaultPathOperation=p.setDefaultPathOperation=function(N){return Ci(N)&&(u=N),this};var Fs=p.__private__.getStyle=p.getStyle=function(N){var ne=u;switch(N){case"D":case"S":ne="S";break;case"F":ne="f";break;case"FD":case"DF":ne="B";break;case"f":case"f*":case"B":case"B*":ne=N}return ne},Ai=p.close=function(){return V("h"),this};p.stroke=function(){return V("S"),this},p.fill=function(N){return Ko("f",N),this},p.fillEvenOdd=function(N){return Ko("f*",N),this},p.fillStroke=function(N){return Ko("B",N),this},p.fillStrokeEvenOdd=function(N){return Ko("B*",N),this};var Ko=function(N,ne){xn(ne)==="object"?hc(ne,N):V(N)},oi=function(N){N===null||w===_.ADVANCED&&N===void 0||(N=Fs(N),V(N))};function Bi(N,ne,je,Ee,Ye){var dt=new qu(ne||this.boundingBox,je||this.xStep,Ee||this.yStep,this.gState,Ye||this.matrix);dt.stream=this.stream;var Pt=N+"$$"+this.cloneIndex+++"$$";return Mn(Pt,dt),dt}var hc=function(N,ne){var je=wt[N.key],Ee=at[je];if(Ee instanceof Ic)V("q"),V($s(ne)),Ee.gState&&p.setGState(Ee.gState),V(N.matrix.toString()+" cm"),V("/"+je+" sh"),V("Q");else if(Ee instanceof qu){var Ye=new rr(1,0,0,-1,0,li());N.matrix&&(Ye=Ye.multiply(N.matrix||Yn),je=Bi.call(Ee,N.key,N.boundingBox,N.xStep,N.yStep,Ye).id),V("q"),V("/Pattern cs"),V("/"+je+" scn"),Ee.gState&&p.setGState(Ee.gState),V(ne),V("Q")}},$s=function(N){switch(N){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},co=p.moveTo=function(N,ne){return V(E(M(N))+" "+E(F(ne))+" m"),this},To=p.lineTo=function(N,ne){return V(E(M(N))+" "+E(F(ne))+" l"),this},Eo=p.curveTo=function(N,ne,je,Ee,Ye,dt){return V([E(M(N)),E(F(ne)),E(M(je)),E(F(Ee)),E(M(Ye)),E(F(dt)),"c"].join(" ")),this};p.__private__.line=p.line=function(N,ne,je,Ee,Ye){if(isNaN(N)||isNaN(ne)||isNaN(je)||isNaN(Ee)||!Ci(Ye))throw new Error("Invalid arguments passed to jsPDF.line");return w===_.COMPAT?this.lines([[je-N,Ee-ne]],N,ne,[1,1],Ye||"S"):this.lines([[je-N,Ee-ne]],N,ne,[1,1]).stroke()},p.__private__.lines=p.lines=function(N,ne,je,Ee,Ye,dt){var Pt,Wt,lr,Lr,Or,Xr,Ln,Wn,aa,za,Ma,fo;if(typeof N=="number"&&(fo=je,je=ne,ne=N,N=fo),Ee=Ee||[1,1],dt=dt||!1,isNaN(ne)||isNaN(je)||!Array.isArray(N)||!Array.isArray(Ee)||!Ci(Ye)||typeof dt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(co(ne,je),Pt=Ee[0],Wt=Ee[1],Lr=N.length,za=ne,Ma=je,lr=0;lr<Lr;lr++)(Or=N[lr]).length===2?(za=Or[0]*Pt+za,Ma=Or[1]*Wt+Ma,To(za,Ma)):(Xr=Or[0]*Pt+za,Ln=Or[1]*Wt+Ma,Wn=Or[2]*Pt+za,aa=Or[3]*Wt+Ma,za=Or[4]*Pt+za,Ma=Or[5]*Wt+Ma,Eo(Xr,Ln,Wn,aa,za,Ma));return dt&&Ai(),oi(Ye),this},p.path=function(N){for(var ne=0;ne<N.length;ne++){var je=N[ne],Ee=je.c;switch(je.op){case"m":co(Ee[0],Ee[1]);break;case"l":To(Ee[0],Ee[1]);break;case"c":Eo.apply(this,Ee);break;case"h":Ai()}}return this},p.__private__.rect=p.rect=function(N,ne,je,Ee,Ye){if(isNaN(N)||isNaN(ne)||isNaN(je)||isNaN(Ee)||!Ci(Ye))throw new Error("Invalid arguments passed to jsPDF.rect");return w===_.COMPAT&&(Ee=-Ee),V([E(M(N)),E(F(ne)),E(M(je)),E(M(Ee)),"re"].join(" ")),oi(Ye),this},p.__private__.triangle=p.triangle=function(N,ne,je,Ee,Ye,dt,Pt){if(isNaN(N)||isNaN(ne)||isNaN(je)||isNaN(Ee)||isNaN(Ye)||isNaN(dt)||!Ci(Pt))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[je-N,Ee-ne],[Ye-je,dt-Ee],[N-Ye,ne-dt]],N,ne,[1,1],Pt,!0),this},p.__private__.roundedRect=p.roundedRect=function(N,ne,je,Ee,Ye,dt,Pt){if(isNaN(N)||isNaN(ne)||isNaN(je)||isNaN(Ee)||isNaN(Ye)||isNaN(dt)||!Ci(Pt))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Wt=4/3*(Math.SQRT2-1);return Ye=Math.min(Ye,.5*je),dt=Math.min(dt,.5*Ee),this.lines([[je-2*Ye,0],[Ye*Wt,0,Ye,dt-dt*Wt,Ye,dt],[0,Ee-2*dt],[0,dt*Wt,-Ye*Wt,dt,-Ye,dt],[2*Ye-je,0],[-Ye*Wt,0,-Ye,-dt*Wt,-Ye,-dt],[0,2*dt-Ee],[0,-dt*Wt,Ye*Wt,-dt,Ye,-dt]],N+Ye,ne,[1,1],Pt,!0),this},p.__private__.ellipse=p.ellipse=function(N,ne,je,Ee,Ye){if(isNaN(N)||isNaN(ne)||isNaN(je)||isNaN(Ee)||!Ci(Ye))throw new Error("Invalid arguments passed to jsPDF.ellipse");var dt=4/3*(Math.SQRT2-1)*je,Pt=4/3*(Math.SQRT2-1)*Ee;return co(N+je,ne),Eo(N+je,ne-Pt,N+dt,ne-Ee,N,ne-Ee),Eo(N-dt,ne-Ee,N-je,ne-Pt,N-je,ne),Eo(N-je,ne+Pt,N-dt,ne+Ee,N,ne+Ee),Eo(N+dt,ne+Ee,N+je,ne+Pt,N+je,ne),oi(Ye),this},p.__private__.circle=p.circle=function(N,ne,je,Ee){if(isNaN(N)||isNaN(ne)||isNaN(je)||!Ci(Ee))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(N,ne,je,je,Ee)},p.setFont=function(N,ne,je){return je&&(ne=T(ne,je)),Vt=pi(N,ne,{disableWarning:!1}),this};var Pl=p.__private__.getFont=p.getFont=function(){return Xe[pi.apply(p,arguments)]};p.__private__.getFontList=p.getFontList=function(){var N,ne,je={};for(N in Ue)if(Ue.hasOwnProperty(N))for(ne in je[N]=[],Ue[N])Ue[N].hasOwnProperty(ne)&&je[N].push(ne);return je},p.addFont=function(N,ne,je,Ee,Ye){var dt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&dt.indexOf(arguments[3])!==-1?Ye=arguments[3]:arguments[3]&&dt.indexOf(arguments[3])==-1&&(je=T(je,Ee)),Ye=Ye||"Identity-H",Na.call(this,N,ne,je,Ye)};var Pi,Bs=e.lineWidth||.200025,Ui=p.__private__.getLineWidth=p.getLineWidth=function(){return Bs},Us=p.__private__.setLineWidth=p.setLineWidth=function(N){return Bs=N,V(E(M(N))+" w"),this};p.__private__.setLineDash=Sr.API.setLineDash=Sr.API.setLineDashPattern=function(N,ne){if(N=N||[],ne=ne||0,isNaN(ne)||!Array.isArray(N))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return N=N.map(function(je){return E(M(je))}).join(" "),ne=E(M(ne)),V("["+N+"] "+ne+" d"),this};var be=p.__private__.getLineHeight=p.getLineHeight=function(){return Ke*Pi};p.__private__.getLineHeight=p.getLineHeight=function(){return Ke*Pi};var we=p.__private__.setLineHeightFactor=p.setLineHeightFactor=function(N){return typeof(N=N||1.15)=="number"&&(Pi=N),this},Te=p.__private__.getLineHeightFactor=p.getLineHeightFactor=function(){return Pi};we(e.lineHeight);var De=p.__private__.getHorizontalCoordinate=function(N){return M(N)},Ie=p.__private__.getVerticalCoordinate=function(N){return w===_.ADVANCED?N:ar[L].mediaBox.topRightY-ar[L].mediaBox.bottomLeftY-M(N)},pt=p.__private__.getHorizontalCoordinateString=p.getHorizontalCoordinateString=function(N){return E(De(N))},Et=p.__private__.getVerticalCoordinateString=p.getVerticalCoordinateString=function(N){return E(Ie(N))},Lt=e.strokeColor||"0 G";p.__private__.getStrokeColor=p.getDrawColor=function(){return Bt(Lt)},p.__private__.setStrokeColor=p.setDrawColor=function(N,ne,je,Ee){return Lt=Ht({ch1:N,ch2:ne,ch3:je,ch4:Ee,pdfColorType:"draw",precision:2}),V(Lt),this};var Pr=e.fillColor||"0 g";p.__private__.getFillColor=p.getFillColor=function(){return Bt(Pr)},p.__private__.setFillColor=p.setFillColor=function(N,ne,je,Ee){return Pr=Ht({ch1:N,ch2:ne,ch3:je,ch4:Ee,pdfColorType:"fill",precision:2}),V(Pr),this};var Hr=e.textColor||"0 g",gn=p.__private__.getTextColor=p.getTextColor=function(){return Bt(Hr)};p.__private__.setTextColor=p.setTextColor=function(N,ne,je,Ee){return Hr=Ht({ch1:N,ch2:ne,ch3:je,ch4:Ee,pdfColorType:"text",precision:3}),this};var na=e.charSpace,Qn=p.__private__.getCharSpace=p.getCharSpace=function(){return parseFloat(na||0)};p.__private__.setCharSpace=p.setCharSpace=function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return na=N,this};var Oi=0;p.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},p.__private__.setLineCap=p.setLineCap=function(N){var ne=p.CapJoinStyles[N];if(ne===void 0)throw new Error("Line cap style of '"+N+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Oi=ne,V(ne+" J"),this};var si=0;p.__private__.setLineJoin=p.setLineJoin=function(N){var ne=p.CapJoinStyles[N];if(ne===void 0)throw new Error("Line join style of '"+N+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return si=ne,V(ne+" j"),this},p.__private__.setLineMiterLimit=p.__private__.setMiterLimit=p.setLineMiterLimit=p.setMiterLimit=function(N){if(N=N||0,isNaN(N))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return V(E(M(N))+" M"),this},p.GState=_v,p.setGState=function(N){(N=typeof N=="string"?Tt[Jt[N]]:Da(null,N)).equals(Dr)||(V("/"+N.id+" gs"),Dr=N)};var Da=function(N,ne){if(!N||!Jt[N]){var je=!1;for(var Ee in Tt)if(Tt.hasOwnProperty(Ee)&&Tt[Ee].equals(ne)){je=!0;break}if(je)ne=Tt[Ee];else{var Ye="GS"+(Object.keys(Tt).length+1).toString(10);Tt[Ye]=ne,ne.id=Ye}return N&&(Jt[N]=ne.id),Er.publish("addGState",ne),ne}};p.addGState=function(N,ne){return Da(N,ne),this},p.saveGraphicsState=function(){return V("q"),ht.push({key:Vt,size:Ke,color:Hr}),this},p.restoreGraphicsState=function(){V("Q");var N=ht.pop();return Vt=N.key,Ke=N.size,Hr=N.color,Dr=null,this},p.setCurrentTransformationMatrix=function(N){return V(N.toString()+" cm"),this},p.comment=function(N){return V("#"+N),this};var Ua=function(N,ne){var je=N||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return je},set:function(dt){isNaN(dt)||(je=parseFloat(dt))}});var Ee=ne||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Ee},set:function(dt){isNaN(dt)||(Ee=parseFloat(dt))}});var Ye="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Ye},set:function(dt){Ye=dt.toString()}}),this},zi=function(N,ne,je,Ee){Ua.call(this,N,ne),this.type="rect";var Ye=je||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Ye},set:function(Pt){isNaN(Pt)||(Ye=parseFloat(Pt))}});var dt=Ee||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return dt},set:function(Pt){isNaN(Pt)||(dt=parseFloat(Pt))}}),this},uo=function(){this.page=qr,this.currentPage=L,this.pages=me.slice(0),this.pagesContext=ar.slice(0),this.x=Tr,this.y=qe,this.matrix=$e,this.width=Hi(L),this.height=li(L),this.outputDestination=G,this.id="",this.objectNumber=-1};uo.prototype.restore=function(){qr=this.page,L=this.currentPage,ar=this.pagesContext,me=this.pages,Tr=this.x,qe=this.y,$e=this.matrix,ps(L,this.width),pc(L,this.height),G=this.outputDestination};var Io=function(N,ne,je,Ee,Ye){Dn.push(new uo),qr=L=0,me=[],Tr=N,qe=ne,$e=Ye,no([je,Ee])},ki=function(N){if(Ta[N])Dn.pop().restore();else{var ne=new uo,je="Xo"+(Object.keys(rn).length+1).toString(10);ne.id=je,Ta[N]=je,rn[je]=ne,Er.publish("addFormObject",ne),Dn.pop().restore()}};for(var Wi in p.beginFormObject=function(N,ne,je,Ee,Ye){return Io(N,ne,je,Ee,Ye),this},p.endFormObject=function(N){return ki(N),this},p.doFormObject=function(N,ne){var je=rn[Ta[N]];return V("q"),V(ne.toString()+" cm"),V("/"+je.id+" Do"),V("Q"),this},p.getFormObject=function(N){var ne=rn[Ta[N]];return{x:ne.x,y:ne.y,width:ne.width,height:ne.height,matrix:ne.matrix}},p.save=function(N,ne){return N=N||"generated.pdf",(ne=ne||{}).returnPromise=ne.returnPromise||!1,ne.returnPromise===!1?(Tc(lo(Qa()),N),typeof Tc.unload=="function"&&kr.setTimeout&&setTimeout(Tc.unload,911),this):new Promise(function(je,Ee){try{var Ye=Tc(lo(Qa()),N);typeof Tc.unload=="function"&&kr.setTimeout&&setTimeout(Tc.unload,911),je(Ye)}catch(dt){Ee(dt.message)}})},Sr.API)Sr.API.hasOwnProperty(Wi)&&(Wi==="events"&&Sr.API.events.length?function(N,ne){var je,Ee,Ye;for(Ye=ne.length-1;Ye!==-1;Ye--)je=ne[Ye][0],Ee=ne[Ye][1],N.subscribe.apply(N,[je].concat(typeof Ee=="function"?[Ee]:Ee))}(Er,Sr.API.events):p[Wi]=Sr.API[Wi]);var Hi=p.getPageWidth=function(N){return(ar[N=N||L].mediaBox.topRightX-ar[N].mediaBox.bottomLeftX)/jt},ps=p.setPageWidth=function(N,ne){ar[N].mediaBox.topRightX=ne*jt+ar[N].mediaBox.bottomLeftX},li=p.getPageHeight=function(N){return(ar[N=N||L].mediaBox.topRightY-ar[N].mediaBox.bottomLeftY)/jt},pc=p.setPageHeight=function(N,ne){ar[N].mediaBox.topRightY=ne*jt+ar[N].mediaBox.bottomLeftY};return p.internal={pdfEscape:Gr,getStyle:Fs,getFont:Pl,getFontSize:st,getCharSpace:Qn,getTextColor:gn,getLineHeight:be,getLineHeightFactor:Te,getLineWidth:Ui,write:He,getHorizontalCoordinate:De,getVerticalCoordinate:Ie,getCoordinateString:pt,getVerticalCoordinateString:Et,collections:{},newObject:Qr,newAdditionalObject:Ve,newObjectDeferred:nn,newObjectDeferredBegin:Se,getFilters:mr,putStream:an,events:Er,scaleFactor:jt,pageSize:{getWidth:function(){return Hi(L)},setWidth:function(N){ps(L,N)},getHeight:function(){return li(L)},setHeight:function(N){pc(L,N)}},encryptionOptions:d,encryption:zn,getEncryptor:Yo,output:ii,getNumberOfPages:oo,pages:me,out:V,f2:z,f3:k,getPageInfo:ko,getPageInfoByObjId:wr,getCurrentPageInfo:Al,getPDFVersion:m,Point:Ua,Rectangle:zi,Matrix:rr,hasHotfix:dc},Object.defineProperty(p.internal.pageSize,"width",{get:function(){return Hi(L)},set:function(N){ps(L,N)},enumerable:!0,configurable:!0}),Object.defineProperty(p.internal.pageSize,"height",{get:function(){return li(L)},set:function(N){pc(L,N)},enumerable:!0,configurable:!0}),ai.call(p,Re),Vt="F1",ao(a,r),Er.publish("initialized"),p}ku.prototype.lsbFirstWord=function(e){return String.fromCharCode(e>>0&255,e>>8&255,e>>16&255,e>>24&255)},ku.prototype.toHexString=function(e){return e.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},ku.prototype.hexToBytes=function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(String.fromCharCode(parseInt(e.substr(r,2),16)));return t.join("")},ku.prototype.processOwnerPassword=function(e,t){return Nw(Iw(t).substr(0,5),e)},ku.prototype.encryptor=function(e,t){var r=Iw(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(n){return Nw(r,n)}},_v.prototype.equals=function(e){var t,r="id,objectNumber,equals";if(!e||xn(e)!==xn(this))return!1;var n=0;for(t in this)if(!(r.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t)||this[t]!==e[t])return!1;n++}for(t in e)e.hasOwnProperty(t)&&r.indexOf(t)<0&&n--;return n===0},Sr.API={events:[]},Sr.version="3.0.1";var pa=Sr.API,jS=1,cu=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Cu=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},$r=function(e){return e.toFixed(2)},Wl=function(e){return e.toFixed(5)};pa.__acroform__={};var to=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},YE=function(e){return e*jS},ys=function(e){var t=new L6,r=er.internal.getHeight(e)||0,n=er.internal.getWidth(e)||0;return t.BBox=[0,0,Number($r(n)),Number($r(r))],t},Kle=pa.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|=1<<t},Qle=pa.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&=~(1<<t)},Xle=pa.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return(e&1<<t)==0?0:1},wa=pa.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Xle(e,t-1)},ja=pa.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Kle(e,t-1)},Sa=pa.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Qle(e,t-1)},Jle=pa.__acroform__.calculateCoordinates=function(e,t){var r=t.internal.getHorizontalCoordinate,n=t.internal.getVerticalCoordinate,a=e[0],o=e[1],s=e[2],l=e[3],c={};return c.lowerLeft_X=r(a)||0,c.lowerLeft_Y=n(o+l)||0,c.upperRight_X=r(a+s)||0,c.upperRight_Y=n(o)||0,[Number($r(c.lowerLeft_X)),Number($r(c.lowerLeft_Y)),Number($r(c.upperRight_X)),Number($r(c.upperRight_Y))]},Zle=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],r=e._V||e.DV,n=Dw(e,r),a=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+a+" "+$r(n.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(n.text),t.push("ET"),t.push("Q"),t.push("EMC");var o=ys(e);return o.scope=e.scope,o.stream=t.join(`
`),o}},Dw=function(e,t){var r=e.fontSize===0?e.maxFontSize:e.fontSize,n={text:"",fontSize:""},a=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");a=e.multiline?a.map(function(k){return k.split(`
`)}):a.map(function(k){return[k]});var o=r,s=er.internal.getHeight(e)||0;s=s<0?-s:s;var l=er.internal.getWidth(e)||0;l=l<0?-l:l;var c=function(k,M,R){if(k+1<a.length){var F=M+" "+a[k+1][0];return Lm(F,e,R).width<=l-4}return!1};o++;e:for(;o>0;){t="",o--;var u,d,f=Lm("3",e,o).height,h=e.multiline?s-o:(s-f)/2,p=h+=2,g=0,m=0,x=0;if(o<=0){t=`(...) Tj
`,t+="% Width of Text: "+Lm(t,e,o=12).width+", FieldWidth:"+l+`
`;break}for(var b="",_=0,w=0;w<a.length;w++)if(a.hasOwnProperty(w)){var A=!1;if(a[w].length!==1&&x!==a[w].length-1){if((f+2)*(_+2)+2>s)continue e;b+=a[w][x],A=!0,m=w,w--}else{b=(b+=a[w][x]+" ").substr(b.length-1)==" "?b.substr(0,b.length-1):b;var O=parseInt(w),T=c(O,b,o),E=w>=a.length-1;if(T&&!E){b+=" ",x=0;continue}if(T||E){if(E)m=O;else if(e.multiline&&(f+2)*(_+2)+2>s)continue e}else{if(!e.multiline||(f+2)*(_+2)+2>s)continue e;m=O}}for(var S="",I=g;I<=m;I++){var z=a[I];if(e.multiline){if(I===m){S+=z[x]+" ",x=(x+1)%z.length;continue}if(I===g){S+=z[z.length-1]+" ";continue}}S+=z[0]+" "}switch(S=S.substr(S.length-1)==" "?S.substr(0,S.length-1):S,d=Lm(S,e,o).width,e.textAlign){case"right":u=l-d-2;break;case"center":u=(l-d)/2;break;case"left":default:u=2}t+=$r(u)+" "+$r(p)+` Td
`,t+="("+cu(S)+`) Tj
`,t+=-$r(u)+` 0 Td
`,p=-(o+2),d=0,g=A?m:m+1,_++,b=""}break}return n.text=t,n.fontSize=o,n},Lm=function(e,t,r){var n=t.scope.internal.getFont(t.fontName,t.fontStyle),a=t.scope.getStringUnitWidth(e,{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r);return{height:t.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r)*1.5,width:a}},ece={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},tce=function(e,t){var r={type:"reference",object:e};t.internal.getPageInfo(e.page).pageContext.annotations.find(function(n){return n.type===r.type&&n.object===r.object})===void 0&&t.internal.getPageInfo(e.page).pageContext.annotations.push(r)},rce=function(e,t){for(var r in e)if(e.hasOwnProperty(r)){var n=r,a=e[r];t.internal.newObjectDeferredBegin(a.objId,!0),xn(a)==="object"&&typeof a.putStream=="function"&&a.putStream(),delete e[n]}},nce=function(e,t){if(t.scope=e,e.internal!==void 0&&(e.internal.acroformPlugin===void 0||e.internal.acroformPlugin.isInitialized===!1)){if(us.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify(ece)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");jS=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new R6,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",function(){(function(r){r.internal.events.unsubscribe(r.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete r.internal.acroformPlugin.acroFormDictionaryRoot._eventID,r.internal.acroformPlugin.printedOut=!0})(e)}),e.internal.events.subscribe("buildDocument",function(){(function(r){r.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=r.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var a in n)if(n.hasOwnProperty(a)){var o=n[a];o.objId=void 0,o.hasAnnotation&&tce(o,r)}})(e)}),e.internal.events.subscribe("putCatalog",function(){(function(r){if(r.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");r.internal.write("/AcroForm "+r.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(e)}),e.internal.events.subscribe("postPutPages",function(r){(function(n,a){var o=!n;for(var s in n||(a.internal.newObjectDeferredBegin(a.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),a.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||a.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(s)){var l=n[s],c=[],u=l.Rect;if(l.Rect&&(l.Rect=Jle(l.Rect,a)),a.internal.newObjectDeferredBegin(l.objId,!0),l.DA=er.createDefaultAppearanceStream(l),xn(l)==="object"&&typeof l.getKeyValueListForStream=="function"&&(c=l.getKeyValueListForStream()),l.Rect=u,l.hasAppearanceStream&&!l.appearanceStreamContent){var d=Zle(l);c.push({key:"AP",value:"<</N "+d+">>"}),a.internal.acroformPlugin.xForms.push(d)}if(l.appearanceStreamContent){var f="";for(var h in l.appearanceStreamContent)if(l.appearanceStreamContent.hasOwnProperty(h)){var p=l.appearanceStreamContent[h];if(f+="/"+h+" ",f+="<<",Object.keys(p).length>=1||Array.isArray(p)){for(var s in p)if(p.hasOwnProperty(s)){var g=p[s];typeof g=="function"&&(g=g.call(a,l)),f+="/"+s+" "+g+" ",a.internal.acroformPlugin.xForms.indexOf(g)>=0||a.internal.acroformPlugin.xForms.push(g)}}else typeof(g=p)=="function"&&(g=g.call(a,l)),f+="/"+s+" "+g,a.internal.acroformPlugin.xForms.indexOf(g)>=0||a.internal.acroformPlugin.xForms.push(g);f+=">>"}c.push({key:"AP",value:`<<
`+f+">>"})}a.internal.putStream({additionalKeyValues:c,objectId:l.objId}),a.internal.out("endobj")}o&&rce(a.internal.acroformPlugin.xForms,a)})(r,e)}),e.internal.acroformPlugin.isInitialized=!0}},M6=pa.__acroform__.arrayToPdfArray=function(e,t,r){var n=function(s){return s};if(Array.isArray(e)){for(var a="[",o=0;o<e.length;o++)switch(o!==0&&(a+=" "),xn(e[o])){case"boolean":case"number":case"object":a+=e[o].toString();break;case"string":e[o].substr(0,1)!=="/"?(t!==void 0&&r&&(n=r.internal.getEncryptor(t)),a+="("+cu(n(e[o].toString()))+")"):a+=e[o].toString()}return a+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},A2=function(e,t,r){var n=function(a){return a};return t!==void 0&&r&&(n=r.internal.getEncryptor(t)),(e=e||"").toString(),e="("+cu(n(e))+")"},js=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};js.prototype.toString=function(){return this.objId+" 0 R"},js.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},js.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter(function(o){return o!="content"&&o!="appearanceStreamContent"&&o!="scope"&&o!="objId"&&o.substring(0,1)!="_"});for(var r in t)if(Object.getOwnPropertyDescriptor(this,t[r]).configurable===!1){var n=t[r],a=this[n];a&&(Array.isArray(a)?e.push({key:n,value:M6(a,this.objId,this.scope)}):a instanceof js?(a.scope=this.scope,e.push({key:n,value:a.objId+" 0 R"})):typeof a!="function"&&e.push({key:n,value:a}))}return e};var L6=function(){js.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(r){e=r.trim()},get:function(){return e||null}})};to(L6,js);var R6=function(){js.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var r=function(n){return n};return this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),"("+cu(r(e))+")"}},set:function(r){e=r}})};to(R6,js);var us=function e(){js.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(b){if(isNaN(b))throw new Error('Invalid value "'+b+'" for attribute F supplied.');t=b}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!wa(t,3)},set:function(b){b?this.F=ja(t,3):this.F=Sa(t,3)}});var r=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return r},set:function(b){if(isNaN(b))throw new Error('Invalid value "'+b+'" for attribute Ff supplied.');r=b}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(b){n=b!==void 0?b:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(b){n[0]=b}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(b){n[1]=b}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(b){n[2]=b}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(b){n[3]=b}});var a="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return a},set:function(b){switch(b){case"/Btn":case"/Tx":case"/Ch":case"/Sig":a=b;break;default:throw new Error('Invalid value "'+b+'" for attribute FT supplied.')}}});var o=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!o||o.length<1){if(this instanceof wv)return;o="FieldObject"+e.FieldNum++}var b=function(_){return _};return this.scope&&(b=this.scope.internal.getEncryptor(this.objId)),"("+cu(b(o))+")"},set:function(b){o=b.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return o},set:function(b){o=b}});var s="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return s},set:function(b){s=b}});var l="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return l},set:function(b){l=b}});var c=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return c},set:function(b){c=b}});var u=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return u===void 0?50/jS:u},set:function(b){u=b}});var d="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return d},set:function(b){d=b}});var f="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!f||this instanceof wv||this instanceof Wc))return A2(f,this.objId,this.scope)},set:function(b){b=b.toString(),f=b}});var h=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(h)return this instanceof ei?h:A2(h,this.objId,this.scope)},set:function(b){b=b.toString(),h=this instanceof ei?b:b.substr(0,1)==="("?Cu(b.substr(1,b.length-2)):Cu(b)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof ei?Cu(h.substr(1,h.length-1)):h},set:function(b){b=b.toString(),h=this instanceof ei?"/"+b:b}});var p=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(p)return p},set:function(b){this.V=b}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(p)return this instanceof ei?p:A2(p,this.objId,this.scope)},set:function(b){b=b.toString(),p=this instanceof ei?b:b.substr(0,1)==="("?Cu(b.substr(1,b.length-2)):Cu(b)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof ei?Cu(p.substr(1,p.length-1)):p},set:function(b){b=b.toString(),p=this instanceof ei?"/"+b:b}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var g,m=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return m},set:function(b){b=!!b,m=b}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(g)return g},set:function(b){g=b}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,1)},set:function(b){b?this.Ff=ja(this.Ff,1):this.Ff=Sa(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,2)},set:function(b){b?this.Ff=ja(this.Ff,2):this.Ff=Sa(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,3)},set:function(b){b?this.Ff=ja(this.Ff,3):this.Ff=Sa(this.Ff,3)}});var x=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(x!==null)return x},set:function(b){if([0,1,2].indexOf(b)===-1)throw new Error('Invalid value "'+b+'" for attribute Q supplied.');x=b}}),Object.defineProperty(this,"textAlign",{get:function(){var b;switch(x){case 0:default:b="left";break;case 1:b="center";break;case 2:b="right"}return b},configurable:!0,enumerable:!0,set:function(b){switch(b){case"right":case 2:x=2;break;case"center":case 1:x=1;break;case"left":case 0:default:x=0}}})};to(us,js);var Ku=function(){us.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(r){e=r}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return M6(t,this.objId,this.scope)},set:function(r){var n,a;a=[],typeof(n=r)=="string"&&(a=function(o,s,l){l||(l=1);for(var c,u=[];c=s.exec(o);)u.push(c[l]);return u}(n,/\((.*?)\)/g)),t=a}}),this.getOptions=function(){return t},this.setOptions=function(r){t=r,this.sort&&t.sort()},this.addOption=function(r){r=(r=r||"").toString(),t.push(r),this.sort&&t.sort()},this.removeOption=function(r,n){for(n=n||!1,r=(r=r||"").toString();t.indexOf(r)!==-1&&(t.splice(t.indexOf(r),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,18)},set:function(r){r?this.Ff=ja(this.Ff,18):this.Ff=Sa(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,19)},set:function(r){this.combo===!0&&(r?this.Ff=ja(this.Ff,19):this.Ff=Sa(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,20)},set:function(r){r?(this.Ff=ja(this.Ff,20),t.sort()):this.Ff=Sa(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,22)},set:function(r){r?this.Ff=ja(this.Ff,22):this.Ff=Sa(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,23)},set:function(r){r?this.Ff=ja(this.Ff,23):this.Ff=Sa(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,27)},set:function(r){r?this.Ff=ja(this.Ff,27):this.Ff=Sa(this.Ff,27)}}),this.hasAppearanceStream=!1};to(Ku,us);var Qu=function(){Ku.call(this),this.fontName="helvetica",this.combo=!1};to(Qu,Ku);var Xu=function(){Qu.call(this),this.combo=!0};to(Xu,Qu);var rg=function(){Xu.call(this),this.edit=!0};to(rg,Xu);var ei=function(){us.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,15)},set:function(r){r?this.Ff=ja(this.Ff,15):this.Ff=Sa(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,16)},set:function(r){r?this.Ff=ja(this.Ff,16):this.Ff=Sa(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,17)},set:function(r){r?this.Ff=ja(this.Ff,17):this.Ff=Sa(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,26)},set:function(r){r?this.Ff=ja(this.Ff,26):this.Ff=Sa(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(o){return o};if(this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var n,a=[];for(n in a.push("<<"),t)a.push("/"+n+" ("+cu(r(t[n]))+")");return a.push(">>"),a.join(`
`)}},set:function(r){xn(r)==="object"&&(t=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(r){typeof r=="string"&&(t.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(r){e="/"+r}})};to(ei,us);var ng=function(){ei.call(this),this.pushButton=!0};to(ng,ei);var Ju=function(){ei.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t!==void 0?t:[]}})};to(Ju,ei);var wv=function(){var e,t;us.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(a){e=a}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(a){t=a}});var r,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var a=function(l){return l};this.scope&&(a=this.scope.internal.getEncryptor(this.objId));var o,s=[];for(o in s.push("<<"),n)s.push("/"+o+" ("+cu(a(n[o]))+")");return s.push(">>"),s.join(`
`)},set:function(a){xn(a)==="object"&&(n=a)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(a){typeof a=="string"&&(n.CA=a)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(a){r=a}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(a){r="/"+a}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=er.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};to(wv,us),Ju.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var r=this.Kids[t];r.appearanceStreamContent=e.createAppearanceStream(r.optionName),r.caption=e.getCA()}},Ju.prototype.createOption=function(e){var t=new wv;return t.Parent=this,t.optionName=e,this.Kids.push(t),ace.call(this.scope,t),t};var ag=function(){ei.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=er.CheckBox.createAppearanceStream()};to(ag,ei);var Wc=function(){us.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,13)},set:function(t){t?this.Ff=ja(this.Ff,13):this.Ff=Sa(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,21)},set:function(t){t?this.Ff=ja(this.Ff,21):this.Ff=Sa(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,23)},set:function(t){t?this.Ff=ja(this.Ff,23):this.Ff=Sa(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,24)},set:function(t){t?this.Ff=ja(this.Ff,24):this.Ff=Sa(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,25)},set:function(t){t?this.Ff=ja(this.Ff,25):this.Ff=Sa(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,26)},set:function(t){t?this.Ff=ja(this.Ff,26):this.Ff=Sa(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};to(Wc,us);var ig=function(){Wc.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!wa(this.Ff,14)},set:function(e){e?this.Ff=ja(this.Ff,14):this.Ff=Sa(this.Ff,14)}}),this.password=!0};to(ig,Wc);var er={CheckBox:{createAppearanceStream:function(){return{N:{On:er.CheckBox.YesNormal},D:{On:er.CheckBox.YesPushDown,Off:er.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=[],n=e.scope.internal.getFont(e.fontName,e.fontStyle).id,a=e.scope.__private__.encodeColorString(e.color),o=Dw(e,e.caption);return r.push("0.749023 g"),r.push("0 0 "+$r(er.internal.getWidth(e))+" "+$r(er.internal.getHeight(e))+" re"),r.push("f"),r.push("BMC"),r.push("q"),r.push("0 0 1 rg"),r.push("/"+n+" "+$r(o.fontSize)+" Tf "+a),r.push("BT"),r.push(o.text),r.push("ET"),r.push("Q"),r.push("EMC"),t.stream=r.join(`
`),t},YesNormal:function(e){var t=ys(e);t.scope=e.scope;var r=e.scope.internal.getFont(e.fontName,e.fontStyle).id,n=e.scope.__private__.encodeColorString(e.color),a=[],o=er.internal.getHeight(e),s=er.internal.getWidth(e),l=Dw(e,e.caption);return a.push("1 g"),a.push("0 0 "+$r(s)+" "+$r(o)+" re"),a.push("f"),a.push("q"),a.push("0 0 1 rg"),a.push("0 0 "+$r(s-1)+" "+$r(o-1)+" re"),a.push("W"),a.push("n"),a.push("0 g"),a.push("BT"),a.push("/"+r+" "+$r(l.fontSize)+" Tf "+n),a.push(l.text),a.push("ET"),a.push("Q"),t.stream=a.join(`
`),t},OffPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+$r(er.internal.getWidth(e))+" "+$r(er.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:er.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=er.RadioButton.Circle.YesNormal,t.D[e]=er.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=ys(e);t.scope=e.scope;var r=[],n=er.internal.getWidth(e)<=er.internal.getHeight(e)?er.internal.getWidth(e)/4:er.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var a=er.internal.Bezier_C,o=Number((n*a).toFixed(5));return r.push("q"),r.push("1 0 0 1 "+Wl(er.internal.getWidth(e)/2)+" "+Wl(er.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),r.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),r.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),r.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=[],n=er.internal.getWidth(e)<=er.internal.getHeight(e)?er.internal.getWidth(e)/4:er.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var a=Number((2*n).toFixed(5)),o=Number((a*er.internal.Bezier_C).toFixed(5)),s=Number((n*er.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+Wl(er.internal.getWidth(e)/2)+" "+Wl(er.internal.getHeight(e)/2)+" cm"),r.push(a+" 0 m"),r.push(a+" "+o+" "+o+" "+a+" 0 "+a+" c"),r.push("-"+o+" "+a+" -"+a+" "+o+" -"+a+" 0 c"),r.push("-"+a+" -"+o+" -"+o+" -"+a+" 0 -"+a+" c"),r.push(o+" -"+a+" "+a+" -"+o+" "+a+" 0 c"),r.push("f"),r.push("Q"),r.push("0 g"),r.push("q"),r.push("1 0 0 1 "+Wl(er.internal.getWidth(e)/2)+" "+Wl(er.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),r.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),r.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),r.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},OffPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=[],n=er.internal.getWidth(e)<=er.internal.getHeight(e)?er.internal.getWidth(e)/4:er.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var a=Number((2*n).toFixed(5)),o=Number((a*er.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+Wl(er.internal.getWidth(e)/2)+" "+Wl(er.internal.getHeight(e)/2)+" cm"),r.push(a+" 0 m"),r.push(a+" "+o+" "+o+" "+a+" 0 "+a+" c"),r.push("-"+o+" "+a+" -"+a+" "+o+" -"+a+" 0 c"),r.push("-"+a+" -"+o+" -"+o+" -"+a+" 0 -"+a+" c"),r.push(o+" -"+a+" "+a+" -"+o+" "+a+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:er.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=er.RadioButton.Cross.YesNormal,t.D[e]=er.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=ys(e);t.scope=e.scope;var r=[],n=er.internal.calculateCross(e);return r.push("q"),r.push("1 1 "+$r(er.internal.getWidth(e)-2)+" "+$r(er.internal.getHeight(e)-2)+" re"),r.push("W"),r.push("n"),r.push($r(n.x1.x)+" "+$r(n.x1.y)+" m"),r.push($r(n.x2.x)+" "+$r(n.x2.y)+" l"),r.push($r(n.x4.x)+" "+$r(n.x4.y)+" m"),r.push($r(n.x3.x)+" "+$r(n.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=er.internal.calculateCross(e),n=[];return n.push("0.749023 g"),n.push("0 0 "+$r(er.internal.getWidth(e))+" "+$r(er.internal.getHeight(e))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+$r(er.internal.getWidth(e)-2)+" "+$r(er.internal.getHeight(e)-2)+" re"),n.push("W"),n.push("n"),n.push($r(r.x1.x)+" "+$r(r.x1.y)+" m"),n.push($r(r.x2.x)+" "+$r(r.x2.y)+" l"),n.push($r(r.x4.x)+" "+$r(r.x4.y)+" m"),n.push($r(r.x3.x)+" "+$r(r.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join(`
`),t},OffPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+$r(er.internal.getWidth(e))+" "+$r(er.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,r=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+r}};er.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=er.internal.getWidth(e),r=er.internal.getHeight(e),n=Math.min(t,r);return{x1:{x:(t-n)/2,y:(r-n)/2+n},x2:{x:(t-n)/2+n,y:(r-n)/2},x3:{x:(t-n)/2,y:(r-n)/2},x4:{x:(t-n)/2+n,y:(r-n)/2+n}}}},er.internal.getWidth=function(e){var t=0;return xn(e)==="object"&&(t=YE(e.Rect[2])),t},er.internal.getHeight=function(e){var t=0;return xn(e)==="object"&&(t=YE(e.Rect[3])),t};var ace=pa.addField=function(e){if(nce(this,e),!(e instanceof us))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};pa.AcroFormChoiceField=Ku,pa.AcroFormListBox=Qu,pa.AcroFormComboBox=Xu,pa.AcroFormEditBox=rg,pa.AcroFormButton=ei,pa.AcroFormPushButton=ng,pa.AcroFormRadioButton=Ju,pa.AcroFormCheckBox=ag,pa.AcroFormTextField=Wc,pa.AcroFormPasswordField=ig,pa.AcroFormAppearance=er,pa.AcroForm={ChoiceField:Ku,ListBox:Qu,ComboBox:Xu,EditBox:rg,Button:ei,PushButton:ng,RadioButton:Ju,CheckBox:ag,TextField:Wc,PasswordField:ig,Appearance:er},Sr.AcroForm={ChoiceField:Ku,ListBox:Qu,ComboBox:Xu,EditBox:rg,Button:ei,PushButton:ng,RadioButton:Ju,CheckBox:ag,TextField:Wc,PasswordField:ig,Appearance:er};Sr.AcroForm;function q6(e){return e.reduce(function(t,r,n){return t[r]=n,t},{})}(function(e){e.__addimage__={};var t="UNKNOWN",r={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},n=e.__addimage__.getImageFileTypeByImageData=function(k,M){var R,F,W,K,Z,D=t;if((M=M||t)==="RGBA"||k.data!==void 0&&k.data instanceof Uint8ClampedArray&&"height"in k&&"width"in k)return"RGBA";if(T(k))for(Z in r)for(W=r[Z],R=0;R<W.length;R+=1){for(K=!0,F=0;F<W[R].length;F+=1)if(W[R][F]!==void 0&&W[R][F]!==k[F]){K=!1;break}if(K===!0){D=Z;break}}else for(Z in r)for(W=r[Z],R=0;R<W.length;R+=1){for(K=!0,F=0;F<W[R].length;F+=1)if(W[R][F]!==void 0&&W[R][F]!==k.charCodeAt(F)){K=!1;break}if(K===!0){D=Z;break}}return D===t&&M!==t&&(D=M),D},a=function k(M){for(var R=this.internal.write,F=this.internal.putStream,W=(0,this.internal.getFilters)();W.indexOf("FlateEncode")!==-1;)W.splice(W.indexOf("FlateEncode"),1);M.objectId=this.internal.newObject();var K=[];if(K.push({key:"Type",value:"/XObject"}),K.push({key:"Subtype",value:"/Image"}),K.push({key:"Width",value:M.width}),K.push({key:"Height",value:M.height}),M.colorSpace===x.INDEXED?K.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(M.palette.length/3-1)+" "+("sMask"in M&&M.sMask!==void 0?M.objectId+2:M.objectId+1)+" 0 R]"}):(K.push({key:"ColorSpace",value:"/"+M.colorSpace}),M.colorSpace===x.DEVICE_CMYK&&K.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),K.push({key:"BitsPerComponent",value:M.bitsPerComponent}),"decodeParameters"in M&&M.decodeParameters!==void 0&&K.push({key:"DecodeParms",value:"<<"+M.decodeParameters+">>"}),"transparency"in M&&Array.isArray(M.transparency)){for(var Z="",D=0,P=M.transparency.length;D<P;D++)Z+=M.transparency[D]+" "+M.transparency[D]+" ";K.push({key:"Mask",value:"["+Z+"]"})}M.sMask!==void 0&&K.push({key:"SMask",value:M.objectId+1+" 0 R"});var $=M.filter!==void 0?["/"+M.filter]:void 0;if(F({data:M.data,additionalKeyValues:K,alreadyAppliedFilters:$,objectId:M.objectId}),R("endobj"),"sMask"in M&&M.sMask!==void 0){var Q="/Predictor "+M.predictor+" /Colors 1 /BitsPerComponent "+M.bitsPerComponent+" /Columns "+M.width,C={width:M.width,height:M.height,colorSpace:"DeviceGray",bitsPerComponent:M.bitsPerComponent,decodeParameters:Q,data:M.sMask};"filter"in M&&(C.filter=M.filter),k.call(this,C)}if(M.colorSpace===x.INDEXED){var L=this.internal.newObject();F({data:S(new Uint8Array(M.palette)),objectId:L}),R("endobj")}},o=function(){var k=this.internal.collections.addImage_images;for(var M in k)a.call(this,k[M])},s=function(){var k,M=this.internal.collections.addImage_images,R=this.internal.write;for(var F in M)R("/I"+(k=M[F]).index,k.objectId,"0","R")},l=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",s))},c=function(){var k=this.internal.collections.addImage_images;return l.call(this),k},u=function(){return Object.keys(this.internal.collections.addImage_images).length},d=function(k){return typeof e["process"+k.toUpperCase()]=="function"},f=function(k){return xn(k)==="object"&&k.nodeType===1},h=function(k,M){if(k.nodeName==="IMG"&&k.hasAttribute("src")){var R=""+k.getAttribute("src");if(R.indexOf("data:image/")===0)return Rh(unescape(R).split("base64,").pop());var F=e.loadFile(R,!0);if(F!==void 0)return F}if(k.nodeName==="CANVAS"){if(k.width===0||k.height===0)throw new Error("Given canvas must have data. Canvas width: "+k.width+", height: "+k.height);var W;switch(M){case"PNG":W="image/png";break;case"WEBP":W="image/webp";break;case"JPEG":case"JPG":default:W="image/jpeg"}return Rh(k.toDataURL(W,1).split("base64,").pop())}},p=function(k){var M=this.internal.collections.addImage_images;if(M){for(var R in M)if(k===M[R].alias)return M[R]}},g=function(k,M,R){return k||M||(k=-96,M=-96),k<0&&(k=-1*R.width*72/k/this.internal.scaleFactor),M<0&&(M=-1*R.height*72/M/this.internal.scaleFactor),k===0&&(k=M*R.width/R.height),M===0&&(M=k*R.height/R.width),[k,M]},m=function(k,M,R,F,W,K){var Z=g.call(this,R,F,W),D=this.internal.getCoordinateString,P=this.internal.getVerticalCoordinateString,$=c.call(this);if(R=Z[0],F=Z[1],$[W.index]=W,K){K*=Math.PI/180;var Q=Math.cos(K),C=Math.sin(K),L=function(U){return U.toFixed(4)},H=[L(Q),L(C),L(-1*C),L(Q),0,0,"cm"]}this.internal.write("q"),K?(this.internal.write([1,"0","0",1,D(k),P(M+F),"cm"].join(" ")),this.internal.write(H.join(" ")),this.internal.write([D(R),"0","0",D(F),"0","0","cm"].join(" "))):this.internal.write([D(R),"0","0",D(F),D(k),P(M+F),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+W.index+" Do"),this.internal.write("Q")},x=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var b=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},_=e.__addimage__.sHashCode=function(k){var M,R,F=0;if(typeof k=="string")for(R=k.length,M=0;M<R;M++)F=(F<<5)-F+k.charCodeAt(M),F|=0;else if(T(k))for(R=k.byteLength/2,M=0;M<R;M++)F=(F<<5)-F+k[M],F|=0;return F},w=e.__addimage__.validateStringAsBase64=function(k){(k=k||"").toString().trim();var M=!0;return k.length===0&&(M=!1),k.length%4!=0&&(M=!1),/^[A-Za-z0-9+/]+$/.test(k.substr(0,k.length-2))===!1&&(M=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(k.substr(-2))===!1&&(M=!1),M},A=e.__addimage__.extractImageFromDataUrl=function(k){if(k==null||!(k=k.trim()).startsWith("data:"))return null;var M=k.indexOf(",");return M<0?null:k.substring(0,M).trim().endsWith("base64")?k.substring(M+1):null},O=e.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};e.__addimage__.isArrayBuffer=function(k){return O()&&k instanceof ArrayBuffer};var T=e.__addimage__.isArrayBufferView=function(k){return O()&&typeof Uint32Array<"u"&&(k instanceof Int8Array||k instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&k instanceof Uint8ClampedArray||k instanceof Int16Array||k instanceof Uint16Array||k instanceof Int32Array||k instanceof Uint32Array||k instanceof Float32Array||k instanceof Float64Array)},E=e.__addimage__.binaryStringToUint8Array=function(k){for(var M=k.length,R=new Uint8Array(M),F=0;F<M;F++)R[F]=k.charCodeAt(F);return R},S=e.__addimage__.arrayBufferToBinaryString=function(k){for(var M="",R=T(k)?k:new Uint8Array(k),F=0;F<R.length;F+=8192)M+=String.fromCharCode.apply(null,R.subarray(F,F+8192));return M};e.addImage=function(){var k,M,R,F,W,K,Z,D,P;if(typeof arguments[1]=="number"?(M=t,R=arguments[1],F=arguments[2],W=arguments[3],K=arguments[4],Z=arguments[5],D=arguments[6],P=arguments[7]):(M=arguments[1],R=arguments[2],F=arguments[3],W=arguments[4],K=arguments[5],Z=arguments[6],D=arguments[7],P=arguments[8]),xn(k=arguments[0])==="object"&&!f(k)&&"imageData"in k){var $=k;k=$.imageData,M=$.format||M||t,R=$.x||R||0,F=$.y||F||0,W=$.w||$.width||W,K=$.h||$.height||K,Z=$.alias||Z,D=$.compression||D,P=$.rotation||$.angle||P}var Q=this.internal.getFilters();if(D===void 0&&Q.indexOf("FlateEncode")!==-1&&(D="SLOW"),isNaN(R)||isNaN(F))throw new Error("Invalid coordinates passed to jsPDF.addImage");l.call(this);var C=I.call(this,k,M,Z,D);return m.call(this,R,F,W,K,C,P),this};var I=function(k,M,R,F){var W,K,Z;if(typeof k=="string"&&n(k)===t){k=unescape(k);var D=z(k,!1);(D!==""||(D=e.loadFile(k,!0))!==void 0)&&(k=D)}if(f(k)&&(k=h(k,M)),M=n(k,M),!d(M))throw new Error("addImage does not support files of type '"+M+"', please ensure that a plugin for '"+M+"' support is added.");if(((Z=R)==null||Z.length===0)&&(R=function(P){return typeof P=="string"||T(P)?_(P):T(P.data)?_(P.data):null}(k)),(W=p.call(this,R))||(O()&&(k instanceof Uint8Array||M==="RGBA"||(K=k,k=E(k))),W=this["process"+M.toUpperCase()](k,u.call(this),R,function(P){return P&&typeof P=="string"&&(P=P.toUpperCase()),P in e.image_compression?P:b.NONE}(F),K)),!W)throw new Error("An unknown error occurred whilst processing the image.");return W},z=e.__addimage__.convertBase64ToBinaryString=function(k,M){M=typeof M!="boolean"||M;var R,F="";if(typeof k=="string"){var W;R=(W=A(k))!==null&&W!==void 0?W:k;try{F=Rh(R)}catch(K){if(M)throw w(R)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+K.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return F};e.getImageProperties=function(k){var M,R,F="";if(f(k)&&(k=h(k)),typeof k=="string"&&n(k)===t&&((F=z(k,!1))===""&&(F=e.loadFile(k)||""),k=F),R=n(k),!d(R))throw new Error("addImage does not support files of type '"+R+"', please ensure that a plugin for '"+R+"' support is added.");if(!O()||k instanceof Uint8Array||(k=E(k)),!(M=this["process"+R.toUpperCase()](k)))throw new Error("An unknown error occurred whilst processing the image");return M.fileType=R,M}})(Sr.API),function(e){var t=function(r){if(r!==void 0&&r!="")return!0};Sr.API.events.push(["addPage",function(r){this.internal.getPageInfo(r.pageNumber).pageContext.annotations=[]}]),e.events.push(["putPage",function(r){for(var n,a,o,s=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,c=this.internal.getPageInfoByObjId(r.objId),u=r.pageContext.annotations,d=!1,f=0;f<u.length&&!d;f++)switch((n=u[f]).type){case"link":(t(n.options.url)||t(n.options.pageNumber))&&(d=!0);break;case"reference":case"text":case"freetext":d=!0}if(d!=0){this.internal.write("/Annots [");for(var h=0;h<u.length;h++){n=u[h];var p=this.internal.pdfEscape,g=this.internal.getEncryptor(r.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var m=this.internal.newAdditionalObject(),x=this.internal.newAdditionalObject(),b=this.internal.getEncryptor(m.objId),_=n.title||"Note";o="<</Type /Annot /Subtype /Text "+(a="/Rect ["+s(n.bounds.x)+" "+l(n.bounds.y+n.bounds.h)+" "+s(n.bounds.x+n.bounds.w)+" "+l(n.bounds.y)+"] ")+"/Contents ("+p(b(n.contents))+")",o+=" /Popup "+x.objId+" 0 R",o+=" /P "+c.objId+" 0 R",o+=" /T ("+p(b(_))+") >>",m.content=o;var w=m.objId+" 0 R";o="<</Type /Annot /Subtype /Popup "+(a="/Rect ["+s(n.bounds.x+30)+" "+l(n.bounds.y+n.bounds.h)+" "+s(n.bounds.x+n.bounds.w+30)+" "+l(n.bounds.y)+"] ")+" /Parent "+w,n.open&&(o+=" /Open true"),o+=" >>",x.content=o,this.internal.write(m.objId,"0 R",x.objId,"0 R");break;case"freetext":a="/Rect ["+s(n.bounds.x)+" "+l(n.bounds.y)+" "+s(n.bounds.x+n.bounds.w)+" "+l(n.bounds.y+n.bounds.h)+"] ";var A=n.color||"#000000";o="<</Type /Annot /Subtype /FreeText "+a+"/Contents ("+p(g(n.contents))+")",o+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+A+")",o+=" /Border [0 0 0]",o+=" >>",this.internal.write(o);break;case"link":if(n.options.name){var O=this.annotations._nameMap[n.options.name];n.options.pageNumber=O.page,n.options.top=O.y}else n.options.top||(n.options.top=0);if(a="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",o="",n.options.url)o="<</Type /Annot /Subtype /Link "+a+"/Border [0 0 0] /A <</S /URI /URI ("+p(g(n.options.url))+") >>";else if(n.options.pageNumber)switch(o="<</Type /Annot /Subtype /Link "+a+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":o+=" /Fit]";break;case"FitH":o+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,o+=" /FitV "+n.options.left+"]";break;case"XYZ":default:var T=l(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),o+=" /XYZ "+n.options.left+" "+T+" "+n.options.zoom+"]"}o!=""&&(o+=" >>",this.internal.write(o))}}this.internal.write("]")}}]),e.createAnnotation=function(r){var n=this.internal.getCurrentPageInfo();switch(r.type){case"link":this.link(r.bounds.x,r.bounds.y,r.bounds.w,r.bounds.h,r);break;case"text":case"freetext":n.pageContext.annotations.push(r)}},e.link=function(r,n,a,o,s){var l=this.internal.getCurrentPageInfo(),c=this.internal.getCoordinateString,u=this.internal.getVerticalCoordinateString;l.pageContext.annotations.push({finalBounds:{x:c(r),y:u(n),w:c(r+a),h:u(n+o)},options:s,type:"link"})},e.textWithLink=function(r,n,a,o){var s,l,c=this.getTextWidth(r),u=this.internal.getLineHeight()/this.internal.scaleFactor;if(o.maxWidth!==void 0){l=o.maxWidth;var d=this.splitTextToSize(r,l).length;s=Math.ceil(u*d)}else l=c,s=u;return this.text(r,n,a,o),a+=.2*u,o.align==="center"&&(n-=c/2),o.align==="right"&&(n-=c),this.link(n,a-u,l,s,o),c},e.getTextWidth=function(r){var n=this.internal.getFontSize();return this.getStringUnitWidth(r)*n/this.internal.scaleFactor}}(Sr.API),function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},r={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},a=[1570,1571,1573,1575];e.__arabicParser__={};var o=e.__arabicParser__.isInArabicSubstitutionA=function(m){return t[m.charCodeAt(0)]!==void 0},s=e.__arabicParser__.isArabicLetter=function(m){return typeof m=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(m)},l=e.__arabicParser__.isArabicEndLetter=function(m){return s(m)&&o(m)&&t[m.charCodeAt(0)].length<=2},c=e.__arabicParser__.isArabicAlfLetter=function(m){return s(m)&&a.indexOf(m.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(m){return s(m)&&o(m)&&t[m.charCodeAt(0)].length>=1};var u=e.__arabicParser__.arabicLetterHasFinalForm=function(m){return s(m)&&o(m)&&t[m.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(m){return s(m)&&o(m)&&t[m.charCodeAt(0)].length>=3};var d=e.__arabicParser__.arabicLetterHasMedialForm=function(m){return s(m)&&o(m)&&t[m.charCodeAt(0)].length==4},f=e.__arabicParser__.resolveLigatures=function(m){var x=0,b=r,_="",w=0;for(x=0;x<m.length;x+=1)b[m.charCodeAt(x)]!==void 0?(w++,typeof(b=b[m.charCodeAt(x)])=="number"&&(_+=String.fromCharCode(b),b=r,w=0),x===m.length-1&&(b=r,_+=m.charAt(x-(w-1)),x-=w-1,w=0)):(b=r,_+=m.charAt(x-w),x-=w,w=0);return _};e.__arabicParser__.isArabicDiacritic=function(m){return m!==void 0&&n[m.charCodeAt(0)]!==void 0};var h=e.__arabicParser__.getCorrectForm=function(m,x,b){return s(m)?o(m)===!1?-1:!u(m)||!s(x)&&!s(b)||!s(b)&&l(x)||l(m)&&!s(x)||l(m)&&c(x)||l(m)&&l(x)?0:d(m)&&s(x)&&!l(x)&&s(b)&&u(b)?3:l(m)||!s(b)?1:2:-1},p=function(m){var x=0,b=0,_=0,w="",A="",O="",T=(m=m||"").split("\\s+"),E=[];for(x=0;x<T.length;x+=1){for(E.push(""),b=0;b<T[x].length;b+=1)w=T[x][b],A=T[x][b-1],O=T[x][b+1],s(w)?(_=h(w,A,O),E[x]+=_!==-1?String.fromCharCode(t[w.charCodeAt(0)][_]):w):E[x]+=w;E[x]=f(E[x])}return E.join(" ")},g=e.__arabicParser__.processArabic=e.processArabic=function(){var m,x=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,b=[];if(Array.isArray(x)){var _=0;for(b=[],_=0;_<x.length;_+=1)Array.isArray(x[_])?b.push([p(x[_][0]),x[_][1],x[_][2]]):b.push([p(x[_])]);m=b}else m=p(x);return typeof arguments[0]=="string"?m:(arguments[0].text=m,arguments[0])};e.events.push(["preProcessText",g])}(Sr.API),Sr.API.autoPrint=function(e){var t;switch((e=e||{}).variant=e.variant||"non-conform",e.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})}return this},function(e){var t=function(){var r=void 0;Object.defineProperty(this,"pdf",{get:function(){return r},set:function(l){r=l}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(l){n=isNaN(l)||Number.isInteger(l)===!1||l<0?150:l,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var a=300;Object.defineProperty(this,"height",{get:function(){return a},set:function(l){a=isNaN(l)||Number.isInteger(l)===!1||l<0?300:l,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=a+1)}});var o=[];Object.defineProperty(this,"childNodes",{get:function(){return o},set:function(l){o=l}});var s={};Object.defineProperty(this,"style",{get:function(){return s},set:function(l){s=l}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(r,n){var a;if((r=r||"2d")!=="2d")return null;for(a in n)this.pdf.context2d.hasOwnProperty(a)&&(this.pdf.context2d[a]=n[a]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(Sr.API),function(e){var t={left:0,top:0,bottom:0,right:0},r=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),a.call(this))},a=function(){this.internal.__cell__.lastCell=new o,this.internal.__cell__.pages=1},o=function(){var c=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return c},set:function(m){c=m}});var u=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return u},set:function(m){u=m}});var d=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return d},set:function(m){d=m}});var f=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return f},set:function(m){f=m}});var h=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return h},set:function(m){h=m}});var p=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return p},set:function(m){p=m}});var g=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return g},set:function(m){g=m}}),this};o.prototype.clone=function(){return new o(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},o.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(c){return n.call(this),this.internal.__cell__.headerFunction=typeof c=="function"?c:void 0,this},e.getTextDimensions=function(c,u){n.call(this);var d=(u=u||{}).fontSize||this.getFontSize(),f=u.font||this.getFont(),h=u.scaleFactor||this.internal.scaleFactor,p=0,g=0,m=0,x=this;if(!Array.isArray(c)&&typeof c!="string"){if(typeof c!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");c=String(c)}var b=u.maxWidth;b>0?typeof c=="string"?c=this.splitTextToSize(c,b):Object.prototype.toString.call(c)==="[object Array]"&&(c=c.reduce(function(w,A){return w.concat(x.splitTextToSize(A,b))},[])):c=Array.isArray(c)?c:[c];for(var _=0;_<c.length;_++)p<(m=this.getStringUnitWidth(c[_],{font:f})*d)&&(p=m);return p!==0&&(g=c.length),{w:p/=h,h:Math.max((g*d*this.getLineHeightFactor()-d*(this.getLineHeightFactor()-1))/h,0)}},e.cellAddPage=function(){n.call(this),this.addPage();var c=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new o(c.left,c.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var s=e.cell=function(){var c;c=arguments[0]instanceof o?arguments[0]:new o(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var u=this.internal.__cell__.lastCell,d=this.internal.__cell__.padding,f=this.internal.__cell__.margins||t,h=this.internal.__cell__.tableHeaderRow,p=this.internal.__cell__.printHeaders;return u.lineNumber!==void 0&&(u.lineNumber===c.lineNumber?(c.x=(u.x||0)+(u.width||0),c.y=u.y||0):u.y+u.height+c.height+f.bottom>this.getPageHeight()?(this.cellAddPage(),c.y=f.top,p&&h&&(this.printHeaderRow(c.lineNumber,!0),c.y+=h[0].height)):c.y=u.y+u.height||c.y),c.text[0]!==void 0&&(this.rect(c.x,c.y,c.width,c.height,r===!0?"FD":void 0),c.align==="right"?this.text(c.text,c.x+c.width-d,c.y+d,{align:"right",baseline:"top"}):c.align==="center"?this.text(c.text,c.x+c.width/2,c.y+d,{align:"center",baseline:"top",maxWidth:c.width-d-d}):this.text(c.text,c.x+d,c.y+d,{align:"left",baseline:"top",maxWidth:c.width-d-d})),this.internal.__cell__.lastCell=c,this};e.table=function(c,u,d,f,h){if(n.call(this),!d)throw new Error("No data for PDF table.");var p,g,m,x,b=[],_=[],w=[],A={},O={},T=[],E=[],S=(h=h||{}).autoSize||!1,I=h.printHeaders!==!1,z=h.css&&h.css["font-size"]!==void 0?16*h.css["font-size"]:h.fontSize||12,k=h.margins||Object.assign({width:this.getPageWidth()},t),M=typeof h.padding=="number"?h.padding:3,R=h.headerBackgroundColor||"#c8c8c8",F=h.headerTextColor||"#000";if(a.call(this),this.internal.__cell__.printHeaders=I,this.internal.__cell__.margins=k,this.internal.__cell__.table_font_size=z,this.internal.__cell__.padding=M,this.internal.__cell__.headerBackgroundColor=R,this.internal.__cell__.headerTextColor=F,this.setFontSize(z),f==null)_=b=Object.keys(d[0]),w=b.map(function(){return"left"});else if(Array.isArray(f)&&xn(f[0])==="object")for(b=f.map(function($){return $.name}),_=f.map(function($){return $.prompt||$.name||""}),w=f.map(function($){return $.align||"left"}),p=0;p<f.length;p+=1)O[f[p].name]=f[p].width*(19.049976/25.4);else Array.isArray(f)&&typeof f[0]=="string"&&(_=b=f,w=b.map(function(){return"left"}));if(S||Array.isArray(f)&&typeof f[0]=="string")for(p=0;p<b.length;p+=1){for(A[x=b[p]]=d.map(function($){return $[x]}),this.setFont(void 0,"bold"),T.push(this.getTextDimensions(_[p],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),g=A[x],this.setFont(void 0,"normal"),m=0;m<g.length;m+=1)T.push(this.getTextDimensions(g[m],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);O[x]=Math.max.apply(null,T)+M+M,T=[]}if(I){var W={};for(p=0;p<b.length;p+=1)W[b[p]]={},W[b[p]].text=_[p],W[b[p]].align=w[p];var K=l.call(this,W,O);E=b.map(function($){return new o(c,u,O[$],K,W[$].text,void 0,W[$].align)}),this.setTableHeaderRow(E),this.printHeaderRow(1,!1)}var Z=f.reduce(function($,Q){return $[Q.name]=Q.align,$},{});for(p=0;p<d.length;p+=1){"rowStart"in h&&h.rowStart instanceof Function&&h.rowStart({row:p,data:d[p]},this);var D=l.call(this,d[p],O);for(m=0;m<b.length;m+=1){var P=d[p][b[m]];"cellStart"in h&&h.cellStart instanceof Function&&h.cellStart({row:p,col:m,data:P},this),s.call(this,new o(c,u,O[b[m]],D,P,p+2,Z[b[m]]))}}return this.internal.__cell__.table_x=c,this.internal.__cell__.table_y=u,this};var l=function(c,u){var d=this.internal.__cell__.padding,f=this.internal.__cell__.table_font_size,h=this.internal.scaleFactor;return Object.keys(c).map(function(p){var g=c[p];return this.splitTextToSize(g.hasOwnProperty("text")?g.text:g,u[p]-d-d)},this).map(function(p){return this.getLineHeightFactor()*p.length*f/h+d+d},this).reduce(function(p,g){return Math.max(p,g)},0)};e.setTableHeaderRow=function(c){n.call(this),this.internal.__cell__.tableHeaderRow=c},e.printHeaderRow=function(c,u){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var d;if(r=!0,typeof this.internal.__cell__.headerFunction=="function"){var f=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new o(f[0],f[1],f[2],f[3],void 0,-1)}this.setFont(void 0,"bold");for(var h=[],p=0;p<this.internal.__cell__.tableHeaderRow.length;p+=1){d=this.internal.__cell__.tableHeaderRow[p].clone(),u&&(d.y=this.internal.__cell__.margins.top||0,h.push(d)),d.lineNumber=c;var g=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),s.call(this,d),this.setTextColor(g)}h.length>0&&this.setTableHeaderRow(h),this.setFont(void 0,"normal"),r=!1}}(Sr.API);var F6={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},$6=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],Mw=q6($6),B6=[100,200,300,400,500,600,700,800,900],ice=q6(B6);function Lw(e){var t=e.family.replace(/"|'/g,"").toLowerCase(),r=function(o){return F6[o=o||"normal"]?o:"normal"}(e.style),n=function(o){if(!o)return 400;if(typeof o=="number")return o>=100&&o<=900&&o%100==0?o:400;if(/^\d00$/.test(o))return parseInt(o);switch(o){case"bold":return 700;case"normal":default:return 400}}(e.weight),a=function(o){return typeof Mw[o=o||"normal"]=="number"?o:"normal"}(e.stretch);return{family:t,style:r,weight:n,stretch:a,src:e.src||[],ref:e.ref||{name:t,style:[a,r,n].join(" ")}}}function KE(e,t,r,n){var a;for(a=r;a>=0&&a<t.length;a+=n)if(e[t[a]])return e[t[a]];for(a=r;a>=0&&a<t.length;a-=n)if(e[t[a]])return e[t[a]]}var oce={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},QE={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function XE(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function sce(e,t,r){for(var n=(r=r||{}).defaultFontFamily||"times",a=Object.assign({},oce,r.genericFontFamilies||{}),o=null,s=null,l=0;l<t.length;++l)if(a[(o=Lw(t[l])).family]&&(o.family=a[o.family]),e.hasOwnProperty(o.family)){s=e[o.family];break}if(!(s=s||e[n]))throw new Error("Could not find a font-family for the rule '"+XE(o)+"' and default family '"+n+"'.");if(s=function(c,u){if(u[c])return u[c];var d=Mw[c],f=d<=Mw.normal?-1:1,h=KE(u,$6,d,f);if(!h)throw new Error("Could not find a matching font-stretch value for "+c);return h}(o.stretch,s),s=function(c,u){if(u[c])return u[c];for(var d=F6[c],f=0;f<d.length;++f)if(u[d[f]])return u[d[f]];throw new Error("Could not find a matching font-style for "+c)}(o.style,s),!(s=function(c,u){if(u[c])return u[c];if(c===400&&u[500])return u[500];if(c===500&&u[400])return u[400];var d=ice[c],f=KE(u,B6,d,c<400?-1:1);if(!f)throw new Error("Could not find a matching font-weight for value "+c);return f}(o.weight,s)))throw new Error("Failed to resolve a font for the rule '"+XE(o)+"'.");return s}function JE(e){return e.trimLeft()}function lce(e,t){for(var r=0;r<e.length;){if(e.charAt(r)===t)return[e.substring(0,r),e.substring(r+1)];r+=1}return null}function cce(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],e.substring(t[0].length)]}var Rm,ZE,e4,P2=["times"];(function(e){var t,r,n,a,o,s,l,c,u,d=function(C){return C=C||{},this.isStrokeTransparent=C.isStrokeTransparent||!1,this.strokeOpacity=C.strokeOpacity||1,this.strokeStyle=C.strokeStyle||"#000000",this.fillStyle=C.fillStyle||"#000000",this.isFillTransparent=C.isFillTransparent||!1,this.fillOpacity=C.fillOpacity||1,this.font=C.font||"10px sans-serif",this.textBaseline=C.textBaseline||"alphabetic",this.textAlign=C.textAlign||"left",this.lineWidth=C.lineWidth||1,this.lineJoin=C.lineJoin||"miter",this.lineCap=C.lineCap||"butt",this.path=C.path||[],this.transform=C.transform!==void 0?C.transform.clone():new c,this.globalCompositeOperation=C.globalCompositeOperation||"normal",this.globalAlpha=C.globalAlpha||1,this.clip_path=C.clip_path||[],this.currentPoint=C.currentPoint||new s,this.miterLimit=C.miterLimit||10,this.lastPoint=C.lastPoint||new s,this.lineDashOffset=C.lineDashOffset||0,this.lineDash=C.lineDash||[],this.margin=C.margin||[0,0,0,0],this.prevPageLastElemOffset=C.prevPageLastElemOffset||0,this.ignoreClearRect=typeof C.ignoreClearRect!="boolean"||C.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new f(this),t=this.internal.f2,r=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,a=this.internal.getHorizontalCoordinate,o=this.internal.getVerticalCoordinate,s=this.internal.Point,l=this.internal.Rectangle,c=this.internal.Matrix,u=new d}]);var f=function(C){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var L=C;Object.defineProperty(this,"pdf",{get:function(){return L}});var H=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return H},set:function(se){H=!!se}});var U=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return U},set:function(se){U=!!se}});var te=0;Object.defineProperty(this,"posX",{get:function(){return te},set:function(se){isNaN(se)||(te=se)}});var le=0;Object.defineProperty(this,"posY",{get:function(){return le},set:function(se){isNaN(se)||(le=se)}}),Object.defineProperty(this,"margin",{get:function(){return u.margin},set:function(se){var V;typeof se=="number"?V=[se,se,se,se]:((V=new Array(4))[0]=se[0],V[1]=se.length>=2?se[1]:V[0],V[2]=se.length>=3?se[2]:V[0],V[3]=se.length>=4?se[3]:V[1]),u.margin=V}});var oe=!1;Object.defineProperty(this,"autoPaging",{get:function(){return oe},set:function(se){oe=se}});var ae=0;Object.defineProperty(this,"lastBreak",{get:function(){return ae},set:function(se){ae=se}});var he=[];Object.defineProperty(this,"pageBreaks",{get:function(){return he},set:function(se){he=se}}),Object.defineProperty(this,"ctx",{get:function(){return u},set:function(se){se instanceof d&&(u=se)}}),Object.defineProperty(this,"path",{get:function(){return u.path},set:function(se){u.path=se}});var me=[];Object.defineProperty(this,"ctxStack",{get:function(){return me},set:function(se){me=se}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(se){var V;V=h(se),this.ctx.fillStyle=V.style,this.ctx.isFillTransparent=V.a===0,this.ctx.fillOpacity=V.a,this.pdf.setFillColor(V.r,V.g,V.b,{a:V.a}),this.pdf.setTextColor(V.r,V.g,V.b,{a:V.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(se){var V=h(se);this.ctx.strokeStyle=V.style,this.ctx.isStrokeTransparent=V.a===0,this.ctx.strokeOpacity=V.a,V.a===0?this.pdf.setDrawColor(255,255,255):(V.a,this.pdf.setDrawColor(V.r,V.g,V.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(se){["butt","round","square"].indexOf(se)!==-1&&(this.ctx.lineCap=se,this.pdf.setLineCap(se))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(se){isNaN(se)||(this.ctx.lineWidth=se,this.pdf.setLineWidth(se))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(se){["bevel","round","miter"].indexOf(se)!==-1&&(this.ctx.lineJoin=se,this.pdf.setLineJoin(se))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(se){isNaN(se)||(this.ctx.miterLimit=se,this.pdf.setMiterLimit(se))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(se){this.ctx.textBaseline=se}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(se){["right","end","center","left","start"].indexOf(se)!==-1&&(this.ctx.textAlign=se)}});var X=null;function G(se,V){if(X===null){var He=function(Ne){var Re=[];return Object.keys(Ne).forEach(function(Ke){Ne[Ke].forEach(function(nt){var st=null;switch(nt){case"bold":st={family:Ke,weight:"bold"};break;case"italic":st={family:Ke,style:"italic"};break;case"bolditalic":st={family:Ke,weight:"bold",style:"italic"};break;case"":case"normal":st={family:Ke}}st!==null&&(st.ref={name:Ke,style:nt},Re.push(st))})}),Re}(se.getFontList());X=function(Ne){for(var Re={},Ke=0;Ke<Ne.length;++Ke){var nt=Lw(Ne[Ke]),st=nt.family,gt=nt.stretch,Ge=nt.style,Je=nt.weight;Re[st]=Re[st]||{},Re[st][gt]=Re[st][gt]||{},Re[st][gt][Ge]=Re[st][gt][Ge]||{},Re[st][gt][Ge][Je]=nt}return Re}(He.concat(V))}return X}var ee=null;Object.defineProperty(this,"fontFaces",{get:function(){return ee},set:function(se){X=null,ee=se}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(se){var V;if(this.ctx.font=se,(V=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(se))!==null){var He=V[1];V[2];var Ne=V[3],Re=V[4];V[5];var Ke=V[6],nt=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Re)[2];Re=Math.floor(nt==="px"?parseFloat(Re)*this.pdf.internal.scaleFactor:nt==="em"?parseFloat(Re)*this.pdf.getFontSize():parseFloat(Re)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Re);var st=function(kt){var Vt,jt,Tr=[],qe=kt.trim();if(qe==="")return P2;if(qe in QE)return[QE[qe]];for(;qe!=="";){switch(jt=null,Vt=(qe=JE(qe)).charAt(0)){case'"':case"'":jt=lce(qe.substring(1),Vt);break;default:jt=cce(qe)}if(jt===null||(Tr.push(jt[0]),(qe=JE(jt[1]))!==""&&qe.charAt(0)!==","))return P2;qe=qe.replace(/^,/,"")}return Tr}(Ke);if(this.fontFaces){var gt=sce(G(this.pdf,this.fontFaces),st.map(function(kt){return{family:kt,stretch:"normal",weight:Ne,style:He}}));this.pdf.setFont(gt.ref.name,gt.ref.style)}else{var Ge="";(Ne==="bold"||parseInt(Ne,10)>=700||He==="bold")&&(Ge="bold"),He==="italic"&&(Ge+="italic"),Ge.length===0&&(Ge="normal");for(var Je="",We={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},_t=0;_t<st.length;_t++){if(this.pdf.internal.getFont(st[_t],Ge,{noFallback:!0,disableWarning:!0})!==void 0){Je=st[_t];break}if(Ge==="bolditalic"&&this.pdf.internal.getFont(st[_t],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Je=st[_t],Ge="bold";else if(this.pdf.internal.getFont(st[_t],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Je=st[_t],Ge="normal";break}}if(Je===""){for(var Nt=0;Nt<st.length;Nt++)if(We[st[Nt]]){Je=We[st[Nt]];break}}Je=Je===""?"Times":Je,this.pdf.setFont(Je,Ge)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(se){this.ctx.globalCompositeOperation=se}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(se){this.ctx.globalAlpha=se}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(se){this.ctx.lineDashOffset=se,Q.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(se){this.ctx.lineDash=se,Q.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(se){this.ctx.ignoreClearRect=!!se}})};f.prototype.setLineDash=function(C){this.lineDash=C},f.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},f.prototype.fill=function(){A.call(this,"fill",!1)},f.prototype.stroke=function(){A.call(this,"stroke",!1)},f.prototype.beginPath=function(){this.path=[{type:"begin"}]},f.prototype.moveTo=function(C,L){if(isNaN(C)||isNaN(L))throw Tn.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var H=this.ctx.transform.applyToPoint(new s(C,L));this.path.push({type:"mt",x:H.x,y:H.y}),this.ctx.lastPoint=new s(C,L)},f.prototype.closePath=function(){var C=new s(0,0),L=0;for(L=this.path.length-1;L!==-1;L--)if(this.path[L].type==="begin"&&xn(this.path[L+1])==="object"&&typeof this.path[L+1].x=="number"){C=new s(this.path[L+1].x,this.path[L+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new s(C.x,C.y)},f.prototype.lineTo=function(C,L){if(isNaN(C)||isNaN(L))throw Tn.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var H=this.ctx.transform.applyToPoint(new s(C,L));this.path.push({type:"lt",x:H.x,y:H.y}),this.ctx.lastPoint=new s(H.x,H.y)},f.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),A.call(this,null,!0)},f.prototype.quadraticCurveTo=function(C,L,H,U){if(isNaN(H)||isNaN(U)||isNaN(C)||isNaN(L))throw Tn.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var te=this.ctx.transform.applyToPoint(new s(H,U)),le=this.ctx.transform.applyToPoint(new s(C,L));this.path.push({type:"qct",x1:le.x,y1:le.y,x:te.x,y:te.y}),this.ctx.lastPoint=new s(te.x,te.y)},f.prototype.bezierCurveTo=function(C,L,H,U,te,le){if(isNaN(te)||isNaN(le)||isNaN(C)||isNaN(L)||isNaN(H)||isNaN(U))throw Tn.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var oe=this.ctx.transform.applyToPoint(new s(te,le)),ae=this.ctx.transform.applyToPoint(new s(C,L)),he=this.ctx.transform.applyToPoint(new s(H,U));this.path.push({type:"bct",x1:ae.x,y1:ae.y,x2:he.x,y2:he.y,x:oe.x,y:oe.y}),this.ctx.lastPoint=new s(oe.x,oe.y)},f.prototype.arc=function(C,L,H,U,te,le){if(isNaN(C)||isNaN(L)||isNaN(H)||isNaN(U)||isNaN(te))throw Tn.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(le=!!le,!this.ctx.transform.isIdentity){var oe=this.ctx.transform.applyToPoint(new s(C,L));C=oe.x,L=oe.y;var ae=this.ctx.transform.applyToPoint(new s(0,H)),he=this.ctx.transform.applyToPoint(new s(0,0));H=Math.sqrt(Math.pow(ae.x-he.x,2)+Math.pow(ae.y-he.y,2))}Math.abs(te-U)>=2*Math.PI&&(U=0,te=2*Math.PI),this.path.push({type:"arc",x:C,y:L,radius:H,startAngle:U,endAngle:te,counterclockwise:le})},f.prototype.arcTo=function(C,L,H,U,te){throw new Error("arcTo not implemented.")},f.prototype.rect=function(C,L,H,U){if(isNaN(C)||isNaN(L)||isNaN(H)||isNaN(U))throw Tn.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(C,L),this.lineTo(C+H,L),this.lineTo(C+H,L+U),this.lineTo(C,L+U),this.lineTo(C,L),this.lineTo(C+H,L),this.lineTo(C,L)},f.prototype.fillRect=function(C,L,H,U){if(isNaN(C)||isNaN(L)||isNaN(H)||isNaN(U))throw Tn.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!p.call(this)){var te={};this.lineCap!=="butt"&&(te.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(te.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(C,L,H,U),this.fill(),te.hasOwnProperty("lineCap")&&(this.lineCap=te.lineCap),te.hasOwnProperty("lineJoin")&&(this.lineJoin=te.lineJoin)}},f.prototype.strokeRect=function(C,L,H,U){if(isNaN(C)||isNaN(L)||isNaN(H)||isNaN(U))throw Tn.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");g.call(this)||(this.beginPath(),this.rect(C,L,H,U),this.stroke())},f.prototype.clearRect=function(C,L,H,U){if(isNaN(C)||isNaN(L)||isNaN(H)||isNaN(U))throw Tn.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(C,L,H,U))},f.prototype.save=function(C){C=typeof C!="boolean"||C;for(var L=this.pdf.internal.getCurrentPageInfo().pageNumber,H=0;H<this.pdf.internal.getNumberOfPages();H++)this.pdf.setPage(H+1),this.pdf.internal.out("q");if(this.pdf.setPage(L),C){this.ctx.fontSize=this.pdf.internal.getFontSize();var U=new d(this.ctx);this.ctxStack.push(this.ctx),this.ctx=U}},f.prototype.restore=function(C){C=typeof C!="boolean"||C;for(var L=this.pdf.internal.getCurrentPageInfo().pageNumber,H=0;H<this.pdf.internal.getNumberOfPages();H++)this.pdf.setPage(H+1),this.pdf.internal.out("Q");this.pdf.setPage(L),C&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},f.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var h=function(C){var L,H,U,te;if(C.isCanvasGradient===!0&&(C=C.getColor()),!C)return{r:0,g:0,b:0,a:0,style:C};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(C))L=0,H=0,U=0,te=0;else{var le=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(C);if(le!==null)L=parseInt(le[1]),H=parseInt(le[2]),U=parseInt(le[3]),te=1;else if((le=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(C))!==null)L=parseInt(le[1]),H=parseInt(le[2]),U=parseInt(le[3]),te=parseFloat(le[4]);else{if(te=1,typeof C=="string"&&C.charAt(0)!=="#"){var oe=new I6(C);C=oe.ok?oe.toHex():"#000000"}C.length===4?(L=C.substring(1,2),L+=L,H=C.substring(2,3),H+=H,U=C.substring(3,4),U+=U):(L=C.substring(1,3),H=C.substring(3,5),U=C.substring(5,7)),L=parseInt(L,16),H=parseInt(H,16),U=parseInt(U,16)}}return{r:L,g:H,b:U,a:te,style:C}},p=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},g=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};f.prototype.fillText=function(C,L,H,U){if(isNaN(L)||isNaN(H)||typeof C!="string")throw Tn.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(U=isNaN(U)?void 0:U,!p.call(this)){var te=D(this.ctx.transform.rotation),le=this.ctx.transform.scaleX;M.call(this,{text:C,x:L,y:H,scale:le,angle:te,align:this.textAlign,maxWidth:U})}},f.prototype.strokeText=function(C,L,H,U){if(isNaN(L)||isNaN(H)||typeof C!="string")throw Tn.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!g.call(this)){U=isNaN(U)?void 0:U;var te=D(this.ctx.transform.rotation),le=this.ctx.transform.scaleX;M.call(this,{text:C,x:L,y:H,scale:le,renderingMode:"stroke",angle:te,align:this.textAlign,maxWidth:U})}},f.prototype.measureText=function(C){if(typeof C!="string")throw Tn.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var L=this.pdf,H=this.pdf.internal.scaleFactor,U=L.internal.getFontSize(),te=L.getStringUnitWidth(C)*U/L.internal.scaleFactor,le=function(oe){var ae=(oe=oe||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return ae}}),this};return new le({width:te*=Math.round(96*H/72*1e4)/1e4})},f.prototype.scale=function(C,L){if(isNaN(C)||isNaN(L))throw Tn.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var H=new c(C,0,0,L,0,0);this.ctx.transform=this.ctx.transform.multiply(H)},f.prototype.rotate=function(C){if(isNaN(C))throw Tn.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var L=new c(Math.cos(C),Math.sin(C),-Math.sin(C),Math.cos(C),0,0);this.ctx.transform=this.ctx.transform.multiply(L)},f.prototype.translate=function(C,L){if(isNaN(C)||isNaN(L))throw Tn.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var H=new c(1,0,0,1,C,L);this.ctx.transform=this.ctx.transform.multiply(H)},f.prototype.transform=function(C,L,H,U,te,le){if(isNaN(C)||isNaN(L)||isNaN(H)||isNaN(U)||isNaN(te)||isNaN(le))throw Tn.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var oe=new c(C,L,H,U,te,le);this.ctx.transform=this.ctx.transform.multiply(oe)},f.prototype.setTransform=function(C,L,H,U,te,le){C=isNaN(C)?1:C,L=isNaN(L)?0:L,H=isNaN(H)?0:H,U=isNaN(U)?1:U,te=isNaN(te)?0:te,le=isNaN(le)?0:le,this.ctx.transform=new c(C,L,H,U,te,le)};var m=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};f.prototype.drawImage=function(C,L,H,U,te,le,oe,ae,he){var me=this.pdf.getImageProperties(C),X=1,G=1,ee=1,se=1;U!==void 0&&ae!==void 0&&(ee=ae/U,se=he/te,X=me.width/U*ae/U,G=me.height/te*he/te),le===void 0&&(le=L,oe=H,L=0,H=0),U!==void 0&&ae===void 0&&(ae=U,he=te),U===void 0&&ae===void 0&&(ae=me.width,he=me.height);for(var V,He=this.ctx.transform.decompose(),Ne=D(He.rotate.shx),Re=new c,Ke=(Re=(Re=(Re=Re.multiply(He.translate)).multiply(He.skew)).multiply(He.scale)).applyToRectangle(new l(le-L*ee,oe-H*se,U*X,te*G)),nt=x.call(this,Ke),st=[],gt=0;gt<nt.length;gt+=1)st.indexOf(nt[gt])===-1&&st.push(nt[gt]);if(w(st),this.autoPaging)for(var Ge=st[0],Je=st[st.length-1],We=Ge;We<Je+1;We++){this.pdf.setPage(We);var _t=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Nt=We===1?this.posY+this.margin[0]:this.margin[0],kt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Vt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],jt=We===1?0:kt+(We-2)*Vt;if(this.ctx.clip_path.length!==0){var Tr=this.path;V=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=_(V,this.posX+this.margin[3],-jt+Nt+this.ctx.prevPageLastElemOffset),O.call(this,"fill",!0),this.path=Tr}var qe=JSON.parse(JSON.stringify(Ke));qe=_([qe],this.posX+this.margin[3],-jt+Nt+this.ctx.prevPageLastElemOffset)[0];var $e=(We>Ge||We<Je)&&m.call(this);$e&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],_t,Vt,null).clip().discardPath()),this.pdf.addImage(C,"JPEG",qe.x,qe.y,qe.w,qe.h,null,null,Ne),$e&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(C,"JPEG",Ke.x,Ke.y,Ke.w,Ke.h,null,null,Ne)};var x=function(C,L,H){var U=[];L=L||this.pdf.internal.pageSize.width,H=H||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var te=this.posY+this.ctx.prevPageLastElemOffset;switch(C.type){default:case"mt":case"lt":U.push(Math.floor((C.y+te)/H)+1);break;case"arc":U.push(Math.floor((C.y+te-C.radius)/H)+1),U.push(Math.floor((C.y+te+C.radius)/H)+1);break;case"qct":var le=P(this.ctx.lastPoint.x,this.ctx.lastPoint.y,C.x1,C.y1,C.x,C.y);U.push(Math.floor((le.y+te)/H)+1),U.push(Math.floor((le.y+le.h+te)/H)+1);break;case"bct":var oe=$(this.ctx.lastPoint.x,this.ctx.lastPoint.y,C.x1,C.y1,C.x2,C.y2,C.x,C.y);U.push(Math.floor((oe.y+te)/H)+1),U.push(Math.floor((oe.y+oe.h+te)/H)+1);break;case"rect":U.push(Math.floor((C.y+te)/H)+1),U.push(Math.floor((C.y+C.h+te)/H)+1)}for(var ae=0;ae<U.length;ae+=1)for(;this.pdf.internal.getNumberOfPages()<U[ae];)b.call(this);return U},b=function(){var C=this.fillStyle,L=this.strokeStyle,H=this.font,U=this.lineCap,te=this.lineWidth,le=this.lineJoin;this.pdf.addPage(),this.fillStyle=C,this.strokeStyle=L,this.font=H,this.lineCap=U,this.lineWidth=te,this.lineJoin=le},_=function(C,L,H){for(var U=0;U<C.length;U++)switch(C[U].type){case"bct":C[U].x2+=L,C[U].y2+=H;case"qct":C[U].x1+=L,C[U].y1+=H;case"mt":case"lt":case"arc":default:C[U].x+=L,C[U].y+=H}return C},w=function(C){return C.sort(function(L,H){return L-H})},A=function(C,L){for(var H,U,te=this.fillStyle,le=this.strokeStyle,oe=this.lineCap,ae=this.lineWidth,he=Math.abs(ae*this.ctx.transform.scaleX),me=this.lineJoin,X=JSON.parse(JSON.stringify(this.path)),G=JSON.parse(JSON.stringify(this.path)),ee=[],se=0;se<G.length;se++)if(G[se].x!==void 0)for(var V=x.call(this,G[se]),He=0;He<V.length;He+=1)ee.indexOf(V[He])===-1&&ee.push(V[He]);for(var Ne=0;Ne<ee.length;Ne++)for(;this.pdf.internal.getNumberOfPages()<ee[Ne];)b.call(this);if(w(ee),this.autoPaging)for(var Re=ee[0],Ke=ee[ee.length-1],nt=Re;nt<Ke+1;nt++){this.pdf.setPage(nt),this.fillStyle=te,this.strokeStyle=le,this.lineCap=oe,this.lineWidth=he,this.lineJoin=me;var st=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],gt=nt===1?this.posY+this.margin[0]:this.margin[0],Ge=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Je=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],We=nt===1?0:Ge+(nt-2)*Je;if(this.ctx.clip_path.length!==0){var _t=this.path;H=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=_(H,this.posX+this.margin[3],-We+gt+this.ctx.prevPageLastElemOffset),O.call(this,C,!0),this.path=_t}if(U=JSON.parse(JSON.stringify(X)),this.path=_(U,this.posX+this.margin[3],-We+gt+this.ctx.prevPageLastElemOffset),L===!1||nt===0){var Nt=(nt>Re||nt<Ke)&&m.call(this);Nt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],st,Je,null).clip().discardPath()),O.call(this,C,L),Nt&&this.pdf.restoreGraphicsState()}this.lineWidth=ae}else this.lineWidth=he,O.call(this,C,L),this.lineWidth=ae;this.path=X},O=function(C,L){if((C!=="stroke"||L||!g.call(this))&&(C==="stroke"||L||!p.call(this))){for(var H,U,te=[],le=this.path,oe=0;oe<le.length;oe++){var ae=le[oe];switch(ae.type){case"begin":te.push({begin:!0});break;case"close":te.push({close:!0});break;case"mt":te.push({start:ae,deltas:[],abs:[]});break;case"lt":var he=te.length;if(le[oe-1]&&!isNaN(le[oe-1].x)&&(H=[ae.x-le[oe-1].x,ae.y-le[oe-1].y],he>0)){for(;he>=0;he--)if(te[he-1].close!==!0&&te[he-1].begin!==!0){te[he-1].deltas.push(H),te[he-1].abs.push(ae);break}}break;case"bct":H=[ae.x1-le[oe-1].x,ae.y1-le[oe-1].y,ae.x2-le[oe-1].x,ae.y2-le[oe-1].y,ae.x-le[oe-1].x,ae.y-le[oe-1].y],te[te.length-1].deltas.push(H);break;case"qct":var me=le[oe-1].x+2/3*(ae.x1-le[oe-1].x),X=le[oe-1].y+2/3*(ae.y1-le[oe-1].y),G=ae.x+2/3*(ae.x1-ae.x),ee=ae.y+2/3*(ae.y1-ae.y),se=ae.x,V=ae.y;H=[me-le[oe-1].x,X-le[oe-1].y,G-le[oe-1].x,ee-le[oe-1].y,se-le[oe-1].x,V-le[oe-1].y],te[te.length-1].deltas.push(H);break;case"arc":te.push({deltas:[],abs:[],arc:!0}),Array.isArray(te[te.length-1].abs)&&te[te.length-1].abs.push(ae)}}U=L?null:C==="stroke"?"stroke":"fill";for(var He=!1,Ne=0;Ne<te.length;Ne++)if(te[Ne].arc)for(var Re=te[Ne].abs,Ke=0;Ke<Re.length;Ke++){var nt=Re[Ke];nt.type==="arc"?S.call(this,nt.x,nt.y,nt.radius,nt.startAngle,nt.endAngle,nt.counterclockwise,void 0,L,!He):R.call(this,nt.x,nt.y),He=!0}else if(te[Ne].close===!0)this.pdf.internal.out("h"),He=!1;else if(te[Ne].begin!==!0){var st=te[Ne].start.x,gt=te[Ne].start.y;F.call(this,te[Ne].deltas,st,gt),He=!0}U&&I.call(this,U),L&&z.call(this)}},T=function(C){var L=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,H=L*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return C-H;case"top":return C+L-H;case"hanging":return C+L-2*H;case"middle":return C+L/2-H;case"ideographic":return C;case"alphabetic":default:return C}},E=function(C){return C+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};f.prototype.createLinearGradient=function(){var C=function(){};return C.colorStops=[],C.addColorStop=function(L,H){this.colorStops.push([L,H])},C.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},C.isCanvasGradient=!0,C},f.prototype.createPattern=function(){return this.createLinearGradient()},f.prototype.createRadialGradient=function(){return this.createLinearGradient()};var S=function(C,L,H,U,te,le,oe,ae,he){for(var me=K.call(this,H,U,te,le),X=0;X<me.length;X++){var G=me[X];X===0&&(he?k.call(this,G.x1+C,G.y1+L):R.call(this,G.x1+C,G.y1+L)),W.call(this,C,L,G.x2,G.y2,G.x3,G.y3,G.x4,G.y4)}ae?z.call(this):I.call(this,oe)},I=function(C){switch(C){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},z=function(){this.pdf.clip(),this.pdf.discardPath()},k=function(C,L){this.pdf.internal.out(r(C)+" "+n(L)+" m")},M=function(C){var L;switch(C.align){case"right":case"end":L="right";break;case"center":L="center";break;case"left":case"start":default:L="left"}var H=this.pdf.getTextDimensions(C.text),U=T.call(this,C.y),te=E.call(this,U)-H.h,le=this.ctx.transform.applyToPoint(new s(C.x,U)),oe=this.ctx.transform.decompose(),ae=new c;ae=(ae=(ae=ae.multiply(oe.translate)).multiply(oe.skew)).multiply(oe.scale);for(var he,me,X,G=this.ctx.transform.applyToRectangle(new l(C.x,U,H.w,H.h)),ee=ae.applyToRectangle(new l(C.x,te,H.w,H.h)),se=x.call(this,ee),V=[],He=0;He<se.length;He+=1)V.indexOf(se[He])===-1&&V.push(se[He]);if(w(V),this.autoPaging)for(var Ne=V[0],Re=V[V.length-1],Ke=Ne;Ke<Re+1;Ke++){this.pdf.setPage(Ke);var nt=Ke===1?this.posY+this.margin[0]:this.margin[0],st=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],gt=this.pdf.internal.pageSize.height-this.margin[2],Ge=gt-this.margin[0],Je=this.pdf.internal.pageSize.width-this.margin[1],We=Je-this.margin[3],_t=Ke===1?0:st+(Ke-2)*Ge;if(this.ctx.clip_path.length!==0){var Nt=this.path;he=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=_(he,this.posX+this.margin[3],-1*_t+nt),O.call(this,"fill",!0),this.path=Nt}var kt=_([JSON.parse(JSON.stringify(ee))],this.posX+this.margin[3],-_t+nt+this.ctx.prevPageLastElemOffset)[0];C.scale>=.01&&(me=this.pdf.internal.getFontSize(),this.pdf.setFontSize(me*C.scale),X=this.lineWidth,this.lineWidth=X*C.scale);var Vt=this.autoPaging!=="text";if(Vt||kt.y+kt.h<=gt){if(Vt||kt.y>=nt&&kt.x<=Je){var jt=Vt?C.text:this.pdf.splitTextToSize(C.text,C.maxWidth||Je-kt.x)[0],Tr=_([JSON.parse(JSON.stringify(G))],this.posX+this.margin[3],-_t+nt+this.ctx.prevPageLastElemOffset)[0],qe=Vt&&(Ke>Ne||Ke<Re)&&m.call(this);qe&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],We,Ge,null).clip().discardPath()),this.pdf.text(jt,Tr.x,Tr.y,{angle:C.angle,align:L,renderingMode:C.renderingMode}),qe&&this.pdf.restoreGraphicsState()}}else kt.y<gt&&(this.ctx.prevPageLastElemOffset+=gt-kt.y);C.scale>=.01&&(this.pdf.setFontSize(me),this.lineWidth=X)}else C.scale>=.01&&(me=this.pdf.internal.getFontSize(),this.pdf.setFontSize(me*C.scale),X=this.lineWidth,this.lineWidth=X*C.scale),this.pdf.text(C.text,le.x+this.posX,le.y+this.posY,{angle:C.angle,align:L,renderingMode:C.renderingMode,maxWidth:C.maxWidth}),C.scale>=.01&&(this.pdf.setFontSize(me),this.lineWidth=X)},R=function(C,L,H,U){H=H||0,U=U||0,this.pdf.internal.out(r(C+H)+" "+n(L+U)+" l")},F=function(C,L,H){return this.pdf.lines(C,L,H,null,null)},W=function(C,L,H,U,te,le,oe,ae){this.pdf.internal.out([t(a(H+C)),t(o(U+L)),t(a(te+C)),t(o(le+L)),t(a(oe+C)),t(o(ae+L)),"c"].join(" "))},K=function(C,L,H,U){for(var te=2*Math.PI,le=Math.PI/2;L>H;)L-=te;var oe=Math.abs(H-L);oe<te&&U&&(oe=te-oe);for(var ae=[],he=U?-1:1,me=L;oe>1e-5;){var X=me+he*Math.min(oe,le);ae.push(Z.call(this,C,me,X)),oe-=Math.abs(X-me),me=X}return ae},Z=function(C,L,H){var U=(H-L)/2,te=C*Math.cos(U),le=C*Math.sin(U),oe=te,ae=-le,he=oe*oe+ae*ae,me=he+oe*te+ae*le,X=4/3*(Math.sqrt(2*he*me)-me)/(oe*le-ae*te),G=oe-X*ae,ee=ae+X*oe,se=G,V=-ee,He=U+L,Ne=Math.cos(He),Re=Math.sin(He);return{x1:C*Math.cos(L),y1:C*Math.sin(L),x2:G*Ne-ee*Re,y2:G*Re+ee*Ne,x3:se*Ne-V*Re,y3:se*Re+V*Ne,x4:C*Math.cos(H),y4:C*Math.sin(H)}},D=function(C){return 180*C/Math.PI},P=function(C,L,H,U,te,le){var oe=C+.5*(H-C),ae=L+.5*(U-L),he=te+.5*(H-te),me=le+.5*(U-le),X=Math.min(C,te,oe,he),G=Math.max(C,te,oe,he),ee=Math.min(L,le,ae,me),se=Math.max(L,le,ae,me);return new l(X,ee,G-X,se-ee)},$=function(C,L,H,U,te,le,oe,ae){var he,me,X,G,ee,se,V,He,Ne,Re,Ke,nt,st,gt,Ge=H-C,Je=U-L,We=te-H,_t=le-U,Nt=oe-te,kt=ae-le;for(me=0;me<41;me++)Ne=(V=(X=C+(he=me/40)*Ge)+he*((ee=H+he*We)-X))+he*(ee+he*(te+he*Nt-ee)-V),Re=(He=(G=L+he*Je)+he*((se=U+he*_t)-G))+he*(se+he*(le+he*kt-se)-He),me==0?(Ke=Ne,nt=Re,st=Ne,gt=Re):(Ke=Math.min(Ke,Ne),nt=Math.min(nt,Re),st=Math.max(st,Ne),gt=Math.max(gt,Re));return new l(Math.round(Ke),Math.round(nt),Math.round(st-Ke),Math.round(gt-nt))},Q=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var C,L,H=(C=this.ctx.lineDash,L=this.ctx.lineDashOffset,JSON.stringify({lineDash:C,lineDashOffset:L}));this.prevLineDash!==H&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=H)}}})(Sr.API),function(e){var t=function(o){var s,l,c,u,d,f,h,p,g,m;for(l=[],c=0,u=(o+=s="\0\0\0\0".slice(o.length%4||4)).length;u>c;c+=4)(d=(o.charCodeAt(c)<<24)+(o.charCodeAt(c+1)<<16)+(o.charCodeAt(c+2)<<8)+o.charCodeAt(c+3))!==0?(f=(d=((d=((d=((d=(d-(m=d%85))/85)-(g=d%85))/85)-(p=d%85))/85)-(h=d%85))/85)%85,l.push(f+33,h+33,p+33,g+33,m+33)):l.push(122);return function(x,b){for(var _=b;_>0;_--)x.pop()}(l,s.length),String.fromCharCode.apply(String,l)+"~>"},r=function(o){var s,l,c,u,d,f=String,h="length",p=255,g="charCodeAt",m="slice",x="replace";for(o[m](-2),o=o[m](0,-2)[x](/\s/g,"")[x]("z","!!!!!"),c=[],u=0,d=(o+=s="uuuuu"[m](o[h]%5||5))[h];d>u;u+=5)l=52200625*(o[g](u)-33)+614125*(o[g](u+1)-33)+7225*(o[g](u+2)-33)+85*(o[g](u+3)-33)+(o[g](u+4)-33),c.push(p&l>>24,p&l>>16,p&l>>8,p&l);return function(b,_){for(var w=_;w>0;w--)b.pop()}(c,s[h]),f.fromCharCode.apply(f,c)},n=function(o){var s=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((o=o.replace(/\s/g,"")).indexOf(">")!==-1&&(o=o.substr(0,o.indexOf(">"))),o.length%2&&(o+="0"),s.test(o)===!1)return"";for(var l="",c=0;c<o.length;c+=2)l+=String.fromCharCode("0x"+(o[c]+o[c+1]));return l},a=function(o){for(var s=new Uint8Array(o.length),l=o.length;l--;)s[l]=o.charCodeAt(l);return o=(s=Tw(s)).reduce(function(c,u){return c+String.fromCharCode(u)},"")};e.processDataByFilters=function(o,s){var l=0,c=o||"",u=[];for(typeof(s=s||[])=="string"&&(s=[s]),l=0;l<s.length;l+=1)switch(s[l]){case"ASCII85Decode":case"/ASCII85Decode":c=r(c),u.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":c=t(c),u.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":c=n(c),u.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":c=c.split("").map(function(d){return("0"+d.charCodeAt().toString(16)).slice(-2)}).join("")+">",u.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":c=a(c),u.push("/FlateDecode");break;default:throw new Error('The filter: "'+s[l]+'" is not implemented')}return{data:c,reverseChain:u.reverse().join(" ")}}}(Sr.API),function(e){e.loadFile=function(t,r,n){return function(a,o,s){o=o!==!1,s=typeof s=="function"?s:function(){};var l=void 0;try{l=function(c,u,d){var f=new XMLHttpRequest,h=0,p=function(g){var m=g.length,x=[],b=String.fromCharCode;for(h=0;h<m;h+=1)x.push(b(255&g.charCodeAt(h)));return x.join("")};if(f.open("GET",c,!u),f.overrideMimeType("text/plain; charset=x-user-defined"),u===!1&&(f.onload=function(){f.status===200?d(p(this.responseText)):d(void 0)}),f.send(null),u&&f.status===200)return p(f.responseText)}(a,o,s)}catch{}return l}(t,r,n)},e.loadImageFile=e.loadFile}(Sr.API),function(e){function t(){return(kr.html2canvas?Promise.resolve(kr.html2canvas):Cw(()=>import("./html2canvas.esm-BfxBtG_O.js"),[])).catch(function(s){return Promise.reject(new Error("Could not load html2canvas: "+s))}).then(function(s){return s.default?s.default:s})}function r(){return(kr.DOMPurify?Promise.resolve(kr.DOMPurify):Cw(()=>import("./purify.es-CQJ0hv7W.js"),[])).catch(function(s){return Promise.reject(new Error("Could not load dompurify: "+s))}).then(function(s){return s.default?s.default:s})}var n=function(s){var l=xn(s);return l==="undefined"?"undefined":l==="string"||s instanceof String?"string":l==="number"||s instanceof Number?"number":l==="function"||s instanceof Function?"function":s&&s.constructor===Array?"array":s&&s.nodeType===1?"element":l==="object"?"object":"unknown"},a=function(s,l){var c=document.createElement(s);for(var u in l.className&&(c.className=l.className),l.innerHTML&&l.dompurify&&(c.innerHTML=l.dompurify.sanitize(l.innerHTML)),l.style)c.style[u]=l.style[u];return c},o=function s(l){var c=Object.assign(s.convert(Promise.resolve()),JSON.parse(JSON.stringify(s.template))),u=s.convert(Promise.resolve(),c);return u=(u=u.setProgress(1,s,1,[s])).set(l)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(s,l){return s.__proto__=l||o.prototype,s},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(s,l){return this.then(function(){switch(l=l||function(c){switch(n(c)){case"string":return"string";case"element":return c.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(s)){case"string":return this.then(r).then(function(c){return this.set({src:a("div",{innerHTML:s,dompurify:c})})});case"element":return this.set({src:s});case"canvas":return this.set({canvas:s});case"img":return this.set({img:s});default:return this.error("Unknown source type.")}})},o.prototype.to=function(s){switch(s){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var s={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},l=function c(u,d){for(var f=u.nodeType===3?document.createTextNode(u.nodeValue):u.cloneNode(!1),h=u.firstChild;h;h=h.nextSibling)d!==!0&&h.nodeType===1&&h.nodeName==="SCRIPT"||f.appendChild(c(h,d));return u.nodeType===1&&(u.nodeName==="CANVAS"?(f.width=u.width,f.height=u.height,f.getContext("2d").drawImage(u,0,0)):u.nodeName!=="TEXTAREA"&&u.nodeName!=="SELECT"||(f.value=u.value),f.addEventListener("load",function(){f.scrollTop=u.scrollTop,f.scrollLeft=u.scrollLeft},!0)),f}(this.prop.src,this.opt.html2canvas.javascriptEnabled);l.tagName==="BODY"&&(s.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=a("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=a("div",{className:"html2pdf__container",style:s}),this.prop.container.appendChild(l),this.prop.container.firstChild.appendChild(a("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var s=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(s).then(t).then(function(l){var c=Object.assign({},this.opt.html2canvas);return delete c.onrendered,l(this.prop.container,c)}).then(function(l){(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var s=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(s).then(t).then(function(l){var c=this.opt.jsPDF,u=this.opt.fontFaces,d=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,f=Object.assign({async:!0,allowTaint:!0,scale:d,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete f.onrendered,c.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,c.context2d.posX=this.opt.x,c.context2d.posY=this.opt.y,c.context2d.margin=this.opt.margin,c.context2d.fontFaces=u,u)for(var h=0;h<u.length;++h){var p=u[h],g=p.src.find(function(m){return m.format==="truetype"});g&&c.addFont(g.url,p.ref.name,p.ref.style)}return f.windowHeight=f.windowHeight||0,f.windowHeight=f.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):f.windowHeight,c.context2d.save(!0),l(this.prop.container,f)}).then(function(l){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var s=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=s})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(s,l,c){return(c=c||"pdf").toLowerCase()==="img"||c.toLowerCase()==="image"?this.outputImg(s,l):this.outputPdf(s,l)},o.prototype.outputPdf=function(s,l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(s,l)})},o.prototype.outputImg=function(s){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(s){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+s+'" is not supported.'}})},o.prototype.save=function(s){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(s?{filename:s}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(s){if(n(s)!=="object")return this;var l=Object.keys(s||{}).map(function(c){if(c in o.template.prop)return function(){this.prop[c]=s[c]};switch(c){case"margin":return this.setMargin.bind(this,s.margin);case"jsPDF":return function(){return this.opt.jsPDF=s.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,s.pageSize);default:return function(){this.opt[c]=s[c]}}},this);return this.then(function(){return this.thenList(l)})},o.prototype.get=function(s,l){return this.then(function(){var c=s in o.template.prop?this.prop[s]:this.opt[s];return l?l(c):c})},o.prototype.setMargin=function(s){return this.then(function(){switch(n(s)){case"number":s=[s,s,s,s];case"array":if(s.length===2&&(s=[s[0],s[1],s[0],s[1]]),s.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=s}).then(this.setPageSize)},o.prototype.setPageSize=function(s){function l(c,u){return Math.floor(c*u/72*96)}return this.then(function(){(s=s||Sr.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(s.inner={width:s.width-this.opt.margin[1]-this.opt.margin[3],height:s.height-this.opt.margin[0]-this.opt.margin[2]},s.inner.px={width:l(s.inner.width,s.k),height:l(s.inner.height,s.k)},s.inner.ratio=s.inner.height/s.inner.width),this.prop.pageSize=s})},o.prototype.setProgress=function(s,l,c,u){return s!=null&&(this.progress.val=s),l!=null&&(this.progress.state=l),c!=null&&(this.progress.n=c),u!=null&&(this.progress.stack=u),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(s,l,c,u){return this.setProgress(s?this.progress.val+s:null,l||null,c?this.progress.n+c:null,u?this.progress.stack.concat(u):null)},o.prototype.then=function(s,l){var c=this;return this.thenCore(s,l,function(u,d){return c.updateProgress(null,null,1,[u]),Promise.prototype.then.call(this,function(f){return c.updateProgress(null,u),f}).then(u,d).then(function(f){return c.updateProgress(1),f})})},o.prototype.thenCore=function(s,l,c){c=c||Promise.prototype.then,s&&(s=s.bind(this)),l&&(l=l.bind(this));var u=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:o.convert(Object.assign({},this),Promise.prototype),d=c.call(u,s,l);return o.convert(d,this.__proto__)},o.prototype.thenExternal=function(s,l){return Promise.prototype.then.call(this,s,l)},o.prototype.thenList=function(s){var l=this;return s.forEach(function(c){l=l.thenCore(c)}),l},o.prototype.catch=function(s){s&&(s=s.bind(this));var l=Promise.prototype.catch.call(this,s);return o.convert(l,this)},o.prototype.catchExternal=function(s){return Promise.prototype.catch.call(this,s)},o.prototype.error=function(s){return this.then(function(){throw new Error(s)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,Sr.getPageSize=function(s,l,c){if(xn(s)==="object"){var u=s;s=u.orientation,l=u.unit||l,c=u.format||c}l=l||"mm",c=c||"a4",s=(""+(s||"P")).toLowerCase();var d,f=(""+c).toLowerCase(),h={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(l){case"pt":d=1;break;case"mm":d=72/25.4;break;case"cm":d=72/2.54;break;case"in":d=72;break;case"px":d=.75;break;case"pc":case"em":d=12;break;case"ex":d=6;break;default:throw"Invalid unit: "+l}var p,g=0,m=0;if(h.hasOwnProperty(f))g=h[f][1]/d,m=h[f][0]/d;else try{g=c[1],m=c[0]}catch{throw new Error("Invalid format: "+c)}if(s==="p"||s==="portrait")s="p",m>g&&(p=m,m=g,g=p);else{if(s!=="l"&&s!=="landscape")throw"Invalid orientation: "+s;s="l",g>m&&(p=m,m=g,g=p)}return{width:m,height:g,unit:l,k:d,orientation:s}},e.html=function(s,l){(l=l||{}).callback=l.callback||function(){},l.html2canvas=l.html2canvas||{},l.html2canvas.canvas=l.html2canvas.canvas||this.canvas,l.jsPDF=l.jsPDF||this,l.fontFaces=l.fontFaces?l.fontFaces.map(Lw):null;var c=new o(l);return l.worker?c:c.from(s).doCallback()}}(Sr.API),Sr.API.addJS=function(e){return e4=e,this.internal.events.subscribe("postPutResources",function(){Rm=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Rm+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),ZE=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+e4+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Rm!==void 0&&ZE!==void 0&&this.internal.out("/Names <</JavaScript "+Rm+" 0 R>>")}),this},function(e){var t;e.events.push(["postPutResources",function(){var r=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var a=r.outline.render().split(/\r\n/),o=0;o<a.length;o++){var s=a[o],l=n.exec(s);if(l!=null){var c=l[1];r.internal.newObjectDeferredBegin(c,!1)}r.internal.write(s)}if(this.outline.createNamedDestinations){var u=this.internal.pages.length,d=[];for(o=0;o<u;o++){var f=r.internal.newObject();d.push(f);var h=r.internal.getPageInfo(o+1);r.internal.write("<< /D["+h.objId+" 0 R /XYZ null null null]>> endobj")}var p=r.internal.newObject();for(r.internal.write("<< /Names [ "),o=0;o<d.length;o++)r.internal.write("(page_"+(o+1)+")"+d[o]+" 0 R");r.internal.write(" ] >>","endobj"),t=r.internal.newObject(),r.internal.write("<< /Dests "+p+" 0 R"),r.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var r=this;r.outline={createNamedDestinations:!1,root:{children:[]}},r.outline.add=function(n,a,o){var s={title:a,options:o,children:[]};return n==null&&(n=this.root),n.children.push(s),s},r.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=r,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},r.outline.genIds_r=function(n){n.id=r.internal.newObjectDeferred();for(var a=0;a<n.children.length;a++)this.genIds_r(n.children[a])},r.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},r.outline.renderItems=function(n){for(var a=this.ctx.pdf.internal.getVerticalCoordinateString,o=0;o<n.children.length;o++){var s=n.children[o];this.objStart(s),this.line("/Title "+this.makeString(s.title)),this.line("/Parent "+this.makeRef(n)),o>0&&this.line("/Prev "+this.makeRef(n.children[o-1])),o<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[o+1])),s.children.length>0&&(this.line("/First "+this.makeRef(s.children[0])),this.line("/Last "+this.makeRef(s.children[s.children.length-1])));var l=this.count=this.count_r({count:0},s);if(l>0&&this.line("/Count "+l),s.options&&s.options.pageNumber){var c=r.internal.getPageInfo(s.options.pageNumber);this.line("/Dest ["+c.objId+" 0 R /XYZ 0 "+a(0)+" 0]")}this.objEnd()}for(var u=0;u<n.children.length;u++)this.renderItems(n.children[u])},r.outline.line=function(n){this.ctx.val+=n+`\r
`},r.outline.makeRef=function(n){return n.id+" 0 R"},r.outline.makeString=function(n){return"("+r.internal.pdfEscape(n)+")"},r.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},r.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},r.outline.count_r=function(n,a){for(var o=0;o<a.children.length;o++)n.count++,this.count_r(n,a.children[o]);return n.count}}])}(Sr.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(r,n,a,o,s,l){var c,u=this.decode.DCT_DECODE,d=null;if(typeof r=="string"||this.__addimage__.isArrayBuffer(r)||this.__addimage__.isArrayBufferView(r)){switch(r=s||r,r=this.__addimage__.isArrayBuffer(r)?new Uint8Array(r):r,(c=function(f){for(var h,p=256*f.charCodeAt(4)+f.charCodeAt(5),g=f.length,m={width:0,height:0,numcomponents:1},x=4;x<g;x+=2){if(x+=p,t.indexOf(f.charCodeAt(x+1))!==-1){h=256*f.charCodeAt(x+5)+f.charCodeAt(x+6),m={width:256*f.charCodeAt(x+7)+f.charCodeAt(x+8),height:h,numcomponents:f.charCodeAt(x+9)};break}p=256*f.charCodeAt(x+2)+f.charCodeAt(x+3)}return m}(r=this.__addimage__.isArrayBufferView(r)?this.__addimage__.arrayBufferToBinaryString(r):r)).numcomponents){case 1:l=this.color_spaces.DEVICE_GRAY;break;case 4:l=this.color_spaces.DEVICE_CMYK;break;case 3:l=this.color_spaces.DEVICE_RGB}d={data:r,width:c.width,height:c.height,colorSpace:l,bitsPerComponent:8,filter:u,index:n,alias:a}}return d}}(Sr.API);var Au,qm,t4,r4,n4,uce=function(){var e,t,r;function n(o){var s,l,c,u,d,f,h,p,g,m,x,b,_,w;for(this.data=o,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},f=null;;){switch(s=this.readUInt32(),g=(function(){var A,O;for(O=[],A=0;A<4;++A)O.push(String.fromCharCode(this.data[this.pos++]));return O}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(s);break;case"fcTL":f&&this.animation.frames.push(f),this.pos+=4,f={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},d=this.readUInt16(),u=this.readUInt16()||100,f.delay=1e3*d/u,f.disposeOp=this.data[this.pos++],f.blendOp=this.data[this.pos++],f.data=[];break;case"IDAT":case"fdAT":for(g==="fdAT"&&(this.pos+=4,s-=4),o=f?.data||this.imgData,b=0;0<=s?b<s:b>s;0<=s?++b:--b)o.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(c=this.palette.length/3,this.transparency.indexed=this.read(s),this.transparency.indexed.length>c)throw new Error("More transparent colors than palette size");if((m=c-this.transparency.indexed.length)>0)for(_=0;0<=m?_<m:_>m;0<=m?++_:--_)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(s)[0];break;case 2:this.transparency.rgb=this.read(s)}break;case"tEXt":h=(x=this.read(s)).indexOf(0),p=String.fromCharCode.apply(String,x.slice(0,h)),this.text[p]=String.fromCharCode.apply(String,x.slice(h+1));break;case"IEND":return f&&this.animation.frames.push(f),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(w=this.colorType)===4||w===6,l=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*l,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=s}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}n.prototype.read=function(o){var s,l;for(l=[],s=0;0<=o?s<o:s>o;0<=o?++s:--s)l.push(this.data[this.pos++]);return l},n.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.decodePixels=function(o){var s=this.pixelBitlength/8,l=new Uint8Array(this.width*this.height*s),c=0,u=this;if(o==null&&(o=this.imgData),o.length===0)return new Uint8Array(0);function d(f,h,p,g){var m,x,b,_,w,A,O,T,E,S,I,z,k,M,R,F,W,K,Z,D,P,$=Math.ceil((u.width-f)/p),Q=Math.ceil((u.height-h)/g),C=u.width==$&&u.height==Q;for(M=s*$,z=C?l:new Uint8Array(M*Q),A=o.length,k=0,x=0;k<Q&&c<A;){switch(o[c++]){case 0:for(_=W=0;W<M;_=W+=1)z[x++]=o[c++];break;case 1:for(_=K=0;K<M;_=K+=1)m=o[c++],w=_<s?0:z[x-s],z[x++]=(m+w)%256;break;case 2:for(_=Z=0;Z<M;_=Z+=1)m=o[c++],b=(_-_%s)/s,R=k&&z[(k-1)*M+b*s+_%s],z[x++]=(R+m)%256;break;case 3:for(_=D=0;D<M;_=D+=1)m=o[c++],b=(_-_%s)/s,w=_<s?0:z[x-s],R=k&&z[(k-1)*M+b*s+_%s],z[x++]=(m+Math.floor((w+R)/2))%256;break;case 4:for(_=P=0;P<M;_=P+=1)m=o[c++],b=(_-_%s)/s,w=_<s?0:z[x-s],k===0?R=F=0:(R=z[(k-1)*M+b*s+_%s],F=b&&z[(k-1)*M+(b-1)*s+_%s]),O=w+R-F,T=Math.abs(O-w),S=Math.abs(O-R),I=Math.abs(O-F),E=T<=S&&T<=I?w:S<=I?R:F,z[x++]=(m+E)%256;break;default:throw new Error("Invalid filter algorithm: "+o[c-1])}if(!C){var L=((h+k*g)*u.width+f)*s,H=k*M;for(_=0;_<$;_+=1){for(var U=0;U<s;U+=1)l[L++]=z[H++];L+=(p-1)*s}}k++}}return o=Ule(o),u.interlaceMethod==1?(d(0,0,8,8),d(4,0,8,8),d(0,4,4,8),d(2,0,4,4),d(0,2,2,4),d(1,0,2,2),d(0,1,1,2)):d(0,0,1,1),l},n.prototype.decodePalette=function(){var o,s,l,c,u,d,f,h,p;for(l=this.palette,d=this.transparency.indexed||[],u=new Uint8Array((d.length||0)+l.length),c=0,o=0,s=f=0,h=l.length;f<h;s=f+=3)u[c++]=l[s],u[c++]=l[s+1],u[c++]=l[s+2],u[c++]=(p=d[o++])!=null?p:255;return u},n.prototype.copyToImageData=function(o,s){var l,c,u,d,f,h,p,g,m,x,b;if(c=this.colors,m=null,l=this.hasAlphaChannel,this.palette.length&&(m=(b=this._decodedPalette)!=null?b:this._decodedPalette=this.decodePalette(),c=4,l=!0),g=(u=o.data||o).length,f=m||s,d=h=0,c===1)for(;d<g;)p=m?4*s[d/4]:h,x=f[p++],u[d++]=x,u[d++]=x,u[d++]=x,u[d++]=l?f[p++]:255,h=p;else for(;d<g;)p=m?4*s[d/4]:h,u[d++]=f[p++],u[d++]=f[p++],u[d++]=f[p++],u[d++]=l?f[p++]:255,h=p},n.prototype.decode=function(){var o;return o=new Uint8Array(this.width*this.height*4),this.copyToImageData(o,this.decodePixels()),o};var a=function(){if(Object.prototype.toString.call(kr)==="[object Window]"){try{t=kr.document.createElement("canvas"),r=t.getContext("2d")}catch{return!1}return!0}return!1};return a(),e=function(o){var s;if(a()===!0)return r.width=o.width,r.height=o.height,r.clearRect(0,0,o.width,o.height),r.putImageData(o,0,0),(s=new Image).src=t.toDataURL(),s;throw new Error("This method requires a Browser with Canvas-capability.")},n.prototype.decodeFrames=function(o){var s,l,c,u,d,f,h,p;if(this.animation){for(p=[],l=d=0,f=(h=this.animation.frames).length;d<f;l=++d)s=h[l],c=o.createImageData(s.width,s.height),u=this.decodePixels(new Uint8Array(s.data)),this.copyToImageData(c,u),s.imageData=c,p.push(s.image=e(c));return p}},n.prototype.renderFrame=function(o,s){var l,c,u;return l=(c=this.animation.frames)[s],u=c[s-1],s===0&&o.clearRect(0,0,this.width,this.height),u?.disposeOp===1?o.clearRect(u.xOffset,u.yOffset,u.width,u.height):u?.disposeOp===2&&o.putImageData(u.imageData,u.xOffset,u.yOffset),l.blendOp===0&&o.clearRect(l.xOffset,l.yOffset,l.width,l.height),o.drawImage(l.image,l.xOffset,l.yOffset)},n.prototype.animate=function(o){var s,l,c,u,d,f,h=this;return l=0,f=this.animation,u=f.numFrames,c=f.frames,d=f.numPlays,(s=function(){var p,g;if(p=l++%u,g=c[p],h.renderFrame(o,p),u>1&&l/u<d)return h.animation._timeout=setTimeout(s,g.delay)})()},n.prototype.stopAnimation=function(){var o;return clearTimeout((o=this.animation)!=null?o._timeout:void 0)},n.prototype.render=function(o){var s,l;return o._png&&o._png.stopAnimation(),o._png=this,o.width=this.width,o.height=this.height,s=o.getContext("2d"),this.animation?(this.decodeFrames(s),this.animate(s)):(l=s.createImageData(this.width,this.height),this.copyToImageData(l,this.decodePixels()),s.putImageData(l,0,0))},n}();/**
 * @license
 *
 * Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 *//**
 * @license
 * (c) Dean McNamee <dean@gmail.com>, 2013.
 *
 * https://github.com/deanm/omggif
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
 * including animation and compression.  It does not rely on any specific
 * underlying system, so should run in the browser, Node, or Plask.
 */function dce(e){var t=0;if(e[t++]!==71||e[t++]!==73||e[t++]!==70||e[t++]!==56||(e[t++]+1&253)!=56||e[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var r=e[t++]|e[t++]<<8,n=e[t++]|e[t++]<<8,a=e[t++],o=a>>7,s=1<<(7&a)+1;e[t++],e[t++];var l=null,c=null;o&&(l=t,c=s,t+=3*s);var u=!0,d=[],f=0,h=null,p=0,g=null;for(this.width=r,this.height=n;u&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(e[t]!==11||e[t+1]==78&&e[t+2]==69&&e[t+3]==84&&e[t+4]==83&&e[t+5]==67&&e[t+6]==65&&e[t+7]==80&&e[t+8]==69&&e[t+9]==50&&e[t+10]==46&&e[t+11]==48&&e[t+12]==3&&e[t+13]==1&&e[t+16]==0)t+=14,g=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((k=e[t++])>=0))throw Error("Invalid block size");if(k===0)break;t+=k}break;case 249:if(e[t++]!==4||e[t+4]!==0)throw new Error("Invalid graphics extension block.");var m=e[t++];f=e[t++]|e[t++]<<8,h=e[t++],(1&m)==0&&(h=null),p=m>>2&7,t++;break;case 254:for(;;){if(!((k=e[t++])>=0))throw Error("Invalid block size");if(k===0)break;t+=k}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var x=e[t++]|e[t++]<<8,b=e[t++]|e[t++]<<8,_=e[t++]|e[t++]<<8,w=e[t++]|e[t++]<<8,A=e[t++],O=A>>6&1,T=1<<(7&A)+1,E=l,S=c,I=!1;A>>7&&(I=!0,E=t,S=T,t+=3*T);var z=t;for(t++;;){var k;if(!((k=e[t++])>=0))throw Error("Invalid block size");if(k===0)break;t+=k}d.push({x,y:b,width:_,height:w,has_local_palette:I,palette_offset:E,palette_size:S,data_offset:z,data_length:t-z,transparent_index:h,interlaced:!!O,delay:f,disposal:p});break;case 59:u=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return d.length},this.loopCount=function(){return g},this.frameInfo=function(M){if(M<0||M>=d.length)throw new Error("Frame index out of range.");return d[M]},this.decodeAndBlitFrameBGRA=function(M,R){var F=this.frameInfo(M),W=F.width*F.height,K=new Uint8Array(W);a4(e,F.data_offset,K,W);var Z=F.palette_offset,D=F.transparent_index;D===null&&(D=256);var P=F.width,$=r-P,Q=P,C=4*(F.y*r+F.x),L=4*((F.y+F.height)*r+F.x),H=C,U=4*$;F.interlaced===!0&&(U+=4*r*7);for(var te=8,le=0,oe=K.length;le<oe;++le){var ae=K[le];if(Q===0&&(Q=P,(H+=U)>=L&&(U=4*$+4*r*(te-1),H=C+(P+$)*(te<<1),te>>=1)),ae===D)H+=4;else{var he=e[Z+3*ae],me=e[Z+3*ae+1],X=e[Z+3*ae+2];R[H++]=X,R[H++]=me,R[H++]=he,R[H++]=255}--Q}},this.decodeAndBlitFrameRGBA=function(M,R){var F=this.frameInfo(M),W=F.width*F.height,K=new Uint8Array(W);a4(e,F.data_offset,K,W);var Z=F.palette_offset,D=F.transparent_index;D===null&&(D=256);var P=F.width,$=r-P,Q=P,C=4*(F.y*r+F.x),L=4*((F.y+F.height)*r+F.x),H=C,U=4*$;F.interlaced===!0&&(U+=4*r*7);for(var te=8,le=0,oe=K.length;le<oe;++le){var ae=K[le];if(Q===0&&(Q=P,(H+=U)>=L&&(U=4*$+4*r*(te-1),H=C+(P+$)*(te<<1),te>>=1)),ae===D)H+=4;else{var he=e[Z+3*ae],me=e[Z+3*ae+1],X=e[Z+3*ae+2];R[H++]=he,R[H++]=me,R[H++]=X,R[H++]=255}--Q}}}function a4(e,t,r,n){for(var a=e[t++],o=1<<a,s=o+1,l=s+1,c=a+1,u=(1<<c)-1,d=0,f=0,h=0,p=e[t++],g=new Int32Array(4096),m=null;;){for(;d<16&&p!==0;)f|=e[t++]<<d,d+=8,p===1?p=e[t++]:--p;if(d<c)break;var x=f&u;if(f>>=c,d-=c,x!==o){if(x===s)break;for(var b=x<l?x:m,_=0,w=b;w>o;)w=g[w]>>8,++_;var A=w;if(h+_+(b!==x?1:0)>n)return void Tn.log("Warning, gif stream longer than expected.");r[h++]=A;var O=h+=_;for(b!==x&&(r[h++]=A),w=b;_--;)w=g[w],r[--O]=255&w,w>>=8;m!==null&&l<4096&&(g[l++]=m<<8|A,l>=u+1&&c<12&&(++c,u=u<<1|1)),m=x}else l=s+1,u=(1<<(c=a+1))-1,m=null}return h!==n&&Tn.log("Warning, gif stream shorter than expected."),r}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function O2(e){var t,r,n,a,o,s=Math.floor,l=new Array(64),c=new Array(64),u=new Array(64),d=new Array(64),f=new Array(65535),h=new Array(65535),p=new Array(64),g=new Array(64),m=[],x=0,b=7,_=new Array(64),w=new Array(64),A=new Array(64),O=new Array(256),T=new Array(2048),E=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],S=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],I=[0,1,2,3,4,5,6,7,8,9,10,11],z=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],k=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],M=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],R=[0,1,2,3,4,5,6,7,8,9,10,11],F=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],W=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function K(C,L){for(var H=0,U=0,te=new Array,le=1;le<=16;le++){for(var oe=1;oe<=C[le];oe++)te[L[U]]=[],te[L[U]][0]=H,te[L[U]][1]=le,U++,H++;H*=2}return te}function Z(C){for(var L=C[0],H=C[1]-1;H>=0;)L&1<<H&&(x|=1<<b),H--,--b<0&&(x==255?(D(255),D(0)):D(x),b=7,x=0)}function D(C){m.push(C)}function P(C){D(C>>8&255),D(255&C)}function $(C,L,H,U,te){for(var le,oe=te[0],ae=te[240],he=function(Re,Ke){var nt,st,gt,Ge,Je,We,_t,Nt,kt,Vt,jt=0;for(kt=0;kt<8;++kt){nt=Re[jt],st=Re[jt+1],gt=Re[jt+2],Ge=Re[jt+3],Je=Re[jt+4],We=Re[jt+5],_t=Re[jt+6];var Tr=nt+(Nt=Re[jt+7]),qe=nt-Nt,$e=st+_t,Xe=st-_t,Ue=gt+We,ht=gt-We,at=Ge+Je,wt=Ge-Je,Tt=Tr+at,Jt=Tr-at,Dr=$e+Ue,qr=$e-Ue;Re[jt]=Tt+Dr,Re[jt+4]=Tt-Dr;var ar=.707106781*(qr+Jt);Re[jt+2]=Jt+ar,Re[jt+6]=Jt-ar;var Er=.382683433*((Tt=wt+ht)-(qr=Xe+qe)),Ir=.5411961*Tt+Er,rn=1.306562965*qr+Er,Ta=.707106781*(Dr=ht+Xe),Dn=qe+Ta,rr=qe-Ta;Re[jt+5]=rr+Ir,Re[jt+3]=rr-Ir,Re[jt+1]=Dn+rn,Re[jt+7]=Dn-rn,jt+=8}for(jt=0,kt=0;kt<8;++kt){nt=Re[jt],st=Re[jt+8],gt=Re[jt+16],Ge=Re[jt+24],Je=Re[jt+32],We=Re[jt+40],_t=Re[jt+48];var Kr=nt+(Nt=Re[jt+56]),Yn=nt-Nt,Mn=st+_t,Qr=st-_t,nn=gt+We,Se=gt-We,Ve=Ge+Je,it=Ge-Je,Ct=Kr+Ve,Bt=Kr-Ve,Ht=Mn+nn,mr=Mn-nn;Re[jt]=Ct+Ht,Re[jt+32]=Ct-Ht;var an=.707106781*(mr+Bt);Re[jt+16]=Bt+an,Re[jt+48]=Bt-an;var Be=.382683433*((Ct=it+Se)-(mr=Qr+Yn)),tt=.5411961*Ct+Be,At=1.306562965*mr+Be,Gt=.707106781*(Ht=Se+Qr),or=Yn+Gt,un=Yn-Gt;Re[jt+40]=un+tt,Re[jt+24]=un-tt,Re[jt+8]=or+At,Re[jt+56]=or-At,jt++}for(kt=0;kt<64;++kt)Vt=Re[kt]*Ke[kt],p[kt]=Vt>0?Vt+.5|0:Vt-.5|0;return p}(C,L),me=0;me<64;++me)g[E[me]]=he[me];var X=g[0]-H;H=g[0],X==0?Z(U[0]):(Z(U[h[le=32767+X]]),Z(f[le]));for(var G=63;G>0&&g[G]==0;)G--;if(G==0)return Z(oe),H;for(var ee,se=1;se<=G;){for(var V=se;g[se]==0&&se<=G;)++se;var He=se-V;if(He>=16){ee=He>>4;for(var Ne=1;Ne<=ee;++Ne)Z(ae);He&=15}le=32767+g[se],Z(te[(He<<4)+h[le]]),Z(f[le]),se++}return G!=63&&Z(oe),H}function Q(C){C=Math.min(Math.max(C,1),100),o!=C&&(function(L){for(var H=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],U=0;U<64;U++){var te=s((H[U]*L+50)/100);te=Math.min(Math.max(te,1),255),l[E[U]]=te}for(var le=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],oe=0;oe<64;oe++){var ae=s((le[oe]*L+50)/100);ae=Math.min(Math.max(ae,1),255),c[E[oe]]=ae}for(var he=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],me=0,X=0;X<8;X++)for(var G=0;G<8;G++)u[me]=1/(l[E[me]]*he[X]*he[G]*8),d[me]=1/(c[E[me]]*he[X]*he[G]*8),me++}(C<50?Math.floor(5e3/C):Math.floor(200-2*C)),o=C)}this.encode=function(C,L){L&&Q(L),m=new Array,x=0,b=7,P(65496),P(65504),P(16),D(74),D(70),D(73),D(70),D(0),D(1),D(1),D(0),P(1),P(1),D(0),D(0),function(){P(65499),P(132),D(0);for(var st=0;st<64;st++)D(l[st]);D(1);for(var gt=0;gt<64;gt++)D(c[gt])}(),function(st,gt){P(65472),P(17),D(8),P(gt),P(st),D(3),D(1),D(17),D(0),D(2),D(17),D(1),D(3),D(17),D(1)}(C.width,C.height),function(){P(65476),P(418),D(0);for(var st=0;st<16;st++)D(S[st+1]);for(var gt=0;gt<=11;gt++)D(I[gt]);D(16);for(var Ge=0;Ge<16;Ge++)D(z[Ge+1]);for(var Je=0;Je<=161;Je++)D(k[Je]);D(1);for(var We=0;We<16;We++)D(M[We+1]);for(var _t=0;_t<=11;_t++)D(R[_t]);D(17);for(var Nt=0;Nt<16;Nt++)D(F[Nt+1]);for(var kt=0;kt<=161;kt++)D(W[kt])}(),P(65498),P(12),D(3),D(1),D(0),D(2),D(17),D(3),D(17),D(0),D(63),D(0);var H=0,U=0,te=0;x=0,b=7,this.encode.displayName="_encode_";for(var le,oe,ae,he,me,X,G,ee,se,V=C.data,He=C.width,Ne=C.height,Re=4*He,Ke=0;Ke<Ne;){for(le=0;le<Re;){for(me=Re*Ke+le,G=-1,ee=0,se=0;se<64;se++)X=me+(ee=se>>3)*Re+(G=4*(7&se)),Ke+ee>=Ne&&(X-=Re*(Ke+1+ee-Ne)),le+G>=Re&&(X-=le+G-Re+4),oe=V[X++],ae=V[X++],he=V[X++],_[se]=(T[oe]+T[ae+256>>0]+T[he+512>>0]>>16)-128,w[se]=(T[oe+768>>0]+T[ae+1024>>0]+T[he+1280>>0]>>16)-128,A[se]=(T[oe+1280>>0]+T[ae+1536>>0]+T[he+1792>>0]>>16)-128;H=$(_,u,H,t,n),U=$(w,d,U,r,a),te=$(A,d,te,r,a),le+=32}Ke+=8}if(b>=0){var nt=[];nt[1]=b+1,nt[0]=(1<<b+1)-1,Z(nt)}return P(65497),new Uint8Array(m)},e=e||50,function(){for(var C=String.fromCharCode,L=0;L<256;L++)O[L]=C(L)}(),t=K(S,I),r=K(M,R),n=K(z,k),a=K(F,W),function(){for(var C=1,L=2,H=1;H<=15;H++){for(var U=C;U<L;U++)h[32767+U]=H,f[32767+U]=[],f[32767+U][1]=H,f[32767+U][0]=U;for(var te=-(L-1);te<=-C;te++)h[32767+te]=H,f[32767+te]=[],f[32767+te][1]=H,f[32767+te][0]=L-1+te;C<<=1,L<<=1}}(),function(){for(var C=0;C<256;C++)T[C]=19595*C,T[C+256>>0]=38470*C,T[C+512>>0]=7471*C+32768,T[C+768>>0]=-11059*C,T[C+1024>>0]=-21709*C,T[C+1280>>0]=32768*C+8421375,T[C+1536>>0]=-27439*C,T[C+1792>>0]=-5329*C}(),Q(e)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function es(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function i4(e){function t(S){if(!S)throw Error("assert :P")}function r(S,I,z){for(var k=0;4>k;k++)if(S[I+k]!=z.charCodeAt(k))return!0;return!1}function n(S,I,z,k,M){for(var R=0;R<M;R++)S[I+R]=z[k+R]}function a(S,I,z,k){for(var M=0;M<k;M++)S[I+M]=z}function o(S){return new Int32Array(S)}function s(S,I){for(var z=[],k=0;k<S;k++)z.push(new I);return z}function l(S,I){var z=[];return function k(M,R,F){for(var W=F[R],K=0;K<W&&(M.push(F.length>R+1?[]:new I),!(F.length<R+1));K++)k(M[K],R+1,F)}(z,0,S),z}var c=function(){var S=this;function I(v,j){for(var q=1<<j-1>>>0;v&q;)q>>>=1;return q?(v&q-1)+q:v}function z(v,j,q,Y,re){t(!(Y%q));do v[j+(Y-=q)]=re;while(0<Y)}function k(v,j,q,Y,re){if(t(2328>=re),512>=re)var ce=o(512);else if((ce=o(re))==null)return 0;return function(ue,fe,xe,_e,Me,Ze){var et,ze,yt=fe,ut=1<<xe,Le=o(16),Fe=o(16);for(t(Me!=0),t(_e!=null),t(ue!=null),t(0<xe),ze=0;ze<Me;++ze){if(15<_e[ze])return 0;++Le[_e[ze]]}if(Le[0]==Me)return 0;for(Fe[1]=0,et=1;15>et;++et){if(Le[et]>1<<et)return 0;Fe[et+1]=Fe[et]+Le[et]}for(ze=0;ze<Me;++ze)et=_e[ze],0<_e[ze]&&(Ze[Fe[et]++]=ze);if(Fe[15]==1)return(_e=new M).g=0,_e.value=Ze[0],z(ue,yt,1,ut,_e),ut;var mt,St=-1,vt=ut-1,Qt=0,$t=1,xr=1,zt=1<<xe;for(ze=0,et=1,Me=2;et<=xe;++et,Me<<=1){if($t+=xr<<=1,0>(xr-=Le[et]))return 0;for(;0<Le[et];--Le[et])(_e=new M).g=et,_e.value=Ze[ze++],z(ue,yt+Qt,Me,zt,_e),Qt=I(Qt,et)}for(et=xe+1,Me=2;15>=et;++et,Me<<=1){if($t+=xr<<=1,0>(xr-=Le[et]))return 0;for(;0<Le[et];--Le[et]){if(_e=new M,(Qt&vt)!=St){for(yt+=zt,mt=1<<(St=et)-xe;15>St&&!(0>=(mt-=Le[St]));)++St,mt<<=1;ut+=zt=1<<(mt=St-xe),ue[fe+(St=Qt&vt)].g=mt+xe,ue[fe+St].value=yt-fe-St}_e.g=et-xe,_e.value=Ze[ze++],z(ue,yt+(Qt>>xe),Me,zt,_e),Qt=I(Qt,et)}}return $t!=2*Fe[15]-1?0:ut}(v,j,q,Y,re,ce)}function M(){this.value=this.g=0}function R(){this.value=this.g=0}function F(){this.G=s(5,M),this.H=o(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=s(fa,R)}function W(v,j,q,Y){t(v!=null),t(j!=null),t(2147483648>Y),v.Ca=254,v.I=0,v.b=-8,v.Ka=0,v.oa=j,v.pa=q,v.Jd=j,v.Yc=q+Y,v.Zc=4<=Y?q+Y-4+1:q,le(v)}function K(v,j){for(var q=0;0<j--;)q|=ae(v,128)<<j;return q}function Z(v,j){var q=K(v,j);return oe(v)?-q:q}function D(v,j,q,Y){var re,ce=0;for(t(v!=null),t(j!=null),t(4294967288>Y),v.Sb=Y,v.Ra=0,v.u=0,v.h=0,4<Y&&(Y=4),re=0;re<Y;++re)ce+=j[q+re]<<8*re;v.Ra=ce,v.bb=Y,v.oa=j,v.pa=q}function P(v){for(;8<=v.u&&v.bb<v.Sb;)v.Ra>>>=8,v.Ra+=v.oa[v.pa+v.bb]<<pe-8>>>0,++v.bb,v.u-=8;H(v)&&(v.h=1,v.u=0)}function $(v,j){if(t(0<=j),!v.h&&j<=de){var q=L(v)&El[j];return v.u+=j,P(v),q}return v.h=1,v.u=0}function Q(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function C(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function L(v){return v.Ra>>>(v.u&pe-1)>>>0}function H(v){return t(v.bb<=v.Sb),v.h||v.bb==v.Sb&&v.u>pe}function U(v,j){v.u=j,v.h=H(v)}function te(v){v.u>=ke&&(t(v.u>=ke),P(v))}function le(v){t(v!=null&&v.oa!=null),v.pa<v.Zc?(v.I=(v.oa[v.pa++]|v.I<<8)>>>0,v.b+=8):(t(v!=null&&v.oa!=null),v.pa<v.Yc?(v.b+=8,v.I=v.oa[v.pa++]|v.I<<8):v.Ka?v.b=0:(v.I<<=8,v.b+=8,v.Ka=1))}function oe(v){return K(v,1)}function ae(v,j){var q=v.Ca;0>v.b&&le(v);var Y=v.b,re=q*j>>>8,ce=(v.I>>>Y>re)+0;for(ce?(q-=re,v.I-=re+1<<Y>>>0):q=re+1,Y=q,re=0;256<=Y;)re+=8,Y>>=8;return Y=7^re+Oe[Y],v.b-=Y,v.Ca=(q<<Y)-1,ce}function he(v,j,q){v[j+0]=q>>24&255,v[j+1]=q>>16&255,v[j+2]=q>>8&255,v[j+3]=q>>0&255}function me(v,j){return v[j+0]<<0|v[j+1]<<8}function X(v,j){return me(v,j)|v[j+2]<<16}function G(v,j){return me(v,j)|me(v,j+2)<<16}function ee(v,j){var q=1<<j;return t(v!=null),t(0<j),v.X=o(q),v.X==null?0:(v.Mb=32-j,v.Xa=j,1)}function se(v,j){t(v!=null),t(j!=null),t(v.Xa==j.Xa),n(j.X,0,v.X,0,1<<j.Xa)}function V(){this.X=[],this.Xa=this.Mb=0}function He(v,j,q,Y){t(q!=null),t(Y!=null);var re=q[0],ce=Y[0];return re==0&&(re=(v*ce+j/2)/j),ce==0&&(ce=(j*re+v/2)/v),0>=re||0>=ce?0:(q[0]=re,Y[0]=ce,1)}function Ne(v,j){return v+(1<<j)-1>>>j}function Re(v,j){return((4278255360&v)+(4278255360&j)>>>0&4278255360)+((16711935&v)+(16711935&j)>>>0&16711935)>>>0}function Ke(v,j){S[j]=function(q,Y,re,ce,ue,fe,xe){var _e;for(_e=0;_e<ue;++_e){var Me=S[v](fe[xe+_e-1],re,ce+_e);fe[xe+_e]=Re(q[Y+_e],Me)}}}function nt(){this.ud=this.hd=this.jd=0}function st(v,j){return((4278124286&(v^j))>>>1)+(v&j)>>>0}function gt(v){return 0<=v&&256>v?v:0>v?0:255<v?255:void 0}function Ge(v,j){return gt(v+(v-j+.5>>1))}function Je(v,j,q){return Math.abs(j-q)-Math.abs(v-q)}function We(v,j,q,Y,re,ce,ue){for(Y=ce[ue-1],q=0;q<re;++q)ce[ue+q]=Y=Re(v[j+q],Y)}function _t(v,j,q,Y,re){var ce;for(ce=0;ce<q;++ce){var ue=v[j+ce],fe=ue>>8&255,xe=16711935&(xe=(xe=16711935&ue)+((fe<<16)+fe));Y[re+ce]=(4278255360&ue)+xe>>>0}}function Nt(v,j){j.jd=v>>0&255,j.hd=v>>8&255,j.ud=v>>16&255}function kt(v,j,q,Y,re,ce){var ue;for(ue=0;ue<Y;++ue){var fe=j[q+ue],xe=fe>>>8,_e=fe,Me=255&(Me=(Me=fe>>>16)+((v.jd<<24>>24)*(xe<<24>>24)>>>5));_e=255&(_e=(_e=_e+((v.hd<<24>>24)*(xe<<24>>24)>>>5))+((v.ud<<24>>24)*(Me<<24>>24)>>>5)),re[ce+ue]=(4278255360&fe)+(Me<<16)+_e}}function Vt(v,j,q,Y,re){S[j]=function(ce,ue,fe,xe,_e,Me,Ze,et,ze){for(xe=Ze;xe<et;++xe)for(Ze=0;Ze<ze;++Ze)_e[Me++]=re(fe[Y(ce[ue++])])},S[v]=function(ce,ue,fe,xe,_e,Me,Ze){var et=8>>ce.b,ze=ce.Ea,yt=ce.K[0],ut=ce.w;if(8>et)for(ce=(1<<ce.b)-1,ut=(1<<et)-1;ue<fe;++ue){var Le,Fe=0;for(Le=0;Le<ze;++Le)Le&ce||(Fe=Y(xe[_e++])),Me[Ze++]=re(yt[Fe&ut]),Fe>>=et}else S["VP8LMapColor"+q](xe,_e,yt,ut,Me,Ze,ue,fe,ze)}}function jt(v,j,q,Y,re){for(q=j+q;j<q;){var ce=v[j++];Y[re++]=ce>>16&255,Y[re++]=ce>>8&255,Y[re++]=ce>>0&255}}function Tr(v,j,q,Y,re){for(q=j+q;j<q;){var ce=v[j++];Y[re++]=ce>>16&255,Y[re++]=ce>>8&255,Y[re++]=ce>>0&255,Y[re++]=ce>>24&255}}function qe(v,j,q,Y,re){for(q=j+q;j<q;){var ce=(ue=v[j++])>>16&240|ue>>12&15,ue=ue>>0&240|ue>>28&15;Y[re++]=ce,Y[re++]=ue}}function $e(v,j,q,Y,re){for(q=j+q;j<q;){var ce=(ue=v[j++])>>16&248|ue>>13&7,ue=ue>>5&224|ue>>3&31;Y[re++]=ce,Y[re++]=ue}}function Xe(v,j,q,Y,re){for(q=j+q;j<q;){var ce=v[j++];Y[re++]=ce>>0&255,Y[re++]=ce>>8&255,Y[re++]=ce>>16&255}}function Ue(v,j,q,Y,re,ce){if(ce==0)for(q=j+q;j<q;)he(Y,((ce=v[j++])[0]>>24|ce[1]>>8&65280|ce[2]<<8&16711680|ce[3]<<24)>>>0),re+=32;else n(Y,re,v,j,q)}function ht(v,j){S[j][0]=S[v+"0"],S[j][1]=S[v+"1"],S[j][2]=S[v+"2"],S[j][3]=S[v+"3"],S[j][4]=S[v+"4"],S[j][5]=S[v+"5"],S[j][6]=S[v+"6"],S[j][7]=S[v+"7"],S[j][8]=S[v+"8"],S[j][9]=S[v+"9"],S[j][10]=S[v+"10"],S[j][11]=S[v+"11"],S[j][12]=S[v+"12"],S[j][13]=S[v+"13"],S[j][14]=S[v+"0"],S[j][15]=S[v+"0"]}function at(v){return v==Uy||v==zy||v==em||v==Wy}function wt(){this.eb=[],this.size=this.A=this.fb=0}function Tt(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Jt(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new wt,this.f.kb=new Tt,this.sd=null}function Dr(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function qr(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function ar(v){return alert("todo:WebPSamplerProcessPlane"),v.T}function Er(v,j){var q=v.T,Y=j.ba.f.RGBA,re=Y.eb,ce=Y.fb+v.ka*Y.A,ue=qo[j.ba.S],fe=v.y,xe=v.O,_e=v.f,Me=v.N,Ze=v.ea,et=v.W,ze=j.cc,yt=j.dc,ut=j.Mc,Le=j.Nc,Fe=v.ka,mt=v.ka+v.T,St=v.U,vt=St+1>>1;for(Fe==0?ue(fe,xe,null,null,_e,Me,Ze,et,_e,Me,Ze,et,re,ce,null,null,St):(ue(j.ec,j.fc,fe,xe,ze,yt,ut,Le,_e,Me,Ze,et,re,ce-Y.A,re,ce,St),++q);Fe+2<mt;Fe+=2)ze=_e,yt=Me,ut=Ze,Le=et,Me+=v.Rc,et+=v.Rc,ce+=2*Y.A,ue(fe,(xe+=2*v.fa)-v.fa,fe,xe,ze,yt,ut,Le,_e,Me,Ze,et,re,ce-Y.A,re,ce,St);return xe+=v.fa,v.j+mt<v.o?(n(j.ec,j.fc,fe,xe,St),n(j.cc,j.dc,_e,Me,vt),n(j.Mc,j.Nc,Ze,et,vt),q--):1&mt||ue(fe,xe,null,null,_e,Me,Ze,et,_e,Me,Ze,et,re,ce+Y.A,null,null,St),q}function Ir(v,j,q){var Y=v.F,re=[v.J];if(Y!=null){var ce=v.U,ue=j.ba.S,fe=ue==Zp||ue==em;j=j.ba.f.RGBA;var xe=[0],_e=v.ka;xe[0]=v.T,v.Kb&&(_e==0?--xe[0]:(--_e,re[0]-=v.width),v.j+v.ka+v.T==v.o&&(xe[0]=v.o-v.j-_e));var Me=j.eb;_e=j.fb+_e*j.A,v=qn(Y,re[0],v.width,ce,xe,Me,_e+(fe?0:3),j.A),t(q==xe),v&&at(ue)&&Lo(Me,_e,fe,ce,xe,j.A)}return 0}function rn(v){var j=v.ma,q=j.ba.S,Y=11>q,re=q==Xp||q==Jp||q==Zp||q==By||q==12||at(q);if(j.memory=null,j.Ib=null,j.Jb=null,j.Nd=null,!gc(j.Oa,v,re?11:12))return 0;if(re&&at(q)&&Pt(),v.da)alert("todo:use_scaling");else{if(Y){if(j.Ib=ar,v.Kb){if(q=v.U+1>>1,j.memory=o(v.U+2*q),j.memory==null)return 0;j.ec=j.memory,j.fc=0,j.cc=j.ec,j.dc=j.fc+v.U,j.Mc=j.cc,j.Nc=j.dc+q,j.Ib=Er,Pt()}}else alert("todo:EmitYUV");re&&(j.Jb=Ir,Y&&Ye())}if(Y&&!RS){for(v=0;256>v;++v)WR[v]=89858*(v-128)+rm>>tm,GR[v]=-22014*(v-128)+rm,VR[v]=-45773*(v-128),HR[v]=113618*(v-128)+rm>>tm;for(v=Qd;v<Gy;++v)j=76283*(v-16)+rm>>tm,YR[v-Qd]=Ti(j,255),KR[v-Qd]=Ti(j+8>>4,15);RS=1}return 1}function Ta(v){var j=v.ma,q=v.U,Y=v.T;return t(!(1&v.ka)),0>=q||0>=Y?0:(q=j.Ib(v,j),j.Jb!=null&&j.Jb(v,j,q),j.Dc+=q,1)}function Dn(v){v.ma.memory=null}function rr(v,j,q,Y){return $(v,8)!=47?0:(j[0]=$(v,14)+1,q[0]=$(v,14)+1,Y[0]=$(v,1),$(v,3)!=0?0:!v.h)}function Kr(v,j){if(4>v)return v+1;var q=v-2>>1;return(2+(1&v)<<q)+$(j,q)+1}function Yn(v,j){return 120<j?j-120:1<=(q=((q=TR[j-1])>>4)*v+(8-(15&q)))?q:1;var q}function Mn(v,j,q){var Y=L(q),re=v[j+=255&Y].g-8;return 0<re&&(U(q,q.u+8),Y=L(q),j+=v[j].value,j+=Y&(1<<re)-1),U(q,q.u+v[j].g),v[j].value}function Qr(v,j,q){return q.g+=v.g,q.value+=v.value<<j>>>0,t(8>=q.g),v.g}function nn(v,j,q){var Y=v.xc;return t((j=Y==0?0:v.vc[v.md*(q>>Y)+(j>>Y)])<v.Wb),v.Ya[j]}function Se(v,j,q,Y){var re=v.ab,ce=v.c*j,ue=v.C;j=ue+j;var fe=q,xe=Y;for(Y=v.Ta,q=v.Ua;0<re--;){var _e=v.gc[re],Me=ue,Ze=j,et=fe,ze=xe,yt=(xe=Y,fe=q,_e.Ea);switch(t(Me<Ze),t(Ze<=_e.nc),_e.hc){case 2:Ut(et,ze,(Ze-Me)*yt,xe,fe);break;case 0:var ut=Me,Le=Ze,Fe=xe,mt=fe,St=(zt=_e).Ea;ut==0&&(rt(et,ze,null,null,1,Fe,mt),We(et,ze+1,0,0,St-1,Fe,mt+1),ze+=St,mt+=St,++ut);for(var vt=1<<zt.b,Qt=vt-1,$t=Ne(St,zt.b),xr=zt.K,zt=zt.w+(ut>>zt.b)*$t;ut<Le;){var vn=xr,Sn=zt,on=1;for(bt(et,ze,Fe,mt-St,1,Fe,mt);on<St;){var Jr=(on&~Qt)+vt;Jr>St&&(Jr=St),(0,Vi[vn[Sn++]>>8&15])(et,ze+ +on,Fe,mt+on-St,Jr-on,Fe,mt+on),on=Jr}ze+=St,mt+=St,++ut&Qt||(zt+=$t)}Ze!=_e.nc&&n(xe,fe-yt,xe,fe+(Ze-Me-1)*yt,yt);break;case 1:for(yt=et,Le=ze,St=(et=_e.Ea)-(mt=et&~(Fe=(ze=1<<_e.b)-1)),ut=Ne(et,_e.b),vt=_e.K,_e=_e.w+(Me>>_e.b)*ut;Me<Ze;){for(Qt=vt,$t=_e,xr=new nt,zt=Le+mt,vn=Le+et;Le<zt;)Nt(Qt[$t++],xr),Ws(xr,yt,Le,ze,xe,fe),Le+=ze,fe+=ze;Le<vn&&(Nt(Qt[$t++],xr),Ws(xr,yt,Le,St,xe,fe),Le+=St,fe+=St),++Me&Fe||(_e+=ut)}break;case 3:if(et==xe&&ze==fe&&0<_e.b){for(Le=xe,et=yt=fe+(Ze-Me)*yt-(mt=(Ze-Me)*Ne(_e.Ea,_e.b)),ze=xe,Fe=fe,ut=[],mt=(St=mt)-1;0<=mt;--mt)ut[mt]=ze[Fe+mt];for(mt=St-1;0<=mt;--mt)Le[et+mt]=ut[mt];Dt(_e,Me,Ze,xe,yt,xe,fe)}else Dt(_e,Me,Ze,et,ze,xe,fe)}fe=Y,xe=q}xe!=q&&n(Y,q,fe,xe,ce)}function Ve(v,j){var q=v.V,Y=v.Ba+v.c*v.C,re=j-v.C;if(t(j<=v.l.o),t(16>=re),0<re){var ce=v.l,ue=v.Ta,fe=v.Ua,xe=ce.width;if(Se(v,re,q,Y),re=fe=[fe],t((q=v.C)<(Y=j)),t(ce.v<ce.va),Y>ce.o&&(Y=ce.o),q<ce.j){var _e=ce.j-q;q=ce.j,re[0]+=_e*xe}if(q>=Y?q=0:(re[0]+=4*ce.v,ce.ka=q-ce.j,ce.U=ce.va-ce.v,ce.T=Y-q,q=1),q){if(fe=fe[0],11>(q=v.ca).S){var Me=q.f.RGBA,Ze=(Y=q.S,re=ce.U,ce=ce.T,_e=Me.eb,Me.A),et=ce;for(Me=Me.fb+v.Ma*Me.A;0<et--;){var ze=ue,yt=fe,ut=re,Le=_e,Fe=Me;switch(Y){case Qp:Gi(ze,yt,ut,Le,Fe);break;case Xp:Ei(ze,yt,ut,Le,Fe);break;case Uy:Ei(ze,yt,ut,Le,Fe),Lo(Le,Fe,0,ut,1,0);break;case OS:Vs(ze,yt,ut,Le,Fe);break;case Jp:Ue(ze,yt,ut,Le,Fe,1);break;case zy:Ue(ze,yt,ut,Le,Fe,1),Lo(Le,Fe,0,ut,1,0);break;case Zp:Ue(ze,yt,ut,Le,Fe,0);break;case em:Ue(ze,yt,ut,Le,Fe,0),Lo(Le,Fe,1,ut,1,0);break;case By:Il(ze,yt,ut,Le,Fe);break;case Wy:Il(ze,yt,ut,Le,Fe),Rn(Le,Fe,ut,1,0);break;case kS:Hs(ze,yt,ut,Le,Fe);break;default:t(0)}fe+=xe,Me+=Ze}v.Ma+=ce}else alert("todo:EmitRescaledRowsYUVA");t(v.Ma<=q.height)}}v.C=j,t(v.C<=v.i)}function it(v){var j;if(0<v.ua)return 0;for(j=0;j<v.Wb;++j){var q=v.Ya[j].G,Y=v.Ya[j].H;if(0<q[1][Y[1]+0].g||0<q[2][Y[2]+0].g||0<q[3][Y[3]+0].g)return 0}return 1}function Ct(v,j,q,Y,re,ce){if(v.Z!=0){var ue=v.qd,fe=v.rd;for(t(Ll[v.Z]!=null);j<q;++j)Ll[v.Z](ue,fe,Y,re,Y,re,ce),ue=Y,fe=re,re+=ce;v.qd=ue,v.rd=fe}}function Bt(v,j){var q=v.l.ma,Y=q.Z==0||q.Z==1?v.l.j:v.C;if(Y=v.C<Y?Y:v.C,t(j<=v.l.o),j>Y){var re=v.l.width,ce=q.ca,ue=q.tb+re*Y,fe=v.V,xe=v.Ba+v.c*Y,_e=v.gc;t(v.ab==1),t(_e[0].hc==3),Xn(_e[0],Y,j,fe,xe,ce,ue),Ct(q,Y,j,ce,ue,re)}v.C=v.Ma=j}function Ht(v,j,q,Y,re,ce,ue){var fe=v.$/Y,xe=v.$%Y,_e=v.m,Me=v.s,Ze=q+v.$,et=Ze;re=q+Y*re;var ze=q+Y*ce,yt=280+Me.ua,ut=v.Pb?fe:16777216,Le=0<Me.ua?Me.Wa:null,Fe=Me.wc,mt=Ze<ze?nn(Me,xe,fe):null;t(v.C<ce),t(ze<=re);var St=!1;e:for(;;){for(;St||Ze<ze;){var vt=0;if(fe>=ut){var Qt=Ze-q;t((ut=v).Pb),ut.wd=ut.m,ut.xd=Qt,0<ut.s.ua&&se(ut.s.Wa,ut.s.vb),ut=fe+IR}if(xe&Fe||(mt=nn(Me,xe,fe)),t(mt!=null),mt.Qb&&(j[Ze]=mt.qb,St=!0),!St)if(te(_e),mt.jc){vt=_e,Qt=j;var $t=Ze,xr=mt.pd[L(vt)&fa-1];t(mt.jc),256>xr.g?(U(vt,vt.u+xr.g),Qt[$t]=xr.value,vt=0):(U(vt,vt.u+xr.g-256),t(256<=xr.value),vt=xr.value),vt==0&&(St=!0)}else vt=Mn(mt.G[0],mt.H[0],_e);if(_e.h)break;if(St||256>vt){if(!St)if(mt.nd)j[Ze]=(mt.qb|vt<<8)>>>0;else{if(te(_e),St=Mn(mt.G[1],mt.H[1],_e),te(_e),Qt=Mn(mt.G[2],mt.H[2],_e),$t=Mn(mt.G[3],mt.H[3],_e),_e.h)break;j[Ze]=($t<<24|St<<16|vt<<8|Qt)>>>0}if(St=!1,++Ze,++xe>=Y&&(xe=0,++fe,ue!=null&&fe<=ce&&!(fe%16)&&ue(v,fe),Le!=null))for(;et<Ze;)vt=j[et++],Le.X[(506832829*vt&4294967295)>>>Le.Mb]=vt}else if(280>vt){if(vt=Kr(vt-256,_e),Qt=Mn(mt.G[4],mt.H[4],_e),te(_e),Qt=Yn(Y,Qt=Kr(Qt,_e)),_e.h)break;if(Ze-q<Qt||re-Ze<vt)break e;for($t=0;$t<vt;++$t)j[Ze+$t]=j[Ze+$t-Qt];for(Ze+=vt,xe+=vt;xe>=Y;)xe-=Y,++fe,ue!=null&&fe<=ce&&!(fe%16)&&ue(v,fe);if(t(Ze<=re),xe&Fe&&(mt=nn(Me,xe,fe)),Le!=null)for(;et<Ze;)vt=j[et++],Le.X[(506832829*vt&4294967295)>>>Le.Mb]=vt}else{if(!(vt<yt))break e;for(St=vt-280,t(Le!=null);et<Ze;)vt=j[et++],Le.X[(506832829*vt&4294967295)>>>Le.Mb]=vt;vt=Ze,t(!(St>>>(Qt=Le).Xa)),j[vt]=Qt.X[St],St=!0}St||t(_e.h==H(_e))}if(v.Pb&&_e.h&&Ze<re)t(v.m.h),v.a=5,v.m=v.wd,v.$=v.xd,0<v.s.ua&&se(v.s.vb,v.s.Wa);else{if(_e.h)break e;ue?.(v,fe>ce?ce:fe),v.a=0,v.$=Ze-q}return 1}return v.a=3,0}function mr(v){t(v!=null),v.vc=null,v.yc=null,v.Ya=null;var j=v.Wa;j!=null&&(j.X=null),v.vb=null,t(v!=null)}function an(){var v=new ki;return v==null?null:(v.a=0,v.xb=IS,ht("Predictor","VP8LPredictors"),ht("Predictor","VP8LPredictors_C"),ht("PredictorAdd","VP8LPredictorsAdd"),ht("PredictorAdd","VP8LPredictorsAdd_C"),Ut=_t,Ws=kt,Gi=jt,Ei=Tr,Il=qe,Hs=$e,Vs=Xe,S.VP8LMapColor32b=fr,S.VP8LMapColor8b=xa,v)}function Be(v,j,q,Y,re){var ce=1,ue=[v],fe=[j],xe=Y.m,_e=Y.s,Me=null,Ze=0;e:for(;;){if(q)for(;ce&&$(xe,1);){var et=ue,ze=fe,yt=Y,ut=1,Le=yt.m,Fe=yt.gc[yt.ab],mt=$(Le,2);if(yt.Oc&1<<mt)ce=0;else{switch(yt.Oc|=1<<mt,Fe.hc=mt,Fe.Ea=et[0],Fe.nc=ze[0],Fe.K=[null],++yt.ab,t(4>=yt.ab),mt){case 0:case 1:Fe.b=$(Le,3)+2,ut=Be(Ne(Fe.Ea,Fe.b),Ne(Fe.nc,Fe.b),0,yt,Fe.K),Fe.K=Fe.K[0];break;case 3:var St,vt=$(Le,8)+1,Qt=16<vt?0:4<vt?1:2<vt?2:3;if(et[0]=Ne(Fe.Ea,Qt),Fe.b=Qt,St=ut=Be(vt,1,0,yt,Fe.K)){var $t,xr=vt,zt=Fe,vn=1<<(8>>zt.b),Sn=o(vn);if(Sn==null)St=0;else{var on=zt.K[0],Jr=zt.w;for(Sn[0]=zt.K[0][0],$t=1;$t<1*xr;++$t)Sn[$t]=Re(on[Jr+$t],Sn[$t-1]);for(;$t<4*vn;++$t)Sn[$t]=0;zt.K[0]=null,zt.K[0]=Sn,St=1}}ut=St;break;case 2:break;default:t(0)}ce=ut}}if(ue=ue[0],fe=fe[0],ce&&$(xe,1)&&!(ce=1<=(Ze=$(xe,4))&&11>=Ze)){Y.a=3;break e}var kn;if(kn=ce)t:{var An,zr,La,Yi=Y,Ra=ue,Ki=fe,Cn=Ze,po=q,mo=Yi.m,Xa=Yi.s,ci=[null],Ni=1,Fo=0,ms=ER[Cn];r:for(;;){if(po&&$(mo,1)){var Ja=$(mo,3)+2,Qs=Ne(Ra,Ja),_c=Ne(Ki,Ja),mu=Qs*_c;if(!Be(Qs,_c,0,Yi,ci))break r;for(ci=ci[0],Xa.xc=Ja,An=0;An<mu;++An){var Rl=ci[An]>>8&65535;ci[An]=Rl,Rl>=Ni&&(Ni=Rl+1)}}if(mo.h)break r;for(zr=0;5>zr;++zr){var ha=TS[zr];!zr&&0<Cn&&(ha+=1<<Cn),Fo<ha&&(Fo=ha)}var Yy=s(Ni*ms,M),$S=Ni,BS=s($S,F);if(BS==null)var am=null;else t(65536>=$S),am=BS;var Xd=o(Fo);if(am==null||Xd==null||Yy==null){Yi.a=1;break r}var im=Yy;for(An=La=0;An<Ni;++An){var Xo=am[An],gu=Xo.G,vu=Xo.H,US=0,om=1,zS=0;for(zr=0;5>zr;++zr){ha=TS[zr],gu[zr]=im,vu[zr]=La,!zr&&0<Cn&&(ha+=1<<Cn);a:{var sm,Ky=ha,lm=Yi,Jd=Xd,JR=im,ZR=La,Qy=0,ql=lm.m,e8=$(ql,1);if(a(Jd,0,0,Ky),e8){var t8=$(ql,1)+1,r8=$(ql,1),WS=$(ql,r8==0?1:8);Jd[WS]=1,t8==2&&(Jd[WS=$(ql,8)]=1);var cm=1}else{var HS=o(19),VS=$(ql,4)+4;if(19<VS){lm.a=3;var um=0;break a}for(sm=0;sm<VS;++sm)HS[kR[sm]]=$(ql,3);var Xy=void 0,Zd=void 0,GS=lm,n8=HS,dm=Ky,YS=Jd,Jy=0,Fl=GS.m,KS=8,QS=s(128,M);n:for(;k(QS,0,7,n8,19);){if($(Fl,1)){var a8=2+2*$(Fl,3);if((Xy=2+$(Fl,a8))>dm)break n}else Xy=dm;for(Zd=0;Zd<dm&&Xy--;){te(Fl);var XS=QS[0+(127&L(Fl))];U(Fl,Fl.u+XS.g);var yu=XS.value;if(16>yu)YS[Zd++]=yu,yu!=0&&(KS=yu);else{var i8=yu==16,JS=yu-16,o8=PR[JS],ZS=$(Fl,AR[JS])+o8;if(Zd+ZS>dm)break n;for(var s8=i8?KS:0;0<ZS--;)YS[Zd++]=s8}}Jy=1;break n}Jy||(GS.a=3),cm=Jy}(cm=cm&&!ql.h)&&(Qy=k(JR,ZR,8,Jd,Ky)),cm&&Qy!=0?um=Qy:(lm.a=3,um=0)}if(um==0)break r;if(om&&OR[zr]==1&&(om=im[La].g==0),US+=im[La].g,La+=um,3>=zr){var ef,Zy=Xd[0];for(ef=1;ef<ha;++ef)Xd[ef]>Zy&&(Zy=Xd[ef]);zS+=Zy}}if(Xo.nd=om,Xo.Qb=0,om&&(Xo.qb=(gu[3][vu[3]+0].value<<24|gu[1][vu[1]+0].value<<16|gu[2][vu[2]+0].value)>>>0,US==0&&256>gu[0][vu[0]+0].value&&(Xo.Qb=1,Xo.qb+=gu[0][vu[0]+0].value<<8)),Xo.jc=!Xo.Qb&&6>zS,Xo.jc){var fm,Xs=Xo;for(fm=0;fm<fa;++fm){var $l=fm,Bl=Xs.pd[$l],hm=Xs.G[0][Xs.H[0]+$l];256<=hm.value?(Bl.g=hm.g+256,Bl.value=hm.value):(Bl.g=0,Bl.value=0,$l>>=Qr(hm,8,Bl),$l>>=Qr(Xs.G[1][Xs.H[1]+$l],16,Bl),$l>>=Qr(Xs.G[2][Xs.H[2]+$l],0,Bl),Qr(Xs.G[3][Xs.H[3]+$l],24,Bl))}}}Xa.vc=ci,Xa.Wb=Ni,Xa.Ya=am,Xa.yc=Yy,kn=1;break t}kn=0}if(!(ce=kn)){Y.a=3;break e}if(0<Ze){if(_e.ua=1<<Ze,!ee(_e.Wa,Ze)){Y.a=1,ce=0;break e}}else _e.ua=0;var ex=Y,e5=ue,l8=fe,tx=ex.s,rx=tx.xc;if(ex.c=e5,ex.i=l8,tx.md=Ne(e5,rx),tx.wc=rx==0?-1:(1<<rx)-1,q){Y.xb=FR;break e}if((Me=o(ue*fe))==null){Y.a=1,ce=0;break e}ce=(ce=Ht(Y,Me,0,ue,fe,fe,null))&&!xe.h;break e}return ce?(re!=null?re[0]=Me:(t(Me==null),t(q)),Y.$=0,q||mr(_e)):mr(_e),ce}function tt(v,j){var q=v.c*v.i,Y=q+j+16*j;return t(v.c<=j),v.V=o(Y),v.V==null?(v.Ta=null,v.Ua=0,v.a=1,0):(v.Ta=v.V,v.Ua=v.Ba+q+j,1)}function At(v,j){var q=v.C,Y=j-q,re=v.V,ce=v.Ba+v.c*q;for(t(j<=v.l.o);0<Y;){var ue=16<Y?16:Y,fe=v.l.ma,xe=v.l.width,_e=xe*ue,Me=fe.ca,Ze=fe.tb+xe*q,et=v.Ta,ze=v.Ua;Se(v,ue,re,ce),_a(et,ze,Me,Ze,_e),Ct(fe,q,q+ue,Me,Ze,xe),Y-=ue,re+=ue*v.c,q+=ue}t(q==j),v.C=v.Ma=j}function Gt(){this.ub=this.yd=this.td=this.Rb=0}function or(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function un(){this.Fb=this.Bb=this.Cb=0,this.Zb=o(4),this.Lb=o(4)}function Ea(){this.Yb=function(){var v=[];return function j(q,Y,re){for(var ce=re[Y],ue=0;ue<ce&&(q.push(re.length>Y+1?[]:0),!(re.length<Y+1));ue++)j(q[ue],Y+1,re)}(v,0,[3,11]),v}()}function ro(){this.jb=o(3),this.Wc=l([4,8],Ea),this.Xc=l([4,17],Ea)}function Un(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new o(4),this.od=new o(4)}function Kn(){this.ld=this.La=this.dd=this.tc=0}function Fi(){this.Na=this.la=0}function ji(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Qe(){this.ad=o(384),this.Za=0,this.Ob=o(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Yt(){this.uc=this.M=this.Nb=0,this.wa=Array(new Kn),this.Y=0,this.ya=Array(new Qe),this.aa=0,this.l=new Ar}function sr(){this.y=o(16),this.f=o(8),this.ea=o(8)}function Mr(){this.cb=this.a=0,this.sc="",this.m=new Q,this.Od=new Gt,this.Kc=new or,this.ed=new Un,this.Qa=new un,this.Ic=this.$c=this.Aa=0,this.D=new Yt,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=s(8,Q),this.ia=0,this.pb=s(4,ji),this.Pa=new ro,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new sr),this.Hd=0,this.rb=Array(new Fi),this.sb=0,this.wa=Array(new Kn),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Qe),this.L=this.aa=0,this.gd=l([4,2],Kn),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Ar(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function dn(){var v=new Mr;return v!=null&&(v.a=0,v.sc="OK",v.cb=0,v.Xb=0,Kd||(Kd=Ia)),v}function Fr(v,j,q){return v.a==0&&(v.a=j,v.sc=q,v.cb=0),0}function ta(v,j,q){return 3<=q&&v[j+0]==157&&v[j+1]==1&&v[j+2]==42}function jn(v,j){if(v==null)return 0;if(v.a=0,v.sc="OK",j==null)return Fr(v,2,"null VP8Io passed to VP8GetHeaders()");var q=j.data,Y=j.w,re=j.ha;if(4>re)return Fr(v,7,"Truncated header.");var ce=q[Y+0]|q[Y+1]<<8|q[Y+2]<<16,ue=v.Od;if(ue.Rb=!(1&ce),ue.td=ce>>1&7,ue.yd=ce>>4&1,ue.ub=ce>>5,3<ue.td)return Fr(v,3,"Incorrect keyframe parameters.");if(!ue.yd)return Fr(v,4,"Frame not displayable.");Y+=3,re-=3;var fe=v.Kc;if(ue.Rb){if(7>re)return Fr(v,7,"cannot parse picture header");if(!ta(q,Y,re))return Fr(v,3,"Bad code word");fe.c=16383&(q[Y+4]<<8|q[Y+3]),fe.Td=q[Y+4]>>6,fe.i=16383&(q[Y+6]<<8|q[Y+5]),fe.Ud=q[Y+6]>>6,Y+=7,re-=7,v.za=fe.c+15>>4,v.Ub=fe.i+15>>4,j.width=fe.c,j.height=fe.i,j.Da=0,j.j=0,j.v=0,j.va=j.width,j.o=j.height,j.da=0,j.ib=j.width,j.hb=j.height,j.U=j.width,j.T=j.height,a((ce=v.Pa).jb,0,255,ce.jb.length),t((ce=v.Qa)!=null),ce.Cb=0,ce.Bb=0,ce.Fb=1,a(ce.Zb,0,0,ce.Zb.length),a(ce.Lb,0,0,ce.Lb)}if(ue.ub>re)return Fr(v,7,"bad partition length");W(ce=v.m,q,Y,ue.ub),Y+=ue.ub,re-=ue.ub,ue.Rb&&(fe.Ld=oe(ce),fe.Kd=oe(ce)),fe=v.Qa;var xe,_e=v.Pa;if(t(ce!=null),t(fe!=null),fe.Cb=oe(ce),fe.Cb){if(fe.Bb=oe(ce),oe(ce)){for(fe.Fb=oe(ce),xe=0;4>xe;++xe)fe.Zb[xe]=oe(ce)?Z(ce,7):0;for(xe=0;4>xe;++xe)fe.Lb[xe]=oe(ce)?Z(ce,6):0}if(fe.Bb)for(xe=0;3>xe;++xe)_e.jb[xe]=oe(ce)?K(ce,8):255}else fe.Bb=0;if(ce.Ka)return Fr(v,3,"cannot parse segment header");if((fe=v.ed).zd=oe(ce),fe.Tb=K(ce,6),fe.wb=K(ce,3),fe.Pc=oe(ce),fe.Pc&&oe(ce)){for(_e=0;4>_e;++_e)oe(ce)&&(fe.vd[_e]=Z(ce,6));for(_e=0;4>_e;++_e)oe(ce)&&(fe.od[_e]=Z(ce,6))}if(v.L=fe.Tb==0?0:fe.zd?1:2,ce.Ka)return Fr(v,3,"cannot parse filter header");var Me=re;if(re=xe=Y,Y=xe+Me,fe=Me,v.Xb=(1<<K(v.m,2))-1,Me<3*(_e=v.Xb))q=7;else{for(xe+=3*_e,fe-=3*_e,Me=0;Me<_e;++Me){var Ze=q[re+0]|q[re+1]<<8|q[re+2]<<16;Ze>fe&&(Ze=fe),W(v.Jc[+Me],q,xe,Ze),xe+=Ze,fe-=Ze,re+=3}W(v.Jc[+_e],q,xe,fe),q=xe<Y?0:5}if(q!=0)return Fr(v,q,"cannot parse partitions");for(q=K(xe=v.m,7),re=oe(xe)?Z(xe,4):0,Y=oe(xe)?Z(xe,4):0,fe=oe(xe)?Z(xe,4):0,_e=oe(xe)?Z(xe,4):0,xe=oe(xe)?Z(xe,4):0,Me=v.Qa,Ze=0;4>Ze;++Ze){if(Me.Cb){var et=Me.Zb[Ze];Me.Fb||(et+=q)}else{if(0<Ze){v.pb[Ze]=v.pb[0];continue}et=q}var ze=v.pb[Ze];ze.Sc[0]=Hy[Ti(et+re,127)],ze.Sc[1]=Vy[Ti(et+0,127)],ze.Eb[0]=2*Hy[Ti(et+Y,127)],ze.Eb[1]=101581*Vy[Ti(et+fe,127)]>>16,8>ze.Eb[1]&&(ze.Eb[1]=8),ze.Qc[0]=Hy[Ti(et+_e,117)],ze.Qc[1]=Vy[Ti(et+xe,127)],ze.lc=et+xe}if(!ue.Rb)return Fr(v,4,"Not a key frame.");for(oe(ce),ue=v.Pa,q=0;4>q;++q){for(re=0;8>re;++re)for(Y=0;3>Y;++Y)for(fe=0;11>fe;++fe)_e=ae(ce,RR[q][re][Y][fe])?K(ce,8):MR[q][re][Y][fe],ue.Wc[q][re].Yb[Y][fe]=_e;for(re=0;17>re;++re)ue.Xc[q][re]=ue.Wc[q][qR[re]]}return v.kc=oe(ce),v.kc&&(v.Bd=K(ce,8)),v.cb=1}function Ia(v,j,q,Y,re,ce,ue){var fe=j[re].Yb[q];for(q=0;16>re;++re){if(!ae(v,fe[q+0]))return re;for(;!ae(v,fe[q+1]);)if(fe=j[++re].Yb[0],q=0,re==16)return 16;var xe=j[re+1].Yb;if(ae(v,fe[q+2])){var _e=v,Me=0;if(ae(_e,(et=fe)[(Ze=q)+3]))if(ae(_e,et[Ze+6])){for(fe=0,Ze=2*(Me=ae(_e,et[Ze+8]))+(et=ae(_e,et[Ze+9+Me])),Me=0,et=NR[Ze];et[fe];++fe)Me+=Me+ae(_e,et[fe]);Me+=3+(8<<Ze)}else ae(_e,et[Ze+7])?(Me=7+2*ae(_e,165),Me+=ae(_e,145)):Me=5+ae(_e,159);else Me=ae(_e,et[Ze+4])?3+ae(_e,et[Ze+5]):2;fe=xe[2]}else Me=1,fe=xe[1];xe=ue+DR[re],0>(_e=v).b&&le(_e);var Ze,et=_e.b,ze=(Ze=_e.Ca>>1)-(_e.I>>et)>>31;--_e.b,_e.Ca+=ze,_e.Ca|=1,_e.I-=(Ze+1&ze)<<et,ce[xe]=((Me^ze)-ze)*Y[(0<re)+0]}return 16}function Na(v){var j=v.rb[v.sb-1];j.la=0,j.Na=0,a(v.zc,0,0,v.zc.length),v.ja=0}function ai(v,j){if(v==null)return 0;if(j==null)return Fr(v,2,"NULL VP8Io parameter in VP8Decode().");if(!v.cb&&!jn(v,j))return 0;if(t(v.cb),j.ac==null||j.ac(j)){j.ob&&(v.L=0);var q=nm[v.L];if(v.L==2?(v.yb=0,v.zb=0):(v.yb=j.v-q>>4,v.zb=j.j-q>>4,0>v.yb&&(v.yb=0),0>v.zb&&(v.zb=0)),v.Va=j.o+15+q>>4,v.Hb=j.va+15+q>>4,v.Hb>v.za&&(v.Hb=v.za),v.Va>v.Ub&&(v.Va=v.Ub),0<v.L){var Y=v.ed;for(q=0;4>q;++q){var re;if(v.Qa.Cb){var ce=v.Qa.Lb[q];v.Qa.Fb||(ce+=Y.Tb)}else ce=Y.Tb;for(re=0;1>=re;++re){var ue=v.gd[q][re],fe=ce;if(Y.Pc&&(fe+=Y.vd[0],re&&(fe+=Y.od[0])),0<(fe=0>fe?0:63<fe?63:fe)){var xe=fe;0<Y.wb&&(xe=4<Y.wb?xe>>2:xe>>1)>9-Y.wb&&(xe=9-Y.wb),1>xe&&(xe=1),ue.dd=xe,ue.tc=2*fe+xe,ue.ld=40<=fe?2:15<=fe?1:0}else ue.tc=0;ue.La=re}}}q=0}else Fr(v,6,"Frame setup failed"),q=v.a;if(q=q==0){if(q){v.$c=0,0<v.Aa||(v.Ic=XR);e:{q=v.Ic,Y=4*(xe=v.za);var _e=32*xe,Me=xe+1,Ze=0<v.L?xe*(0<v.Aa?2:1):0,et=(v.Aa==2?2:1)*xe;if((ue=Y+832+(re=3*(16*q+nm[v.L])/2*_e)+(ce=v.Fa!=null&&0<v.Fa.length?v.Kc.c*v.Kc.i:0))!=ue)q=0;else{if(ue>v.Vb){if(v.Vb=0,v.Ec=o(ue),v.Fc=0,v.Ec==null){q=Fr(v,1,"no memory during frame initialization.");break e}v.Vb=ue}ue=v.Ec,fe=v.Fc,v.Ac=ue,v.Bc=fe,fe+=Y,v.Gd=s(_e,sr),v.Hd=0,v.rb=s(Me+1,Fi),v.sb=1,v.wa=Ze?s(Ze,Kn):null,v.Y=0,v.D.Nb=0,v.D.wa=v.wa,v.D.Y=v.Y,0<v.Aa&&(v.D.Y+=xe),t(!0),v.oc=ue,v.pc=fe,fe+=832,v.ya=s(et,Qe),v.aa=0,v.D.ya=v.ya,v.D.aa=v.aa,v.Aa==2&&(v.D.aa+=xe),v.R=16*xe,v.B=8*xe,xe=(_e=nm[v.L])*v.R,_e=_e/2*v.B,v.sa=ue,v.ta=fe+xe,v.qa=v.sa,v.ra=v.ta+16*q*v.R+_e,v.Ha=v.qa,v.Ia=v.ra+8*q*v.B+_e,v.$c=0,fe+=re,v.mb=ce?ue:null,v.nb=ce?fe:null,t(fe+ce<=v.Fc+v.Vb),Na(v),a(v.Ac,v.Bc,0,Y),q=1}}if(q){if(j.ka=0,j.y=v.sa,j.O=v.ta,j.f=v.qa,j.N=v.ra,j.ea=v.Ha,j.Vd=v.Ia,j.fa=v.R,j.Rc=v.B,j.F=null,j.J=0,!Yp){for(q=-255;255>=q;++q)Wa[255+q]=0>q?-q:q;for(q=-1020;1020>=q;++q)Ys[1020+q]=-128>q?-128:127<q?127:q;for(q=-112;112>=q;++q)Yd[112+q]=-16>q?-16:15<q?15:q;for(q=-255;510>=q;++q)pu[255+q]=0>q?0:255<q?255:q;Yp=1}du=Oo,Gs=io,Hd=Si,Ii=oo,Do=pi,ba=ao,fu=Pr,Gp=Hr,Vd=Qn,vc=Oi,yc=gn,Nl=na,xc=si,hu=Da,bc=Te,Dl=De,Gd=Ie,Mo=pt,Qo[0]=Ci,Qo[1]=fs,Qo[2]=Al,Qo[3]=fc,Qo[4]=Fs,Qo[5]=Ko,Qo[6]=Ai,Qo[7]=oi,Qo[8]=hc,Qo[9]=Bi,Ml[0]=dc,Ml[1]=hs,Ml[2]=Qa,Ml[3]=lo,Ml[4]=zn,Ml[5]=Yo,Ml[6]=ko,Ks[0]=Eo,Ks[1]=so,Ks[2]=$s,Ks[3]=co,Ks[4]=Pi,Ks[5]=Pl,Ks[6]=Bs,q=1}else q=0}q&&(q=function(ze,yt){for(ze.M=0;ze.M<ze.Va;++ze.M){var ut,Le=ze.Jc[ze.M&ze.Xb],Fe=ze.m,mt=ze;for(ut=0;ut<mt.za;++ut){var St=Fe,vt=mt,Qt=vt.Ac,$t=vt.Bc+4*ut,xr=vt.zc,zt=vt.ya[vt.aa+ut];if(vt.Qa.Bb?zt.$b=ae(St,vt.Pa.jb[0])?2+ae(St,vt.Pa.jb[2]):ae(St,vt.Pa.jb[1]):zt.$b=0,vt.kc&&(zt.Ad=ae(St,vt.Bd)),zt.Za=!ae(St,145)+0,zt.Za){var vn=zt.Ob,Sn=0;for(vt=0;4>vt;++vt){var on,Jr=xr[0+vt];for(on=0;4>on;++on){Jr=LR[Qt[$t+on]][Jr];for(var kn=ES[ae(St,Jr[0])];0<kn;)kn=ES[2*kn+ae(St,Jr[kn])];Jr=-kn,Qt[$t+on]=Jr}n(vn,Sn,Qt,$t,4),Sn+=4,xr[0+vt]=Jr}}else Jr=ae(St,156)?ae(St,128)?1:3:ae(St,163)?2:0,zt.Ob[0]=Jr,a(Qt,$t,Jr,4),a(xr,0,Jr,4);zt.Dd=ae(St,142)?ae(St,114)?ae(St,183)?1:3:2:0}if(mt.m.Ka)return Fr(ze,7,"Premature end-of-partition0 encountered.");for(;ze.ja<ze.za;++ze.ja){if(mt=Le,St=(Fe=ze).rb[Fe.sb-1],Qt=Fe.rb[Fe.sb+Fe.ja],ut=Fe.ya[Fe.aa+Fe.ja],$t=Fe.kc?ut.Ad:0)St.la=Qt.la=0,ut.Za||(St.Na=Qt.Na=0),ut.Hc=0,ut.Gc=0,ut.ia=0;else{var An,zr;if(St=Qt,Qt=mt,$t=Fe.Pa.Xc,xr=Fe.ya[Fe.aa+Fe.ja],zt=Fe.pb[xr.$b],vt=xr.ad,vn=0,Sn=Fe.rb[Fe.sb-1],Jr=on=0,a(vt,vn,0,384),xr.Za)var La=0,Yi=$t[3];else{kn=o(16);var Ra=St.Na+Sn.Na;if(Ra=Kd(Qt,$t[1],Ra,zt.Eb,0,kn,0),St.Na=Sn.Na=(0<Ra)+0,1<Ra)du(kn,0,vt,vn);else{var Ki=kn[0]+3>>3;for(kn=0;256>kn;kn+=16)vt[vn+kn]=Ki}La=1,Yi=$t[0]}var Cn=15&St.la,po=15&Sn.la;for(kn=0;4>kn;++kn){var mo=1&po;for(Ki=zr=0;4>Ki;++Ki)Cn=Cn>>1|(mo=(Ra=Kd(Qt,Yi,Ra=mo+(1&Cn),zt.Sc,La,vt,vn))>La)<<7,zr=zr<<2|(3<Ra?3:1<Ra?2:vt[vn+0]!=0),vn+=16;Cn>>=4,po=po>>1|mo<<7,on=(on<<8|zr)>>>0}for(Yi=Cn,La=po>>4,An=0;4>An;An+=2){for(zr=0,Cn=St.la>>4+An,po=Sn.la>>4+An,kn=0;2>kn;++kn){for(mo=1&po,Ki=0;2>Ki;++Ki)Ra=mo+(1&Cn),Cn=Cn>>1|(mo=0<(Ra=Kd(Qt,$t[2],Ra,zt.Qc,0,vt,vn)))<<3,zr=zr<<2|(3<Ra?3:1<Ra?2:vt[vn+0]!=0),vn+=16;Cn>>=2,po=po>>1|mo<<5}Jr|=zr<<4*An,Yi|=Cn<<4<<An,La|=(240&po)<<An}St.la=Yi,Sn.la=La,xr.Hc=on,xr.Gc=Jr,xr.ia=43690&Jr?0:zt.ia,$t=!(on|Jr)}if(0<Fe.L&&(Fe.wa[Fe.Y+Fe.ja]=Fe.gd[ut.$b][ut.Za],Fe.wa[Fe.Y+Fe.ja].La|=!$t),mt.Ka)return Fr(ze,7,"Premature end-of-file encountered.")}if(Na(ze),Fe=yt,mt=1,ut=(Le=ze).D,St=0<Le.L&&Le.M>=Le.zb&&Le.M<=Le.Va,Le.Aa==0)e:{if(ut.M=Le.M,ut.uc=St,Ol(Le,ut),mt=1,ut=(zr=Le.D).Nb,St=(Jr=nm[Le.L])*Le.R,Qt=Jr/2*Le.B,kn=16*ut*Le.R,Ki=8*ut*Le.B,$t=Le.sa,xr=Le.ta-St+kn,zt=Le.qa,vt=Le.ra-Qt+Ki,vn=Le.Ha,Sn=Le.Ia-Qt+Ki,po=(Cn=zr.M)==0,on=Cn>=Le.Va-1,Le.Aa==2&&Ol(Le,zr),zr.uc)for(mo=(Ra=Le).D.M,t(Ra.D.uc),zr=Ra.yb;zr<Ra.Hb;++zr){La=zr,Yi=mo;var Xa=(ci=(ha=Ra).D).Nb;An=ha.R;var ci=ci.wa[ci.Y+La],Ni=ha.sa,Fo=ha.ta+16*Xa*An+16*La,ms=ci.dd,Ja=ci.tc;if(Ja!=0)if(t(3<=Ja),ha.L==1)0<La&&Dl(Ni,Fo,An,Ja+4),ci.La&&Mo(Ni,Fo,An,Ja),0<Yi&&bc(Ni,Fo,An,Ja+4),ci.La&&Gd(Ni,Fo,An,Ja);else{var Qs=ha.B,_c=ha.qa,mu=ha.ra+8*Xa*Qs+8*La,Rl=ha.Ha,ha=ha.Ia+8*Xa*Qs+8*La;Xa=ci.ld,0<La&&(Gp(Ni,Fo,An,Ja+4,ms,Xa),vc(_c,mu,Rl,ha,Qs,Ja+4,ms,Xa)),ci.La&&(Nl(Ni,Fo,An,Ja,ms,Xa),hu(_c,mu,Rl,ha,Qs,Ja,ms,Xa)),0<Yi&&(fu(Ni,Fo,An,Ja+4,ms,Xa),Vd(_c,mu,Rl,ha,Qs,Ja+4,ms,Xa)),ci.La&&(yc(Ni,Fo,An,Ja,ms,Xa),xc(_c,mu,Rl,ha,Qs,Ja,ms,Xa))}}if(Le.ia&&alert("todo:DitherRow"),Fe.put!=null){if(zr=16*Cn,Cn=16*(Cn+1),po?(Fe.y=Le.sa,Fe.O=Le.ta+kn,Fe.f=Le.qa,Fe.N=Le.ra+Ki,Fe.ea=Le.Ha,Fe.W=Le.Ia+Ki):(zr-=Jr,Fe.y=$t,Fe.O=xr,Fe.f=zt,Fe.N=vt,Fe.ea=vn,Fe.W=Sn),on||(Cn-=Jr),Cn>Fe.o&&(Cn=Fe.o),Fe.F=null,Fe.J=null,Le.Fa!=null&&0<Le.Fa.length&&zr<Cn&&(Fe.J=pc(Le,Fe,zr,Cn-zr),Fe.F=Le.mb,Fe.F==null&&Fe.F.length==0)){mt=Fr(Le,3,"Could not decode alpha data.");break e}zr<Fe.j&&(Jr=Fe.j-zr,zr=Fe.j,t(!(1&Jr)),Fe.O+=Le.R*Jr,Fe.N+=Le.B*(Jr>>1),Fe.W+=Le.B*(Jr>>1),Fe.F!=null&&(Fe.J+=Fe.width*Jr)),zr<Cn&&(Fe.O+=Fe.v,Fe.N+=Fe.v>>1,Fe.W+=Fe.v>>1,Fe.F!=null&&(Fe.J+=Fe.v),Fe.ka=zr-Fe.j,Fe.U=Fe.va-Fe.v,Fe.T=Cn-zr,mt=Fe.put(Fe))}ut+1!=Le.Ic||on||(n(Le.sa,Le.ta-St,$t,xr+16*Le.R,St),n(Le.qa,Le.ra-Qt,zt,vt+8*Le.B,Qt),n(Le.Ha,Le.Ia-Qt,vn,Sn+8*Le.B,Qt))}if(!mt)return Fr(ze,6,"Output aborted.")}return 1}(v,j)),j.bc!=null&&j.bc(j),q&=1}return q?(v.cb=0,q):0}function ra(v,j,q,Y,re){re=v[j+q+32*Y]+(re>>3),v[j+q+32*Y]=-256&re?0>re?0:255:re}function On(v,j,q,Y,re,ce){ra(v,j,0,q,Y+re),ra(v,j,1,q,Y+ce),ra(v,j,2,q,Y-ce),ra(v,j,3,q,Y-re)}function Gr(v){return(20091*v>>16)+v}function no(v,j,q,Y){var re,ce=0,ue=o(16);for(re=0;4>re;++re){var fe=v[j+0]+v[j+8],xe=v[j+0]-v[j+8],_e=(35468*v[j+4]>>16)-Gr(v[j+12]),Me=Gr(v[j+4])+(35468*v[j+12]>>16);ue[ce+0]=fe+Me,ue[ce+1]=xe+_e,ue[ce+2]=xe-_e,ue[ce+3]=fe-Me,ce+=4,j++}for(re=ce=0;4>re;++re)fe=(v=ue[ce+0]+4)+ue[ce+8],xe=v-ue[ce+8],_e=(35468*ue[ce+4]>>16)-Gr(ue[ce+12]),ra(q,Y,0,0,fe+(Me=Gr(ue[ce+4])+(35468*ue[ce+12]>>16))),ra(q,Y,1,0,xe+_e),ra(q,Y,2,0,xe-_e),ra(q,Y,3,0,fe-Me),ce++,Y+=32}function ao(v,j,q,Y){var re=v[j+0]+4,ce=35468*v[j+4]>>16,ue=Gr(v[j+4]),fe=35468*v[j+1]>>16;On(q,Y,0,re+ue,v=Gr(v[j+1]),fe),On(q,Y,1,re+ce,v,fe),On(q,Y,2,re-ce,v,fe),On(q,Y,3,re-ue,v,fe)}function io(v,j,q,Y,re){no(v,j,q,Y),re&&no(v,j+16,q,Y+4)}function Si(v,j,q,Y){Gs(v,j+0,q,Y,1),Gs(v,j+32,q,Y+128,1)}function oo(v,j,q,Y){var re;for(v=v[j+0]+4,re=0;4>re;++re)for(j=0;4>j;++j)ra(q,Y,j,re,v)}function pi(v,j,q,Y){v[j+0]&&Ii(v,j+0,q,Y),v[j+16]&&Ii(v,j+16,q,Y+4),v[j+32]&&Ii(v,j+32,q,Y+128),v[j+48]&&Ii(v,j+48,q,Y+128+4)}function Oo(v,j,q,Y){var re,ce=o(16);for(re=0;4>re;++re){var ue=v[j+0+re]+v[j+12+re],fe=v[j+4+re]+v[j+8+re],xe=v[j+4+re]-v[j+8+re],_e=v[j+0+re]-v[j+12+re];ce[0+re]=ue+fe,ce[8+re]=ue-fe,ce[4+re]=_e+xe,ce[12+re]=_e-xe}for(re=0;4>re;++re)ue=(v=ce[0+4*re]+3)+ce[3+4*re],fe=ce[1+4*re]+ce[2+4*re],xe=ce[1+4*re]-ce[2+4*re],_e=v-ce[3+4*re],q[Y+0]=ue+fe>>3,q[Y+16]=_e+xe>>3,q[Y+32]=ue-fe>>3,q[Y+48]=_e-xe>>3,Y+=64}function $i(v,j,q){var Y,re=j-32,ce=ho,ue=255-v[re-1];for(Y=0;Y<q;++Y){var fe,xe=ce,_e=ue+v[j-1];for(fe=0;fe<q;++fe)v[j+fe]=xe[_e+v[re+fe]];j+=32}}function fs(v,j){$i(v,j,4)}function so(v,j){$i(v,j,8)}function hs(v,j){$i(v,j,16)}function Qa(v,j){var q;for(q=0;16>q;++q)n(v,j+32*q,v,j-32,16)}function lo(v,j){var q;for(q=16;0<q;--q)a(v,j,v[j-1],16),j+=32}function ii(v,j,q){var Y;for(Y=0;16>Y;++Y)a(j,q+32*Y,v,16)}function dc(v,j){var q,Y=16;for(q=0;16>q;++q)Y+=v[j-1+32*q]+v[j+q-32];ii(Y>>5,v,j)}function zn(v,j){var q,Y=8;for(q=0;16>q;++q)Y+=v[j-1+32*q];ii(Y>>4,v,j)}function Yo(v,j){var q,Y=8;for(q=0;16>q;++q)Y+=v[j+q-32];ii(Y>>4,v,j)}function ko(v,j){ii(128,v,j)}function wr(v,j,q){return v+2*j+q+2>>2}function Al(v,j){var q,Y=j-32;for(Y=new Uint8Array([wr(v[Y-1],v[Y+0],v[Y+1]),wr(v[Y+0],v[Y+1],v[Y+2]),wr(v[Y+1],v[Y+2],v[Y+3]),wr(v[Y+2],v[Y+3],v[Y+4])]),q=0;4>q;++q)n(v,j+32*q,Y,0,Y.length)}function fc(v,j){var q=v[j-1],Y=v[j-1+32],re=v[j-1+64],ce=v[j-1+96];he(v,j+0,16843009*wr(v[j-1-32],q,Y)),he(v,j+32,16843009*wr(q,Y,re)),he(v,j+64,16843009*wr(Y,re,ce)),he(v,j+96,16843009*wr(re,ce,ce))}function Ci(v,j){var q,Y=4;for(q=0;4>q;++q)Y+=v[j+q-32]+v[j-1+32*q];for(Y>>=3,q=0;4>q;++q)a(v,j+32*q,Y,4)}function Fs(v,j){var q=v[j-1+0],Y=v[j-1+32],re=v[j-1+64],ce=v[j-1-32],ue=v[j+0-32],fe=v[j+1-32],xe=v[j+2-32],_e=v[j+3-32];v[j+0+96]=wr(Y,re,v[j-1+96]),v[j+1+96]=v[j+0+64]=wr(q,Y,re),v[j+2+96]=v[j+1+64]=v[j+0+32]=wr(ce,q,Y),v[j+3+96]=v[j+2+64]=v[j+1+32]=v[j+0+0]=wr(ue,ce,q),v[j+3+64]=v[j+2+32]=v[j+1+0]=wr(fe,ue,ce),v[j+3+32]=v[j+2+0]=wr(xe,fe,ue),v[j+3+0]=wr(_e,xe,fe)}function Ai(v,j){var q=v[j+1-32],Y=v[j+2-32],re=v[j+3-32],ce=v[j+4-32],ue=v[j+5-32],fe=v[j+6-32],xe=v[j+7-32];v[j+0+0]=wr(v[j+0-32],q,Y),v[j+1+0]=v[j+0+32]=wr(q,Y,re),v[j+2+0]=v[j+1+32]=v[j+0+64]=wr(Y,re,ce),v[j+3+0]=v[j+2+32]=v[j+1+64]=v[j+0+96]=wr(re,ce,ue),v[j+3+32]=v[j+2+64]=v[j+1+96]=wr(ce,ue,fe),v[j+3+64]=v[j+2+96]=wr(ue,fe,xe),v[j+3+96]=wr(fe,xe,xe)}function Ko(v,j){var q=v[j-1+0],Y=v[j-1+32],re=v[j-1+64],ce=v[j-1-32],ue=v[j+0-32],fe=v[j+1-32],xe=v[j+2-32],_e=v[j+3-32];v[j+0+0]=v[j+1+64]=ce+ue+1>>1,v[j+1+0]=v[j+2+64]=ue+fe+1>>1,v[j+2+0]=v[j+3+64]=fe+xe+1>>1,v[j+3+0]=xe+_e+1>>1,v[j+0+96]=wr(re,Y,q),v[j+0+64]=wr(Y,q,ce),v[j+0+32]=v[j+1+96]=wr(q,ce,ue),v[j+1+32]=v[j+2+96]=wr(ce,ue,fe),v[j+2+32]=v[j+3+96]=wr(ue,fe,xe),v[j+3+32]=wr(fe,xe,_e)}function oi(v,j){var q=v[j+0-32],Y=v[j+1-32],re=v[j+2-32],ce=v[j+3-32],ue=v[j+4-32],fe=v[j+5-32],xe=v[j+6-32],_e=v[j+7-32];v[j+0+0]=q+Y+1>>1,v[j+1+0]=v[j+0+64]=Y+re+1>>1,v[j+2+0]=v[j+1+64]=re+ce+1>>1,v[j+3+0]=v[j+2+64]=ce+ue+1>>1,v[j+0+32]=wr(q,Y,re),v[j+1+32]=v[j+0+96]=wr(Y,re,ce),v[j+2+32]=v[j+1+96]=wr(re,ce,ue),v[j+3+32]=v[j+2+96]=wr(ce,ue,fe),v[j+3+64]=wr(ue,fe,xe),v[j+3+96]=wr(fe,xe,_e)}function Bi(v,j){var q=v[j-1+0],Y=v[j-1+32],re=v[j-1+64],ce=v[j-1+96];v[j+0+0]=q+Y+1>>1,v[j+2+0]=v[j+0+32]=Y+re+1>>1,v[j+2+32]=v[j+0+64]=re+ce+1>>1,v[j+1+0]=wr(q,Y,re),v[j+3+0]=v[j+1+32]=wr(Y,re,ce),v[j+3+32]=v[j+1+64]=wr(re,ce,ce),v[j+3+64]=v[j+2+64]=v[j+0+96]=v[j+1+96]=v[j+2+96]=v[j+3+96]=ce}function hc(v,j){var q=v[j-1+0],Y=v[j-1+32],re=v[j-1+64],ce=v[j-1+96],ue=v[j-1-32],fe=v[j+0-32],xe=v[j+1-32],_e=v[j+2-32];v[j+0+0]=v[j+2+32]=q+ue+1>>1,v[j+0+32]=v[j+2+64]=Y+q+1>>1,v[j+0+64]=v[j+2+96]=re+Y+1>>1,v[j+0+96]=ce+re+1>>1,v[j+3+0]=wr(fe,xe,_e),v[j+2+0]=wr(ue,fe,xe),v[j+1+0]=v[j+3+32]=wr(q,ue,fe),v[j+1+32]=v[j+3+64]=wr(Y,q,ue),v[j+1+64]=v[j+3+96]=wr(re,Y,q),v[j+1+96]=wr(ce,re,Y)}function $s(v,j){var q;for(q=0;8>q;++q)n(v,j+32*q,v,j-32,8)}function co(v,j){var q;for(q=0;8>q;++q)a(v,j,v[j-1],8),j+=32}function To(v,j,q){var Y;for(Y=0;8>Y;++Y)a(j,q+32*Y,v,8)}function Eo(v,j){var q,Y=8;for(q=0;8>q;++q)Y+=v[j+q-32]+v[j-1+32*q];To(Y>>4,v,j)}function Pl(v,j){var q,Y=4;for(q=0;8>q;++q)Y+=v[j+q-32];To(Y>>3,v,j)}function Pi(v,j){var q,Y=4;for(q=0;8>q;++q)Y+=v[j-1+32*q];To(Y>>3,v,j)}function Bs(v,j){To(128,v,j)}function Ui(v,j,q){var Y=v[j-q],re=v[j+0],ce=3*(re-Y)+$y[1020+v[j-2*q]-v[j+q]],ue=Kp[112+(ce+4>>3)];v[j-q]=ho[255+Y+Kp[112+(ce+3>>3)]],v[j+0]=ho[255+re-ue]}function Us(v,j,q,Y){var re=v[j+0],ce=v[j+q];return Ro[255+v[j-2*q]-v[j-q]]>Y||Ro[255+ce-re]>Y}function be(v,j,q,Y){return 4*Ro[255+v[j-q]-v[j+0]]+Ro[255+v[j-2*q]-v[j+q]]<=Y}function we(v,j,q,Y,re){var ce=v[j-3*q],ue=v[j-2*q],fe=v[j-q],xe=v[j+0],_e=v[j+q],Me=v[j+2*q],Ze=v[j+3*q];return 4*Ro[255+fe-xe]+Ro[255+ue-_e]>Y?0:Ro[255+v[j-4*q]-ce]<=re&&Ro[255+ce-ue]<=re&&Ro[255+ue-fe]<=re&&Ro[255+Ze-Me]<=re&&Ro[255+Me-_e]<=re&&Ro[255+_e-xe]<=re}function Te(v,j,q,Y){var re=2*Y+1;for(Y=0;16>Y;++Y)be(v,j+Y,q,re)&&Ui(v,j+Y,q)}function De(v,j,q,Y){var re=2*Y+1;for(Y=0;16>Y;++Y)be(v,j+Y*q,1,re)&&Ui(v,j+Y*q,1)}function Ie(v,j,q,Y){var re;for(re=3;0<re;--re)Te(v,j+=4*q,q,Y)}function pt(v,j,q,Y){var re;for(re=3;0<re;--re)De(v,j+=4,q,Y)}function Et(v,j,q,Y,re,ce,ue,fe){for(ce=2*ce+1;0<re--;){if(we(v,j,q,ce,ue))if(Us(v,j,q,fe))Ui(v,j,q);else{var xe=v,_e=j,Me=q,Ze=xe[_e-2*Me],et=xe[_e-Me],ze=xe[_e+0],yt=xe[_e+Me],ut=xe[_e+2*Me],Le=27*(mt=$y[1020+3*(ze-et)+$y[1020+Ze-yt]])+63>>7,Fe=18*mt+63>>7,mt=9*mt+63>>7;xe[_e-3*Me]=ho[255+xe[_e-3*Me]+mt],xe[_e-2*Me]=ho[255+Ze+Fe],xe[_e-Me]=ho[255+et+Le],xe[_e+0]=ho[255+ze-Le],xe[_e+Me]=ho[255+yt-Fe],xe[_e+2*Me]=ho[255+ut-mt]}j+=Y}}function Lt(v,j,q,Y,re,ce,ue,fe){for(ce=2*ce+1;0<re--;){if(we(v,j,q,ce,ue))if(Us(v,j,q,fe))Ui(v,j,q);else{var xe=v,_e=j,Me=q,Ze=xe[_e-Me],et=xe[_e+0],ze=xe[_e+Me],yt=Kp[112+((ut=3*(et-Ze))+4>>3)],ut=Kp[112+(ut+3>>3)],Le=yt+1>>1;xe[_e-2*Me]=ho[255+xe[_e-2*Me]+Le],xe[_e-Me]=ho[255+Ze+ut],xe[_e+0]=ho[255+et-yt],xe[_e+Me]=ho[255+ze-Le]}j+=Y}}function Pr(v,j,q,Y,re,ce){Et(v,j,q,1,16,Y,re,ce)}function Hr(v,j,q,Y,re,ce){Et(v,j,1,q,16,Y,re,ce)}function gn(v,j,q,Y,re,ce){var ue;for(ue=3;0<ue;--ue)Lt(v,j+=4*q,q,1,16,Y,re,ce)}function na(v,j,q,Y,re,ce){var ue;for(ue=3;0<ue;--ue)Lt(v,j+=4,1,q,16,Y,re,ce)}function Qn(v,j,q,Y,re,ce,ue,fe){Et(v,j,re,1,8,ce,ue,fe),Et(q,Y,re,1,8,ce,ue,fe)}function Oi(v,j,q,Y,re,ce,ue,fe){Et(v,j,1,re,8,ce,ue,fe),Et(q,Y,1,re,8,ce,ue,fe)}function si(v,j,q,Y,re,ce,ue,fe){Lt(v,j+4*re,re,1,8,ce,ue,fe),Lt(q,Y+4*re,re,1,8,ce,ue,fe)}function Da(v,j,q,Y,re,ce,ue,fe){Lt(v,j+4,1,re,8,ce,ue,fe),Lt(q,Y+4,1,re,8,ce,ue,fe)}function Ua(){this.ba=new Jt,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new qr,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function zi(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function uo(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Io(){this.ua=0,this.Wa=new V,this.vb=new V,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new F,this.yc=new M}function ki(){this.xb=this.a=0,this.l=new Ar,this.ca=new Jt,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new C,this.Pb=0,this.wd=new C,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Io,this.ab=0,this.gc=s(4,uo),this.Oc=0}function Wi(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Ar,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Hi(v,j,q,Y,re,ce,ue){for(v=v==null?0:v[j+0],j=0;j<ue;++j)re[ce+j]=v+q[Y+j]&255,v=re[ce+j]}function ps(v,j,q,Y,re,ce,ue){var fe;if(v==null)Hi(null,null,q,Y,re,ce,ue);else for(fe=0;fe<ue;++fe)re[ce+fe]=v[j+fe]+q[Y+fe]&255}function li(v,j,q,Y,re,ce,ue){if(v==null)Hi(null,null,q,Y,re,ce,ue);else{var fe,xe=v[j+0],_e=xe,Me=xe;for(fe=0;fe<ue;++fe)_e=Me+(xe=v[j+fe])-_e,Me=q[Y+fe]+(-256&_e?0>_e?0:255:_e)&255,_e=xe,re[ce+fe]=Me}}function pc(v,j,q,Y){var re=j.width,ce=j.o;if(t(v!=null&&j!=null),0>q||0>=Y||q+Y>ce)return null;if(!v.Cc){if(v.ga==null){var ue;if(v.ga=new Wi,(ue=v.ga==null)||(ue=j.width*j.o,t(v.Gb.length==0),v.Gb=o(ue),v.Uc=0,v.Gb==null?ue=0:(v.mb=v.Gb,v.nb=v.Uc,v.rc=null,ue=1),ue=!ue),!ue){ue=v.ga;var fe=v.Fa,xe=v.P,_e=v.qc,Me=v.mb,Ze=v.nb,et=xe+1,ze=_e-1,yt=ue.l;if(t(fe!=null&&Me!=null&&j!=null),Ll[0]=null,Ll[1]=Hi,Ll[2]=ps,Ll[3]=li,ue.ca=Me,ue.tb=Ze,ue.c=j.width,ue.i=j.height,t(0<ue.c&&0<ue.i),1>=_e)j=0;else if(ue.$a=fe[xe+0]>>0&3,ue.Z=fe[xe+0]>>2&3,ue.Lc=fe[xe+0]>>4&3,xe=fe[xe+0]>>6&3,0>ue.$a||1<ue.$a||4<=ue.Z||1<ue.Lc||xe)j=0;else if(yt.put=Ta,yt.ac=rn,yt.bc=Dn,yt.ma=ue,yt.width=j.width,yt.height=j.height,yt.Da=j.Da,yt.v=j.v,yt.va=j.va,yt.j=j.j,yt.o=j.o,ue.$a)e:{t(ue.$a==1),j=an();t:for(;;){if(j==null){j=0;break e}if(t(ue!=null),ue.mc=j,j.c=ue.c,j.i=ue.i,j.l=ue.l,j.l.ma=ue,j.l.width=ue.c,j.l.height=ue.i,j.a=0,D(j.m,fe,et,ze),!Be(ue.c,ue.i,1,j,null)||(j.ab==1&&j.gc[0].hc==3&&it(j.s)?(ue.ic=1,fe=j.c*j.i,j.Ta=null,j.Ua=0,j.V=o(fe),j.Ba=0,j.V==null?(j.a=1,j=0):j=1):(ue.ic=0,j=tt(j,ue.c)),!j))break t;j=1;break e}ue.mc=null,j=0}else j=ze>=ue.c*ue.i;ue=!j}if(ue)return null;v.ga.Lc!=1?v.Ga=0:Y=ce-q}t(v.ga!=null),t(q+Y<=ce);e:{if(j=(fe=v.ga).c,ce=fe.l.o,fe.$a==0){if(et=v.rc,ze=v.Vc,yt=v.Fa,xe=v.P+1+q*j,_e=v.mb,Me=v.nb+q*j,t(xe<=v.P+v.qc),fe.Z!=0)for(t(Ll[fe.Z]!=null),ue=0;ue<Y;++ue)Ll[fe.Z](et,ze,yt,xe,_e,Me,j),et=_e,ze=Me,Me+=j,xe+=j;else for(ue=0;ue<Y;++ue)n(_e,Me,yt,xe,j),et=_e,ze=Me,Me+=j,xe+=j;v.rc=et,v.Vc=ze}else{if(t(fe.mc!=null),j=q+Y,t((ue=fe.mc)!=null),t(j<=ue.i),ue.C>=j)j=1;else if(fe.ic||Ye(),fe.ic){fe=ue.V,et=ue.Ba,ze=ue.c;var ut=ue.i,Le=(yt=1,xe=ue.$/ze,_e=ue.$%ze,Me=ue.m,Ze=ue.s,ue.$),Fe=ze*ut,mt=ze*j,St=Ze.wc,vt=Le<mt?nn(Ze,_e,xe):null;t(Le<=Fe),t(j<=ut),t(it(Ze));t:for(;;){for(;!Me.h&&Le<mt;){if(_e&St||(vt=nn(Ze,_e,xe)),t(vt!=null),te(Me),256>(ut=Mn(vt.G[0],vt.H[0],Me)))fe[et+Le]=ut,++Le,++_e>=ze&&(_e=0,++xe<=j&&!(xe%16)&&Bt(ue,xe));else{if(!(280>ut)){yt=0;break t}ut=Kr(ut-256,Me);var Qt,$t=Mn(vt.G[4],vt.H[4],Me);if(te(Me),!(Le>=($t=Yn(ze,$t=Kr($t,Me)))&&Fe-Le>=ut)){yt=0;break t}for(Qt=0;Qt<ut;++Qt)fe[et+Le+Qt]=fe[et+Le+Qt-$t];for(Le+=ut,_e+=ut;_e>=ze;)_e-=ze,++xe<=j&&!(xe%16)&&Bt(ue,xe);Le<mt&&_e&St&&(vt=nn(Ze,_e,xe))}t(Me.h==H(Me))}Bt(ue,xe>j?j:xe);break t}!yt||Me.h&&Le<Fe?(yt=0,ue.a=Me.h?5:3):ue.$=Le,j=yt}else j=Ht(ue,ue.V,ue.Ba,ue.c,ue.i,j,At);if(!j){Y=0;break e}}q+Y>=ce&&(v.Cc=1),Y=1}if(!Y)return null;if(v.Cc&&((Y=v.ga)!=null&&(Y.mc=null),v.ga=null,0<v.Ga))return alert("todo:WebPDequantizeLevels"),null}return v.nb+q*re}function N(v,j,q,Y,re,ce){for(;0<re--;){var ue,fe=v,xe=j+(q?1:0),_e=v,Me=j+(q?0:3);for(ue=0;ue<Y;++ue){var Ze=_e[Me+4*ue];Ze!=255&&(Ze*=32897,fe[xe+4*ue+0]=fe[xe+4*ue+0]*Ze>>23,fe[xe+4*ue+1]=fe[xe+4*ue+1]*Ze>>23,fe[xe+4*ue+2]=fe[xe+4*ue+2]*Ze>>23)}j+=ce}}function ne(v,j,q,Y,re){for(;0<Y--;){var ce;for(ce=0;ce<q;++ce){var ue=v[j+2*ce+0],fe=15&(_e=v[j+2*ce+1]),xe=4369*fe,_e=(240&_e|_e>>4)*xe>>16;v[j+2*ce+0]=(240&ue|ue>>4)*xe>>16&240|(15&ue|ue<<4)*xe>>16>>4&15,v[j+2*ce+1]=240&_e|fe}j+=re}}function je(v,j,q,Y,re,ce,ue,fe){var xe,_e,Me=255;for(_e=0;_e<re;++_e){for(xe=0;xe<Y;++xe){var Ze=v[j+xe];ce[ue+4*xe]=Ze,Me&=Ze}j+=q,ue+=fe}return Me!=255}function Ee(v,j,q,Y,re){var ce;for(ce=0;ce<re;++ce)q[Y+ce]=v[j+ce]>>8}function Ye(){Lo=N,Rn=ne,qn=je,_a=Ee}function dt(v,j,q){S[v]=function(Y,re,ce,ue,fe,xe,_e,Me,Ze,et,ze,yt,ut,Le,Fe,mt,St){var vt,Qt=St-1>>1,$t=fe[xe+0]|_e[Me+0]<<16,xr=Ze[et+0]|ze[yt+0]<<16;t(Y!=null);var zt=3*$t+xr+131074>>2;for(j(Y[re+0],255&zt,zt>>16,ut,Le),ce!=null&&(zt=3*xr+$t+131074>>2,j(ce[ue+0],255&zt,zt>>16,Fe,mt)),vt=1;vt<=Qt;++vt){var vn=fe[xe+vt]|_e[Me+vt]<<16,Sn=Ze[et+vt]|ze[yt+vt]<<16,on=$t+vn+xr+Sn+524296,Jr=on+2*(vn+xr)>>3;zt=Jr+$t>>1,$t=(on=on+2*($t+Sn)>>3)+vn>>1,j(Y[re+2*vt-1],255&zt,zt>>16,ut,Le+(2*vt-1)*q),j(Y[re+2*vt-0],255&$t,$t>>16,ut,Le+(2*vt-0)*q),ce!=null&&(zt=on+xr>>1,$t=Jr+Sn>>1,j(ce[ue+2*vt-1],255&zt,zt>>16,Fe,mt+(2*vt-1)*q),j(ce[ue+2*vt+0],255&$t,$t>>16,Fe,mt+(2*vt+0)*q)),$t=vn,xr=Sn}1&St||(zt=3*$t+xr+131074>>2,j(Y[re+St-1],255&zt,zt>>16,ut,Le+(St-1)*q),ce!=null&&(zt=3*xr+$t+131074>>2,j(ce[ue+St-1],255&zt,zt>>16,Fe,mt+(St-1)*q)))}}function Pt(){qo[Qp]=$R,qo[Xp]=NS,qo[OS]=BR,qo[Jp]=DS,qo[Zp]=MS,qo[By]=LS,qo[kS]=UR,qo[Uy]=NS,qo[zy]=DS,qo[em]=MS,qo[Wy]=LS}function Wt(v){return v&-16384?0>v?0:255:v>>zR}function lr(v,j){return Wt((19077*v>>8)+(26149*j>>8)-14234)}function Lr(v,j,q){return Wt((19077*v>>8)-(6419*j>>8)-(13320*q>>8)+8708)}function Or(v,j){return Wt((19077*v>>8)+(33050*j>>8)-17685)}function Xr(v,j,q,Y,re){Y[re+0]=lr(v,q),Y[re+1]=Lr(v,j,q),Y[re+2]=Or(v,j)}function Ln(v,j,q,Y,re){Y[re+0]=Or(v,j),Y[re+1]=Lr(v,j,q),Y[re+2]=lr(v,q)}function Wn(v,j,q,Y,re){var ce=Lr(v,j,q);j=ce<<3&224|Or(v,j)>>3,Y[re+0]=248&lr(v,q)|ce>>5,Y[re+1]=j}function aa(v,j,q,Y,re){var ce=240&Or(v,j)|15;Y[re+0]=240&lr(v,q)|Lr(v,j,q)>>4,Y[re+1]=ce}function za(v,j,q,Y,re){Y[re+0]=255,Xr(v,j,q,Y,re+1)}function Ma(v,j,q,Y,re){Ln(v,j,q,Y,re),Y[re+3]=255}function fo(v,j,q,Y,re){Xr(v,j,q,Y,re),Y[re+3]=255}function Ti(v,j){return 0>v?0:v>j?j:v}function No(v,j,q){S[v]=function(Y,re,ce,ue,fe,xe,_e,Me,Ze){for(var et=Me+(-2&Ze)*q;Me!=et;)j(Y[re+0],ce[ue+0],fe[xe+0],_e,Me),j(Y[re+1],ce[ue+0],fe[xe+0],_e,Me+q),re+=2,++ue,++xe,Me+=2*q;1&Ze&&j(Y[re+0],ce[ue+0],fe[xe+0],_e,Me)}}function uu(v,j,q){return q==0?v==0?j==0?6:5:j==0?4:0:q}function mc(v,j,q,Y,re){switch(v>>>30){case 3:Gs(j,q,Y,re,0);break;case 2:ba(j,q,Y,re);break;case 1:Ii(j,q,Y,re)}}function Ol(v,j){var q,Y,re=j.M,ce=j.Nb,ue=v.oc,fe=v.pc+40,xe=v.oc,_e=v.pc+584,Me=v.oc,Ze=v.pc+600;for(q=0;16>q;++q)ue[fe+32*q-1]=129;for(q=0;8>q;++q)xe[_e+32*q-1]=129,Me[Ze+32*q-1]=129;for(0<re?ue[fe-1-32]=xe[_e-1-32]=Me[Ze-1-32]=129:(a(ue,fe-32-1,127,21),a(xe,_e-32-1,127,9),a(Me,Ze-32-1,127,9)),Y=0;Y<v.za;++Y){var et=j.ya[j.aa+Y];if(0<Y){for(q=-1;16>q;++q)n(ue,fe+32*q-4,ue,fe+32*q+12,4);for(q=-1;8>q;++q)n(xe,_e+32*q-4,xe,_e+32*q+4,4),n(Me,Ze+32*q-4,Me,Ze+32*q+4,4)}var ze=v.Gd,yt=v.Hd+Y,ut=et.ad,Le=et.Hc;if(0<re&&(n(ue,fe-32,ze[yt].y,0,16),n(xe,_e-32,ze[yt].f,0,8),n(Me,Ze-32,ze[yt].ea,0,8)),et.Za){var Fe=ue,mt=fe-32+16;for(0<re&&(Y>=v.za-1?a(Fe,mt,ze[yt].y[15],4):n(Fe,mt,ze[yt+1].y,0,4)),q=0;4>q;q++)Fe[mt+128+q]=Fe[mt+256+q]=Fe[mt+384+q]=Fe[mt+0+q];for(q=0;16>q;++q,Le<<=2)Fe=ue,mt=fe+qS[q],Qo[et.Ob[q]](Fe,mt),mc(Le,ut,16*+q,Fe,mt)}else if(Fe=uu(Y,re,et.Ob[0]),Ml[Fe](ue,fe),Le!=0)for(q=0;16>q;++q,Le<<=2)mc(Le,ut,16*+q,ue,fe+qS[q]);for(q=et.Gc,Fe=uu(Y,re,et.Dd),Ks[Fe](xe,_e),Ks[Fe](Me,Ze),Le=ut,Fe=xe,mt=_e,255&(et=q>>0)&&(170&et?Hd(Le,256,Fe,mt):Do(Le,256,Fe,mt)),et=Me,Le=Ze,255&(q>>=8)&&(170&q?Hd(ut,320,et,Le):Do(ut,320,et,Le)),re<v.Ub-1&&(n(ze[yt].y,0,ue,fe+480,16),n(ze[yt].f,0,xe,_e+224,8),n(ze[yt].ea,0,Me,Ze+224,8)),q=8*ce*v.B,ze=v.sa,yt=v.ta+16*Y+16*ce*v.R,ut=v.qa,et=v.ra+8*Y+q,Le=v.Ha,Fe=v.Ia+8*Y+q,q=0;16>q;++q)n(ze,yt+q*v.R,ue,fe+32*q,16);for(q=0;8>q;++q)n(ut,et+q*v.B,xe,_e+32*q,8),n(Le,Fe+q*v.B,Me,Ze+32*q,8)}}function kl(v,j,q,Y,re,ce,ue,fe,xe){var _e=[0],Me=[0],Ze=0,et=xe!=null?xe.kd:0,ze=xe??new zi;if(v==null||12>q)return 7;ze.data=v,ze.w=j,ze.ha=q,j=[j],q=[q],ze.gb=[ze.gb];e:{var yt=j,ut=q,Le=ze.gb;if(t(v!=null),t(ut!=null),t(Le!=null),Le[0]=0,12<=ut[0]&&!r(v,yt[0],"RIFF")){if(r(v,yt[0]+8,"WEBP")){Le=3;break e}var Fe=G(v,yt[0]+4);if(12>Fe||4294967286<Fe){Le=3;break e}if(et&&Fe>ut[0]-8){Le=7;break e}Le[0]=Fe,yt[0]+=12,ut[0]-=12}Le=0}if(Le!=0)return Le;for(Fe=0<ze.gb[0],q=q[0];;){e:{var mt=v;ut=j,Le=q;var St=_e,vt=Me,Qt=yt=[0];if((zt=Ze=[Ze])[0]=0,8>Le[0])Le=7;else{if(!r(mt,ut[0],"VP8X")){if(G(mt,ut[0]+4)!=10){Le=3;break e}if(18>Le[0]){Le=7;break e}var $t=G(mt,ut[0]+8),xr=1+X(mt,ut[0]+12);if(2147483648<=xr*(mt=1+X(mt,ut[0]+15))){Le=3;break e}Qt!=null&&(Qt[0]=$t),St!=null&&(St[0]=xr),vt!=null&&(vt[0]=mt),ut[0]+=18,Le[0]-=18,zt[0]=1}Le=0}}if(Ze=Ze[0],yt=yt[0],Le!=0)return Le;if(ut=!!(2&yt),!Fe&&Ze)return 3;if(ce!=null&&(ce[0]=!!(16&yt)),ue!=null&&(ue[0]=ut),fe!=null&&(fe[0]=0),ue=_e[0],yt=Me[0],Ze&&ut&&xe==null){Le=0;break}if(4>q){Le=7;break}if(Fe&&Ze||!Fe&&!Ze&&!r(v,j[0],"ALPH")){q=[q],ze.na=[ze.na],ze.P=[ze.P],ze.Sa=[ze.Sa];e:{$t=v,Le=j,Fe=q;var zt=ze.gb;St=ze.na,vt=ze.P,Qt=ze.Sa,xr=22,t($t!=null),t(Fe!=null),mt=Le[0];var vn=Fe[0];for(t(St!=null),t(Qt!=null),St[0]=null,vt[0]=null,Qt[0]=0;;){if(Le[0]=mt,Fe[0]=vn,8>vn){Le=7;break e}var Sn=G($t,mt+4);if(4294967286<Sn){Le=3;break e}var on=8+Sn+1&-2;if(xr+=on,0<zt&&xr>zt){Le=3;break e}if(!r($t,mt,"VP8 ")||!r($t,mt,"VP8L")){Le=0;break e}if(vn[0]<on){Le=7;break e}r($t,mt,"ALPH")||(St[0]=$t,vt[0]=mt+8,Qt[0]=Sn),mt+=on,vn-=on}}if(q=q[0],ze.na=ze.na[0],ze.P=ze.P[0],ze.Sa=ze.Sa[0],Le!=0)break}q=[q],ze.Ja=[ze.Ja],ze.xa=[ze.xa];e:if(zt=v,Le=j,Fe=q,St=ze.gb[0],vt=ze.Ja,Qt=ze.xa,$t=Le[0],mt=!r(zt,$t,"VP8 "),xr=!r(zt,$t,"VP8L"),t(zt!=null),t(Fe!=null),t(vt!=null),t(Qt!=null),8>Fe[0])Le=7;else{if(mt||xr){if(zt=G(zt,$t+4),12<=St&&zt>St-12){Le=3;break e}if(et&&zt>Fe[0]-8){Le=7;break e}vt[0]=zt,Le[0]+=8,Fe[0]-=8,Qt[0]=xr}else Qt[0]=5<=Fe[0]&&zt[$t+0]==47&&!(zt[$t+4]>>5),vt[0]=Fe[0];Le=0}if(q=q[0],ze.Ja=ze.Ja[0],ze.xa=ze.xa[0],j=j[0],Le!=0)break;if(4294967286<ze.Ja)return 3;if(fe==null||ut||(fe[0]=ze.xa?2:1),ue=[ue],yt=[yt],ze.xa){if(5>q){Le=7;break}fe=ue,et=yt,ut=ce,v==null||5>q?v=0:5<=q&&v[j+0]==47&&!(v[j+4]>>5)?(Fe=[0],zt=[0],St=[0],D(vt=new C,v,j,q),rr(vt,Fe,zt,St)?(fe!=null&&(fe[0]=Fe[0]),et!=null&&(et[0]=zt[0]),ut!=null&&(ut[0]=St[0]),v=1):v=0):v=0}else{if(10>q){Le=7;break}fe=yt,v==null||10>q||!ta(v,j+3,q-3)?v=0:(et=v[j+0]|v[j+1]<<8|v[j+2]<<16,ut=16383&(v[j+7]<<8|v[j+6]),v=16383&(v[j+9]<<8|v[j+8]),1&et||3<(et>>1&7)||!(et>>4&1)||et>>5>=ze.Ja||!ut||!v?v=0:(ue&&(ue[0]=ut),fe&&(fe[0]=v),v=1))}if(!v||(ue=ue[0],yt=yt[0],Ze&&(_e[0]!=ue||Me[0]!=yt)))return 3;xe!=null&&(xe[0]=ze,xe.offset=j-xe.w,t(4294967286>j-xe.w),t(xe.offset==xe.ha-q));break}return Le==0||Le==7&&Ze&&xe==null?(ce!=null&&(ce[0]|=ze.na!=null&&0<ze.na.length),Y!=null&&(Y[0]=ue),re!=null&&(re[0]=yt),0):Le}function gc(v,j,q){var Y=j.width,re=j.height,ce=0,ue=0,fe=Y,xe=re;if(j.Da=v!=null&&0<v.Da,j.Da&&(fe=v.cd,xe=v.bd,ce=v.v,ue=v.j,11>q||(ce&=-2,ue&=-2),0>ce||0>ue||0>=fe||0>=xe||ce+fe>Y||ue+xe>re))return 0;if(j.v=ce,j.j=ue,j.va=ce+fe,j.o=ue+xe,j.U=fe,j.T=xe,j.da=v!=null&&0<v.da,j.da){if(!He(fe,xe,q=[v.ib],ce=[v.hb]))return 0;j.ib=q[0],j.hb=ce[0]}return j.ob=v!=null&&v.ob,j.Kb=v==null||!v.Sd,j.da&&(j.ob=j.ib<3*Y/4&&j.hb<3*re/4,j.Kb=0),1}function Tl(v){if(v==null)return 2;if(11>v.S){var j=v.f.RGBA;j.fb+=(v.height-1)*j.A,j.A=-j.A}else j=v.f.kb,v=v.height,j.O+=(v-1)*j.fa,j.fa=-j.fa,j.N+=(v-1>>1)*j.Ab,j.Ab=-j.Ab,j.W+=(v-1>>1)*j.Db,j.Db=-j.Db,j.F!=null&&(j.J+=(v-1)*j.lb,j.lb=-j.lb);return 0}function zs(v,j,q,Y){if(Y==null||0>=v||0>=j)return 2;if(q!=null){if(q.Da){var re=q.cd,ce=q.bd,ue=-2&q.v,fe=-2&q.j;if(0>ue||0>fe||0>=re||0>=ce||ue+re>v||fe+ce>j)return 2;v=re,j=ce}if(q.da){if(!He(v,j,re=[q.ib],ce=[q.hb]))return 2;v=re[0],j=ce[0]}}Y.width=v,Y.height=j;e:{var xe=Y.width,_e=Y.height;if(v=Y.S,0>=xe||0>=_e||!(v>=Qp&&13>v))v=2;else{if(0>=Y.Rd&&Y.sd==null){ue=ce=re=j=0;var Me=(fe=xe*FS[v])*_e;if(11>v||(ce=(_e+1)/2*(j=(xe+1)/2),v==12&&(ue=(re=xe)*_e)),(_e=o(Me+2*ce+ue))==null){v=1;break e}Y.sd=_e,11>v?((xe=Y.f.RGBA).eb=_e,xe.fb=0,xe.A=fe,xe.size=Me):((xe=Y.f.kb).y=_e,xe.O=0,xe.fa=fe,xe.Fd=Me,xe.f=_e,xe.N=0+Me,xe.Ab=j,xe.Cd=ce,xe.ea=_e,xe.W=0+Me+ce,xe.Db=j,xe.Ed=ce,v==12&&(xe.F=_e,xe.J=0+Me+2*ce),xe.Tc=ue,xe.lb=re)}if(j=1,re=Y.S,ce=Y.width,ue=Y.height,re>=Qp&&13>re)if(11>re)v=Y.f.RGBA,j&=(fe=Math.abs(v.A))*(ue-1)+ce<=v.size,j&=fe>=ce*FS[re],j&=v.eb!=null;else{v=Y.f.kb,fe=(ce+1)/2,Me=(ue+1)/2,xe=Math.abs(v.fa),_e=Math.abs(v.Ab);var Ze=Math.abs(v.Db),et=Math.abs(v.lb),ze=et*(ue-1)+ce;j&=xe*(ue-1)+ce<=v.Fd,j&=_e*(Me-1)+fe<=v.Cd,j=(j&=Ze*(Me-1)+fe<=v.Ed)&xe>=ce&_e>=fe&Ze>=fe,j&=v.y!=null,j&=v.f!=null,j&=v.ea!=null,re==12&&(j&=et>=ce,j&=ze<=v.Tc,j&=v.F!=null)}else j=0;v=j?0:2}}return v!=0||q!=null&&q.fd&&(v=Tl(Y)),v}var fa=64,El=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],de=24,pe=32,ke=8,Oe=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Ke("Predictor0","PredictorAdd0"),S.Predictor0=function(){return 4278190080},S.Predictor1=function(v){return v},S.Predictor2=function(v,j,q){return j[q+0]},S.Predictor3=function(v,j,q){return j[q+1]},S.Predictor4=function(v,j,q){return j[q-1]},S.Predictor5=function(v,j,q){return st(st(v,j[q+1]),j[q+0])},S.Predictor6=function(v,j,q){return st(v,j[q-1])},S.Predictor7=function(v,j,q){return st(v,j[q+0])},S.Predictor8=function(v,j,q){return st(j[q-1],j[q+0])},S.Predictor9=function(v,j,q){return st(j[q+0],j[q+1])},S.Predictor10=function(v,j,q){return st(st(v,j[q-1]),st(j[q+0],j[q+1]))},S.Predictor11=function(v,j,q){var Y=j[q+0];return 0>=Je(Y>>24&255,v>>24&255,(j=j[q-1])>>24&255)+Je(Y>>16&255,v>>16&255,j>>16&255)+Je(Y>>8&255,v>>8&255,j>>8&255)+Je(255&Y,255&v,255&j)?Y:v},S.Predictor12=function(v,j,q){var Y=j[q+0];return(gt((v>>24&255)+(Y>>24&255)-((j=j[q-1])>>24&255))<<24|gt((v>>16&255)+(Y>>16&255)-(j>>16&255))<<16|gt((v>>8&255)+(Y>>8&255)-(j>>8&255))<<8|gt((255&v)+(255&Y)-(255&j)))>>>0},S.Predictor13=function(v,j,q){var Y=j[q-1];return(Ge((v=st(v,j[q+0]))>>24&255,Y>>24&255)<<24|Ge(v>>16&255,Y>>16&255)<<16|Ge(v>>8&255,Y>>8&255)<<8|Ge(v>>0&255,Y>>0&255))>>>0};var rt=S.PredictorAdd0;S.PredictorAdd1=We,Ke("Predictor2","PredictorAdd2"),Ke("Predictor3","PredictorAdd3"),Ke("Predictor4","PredictorAdd4"),Ke("Predictor5","PredictorAdd5"),Ke("Predictor6","PredictorAdd6"),Ke("Predictor7","PredictorAdd7"),Ke("Predictor8","PredictorAdd8"),Ke("Predictor9","PredictorAdd9"),Ke("Predictor10","PredictorAdd10"),Ke("Predictor11","PredictorAdd11"),Ke("Predictor12","PredictorAdd12"),Ke("Predictor13","PredictorAdd13");var bt=S.PredictorAdd2;Vt("ColorIndexInverseTransform","MapARGB","32b",function(v){return v>>8&255},function(v){return v}),Vt("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(v){return v},function(v){return v>>8&255});var Ut,Dt=S.ColorIndexInverseTransform,fr=S.MapARGB,Xn=S.VP8LColorIndexInverseTransformAlpha,xa=S.MapAlpha,Vi=S.VP8LPredictorsAdd=[];Vi.length=16,(S.VP8LPredictors=[]).length=16,(S.VP8LPredictorsAdd_C=[]).length=16,(S.VP8LPredictors_C=[]).length=16;var Ws,Gi,Ei,Il,Hs,Vs,du,Gs,ba,Hd,Ii,Do,fu,Gp,Vd,vc,yc,Nl,xc,hu,bc,Dl,Gd,Mo,Lo,Rn,qn,_a,Wa=o(511),Ys=o(2041),Yd=o(225),pu=o(767),Yp=0,$y=Ys,Kp=Yd,ho=pu,Ro=Wa,Qp=0,Xp=1,OS=2,Jp=3,Zp=4,By=5,kS=6,Uy=7,zy=8,em=9,Wy=10,AR=[2,3,7],PR=[3,3,11],TS=[280,256,256,256,40],OR=[0,1,1,1,0],kR=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],TR=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],ER=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],IR=8,Hy=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Vy=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Kd=null,NR=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],DR=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],ES=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],MR=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],LR=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],RR=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],qR=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Ml=[],Qo=[],Ks=[],FR=1,IS=2,Ll=[],qo=[];dt("UpsampleRgbLinePair",Xr,3),dt("UpsampleBgrLinePair",Ln,3),dt("UpsampleRgbaLinePair",fo,4),dt("UpsampleBgraLinePair",Ma,4),dt("UpsampleArgbLinePair",za,4),dt("UpsampleRgba4444LinePair",aa,2),dt("UpsampleRgb565LinePair",Wn,2);var $R=S.UpsampleRgbLinePair,BR=S.UpsampleBgrLinePair,NS=S.UpsampleRgbaLinePair,DS=S.UpsampleBgraLinePair,MS=S.UpsampleArgbLinePair,LS=S.UpsampleRgba4444LinePair,UR=S.UpsampleRgb565LinePair,tm=16,rm=1<<tm-1,Qd=-227,Gy=482,zR=6,RS=0,WR=o(256),HR=o(256),VR=o(256),GR=o(256),YR=o(Gy-Qd),KR=o(Gy-Qd);No("YuvToRgbRow",Xr,3),No("YuvToBgrRow",Ln,3),No("YuvToRgbaRow",fo,4),No("YuvToBgraRow",Ma,4),No("YuvToArgbRow",za,4),No("YuvToRgba4444Row",aa,2),No("YuvToRgb565Row",Wn,2);var qS=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],nm=[0,2,8],QR=[8,7,6,4,4,2,2,2,1,1,1,1],XR=1;this.WebPDecodeRGBA=function(v,j,q,Y,re){var ce=Xp,ue=new Ua,fe=new Jt;ue.ba=fe,fe.S=ce,fe.width=[fe.width],fe.height=[fe.height];var xe=fe.width,_e=fe.height,Me=new Dr;if(Me==null||v==null)var Ze=2;else t(Me!=null),Ze=kl(v,j,q,Me.width,Me.height,Me.Pd,Me.Qd,Me.format,null);if(Ze!=0?xe=0:(xe!=null&&(xe[0]=Me.width[0]),_e!=null&&(_e[0]=Me.height[0]),xe=1),xe){fe.width=fe.width[0],fe.height=fe.height[0],Y!=null&&(Y[0]=fe.width),re!=null&&(re[0]=fe.height);e:{if(Y=new Ar,(re=new zi).data=v,re.w=j,re.ha=q,re.kd=1,j=[0],t(re!=null),((v=kl(re.data,re.w,re.ha,null,null,null,j,null,re))==0||v==7)&&j[0]&&(v=4),(j=v)==0){if(t(ue!=null),Y.data=re.data,Y.w=re.w+re.offset,Y.ha=re.ha-re.offset,Y.put=Ta,Y.ac=rn,Y.bc=Dn,Y.ma=ue,re.xa){if((v=an())==null){ue=1;break e}if(function(et,ze){var yt=[0],ut=[0],Le=[0];t:for(;;){if(et==null)return 0;if(ze==null)return et.a=2,0;if(et.l=ze,et.a=0,D(et.m,ze.data,ze.w,ze.ha),!rr(et.m,yt,ut,Le)){et.a=3;break t}if(et.xb=IS,ze.width=yt[0],ze.height=ut[0],!Be(yt[0],ut[0],1,et,null))break t;return 1}return t(et.a!=0),0}(v,Y)){if(Y=(j=zs(Y.width,Y.height,ue.Oa,ue.ba))==0){t:{Y=v;r:for(;;){if(Y==null){Y=0;break t}if(t(Y.s.yc!=null),t(Y.s.Ya!=null),t(0<Y.s.Wb),t((q=Y.l)!=null),t((re=q.ma)!=null),Y.xb!=0){if(Y.ca=re.ba,Y.tb=re.tb,t(Y.ca!=null),!gc(re.Oa,q,Jp)){Y.a=2;break r}if(!tt(Y,q.width)||q.da)break r;if((q.da||at(Y.ca.S))&&Ye(),11>Y.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),Y.ca.f.kb.F!=null&&Ye()),Y.Pb&&0<Y.s.ua&&Y.s.vb.X==null&&!ee(Y.s.vb,Y.s.Wa.Xa)){Y.a=1;break r}Y.xb=0}if(!Ht(Y,Y.V,Y.Ba,Y.c,Y.i,q.o,Ve))break r;re.Dc=Y.Ma,Y=1;break t}t(Y.a!=0),Y=0}Y=!Y}Y&&(j=v.a)}else j=v.a}else{if((v=new dn)==null){ue=1;break e}if(v.Fa=re.na,v.P=re.P,v.qc=re.Sa,jn(v,Y)){if((j=zs(Y.width,Y.height,ue.Oa,ue.ba))==0){if(v.Aa=0,q=ue.Oa,t((re=v)!=null),q!=null){if(0<(xe=0>(xe=q.Md)?0:100<xe?255:255*xe/100)){for(_e=Me=0;4>_e;++_e)12>(Ze=re.pb[_e]).lc&&(Ze.ia=xe*QR[0>Ze.lc?0:Ze.lc]>>3),Me|=Ze.ia;Me&&(alert("todo:VP8InitRandom"),re.ia=1)}re.Ga=q.Id,100<re.Ga?re.Ga=100:0>re.Ga&&(re.Ga=0)}ai(v,Y)||(j=v.a)}}else j=v.a}j==0&&ue.Oa!=null&&ue.Oa.fd&&(j=Tl(ue.ba))}ue=j}ce=ue!=0?null:11>ce?fe.f.RGBA.eb:fe.f.kb.y}else ce=null;return ce};var FS=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function u(S,I){for(var z="",k=0;k<4;k++)z+=String.fromCharCode(S[I++]);return z}function d(S,I){return(S[I+0]<<0|S[I+1]<<8|S[I+2]<<16)>>>0}function f(S,I){return(S[I+0]<<0|S[I+1]<<8|S[I+2]<<16|S[I+3]<<24)>>>0}new c;var h=[0],p=[0],g=[],m=new c,x=e,b=function(S,I){var z={},k=0,M=!1,R=0,F=0;if(z.frames=[],!function(L,H,U,te){for(var le=0;le<te;le++)if(L[H+le]!=U.charCodeAt(le))return!0;return!1}(S,I,"RIFF",4)){for(f(S,I+=4),I+=8;I<S.length;){var W=u(S,I),K=f(S,I+=4);I+=4;var Z=K+(1&K);switch(W){case"VP8 ":case"VP8L":z.frames[k]===void 0&&(z.frames[k]={}),($=z.frames[k]).src_off=M?F:I-8,$.src_size=R+K+8,k++,M&&(M=!1,R=0,F=0);break;case"VP8X":($=z.header={}).feature_flags=S[I];var D=I+4;$.canvas_width=1+d(S,D),D+=3,$.canvas_height=1+d(S,D),D+=3;break;case"ALPH":M=!0,R=Z+8,F=I-8;break;case"ANIM":($=z.header).bgcolor=f(S,I),D=I+4,$.loop_count=(Q=S)[(C=D)+0]<<0|Q[C+1]<<8,D+=2;break;case"ANMF":var P,$;($=z.frames[k]={}).offset_x=2*d(S,I),I+=3,$.offset_y=2*d(S,I),I+=3,$.width=1+d(S,I),I+=3,$.height=1+d(S,I),I+=3,$.duration=d(S,I),I+=3,P=S[I++],$.dispose=1&P,$.blend=P>>1&1}W!="ANMF"&&(I+=Z)}var Q,C;return z}}(x,0);b.response=x,b.rgbaoutput=!0,b.dataurl=!1;var _=b.header?b.header:null,w=b.frames?b.frames:null;if(_){_.loop_counter=_.loop_count,h=[_.canvas_height],p=[_.canvas_width];for(var A=0;A<w.length&&w[A].blend!=0;A++);}var O=w[0],T=m.WebPDecodeRGBA(x,O.src_off,O.src_size,p,h);O.rgba=T,O.imgwidth=p[0],O.imgheight=h[0];for(var E=0;E<p[0]*h[0]*4;E++)g[E]=T[E];return this.width=p,this.height=h,this.data=g,this}(function(e){var t=function(){return typeof Tw=="function"},r=function(h,p,g,m){var x=4,b=s;switch(m){case e.image_compression.FAST:x=1,b=o;break;case e.image_compression.MEDIUM:x=6,b=l;break;case e.image_compression.SLOW:x=9,b=c}h=n(h,p,g,b);var _=Tw(h,{level:x});return e.__addimage__.arrayBufferToBinaryString(_)},n=function(h,p,g,m){for(var x,b,_,w=h.length/p,A=new Uint8Array(h.length+w),O=d(),T=0;T<w;T+=1){if(_=T*p,x=h.subarray(_,_+p),m)A.set(m(x,g,b),_+T);else{for(var E,S=O.length,I=[];E<S;E+=1)I[E]=O[E](x,g,b);var z=f(I.concat());A.set(I[z],_+T)}b=x}return A},a=function(h){var p=Array.apply([],h);return p.unshift(0),p},o=function(h,p){var g,m=[],x=h.length;m[0]=1;for(var b=0;b<x;b+=1)g=h[b-p]||0,m[b+1]=h[b]-g+256&255;return m},s=function(h,p,g){var m,x=[],b=h.length;x[0]=2;for(var _=0;_<b;_+=1)m=g&&g[_]||0,x[_+1]=h[_]-m+256&255;return x},l=function(h,p,g){var m,x,b=[],_=h.length;b[0]=3;for(var w=0;w<_;w+=1)m=h[w-p]||0,x=g&&g[w]||0,b[w+1]=h[w]+256-(m+x>>>1)&255;return b},c=function(h,p,g){var m,x,b,_,w=[],A=h.length;w[0]=4;for(var O=0;O<A;O+=1)m=h[O-p]||0,x=g&&g[O]||0,b=g&&g[O-p]||0,_=u(m,x,b),w[O+1]=h[O]-_+256&255;return w},u=function(h,p,g){if(h===p&&p===g)return h;var m=Math.abs(p-g),x=Math.abs(h-g),b=Math.abs(h+p-g-g);return m<=x&&m<=b?h:x<=b?p:g},d=function(){return[a,o,s,l,c]},f=function(h){var p=h.map(function(g){return g.reduce(function(m,x){return m+Math.abs(x)},0)});return p.indexOf(Math.min.apply(null,p))};e.processPNG=function(h,p,g,m){var x,b,_,w,A,O,T,E,S,I,z,k,M,R,F,W=this.decode.FLATE_DECODE,K="";if(this.__addimage__.isArrayBuffer(h)&&(h=new Uint8Array(h)),this.__addimage__.isArrayBufferView(h)){if(h=(_=new uce(h)).imgData,b=_.bits,x=_.colorSpace,A=_.colors,[4,6].indexOf(_.colorType)!==-1){if(_.bits===8){S=(E=_.pixelBitlength==32?new Uint32Array(_.decodePixels().buffer):_.pixelBitlength==16?new Uint16Array(_.decodePixels().buffer):new Uint8Array(_.decodePixels().buffer)).length,z=new Uint8Array(S*_.colors),I=new Uint8Array(S);var Z,D=_.pixelBitlength-_.bits;for(R=0,F=0;R<S;R++){for(M=E[R],Z=0;Z<D;)z[F++]=M>>>Z&255,Z+=_.bits;I[R]=M>>>Z&255}}if(_.bits===16){S=(E=new Uint32Array(_.decodePixels().buffer)).length,z=new Uint8Array(S*(32/_.pixelBitlength)*_.colors),I=new Uint8Array(S*(32/_.pixelBitlength)),k=_.colors>1,R=0,F=0;for(var P=0;R<S;)M=E[R++],z[F++]=M>>>0&255,k&&(z[F++]=M>>>16&255,M=E[R++],z[F++]=M>>>0&255),I[P++]=M>>>16&255;b=8}m!==e.image_compression.NONE&&t()?(h=r(z,_.width*_.colors,_.colors,m),T=r(I,_.width,1,m)):(h=z,T=I,W=void 0)}if(_.colorType===3&&(x=this.color_spaces.INDEXED,O=_.palette,_.transparency.indexed)){var $=_.transparency.indexed,Q=0;for(R=0,S=$.length;R<S;++R)Q+=$[R];if((Q/=255)===S-1&&$.indexOf(0)!==-1)w=[$.indexOf(0)];else if(Q!==S){for(E=_.decodePixels(),I=new Uint8Array(E.length),R=0,S=E.length;R<S;R++)I[R]=$[E[R]];T=r(I,_.width,1)}}var C=function(L){var H;switch(L){case e.image_compression.FAST:H=11;break;case e.image_compression.MEDIUM:H=13;break;case e.image_compression.SLOW:H=14;break;default:H=12}return H}(m);return W===this.decode.FLATE_DECODE&&(K="/Predictor "+C+" "),K+="/Colors "+A+" /BitsPerComponent "+b+" /Columns "+_.width,(this.__addimage__.isArrayBuffer(h)||this.__addimage__.isArrayBufferView(h))&&(h=this.__addimage__.arrayBufferToBinaryString(h)),(T&&this.__addimage__.isArrayBuffer(T)||this.__addimage__.isArrayBufferView(T))&&(T=this.__addimage__.arrayBufferToBinaryString(T)),{alias:g,data:h,index:p,filter:W,decodeParameters:K,transparency:w,palette:O,sMask:T,predictor:C,width:_.width,height:_.height,bitsPerComponent:b,colorSpace:x}}}})(Sr.API),function(e){e.processGIF89A=function(t,r,n,a){var o=new dce(t),s=o.width,l=o.height,c=[];o.decodeAndBlitFrameRGBA(0,c);var u={data:c,width:s,height:l},d=new O2(100).encode(u,100);return e.processJPEG.call(this,d,r,n,a)},e.processGIF87A=e.processGIF89A}(Sr.API),es.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:a,green:n,blue:r,quad:o}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},es.prototype.parseBGR=function(){this.pos=this.offset;try{var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[e]()}catch(r){Tn.log("bit decode error:"+r)}},es.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),r=t%4;for(e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,a=0;a<t;a++)for(var o=this.datav.getUint8(this.pos++,!0),s=n*this.width*4+8*a*4,l=0;l<8&&8*a+l<this.width;l++){var c=this.palette[o>>7-l&1];this.data[s+4*l]=c.blue,this.data[s+4*l+1]=c.green,this.data[s+4*l+2]=c.red,this.data[s+4*l+3]=255}r!==0&&(this.pos+=4-r)}},es.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,a=0;a<e;a++){var o=this.datav.getUint8(this.pos++,!0),s=n*this.width*4+2*a*4,l=o>>4,c=15&o,u=this.palette[l];if(this.data[s]=u.blue,this.data[s+1]=u.green,this.data[s+2]=u.red,this.data[s+3]=255,2*a+1>=this.width)break;u=this.palette[c],this.data[s+4]=u.blue,this.data[s+4+1]=u.green,this.data[s+4+2]=u.red,this.data[s+4+3]=255}t!==0&&(this.pos+=4-t)}},es.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var a=this.datav.getUint8(this.pos++,!0),o=r*this.width*4+4*n;if(a<this.palette.length){var s=this.palette[a];this.data[o]=s.red,this.data[o+1]=s.green,this.data[o+2]=s.blue,this.data[o+3]=255}else this.data[o]=255,this.data[o+1]=255,this.data[o+2]=255,this.data[o+3]=255}e!==0&&(this.pos+=4-e)}},es.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,a=0;a<this.width;a++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var s=(o&t)/t*255|0,l=(o>>5&t)/t*255|0,c=(o>>10&t)/t*255|0,u=o>>15?255:0,d=n*this.width*4+4*a;this.data[d]=c,this.data[d+1]=l,this.data[d+2]=s,this.data[d+3]=u}this.pos+=e}},es.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),r=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var a=this.bottom_up?n:this.height-1-n,o=0;o<this.width;o++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(s&t)/t*255|0,c=(s>>5&r)/r*255|0,u=(s>>11)/t*255|0,d=a*this.width*4+4*o;this.data[d]=u,this.data[d+1]=c,this.data[d+2]=l,this.data[d+3]=255}this.pos+=e}},es.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),s=t*this.width*4+4*r;this.data[s]=o,this.data[s+1]=a,this.data[s+2]=n,this.data[s+3]=255}this.pos+=this.width%4}},es.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),l=t*this.width*4+4*r;this.data[l]=o,this.data[l+1]=a,this.data[l+2]=n,this.data[l+3]=s}},es.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,r,n,a){var o=new es(t,!1),s=o.width,l=o.height,c={data:o.getData(),width:s,height:l},u=new O2(100).encode(c,100);return e.processJPEG.call(this,u,r,n,a)}}(Sr.API),i4.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,r,n,a){var o=new i4(t),s=o.width,l=o.height,c={data:o.getData(),width:s,height:l},u=new O2(100).encode(c,100);return e.processJPEG.call(this,u,r,n,a)}}(Sr.API),Sr.API.processRGBA=function(e,t,r){for(var n=e.data,a=n.length,o=new Uint8Array(a/4*3),s=new Uint8Array(a/4),l=0,c=0,u=0;u<a;u+=4){var d=n[u],f=n[u+1],h=n[u+2],p=n[u+3];o[l++]=d,o[l++]=f,o[l++]=h,s[c++]=p}var g=this.__addimage__.arrayBufferToBinaryString(o);return{alpha:this.__addimage__.arrayBufferToBinaryString(s),data:g,index:t,alias:r,colorSpace:"DeviceRGB",bitsPerComponent:8,width:e.width,height:e.height}},Sr.API.setLanguage=function(e){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]!==void 0&&(this.internal.languageSettings.languageCode=e,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Au=Sr.API,qm=Au.getCharWidthsArray=function(e,t){var r,n,a=(t=t||{}).font||this.internal.getFont(),o=t.fontSize||this.internal.getFontSize(),s=t.charSpace||this.internal.getCharSpace(),l=t.widths?t.widths:a.metadata.Unicode.widths,c=l.fof?l.fof:1,u=t.kerning?t.kerning:a.metadata.Unicode.kerning,d=u.fof?u.fof:1,f=t.doKerning!==!1,h=0,p=e.length,g=0,m=l[0]||c,x=[];for(r=0;r<p;r++)n=e.charCodeAt(r),typeof a.metadata.widthOfString=="function"?x.push((a.metadata.widthOfGlyph(a.metadata.characterToGlyph(n))+s*(1e3/o)||0)/1e3):(h=f&&xn(u[n])==="object"&&!isNaN(parseInt(u[n][g],10))?u[n][g]/d:0,x.push((l[n]||m)/c+h)),g=n;return x},t4=Au.getStringUnitWidth=function(e,t){var r=(t=t||{}).fontSize||this.internal.getFontSize(),n=t.font||this.internal.getFont(),a=t.charSpace||this.internal.getCharSpace();return Au.processArabic&&(e=Au.processArabic(e)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(e,r,a)/r:qm.apply(this,arguments).reduce(function(o,s){return o+s},0)},r4=function(e,t,r,n){for(var a=[],o=0,s=e.length,l=0;o!==s&&l+t[o]<r;)l+=t[o],o++;a.push(e.slice(0,o));var c=o;for(l=0;o!==s;)l+t[o]>n&&(a.push(e.slice(c,o)),l=0,c=o),l+=t[o],o++;return c!==o&&a.push(e.slice(c,o)),a},n4=function(e,t,r){r||(r={});var n,a,o,s,l,c,u,d=[],f=[d],h=r.textIndent||0,p=0,g=0,m=e.split(" "),x=qm.apply(this,[" ",r])[0];if(c=r.lineIndent===-1?m[0].length+2:r.lineIndent||0){var b=Array(c).join(" "),_=[];m.map(function(A){(A=A.split(/\s*\n/)).length>1?_=_.concat(A.map(function(O,T){return(T&&O.length?`
`:"")+O})):_.push(A[0])}),m=_,c=t4.apply(this,[b,r])}for(o=0,s=m.length;o<s;o++){var w=0;if(n=m[o],c&&n[0]==`
`&&(n=n.substr(1),w=1),h+p+(g=(a=qm.apply(this,[n,r])).reduce(function(A,O){return A+O},0))>t||w){if(g>t){for(l=r4.apply(this,[n,a,t-(h+p),t]),d.push(l.shift()),d=[l.pop()];l.length;)f.push([l.shift()]);g=a.slice(n.length-(d[0]?d[0].length:0)).reduce(function(A,O){return A+O},0)}else d=[n];f.push(d),h=g+c,p=x}else d.push(n),h+=p+g,p=x}return u=c?function(A,O){return(O?b:"")+A.join(" ")}:function(A){return A.join(" ")},f.map(u)},Au.splitTextToSize=function(e,t,r){var n,a=(r=r||{}).fontSize||this.internal.getFontSize(),o=(function(d){if(d.widths&&d.kerning)return{widths:d.widths,kerning:d.kerning};var f=this.internal.getFont(d.fontName,d.fontStyle);return f.metadata.Unicode?{widths:f.metadata.Unicode.widths||{0:1},kerning:f.metadata.Unicode.kerning||{}}:{font:f.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,r);n=Array.isArray(e)?e:String(e).split(/\r?\n/);var s=1*this.internal.scaleFactor*t/a;o.textIndent=r.textIndent?1*r.textIndent*this.internal.scaleFactor/a:0,o.lineIndent=r.lineIndent;var l,c,u=[];for(l=0,c=n.length;l<c;l++)u=u.concat(n4.apply(this,[n[l],s,o]));return u},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="klmnopqrstuvwxyz",r={},n={},a=0;a<t.length;a++)r[t[a]]="0123456789abcdef"[a],n["0123456789abcdef"[a]]=t[a];var o=function(f){return"0x"+parseInt(f,10).toString(16)},s=e.__fontmetrics__.compress=function(f){var h,p,g,m,x=["{"];for(var b in f){if(h=f[b],isNaN(parseInt(b,10))?p="'"+b+"'":(b=parseInt(b,10),p=(p=o(b).slice(2)).slice(0,-1)+n[p.slice(-1)]),typeof h=="number")h<0?(g=o(h).slice(3),m="-"):(g=o(h).slice(2),m=""),g=m+g.slice(0,-1)+n[g.slice(-1)];else{if(xn(h)!=="object")throw new Error("Don't know what to do with value type "+xn(h)+".");g=s(h)}x.push(p+g)}return x.push("}"),x.join("")},l=e.__fontmetrics__.uncompress=function(f){if(typeof f!="string")throw new Error("Invalid argument passed to uncompress.");for(var h,p,g,m,x={},b=1,_=x,w=[],A="",O="",T=f.length-1,E=1;E<T;E+=1)(m=f[E])=="'"?h?(g=h.join(""),h=void 0):h=[]:h?h.push(m):m=="{"?(w.push([_,g]),_={},g=void 0):m=="}"?((p=w.pop())[0][p[1]]=_,g=void 0,_=p[0]):m=="-"?b=-1:g===void 0?r.hasOwnProperty(m)?(A+=r[m],g=parseInt(A,16)*b,b=1,A=""):A+=m:r.hasOwnProperty(m)?(O+=r[m],_[g]=parseInt(O,16)*b,b=1,g=void 0,O=""):O+=m;return x},c={codePages:["WinAnsiEncoding"],WinAnsiEncoding:l("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},u={Unicode:{Courier:c,"Courier-Bold":c,"Courier-BoldOblique":c,"Courier-Oblique":c,Helvetica:c,"Helvetica-Bold":c,"Helvetica-BoldOblique":c,"Helvetica-Oblique":c,"Times-Roman":c,"Times-Bold":c,"Times-BoldItalic":c,"Times-Italic":c}},d={Unicode:{"Courier-Oblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":l("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":l("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:l("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:l("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":l("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":l("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(f){var h=f.font,p=d.Unicode[h.postScriptName];p&&(h.metadata.Unicode={},h.metadata.Unicode.widths=p.widths,h.metadata.Unicode.kerning=p.kerning);var g=u.Unicode[h.postScriptName];g&&(h.metadata.Unicode.encoding=g,h.encoding=g.codePages[0])}])}(Sr.API),function(e){var t=function(r){for(var n=r.length,a=new Uint8Array(n),o=0;o<n;o++)a[o]=r.charCodeAt(o);return a};e.API.events.push(["addFont",function(r){var n=void 0,a=r.font,o=r.instance;if(!a.isStandardFont){if(o===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");if(typeof(n=o.existsFileInVFS(a.postScriptName)===!1?o.loadFile(a.postScriptName):o.getFileFromVFS(a.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");(function(s,l){l=/^\x00\x01\x00\x00/.test(l)?t(l):t(Rh(l)),s.metadata=e.API.TTFFont.open(l),s.metadata.Unicode=s.metadata.Unicode||{encoding:{},kerning:{},widths:[]},s.metadata.glyIdsUsed=[0]})(a,n)}}])}(Sr),function(e){function t(){return(kr.canvg?Promise.resolve(kr.canvg):Cw(()=>import("./index.es-CRvpoM4X.js"),__vite__mapDeps([0,1,2]))).catch(function(r){return Promise.reject(new Error("Could not load canvg: "+r))}).then(function(r){return r.default?r.default:r})}Sr.API.addSvgAsImage=function(r,n,a,o,s,l,c,u){if(isNaN(n)||isNaN(a))throw Tn.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(o)||isNaN(s))throw Tn.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var d=document.createElement("canvas");d.width=o,d.height=s;var f=d.getContext("2d");f.fillStyle="#fff",f.fillRect(0,0,d.width,d.height);var h={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},p=this;return t().then(function(g){return g.fromString(f,r,h)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(g){return g.render(h)}).then(function(){p.addImage(d.toDataURL("image/jpeg",1),n,a,o,s,c,u)})}}(),Sr.API.putTotalPages=function(e){var t,r=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),r=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),r=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var a=0;a<this.internal.pages[n].length;a++)this.internal.pages[n][a]=this.internal.pages[n][a].replace(t,r);return this},Sr.API.viewerPreferences=function(e,t){var r;e=e||{},t=t||!1;var n,a,o,s={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},l=Object.keys(s),c=[],u=0,d=0,f=0;function h(g,m){var x,b=!1;for(x=0;x<g.length;x+=1)g[x]===m&&(b=!0);return b}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(s)),this.internal.viewerpreferences.isSubscribed=!1),r=this.internal.viewerpreferences.configuration,e==="reset"||t===!0){var p=l.length;for(f=0;f<p;f+=1)r[l[f]].value=r[l[f]].defaultValue,r[l[f]].explicitSet=!1}if(xn(e)==="object"){for(a in e)if(o=e[a],h(l,a)&&o!==void 0){if(r[a].type==="boolean"&&typeof o=="boolean")r[a].value=o;else if(r[a].type==="name"&&h(r[a].valueSet,o))r[a].value=o;else if(r[a].type==="integer"&&Number.isInteger(o))r[a].value=o;else if(r[a].type==="array"){for(u=0;u<o.length;u+=1)if(n=!0,o[u].length===1&&typeof o[u][0]=="number")c.push(String(o[u]-1));else if(o[u].length>1){for(d=0;d<o[u].length;d+=1)typeof o[u][d]!="number"&&(n=!1);n===!0&&c.push([o[u][0]-1,o[u][1]-1].join(" "))}r[a].value="["+c.join(" ")+"]"}else r[a].value=r[a].defaultValue;r[a].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var g,m=[];for(g in r)r[g].explicitSet===!0&&(r[g].type==="name"?m.push("/"+g+" /"+r[g].value):m.push("/"+g+" "+r[g].value));m.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+m.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=r,this},function(e){var t=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',a=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),o=unescape(encodeURIComponent(n)),s=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),l=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),c=unescape(encodeURIComponent("</x:xmpmeta>")),u=o.length+s.length+l.length+a.length+c.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+u+" >>"),this.internal.write("stream"),this.internal.write(a+o+s+l+c),this.internal.write("endstream"),this.internal.write("endobj")},r=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};e.addMetadata=function(n,a){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:a||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",r),this.internal.events.subscribe("postPutResources",t)),this}}(Sr.API),function(e){var t=e.API,r=t.pdfEscape16=function(o,s){for(var l,c=s.metadata.Unicode.widths,u=["","0","00","000","0000"],d=[""],f=0,h=o.length;f<h;++f){if(l=s.metadata.characterToGlyph(o.charCodeAt(f)),s.metadata.glyIdsUsed.push(l),s.metadata.toUnicode[l]=o.charCodeAt(f),c.indexOf(l)==-1&&(c.push(l),c.push([parseInt(s.metadata.widthOfGlyph(l),10)])),l=="0")return d.join("");l=l.toString(16),d.push(u[4-l.length],l)}return d.join("")},n=function(o){var s,l,c,u,d,f,h;for(d=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,c=[],f=0,h=(l=Object.keys(o).sort(function(p,g){return p-g})).length;f<h;f++)s=l[f],c.length>=100&&(d+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar`,c=[]),o[s]!==void 0&&o[s]!==null&&typeof o[s].toString=="function"&&(u=("0000"+o[s].toString(16)).slice(-4),s=("0000"+(+s).toString(16)).slice(-4),c.push("<"+s+"><"+u+">"));return c.length&&(d+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar
`),d+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(o){(function(s){var l=s.font,c=s.out,u=s.newObject,d=s.putStream;if(l.metadata instanceof e.API.TTFFont&&l.encoding==="Identity-H"){for(var f=l.metadata.Unicode.widths,h=l.metadata.subset.encode(l.metadata.glyIdsUsed,1),p="",g=0;g<h.length;g++)p+=String.fromCharCode(h[g]);var m=u();d({data:p,addLength1:!0,objectId:m}),c("endobj");var x=u();d({data:n(l.metadata.toUnicode),addLength1:!0,objectId:x}),c("endobj");var b=u();c("<<"),c("/Type /FontDescriptor"),c("/FontName /"+Tu(l.fontName)),c("/FontFile2 "+m+" 0 R"),c("/FontBBox "+e.API.PDFObject.convert(l.metadata.bbox)),c("/Flags "+l.metadata.flags),c("/StemV "+l.metadata.stemV),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c(">>"),c("endobj");var _=u();c("<<"),c("/Type /Font"),c("/BaseFont /"+Tu(l.fontName)),c("/FontDescriptor "+b+" 0 R"),c("/W "+e.API.PDFObject.convert(f)),c("/CIDToGIDMap /Identity"),c("/DW 1000"),c("/Subtype /CIDFontType2"),c("/CIDSystemInfo"),c("<<"),c("/Supplement 0"),c("/Registry (Adobe)"),c("/Ordering ("+l.encoding+")"),c(">>"),c(">>"),c("endobj"),l.objectNumber=u(),c("<<"),c("/Type /Font"),c("/Subtype /Type0"),c("/ToUnicode "+x+" 0 R"),c("/BaseFont /"+Tu(l.fontName)),c("/Encoding /"+l.encoding),c("/DescendantFonts ["+_+" 0 R]"),c(">>"),c("endobj"),l.isAlreadyPutted=!0}})(o)}]),t.events.push(["putFont",function(o){(function(s){var l=s.font,c=s.out,u=s.newObject,d=s.putStream;if(l.metadata instanceof e.API.TTFFont&&l.encoding==="WinAnsiEncoding"){for(var f=l.metadata.rawData,h="",p=0;p<f.length;p++)h+=String.fromCharCode(f[p]);var g=u();d({data:h,addLength1:!0,objectId:g}),c("endobj");var m=u();d({data:n(l.metadata.toUnicode),addLength1:!0,objectId:m}),c("endobj");var x=u();c("<<"),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c("/StemV "+l.metadata.stemV),c("/Type /FontDescriptor"),c("/FontFile2 "+g+" 0 R"),c("/Flags 96"),c("/FontBBox "+e.API.PDFObject.convert(l.metadata.bbox)),c("/FontName /"+Tu(l.fontName)),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c(">>"),c("endobj"),l.objectNumber=u();for(var b=0;b<l.metadata.hmtx.widths.length;b++)l.metadata.hmtx.widths[b]=parseInt(l.metadata.hmtx.widths[b]*(1e3/l.metadata.head.unitsPerEm));c("<</Subtype/TrueType/Type/Font/ToUnicode "+m+" 0 R/BaseFont/"+Tu(l.fontName)+"/FontDescriptor "+x+" 0 R/Encoding/"+l.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(l.metadata.hmtx.widths)+">>"),c("endobj"),l.isAlreadyPutted=!0}})(o)}]);var a=function(o){var s,l=o.text||"",c=o.x,u=o.y,d=o.options||{},f=o.mutex||{},h=f.pdfEscape,p=f.activeFontKey,g=f.fonts,m=p,x="",b=0,_="",w=g[m].encoding;if(g[m].encoding!=="Identity-H")return{text:l,x:c,y:u,options:d,mutex:f};for(_=l,m=p,Array.isArray(l)&&(_=l[0]),b=0;b<_.length;b+=1)g[m].metadata.hasOwnProperty("cmap")&&(s=g[m].metadata.cmap.unicode.codeMap[_[b].charCodeAt(0)]),s||_[b].charCodeAt(0)<256&&g[m].metadata.hasOwnProperty("Unicode")?x+=_[b]:x+="";var A="";return parseInt(m.slice(1))<14||w==="WinAnsiEncoding"?A=h(x,m).split("").map(function(O){return O.charCodeAt(0).toString(16)}).join(""):w==="Identity-H"&&(A=r(x,g[m])),f.isHex=!0,{text:A,x:c,y:u,options:d,mutex:f}};t.events.push(["postProcessText",function(o){var s=o.text||"",l=[],c={text:s,x:o.x,y:o.y,options:o.options,mutex:o.mutex};if(Array.isArray(s)){var u=0;for(u=0;u<s.length;u+=1)Array.isArray(s[u])&&s[u].length===3?l.push([a(Object.assign({},c,{text:s[u][0]})).text,s[u][1],s[u][2]]):l.push(a(Object.assign({},c,{text:s[u]})).text);o.text=l}else o.text=a(Object.assign({},c,{text:s})).text}])}(Sr),function(e){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0},e.addFileToVFS=function(r,n){return t.call(this),this.internal.vFS[r]=n,this},e.getFileFromVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0?this.internal.vFS[r]:null}}(Sr.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(n){var a,o,s,l,c,u,d,f=t,h=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],p=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],g={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},m={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},x=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],b=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),_=!1,w=0;this.__bidiEngine__={};var A=function(k){var M=k.charCodeAt(),R=M>>8,F=m[R];return F!==void 0?f[256*F+(255&M)]:R===252||R===253?"AL":b.test(R)?"L":R===8?"R":"N"},O=function(k){for(var M,R=0;R<k.length;R++){if((M=A(k.charAt(R)))==="L")return!1;if(M==="R")return!0}return!1},T=function(k,M,R,F){var W,K,Z,D,P=M[F];switch(P){case"L":case"R":_=!1;break;case"N":case"AN":break;case"EN":_&&(P="AN");break;case"AL":_=!0,P="R";break;case"WS":P="N";break;case"CS":F<1||F+1>=M.length||(W=R[F-1])!=="EN"&&W!=="AN"||(K=M[F+1])!=="EN"&&K!=="AN"?P="N":_&&(K="AN"),P=K===W?K:"N";break;case"ES":P=(W=F>0?R[F-1]:"B")==="EN"&&F+1<M.length&&M[F+1]==="EN"?"EN":"N";break;case"ET":if(F>0&&R[F-1]==="EN"){P="EN";break}if(_){P="N";break}for(Z=F+1,D=M.length;Z<D&&M[Z]==="ET";)Z++;P=Z<D&&M[Z]==="EN"?"EN":"N";break;case"NSM":if(s&&!l){for(D=M.length,Z=F+1;Z<D&&M[Z]==="NSM";)Z++;if(Z<D){var $=k[F],Q=$>=1425&&$<=2303||$===64286;if(W=M[Z],Q&&(W==="R"||W==="AL")){P="R";break}}}P=F<1||(W=M[F-1])==="B"?"N":R[F-1];break;case"B":_=!1,a=!0,P=w;break;case"S":o=!0,P="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":_=!1;break;case"BN":P="N"}return P},E=function(k,M,R){var F=k.split("");return R&&S(F,R,{hiLevel:w}),F.reverse(),M&&M.reverse(),F.join("")},S=function(k,M,R){var F,W,K,Z,D,P=-1,$=k.length,Q=0,C=[],L=w?p:h,H=[];for(_=!1,a=!1,o=!1,W=0;W<$;W++)H[W]=A(k[W]);for(K=0;K<$;K++){if(D=Q,C[K]=T(k,H,C,K),F=240&(Q=L[D][g[C[K]]]),Q&=15,M[K]=Z=L[Q][5],F>0)if(F===16){for(W=P;W<K;W++)M[W]=1;P=-1}else P=-1;if(L[Q][6])P===-1&&(P=K);else if(P>-1){for(W=P;W<K;W++)M[W]=Z;P=-1}H[K]==="B"&&(M[K]=0),R.hiLevel|=Z}o&&function(U,te,le){for(var oe=0;oe<le;oe++)if(U[oe]==="S"){te[oe]=w;for(var ae=oe-1;ae>=0&&U[ae]==="WS";ae--)te[ae]=w}}(H,M,$)},I=function(k,M,R,F,W){if(!(W.hiLevel<k)){if(k===1&&w===1&&!a)return M.reverse(),void(R&&R.reverse());for(var K,Z,D,P,$=M.length,Q=0;Q<$;){if(F[Q]>=k){for(D=Q+1;D<$&&F[D]>=k;)D++;for(P=Q,Z=D-1;P<Z;P++,Z--)K=M[P],M[P]=M[Z],M[Z]=K,R&&(K=R[P],R[P]=R[Z],R[Z]=K);Q=D}Q++}}},z=function(k,M,R){var F=k.split(""),W={hiLevel:w};return R||(R=[]),S(F,R,W),function(K,Z,D){if(D.hiLevel!==0&&d)for(var P,$=0;$<K.length;$++)Z[$]===1&&(P=x.indexOf(K[$]))>=0&&(K[$]=x[P+1])}(F,R,W),I(2,F,M,R,W),I(1,F,M,R,W),F.join("")};return this.__bidiEngine__.doBidiReorder=function(k,M,R){if(function(W,K){if(K)for(var Z=0;Z<W.length;Z++)K[Z]=Z;l===void 0&&(l=O(W)),u===void 0&&(u=O(W))}(k,M),s||!c||u)if(s&&c&&l^u)w=l?1:0,k=E(k,M,R);else if(!s&&c&&u)w=l?1:0,k=z(k,M,R),k=E(k,M);else if(!s||l||c||u){if(s&&!c&&l^u)k=E(k,M),l?(w=0,k=z(k,M,R)):(w=1,k=z(k,M,R),k=E(k,M));else if(s&&l&&!c&&u)w=1,k=z(k,M,R),k=E(k,M);else if(!s&&!c&&l^u){var F=d;l?(w=1,k=z(k,M,R),w=0,d=!1,k=z(k,M,R),d=F):(w=0,k=z(k,M,R),k=E(k,M),w=1,d=!1,k=z(k,M,R),d=F,k=E(k,M))}}else w=0,k=z(k,M,R);else w=l?1:0,k=z(k,M,R);return k},this.__bidiEngine__.setOptions=function(k){k&&(s=k.isInputVisual,c=k.isOutputVisual,l=k.isInputRtl,u=k.isOutputRtl,d=k.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],r=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(n){var a=n.text;n.x,n.y;var o=n.options||{};n.mutex,o.lang;var s=[];if(o.isInputVisual=typeof o.isInputVisual!="boolean"||o.isInputVisual,r.setOptions(o),Object.prototype.toString.call(a)==="[object Array]"){var l=0;for(s=[],l=0;l<a.length;l+=1)Object.prototype.toString.call(a[l])==="[object Array]"?s.push([r.doBidiReorder(a[l][0]),a[l][1],a[l][2]]):s.push([r.doBidiReorder(a[l])]);n.text=s}else n.text=r.doBidiReorder(a);r.setOptions({isInputVisual:!0})}])}(Sr),Sr.API.TTFFont=function(){function e(t){var r;if(this.rawData=t,r=this.contents=new nc(t),this.contents.pos=4,r.readString(4)==="ttcf")throw new Error("TTCF not supported.");r.pos=0,this.parse(),this.subset=new Ace(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new fce(this.contents),this.head=new pce(this),this.name=new xce(this),this.cmap=new U6(this),this.toUnicode={},this.hhea=new mce(this),this.maxp=new bce(this),this.hmtx=new _ce(this),this.post=new vce(this),this.os2=new gce(this),this.loca=new Cce(this),this.glyf=new wce(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var t,r,n,a,o;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var s,l,c,u;for(u=[],s=0,l=(c=this.bbox).length;s<l;s++)t=c[s],u.push(Math.round(t*this.scaleFactor));return u}).call(this),this.stemV=0,this.post.exists?(n=255&(a=this.post.italic_angle),(32768&(r=a>>16))!=0&&(r=-(1+(65535^r))),this.italicAngle=+(r+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(o=this.familyClass)===1||o===2||o===3||o===4||o===5||o===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(t){var r;return((r=this.cmap.unicode)!=null?r.codeMap[t]:void 0)||0},e.prototype.widthOfGlyph=function(t){var r;return r=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*r},e.prototype.widthOfString=function(t,r,n){var a,o,s,l;for(s=0,o=0,l=(t=""+t).length;0<=l?o<l:o>l;o=0<=l?++o:--o)a=t.charCodeAt(o),s+=this.widthOfGlyph(this.characterToGlyph(a))+n*(1e3/r)||0;return s*(r/1e3)},e.prototype.lineHeight=function(t,r){var n;return r==null&&(r=!1),n=r?this.lineGap:0,(this.ascender+n-this.decender)/1e3*t},e}();var ds,nc=function(){function e(t){this.data=t??[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(t){return this.data[this.pos++]=t},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},e.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},e.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},e.prototype.readString=function(t){var r,n;for(n=[],r=0;0<=t?r<t:r>t;r=0<=t?++r:--r)n[r]=String.fromCharCode(this.readByte());return n.join("")},e.prototype.writeString=function(t){var r,n,a;for(a=[],r=0,n=t.length;0<=n?r<n:r>n;r=0<=n?++r:--r)a.push(this.writeByte(t.charCodeAt(r)));return a},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(t){return this.writeInt16(t)},e.prototype.readLongLong=function(){var t,r,n,a,o,s,l,c;return t=this.readByte(),r=this.readByte(),n=this.readByte(),a=this.readByte(),o=this.readByte(),s=this.readByte(),l=this.readByte(),c=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^r)+1099511627776*(255^n)+4294967296*(255^a)+16777216*(255^o)+65536*(255^s)+256*(255^l)+(255^c)+1):72057594037927940*t+281474976710656*r+1099511627776*n+4294967296*a+16777216*o+65536*s+256*l+c},e.prototype.writeLongLong=function(t){var r,n;return r=Math.floor(t/4294967296),n=4294967295&t,this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(t){return this.writeInt32(t)},e.prototype.read=function(t){var r,n;for(r=[],n=0;0<=t?n<t:n>t;n=0<=t?++n:--n)r.push(this.readByte());return r},e.prototype.write=function(t){var r,n,a,o;for(o=[],n=0,a=t.length;n<a;n++)r=t[n],o.push(this.writeByte(r));return o},e}(),fce=function(){var e;function t(r){var n,a,o;for(this.scalarType=r.readInt(),this.tableCount=r.readShort(),this.searchRange=r.readShort(),this.entrySelector=r.readShort(),this.rangeShift=r.readShort(),this.tables={},a=0,o=this.tableCount;0<=o?a<o:a>o;a=0<=o?++a:--a)n={tag:r.readString(4),checksum:r.readInt(),offset:r.readInt(),length:r.readInt()},this.tables[n.tag]=n}return t.prototype.encode=function(r){var n,a,o,s,l,c,u,d,f,h,p,g,m;for(m in p=Object.keys(r).length,c=Math.log(2),f=16*Math.floor(Math.log(p)/c),s=Math.floor(f/c),d=16*p-f,(a=new nc).writeInt(this.scalarType),a.writeShort(p),a.writeShort(f),a.writeShort(s),a.writeShort(d),o=16*p,u=a.pos+o,l=null,g=[],r)for(h=r[m],a.writeString(m),a.writeInt(e(h)),a.writeInt(u),a.writeInt(h.length),g=g.concat(h),m==="head"&&(l=u),u+=h.length;u%4;)g.push(0),u++;return a.write(g),n=2981146554-e(a.data),a.pos=l+8,a.writeUInt32(n),a.data},e=function(r){var n,a,o,s;for(r=z6.call(r);r.length%4;)r.push(0);for(o=new nc(r),a=0,n=0,s=r.length;n<s;n=n+=4)a+=o.readUInt32();return 4294967295&a},t}(),hce={}.hasOwnProperty,qs=function(e,t){for(var r in t)hce.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};ds=function(){function e(t){var r;this.file=t,r=this.file.directory.tables[this.tag],this.exists=!!r,r&&(this.offset=r.offset,this.length=r.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var pce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="head",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.revision=r.readInt(),this.checkSumAdjustment=r.readInt(),this.magicNumber=r.readInt(),this.flags=r.readShort(),this.unitsPerEm=r.readShort(),this.created=r.readLongLong(),this.modified=r.readLongLong(),this.xMin=r.readShort(),this.yMin=r.readShort(),this.xMax=r.readShort(),this.yMax=r.readShort(),this.macStyle=r.readShort(),this.lowestRecPPEM=r.readShort(),this.fontDirectionHint=r.readShort(),this.indexToLocFormat=r.readShort(),this.glyphDataFormat=r.readShort()},t.prototype.encode=function(r){var n;return(n=new nc).writeInt(this.version),n.writeInt(this.revision),n.writeInt(this.checkSumAdjustment),n.writeInt(this.magicNumber),n.writeShort(this.flags),n.writeShort(this.unitsPerEm),n.writeLongLong(this.created),n.writeLongLong(this.modified),n.writeShort(this.xMin),n.writeShort(this.yMin),n.writeShort(this.xMax),n.writeShort(this.yMax),n.writeShort(this.macStyle),n.writeShort(this.lowestRecPPEM),n.writeShort(this.fontDirectionHint),n.writeShort(r),n.writeShort(this.glyphDataFormat),n.data},t}(),o4=function(){function e(t,r){var n,a,o,s,l,c,u,d,f,h,p,g,m,x,b,_,w;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=r+t.readInt(),f=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(c=0;c<256;++c)this.codeMap[c]=t.readByte();break;case 4:for(p=t.readUInt16(),h=p/2,t.pos+=6,o=function(){var A,O;for(O=[],c=A=0;0<=h?A<h:A>h;c=0<=h?++A:--A)O.push(t.readUInt16());return O}(),t.pos+=2,m=function(){var A,O;for(O=[],c=A=0;0<=h?A<h:A>h;c=0<=h?++A:--A)O.push(t.readUInt16());return O}(),u=function(){var A,O;for(O=[],c=A=0;0<=h?A<h:A>h;c=0<=h?++A:--A)O.push(t.readUInt16());return O}(),d=function(){var A,O;for(O=[],c=A=0;0<=h?A<h:A>h;c=0<=h?++A:--A)O.push(t.readUInt16());return O}(),a=(this.length-t.pos+this.offset)/2,l=function(){var A,O;for(O=[],c=A=0;0<=a?A<a:A>a;c=0<=a?++A:--A)O.push(t.readUInt16());return O}(),c=b=0,w=o.length;b<w;c=++b)for(x=o[c],n=_=g=m[c];g<=x?_<=x:_>=x;n=g<=x?++_:--_)d[c]===0?s=n+u[c]:(s=l[d[c]/2+(n-g)-(h-c)]||0)!==0&&(s+=u[c]),this.codeMap[n]=65535&s}t.pos=f}return e.encode=function(t,r){var n,a,o,s,l,c,u,d,f,h,p,g,m,x,b,_,w,A,O,T,E,S,I,z,k,M,R,F,W,K,Z,D,P,$,Q,C,L,H,U,te,le,oe,ae,he,me,X;switch(F=new nc,s=Object.keys(t).sort(function(G,ee){return G-ee}),r){case"macroman":for(m=0,x=function(){var G=[];for(g=0;g<256;++g)G.push(0);return G}(),_={0:0},o={},W=0,P=s.length;W<P;W++)_[ae=t[a=s[W]]]==null&&(_[ae]=++m),o[a]={old:t[a],new:_[t[a]]},x[a]=_[t[a]];return F.writeUInt16(1),F.writeUInt16(0),F.writeUInt32(12),F.writeUInt16(0),F.writeUInt16(262),F.writeUInt16(0),F.write(x),{charMap:o,subtable:F.data,maxGlyphID:m+1};case"unicode":for(M=[],f=[],w=0,_={},n={},b=u=null,K=0,$=s.length;K<$;K++)_[O=t[a=s[K]]]==null&&(_[O]=++w),n[a]={old:O,new:_[O]},l=_[O]-a,b!=null&&l===u||(b&&f.push(b),M.push(a),u=l),b=a;for(b&&f.push(b),f.push(65535),M.push(65535),z=2*(I=M.length),S=2*Math.pow(Math.log(I)/Math.LN2,2),h=Math.log(S/2)/Math.LN2,E=2*I-S,c=[],T=[],p=[],g=Z=0,Q=M.length;Z<Q;g=++Z){if(k=M[g],d=f[g],k===65535){c.push(0),T.push(0);break}if(k-(R=n[k].new)>=32768)for(c.push(0),T.push(2*(p.length+I-g)),a=D=k;k<=d?D<=d:D>=d;a=k<=d?++D:--D)p.push(n[a].new);else c.push(R-k),T.push(0)}for(F.writeUInt16(3),F.writeUInt16(1),F.writeUInt32(12),F.writeUInt16(4),F.writeUInt16(16+8*I+2*p.length),F.writeUInt16(0),F.writeUInt16(z),F.writeUInt16(S),F.writeUInt16(h),F.writeUInt16(E),le=0,C=f.length;le<C;le++)a=f[le],F.writeUInt16(a);for(F.writeUInt16(0),oe=0,L=M.length;oe<L;oe++)a=M[oe],F.writeUInt16(a);for(he=0,H=c.length;he<H;he++)l=c[he],F.writeUInt16(l);for(me=0,U=T.length;me<U;me++)A=T[me],F.writeUInt16(A);for(X=0,te=p.length;X<te;X++)m=p[X],F.writeUInt16(m);return{charMap:n,subtable:F.data,maxGlyphID:w+1}}},e}(),U6=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="cmap",t.prototype.parse=function(r){var n,a,o;for(r.pos=this.offset,this.version=r.readUInt16(),o=r.readUInt16(),this.tables=[],this.unicode=null,a=0;0<=o?a<o:a>o;a=0<=o?++a:--a)n=new o4(r,this.offset),this.tables.push(n),n.isUnicode&&this.unicode==null&&(this.unicode=n);return!0},t.encode=function(r,n){var a,o;return n==null&&(n="macroman"),a=o4.encode(r,n),(o=new nc).writeUInt16(0),o.writeUInt16(1),a.table=o.data.concat(a.subtable),a},t}(),mce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="hhea",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.ascender=r.readShort(),this.decender=r.readShort(),this.lineGap=r.readShort(),this.advanceWidthMax=r.readShort(),this.minLeftSideBearing=r.readShort(),this.minRightSideBearing=r.readShort(),this.xMaxExtent=r.readShort(),this.caretSlopeRise=r.readShort(),this.caretSlopeRun=r.readShort(),this.caretOffset=r.readShort(),r.pos+=8,this.metricDataFormat=r.readShort(),this.numberOfMetrics=r.readUInt16()},t}(),gce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="OS/2",t.prototype.parse=function(r){if(r.pos=this.offset,this.version=r.readUInt16(),this.averageCharWidth=r.readShort(),this.weightClass=r.readUInt16(),this.widthClass=r.readUInt16(),this.type=r.readShort(),this.ySubscriptXSize=r.readShort(),this.ySubscriptYSize=r.readShort(),this.ySubscriptXOffset=r.readShort(),this.ySubscriptYOffset=r.readShort(),this.ySuperscriptXSize=r.readShort(),this.ySuperscriptYSize=r.readShort(),this.ySuperscriptXOffset=r.readShort(),this.ySuperscriptYOffset=r.readShort(),this.yStrikeoutSize=r.readShort(),this.yStrikeoutPosition=r.readShort(),this.familyClass=r.readShort(),this.panose=function(){var n,a;for(a=[],n=0;n<10;++n)a.push(r.readByte());return a}(),this.charRange=function(){var n,a;for(a=[],n=0;n<4;++n)a.push(r.readInt());return a}(),this.vendorID=r.readString(4),this.selection=r.readShort(),this.firstCharIndex=r.readShort(),this.lastCharIndex=r.readShort(),this.version>0&&(this.ascent=r.readShort(),this.descent=r.readShort(),this.lineGap=r.readShort(),this.winAscent=r.readShort(),this.winDescent=r.readShort(),this.codePageRange=function(){var n,a;for(a=[],n=0;n<2;n=++n)a.push(r.readInt());return a}(),this.version>1))return this.xHeight=r.readShort(),this.capHeight=r.readShort(),this.defaultChar=r.readShort(),this.breakChar=r.readShort(),this.maxContext=r.readShort()},t}(),vce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="post",t.prototype.parse=function(r){var n,a,o;switch(r.pos=this.offset,this.format=r.readInt(),this.italicAngle=r.readInt(),this.underlinePosition=r.readShort(),this.underlineThickness=r.readShort(),this.isFixedPitch=r.readInt(),this.minMemType42=r.readInt(),this.maxMemType42=r.readInt(),this.minMemType1=r.readInt(),this.maxMemType1=r.readInt(),this.format){case 65536:break;case 131072:var s;for(a=r.readUInt16(),this.glyphNameIndex=[],s=0;0<=a?s<a:s>a;s=0<=a?++s:--s)this.glyphNameIndex.push(r.readUInt16());for(this.names=[],o=[];r.pos<this.offset+this.length;)n=r.readByte(),o.push(this.names.push(r.readString(n)));return o;case 151552:return a=r.readUInt16(),this.offsets=r.read(a);case 196608:break;case 262144:return this.map=(function(){var l,c,u;for(u=[],s=l=0,c=this.file.maxp.numGlyphs;0<=c?l<c:l>c;s=0<=c?++l:--l)u.push(r.readUInt32());return u}).call(this)}},t}(),yce=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},xce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="name",t.prototype.parse=function(r){var n,a,o,s,l,c,u,d,f,h,p;for(r.pos=this.offset,r.readShort(),n=r.readShort(),c=r.readShort(),a=[],s=0;0<=n?s<n:s>n;s=0<=n?++s:--s)a.push({platformID:r.readShort(),encodingID:r.readShort(),languageID:r.readShort(),nameID:r.readShort(),length:r.readShort(),offset:this.offset+c+r.readShort()});for(u={},s=f=0,h=a.length;f<h;s=++f)o=a[s],r.pos=o.offset,d=r.readString(o.length),l=new yce(d,o),u[p=o.nameID]==null&&(u[p]=[]),u[o.nameID].push(l);this.strings=u,this.copyright=u[0],this.fontFamily=u[1],this.fontSubfamily=u[2],this.uniqueSubfamily=u[3],this.fontName=u[4],this.version=u[5];try{this.postscriptName=u[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=u[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=u[7],this.manufacturer=u[8],this.designer=u[9],this.description=u[10],this.vendorUrl=u[11],this.designerUrl=u[12],this.license=u[13],this.licenseUrl=u[14],this.preferredFamily=u[15],this.preferredSubfamily=u[17],this.compatibleFull=u[18],this.sampleText=u[19]},t}(),bce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="maxp",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.numGlyphs=r.readUInt16(),this.maxPoints=r.readUInt16(),this.maxContours=r.readUInt16(),this.maxCompositePoints=r.readUInt16(),this.maxComponentContours=r.readUInt16(),this.maxZones=r.readUInt16(),this.maxTwilightPoints=r.readUInt16(),this.maxStorage=r.readUInt16(),this.maxFunctionDefs=r.readUInt16(),this.maxInstructionDefs=r.readUInt16(),this.maxStackElements=r.readUInt16(),this.maxSizeOfInstructions=r.readUInt16(),this.maxComponentElements=r.readUInt16(),this.maxComponentDepth=r.readUInt16()},t}(),_ce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="hmtx",t.prototype.parse=function(r){var n,a,o,s,l,c,u;for(r.pos=this.offset,this.metrics=[],n=0,c=this.file.hhea.numberOfMetrics;0<=c?n<c:n>c;n=0<=c?++n:--n)this.metrics.push({advance:r.readUInt16(),lsb:r.readInt16()});for(o=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var d,f;for(f=[],n=d=0;0<=o?d<o:d>o;n=0<=o?++d:--d)f.push(r.readInt16());return f}(),this.widths=(function(){var d,f,h,p;for(p=[],d=0,f=(h=this.metrics).length;d<f;d++)s=h[d],p.push(s.advance);return p}).call(this),a=this.widths[this.widths.length-1],u=[],n=l=0;0<=o?l<o:l>o;n=0<=o?++l:--l)u.push(this.widths.push(a));return u},t.prototype.forGlyph=function(r){return r in this.metrics?this.metrics[r]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[r-this.metrics.length]}},t}(),z6=[].slice,wce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(r){var n,a,o,s,l,c,u,d,f,h;return r in this.cache?this.cache[r]:(s=this.file.loca,n=this.file.contents,a=s.indexOf(r),(o=s.lengthOf(r))===0?this.cache[r]=null:(n.pos=this.offset+a,l=(c=new nc(n.read(o))).readShort(),d=c.readShort(),h=c.readShort(),u=c.readShort(),f=c.readShort(),this.cache[r]=l===-1?new Sce(c,d,h,u,f):new jce(c,l,d,h,u,f),this.cache[r]))},t.prototype.encode=function(r,n,a){var o,s,l,c,u;for(l=[],s=[],c=0,u=n.length;c<u;c++)o=r[n[c]],s.push(l.length),o&&(l=l.concat(o.encode(a)));return s.push(l.length),{table:l,offsets:s}},t}(),jce=function(){function e(t,r,n,a,o,s){this.raw=t,this.numberOfContours=r,this.xMin=n,this.yMin=a,this.xMax=o,this.yMax=s,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),Sce=function(){function e(t,r,n,a,o){var s,l;for(this.raw=t,this.xMin=r,this.yMin=n,this.xMax=a,this.yMax=o,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],s=this.raw;l=s.readShort(),this.glyphOffsets.push(s.pos),this.glyphIDs.push(s.readUInt16()),32&l;)s.pos+=1&l?4:2,128&l?s.pos+=8:64&l?s.pos+=4:8&l&&(s.pos+=2)}return e.prototype.encode=function(){var t,r,n;for(r=new nc(z6.call(this.raw.data)),t=0,n=this.glyphIDs.length;t<n;++t)r.pos=this.glyphOffsets[t];return r.data},e}(),Cce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="loca",t.prototype.parse=function(r){var n,a;return r.pos=this.offset,n=this.file.head.indexToLocFormat,this.offsets=n===0?(function(){var o,s;for(s=[],a=0,o=this.length;a<o;a+=2)s.push(2*r.readUInt16());return s}).call(this):(function(){var o,s;for(s=[],a=0,o=this.length;a<o;a+=4)s.push(r.readUInt32());return s}).call(this)},t.prototype.indexOf=function(r){return this.offsets[r]},t.prototype.lengthOf=function(r){return this.offsets[r+1]-this.offsets[r]},t.prototype.encode=function(r,n){for(var a=new Uint32Array(this.offsets.length),o=0,s=0,l=0;l<a.length;++l)if(a[l]=o,s<n.length&&n[s]==l){++s,a[l]=o;var c=this.offsets[l],u=this.offsets[l+1]-c;u>0&&(o+=u)}for(var d=new Array(4*a.length),f=0;f<a.length;++f)d[4*f+3]=255&a[f],d[4*f+2]=(65280&a[f])>>8,d[4*f+1]=(16711680&a[f])>>16,d[4*f]=(4278190080&a[f])>>24;return d},t}(),Ace=function(){function e(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var t,r,n,a,o;for(r in a=this.font.cmap.tables[0].codeMap,t={},o=this.subset)n=o[r],t[r]=a[n];return t},e.prototype.glyphsFor=function(t){var r,n,a,o,s,l,c;for(a={},s=0,l=t.length;s<l;s++)a[o=t[s]]=this.font.glyf.glyphFor(o);for(o in r=[],a)(n=a[o])!=null&&n.compound&&r.push.apply(r,n.glyphIDs);if(r.length>0)for(o in c=this.glyphsFor(r))n=c[o],a[o]=n;return a},e.prototype.encode=function(t,r){var n,a,o,s,l,c,u,d,f,h,p,g,m,x,b;for(a in n=U6.encode(this.generateCmap(),"unicode"),s=this.glyphsFor(t),p={0:0},b=n.charMap)p[(c=b[a]).old]=c.new;for(g in h=n.maxGlyphID,s)g in p||(p[g]=h++);return d=function(_){var w,A;for(w in A={},_)A[_[w]]=w;return A}(p),f=Object.keys(d).sort(function(_,w){return _-w}),m=function(){var _,w,A;for(A=[],_=0,w=f.length;_<w;_++)l=f[_],A.push(d[l]);return A}(),o=this.font.glyf.encode(s,m,p),u=this.font.loca.encode(o.offsets,m),x={cmap:this.font.cmap.raw(),glyf:o.table,loca:u,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(r)},this.font.os2.exists&&(x["OS/2"]=this.font.os2.raw()),this.font.directory.encode(x)},e}();Sr.API.PDFObject=function(){var e;function t(){}return e=function(r,n){return(Array(n+1).join("0")+r).slice(-n)},t.convert=function(r){var n,a,o,s;if(Array.isArray(r))return"["+function(){var l,c,u;for(u=[],l=0,c=r.length;l<c;l++)n=r[l],u.push(t.convert(n));return u}().join(" ")+"]";if(typeof r=="string")return"/"+r;if(r?.isString)return"("+r+")";if(r instanceof Date)return"(D:"+e(r.getUTCFullYear(),4)+e(r.getUTCMonth(),2)+e(r.getUTCDate(),2)+e(r.getUTCHours(),2)+e(r.getUTCMinutes(),2)+e(r.getUTCSeconds(),2)+"Z)";if({}.toString.call(r)==="[object Object]"){for(a in o=["<<"],r)s=r[a],o.push("/"+a+" "+t.convert(s));return o.push(">>"),o.join(`
`)}return""+r},t}();function W6(e,t,r,n,a){n=n||{};var o=1.15,s=a.internal.scaleFactor,l=a.internal.getFontSize()/s,c=a.getLineHeightFactor?a.getLineHeightFactor():o,u=l*c,d=/\r\n|\r|\n/g,f="",h=1;if((n.valign==="middle"||n.valign==="bottom"||n.halign==="center"||n.halign==="right")&&(f=typeof e=="string"?e.split(d):e,h=f.length||1),r+=l*(2-o),n.valign==="middle"?r-=h/2*u:n.valign==="bottom"&&(r-=h*u),n.halign==="center"||n.halign==="right"){var p=l;if(n.halign==="center"&&(p*=.5),f&&h>=1){for(var g=0;g<f.length;g++)a.text(f[g],t-a.getStringUnitWidth(f[g])*p,r),r+=u;return a}t-=a.getStringUnitWidth(e)*p}return n.halign==="justify"?a.text(e,t,r,{maxWidth:n.maxWidth||100,align:"justify"}):a.text(e,t,r),a}var s4={},Zu=function(){function e(t){this.jsPDFDocument=t,this.userStyles={textColor:t.getTextColor?this.jsPDFDocument.getTextColor():0,fontSize:t.internal.getFontSize(),fontStyle:t.internal.getFont().fontStyle,font:t.internal.getFont().fontName,lineWidth:t.getLineWidth?this.jsPDFDocument.getLineWidth():0,lineColor:t.getDrawColor?this.jsPDFDocument.getDrawColor():0}}return e.setDefaults=function(t,r){r===void 0&&(r=null),r?r.__autoTableDocumentDefaults=t:s4=t},e.unifyColor=function(t){return Array.isArray(t)?t:typeof t=="number"?[t,t,t]:typeof t=="string"?[t]:null},e.prototype.applyStyles=function(t,r){var n,a,o;r===void 0&&(r=!1),t.fontStyle&&this.jsPDFDocument.setFontStyle&&this.jsPDFDocument.setFontStyle(t.fontStyle);var s=this.jsPDFDocument.internal.getFont(),l=s.fontStyle,c=s.fontName;if(t.font&&(c=t.font),t.fontStyle){l=t.fontStyle;var u=this.getFontList()[c];u&&u.indexOf(l)===-1&&this.jsPDFDocument.setFontStyle&&(this.jsPDFDocument.setFontStyle(u[0]),l=u[0])}if(this.jsPDFDocument.setFont(c,l),t.fontSize&&this.jsPDFDocument.setFontSize(t.fontSize),!r){var d=e.unifyColor(t.fillColor);d&&(n=this.jsPDFDocument).setFillColor.apply(n,d),d=e.unifyColor(t.textColor),d&&(a=this.jsPDFDocument).setTextColor.apply(a,d),d=e.unifyColor(t.lineColor),d&&(o=this.jsPDFDocument).setDrawColor.apply(o,d),typeof t.lineWidth=="number"&&this.jsPDFDocument.setLineWidth(t.lineWidth)}},e.prototype.splitTextToSize=function(t,r,n){return this.jsPDFDocument.splitTextToSize(t,r,n)},e.prototype.rect=function(t,r,n,a,o){return this.jsPDFDocument.rect(t,r,n,a,o)},e.prototype.getLastAutoTable=function(){return this.jsPDFDocument.lastAutoTable||null},e.prototype.getTextWidth=function(t){return this.jsPDFDocument.getTextWidth(t)},e.prototype.getDocument=function(){return this.jsPDFDocument},e.prototype.setPage=function(t){this.jsPDFDocument.setPage(t)},e.prototype.addPage=function(){return this.jsPDFDocument.addPage()},e.prototype.getFontList=function(){return this.jsPDFDocument.getFontList()},e.prototype.getGlobalOptions=function(){return s4||{}},e.prototype.getDocumentOptions=function(){return this.jsPDFDocument.__autoTableDocumentDefaults||{}},e.prototype.pageSize=function(){var t=this.jsPDFDocument.internal.pageSize;return t.width==null&&(t={width:t.getWidth(),height:t.getHeight()}),t},e.prototype.scaleFactor=function(){return this.jsPDFDocument.internal.scaleFactor},e.prototype.getLineHeightFactor=function(){var t=this.jsPDFDocument;return t.getLineHeightFactor?t.getLineHeightFactor():1.15},e.prototype.getLineHeight=function(t){return t/this.scaleFactor()*this.getLineHeightFactor()},e.prototype.pageNumber=function(){var t=this.jsPDFDocument.internal.getCurrentPageInfo();return t?t.pageNumber:this.jsPDFDocument.internal.getNumberOfPages()},e}(),Rw=function(e,t){return Rw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},Rw(e,t)};function H6(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Rw(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var V6=function(e){H6(t,e);function t(r){var n=e.call(this)||this;return n._element=r,n}return t}(Array);function Pce(e){return{font:"helvetica",fontStyle:"normal",overflow:"linebreak",fillColor:!1,textColor:20,halign:"left",valign:"top",fontSize:10,cellPadding:5/e,lineColor:200,lineWidth:0,cellWidth:"auto",minCellHeight:0,minCellWidth:0}}function Oce(e){var t={striped:{table:{fillColor:255,textColor:80,fontStyle:"normal"},head:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},body:{},foot:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},alternateRow:{fillColor:245}},grid:{table:{fillColor:255,textColor:80,fontStyle:"normal",lineWidth:.1},head:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},body:{},foot:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},alternateRow:{}},plain:{head:{fontStyle:"bold"},foot:{fontStyle:"bold"}}};return t[e]}function jv(e,t,r){r.applyStyles(t,!0);var n=Array.isArray(e)?e:[e],a=n.map(function(o){return r.getTextWidth(o)}).reduce(function(o,s){return Math.max(o,s)},0);return a}function G6(e,t,r,n){var a=t.settings.tableLineWidth,o=t.settings.tableLineColor;e.applyStyles({lineWidth:a,lineColor:o});var s=Y6(a,!1);s&&e.rect(r.x,r.y,t.getWidth(e.pageSize().width),n.y-r.y,s)}function Y6(e,t){var r=e>0,n=t||t===0;return r&&n?"DF":r?"S":n?"F":null}function Ry(e,t){var r,n,a,o;if(e=e||t,Array.isArray(e)){if(e.length>=4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(e.length===3)return{top:e[0],right:e[1],bottom:e[2],left:e[1]};if(e.length===2)return{top:e[0],right:e[1],bottom:e[0],left:e[1]};e.length===1?e=e[0]:e=t}return typeof e=="object"?(typeof e.vertical=="number"&&(e.top=e.vertical,e.bottom=e.vertical),typeof e.horizontal=="number"&&(e.right=e.horizontal,e.left=e.horizontal),{left:(r=e.left)!==null&&r!==void 0?r:t,top:(n=e.top)!==null&&n!==void 0?n:t,right:(a=e.right)!==null&&a!==void 0?a:t,bottom:(o=e.bottom)!==null&&o!==void 0?o:t}):(typeof e!="number"&&(e=t),{top:e,right:e,bottom:e,left:e})}function K6(e,t){var r=Ry(t.settings.margin,0);return e.pageSize().width-(r.left+r.right)}function kce(e,t,r,n,a){var o={},s=1.3333333333333333,l=k2(t,function(w){return a.getComputedStyle(w).backgroundColor});l!=null&&(o.fillColor=l);var c=k2(t,function(w){return a.getComputedStyle(w).color});c!=null&&(o.textColor=c);var u=Ece(n,r);u&&(o.cellPadding=u);var d="borderTopColor",f=s*r,h=n.borderTopWidth;if(n.borderBottomWidth===h&&n.borderRightWidth===h&&n.borderLeftWidth===h){var p=(parseFloat(h)||0)/f;p&&(o.lineWidth=p)}else o.lineWidth={top:(parseFloat(n.borderTopWidth)||0)/f,right:(parseFloat(n.borderRightWidth)||0)/f,bottom:(parseFloat(n.borderBottomWidth)||0)/f,left:(parseFloat(n.borderLeftWidth)||0)/f},o.lineWidth.top||(o.lineWidth.right?d="borderRightColor":o.lineWidth.bottom?d="borderBottomColor":o.lineWidth.left&&(d="borderLeftColor"));var g=k2(t,function(w){return a.getComputedStyle(w)[d]});g!=null&&(o.lineColor=g);var m=["left","right","center","justify"];m.indexOf(n.textAlign)!==-1&&(o.halign=n.textAlign),m=["middle","bottom","top"],m.indexOf(n.verticalAlign)!==-1&&(o.valign=n.verticalAlign);var x=parseInt(n.fontSize||"");isNaN(x)||(o.fontSize=x/s);var b=Tce(n);b&&(o.fontStyle=b);var _=(n.fontFamily||"").toLowerCase();return e.indexOf(_)!==-1&&(o.font=_),o}function Tce(e){var t="";return(e.fontWeight==="bold"||e.fontWeight==="bolder"||parseInt(e.fontWeight)>=700)&&(t="bold"),(e.fontStyle==="italic"||e.fontStyle==="oblique")&&(t+="italic"),t}function k2(e,t){var r=Q6(e,t);if(!r)return null;var n=r.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*\.?\d*))?\)$/);if(!n||!Array.isArray(n))return null;var a=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])],o=parseInt(n[4]);return o===0||isNaN(a[0])||isNaN(a[1])||isNaN(a[2])?null:a}function Q6(e,t){var r=t(e);return r==="rgba(0, 0, 0, 0)"||r==="transparent"||r==="initial"||r==="inherit"?e.parentElement==null?null:Q6(e.parentElement,t):r}function Ece(e,t){var r=[e.paddingTop,e.paddingRight,e.paddingBottom,e.paddingLeft],n=96/(72/t),a=(parseInt(e.lineHeight)-parseInt(e.fontSize))/t/2,o=r.map(function(l){return parseInt(l||"0")/n}),s=Ry(o,0);return a>s.top&&(s.top=a),a>s.bottom&&(s.bottom=a),s}function X6(e,t,r,n,a){var o,s;n===void 0&&(n=!1),a===void 0&&(a=!1);var l;typeof t=="string"?l=r.document.querySelector(t):l=t;var c=Object.keys(e.getFontList()),u=e.scaleFactor(),d=[],f=[],h=[];if(!l)return console.error("Html table could not be found with input: ",t),{head:d,body:f,foot:h};for(var p=0;p<l.rows.length;p++){var g=l.rows[p],m=(s=(o=g?.parentElement)===null||o===void 0?void 0:o.tagName)===null||s===void 0?void 0:s.toLowerCase(),x=Ice(c,u,r,g,n,a);x&&(m==="thead"?d.push(x):m==="tfoot"?h.push(x):f.push(x))}return{head:d,body:f,foot:h}}function Ice(e,t,r,n,a,o){for(var s=new V6(n),l=0;l<n.cells.length;l++){var c=n.cells[l],u=r.getComputedStyle(c);if(a||u.display!=="none"){var d=void 0;o&&(d=kce(e,c,t,u,r)),s.push({rowSpan:c.rowSpan,colSpan:c.colSpan,styles:d,_element:c,content:Nce(c)})}}var f=r.getComputedStyle(n);if(s.length>0&&(a||f.display!=="none"))return s}function Nce(e){var t=e.cloneNode(!0);return t.innerHTML=t.innerHTML.replace(/\n/g,"").replace(/ +/g," "),t.innerHTML=t.innerHTML.split(/<br.*?>/).map(function(r){return r.trim()}).join(`
`),t.innerText||t.textContent||""}function Dce(e,t,r){for(var n=0,a=[e,t,r];n<a.length;n++){var o=a[n];o&&typeof o!="object"&&console.error("The options parameter should be of type object, is: "+typeof o),o.startY&&typeof o.startY!="number"&&(console.error("Invalid value for startY option",o.startY),delete o.startY)}}function ll(e,t,r,n,a){if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(e),s=1;s<arguments.length;s++){var l=arguments[s];if(l!=null)for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(o[c]=l[c])}return o}function J6(e,t){var r=new Zu(e),n=r.getDocumentOptions(),a=r.getGlobalOptions();Dce(a,n,t);var o=ll({},a,n,t),s;typeof window<"u"&&(s=window);var l=Mce(a,n,t),c=Lce(a,n,t),u=Rce(r,o),d=Fce(r,o,s);return{id:t.tableId,content:d,hooks:c,styles:l,settings:u}}function Mce(e,t,r){for(var n={styles:{},headStyles:{},bodyStyles:{},footStyles:{},alternateRowStyles:{},columnStyles:{}},a=function(c){if(c==="columnStyles"){var u=e[c],d=t[c],f=r[c];n.columnStyles=ll({},u,d,f)}else{var h=[e,t,r],p=h.map(function(g){return g[c]||{}});n[c]=ll({},p[0],p[1],p[2])}},o=0,s=Object.keys(n);o<s.length;o++){var l=s[o];a(l)}return n}function Lce(e,t,r){for(var n=[e,t,r],a={didParseCell:[],willDrawCell:[],didDrawCell:[],willDrawPage:[],didDrawPage:[]},o=0,s=n;o<s.length;o++){var l=s[o];l.didParseCell&&a.didParseCell.push(l.didParseCell),l.willDrawCell&&a.willDrawCell.push(l.willDrawCell),l.didDrawCell&&a.didDrawCell.push(l.didDrawCell),l.willDrawPage&&a.willDrawPage.push(l.willDrawPage),l.didDrawPage&&a.didDrawPage.push(l.didDrawPage)}return a}function Rce(e,t){var r,n,a,o,s,l,c,u,d,f,h,p,g=Ry(t.margin,40/e.scaleFactor()),m=(r=qce(e,t.startY))!==null&&r!==void 0?r:g.top,x;t.showFoot===!0?x="everyPage":t.showFoot===!1?x="never":x=(n=t.showFoot)!==null&&n!==void 0?n:"everyPage";var b;t.showHead===!0?b="everyPage":t.showHead===!1?b="never":b=(a=t.showHead)!==null&&a!==void 0?a:"everyPage";var _=(o=t.useCss)!==null&&o!==void 0?o:!1,w=t.theme||(_?"plain":"striped"),A=!!t.horizontalPageBreak,O=(s=t.horizontalPageBreakRepeat)!==null&&s!==void 0?s:null;return{includeHiddenHtml:(l=t.includeHiddenHtml)!==null&&l!==void 0?l:!1,useCss:_,theme:w,startY:m,margin:g,pageBreak:(c=t.pageBreak)!==null&&c!==void 0?c:"auto",rowPageBreak:(u=t.rowPageBreak)!==null&&u!==void 0?u:"auto",tableWidth:(d=t.tableWidth)!==null&&d!==void 0?d:"auto",showHead:b,showFoot:x,tableLineWidth:(f=t.tableLineWidth)!==null&&f!==void 0?f:0,tableLineColor:(h=t.tableLineColor)!==null&&h!==void 0?h:200,horizontalPageBreak:A,horizontalPageBreakRepeat:O,horizontalPageBreakBehaviour:(p=t.horizontalPageBreakBehaviour)!==null&&p!==void 0?p:"afterAllRows"}}function qce(e,t){var r=e.getLastAutoTable(),n=e.scaleFactor(),a=e.pageNumber(),o=!1;if(r&&r.startPageNumber){var s=r.startPageNumber+r.pageNumber-1;o=s===a}return typeof t=="number"?t:(t==null||t===!1)&&o&&r?.finalY!=null?r.finalY+20/n:null}function Fce(e,t,r){var n=t.head||[],a=t.body||[],o=t.foot||[];if(t.html){var s=t.includeHiddenHtml;if(r){var l=X6(e,t.html,r,s,t.useCss)||{};n=l.head||n,a=l.body||n,o=l.foot||n}else console.error("Cannot parse html in non browser environment")}var c=t.columns||$ce(n,a,o);return{columns:c,head:n,body:a,foot:o}}function $ce(e,t,r){var n=e[0]||t[0]||r[0]||[],a=[];return Object.keys(n).filter(function(o){return o!=="_element"}).forEach(function(o){var s=1,l;Array.isArray(n)?l=n[parseInt(o)]:l=n[o],typeof l=="object"&&!Array.isArray(l)&&(s=l?.colSpan||1);for(var c=0;c<s;c++){var u=void 0;Array.isArray(n)?u=a.length:u=o+(c>0?"_".concat(c):"");var d={dataKey:u};a.push(d)}}),a}var qw=function(){function e(t,r,n){this.table=r,this.pageNumber=r.pageNumber,this.settings=r.settings,this.cursor=n,this.doc=t.getDocument()}return e}(),Bce=function(e){H6(t,e);function t(r,n,a,o,s,l){var c=e.call(this,r,n,l)||this;return c.cell=a,c.row=o,c.column=s,c.section=o.section,c}return t}(qw),Uce=function(){function e(t,r){this.pageNumber=1,this.id=t.id,this.settings=t.settings,this.styles=t.styles,this.hooks=t.hooks,this.columns=r.columns,this.head=r.head,this.body=r.body,this.foot=r.foot}return e.prototype.getHeadHeight=function(t){return this.head.reduce(function(r,n){return r+n.getMaxCellHeight(t)},0)},e.prototype.getFootHeight=function(t){return this.foot.reduce(function(r,n){return r+n.getMaxCellHeight(t)},0)},e.prototype.allRows=function(){return this.head.concat(this.body).concat(this.foot)},e.prototype.callCellHooks=function(t,r,n,a,o,s){for(var l=0,c=r;l<c.length;l++){var u=c[l],d=new Bce(t,this,n,a,o,s),f=u(d)===!1;if(n.text=Array.isArray(n.text)?n.text:[n.text],f)return!1}return!0},e.prototype.callEndPageHooks=function(t,r){t.applyStyles(t.userStyles);for(var n=0,a=this.hooks.didDrawPage;n<a.length;n++){var o=a[n];o(new qw(t,this,r))}},e.prototype.callWillDrawPageHooks=function(t,r){for(var n=0,a=this.hooks.willDrawPage;n<a.length;n++){var o=a[n];o(new qw(t,this,r))}},e.prototype.getWidth=function(t){if(typeof this.settings.tableWidth=="number")return this.settings.tableWidth;if(this.settings.tableWidth==="wrap"){var r=this.columns.reduce(function(a,o){return a+o.wrappedWidth},0);return r}else{var n=this.settings.margin;return t-n.left-n.right}},e}(),Z6=function(){function e(t,r,n,a,o){o===void 0&&(o=!1),this.height=0,this.raw=t,t instanceof V6&&(this.raw=t._element,this.element=t._element),this.index=r,this.section=n,this.cells=a,this.spansMultiplePages=o}return e.prototype.getMaxCellHeight=function(t){var r=this;return t.reduce(function(n,a){var o;return Math.max(n,((o=r.cells[a.index])===null||o===void 0?void 0:o.height)||0)},0)},e.prototype.hasRowSpan=function(t){var r=this;return t.filter(function(n){var a=r.cells[n.index];return a?a.rowSpan>1:!1}).length>0},e.prototype.canEntireRowFit=function(t,r){return this.getMaxCellHeight(r)<=t},e.prototype.getMinimumRowHeight=function(t,r){var n=this;return t.reduce(function(a,o){var s=n.cells[o.index];if(!s)return 0;var l=r.getLineHeight(s.styles.fontSize),c=s.padding("vertical"),u=c+l;return u>a?u:a},0)},e}(),eR=function(){function e(t,r,n){var a;this.contentHeight=0,this.contentWidth=0,this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.height=0,this.x=0,this.y=0,this.styles=r,this.section=n,this.raw=t;var o=t;t!=null&&typeof t=="object"&&!Array.isArray(t)?(this.rowSpan=t.rowSpan||1,this.colSpan=t.colSpan||1,o=(a=t.content)!==null&&a!==void 0?a:t,t._element&&(this.raw=t._element)):(this.rowSpan=1,this.colSpan=1);var s=o!=null?""+o:"",l=/\r\n|\r|\n/g;this.text=s.split(l)}return e.prototype.getTextPos=function(){var t;if(this.styles.valign==="top")t=this.y+this.padding("top");else if(this.styles.valign==="bottom")t=this.y+this.height-this.padding("bottom");else{var r=this.height-this.padding("vertical");t=this.y+r/2+this.padding("top")}var n;if(this.styles.halign==="right")n=this.x+this.width-this.padding("right");else if(this.styles.halign==="center"){var a=this.width-this.padding("horizontal");n=this.x+a/2+this.padding("left")}else n=this.x+this.padding("left");return{x:n,y:t}},e.prototype.getContentHeight=function(t,r){r===void 0&&(r=1.15);var n=Array.isArray(this.text)?this.text.length:1,a=this.styles.fontSize/t*r,o=n*a+this.padding("vertical");return Math.max(o,this.styles.minCellHeight)},e.prototype.padding=function(t){var r=Ry(this.styles.cellPadding,0);return t==="vertical"?r.top+r.bottom:t==="horizontal"?r.left+r.right:r[t]},e}(),zce=function(){function e(t,r,n){this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.dataKey=t,this.raw=r,this.index=n}return e.prototype.getMaxCustomCellWidth=function(t){for(var r=0,n=0,a=t.allRows();n<a.length;n++){var o=a[n],s=o.cells[this.index];s&&typeof s.styles.cellWidth=="number"&&(r=Math.max(r,s.styles.cellWidth))}return r},e}();function Wce(e,t){Hce(e,t);var r=[],n=0;t.columns.forEach(function(o){var s=o.getMaxCustomCellWidth(t);s?o.width=s:(o.width=o.wrappedWidth,r.push(o)),n+=o.width});var a=t.getWidth(e.pageSize().width)-n;a&&(a=Fw(r,a,function(o){return Math.max(o.minReadableWidth,o.minWidth)})),a&&(a=Fw(r,a,function(o){return o.minWidth})),a=Math.abs(a),!t.settings.horizontalPageBreak&&a>.1/e.scaleFactor()&&(a=a<1?a:Math.round(a),console.warn("Of the table content, ".concat(a," units width could not fit page"))),Gce(t),Yce(t,e),Vce(t)}function Hce(e,t){var r=e.scaleFactor(),n=t.settings.horizontalPageBreak,a=K6(e,t);t.allRows().forEach(function(o){for(var s=0,l=t.columns;s<l.length;s++){var c=l[s],u=o.cells[c.index];if(u){var d=t.hooks.didParseCell;t.callCellHooks(e,d,u,o,c,null);var f=u.padding("horizontal");u.contentWidth=jv(u.text,u.styles,e)+f;var h=jv(u.text.join(" ").split(/[^\S\u00A0]+/),u.styles,e);if(u.minReadableWidth=h+u.padding("horizontal"),typeof u.styles.cellWidth=="number")u.minWidth=u.styles.cellWidth,u.wrappedWidth=u.styles.cellWidth;else if(u.styles.cellWidth==="wrap"||n===!0)u.contentWidth>a?(u.minWidth=a,u.wrappedWidth=a):(u.minWidth=u.contentWidth,u.wrappedWidth=u.contentWidth);else{var p=10/r;u.minWidth=u.styles.minCellWidth||p,u.wrappedWidth=u.contentWidth,u.minWidth>u.wrappedWidth&&(u.wrappedWidth=u.minWidth)}}}}),t.allRows().forEach(function(o){for(var s=0,l=t.columns;s<l.length;s++){var c=l[s],u=o.cells[c.index];if(u&&u.colSpan===1)c.wrappedWidth=Math.max(c.wrappedWidth,u.wrappedWidth),c.minWidth=Math.max(c.minWidth,u.minWidth),c.minReadableWidth=Math.max(c.minReadableWidth,u.minReadableWidth);else{var d=t.styles.columnStyles[c.dataKey]||t.styles.columnStyles[c.index]||{},f=d.cellWidth||d.minCellWidth;f&&typeof f=="number"&&(c.minWidth=f,c.wrappedWidth=f)}u&&(u.colSpan>1&&!c.minWidth&&(c.minWidth=u.minWidth),u.colSpan>1&&!c.wrappedWidth&&(c.wrappedWidth=u.minWidth))}})}function Fw(e,t,r){for(var n=t,a=e.reduce(function(p,g){return p+g.wrappedWidth},0),o=0;o<e.length;o++){var s=e[o],l=s.wrappedWidth/a,c=n*l,u=s.width+c,d=r(s),f=u<d?d:u;t-=f-s.width,s.width=f}if(t=Math.round(t*1e10)/1e10,t){var h=e.filter(function(p){return t<0?p.width>r(p):!0});h.length&&(t=Fw(h,t,r))}return t}function Vce(e){for(var t={},r=1,n=e.allRows(),a=0;a<n.length;a++)for(var o=n[a],s=0,l=e.columns;s<l.length;s++){var c=l[s],u=t[c.index];if(r>1)r--,delete o.cells[c.index];else if(u)u.cell.height+=o.height,r=u.cell.colSpan,delete o.cells[c.index],u.left--,u.left<=1&&delete t[c.index];else{var d=o.cells[c.index];if(!d)continue;if(d.height=o.height,d.rowSpan>1){var f=n.length-a,h=d.rowSpan>f?f:d.rowSpan;t[c.index]={cell:d,left:h,row:o}}}}}function Gce(e){for(var t=e.allRows(),r=0;r<t.length;r++)for(var n=t[r],a=null,o=0,s=0,l=0;l<e.columns.length;l++){var c=e.columns[l];if(s-=1,s>1&&e.columns[l+1])o+=c.width,delete n.cells[c.index];else if(a){var u=a;delete n.cells[c.index],a=null,u.width=c.width+o}else{var u=n.cells[c.index];if(!u)continue;if(s=u.colSpan,o=0,u.colSpan>1){a=u,o+=c.width;continue}u.width=c.width+o}}}function Yce(e,t){for(var r={count:0,height:0},n=0,a=e.allRows();n<a.length;n++){for(var o=a[n],s=0,l=e.columns;s<l.length;s++){var c=l[s],u=o.cells[c.index];if(u){t.applyStyles(u.styles,!0);var d=u.width-u.padding("horizontal");if(u.styles.overflow==="linebreak")u.text=t.splitTextToSize(u.text,d+1/t.scaleFactor(),{fontSize:u.styles.fontSize});else if(u.styles.overflow==="ellipsize")u.text=l4(u.text,d,u.styles,t,"...");else if(u.styles.overflow==="hidden")u.text=l4(u.text,d,u.styles,t,"");else if(typeof u.styles.overflow=="function"){var f=u.styles.overflow(u.text,d);typeof f=="string"?u.text=[f]:u.text=f}u.contentHeight=u.getContentHeight(t.scaleFactor(),t.getLineHeightFactor());var h=u.contentHeight/u.rowSpan;u.rowSpan>1&&r.count*r.height<h*u.rowSpan?r={height:h,count:u.rowSpan}:r&&r.count>0&&r.height>h&&(h=r.height),h>o.height&&(o.height=h)}}r.count--}}function l4(e,t,r,n,a){return e.map(function(o){return Kce(o,t,r,n,a)})}function Kce(e,t,r,n,a){var o=1e4*n.scaleFactor();if(t=Math.ceil(t*o)/o,t>=jv(e,r,n))return e;for(;t<jv(e+a,r,n)&&!(e.length<=1);)e=e.substring(0,e.length-1);return e.trim()+a}function tR(e,t){var r=new Zu(e),n=Qce(t,r.scaleFactor()),a=new Uce(t,n);return Wce(r,a),r.applyStyles(r.userStyles),a}function Qce(e,t){var r=e.content,n=Jce(r.columns);if(r.head.length===0){var a=c4(n,"head");a&&r.head.push(a)}if(r.foot.length===0){var a=c4(n,"foot");a&&r.foot.push(a)}var o=e.settings.theme,s=e.styles;return{columns:n,head:T2("head",r.head,n,s,o,t),body:T2("body",r.body,n,s,o,t),foot:T2("foot",r.foot,n,s,o,t)}}function T2(e,t,r,n,a,o){var s={},l=t.map(function(c,u){for(var d=0,f={},h=0,p=0,g=0,m=r;g<m.length;g++){var x=m[g];if(s[x.index]==null||s[x.index].left===0)if(p===0){var b=void 0;Array.isArray(c)?b=c[x.index-h-d]:b=c[x.dataKey];var _={};typeof b=="object"&&!Array.isArray(b)&&(_=b?.styles||{});var w=Zce(e,x,u,a,n,o,_),A=new eR(b,w,e);f[x.dataKey]=A,f[x.index]=A,p=A.colSpan-1,s[x.index]={left:A.rowSpan-1,times:p}}else p--,h++;else s[x.index].left--,p=s[x.index].times,d++}return new Z6(c,u,e,f)});return l}function c4(e,t){var r={};return e.forEach(function(n){if(n.raw!=null){var a=Xce(t,n.raw);a!=null&&(r[n.dataKey]=a)}}),Object.keys(r).length>0?r:null}function Xce(e,t){if(e==="head"){if(typeof t=="object")return t.header||null;if(typeof t=="string"||typeof t=="number")return t}else if(e==="foot"&&typeof t=="object")return t.footer;return null}function Jce(e){return e.map(function(t,r){var n,a;return typeof t=="object"?a=(n=t.dataKey)!==null&&n!==void 0?n:r:a=r,new zce(a,t,r)})}function Zce(e,t,r,n,a,o,s){var l=Oce(n),c;e==="head"?c=a.headStyles:e==="body"?c=a.bodyStyles:e==="foot"&&(c=a.footStyles);var u=ll({},l.table,l[e],a.styles,c),d=a.columnStyles[t.dataKey]||a.columnStyles[t.index]||{},f=e==="body"?d:{},h=e==="body"&&r%2===0?ll({},l.alternateRow,a.alternateRowStyles):{},p=Pce(o),g=ll({},p,u,h,f);return ll(g,s)}function eue(e,t,r){var n;r===void 0&&(r={});var a=K6(e,t),o=new Map,s=[],l=[],c=[];Array.isArray(t.settings.horizontalPageBreakRepeat)?c=t.settings.horizontalPageBreakRepeat:(typeof t.settings.horizontalPageBreakRepeat=="string"||typeof t.settings.horizontalPageBreakRepeat=="number")&&(c=[t.settings.horizontalPageBreakRepeat]),c.forEach(function(h){var p=t.columns.find(function(g){return g.dataKey===h||g.index===h});p&&!o.has(p.index)&&(o.set(p.index,!0),s.push(p.index),l.push(t.columns[p.index]),a-=p.wrappedWidth)});for(var u=!0,d=(n=r?.start)!==null&&n!==void 0?n:0;d<t.columns.length;){if(o.has(d)){d++;continue}var f=t.columns[d].wrappedWidth;if(u||a>=f)u=!1,s.push(d),l.push(t.columns[d]),a-=f;else break;d++}return{colIndexes:s,columns:l,lastIndex:d-1}}function tue(e,t){for(var r=[],n=0;n<t.columns.length;n++){var a=eue(e,t,{start:n});a.columns.length&&(r.push(a),n=a.lastIndex)}return r}function rR(e,t){var r=t.settings,n=r.startY,a=r.margin,o={x:a.left,y:n},s=t.getHeadHeight(t.columns)+t.getFootHeight(t.columns),l=n+a.bottom+s;if(r.pageBreak==="avoid"){var c=t.body,u=c.reduce(function(h,p){return h+p.height},0);l+=u}var d=new Zu(e);(r.pageBreak==="always"||r.startY!=null&&l>d.pageSize().height)&&(aR(d),o.y=a.top),t.callWillDrawPageHooks(d,o);var f=ll({},o);t.startPageNumber=d.pageNumber(),r.horizontalPageBreak?rue(d,t,f,o):(d.applyStyles(d.userStyles),(r.showHead==="firstPage"||r.showHead==="everyPage")&&t.head.forEach(function(h){return xl(d,t,h,o,t.columns)}),d.applyStyles(d.userStyles),t.body.forEach(function(h,p){var g=p===t.body.length-1;Sv(d,t,h,g,f,o,t.columns)}),d.applyStyles(d.userStyles),(r.showFoot==="lastPage"||r.showFoot==="everyPage")&&t.foot.forEach(function(h){return xl(d,t,h,o,t.columns)})),G6(d,t,f,o),t.callEndPageHooks(d,o),t.finalY=o.y,e.lastAutoTable=t,d.applyStyles(d.userStyles)}function rue(e,t,r,n){var a=tue(e,t),o=t.settings;if(o.horizontalPageBreakBehaviour==="afterAllRows")a.forEach(function(u,d){e.applyStyles(e.userStyles),d>0?qh(e,t,r,n,u.columns,!0):u4(e,t,n,u.columns),nue(e,t,r,n,u.columns),E2(e,t,n,u.columns)});else for(var s=-1,l=a[0],c=function(){var u=s;if(l){e.applyStyles(e.userStyles);var d=l.columns;s>=0?qh(e,t,r,n,d,!0):u4(e,t,n,d),u=d4(e,t,s+1,n,d),E2(e,t,n,d)}var f=u-s;a.slice(1).forEach(function(h){e.applyStyles(e.userStyles),qh(e,t,r,n,h.columns,!0),d4(e,t,s+1,n,h.columns,f),E2(e,t,n,h.columns)}),s=u};s<t.body.length-1;)c()}function u4(e,t,r,n){var a=t.settings;e.applyStyles(e.userStyles),(a.showHead==="firstPage"||a.showHead==="everyPage")&&t.head.forEach(function(o){return xl(e,t,o,r,n)})}function nue(e,t,r,n,a){e.applyStyles(e.userStyles),t.body.forEach(function(o,s){var l=s===t.body.length-1;Sv(e,t,o,l,r,n,a)})}function d4(e,t,r,n,a,o){e.applyStyles(e.userStyles),o=o??t.body.length;var s=Math.min(r+o,t.body.length),l=-1;return t.body.slice(r,s).forEach(function(c,u){var d=r+u===t.body.length-1,f=nR(e,t,d,n);c.canEntireRowFit(f,a)&&(xl(e,t,c,n,a),l=r+u)}),l}function E2(e,t,r,n){var a=t.settings;e.applyStyles(e.userStyles),(a.showFoot==="lastPage"||a.showFoot==="everyPage")&&t.foot.forEach(function(o){return xl(e,t,o,r,n)})}function aue(e,t,r){var n=r.getLineHeight(e.styles.fontSize),a=e.padding("vertical"),o=Math.floor((t-a)/n);return Math.max(0,o)}function iue(e,t,r,n){var a={};e.spansMultiplePages=!0,e.height=0;for(var o=0,s=0,l=r.columns;s<l.length;s++){var c=l[s],u=e.cells[c.index];if(u){Array.isArray(u.text)||(u.text=[u.text]);var d=new eR(u.raw,u.styles,u.section);d=ll(d,u),d.text=[];var f=aue(u,t,n);u.text.length>f&&(d.text=u.text.splice(f,u.text.length));var h=n.scaleFactor(),p=n.getLineHeightFactor();u.contentHeight=u.getContentHeight(h,p),u.contentHeight>=t&&(u.contentHeight=t,d.styles.minCellHeight-=t),u.contentHeight>e.height&&(e.height=u.contentHeight),d.contentHeight=d.getContentHeight(h,p),d.contentHeight>o&&(o=d.contentHeight),a[c.index]=d}}var g=new Z6(e.raw,-1,e.section,a,!0);g.height=o;for(var m=0,x=r.columns;m<x.length;m++){var c=x[m],d=g.cells[c.index];d&&(d.height=g.height);var u=e.cells[c.index];u&&(u.height=e.height)}return g}function oue(e,t,r,n){var a=e.pageSize().height,o=n.settings.margin,s=o.top+o.bottom,l=a-s;t.section==="body"&&(l-=n.getHeadHeight(n.columns)+n.getFootHeight(n.columns));var c=t.getMinimumRowHeight(n.columns,e),u=c<r;if(c>l)return console.error("Will not be able to print row ".concat(t.index," correctly since it's minimum height is larger than page height")),!0;if(!u)return!1;var d=t.hasRowSpan(n.columns),f=t.getMaxCellHeight(n.columns)>l;return f?(d&&console.error("The content of row ".concat(t.index," will not be drawn correctly since drawing rows with a height larger than the page height and has cells with rowspans is not supported.")),!0):!(d||n.settings.rowPageBreak==="avoid")}function Sv(e,t,r,n,a,o,s){var l=nR(e,t,n,o);if(r.canEntireRowFit(l,s))xl(e,t,r,o,s);else if(oue(e,r,l,t)){var c=iue(r,l,t,e);xl(e,t,r,o,s),qh(e,t,a,o,s),Sv(e,t,c,n,a,o,s)}else qh(e,t,a,o,s),Sv(e,t,r,n,a,o,s)}function xl(e,t,r,n,a){n.x=t.settings.margin.left;for(var o=0,s=a;o<s.length;o++){var l=s[o],c=r.cells[l.index];if(!c){n.x+=l.width;continue}e.applyStyles(c.styles),c.x=n.x,c.y=n.y;var u=t.callCellHooks(e,t.hooks.willDrawCell,c,r,l,n);if(u===!1){n.x+=l.width;continue}sue(e,c,n);var d=c.getTextPos();W6(c.text,d.x,d.y,{halign:c.styles.halign,valign:c.styles.valign,maxWidth:Math.ceil(c.width-c.padding("left")-c.padding("right"))},e.getDocument()),t.callCellHooks(e,t.hooks.didDrawCell,c,r,l,n),n.x+=l.width}n.y+=r.height}function sue(e,t,r){var n=t.styles;if(e.getDocument().setFillColor(e.getDocument().getFillColor()),typeof n.lineWidth=="number"){var a=Y6(n.lineWidth,n.fillColor);a&&e.rect(t.x,r.y,t.width,t.height,a)}else typeof n.lineWidth=="object"&&(n.fillColor&&e.rect(t.x,r.y,t.width,t.height,"F"),lue(e,t,r,n.lineWidth))}function lue(e,t,r,n){var a,o,s,l;n.top&&(a=r.x,o=r.y,s=r.x+t.width,l=r.y,n.right&&(s+=.5*n.right),n.left&&(a-=.5*n.left),c(n.top,a,o,s,l)),n.bottom&&(a=r.x,o=r.y+t.height,s=r.x+t.width,l=r.y+t.height,n.right&&(s+=.5*n.right),n.left&&(a-=.5*n.left),c(n.bottom,a,o,s,l)),n.left&&(a=r.x,o=r.y,s=r.x,l=r.y+t.height,n.top&&(o-=.5*n.top),n.bottom&&(l+=.5*n.bottom),c(n.left,a,o,s,l)),n.right&&(a=r.x+t.width,o=r.y,s=r.x+t.width,l=r.y+t.height,n.top&&(o-=.5*n.top),n.bottom&&(l+=.5*n.bottom),c(n.right,a,o,s,l));function c(u,d,f,h,p){e.getDocument().setLineWidth(u),e.getDocument().line(d,f,h,p,"S")}}function nR(e,t,r,n){var a=t.settings.margin.bottom,o=t.settings.showFoot;return(o==="everyPage"||o==="lastPage"&&r)&&(a+=t.getFootHeight(t.columns)),e.pageSize().height-n.y-a}function qh(e,t,r,n,a,o){a===void 0&&(a=[]),o===void 0&&(o=!1),e.applyStyles(e.userStyles),t.settings.showFoot==="everyPage"&&!o&&t.foot.forEach(function(l){return xl(e,t,l,n,a)}),t.callEndPageHooks(e,n);var s=t.settings.margin;G6(e,t,r,n),aR(e),t.pageNumber++,n.x=s.left,n.y=s.top,r.y=s.top,t.callWillDrawPageHooks(e,n),t.settings.showHead==="everyPage"&&(t.head.forEach(function(l){return xl(e,t,l,n,a)}),e.applyStyles(e.userStyles))}function aR(e){var t=e.pageNumber();e.setPage(t+1);var r=e.pageNumber();return r===t?(e.addPage(),!0):!1}function cue(e){e.API.autoTable=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t[0],a=J6(this,n),o=tR(this,a);return rR(this,o),this},e.API.lastAutoTable=!1,e.API.autoTableText=function(t,r,n,a){W6(t,r,n,a,this)},e.API.autoTableSetDefaults=function(t){return Zu.setDefaults(t,this),this},e.autoTableSetDefaults=function(t,r){Zu.setDefaults(t,r)},e.API.autoTableHtmlToJson=function(t,r){var n;if(r===void 0&&(r=!1),typeof window>"u")return console.error("Cannot run autoTableHtmlToJson in non browser environment"),null;var a=new Zu(this),o=X6(a,t,window,r,!1),s=o.head,l=o.body,c=((n=s[0])===null||n===void 0?void 0:n.map(function(u){return u.content}))||[];return{columns:c,rows:l,data:l}}}var I2;function uue(e,t){var r=J6(e,t),n=tR(e,r);rR(e,n)}try{if(typeof window<"u"&&window){var f4=window,h4=f4.jsPDF||((I2=f4.jspdf)===null||I2===void 0?void 0:I2.jsPDF);h4&&cue(h4)}}catch(e){console.error("Could not apply autoTable plugin",e)}const iR=({open:e,onClose:t,type:r,recordId:n,defaultTo:a,defaultSubject:o,defaultMessage:s,allowMessageEdit:l=!0})=>{const{user:c}=ea(),[u,d]=y.useState(a||""),[f,h]=y.useState(o||""),[p,g]=y.useState(s||""),[m,x]=y.useState(""),[b,_]=y.useState(!1),[w,A]=y.useState(""),[O,T]=y.useState([]),[E,S]=y.useState("");y.useEffect(()=>{console.log("EmailModal useEffect: open =",e,"defaultTo =",a,"current to =",u),e&&a&&(console.log("Setting to field to:",a),d(a))},[e,a]),y.useEffect(()=>{e&&I()},[e,r]);const I=async()=>{try{const F=await ve.get("/api/email/templates");if(F.data.success){const W=F.data.templates.filter(Z=>Z.type===r);T(W);const K=W.find(Z=>Z.is_default);K?(S(K.id),h(K.subject),g(K.html_content)):W.length===0&&(r==="quote"?(h("Quote Information"),g("Please find attached the quote details.")):r==="purchase-order"?(h("Purchase Order Information"),g("Please find attached the purchase order details.")):r==="sales-order"&&(h("Sales Order Information"),g("Please find attached the sales order details.")))}}catch(F){console.error("Error loading templates:",F),r==="quote"?(h("Quote Information"),g("Please find attached the quote details.")):r==="purchase-order"?(h("Purchase Order Information"),g("Please find attached the purchase order details.")):r==="sales-order"&&(h("Sales Order Information"),g("Please find attached the sales order details."))}},z=F=>{if(S(F),F!==""){const W=O.find(K=>K.id===F);W&&(h(W.subject),g(W.html_content))}},k=async()=>{if(r==="custom"){if(!u||!f||!p){A("Please fill in all required fields");return}}else if(!u){A("Please enter a recipient email address");return}_(!0),A("");try{let F="/api/email/send",W={to:u,subject:f,message:p};r!=="custom"&&n&&(F=`/api/email/${r.replace("-","-")}/${n}`,W={to:u,...m&&{customMessage:m}});const K=await ve.post(F,W);K.data.success?(ge.success("Email sent successfully!"),t(),d(""),h(""),g(""),x(""),S("")):A(K.data.message||"Failed to send email")}catch(F){console.error("Error sending email:",F),A(F.response?.data?.message||"Failed to send email")}finally{_(!1)}},M=()=>{b||(t(),A(""))},R=()=>{switch(r){case"sales-order":return"Send Sales Order Email";case"purchase-order":return"Send Purchase Order Email";case"quote":return"Send Quote Email";default:return"Send Email"}};return i.jsxs(gr,{open:e,onClose:M,maxWidth:"md",fullWidth:!0,children:[i.jsx(vr,{children:R()}),i.jsx(yr,{children:i.jsxs(J,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[r!=="custom"&&O.length>0&&i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Email Template"}),i.jsxs(hn,{value:E,onChange:F=>z(F.target.value),label:"Email Template",children:[i.jsx(tr,{value:"",children:i.jsx("em",{children:"Use default template"})}),O.map(F=>i.jsx(tr,{value:F.id,children:i.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:1},children:[F.name,F.is_default&&i.jsx(ot,{label:"Default",size:"small",color:"secondary"})]})},F.id))]})]}),i.jsx(Ae,{label:"To",value:u,onChange:F=>d(F.target.value),fullWidth:!0,required:!0,type:"email"}),r==="custom"&&i.jsxs(i.Fragment,{children:[i.jsx(Ae,{label:"Subject",value:f,onChange:F=>h(F.target.value),fullWidth:!0,required:!0}),i.jsx(Ae,{label:"Message",value:p,onChange:F=>g(F.target.value),fullWidth:!0,multiline:!0,rows:6,required:!0})]}),r!=="custom"&&l&&i.jsx(Ae,{label:"Additional Message (Optional)",value:m,onChange:F=>x(F.target.value),fullWidth:!0,multiline:!0,rows:4,helperText:"Add a custom message to include with the email"}),w&&i.jsx(Ot,{severity:"error",sx:{mt:2},children:w})]})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:M,disabled:b,children:"Cancel"}),i.jsx(ye,{onClick:k,variant:"contained",disabled:b,startIcon:b?i.jsx(nr,{size:20}):void 0,children:b?"Sending...":"Send Email"})]})]})},p4={product_name:""},SS=({open:e,onClose:t,onSave:r,initialProduct:n,isEditMode:a=!1,loading:o=!1})=>{const[s,l]=y.useState(p4),[c,u]=y.useState(null),d=Py(s,300);y.useEffect(()=>{e&&(l({...p4,...n}),u(null))},[e,n]);const f=g=>{const{name:m,value:x}=g.target;l(b=>({...b,[m]:x}))},h=()=>s.product_name.trim()?(u(null),!0):(u("Product name is required"),!1),p=()=>{h()&&r(s)};return y.useEffect(()=>{},[d,e]),i.jsxs(gr,{open:e,onClose:t,maxWidth:"sm",fullWidth:!0,children:[i.jsx(vr,{children:a?"Edit Product":"Add New Product"}),i.jsxs(yr,{children:[i.jsx(ie,{container:!0,spacing:2,sx:{mt:1},children:i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{name:"product_name",label:"Product Name",value:s.product_name,onChange:f,fullWidth:!0,required:!0,autoFocus:!0})})}),c&&i.jsx("div",{style:{color:"red",marginTop:8},children:c})]}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:t,children:"Cancel"}),i.jsx(ye,{onClick:p,variant:"contained",disabled:o,children:a?"Save Changes":"Add Product"})]})]})},qy=({when:e,onSave:t})=>{console.log("[UnsavedChangesGuard] Component rendered with when=",e);const[r,n]=y.useState(!1),[a,o]=y.useState(!1),s=y.useRef(""),l=y.useRef(null),c=y.useRef(!1);y.useEffect(()=>{if(!e)return;s.current=window.location.hash,console.log("[UnsavedChangesGuard] activating interceptors. prevHash=",s.current);const h=_=>_.metaKey||_.ctrlKey||_.shiftKey||_.altKey||_.button!==0,p=_=>{let w=_;for(;w&&w!==document.body;){if(w.tagName==="A")return w;w=w.parentElement}return null},g=_=>{if(!e||r)return;const w=p(_.target);if(!w||h(_))return;const A=w.getAttribute("href")||"";if(!A.startsWith("#"))return;const O=A;if(O!==window.location.hash){if(window.__unsavedGuardAllowNext){console.log("[UnsavedChangesGuard] bypass flag set -> allowing click navigation"),window.__unsavedGuardAllowNext=!1,c.current=!0;return}console.log("[UnsavedChangesGuard] click capture -> intercept anchor to",O),_.preventDefault(),_.stopPropagation(),l.current=O,n(!0)}},m=()=>{if(!e)return;if(window.__unsavedGuardAllowNext){console.log("[UnsavedChangesGuard] bypass flag set -> allowing hashchange"),window.__unsavedGuardAllowNext=!1,c.current=!0,s.current=window.location.hash;return}if(c.current){c.current=!1,s.current=window.location.hash,console.log("[UnsavedChangesGuard] hashchange allowed. prevHash ->",s.current);return}if(r)return;const _=window.location.hash;console.log("[UnsavedChangesGuard] hashchange detected -> attempted",_,"reverting to",s.current),l.current=_,n(!0),setTimeout(()=>{window.location.hash!==s.current&&(window.location.hash=s.current)},0)},x=history.pushState,b=history.replaceState;return history.pushState=function(..._){try{const w=_[2],A=typeof w=="string"?w:w?String(w):"",O=A&&A.includes("#")?A.slice(A.indexOf("#")):A;if(window.__unsavedGuardAllowNext)return console.log("[UnsavedChangesGuard] bypass flag set -> allowing pushState",A),window.__unsavedGuardAllowNext=!1,c.current=!0,x.apply(this,_);if(e&&!c.current){console.log("[UnsavedChangesGuard] pushState intercepted ->",A),l.current=O||null,n(!0);return}}catch{}return x.apply(this,_)},history.replaceState=function(..._){try{const w=_[2],A=typeof w=="string"?w:w?String(w):"",O=A&&A.includes("#")?A.slice(A.indexOf("#")):A;if(window.__unsavedGuardAllowNext)return console.log("[UnsavedChangesGuard] bypass flag set -> allowing replaceState",A),window.__unsavedGuardAllowNext=!1,c.current=!0,b.apply(this,_);if(e&&!c.current){console.log("[UnsavedChangesGuard] replaceState intercepted ->",A),l.current=O||null,n(!0);return}}catch{}return b.apply(this,_)},document.addEventListener("click",g,!0),window.addEventListener("hashchange",m),window.addEventListener("popstate",m),()=>{console.log("[UnsavedChangesGuard] deactivating interceptors"),document.removeEventListener("click",g,!0),window.removeEventListener("hashchange",m),window.removeEventListener("popstate",m),history.pushState=x,history.replaceState=b}},[e,r]),y.useEffect(()=>{console.log("[UnsavedChangesGuard] beforeunload useEffect triggered with when=",e);const h=p=>{e&&(console.log("[UnsavedChangesGuard] beforeunload fired"),p.preventDefault(),p.returnValue="")};return e&&(console.log("[UnsavedChangesGuard] registering beforeunload"),window.addEventListener("beforeunload",h)),()=>{console.log("[UnsavedChangesGuard] removing beforeunload listener"),window.removeEventListener("beforeunload",h)}},[e]);const u=()=>{console.log("[UnsavedChangesGuard] user chose: Stay"),n(!1),l.current=null},d=()=>{console.log("[UnsavedChangesGuard] user chose: Leave -> proceeding to",l.current);const h=l.current;n(!1),h&&(c.current=!0,l.current=null,window.location.hash!==h&&(window.location.hash=h))},f=async()=>{if(console.log("[UnsavedChangesGuard] user chose: Save and leave"),!t){d();return}try{o(!0),await t(),d()}catch(h){console.log("[UnsavedChangesGuard] save failed, staying on page",h),o(!1)}finally{o(!1)}};return i.jsxs(gr,{open:r,onClose:u,maxWidth:"xs",fullWidth:!0,children:[i.jsx(vr,{children:"Unsaved Changes"}),i.jsx(yr,{children:i.jsx(B,{variant:"body2",children:"You have unsaved changes. Would you like to save before leaving this page?"})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:u,children:"Cancel"}),i.jsx(ye,{onClick:d,color:"warning",children:"Leave without saving"}),i.jsx(ye,{onClick:f,variant:"contained",disabled:a,children:a?"Saving":"Save and leave"})]})]})};var Hf={},m4;function due(){if(m4)return Hf;m4=1;var e=cr();Object.defineProperty(Hf,"__esModule",{value:!0}),Hf.default=void 0;var t=e(dr()),r=ur();return Hf.default=(0,t.default)([(0,r.jsx)("path",{d:"M5 5h2v3h10V5h2v6h2V5c0-1.1-.9-2-2-2h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h5v-2H5zm7-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1"},"0"),(0,r.jsx)("path",{d:"m18.01 13-1.42 1.41 1.58 1.58H12v2h6.17l-1.58 1.59 1.42 1.41 3.99-4z"},"1")],"ContentPasteGo"),Hf}var fue=due();const hue=It(fue),g4={"& .MuiInputBase-input":{fontFamily:"Roboto Mono, Consolas, Menlo, monospace",fontSize:14,padding:"6px 8px"},"& fieldset":{border:"none"}},oR=({value:e,onChange:t,disableColumnEditing:r})=>{const n=Math.max(1,e.columns.length),a=y.useMemo(()=>Array.from({length:n},(f,h)=>e.columns[h]??""),[n,e.columns]),o=y.useMemo(()=>e.rows.map(f=>Array.from({length:n},(h,p)=>f[p]??"")),[e.rows,n]),s=y.useCallback((f,h)=>{const p=a.slice();p[f]=h,t({...e,columns:p})},[a,t,e]),l=y.useCallback((f,h,p)=>{const g=o.map(m=>m.slice());g[f][h]=p,t({...e,rows:g})},[t,o,e]),c=y.useCallback(f=>{const h=o.map(p=>p.slice());h.splice(f+1,0,Array.from({length:n},()=>"")),t({...e,rows:h})},[n,t,o,e]),u=y.useCallback(f=>{const h=o.map(p=>p.slice());h.splice(f,1),t({...e,rows:h.length>0?h:[Array.from({length:n},()=>"")]})},[n,t,o,e]),d=y.useCallback((f,h,p)=>{const g=p.clipboardData.getData("text");if(!g.includes("	")&&!g.includes(`
`))return;p.preventDefault();const x=g.replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`).map(w=>w.split("	")),b=o.map(w=>w.slice()),_=f+x.length;for(;b.length<_;)b.push(Array.from({length:n},()=>""));for(let w=0;w<x.length;w+=1)for(let A=0;A<x[w].length;A+=1){const O=f+w,T=h+A;T>=n||(b[O][T]=x[w][A]??"")}t({...e,rows:b})},[n,t,o,e]);return i.jsxs(J,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1,overflow:"hidden"},children:[i.jsxs(J,{sx:{display:"grid",gridTemplateColumns:`repeat(${n}, 1fr) 70px`,bgcolor:"background.paper"},children:[a.map((f,h)=>i.jsx(Ae,{value:f,onChange:p=>s(h,p.target.value),size:"small",disabled:r,placeholder:`Column ${h+1}`,sx:{...g4,borderBottom:"1px solid",borderColor:"divider",bgcolor:"action.hover"},inputProps:{style:{fontWeight:700}}},`h-${h}`)),i.jsx(J,{sx:{borderBottom:"1px solid",borderColor:"divider",bgcolor:"action.hover"}})]}),o.map((f,h)=>i.jsxs(J,{sx:{display:"grid",gridTemplateColumns:`repeat(${n}, 1fr) 70px`,alignItems:"stretch"},children:[f.map((p,g)=>i.jsx(Ae,{value:p,onChange:m=>l(h,g,m.target.value),onPaste:m=>d(h,g,m),size:"small",placeholder:g===0?"":"...",sx:{...g4,borderBottom:h<o.length-1?"1px solid":"none",borderColor:"divider"}},`c-${h}-${g}`)),i.jsxs(ct,{direction:"row",spacing:0,alignItems:"center",justifyContent:"center",sx:{borderBottom:h<o.length-1?"1px solid":"none",borderColor:"divider"},children:[i.jsx(En,{title:"Add row",children:i.jsx(pr,{size:"small",onClick:()=>c(h),children:i.jsx(Ba,{fontSize:"small"})})}),i.jsx(En,{title:"Delete row",children:i.jsx(pr,{size:"small",color:"error",onClick:()=>u(h),children:i.jsx(ua,{fontSize:"small"})})})]})]},`r-${h}`))]})},v4=e=>e.replace(/\|/g,""),$w=e=>{const t=e.columns.length>0?e.columns:["Column 1","Column 2"],r=t.length,n=`| ${t.map(s=>v4(s)).join(" | ")} |`,a=`| ${Array.from({length:r},()=>"---").join(" | ")} |`,o=e.rows.map(s=>`| ${Array.from({length:r},(c,u)=>v4(s[u]??"")).join(" | ")} |`);return[n,a,...o].join(`
`)},Bw=e=>{if(!e.includes("|"))return null;let n=e.trim().split("|");return n.length>=2&&n[0].trim()===""&&(n=n.slice(1)),n.length>=2&&n[n.length-1].trim()===""&&(n=n.slice(0,-1)),n.length===0?null:n.map(a=>a.trim())},pue=e=>{const t=Bw(e);return!t||t.length===0?!1:t.every(r=>/^:?-{3,}:?$/.test(r))},mue=e=>{const t=e.replace(/\r\n/g,`
`).replace(/\r/g,`
`).trim();if(!t.startsWith("|"))return null;const r=t.split(`
`).filter(l=>l.trim().length>0);if(r.length<2)return null;const n=Bw(r[0]);if(!n||!pue(r[1]))return null;const a=[];for(let l=2;l<r.length;l+=1){const c=Bw(r[l]);if(!c)return null;a.push(c)}const o=n.length,s=a.map(l=>Array.from({length:o},(c,u)=>l[u]??""));return{columns:n,rows:s}},gue=e=>JSON.stringify({type:"table",version:1,table:e}),y4=e=>{const t=e.trim();if(!t.startsWith("{"))return null;try{const r=JSON.parse(t);return r?.type!=="table"||r.version!==1||!r.table||!Array.isArray(r.table.columns)||!Array.isArray(r.table.rows)?null:r}catch{return null}},Fh=(e=10)=>({columns:["Column 1","Column 2"],rows:Array.from({length:Math.max(1,e)},()=>["",""])}),Fm={name:"",content:""},vue={"& textarea":{fontFamily:"Roboto Mono, Consolas, Menlo, monospace",fontSize:14,whiteSpace:"pre"}},yue=({open:e,onClose:t,onTemplateSelected:r,onSuccess:n,onError:a})=>{const[o,s]=y.useState([]),[l,c]=y.useState(!1),[u,d]=y.useState(null),[f,h]=y.useState(!1),[p,g]=y.useState(Fm),[m,x]=y.useState({}),[b,_]=y.useState(!1),[w,A]=y.useState(null),O=y.useRef(null),[T,E]=y.useState("text"),[S,I]=y.useState(()=>Fh(18));y.useEffect(()=>{e&&z()},[e]);const z=async()=>{try{c(!0),d(null);const D=await ve.get("/api/quote-templates"),P=Array.isArray(D.data?.templates)?D.data.templates:[];s(P)}catch(D){console.error("Failed to load quote templates",D);const P=D?.response?.data&&typeof D.response?.data=="object"&&"message"in D.response?.data?(D.response?.data).message:"Failed to load quote templates";d(P),a?.(P)}finally{c(!1)}},k=D=>{if(D){A(D);const P=y4(D.content);P?(E("table"),I(P.table),g({name:D.name,content:D.content})):(E("text"),g({name:D.name,content:D.content}))}else A(null),E("text"),I(Fh(18)),g(Fm);x({}),h(!0)},M=()=>{b||(h(!1),A(null),E("text"),I(Fh(18)),g(Fm),x({}))},R=()=>{const D={};return p.name.trim()||(D.name="Template name is required"),T==="text"&&!p.content.trim()&&(D.content="Template content is required"),x(D),Object.keys(D).length===0},F=async()=>{if(R())try{_(!0);const D=T==="table"?gue(S):p.content,P={name:p.name.trim(),content:D};w?(await ve.put(`/api/quote-templates/${w.template_id}`,P),n?.("Template updated successfully")):(await ve.post("/api/quote-templates",P),n?.("Template created successfully")),h(!1),A(null),g(Fm),await z()}catch(D){console.error("Failed to save quote template",D);const P=D,$=P.response?.data&&typeof P.response.data=="object"&&"message"in P.response.data?P.response.data.message:"Failed to save quote template";x(Q=>({...Q,submit:$})),a?.($)}finally{_(!1)}},W=async D=>{if(window.confirm(`Delete template "${D.name}"?`))try{await ve.delete(`/api/quote-templates/${D.template_id}`),n?.("Template deleted"),await z()}catch($){console.error("Failed to delete quote template",$);const Q=$,C=Q.response?.data&&typeof Q.response.data=="object"&&"message"in Q.response.data?Q.response.data.message:"Failed to delete template";a?.(C)}},K=D=>{const P=y4(D.content);if(P){const $=$w(P.table);r({...D,content:$});return}r(D)},Z=y.useMemo(()=>o,[o]);return i.jsxs(gr,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,children:[i.jsxs(vr,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(Sw,{color:"primary"}),"Quote Description Templates"]}),i.jsx(yr,{dividers:!0,children:i.jsxs(ct,{spacing:2,sx:{minHeight:260},children:[i.jsxs(ct,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[i.jsxs(J,{children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:"Saved templates"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Create reusable descriptions, including ASCII or HTML tables, and insert them into your quotes."})]}),i.jsx(ye,{variant:"contained",startIcon:i.jsx(Ba,{}),onClick:()=>k(),size:"small",children:"New Template"})]}),l?i.jsx(J,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexGrow:1},children:i.jsx(nr,{size:32})}):u?i.jsx(Ot,{severity:"error",children:u}):Z.length===0?i.jsx(J,{sx:{textAlign:"center",py:6},children:i.jsx(B,{variant:"body1",color:"text.secondary",children:"No templates yet. Create your first template to speed up quote creation."})}):i.jsx(ga,{sx:{maxHeight:360,overflowY:"auto"},children:Z.map((D,P)=>i.jsxs(Ce.Fragment,{children:[i.jsxs(Ca,{alignItems:"flex-start",sx:{alignItems:"flex-start",gap:2},children:[i.jsx(Jn,{primary:i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:D.name}),secondary:i.jsxs(B,{variant:"caption",color:"text.secondary",children:["Updated ",new Date(D.updated_at||D.created_at).toLocaleString()]})}),i.jsxs(ct,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",justifyContent:"flex-end",children:[i.jsx(ye,{variant:"outlined",size:"small",startIcon:i.jsx(hue,{}),onClick:()=>K(D),children:"Insert"}),i.jsx(En,{title:"Edit template",children:i.jsx("span",{children:i.jsx(pr,{onClick:()=>k(D),size:"small",children:i.jsx(tu,{fontSize:"small"})})})}),i.jsx(En,{title:"Delete template",children:i.jsx("span",{children:i.jsx(pr,{onClick:()=>W(D),size:"small",color:"error",children:i.jsx(ua,{fontSize:"small"})})})})]})]}),P<Z.length-1&&i.jsx(Gn,{component:"li"})]},D.template_id))})]})}),i.jsx(Cr,{children:i.jsx(ye,{onClick:t,children:"Close"})}),i.jsxs(gr,{open:f,onClose:M,maxWidth:"sm",fullWidth:!0,children:[i.jsx(vr,{children:w?"Edit Template":"New Template"}),i.jsx(yr,{children:i.jsxs(ct,{spacing:2,sx:{mt:1},children:[i.jsx(Ae,{label:"Template Name",value:p.name,onChange:D=>g(P=>({...P,name:D.target.value})),error:!!m.name,helperText:m.name,fullWidth:!0,autoFocus:!0}),i.jsxs(ct,{direction:"row",spacing:1,justifyContent:"flex-end",children:[i.jsx(ye,{variant:T==="text"?"contained":"outlined",size:"small",onClick:()=>E("text"),children:"Text"}),i.jsx(ye,{variant:T==="table"?"contained":"outlined",size:"small",startIcon:i.jsx(Sw,{fontSize:"small"}),onClick:()=>E("table"),children:"Table"})]}),T==="text"?i.jsx(Ae,{label:"Template Content",value:p.content,onChange:D=>g(P=>({...P,content:D.target.value})),error:!!m.content,helperText:m.content||"Multi-line text description.",fullWidth:!0,multiline:!0,minRows:8,inputRef:O,InputProps:{sx:vue}}):i.jsxs(J,{children:[i.jsx(B,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.75},children:"Paste from Excel/Sheets to fill cells quickly."}),i.jsx(oR,{value:S,onChange:I,disableColumnEditing:!1})]}),m.submit&&i.jsx(Ot,{severity:"error",children:m.submit})]})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:M,disabled:b,children:"Cancel"}),i.jsx(ye,{onClick:F,variant:"contained",disabled:b,children:b?"Saving":w?"Update Template":"Create Template"})]})]})]})},el={"& .MuiOutlinedInput-root":{height:56,borderRadius:1},"& .MuiInputBase-input":{py:1.25,fontSize:16}},vs={fontSize:18,transform:"translate(14px, 18px) scale(1)","&.MuiInputLabel-shrink":{fontSize:14,transform:"translate(14px, -9px) scale(0.9)"}},Fu=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim().toUpperCase(),xue=e=>{switch(e){case"Approved":return{backgroundColor:"rgba(76, 175, 80, 0.12)",color:"#2e7d32"};case"Rejected":return{backgroundColor:"rgba(244, 67, 54, 0.12)",color:"#c62828"};default:return{backgroundColor:"rgba(33, 150, 243, 0.12)",color:"#1565c0"}}},bue=(e,t)=>{const r=Fu(t);return r?e.map(a=>{const o=Fu(a.label);let s=-1;return o.startsWith(r)?s=3:o.split(" ").some(l=>l.startsWith(r))?s=2:o.includes(r)&&(s=1),{opt:a,score:s}}).filter(a=>a.score>=0).sort((a,o)=>o.score-a.score||a.opt.label.localeCompare(o.opt.label)).slice(0,8).map(a=>a.opt):e.slice(0,8)},x4=()=>{const{id:e}=Ms(),t=Nn(),n=!!e&&!(e==="new"),[a,o]=y.useState([]),[s,l]=y.useState([]),[c,u]=y.useState(null),[d,f]=y.useState(null),[h,p]=y.useState(null),[g,m]=y.useState(Rt()),[x,b]=y.useState(Rt().add(30,"day")),[_,w]=y.useState(null),[A,O]=y.useState(""),[T,E]=y.useState(""),[S,I]=y.useState(""),[z,k]=y.useState(""),[M,R]=y.useState(""),[F,W]=y.useState(""),[K,Z]=y.useState(!1),[D,P]=y.useState(null),[$,Q]=y.useState(null),[C,L]=y.useState(!1),[H,U]=y.useState(""),[te,le]=y.useState(null),[oe,ae]=y.useState(!1),he=y.useRef(null),me=y.useRef(null),[X,G]=y.useState(!1),[ee,se]=y.useState(""),[V,He]=y.useState(null),[Ne,Re]=y.useState(!1),[Ke,nt]=y.useState(""),[st,gt]=y.useState(!1),[Ge,Je]=y.useState(""),[We,_t]=y.useState(!1),[Nt,kt]=y.useState(!1),[Vt,jt]=y.useState(!1),[Tr,qe]=y.useState(!1),[$e,Xe]=y.useState(""),[Ue,ht]=y.useState(!1),[at,wt]=y.useState(!1),Tt=y.useCallback(()=>({customer:d?.id||c?.customer_id||null,product:h?.label||c?.product_name||"",quoteDate:g?.toISOString?.()||c?.quote_date||null,validUntil:x?.toISOString?.()||c?.valid_until||null,estimatedCost:_??c?.estimated_cost??null,productDescription:(A||"").trim(),terms:(T||"").trim(),customerPoNumber:(S||"").trim(),vinNumber:(z||"").trim(),vehicleMake:(M||"").trim(),vehicleModel:(F||"").trim()}),[d,c,h,g,x,_,A,T,S,z,M,F]),Jt=y.useCallback(Be=>{O(Be.content),qe(!1),kt(!1),Q(`Template "${Be.name}" inserted into the description.`),window.setTimeout(()=>{if(me.current){const tt=me.current;tt.focus();try{const At=Be.content.length;tt.setSelectionRange(At,At)}catch{}}},0)},[O,kt,Q]),Dr=y.useCallback(()=>{O($w(Fh(18))),qe(!1)},[A]),qr=y.useMemo(()=>mue(A),[A]),ar=!!qr&&!Tr,Er=qr??Fh(18);y.useEffect(()=>{if(Ue&&$e===""){const Be=JSON.stringify(Tt());Xe(Be),console.log("[QuoteEditor] Initial signature set:",Be)}},[Ue,$e,Tt]);const Ir=y.useMemo(()=>JSON.stringify(Tt()),[Tt]),rn=!!$e&&$e!==Ir&&!at;y.useEffect(()=>{$e&&console.log("[QuoteEditor] Signature comparison:",{isDirty:rn,initialSignature:$e.slice(0,100)+"...",currentSignature:Ir.slice(0,100)+"...",signaturesMatch:$e===Ir})},[rn,$e,Ir]),y.useEffect(()=>{Ta(),Dn(),n||ht(!0)},[]),y.useEffect(()=>{!n||!e||(async()=>{try{const Be=await ve.get(`/api/quotes/${e}`),tt={...Be.data,status:Oh(Be.data?.status)};u(tt),f(null),p({label:tt.product_name}),m(Rt(tt.quote_date)),b(Rt(tt.valid_until)),w(Number(tt.estimated_cost??0)),O(tt.product_description||""),E(tt.terms||""),I(tt.customer_po_number||""),k(tt.vin_number||""),R(tt.vehicle_make||""),W(tt.vehicle_model||""),U(tt.customer_name||""),se(tt.product_name||""),ht(!0)}catch(Be){console.error("Failed to load quote:",Be),P("Failed to load quote")}})()},[e,n]),y.useEffect(()=>{if(c&&a.length>0){const Be=a.find(tt=>tt.id===c.customer_id);Be&&f(Be)}},[a,c]),y.useEffect(()=>()=>{te&&window.clearTimeout(te),V&&window.clearTimeout(V)},[te,V]);const Ta=async()=>{try{const tt=((await ve.get("/api/customers")).data||[]).map(At=>({label:At.customer_name,id:At.customer_id,email:At.email}));o(tt)}catch{P("Failed to load customers")}},Dn=async()=>{try{const Be=await ve.get("/api/products");l((Be.data||[]).map(tt=>({label:tt.product_name,id:tt.product_id,description:tt.product_description})))}catch{P("Failed to load products")}},rr=Be=>{const tt=Fu(Be);return a.find(At=>Fu(At.label)===tt)||null},Kr=async()=>{if(!d||!h||!g||!x||_==null){P("Please fill in all required fields");return}Z(!0),wt(!0);try{const Be={customer_id:d.id,product_name:h.label.trim(),quote_date:g.format("YYYY-MM-DD"),valid_until:x.format("YYYY-MM-DD"),estimated_cost:Number(_),product_description:A,terms:T,customer_po_number:S,vin_number:z,vehicle_make:M.trim(),vehicle_model:F.trim(),status:c?.status??"Open"};if(n&&c){const tt=await ve.put(`/api/quotes/${c.quote_id}`,Be);Q("Quote updated successfully");const At=tt?.data;u(At?or=>or&&{...or,...At,status:Oh(At.status??or.status)}:or=>or&&{...or,...Be});const Gt=JSON.stringify(Tt());Xe(Gt),console.log("[QuoteEditor] Signature reset after save:",Gt.slice(0,100)+"..."),setTimeout(()=>{window.__unsavedGuardAllowNext=!0},100)}else{if(window.__quoteCreateInFlight){console.log("[QuoteEditor] Skipping duplicate create (in flight)");return}window.__quoteCreateInFlight=!0;const tt=await ve.post("/api/quotes",Be);Q("Quote created successfully");const At=tt?.data??{},Gt=At.quote_id??At.quoteId??At.id??At?.quote?.quote_id;if(Gt){const or={quote_id:Gt,quote_number:At.quote_number||`Q${Gt}`,customer_id:d.id,customer_name:d.label,quote_date:Be.quote_date,valid_until:Be.valid_until,product_name:Be.product_name,product_description:Be.product_description,estimated_cost:Be.estimated_cost,status:"Open",terms:Be.terms,customer_po_number:Be.customer_po_number,vin_number:Be.vin_number,vehicle_make:Be.vehicle_make,vehicle_model:Be.vehicle_model};u(or),window.__unsavedGuardAllowNext=!0,t(`/quotes/${Gt}`,{replace:!0}),Xe(JSON.stringify(Tt()));return}}}catch(Be){const tt=Be,At=tt.response?.data&&typeof tt.response.data=="object"&&"message"in tt.response.data?tt.response.data.message:"Failed to save quote";P(At)}finally{Z(!1),wt(!1),window.__quoteCreateInFlight=!1}},Yn=async()=>{if(c)try{const Be=await ve.get(`/api/quotes/${c.quote_id}/pdf`,{responseType:"blob"}),tt=window.URL.createObjectURL(new Blob([Be.data])),At=document.createElement("a");At.href=tt,At.setAttribute("download",`Quote_${c.quote_number}.pdf`),document.body.appendChild(At),At.click(),At.parentNode?.removeChild(At),window.URL.revokeObjectURL(tt),Q("PDF downloaded successfully.")}catch{P("Failed to download PDF. Please try again.")}},Mn=()=>{const Be=new Sr({unit:"pt"}),tt=40,At=Be.internal.pageSize.getWidth(),Gt=At-tt*2,or="Estimate Cost";Be.setFontSize(16),Be.setFont("helvetica","bold"),Be.text(or,tt,40),Be.setFontSize(10),Be.setFont("helvetica","normal");let un=58;c?.quote_number&&(Be.text(`Quote: ${c.quote_number}`,tt,un),un+=14),d?.label&&(Be.text(`Customer: ${d.label}`,tt,un),un+=14),h?.label&&(Be.text(`Product: ${h.label}`,tt,un),un+=14);const Ea=[["SN","Item Code","Description","Qty","Unit","Unit Price","Line Total"]],ro=[["1","LABOUR","Labour Hours","52.41","hr","40.00","2096.40"],["2","1705110",'48" ALUM UNDERBODY TOOLBOX',"2","Each","1246.94","2493.88"],["3","3X(3/8)","Flatbar","75","ft","3.91","293.25"],["4","2X2X(3/16)AG L","Angle","10","ft","2.68","26.80"],["5","(3/4)(A36/44W)","HR ROUND - ASTM A36/44W","10","ft","1.67","16.70"],["6","5X3X(1/4)ANG LE3","HEAT # 52118708","20","ft","7.01","140.20"],["7","(4-1)(A36/44W)","CHANNEL ASTM A36/44W","100","ft","4.14","414.00"],["8","83021K05","CLOVAPRIME 21 EPOXY PRIM GREY 5 GAL KIT","1","Each","441.29","441.29"],["9","83904K05","GEMINI AMOURSHIELD BLACK 5G KIT","2","Each","639.73","1279.46"],["10","CLS-AS2620C","CR ANTI SAIL BRACKET","3","Each","8.70","26.10"],["11","AUP-IMXGT-2436CD",'1/4" RUBBER BLACK CHEVRO',"3","Each","19.53","58.59"],["12","SUPPLY","Supply","1","Each","209.64","209.64"],["13","OVERHEAD","Overhead Hours","52.41","hr","30.00","1572.30"]],Un={sn:26,code:80,qty:44,unit:40,unitPrice:72,lineTotal:80},Kn=Un.sn+Un.code+Un.qty+Un.unit+Un.unitPrice+Un.lineTotal,Fi=Math.max(140,Gt-Kn);uue(Be,{head:Ea,body:ro,startY:Math.max(110,un+10),margin:{left:tt,right:tt},tableWidth:Gt,styles:{fontSize:9,cellPadding:4,overflow:"linebreak"},headStyles:{fillColor:[33,150,243],halign:"center"},columnStyles:{0:{cellWidth:Un.sn,halign:"right"},1:{cellWidth:Un.code},2:{cellWidth:Fi},3:{cellWidth:Un.qty,halign:"right"},4:{cellWidth:Un.unit},5:{cellWidth:Un.unitPrice,halign:"right"},6:{cellWidth:Un.lineTotal,halign:"right"}},theme:"striped",didParseCell:dn=>{dn.section==="body"&&[0,3,5,6].includes(dn.column.index)&&(dn.cell.styles.halign="right")}});const ji=Be.lastAutoTable?.finalY||110,Qe="Sub Total: 9068.61",Yt="Total GST: 453.43",sr="Total: 9522.04";Be.setFont("helvetica","bold"),Be.setFontSize(11);const Mr=At-tt;Be.text(Qe,Mr,ji+24,{align:"right"}),Be.text(Yt,Mr,ji+44,{align:"right"}),Be.setFontSize(12),Be.text(sr,Mr,ji+70,{align:"right"});const Ar=c?.quote_number?`Estimate_${c.quote_number}`:"Estimate_Cost";Be.save(`${Ar}.pdf`)},Qr=()=>{Vt||(jt(!0),window.setTimeout(()=>{jt(!1);try{Mn(),Q("Estimate generated successfully.")}catch{P("Failed to generate estimate PDF.")}},15e3))},nn=()=>{if(!c?.quote_id){P("Please save the quote before emailing.");return}_t(!0)},Se=async()=>{if(!c?.quote_id){P("Please save the quote before converting.");return}Z(!0);try{const Be=await ve.post(`/api/quotes/${c.quote_id}/convert-to-sales-order`);Q("Quote converted to sales order successfully!");const tt=Be?.data?.quote;u(tt?Gt=>Gt&&{...Gt,...tt,status:Oh(tt.status??"Approved")}:Gt=>Gt&&{...Gt,status:"Approved"});const At=Be.data.salesOrder?.sales_order_id;setTimeout(At?()=>{t(`/open-sales-orders/${At}`)}:()=>{t("/open-sales-orders")},1500)}catch(Be){const tt=Be,At=tt.response?.data&&typeof tt.response.data=="object"&&"message"in tt.response.data?tt.response.data.message:"Failed to convert quote to sales order";P(At)}finally{Z(!1)}},Ve=Be=>{const tt=H.trim(),At=Be.key==="Enter",Gt=Be.key==="Tab",or=Be.key==="Escape",un=Be.key==="ArrowDown"||Be.key==="ArrowUp";if(or){L(!1);return}if(!un&&(At||Gt)){if(At&&Be.ctrlKey&&tt){Be.preventDefault(),ae(!0),nt(tt),Re(!0);return}const Ea=rr(tt);if(C||!tt)return;Be.preventDefault(),Ea?(f(Ea),U(Ea.label)):(ae(!0),nt(tt),Re(!0))}},it=Be=>{if(Be.key==="Enter"){Be.preventDefault();const tt=ee.trim();if(!tt)return;const At=s.find(Gt=>Gt.label.toLowerCase()===tt.toLowerCase());At?(p(At),se(At.label)):(Je(tt),gt(!0))}},Ct=n&&c?`Edit Quote: ${c.quote_number}`:n?"Edit Quote":"New Quote",Bt=c?c.status:"Open",Ht=Bt==="Approved",mr=Bt==="Rejected",an=async()=>{if(!c?.quote_id){P("Please save the quote before rejecting.");return}if(window.confirm("Are you sure you want to mark this quote as rejected?")){Z(!0);try{const Be=await ve.post(`/api/quotes/${c.quote_id}/reject`),tt=Be?.data?.quote??Be?.data;u(tt?At=>At&&{...At,...tt,status:Oh(tt.status??"Rejected")}:At=>At&&{...At,status:"Rejected"}),Q("Quote marked as rejected.")}catch(Be){const tt=Be,At=tt.response?.data&&typeof tt.response.data=="object"&&"message"in tt.response.data?tt.response.data.message:"Failed to reject quote";P(At)}finally{Z(!1)}}};return i.jsxs(Os,{dateAdapter:oc,children:[i.jsx(qy,{when:rn,onSave:Kr}),i.jsxs(ir,{maxWidth:"lg",sx:{mt:4,mb:4,px:{xs:2,sm:3}},children:[i.jsxs(J,{sx:{maxWidth:1e3,mx:"auto",mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs(ct,{direction:"row",spacing:1.5,alignItems:"center",children:[i.jsx(B,{variant:"h5",sx:{fontWeight:700},children:Ct}),n&&c&&i.jsx(ot,{label:Bt,sx:{fontWeight:600,...xue(Bt)}})]}),i.jsxs(ct,{direction:"row",spacing:1.25,children:[i.jsx(ye,{variant:"contained",color:"primary",startIcon:i.jsx(Is,{}),onClick:Kr,disabled:K,children:n?"SAVE CHANGES":"CREATE QUOTE"}),n&&c&&i.jsxs(i.Fragment,{children:[i.jsx(ye,{variant:"contained",color:"primary",startIcon:i.jsx(bv,{}),onClick:Se,disabled:K||Ht||mr,children:"CONVERT TO SO"}),i.jsx(ye,{variant:"contained",color:"error",startIcon:i.jsx(Cle,{}),onClick:an,disabled:K||Ht||mr,children:"MARK REJECTED"}),i.jsx(ye,{variant:"contained",color:"primary",startIcon:i.jsx(da,{}),onClick:Yn,children:"DOWNLOAD PDF"}),i.jsx(ye,{variant:"contained",startIcon:i.jsx(bS,{}),sx:{backgroundColor:"#ff9800","&:hover":{backgroundColor:"#f57c00"}},onClick:nn,children:"EMAIL QUOTE"})]})]})]}),i.jsx(J,{sx:{maxWidth:1e3,mx:"auto",mt:1.5},children:i.jsx(xt,{sx:{p:3,backgroundColor:"#fff"},elevation:3,children:i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(Fa,{open:C,onOpen:()=>L(!0),onClose:()=>L(!1),autoHighlight:!0,options:a,value:d,onChange:(Be,tt)=>{if(oe){ae(!1);return}tt&&tt.isNew?(Re(!0),nt(H),f(null),U("")):f(tt)},filterOptions:(Be,tt)=>{const At=bue(Be,tt.inputValue||""),Gt=!!(tt.inputValue&&a.some(un=>Fu(un.label)===Fu(tt.inputValue))),or=[...At];return(tt.inputValue||"").trim()!==""&&!Gt&&or.push({label:`Add "${tt.inputValue}" as New Customer`,isNew:!0}),At.length===0&&(tt.inputValue||"").trim()!==""&&!Gt,or},inputValue:H,onInputChange:(Be,tt,At)=>{if(U(tt),te&&window.clearTimeout(te),At==="reset")return;if(tt.trim().length>0){const or=window.setTimeout(()=>L(!0),180);le(or)}else L(!1)},getOptionLabel:Be=>typeof Be=="string"?Be:Be.label,isOptionEqualToValue:(Be,tt)=>Be.id===tt?.id,renderOption:(Be,tt)=>{const At=tt.isNew,{key:Gt,...or}=Be;return i.jsxs("li",{...or,style:{display:"flex",alignItems:"center",opacity:At?.9:1},children:[At&&i.jsx(ec,{fontSize:"small",style:{marginRight:8,color:"#666"}}),i.jsx("span",{children:tt.label})]},Gt)},renderInput:Be=>{const tt=!!Be.inputProps?.value,At=!!d||tt;return i.jsx(Ae,{...Be,label:"Customer",fullWidth:!0,required:!0,onKeyDown:Ve,onBlur:()=>{if(!d){const Gt=H.trim();if(Gt){const or=rr(Gt);or&&(f(or),U(or.label))}}},inputRef:Gt=>{he.current=Gt},sx:el,InputLabelProps:{...Be.InputLabelProps,sx:vs,shrink:At}})}})}),i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(Ae,{label:"Customer PO #",fullWidth:!0,value:S,onChange:Be=>I(Be.target.value),sx:el,InputLabelProps:{sx:vs}})}),i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(Ae,{label:"Estimated Price",type:"number",value:_??"",onChange:Be=>w(Be.target.value===""?null:parseFloat(Be.target.value)),fullWidth:!0,required:!0,InputProps:{startAdornment:i.jsx(oa,{position:"start",children:"$"})},inputProps:{step:"0.01",onWheel:Be=>Be.currentTarget.blur()},sx:el,InputLabelProps:{sx:vs}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Fa,{disablePortal:!0,open:X,onOpen:()=>G(!0),onClose:()=>G(!1),autoHighlight:!0,options:s,value:h,onChange:(Be,tt)=>{if(tt&&tt.isNew){const At=tt.inputValue?.toString?.()||ee.trim();gt(!0),Je(At),p(null),se(""),G(!1)}else p(tt),G(!1)},filterOptions:(Be,tt)=>{const At=Be.filter(Gt=>Gt.label.toLowerCase().includes(tt.inputValue.toLowerCase()));return tt.inputValue!==""&&!Be.some(Gt=>Gt.label.toLowerCase()===tt.inputValue.toLowerCase())&&At.push({label:`Add "${tt.inputValue}"`,isNew:!0,inputValue:tt.inputValue}),At},inputValue:ee,onInputChange:(Be,tt,At)=>{if(se(tt),Je(tt),V&&window.clearTimeout(V),At==="reset")return;if(tt.trim().length>0){const or=window.setTimeout(()=>G(!0),180);He(or)}else G(!1)},getOptionLabel:Be=>typeof Be=="string"?Be:Be.label,isOptionEqualToValue:(Be,tt)=>Be.id===tt?.id,renderInput:Be=>{const tt=!!Be.inputProps?.value,At=!!h||tt;return i.jsx(Ae,{...Be,label:"Product",fullWidth:!0,required:!0,onKeyDown:it,onBlur:()=>{if(!h){const Gt=ee.trim();if(Gt){const or=s.find(un=>un.label.toLowerCase()===Gt.toLowerCase());or&&(p(or),se(or.label))}}},sx:el,InputLabelProps:{...Be.InputLabelProps,sx:vs,shrink:At}})}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Ae,{label:"VIN #",fullWidth:!0,placeholder:"Optional",value:z,onChange:Be=>k(Be.target.value),sx:el,InputLabelProps:{sx:vs}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Ae,{label:"Make",fullWidth:!0,value:M,onChange:Be=>R(Be.target.value),sx:el,InputLabelProps:{sx:vs}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Ae,{label:"Model",fullWidth:!0,value:F,onChange:Be=>W(Be.target.value),sx:el,InputLabelProps:{sx:vs}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(os,{label:"Quote Date",value:g,onChange:Be=>m(Be),slotProps:{textField:{fullWidth:!0,sx:el,InputLabelProps:{sx:vs}}}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(os,{label:"Valid Until",value:x,onChange:Be=>b(Be),slotProps:{textField:{fullWidth:!0,sx:el,InputLabelProps:{sx:vs}}}})}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsxs(ct,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:"Product Description"}),i.jsxs(ct,{direction:"row",spacing:1,children:[i.jsx(ye,{variant:"outlined",size:"small",onClick:()=>kt(!0),children:"Templates"}),i.jsx(ye,{variant:"outlined",size:"small",startIcon:i.jsx(Sw,{fontSize:"small"}),onClick:Dr,children:"Insert Table"}),ar&&i.jsx(ye,{variant:"outlined",size:"small",onClick:()=>qe(!0),children:"Edit As Text"})]})]}),ar?i.jsx(oR,{value:Er,onChange:Be=>O($w(Be)),disableColumnEditing:!1}):i.jsx(Ae,{placeholder:"Add the quote details here...",fullWidth:!0,multiline:!0,minRows:6,value:A,onChange:Be=>O(Be.target.value),inputRef:me,sx:{"& .MuiOutlinedInput-root":{borderRadius:1},"& textarea":{fontSize:15,fontFamily:"Roboto Mono, Consolas, Menlo, monospace",whiteSpace:"pre-wrap"}}}),i.jsxs(J,{sx:{mt:1.5,display:"flex",alignItems:"center",gap:1.5},children:[i.jsx(ye,{variant:"contained",color:"secondary",onClick:Qr,disabled:Vt,children:"ESTIMATE COST"}),Vt&&i.jsxs(ct,{direction:"row",alignItems:"center",spacing:1,children:[i.jsx(nr,{size:22}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Generating estimate"})]})]})]}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{label:"Terms and Conditions",fullWidth:!0,multiline:!0,minRows:4,value:T,onChange:Be=>E(Be.target.value),sx:{"& .MuiOutlinedInput-root":{borderRadius:1},"& .MuiOutlinedInput-input":{fontSize:15}},InputLabelProps:{sx:vs,shrink:!0}})})]})})}),i.jsx(yue,{open:Nt,onClose:()=>kt(!1),onTemplateSelected:Jt,onSuccess:Be=>Q(Be),onError:Be=>P(Be)}),i.jsx(iR,{open:We,onClose:()=>_t(!1),type:"quote",recordId:c?.quote_id,defaultTo:d?.email||"",allowMessageEdit:!0}),i.jsx(Wd,{open:Ne,onClose:()=>Re(!1),onSave:async Be=>{try{const At=(await ve.post("/api/customers",Be)).data,Gt={label:At.customer_name,id:At.customer_id,email:At.email||Be.email};o(or=>[...or,Gt]),f(Gt),Re(!1),U(Gt.label)}catch{P("Failed to add customer")}},initialCustomer:{customer_name:Ke},isEditMode:!1}),i.jsx(SS,{open:st,onClose:()=>gt(!1),onSave:async Be=>{try{const tt=await ve.post("/api/products",Be),At={label:Be.product_name,id:tt.data.product_id,description:Be.product_name};l(Gt=>[...Gt,At]),p(At),se(At.label),gt(!1),Je("")}catch{P("Failed to add product.")}},initialProduct:{product_name:Ge||ee},isEditMode:!1}),i.jsx(pl,{open:!!$,autoHideDuration:6e3,onClose:()=>Q(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>Q(null),severity:"success",sx:{width:"100%"},children:$})}),i.jsx(pl,{open:!!D,autoHideDuration:6e3,onClose:()=>P(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>P(null),severity:"error",sx:{width:"100%"},children:D})})]})]})},_ue=({conversations:e,activeConversationId:t,onSelect:r,onStartConversation:n,isLoading:a=!1,unreadConversationIds:o})=>{const[s,l]=y.useState(""),c=y.useMemo(()=>new Set(o??[]),[o]),u=y.useMemo(()=>{const d=s.trim().toLowerCase();return d?e.filter(f=>{const h=f.displayName.toLowerCase(),p=f.participantNames.toLowerCase();return h.includes(d)||p.includes(d)}):e},[e,s]);return i.jsxs(J,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[i.jsxs(ct,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:2,sx:{mb:2},children:[i.jsx(B,{variant:"h6",component:"h2",children:"Conversations"}),i.jsx(ye,{variant:"contained",startIcon:i.jsx(Iv,{}),onClick:n,size:"small",children:"New"})]}),i.jsx(Ae,{fullWidth:!0,size:"small",placeholder:"Search conversations",value:s,onChange:d=>l(d.target.value),sx:{mb:2}}),i.jsx(Gn,{}),i.jsx(J,{sx:{flexGrow:1,overflowY:"auto"},children:a?i.jsx(J,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",py:4},children:i.jsx(nr,{size:32})}):u.length===0?i.jsx(J,{sx:{textAlign:"center",py:6,px:2},children:i.jsx(B,{variant:"body2",color:"text.secondary",children:s?"No conversations match your search.":"Start a new conversation to begin messaging."})}):i.jsx(ga,{disablePadding:!0,children:u.map(d=>{const f=d.lastMessage?.content,h=d.lastMessageAt||d.updatedAt||d.createdAt,p=Toe(new Date(h),{addSuffix:!0}),g=c.has(d.id);return i.jsxs(Ce.Fragment,{children:[i.jsxs(C8,{selected:d.id===t,alignItems:"flex-start",onClick:()=>r(d.id),sx:{py:1.5,"&.Mui-selected":{backgroundColor:"action.selected"},bgcolor:g?"action.hover":void 0,"& .MuiListItemText-secondary":{display:"-webkit-box",overflow:"hidden",WebkitBoxOrient:"vertical",WebkitLineClamp:2}},children:[i.jsx(A8,{children:i.jsx(Tp,{children:d.displayName.charAt(0).toUpperCase()})}),i.jsx(Jn,{primary:i.jsxs(ct,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:1,children:[i.jsx(B,{variant:"subtitle1",noWrap:!0,sx:{fontWeight:g?600:500},children:d.displayName}),i.jsxs(ct,{direction:"row",alignItems:"center",spacing:1.25,sx:{flexShrink:0},children:[g&&i.jsx(J,{component:"span",sx:{width:8,height:8,borderRadius:"50%",bgcolor:"primary.main"}}),i.jsx(B,{variant:"caption",color:"text.secondary",children:p})]})]}),secondaryTypographyProps:{fontWeight:g?600:void 0},secondary:f||"No messages yet"})]}),i.jsx(Gn,{component:"li"})]},d.id)})})})]})},wue=({onSendMessage:e,disabled:t=!1,placeholder:r="Type your message...",withTopBorder:n=!0})=>{const[a,o]=y.useState(""),s=()=>{a.trim()&&!t&&(e(a.trim()),o(""))},l=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),s())};return i.jsx(xt,{elevation:0,sx:{px:{xs:2,sm:3},py:2.5,borderTop:n?"1px solid":"none",borderColor:"divider",bgcolor:"transparent",backdropFilter:"blur(6px)"},children:i.jsxs(J,{sx:{display:"flex",alignItems:{xs:"stretch",sm:"center"},gap:1.5,bgcolor:"rgba(255, 255, 255, 0.92)",borderRadius:3,px:{xs:1.5,sm:2.5},py:{xs:1.25,sm:1.5},border:"1px solid rgba(148, 163, 184, 0.25)",boxShadow:"0 18px 36px -28px rgba(15, 23, 42, 0.4)"},children:[i.jsx(Ae,{fullWidth:!0,multiline:!0,maxRows:4,value:a,onChange:c=>o(c.target.value),onKeyDown:l,placeholder:r,disabled:t,variant:"standard",size:"medium",sx:{"& .MuiInputBase-root":{fontSize:15,lineHeight:1.7,"&::before, &::after":{display:"none"}},"& textarea":{padding:0}}}),i.jsx(En,{title:"Send message",children:i.jsx("span",{children:i.jsx(pr,{onClick:s,disabled:!a.trim()||t,sx:{bgcolor:"primary.main",color:"common.white",p:1.4,borderRadius:"18px",transition:"transform 0.2s ease, box-shadow 0.2s ease",boxShadow:c=>`0 16px 32px -18px ${c.palette.primary.main}`,"&:hover":{bgcolor:"primary.dark",transform:"translateY(-1px)",boxShadow:c=>`0 20px 38px -20px ${c.palette.primary.dark}`},"&.Mui-disabled":{bgcolor:"grey.200",color:"grey.500",boxShadow:"none",transform:"none"}},children:i.jsx(P8,{fontSize:"small"})})})})]})})};var Vf={},b4;function jue(){if(b4)return Vf;b4=1;var e=cr();Object.defineProperty(Vf,"__esModule",{value:!0}),Vf.default=void 0;var t=e(dr()),r=ur();return Vf.default=(0,t.default)((0,r.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"}),"DeleteOutlineOutlined"),Vf}var Sue=jue();const Cue=It(Sue),Aue=e=>{try{return Ru(new Date(e),"MMM d, yyyy h:mm a")}catch{return e}},Pue=({conversation:e,messages:t,currentUserId:r,isLoading:n,isSending:a,onSendMessage:o,onDeleteMessage:s})=>{const l=y.useRef(null);y.useEffect(()=>{const u=l.current;u&&(u.scrollTop=u.scrollHeight)},[t.length,n]);const c=y.useMemo(()=>e?e.otherParticipants.length>0?e.otherParticipants.map(u=>u.username||u.email||"Unknown user").join(", "):e.participantNames:"",[e]);return e?i.jsxs(xt,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[i.jsxs(J,{sx:{p:2},children:[i.jsx(B,{variant:"h6",component:"h2",children:e.displayName}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:c})]}),i.jsx(Gn,{}),i.jsx(J,{ref:l,sx:{flexGrow:1,overflowY:"auto",p:2},children:n?i.jsx(J,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:i.jsx(nr,{size:36})}):t.length===0?i.jsx(J,{sx:{textAlign:"center",color:"text.secondary",mt:6},children:i.jsx(B,{variant:"body2",children:"No messages yet. Start the conversation below."})}):i.jsx(ct,{spacing:2,children:t.map(u=>{const d=r!==null&&u.senderId===r,f=!!u.isDeletedForUser,h=d?"flex-end":"flex-start",p=u.error?"error.light":f?"grey.300":d?"primary.main":"grey.100",g=u.error?"error.dark":f?"text.secondary":d?"common.white":"text.primary",m=!f&&!u.error&&!u.pending&&typeof u.id=="number",x=f?d?"You deleted this message":"Message deleted":u.content;return i.jsx(J,{sx:{display:"flex",justifyContent:h},children:i.jsxs(J,{sx:{maxWidth:"75%",display:"flex",flexDirection:"column",gap:.5},children:[i.jsxs(xt,{elevation:d?3:1,sx:{p:1.5,bgcolor:p,color:g,borderRadius:2,border:u.error?"1px solid":"none",borderColor:u.error?"error.main":void 0,position:"relative"},children:[i.jsxs(ct,{spacing:.5,children:[i.jsx(B,{variant:"caption",sx:{opacity:d?.85:.6},children:u.senderName||(d?"You":"Unknown user")}),i.jsx(B,{variant:"body2",sx:{whiteSpace:"pre-wrap",fontStyle:f?"italic":"normal"},children:x}),i.jsx(B,{variant:"caption",sx:{opacity:d?.85:.6,textAlign:"right"},children:Aue(u.createdAt)})]}),m&&i.jsx(En,{title:"Delete for me",children:i.jsx(pr,{size:"small",onClick:()=>s(Number(u.id)),sx:{position:"absolute",top:4,right:4,color:d?"common.white":"text.secondary",bgcolor:d?"rgba(255,255,255,0.1)":"transparent","&:hover":{bgcolor:d?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.04)"}},children:i.jsx(Cue,{fontSize:"inherit"})})})]}),u.pending&&!u.error&&i.jsx(ot,{label:"Sending...",size:"small",color:"default",sx:{alignSelf:d?"flex-end":"flex-start",mt:.5}}),u.error&&i.jsx(B,{variant:"caption",color:"error",sx:{alignSelf:d?"flex-end":"flex-start"},children:"Failed to send. Please try again."})]})},u.id)})})}),i.jsx(Gn,{}),i.jsx(wue,{onSendMessage:u=>o(u),disabled:a})]}):i.jsx(xt,{sx:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",p:4},children:i.jsx(B,{variant:"body1",color:"text.secondary",align:"center",children:"Select a conversation to view messages or start a new chat."})})},Oue=()=>{const{user:e}=ea(),t=e?Number(e.id):null,{conversations:r,isLoadingConversations:n,activeConversationId:a,selectConversation:o,messagesByConversation:s,isLoadingMessages:l,sendMessage:c,createConversation:u,loadMessages:d,deleteMessage:f,unreadConversationIds:h}=wN(),[p,g]=y.useState([]),[m,x]=y.useState(!1),[b,_]=y.useState(!1),[w,A]=y.useState([]),[O,T]=y.useState(""),[E,S]=y.useState(!1),[I,z]=y.useState(!1);y.useEffect(()=>{let $=!0;return(async()=>{try{x(!0);const C=await ve.get("/api/employees");if(!$)return;const H=(Array.isArray(C.data)?C.data:[]).map(U=>({id:Number(U.id),username:U.username??null,email:U.email??null,access_role:U.access_role})).filter(U=>U.id!==t).sort((U,te)=>{const le=(U.username||U.email||"").toLowerCase(),oe=(te.username||te.email||"").toLowerCase();return le.localeCompare(oe)});g(H)}catch(C){console.error("Failed to load employees",C),ge.error("Unable to load team members.")}finally{$&&x(!1)}})(),()=>{$=!1}},[t]);const k=y.useMemo(()=>r.find($=>$.id===a),[a,r]),M=a?s[a]??[]:[],R=a?!!l[a]:!1,F=()=>{A([]),T(""),_(!0)},W=()=>{E||_(!1)},K=async()=>{if(w.length===0){ge.error("Select at least one teammate to start a conversation.");return}const $=w.map(C=>C.id),Q=$.length>1?"group":"direct";if(Q==="group"&&!O.trim()){ge.error("Enter a name for the group conversation.");return}try{S(!0);const C=await u({participantIds:$,title:Q==="group"?O.trim():void 0,type:Q}),{conversation:L,created:H}=C;ge.success(H?"Conversation created successfully.":"Conversation already existed. Opening chat."),_(!1),A([]),T(""),await d(L.id,{force:!0})}catch(C){console.error("Failed to create conversation",C),ge.error("Unable to start conversation. Please try again.")}finally{S(!1)}},Z=async $=>{if(!a){ge.error("Select a conversation before sending a message.");return}try{z(!0),await c(a,$)}catch(Q){console.error("Failed to send message",Q),ge.error("Failed to send message. Please try again.")}finally{z(!1)}},D=async $=>{if(!a){ge.error("Select a conversation before deleting a message.");return}try{await f(a,$),ge.info("Message deleted for you.")}catch(Q){console.error("Failed to delete message",Q),ge.error("Unable to delete message. Please try again.")}},P=y.useMemo(()=>p,[p]);return i.jsxs(J,{sx:{display:"flex",flexDirection:"column",height:"100%",p:{xs:2,md:3},gap:3},children:[i.jsxs(ct,{spacing:1,children:[i.jsx(B,{variant:"h4",component:"h1",children:"Messaging"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Collaborate with your team using direct messages and group chats."})]}),i.jsxs(xt,{elevation:0,sx:{flexGrow:1,minHeight:{xs:480,md:540},display:"flex",flexDirection:{xs:"column",md:"row"},borderRadius:3,overflow:"hidden",border:"1px solid",borderColor:"divider",backgroundColor:"background.paper"},children:[i.jsx(J,{sx:{width:{xs:"100%",md:340},flexShrink:0,borderRight:{md:"1px solid",xs:"none"},borderColor:"divider",backgroundColor:"background.default"},children:i.jsx(J,{sx:{height:"100%",p:{xs:2,md:2.5}},children:i.jsx(_ue,{conversations:r,activeConversationId:a,onSelect:o,onStartConversation:F,isLoading:n,unreadConversationIds:h})})}),i.jsx(Gn,{orientation:"vertical",flexItem:!0,sx:{display:{xs:"none",md:"block"}}}),i.jsx(J,{sx:{flex:1,p:{xs:2,md:2.5},display:"flex",flexDirection:"column",backgroundColor:"background.paper"},children:i.jsx(Pue,{conversation:k,messages:M,currentUserId:t,isLoading:R,isSending:I,onSendMessage:Z,onDeleteMessage:D})})]}),i.jsxs(gr,{open:b,onClose:W,fullWidth:!0,maxWidth:"sm",children:[i.jsx(vr,{children:"Start a Conversation"}),i.jsx(yr,{dividers:!0,children:i.jsxs(ct,{spacing:2,sx:{mt:1},children:[i.jsx(Fa,{multiple:!0,options:P,value:w,onChange:($,Q)=>A(Q),getOptionLabel:$=>$.username||$.email||`User ${$.id}`,renderOption:($,Q)=>y.createElement("li",{...$,key:Q.id},i.jsxs(ct,{spacing:.25,children:[i.jsx(B,{variant:"body2",children:Q.username||Q.email||`User ${Q.id}`}),Q.email&&i.jsx(B,{variant:"caption",color:"text.secondary",children:Q.email})]})),filterSelectedOptions:!0,renderInput:$=>i.jsx(Ae,{...$,label:"Participants",placeholder:"Select team members",helperText:"Choose one teammate for a direct chat or multiple for a group conversation."}),loading:m,loadingText:"Loading team members..."}),w.length>1&&i.jsx(Ae,{label:"Group name",value:O,onChange:$=>T($.target.value),placeholder:"e.g., Operations Leads",inputProps:{maxLength:80}})]})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:W,disabled:E,children:"Cancel"}),i.jsx(ye,{variant:"contained",onClick:K,disabled:E||w.length===0||w.length>1&&!O.trim(),children:E?"Creating":"Start"})]})]})]})};var Gf={},_4;function kue(){if(_4)return Gf;_4=1;var e=cr();Object.defineProperty(Gf,"__esModule",{value:!0}),Gf.default=void 0;var t=e(dr()),r=ur();return Gf.default=(0,t.default)((0,r.jsx)("path",{d:"m19 9 1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25zm-7.5.5L9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12zM19 15l-1.25 2.75L15 19l2.75 1.25L19 23l1.25-2.75L23 19l-2.75-1.25z"}),"AutoAwesome"),Gf}var Tue=kue();const Uw=It(Tue);var Yf={},w4;function Eue(){if(w4)return Yf;w4=1;var e=cr();Object.defineProperty(Yf,"__esModule",{value:!0}),Yf.default=void 0;var t=e(dr()),r=ur();return Yf.default=(0,t.default)([(0,r.jsx)("path",{d:"M21 8c-1.45 0-2.26 1.44-1.93 2.51l-3.55 3.56c-.3-.09-.74-.09-1.04 0l-2.55-2.55C12.27 10.45 11.46 9 10 9c-1.45 0-2.27 1.44-1.93 2.52l-4.56 4.55C2.44 15.74 1 16.55 1 18c0 1.1.9 2 2 2 1.45 0 2.26-1.44 1.93-2.51l4.55-4.56c.3.09.74.09 1.04 0l2.55 2.55C12.73 16.55 13.54 18 15 18c1.45 0 2.27-1.44 1.93-2.52l3.56-3.55c1.07.33 2.51-.48 2.51-1.93 0-1.1-.9-2-2-2"},"0"),(0,r.jsx)("path",{d:"m15 9 .94-2.07L18 6l-2.06-.93L15 3l-.92 2.07L12 6l2.08.93zM3.5 11 4 9l2-.5L4 8l-.5-2L3 8l-2 .5L3 9z"},"1")],"Insights"),Yf}var Iue=Eue();const Nue=It(Iue);var Kf={},j4;function Due(){if(j4)return Kf;j4=1;var e=cr();Object.defineProperty(Kf,"__esModule",{value:!0}),Kf.default=void 0;var t=e(dr()),r=ur();return Kf.default=(0,t.default)((0,r.jsx)("path",{d:"M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2m-5 12H9v-2h6zm5-7H4V4l16-.02z"}),"Inventory"),Kf}var Mue=Due();const Lue=It(Mue);var Qf={},S4;function Rue(){if(S4)return Qf;S4=1;var e=cr();Object.defineProperty(Qf,"__esModule",{value:!0}),Qf.default=void 0;var t=e(dr()),r=ur();return Qf.default=(0,t.default)((0,r.jsx)("path",{d:"M4.25 5.61C6.27 8.2 10 13 10 13v6c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-6s3.72-4.8 5.74-7.39c.51-.66.04-1.61-.79-1.61H5.04c-.83 0-1.3.95-.79 1.61"}),"FilterAlt"),Qf}var que=Rue();const Fue=It(que),bl={version:"1.0",domain:"truck_trailer_fabrication",description:"Master synonym + normalization dictionary for searching truck/trailer fabrication parts by description and number.",abbreviation_map:{GR:["grade"],GR2:["grade 2"],GR5:["grade 5"],GR8:["grade 8","high tensile"],G2:["grade 2"],G5:["grade 5"],G8:["grade 8"],NC:["national coarse","coarse thread"],NF:["national fine","fine thread"],UNC:["unified national coarse"],UNF:["unified national fine"],UN:["unified thread"],STOVER:["prevailing torque","locknut"],LOCKNUT:["lock nut","torque nut"],CSK:["countersunk"],PL:["plow","plow bolt"],HD:["heavy duty"],HT:["high tensile"],HEX:["hex head","hexagon head"],HHCS:["hex head cap screw"],CAP:["cap screw","cap bolt"],BOLT:["bolt","cap screw"],SCREW:["screw"],ROD:["rod","ready rod","all-thread"],RR:["ready rod","all-thread"],RRD:["ready rod","all-thread"],NUT:["nut"],WASH:["washer"],WASHER:["washer"],STL:["steel"],AL:["aluminum"],ALUM:["aluminum"],SS:["stainless steel"],SS304:["stainless steel 304"],SS316:["stainless steel 316"],GALV:["galvanized"],GALVANIZING:["galvanized coating","zinc rich coating"],ZINC:["zinc plated"],BRZ:["bronze"],BRASS:["brass"],COP:["copper"],HR:["hot rolled"],HRS:["hot rolled steel"],CR:["cold rolled"],HSS:["hollow structural section"],QT:["quenched and tempered"],QT100:["quenched and tempered 100 ksi plate"],A36:["ASTM A36 structural steel"],A53:["ASTM A53 pipe"],A500:["ASTM A500 tube"],CSA:["canadian standards association"],ASTM:["american society for testing and materials"],GA:["gauge"],GAUGE:["gauge"],SCH:["schedule"],OD:["outside diameter"],ID:["inside diameter"],NPT:["national pipe thread tapered"],MPT:["male pipe thread"],FPT:["female pipe thread"],M:["male"],F:["female"],MNPT:["male npt"],FNPT:["female npt"],ELB:["elbow"],ELBOW:["elbow"],TEE:["tee"],CAPS:["caps","end caps"],FLG:["flange"],FLANGE:["flange"],TTMA:["ttma flange pattern"],VALVE:["valve"],CHK:["check"],DC:["dual check","direct current (context dependent)"],CV:["check valve"],STT:["stop turn tail"],"ST/T":["stop tail turn"],"STT/T":["stop tail turn"],"B/U":["back up"],BACKUP:["back up"],BU:["back up"],CLR:["clearance"],MARKER:["marker light"],IDLF:["identification light function"],LED:["led","light emitting diode"],INCAND:["incandescent"],LAMP:["light","lamp"],LIC:["license"],LICENCE:["license"],PLUG:["plug"],PIGTAIL:["pigtail harness"],JBOX:["junction box"],JUNCTION:["junction"],"JUNCTION BOX":["junction box"],CABLE:["cable","wire"],WIRE:["wire"],SYNFLEX:["air brake nylon hose"],AIRLINE:["air line"],AB:["air brake"],ABS:["anti lock brake system"],AXL:["axle"],AXLE:["axle"],SPR:["spring"],EQ:["equalizer"],EQUALIZER:["equalizer"],HUB:["hub"],DRUM:["drum"],SHOE:["brake shoe"],LINED:["lined"],GLAD:["gladhand"],GH:["gladhand"],CAM:["camshaft","s-cam"],SLACK:["slack adjuster"],SUSP:["suspension"],SUSPENSION:["suspension"],JACK:["jack"],DL:["dropleg"],DROPLEG:["dropleg"],LEG:["leg"],COUPLER:["coupler"],EYE:["lunette eye"],LUNETTE:["lunette ring"],ADJ:["adjustable"],ADJUST:["adjustable"],"25K":["25000 lb","25,000 lb"],"20K":["20000 lb","20,000 lb"],TUBE:["tube"],TUBING:["tubing"],PIPE:["pipe"],CH:["channel"],CHANNEL:["channel"],ANG:["angle"],ANGLE:["angle"],PLATE:["plate"],BAR:["bar"],FLAT:["flat bar"],FB:["flat bar"],DECK:["decking"],DECKING:["decking"],FIR:["douglas fir"],"T&G":["tongue and groove"],"S-DRY":["surface dry"],"S DRY":["surface dry"],INV:["invoice"],PO:["purchase order"],ENV:["environmental"],ECO:["environmental"],FEE:["fee"],KIT:["kit"],ASSY:["assembly"],ASSM:["assembly"],ASM:["assembly"],WLD:["welded"],WELD:["weld"],WELDED:["welded"],GLV:["gloves"],GLVS:["gloves"],OZ:["ounce"],LB:["pound"],PK:["pack"],BG:["bag"],EA:["each"],EACH:["each"],FT:["foot","feet"],IN:["inch","inches"],MM:["millimeter","millimetre"],CM:["centimeter","centimetre"],WHEEL:["wheel"],RIM:["rim"],TIRE:["tire"],TYRE:["tire"],RECYCLE:["recycle"],RECYCLING:["recycling"],ECOFEE:["environmental fee","tire levy"]},material_grade_map:{A36:["mild steel","astm a36"],A53:["astm a53 pipe","standard pipe"],A500B:["astm a500 grade b tube"],HSS:["structural tube","hollow structural section"],QT100:["quenched and tempered 100 ksi plate"],"350W":["csa g40.21 350w structural steel"],"44W":["csa g40.21 44w structural steel"],"50W":["csa g40.21 50w structural steel"],"CSA G40.21":["csa g40.21 structural steel specification"],"H.S.S":["hollow structural section"],FIR:["douglas fir lumber"],SPF:["spruce pine fir lumber"]},finish_map:{"HOT DIP GALV":["hot dip galvanized"],GALV:["galvanized"],GALVANIZED:["galvanized"],"ZINC PLATED":["zinc plated"],ZP:["zinc plated"],PRIMED:["shop primed"],PRIMER:["primer coated"],PAINTED:["painted finish"],PLAIN:["no coating","mill finish"],MILL:["mill finish"],"BRIGHT GALVANIZING":["zinc rich galvanizing spray","cold galvanizing"],"SS POLISHED":["polished stainless"]},thread_map:{NC:["coarse","unc"],NF:["fine","unf"],UNC:["coarse","unified coarse"],UNF:["fine","unified fine"],NPT:["tapered pipe thread"],NPS:["straight pipe thread"],MPT:["male npt","male pipe thread"],FPT:["female pipe thread"],NS:["national special thread"],DRYSEAL:["nptf","dryseal pipe thread"]},product_type_keywords:{fasteners:["bolt","cap screw","screw","machine screw","ready rod","all-thread","nut","stover","locknut","jam nut","flange nut","washer","flat washer","lock washer","split lock","rivets","blind rivet","huck","pins","cotter pin","hitch pin","spring pin"],structural_steel:["plate","qt100","qt 100","hss","tube","tubing","pipe","channel","c-channel","c shape","angle","angle iron","flat bar","round bar","square bar","frame rail","rail","decking","t&g","checker plate","floor plate"],lumber:["2x4","2x6","2x8","fir","spf","decking","t&g","tongue and groove","spruce","pine"],trailer_running_gear:["axle","hub","drum","rotor","spindle","bearing","seal","dust cap","spring","leaf spring","equalizer","hanger","shackle","u-bolt","u bolt","torque arm","suspension"],brake_system:["air tank","air brake","hose","air line","synflex","gladhand","slack adjuster","brake shoe","cam","s-cam","valve","relay valve","foot valve","abs","anti lock","chamber","brake kit","anti lock brakes kit"],lighting_electrical:["led","lamp","light","marker","clearance","stop","tail","turn","stt","b/u","backup","license","pigtail","plug","connector","junction box","cable","wire","trailer cable","7-way","7way","4-way","4way","breakaway","battery box","battery"],coupling_jacks:["jack","dropleg","drop leg","sidewind","topwind","jack foot","coupler","ball coupler","lunette","eye coupler","adjustable coupler","pintle","kingpin"],body_components:["fender","fender steps","stake pocket","rub rail","d-ring","tie down","winch","winch track","bumper","step","ladder","toolbox","door latch","hinge","hood catch"],consumables:["grinding wheel","cutting disc","wire wheel","welding rod","mig wire","anti-seize","grease","spray paint","primer","galvanizing spray","shop towels","gloves","zip tie","shrink tube"],fluid_lubricants:["10w30","15w40","gear oil","hydraulic oil","grease","brake cleaner","penetrant","anti-seize","silicone"],documentation_misc:["invoice","po","document holder","registration tube","permit holder","label","tag"]},tire_wheel_keywords:{rim:["wheel rim","steel rim"],"steel rim":["steel wheel","rim steel"],hub_pilot:["hub piloted","piloted wheel"],stud_pilot:["stud piloted"],tire:["tire","tyre"],recycling_fee:["tire recycling","eco fee","environmental fee","tire levy"]},pipe_tube_patterns:{pipe_designation_keywords:["a53","schedule","sch","pipe","nom","nominal"],tube_designation_keywords:["hss","rect tube","square tube","round tube","a500"],common_schedules:["10","20","40","80"],examples:['2" sch 40 pipe',"2in sch40 a53","3 x 2 x 0.250 hss","3x2x1/4 hss"]},dimension_patterns:[{name:"fractional_dia_by_length_inch",description:"Patterns like 3/8X1, 3/8 X 1-1/2, 1/2-13 x 2",regexes:["(?<diameter>\\d+/\\d+|\\d+\\.?\\d*)(?:\\s*[xX-]\\s*)(?<length>\\d+/\\d+|\\d+\\.?\\d*)"],normalized_form:"{diameter} x {length} in"},{name:"nominal_pipe_size_with_schedule",description:'Pipe like 2" SCH 40, 0 2 P 2(nom) X .154 (SCH 40)',regexes:['(?<nominal>\\d+(?:/\\d+)?)\\s*\\"?\\s*(?:NOM|nom)?\\s*(?:X|x)?\\s*(?<wall>\\d*\\.?\\d+)?\\s*\\(?(?:SCH|Sch|schedule)\\s*(?<schedule>10|20|40|80)\\)?'],normalized_form:"{nominal} in pipe SCH {schedule}"},{name:"rectangular_hss",description:"Rectangular hollow section, e.g., 3 X 2 X .250 HSS",regexes:["(?<depth>\\d+\\.?\\d*)\\s*[xX]\\s*(?<width>\\d+\\.?\\d*)\\s*[xX]\\s*(?<thickness>\\d*\\.?\\d+)\\s*(?:HSS|hss)?"],normalized_form:"HSS {depth} x {width} x {thickness}"},{name:"plate_thickness",description:"Plate like 1/4 PL, 3/8 PLATE, .250 PL",regexes:["(?<thickness>\\d+/\\d+|\\d*\\.?\\d+)\\s*(?:PL|plate|PLT)"],normalized_form:"{thickness} in plate"},{name:"ga_thickness",description:"Gauge thickness e.g., 14 GA, 11 GA",regexes:["(?<gauge>\\d+)\\s*(?:GA|ga|gauge)"],normalized_form:"{gauge} gauge"},{name:"lumber_2x",description:"Lumber e.g., 2X6-16, 2x8x12",regexes:["2\\s*[xX]\\s*(?<width>\\d+)\\s*(?:[-xX]\\s*(?<length>\\d+))?"],normalized_form:"2 x {width}{length_ft}",length_ft_suffix:" ft"}],part_number_normalization:{strip_characters:[" ","	",`
`,"\r"],collapse_characters_to_dash:["_","/"],remove_leading_zeros:!0,case:"upper",examples_equivalent:[["01202616A","1202616-A"],["066366630152","66366630152"],["01-117","01117"]]},description_normalization:{to_upper:!0,replace_characters:{"":'"',"":'"',"":"'","":"-","":"x"},collapse_whitespace:!0,remove_punctuation_except:["/","-",'"',"."]},unit_map:{EA:"each",EACH:"each",PC:"each",PCS:"each",FT:"foot",IN:"inch",'"':"inch",MM:"millimeter",CM:"centimeter",M:"meter",PK:"pack",PKG:"package",BG:"bag",SET:"set",LB:"pound",OZ:"ounce",GAL:"gallon",L:"liter"},stopwords:["THE","AND","&","OF","FOR","WITH","W/","IN","ON","OR","TO","BY","EA","EACH","NEW","OLD","ASSY","KIT"],category_inference_rules:[{category:"fasteners",if_description_contains_any:["BOLT","SCREW","NUT","WASHER","RIVET","READY ROD","ALL THREAD","STOVER"]},{category:"structural_steel",if_description_contains_any:["HSS","PLATE","ANGLE","CHANNEL","TUBE","PIPE","FRAME RAIL","QT100","A36","A53","350W","50W"]},{category:"lighting_electrical",if_description_contains_any:["LED","LAMP","LIGHT","MARKER","CLEARANCE","STT","STOP","TAIL","TURN","B/U","BACK UP","JUNCTION BOX","PIGTAIL","CABLE","WIRE"]},{category:"brake_system",if_description_contains_any:["AIR BRAKE","SYNFLEX","GLADHAND","SLACK ADJ","BRAKE SHOE","CAM","ABS","AIR TANK","CHAMBER"]},{category:"trailer_running_gear",if_description_contains_any:["AXLE","HUB","DRUM","SPINDLE","SPRING","EQUALIZER","HANGER","U-BOLT","U BOLT"]},{category:"coupling_jacks",if_description_contains_any:["JACK","DROPLEG","COUPLER","LUNETTE","EYE COUPLER","PINTLE","KINGPIN"]},{category:"tire_wheel",if_description_contains_any:["RIM","WHEEL","TIRE","HUB PILOT","STUD PILOT","STEEL RIM"]},{category:"consumables",if_description_contains_any:["GRINDING WHEEL","CUT OFF","WIRE WHEEL","SPRAY","PAINT","PRIMER","GALVANIZING","GLVS","GLOVES","SHRINK TUBE","ZIP TIE"]}]},$ue=new Set((bl.stopwords||[]).map(e=>e.toUpperCase())),C4=e=>(e||"").split(/[^A-Za-z0-9]+/).map(t=>t.trim()).filter(Boolean).map(t=>t.toUpperCase()),Bue=e=>{const t=new Map,r=(a,o)=>{if(!a||!o||a===o)return;const s=a.toUpperCase(),l=o.toUpperCase();t.has(s)||t.set(s,new Set),t.get(s).add(l)},n=a=>{a&&Object.entries(a).forEach(([o,s])=>{const l=Array.isArray(s)?s:[s],c=new Set;C4(o).forEach(d=>c.add(d)),l.forEach(d=>C4(String(d)).forEach(f=>c.add(f)));const u=Array.from(c);u.forEach(d=>u.forEach(f=>r(d,f)))})};return n(e.abbreviation_map),n(e.material_grade_map),n(e.finish_map),n(e.thread_map),n(e.unit_map),t},Uue=Bue(bl),CS=(e,t=bl)=>{if(!e)return"";let r=String(e);const n=t.description_normalization?.replace_characters||{};Object.entries(n).forEach(([s,l])=>{const c=String(s),u=String(l);r=r.split(c).join(u)});const a=[...t.description_normalization?.remove_punctuation_except??[]],o=new RegExp(`[^A-Za-z0-9\\s${a.map(s=>"\\"+s).join("")}]+`,"g");return r=r.replace(o," "),t.description_normalization?.collapse_whitespace&&(r=r.replace(/\s+/g," ")),t.description_normalization?.to_upper&&(r=r.toUpperCase()),r.trim()},sR=(e,t=bl)=>{if(!e)return"";let r=String(e);return[...t.part_number_normalization?.strip_characters??[]].forEach(o=>{const s=new RegExp(o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g");r=r.replace(s,"")}),[...t.part_number_normalization?.collapse_characters_to_dash??[]].forEach(o=>{const s=new RegExp(o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g");r=r.replace(s,"-")}),t.part_number_normalization?.remove_leading_zeros&&(r=r.replace(/(^|[^0-9])0+([0-9]+)/g,"$1$2"),r=r.replace(/^0+/,"")),t.part_number_normalization?.case==="upper"&&(r=r.toUpperCase()),r.trim()},zue=e=>(e.dimension_patterns||[]).map(t=>({...t,regexes:t.regexes.map(r=>new RegExp(r,"gi"))})),Wue=zue(bl),Hue=(e,t)=>{let r=e.normalized_form||"";return r=r.replace(/\{(\w+)\}/g,(n,a)=>t[a]||""),e.length_ft_suffix&&t.length?r=r.replace("{length_ft}",`${t.length}${e.length_ft_suffix}`):r=r.replace("{length_ft}",t.length||""),r.replace(/\s+/g," ").trim().toUpperCase()},lR=e=>{const t=new Set;if(!e)return t;for(const r of Wue)for(const n of r.regexes){let a;for(;(a=n.exec(e))!==null;){const o=a.groups||{},s=Hue(r,o);s&&t.add(s)}n.lastIndex=0}return t},cR=e=>CS(e).split(/[^A-Z0-9]+/).map(r=>r.trim()).filter(r=>r.length>0&&!$ue.has(r)),uR=e=>{const t=new Set;for(const r of e){const n=r.toUpperCase();t.add(n);const a=Uue.get(n);a&&a.forEach(o=>t.add(o))}return t},A4=(e,t)=>{const r=new Set;return e.forEach(n=>{t.has(n)&&r.add(n)}),r},Vue=(e,t=bl)=>{if(!e)return;const r=e.toUpperCase();for(const n of t.category_inference_rules||[])if(n.if_description_contains_any?.some(a=>r.includes(a)))return n.category},Gue=(e,t=bl)=>e.map(r=>{const n=`${r.part_number||""} ${r.part_description||""}`,a=uR(cR(n)),o=lR(n),s=sR(r.part_number||"",t),l=CS(r.part_description||"",t),c=r.category||Vue(l,t);return{item:r,tokenSet:a,dimensionSet:o,normalizedPartNumber:s,normalizedDescription:l,categoryHint:c}}),zw=e=>{const t=CS(e),r=sR(e),n=cR(e),a=uR(n),o=lR(e);return{normalized:t,normalizedPartNumber:r,tokens:n,expandedTokens:Array.from(a),dimensions:Array.from(o)}},Yue=(e,t)=>{const r=t.trim();if(!r)return[];const{normalized:n,normalizedPartNumber:a,expandedTokens:o,dimensions:s}=zw(r),l=new Set(o),c=new Set(s),u=[];for(const d of e){const f=A4(d.tokenSet,l),h=A4(d.dimensionSet,c),p=a.length>0&&d.normalizedPartNumber.includes(a),g=n.length>2&&d.normalizedDescription.includes(n);let m=0;if(m+=f.size*2,m+=h.size*3,p&&(m+=5),g&&(m+=2),m>0){const x=d.categoryHint&&(l.has(d.categoryHint.toUpperCase())||n.includes(d.categoryHint.toUpperCase()))?d.categoryHint:void 0;u.push({item:d.item,score:m,matchedTokens:Array.from(f),matchedDimensions:Array.from(h),matchedCategory:x,partNumberMatched:p,descriptionMatched:g})}}return u.sort((d,f)=>f.score-d.score||String(d.item.part_number||"").localeCompare(String(f.item.part_number||"")))},Kue=()=>{const[e,t]=y.useState(""),[r,n]=y.useState("all"),[a,o]=y.useState([]),[s,l]=y.useState(!1),[c,u]=y.useState(null),[d,f]=y.useState([]),[h,p]=y.useState(()=>zw("")),g=y.useMemo(()=>Gue(a),[a]),m=y.useCallback(async()=>{l(!0),u(null);try{const _=await Oy(r==="all"?void 0:r);o(_||[])}catch(_){console.error("Failed to load inventory for smart search",_);const w=_?.response?.data?.message||_?.message||"Could not load inventory. Check your connection and try again.";u(w)}finally{l(!1)}},[r]);y.useEffect(()=>{m()},[m]),y.useEffect(()=>{const _=()=>m();return window.addEventListener("inventory-updated",_),()=>window.removeEventListener("inventory-updated",_)},[m]),y.useEffect(()=>{const _=setTimeout(()=>{p(zw(e)),f(Yue(g,e))},180);return()=>clearTimeout(_)},[e,g]);const x=(_,w,A)=>i.jsxs(ct,{direction:"row",spacing:1,flexWrap:"wrap",alignItems:"center",children:[i.jsx(B,{variant:"caption",color:"text.secondary",sx:{minWidth:120,fontWeight:600},children:_}),w.length===0&&A?i.jsx(B,{variant:"caption",color:"text.disabled",children:A}):w.slice(0,24).map(O=>i.jsx(ot,{label:O,size:"small"},`${_}-${O}`))]}),b=y.useMemo(()=>{const _=new Set(h.expandedTokens);return h.tokens.forEach(w=>_.delete(w)),Array.from(_)},[h]);return i.jsxs(J,{children:[i.jsx(xt,{elevation:0,sx:{p:3,mb:3,borderRadius:3,background:"linear-gradient(120deg, #0f172a, #0b5dab)",color:"white"},children:i.jsxs(ct,{direction:{xs:"column",md:"row"},spacing:2,alignItems:"flex-start",justifyContent:"space-between",children:[i.jsxs(J,{children:[i.jsxs(ct,{direction:"row",spacing:1,alignItems:"center",mb:1,children:[i.jsx(Uw,{fontSize:"small"}),i.jsxs(B,{variant:"body2",sx:{letterSpacing:.5},children:["Dictionary-driven search  v",bl.version]})]}),i.jsx(B,{variant:"h4",fontWeight:800,children:"Smart Inventory Search"}),i.jsx(B,{variant:"body1",sx:{opacity:.8,maxWidth:720,mt:1},children:"Find parts using abbreviations, grades, finishes, or full descriptions. The search engine expands synonyms, grades, and dimensions from the truck/trailer fabrication dictionary before matching against your inventory."})]}),i.jsxs(ct,{spacing:1.5,alignItems:{xs:"flex-start",md:"flex-end"},children:[i.jsx(ot,{icon:i.jsx(Lue,{}),label:`${a.length} parts indexed`,variant:"filled",color:"default",sx:{bgcolor:"rgba(255,255,255,0.12)",color:"white"}}),i.jsx(ot,{icon:i.jsx(Nue,{}),label:`Domain: ${bl.domain}`,variant:"outlined",sx:{borderColor:"rgba(255,255,255,0.4)",color:"white"}})]})]})}),i.jsx(xt,{elevation:1,sx:{p:2.5,mb:2.5,borderRadius:3},children:i.jsxs(ct,{spacing:2,children:[i.jsxs(ct,{direction:{xs:"column",md:"row"},spacing:2,alignItems:{xs:"stretch",md:"center"},children:[i.jsx(J,{sx:{flex:1,position:"relative"},children:i.jsx(Ae,{fullWidth:!0,value:e,onChange:_=>t(_.target.value),placeholder:'Try "gr8 hex bolt 3/8 x 1 galvanized" or "2in sch40 pipe"',InputProps:{startAdornment:i.jsx(hi,{sx:{mr:1,color:"text.secondary"}})}})}),i.jsxs(ct,{direction:"row",alignItems:"center",spacing:1,children:[i.jsx(Fue,{color:"action"}),i.jsxs(F2,{value:r,exclusive:!0,onChange:(_,w)=>w&&n(w),size:"small",color:"primary",children:[i.jsx(al,{value:"all",children:"All"}),i.jsx(al,{value:"stock",children:"Stock"}),i.jsx(al,{value:"supply",children:"Supply"}),i.jsx(al,{value:"service",children:"Service"})]})]})]}),i.jsx(Gn,{}),i.jsxs(ct,{spacing:1,children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",fontWeight:700,children:"How your query is interpreted"}),x("Normalized",h.normalized?[h.normalized]:[],"No query yet"),x("Part # form",h.normalizedPartNumber?[h.normalizedPartNumber]:[],"Waiting for part # text"),x("Tokens",h.tokens,"No tokens extracted"),x("Synonyms added",b,"No synonym expansions yet"),x("Dimensions",h.dimensions,"No dimensional pattern found")]})]})}),c&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:c}),s&&i.jsx(Ed,{sx:{mb:2}}),i.jsx(xt,{elevation:0,sx:{p:2,borderRadius:3,border:"1px solid #e5e7eb",mb:1},children:i.jsxs(ct,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:{xs:"flex-start",sm:"center"},justifyContent:"space-between",children:[i.jsxs(B,{variant:"h6",fontWeight:800,children:["Results ",d.length>0?` ${d.length} matches`:""]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Matching uses abbreviations, finishes, grades, thread types, units, and dimensional patterns from the dictionary."})]})}),d.length===0&&!s?i.jsx(xt,{variant:"outlined",sx:{p:3,borderRadius:3},children:i.jsxs(ct,{direction:"row",spacing:1,alignItems:"center",children:[i.jsx(hi,{color:"action"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:'Start typing to see smart matches. Use abbreviations like "GR8", "UNC", "SCH40", or material names like "A36", "HSS".'})]})}):i.jsx(ie,{container:!0,spacing:2,children:d.map(_=>i.jsx(ie,{item:!0,xs:12,md:6,lg:4,children:i.jsxs(xt,{elevation:1,sx:{p:2,height:"100%",borderRadius:3,border:"1px solid #e5e7eb",display:"flex",flexDirection:"column",gap:1},children:[i.jsxs(ct,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:1,children:[i.jsx(B,{variant:"h6",fontWeight:800,sx:{wordBreak:"break-all"},children:_.item.part_number}),i.jsx(ot,{label:`Score ${_.score}`,size:"small",color:"primary"})]}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{minHeight:48},children:_.item.part_description||"No description"}),i.jsxs(ct,{direction:"row",spacing:1,flexWrap:"wrap",children:[_.item.category&&i.jsx(ot,{label:_.item.category,size:"small"}),_.item.part_type&&i.jsx(ot,{label:_.item.part_type,size:"small",variant:"outlined"}),typeof _.item.quantity_on_hand=="number"&&i.jsx(ot,{label:`On hand: ${_.item.quantity_on_hand} ${_.item.unit||""}`.trim(),size:"small",variant:"outlined"}),typeof _.item.last_unit_cost=="number"&&i.jsx(ot,{label:`Last cost: ${_.item.last_unit_cost}`,size:"small",variant:"outlined"})]}),i.jsx(Gn,{}),i.jsxs(ct,{spacing:.5,children:[i.jsx(B,{variant:"caption",color:"text.secondary",fontWeight:700,children:"Match reasons"}),i.jsxs(ct,{direction:"row",spacing:1,flexWrap:"wrap",children:[_.partNumberMatched&&i.jsx(ot,{label:"Part #",size:"small",color:"success",variant:"outlined"}),_.descriptionMatched&&i.jsx(ot,{label:"Description",size:"small",color:"success",variant:"outlined"}),_.matchedTokens.slice(0,6).map(w=>i.jsx(ot,{label:w,size:"small"},`${_.item.part_number}-tok-${w}`)),_.matchedDimensions.slice(0,4).map(w=>i.jsx(ot,{label:w,size:"small",variant:"outlined"},`${_.item.part_number}-dim-${w}`)),_.matchedCategory&&i.jsx(ot,{label:`Category: ${_.matchedCategory}`,size:"small",color:"secondary",variant:"outlined"})]})]})]})},_.item.part_number))}),s&&d.length>0&&i.jsx(J,{display:"flex",justifyContent:"center",mt:2,children:i.jsx(nr,{size:24})})]})},Que=async()=>(await ve.get("/api/employees")).data,P4=["Admin","Sales and Purchase","Time Tracking","Mobile Time Tracker"],Xue=()=>{const[e,t]=y.useState(""),[r,n]=y.useState(""),[a,o]=y.useState(""),[s,l]=y.useState(""),[c,u]=y.useState("Employee"),[d,f]=y.useState(null),[h,p]=y.useState(null),[g,m]=y.useState([]),[x,b]=y.useState(!0);Nn();const[_,w]=y.useState(null),[A,O]=y.useState(""),[T,E]=y.useState(""),[S,I]=y.useState(""),[z,k]=y.useState(!1);y.useEffect(()=>{M()},[]);const M=async()=>{b(!0);try{const D=await Que();m(D)}catch{f("Failed to fetch employees.")}finally{b(!1)}},R=async D=>{if(D.preventDefault(),f(null),p(null),a!==s){f("Passwords do not match");return}try{const P=await ve.post("/api/employees",{username:e,email:r,password:a,access_role:c});p(P.data.message),t(""),n(""),o(""),l(""),u("Employee"),M()}catch(P){P instanceof fi?f(P.response?.data?.message||"Employee registration failed"):f("An unexpected error occurred")}},F=async D=>{if(window.confirm("Are you sure you want to delete this employee?"))try{await ve.delete(`/api/employees/${D}`),p("Employee deleted successfully"),M()}catch(P){console.error("Error deleting employee:",P),P instanceof fi?f(P.response?.data?.message||"Failed to delete employee"):f("An unexpected error occurred")}},W=D=>{w(D),O(D.username),E(D.access_role),I(""),k(!0)},K=()=>{k(!1),w(null),f(null),p(null)},Z=async()=>{if(_){f(null),p(null);try{const D={username:A,access_role:T};S&&(D.password=S);const P=await ve.put(`/api/employees/${_.id}`,D);p(P.data.message||"Employee updated successfully"),M(),K()}catch(D){console.error("Error updating employee:",D),D instanceof fi?f(D.response?.data?.message||"Failed to update employee"):f("An unexpected error occurred")}}};return x?i.jsxs(ir,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(nr,{}),i.jsx(B,{children:"Loading employees..."})]}):i.jsxs(ir,{component:"main",maxWidth:"md",children:[i.jsxs(J,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[i.jsxs(xt,{elevation:6,sx:{p:4,width:"100%",borderRadius:2,mb:4},children:[i.jsx(B,{component:"h1",variant:"h5",sx:{mb:3,textAlign:"center"},children:"Register New Employee"}),i.jsxs(J,{component:"form",onSubmit:R,noValidate:!0,sx:{mt:1},children:[i.jsx(Ae,{margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Username",name:"username",autoComplete:"new-username",value:e,onChange:D=>t(D.target.value)}),i.jsx(Ae,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"new-email",value:r,onChange:D=>n(D.target.value)}),i.jsx(Ae,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Initial Password",type:"password",id:"password",autoComplete:"new-password",value:a,onChange:D=>o(D.target.value)}),i.jsx(Ae,{margin:"normal",required:!0,fullWidth:!0,name:"confirmPassword",label:"Confirm Initial Password",type:"password",id:"confirmPassword",autoComplete:"new-password",value:s,onChange:D=>l(D.target.value)}),i.jsxs(tn,{fullWidth:!0,margin:"normal",children:[i.jsx(fn,{id:"access-role-label",children:"Access Role"}),i.jsx(hn,{labelId:"access-role-label",id:"access-role",value:c,label:"Access Role",onChange:D=>u(D.target.value),children:P4.map(D=>i.jsx(tr,{value:D,children:D},D))})]}),i.jsx(ye,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},children:"Register Employee"}),d&&i.jsx(Ot,{severity:"error",sx:{mt:2},children:d}),h&&i.jsx(Ot,{severity:"success",sx:{mt:2},children:h})]})]}),i.jsxs(xt,{elevation:6,sx:{p:4,width:"100%",borderRadius:2},children:[i.jsx(B,{component:"h2",variant:"h5",sx:{mb:3,textAlign:"center"},children:"Existing Employees"}),i.jsx(ga,{children:g.map(D=>i.jsx(Ca,{secondaryAction:i.jsxs(J,{children:[i.jsx(pr,{edge:"end","aria-label":"edit",onClick:()=>W(D),sx:{mr:1},children:i.jsx(tu,{})}),i.jsx(pr,{edge:"end","aria-label":"delete",onClick:()=>F(D.id),children:i.jsx(ua,{})})]}),children:i.jsx(Jn,{primary:D.username,secondary:`Email: ${D.email} | Role: ${D.role} | Access: ${D.access_role}`})},D.id))})]})]}),i.jsxs(gr,{open:z,onClose:K,children:[i.jsx(vr,{children:"Edit Employee Roles"}),i.jsxs(yr,{children:[_&&i.jsxs(J,{component:"form",noValidate:!0,sx:{mt:1},children:[i.jsx(Ae,{margin:"normal",fullWidth:!0,id:"edit-username",label:"Username",value:A,onChange:D=>O(D.target.value),variant:"standard"}),i.jsx(Ae,{margin:"normal",fullWidth:!0,id:"edit-email",label:"Email",value:_.email,InputProps:{readOnly:!0,disableUnderline:!0},variant:"standard"}),i.jsx(Ae,{margin:"normal",fullWidth:!0,id:"edit-password",label:"New Password (leave blank to keep current)",type:"password",value:S,onChange:D=>I(D.target.value),variant:"standard"}),i.jsxs(tn,{fullWidth:!0,margin:"normal",children:[i.jsx(fn,{id:"edit-access-role-label",children:"Access Role"}),i.jsx(hn,{labelId:"edit-access-role-label",id:"edit-access-role",value:T,label:"Access Role",onChange:D=>E(D.target.value),children:P4.map(D=>i.jsx(tr,{value:D,children:D},D))})]})]}),d&&i.jsx(Ot,{severity:"error",sx:{mt:2},children:d}),h&&i.jsx(Ot,{severity:"success",sx:{mt:2},children:h})]}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:K,children:"Cancel"}),i.jsx(ye,{onClick:Z,variant:"contained",color:"primary",children:"Save Changes"})]})]})]})},Jue=()=>{const[e,t]=y.useState([]),[r,n]=y.useState(""),[a,o]=y.useState([]),[s,l]=y.useState(!1),[c,u]=y.useState(!1),[d,f]=y.useState(null),[h,p]=y.useState(""),[g,m]=y.useState(!1),[x,b]=y.useState(!1),[_,w]=y.useState(null),[A,O]=y.useState([]),[T,E]=y.useState([]),[S,I]=y.useState("admin");y.useEffect(()=>{z()},[]),y.useEffect(()=>{S==="admin"?M():r?k(r):o([])},[r,S]);const z=async()=>{try{const P=await ve.get("/api/profile-documents/profiles");t(P.data)}catch(P){console.error("Error fetching profiles:",P),ge.error("Failed to fetch profiles")}},k=async P=>{l(!0);try{const $=await ve.get(`/api/profile-documents/profile/${P}`);o($.data)}catch($){console.error("Error fetching documents:",$),ge.error("Failed to fetch documents")}finally{l(!1)}},M=async()=>{l(!0);try{const $=(await ve.get("/api/profile-documents/all")).data.reduce((C,L)=>{const H=L.id;return C[H]||(C[H]={id:L.id,filename:L.filename,original_filename:L.original_filename,file_size:L.file_size,mime_type:L.mime_type,uploaded_by:L.uploaded_by,uploaded_by_name:L.uploaded_by_name,created_at:L.created_at,visible_to_profiles:[],profile_read_status:{},profile_details:[]}),C[H].visible_to_profiles.push(L.profile_id),C[H].profile_read_status[L.profile_id]=L.has_read,C[H].profile_details.push({profile_id:L.profile_id,profile_name:L.profile_name,has_read:L.has_read,read_at:L.read_at}),C},{}),Q=Object.values($);console.log("Grouped documents:",Q),o(Q)}catch(P){console.error("Error fetching all documents:",P),ge.error("Failed to fetch documents")}finally{l(!1)}},R=P=>{const $=P.target.files?.[0];$&&(f($),h||p($.name))},F=async()=>{if(!d||T.length===0){ge.error("Please select a file and at least one profile");return}m(!0);try{const P=new FormData;P.append("document",d),P.append("customName",h),P.append("visibleToProfiles",JSON.stringify(T)),(await ve.post("/api/profile-documents/upload",P,{headers:{"Content-Type":"multipart/form-data"}})).data.success&&(ge.success("Document uploaded successfully"),u(!1),f(null),p(""),E([]),S==="admin"?M():r&&k(r))}catch(P){console.error("Error uploading document:",P),ge.error(P.response?.data?.error||"Failed to upload document")}finally{m(!1)}},W=async P=>{if(window.confirm("Are you sure you want to delete this document?"))try{await ve.delete(`/api/profile-documents/${P}`),ge.success("Document deleted successfully"),S==="admin"?M():r&&k(r)}catch($){console.error("Error deleting document:",$),ge.error("Failed to delete document")}},K=async P=>{w(P),b(!0);try{const $=await ve.get(`/api/profile-documents/${P.id}/stats`);O($.data)}catch($){console.error("Error fetching document stats:",$),ge.error("Failed to fetch document statistics")}},Z=P=>{if(P===0)return"0 Bytes";const $=1024,Q=["Bytes","KB","MB","GB"],C=Math.floor(Math.log(P)/Math.log($));return parseFloat((P/Math.pow($,C)).toFixed(2))+" "+Q[C]},D=P=>new Date(P).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return i.jsxs(J,{p:3,children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsx(B,{variant:"h4",component:"h1",children:"Profile Documents Management"}),i.jsxs(J,{display:"flex",gap:2,alignItems:"center",children:[i.jsxs(tn,{size:"small",sx:{minWidth:120},children:[i.jsx(fn,{children:"View Mode"}),i.jsxs(hn,{value:S,onChange:P=>I(P.target.value),label:"View Mode",children:[i.jsx(tr,{value:"admin",children:"Admin View"}),i.jsx(tr,{value:"profile",children:"Profile View"})]})]}),i.jsx(ye,{variant:"contained",startIcon:i.jsx(Iv,{}),onClick:()=>u(!0),disabled:S==="profile"&&!r,children:"Upload Document"})]})]}),i.jsxs(ie,{container:!0,spacing:3,children:[S==="profile"&&i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(Br,{children:i.jsxs(Vr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Select Profile"}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Profile"}),i.jsx(hn,{value:r,onChange:P=>n(P.target.value),label:"Profile",children:e.map(P=>i.jsx(tr,{value:P.id,children:P.name},P.id))})]}),r&&i.jsx(J,{mt:2,children:i.jsx(B,{variant:"body2",color:"text.secondary",children:e.find(P=>P.id===r)?.email})})]})})}),i.jsx(ie,{item:!0,xs:12,md:S==="profile"?8:12,children:i.jsx(Br,{children:i.jsxs(Vr,{children:[i.jsxs(B,{variant:"h6",gutterBottom:!0,children:["Documents",i.jsx(ot,{label:`${a.length} documents`,size:"small",sx:{ml:2}})]}),S==="profile"&&!r?i.jsx(Ot,{severity:"info",children:"Please select a profile to view documents."}):s?i.jsx(J,{display:"flex",justifyContent:"center",p:3,children:i.jsx(nr,{})}):a.length===0?i.jsx(Ot,{severity:"info",children:S==="admin"?"No documents found.":"No documents found for this profile."}):i.jsx(va,{children:i.jsxs(sa,{size:"small",children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{children:"Document Name"}),i.jsx(Pe,{align:"center",children:"Size"}),i.jsx(Pe,{align:"center",children:"Type"}),S==="admin"?i.jsxs(i.Fragment,{children:[i.jsx(Pe,{align:"center",children:"Visible To"}),i.jsx(Pe,{align:"center",children:"Read Status"})]}):i.jsx(Pe,{align:"center",children:"Read Status"}),i.jsx(Pe,{align:"center",children:"Uploaded"}),i.jsx(Pe,{align:"center",children:"Actions"})]})}),i.jsx(ca,{children:a.map(P=>i.jsxs(br,{children:[i.jsxs(Pe,{children:[i.jsx(B,{variant:"body2",fontWeight:"medium",children:P.original_filename}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:["by ",P.uploaded_by_name]})]}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"body2",children:Z(P.file_size)})}),i.jsx(Pe,{align:"center",children:i.jsx(ot,{label:P.mime_type.split("/")[1]?.toUpperCase()||"FILE",size:"small",variant:"outlined"})}),S==="admin"?i.jsxs(i.Fragment,{children:[i.jsx(Pe,{align:"center",children:i.jsx(J,{display:"flex",flexWrap:"wrap",gap:.5,justifyContent:"center",children:P.profile_details&&P.profile_details.length>0?P.profile_details.map($=>i.jsx(ot,{label:$.profile_name,size:"small",variant:"outlined",color:"primary"},$.profile_id)):P.visible_to_profiles?.map($=>{const Q=e.find(C=>C.id===$);return Q?i.jsx(ot,{label:Q.name,size:"small",variant:"outlined",color:"primary"},$):null})})}),i.jsx(Pe,{align:"center",children:i.jsx(J,{display:"flex",flexWrap:"wrap",gap:.5,justifyContent:"center",children:P.profile_details&&P.profile_details.length>0?P.profile_details.map($=>i.jsx(ot,{label:$.has_read?"Read":"Unread",size:"small",color:$.has_read?"success":"default",icon:$.has_read?i.jsx(jh,{}):i.jsx(Eu,{}),title:`${$.profile_name}: ${$.has_read?"Read":"Unread"}`},$.profile_id)):P.visible_to_profiles?.map($=>{const Q=e.find(L=>L.id===$),C=P.profile_read_status?.[$]||!1;return Q?i.jsx(ot,{label:C?"Read":"Unread",size:"small",color:C?"success":"default",icon:C?i.jsx(jh,{}):i.jsx(Eu,{}),title:`${Q.name}: ${C?"Read":"Unread"}`},$):null})})})]}):i.jsx(Pe,{align:"center",children:i.jsx(ot,{label:P.profile_read_status?.[r]?"Read":"Unread",size:"small",color:P.profile_read_status?.[r]?"success":"default",icon:P.profile_read_status?.[r]?i.jsx(jh,{}):i.jsx(Eu,{})})}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"body2",children:D(P.created_at)})}),i.jsxs(Pe,{align:"center",children:[i.jsx(pr,{size:"small",onClick:()=>K(P),title:"View Statistics",children:i.jsx(kI,{})}),i.jsx(pr,{size:"small",component:"a",href:`/api/profile-documents/file/${P.id}`,target:"_blank",title:"Download",children:i.jsx(II,{})}),i.jsx(pr,{size:"small",onClick:()=>W(P.id),title:"Delete",color:"error",children:i.jsx(Id,{})})]})]},P.id))})]})})]})})})]}),i.jsxs(gr,{open:c,onClose:()=>u(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(vr,{children:"Upload Document"}),i.jsx(yr,{children:i.jsxs(J,{sx:{pt:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Select Profiles"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Choose which profiles can see this document"}),i.jsx(Ep,{children:e.map(P=>i.jsx(ri,{control:i.jsx(Xi,{checked:T.includes(P.id),onChange:$=>{$.target.checked?E([...T,P.id]):E(T.filter(Q=>Q!==P.id))}}),label:i.jsxs(J,{children:[i.jsx(B,{variant:"body2",children:P.name}),i.jsx(B,{variant:"caption",color:"text.secondary",children:P.email})]})},P.id))}),i.jsx(Ae,{fullWidth:!0,label:"Custom Document Name",value:h,onChange:P=>p(P.target.value),sx:{mb:2,mt:2},helperText:"Leave empty to use original filename"}),i.jsxs(J,{sx:{mb:2},children:[i.jsx("input",{type:"file",id:"file-upload",onChange:R,style:{display:"none"},accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.gif"}),i.jsx("label",{htmlFor:"file-upload",children:i.jsx(ye,{variant:"outlined",component:"span",startIcon:i.jsx(fg,{}),fullWidth:!0,children:d?d.name:"Select File"})})]}),d&&i.jsxs(Ot,{severity:"info",children:["Selected: ",d.name," (",Z(d.size),")"]})]})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:()=>u(!1),disabled:g,children:"Cancel"}),i.jsx(ye,{onClick:F,variant:"contained",disabled:!d||T.length===0||g,startIcon:g?i.jsx(nr,{size:20}):i.jsx(fg,{}),children:g?"Uploading...":"Upload"})]})]}),i.jsxs(gr,{open:x,onClose:()=>b(!1),maxWidth:"md",fullWidth:!0,children:[i.jsxs(vr,{children:["Document Statistics: ",_?.original_filename]}),i.jsx(yr,{children:i.jsxs(J,{sx:{pt:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Profile Read Status"}),i.jsx(B,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"View which profiles can see this document and their read status:"}),_&&i.jsx(va,{sx:{mt:2},children:i.jsxs(sa,{size:"small",children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{children:"Profile"}),i.jsx(Pe,{children:"Email"}),i.jsx(Pe,{align:"center",children:"Read Status"}),i.jsx(Pe,{align:"center",children:"Read At"})]})}),i.jsx(ca,{children:_.visible_to_profiles?.map(P=>{const $=e.find(L=>L.id===P),Q=_.profile_read_status?.[P]||!1,C=A.find(L=>L.profile_id===P);return $?i.jsxs(br,{children:[i.jsx(Pe,{children:i.jsx(B,{variant:"body2",fontWeight:"medium",children:$.name})}),i.jsx(Pe,{children:i.jsx(B,{variant:"body2",color:"text.secondary",children:$.email})}),i.jsx(Pe,{align:"center",children:i.jsx(ot,{label:Q?"Read":"Unread",size:"small",color:Q?"success":"default",icon:Q?i.jsx(jh,{}):i.jsx(Eu,{})})}),i.jsx(Pe,{align:"center",children:C?i.jsx(B,{variant:"body2",children:D(C.read_at)}):i.jsx(B,{variant:"body2",color:"text.secondary",children:"-"})})]},P):null})})]})})]})}),i.jsx(Cr,{children:i.jsx(ye,{onClick:()=>b(!1),children:"Close"})})]})]})},Zue=()=>{const[e,t]=y.useState([]),[r,n]=y.useState(!0),[a,o]=y.useState(!1),[s,l]=y.useState(!1),[c,u]=y.useState({margin_id:"",cost_lower_bound:"",cost_upper_bound:"",margin_factor:""}),[d,f]=y.useState(null),[h,p]=y.useState({page:0,pageSize:5}),[g,m]=y.useState(""),[x,b]=y.useState(!1),[_,w]=y.useState(""),[A,O]=y.useState(!1),[T,E]=y.useState(""),[S,I]=y.useState(!1),[z,k]=y.useState(""),[M,R]=y.useState(!1),[F,W]=y.useState(""),[K,Z]=y.useState(!1),D=async()=>{try{const V=await ve.get("/api/margin-schedule");t(V.data.map(He=>({...He,id:He.margin_id}))),n(!1),f(null)}catch(V){console.error("Error fetching margin schedules:",V),f("Failed to load margin schedules"),ge.error("Failed to load margin schedules"),n(!1)}},P=async()=>{b(!0);try{const V=await ve.get("/api/settings/labour-rate");m(V.data.labour_rate??"")}catch{m("")}finally{b(!1)}},$=async()=>{O(!0);try{const V=await ve.get("/api/settings/overhead-rate");w(V.data.overhead_rate??"")}catch{w("")}finally{O(!1)}},Q=async()=>{I(!0);try{const V=await ve.get("/api/settings/supply-rate");E(V.data.supply_rate??"")}catch{E("")}finally{I(!1)}},C=async()=>{R(!0);try{const V=await ve.get("/api/settings/daily-break-start");k(V.data.daily_break_start??"")}catch{k("")}finally{R(!1)}},L=async()=>{Z(!0);try{const V=await ve.get("/api/settings/daily-break-end");W(V.data.daily_break_end??"")}catch{W("")}finally{Z(!1)}};y.useEffect(()=>{D(),P(),$(),Q(),C(),L()},[]);const H=()=>{l(!1),u({margin_id:"",cost_lower_bound:"",cost_upper_bound:"",margin_factor:""}),o(!0)},U=V=>{l(!0),u({margin_id:V.margin_id,cost_lower_bound:String(V.cost_lower_bound),cost_upper_bound:String(V.cost_upper_bound),margin_factor:String(V.margin_factor)}),o(!0)},te=async V=>{if(window.confirm("Are you sure you want to delete this margin schedule?"))try{await ve.delete(`/api/margin-schedule/${V}`),ge.success("Margin schedule deleted successfully"),D()}catch(He){console.error("Error deleting margin schedule:",He),ge.error("Failed to delete margin schedule")}},le=()=>{o(!1)},oe=V=>{const{name:He,value:Ne}=V.target;u(Re=>({...Re,[He]:Ne}))},ae=async V=>{V.preventDefault();try{s?(await ve.put(`/api/margin-schedule/${c.margin_id}`,{cost_lower_bound:parseFloat(c.cost_lower_bound),cost_upper_bound:parseFloat(c.cost_upper_bound),margin_factor:parseFloat(c.margin_factor)}),ge.success("Margin schedule updated successfully")):(await ve.post("/api/margin-schedule",{schedule:[{cost_lower_bound:parseFloat(c.cost_lower_bound),cost_upper_bound:parseFloat(c.cost_upper_bound),margin_factor:parseFloat(c.margin_factor)}]}),ge.success("Margin schedule created successfully")),le(),D()}catch(He){console.error("Error saving margin schedule:",He),ge.error("Failed to save margin schedule")}},he=async()=>{b(!0);try{await ve.put("/api/settings/labour-rate",{labour_rate:Number(g)}),P()}catch{}finally{b(!1)}},me=async()=>{O(!0);try{await ve.put("/api/settings/overhead-rate",{overhead_rate:Number(_)}),$()}catch{}finally{O(!1)}},X=async()=>{I(!0);try{await ve.put("/api/settings/supply-rate",{supply_rate:Number(T)}),Q(),ge.success("Supply rate updated successfully")}catch{ge.error("Failed to update supply rate")}finally{I(!1)}},G=async()=>{R(!0);try{await ve.put("/api/settings/daily-break-start",{daily_break_start:z}),C(),ge.success("Daily break start time updated successfully")}catch{ge.error("Failed to update daily break start time")}finally{R(!1)}},ee=async()=>{Z(!0);try{await ve.put("/api/settings/daily-break-end",{daily_break_end:F}),L(),ge.success("Daily break end time updated successfully")}catch{ge.error("Failed to update daily break end time")}finally{Z(!1)}},se=[{field:"margin_id",headerName:"ID",flex:.5,minWidth:60,headerAlign:"center",align:"center"},{field:"cost_lower_bound",headerName:"Cost Lower Bound",flex:1,minWidth:120,type:"number",headerAlign:"center",align:"center"},{field:"cost_upper_bound",headerName:"Cost Upper Bound",flex:1,minWidth:120,type:"number",headerAlign:"center",align:"center"},{field:"margin_factor",headerName:"Margin Factor",flex:1,minWidth:120,type:"number",headerAlign:"center",align:"center"},{field:"actions",headerName:"Actions",width:80,sortable:!1,headerAlign:"center",align:"center",renderCell:V=>i.jsx(pr,{size:"small",color:"error",onClick:He=>{He.stopPropagation(),te(V.row.margin_id)},children:i.jsx(ua,{})})}];return i.jsxs(ir,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Global Variables"}),i.jsxs(ct,{direction:"row",spacing:2,children:[i.jsx(ye,{variant:"contained",onClick:H,startIcon:i.jsx(Ba,{}),children:"New Entry"}),i.jsx(ye,{variant:"contained",onClick:D,children:"Refresh"})]})]}),i.jsx(xt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsx(J,{sx:{p:2},children:i.jsx(Po,{rows:e,columns:se,getRowId:V=>V.id,paginationModel:h,onPaginationModelChange:V=>p(V),pageSizeOptions:[5,10,20],loading:r,disableRowSelectionOnClick:!0,onRowClick:V=>U(V.row),sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"},cursor:"pointer"}})})}),i.jsx(xt,{sx:{width:"100%",overflow:"hidden",mb:3,p:2},children:i.jsxs(J,{sx:{display:"flex",gap:4,alignItems:"flex-start"},children:[i.jsxs(J,{sx:{flex:1},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Labour Hourly Rate"}),i.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(Ae,{label:"Hourly Rate ($)",type:"number",value:g,onChange:V=>m(V.target.value===""?"":Number(V.target.value)),disabled:x,InputProps:{startAdornment:i.jsx(oa,{position:"start",children:"$"})},sx:{maxWidth:200}}),i.jsx(ye,{variant:"contained",onClick:he,disabled:x||g==="",children:"Save"})]})]}),i.jsxs(J,{sx:{flex:1},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Overhead Hourly Rate"}),i.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(Ae,{label:"Hourly Rate ($)",type:"number",value:_,onChange:V=>w(V.target.value===""?"":Number(V.target.value)),disabled:A,InputProps:{startAdornment:i.jsx(oa,{position:"start",children:"$"})},sx:{maxWidth:200}}),i.jsx(ye,{variant:"contained",onClick:me,disabled:A||_==="",children:"Save"})]})]}),i.jsxs(J,{sx:{flex:1},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Supply Percentage"}),i.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(Ae,{label:"Percentage (%)",type:"number",value:T,onChange:V=>E(V.target.value===""?"":Number(V.target.value)),disabled:S,InputProps:{endAdornment:i.jsx(oa,{position:"end",children:"%"})},sx:{maxWidth:200}}),i.jsx(ye,{variant:"contained",onClick:X,disabled:S||T==="",children:"Save"})]})]}),i.jsxs(J,{sx:{flex:1},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Daily Break Times"}),i.jsxs(J,{sx:{display:"flex",flexDirection:"column",gap:2},children:[i.jsx(Ae,{label:"Break Start (HH:MM)",type:"time",value:z,onChange:V=>k(V.target.value),disabled:M,InputLabelProps:{shrink:!0},sx:{maxWidth:200}}),i.jsx(ye,{variant:"contained",onClick:G,disabled:M||z==="",children:"Save Start"}),i.jsx(Ae,{label:"Break End (HH:MM)",type:"time",value:F,onChange:V=>W(V.target.value),disabled:K,InputLabelProps:{shrink:!0},sx:{maxWidth:200}}),i.jsx(ye,{variant:"contained",onClick:ee,disabled:K||F==="",children:"Save End"})]})]})]})}),i.jsxs(gr,{open:a,onClose:le,children:[i.jsx(vr,{children:s?"Edit Margin Entry":"Add New Margin Entry"}),i.jsx(yr,{children:i.jsxs(ct,{spacing:2,mt:1,children:[i.jsx(Ae,{label:"Cost Lower Bound",name:"cost_lower_bound",value:c.cost_lower_bound,onChange:oe,fullWidth:!0,type:"number"}),i.jsx(Ae,{label:"Cost Upper Bound",name:"cost_upper_bound",value:c.cost_upper_bound,onChange:oe,fullWidth:!0,type:"number"}),i.jsx(Ae,{label:"Margin Factor",name:"margin_factor",value:c.margin_factor,onChange:oe,fullWidth:!0,type:"number"})]})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:le,children:"Cancel"}),i.jsx(ye,{onClick:ae,children:s?"Save Changes":"Add Entry"})]})]})]})};var Xf={},O4;function ede(){if(O4)return Xf;O4=1;var e=cr();Object.defineProperty(Xf,"__esModule",{value:!0}),Xf.default=void 0;var t=e(dr()),r=ur();return Xf.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),Xf}var tde=ede();const ac=It(tde);var Jf={},k4;function rde(){if(k4)return Jf;k4=1;var e=cr();Object.defineProperty(Jf,"__esModule",{value:!0}),Jf.default=void 0;var t=e(dr()),r=ur();return Jf.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error"),Jf}var nde=rde();const Fy=It(nde);var Zf={},T4;function ade(){if(T4)return Zf;T4=1;var e=cr();Object.defineProperty(Zf,"__esModule",{value:!0}),Zf.default=void 0;var t=e(dr()),r=ur();return Zf.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),Zf}var ide=ade();const Ww=It(ide);var eh={},E4;function ode(){if(E4)return eh;E4=1;var e=cr();Object.defineProperty(eh,"__esModule",{value:!0}),eh.default=void 0;var t=e(dr()),r=ur();return eh.default=(0,t.default)((0,r.jsx)("path",{d:"M6 2v6h.01L6 8.01 10 12l-4 4 .01.01H6V22h12v-5.99h-.01L18 16l-4-4 4-3.99-.01-.01H18V2zm10 14.5V20H8v-3.5l4-4zm-4-5-4-4V4h8v3.5z"}),"HourglassEmpty"),eh}var sde=ode();const dR=It(sde);var th={},I4;function lde(){if(I4)return th;I4=1;var e=cr();Object.defineProperty(th,"__esModule",{value:!0}),th.default=void 0;var t=e(dr()),r=ur();return th.default=(0,t.default)((0,r.jsx)("path",{d:"M14.67 5v14H9.33V5zm1 14H21V5h-5.33zm-7.34 0V5H3v14z"}),"ViewColumn"),th}var cde=lde();const Hw=It(cde),ude=e=>{if(typeof e=="string"){const t=e.trim().toLowerCase();if(["needed","need","required","pending"].includes(t))return"needed";if(["done","complete","completed","sent"].includes(t))return"done";if(["true","t","yes","y","1","on"].includes(t))return"needed";if(["false","f","no","n","0","off",""].includes(t))return""}return typeof e=="boolean"&&e?"needed":""},dde=()=>{const[e,t]=y.useState(""),[r,n]=y.useState([]),[a,o]=y.useState("open"),[s,l]=y.useState(0),c=Nn(),u=Ds(),{user:d}=ea(),[f,h]=y.useState(!1),p="openSalesOrders.columnVisibility",[g,m]=y.useState(()=>{if(typeof window>"u")return{};const D=localStorage.getItem(p);if(D)try{return JSON.parse(D)}catch(P){console.warn("Failed to parse column visibility model, resetting to defaults",P)}return{}}),[x,b]=y.useState(null),[_,w]=y.useState([]);y.useEffect(()=>{typeof window<"u"&&localStorage.setItem(p,JSON.stringify(g))},[g]);const A=(D,P)=>{w(P),b(D.currentTarget)},O=()=>b(null),T=i.jsx(Nv,{open:!!x,anchorEl:x,onClose:O,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:i.jsxs(J,{sx:{p:2,maxWidth:280},children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1.5},children:"Show / Hide Columns"}),i.jsx(Ep,{children:_.filter(D=>D.field!=="actions").map(D=>i.jsx(ri,{control:i.jsx(Xi,{size:"small",checked:g[D.field]!==!1,onChange:P=>m($=>({...$,[D.field]:P.target.checked}))}),label:D.headerName||D.field},D.field))})]})}),[E,S]=y.useState({page:0,pageSize:10}),I=async(D=a)=>{try{const P=d?.access_role==="Sales and Purchase"?"open":D,Q=(await ve.get("/api/sales-orders",{params:{status:P,_ts:Date.now()}})).data.sort((L,H)=>{const U=oe=>{const ae=oe.match(/\d+/);return ae?parseInt(ae[0],10):0},te=U(L.sales_order_number);return U(H.sales_order_number)-te}),C=Q.map(L=>({...L,id:L.sales_order_id,subtotal:Number(L.subtotal)||0,total_gst_amount:Number(L.total_gst_amount)||0,total_amount:Number(L.total_amount)||0,invoice_status:ude(L.invoice_status??L.invoice_required)}));if(n(C),D==="open"||D==="all"){const H=(D==="open"?Q:Q.filter(U=>U.status==="Open")).reduce((U,te)=>{const le=parseFloat(te.subtotal)||0;return U+le},0);l(H)}else l(0)}catch(P){console.error("Error fetching sales orders:",P),n([]),l(0)}};y.useEffect(()=>{I(a)},[a,d?.access_role]),y.useEffect(()=>{setTimeout(()=>{I(a)},500)},[u.key]),y.useEffect(()=>{const D=()=>I(a),P=()=>{document.visibilityState==="visible"&&I(a)};return window.addEventListener("focus",D),document.addEventListener("visibilitychange",P),()=>{window.removeEventListener("focus",D),document.removeEventListener("visibilitychange",P)}},[a]);const z=async D=>{if(window.confirm("Are you sure you want to close this Sales Order?"))try{const P=await ve.get(`/api/sales-orders/${D}`),{salesOrder:$,lineItems:Q}=P.data,{subtotal:C,total_gst_amount:L,total_amount:H,...U}=$;await ve.put(`/api/sales-orders/${D}`,{...U,status:"Closed",lineItems:(Q||[]).map(te=>{const le=String(te.part_number||"").toUpperCase(),oe={part_number:String(te.part_number||""),part_description:String(te.part_description||""),unit:String(te.unit||""),unit_price:le==="SUPPLY"?0:Number(te.unit_price)||0,line_amount:Number(te.line_amount)||0,...te.part_id?{part_id:Number(te.part_id)}:{}};if(le==="SUPPLY")return{...oe,unit:"Each",quantity:1};if(le==="LABOUR"||le==="OVERHEAD"){const ae=Number(te.quantity_sold??te.quantity??0)||0;return{...oe,quantity:ae}}return{...oe,quantity:Number(te.quantity_sold??te.quantity??0)||0}})}),ge.success("Sales Order closed successfully!"),I()}catch(P){console.error("Error closing sales order:",P);let $="Failed to close sales order.";P.response?.data?.error?$=P.response.data.error:P.response?.data?.details?$=P.response.data.details:P.response?.data?.message&&($=P.response.data.message),$.toLowerCase().includes("insufficient inventory")||$.toLowerCase().includes("insufficient quantity")||$.toLowerCase().includes("negative inventory")?ge.error(`Inventory Error: ${$}`):ge.error($)}},k=async D=>{if(window.confirm("Are you sure you want to delete this Sales Order? This action cannot be undone."))try{await ve.delete(`/api/sales-orders/${D}`),ge.success("Sales Order deleted successfully!"),I()}catch(P){console.error("Error deleting sales order:",P),ge.error("Failed to delete sales order.")}},M=e.toLowerCase(),R=r.filter(D=>[D.sales_order_number,D.customer_name,D.product_name,D.product_description,D.unit_number,D.mileage,D.vin_number,D.sales_date?new Date(D.sales_date).toLocaleDateString():"",D.wanted_by_date?new Date(D.wanted_by_date).toLocaleDateString():"",D.wanted_by_time_of_day].filter(P=>P!=null).some(P=>P.toString().toLowerCase().includes(M))),F=[{field:"sales_order_number",headerName:"Sales Order #",flex:1,minWidth:120,valueFormatter:D=>D.value?String(D.value).replace("SO-",""):""},{field:"sales_date",headerName:"Sales Date",flex:.9,minWidth:130,valueFormatter:D=>D.value?new Date(D.value).toLocaleDateString():""},{field:"wanted_by_date",headerName:"Wanted By Date",flex:.9,minWidth:140,valueFormatter:D=>D.value?new Date(D.value).toLocaleDateString():""},{field:"wanted_by_time_of_day",headerName:"Wanted Time",flex:.8,minWidth:120,valueFormatter:D=>D.value?`${String(D.value).charAt(0).toUpperCase()}${String(D.value).slice(1)}`:""},{field:"customer_name",headerName:"Customer",flex:1.3,minWidth:150},{field:"product_name",headerName:"Product Name",flex:1,minWidth:120},{field:"product_description",headerName:"Product Description",flex:1.5,minWidth:150},{field:"unit_number",headerName:"Unit #",flex:.9,minWidth:110},{field:"mileage",headerName:"Mileage",flex:.8,minWidth:100},{field:"vin_number",headerName:"VIN #",flex:1,minWidth:140},{field:"subtotal",headerName:"Subtotal",flex:.8,minWidth:100,valueFormatter:D=>D.value!=null&&!isNaN(Number(D.value))?`$${Number(D.value).toFixed(2)}`:"$0.00"},{field:"total_amount",headerName:"Total",flex:.8,minWidth:100,valueFormatter:D=>D.value!=null&&!isNaN(Number(D.value))?`$${Number(D.value).toFixed(2)}`:"$0.00"},{field:"status",headerName:"Status",flex:.8,minWidth:100,renderCell:D=>i.jsx(ot,{label:D.value,color:D.value==="Open"?"success":"error",size:"small",variant:"outlined"})},{field:"invoice_status",headerName:"Invoice",flex:.6,minWidth:90,valueFormatter:D=>D.value==="done"?"Done":D.value==="needed"?"Needed":"",renderCell:D=>D.value==="done"?i.jsx(ac,{color:"success",titleAccess:"Invoice done"}):D.value==="needed"?i.jsx(Ww,{color:"error",titleAccess:"Invoice needed"}):null,sortable:!1},{field:"exported_to_qbo",headerName:"QBO Exported",flex:.8,minWidth:120,renderCell:D=>D.row.exported_to_qbo?i.jsx(ac,{color:"success",titleAccess:"Exported to QuickBooks"}):D.row.qbo_export_status?i.jsx(Fy,{color:"error",titleAccess:`QBO Export Error: ${D.row.qbo_export_status}`}):D.row.status==="Closed"?i.jsx(dR,{color:"warning",titleAccess:"Not exported to QuickBooks"}):null},{field:"actions",headerName:"Actions",width:140,sortable:!1,renderCell:D=>i.jsxs(J,{sx:{display:"flex",gap:.5},children:[D.row.status!=="Closed"&&i.jsx(pr,{size:"small",color:"primary",onClick:P=>{P.stopPropagation(),z(D.row.sales_order_id)},children:i.jsx(lj,{})}),D.row.status!=="Closed"&&i.jsx(pr,{size:"small",color:"error",onClick:P=>{P.stopPropagation(),k(D.row.sales_order_id)},children:i.jsx(ua,{})})]})}],W=()=>{setTimeout(()=>{I()},500)},K=()=>{let D=R;a==="open"?D=R.filter(C=>C.status==="Open"):a==="closed"&&(D=R.filter(C=>C.status==="Closed"));const P=Cl.unparse(D.map(C=>{const L={};return F.forEach(H=>{if(H.field!=="actions"){const U=C[H.field];H.field==="bill_date"||H.field==="sales_date"||H.field==="wanted_by_date"?L[H.headerName]=U?new Date(U).toLocaleDateString():"":H.type==="number"?L[H.headerName]=U!=null&&!isNaN(parseFloat(String(U)))?parseFloat(String(U)).toFixed(2):"":L[H.headerName]=U!==void 0?String(U):""}}),L})),$=new Blob([P],{type:"text/csv;charset=utf-8;"}),Q=document.createElement("a");if(Q.download!==void 0){const C=URL.createObjectURL($);Q.setAttribute("href",C),Q.setAttribute("download","open_sales_orders.csv"),Q.style.visibility="hidden",document.body.appendChild(Q),Q.click(),document.body.removeChild(Q)}},Z=D=>{console.log("OpenSalesOrdersPage: Row clicked:",D.row),console.log("OpenSalesOrdersPage: User role:",d?.access_role),console.log("OpenSalesOrdersPage: Sales order ID:",D.row.sales_order_id);const P=`/open-sales-orders/${D.row.sales_order_id}`;console.log("OpenSalesOrdersPage: Navigating user to:",P),c(P)};return d?.access_role==="Time Tracking"?i.jsxs(ir,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(J,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Sales Orders"}),i.jsxs(J,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:[i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Hw,{}),sx:{mr:1},onClick:D=>A(D,F.filter(P=>P.field!=="actions")),children:"Columns"}),i.jsx(ye,{variant:"contained",startIcon:i.jsx(Ba,{}),sx:{mr:1},onClick:()=>c("/open-sales-orders/new"),children:"New Sales Order"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Es,{}),onClick:W,children:"Refresh"})]})]}),i.jsx(xt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(J,{sx:{p:2},children:[i.jsx(ct,{direction:"row",spacing:3,sx:{mb:2},children:i.jsx(Ae,{label:"Search",variant:"outlined",value:e,onChange:D=>t(D.target.value),InputProps:{startAdornment:i.jsx(oa,{position:"start",children:i.jsx(hi,{sx:{fontSize:22}})})},sx:{minWidth:340,maxWidth:400,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"small"})}),i.jsx(Po,{rows:R,columns:F.filter(D=>D.field!=="actions"),loading:!1,columnVisibilityModel:g,onColumnVisibilityModelChange:D=>m(D),paginationModel:E,onPaginationModelChange:S,pageSizeOptions:[10,25,50],getRowId:D=>D.id,onRowClick:Z,disableRowSelectionOnClick:!0,initialState:{sorting:{sortModel:[{field:"sales_order_number",sort:"desc"}]}},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),T]}):i.jsxs(ir,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(J,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:d?.access_role==="Sales and Purchase"?"Sales Orders (Open Only)":"Sales Orders"}),(a==="open"||a==="all")&&i.jsxs(J,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[i.jsxs(B,{variant:"h6",component:"div",sx:{fontWeight:"bold",color:"primary.main"},children:["Work In Process: $",s.toFixed(2)]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Total subtotal value of all open sales orders"})]}),i.jsx(J,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:i.jsxs(ct,{direction:"row",spacing:2,children:[d?.access_role!=="Time Tracking"&&i.jsx(ye,{variant:"contained",startIcon:i.jsx(Ba,{}),onClick:()=>c("/open-sales-orders/new"),children:"New SO"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Hw,{}),onClick:D=>A(D,F),children:"Columns"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(da,{}),onClick:K,children:"Export CSV"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Es,{}),onClick:W,children:"Refresh"})]})})]}),i.jsx(xt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(J,{sx:{p:2},children:[i.jsxs(ct,{direction:"row",spacing:3,sx:{mb:2},children:[i.jsx(Ae,{label:"Search",variant:"outlined",value:e,onChange:D=>t(D.target.value),InputProps:{startAdornment:i.jsx(oa,{position:"start",children:i.jsx(hi,{sx:{fontSize:22}})})},sx:{minWidth:340,maxWidth:400,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"small"}),d?.access_role!=="Sales and Purchase"&&i.jsx(ot,{label:"All",onClick:()=>o("all"),color:a==="all"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),i.jsx(ot,{label:"Open",onClick:()=>o("open"),color:a==="open"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),d?.access_role!=="Sales and Purchase"&&i.jsx(ot,{label:"Closed",onClick:()=>o("closed"),color:a==="closed"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}})]}),i.jsx(Po,{rows:R,columns:F,loading:!1,columnVisibilityModel:g,onColumnVisibilityModelChange:D=>m(D),paginationModel:E,onPaginationModelChange:S,pageSizeOptions:[10,25,50],getRowId:D=>D.id,onRowClick:Z,disableRowSelectionOnClick:!0,initialState:{sorting:{sortModel:[{field:"sales_order_number",sort:"desc"}]}},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),T]})};var rh={},N4;function fde(){if(N4)return rh;N4=1;var e=cr();Object.defineProperty(rh,"__esModule",{value:!0}),rh.default=void 0;var t=e(dr()),r=ur();return rh.default=(0,t.default)([(0,r.jsx)("path",{d:"M19.5 3.5 18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2v14H3v3c0 1.66 1.34 3 3 3h12c1.66 0 3-1.34 3-3V2zM19 19c0 .55-.45 1-1 1s-1-.45-1-1v-3H8V5h11z"},"0"),(0,r.jsx)("path",{d:"M9 7h6v2H9zm7 0h2v2h-2zm-7 3h6v2H9zm7 0h2v2h-2z"},"1")],"ReceiptLong"),rh}var hde=fde();const Cv=It(hde);var nh={},D4;function pde(){if(D4)return nh;D4=1;var e=cr();Object.defineProperty(nh,"__esModule",{value:!0}),nh.default=void 0;var t=e(dr()),r=ur();return nh.default=(0,t.default)((0,r.jsx)("path",{d:"M3 17v2h6v-2zM3 5v2h10V5zm10 16v-2h8v-2h-8v-2h-2v6zM7 9v2H3v2h4v2h2V9zm14 4v-2H11v2zm-6-4h2V7h4V5h-4V3h-2z"}),"Tune"),nh}var mde=pde();const gde=It(mde),$u=(e,t)=>{const r=parseFloat(String(e))||0,n=parseFloat(String(t))||0;return Math.round(r*n*100)/100},bo=e=>{const t=parseFloat(String(e));return isNaN(t)?0:t},kd={salesOrders:{customerPoNumber:!0,quotedPrice:!0,sourceQuote:!0,vin:!0,unitNumber:!0,vehicleMake:!0,vehicleModel:!0,invoiceStatus:!0,wantedByDate:!0,wantedByTimeOfDay:!0,productDescription:!0,terms:!0,mileage:!0,techStory:!0},invoices:{vin:!0,productDescription:!0,unitNumber:!0,vehicleMake:!0,vehicleModel:!0,mileage:!0,techStory:!0}},M4=e=>{const t=kd,r=(n,a)=>{const o={...a};return!n||typeof n!="object"||Object.keys(a).forEach(s=>{const l=n[s];o[s]=typeof l=="boolean"?l:a[s]}),o};return{salesOrders:r(e?.salesOrders,t.salesOrders),invoices:r(e?.invoices,t.invoices)}},Av={async fetchSettings(){try{const e=await ve.get("/api/settings/field-visibility");return M4(e.data?.settings)}catch(e){return console.warn("Failed to fetch field visibility settings, using defaults",e),{...kd}}},async updateSettings(e){const t=await ve.put("/api/settings/field-visibility",e);return M4(t.data?.settings)}},fR=async e=>(await ve.get(`/api/customers/${e}/vehicle-history`)).data,cl=e=>(e??"").trim().toUpperCase(),vde=e=>e!=null&&!(typeof e=="string"&&e.trim()===""),hR=e=>{const t=[],r=[],n={},a={},o=new Set,s=new Set;return e.forEach(l=>{const c=cl(l.unit_number),u=cl(l.vin_number);c&&!o.has(c)&&l.unit_number&&(t.push(l.unit_number),o.add(c)),u&&!s.has(u)&&l.vin_number&&(r.push(l.vin_number),s.add(u)),c&&u&&l.unit_number&&l.vin_number&&(n[c]||(n[c]=[]),n[c].some(d=>cl(d)===u)||n[c].push(l.vin_number),a[u]||(a[u]=[]),a[u].some(d=>cl(d)===c)||a[u].push(l.unit_number))}),{units:t,vins:r,unitToVins:n,vinToUnits:a}},pR=(e,t,r)=>{const n=cl(t),a=cl(r),o=e.filter(l=>{const c=cl(l.unit_number),u=cl(l.vin_number);return n&&c!==n||a&&u!==a?!1:!!(n||a)}),s=l=>{const c=o.find(u=>vde(u[l]));return c?c[l]:void 0};return{unit_number:s("unit_number"),vin_number:s("vin_number"),vehicle_make:s("vehicle_make"),vehicle_model:s("vehicle_model"),mileage:s("mileage"),product_name:s("product_name"),product_description:s("product_description")}},Pv=cl,$m=["Each","cm","ft","ft^2","kg","pcs","hr","L"],Cc=5,L4=e=>{if(typeof e=="string"){const t=e.trim().toLowerCase();if(["needed","need","required","pending"].includes(t))return"needed";if(["done","complete","completed","sent"].includes(t))return"done";if(["true","t","yes","y","1","on"].includes(t))return"needed";if(["false","f","no","n","0","off",""].includes(t))return""}return typeof e=="boolean"&&e?"needed":""},Ov=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim().toUpperCase(),yde=(e,t,r=8)=>{const n=Ov(t);if(!n)return e.slice(0,r);const a=e.map(o=>{const s=Ov(o.label);let l=-1;return s.startsWith(n)?l=3:s.split(" ").some(c=>c.startsWith(n))?l=2:s.includes(n)&&(l=1),{opt:o,score:l}}).filter(o=>o.score>=0);return a.sort((o,s)=>s.score-o.score||o.opt.label.localeCompare(s.opt.label)),a.slice(0,r).map(o=>o.opt)},xde=e=>e>=4?3:e===3?4:e===2?6:12,bde=()=>{const{id:e}=Ms(),t=e==="new",r=!!e&&/^\d+$/.test(e),n=Nn(),{user:a}=ea(),o=a?.access_role==="Sales and Purchase",s=a?.access_role==="Time Tracking",[l,c]=y.useState([]),[u,d]=y.useState([]),[f,h]=y.useState([]),[p,g]=y.useState(null),[m,x]=y.useState(null),[b,_]=y.useState(null),[w,A]=y.useState(null),[O,T]=y.useState(""),[E,S]=y.useState(!1),[I,z]=y.useState(null),[k,M]=y.useState(!1),R=y.useRef(null),[F,W]=y.useState([]),[K,Z]=y.useState(!1),D=y.useRef(null),[P,$]=y.useState(null),[Q,C]=y.useState(""),[L,H]=y.useState(!1),[U,te]=y.useState(null),[le,oe]=y.useState(Rt()),[ae,he]=y.useState(null),[me,X]=y.useState(""),[G,ee]=y.useState(""),[se,V]=y.useState(""),[He,Ne]=y.useState(""),[Re,Ke]=y.useState(""),[nt,st]=y.useState(""),[gt,Ge]=y.useState(""),[Je,We]=y.useState(""),[_t,Nt]=y.useState(""),[kt,Vt]=y.useState(""),[jt,Tr]=y.useState(""),qe=y.useCallback((de,pe)=>{Nt(pe??"")},[]),[$e,Xe]=y.useState(null),[Ue,ht]=y.useState(""),[at,wt]=y.useState([]);y.useMemo(()=>at.map(de=>({part_number:de.part_number,part_description:de.part_description,quantity:bo(de.quantity),unit:de.unit,unit_price:de.unit_price})),[at]);const Tt="salesOrderDetail.fieldVisibility",Jt={...kd.salesOrders},[Dr,qr]=y.useState(()=>{if(typeof window>"u")return Jt;try{const de=localStorage.getItem(Tt);if(de){const pe=JSON.parse(de);return{...Jt,...pe}}}catch(de){console.warn("Failed to read sales order field visibility preferences",de)}return Jt}),[ar,Er]=y.useState(Jt);y.useEffect(()=>{typeof window<"u"&&localStorage.setItem(Tt,JSON.stringify(Dr))},[Dr]),y.useEffect(()=>{(async()=>{try{const de=await Av.fetchSettings();Er(de.salesOrders),qr(pe=>{const ke={...pe};let Oe=!1;return Object.keys(de.salesOrders).forEach(rt=>{!de.salesOrders[rt]&&ke[rt]&&(ke[rt]=!1,Oe=!0)}),Oe?ke:pe})}catch(de){console.warn("Failed to load admin field visibility defaults; using user preferences",de)}})()},[]);const Ir=y.useMemo(()=>{const de={...Jt};return Object.keys(de).forEach(pe=>{de[pe]=!!(ar[pe]&&Dr[pe])}),s&&(de.quotedPrice=!1,de.invoiceStatus=!1,de.terms=!1),de},[ar,Dr,s]),[rn,Ta]=y.useState(null),Dn=de=>Ta(de.currentTarget),rr=()=>Ta(null),Kr=y.useMemo(()=>s?{partNumber:3,description:3,quantity:1.5,availability:1.5,unit:1.5,unitCost:0,amount:0,actions:1.5}:{partNumber:2.5,description:2.5,quantity:1,availability:1,unit:1,unitCost:1.5,amount:1.5,actions:1},[s]),Yn=y.useMemo(()=>{if(!at||at.length===0)return{subtotal:0,total_gst_amount:0,total_amount:0};const de=at.reduce((Oe,rt)=>{const bt=rt.line_amount||0;return Oe+bt},0),pe=de*.05,ke=de+pe;return{subtotal:Math.round(de*100)/100,total_gst_amount:Math.round(pe*100)/100,total_amount:Math.round(ke*100)/100}},[at]),Mn=Yn.subtotal,Qr=Yn.total_gst_amount,nn=Yn.total_amount,[Se,Ve]=y.useState(null),[it,Ct]=y.useState(!t),[Bt,Ht]=y.useState(null),[mr,an]=y.useState(null),[Be,tt]=y.useState([]),[At,Gt]=y.useState(""),[or,un]=y.useState(!1),[Ea,ro]=y.useState(!1),Un=y.useCallback(de=>JSON.stringify((de||[]).map(pe=>({part_number:(pe.part_number||"").trim(),part_description:(pe.part_description||"").trim(),quantity:bo(pe.quantity),unit:(pe.unit||"").trim(),unit_price:bo(pe.unit_price)})).sort((pe,ke)=>pe.part_number!==ke.part_number?pe.part_number.localeCompare(ke.part_number):pe.quantity-ke.quantity)),[]),Kn=y.useCallback(()=>({customer:w?{id:w.id,label:w.label}:null,product:P?{id:P.id,label:P.label}:null,salesDate:le?le.toISOString():null,wantedByDate:ae?ae.toISOString():null,wantedByTimeOfDay:kt,terms:(G||"").trim(),customerPoNumber:(se||"").trim(),vinNumber:(He||"").trim(),unitNumber:(Re||"").trim(),estimatedCost:$e!=null?Number($e):null,vehicleMake:(nt||"").trim(),vehicleModel:(gt||"").trim(),mileage:Je===""?"":Number(Je),invoiceStatus:_t}),[w,P,le,ae,kt,G,se,He,Re,$e,nt,gt,Je,_t]);y.useEffect(()=>{if(or&&At===""){const de=JSON.stringify({header:Kn(),lineItems:Un(at)});Gt(de)}},[or,At,Kn,Un,at]);const Fi=y.useMemo(()=>JSON.stringify({header:Kn(),lineItems:Un(at)}),[Kn,Un,at]),ji=!!At&&At!==Fi&&!Ea,Qe=!!Se&&Se.status?.toLowerCase()==="closed",[Yt,sr]=y.useState([]),[Mr,Ar]=y.useState([]),[dn,Fr]=y.useState(null),[ta,jn]=y.useState(null),[Ia,Na]=y.useState(null),[ai,ra]=y.useState(null),[On,Gr]=y.useState(null),[no,ao]=y.useState(null),[io,Si]=y.useState(!1),[oo,pi]=y.useState(null),[Oo,$i]=y.useState(""),[fs,so]=y.useState(!1),[hs,Qa]=y.useState(null),[lo,ii]=y.useState(""),zn=Mr.length>0?8+64*Mr.length:0,Yo={p:3,mb:3,border:"1px solid",borderColor:"divider",borderRadius:2,boxShadow:"0 8px 24px rgba(0,0,0,0.06)"},ko={display:"grid",gap:2,gridAutoFlow:"row dense",alignItems:"stretch"},wr={...ko,gridTemplateColumns:{xs:"1fr",sm:"repeat(2, minmax(0, 1fr))",md:"2fr 1fr 1fr"}},Al={...ko,gridTemplateColumns:{xs:"1fr",sm:"repeat(2, minmax(0, 1fr))",md:"repeat(3, minmax(0, 1fr))",lg:"1.2fr repeat(4, minmax(0, 1fr))"}},fc={...ko,gridTemplateColumns:{xs:"1fr",sm:"repeat(2, minmax(0, 1fr))",md:"repeat(3, minmax(0, 1fr))"}},Ci=y.useCallback((de,pe)=>{const ke={},Oe=de??Re,rt=pe??He;if(de!==void 0&&(ke.unit=de),pe!==void 0&&(ke.vin=pe),F.length&&(Oe||rt)){const bt=pR(F,Oe,rt);bt.unit_number&&(ke.unit=bt.unit_number),bt.vin_number&&(ke.vin=bt.vin_number),bt.vehicle_make&&(ke.make=bt.vehicle_make),bt.vehicle_model&&(ke.model=bt.vehicle_model);const Ut=bt.mileage;if(Ut!=null&&String(Ut)!==""){const Dt=Number(Ut);ke.mileage=Number.isFinite(Dt)?Dt:Ut}}ke.unit!==void 0&&Ke(ke.unit),ke.vin!==void 0&&Ne(ke.vin),ke.make!==void 0&&st(ke.make),ke.model!==void 0&&Ge(ke.model),ke.mileage!==void 0&&We(ke.mileage)},[Re,F,He]),Fs=!!(w?.id||Se?.customer_id);y.useMemo(()=>JSON.stringify(at.map(de=>({part_number:de.part_number,part_description:de.part_description,quantity:de.quantity,unit:de.unit,unit_price:de.unit_price,line_amount:de.line_amount}))),[at]);const{units:Ai,vins:Ko,unitToVins:oi,vinToUnits:Bi}=y.useMemo(()=>hR(F),[F]),hc=y.useMemo(()=>{const de=Pv(Re);return de&&oi[de]?oi[de]:Ko},[Re,oi,Ko]),$s=y.useMemo(()=>{const de=Pv(He);return de&&Bi[de]?Bi[de]:Ai},[Ai,He,Bi]),co=y.useMemo(()=>{const de={};for(const pe of f||[])pe?.part_number&&(de[String(pe.part_number)]=pe.part_description||"");return de},[f]),To=y.useCallback((de,pe,ke=!1)=>{const Oe=(pe.inputValue||"").toUpperCase(),rt=50,bt=[];for(const Dt of de){const fr=String(Dt).toUpperCase(),Xn=(co[Dt]||"").toUpperCase();if((!Oe||fr.includes(Oe)||Xn.includes(Oe))&&(bt.push(Dt),bt.length>=rt))break}const Ut=bt.some(Dt=>String(typeof Dt=="string"?Dt:Dt?.label||"").toUpperCase()===Oe);return ke&&Oe&&!Ut&&bt.push({label:`Add "${pe.inputValue}" as New Part`,isNew:!0,inputValue:pe.inputValue}),bt},[co]),Eo=(de,pe)=>{const ke=(at[de]?.part_number||"").trim(),Oe=pe.key==="Enter",rt=pe.key==="Tab",bt=pe.key==="Escape",Ut=pe.key==="ArrowDown"||pe.key==="ArrowUp";if(bt){jn(null);return}if(Ut){pe.key==="ArrowDown"&&ta!==de&&jn(de);return}if(!(ta===de&&(Oe||rt))&&(Oe||rt)&&ke){if(Oe&&pe.ctrlKey){pe.preventDefault(),ra(de),$i(ke.toUpperCase()),pi(de),Si(!0),jn(null);return}!f.find(fr=>fr.part_number.toUpperCase()===ke.toUpperCase())&&Oe&&(pe.preventDefault(),ra(de),$i(ke.toUpperCase()),pi(de),Si(!0),jn(null))}},Pl=(de,pe)=>{const ke=(Be[de]?.part_number||"").trim(),Oe=pe.key==="Enter",rt=pe.key==="Tab",bt=pe.key==="Escape",Ut=pe.key==="ArrowDown"||pe.key==="ArrowUp";if(bt){Gr(null);return}if(Ut){pe.key==="ArrowDown"&&On!==de&&Gr(de);return}if(!(On===de&&(Oe||rt))&&(Oe||rt)&&ke){if(Oe&&pe.ctrlKey){pe.preventDefault(),ao(de),ii(ke.toUpperCase()),Qa(de),so(!0),Gr(null);return}!f.find(fr=>fr.part_number.toUpperCase()===ke.toUpperCase())&&Oe&&(pe.preventDefault(),ao(de),ii(ke.toUpperCase()),Qa(de),so(!0),Gr(null))}},Pi=de=>l.find(pe=>Ov(pe.label)===Ov(de))||null,[Bs,Ui]=y.useState(!1),[Us,be]=y.useState(""),[we,Te]=y.useState(!1),[De,Ie]=y.useState(""),[pt,Et]=y.useState(!1),[Lt,Pr]=y.useState([]),[Hr,gn]=y.useState(null),[na,Qn]=y.useState(!1),[Oi,si]=y.useState(!1),[Da,Ua]=y.useState(null),[zi,uo]=y.useState(null),[Io,ki]=y.useState(!1),[Wi,Hi]=y.useState(!1),[ps,li]=y.useState(null);y.useEffect(()=>{(async()=>{try{const[de,pe,ke]=await Promise.all([ve.get("/api/customers"),ve.get("/api/products"),ve.get("/api/inventory")]);c(de.data.map(Oe=>({label:Oe.customer_name,id:Oe.customer_id}))),d(pe.data.map(Oe=>({label:Oe.product_name,id:Oe.product_id,description:Oe.product_description}))),h(ke.data),t&&un(!0)}catch(de){console.error("Prefetch failed",de)}})()},[]),y.useEffect(()=>{(async()=>{try{const[de,pe,ke]=await Promise.all([ve.get("/api/settings/labour-rate").catch(()=>({data:{labour_rate:null}})),ve.get("/api/settings/overhead-rate").catch(()=>({data:{overhead_rate:null}})),ve.get("/api/settings/supply-rate").catch(()=>({data:{supply_rate:null}}))]);g(de.data.labour_rate??null),x(pe.data.overhead_rate??null),_(ke.data.supply_rate??null)}catch{}})()},[]);const pc=y.useCallback(async()=>{if(!(Wi||l.length>0)){Hi(!0);try{const de=await ve.get("/api/customers");c(de.data.map(pe=>({label:pe.customer_name,id:pe.customer_id})))}catch(de){console.error("Failed to reload customers",de)}finally{Hi(!1)}}},[l.length,Wi]),N=y.useCallback(async de=>{if(!de){W([]),D.current=null;return}if(!(D.current===de&&F.length)){D.current=de,Z(!0);try{const ke=[...(await fR(de)).records||[]].sort((Oe,rt)=>{const bt=Oe.activity_date?new Date(Oe.activity_date).getTime():0;return(rt.activity_date?new Date(rt.activity_date).getTime():0)-bt});W(ke)}catch(pe){console.error("Failed to load vehicle history for customer",pe),W([])}finally{Z(!1)}}},[F.length]);y.useEffect(()=>{if(!e||t||!r){t&&(wt([{part_number:"",part_description:"",quantity:"",unit:$m[0],unit_price:0,gst:Cc,line_amount:0}]),un(!0),ht(""),Tr(""));return}(async()=>{Ct(!0),Ht(null);try{const pe=(await ve.get(`/api/sales-orders/${e}`)).data,ke=L4(pe.salesOrder?.invoice_status??pe.salesOrder?.invoice_required);Ve(pe.salesOrder?{...pe.salesOrder,invoice_status:ke||null}:null),ht(pe.salesOrder?.source_quote_number||"");const Oe=(pe.lineItems||pe.salesOrder?.line_items||[]).map(fr=>({part_number:fr.part_number,part_description:fr.part_description,unit:fr.unit,unit_price:fr.unit_price,line_amount:Number(fr.line_amount||0),quantity:fr.part_number==="SUPPLY"?"1":["LABOUR","OVERHEAD"].includes(fr.part_number)?String(fr.quantity_sold||0):String(fr.quantity_sold??fr.quantity??0),gst:Cc,part_id:fr.part_id??void 0}));console.log("[SalesOrderDetail] Raw line items from backend:",pe.lineItems),console.log("[SalesOrderDetail] Mapped line items:",Oe),wt(Oe),sr(Oe);const rt=(pe.partsToOrder||[]).map(fr=>({sales_order_id:parseInt(e),part_number:fr.part_number,part_description:fr.part_description,quantity_to_order:String(fr.quantity_needed||0),unit:fr.unit||"Each",unit_price:Number(fr.unit_price||0),line_amount:Number(fr.line_amount||0)}));tt(rt),oe(Rt(pe.salesOrder?.sales_date)),he(pe.salesOrder?.wanted_by_date?Rt(pe.salesOrder?.wanted_by_date):null);const bt=pe.salesOrder?.wanted_by_time_of_day?String(pe.salesOrder.wanted_by_time_of_day).toLowerCase():"";Vt(bt||""),Xe(pe.salesOrder?.estimated_cost||0),X(pe.salesOrder?.product_description||""),ee(pe.salesOrder?.terms||""),V(pe.salesOrder?.customer_po_number||""),Ne(pe.salesOrder?.vin_number||""),Ke(pe.salesOrder?.unit_number||""),We(pe.salesOrder?.mileage===null||pe.salesOrder?.mileage===void 0?"":Number(pe.salesOrder.mileage)),st(pe.salesOrder?.vehicle_make||""),Ge(pe.salesOrder?.vehicle_model||""),Nt(ke),Tr(pe.salesOrder?.tech_story||"");const Ut=l.find(fr=>fr.id===pe.salesOrder?.customer_id)||{label:pe.salesOrder?.customer_name||"",id:pe.salesOrder?.customer_id};A(Ut?.id?Ut:null);const Dt=u.find(fr=>fr.label===pe.salesOrder?.product_name)||{label:pe.salesOrder?.product_name||""};$(Dt?.label?Dt:null)}catch(de){console.error(de),Ht(de?.response?.status===404?"Sales order not found. It may have been deleted.":"Failed to load sales order data. Please try again.")}finally{Ct(!1),un(!0)}})()},[e,t,r]),y.useEffect(()=>{const de=w?.id??Se?.customer_id??null;N(de?Number(de):null)},[w?.id,N,Se?.customer_id]),y.useEffect(()=>{or&&p!==null&&wt(de=>de.map(pe=>pe.part_number!=="LABOUR"?pe:pe.unit_price!==p?{...pe,unit_price:p}:pe))},[p,or]),y.useEffect(()=>{or&&m!==null&&wt(de=>de.map(pe=>pe.part_number!=="OVERHEAD"?pe:pe.unit_price!==m?{...pe,unit_price:m}:pe))},[m,or]),y.useEffect(()=>{or&&wt(de=>{const pe=de.some(Oe=>Oe.part_number==="LABOUR"),ke=de.some(Oe=>Oe.part_number==="SUPPLY");if(b&&b>0){if(pe&&!ke)return[...de,{part_number:"SUPPLY",part_description:"Supply",quantity:t?"":"1",unit:t?"":"Each",unit_price:0,gst:Cc,line_amount:0}];if(!pe&&ke)return de.filter(Oe=>Oe.part_number!=="SUPPLY")}else if(ke)return de.filter(Oe=>Oe.part_number!=="SUPPLY");return de})},[b,at,or,t]),y.useEffect(()=>{or&&(!f||f.length===0||!at||at.length===0||wt(de=>{let pe=!1;const ke=de.map(Oe=>{if(["LABOUR","OVERHEAD","SUPPLY"].includes(Oe.part_number))return Oe;const rt=(f||[]).find(Vi=>String(Vi.part_number).trim().toUpperCase()===String(Oe.part_number).trim().toUpperCase());if(!rt)return Oe;const bt=String(rt.unit||"").trim(),Ut=String(Oe.unit||"").trim(),Dt=String(rt.part_description||""),Xn=parseFloat(String(rt.last_unit_cost))||0;let xa=Oe;return bt&&bt!==Ut&&(xa={...xa,unit:bt},pe=!0),Dt&&Dt!==Oe.part_description&&(xa={...xa,part_description:Dt},pe=!0),!isNaN(Xn)&&Xn!==Oe.unit_price&&(xa={...xa,unit_price:Xn},pe=!0),xa});return pe?ke:de}))},[or,f,at]);const ne=de=>f.find(pe=>pe.part_number===de),je=(de,pe)=>{wt(ke=>{const Oe=[...ke];if(!pe||pe.trim()==="")Oe[de]={...Oe[de],part_number:"",part_description:"",quantity:"",unit:$m[0],unit_price:0,line_amount:0};else if(pe.toUpperCase()==="LABOUR")Oe[de]={...Oe[de],part_number:"LABOUR",part_description:"Labour",unit:"hr",unit_price:p??0,line_amount:0};else if(pe.toUpperCase()==="OVERHEAD")Oe[de]={...Oe[de],part_number:"OVERHEAD",part_description:"Overhead",unit:"hr",unit_price:m??0,line_amount:0};else if(pe.toUpperCase()==="SUPPLY")Oe[de]={...Oe[de],part_number:"SUPPLY",part_description:"Supply",unit:t?"":"Each",unit_price:0,line_amount:0};else{const rt=ne(pe);if(rt){const Ut=parseFloat(String(rt.last_unit_cost))||0,Dt=bo(Oe[de]?.quantity),fr=$u(Dt,Ut);Oe[de]={...Oe[de],part_number:pe,part_description:rt.part_description||"",unit:rt.unit,unit_price:Ut,line_amount:fr}}else Oe[de]={...Oe[de],part_number:pe,part_description:"Part not found",unit_price:0,line_amount:0}}return Oe})},Ee=(de,pe,ke)=>{wt(Oe=>{const rt=[...Oe],bt={...rt[de],[pe]:ke};if(parseFloat(ke)<=0&&bt.part_number!=="SUPPLY")return rt.filter((Ut,Dt)=>Dt!==de);if(["LABOUR","OVERHEAD"].includes(bt.part_number))return rt[de]=bt,rt;{const Ut=bo(bt.quantity),Dt=bo(bt.unit_price);bt.line_amount=$u(Ut,Dt)}return rt[de]=bt,rt})},Ye=()=>{wt(de=>[...de,{part_number:"",part_description:"",quantity:"",unit:$m[0],unit_price:0,gst:Cc,line_amount:0}])},dt=de=>{wt(pe=>pe.filter((ke,Oe)=>Oe!==de))},Pt=(de,pe)=>{if(["LABOUR","OVERHEAD","SUPPLY"].includes(de.part_number))return null;const ke=f.find(Xn=>Xn.part_number.toLowerCase()===de.part_number.toLowerCase());if(!ke||ke.part_type==="supply")return null;const Oe=parseFloat(ke.quantity_on_hand)||0;if(t){const Xn=at.filter(Vi=>Vi.part_number.toLowerCase()===de.part_number.toLowerCase()).reduce((Vi,Ws)=>Vi+(parseFloat(String(Ws.quantity).replace(/[^\d.-]/g,""))||0),0),xa=Oe-Xn;return{available:xa<0?Math.floor(xa):Math.round(xa),isNegative:xa<0,currentStock:Oe,changeInQuantity:Xn,totalQuantityForPart:Xn,totalOriginalQuantityForPart:0}}const rt=at.filter(Xn=>Xn.part_number.toLowerCase()===de.part_number.toLowerCase()).reduce((Xn,xa)=>Xn+(parseFloat(String(xa.quantity).replace(/[^\d.-]/g,""))||0),0),bt=Yt.filter(Xn=>Xn.part_number.toLowerCase()===de.part_number.toLowerCase()).reduce((Xn,xa)=>Xn+(parseFloat(String(xa.quantity).replace(/[^\d.-]/g,""))||0),0),Ut=rt-bt,Dt=Oe-Ut,fr=Dt<0?Math.floor(Dt):Math.round(Dt);return{available:fr,isNegative:fr<0,currentStock:Oe,changeInQuantity:Ut,totalQuantityForPart:rt,totalOriginalQuantityForPart:bt}},Wt=y.useMemo(()=>at.map((de,pe)=>Pt(de)),[at,f,Yt,t]);y.useEffect(()=>{if(t)return;const de=[];at.forEach((pe,ke)=>{const Oe=Pt(pe);Oe&&Oe.available<0&&de.push({lineItemIndex:ke,partNumber:pe.part_number,partDescription:pe.part_description,excessQuantity:Math.abs(Oe.available),unit:pe.unit})}),Ar(de)},[at,f,t]);const lr=()=>{if(at.filter(Oe=>!Oe.part_number||Oe.part_number.trim()==="").length>0)return ge.error("Line items with blank part numbers are not allowed."),!1;const pe=at.filter(Oe=>{if(["LABOUR","OVERHEAD","SUPPLY"].includes(String(Oe.part_number).toUpperCase()))return!1;const rt=Oe.part_id;if(rt){const Ut=(f||[]).find(Dt=>Dt.part_id===rt);return Ut?Ut.part_type==="supply":!1}const bt=(f||[]).find(Ut=>String(Ut.part_number).toUpperCase()===String(Oe.part_number).trim().toUpperCase());return!bt||bt.part_type==="supply"});if(pe.length>0){const Oe=pe.map(rt=>rt.part_number).join(", ");return ge.error(`Invalid or supply parts (not allowed): ${Oe}`),!1}return at.some((Oe,rt)=>{const bt=Pt(Oe);return bt&&bt.available<0})?(li("Insufficient inventory for one or more parts."),!1):(li(null),!0)},Lr=de=>{const pe=de.reduce((ke,Oe)=>{const rt=Oe.part_number.trim().toLowerCase();if(!ke[rt]){const bt=["LABOUR","OVERHEAD","SUPPLY"].includes(Oe.part_number.toUpperCase())?null:(f||[]).find(Ut=>String(Ut.part_number).toUpperCase()===Oe.part_number.trim().toUpperCase());ke[rt]={part_number:Oe.part_number.trim(),part_description:Oe.part_description.trim(),unit:Oe.unit.trim(),unit_price:Oe.unit_price!=null?Number(Oe.unit_price):0,line_amount:0,quantity_sold:0,...Oe.part_id?{part_id:Oe.part_id}:bt&&bt.part_id?{part_id:bt.part_id}:{}}}if(Oe.part_number.toUpperCase()==="SUPPLY")ke[rt].quantity_sold=1,ke[rt].unit="Each",ke[rt].unit_price=0,ke[rt].line_amount+=Number(Oe.line_amount||0);else if(["LABOUR","OVERHEAD"].includes(Oe.part_number.toUpperCase())){const bt=parseFloat(String(Oe.quantity).replace(/[^\d.-]/g,""))||0;ke[rt].quantity_sold=bt,ke[rt].line_amount=Number(Oe.line_amount||0)}else{const bt=parseFloat(String(Oe.quantity).replace(/[^\d.-]/g,""))||0,Ut=Number.isFinite(bt)?bt:0;ke[rt].quantity_sold+=Ut,ke[rt].line_amount+=Ut*(Oe.unit_price||0)}return ke},{});return Object.values(pe)},Or=async()=>{if(!w||!le||!P){ge.error("Please fill in required fields.");return}if(!lr())return;const de={customer_id:w?.id,sales_date:le?le.toISOString():new Date().toISOString(),wanted_by_date:ae?ae.format("YYYY-MM-DD"):null,wanted_by_time_of_day:kt||null,product_name:P?.label?.trim(),product_description:me.trim(),terms:G.trim(),customer_po_number:se.trim(),vin_number:He.trim(),unit_number:Re.trim(),vehicle_make:nt.trim(),vehicle_model:gt.trim(),mileage:Je===""?null:Number(Je),invoice_status:_t||null,status:t?"Open":Se?.status||"Open",estimated_cost:$e!=null?Number($e):0,lineItems:Lr(at),source_quote_number:Ue?.trim()||null,tech_story:jt?.trim()||null};ro(!0);try{if(t){if(window.__soCreateInFlight){console.log("[SO] Skipping duplicate create (in flight)");return}window.__soCreateInFlight=!0;const pe=await ve.post("/api/sales-orders",de);ge.success("Sales Order created successfully!"),window.__unsavedGuardAllowNext=!0,n(`/open-sales-orders/${pe.data.sales_order_id}`)}else{const pe=Be.filter(ke=>ke.part_number&&parseFloat(String(ke.quantity_to_order))>0).map(ke=>({sales_order_id:Number(e),part_number:ke.part_number.trim(),part_description:ke.part_description.trim(),quantity_needed:parseFloat(String(ke.quantity_to_order))||0,unit:ke.unit.trim(),unit_price:ke.unit_price,line_amount:ke.line_amount}));await ve.put(`/api/sales-orders/${e}`,{...de,partsToOrder:pe}),an("Sales Order updated successfully!"),setTimeout(()=>{window.__unsavedGuardAllowNext=!0},100),Gt(JSON.stringify({header:Kn(),lineItems:at,quantityToOrderItems:Be}));try{const[ke,Oe]=await Promise.all([ve.get(`/api/sales-orders/${e}`),ve.get("/api/inventory")]),rt=ke.data,bt=L4(rt.salesOrder?.invoice_status??rt.salesOrder?.invoice_required);Ve(rt.salesOrder?{...rt.salesOrder,invoice_status:bt||null}:null),Nt(bt),ht(rt.salesOrder?.source_quote_number||""),Ke(rt.salesOrder?.unit_number||""),We(rt.salesOrder?.mileage===null||rt.salesOrder?.mileage===void 0?"":Number(rt.salesOrder.mileage));const Ut=(rt.lineItems||rt.salesOrder?.line_items||[]).map(Dt=>({part_number:Dt.part_number,part_description:Dt.part_description,unit:Dt.unit,unit_price:Dt.unit_price,line_amount:Number(Dt.line_amount||0),quantity:Dt.part_number==="SUPPLY"?"1":["LABOUR","OVERHEAD"].includes(Dt.part_number)?String(Dt.quantity_sold||0):String(Dt.quantity_sold??Dt.quantity??0),gst:Cc,part_id:Dt.part_id??void 0}));wt(Ut),sr(Ut),h(Oe.data)}catch{}}}catch(pe){const ke=pe?.response?.data?.error||pe?.response?.data?.details||pe?.response?.data?.message||"Failed to save sales order.";li(ke)}finally{ro(!1),window.__soCreateInFlight=!1}},Xr=async()=>{if(t||!Se)return;const de=at.filter(pe=>!["LABOUR","OVERHEAD","SUPPLY"].includes(pe.part_number)&&(parseFloat(String(pe.quantity).replace(/[^\d.-]/g,""))||0)===0);if(de.length>0){ge.error(`Cannot close: line items with 0 quantity: ${de.map(pe=>pe.part_number).join(", ")}`);return}if(Be.some(pe=>parseFloat(String(pe.quantity_to_order))>0)){const pe=Be.filter(ke=>parseFloat(String(ke.quantity_to_order))>0).map(ke=>`${ke.part_number} (${ke.quantity_to_order})`).join(", ");ge.error(`Cannot close: parts still need to be ordered: ${pe}`);return}try{await ve.put(`/api/sales-orders/${Se.sales_order_id}`,{customer_id:Se.customer_id,sales_date:Se.sales_date,product_name:P?.label?.trim()||Se.product_name,product_description:me.trim(),terms:G.trim(),unit_number:Re.trim()||Se.unit_number,status:"Closed",estimated_cost:$e??Se.estimated_cost,lineItems:Lr(at)}),ge.success("Sales Order closed successfully!"),Ve(pe=>pe&&{...pe,status:"Closed"})}catch(pe){const ke=pe?.response?.data?.error||pe?.response?.data?.details||pe?.response?.data?.message||"Failed to close sales order.";li(ke)}},Ln=async()=>{if(!(t||!Se))try{await ve.put(`/api/sales-orders/${Se.sales_order_id}`,{customer_id:Se.customer_id,sales_date:Se.sales_date,product_name:P?.label?.trim()||Se.product_name,product_description:me.trim(),terms:G.trim(),unit_number:Re.trim()||Se.unit_number,status:"Open",estimated_cost:$e??Se.estimated_cost,lineItems:Lr(at)}),ge.success("Sales Order reopened successfully!"),Ve(de=>de&&{...de,status:"Open"}),n(`/open-sales-orders/${Se.sales_order_id}`)}catch(de){const pe=de?.response?.data?.error||de?.response?.data?.details||de?.response?.data?.message||"Failed to reopen sales order.";li(pe)}},Wn=async()=>{if(t)return await(async()=>(await Or(),!0))(),void 0;if(Se)try{Se.status?.toLowerCase()!=="closed"&&await Or();const de=Object.entries(Ir).filter(([,rt])=>rt).map(([rt])=>rt).join(","),pe=await ve.get(`/api/sales-orders/${Se.sales_order_id}/pdf`,{responseType:"blob",params:{visibleFields:de}}),ke=window.URL.createObjectURL(new Blob([pe.data],{type:"application/pdf"})),Oe=document.createElement("a");Oe.href=ke,Oe.download=`sales_order_${Se.sales_order_number}.pdf`,document.body.appendChild(Oe),Oe.click(),Oe.remove(),window.URL.revokeObjectURL(ke),ge.success(Se.status?.toLowerCase()==="closed"?"PDF downloaded.":"Saved and downloaded PDF.")}catch(de){const pe=de?.response?.data?.error||de?.response?.data?.details||de?.response?.data?.message||"Failed to save or download PDF.";li(pe)}},aa=async()=>{if(Se){ki(!0);try{const de=await ve.post(`/api/invoices/from-sales-order/${Se.sales_order_id}`),pe=de.data?.invoice_id||de.data?.id||de.data?.invoice?.invoice_id;ge.success("Invoice created from this sales order"),pe&&n(`/invoices/${pe}`),Ve(ke=>ke&&{...ke,invoice_status:"done"})}catch(de){console.error("Failed to create invoice",de);const pe=de?.response?.data?.error||"Failed to create invoice";ge.error(pe)}finally{ki(!1)}}},za=async()=>{if(!(t||!Se)){if(Be.some(de=>parseFloat(String(de.quantity_to_order))>0)){const de=Be.filter(pe=>parseFloat(String(pe.quantity_to_order))>0).map(pe=>`${pe.part_number} (${pe.quantity_to_order})`).join(", ");ge.error(`Cannot export to QuickBooks: parts to order exist: ${de}`);return}si(!0),Ua(null),uo(null);try{const de=await ve.post(`/api/sales-orders/${Se.sales_order_id}/export-to-qbo`);uo("Sales Order exported to QuickBooks successfully!"),Ve(pe=>pe&&{...pe,exported_to_qbo:!0,qbo_invoice_id:de.data.qbo_invoice_id,qbo_export_date:new Date().toISOString(),qbo_export_status:"Success"}),ge.success("Exported to QuickBooks.")}catch(de){const pe=de?.response?.data;if(pe?.error==="CUSTOMER_NOT_FOUND")if(window.confirm(`Customer '${pe.customerName}' does not exist in QuickBooks.
Create it and export the Sales Order?`))try{const Oe=await ve.post(`/api/sales-orders/${Se.sales_order_id}/export-to-qbo-with-customer`,{customerData:pe.customerData});ge.success("Customer created and Sales Order exported."),uo("Customer created and Sales Order exported."),Ve(rt=>rt&&{...rt,exported_to_qbo:!0,qbo_invoice_id:Oe.data.qbo_invoice_id,qbo_export_date:new Date().toISOString(),qbo_export_status:"Success"})}catch(Oe){const rt=Oe?.response?.data?.error||"Failed to create customer and export to QuickBooks.";Ua(rt),ge.error(rt)}else Ua("Export cancelled. Customer must exist in QuickBooks.");else{const ke=pe?.error||pe?.message||"Failed to export to QuickBooks.";Ua(ke),ge.error(ke)}}finally{si(!1)}}},Ma=async()=>{Qn(!0);try{const de=await ve.get("/api/sales-orders");Pr(de.data)}catch{ge.error("Failed to fetch sales orders for import")}finally{Qn(!1)}},fo=()=>{Et(!0),Ma()},Ti=async()=>{if(Hr){Qn(!0);try{const de=await ve.get(`/api/sales-orders/${Hr.sales_order_id}`),Oe=(de.data.lineItems||de.data.salesOrder?.line_items||[]).filter(rt=>(rt.part_number||"").toUpperCase()!=="LABOUR").map(rt=>({part_number:rt.part_number,part_description:rt.part_description,quantity:String(t?rt.quantity:rt.quantity_sold??rt.quantity??0),unit:rt.unit,unit_price:rt.unit_price,gst:Cc,line_amount:rt.line_amount,part_id:rt.part_id??void 0}));wt(Oe),Et(!1),gn(null),ge.success("Line items imported!")}catch{ge.error("Failed to import line items")}finally{Qn(!1)}}},No=de=>{const pe=O.trim(),ke=de.key==="Enter",Oe=de.key==="Tab";if(de.key==="Escape"){S(!1);return}if(ke||Oe){if(ke&&de.ctrlKey&&pe){de.preventDefault(),M(!0),be(pe),Ui(!0);return}if(E||!pe)return;de.preventDefault();const bt=Pi(pe);bt?(A(bt),T(bt.label)):(M(!0),be(pe),Ui(!0))}},uu=de=>{if(de.key!=="Enter")return;de.preventDefault();const pe=Q.trim();if(!pe)return;const ke=u.find(Oe=>Oe.label.toLowerCase()===pe.toLowerCase());ke?($(ke),C(ke.label)):(Ie(pe),Te(!0))},mc=()=>{if(!Se)return null;const de=at||[];let pe=de.reduce((rt,bt)=>rt+(Number(bt.line_amount)||0),0),ke=pe*.05,Oe=pe+ke;return isNaN(pe)&&(pe=0),isNaN(ke)&&(ke=0),isNaN(Oe)&&(Oe=0),i.jsxs(J,{p:{xs:2,md:4},maxWidth:1e3,mx:"auto",children:[zi&&i.jsx(Ot,{severity:"success",sx:{mb:2},onClose:()=>uo(null),children:zi}),Da&&i.jsx(Ot,{severity:"error",sx:{mb:2},onClose:()=>Ua(null),children:Da}),i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Sales Order Details"}),i.jsx(Br,{variant:"outlined",sx:{mb:3},children:i.jsx(Vr,{children:i.jsxs(ie,{container:!0,spacing:{xs:2,md:3},children:[i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Sales Order #:"})," ",Se.sales_order_number]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Customer:"})," ",Se.customer_name||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Sales Date:"})," ",Se.sales_date?new Date(Se.sales_date).toLocaleDateString():""]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Wanted By:"})," ",Se.wanted_by_date?new Date(Se.wanted_by_date).toLocaleDateString():"N/A",Se.wanted_by_time_of_day?` (${String(Se.wanted_by_time_of_day).charAt(0).toUpperCase()}${String(Se.wanted_by_time_of_day).slice(1)})`:""]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Status:"})," ",Se.status?.toUpperCase()||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"VIN #:"})," ",Se.vin_number||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Unit #:"})," ",Se.unit_number||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Mileage:"})," ",Se.mileage??"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Make:"})," ",Se.vehicle_make||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Model:"})," ",Se.vehicle_model||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Invoice:"})," ",Se.invoice_status==="done"&&i.jsxs(J,{component:"span",sx:{display:"inline-flex",alignItems:"center",gap:.5},children:[i.jsx(ac,{color:"success",fontSize:"small"})," Done"]}),Se.invoice_status==="needed"&&i.jsxs(J,{component:"span",sx:{display:"inline-flex",alignItems:"center",gap:.5},children:[i.jsx(Ww,{color:"error",fontSize:"small"})," Needed"]}),!Se.invoice_status&&""]}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx("b",{children:"Estimated Price:"})," ",Va(Se.estimated_cost||0)]}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx("b",{children:"Product Description:"})," ",Se.product_description||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx("b",{children:"Tech Story:"}),i.jsx(J,{sx:{whiteSpace:"pre-line",mt:.5},children:Se.tech_story||"N/A"})]}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx("b",{children:"Terms:"})," ",Se.terms||"N/A"]}),Se.exported_to_qbo&&i.jsxs(ie,{item:!0,xs:12,children:[i.jsx("b",{children:"QBO Export:"})," Exported",Se.qbo_invoice_id&&` (Invoice ID: ${Se.qbo_invoice_id})`,Se.qbo_export_date&&` on ${new Date(Se.qbo_export_date).toLocaleDateString()}`]})]})})}),i.jsx(B,{variant:"h5",gutterBottom:!0,children:"Items"}),i.jsx(Br,{variant:"outlined",children:i.jsx(Vr,{children:de.map((rt,bt)=>i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:3,md:2,children:rt.part_number}),i.jsx(ie,{item:!0,xs:6,sm:5,md:4,children:rt.part_description}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1.5,children:rt.quantity}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1.5,children:rt.unit}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1.5,children:Va(rt.unit_price)}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1,children:Va(rt.line_amount)})]},bt))})}),i.jsxs(J,{mt:4,display:"flex",flexDirection:"column",alignItems:"flex-end",children:[i.jsxs(B,{variant:"h6",children:["Subtotal: ",Va(pe)]}),i.jsxs(B,{variant:"h6",children:["Total GST: ",Va(ke)]}),i.jsxs(B,{variant:"h6",children:["Total Amount: ",Va(Oe)]})]}),i.jsxs(J,{mt:4,display:"flex",justifyContent:{xs:"center",sm:"flex-end"},gap:2,children:[i.jsx(ye,{variant:"contained",color:"primary",startIcon:i.jsx(da,{}),onClick:Wn,children:"Download PDF"}),!Se.exported_to_qbo&&i.jsx(ye,{variant:"contained",color:"success",startIcon:i.jsx(Ap,{}),disabled:Oi,onClick:za,children:Oi?"Exporting...":"Export to QuickBooks"}),i.jsx(ye,{variant:"contained",color:"secondary",startIcon:i.jsx(Cv,{}),onClick:aa,disabled:Io,children:Io?"Creating Invoice...":"Create Invoice"}),a?.access_role!=="Sales and Purchase"&&i.jsx(ye,{variant:"contained",color:"primary",onClick:Ln,children:"Reopen SO"})]})]})};if(!t&&it)return i.jsxs(ir,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(nr,{}),i.jsx(B,{children:"Loading sales order..."})]});if(!t&&Bt)return i.jsxs(ir,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(Ot,{severity:"error",sx:{mb:2},children:Bt}),i.jsx(ye,{variant:"contained",onClick:()=>window.location.reload(),sx:{mr:2},children:"Retry"}),i.jsx(ye,{variant:"outlined",onClick:()=>n("/open-sales-orders"),children:"Back to Sales Orders"})]});if(!t&&Qe&&a?.access_role==="Sales and Purchase")return i.jsxs(ir,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(Ot,{severity:"error",sx:{mb:2},children:"Access Denied: Sales and Purchase users cannot view closed sales orders."}),i.jsx(ye,{variant:"outlined",onClick:()=>n("/open-sales-orders"),children:"Back to Sales Orders"})]});if(!t&&Qe)return mc();const Ol=[{key:"customer",element:i.jsx(Fa,{open:E,onOpen:()=>S(!0),onClose:()=>S(!1),autoHighlight:!0,value:w,onChange:(de,pe)=>{if(k){M(!1);return}pe&&pe.isNew?(Ui(!0),be(O),A(null),T(""),S(!1)):(A(pe),S(!1))},inputValue:O,onInputChange:(de,pe,ke)=>{if(T(pe),I&&window.clearTimeout(I),ke==="reset")return;if((pe||"").trim().length>0){const rt=window.setTimeout(()=>S(!0),200);z(rt)}else S(!1)},options:l,filterOptions:(de,pe)=>{const ke=yde(de,pe.inputValue||""),Oe=!!Pi(pe.inputValue||""),rt=[...ke];return(pe.inputValue||"").trim()!==""&&!Oe&&rt.push({label:`Add "${pe.inputValue}" as New Customer`,isNew:!0}),rt},getOptionLabel:de=>typeof de=="string"?de:de.label,isOptionEqualToValue:(de,pe)=>de.id===pe.id,renderOption:(de,pe)=>{const ke=pe.isNew,{key:Oe,...rt}=de;return i.jsxs("li",{...rt,style:{display:"flex",alignItems:"center",opacity:ke?.9:1},children:[ke&&i.jsx(ec,{fontSize:"small",style:{marginRight:8,color:"#666"}}),i.jsx("span",{children:pe.label})]},Oe)},renderInput:de=>i.jsx(Ae,{...de,label:"Customer",required:!0,onFocus:pc,onKeyDown:No,onBlur:()=>{if(!w){const pe=O.trim();if(pe){const ke=Pi(pe);ke&&(A(ke),T(ke.label))}}},inputRef:pe=>{R.current=pe}})})},Ir.customerPoNumber?{key:"customerPoNumber",element:i.jsx(Ae,{label:"Customer PO #",value:se,onChange:de=>V(de.target.value),fullWidth:!0,placeholder:"Optional"})}:null,Ir.sourceQuote?{key:"sourceQuote",element:i.jsx(Ae,{label:"Source Quote #",value:Ue||"",placeholder:"Not converted from a quote",fullWidth:!0,InputProps:{readOnly:!0}})}:null,!o&&Ir.quotedPrice?{key:"quotedPrice",element:i.jsx(Ae,{label:"Quoted Price",type:"number",value:$e??"",onChange:de=>Xe(de.target.value?parseFloat(de.target.value):null),fullWidth:!0,InputProps:{startAdornment:i.jsx(oa,{position:"start",children:"$"})},inputProps:{onWheel:de=>de.currentTarget.blur()}})}:null].filter(Boolean),kl=Fs?i.jsx(Fa,{freeSolo:!0,options:hc,loading:K,value:He,onInputChange:(de,pe)=>Ne(pe),onChange:(de,pe,ke)=>{if(ke==="clear"){Ne("");return}Ci(void 0,typeof pe=="string"?pe:pe??"")},renderInput:de=>i.jsx(Ae,{...de,label:"VIN #",fullWidth:!0,placeholder:"Optional"})}):i.jsx(Ae,{label:"VIN #",value:He,onChange:de=>Ne(de.target.value),fullWidth:!0,placeholder:"Optional"}),gc=Fs?i.jsx(Fa,{freeSolo:!0,options:$s,loading:K,value:Re,onInputChange:(de,pe)=>Ke(pe),onChange:(de,pe,ke)=>{if(ke==="clear"){Ke("");return}Ci(typeof pe=="string"?pe:pe??"",void 0)},renderInput:de=>i.jsx(Ae,{...de,label:"Unit #",fullWidth:!0,placeholder:"Optional"})}):i.jsx(Ae,{label:"Unit #",value:Re,onChange:de=>Ke(de.target.value),fullWidth:!0,placeholder:"Optional"}),Tl=[Ir.vin?{key:"vin",element:kl}:null,Ir.unitNumber?{key:"unitNumber",element:gc}:null,Ir.vehicleMake?{key:"vehicleMake",element:i.jsx(Ae,{label:"Make",value:nt,onChange:de=>st(de.target.value),fullWidth:!0,placeholder:"Optional"})}:null,Ir.vehicleModel?{key:"vehicleModel",element:i.jsx(Ae,{label:"Model",value:gt,onChange:de=>Ge(de.target.value),fullWidth:!0,placeholder:"Optional"})}:null,Ir.mileage?{key:"mileage",element:i.jsx(Ae,{label:"Mileage",type:"number",value:Je===""?"":Je,onChange:de=>We(de.target.value===""?"":Number(de.target.value)),fullWidth:!0,placeholder:"Optional",inputProps:{min:0,step:1}})}:null].filter(Boolean),zs=[{key:"salesDate",element:i.jsx(os,{label:"Sales Date",value:le,onChange:oe,sx:{width:"100%"},slotProps:{textField:{fullWidth:!0,required:!0}}})},Ir.wantedByDate?{key:"wantedByDate",element:i.jsx(os,{label:"Wanted By Date",value:ae,onChange:he,sx:{width:"100%"},slotProps:{textField:{placeholder:"Optional",fullWidth:!0}}})}:null,Ir.wantedByTimeOfDay?{key:"wantedTimeOfDay",element:i.jsxs(tn,{component:"fieldset",fullWidth:!0,children:[i.jsx(o5,{sx:{mb:1},children:"Wanted Time of Day"}),i.jsxs(F2,{value:kt||null,exclusive:!0,fullWidth:!0,size:"small",color:"standard","aria-label":"Wanted time of day",onChange:(de,pe)=>Vt(pe||""),sx:{"& .MuiToggleButtonGroup-grouped":{textTransform:"none",flex:1,gap:0},"& .MuiToggleButtonGroup-grouped:not(:first-of-type)":{marginLeft:0}},children:[i.jsx(al,{value:"morning",children:"Morning"}),i.jsx(al,{value:"afternoon",children:"Afternoon"}),i.jsx(al,{value:"evening",children:"Evening"})]})]})}:null].filter(Boolean),fa=[Ir.invoiceStatus?{key:"invoiceStatus",element:i.jsxs(tn,{component:"fieldset",fullWidth:!0,children:[i.jsx(o5,{sx:{mb:1},children:"Invoice"}),i.jsxs(F2,{value:_t||null,exclusive:!0,fullWidth:!0,size:"small",color:"standard","aria-label":"Invoice status",onChange:qe,sx:{"& .MuiToggleButtonGroup-grouped":{textTransform:"none",flex:1,gap:0},"& .MuiToggleButtonGroup-grouped:not(:first-of-type)":{marginLeft:0},"& .MuiToggleButtonGroup-grouped.Mui-selected":{color:"#fff"},"& .MuiToggleButtonGroup-grouped.Mui-selected.MuiToggleButton-colorError":{bgcolor:de=>de.palette.error.main,"&:hover":{bgcolor:de=>de.palette.error.dark}},"& .MuiToggleButtonGroup-grouped.Mui-selected.MuiToggleButton-colorSuccess":{bgcolor:de=>de.palette.success.main,"&:hover":{bgcolor:de=>de.palette.success.dark}}},children:[i.jsxs(al,{value:"needed",color:"error",children:[i.jsx(Ww,{fontSize:"small",sx:{mr:1}}),"Needed"]}),i.jsxs(al,{value:"done",color:"success",children:[i.jsx(ac,{fontSize:"small",sx:{mr:1}}),"Done"]})]})]})}:null,Ir.terms?{key:"terms",element:i.jsx(Ae,{label:"Terms",value:G,onChange:de=>ee(de.target.value),fullWidth:!0,multiline:!0,minRows:3,maxRows:8,placeholder:"Enter payment/delivery terms, etc."})}:null].filter(Boolean),El=xde(fa.length||1);return i.jsxs(Os,{dateAdapter:oc,children:[i.jsx(qy,{when:ji,onSave:Or}),i.jsxs(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",component:"h1",children:t?"Create Sales Order":`Edit Sales Order${Se?.sales_order_number?`: ${Se.sales_order_number}`:""}`}),i.jsxs(ct,{direction:"row",spacing:1,children:[i.jsx(ye,{variant:"outlined",startIcon:i.jsx(gde,{}),onClick:Dn,children:"Customize Fields"}),t&&i.jsx(ye,{variant:"outlined",onClick:()=>{A(null),T(""),oe(Rt()),he(null),Vt(""),$(null),C(""),X(""),ee(""),V(""),Ne(""),Ke(""),st(""),Ge(""),Nt(""),We(""),Xe(null),wt([{part_number:"",part_description:"",quantity:"",unit:$m[0],unit_price:0,gst:Cc,line_amount:0}]),li(null)},children:"Reset"}),i.jsx(ye,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:Or,children:t?"Save Sales Order":"Save Changes"}),!t&&i.jsxs(i.Fragment,{children:[a?.access_role!=="Sales and Purchase"&&i.jsx(ye,{variant:"contained",startIcon:i.jsx(bv,{}),onClick:Xr,children:"Close SO"}),i.jsx(ye,{variant:"contained",startIcon:i.jsx(da,{}),onClick:Wn,children:"Download PDF"})]})]})]}),i.jsx(Nv,{open:!!rn,anchorEl:rn,onClose:rr,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:i.jsxs(J,{sx:{p:2,width:280},children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"Show / Hide Optional Fields"}),i.jsx(Ep,{children:[{key:"customerPoNumber",label:"Customer PO #"},{key:"quotedPrice",label:"Quoted Price"},{key:"sourceQuote",label:"Source Quote #"},{key:"vin",label:"VIN #"},{key:"unitNumber",label:"Unit #"},{key:"mileage",label:"Mileage"},{key:"vehicleMake",label:"Make"},{key:"vehicleModel",label:"Model"},{key:"invoiceStatus",label:"Invoice Status"},{key:"wantedByDate",label:"Wanted By Date"},{key:"wantedByTimeOfDay",label:"Wanted Time of Day"},{key:"productDescription",label:"Product Description"},{key:"techStory",label:"Tech Story"},{key:"terms",label:"Terms"},{key:"techStory",label:"Tech Story"}].filter(({key:de})=>ar[de]).filter(({key:de})=>!(s&&["quotedPrice","invoiceStatus","terms"].includes(de))).map(({key:de,label:pe})=>i.jsx(ri,{control:i.jsx(Xi,{size:"small",checked:!!Dr[de],onChange:ke=>qr(Oe=>({...Oe,[de]:ke.target.checked}))}),label:pe},de))})]})}),i.jsx(J,{sx:{mb:2},children:i.jsx(ye,{variant:"outlined",color:"secondary",onClick:fo,children:"Import Line Items"})}),i.jsxs(gr,{open:pt,onClose:()=>Et(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(vr,{children:"Import Line Items from Sales Order"}),i.jsx(yr,{children:na?i.jsx(J,{display:"flex",alignItems:"center",justifyContent:"center",minHeight:120,children:i.jsx(nr,{})}):i.jsx(Fa,{options:Lt,getOptionLabel:de=>{if(!de)return"";const pe=de.sales_order_number||"",ke=de.customer_name||"",Oe=de.status||"";return`${pe} - ${ke}${Oe?` (${Oe})`:""}`},value:Hr,onChange:(de,pe)=>gn(pe),renderInput:de=>i.jsx(Ae,{...de,label:"Select Sales Order",fullWidth:!0}),isOptionEqualToValue:(de,pe)=>de.sales_order_id===pe?.sales_order_id})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:()=>Et(!1),children:"Cancel"}),i.jsx(ye,{onClick:Ti,disabled:!Hr||na,variant:"contained",children:"Import"})]})]}),ps&&i.jsxs(Ot,{severity:"warning",sx:{mb:3},onClose:()=>li(null),children:[i.jsx(B,{variant:"body1",sx:{fontWeight:"medium"},children:"Inventory Error"}),i.jsx(B,{variant:"body2",children:ps})]}),i.jsx(J,{sx:{transform:zn?`translateY(-${zn}px)`:"none",transition:"transform 200ms ease"},children:i.jsxs(xt,{sx:Yo,elevation:3,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Customer Information"}),Ol.length?i.jsx(J,{sx:wr,children:Ol.map(de=>i.jsx(J,{children:de.element},de.key))}):i.jsx(B,{variant:"body2",color:"text.secondary",children:"No customer fields are enabled."})]})}),Tl.length?i.jsxs(xt,{sx:Yo,elevation:3,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Vehicle Details"}),i.jsx(J,{sx:Al,children:Tl.map(de=>i.jsx(J,{children:de.element},de.key))})]}):null,i.jsxs(xt,{sx:Yo,elevation:3,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Job & Schedule"}),zs.length?i.jsx(J,{sx:{...fc,mb:2},children:zs.map(de=>i.jsx(J,{children:de.element},de.key))}):null,i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsx(Fa,{disablePortal:!0,open:L,onOpen:()=>H(!0),onClose:()=>H(!1),autoHighlight:!0,value:P,onChange:(de,pe)=>{if(pe&&pe.isNew){const ke=pe.inputValue?.toString?.()||Q.trim();Te(!0),Ie(ke),$(null),C(""),H(!1)}else $(pe),H(!1)},inputValue:Q,onInputChange:(de,pe,ke)=>{if(C(pe),Ie(pe),U&&window.clearTimeout(U),ke==="reset")return;if((pe||"").trim().length>0){const rt=window.setTimeout(()=>H(!0),200);te(rt)}else H(!1)},options:u,filterOptions:(de,pe)=>{const ke=de.filter(Oe=>Oe.label.toLowerCase().includes((pe.inputValue||"").toLowerCase()));return(pe.inputValue||"")!==""&&!de.some(Oe=>Oe.label.toLowerCase()===(pe.inputValue||"").toLowerCase())&&ke.push({label:`Add "${pe.inputValue}"`,isNew:!0,inputValue:pe.inputValue}),ke},getOptionLabel:de=>typeof de=="string"?de:de.label,renderInput:de=>i.jsx(Ae,{...de,label:"Product Name",required:!0,onKeyDown:uu,onBlur:()=>{if(H(!1),!P){const pe=Q.trim();if(pe){const ke=u.find(Oe=>Oe.label.toLowerCase()===pe.toLowerCase());ke&&($(ke),C(ke.label))}}}}),disabled:!1})}),Ir.productDescription&&i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{label:"Product Description",value:me,onChange:de=>X(de.target.value),fullWidth:!0,multiline:!0,minRows:2,maxRows:6})}),Ir.techStory&&i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{label:"Tech Story",value:jt,onChange:de=>Tr(de.target.value),fullWidth:!0,multiline:!0,minRows:4,maxRows:12,placeholder:"Add technician notes for this sales order"})})]})]}),fa.length?i.jsxs(xt,{sx:Yo,elevation:3,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Invoice Status"}),i.jsx(ie,{container:!0,spacing:2,children:fa.map(de=>i.jsx(ie,{item:!0,xs:12,sm:fa.length>1?6:12,md:El,children:de.element},de.key))})]}):null,i.jsxs(J,{sx:{position:"relative",zIndex:1e3,transform:zn?`translateY(-${zn}px)`:"none",transition:"transform 200ms ease"},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Line Items"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Each part number can only appear once. Edit existing line items to change quantities."})]}),i.jsxs(J,{sx:{position:"relative",mb:3},children:[!t&&Mr.length>0&&i.jsx(J,{sx:{position:"absolute",bottom:"calc(100% + 8px)",left:0,right:0,zIndex:500,display:"flex",flexDirection:"column",gap:1,pointerEvents:"none"},children:Mr.map((de,pe)=>i.jsx(Ot,{severity:"warning",sx:{width:"100%",boxShadow:2,pointerEvents:"auto","& .MuiAlert-message":{width:"100%",padding:0}},children:i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{width:"100%"},children:[i.jsxs(J,{children:[i.jsxs(B,{variant:"body2",fontWeight:"medium",children:["Insufficient stock for ",de.partNumber]}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Excess quantity: ",de.excessQuantity," ",de.unit]})]}),i.jsxs(ye,{variant:"contained",size:"small",sx:{whiteSpace:"nowrap"},onClick:()=>Fr(de),children:["Transfer ",de.excessQuantity," to Parts to Order"]})]})},`${de.lineItemIndex}-${pe}`))}),i.jsxs(gr,{open:!!dn,onClose:()=>Fr(null),maxWidth:"xs",fullWidth:!0,children:[i.jsx(vr,{children:"Transfer to Parts to Order"}),i.jsx(yr,{children:dn&&i.jsxs(B,{variant:"body2",children:["Transfer ",dn.excessQuantity," ",dn.unit," of ",dn.partNumber," to Parts to Order?"]})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:()=>Fr(null),children:"Cancel"}),i.jsx(ye,{variant:"contained",onClick:()=>{if(!dn)return;const de=dn,pe=at[de.lineItemIndex],ke=de.excessQuantity,Oe=f.find(Ut=>Ut.part_number.toLowerCase()===pe.part_number.toLowerCase()),rt={sales_order_id:Se?.sales_order_id||0,part_number:pe.part_number,part_description:pe.part_description,quantity_to_order:String(ke),unit:pe.unit,unit_price:Oe?.last_unit_cost||0,line_amount:(Oe?.last_unit_cost||0)*ke};tt(Ut=>[...Ut,rt]);const bt=Math.max(0,(parseFloat(String(pe.quantity).replace(/[^\d.-]/g,""))||0)-ke);wt(Ut=>Ut.map((Dt,fr)=>fr===de.lineItemIndex?{...Dt,quantity:String(bt)}:Dt)),Ar(Ut=>Ut.filter(Dt=>Dt.lineItemIndex!==de.lineItemIndex)),Fr(null),ge.success(`Transferred ${ke} ${pe.unit} of ${pe.part_number} to parts to order`)},children:"Confirm"})]})]}),i.jsxs(xt,{sx:{p:3,mb:3},elevation:3,children:[i.jsx(ie,{container:!0,spacing:2,children:at.map((de,pe)=>({item:de,originalIndex:pe})).sort((de,pe)=>{const ke=["LABOUR","OVERHEAD","SUPPLY"].includes(de.item.part_number),Oe=["LABOUR","OVERHEAD","SUPPLY"].includes(pe.item.part_number);return ke&&!Oe?1:!ke&&Oe?-1:0}).map(({item:de,originalIndex:pe})=>i.jsxs(Ce.Fragment,{children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:Kr.partNumber,children:i.jsx(Fa,{open:ta===pe,onOpen:()=>jn(pe),onClose:()=>jn(null),autoHighlight:!0,inputValue:de.part_number,onChange:(ke,Oe)=>{if(typeof Oe=="string"){const rt=at.findIndex((bt,Ut)=>Ut!==pe&&bt.part_number.trim().toLowerCase()===Oe.trim().toLowerCase());if(rt!==-1){ge.error(`Part "${Oe}" already exists as line item ${rt+1}. Edit that line item instead.`),wt(bt=>bt.map((Ut,Dt)=>Dt===pe?{...Ut,part_number:"",part_description:""}:Ut)),jn(null);return}je(pe,Oe),jn(null)}else if(Oe&&typeof Oe=="object"&&"isNew"in Oe){const rt=Oe.inputValue||"";$i(String(rt).toUpperCase()),pi(pe),Si(!0),jn(null)}},onInputChange:(ke,Oe,rt)=>{if(rt==="reset")return;const bt=(Oe||"").trim();if(wt(Ut=>Ut.map((Dt,fr)=>fr===pe?{...Dt,part_number:bt}:Dt)),Ia&&window.clearTimeout(Ia),bt.length>0){const Ut=window.setTimeout(()=>jn(pe),200);Na(Ut)}else jn(null)},options:f.filter(ke=>ke.part_type!=="supply").map(ke=>ke.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,filterOptions:(ke,Oe)=>To(ke,Oe,!0),renderOption:(ke,Oe)=>{const rt=typeof Oe=="object"&&Oe.isNew,bt=typeof Oe=="string"?Oe:Oe.label,{key:Ut,...Dt}=ke;return i.jsxs("li",{...Dt,children:[rt&&i.jsx(ec,{fontSize:"small",style:{marginRight:8,color:"#666"}}),typeof Oe=="string"?i.jsxs(J,{children:[i.jsx(B,{variant:"body2",children:Oe}),(()=>{const fr=co[String(Oe)]||"";return fr?i.jsx(B,{variant:"caption",color:"text.secondary",children:fr}):null})()]}):bt]},Ut)},renderInput:ke=>i.jsx(Ae,{...ke,label:"Part Number",required:!0,fullWidth:!0,onKeyDown:Oe=>Eo(pe,Oe),onBlur:()=>jn(null)}),onBlur:()=>{const ke=at[pe]?.part_number?.trim().toUpperCase();if(!ke)return;f.find(rt=>rt.part_number===ke)?je(pe,ke):(pi(pe),$i(ke),Si(!0),jn(null))}})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:Kr.description,children:i.jsx(Ae,{label:"Part Description",value:de.part_description,fullWidth:!0,required:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:Kr.quantity,children:i.jsx(Ae,{label:"Qty",value:de.quantity,onChange:ke=>Ee(pe,"quantity",ke.target.value),type:"number",fullWidth:!0,required:!0,InputProps:{readOnly:["SUPPLY","LABOUR","OVERHEAD"].includes(de.part_number),disabled:["SUPPLY","LABOUR","OVERHEAD"].includes(de.part_number)},inputProps:{step:1,onWheel:ke=>ke.target.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:Kr.availability,children:i.jsx(Ae,{label:"Avail",value:(()=>{const ke=Wt[pe];return ke?ke.available<0?`${ke.available} (Insufficient)`:String(ke.available):"N/A"})(),fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:(()=>{const ke=Wt[pe];return ke?ke.available>=0?"#e8f5e8":"#ffeaea":"#f5f5f5"})(),"& .MuiInputBase-input":{color:Wt[pe]?.isNegative?"#d32f2f":"#2e7d32"}}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:Kr.unit,children:i.jsx(Ae,{label:"Unit",value:de.part_number==="SUPPLY"?"":de.unit,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),!s&&i.jsx(ie,{item:!0,xs:12,sm:2,md:Kr.unitCost,children:i.jsx(Ae,{label:"Unit Cost",value:de.part_number==="LABOUR"?p??0:de.part_number==="OVERHEAD"?m??0:de.part_number==="SUPPLY"?"":de.unit_price,type:"number",fullWidth:!0,InputProps:{readOnly:!0,startAdornment:de.part_number!=="SUPPLY"?i.jsx(oa,{position:"start",children:"$"}):void 0,disabled:["LABOUR","OVERHEAD","SUPPLY"].includes(de.part_number)}})}),!s&&i.jsx(ie,{item:!0,xs:6,sm:3,md:Kr.amount,children:i.jsx(Ae,{label:"Amount",value:de.line_amount!=null&&!isNaN(Number(de.line_amount))?Number(de.line_amount).toFixed(2):"0.00",InputProps:{readOnly:!0},fullWidth:!0})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:Kr.actions,sx:{display:"flex",alignItems:"center"},children:i.jsx(ye,{variant:"outlined",color:"primary",onClick:()=>dt(pe),fullWidth:!0,children:"Remove"})})]},pe))}),i.jsx(J,{sx:{mt:2},children:i.jsx(ye,{variant:"outlined",color:"primary",onClick:Ye,children:"Add Line Item"})})]})]}),!s&&i.jsx(xt,{sx:{p:3,mb:3},elevation:3,children:i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Subtotal: ",Va(Mn)]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Total GST: ",Va(Qr)]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"h6",children:["Total Amount: ",Va(nn)]})})]})}),!t&&i.jsxs(xt,{sx:{p:3,mb:3,elevation:3,border:"2px solid #b8860b","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#b8860b"},"&:hover fieldset":{borderColor:"#b8860b"}}},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Parts to Order"}),i.jsx(B,{variant:"body2",color:"textSecondary",sx:{mb:2},children:"Add parts that need to be ordered for this sales order. These quantities are aggregated across all sales orders."}),i.jsx(ie,{container:!0,spacing:2,children:Be.map((de,pe)=>i.jsxs(Ce.Fragment,{children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Fa,{open:On===pe,onOpen:()=>Gr(pe),onClose:()=>Gr(null),autoHighlight:!0,value:de.part_number,onChange:(ke,Oe)=>{if(!Oe){tt(rt=>{const bt=[...rt];return bt[pe]={...bt[pe],part_number:"",part_description:"",unit:"Each",unit_price:0,line_amount:0},bt});return}if(typeof Oe=="string"){const rt=f.find(bt=>bt.part_number===Oe);if(rt){const Ut=parseFloat(String(rt.last_unit_cost))||0;tt(Dt=>{const fr=[...Dt];return fr[pe]={...fr[pe],part_number:rt.part_number,part_description:rt.part_description,unit:rt.unit||"Each",unit_price:Ut,line_amount:0},fr})}else{tt(Ut=>{const Dt=[...Ut];return Dt[pe]={...Dt[pe],part_number:Oe,part_description:"",unit:"Each",unit_price:0,line_amount:0},Dt});const bt=String(Oe).toUpperCase();Qa(pe),ii(bt),so(!0)}}else if(Oe&&typeof Oe=="object"&&"isNew"in Oe){const rt=String(Oe.inputValue||"").toUpperCase();Qa(pe),ii(rt),so(!0)}},onInputChange:(ke,Oe,rt)=>{if(tt(Ut=>{const Dt=[...Ut];return Dt[pe]={...Dt[pe],part_number:(Oe||"").toUpperCase()},Dt}),Ia&&window.clearTimeout(Ia),rt==="reset")return;if((Oe||"").trim().length>0){const Ut=window.setTimeout(()=>Gr(pe),200);Na(Ut)}else Gr(null)},options:f.filter(ke=>ke.part_type!=="supply").map(ke=>ke.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,filterOptions:(ke,Oe)=>To(ke,Oe,!0),renderOption:(ke,Oe)=>{const rt=typeof Oe=="object"&&Oe.isNew,bt=typeof Oe=="string"?Oe:Oe.label,{key:Ut,...Dt}=ke;return i.jsxs("li",{...Dt,children:[rt&&i.jsx(ec,{fontSize:"small",style:{marginRight:8,color:"#666"}}),typeof Oe=="string"?i.jsxs(J,{children:[i.jsx(B,{variant:"body2",children:Oe}),(()=>{const fr=co[String(Oe)]||"";return fr?i.jsx(B,{variant:"caption",color:"text.secondary",children:fr}):null})()]}):bt]},Ut)},renderInput:ke=>i.jsx(Ae,{...ke,label:"Part Number",fullWidth:!0,required:!0,onKeyDown:Oe=>Pl(pe,Oe),onBlur:()=>Gr(null)}),onBlur:()=>{const ke=(Be[pe]?.part_number||"").trim().toUpperCase();if(!ke)return;f.find(rt=>rt.part_number===ke)||(Qa(pe),ii(ke),so(!0),Gr(null))}})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Ae,{label:"Description",value:de.part_description,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#f5f5f5"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Ae,{label:"Qty to Order",value:de.quantity_to_order,onChange:ke=>{const Oe=ke.target.value;tt(rt=>{const bt=[...rt],Ut=parseFloat(Oe)||0,Dt=bt[pe].unit_price||0;return bt[pe]={...bt[pe],quantity_to_order:Oe,line_amount:Ut*Dt},bt})},type:"number",fullWidth:!0,required:!0,inputProps:{step:1,min:0,onWheel:ke=>ke.target.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Ae,{label:"Unit",value:de.unit,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),i.jsx(ie,{item:!0,xs:12,sm:1.5,children:i.jsx(Ae,{label:"Unit Price",value:de.unit_price,type:"number",fullWidth:!0,InputProps:{readOnly:!0,startAdornment:i.jsx(oa,{position:"start",children:"$"})},sx:{backgroundColor:"#f5f5f5"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Ae,{label:"Amount",value:de.line_amount,InputProps:{readOnly:!0},fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:1,md:1,sx:{display:"flex",alignItems:"center",gap:2},children:i.jsx(ye,{variant:"outlined",onClick:()=>tt(ke=>ke.filter((Oe,rt)=>rt!==pe)),sx:{flexShrink:0,borderColor:"#b8860b",color:"#b8860b","&:hover":{borderColor:"#8b6914",backgroundColor:"#fff8dc"}},children:"Remove"})})]},pe))}),i.jsx(J,{sx:{mt:2},children:i.jsx(ye,{variant:"outlined",color:"primary",onClick:()=>tt(de=>[...de,{sales_order_id:Number(e)||0,part_number:"",part_description:"",quantity_to_order:"",unit:"Each",unit_price:0,line_amount:0}]),children:"Add Parts to Order Item"})})]}),i.jsx(Wd,{open:Bs,onClose:()=>Ui(!1),onSave:async de=>{try{const pe=await ve.post("/api/customers",de),ke={label:de.customer_name,id:pe.data.customer_id};c(Oe=>[...Oe,ke]),A(ke),Ui(!1),ge.success("Customer added successfully!")}catch{ge.error("Failed to add customer.")}},initialCustomer:{customer_name:Us},isEditMode:!1}),i.jsx(SS,{open:we,onClose:()=>Te(!1),onSave:async de=>{try{const pe=await ve.post("/api/products",de),ke={label:de.product_name,id:pe.data.product_id,description:de.product_name};d(Oe=>[...Oe,ke]),$(ke),C(ke.label),Te(!1),Ie(""),ge.success("Product added successfully!")}catch{ge.error("Failed to add product.")}},initialProduct:{product_name:De||Q},isEditMode:!1}),!t&&i.jsxs(i.Fragment,{children:[Da&&i.jsx(Ot,{severity:"error",sx:{mb:2},onClose:()=>Ua(null),children:Da}),i.jsx(pl,{open:!!mr,autoHideDuration:6e3,onClose:()=>an(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>an(null),severity:"success",sx:{width:"100%"},children:mr})}),Se?.status?.toLowerCase()==="closed"&&i.jsxs(J,{display:"flex",justifyContent:"flex-end",gap:2,mb:2,children:[i.jsx(ye,{variant:"contained",color:"secondary",startIcon:i.jsx(Cv,{}),onClick:aa,disabled:Io,children:Io?"Creating Invoice...":"Create Invoice"}),!Se?.exported_to_qbo&&i.jsx(ye,{variant:"contained",color:"success",startIcon:i.jsx(Ap,{}),disabled:Oi,onClick:za,children:Oi?"Exporting...":"Export to QuickBooks"}),a?.access_role!=="Sales and Purchase"&&i.jsx(ye,{variant:"outlined",onClick:Ln,children:"Reopen SO"})]})]})]}),i.jsx(tc,{open:io,onClose:()=>{Si(!1),pi(null),$i("")},onSave:async de=>{const pe=await ve.post("/api/inventory",de),ke=await ve.get("/api/inventory");h(ke.data);const Oe=pe.data.item;oo!==null&&wt(rt=>{const bt=[...rt],Dt=parseFloat(String(Oe.last_unit_cost))||0;return bt[oo]={...bt[oo],part_number:Oe.part_number,part_description:Oe.part_description,unit:Oe.unit||bt[oo].unit,unit_price:Dt},bt})},title:"Add New Part",initialPart:{part_number:Oo.toUpperCase(),category:"Uncategorized"}}),i.jsx(tc,{open:fs,onClose:()=>{so(!1),Qa(null),ii("")},onSave:async de=>{const pe=await ve.post("/api/inventory",de),ke=await ve.get("/api/inventory");h(ke.data);const Oe=pe.data.item;hs!==null&&tt(rt=>{const bt=[...rt],Dt=parseFloat(String(Oe.last_unit_cost))||0;return bt[hs]={...bt[hs],part_number:Oe.part_number,part_description:Oe.part_description,unit:Oe.unit||"Each",unit_price:Dt},bt})},title:"Add New Part",initialPart:{part_number:lo.toUpperCase(),category:"Uncategorized"}})]})},_de=async e=>{try{return(await ve.get("/api/purchase-history",{params:e})).data}catch(t){throw console.error("Error fetching purchase orders:",t),t}},wde=async()=>ve.get("/api/purchase-history/csv-template",{responseType:"blob"}),jde=async e=>{const t=new FormData;return t.append("file",e),(await ve.post("/api/purchase-history/upload-csv",t,{headers:{"Content-Type":"multipart/form-data"}})).data},R4=()=>{const[e,t]=y.useState([]),[r,n]=y.useState(!0),[a,o]=y.useState(""),[s,l]=y.useState("open"),[c,u]=y.useState({page:0,pageSize:10}),[d,f]=y.useState(!1),h=y.useRef(null),p=Nn();Ds();const{user:g}=ea(),m=async()=>{n(!0);try{const S=(await ve.get("/api/purchase-history",{params:{status:s,searchTerm:a||void 0}})).data.sort((I,z)=>{const k=F=>{const W=F.match(/\d+/);return W?parseInt(W[0],10):0},M=k(I.purchase_number);return k(z.purchase_number)-M});t(S)}catch(E){console.error("Error fetching purchase orders:",E),t([]),ge.error("Failed to fetch purchase orders")}finally{n(!1)}};y.useEffect(()=>{m()},[s,a]);const x=E=>{window.confirm("Are you sure you want to delete this purchase order?")&&b(E)},b=async E=>{try{await ve.delete(`/api/purchase-orders/${E}`),ge.success("Purchase order deleted successfully"),m()}catch(S){console.error("Error deleting purchase order:",S),ge.error("Failed to delete purchase order")}},_=()=>{let E=e;s==="open"?E=e.filter(k=>k.status==="Open"):s==="closed"&&(E=e.filter(k=>k.status==="Closed"));const S=Cl.unparse(E),I=new Blob([S],{type:"text/csv;charset=utf-8;"}),z=document.createElement("a");z.href=URL.createObjectURL(I),z.download=`purchase_orders_${Rt().format("YYYY-MM-DD")}.csv`,z.click()},w=async()=>{try{const E=await wde(),S=new Blob([E.data],{type:"text/csv"}),I=window.URL.createObjectURL(S),z=document.createElement("a");z.href=I,z.setAttribute("download","purchase_order_import_template.csv"),document.body.appendChild(z),z.click(),z.remove(),window.URL.revokeObjectURL(I)}catch(E){console.error("Error downloading template",E),ge.error("Failed to download template")}},A=()=>{h.current?.click()},O=async E=>{const S=E.target.files?.[0];if(S){f(!0);try{const I=await jde(S);ge.success(I?.message||"Purchase order CSV uploaded"),I?.warnings?.length&&ge.warn(I.warnings.join("; ")),m()}catch(I){console.error("Error uploading purchase order CSV",I);const z=I?.response?.data?.error||"Failed to upload purchase order CSV";ge.error(z)}finally{f(!1),E.target.value=""}}},T=[{field:"purchase_number",headerName:"Purchase #",flex:1,minWidth:120,valueFormatter:E=>E.value?String(E.value).replace("PO-",""):""},{field:"vendor_name",headerName:"Vendor",flex:1.3,minWidth:150},{field:"date",headerName:"Date",flex:.9,minWidth:130,valueFormatter:E=>E.value?new Date(E.value).toLocaleDateString():""},{field:"bill_number",headerName:"Bill #",flex:.9,minWidth:100},{field:"subtotal",headerName:"Subtotal",flex:.8,minWidth:100,valueFormatter:E=>E.value!=null&&!isNaN(Number(E.value))?`$${Number(E.value).toFixed(2)}`:"$0.00"},{field:"gst_rate",headerName:"GST Rate (%)",flex:.7,minWidth:80,valueFormatter:E=>E.value!=null&&!isNaN(Number(E.value))?`${Number(E.value).toFixed(2)}%`:"5.00%"},{field:"total_gst_amount",headerName:"GST",flex:.7,minWidth:80,valueFormatter:E=>E.value!=null&&!isNaN(Number(E.value))?`$${Number(E.value).toFixed(2)}`:"$0.00"},{field:"total_amount",headerName:"Total",flex:.8,minWidth:100,valueFormatter:E=>E.value!=null&&!isNaN(Number(E.value))?`$${Number(E.value).toFixed(2)}`:"$0.00"},{field:"status",headerName:"Status",flex:.8,minWidth:100,renderCell:E=>i.jsx(ot,{label:E.value,color:E.value==="Open"?"success":"error",size:"small",variant:"outlined"})},{field:"return_summary",headerName:"Returns",flex:.9,minWidth:150,sortable:!1,renderCell:E=>{const S=E.row.return_requested_count??0,I=E.row.return_returned_count??0;return!S&&!I?i.jsx(B,{variant:"body2",color:"text.secondary",children:"None"}):i.jsxs(ct,{direction:"row",spacing:1,children:[S>0&&i.jsx(ot,{label:`Requested ${S}`,color:"warning",size:"small",variant:"outlined"}),I>0&&i.jsx(ot,{label:`Returned ${I}`,color:"success",size:"small",variant:"outlined"})]})}},{field:"qbo_exported",headerName:"QBO Exported",flex:.8,minWidth:120,renderCell:E=>E.row.exported_to_qbo?i.jsx(ac,{color:"success",titleAccess:"Exported to QuickBooks"}):E.row.qbo_export_status?i.jsx(Fy,{color:"error",titleAccess:`QBO Export Error: ${E.row.qbo_export_status}`}):E.row.status==="Closed"?i.jsx(dR,{color:"warning",titleAccess:"Not exported to QuickBooks"}):null},{field:"actions",headerName:"Actions",width:100,sortable:!1,renderCell:E=>i.jsx(J,{sx:{display:"flex",gap:.5},children:E.row.status!=="Closed"&&i.jsx(pr,{size:"small",color:"error",onClick:S=>{S.stopPropagation(),x(E.row.purchase_id)},children:i.jsx(ua,{})})})}];return i.jsx(ir,{maxWidth:"xl",sx:{mt:4},children:i.jsxs(J,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:s==="open"?"Open Purchase Orders":s==="closed"?"Purchase Order History":"All Purchase Orders"}),i.jsxs(ct,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[i.jsx("input",{type:"file",accept:".csv,text/csv",ref:h,style:{display:"none"},onChange:O}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(da,{}),onClick:w,children:"PO Template"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Cd,{}),onClick:A,disabled:d,children:d?"Uploading...":"Upload PO CSV"}),i.jsx(ye,{variant:"contained",startIcon:i.jsx(Ba,{}),onClick:()=>p("/open-purchase-orders/new"),children:"New PO"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(da,{}),onClick:_,children:"Export CSV"})]}),i.jsx(xt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(J,{sx:{p:2},children:[i.jsxs(ct,{direction:"row",spacing:3,sx:{mb:3},children:[i.jsx(Ae,{label:"Search",variant:"outlined",value:a,onChange:E=>o(E.target.value),InputProps:{startAdornment:i.jsx(oa,{position:"start",children:i.jsx(hi,{sx:{fontSize:32}})}),sx:{fontSize:22,height:56}},sx:{minWidth:340,maxWidth:400,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"medium"}),i.jsx(ot,{label:"All",onClick:()=>l("all"),color:s==="all"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),i.jsx(ot,{label:"Open",onClick:()=>l("open"),color:s==="open"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),i.jsx(ot,{label:"Closed",onClick:()=>l("closed"),color:s==="closed"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}})]}),i.jsx(Po,{rows:e,columns:T,loading:r,paginationModel:c,onPaginationModelChange:u,pageSizeOptions:[10,25,50],getRowId:E=>E.purchase_id,disableRowSelectionOnClick:!0,initialState:{sorting:{sortModel:[{field:"purchase_number",sort:"desc"}]}},onRowClick:E=>{const S=E.row.status?.toLowerCase();p(S==="closed"?`/purchase-order/${E.row.purchase_id}`:`/open-purchase-orders/${E.row.purchase_id}`)},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"},cursor:"pointer"}})]})})]})})};var ah={},q4;function Sde(){if(q4)return ah;q4=1;var e=cr();Object.defineProperty(ah,"__esModule",{value:!0}),ah.default=void 0;var t=e(dr()),r=ur();return ah.default=(0,t.default)((0,r.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),ah}var Cde=Sde();const Vp=It(Cde),Ade=async e=>{const t=Array.isArray(e)?e:[e];if(t.length===0)throw new Error("Please select at least one document to analyze.");const r=new FormData;return t.forEach(a=>r.append("documents",a)),t.length===1&&r.append("document",t[0]),(await ve.post("/api/purchase-orders/ocr/upload",r,{headers:{"Content-Type":"multipart/form-data"}})).data};var ih={},F4;function Pde(){if(F4)return ih;F4=1;var e=cr();Object.defineProperty(ih,"__esModule",{value:!0}),ih.default=void 0;var t=e(dr()),r=ur();return ih.default=(0,t.default)((0,r.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),ih}var Ode=Pde();const kde=It(Ode);var oh={},$4;function Tde(){if($4)return oh;$4=1;var e=cr();Object.defineProperty(oh,"__esModule",{value:!0}),oh.default=void 0;var t=e(dr()),r=ur();return oh.default=(0,t.default)((0,r.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess"),oh}var Ede=Tde();const Ide=It(Ede),Nde=({open:e,onClose:t,purchaseOrderId:r,onSuccess:n,onAllocationSaved:a})=>{const[o,s]=y.useState(!1),[l,c]=y.useState(!1),[u,d]=y.useState(null),[f,h]=y.useState({}),[p,g]=y.useState({}),[m,x]=y.useState({}),[b,_]=y.useState(new Set),[w,A]=y.useState(new Set),[O,T]=y.useState(""),[E,S]=y.useState([]);y.useEffect(()=>{e&&r&&(d(null),h({}),g({}),x({}),_(new Set),S([]),A(new Set),T(""),I())},[e,r]);const I=async()=>{s(!0);try{const H=(await ve.get(`/api/purchase-history/${r}/allocation-suggestions`)).data;console.log("Allocation suggestions data:",H),console.log("Number of suggestions:",H.suggestions?.length),H.suggestions?.forEach((he,me)=>{console.log(`Suggestion ${me}: ${he.part_number} - ${he.allocation_suggestions?.length} sales orders`),he.allocation_suggestions?.forEach((X,G)=>{console.log(`  Allocation ${G}: SO ${X.sales_order_number}, current_quantity_needed: ${X.current_quantity_needed}, is_needed: ${X.is_needed}`)})});const U=new Set,te=[];for(const he of H.suggestions||[])try{console.log(`Checking part type for: ${he.part_number}`);const me=await a6(he.part_number);console.log(`Part info for ${he.part_number}:`,me),me.part_type==="supply"?(U.add(he.part_number),console.log(`Filtering out supply part: ${he.part_number}`)):(console.log(`Including stock part: ${he.part_number} (type: ${me.part_type})`),te.push(he))}catch(me){console.warn(`Could not determine part type for ${he.part_number}, including it:`,me),te.push(he)}_(U),console.log(`Filtering summary: ${U.size} supply parts filtered out, ${te.length} stock parts remaining`),console.log("Supply parts filtered:",Array.from(U)),console.log("Stock parts included:",te.map(he=>he.part_number));const le={...H,suggestions:te};d(le);let oe={},ae={};try{const me=(await ve.get(`/api/purchase-history/${r}/allocations`)).data||[],X={};for(const G of me){const ee=String(G.part_number).toUpperCase();X[ee]||(X[ee]={}),X[ee][G.sales_order_id]=Number(G.allocate_qty)||0}oe={},ae={},te.forEach(G=>{const ee=G.part_number,se=X[ee]||{},V={};G.allocation_suggestions.forEach(Ne=>{const Re=se[Ne.sales_order_id];V[Ne.sales_order_id]=typeof Re=="number"?Re:Ne.suggested_alloc}),oe[ee]=V;const He=Object.values(V).reduce((Ne,Re)=>Ne+(Number(Re)||0),0);ae[ee]=Math.max(0,G.quantity_ordered-He)})}catch{oe={},ae={},te.forEach(me=>{oe[me.part_number]={},me.allocation_suggestions.forEach(G=>{oe[me.part_number][G.sales_order_id]=G.suggested_alloc});const X=Object.values(oe[me.part_number]).reduce((G,ee)=>G+(Number(ee)||0),0);ae[me.part_number]=Math.max(0,me.quantity_ordered-X)})}h(oe),g(ae),A(new Set),S([])}catch(L){console.error("Error fetching allocation suggestions:",L),ge.error("Failed to load allocation suggestions")}finally{s(!1)}},z=(L,H,U)=>{if(!u)return{valid:!0};const te=u.suggestions.find(se=>se.part_number===L);if(!te)return{valid:!0};const le=te.allocation_suggestions.find(se=>se.sales_order_id===H);if(!le)return{valid:!0};const oe=le.current_quantity_needed,ae=te.quantity_ordered,he=te.allocation_suggestions.filter(se=>se.is_needed).reduce((se,V)=>se+V.current_quantity_needed,0),me=ae>=he,X=$(L),G=f[L]?.[H]||0,ee=ae-(X-G);return U>ee?{valid:!1,message:`Cannot allocate more than ${ee} units (exceeds ordered quantity)`}:me&&le.is_needed&&U<oe?{valid:!1,message:`Cannot allocate less than ${oe} units when surplus exists`}:!me&&le.is_needed&&U<oe?{valid:!0,warning:`Allocating ${U} units but ${oe} units are needed for quantity to order`}:{valid:!0}},k=(L,H,U)=>{const te=Math.max(0,U),le=z(L,H,te);if(!le.valid){ge.error(le.message);return}le.warning&&ge.warning(le.warning),h(oe=>{const ae={...oe,[L]:{...oe[L],[H]:te}};if(u){const he=u.suggestions.find(me=>me.part_number===L);if(he){const me=ae[L]||{},X=Object.values(me).reduce((ee,se)=>ee+se,0),G=Math.max(0,he.quantity_ordered-X);g(ee=>({...ee,[L]:G}))}}return ae})},M=L=>{if(!u)return;const H=u.suggestions.find(me=>me.part_number===L);if(!H)return;const U=H.quantity_ordered,te=H.allocation_suggestions.filter(me=>me.is_needed).reduce((me,X)=>me+X.current_quantity_needed,0),le=U>=te,oe=H.allocation_suggestions.filter(me=>me.is_needed).sort((me,X)=>me.sales_order_number.localeCompare(X.sales_order_number)),ae={};let he=U;if(le){for(const me of oe){const X=me.current_quantity_needed,G=Math.min(X,he);G>0&&(ae[me.sales_order_id]=G,he-=G)}if(he>0)for(const me of H.allocation_suggestions){if(he<=0)break;const X=ae[me.sales_order_id]||0,G=Math.min(he,1);ae[me.sales_order_id]=X+G,he-=G}}else for(const me of oe){if(he<=0)break;const X=me.current_quantity_needed,G=Math.min(X,he);G>0&&(ae[me.sales_order_id]=G,he-=G)}h(me=>({...me,[L]:ae})),g(me=>({...me,[L]:he}))},R=()=>{u&&u.suggestions.forEach(L=>{M(L.part_number)})},F=(L,H)=>{A(U=>{const te=new Set(U);return H?te.add(L):te.delete(L),te})},W=L=>{if(!u){A(new Set);return}A(L?new Set(u.suggestions.map(H=>H.part_number)):new Set)},K=y.useMemo(()=>{if(!u)return[];const L=new Map;return u.suggestions.forEach(H=>{H.allocation_suggestions.forEach(U=>{L.has(U.sales_order_id)||L.set(U.sales_order_id,{id:U.sales_order_id,label:U.sales_order_number,customer:U.customer_name})})}),Array.from(L.values()).sort((H,U)=>H.label.localeCompare(U.label))},[u]),Z=()=>{if(!u)return;const L=Array.from(w);if(L.length===0){ge.error("Select at least one part to allocate.");return}if(O===""){ge.error("Select a sales order to allocate the selected parts.");return}const H={...f},U={...p};L.forEach(te=>{const le=u.suggestions.find(he=>he.part_number===te);if(!le)return;const oe={};le.allocation_suggestions.forEach(he=>{oe[he.sales_order_id]=he.sales_order_id===O?le.quantity_ordered:0}),H[te]=oe;const ae=Object.values(oe).reduce((he,me)=>he+(Number(me)||0),0);U[te]=Math.max(0,le.quantity_ordered-ae)}),h(H),g(U),ge.success("Selected parts allocated to the chosen sales order.")},D=()=>{const L=[];return u?(u.suggestions.forEach(H=>{const U=H.part_number,te=H.quantity_ordered,le=f[U]||{},oe=Object.values(le).reduce((me,X)=>me+X,0);oe>te&&L.push(`Total allocation (${oe}) exceeds ordered quantity (${te}) for part ${U}`);const ae=H.allocation_suggestions.filter(me=>me.is_needed).reduce((me,X)=>me+X.current_quantity_needed,0);if(te>=ae){for(const me of H.allocation_suggestions)if(me.is_needed){const X=le[me.sales_order_id]||0,G=me.current_quantity_needed;X<G&&L.push(`Sales order ${me.sales_order_number} must receive at least ${G} units when surplus exists`)}}}),S(L),L.length===0):!1},P=async()=>{if(D()){c(!0);try{const L=[];for(const[U,te]of Object.entries(f))for(const[le,oe]of Object.entries(te))oe>0&&L.push({sales_order_id:parseInt(le),part_number:U,allocate_qty:oe});const H=await ve.post(`/api/purchase-history/${r}/save-allocations`,{allocations:L,surplusPerPart:p});ge.success("Allocations saved successfully"),a&&a(),t()}catch(L){console.error("Error saving allocations:",L);const H=L.response?.data?.error||"Failed to save allocations";ge.error(H)}finally{c(!1)}}},$=L=>{const H=f[L]||{};return Object.values(H).reduce((U,te)=>U+te,0)},Q=L=>{if(!u)return 0;const H=u.suggestions.find(te=>te.part_number===L);if(!H)return 0;const U=$(L);return H.quantity_ordered-U},C=L=>{x(H=>({...H,[L]:!H[L]}))};return o?i.jsxs(gr,{open:e,onClose:t,maxWidth:"lg",fullWidth:!0,children:[i.jsx(vr,{children:"Loading Allocation Suggestions..."}),i.jsx(yr,{children:i.jsx(J,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:i.jsx(nr,{})})})]}):i.jsxs(gr,{open:e,onClose:t,maxWidth:"lg",fullWidth:!0,children:[i.jsxs(vr,{children:["Allocate Purchase Order: ",u?.purchase_order_number]}),i.jsxs(yr,{children:[u&&u.suggestions.length>0&&i.jsxs(xt,{sx:{mb:3,p:2,backgroundColor:"grey.50"},children:[i.jsxs(B,{variant:"h6",gutterBottom:!0,children:["Purchase Order Summary (",u.suggestions.length," parts)"]}),i.jsx(J,{display:"flex",flexWrap:"wrap",gap:1,children:u.suggestions.map((L,H)=>i.jsx(ot,{label:`${L.part_number}: ${L.quantity_ordered} ordered`,color:"primary",variant:"outlined",size:"small"},`${L.part_number}-${H}`))})]}),b.size>0&&i.jsxs(Ot,{severity:"info",sx:{mb:2},children:[i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"Note:"})," ",b.size," supply part",b.size>1?"s":""," ",b.size>1?"have":"has"," been filtered out from allocation. Supply parts are not tracked for inventory allocation."]}),i.jsx(J,{mt:1,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Filtered parts: ",Array.from(b).join(", ")]})})]}),E.length>0&&i.jsxs(Ot,{severity:"error",sx:{mb:2},children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Please correct the following errors:"}),E.map((L,H)=>i.jsxs(B,{variant:"body2",children:[" ",L]},H))]}),u&&u.suggestions.length>0&&i.jsx(xt,{sx:{mb:3,p:2},variant:"outlined",children:i.jsxs(ct,{direction:{xs:"column",md:"row"},spacing:2,alignItems:{xs:"flex-start",md:"center"},children:[i.jsxs(J,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(ri,{control:i.jsx(Xi,{checked:w.size===u.suggestions.length&&u.suggestions.length>0,indeterminate:w.size>0&&w.size<u.suggestions.length,onChange:L=>W(L.target.checked)}),label:"Select all parts"}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:[w.size," selected"]})]}),i.jsxs(tn,{size:"small",sx:{minWidth:220},children:[i.jsx(fn,{id:"bulk-sales-order-label",children:"Sales Order"}),i.jsxs(hn,{labelId:"bulk-sales-order-label",label:"Sales Order",value:O,onChange:L=>T(L.target.value),displayEmpty:!0,children:[i.jsx(tr,{value:"",children:i.jsx("em",{children:"Select sales order"})}),K.map(L=>i.jsxs(tr,{value:L.id,children:[L.label,"  ",L.customer]},L.id))]})]}),i.jsx(ye,{variant:"contained",onClick:Z,disabled:w.size===0||O==="",children:"Allocate selected parts to sales order"})]})}),u?.suggestions.length===0?i.jsx(Ot,{severity:"info",sx:{mb:2},children:i.jsx(B,{variant:"body1",children:"No parts found in this purchase order to allocate."})}):u?.suggestions.map((L,H)=>i.jsxs(xt,{sx:{mb:2,p:2},children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsxs(J,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(Xi,{checked:w.has(L.part_number),onChange:U=>F(L.part_number,U.target.checked),inputProps:{"aria-label":`Select part ${L.part_number}`}}),i.jsx(pr,{size:"small",onClick:()=>C(L.part_number),sx:{p:.5},children:m[L.part_number]?i.jsx(Ide,{}):i.jsx(kde,{})}),i.jsxs(B,{variant:"h6",children:[L.part_number," - ",L.part_description]})]}),i.jsxs(J,{display:"flex",gap:1,alignItems:"center",children:[i.jsx(ot,{label:`Ordered: ${L.quantity_ordered}`,color:"primary",variant:"outlined",size:"small"}),i.jsx(ot,{label:`Total Needed: ${L.total_needed}`,color:"secondary",variant:"outlined",size:"small"}),i.jsx(ot,{label:`Remaining: ${Q(L.part_number)}`,color:Q(L.part_number)<0?"error":"default",variant:"outlined",size:"small"}),i.jsx(ye,{variant:"outlined",size:"small",onClick:()=>M(L.part_number),children:"Auto Allocate (FIFO)"})]})]}),i.jsx(NI,{in:m[L.part_number],children:i.jsx(J,{mt:2,children:i.jsx(va,{children:i.jsxs(sa,{size:"small",children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{children:"Sales Order"}),i.jsx(Pe,{children:"Customer"}),i.jsx(Pe,{children:"Date"}),i.jsx(Pe,{align:"right",children:"Quantity to Order"}),i.jsx(Pe,{align:"right",children:"Allocate Qty"}),i.jsx(Pe,{children:"Status"})]})}),i.jsx(ca,{children:L.allocation_suggestions.map(U=>(console.log(`Rendering allocation for SO ${U.sales_order_number}: current_quantity_needed = ${U.current_quantity_needed}, is_needed = ${U.is_needed}`),i.jsxs(br,{sx:{backgroundColor:U.is_needed?"warning.light":"grey.50","&:hover":{backgroundColor:U.is_needed?"warning.main":"grey.100"},borderLeft:U.is_needed?"4px solid #ff9800":"4px solid transparent"},children:[i.jsx(Pe,{children:i.jsx(B,{variant:"body2",fontWeight:"medium",children:U.sales_order_number})}),i.jsx(Pe,{children:U.customer_name}),i.jsx(Pe,{children:new Date(U.sales_date).toLocaleDateString()}),i.jsx(Pe,{align:"right",children:i.jsx(B,{variant:"body2",color:"black",fontWeight:U.is_needed?"bold":"normal",children:U.current_quantity_needed||0})}),i.jsx(Pe,{align:"right",children:i.jsx(Ae,{type:"number",value:f[L.part_number]?.[U.sales_order_id]||0,onChange:te=>{const le=parseFloat(te.target.value)||0;k(L.part_number,U.sales_order_id,le)},onBlur:te=>{const le=parseFloat(te.target.value)||0,oe=$(L.part_number),ae=f[L.part_number]?.[U.sales_order_id]||0,he=L.quantity_ordered-(oe-ae);le>he&&k(L.part_number,U.sales_order_id,he)},size:"small",sx:{width:80},inputProps:{min:0,step:1,max:L.quantity_ordered}})}),i.jsx(Pe,{children:i.jsx(ot,{label:U.is_needed?"Needs Part":"No Need",color:U.is_needed?"warning":"default",size:"small",variant:"outlined"})})]},`${L.part_number}-${U.sales_order_id}`)))})]})})})}),i.jsxs(J,{mt:2,display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsxs(B,{variant:"body2",children:["Total Allocated: ",$(L.part_number)]}),i.jsxs(J,{display:"flex",alignItems:"center",gap:2,children:[i.jsx(B,{variant:"body2",children:"Surplus to Stock:"}),i.jsx(Ae,{type:"number",value:p[L.part_number]||0,disabled:!0,size:"small",sx:{width:80},inputProps:{min:0,step:1}})]})]})]},`${L.part_number}-${H}`))]}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:t,disabled:l,children:"Cancel"}),i.jsx(ye,{onClick:R,variant:"outlined",disabled:l,sx:{mr:"auto"},children:"Auto Allocate All (FIFO)"}),i.jsx(ye,{onClick:P,variant:"contained",disabled:l||E.length>0,children:l?i.jsx(nr,{size:20}):"Save Allocations"})]})]})},Vw=(e,t)=>{const r=parseFloat(String(e))||0,n=parseFloat(String(t))||0;return Math.round(r*n*100)/100},Dde=(e,t=5)=>{const r=e.reduce((o,s)=>{const l=Vw(s.quantity,s.unit_cost);return o+l},0),n=r*(t/100),a=r+n;return{subtotal:Math.round(r*100)/100,total_gst_amount:Math.round(n*100)/100,total_amount:Math.round(a*100)/100}},Mde=(e,t=!1)=>{const r={};e.part_number?.trim()||(r.part_number="Part Number is required"),e.part_description?.trim()||(r.part_description="Part Description is required");const n=parseFloat(String(e.quantity));if((isNaN(n)||n<=0)&&(r.quantity="Quantity must be greater than 0"),t){const a=parseFloat(String(e.unit_cost));(isNaN(a)||a<=0)&&(r.unit_cost="Unit Cost must be greater than 0")}return r},Lde=(e,t,r=!1)=>{const n={};t||(n.vendor="Vendor is required");const a=e.map(s=>Mde(s,r));return a.some(s=>Object.keys(s).length>0)&&(n.lineItems=a),n},tl=e=>{const t=parseFloat(String(e));return isNaN(t)?0:t},rl=["Each","cm","ft","ft^2","kg","pcs","L"],B4=5,U4=()=>{const{id:e}=Ms(),t=Nn(),{user:r}=ea(),n=e==="new";console.log("Is creation mode:",n,"ID:",e);const[a,o]=y.useState(null),[s,l]=y.useState(null),[c,u]=y.useState(Rt()),[d,f]=y.useState(Rt().toISOString()),[h,p]=y.useState(""),[g,m]=y.useState([]),x=Py(g,300),[b,_]=y.useState([]),[w,A]=y.useState("Open"),[O,T]=y.useState(!1),[E,S]=y.useState(B4),[I,z]=y.useState({}),[k,M]=y.useState(0),[R,F]=y.useState([]),[W,K]=y.useState(""),Z=y.useRef(null),[D,P]=y.useState(!1),[$,Q]=y.useState(null),[C,L]=y.useState(null),[H,U]=y.useState(!1),[te,le]=y.useState(!1),[oe,ae]=y.useState([]),[he,me]=y.useState({}),[X,G]=y.useState(null),[ee,se]=y.useState(null),[V,He]=y.useState(!1),[Ne,Re]=y.useState(null),Ke=y.useRef(null),[nt,st]=y.useState(!0),gt=y.useCallback(async()=>{if(!(te||R.length>0)){le(!0);try{const be=await ve.get("/api/vendors");F(be.data.map(we=>({label:we.vendor_name,id:we.vendor_id,vendor_code:we.vendor_code||"",isNew:!1})))}catch(be){console.error("Failed to reload vendors",be)}finally{le(!1)}}},[R.length,te]),Ge=y.useMemo(()=>{const be={};for(const we of oe||[])we?.part_number&&(be[String(we.part_number)]=we.part_description||"");return be},[oe]),Je=y.useCallback((be,we,Te=!1)=>{const De=(we.inputValue||"").toUpperCase(),Ie=50,pt=[];for(const Lt of be){const Pr=String(Lt).toUpperCase(),Hr=(Ge[Lt]||"").toUpperCase();if((!De||Pr.includes(De)||Hr.includes(De))&&(pt.push(Lt),pt.length>=Ie))break}const Et=pt.some(Lt=>String(typeof Lt=="string"?Lt:Lt?.label||"").toUpperCase()===De);return Te&&De&&!Et&&pt.push({label:`Add "${we.inputValue}" as New Part`,isNew:!0,inputValue:we.inputValue}),pt},[Ge]),[We,_t]=y.useState(!1),[Nt,kt]=y.useState(null),[Vt,jt]=y.useState(""),[Tr,qe]=y.useState(void 0),[$e,Xe]=y.useState("manual"),[Ue,ht]=y.useState([]),[at,wt]=y.useState(null),[Tt,Jt]=y.useState(null),[Dr,qr]=y.useState(null),[ar,Er]=y.useState({}),[Ir,rn]=y.useState({});y.useMemo(()=>O8(),[]);const[Ta,Dn]=y.useState(null),[rr,Kr]=y.useState(!1),[Yn,Mn]=y.useState(null),[Qr,nn]=y.useState(""),[Se,Ve]=y.useState(!1),[it,Ct]=y.useState(!1);y.useEffect(()=>{n&&c&&f(c.toISOString())},[c,n]);const Bt=async()=>{try{console.log("Fetching aggregate quantities...");const be=new AbortController,we=setTimeout(()=>be.abort(),1e4),Te=await ve.get("/api/sales-orders/parts-to-order/all",{signal:be.signal});clearTimeout(we);const{aggregatedParts:De}=Te.data;if(console.log("Full API response:",Te.data),console.log("Aggregated parts response:",De),De&&De.length>0){const Ie={};De.forEach(pt=>{const Et=typeof pt.total_quantity_needed=="string"?parseFloat(pt.total_quantity_needed):pt.total_quantity_needed;Ie[pt.part_number.toUpperCase()]=Et}),console.log("Calculated quantities:",Ie),z(Ie),_(pt=>{const Et=pt.map(Lt=>({...Lt,quantity_to_order:Ie[Lt.part_number]||0}));return console.log("Updated line items with quantities:",Et),Et})}else console.log("No aggregated parts found, clearing quantities"),z({}),_(Ie=>Ie.map(pt=>({...pt,quantity_to_order:0})))}catch(be){console.error("Error fetching aggregate quantities:",be),be.name==="AbortError"&&console.error("Request timed out"),z({}),_(we=>we.map(Te=>({...Te,quantity_to_order:0})))}},Ht=async()=>{if(console.log("fetchData called. ID:",e),n)try{console.log(" Fetching vendors and inventory for creation mode...");const be=new AbortController,we=setTimeout(()=>be.abort(),15e3),[Te,De]=await Promise.all([ve.get("/api/vendors",{signal:be.signal}),ve.get("/api/inventory",{signal:be.signal})]);clearTimeout(we),console.log(" Vendors and inventory fetched successfully"),console.log("Raw vendors data:",Te.data);const Ie=Te.data.map(pt=>({label:pt.vendor_name,id:pt.vendor_id,email:pt.email}));console.log("Mapped vendors:",Ie),F(Ie),ae(De.data),_([]);try{await Bt()}catch(pt){console.error("Error fetching aggregate quantities:",pt)}st(!1),Ve(!0),console.log(" Creation mode initialization complete");return}catch(be){console.error(" Error fetching vendors/inventory:",be),be.name==="AbortError"?Dn("Request timed out. Please try again."):Dn("Failed to fetch vendors and inventory. Please check your connection and try again."),st(!1);return}try{const[be,we,Te]=await Promise.all([ve.get(`/api/purchase-orders/${e}`),ve.get("/api/vendors"),ve.get("/api/inventory")]),De=be.data;if(console.log("Fetched Order Data:",De),o(De),De.vendor_name&&De.vendor_id){const Lt=we.data.find(Pr=>Pr.vendor_id===De.vendor_id);l({label:De.vendor_name,id:De.vendor_id,email:Lt?.email})}else if(De.vendor_id){const Lt=we.data.find(Pr=>Pr.vendor_id===De.vendor_id);Lt?l({label:Lt.vendor_name,id:Lt.vendor_id,email:Lt.email}):(!s||!s.id)&&l(null)}else(!s||!s.id)&&l(null);u(Rt(De.purchase_date)),f(De.date||De.purchase_date||null),p(De.bill_number||""),console.log("Original line items from backend:",De.lineItems);const Ie=De.lineItems.map(Lt=>{const Pr={...Lt,quantity:String(Lt.quantity||""),unit_cost:String(Lt.unit_cost||""),line_amount:parseFloat(String(Lt.line_amount??Lt.line_total??0)),quantity_to_order:0};return console.log("Mapped line item:",Pr),Pr});console.log("Final mapped line items:",Ie),_(Ie),m(Ie);const pt=De.status==="Closed"?"Closed":"Open";console.log("Setting purchase order status:",pt,"from fetched status:",De.status),A(pt),T(!1),S(De.global_gst_rate||B4),console.log("State after setting:",{purchaseOrder:De,billNumber:De.bill_number||"",lineItems:De.lineItems,mappedLineItems:Ie,subTotal:parseFloat(String(De.subtotal))||0,totalGSTAmount:parseFloat(String(De.total_gst_amount))||0,totalAmount:parseFloat(String(De.total_amount))||0}),console.log("Raw vendors data (edit mode):",we.data);const Et=we.data.map(Lt=>({label:Lt.vendor_name,id:Lt.vendor_id,email:Lt.email}));console.log("Mapped vendors (edit mode):",Et),F(Et),ae(Te.data),await Bt(),st(!1),Ve(!0)}catch(be){console.error("Error fetching data:",be),be instanceof fi&&be.response?.data?.message?Dn(be.response.data.message):Dn("An unexpected error occurred")}};y.useEffect(()=>{e&&Ht()},[e]),y.useEffect(()=>{console.log("lineItems state changed:",b)},[b]),y.useEffect(()=>{m(b)},[b]),y.useEffect(()=>{P(!1),wt(null)},[e]);const mr=be=>Vw(tl(be.quantity),tl(be.unit_cost)),an=y.useMemo(()=>x.map(be=>({part_number:be.part_number,part_description:be.part_description,quantity:tl(be.quantity),unit:be.unit,unit_cost:tl(be.unit_cost)})),[x]),Be=y.useMemo(()=>Dde(an,E),[an,E]),tt=Be.subtotal,At=Be.total_gst_amount,Gt=Be.total_amount,or=y.useCallback(be=>JSON.stringify(be.map(we=>({part_number:we.part_number.trim(),part_description:we.part_description.trim(),quantity:parseFloat(String(we.quantity)),unit:we.unit.trim(),unit_cost:parseFloat(String(we.unit_cost))})).sort((we,Te)=>we.part_number!==Te.part_number?we.part_number.localeCompare(Te.part_number):we.quantity-Te.quantity)),[]);y.useEffect(()=>{Se&&(!Array.isArray(oe)||oe.length===0||m(be=>{let we=!1;const Te=be.map(De=>{const Ie=String(De.part_number||"").trim().toUpperCase();if(!Ie)return De;const pt=(oe||[]).find(Qn=>String(Qn.part_number).trim().toUpperCase()===Ie);if(!pt)return De;let Et=De;const Lt=String(pt.unit||"").trim(),Pr=String(De.unit||"").trim();Lt&&!Pr&&(Et={...Et,unit:Lt},we=!0);const Hr=String(pt.part_description||"");Hr&&Hr!==String(De.part_description||"")&&(Et={...Et,part_description:Hr},we=!0);const gn=parseFloat(String(De.unit_cost));if(!Number.isFinite(gn)||gn===0){const Qn=parseFloat(String(pt.last_unit_cost))||0;Qn>0&&Qn!==gn&&(Et={...Et,unit_cost:String(Qn)},we=!0)}if(Et!==De){const Qn=mr(Et);Et={...Et,line_amount:Qn}}return Et});return we?Te:be}))},[Se,oe]),y.useEffect(()=>{if(!n&&!nt&&a&&Qr===""&&Se){console.log("[PO Detail] Setting initial signature for dirty tracking");const be=JSON.stringify({vendor:s?{id:s.id,label:s.label}:null,billNumber:h.trim(),date:c?.toISOString(),lineItems:or(b),pickup_time:a.pickup_time||null,pickup_location:a.pickup_location||null,pickup_contact_person:a.pickup_contact_person||null,pickup_phone:a.pickup_phone||null,pickup_instructions:a.pickup_instructions||null,pickup_notes:a.pickup_notes||null,order_placed:a.order_placed||!1,order_placed_at:a.order_placed_at||null,order_placed_by:a.order_placed_by||null,order_placed_method:a.order_placed_method||null,vendor_confirmation_status:a.vendor_confirmation_status||"pending",vendor_confirmation_notes:a.vendor_confirmation_notes||null,vendor_confirmation_date:a.vendor_confirmation_date||null,pricing_updated:a.pricing_updated||!1,pricing_updated_at:a.pricing_updated_at||null,pricing_updated_by:a.pricing_updated_by||null,pricing_updated_method:a.pricing_updated_method||null,quantity_adjusted:a.quantity_adjusted||!1,quantity_adjusted_at:a.quantity_adjusted_at||null,quantity_adjusted_by:a.quantity_adjusted_by||null,quantity_adjusted_method:a.quantity_adjusted_method||null,original_quantities:a.original_quantities||null,adjusted_quantities:a.adjusted_quantities||null,vendor_pricing_notes:a.vendor_pricing_notes||null});nn(be)}},[n,nt,a,Se,Qr]);const un=y.useMemo(()=>JSON.stringify({vendor:s?{id:s.id,label:s.label}:null,billNumber:h.trim(),date:c?.toISOString(),lineItems:or(b),pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null}),[s,h,c,b,a]),Ea=!!Qr&&Qr!==un&&!it;y.useEffect(()=>{console.log("[PO Detail] isDirty changed:",{isDirty:Ea,hasInitialSignature:!!Qr,signaturesMatch:Qr===un,initialSignature:Qr.slice(0,100)+"...",currentSignature:un.slice(0,100)+"..."}),console.log("[PO Detail] About to render UnsavedChangesGuard with when=",Ea)},[Ea,Qr,un]),y.useEffect(()=>{console.log("Aggregate quantities changed:",I),Object.keys(I).length>0&&_(be=>{const we=be.map(Te=>{const De=I[Te.part_number]||I[Te.part_number.toUpperCase()]||I[Te.part_number.toLowerCase()]||0,Ie=typeof De=="string"?parseFloat(De):De;return{...Te,quantity_to_order:Ie}});return console.log("Updated line items from aggregate quantities effect:",we),we})},[I]);const ro=(be,we,Te)=>{_(De=>{const Ie=[...De];if(!Ie[be])return console.log("Item at index",be,"not found in handleLineItemChange"),De;const pt={...Ie[be],[we]:Te};return we==="quantity"&&parseFloat(Te)<=0?Ie.filter((Et,Lt)=>Lt!==be):((we==="quantity"||we==="unit_cost")&&(pt.line_amount=mr(pt)),Ie[be]=pt,Ie)})},Un=()=>{_(be=>[...be,{part_number:"",part_description:"",quantity:"",unit:rl[0],unit_cost:"",line_amount:0,quantity_to_order:0}])},Kn=be=>{const we=[],Te=[];if(!be||be.length===0)return{mapped:we,pending:Te};const De=Ie=>Ie?Ie.trim().toUpperCase():"";return be.filter(Ie=>Ie.description&&Ie.description.trim().length>0||Ie.partNumber&&Ie.partNumber.trim().length>0).forEach(Ie=>{const pt=tl(Ie.quantity??0),Et=Ie.unitCost!==null&&Ie.unitCost!==void 0&&String(Ie.unitCost).trim()!=="",Lt=Et?tl(Ie.unitCost):0,Pr=Et?Lt:tl(Ie.match?.lastUnitCost??0),Hr=Ie.match?.status==="existing"?De(Ie.match?.matchedPartNumber||Ie.partNumber||Ie.match?.normalizedPartNumber||""):De(Ie.match?.suggestedPartNumber||Ie.partNumber||Ie.normalizedPartNumber||""),gn=Ie.description||Ie.match?.partDescription||"",na=Ie.match?.status==="existing"?Ie.match?.unit||Ie.unit||rl[0]:Ie.unit||rl[0],Qn=Ie.match?.status==="existing"?Et?String(Ie.unitCost):Ie.match?.lastUnitCost!=null?String(Ie.match.lastUnitCost):"":Ie.unitCost!=null?String(Ie.unitCost):"",Oi={part_number:Hr,part_description:gn,quantity:Ie.quantity!==null&&Ie.quantity!==void 0?String(Ie.quantity):"",unit:na,unit_cost:Qn,line_amount:Vw(pt,Pr),quantity_to_order:0},si=we.length;if(we.push(Oi),Ie.match?.status==="missing"&&Hr){const Da={part_number:De(Ie.match.suggestedPartNumber||Hr),part_description:Ie.description||"",unit:Ie.unit||rl[0],last_unit_cost:Ie.unitCost??"",part_type:"stock",category:"Uncategorized"};Te.push({index:si,suggestion:Da})}else if(Ie.match?.status==="existing"&&Ie.match.descriptionMatches===!1){const Da=`Invoice description for part "${Ie.match.matchedPartNumber||Hr}" differs from inventory. Create a new part using the invoice details?`;if(typeof window<"u"?window.confirm(Da):!1){const zi={part_number:De(Ie.match.suggestedPartNumber||Hr),part_description:Ie.description||"",unit:Ie.unit||Ie.match?.unit||rl[0],last_unit_cost:Ie.unitCost??Ie.match?.lastUnitCost??"",part_type:"stock",category:"Uncategorized"};Te.push({index:si,suggestion:zi})}}}),{mapped:we,pending:Te}},Fi=async be=>{const we=be.target.files?Array.from(be.target.files):[];if(we.length!==0){Re(null),He(!0);try{const Te=await Ade(we);se(Te);const De=we.length>1?`${we.length} documents`:"the uploaded document";ge.success(`Gemini analysis completed for ${De}. Review the detected values before applying them.`)}catch(Te){console.error("Error processing OCR document:",Te);let De="Failed to analyze the document with AI. Please ensure OCR and Gemini are configured on the server.";Te instanceof fi&&Te.response?.data?.error?De=Te.response.data.error:Te?.message&&(De=Te.message),Re(De),ge.error(De)}finally{He(!1),be.target&&(be.target.value="")}}},ji=()=>{if(!ee)return;const{normalized:be}=ee.ocr,we=be.vendorMatch,Te=we?.vendorName||be.vendorName||"";if(we&&we.status==="existing"&&we.vendorId){const De=R.find(Et=>Et.id===we.vendorId),Ie=we.matchedVendorName||Te,pt=we.details?.email||"";if(De)l(De),K(De.label);else{const Et={label:Ie||Te,id:we.vendorId,email:pt};F(Lt=>Lt.some(Pr=>Pr.id===we.vendorId)?Lt:[...Lt,Et]),l(Et),K(Et.label)}Ie&&ge.info(`Matched invoice vendor to "${Ie}".`)}else if(we&&we.status==="missing"&&Te){l(null),K(Te);const De={vendor_name:Te,street_address:we.details?.streetAddress||"",city:we.details?.city||"",province:we.details?.province||"",country:we.details?.country||"",postal_code:we.details?.postalCode||"",contact_person:we.details?.contactPerson||"",telephone_number:we.details?.telephone||"",email:we.details?.email||"",website:we.details?.website||""};oi(De),(typeof window<"u"?window.confirm(`Vendor "${Te}" was not found. Would you like to add this vendor now?`):!1)?Ai(!0):ge.warn(`Vendor "${Te}" is not in the system. Review the captured details before continuing.`)}else if(Te){const De=R.find(Ie=>Ie.label.toLowerCase()===Te.toLowerCase());De?(l(De),K(De.label)):(l(null),K(Te))}if(be.billNumber&&p(be.billNumber),be.billDate){const De=Rt(be.billDate);De.isValid()&&u(De)}if(typeof be.gstRate=="number"&&!Number.isNaN(be.gstRate)&&S(be.gstRate),be.lineItems?.length){const{mapped:De,pending:Ie}=Kn(be.lineItems);De.length>0&&(_(De),m(De)),ht(Ie)}else ht([]);ge.success("OCR data applied. Please review the form before saving.")},Qe=async be=>{const we=be.toUpperCase();if(!he[we])try{const Te=await Zm(we);me(De=>({...De,[we]:Te}))}catch{}},Yt=(be,we)=>{const Te=he[be.toUpperCase()]||[];if(Te.length===0)return be;if(we){const pt=Te.filter(Et=>Et.vendor_id===we);if(pt.length>0){const Et=pt.find(Pr=>Pr.preferred);if(Et)return Et.vendor_part_number;const Lt=[...pt].sort((Pr,Hr)=>(Hr.usage_count||0)-(Pr.usage_count||0))[0];if(Lt)return Lt.vendor_part_number}}const De=Te.find(pt=>pt.preferred);if(De)return De.vendor_part_number;const Ie=[...Te].sort((pt,Et)=>(Et.usage_count||0)-(pt.usage_count||0))[0];return Ie?Ie.vendor_part_number:be};y.useEffect(()=>{s&&_(be=>be.map(we=>{const Te=(we.part_number||"").toUpperCase(),De=he[Te];if(!De||De.length===0)return we;const Ie=Yt(Te,s?.id||null);return{...we,part_number:Ie}}))},[s,he]);const sr=be=>{_(we=>we.filter((Te,De)=>De!==be))},Mr=be=>oe.find(we=>we.part_number===be),Ar=(be,we)=>{console.log("handlePartNumberChange called:",{idx:be,newValue:we,inventoryItemsLength:oe.length}),m(Te=>{const De=[...Te],Ie=De[be];if(console.log("Current item before change:",Ie),!Ie)return console.log("Current item not found, creating default item"),De[be]={part_number:"",part_description:"",quantity:"",unit:rl[0],unit_cost:"",line_amount:0,quantity_to_order:0},De;if(we===null||typeof we=="string"&&we.trim()==="")console.log("Resetting line item to empty values"),!Ie.part_number&&!Ie.part_description&&!Ie.quantity&&!Ie.unit_cost?De[be]={...Ie,part_number:"",part_description:"",quantity:"",unit:rl[0],unit_cost:"",line_amount:0,quantity_to_order:0}:console.log("Preserving existing data despite empty input value");else if(typeof we!="string"&&we.isNew){console.log("Opening part dialog for new part"),kt(be);const pt=we.inputValue||"";jt(pt),qe({part_number:pt.toUpperCase(),category:"Uncategorized"}),Xe("manual"),_t(!0)}else if(typeof we=="string"){const pt=Mr(we);console.log("Found inventory item:",pt);const Et=I[we]||I[we.toUpperCase()]||I[we.toLowerCase()]||0,Lt=typeof Et=="string"?parseFloat(Et):Et;if(console.log(`Quantity to order for ${we}:`,Et,"as number:",Lt),console.log("Available aggregate quantities keys:",Object.keys(I)),console.log("Looking for part:",we,"in aggregate quantities:",I),pt){const Pr=Ie.unit_cost,Hr=!Pr||Pr===""||Pr==="0";De[be]={...Ie,part_number:we,part_description:pt.part_description,unit:pt.unit,unit_cost:Hr?String(pt.last_unit_cost):Pr,quantity_to_order:Lt}}else console.log("Inventory item not found, preserving existing data"),De[be]={...Ie,part_number:we,quantity_to_order:Lt}}return De[be].line_amount=mr(De[be]),console.log("Updated item after change:",De[be]),De}),typeof we=="string"&&we.trim()!==""&&Bt()},dn=async(be,we)=>{if(!be||be.trim()==="")return!1;try{return(await ve.get("/api/purchase-history/check-bill-number",{params:{bill_number:be.trim(),exclude_purchase_id:we}})).data.exists}catch(Te){return console.error("Error checking duplicate bill number:",Te),!1}},Fr=(be=!1,we=!1)=>{let Te={};s||(Te.vendor="Vendor is required."),c||(Te.date="Date is required."),be&&!h.trim()&&(Te.billNumber="Bill Number is required.");const De=b.map(pt=>({part_number:pt.part_number,part_description:pt.part_description,quantity:tl(pt.quantity),unit:pt.unit,unit_cost:tl(pt.unit_cost)})),Ie=Lde(De,s,we);return Ie.lineItems&&b.length>0&&(Te.lineItems=Ie.lineItems),rn(Te),Te},ta=async()=>{const be=Fr(!1,!1);if(Object.keys(be).length>0){ge.error("Please correct the errors before saving.");return}if(!(h&&h.trim()&&await dn(h,a?.purchase_id)&&!window.confirm(`Warning: Bill number "${h}" already exists in another purchase order. Do you want to proceed anyway?`))){Ct(!0);try{if(n){const we={vendor_id:s?.id,purchase_date:c?.toISOString(),date:d||c?.toISOString(),bill_number:h.trim(),lineItems:b.map(Ie=>({part_number:Ie.part_number.trim(),part_description:Ie.part_description.trim(),unit:Ie.unit.trim(),quantity:parseFloat(String(Ie.quantity)),unit_cost:parseFloat(String(Ie.unit_cost)),line_amount:parseFloat(String(Ie.line_amount))})),status:"Open",subtotal:tt,total_gst_amount:At,total_amount:Gt,global_gst_rate:E,company_id:r?.company_id,created_by:r?.id,pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null};if(console.log("Creating new purchase order:",we),window.__poCreateInFlight){console.log("[PO] Skipping duplicate create (in flight)");return}window.__poCreateInFlight=!0;const Te=await ve.post("/api/purchase-orders",we);ge.success("Purchase Order created successfully!");const De=Te.data.purchase_id;window.__unsavedGuardAllowNext=!0,t(`/open-purchase-orders/${De}`)}else{const we=w==="Closed"&&O,Te={...a,vendor_id:s?.id,purchase_date:c?.toISOString(),date:d||c?.toISOString()||a?.date,bill_number:h.trim(),lineItems:b.map(Ie=>({...Ie,part_number:Ie.part_number.trim(),part_description:Ie.part_description.trim(),unit:Ie.unit.trim(),quantity:parseFloat(String(Ie.quantity)),unit_cost:parseFloat(String(Ie.unit_cost)),line_amount:parseFloat(String(Ie.line_amount))})),status:w,subtotal:tt,total_gst_amount:At,total_amount:Gt,global_gst_rate:E,gst_rate:E,pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null};console.log("Sending to backend (handleSave):",Te);const De=await ve.put(`/api/purchase-orders/${e}`,Te);Mn("Purchase Order updated successfully!"),we&&(await Ht(),T(!1)),setTimeout(()=>{window.__unsavedGuardAllowNext=!0},100),we||nn(JSON.stringify({vendor:s,billNumber:h,date:c,lineItems:b,pickup_time:a?.pickup_time,pickup_location:a?.pickup_location,pickup_contact_person:a?.pickup_contact_person,pickup_phone:a?.pickup_phone,pickup_instructions:a?.pickup_instructions,pickup_notes:a?.pickup_notes,order_placed:a?.order_placed,order_placed_at:a?.order_placed_at,order_placed_by:a?.order_placed_by,order_placed_method:a?.order_placed_method,vendor_confirmation_status:a?.vendor_confirmation_status,vendor_confirmation_notes:a?.vendor_confirmation_notes,vendor_confirmation_date:a?.vendor_confirmation_date,pricing_updated:a?.pricing_updated,pricing_updated_at:a?.pricing_updated_at,pricing_updated_by:a?.pricing_updated_by,pricing_updated_method:a?.pricing_updated_method,quantity_adjusted:a?.quantity_adjusted,quantity_adjusted_at:a?.quantity_adjusted_at,quantity_adjusted_by:a?.quantity_adjusted_by,quantity_adjusted_method:a?.quantity_adjusted_method,original_quantities:a?.original_quantities,adjusted_quantities:a?.adjusted_quantities,vendor_pricing_notes:a?.vendor_pricing_notes}))}}catch(we){if(console.error("Error saving Purchase Order:",we),we instanceof fi&&we.response?.data?.error){const Te=we.response.data,De=Te.details?` (${Te.details})`:"";ge.error(`Error saving Purchase Order: ${Te.error}${De}`)}else ge.error("Error saving Purchase Order. Please try again.")}finally{Ct(!1),window.__poCreateInFlight=!1}}},jn=async()=>{if(w==="Closed"&&!(Ea&&!window.confirm("Discard your edits to this closed purchase order?")))try{await Ht()}finally{T(!1)}},Ia=async()=>{if(!a?.purchase_id){ge.error("Purchase order not loaded. Cannot export.");return}if(a.status!=="Closed"){ge.error("Only closed purchase orders can be exported to QuickBooks.");return}if(a.exported_to_qbo){ge.error("Purchase order has already been exported to QuickBooks.");return}hs(!0);try{const be=await ve.post(`/api/purchase-orders/${a.purchase_id}/export-to-qbo`);ge.success("Exported to QuickBooks successfully!"),o(we=>we&&{...we,exported_to_qbo:!0})}catch(be){const we=be?.response?.data?.error||"Failed to export to QuickBooks.";ge.error(we)}finally{hs(!1)}},Na=async()=>{a?.purchase_id&&await ai()},ai=async()=>{if(!a?.purchase_id)return;const be=Fr(!0,!0);if(Object.keys(be).length>0){be.lineItems?.some(De=>De.unit_cost)?ge.error("Unit cost is required for all line items before closing a purchase order."):(Kr(!0),ge.error("A bill number is required to close the purchase order."));return}if(!(await dn(h,a.purchase_id)&&!window.confirm(`Warning: Bill number "${h}" already exists in another purchase order. Do you want to proceed with closing this purchase order anyway?`)))try{const Te={...a,vendor_id:s?.id,purchase_date:c?.toISOString(),bill_number:h.trim(),lineItems:b.map(Ie=>({...Ie,part_number:Ie.part_number.trim(),part_description:Ie.part_description.trim(),unit:Ie.unit.trim(),quantity:parseFloat(String(Ie.quantity)),unit_cost:parseFloat(String(Ie.unit_cost)),line_amount:parseFloat(String(Ie.line_amount))})),status:"Closed",subtotal:tt,total_gst_amount:At,total_amount:Gt,global_gst_rate:E,gst_rate:E,pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null},De=await ve.put(`/api/purchase-orders/${a.purchase_id}`,Te);De.status===200?(console.log("Purchase Order closed:",De.data),ge.success("Purchase Order closed successfully!"),o(Ie=>Ie&&{...Ie,status:"Closed"}),A("Closed"),t(`/open-purchase-orders/${a.purchase_id}`)):ge.error("Failed to close purchase order")}catch(Te){if(console.error("Error closing purchase order:",Te),Te instanceof fi&&Te.response?.data?.error){const De=Te.response.data.error;De.toLowerCase().includes("negative quantity")||De.toLowerCase().includes("insufficient inventory")||De.toLowerCase().includes("inventory constraint")?ge.error(`Cannot close: ${De}`):ge.error(`Error closing PO: ${De}`)}else ge.error("Failed to close purchase order. Please try again.")}},ra=()=>{t(`/open-purchase-orders/${a?.purchase_id}`)},On=()=>{Ht(),ge.success("Allocation changes saved successfully. Purchase order remains open.")},Gr=async()=>{if(!Fr(!1)){ge.error("Please correct the errors before proceeding with allocation.");return}try{const be={...a,vendor_id:s?.id,purchase_date:c?.toISOString(),bill_number:h.trim(),lineItems:b.map(we=>({...we,part_number:we.part_number.trim(),part_description:we.part_description.trim(),unit:we.unit.trim(),quantity:parseFloat(String(we.quantity)),unit_cost:parseFloat(String(we.unit_cost)),line_amount:parseFloat(String(we.line_amount))})),subtotal:tt,total_gst_amount:At,total_amount:Gt,global_gst_rate:E,gst_rate:E,pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null};await ve.put(`/api/purchase-orders/${a.purchase_id}`,be),o(be),oo(!0),ge.success("Changes saved successfully. Opening allocation modal...")}catch(be){console.error("Error saving changes before allocation:",be),be instanceof fi&&be.response?.data?.error?ge.error(`Error saving changes: ${be.response.data.error}`):ge.error("Failed to save changes before allocation. Please try again.")}},no=async()=>{if(!a?.purchase_id){ge.error("Purchase order not loaded. Cannot download PDF.");return}try{const be=await ve.get(`/api/purchase-orders/${a.purchase_id}/pdf`,{responseType:"blob"}),we=window.URL.createObjectURL(new Blob([be.data])),Te=document.createElement("a");Te.href=we,Te.download=`purchase_order_${a.purchase_number}.pdf`,document.body.appendChild(Te),Te.click(),Te.remove(),window.URL.revokeObjectURL(we)}catch(be){console.error("Error downloading PDF:",be),ge.error("Failed to download PDF. Please try again.")}},ao=async()=>{await ta(),!(Object.keys(Ir).length>0)&&await no()},io=()=>{if(!a)return;const be=b.map(Te=>Te.quantity),we=prompt(`Enter adjusted quantities (comma-separated, e.g., 50,100,25):
Current quantities: `+be.join(", ")+`
Note: Adjust based on vendor minimum orders (e.g., sold by 10ft packs)`);if(we)try{const Te=we.split(",").map(De=>parseFloat(De.trim()));if(Te.length!==b.length){ge.error("Number of quantities must match number of line items");return}_(De=>De.map((Ie,pt)=>({...Ie,quantity:Te[pt]}))),o(De=>De&&{...De,quantity_adjusted:!0,quantity_adjusted_at:new Date().toISOString(),quantity_adjusted_by:Number(r?.id),quantity_adjusted_method:"manual",original_quantities:be,adjusted_quantities:Te}),ge.success("Quantities adjusted based on vendor confirmation")}catch{ge.error("Invalid quantity format. Please use numbers separated by commas.")}},[Si,oo]=y.useState(!1),[pi,Oo]=y.useState(!1),[$i,fs]=y.useState(""),[so,hs]=y.useState(!1),[Qa,lo]=y.useState(!1),[ii,dc]=y.useState([]),[zn,Yo]=y.useState(!1),[ko,wr]=y.useState(null),[Al,fc]=y.useState({}),Ci=async()=>{if(a?.purchase_id){Yo(!0),wr(null);try{const be=await ve.get(`/api/purchase-history/${a.purchase_id}/allocations`);dc(be.data||[]);const we=Array.from(new Set((be.data||[]).map(Te=>Te.sales_order_id).filter(Boolean)));if(we.length>0)try{const Te=await Promise.all(we.map(Ie=>ve.get(`/api/sales-orders/${Ie}`))),De={};Te.forEach((Ie,pt)=>{const Et=we[pt],Lt=Ie.data?.salesOrder?.sales_order_number||Ie.data?.salesOrder?.sales_number||"";Lt&&(De[Et]=Lt)}),fc(De)}catch(Te){console.warn("Unable to fetch one or more sales order numbers:",Te)}lo(!0)}catch(be){console.error("Error fetching allocations:",be),wr("Failed to load allocations."),lo(!0)}finally{Yo(!1)}}},[Fs,Ai]=y.useState(!1),[Ko,oi]=y.useState({}),Bi=be=>be.normalize("NFD").replace(/[-]/g,"").replace(/[^a-zA-Z0-9\s]/g," ").replace(/\s+/g," ").trim().toUpperCase(),hc=(be,we)=>{const Te=Bi(we);if(!Te)return be.slice(0,8);const De=be.map(Ie=>{const pt=Bi(Ie.label);let Et=-1;return pt.startsWith(Te)?Et=3:pt.split(" ").some(Lt=>Lt.startsWith(Te))?Et=2:pt.includes(Te)&&(Et=1),{opt:Ie,score:Et}}).filter(Ie=>Ie.score>=0);return De.sort((Ie,pt)=>pt.score-Ie.score||Ie.opt.label.localeCompare(pt.opt.label)),De.slice(0,8).map(Ie=>Ie.opt)},$s=be=>{const we=Bi(be);return R.find(Te=>Bi(Te.label)===we)||null},co=be=>{const we=Bi(be),Te=oe.find(De=>Bi(De.part_number)===we);return Te?Te.part_number:null},To=be=>{const we=W.trim(),Te=be.key==="Enter",De=be.key==="Tab",Ie=be.key==="Escape",pt=be.key==="ArrowDown"||be.key==="ArrowUp";if(Ie){P(!1);return}if(pt){be.key==="ArrowDown"&&!D&&P(!0);return}if(Te||De){if(Te&&be.ctrlKey&&we){be.preventDefault(),U(!0),oi({vendor_name:we}),Ai(!0),P(!1);return}if(D){if(Te){const Lt=C;Lt&&Lt.isNew&&(be.preventDefault(),U(!0),oi({vendor_name:we}),Ai(!0),P(!1))}return}const Et=$s(we);if(!we)return;be.preventDefault(),Et?(l(Et),K(Et.label)):(U(!0),oi({vendor_name:we}),Ai(!0),P(!1))}},Eo=(be,we)=>{const Te=(b[be]?.part_number||"").trim(),De=we.key==="Enter",Ie=we.key==="Tab",pt=we.key==="Escape",Et=we.key==="ArrowDown"||we.key==="ArrowUp";if(pt){wt(null);return}if(Et){we.key==="ArrowDown"&&at!==be&&wt(be);return}if(!(at===be&&(De||Ie))&&(De||Ie)){if(De&&we.ctrlKey&&Te){we.preventDefault(),qr(be),jt(Te),kt(be),qe({part_number:Te.toUpperCase(),category:"Uncategorized"}),Xe("manual"),_t(!0),wt(null);return}const Lt=co(Te);if(!Te)return;we.preventDefault(),Lt?Ar(be,Lt):(qr(be),jt(Te),kt(be),qe({part_number:Te.toUpperCase(),category:"Uncategorized"}),Xe("manual"),_t(!0),wt(null))}},Pl=()=>{_t(!1),kt(null),qe(void 0),Xe("manual"),jt("")},Pi=be=>{const we=R.find(Te=>Te.id===be);return console.log("Getting vendor email for vendor ID:",be),console.log("Selected vendor:",we),console.log("Vendor email:",we?.email),we?.email||""},Bs=async()=>{if(!s?.id){ge.error("Please select a vendor first");return}if(n){if(!Fr(!1)){ge.error("Please correct the errors before sending email.");return}try{const be={vendor_id:s?.id,purchase_date:c?.toISOString(),bill_number:h.trim(),lineItems:b.map(pt=>({part_number:pt.part_number.trim(),part_description:pt.part_description.trim(),unit:pt.unit.trim(),quantity:parseFloat(String(pt.quantity)),unit_cost:parseFloat(String(pt.unit_cost)),line_amount:parseFloat(String(pt.line_amount))})),status:"Open",subtotal:tt,total_gst_amount:At,total_amount:Gt,global_gst_rate:E,company_id:r?.company_id,created_by:r?.id,pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null};console.log("Creating new purchase order for email:",be);const Te=(await ve.post("/api/purchase-orders",be)).data;o(Te);const De=Te.purchase_id;t(`/open-purchase-orders/${De}`);const Ie=Pi(s.id);fs(Ie),Oo(!0),ge.success("Purchase Order created and email modal opened!")}catch(be){console.error("Error creating Purchase Order for email:",be),be instanceof fi&&be.response?.data?.error?ge.error(`Error creating Purchase Order: ${be.response.data.error}`):ge.error("Error creating Purchase Order. Please try again.")}}else{const be=Pi(s.id);console.log("Email button clicked - vendor ID:",s.id),console.log("Retrieved email:",be),fs(be),Oo(!0)}};y.useEffect(()=>{console.log("Part modal state changed - openPartDialog:",We,"partNumberForModal:",Vt,"partToAddIndex:",Nt)},[We,Vt,Nt]),y.useEffect(()=>{if(!We&&Ue.length>0){const[be,...we]=Ue;ht(we),kt(be.index),jt(be.suggestion.part_number?String(be.suggestion.part_number):""),qe({part_number:be.suggestion.part_number??"",part_description:be.suggestion.part_description??"",unit:be.suggestion.unit??rl[0],last_unit_cost:be.suggestion.last_unit_cost??"",quantity_on_hand:be.suggestion.quantity_on_hand??"",reorder_point:be.suggestion.reorder_point??"",part_type:be.suggestion.part_type??"stock",category:be.suggestion.category??"Uncategorized"}),Xe("ocr"),_t(!0)}},[We,Ue]),y.useEffect(()=>{We&&wt(null)},[We]),y.useEffect(()=>{if(s?.id){const be=Pi(s.id);console.log("Vendor changed - updating email:",be),fs(be)}else fs("")},[s,R]);const Ui=()=>{if(!a)return null;const be=b||[];let we=be.reduce((Ie,pt)=>Ie+(Number(pt.line_amount)||0),0),Te=we*(a.global_gst_rate||5)/100,De=we+Te;return isNaN(we)&&(we=0),isNaN(Te)&&(Te=0),isNaN(De)&&(De=0),i.jsxs(J,{p:{xs:2,md:4},maxWidth:1e3,mx:"auto",children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Purchase Order Details"}),i.jsx(Br,{variant:"outlined",sx:{mb:3},children:i.jsx(Vr,{children:i.jsxs(ie,{container:!0,spacing:{xs:2,md:3},children:[i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Purchase Order #:"})," ",a.purchase_number]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Vendor:"})," ",a.vendor_name||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Purchase Date:"})," ",a.purchase_date?new Date(a.purchase_date).toLocaleDateString():""]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Transaction Date:"})," ",d?new Date(d).toLocaleDateString():""]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Created On:"})," ",a.created_at?new Date(a.created_at).toLocaleDateString():"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Status:"})," ",a.status?.toUpperCase()||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Bill Number:"})," ",a.bill_number||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"GST Rate:"})," ",(a.global_gst_rate||5).toFixed(2),"%"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"QuickBooks Export:"})," ",a.exported_to_qbo?"Exported":a.qbo_export_status?`Error: ${a.qbo_export_status}`:"Not Exported"]})]})})}),a.return_orders&&i.jsx(J,{mb:3,children:Us()}),i.jsx(B,{variant:"h5",gutterBottom:!0,children:"Items"}),i.jsx(Br,{variant:"outlined",children:i.jsx(Vr,{children:be.map((Ie,pt)=>i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:3,md:2,children:Ie.part_number}),i.jsx(ie,{item:!0,xs:6,sm:5,md:4,children:Ie.part_description}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1.5,children:Ie.quantity}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1.5,children:Ie.unit}),i.jsxs(ie,{item:!0,xs:4,sm:2,md:1.5,children:["$",Qne(Number(Ie.unit_cost)||0)]}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1,children:Va(Number(Ie.line_amount)||0)})]},pt))})}),i.jsxs(J,{mt:4,display:"flex",flexDirection:"column",alignItems:"flex-end",children:[i.jsxs(B,{variant:"h6",children:["Subtotal: ",Va(we)]}),i.jsxs(B,{variant:"h6",children:["Total GST: ",Va(Te)]}),i.jsxs(B,{variant:"h6",children:["Total Amount: ",Va(De)]})]}),i.jsxs(J,{mt:4,display:"flex",justifyContent:{xs:"center",sm:"flex-end"},gap:2,children:[i.jsx(ye,{variant:"contained",color:"primary",startIcon:i.jsx(da,{}),onClick:ao,children:"Download PDF"}),!a?.exported_to_qbo&&r?.access_role==="Admin"&&i.jsx(ye,{variant:"contained",color:"success",startIcon:i.jsx(Ap,{}),onClick:Ia,disabled:so,children:so?"Exporting...":"Export to QuickBooks"}),(r?.access_role==="Admin"||r?.access_role==="Sales and Purchase")&&i.jsx(ye,{variant:"contained",color:"secondary",startIcon:i.jsx(tu,{}),onClick:()=>T(!0),children:"Edit"}),i.jsx(ye,{variant:"outlined",color:"primary",onClick:Ci,children:"View Allocations"})]}),i.jsxs(gr,{open:Qa,onClose:()=>lo(!1),maxWidth:"md",fullWidth:!0,children:[i.jsx(vr,{children:"Allocations"}),i.jsxs(yr,{dividers:!0,children:[zn&&i.jsx(J,{display:"flex",justifyContent:"center",alignItems:"center",py:4,children:i.jsx(nr,{})}),!zn&&ko&&i.jsx(Ot,{severity:"error",children:ko}),!zn&&!ko&&(()=>{if(!ii||ii.length===0)return i.jsx(B,{variant:"body2",children:"No allocations were saved for this purchase order."});const Ie=ii.reduce((Et,Lt)=>{const Pr=(Lt.part_number||"").toString();return Et[Pr]||(Et[Pr]=[]),Et[Pr].push(Lt),Et},{}),pt=Object.keys(Ie).sort();return i.jsx(ct,{spacing:3,children:pt.map(Et=>{const Lt=Ie[Et],Pr=Lt.find(gn=>gn.part_description)?.part_description||"",Hr=Lt.reduce((gn,na)=>gn+(Number(na.allocate_qty)||0),0);return i.jsxs(J,{children:[i.jsxs(B,{variant:"subtitle1",sx:{fontWeight:"bold"},children:[Et," ",Pr?`- ${Pr}`:""]}),i.jsx(va,{component:xt,sx:{mt:1},children:i.jsxs(sa,{size:"small",children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{children:"Sales Order"}),i.jsx(Pe,{children:"Sales Order Number"}),i.jsx(Pe,{align:"right",children:"Allocated Qty"})]})}),i.jsxs(ca,{children:[Lt.map(gn=>i.jsxs(br,{children:[i.jsxs(Pe,{children:["#",gn.sales_order_id]}),i.jsx(Pe,{children:Al[gn.sales_order_id]?`SO-${Al[gn.sales_order_id]}`:"-"}),i.jsx(Pe,{align:"right",children:Number(gn.allocate_qty||0).toFixed(2)})]},gn.allocation_id)),i.jsxs(br,{children:[i.jsx(Pe,{sx:{fontWeight:600},children:"Total"}),i.jsx(Pe,{align:"right",sx:{fontWeight:600},children:Hr.toFixed(2)})]})]})]})})]},Et)})})})()]}),i.jsx(Cr,{children:i.jsx(ye,{onClick:()=>lo(!1),children:"Close"})})]})]})},Us=()=>{if(!a)return null;const be=a.return_orders??[],we=a.return_summary??{};return i.jsxs(xt,{sx:{p:3},elevation:1,children:[i.jsxs(ct,{direction:{xs:"column",md:"row"},alignItems:{xs:"flex-start",md:"center"},justifyContent:"space-between",spacing:2,children:[i.jsxs(J,{children:[i.jsx(B,{variant:"h6",children:"Return Orders"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"View vendor returns associated with this purchase order."})]}),i.jsxs(ct,{direction:"row",spacing:1,children:[i.jsx(ot,{label:`Requested: ${we.requested_count??0}`,color:"warning",variant:"outlined",size:"small"}),i.jsx(ot,{label:`Returned: ${we.returned_count??0}`,color:"success",variant:"outlined",size:"small"}),i.jsx(ye,{variant:"outlined",onClick:()=>t(`/return-orders/new?purchaseId=${a.purchase_id}`),children:"Create Return"})]})]}),be.length===0?i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"No return orders have been logged for this purchase order."}):i.jsx(va,{component:J,sx:{mt:2},children:i.jsxs(sa,{size:"small",children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{children:"Return #"}),i.jsx(Pe,{children:"Status"}),i.jsx(Pe,{children:"Requested"}),i.jsx(Pe,{children:"Returned"}),i.jsx(Pe,{align:"right",children:"Total Qty"}),i.jsx(Pe,{align:"right",children:"Actions"})]})}),i.jsx(ca,{children:be.map(Te=>i.jsxs(br,{hover:!0,children:[i.jsx(Pe,{children:Te.return_number}),i.jsx(Pe,{children:i.jsx(ot,{label:Te.status,size:"small",color:Te.status==="Returned"?"success":"warning",variant:"outlined"})}),i.jsx(Pe,{children:Te.requested_at?new Date(Te.requested_at).toLocaleString():""}),i.jsx(Pe,{children:Te.returned_at?new Date(Te.returned_at).toLocaleString():""}),i.jsx(Pe,{align:"right",children:Number(Te.total_quantity??0).toFixed(2)}),i.jsx(Pe,{align:"right",children:i.jsx(ye,{size:"small",onClick:()=>t(`/return-orders/${Te.return_id}`),children:"View"})})]},Te.return_id))})]})})]})};return!n&&!a?i.jsx(J,{p:4,children:i.jsx(B,{variant:"h5",children:"Loading Purchase Order..."})}):nt?i.jsx(J,{p:4,children:i.jsx(B,{variant:"h5",children:"Loading..."})}):!n&&w==="Closed"&&!O?Ui():i.jsxs(i.Fragment,{children:[i.jsxs(Os,{dateAdapter:oc,children:[i.jsx(qy,{when:Ea,onSave:ta}),i.jsxs(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsxs(J,{children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:n?"Create New Purchase Order":`Edit Purchase Order: ${a?.purchase_number}`}),!n&&a&&i.jsxs(i.Fragment,{children:[i.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:2,mt:1},children:[i.jsx(ot,{label:a.order_placed?"Order Placed":"Order Not Placed",color:a.order_placed?"success":"warning",variant:"outlined",size:"small"}),i.jsx(ot,{label:`Vendor: ${a.vendor_confirmation_status||"pending"}`,color:a.vendor_confirmation_status==="confirmed"?"success":a.vendor_confirmation_status==="partial"?"warning":a.vendor_confirmation_status==="unavailable"?"error":"default",variant:"outlined",size:"small"}),a.pricing_updated&&i.jsx(ot,{label:"Pricing Updated",color:"info",variant:"outlined",size:"small"}),a.quantity_adjusted&&i.jsx(ot,{label:"Quantities Adjusted",color:"secondary",variant:"outlined",size:"small"})]}),a.created_at&&i.jsxs(B,{variant:"subtitle1",color:"text.secondary",sx:{mt:1},children:["Created On: ",new Date(a.created_at).toLocaleDateString()]})]})]}),i.jsxs(ct,{direction:"row",spacing:1,children:[i.jsx(ye,{variant:"contained",color:"primary",onClick:ta,startIcon:i.jsx(Is,{}),children:n?"Create Purchase Order":w==="Closed"&&O?"Save Closed PO Edits":"Save Changes"}),!n&&w==="Closed"&&O&&i.jsx(ye,{variant:"outlined",color:"secondary",onClick:jn,startIcon:i.jsx(Vp,{}),children:"Cancel Edit"}),!n&&i.jsxs(i.Fragment,{children:[w!=="Closed"&&i.jsx(ye,{variant:"contained",color:"primary",onClick:Na,startIcon:i.jsx(bv,{}),children:"Close PO"}),i.jsx(ye,{variant:"contained",color:"primary",onClick:ao,startIcon:i.jsx(da,{}),children:"Download PDF"}),i.jsx(ye,{variant:"contained",onClick:Bs,startIcon:i.jsx(bS,{}),sx:{backgroundColor:"#ff9800","&:hover":{backgroundColor:"#f57c00"}},children:"Email Vendor"})]})]})]}),!n&&a&&i.jsx(J,{sx:{mb:3},children:Us()}),rr&&i.jsxs(Ot,{severity:"warning",sx:{mb:3},onClose:()=>Kr(!1),children:[i.jsx(B,{variant:"body1",sx:{fontWeight:"medium"},children:"Bill Number Required"}),i.jsx(B,{variant:"body2",children:"A bill number is required to close this purchase order. Please enter a bill number before closing."})]}),i.jsx(Br,{variant:"outlined",sx:{mb:3},children:i.jsxs(Vr,{children:[i.jsxs(ct,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:{xs:"stretch",sm:"center"},children:[i.jsxs(J,{sx:{flexGrow:1},children:[i.jsx(B,{variant:"h6",children:"Invoice / Packing Slip OCR Prefill"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Upload one or multiple invoice/packing slip images (or a PDF) to extract vendor, bill, and line item details using on-server OCR."})]}),i.jsx("input",{type:"file",accept:"image/*,.pdf",multiple:!0,hidden:!0,ref:Ke,onChange:Fi}),i.jsx(ye,{variant:"contained",color:"secondary",startIcon:i.jsx(Ap,{}),onClick:()=>Ke.current?.click(),disabled:V,children:V?"Processing":"Upload Documents"}),V&&i.jsx(nr,{size:24})]}),Ne&&i.jsx(Ot,{severity:"error",sx:{mt:2},children:Ne}),ee&&i.jsxs(J,{sx:{mt:3},children:[i.jsxs(ct,{direction:{xs:"column",md:"row"},spacing:2,alignItems:{xs:"flex-start",md:"center"},children:[i.jsxs(J,{sx:{flexGrow:1},children:[i.jsxs(ct,{direction:"row",spacing:1,alignItems:"center",children:[i.jsx(B,{variant:"subtitle1",children:"Detected Fields"}),i.jsx(ot,{size:"small",color:ee.source==="ai"?"info":"default",variant:ee.source==="ai"?"filled":"outlined",label:ee.source==="ai"?"Gemini AI analysis":"OCR extraction"})]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Review the extracted details and apply them to this purchase order."}),ee.files?.length?i.jsx(ct,{direction:"row",spacing:1,sx:{flexWrap:"wrap",mt:1},children:ee.files.map(be=>i.jsx(ot,{size:"small",label:be.originalName,variant:"outlined"},be.storedName))}):ee.file?i.jsx(B,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:ee.file.originalName}):null]}),i.jsx(ct,{direction:"row",spacing:1,children:i.jsx(ye,{variant:"contained",color:"primary",onClick:ji,children:"Apply to Form"})})]}),i.jsxs(ie,{container:!0,spacing:2,sx:{mt:1},children:[i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsx(B,{variant:"body2",color:"text.secondary",children:"Vendor"}),i.jsx(B,{variant:"body1",children:ee.ocr.normalized.vendorName||"Not detected"}),ee.ocr.normalized.vendorAddress&&i.jsx(B,{variant:"body2",color:"text.secondary",children:ee.ocr.normalized.vendorAddress})]}),i.jsxs(ie,{item:!0,xs:12,md:3,children:[i.jsx(B,{variant:"body2",color:"text.secondary",children:"Bill Number"}),i.jsx(B,{variant:"body1",children:ee.ocr.normalized.billNumber||"Not detected"})]}),i.jsxs(ie,{item:!0,xs:12,md:3,children:[i.jsx(B,{variant:"body2",color:"text.secondary",children:"Bill Date"}),i.jsx(B,{variant:"body1",children:ee.ocr.normalized.billDate||"Not detected"})]})]}),ee.ocr.normalized.lineItems.length>0&&i.jsxs(J,{sx:{mt:2},children:[i.jsxs(B,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Sample of detected line items (",ee.ocr.normalized.lineItems.length," total)"]}),i.jsx(xt,{variant:"outlined",sx:{maxHeight:200,overflowY:"auto",p:1},children:ee.ocr.normalized.lineItems.slice(0,5).map((be,we)=>i.jsxs(J,{sx:{py:.5},children:[i.jsxs(B,{variant:"body2",sx:{fontWeight:500},children:[be.partNumber?`${be.partNumber}  `:"",be.description]}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:["Qty: ",be.quantity??"n/a"," | Unit Cost: ",be.unitCost??"n/a"," | Total: ",be.totalCost??"n/a"]})]},`${be.rawLine}-${we}`))})]}),(ee.ocr.warnings.length>0||ee.ocr.notes.length>0)&&i.jsxs(ct,{direction:"row",spacing:1,sx:{mt:2,flexWrap:"wrap"},children:[ee.ocr.warnings.map((be,we)=>i.jsx(ot,{label:be,color:"warning",variant:"outlined",sx:{mr:1,mb:1}},`ocr-warning-${we}`)),ee.ocr.notes.map((be,we)=>i.jsx(ot,{label:be,color:"info",variant:"outlined",sx:{mr:1,mb:1}},`ocr-note-${we}`))]})]})]})}),i.jsx(xt,{sx:{p:3},children:i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Fa,{disablePortal:!1,open:D,onOpen:()=>P(!0),onClose:()=>P(!1),autoHighlight:!0,value:s,onChange:(be,we)=>{if(H){U(!1);return}we&&we.isNew?(Ai(!0),oi({vendor_name:W}),l(null),K(""),P(!1)):(l(we),P(!1))},filterOptions:(be,we)=>{const Te=hc(be,we.inputValue||""),De=!!$s(we.inputValue||""),Ie=[...Te];return(we.inputValue||"").trim()!==""&&!De&&Ie.push({label:`Add "${we.inputValue}" as New Vendor`,isNew:!0}),Te.length===0&&(we.inputValue||"").trim()!==""&&!De,Ie},inputValue:W,onInputChange:(be,we,Te)=>{if(K(we),Te==="reset")return;(we||"").trim()||P(!1)},options:R,getOptionLabel:be=>typeof be=="string"?be:be.label,isOptionEqualToValue:(be,we)=>be.id===we.id,onHighlightChange:(be,we)=>L(we),ListboxProps:{role:"listbox",style:{maxHeight:320,overflowY:"auto"}},renderOption:(be,we)=>{const Te=we.isNew,{key:De,...Ie}=be;return i.jsxs("li",{...Ie,style:{display:"flex",alignItems:"center",opacity:Te?.9:1},children:[Te&&i.jsx(ec,{fontSize:"small",style:{marginRight:8,color:"#666"}}),i.jsx("span",{children:we.label})]},De)},renderInput:be=>i.jsx(Ae,{...be,label:"Vendor",error:!!Ir.vendor,helperText:Ir.vendor,onFocus:gt,onKeyDown:To,onBlur:()=>{if(P(!1),!s){const we=W.trim();if(we){const Te=$s(we);Te&&(l(Te),K(Te.label))}}},inputRef:we=>{Z.current=we}})})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{label:"Bill Number",value:h,onChange:be=>{p(be.target.value),be.target.value.trim()!==""&&Kr(!1)},fullWidth:!0,error:!!Ir.billNumber,helperText:Ir.billNumber})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{label:"GST Rate (%)",type:"number",value:E,onChange:be=>S(Number(be.target.value)),fullWidth:!0,inputProps:{min:0,max:100,step:"0.01",readOnly:w==="Closed"&&!O,onWheel:be=>be.currentTarget.blur()},helperText:"Change GST rate if needed (default 5%). This will affect GST and total calculations.",disabled:w==="Closed"&&!O})})]})}),i.jsxs(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:3,mb:2},children:[i.jsx(B,{variant:"h6",children:"Line Items"}),i.jsx(ye,{variant:"contained",onClick:Gr,startIcon:i.jsx(bv,{}),sx:{backgroundColor:n?"#e0e0e0":"#ff9800",color:"#fff","&:hover":{backgroundColor:n?"#e0e0e0":"#f57c00"},"&.Mui-disabled":{color:"#fff"}},disabled:n,children:"  Allocate Parts"})]}),i.jsxs(xt,{sx:{p:3,mb:3,mt:0},elevation:3,children:[i.jsx(ie,{container:!0,spacing:2,children:b.map((be,we)=>i.jsxs(Ce.Fragment,{children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Fa,{disablePortal:!1,open:at===we,onOpen:()=>wt(we),onClose:()=>wt(null),autoHighlight:!0,value:be.part_number,inputValue:ar[we]??be.part_number,onInputChange:(Te,De,Ie)=>{if(Er(Et=>({...Et,[we]:De})),Ie==="reset")return;(De||"").trim()||wt(null)},onChange:(Te,De)=>{if(typeof De=="string"){const Ie=De,pt=oe.find(Pr=>Pr.part_number===Ie),Et=I[Ie]||I[Ie?.toUpperCase?.()||""]||I[Ie?.toLowerCase?.()||""]||0,Lt=typeof Et=="string"?parseFloat(Et):Et;_(Pr=>{const Hr=[...Pr],gn=Hr[we];if(pt){const na=gn.unit_cost,Oi=String(!na||na===""||na==="0"?pt.last_unit_cost:na),si={...gn,part_number:Ie,part_description:pt.part_description,unit:pt.unit,unit_cost:Oi,quantity_to_order:Lt};if(si.line_amount=mr(si),Hr[we]=si,Qe(pt.part_number),s?.id){const Da=(()=>{const Ua=he[pt.part_number.toUpperCase()]||[];if(Ua.length===0)return null;const zi=Ua.filter(ki=>ki.vendor_id===s.id);if(zi.length>0){const ki=zi.find(Hi=>Hi.preferred);if(ki)return ki.vendor_part_number;const Wi=[...zi].sort((Hi,ps)=>(ps.usage_count||0)-(Hi.usage_count||0))[0];if(Wi)return Wi.vendor_part_number}const uo=Ua.find(ki=>ki.preferred);if(uo)return uo.vendor_part_number;const Io=[...Ua].sort((ki,Wi)=>(Wi.usage_count||0)-(ki.usage_count||0))[0];return Io?Io.vendor_part_number:null})();Da&&(Hr[we].part_number=Da)}}else Hr[we]={...gn,part_number:Ie};return Hr}),Ar(we,Ie),wt(null),Er(Pr=>({...Pr,[we]:""}))}else if(De&&typeof De=="object"&&"isNew"in De){const Ie=De.inputValue||"";jt(Ie),kt(we),qe({part_number:Ie.toUpperCase(),category:"Uncategorized"}),Xe("manual"),_t(!0),wt(null),Er(pt=>({...pt,[we]:""}))}},options:oe.map(Te=>Te.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,getOptionLabel:Te=>typeof Te=="string"?Te:Te.label,renderOption:(Te,De)=>{const Ie=typeof De=="object"&&De.isNew,pt=typeof De=="string"?De:De.label,{key:Et,...Lt}=Te;return i.jsxs("li",{...Lt,children:[Ie&&i.jsx(ec,{fontSize:"small",style:{marginRight:8,color:"#666"}}),typeof De=="string"?i.jsxs(J,{children:[i.jsx(B,{variant:"body2",children:De}),(()=>{const Pr=Ge[String(De)]||"";return Pr?i.jsx(B,{variant:"caption",color:"text.secondary",children:Pr}):null})()]}):pt]},Et)},filterOptions:(Te,De)=>Je(Te,De,!0),ListboxProps:{role:"listbox",style:{maxHeight:320,overflowY:"auto"}},renderInput:Te=>i.jsx(Ae,{...Te,label:"Part Number",fullWidth:!0,required:!0,error:!!Ir.lineItems?.[we]?.part_number,helperText:Ir.lineItems?.[we]?.part_number,onKeyDown:De=>Eo(we,De),onBlur:()=>{wt(null);const Ie=(b[we]?.part_number||"").trim();if(!Ie)return;const pt=co(Ie);if(pt){const Et=oe.find(Hr=>Hr.part_number===pt),Lt=I[pt]||I[pt?.toUpperCase?.()||""]||I[pt?.toLowerCase?.()||""]||0,Pr=typeof Lt=="string"?parseFloat(Lt):Lt;_(Hr=>{const gn=[...Hr],na=gn[we];if(Et){const Qn=na.unit_cost,si=String(!Qn||Qn===""||Qn==="0"?Et.last_unit_cost:Qn),Da={...na,part_number:pt,part_description:Et.part_description,unit:Et.unit,unit_cost:si,quantity_to_order:Pr};Da.line_amount=mr(Da),gn[we]=Da}else gn[we]={...na,part_number:pt};return gn}),Ar(we,pt)}}})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Ae,{label:"Part Description",value:be.part_description,InputProps:{readOnly:!0},fullWidth:!0,error:!!Ir.lineItems?.[we]?.part_description,helperText:Ir.lineItems?.[we]?.part_description})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Ae,{label:"Qty",value:be.quantity,onChange:Te=>ro(we,"quantity",Te.target.value),type:"number",fullWidth:!0,required:!0,error:!!Ir.lineItems?.[we]?.quantity,helperText:Ir.lineItems?.[we]?.quantity,inputProps:{step:"1",onWheel:Te=>Te.currentTarget.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Ae,{label:"Unit",value:be.unit,select:!0,fullWidth:!0,disabled:!0,InputProps:{readOnly:!0},children:rl.map(Te=>i.jsx(tr,{value:Te,children:Te},Te))})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Ae,{label:"Unit Cost",value:be.unit_cost,onChange:Te=>ro(we,"unit_cost",Te.target.value),type:"number",fullWidth:!0,error:!!Ir.lineItems?.[we]?.unit_cost,helperText:Ir.lineItems?.[we]?.unit_cost,inputProps:{step:"0.0001",onWheel:Te=>Te.currentTarget.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Ae,{label:"Amount",value:be.line_amount!=null&&!isNaN(Number(be.line_amount))?Number(be.line_amount).toFixed(2):"0.00",InputProps:{readOnly:!0},fullWidth:!0})}),i.jsxs(ie,{item:!0,xs:12,sm:1,md:1,sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(ye,{variant:"outlined",color:"primary",onClick:()=>sr(we),sx:{flexShrink:0},children:"Remove"}),(()=>{const Te=n?"Open":w,De=Te==="Open"&&typeof be.quantity_to_order=="number"&&be.quantity_to_order>0;return console.log(`Rendering Qty to Order for ${be.part_number}:`,{status:w,isCreationMode:n,effectiveStatus:Te,quantity_to_order:be.quantity_to_order,type:typeof be.quantity_to_order,shouldShow:De}),De?i.jsx(Ae,{label:"Qty to Order",value:be.quantity_to_order,size:"small",InputProps:{readOnly:!0},sx:{backgroundColor:"#fff3cd",minWidth:"120px","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#ffc107"},"&:hover fieldset":{borderColor:"#ffc107"}}}}):null})()]})]},we))}),i.jsx(J,{sx:{mt:2},children:i.jsx(ye,{variant:"outlined",color:"primary",onClick:Un,children:"Add Line Item"})})]}),i.jsx(xt,{sx:{p:3,mb:3},elevation:3,children:i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Subtotal: $",tt!=null&&!isNaN(Number(tt))?Number(tt).toFixed(2):"0.00"]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Total GST: $",At!=null&&!isNaN(Number(At))?Number(At).toFixed(2):"0.00"]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"h6",children:["Total Amount: $",Gt!=null&&!isNaN(Number(Gt))?Number(Gt).toFixed(2):"0.00"]})})]})}),i.jsx(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:3,mb:2},children:i.jsx(B,{variant:"h6",children:"Pickup Details for Drivers"})}),i.jsx(xt,{sx:{p:3,mb:3},elevation:3,children:i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"Pickup Time",placeholder:"e.g., tomorrow at 2 PM, Friday morning",value:a?.pickup_time||"",onChange:be=>{a&&o({...a,pickup_time:be.target.value})},fullWidth:!0,helperText:"When to pick up the order"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"Pickup Location",placeholder:"e.g., 123 Main St, Building A, Loading Dock",value:a?.pickup_location||"",onChange:be=>{a&&o({...a,pickup_location:be.target.value})},fullWidth:!0,helperText:"Where to pick up the order"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"Contact Person",placeholder:"e.g., John Smith, Warehouse Manager",value:a?.pickup_contact_person||"",onChange:be=>{a&&o({...a,pickup_contact_person:be.target.value})},fullWidth:!0,helperText:"Name of person to contact at pickup location"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"Contact Phone",placeholder:"e.g., (555) 123-4567",value:a?.pickup_phone||"",onChange:be=>{a&&o({...a,pickup_phone:be.target.value})},fullWidth:!0,helperText:"Phone number for pickup contact person"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{label:"Pickup Instructions",placeholder:"e.g., Use loading dock on east side, call 15 minutes before arrival, parking available in lot B",value:a?.pickup_instructions||"",onChange:be=>{a&&o({...a,pickup_instructions:be.target.value})},fullWidth:!0,multiline:!0,rows:3,helperText:"Special instructions for pickup (parking, loading dock, etc.)"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{label:"Pickup Notes",placeholder:"e.g., After-hours pickup available, bring ID, parts are in warehouse section C",value:a?.pickup_notes||"",onChange:be=>{a&&o({...a,pickup_notes:be.target.value})},fullWidth:!0,multiline:!0,rows:2,helperText:"General notes about pickup for drivers"})})]})}),i.jsx(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:3,mb:2},children:i.jsx(B,{variant:"h6",children:"Order Placement Tracking"})}),i.jsx(xt,{sx:{p:3,mb:3},elevation:3,children:i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx("input",{type:"checkbox",checked:a?.order_placed||!1,onChange:be=>{a&&o({...a,order_placed:be.target.checked,order_placed_at:be.target.checked?new Date().toISOString():void 0,order_placed_by:be.target.checked?Number(r?.id):void 0,order_placed_method:be.target.checked?"manual":void 0})},style:{transform:"scale(1.5)"}}),i.jsxs(J,{children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:"bold"},children:"Order Placed with Vendor"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:a?.order_placed?`Placed on ${new Date(a.order_placed_at||"").toLocaleDateString()}`:"Order not yet placed"})]})]})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsxs(Ae,{select:!0,label:"Vendor Confirmation Status",value:a?.vendor_confirmation_status||"pending",onChange:be=>{a&&o({...a,vendor_confirmation_status:be.target.value,vendor_confirmation_date:be.target.value!=="pending"?new Date().toISOString():void 0})},fullWidth:!0,helperText:"Current vendor confirmation status",children:[i.jsx(tr,{value:"pending",children:"Pending"}),i.jsx(tr,{value:"confirmed",children:"Confirmed"}),i.jsx(tr,{value:"partial",children:"Partially Available"}),i.jsx(tr,{value:"unavailable",children:"Unavailable"})]})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{label:"Vendor Confirmation Notes",placeholder:"e.g., Parts available, pricing confirmed, minimum order 10ft packs",value:a?.vendor_confirmation_notes||"",onChange:be=>{a&&o({...a,vendor_confirmation_notes:be.target.value})},fullWidth:!0,multiline:!0,rows:2,helperText:"Notes from vendor about order confirmation, availability, and pricing"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx("input",{type:"checkbox",checked:a?.pricing_updated||!1,onChange:be=>{a&&o({...a,pricing_updated:be.target.checked,pricing_updated_at:be.target.checked?new Date().toISOString():void 0,pricing_updated_by:be.target.checked?Number(r?.id):void 0,pricing_updated_method:be.target.checked?"manual":void 0})},style:{transform:"scale(1.5)"}}),i.jsxs(J,{children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:"bold"},children:"Pricing Updated"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:a?.pricing_updated?`Updated on ${new Date(a.pricing_updated_at||"").toLocaleDateString()}`:"Pricing not yet updated"})]})]})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx("input",{type:"checkbox",checked:a?.quantity_adjusted||!1,onChange:be=>{a&&o({...a,quantity_adjusted:be.target.checked,quantity_adjusted_at:be.target.checked?new Date().toISOString():void 0,quantity_adjusted_by:be.target.checked?Number(r?.id):void 0,quantity_adjusted_method:be.target.checked?"manual":void 0})},style:{transform:"scale(1.5)"}}),i.jsxs(J,{children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:"bold"},children:"Quantities Adjusted"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:a?.quantity_adjusted?`Adjusted on ${new Date(a.quantity_adjusted_at||"").toLocaleDateString()}`:"Quantities not yet adjusted"})]})]})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{label:"Vendor Pricing Structure Notes",placeholder:"e.g., Sold by 10ft packs, minimum order 50ft, bulk pricing available over 100ft",value:a?.vendor_pricing_notes||"",onChange:be=>{a&&o({...a,vendor_pricing_notes:be.target.value})},fullWidth:!0,multiline:!0,rows:2,helperText:"Notes about vendor pricing structure, minimum orders, and packaging units"})}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx(J,{sx:{display:"flex",justifyContent:"center",mt:2},children:i.jsx(ye,{variant:"outlined",color:"primary",onClick:io,disabled:!a||b.length===0,sx:{minWidth:"200px"},children:"Adjust Quantities (Vendor Confirmation)"})}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",mt:1},children:"Use this when vendor confirms different quantities (e.g., sold by 10ft packs)"})]}),(a?.original_quantities||a?.adjusted_quantities)&&i.jsxs(ie,{item:!0,xs:12,children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:"bold",mb:2},children:"Quantity Adjustments"}),i.jsx(ie,{container:!0,spacing:2,children:b.map((be,we)=>{const Te=a?.original_quantities?.[we]||be.quantity,De=a?.adjusted_quantities?.[we]||be.quantity;return Te!==De?i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsxs(xt,{sx:{p:2,backgroundColor:"#f5f5f5"},elevation:1,children:[i.jsx(B,{variant:"body2",sx:{fontWeight:"bold"},children:be.part_number}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Original: ",Te,"  Adjusted: ",De]})]})},we):null})})]})]})}),i.jsx(tc,{open:We,onClose:Pl,onSave:async be=>{try{const we=await ve.post("/api/inventory",be);console.log("New part added successfully:",we.data);const Te=await ve.get("/api/inventory");ae(Te.data);const De=we.data.item;Nt!==null&&_(Ie=>{const pt=[...Ie];return pt[Nt]={...pt[Nt],part_number:De.part_number,part_description:De.part_description,unit:De.unit,unit_cost:String(De.last_unit_cost),quantity:pt[Nt].quantity},pt[Nt].line_amount=mr(pt[Nt]),pt}),Pl()}catch(we){throw we}},title:$e==="ocr"?"Add New Part from OCR":"Add New Part",initialPart:Tr??{part_number:Vt.toUpperCase(),category:"Uncategorized"}}),i.jsx(n6,{open:Fs,onClose:()=>{Ai(!1),oi({})},onSave:async be=>{try{const Te=(await ve.post("/api/vendors",be)).data.vendor;F(De=>[...De,{label:Te.vendor_name,id:Te.vendor_id,email:Te.email}]),l({label:Te.vendor_name,id:Te.vendor_id,email:Te.email}),!n&&a&&o(De=>De&&{...De,vendor_id:Te.vendor_id,vendor_name:Te.vendor_name}),Ai(!1),oi({}),ge.success("Vendor added successfully!")}catch{ge.error("Failed to add vendor.")}},initialVendor:Ko,isEditMode:!1}),i.jsx(Nde,{open:Si,onClose:()=>oo(!1),purchaseOrderId:a?.purchase_id||0,onSuccess:ra,onAllocationSaved:On}),i.jsx(iR,{open:pi,onClose:()=>Oo(!1),type:"purchase-order",recordId:a?.purchase_id,defaultTo:$i,allowMessageEdit:!0}),pi&&i.jsxs("div",{style:{display:"none"},children:["Debug: vendorEmail = ",$i,", vendor = ",JSON.stringify(s)]})]})]}),i.jsx(pl,{open:!!Yn,autoHideDuration:6e3,onClose:()=>Mn(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>Mn(null),severity:"success",sx:{width:"100%"},children:Yn})})]})},Rde=()=>{const e=Nn(),[t,r]=y.useState([]),[n,a]=y.useState({totalReceivables:0,totalOverdue:0}),[o,s]=y.useState(!1),[l,c]=y.useState(!0),[u,d]=y.useState(0),f=y.useRef(0),h=200,[p,g]=y.useState([]),[m,x]=y.useState(null),[b,_]=y.useState(""),[w,A]=y.useState(null),[O,T]=y.useState(!1),[E,S]=y.useState(!1),[I,z]=y.useState(""),[k,M]=y.useState("unpaid"),[R,F]=y.useState(()=>{const Ge=new Date;return`${Ge.getFullYear()}-${String(Ge.getMonth()+1).padStart(2,"0")}`}),[W,K]=y.useState(!1),[Z,D]=y.useState(!1),P=y.useRef(null),$=y.useRef(null),Q="invoices.columnVisibility",[C,L]=y.useState(()=>{if(typeof window>"u")return{};const Ge=localStorage.getItem(Q);if(Ge)try{return JSON.parse(Ge)}catch{}return{}}),[H,U]=y.useState(null),[te,le]=y.useState([]);y.useEffect(()=>{typeof window<"u"&&localStorage.setItem(Q,JSON.stringify(C))},[C]),y.useEffect(()=>{(async()=>{try{const Ge=await hS();g(Ge.map(Je=>({id:Je.customer_id||Je.id,label:Je.customer_name})))}catch(Ge){console.error("Failed to load customers",Ge)}})()},[]),y.useEffect(()=>{(async()=>{if(!m?.id){A(null);return}try{const Je=await e6(String(m.id));A(Je)}catch(Je){console.error("Failed to load customer detail",Je),A(null)}})()},[m?.id]);const oe=(Ge,Je)=>{le(Je),U(Ge.currentTarget)},ae=()=>U(null),he=y.useMemo(()=>{if(k!=="all")return k==="paid"?"Paid":"Unpaid"},[k]),me=y.useCallback(async(Ge=!1)=>{const Je=Ge?0:f.current;Ge&&(f.current=0,d(0),c(!0)),s(!0);try{const We=await mE({customer_id:m?.id,status:he,limit:h,offset:Je}),_t=We.invoices.map(kt=>({...kt,id:kt.invoice_id}));r(kt=>Ge?_t:[...kt,..._t]),a(We.summary);const Nt=Je+_t.length;f.current=Nt,d(Nt),c(We.hasMore??_t.length===h)}catch(We){console.error("Failed to load invoices",We),Ge&&(r([]),d(0)),c(!1),a({totalReceivables:0,totalOverdue:0})}finally{s(!1)}},[m?.id,he]),X=y.useCallback(async()=>{s(!0);try{const Ge=await mE({customer_id:m?.id,status:he}),Je=Ge.invoices.map(We=>({...We,id:We.invoice_id}));r(Je),a(Ge.summary),f.current=Je.length,d(Je.length),c(!1)}catch(Ge){console.error("Failed to load all invoices",Ge),ge.error("Failed to load all invoices")}finally{s(!1)}},[m?.id,he]);y.useEffect(()=>{me(!0)},[me,m?.id,he]);const G=Ge=>{e(`/invoices/${Ge.row.invoice_id}`)},ee=y.useCallback(async Ge=>{if(Ge&&window.confirm("Delete this invoice? This cannot be undone."))try{await Cae(Ge),ge.success("Invoice deleted."),me(!0)}catch(Je){console.error("Failed to delete invoice",Je),ge.error("Failed to delete invoice.")}},[me]),se=y.useMemo(()=>{const Ge=[{field:"invoice_number",headerName:"Invoice #",flex:1,minWidth:140},{field:"customer_name",headerName:"Customer",flex:1.2,minWidth:160},{field:"sales_order_number",headerName:"SO #",minWidth:140,flex:1},{field:"product_name",headerName:"Product",minWidth:140,flex:1.1},{field:"product_description",headerName:"Product Description",minWidth:200,flex:1.5},{field:"vin_number",headerName:"VIN #",minWidth:120},{field:"unit_number",headerName:"Unit #",minWidth:120},{field:"mileage",headerName:"Mileage",minWidth:110},{field:"vehicle_make",headerName:"Make",minWidth:120},{field:"vehicle_model",headerName:"Model",minWidth:120},{field:"invoice_date",headerName:"Invoice Date",minWidth:130,valueFormatter:We=>We.value?new Date(We.value).toLocaleDateString():""},{field:"due_in",headerName:"Due In",minWidth:140,renderCell:We=>{const _t=We.row.due_date?new Date(We.row.due_date):null;if(!_t)return"";const Nt=new Date,kt=_t.getTime()-Nt.getTime(),Vt=Math.round(kt/(1e3*60*60*24)),jt=Vt<0,Tr=`${Vt} day${Math.abs(Vt)===1?"":"s"}`;return i.jsxs(ct,{direction:"row",spacing:1,alignItems:"center",children:[i.jsx(B,{color:jt?"error":"success.main",fontWeight:600,children:Tr}),jt&&i.jsx(GL,{color:"error",fontSize:"small"})]})},valueGetter:We=>We.row.due_date||null},{field:"status",headerName:"Status",minWidth:120,renderCell:We=>i.jsx(ot,{label:We.value,color:We.value==="Paid"?"success":"default",size:"small"})},{field:"total_amount",headerName:"Total",minWidth:120,valueFormatter:We=>Va(Number(We.value)||0)}],Je={field:"actions",headerName:"Actions",type:"actions",width:90,getActions:We=>String(We.row.status||"").toLowerCase()!=="unpaid"?[]:[i.jsx(k8,{icon:i.jsx(ua,{color:"error"}),label:"Delete",onClick:_t=>{_t.stopPropagation(),ee(We.row.invoice_id)},showInMenu:!1},"delete")]};return[...Ge,Je]},[ee]),V=y.useMemo(()=>{const Ge=I.toLowerCase();return t.filter(Je=>[Je.invoice_number,Je.sales_order_number,Je.customer_name,Je.product_name,Je.product_description,Je.vin_number,Je.unit_number,Je.mileage,Je.vehicle_make,Je.vehicle_model,Je.invoice_date?new Date(Je.invoice_date).toLocaleDateString():"",Je.due_date?new Date(Je.due_date).toLocaleDateString():""].filter(We=>We!=null).some(We=>We.toString().toLowerCase().includes(Ge)))},[t,I]),He=y.useMemo(()=>t.filter(Ge=>{const Je=Ge.due_date?new Date(Ge.due_date):null;return Ge.status==="Unpaid"&&Je&&Je<new Date}).length,[t]),Ne=async()=>{if(!R){ge.error("Select a month for the statement.");return}try{const Ge=await Pae({month:R,customer_id:m?.id}),Je=new Blob([Ge.data],{type:"application/pdf"}),We=window.URL.createObjectURL(Je),_t=document.createElement("a");_t.href=We;const Nt=m?.label?m.label.replace(/\s+/g,"_"):"all-customers";_t.download=`statement-${Nt}-${R}.pdf`,_t.click(),window.URL.revokeObjectURL(We),ge.success("Statement downloaded.")}catch(Ge){console.error("Error downloading statements",Ge),ge.error("Failed to download statement.")}},Re=async()=>{try{const Ge=await Oae(),Je=new Blob([Ge.data],{type:"text/csv"}),We=window.URL.createObjectURL(Je),_t=document.createElement("a");_t.href=We,_t.download="invoice_import_template.csv",_t.click(),window.URL.revokeObjectURL(We),ge.success("Template downloaded.")}catch(Ge){console.error("Error downloading template",Ge),ge.error("Failed to download template.")}},Ke=()=>{P.current?.click()},nt=()=>{$.current?.click()},st=async Ge=>{const Je=Ge.target.files?.[0];if(Je){K(!0);try{const We=await kae(Je);ge.success(`Upload complete. Created: ${We.summary?.invoicesCreated??0}, skipped: ${We.summary?.invoicesSkipped??0}`),We.warnings?.length&&console.warn("Invoice CSV upload warnings:",We.warnings),me(!0)}catch(We){console.error("Error uploading invoice CSV",We);const _t=We?.response?.data?.error||"Failed to upload CSV",Nt=We?.response?.data?.errors?.[0];ge.error(Nt?`${_t}: ${Nt}`:_t)}finally{K(!1),P.current&&(P.current.value="")}}},gt=async Ge=>{const Je=Ge.target.files?.[0];if(Je){D(!0);try{const We=await Tae(Je),_t=We.summary?.updated??0,Nt=We.summary?.missingInvoices??We.missingInvoices?.length??0;ge.success(`Unit upload complete. Updated: ${_t}${Nt?`, missing invoices: ${Nt}`:""}`),We.warnings?.length&&console.warn("Invoice unit CSV warnings:",We.warnings),me(!0)}catch(We){console.error("Error uploading invoice unit CSV",We);const _t=We?.response?.data?.error||"Failed to upload unit CSV",Nt=We?.response?.data?.warnings?.[0];ge.error(Nt?`${_t}: ${Nt}`:_t)}finally{D(!1),$.current&&($.current.value="")}}};return i.jsxs(ir,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(ct,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},mb:3,children:[i.jsx(B,{variant:"h4",children:"Invoices"}),i.jsxs(ct,{direction:"row",spacing:1,children:[i.jsx(ye,{startIcon:i.jsx(Hw,{}),variant:"outlined",onClick:Ge=>oe(Ge,se),children:"Columns"}),i.jsx(ye,{startIcon:i.jsx(Es,{}),variant:"outlined",onClick:()=>me(!0),children:"Refresh"}),i.jsx(ye,{startIcon:i.jsx(da,{}),variant:"outlined",onClick:Re,children:"Download Template"}),i.jsx(ye,{startIcon:i.jsx(Cd,{}),variant:"outlined",color:"secondary",onClick:nt,disabled:Z,children:Z?"Uploading units...":"Upload Unit CSV"}),i.jsx(ye,{startIcon:i.jsx(Cd,{}),variant:"outlined",color:"secondary",onClick:Ke,disabled:W,children:W?"Uploading...":"Upload CSV"}),i.jsx(ye,{startIcon:i.jsx(Ba,{}),variant:"contained",onClick:()=>e("/invoices/new"),children:"New Invoice"}),i.jsx(ye,{startIcon:i.jsx(da,{}),variant:"outlined",onClick:Ne,children:"Download Statement"})]})]}),i.jsx("input",{type:"file",accept:".csv,text/csv",ref:P,style:{display:"none"},onChange:st}),i.jsx("input",{type:"file",accept:".csv,text/csv",ref:$,style:{display:"none"},onChange:gt}),i.jsx(xt,{sx:{mb:3,p:2,border:"1px solid",borderColor:"divider"},children:i.jsxs(ct,{direction:{xs:"column",sm:"row"},spacing:3,alignItems:"flex-start",children:[i.jsxs(J,{children:[i.jsxs(B,{variant:"h6",sx:{fontWeight:"bold",color:"primary.main"},children:["Total Receivables: ",Va(n.totalReceivables)]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Total value of all unpaid invoices"})]}),i.jsxs(J,{children:[i.jsx(B,{variant:"subtitle1",children:"Overdue"}),i.jsx(B,{variant:"h6",color:n.totalOverdue>0?"error":"inherit",children:Va(n.totalOverdue)})]}),i.jsxs(J,{children:[i.jsx(B,{variant:"subtitle1",children:"Overdue Count"}),i.jsx(B,{variant:"h6",children:He})]})]})}),i.jsx(xt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(J,{sx:{p:2},children:[i.jsxs(ct,{direction:"row",spacing:3,sx:{mb:2},flexWrap:"wrap",children:[i.jsx(Ae,{label:"Search",variant:"outlined",value:I,onChange:Ge=>z(Ge.target.value),InputProps:{startAdornment:i.jsx(oa,{position:"start",children:i.jsx(hi,{sx:{fontSize:22}})})},sx:{minWidth:300,maxWidth:380,"& .MuiInputBase-input":{fontSize:18,py:1.5},"& .MuiInputLabel-root":{fontSize:16}},size:"small"}),i.jsx(Ae,{label:"Statement Month",type:"month",value:R,onChange:Ge=>F(Ge.target.value),size:"small",sx:{minWidth:170},InputLabelProps:{shrink:!0}}),i.jsx(Fa,{options:p,getOptionLabel:Ge=>Ge.label,value:m,inputValue:b,onInputChange:(Ge,Je)=>_(Je),onChange:(Ge,Je)=>x(Je),renderInput:Ge=>i.jsx(Ae,{...Ge,label:"Customer (optional)",size:"small",placeholder:"Choose customer or leave empty for all",sx:{minWidth:260}}),clearOnBlur:!1}),i.jsx(ot,{label:"All",onClick:()=>M("all"),color:k==="all"?"primary":"default",sx:{fontSize:16,px:3,py:1,minWidth:80,height:40}}),i.jsx(ot,{label:"Unpaid",onClick:()=>M("unpaid"),color:k==="unpaid"?"primary":"default",sx:{fontSize:16,px:3,py:1,minWidth:90,height:40}}),i.jsx(ot,{label:"Paid",onClick:()=>M("paid"),color:k==="paid"?"primary":"default",sx:{fontSize:16,px:3,py:1,minWidth:80,height:40}}),i.jsx(J,{sx:{flexGrow:1}})]}),w&&i.jsx(xt,{variant:"outlined",sx:{p:2,mb:2,backgroundColor:"#fafafa",borderColor:"divider"},children:i.jsxs(ct,{direction:{xs:"column",md:"row"},spacing:2,justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},children:[i.jsxs(J,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:1.5,flex:1},children:[i.jsxs(J,{children:[i.jsx(B,{variant:"caption",color:"text.secondary",children:"Email"}),i.jsx(B,{variant:"body1",children:w.email||""})]}),i.jsxs(J,{children:[i.jsx(B,{variant:"caption",color:"text.secondary",children:"Phone"}),i.jsx(B,{variant:"body1",children:w.phone||w.phone_number||""})]}),i.jsxs(J,{children:[i.jsx(B,{variant:"caption",color:"text.secondary",children:"Payment Terms"}),i.jsx(B,{variant:"body1",children:w.default_payment_terms_in_days!=null?`${w.default_payment_terms_in_days} days`:""})]}),i.jsxs(J,{sx:{gridColumn:"1 / -1"},children:[i.jsx(B,{variant:"caption",color:"text.secondary",children:"General Notes"}),i.jsx(B,{variant:"body1",sx:{whiteSpace:"pre-wrap"},children:w.general_notes||""})]})]}),i.jsx(ye,{variant:"outlined",onClick:()=>{T(!0)},children:"Edit Customer"})]})}),i.jsx(Po,{rows:V,columns:se,loading:o,density:"comfortable",onRowClick:G,columnVisibilityModel:C,onColumnVisibilityModelChange:Ge=>L(Ge),getRowClassName:Ge=>{const Je=Ge.row.due_date?new Date(Ge.row.due_date):null;return Ge.row.status==="Unpaid"&&Je&&Je<new Date?"overdue-row":""},initialState:{sorting:{sortModel:[{field:"invoice_number",sort:"desc"}]}},sx:{"& .overdue-row":{backgroundColor:"#fff5f5"},"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.05rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}}),i.jsxs(J,{sx:{mt:2,display:"flex",justifyContent:"center",gap:2,flexWrap:"wrap"},children:[i.jsx(ye,{variant:"outlined",onClick:()=>me(!1),disabled:o||!l,children:o?"Loading...":l?"Load More":"No more invoices"}),i.jsx(ye,{variant:"contained",onClick:X,disabled:o,children:o?"Loading...":"Load All"})]})]})}),i.jsx(Nv,{open:!!H,anchorEl:H,onClose:ae,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:i.jsxs(J,{sx:{p:2,maxWidth:320},children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1.5},children:"Show / Hide Columns"}),i.jsx(Ep,{children:te.map(Ge=>i.jsx(ri,{control:i.jsx(Xi,{size:"small",checked:C[Ge.field]!==!1,onChange:Je=>L(We=>({...We,[Ge.field]:Je.target.checked}))}),label:Ge.headerName||Ge.field},Ge.field))})]})}),i.jsx(Wd,{open:O,onClose:()=>T(!1),isEditMode:!0,loading:E,initialCustomer:w?{customer_id:String(w.customer_id??w.id),customer_name:w.customer_name,contact_person:w.contact_person||"",email:w.email||"",phone_number:w.phone||w.phone_number||"",street_address:w.street_address||w.address||"",city:w.city||"",province:w.province||w.state||"",country:w.country||"",postal_code:w.postal_code||"",default_payment_terms_in_days:w.default_payment_terms_in_days,website:w.website||"",general_notes:w.general_notes||""}:void 0,onSave:async Ge=>{if(!w)return;S(!0);const Je=Number(w.customer_id??w.id);try{const We=await pS(String(Je),Ge);A(We),g(_t=>_t.map(Nt=>Nt.id===Je?{...Nt,label:We.customer_name}:Nt)),m&&x({...m,label:We.customer_name}),me(!0),ge.success("Customer updated"),T(!1)}catch(We){console.error("Failed to update customer",We);const _t=We?.response?.data?.error||"Failed to update customer";ge.error(_t)}finally{S(!1)}}})]})},kv=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim().toUpperCase(),qde=(e,t,r=8)=>{const n=kv(t||"");if(!n)return e.slice(0,r);const a=e.map(o=>{const s=kv(o.label);let l=-1;return s.startsWith(n)?l=3:s.split(" ").some(c=>c.startsWith(n))?l=2:s.includes(n)&&(l=1),{opt:o,score:l}}).filter(o=>o.score>=0);return a.sort((o,s)=>s.score-o.score||o.opt.label.localeCompare(s.opt.label)),a.slice(0,r).map(o=>o.opt)},N2=()=>({part_id:null,part_number:"",part_description:"",quantity:1,unit:"",unit_price:0,line_amount:0}),Fde=()=>{const{id:e}=Ms(),t=e==="new",r=Nn(),[n,a]=y.useState({status:"Unpaid",product_name:"",product_description:"",vin_number:"",unit_number:"",vehicle_make:"",vehicle_model:"",source_sales_order_number:"",mileage:"",tech_story:""}),[o,s]=y.useState([N2()]),[l,c]=y.useState([]),[u,d]=y.useState([]),[f,h]=y.useState(null),[p,g]=y.useState(null),[m,x]=y.useState([]),[b,_]=y.useState(null),[w,A]=y.useState(""),[O,T]=y.useState(!1),E=y.useRef(!1),[S,I]=y.useState(!1),[z,k]=y.useState(""),[M,R]=y.useState(Rt()),[F,W]=y.useState(Rt().add(30,"day")),[K,Z]=y.useState(!1),[D,P]=y.useState(!t),[$,Q]=y.useState(!1),[C,L]=y.useState(null),[H,U]=y.useState(!1),te="invoiceDetail.fieldVisibility",le={...kd.invoices},[oe,ae]=y.useState(()=>{if(typeof window>"u")return le;const Se=localStorage.getItem(te);if(Se)try{return{...le,...JSON.parse(Se)}}catch{}return le}),[he,me]=y.useState(le),[X,G]=y.useState(null),[ee,se]=y.useState([]),[V,He]=y.useState(!1),Ne=y.useRef(null),Re=y.useMemo(()=>{const Se=o.reduce((Ct,Bt)=>Ct+(Number(Bt.line_amount)||0),0),Ve=Math.round(Se*.05*100)/100,it=Math.round((Se+Ve)*100)/100;return{subtotal:Se,gst:Ve,total:it}},[o]),Ke=y.useCallback(async()=>{if(!E.current){E.current=!0,T(!0);try{const Ve=(await hS()).map(it=>({id:it.customer_id||it.id,label:it.customer_name,defaultTerms:Number(it.default_payment_terms_in_days)||30}));x(Ve)}catch(Se){console.error("Failed to load customers",Se)}finally{E.current=!1,T(!1)}}},[]),nt=y.useCallback(async Se=>{if(!Se){se([]),Ne.current=null;return}if(!(Ne.current===Se&&ee.length)){Ne.current=Se,He(!0);try{const it=[...(await fR(Se)).records||[]].sort((Ct,Bt)=>{const Ht=Ct.activity_date?new Date(Ct.activity_date).getTime():0;return(Bt.activity_date?new Date(Bt.activity_date).getTime():0)-Ht});se(it)}catch(Ve){console.error("Failed to load vehicle history for customer",Ve),se([])}finally{He(!1)}}},[ee.length]);y.useEffect(()=>{Ke()},[Ke]),y.useEffect(()=>{(async()=>{try{const[Se,Ve,it,Ct]=await Promise.all([ve.get("/api/inventory"),ve.get("/api/margin-schedule"),ve.get("/api/settings/labour-charge-rate").catch(()=>({data:{labour_charge_rate:null}})),ve.get("/api/settings/overhead-charge-rate").catch(()=>({data:{overhead_charge_rate:null}}))]);c(Se.data||[]),d(Ve.data||[]),h(it.data?.labour_charge_rate??null),g(Ct.data?.overhead_charge_rate??null)}catch(Se){console.error("Failed to load inventory or margin schedule for invoices",Se)}})()},[]),y.useEffect(()=>{typeof window<"u"&&localStorage.setItem(te,JSON.stringify(oe))},[oe]),y.useEffect(()=>{(async()=>{try{const Se=await Av.fetchSettings();me(Se.invoices),ae(Ve=>{const it={...Ve};let Ct=!1;return Object.keys(Se.invoices).forEach(Bt=>{!Se.invoices[Bt]&&it[Bt]&&(it[Bt]=!1,Ct=!0)}),Ct?it:Ve})}catch(Se){console.warn("Failed to load invoice field visibility defaults; using saved preferences",Se)}})()},[]),y.useEffect(()=>{const Se=b?.id??n.customer_id??null;nt(Se?Number(Se):null)},[b?.id,n.customer_id,nt]);const st=y.useMemo(()=>{const Se={...le};return Object.keys(Se).forEach(Ve=>{Se[Ve]=!!(he[Ve]&&oe[Ve])}),Se},[he,oe]),{units:gt,vins:Ge,unitToVins:Je,vinToUnits:We}=y.useMemo(()=>hR(ee),[ee]),_t=y.useMemo(()=>{const Se=Pv(n.unit_number);return Se&&Je[Se]?Je[Se]:Ge},[n.unit_number,Je,Ge]),Nt=y.useMemo(()=>{const Se=Pv(n.vin_number);return Se&&We[Se]?We[Se]:gt},[n.vin_number,gt,We]),kt=async Se=>{try{const Ve=await ve.get(`/api/sales-orders/${Se}`),it=Ve.data?.salesOrder||Ve.data;if(!it)return;a(Ct=>({...Ct,product_name:Ct.product_name||it.product_name||"",product_description:Ct.product_description||it.product_description||"",vin_number:Ct.vin_number||it.vin_number||"",unit_number:Ct.unit_number||it.unit_number||"",vehicle_make:Ct.vehicle_make||it.vehicle_make||"",vehicle_model:Ct.vehicle_model||it.vehicle_model||"",mileage:Ct.mileage??it.mileage??"",notes:Ct.notes||it.terms||"",tech_story:Ct.tech_story||it.tech_story||""}))}catch(Ve){console.warn("Failed to pull sales order defaults for invoice",Ve)}};y.useEffect(()=>{!t&&e&&(async()=>{P(!0);try{const Se=await wae(e),Ve=Se.invoice,it=(Se.lineItems||[]).map(Bt=>({invoice_line_item_id:Bt.invoice_line_item_id,part_id:Bt.part_id??null,part_number:Bt.part_number||"",part_description:Bt.part_description||"",quantity:Number(Bt.quantity)||0,unit:Bt.unit||"",unit_price:Number(Bt.unit_price)||0,line_amount:Number(Bt.line_amount)||Math.round(Number(Bt.quantity)*Number(Bt.unit_price)*100)/100}));a({...Ve,tech_story:Ve.tech_story||""}),s(it.length?it:[N2()]);const Ct=Ve.customer_id?{id:Ve.customer_id,label:Ve.customer_name||`Customer ${Ve.customer_id}`,defaultTerms:Number(Ve.payment_terms_in_days)||Number(Ve.default_payment_terms_in_days)||30}:null;_(Ct||null),A(Ct?.label||""),R(Ve.invoice_date?Rt(Ve.invoice_date):Rt()),W(Ve.due_date?Rt(Ve.due_date):Rt().add(Ct?.defaultTerms||30,"day")),Ve.sales_order_id&&kt(Ve.sales_order_id)}catch(Se){console.error("Failed to load invoice",Se),L("Failed to load invoice")}finally{P(!1)}})()},[e,t]),y.useEffect(()=>{if(!m.length||!n.customer_id)return;const Se=m.find(Ve=>Ve.id===n.customer_id);Se&&(_(Se),A(Se.label))},[m,n.customer_id]),y.useEffect(()=>{t&&!K&&M&&b?.defaultTerms&&W(M.add(b.defaultTerms,"day"))},[b,M,K,t]);const Vt=y.useCallback(Se=>{const Ve=(Se||"").trim().toUpperCase();return l.find(it=>String(it.part_number||"").trim().toUpperCase()===Ve)},[l]),jt=y.useCallback((Se,Ve)=>{const it=u.filter(mr=>mr.product_id===(Ve??null)),Ct=u.filter(mr=>mr.product_id==null),Bt=mr=>{const an=[...mr].sort((Be,tt)=>Number(Be.cost_lower_bound??0)-Number(tt.cost_lower_bound??0));for(const Be of an){const tt=Number(Be.cost_lower_bound??0),At=Be.cost_upper_bound==null?null:Number(Be.cost_upper_bound),Gt=Number(Be.margin_factor??1);if(Se>=tt&&(At===null||Se<At))return Number.isFinite(Gt)&&Gt>0?Gt:1}return 1},Ht=it.length?Bt(it):1;return Ht!==1?Ht:Bt(it.length?it:Ct)},[u]),Tr=y.useCallback((Se,Ve)=>{const it=(Se||"").trim().toUpperCase();if(it==="LABOUR"||it==="LABOR"||it==="OVERHEAD"||it==="SUPPLY")return!0;const Ct=(Ve||"").toLowerCase();return Ct==="labour"||Ct==="labor"||Ct==="overhead"||Ct==="supply"},[]),qe=y.useCallback((Se,Ve)=>{const it=Ve??(Se.part_number?Vt(Se.part_number):null);if(!it||Tr(Se.part_number,it.part_type))return{...Se,part_id:it?.part_id??Se.part_id??null};const Ct=Number(it.last_unit_cost??0);if(!Number.isFinite(Ct)||Ct<=0)return{...Se,part_id:it.part_id??Se.part_id??null,part_description:Se.part_description||it.part_description||"",unit:Se.unit||it.unit||""};const Bt=jt(Ct,it.part_id??null),Ht=Math.round(Ct*Bt*100)/100,mr=Number(Se.quantity??0),an=Math.round(Ht*mr*100)/100;return{...Se,part_id:it.part_id??Se.part_id??null,part_number:it.part_number??Se.part_number,part_description:Se.part_description||it.part_description||"",unit:Se.unit||it.unit||"",unit_price:Ht,line_amount:mr?an:Se.line_amount}},[Vt,jt,Tr]);y.useEffect(()=>{t&&l.length&&s(Se=>Se.map(Ve=>{const it=Ve.part_number?Vt(Ve.part_number):null;return!it||Ve.unit_price&&Ve.unit_price>0&&Ve.part_id?Ve:qe(Ve,it)}))},[qe,Vt,l,t]);const $e=(Se,Ve,it)=>{s(Ct=>{const Bt=[...Ct],Ht={...Bt[Se]};if(Ve==="part_number"){const mr=String(it||"").trim();Ht.part_number=mr,Ht.part_id=null;const an=mr.toUpperCase();if(!mr)Ht.part_description="",Ht.unit="",Ht.unit_price=0,Ht.line_amount=0;else if(an==="LABOUR"||an==="LABOR"){const Be=f??0;Ht.unit=Ht.unit||"hr",Ht.unit_price=Be;const tt=Number(Ht.quantity)||0;Ht.line_amount=Math.round(tt*Be*100)/100}else if(an==="OVERHEAD"){const Be=p??0;Ht.unit=Ht.unit||"hr",Ht.unit_price=Be;const tt=Number(Ht.quantity)||0;Ht.line_amount=Math.round(tt*Be*100)/100}else{const Be=Vt(mr);if(Be){const tt=qe({...Ht,part_number:mr},Be);return Bt[Se]=tt,Bt}!Ht.part_description&&!Ht.unit_price&&(Ht.part_description="",Ht.unit_price=0,Ht.line_amount=0)}}else if(Ve==="quantity"||Ve==="unit_price"){const mr=Number(it);Ht[Ve]=Number.isFinite(mr)?mr:0,Ht.line_amount=Math.round(Number(Ht.quantity)*Number(Ht.unit_price)*100)/100}else if(Ve==="line_amount"){const mr=Number(it);Ht.line_amount=Number.isFinite(mr)?mr:0}else Ht[Ve]=it;return Bt[Se]=Ht,Bt})},Xe=()=>G(null),Ue=()=>s(Se=>[...Se,N2()]),ht=Se=>s(Ve=>Ve.filter((it,Ct)=>Ct!==Se)),at=y.useMemo(()=>l.map(Se=>({part_number:Se.part_number,part_description:Se.part_description})),[l]),wt=y.useMemo(()=>{const Se={};for(const Ve of l||[])Ve?.part_number&&(Se[String(Ve.part_number)]=Ve.part_description||"");return Se},[l]),Tt=y.useCallback((Se,Ve)=>{const it=(Ve.inputValue||"").toUpperCase(),Ct=[];for(const Bt of Se){const Ht=String(Bt).toUpperCase(),mr=(wt[Bt]||"").toUpperCase();if((!it||Ht.includes(it)||mr.includes(it))&&(Ct.push(Bt),Ct.length>=50))break}return it&&!Ct.some(Bt=>Bt.toUpperCase()===it)&&Ct.push(Ve.inputValue),Ct},[wt]),Jt=async()=>{if(!b&&!n.customer_id){ge.error("Please select a customer");return}const Se={customer_id:b?.id??n.customer_id,invoice_date:M?M.toISOString():void 0,due_date:F?F.toISOString():void 0,status:n.status||"Unpaid",payment_terms_in_days:n.payment_terms_in_days??b?.defaultTerms,notes:n.notes,tech_story:n.tech_story??null,sales_order_id:n.sales_order_id??null,source_sales_order_number:n.source_sales_order_number??null,product_name:n.product_name??"",product_description:n.product_description??"",vin_number:n.vin_number??"",unit_number:n.unit_number??"",vehicle_make:n.vehicle_make??"",vehicle_model:n.vehicle_model??"",mileage:n.mileage===""||n.mileage===null||n.mileage===void 0?null:Number(n.mileage),line_items:o.map(Ve=>({invoice_line_item_id:Ve.invoice_line_item_id,part_id:Ve.part_id,part_number:Ve.part_number,part_description:Ve.part_description,quantity:Number(Ve.quantity)||0,unit:Ve.unit,unit_price:Number(Ve.unit_price)||0,line_amount:Number(Ve.line_amount)||Math.round(Number(Ve.quantity)*Number(Ve.unit_price)*100)/100}))};Q(!0);try{if(t){const Ve=await jae(Se);ge.success("Invoice created"),r(`/invoices/${Ve.invoice_id}`)}else await Sae(n.invoice_id,Se),ge.success("Invoice updated")}catch(Ve){console.error("Failed to save invoice",Ve),ge.error("Failed to save invoice")}finally{Q(!1)}},Dr=async()=>{if(!(t||!n.invoice_id)){U(!0);try{const Se=await ve.get(`/api/invoices/${n.invoice_id}/pdf`,{responseType:"blob"}),Ve=window.URL.createObjectURL(new Blob([Se.data],{type:"application/pdf"})),it=document.createElement("a");it.href=Ve,it.download=`${n.invoice_number||"invoice"}.pdf`,document.body.appendChild(it),it.click(),it.remove(),window.URL.revokeObjectURL(Ve)}catch(Se){console.error("Failed to download invoice PDF",Se),ge.error("Failed to download invoice PDF")}finally{U(!1)}}},qr=y.useCallback((Se,Ve)=>{const it={};if(Se!==void 0&&(it.unit_number=Se),Ve!==void 0&&(it.vin_number=Ve),ee.length&&(Se||Ve||n.unit_number||n.vin_number)){const Ct=pR(ee,Se??n.unit_number,Ve??n.vin_number);Ct.unit_number&&(it.unit_number=Ct.unit_number),Ct.vin_number&&(it.vin_number=Ct.vin_number),Ct.vehicle_make&&(it.vehicle_make=Ct.vehicle_make),Ct.vehicle_model&&(it.vehicle_model=Ct.vehicle_model);const Bt=Ct.mileage;if(Bt!=null&&String(Bt)!==""){const Ht=Number(Bt);it.mileage=Number.isFinite(Ht)?Ht:Bt}}a(Ct=>({...Ct,...it}))},[n.unit_number,n.vin_number,ee]);if(D)return i.jsx(ir,{maxWidth:"md",sx:{mt:6,textAlign:"center"},children:i.jsx(B,{children:"Loading invoice..."})});if(C)return i.jsxs(ir,{maxWidth:"md",sx:{mt:6,textAlign:"center"},children:[i.jsx(B,{color:"error",children:C}),i.jsx(ye,{variant:"outlined",sx:{mt:2},onClick:()=>r("/invoices"),children:"Back to Invoices"})]});const ar=n.status==="Unpaid"&&F&&F.isBefore(Rt(),"day"),Er={p:3,mb:3,border:"1px solid",borderColor:"divider",borderRadius:2,boxShadow:"0 8px 24px rgba(0,0,0,0.06)"},Ir={display:"grid",gap:2,gridAutoFlow:"row dense",alignItems:"stretch"},rn={...Ir,gridTemplateColumns:{xs:"1fr",sm:"repeat(2, minmax(0, 1fr))",md:"2fr 1fr 1fr"}},Ta={...Ir,gridTemplateColumns:{xs:"repeat(auto-fit, minmax(200px, 1fr))",md:"repeat(auto-fit, minmax(180px, 1fr))",lg:"repeat(auto-fit, minmax(160px, 1fr))"}},Dn={...Ir,gridTemplateColumns:{xs:"1fr",sm:"repeat(2, minmax(0, 1fr))",md:"repeat(3, minmax(0, 1fr))"}},rr=!!(b?.id||n.customer_id),Kr=i.jsx(Fa,{options:m,value:b,inputValue:w,onInputChange:(Se,Ve)=>A(Ve),loading:O,onFocus:Ke,onChange:(Se,Ve)=>{if(!Ve){_(null),a(Ct=>({...Ct,customer_id:null}));return}if(typeof Ve=="object"&&Ve.isNew){const Ct=Ve.inputValue||w||"";k(Ct),I(!0);return}const it=typeof Ve=="string"?m.find(Ct=>Ct.label===Ve)||null:Ve;_(it),A(it?.label||""),it?.id&&a(Ct=>({...Ct,customer_id:it.id}))},getOptionLabel:Se=>typeof Se=="string"?Se:Se.label,isOptionEqualToValue:(Se,Ve)=>Se.id===Ve.id,filterOptions:(Se,Ve)=>{const it=(Ve.inputValue||"").trim(),Ct=qde(Se,it,10),Bt=Se.some(mr=>kv(mr.label)===kv(it)),Ht=[...Ct];return it&&!Bt&&Ht.push({label:`Add "${Ve.inputValue}"`,isNew:!0,id:-1}),Ht},renderInput:Se=>i.jsx(Ae,{...Se,label:"Customer",fullWidth:!0})}),Yn=rr?i.jsx(Fa,{freeSolo:!0,options:_t,loading:V,value:n.vin_number||"",onInputChange:(Se,Ve)=>a(it=>({...it,vin_number:Ve})),onChange:(Se,Ve,it)=>{if(it==="clear"){a(Bt=>({...Bt,vin_number:""}));return}qr(void 0,typeof Ve=="string"?Ve:Ve??"")},renderInput:Se=>i.jsx(Ae,{...Se,label:"VIN #",fullWidth:!0})}):i.jsx(Ae,{label:"VIN #",value:n.vin_number||"",onChange:Se=>a(Ve=>({...Ve,vin_number:Se.target.value})),fullWidth:!0}),Mn=rr?i.jsx(Fa,{freeSolo:!0,options:Nt,loading:V,value:n.unit_number||"",onInputChange:(Se,Ve)=>a(it=>({...it,unit_number:Ve})),onChange:(Se,Ve,it)=>{if(it==="clear"){a(Bt=>({...Bt,unit_number:""}));return}qr(typeof Ve=="string"?Ve:Ve??"",void 0)},renderInput:Se=>i.jsx(Ae,{...Se,label:"Unit #",fullWidth:!0})}):i.jsx(Ae,{label:"Unit #",value:n.unit_number||"",onChange:Se=>a(Ve=>({...Ve,unit_number:Se.target.value})),fullWidth:!0}),Qr=[st.vin!==!1?{key:"vin",element:Yn}:null,st.unitNumber!==!1?{key:"unitNumber",element:Mn}:null,st.vehicleMake!==!1?{key:"vehicleMake",element:i.jsx(Ae,{label:"Make",value:n.vehicle_make||"",onChange:Se=>a(Ve=>({...Ve,vehicle_make:Se.target.value})),fullWidth:!0})}:null,st.vehicleModel!==!1?{key:"vehicleModel",element:i.jsx(Ae,{label:"Model",value:n.vehicle_model||"",onChange:Se=>a(Ve=>({...Ve,vehicle_model:Se.target.value})),fullWidth:!0})}:null,st.mileage!==!1?{key:"mileage",element:i.jsx(Ae,{label:"Mileage",type:"number",value:n.mileage??"",onChange:Se=>a(Ve=>({...Ve,mileage:Se.target.value===""?"":Number(Se.target.value)})),fullWidth:!0,inputProps:{step:1,min:0}})}:null].filter(Boolean),nn=[{key:"invoiceDate",element:i.jsx(os,{label:"Invoice Date",value:M,onChange:Se=>R(Se),slotProps:{textField:{fullWidth:!0}}})},{key:"dueDate",element:i.jsx(os,{label:"Due Date",value:F,onChange:Se=>{W(Se),Z(!0)},slotProps:{textField:{fullWidth:!0}}})}];return i.jsxs(i.Fragment,{children:[i.jsx(Os,{dateAdapter:oc,children:i.jsxs(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:[i.jsxs(J,{children:[i.jsx(B,{variant:"h4",children:t?"New Invoice":`Invoice ${n.invoice_number||""}`}),n.source_sales_order_number&&i.jsxs(ct,{direction:"row",spacing:1,alignItems:"center",sx:{mt:1},children:[i.jsx(B,{variant:"body1",children:"Source Sales Order:"}),i.jsx(ye,{variant:"text",size:"small",startIcon:i.jsx(Cv,{}),onClick:()=>r(`/open-sales-orders/${n.sales_order_id}`),children:n.source_sales_order_number})]})]}),i.jsxs(ct,{direction:"row",spacing:1,children:[ar&&i.jsx(ot,{color:"error",label:"Overdue"}),i.jsx(ot,{color:n.status==="Paid"?"success":"default",label:n.status||"Unpaid",onClick:()=>a(Se=>({...Se,status:Se.status==="Paid"?"Unpaid":"Paid"}))}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Cv,{}),onClick:Dr,disabled:H||t,children:H?"Downloading...":"Download PDF"}),i.jsx(ye,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:Jt,disabled:$,children:$?"Saving...":"Save"}),i.jsx(ye,{variant:"outlined",onClick:Se=>G(Se.currentTarget),children:"Customize Fields"})]})]}),i.jsxs(xt,{sx:Er,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Customer Information"}),i.jsx(J,{sx:rn,children:i.jsx(J,{children:Kr})})]}),i.jsxs(xt,{sx:Er,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Vehicle Details"}),i.jsx(J,{sx:Ta,children:Qr.map(Se=>i.jsx(J,{children:Se.element},Se.key))})]}),i.jsxs(xt,{sx:Er,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Job & Schedule"}),i.jsx(J,{sx:{...Dn,mb:2},children:nn.map(Se=>i.jsx(J,{children:Se.element},Se.key))}),i.jsxs(J,{sx:{display:"grid",gap:2},children:[i.jsx(Ae,{label:"Product",value:n.product_name||"",onChange:Se=>a(Ve=>({...Ve,product_name:Se.target.value})),fullWidth:!0}),st.productDescription!==!1&&i.jsx(Ae,{label:"Product Description",value:n.product_description||"",onChange:Se=>a(Ve=>({...Ve,product_description:Se.target.value})),fullWidth:!0,multiline:!0,minRows:2}),st.techStory!==!1&&i.jsx(Ae,{label:"Tech Story",value:n.tech_story||"",onChange:Se=>a(Ve=>({...Ve,tech_story:Se.target.value})),fullWidth:!0,multiline:!0,minRows:4,placeholder:"Technician notes carried from the sales order"})]})]}),i.jsxs(xt,{sx:Er,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Invoice Terms"}),i.jsx(Ae,{label:"Invoice Terms",multiline:!0,minRows:2,fullWidth:!0,value:n.notes||"",onChange:Se=>a(Ve=>({...Ve,notes:Se.target.value}))})]}),i.jsx(Nv,{open:!!X,anchorEl:X,onClose:Xe,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:i.jsxs(J,{sx:{p:2,minWidth:220},children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1.5},children:"Show / Hide Fields"}),i.jsx(Ep,{children:[{key:"vin",label:"VIN #"},{key:"productDescription",label:"Product Description"},{key:"unitNumber",label:"Unit #"},{key:"mileage",label:"Mileage"},{key:"vehicleMake",label:"Make"},{key:"vehicleModel",label:"Model"},{key:"techStory",label:"Tech Story"}].filter(({key:Se})=>he[Se]).map(({key:Se,label:Ve})=>i.jsx(ri,{control:i.jsx(Xi,{size:"small",checked:!!oe[Se],onChange:it=>ae(Ct=>({...Ct,[Se]:it.target.checked}))}),label:Ve},Se))})]})}),i.jsx(B,{variant:"h6",sx:{mt:2,mb:.5},children:"Line Items"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Each part number can only appear once. Edit existing line items to change quantities."}),i.jsxs(xt,{sx:{p:3,mb:3},elevation:3,children:[i.jsx(ie,{container:!0,spacing:2,children:o.map((Se,Ve)=>i.jsxs(Ce.Fragment,{children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:2.5,children:i.jsx(Fa,{freeSolo:!0,autoHighlight:!0,options:at.map(it=>it.part_number),value:Se.part_number||"",onInputChange:(it,Ct)=>$e(Ve,"part_number",Ct),onChange:(it,Ct)=>$e(Ve,"part_number",Ct||""),filterOptions:Tt,renderOption:(it,Ct)=>{const Bt=wt[Ct]||"",{key:Ht,...mr}=it;return i.jsx("li",{...mr,children:i.jsxs(J,{children:[i.jsx(B,{variant:"body2",children:Ct}),Bt?i.jsx(B,{variant:"caption",color:"text.secondary",children:Bt}):null]})},Ht)},renderInput:it=>i.jsx(Ae,{...it,label:"Part Number *",fullWidth:!0})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3.5,children:i.jsx(Ae,{label:"Part Description *",value:Se.part_description,onChange:it=>$e(Ve,"part_description",it.target.value),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Ae,{label:"Qty",type:"number",value:Se.quantity,onChange:it=>$e(Ve,"quantity",it.target.value),fullWidth:!0,inputProps:{step:.01}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Ae,{label:"Unit",value:Se.unit,onChange:it=>$e(Ve,"unit",it.target.value),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Ae,{label:"Unit Price",type:"number",value:Se.unit_price,onChange:it=>$e(Ve,"unit_price",it.target.value),fullWidth:!0,InputProps:{startAdornment:i.jsx(oa,{position:"start",children:"$"})}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Ae,{label:"Amount",type:"number",value:Se.line_amount,onChange:it=>$e(Ve,"line_amount",it.target.value),fullWidth:!0,InputProps:{startAdornment:i.jsx(oa,{position:"start",children:"$"})}})}),i.jsx(ie,{item:!0,xs:12,sm:3,md:1,sx:{display:"flex",alignItems:"center"},children:i.jsx(ye,{variant:"outlined",color:"primary",onClick:()=>ht(Ve),fullWidth:!0,children:"Remove"})})]},Ve))}),i.jsx(J,{sx:{mt:2},children:i.jsx(ye,{variant:"outlined",color:"primary",onClick:Ue,startIcon:i.jsx(Ba,{}),children:"Add Line Item"})})]}),i.jsx(xt,{sx:{p:3,mb:3},elevation:3,children:i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Subtotal: ",Va(Re.subtotal)]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Total GST: ",Va(Re.gst)]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"h6",children:["Total Amount: ",Va(Re.total)]})})]})}),i.jsx(Gn,{sx:{my:3}}),i.jsxs(ct,{direction:"row",spacing:2,children:[i.jsx(ye,{variant:"outlined",onClick:()=>r("/invoices"),children:"Back to Invoices"}),i.jsx(ye,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:Jt,disabled:$,children:$?"Saving...":"Save Invoice"})]})]})}),i.jsx(Wd,{open:S,onClose:()=>I(!1),onSave:async Se=>{try{const Ve=await ve.post("/api/customers",Se),it={id:Ve.data.customer_id,label:Se.customer_name,defaultTerms:Number(Ve.data.default_payment_terms_in_days)||30};x(Ct=>[...Ct,it]),_(it),A(it.label),a(Ct=>({...Ct,customer_id:it.id})),I(!1),ge.success("Customer added successfully!")}catch{ge.error("Failed to add customer.")}},initialCustomer:{customer_name:z},isEditMode:!1})]})};var sh={},z4;function $de(){if(z4)return sh;z4=1;var e=cr();Object.defineProperty(sh,"__esModule",{value:!0}),sh.default=void 0;var t=e(dr()),r=ur();return sh.default=(0,t.default)((0,r.jsx)("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorder"),sh}var Bde=$de();const Ude=It(Bde);var lh={},W4;function zde(){if(W4)return lh;W4=1;var e=cr();Object.defineProperty(lh,"__esModule",{value:!0}),lh.default=void 0;var t=e(dr()),r=ur();return lh.default=(0,t.default)((0,r.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),lh}var Wde=zde();const Hde=It(Wde);var ch={},H4;function Vde(){if(H4)return ch;H4=1;var e=cr();Object.defineProperty(ch,"__esModule",{value:!0}),ch.default=void 0;var t=e(dr()),r=ur();return ch.default=(0,t.default)((0,r.jsx)("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"}),"Mic"),ch}var Gde=Vde();const Yde=It(Gde);var uh={},V4;function Kde(){if(V4)return uh;V4=1;var e=cr();Object.defineProperty(uh,"__esModule",{value:!0}),uh.default=void 0;var t=e(dr()),r=ur();return uh.default=(0,t.default)((0,r.jsx)("path",{d:"M6 6h12v12H6z"}),"Stop"),uh}var Qde=Kde();const Xde=It(Qde);class Jde{mediaRecorder=null;audioChunks=[];isRecording=!1;stream=null;async startRecording(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});const t={mimeType:"audio/webm;codecs=opus",audioBitsPerSecond:16e3};MediaRecorder.isTypeSupported(t.mimeType)||delete t.mimeType,this.mediaRecorder=new MediaRecorder(this.stream,t),this.audioChunks=[],this.isRecording=!0,this.mediaRecorder.ondataavailable=r=>{r.data.size>0&&this.audioChunks.push(r.data)},this.mediaRecorder.start(1e3)}catch(t){throw console.error("Error starting voice recording:",t),new Error("Failed to start voice recording. Please check microphone permissions.")}}async stopRecording(){return new Promise((t,r)=>{if(!this.mediaRecorder||!this.isRecording){r(new Error("No active recording"));return}this.mediaRecorder.onstop=async()=>{try{this.isRecording=!1;const n=new Blob(this.audioChunks,{type:"audio/wav"}),a=await this.processAudioQuery(n);t(a)}catch(n){r(n)}finally{this.cleanup()}},this.mediaRecorder.stop()})}cleanup(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.mediaRecorder=null,this.audioChunks=[],this.isRecording=!1}async processAudioQuery(t){try{if(t.size>1048576)throw new Error(`Audio file too large (${(t.size/1024/1024).toFixed(2)}MB). Please record a shorter message.`);const n=await this.blobToBase64(t);return(await ve.post("/api/voice-search/search-parts",{audioData:n,audioFormat:t.type||"audio/webm"})).data}catch(r){throw console.error("Error processing voice query:",r),r instanceof Error?new Error(r.message):new Error("Failed to process voice query. Please try again.")}}blobToBase64(t){return new Promise((r,n)=>{const a=new FileReader;a.onload=()=>{const s=a.result.split(",")[1];r(s)},a.onerror=n,a.readAsDataURL(t)})}async interpretTextQuery(t){try{return(await ve.post("/api/voice-search/interpret-query",{query:t})).data}catch(r){return console.error("Error interpreting text query:",r),{query:t,searchInPartNumbers:!0,searchInDescriptions:!0,extractedTerms:[t]}}}isRecordingActive(){return this.isRecording}cancelRecording(){this.isRecording&&(this.mediaRecorder?.stop(),this.cleanup())}}const Zde=new Jde,efe=({onSearchTerms:e,disabled:t=!1})=>{const[r,n]=y.useState(!1),[a,o]=y.useState(!1),[s,l]=y.useState(""),c=y.useRef(null),u=y.useRef(null),d=()=>{const m=typeof window<"u"&&window.process&&window.process.type;if(typeof window<"u"&&"webkitSpeechRecognition"in window&&!c.current){const x=window.webkitSpeechRecognition||window.SpeechRecognition;c.current=new x,c.current.continuous=!1,c.current.interimResults=!0,c.current.lang="en-US",m&&console.log("Running in Electron environment"),c.current.onresult=b=>{let _="",w="";for(let A=b.resultIndex;A<b.results.length;A++){const O=b.results[A][0].transcript;b.results[A].isFinal?_+=O:w+=O}l(_+w),_.trim()&&p(_.trim())},c.current.onerror=b=>{console.error("Speech recognition error:",b.error),b.error==="network"?(typeof window<"u"&&window.process&&window.process.type?ge.error("Voice recognition network error in Electron. Please try again or use text search."):ge.error("Voice recognition requires internet connection. Please try again."),n(!1)):b.error==="not-allowed"?(ge.error("Microphone access denied. Please allow microphone access."),n(!1)):b.error==="no-speech"?(ge.info("No speech detected. Please try again."),n(!1)):b.error==="audio-capture"?(ge.error("Audio capture error. Please check your microphone."),n(!1)):b.error==="service-not-allowed"?(ge.error("Voice recognition service not allowed. This is common in Electron apps."),n(!1)):(console.error("Speech recognition error:",b.error),ge.error(`Voice recognition error: ${b.error}. Please try again.`),n(!1))},c.current.onend=()=>{n(!1),l("")}}},f=()=>{try{if(!(typeof window<"u"&&("webkitSpeechRecognition"in window||"SpeechRecognition"in window))){ge.error("Voice recognition not available in this browser.");return}typeof window<"u"&&window.process&&window.process.type&&ge.info("Voice recognition in Electron may have limitations. If it doesn't work, please use text search."),d(),c.current&&(n(!0),l(""),c.current.start(),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{r&&h()},8e3))}catch(m){console.error("Error starting voice recognition:",m),ge.error("Failed to start voice recognition."),n(!1)}},h=()=>{c.current&&c.current.stop(),n(!1),u.current&&clearTimeout(u.current)},p=async m=>{try{o(!0),l("");const x=await Zde.interpretTextQuery(m);e(x.extractedTerms,{searchInPartNumbers:x.searchInPartNumbers,searchInDescriptions:x.searchInDescriptions}),ge.success(`Voice search: "${m}"  ${x.extractedTerms.join(", ")}`)}catch(x){console.error("Error processing voice input:",x),ge.error("Failed to process voice input. Please try again.")}finally{o(!1)}},g=()=>{r?h():f()};return i.jsxs(J,{children:[i.jsx(ye,{variant:"contained",size:"large",onClick:g,disabled:t||a,startIcon:a?i.jsx(nr,{size:20,color:"inherit"}):r?i.jsx(Xde,{}):i.jsx(Yde,{}),sx:{backgroundColor:r?"error.main":"primary.main",color:"white","&:hover":{backgroundColor:r?"error.dark":"primary.dark"},minWidth:120,height:48},children:a?"Processing...":r?"Stop":"Voice Search"}),r&&i.jsxs(J,{display:"flex",alignItems:"center",gap:1,mt:1,children:[i.jsx(J,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:"error.main",animation:"pulse 1s infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.3},"100%":{opacity:1}}}}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:["Listening... ",s&&`"${s}"`]})]})]})},tfe="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),rfe="0123456789".split("");function mR(e,t,r){return`so:${t}:${e}:${r}`}function G4(e,t,r){try{const n=localStorage.getItem(mR(e,t,r));if(!n)return[];const a=JSON.parse(n);return Array.isArray(a)?a:[]}catch{return[]}}function Y4(e,t,r,n){try{localStorage.setItem(mR(e,t,r),JSON.stringify(n.slice(0,50)))}catch{}}function gR(){return"partFinder:usage:global"}function vR(e,t){return`partFinder:usage:so:${e}:${t}`}function nfe(){try{const e=localStorage.getItem(gR());return e?JSON.parse(e):{}}catch{return{}}}function afe(e){try{localStorage.setItem(gR(),JSON.stringify(e))}catch{}}function ife(e,t){try{const r=localStorage.getItem(vR(e,t));return r?JSON.parse(r):{}}catch{return{}}}function ofe(e,t,r){try{localStorage.setItem(vR(e,t),JSON.stringify(r))}catch{}}function sfe(e){const{open:t,onClose:r,onSelect:n,salesOrderId:a,context:o,inventoryItems:s}=e,[l,c]=y.useState(""),[u,d]=y.useState(""),[f,h]=y.useState([]),[p,g]=y.useState([]),[m,x]=y.useState([]),[b,_]=y.useState({}),[w,A]=y.useState({}),[O,T]=y.useState([]),[E,S]=y.useState(null);y.useEffect(()=>{t&&(g(G4("favorites",a,o)),x(G4("recents",a,o)),_(ife(a,o)),A(nfe()))},[t,a,o]);const I=y.useMemo(()=>{const D=l.toUpperCase(),P=new Set(f.map(C=>C.toUpperCase())),$=new Set(O.map(C=>C.toUpperCase())),Q=u.trim().toUpperCase();return s.filter(C=>{const L=(C.part_number||"").toUpperCase(),H=(C.part_description||"").toUpperCase();if(D&&!L.startsWith(D)||Q&&!(L.includes(Q)||H.includes(Q)))return!1;for(const U of P)if(!(L.includes(U)||H.includes(U)))return!1;if(O.length>0&&E){let U=!1;for(const te of $){if(E.searchInPartNumbers&&L.includes(te)){U=!0;break}if(E.searchInDescriptions&&H.includes(te)){U=!0;break}}if(!U)return!1}return!0})},[s,l,f,u,O,E]),z=y.useMemo(()=>{const D={},P=new Set(f.map(oe=>oe.toUpperCase())),$=new Set(p),Q=new Set(m),C={SS:"STAINLESS",STAIN:"STAINLESS",STAINLESS:"STAINLESS",AL:"ALUMINUM",ALUM:"ALUMINUM",GALV:"GALVANIZED",GALVANIZED:"GALVANIZED",SQ:"SQUARE",RECT:"RECTANGULAR",TUBE:"TUBING"},L=new Set(["TUBING","PIPE","ANGLE","BAR","FLAT","BEAM","CHANNEL","SHEET","PLATE","ROUND","SQUARE","RECTANGULAR"]),H=oe=>C[oe]||oe,U=(oe,ae)=>{const he=oe.trim();!he||P.has(he)||(D[he]=(D[he]||0)+ae)},te=oe=>{const[ae,he]=oe.split("/").map(Number);return!ae||!he?null:(ae/he).toFixed(4).replace(/0+$/,"").replace(/\.$/,"")},le=oe=>{const ae=[];if(!oe)return ae;const he=oe.toUpperCase().replace(/[\s-]+/g,"").replace(//g,"X").replace(/[()]/g,""),me=he.match(/\d+\/\d+/g)??[];if(he.includes("X")){const X=he.split("X");X.length>=2&&X.length<=4&&(ae.push(X.slice(0,2).join("X")),ae.push(X.join("X")))}return me.forEach(X=>{ae.push(X);const G=te(X);G&&ae.push(G)}),(he.match(/(\d+)GA/g)??[]).forEach(X=>ae.push(X)),(he.match(/SCH\s*\d+/g)??[]).forEach(X=>ae.push(X.replace(/\s+/g,""))),(he.match(/OD\d+(?:\.\d+)?/g)??[]).forEach(X=>ae.push(X)),(he.match(/ID\d+(?:\.\d+)?/g)??[]).forEach(X=>ae.push(X)),(he.match(/\d+(?:\.\d+)?/g)??[]).slice(0,3).forEach(X=>ae.push(X)),Array.from(new Set(ae))};for(const oe of I){const he=String(oe.part_description||"").toUpperCase().split(/[^A-Z0-9]+/).filter(Je=>Je.length>=2&&!P.has(Je)).map(H),me=b[oe.part_number]?.count||0,X=w[oe.part_number]?.count||0,G=b[oe.part_number]?.last||0,ee=Date.now(),se=G?(ee-G)/(1e3*60*60*24):365,V=se<=7?1:se<=30?.5:0;let He=1+me*.5+X*.25+V;$.has(oe.part_number)&&(He+=3),Q.has(oe.part_number)&&(He+=1);const Ne=u.trim().toUpperCase(),Re=(oe.part_number||"").toUpperCase(),Ke=(oe.part_description||"").toUpperCase(),nt=Ne&&(Re.startsWith(Ne)||Ke.includes(Ne))?.5:0,st=[];he.forEach(Je=>{L.has(Je)&&st.push(Je),U(Je,He*(1+nt+(Ne&&Je.includes(Ne)?.5:0)))});const gt=Array.from(new Set(he));gt.forEach(Je=>gt.forEach(We=>{Je!==We&&(L.has(Je)||L.has(We))&&U(`${Je} ${We}`,He*1.2)}));const Ge=le(Re);Ge.forEach(Je=>U(Je,He*1.3)),Ge[0]&&st.slice(0,2).forEach(Je=>U(`${Je} ${Ge[0]}`,He*1.5))}return Object.entries(D).sort((oe,ae)=>ae[1]-oe[1]).slice(0,24).map(([oe])=>oe)},[I,f,p,m,b,w,u]),k=I,M=y.useMemo(()=>k.slice(0,200),[k]),R=D=>{h(P=>P.includes(D)?P.filter($=>$!==D):[...P,D])},F=()=>{c(""),h([]),T([]),S(null)},W=D=>p.includes(D),K=D=>{g(P=>{const $=P.includes(D)?P.filter(Q=>Q!==D):[D,...P];Y4("favorites",a,o,$);try{fetch(`/api/part-finder/${a}/favorite`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({part_number:D,context:o,value:!P.includes(D)})}).catch(()=>{})}catch{}return $})},Z=D=>{x(P=>{const $=[D.part_number,...P.filter(Q=>Q!==D.part_number)].slice(0,20);return Y4("recents",a,o,$),$}),_(P=>{const $={...P},Q=$[D.part_number]||{count:0,last:0};return Q.count+=1,Q.last=Date.now(),$[D.part_number]=Q,ofe(a,o,$),$}),A(P=>{const $={...P},Q=$[D.part_number]||{count:0,last:0};return Q.count+=1,Q.last=Date.now(),$[D.part_number]=Q,afe($),$}),n(D);try{fetch(`/api/part-finder/${a}/use`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({part_number:D.part_number,context:o})}).catch(()=>{})}catch{}};return i.jsxs(gr,{open:t,onClose:r,maxWidth:"lg",fullWidth:!0,fullScreen:!1,"aria-labelledby":"part-finder-title",children:[i.jsx(vr,{id:"part-finder-title",children:"Find Part"}),i.jsxs(yr,{dividers:!0,children:[i.jsx(J,{mb:2,children:i.jsxs(J,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[i.jsx(Ae,{fullWidth:!0,placeholder:"Search by part # or description",value:u,onChange:D=>d(D.target.value),InputProps:{startAdornment:i.jsx(oa,{position:"start",children:i.jsx(hi,{})})}}),i.jsx(efe,{onSearchTerms:(D,P)=>{T(D),S(P)},disabled:!1})]})}),null,i.jsxs(J,{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",mb:2,children:[!!l&&i.jsx(ot,{label:`Prefix: ${l}`,color:"primary",onDelete:()=>c(""),sx:{height:40,borderRadius:2,"& .MuiChip-label":{px:2,py:1,fontSize:16,fontWeight:600}}}),f.map(D=>i.jsx(ot,{label:D,color:"secondary",onDelete:()=>R(D),sx:{height:38,borderRadius:2,"& .MuiChip-label":{px:2,py:1,fontSize:15,fontWeight:600}}},D)),O.length>0&&i.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:1},children:[i.jsx(B,{variant:"caption",color:"text.secondary",children:"Voice:"}),O.map(D=>i.jsx(ot,{label:D,color:"success",variant:"outlined",size:"small",sx:{height:32,"& .MuiChip-label":{px:1.5,py:.5,fontSize:12}}},D)),E&&i.jsxs(B,{variant:"caption",color:"text.secondary",sx:{ml:1},children:["(",E.searchInPartNumbers?"Part#":"",E.searchInPartNumbers&&E.searchInDescriptions?" + ":"",E.searchInDescriptions?"Desc":"",")"]})]}),(!!l||f.length>0||O.length>0)&&i.jsx(ye,{onClick:F,children:"Clear All"})]}),i.jsxs(J,{display:"flex",gap:2,mb:2,flexWrap:"wrap",children:[i.jsxs(J,{children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Part # Starts With"}),i.jsxs(J,{display:"flex",flexWrap:"wrap",gap:1.5,children:[tfe.map(D=>i.jsx(ot,{label:D,variant:l.startsWith(D)?"filled":"outlined",onClick:()=>c(D),sx:{height:44,borderRadius:2,"& .MuiChip-label":{px:2.25,py:1.25,fontSize:18,fontWeight:700}}},D)),rfe.map(D=>i.jsx(ot,{label:D,variant:l.startsWith(D)?"filled":"outlined",onClick:()=>c(D),sx:{height:44,borderRadius:2,"& .MuiChip-label":{px:2.25,py:1.25,fontSize:18,fontWeight:700}}},D))]})]}),i.jsxs(J,{children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Description Tokens"}),i.jsx(J,{display:"flex",flexWrap:"wrap",gap:1.5,children:z.map(D=>i.jsx(ot,{label:D,clickable:!0,color:f.includes(D)?"secondary":"default",onClick:()=>R(D),sx:{height:40,borderRadius:2,"& .MuiChip-label":{px:2,py:1,fontSize:16,fontWeight:600}}},D))})]})]}),i.jsx(Gn,{sx:{my:2}}),i.jsxs(J,{mb:2,children:[p.length>0&&i.jsxs(J,{mb:1,children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Favorites for this Sales Order"}),i.jsx(J,{display:"flex",flexWrap:"wrap",gap:1.25,children:p.map(D=>{const P=s.find($=>$.part_number===D);return P?i.jsx(ot,{label:`${P.part_number}`,onClick:()=>Z(P),title:P.part_description,sx:{height:38,borderRadius:2,"& .MuiChip-label":{px:2,py:1,fontSize:15,fontWeight:600}}},D):null})})]}),m.length>0&&i.jsxs(J,{children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Recents for this Sales Order"}),i.jsx(J,{display:"flex",flexWrap:"wrap",gap:1.25,children:m.map(D=>{const P=s.find($=>$.part_number===D);return P?i.jsx(ot,{variant:"outlined",label:`${P.part_number}`,onClick:()=>Z(P),title:P.part_description,sx:{height:38,borderRadius:2,"& .MuiChip-label":{px:2,py:1,fontSize:15,fontWeight:600}}},D):null})})]})]}),i.jsxs(ie,{container:!0,spacing:2,children:[M.map(D=>i.jsx(ie,{item:!0,xs:12,sm:6,md:4,lg:3,children:i.jsxs(J,{sx:{border:"1px solid #ddd",borderRadius:1,p:1.5,display:"flex",flexDirection:"column",gap:1,height:"100%"},children:[i.jsxs(J,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:700},children:D.part_number}),i.jsx(En,{title:W(D.part_number)?"Remove favorite":"Add favorite",children:i.jsx(pr,{size:"small",onClick:()=>K(D.part_number),children:W(D.part_number)?i.jsx(Hde,{color:"warning",fontSize:"small"}):i.jsx(Ude,{fontSize:"small"})})})]}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{minHeight:40},children:D.part_description||""}),i.jsxs(J,{mt:"auto",display:"flex",gap:1,children:[i.jsx(ye,{variant:"contained",size:"small",onClick:()=>Z(D),children:"Add"}),i.jsx(ye,{variant:"outlined",size:"small",onClick:()=>{Z(D)},children:"Add & Keep Open"})]})]})},D.part_number)),M.length===0&&i.jsx(ie,{item:!0,xs:12,children:i.jsx(B,{variant:"body2",color:"text.secondary",children:"No parts match the current filters."})})]})]}),i.jsx(Cr,{children:i.jsx(ye,{onClick:r,children:"Close"})})]})}const K4=["Each","cm","ft","ft^2","kg","pcs","hr","L"],D2=5,Q4=()=>{const{id:e}=Ms(),t=Nn(),r=!!e&&/^\d+$/.test(e);console.log("WokerSalesOrderPage: Component rendered with id:",e,"isNumericId:",r),y.useEffect(()=>(console.log("WokerSalesOrderPage: Component mounted"),()=>{console.log("WokerSalesOrderPage: Component unmounted")}),[]);const[n,a]=y.useState(null),[o,s]=y.useState(!0),[l,c]=y.useState(null),[u,d]=y.useState(null),[f,h]=y.useState([]),[p,g]=y.useState(null),[m,x]=y.useState(null),[b,_]=y.useState([]),[w,A]=y.useState([]),[O,T]=y.useState([]),[E,S]=y.useState([]),I=y.useRef(null),z=y.useRef(0);y.useLayoutEffect(()=>{const qe=I.current,$e=qe?qe.getBoundingClientRect().height:0,Xe=$e-z.current;Xe!==0&&(window.scrollBy({top:Xe,left:0,behavior:"auto"}),z.current=$e)},[O.length]);const[k,M]=y.useState(null),[R,F]=y.useState(null),[W,K]=y.useState(null),[Z,D]=y.useState(!1),[P,$]=y.useState(null),[Q,C]=y.useState(""),[L,H]=y.useState(!1),[U,te]=y.useState(null),[le,oe]=y.useState(""),[ae,he]=y.useState(!1),[me,X]=y.useState("line"),[G,ee]=y.useState(0),se=qe=>f.find($e=>$e.part_number===qe),V=(qe,$e)=>{const Xe=f.find(Dr=>Dr.part_number.toLowerCase()===qe.part_number.toLowerCase());if(!Xe||Xe.part_type==="supply")return null;const Ue=parseFloat(Xe.quantity_on_hand)||0,ht=b.filter(Dr=>Dr.part_number.toLowerCase()===qe.part_number.toLowerCase()).reduce((Dr,qr)=>Dr+(parseFloat(String(qr.quantity).replace(/[^\d.-]/g,""))||0),0),at=w.filter(Dr=>Dr.part_number.toLowerCase()===qe.part_number.toLowerCase()).reduce((Dr,qr)=>Dr+(parseFloat(String(qr.quantity).replace(/[^\d.-]/g,""))||0),0),wt=ht-at,Tt=Ue-wt,Jt=Tt<0?Math.floor(Tt):Math.round(Tt);return{available:Jt,isNegative:Jt<0,currentStock:Ue,changeInQuantity:wt,totalQuantityForPart:ht,totalOriginalQuantityForPart:at}},He=(qe,$e)=>{const Xe=b.filter(ht=>ht.part_number.toLowerCase()===qe.part_number.toLowerCase());if(Xe.length<=1)return!0;const Ue=Math.max(...Xe.map((ht,at)=>b.findIndex(wt=>wt.part_number.toLowerCase()===qe.part_number.toLowerCase()&&b.indexOf(wt)===at)));return $e===Ue},Ne=y.useMemo(()=>b.map(qe=>({part_number:qe.part_number,part_description:qe.part_description,quantity:bo(qe.quantity),unit:qe.unit,unit_price:bo(qe.unit_price)})),[b]),Re=y.useMemo(()=>Ne.reduce((qe,$e)=>qe+$u($e.quantity,$e.unit_price),0),[Ne]),Ke=y.useMemo(()=>Re*(D2/100),[Re]);y.useMemo(()=>Re+Ke,[Re,Ke]);const[nt,st]=y.useState("");y.useEffect(()=>{n&&st(JSON.stringify({lineItems:b,partsToOrder:E}))},[n]);const gt=!!nt&&nt!==JSON.stringify({lineItems:b,partsToOrder:E});y.useEffect(()=>{(async()=>{try{const[qe,$e,Xe]=await Promise.all([ve.get("/api/inventory"),ve.get("/api/settings/labour-rate").catch(()=>({data:{labour_rate:null}})),ve.get("/api/settings/overhead-rate").catch(()=>({data:{overhead_rate:null}}))]);h(qe.data),g($e.data.labour_rate??null),x(Xe.data.overhead_rate??null)}catch(qe){console.error("Prefetch failed",qe)}})()},[]),y.useEffect(()=>{if(console.log("WokerSalesOrderPage: useEffect triggered with id:",e,"isNumericId:",r),!e||!r){console.log("WokerSalesOrderPage: Invalid ID, setting error"),c("Invalid sales order ID."),s(!1);return}(async()=>{console.log("WokerSalesOrderPage: Fetching sales order data for ID:",e),s(!0),c(null);try{console.log("WokerSalesOrderPage: Making API call to /api/sales-orders/${id}");const qe=await ve.get(`/api/sales-orders/${e}`);if(console.log("WokerSalesOrderPage: API response received:",qe),console.log("WokerSalesOrderPage: API response data:",qe.data),!qe.data||!qe.data.salesOrder){console.error("WokerSalesOrderPage: No sales order data in response"),c("Invalid response format from server"),s(!1);return}const $e=qe.data.salesOrder;console.log("WokerSalesOrderPage: Parsed sales order:",$e),a({sales_order_id:$e.sales_order_id,sales_order_number:$e.sales_order_number,status:$e.status});const Xe=(qe.data.lineItems||$e?.line_items||[]).filter(ht=>!["LABOUR","OVERHEAD","SUPPLY"].includes(ht.part_number?.toUpperCase())).map(ht=>({line_item_id:ht.line_item_id,part_number:ht.part_number,part_description:ht.part_description,unit:ht.unit,unit_price:ht.unit_price,line_amount:ht.line_amount,quantity:String(ht.quantity_sold??ht.quantity??0),gst:D2,part_id:ht.part_id??void 0}));console.log("WokerSalesOrderPage: Loaded line items (filtered):",Xe),_(Xe),A(Xe);const Ue=(qe.data.partsToOrder||[]).map(ht=>({sales_order_id:$e.sales_order_id,part_number:ht.part_number,part_description:ht.part_description,quantity_to_order:String(ht.quantity_needed??ht.quantity_to_order??""),unit:ht.unit||"Each",unit_price:Number(ht.unit_price||0),line_amount:Number(ht.line_amount||0)}));console.log("WokerSalesOrderPage: Loaded parts to order:",Ue),S(Ue),console.log("WokerSalesOrderPage: Successfully loaded sales order data")}catch(qe){console.error("WokerSalesOrderPage: Error loading sales order:",qe),console.error("WokerSalesOrderPage: Error details:",{message:qe?.message,status:qe?.response?.status,statusText:qe?.response?.statusText,data:qe?.response?.data,url:qe?.config?.url}),c(qe?.response?.status===404?"Sales order not found. It may have been deleted.":"Failed to load sales order data. Please try again.")}finally{s(!1)}})()},[e,r]),y.useEffect(()=>{p!==null&&_(qe=>qe.map($e=>$e.part_number==="LABOUR"?{...$e,unit_price:p}:$e))},[p]),y.useEffect(()=>{m!==null&&_(qe=>qe.map($e=>$e.part_number==="OVERHEAD"?{...$e,unit_price:m}:$e))},[m]),y.useEffect(()=>{const qe=[];b.forEach(($e,Xe)=>{if(He($e,Xe)){const Ue=V($e);Ue&&Ue.available<0&&qe.push({lineItemIndex:Xe,partNumber:$e.part_number,partDescription:$e.part_description,excessQuantity:Math.abs(Ue.available),unit:$e.unit})}}),T(qe)},[b,f]);const Ge=(qe,$e)=>{_(Xe=>{const Ue=[...Xe];if(!$e||$e.trim()==="")Ue[qe]={...Ue[qe],part_number:"",part_description:"",quantity:"",unit:K4[0],unit_price:0,line_amount:0};else{const wt=se($e);if(wt){const Tt=parseFloat(String(wt.last_unit_cost))||0;Ue[qe]={...Ue[qe],part_number:$e,part_description:wt.part_description||"",unit:wt.unit||"Each",unit_price:Tt}}else Ue[qe]={...Ue[qe],part_number:$e,part_description:"Part not found",unit_price:0}}const ht=bo(Ue[qe].quantity),at=bo(Ue[qe].unit_price);return Ue[qe].line_amount=$u(ht,at),Ue})},Je=(qe,$e,Xe)=>{_(Ue=>{const ht=[...Ue],at={...ht[qe],[$e]:Xe};if(parseFloat(Xe)<=0)return ht.filter((Jt,Dr)=>Dr!==qe);const wt=bo(at.quantity),Tt=bo(at.unit_price);return at.line_amount=$u(wt,Tt),ht[qe]=at,ht})},We=()=>{_(qe=>[...qe,{part_number:"",part_description:"",quantity:"",unit:K4[0],unit_price:0,gst:D2,line_amount:0}])},_t=qe=>{_($e=>$e.filter((Xe,Ue)=>Ue!==qe))},Nt=()=>{if(b.filter(Ue=>!Ue.part_number||Ue.part_number.trim()==="").length>0)return ge.error("Line items with blank part numbers are not allowed."),!1;const $e=b.filter(Ue=>{if(["LABOUR","OVERHEAD","SUPPLY"].includes(String(Ue.part_number).toUpperCase()))return!1;const ht=Ue.part_id;if(ht){const wt=(f||[]).find(Tt=>Tt.part_id===ht);return wt?wt.part_type==="supply":!1}const at=(f||[]).find(wt=>String(wt.part_number).toUpperCase()===String(Ue.part_number).trim().toUpperCase());return!at||at.part_type==="supply"});if($e.length>0){const Ue=$e.map(ht=>ht.part_number).join(", ");return ge.error(`Invalid or supply parts (not allowed): ${Ue}`),!1}return b.some((Ue,ht)=>{if(!He(Ue,ht))return!1;const at=V(Ue);return at&&at.available<0})?(ge.error("Insufficient inventory for one or more parts."),!1):!0},kt=qe=>{const $e=qe.reduce((Xe,Ue)=>{const ht=Ue.part_number.trim().toLowerCase();if(!Xe[ht]){const wt=["LABOUR","OVERHEAD","SUPPLY"].includes(Ue.part_number.toUpperCase())?null:(f||[]).find(Tt=>String(Tt.part_number).toUpperCase()===Ue.part_number.trim().toUpperCase());Xe[ht]={part_number:Ue.part_number.trim(),part_description:Ue.part_description.trim(),unit:Ue.unit.trim(),unit_price:Ue.unit_price!=null?Number(Ue.unit_price):0,line_amount:0,quantity_sold:0,...Ue.part_id?{part_id:Ue.part_id}:wt&&wt.part_id?{part_id:wt.part_id}:{}}}const at=parseFloat(String(Ue.quantity).replace(/[^\d.-]/g,""))||0;return Xe[ht].quantity_sold+=Math.round(at),Xe[ht].line_amount+=at*(Ue.unit_price||0),Xe},{});return Object.values($e)},Vt=async()=>{if(n&&Nt())try{const qe={lineItems:kt(b),partsToOrder:E.filter($e=>$e.part_number&&parseFloat(String($e.quantity_to_order))>0).map($e=>({sales_order_id:n.sales_order_id,part_number:$e.part_number.trim(),part_description:$e.part_description.trim(),quantity_needed:parseFloat(String($e.quantity_to_order))||0,unit:$e.unit.trim(),unit_price:$e.unit_price,line_amount:$e.line_amount}))};await ve.put(`/api/sales-orders/${n.sales_order_id}`,qe),d("Sales Order updated successfully!"),st(JSON.stringify({lineItems:b,partsToOrder:E}));try{const $e=await ve.get("/api/inventory");h($e.data)}catch{}}catch(qe){const $e=qe?.response?.data?.error||qe?.response?.data?.details||qe?.response?.data?.message||"Failed to save sales order.";ge.error($e)}},jt=(qe,$e)=>{const Xe=(b[qe]?.part_number||"").trim(),Ue=$e.key==="Enter",ht=$e.key==="Tab",at=$e.key==="Escape",wt=$e.key==="ArrowDown"||$e.key==="ArrowUp";if(at){M(null);return}if(wt){$e.key==="ArrowDown"&&k!==qe&&M(qe);return}if(!(k===qe&&(Ue||ht))&&(Ue||ht)&&Xe){if(Ue&&$e.ctrlKey){$e.preventDefault(),C(Xe.toUpperCase()),$(qe),D(!0),M(null);return}!f.find(Jt=>Jt.part_number.toUpperCase()===Xe.toUpperCase())&&Ue&&($e.preventDefault(),C(Xe.toUpperCase()),$(qe),D(!0),M(null))}},Tr=(qe,$e)=>{const Xe=(E[qe]?.part_number||"").trim(),Ue=$e.key==="Enter",ht=$e.key==="Tab",at=$e.key==="Escape",wt=$e.key==="ArrowDown"||$e.key==="ArrowUp";if(at){F(null);return}if(wt){$e.key==="ArrowDown"&&R!==qe&&F(qe);return}if(!(R===qe&&(Ue||ht))&&(Ue||ht)&&Xe){if(Ue&&$e.ctrlKey){$e.preventDefault(),oe(Xe.toUpperCase()),te(qe),H(!0),F(null);return}!f.find(Jt=>Jt.part_number.toUpperCase()===Xe.toUpperCase())&&Ue&&($e.preventDefault(),oe(Xe.toUpperCase()),te(qe),H(!0),F(null))}};return o?i.jsxs(ir,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(nr,{}),i.jsx(B,{children:"Loading sales order..."})]}):l?i.jsxs(ir,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(Ot,{severity:"error",sx:{mb:2},children:l}),i.jsx(ye,{variant:"contained",onClick:()=>window.location.reload(),sx:{mr:2},children:"Retry"}),i.jsx(ye,{variant:"outlined",onClick:()=>t("/open-sales-orders"),children:"Back to Sales Orders"})]}):n?i.jsxs(Os,{dateAdapter:oc,children:[i.jsx(qy,{when:gt,onSave:Vt}),i.jsxs(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(J,{sx:{position:"relative",zIndex:1},children:[i.jsxs(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsxs(B,{variant:"h5",sx:{fontWeight:700},children:["Edit Lines & Parts to Order  SO ",n.sales_order_number||n.sales_order_id]}),i.jsx(ye,{variant:"contained",onClick:Vt,children:"Save Changes"})]}),i.jsx(B,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Line Items"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"You can add multiple line items with the same part number. They will be automatically merged on save."})]}),i.jsx(J,{ref:I,sx:{mb:O.length?2:0,display:O.length?"flex":"none",flexDirection:"column",gap:1},children:O.map((qe,$e)=>{const Xe=b[qe.lineItemIndex];return!Xe||!He(Xe,qe.lineItemIndex)?null:i.jsx(Ot,{severity:"warning",sx:{width:"100%",boxShadow:2,"& .MuiAlert-message":{width:"100%",padding:0}},children:i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{width:"100%"},children:[i.jsxs(J,{sx:{flex:1},children:[i.jsxs(B,{variant:"body2",fontWeight:"medium",children:["Insufficient stock for ",qe.partNumber]}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Excess quantity: ",qe.excessQuantity," ",qe.unit]})]}),i.jsxs(ye,{variant:"contained",size:"small",sx:{whiteSpace:"nowrap"},onClick:()=>{const Ue=qe.excessQuantity,ht=f.find(Tt=>Tt.part_number.toLowerCase()===Xe.part_number.toLowerCase()),at={sales_order_id:n.sales_order_id,part_number:Xe.part_number,part_description:Xe.part_description,quantity_to_order:String(Ue),unit:Xe.unit,unit_price:ht?.last_unit_cost||0,line_amount:(ht?.last_unit_cost||0)*Ue};S(Tt=>[...Tt,at]);const wt=Math.max(0,(parseFloat(String(Xe.quantity).replace(/[^\d.-]/g,""))||0)-Ue);_(Tt=>Tt.map((Jt,Dr)=>Dr===qe.lineItemIndex?{...Jt,quantity:String(wt)}:Jt)),T(Tt=>Tt.filter(Jt=>Jt.lineItemIndex!==qe.lineItemIndex)),ge.success(`Transferred ${Ue} ${Xe.unit} of ${Xe.part_number} to parts to order`)},children:["Transfer ",qe.excessQuantity," to Parts to Order"]})]})},`${qe.lineItemIndex}-${$e}`)})}),i.jsxs(xt,{sx:{p:3,mb:3},elevation:3,children:[i.jsx(ie,{container:!0,spacing:2,children:b.map((qe,$e)=>i.jsxs(Ce.Fragment,{children:[i.jsxs(ie,{item:!0,xs:12,sm:6,md:3.5,children:[i.jsx(Fa,{open:k===$e,onOpen:()=>M($e),onClose:()=>M(null),autoHighlight:!0,inputValue:qe.part_number,onChange:(Xe,Ue)=>{if(typeof Ue=="string")Ge($e,Ue),M(null);else if(Ue&&typeof Ue=="object"&&"isNew"in Ue){const ht=Ue.inputValue||"";C(String(ht).toUpperCase()),$($e),D(!0),M(null)}},onInputChange:(Xe,Ue,ht)=>{if(_(wt=>{const Tt=[...wt];return Tt[$e]={...Tt[$e],part_number:(Ue||"").toUpperCase()},Tt}),W&&window.clearTimeout(W),ht==="reset")return;if((Ue||"").trim().length>0){const wt=window.setTimeout(()=>M($e),200);K(wt)}else M(null)},options:f.filter(Xe=>Xe.part_type!=="supply").map(Xe=>Xe.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,filterOptions:(Xe,Ue)=>{const ht=(Ue.inputValue||"").toUpperCase(),at=Xe.filter(Jt=>{const Dr=f.find(qr=>qr.part_number===Jt);return Dr?String(Jt).toUpperCase().includes(ht)||String(Dr.part_description||"").toUpperCase().includes(ht):String(Jt).toUpperCase().includes(ht)}),wt=at.some(Jt=>String(Jt).toUpperCase()===ht),Tt=[...at];return ht&&!wt&&Tt.push({label:`Add "${Ue.inputValue}" as New Part`,isNew:!0,inputValue:Ue.inputValue}),Tt},renderOption:(Xe,Ue)=>{const ht=typeof Ue=="object"&&Ue.isNew,at=typeof Ue=="string"?Ue:Ue.label,{key:wt,...Tt}=Xe;return i.jsxs("li",{...Tt,children:[ht&&i.jsx(ec,{fontSize:"small",style:{marginRight:8,color:"#666"}}),typeof Ue=="string"?i.jsxs(J,{children:[i.jsx(B,{variant:"body2",children:Ue}),(()=>{const Jt=f.find(Dr=>Dr.part_number===Ue);return Jt?.part_description?i.jsx(B,{variant:"caption",color:"text.secondary",children:Jt.part_description}):null})()]}):at]},wt)},renderInput:Xe=>i.jsx(Ae,{...Xe,label:"Part Number",required:!0,fullWidth:!0,onKeyDown:Ue=>jt($e,Ue),onBlur:()=>M(null)}),onBlur:()=>{const Xe=b[$e]?.part_number?.trim().toUpperCase();if(!Xe)return;f.find(ht=>ht.part_number===Xe)?Ge($e,Xe):($($e),C(Xe),D(!0),M(null))}}),i.jsx(J,{mt:1,children:i.jsx(ye,{size:"small",variant:"outlined",onClick:()=>{X("line"),ee($e),he(!0)},children:"Find Part"})})]}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3.5,children:i.jsx(Ae,{label:"Part Description",value:qe.part_description,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Ae,{label:"Qty",value:qe.quantity,onChange:Xe=>Je($e,"quantity",Xe.target.value),type:"number",fullWidth:!0,required:!0,inputProps:{step:1,onWheel:Xe=>Xe.target.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Ae,{label:"Avail",value:(()=>{if(!He(qe,$e))return"N/A";const Xe=V(qe);return Xe?Xe.available<0?`${Xe.available} (Insufficient)`:String(Xe.available):"N/A"})(),fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:(()=>{if(!He(qe,$e))return"#f5f5f5";const Xe=V(qe);return Xe?Xe.available>=0?"#e8f5e8":"#ffeaea":"#f5f5f5"})(),"& .MuiInputBase-input":{color:He(qe,$e)?V(qe)?.isNegative?"#d32f2f":"#2e7d32":"#666"}}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Ae,{label:"Unit",value:qe.unit,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,sx:{display:"flex",alignItems:"stretch"},children:i.jsx(ye,{variant:"outlined",color:"primary",onClick:()=>_t($e),fullWidth:!0,sx:{height:"56px"},children:"Remove"})})]},$e))}),i.jsx(J,{sx:{mt:2},children:i.jsx(ye,{variant:"outlined",color:"primary",onClick:We,children:"Add Line Item"})})]}),i.jsxs(xt,{sx:{p:3,mb:3,border:"2px solid #b8860b","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#b8860b"},"&:hover fieldset":{borderColor:"#b8860b"}}},elevation:0,children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Parts to Order"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Add parts that need to be ordered for this sales order. These quantities are aggregated across all sales orders."}),i.jsx(ie,{container:!0,spacing:2,children:E.map((qe,$e)=>i.jsxs(Ce.Fragment,{children:[i.jsxs(ie,{item:!0,xs:12,sm:6,md:3.5,children:[i.jsx(Fa,{open:R===$e,onOpen:()=>F($e),onClose:()=>F(null),autoHighlight:!0,value:qe.part_number,onChange:(Xe,Ue)=>{if(!Ue){S(ht=>{const at=[...ht];return at[$e]={...at[$e],part_number:"",part_description:"",unit:"Each",unit_price:0,line_amount:0},at});return}if(typeof Ue=="string"){const ht=f.find(at=>at.part_number===Ue);if(ht){const wt=parseFloat(String(ht.last_unit_cost))||0;S(Tt=>{const Jt=[...Tt];return Jt[$e]={...Jt[$e],part_number:ht.part_number,part_description:ht.part_description,unit:ht.unit||"Each",unit_price:wt,line_amount:0},Jt})}else{S(wt=>{const Tt=[...wt];return Tt[$e]={...Tt[$e],part_number:Ue,part_description:"",unit:"Each",unit_price:0,line_amount:0},Tt});const at=String(Ue).toUpperCase();te($e),oe(at),H(!0)}}else if(Ue&&typeof Ue=="object"&&"isNew"in Ue){const ht=String(Ue.inputValue||"").toUpperCase();te($e),oe(ht),H(!0)}},onInputChange:(Xe,Ue,ht)=>{if(S(wt=>{const Tt=[...wt];return Tt[$e]={...Tt[$e],part_number:(Ue||"").toUpperCase()},Tt}),W&&window.clearTimeout(W),ht==="reset")return;if((Ue||"").trim().length>0){const wt=window.setTimeout(()=>F($e),200);K(wt)}else F(null)},options:f.filter(Xe=>Xe.part_type!=="supply").map(Xe=>Xe.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,filterOptions:(Xe,Ue)=>{const ht=(Ue.inputValue||"").toUpperCase(),at=Xe.filter(Jt=>{const Dr=f.find(qr=>qr.part_number===Jt);return Dr?String(Jt).toUpperCase().includes(ht)||String(Dr.part_description||"").toUpperCase().includes(ht):String(Jt).toUpperCase().includes(ht)}),wt=at.some(Jt=>String(Jt).toUpperCase()===ht),Tt=[...at];return ht&&!wt&&Tt.push({label:`Add "${Ue.inputValue}" as New Part`,isNew:!0,inputValue:Ue.inputValue}),Tt},renderOption:(Xe,Ue)=>{const ht=typeof Ue=="object"&&Ue.isNew,at=typeof Ue=="string"?Ue:Ue.label,{key:wt,...Tt}=Xe;return i.jsxs("li",{...Tt,children:[ht&&i.jsx(ec,{fontSize:"small",style:{marginRight:8,color:"#666"}}),typeof Ue=="string"?i.jsxs(J,{children:[i.jsx(B,{variant:"body2",children:Ue}),(()=>{const Jt=f.find(Dr=>Dr.part_number===Ue);return Jt?.part_description?i.jsx(B,{variant:"caption",color:"text.secondary",children:Jt.part_description}):null})()]}):at]},wt)},renderInput:Xe=>i.jsx(Ae,{...Xe,label:"Part Number",fullWidth:!0,required:!0,onKeyDown:Ue=>Tr($e,Ue),onBlur:()=>F(null)}),onBlur:()=>{const Xe=(E[$e]?.part_number||"").trim().toUpperCase();if(!Xe)return;f.find(ht=>ht.part_number===Xe)||(te($e),oe(Xe),H(!0),F(null))}}),i.jsx(J,{mt:1,children:i.jsx(ye,{size:"small",variant:"outlined",onClick:()=>{X("pto"),ee($e),he(!0)},children:"Find Part"})})]}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3.5,children:i.jsx(Ae,{label:"Description",value:qe.part_description,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#f5f5f5"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Ae,{label:"Qty to Order",value:qe.quantity_to_order,onChange:Xe=>{const Ue=Xe.target.value;S(ht=>{const at=[...ht],wt=parseFloat(Ue)||0,Tt=at[$e].unit_price||0;return at[$e]={...at[$e],quantity_to_order:Ue,line_amount:wt*Tt},at})},type:"number",fullWidth:!0,required:!0,inputProps:{step:1,min:0,onWheel:Xe=>Xe.target.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Ae,{label:"Unit",value:qe.unit,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),i.jsx(ie,{item:!0,xs:12,sm:1,md:1,sx:{display:"flex",alignItems:"stretch",gap:2},children:i.jsx(ye,{variant:"outlined",onClick:()=>S(Xe=>Xe.filter((Ue,ht)=>ht!==$e)),sx:{height:"56px",flexShrink:0,borderColor:"#b8860b",color:"#b8860b","&:hover":{borderColor:"#8b6914",backgroundColor:"#fff8dc"}},children:"Remove"})})]},$e))}),i.jsx(J,{sx:{mt:2},children:i.jsx(ye,{variant:"outlined",color:"primary",onClick:()=>S(qe=>[...qe,{sales_order_id:n.sales_order_id,part_number:"",part_description:"",quantity_to_order:"",unit:"Each",unit_price:0,line_amount:0}]),children:"Add Parts to Order Item"})})]}),i.jsxs(J,{display:"flex",justifyContent:"flex-end",gap:2,children:[i.jsx(ye,{variant:"outlined",onClick:()=>t(`/open-sales-orders/${n.sales_order_id}`),children:"Back to SO"}),i.jsx(ye,{variant:"contained",onClick:Vt,children:"Save Changes"})]}),i.jsx(pl,{open:!!u,autoHideDuration:6e3,onClose:()=>d(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>d(null),severity:"success",sx:{width:"100%"},children:u})})]}),i.jsx(tc,{open:Z,onClose:()=>{D(!1),$(null),C("")},onSave:async qe=>{const $e=await ve.post("/api/inventory",qe),Xe=await ve.get("/api/inventory");h(Xe.data);const Ue=$e.data.item;P!==null&&_(ht=>{const at=[...ht],Tt=parseFloat(String(Ue.last_unit_cost))||0;at[P]={...at[P],part_number:Ue.part_number,part_description:Ue.part_description,unit:Ue.unit||at[P].unit,unit_price:Tt};const Jt=bo(at[P].quantity);return at[P].line_amount=$u(Jt,Tt),at})},title:"Add New Part",initialPart:{part_number:Q.toUpperCase(),category:"Uncategorized"}}),i.jsx(sfe,{open:ae,onClose:()=>he(!1),onSelect:qe=>{if(n)if(me==="line"){const $e=G;_(Xe=>{const Ue=[...Xe];return Ue[$e]?(Ue[$e]={...Ue[$e],part_number:qe.part_number,part_description:qe.part_description},Ue):Xe})}else{const $e=G;S(Xe=>{const Ue=[...Xe];return Ue[$e]?(Ue[$e]={...Ue[$e],part_number:qe.part_number,part_description:qe.part_description},Ue):Xe})}},salesOrderId:n?.sales_order_id||0,context:me,inventoryItems:f.map(qe=>({part_number:qe.part_number,part_description:qe.part_description}))}),i.jsx(tc,{open:L,onClose:()=>{H(!1),te(null),oe("")},onSave:async qe=>{const $e=await ve.post("/api/inventory",qe),Xe=await ve.get("/api/inventory");h(Xe.data);const Ue=$e.data.item;U!==null&&S(ht=>{const at=[...ht],Tt=parseFloat(String(Ue.last_unit_cost))||0;at[U]={...at[U],part_number:Ue.part_number,part_description:Ue.part_description,unit:Ue.unit||"Each",unit_price:Tt};const Jt=parseFloat(String(at[U].quantity_to_order))||0;return at[U].line_amount=Jt*Tt,at})},title:"Add New Part",initialPart:{part_number:le.toUpperCase(),category:"Uncategorized"}})]}):null},Tv=e=>new Date(e.getTime()-e.getTimezoneOffset()*6e4).toISOString(),yR=()=>crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`;function Hc(e){if(e==null)return null;if(typeof e=="number")return Number.isNaN(e)?null:e;if(typeof e=="string"){const t=e.trim();if(!t)return null;const r=Number(t);if(!Number.isNaN(r))return r;const n=t.match(/^(-?)(\d+):(\d{2})(?::(\d{2})(?:\.\d+)?)?$/);if(n){const o=n[1]==="-"?-1:1,s=parseInt(n[2],10),l=parseInt(n[3],10),c=n[4]?parseInt(n[4],10):0;return Number.isNaN(s)||Number.isNaN(l)||Number.isNaN(c)?null:o*(s+l/60+c/3600)}const a=t.match(/^(-)?P?T?(?:(\d+(?:\.\d+)?)H)?(?:(\d+(?:\.\d+)?)M)?(?:(\d+(?:\.\d+)?)S)?$/i);if(a){const o=a[1]==="-"?-1:1,s=a[2]?parseFloat(a[2]):0,l=a[3]?parseFloat(a[3]):0,c=a[4]?parseFloat(a[4]):0;return[s,l,c].some(u=>Number.isNaN(u))?null:o*(s+l/60+c/3600)}}return null}function Ev(e,t=3){const r=Hc(e);return r!==null&&!Number.isNaN(r)?`${r.toFixed(t)} hrs`:"-"}const AS=async()=>{try{const e=await ve.get("/api/time-tracking/profiles");return localStorage.setItem("tt_profiles_cache",JSON.stringify(e.data)),e.data}catch{const t=localStorage.getItem("tt_profiles_cache");return t?JSON.parse(t):[]}},lfe=async(e,t,r)=>(await ve.post("/api/time-tracking/profiles",{name:e,email:t,phone_number:r})).data,cfe=async(e,t,r,n)=>(await ve.put(`/api/time-tracking/profiles/${e}`,{name:t,email:r,phone_number:n})).data,xR=async()=>{try{const e=await ve.get("/api/time-tracking/sales-orders");return localStorage.setItem("tt_sales_orders_cache",JSON.stringify(e.data)),e.data}catch{const t=localStorage.getItem("tt_sales_orders_cache");return t?JSON.parse(t):[]}},ufe=async(e,t)=>{const r={date:e};return t&&(r.profile_id=t),(await ve.get("/api/time-tracking/time-entries",{params:r})).data},dfe=async(e,t)=>{try{return(await ve.post("/api/time-tracking/time-entries/clock-in",{profile_id:e,so_id:t})).data}catch(r){if(r?.response)throw r;if(!!!window?.api?.timeEvents?.insert)throw new Error("Network error: time entry clock-in did not reach the server. Please check your connection and try again.");const a={event_id:yR(),user_id:e,device_id:localStorage.getItem("deviceId")||"unknown-device",type:"time_clock_in",timestamp_utc:Tv(new Date),payload_json:JSON.stringify({profile_id:e,so_id:t}),created_at:Tv(new Date)};return await window?.api?.timeEvents?.insert?.(a),{id:-Math.floor(Math.random()*1e9),profile_id:e,profile_name:"",sales_order_id:t,sales_order_number:"",clock_in:new Date().toISOString(),clock_out:null,duration:null,unit_price:0,__pending:!0,__pending_event_id:a.event_id}}},ffe=async e=>{try{return(await ve.post(`/api/time-tracking/time-entries/${e}/clock-out`)).data}catch{if(!!!window?.api?.timeEvents?.insert)throw new Error("Network error: time entry clock-out did not reach the server. Please check your connection and try again.");const n={event_id:yR(),device_id:localStorage.getItem("deviceId")||"unknown-device",type:"time_clock_out",timestamp_utc:Tv(new Date),payload_json:JSON.stringify({id:e}),created_at:Tv(new Date)};return await window?.api?.timeEvents?.insert?.(n),{id:e,clock_out:new Date().toISOString(),__pending:!0,__pending_event_id:n.event_id}}},hfe=async(e,t,r)=>(await ve.put(`/api/time-tracking/time-entries/${e}`,{clock_in:t,clock_out:r})).data,pfe=async e=>{await ve.delete(`/api/time-tracking/time-entries/${e}`)},mfe=async(e,t,r,n)=>(await ve.post("/api/time-tracking/time-entries/manual",{profile_id:e,sales_order_id:t,clock_in:r,clock_out:n})).data,gfe=async(e,t,r,n)=>(await ve.get("/api/time-tracking/reports/time-entries",{params:{from:e,to:t,profile:r,so:n}})).data,vfe=async(e,t,r,n,a="csv")=>(await ve.get("/api/time-tracking/reports/time-entries/export",{params:{from:e,to:t,profile:r,so:n,format:a},responseType:"blob"})).data,X4=async e=>(await ve.get("/api/time-tracking/time-entries/open",{params:{profile_id:e}})).data,yfe=()=>{const{user:e}=ea(),[t,r]=y.useState([]),[n,a]=y.useState([]),[o,s]=y.useState([]),[l,c]=y.useState([]),[u,d]=y.useState(""),[f,h]=y.useState(""),[p,g]=y.useState(!0),[m,x]=y.useState(!1),[b,_]=y.useState(null),[w,A]=y.useState(null),O=y.useRef(null),T=R=>{O.current&&window.clearTimeout(O.current),A(R),O.current=window.setTimeout(()=>{A(null),O.current=null},2500)};y.useEffect(()=>()=>{O.current&&window.clearTimeout(O.current)},[]),y.useEffect(()=>{E()},[]),y.useEffect(()=>{u?S():s([])},[u]),y.useEffect(()=>{const R=setInterval(()=>{s(F=>F.map(W=>{if(!W.clock_out){const K=new Date,Z=new Date(W.clock_in),D=(K.getTime()-Z.getTime())/(1e3*60*60);return{...W,duration:D}}return W})),c(F=>F.map(W=>{if(!W.clock_out){const K=new Date,Z=new Date(W.clock_in),D=(K.getTime()-Z.getTime())/(1e3*60*60);return{...W,duration:D}}return W}))},1e3);return()=>clearInterval(R)},[]);const E=async()=>{try{g(!0);const[R,F]=await Promise.all([AS(),xR()]);console.log("Sales orders data received:",F),r(R),a(F),I(R),_(null)}catch(R){_("Failed to fetch data. Please try again."),console.error("Error fetching data:",R)}finally{g(!1)}},S=async()=>{if(u)try{const[R,F]=await Promise.all([ufe(new Date().toISOString().split("T")[0],u),X4(u)]),W=new Map;[...R,...F].forEach(K=>{W.set(K.id,K)}),s(Array.from(W.values()))}catch(R){_("Failed to fetch time entries. Please try again."),console.error("Error fetching time entries:",R)}},I=async R=>{const F=R||t;if(!F.length){c([]);return}try{x(!0);const W=[];await Promise.all(F.map(async K=>{try{(await X4(K.id)).forEach(D=>{W.push({...D,profile_name:K.name})})}catch(Z){console.error(`Failed to fetch open time entries for profile ${K.id}`,Z)}})),c(W)}catch(W){console.error("Error fetching active time entries:",W)}finally{x(!1)}},z=async()=>{if(!u||!f){_("Please select both a profile and a sales order");return}if(o.find(F=>F.sales_order_id===f&&!F.clock_out)){_("You are already clocked in for this sales order");return}try{A(null);const F=await dfe(u,f);s([F,...o]),d(""),h(""),s([]),_(null),T("Successfully clocked in."),I()}catch(F){A(null),F.response&&F.response.data&&F.response.data.error.includes("attendance")?_("You must clock in for attendance before you can clock in for a sales order."):_(F?.message||"Failed to clock in. Please try again."),console.error("Error clocking in:",F)}},k=async R=>{try{A(null);const F=await ffe(R);s(o.map(W=>W.id===R?F:W)),d(""),h(""),s([]),_(null),T("Successfully clocked out."),I()}catch(F){A(null),_(F?.message||"Failed to clock out. Please try again."),console.error("Error clocking out:",F)}},M=u&&o.some(R=>R.profile_id===u&&!R.clock_out);return p?i.jsx(J,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:i.jsx(nr,{})}):i.jsxs(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Time Tracking"}),b&&i.jsx(Ot,{severity:"error",variant:"filled",sx:{mb:2,fontSize:"1.1rem",fontWeight:700,py:2},children:b}),i.jsxs(gr,{open:!!w,onClose:()=>A(null),PaperProps:{sx:{px:6,py:4,textAlign:"center"}},children:[i.jsx(vr,{sx:{fontSize:"2rem"},children:"Success"}),i.jsx(yr,{children:i.jsx(B,{variant:"h4",component:"p",children:w})})]}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(xt,{sx:{p:2},children:[i.jsx(J,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:i.jsx(B,{variant:"h6",children:"Profile"})}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Select Profile"}),i.jsx(hn,{value:u,label:"Select Profile",onChange:R=>d(R.target.value),sx:{"& .MuiSelect-select":{fontSize:"1.25rem",py:1.5,minHeight:56}},MenuProps:{PaperProps:{sx:{"& .MuiMenuItem-root":{fontSize:"1.25rem",py:1.5,minHeight:56},"& .MuiMenuItem-root.Mui-selected, & .MuiMenuItem-root.Mui-selected:hover":{backgroundColor:"rgba(25, 118, 210, 0.2)",color:"primary.main",fontWeight:700},"& .MuiMenuItem-root:hover":{backgroundColor:"rgba(25, 118, 210, 0.15)"}}}},children:t.map(R=>i.jsx(tr,{value:R.id,sx:{fontSize:"1.2rem",py:1.25},children:R.name},R.id))})]})]})}),u&&i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(xt,{sx:{p:2},children:[i.jsx(J,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:i.jsx(B,{variant:"h6",children:"Sales Order"})}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Select Sales Order"}),i.jsx(hn,{value:f,label:"Select Sales Order",onChange:R=>h(R.target.value),sx:{"& .MuiSelect-select":{fontSize:"1.25rem",py:1.5,minHeight:56}},MenuProps:{PaperProps:{sx:{"& .MuiMenuItem-root":{fontSize:"1.25rem",py:1.5,lineHeight:1.3,minHeight:56},"& .MuiMenuItem-root.Mui-selected, & .MuiMenuItem-root.Mui-selected:hover":{backgroundColor:"rgba(25, 118, 210, 0.2)",color:"primary.main",fontWeight:700},"& .MuiMenuItem-root:hover":{backgroundColor:"rgba(25, 118, 210, 0.15)"}}}},children:n.map(R=>{const F=o.some(W=>W.sales_order_id===R.id&&!W.clock_out);return i.jsxs(tr,{value:R.id,disabled:F,sx:{fontSize:"1.1rem"},children:[`${R.number} - ${R.product_name||"No Product Name"} - ${R.customer_name||"Unknown Customer"}`,F?" - Already Clocked In":""]},R.id)})})]})]})}),u&&f&&i.jsx(ie,{item:!0,xs:12,children:i.jsx(xt,{sx:{p:2},children:i.jsx(J,{display:"flex",justifyContent:"center",gap:2,children:i.jsx(ye,{variant:"contained",sx:{backgroundColor:"green",px:4,py:2,fontSize:"1.2rem",fontWeight:700,borderRadius:"12px",minWidth:220,"&:hover":{backgroundColor:"darkgreen"}},onClick:z,disabled:M,children:"Clock In"})})})}),u&&i.jsx(ie,{item:!0,xs:12,children:i.jsxs(xt,{sx:{p:2},children:[i.jsxs(B,{variant:"h6",gutterBottom:!0,children:["Today's Time Entries for ",t.find(R=>R.id===u)?.name]}),i.jsx(va,{children:i.jsxs(sa,{children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Sales Order"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Clock In"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Clock Out"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Duration"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Actions"})]})}),i.jsx(ca,{children:o.map(R=>i.jsxs(br,{children:[i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:R.sales_order_number}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:new Date(R.clock_in).toLocaleTimeString()}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:R.clock_out?new Date(R.clock_out).toLocaleTimeString():"-"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:Ev(R.duration)}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:!R.clock_out&&i.jsx(ye,{variant:"contained",sx:{backgroundColor:"red",px:3,py:1.5,fontSize:"1.1rem",fontWeight:700,borderRadius:"12px","&:hover":{backgroundColor:"darkred"}},onClick:()=>k(R.id),children:"Clock Out"})})]},R.id))})]})})]})}),i.jsx(ie,{item:!0,xs:12,children:i.jsxs(xt,{sx:{p:2},children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[i.jsx(B,{variant:"h6",children:"Active Clock Ins"}),m&&i.jsx(nr,{size:24})]}),l.length===0&&!m?i.jsx(B,{color:"text.secondary",children:"No active clock ins."}):i.jsx(va,{children:i.jsxs(sa,{children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Profile"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Sales Order"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Clock In"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Duration"})]})}),i.jsx(ca,{children:l.map(R=>i.jsxs(br,{children:[i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:R.profile_name||t.find(F=>F.id===R.profile_id)?.name||"Unknown"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:R.sales_order_number}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:new Date(R.clock_in).toLocaleString()}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:Ev(R.duration)})]},R.id))})]})})]})})]})]})};var Bm={exports:{}},J4;function xfe(){return J4||(J4=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(c,u){switch(c){case"P":return u.date({width:"short"});case"PP":return u.date({width:"medium"});case"PPP":return u.date({width:"long"});case"PPPP":default:return u.date({width:"full"})}},n=function(c,u){switch(c){case"p":return u.time({width:"short"});case"pp":return u.time({width:"medium"});case"ppp":return u.time({width:"long"});case"pppp":default:return u.time({width:"full"})}},a=function(c,u){var d=c.match(/(P+)(p+)?/)||[],f=d[1],h=d[2];if(!h)return r(c,u);var p;switch(f){case"P":p=u.dateTime({width:"short"});break;case"PP":p=u.dateTime({width:"medium"});break;case"PPP":p=u.dateTime({width:"long"});break;case"PPPP":default:p=u.dateTime({width:"full"});break}return p.replace("{{date}}",r(f,u)).replace("{{time}}",n(h,u))},o={p:n,P:a},s=o;t.default=s,e.exports=t.default}(Bm,Bm.exports)),Bm.exports}var bfe=xfe();const _fe=It(bfe),wfe={y:{sectionType:"year",contentType:"digit",maxLength:4},yy:"year",yyy:{sectionType:"year",contentType:"digit",maxLength:4},yyyy:"year",M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMMM:{sectionType:"month",contentType:"letter"},MMM:{sectionType:"month",contentType:"letter"},L:{sectionType:"month",contentType:"digit",maxLength:2},LL:"month",LLL:{sectionType:"month",contentType:"letter"},LLLL:{sectionType:"month",contentType:"letter"},d:{sectionType:"day",contentType:"digit",maxLength:2},dd:"day",do:{sectionType:"day",contentType:"digit-with-letter"},E:{sectionType:"weekDay",contentType:"letter"},EE:{sectionType:"weekDay",contentType:"letter"},EEE:{sectionType:"weekDay",contentType:"letter"},EEEE:{sectionType:"weekDay",contentType:"letter"},EEEEE:{sectionType:"weekDay",contentType:"letter"},i:{sectionType:"weekDay",contentType:"digit",maxLength:1},ii:"weekDay",iii:{sectionType:"weekDay",contentType:"letter"},iiii:{sectionType:"weekDay",contentType:"letter"},e:{sectionType:"weekDay",contentType:"digit",maxLength:1},ee:"weekDay",eee:{sectionType:"weekDay",contentType:"letter"},eeee:{sectionType:"weekDay",contentType:"letter"},eeeee:{sectionType:"weekDay",contentType:"letter"},eeeeee:{sectionType:"weekDay",contentType:"letter"},c:{sectionType:"weekDay",contentType:"digit",maxLength:1},cc:"weekDay",ccc:{sectionType:"weekDay",contentType:"letter"},cccc:{sectionType:"weekDay",contentType:"letter"},ccccc:{sectionType:"weekDay",contentType:"letter"},cccccc:{sectionType:"weekDay",contentType:"letter"},a:"meridiem",aa:"meridiem",aaa:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},jfe={year:"yyyy",month:"LLLL",monthShort:"MMM",dayOfMonth:"d",weekday:"EEEE",weekdayShort:"EEEEEE",hours24h:"HH",hours12h:"hh",meridiem:"aa",minutes:"mm",seconds:"ss",fullDate:"PP",fullDateWithWeekday:"PPPP",keyboardDate:"P",shortDate:"MMM d",normalDate:"d MMMM",normalDateWithWeekday:"EEE, MMM d",monthAndYear:"LLLL yyyy",monthAndDate:"MMMM d",fullTime:"p",fullTime12h:"hh:mm aa",fullTime24h:"HH:mm",fullDateTime:"PP p",fullDateTime12h:"PP hh:mm aa",fullDateTime24h:"PP HH:mm",keyboardDateTime:"P p",keyboardDateTime12h:"P hh:mm aa",keyboardDateTime24h:"P HH:mm"};class Sfe{constructor(t){this.isMUIAdapter=!0,this.isTimezoneCompatible=!1,this.lib="date-fns",this.locale=void 0,this.formats=void 0,this.formatTokenMap=wfe,this.escapedCharacters={start:"'",end:"'"},this.longFormatters=void 0,this.date=o=>typeof o>"u"?new Date:o===null?null:new Date(o),this.dateWithTimezone=o=>this.date(o),this.getTimezone=()=>"default",this.setTimezone=o=>o,this.toJsDate=o=>o,this.getCurrentLocaleCode=()=>{var o;return((o=this.locale)==null?void 0:o.code)||"en-US"},this.is12HourCycleInCurrentLocale=()=>this.locale?/a/.test(this.locale.formatLong.time({width:"short"})):!0,this.expandFormat=o=>{const s=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g;return o.match(s).map(l=>{const c=l[0];if(c==="p"||c==="P"){const u=this.longFormatters[c];return u(l,this.locale.formatLong)}return l}).join("")},this.getFormatHelperText=o=>this.expandFormat(o).replace(/(aaa|aa|a)/g,"(a|p)m").toLocaleLowerCase(),this.isNull=o=>o===null,this.formatNumber=o=>o,this.getMeridiemText=o=>o==="am"?"AM":"PM";const{locale:r,formats:n,longFormatters:a}=t;this.locale=r,this.formats=wI({},jfe,n),this.longFormatters=a}}class Z4 extends Sfe{constructor({locale:t,formats:r}={}){if(typeof eg!="function")throw new Error(["MUI: The `date-fns` package v3.x is not compatible with this adapter.","Please, install v2.x of the package or use the `AdapterDateFnsV3` instead."].join(`
`));super({locale:t??Ny,formats:r,longFormatters:_fe}),this.parseISO=n=>Hse(n),this.toISO=n=>Eoe(n,{format:"extended"}),this.parse=(n,a)=>n===""?null:Fse(n,a,new Date,{locale:this.locale}),this.isValid=n=>o6(this.date(n)),this.format=(n,a)=>this.formatByString(n,this.formats[a]),this.formatByString=(n,a)=>Ru(n,a,{locale:this.locale}),this.getDiff=(n,a,o)=>{switch(o){case"years":return Iie(n,this.date(a));case"quarters":return kie(n,this.date(a));case"months":return l6(n,this.date(a));case"weeks":return Eie(n,this.date(a));case"days":return s6(n,this.date(a));case"hours":return Aie(n,this.date(a));case"minutes":return Pie(n,this.date(a));case"seconds":return Tie(n,this.date(a));default:return Iy(n,this.date(a))}},this.isEqual=(n,a)=>n===null&&a===null?!0:zoe(n,a),this.isSameYear=(n,a)=>zse(n,a),this.isSameMonth=(n,a)=>Use(n,a),this.isSameDay=(n,a)=>_ie(n,a),this.isSameHour=(n,a)=>Bse(n,a),this.isAfter=(n,a)=>y2(n,a),this.isAfterYear=(n,a)=>y2(n,m2(a)),this.isAfterDay=(n,a)=>y2(n,_w(a)),this.isBefore=(n,a)=>Mf(n,a),this.isBeforeYear=(n,a)=>Mf(n,Nm(a)),this.isBeforeDay=(n,a)=>Mf(n,Pd(a)),this.isWithinRange=(n,[a,o])=>Wse(n,{start:a,end:o}),this.startOfYear=n=>Nm(n),this.startOfMonth=n=>jE(n),this.startOfWeek=n=>zc(n,{locale:this.locale}),this.startOfDay=n=>Pd(n),this.endOfYear=n=>m2(n),this.endOfMonth=n=>ww(n),this.endOfWeek=n=>g2(n,{locale:this.locale}),this.endOfDay=n=>_w(n),this.addYears=(n,a)=>bE(n,a),this.addMonths=(n,a)=>tg(n,a),this.addWeeks=(n,a)=>xie(n,a),this.addDays=(n,a)=>eg(n,a),this.addHours=(n,a)=>fie(n,a),this.addMinutes=(n,a)=>vie(n,a),this.addSeconds=(n,a)=>yie(n,a),this.getYear=n=>Uoe(n),this.getMonth=n=>Loe(n),this.getDate=n=>Ioe(n),this.getHours=n=>Noe(n),this.getMinutes=n=>Moe(n),this.getSeconds=n=>Roe(n),this.getMilliseconds=n=>Doe(n),this.setYear=(n,a)=>hle(n,a),this.setMonth=(n,a)=>sle(n,a),this.setDate=(n,a)=>lle(n,a),this.setHours=(n,a)=>cle(n,a),this.setMinutes=(n,a)=>dle(n,a),this.setSeconds=(n,a)=>fle(n,a),this.setMilliseconds=(n,a)=>ule(n,a),this.getDaysInMonth=n=>g6(n),this.getNextMonth=n=>tg(n,1),this.getPreviousMonth=n=>tg(n,-1),this.getMonthArray=n=>{const o=[Nm(n)];for(;o.length<12;){const s=o[o.length-1];o.push(this.getNextMonth(s))}return o},this.mergeDateAndTime=(n,a)=>this.setSeconds(this.setMinutes(this.setHours(n,this.getHours(a)),this.getMinutes(a)),this.getSeconds(a)),this.getWeekdays=()=>{const n=new Date;return Nie({start:zc(n,{locale:this.locale}),end:g2(n,{locale:this.locale})}).map(a=>this.formatByString(a,"EEEEEE"))},this.getWeekArray=n=>{const a=zc(jE(n),{locale:this.locale}),o=g2(ww(n),{locale:this.locale});let s=0,l=a;const c=[];for(;Mf(l,o);){const u=Math.floor(s/7);c[u]=c[u]||[],c[u].push(l),l=eg(l,1),s+=1}return c},this.getWeekNumber=n=>Boe(n,{locale:this.locale}),this.getYearRange=(n,a)=>{const o=Nm(n),s=m2(a),l=[];let c=o;for(;Mf(c,s);)l.push(c),c=bE(c,1);return l}}}const Td=e=>new Date(e.getTime()-e.getTimezoneOffset()*6e4).toISOString(),PS=()=>crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,Cfe=()=>new Promise((e,t)=>{if(typeof navigator>"u"||!navigator?.geolocation)return t(new Error("Location services are unavailable in this environment."));navigator.geolocation.getCurrentPosition(r=>e({latitude:r.coords.latitude,longitude:r.coords.longitude}),r=>t(r),{enableHighAccuracy:!0,timeout:1e4})}),Afe=()=>{try{const e=typeof navigator<"u"&&(navigator.userAgent||navigator.vendor)||"";if(e&&/android|iphone|ipad|ipod|mobile/i.test(e))return!0;if(typeof window<"u"&&window.matchMedia)return window.matchMedia("(max-width: 768px)").matches}catch{}return!1},Pfe=async()=>{try{return(await ve.get("/api/attendance/geofence")).data}catch{return null}},Ofe=async e=>(await ve.get("/api/attendance",{params:{profile_id:e}})).data,kfe=async e=>{const t=Afe(),r=t?await Pfe():null,n=!!(t&&r?.enabled&&r?.configured);let a=null;if(n)try{a=await Cfe()}catch(s){const l=s?.message||"Location access is required to clock in because geofencing is enabled. Please allow location permissions and try again.",c=new Error(l);throw c.code="GEOFENCE_LOCATION_REQUIRED",c}const o={profile_id:e};a&&(o.latitude=a.latitude,o.longitude=a.longitude);try{return(await ve.post("/api/attendance/clock-in",o)).data}catch(s){if(s?.response)throw s;if(!!!window?.api?.timeEvents?.insert)throw new Error("Network error: clock-in did not reach the server. Please check your connection and try again.");const c={...o},u={event_id:PS(),user_id:e,device_id:localStorage.getItem("deviceId")||"unknown-device",type:"attendance_clock_in",timestamp_utc:Td(new Date),payload_json:JSON.stringify(c),created_at:Td(new Date)};return await window?.api?.timeEvents?.insert?.(u),{id:-Math.floor(Math.random()*1e9),profile_id:e,clock_in:new Date().toISOString(),clock_out:null,duration:null,__pending:!0,__pending_event_id:u.event_id}}},Tfe=async e=>{try{return(await ve.post("/api/attendance/clock-out",{shift_id:e})).data}catch{if(!!!window?.api?.timeEvents?.insert)throw new Error("Network error: clock-out did not reach the server. Please check your connection and try again.");const n={event_id:PS(),user_id:void 0,device_id:localStorage.getItem("deviceId")||"unknown-device",type:"attendance_clock_out",timestamp_utc:Td(new Date),payload_json:JSON.stringify({shift_id:e}),created_at:Td(new Date)};return await window?.api?.timeEvents?.insert?.(n),{id:e,clock_out:new Date().toISOString(),__pending:!0,__pending_event_id:n.event_id}}},Efe=async(e,t,r)=>{try{return(await ve.post("/api/attendance/manual",{profile_id:e,clock_in:t,clock_out:r})).data}catch(n){throw n}},Ife=async(e,t,r)=>{try{return(await ve.put(`/api/attendance/${e}`,{clock_in:t,clock_out:r})).data}catch(n){if(n?.response)throw n;const a={event_id:PS(),device_id:localStorage.getItem("deviceId")||"unknown-device",type:"attendance_update",timestamp_utc:Td(new Date),payload_json:JSON.stringify({shift_id:e,clock_in:t,clock_out:r}),created_at:Td(new Date)};return await window?.api?.timeEvents?.insert?.(a),{id:e,clock_in:t,clock_out:r,__pending:!0,__pending_event_id:a.event_id}}},Nfe=async(e,t,r)=>(await ve.get("/api/attendance",{params:{profile_id:e,from:t,to:r}})).data,Dfe=async e=>(await ve.get("/api/attendance/active",{params:{profile_id:e}})).data,Mfe=async e=>{await ve.delete(`/api/attendance/${e}`)};function Vl(e){if(!e)return"";const t=new Date(e),r=t.getTimezoneOffset()*6e4;return new Date(t.getTime()-r).toISOString().slice(0,16)}function Pu(e){return e?new Date(e).toISOString():null}function Gw(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}function dh(e){const t=Gw(e),r=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${r}-${n}-${a}`}const eI=["#2563eb","#22c55e","#f97316","#06b6d4","#eab308","#8b5cf6","#ef4444","#0ea5e9","#d946ef","#14b8a6"],Lfe="#9ca3af",Rfe=()=>{const[e,t]=y.useState([]),[r,n]=y.useState([]),[a,o]=y.useState([]),[s,l]=y.useState(""),[c,u]=y.useState(""),d=new Date,f=new Date;f.setDate(d.getDate()-1);const h=new Date;h.setDate(f.getDate()-13);const[p,g]=y.useState(h),[m,x]=y.useState(f),[b,_]=y.useState(!0),[w,A]=y.useState(null),[O,T]=y.useState(null),[E,S]=y.useState(""),[I,z]=y.useState(""),[k,M]=y.useState(null),[R,F]=y.useState([]),[W,K]=y.useState({}),[Z,D]=y.useState([]),[P,$]=y.useState(null),[Q,C]=y.useState(null),[L,H]=y.useState(""),[U,te]=y.useState(""),[le,oe]=y.useState(!1),[ae,he]=y.useState(!0),[me,X]=y.useState(!1),[G,ee]=y.useState(null),[se,V]=y.useState(""),[He,Ne]=y.useState(""),[Re,Ke]=y.useState(""),[nt,st]=y.useState(!1),[gt,Ge]=y.useState(!1),[Je,We]=y.useState(""),[_t,Nt]=y.useState(""),[kt,Vt]=y.useState(""),[jt,Tr]=y.useState(!1),[qe,$e]=y.useState(null),[Xe,Ue]=y.useState(!1),[ht,at]=y.useState(null),[wt,Tt]=y.useState(null),[Jt,Dr]=y.useState(!1),[qr,ar]=y.useState(null),[Er,Ir]=y.useState(null),[rn,Ta]=y.useState(null),Dn=y.useMemo(()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"}catch(Qe){return console.warn("Unable to determine browser timezone, defaulting to UTC.",Qe),"UTC"}},[]);y.useEffect(()=>{rr()},[]);const rr=async()=>{try{_(!0);const[Qe,Yt]=await Promise.all([AS(),xR()]);t(Qe),n(Yt);const[sr,Mr]=await Promise.all([ve.get("/api/settings/daily-break-start").catch(()=>null),ve.get("/api/settings/daily-break-end").catch(()=>null)]);Ir(sr?.data?.daily_break_start??null),Ta(Mr?.data?.daily_break_end??null),A(null)}catch(Qe){A("Failed to fetch data. Please try again."),console.error("Error fetching data:",Qe)}finally{_(!1)}},Kr=async()=>{if(!p||!m){A("Please select a date range");return}try{_(!0);const Qe=Gw(p),Yt=new Date(m.getFullYear(),m.getMonth(),m.getDate()+1),sr=dh(Qe),Mr=dh(Yt);console.log("Requesting shifts for:",sr,Mr);const Ar={from_date:sr,to_date:Mr};s&&(Ar.profile_id=s),c&&(Ar.sales_order_id=c);const dn=await gfe(sr,Mr,s||void 0,c||void 0);if(o(dn),c)F([]),K({}),D([]);else{const ta=(await Nfe(s||void 0,sr,Mr)).map(On=>({...On,id:Number(On.id),profile_id:Number(On.profile_id)}));console.log("Fetched shifts:",ta),F(ta);const jn=[];let Ia=new Date(Qe);const Na=new Date(Yt);for(;Ia<Na;){const Gr={date:dh(Ia)};s&&(Gr.profile_id=s);const no=await ve.get("/api/time-tracking/time-entries",{params:Gr});jn.push(...no.data),Ia.setDate(Ia.getDate()+1)}const ai={},ra=[];ta.forEach(On=>{const Gr=Number(On.id);Number.isNaN(Gr)||(ai[Gr]=[])}),jn.forEach(On=>{const Gr=new Date(On.clock_in).getTime(),no=Number(On.profile_id);let ao=!1;for(const io of ta){const Si=Number(io.id);if(Number.isNaN(Si))continue;const oo=new Date(io.clock_in).getTime(),pi=io.clock_out?new Date(io.clock_out).getTime():null,Oo=Number(io.profile_id);if(pi&&!Number.isNaN(no)&&!Number.isNaN(Oo)&&no===Oo&&Gr>=oo&&Gr<pi){ai[Si].push(On),ao=!0;break}}ao||ra.push(On)}),K(ai),D(ra)}A(null)}catch(Qe){A("Failed to generate report. Please try again."),console.error("Error generating report:",Qe)}finally{_(!1)}},Yn=async Qe=>{if(!p||!m){A("Please select both from and to dates");return}try{const Yt=Gw(p),sr=new Date(m.getFullYear(),m.getMonth(),m.getDate()+1),Mr=dh(Yt),Ar=dh(sr),dn=await vfe(Mr,Ar,s||void 0,c||void 0,Qe),Fr=c?`time-entries-report-so-${c}.${Qe}`:`time-entries-report.${Qe}`;qfe(dn,Fr)}catch(Yt){A("Failed to export report. Please try again."),console.error("Error exporting report:",Yt)}},Mn=async()=>{if(O){M(null),A(null);try{const Qe=Pu(E),Yt=Pu(I),sr=await hfe(O.id,Qe,Yt);o(a.map(Mr=>Mr.id===O.id?{...Mr,clock_in:sr.clock_in,clock_out:sr.clock_out,duration:sr.duration}:Mr)),M(null),T(null),A(null)}catch(Qe){const sr=(Qe?.response?.data?.message??Qe?.response?.data?.error)||"Failed to update time entry. Please try again.";M(sr),A(sr),console.error("Error updating time entry:",Qe)}}},Qr=Qe=>{ee(Qe),X(!0),V(c!==""?c:""),Ne(Qe.clock_in?Vl(Qe.clock_in):""),Ke(Qe.clock_out?Vl(Qe.clock_out):""),A(null)},nn=()=>{X(!1),ee(null),Ne(""),Ke(""),V(c!==""?c:""),st(!1)},Se=async()=>{if(!G||se===""||!He||!Re)return;const Qe=Pu(He),Yt=Pu(Re);if(!(!Qe||!Yt)){st(!0),A(null);try{await mfe(G.profile_id,Number(se),Qe,Yt),nn(),await Kr()}catch(sr){const Mr=sr?.response?.data?.message||sr?.response?.data?.error||"Failed to create time entry. Please try again.";A(Mr),console.error("Error creating manual time entry:",sr)}finally{st(!1)}}},Ve=Qe=>{at(null),A(null),$e(Qe)},it=()=>{Xe||($e(null),at(null))},Ct=async()=>{if(!qe)return;const Qe=qe.id;Ue(!0),at(null),A(null);try{await pfe(Qe),$e(null),await Kr()}catch(Yt){const sr=Yt?.response?.data?.message||Yt?.response?.data?.error||"Failed to delete time entry.";at(sr),A(sr)}finally{Ue(!1)}},Bt=Qe=>{ar(null),A(null),Tt(Qe)},Ht=()=>{Jt||(Tt(null),ar(null))},mr=async()=>{if(!wt)return;const Qe=wt.id;Dr(!0),ar(null),A(null);try{await Mfe(Qe),Tt(null),await Kr()}catch(Yt){const sr=Yt?.response?.data?.message||Yt?.response?.data?.error||"Failed to delete shift.";ar(sr),A(sr)}finally{Dr(!1)}};y.useEffect(()=>{Q&&(H(Q.clock_in?Vl(Q.clock_in):""),te(Q.clock_out?Vl(Q.clock_out):""))},[Q]);const{stackedChartData:an,salesOrderKeys:Be,salesOrderColorMap:tt}=y.useMemo(()=>{const Qe=new Set,Yt=new Map;R.forEach(Ar=>{const dn=Number(Ar.id),Fr=Number(Ar.profile_id);if(Number.isNaN(dn)||Number.isNaN(Fr)||!Ar.clock_in||!Ar.clock_out)return;const ta=Ar.profile_name||e.find(ai=>ai.id===Fr)?.name||`Profile ${Fr}`,jn=Yw(Ar.duration,Ar.clock_in,Ar.clock_out,Er,rn,Dn),Ia=W[dn]||[],Na=Yt.get(Fr)||{profileName:ta,total:0,salesOrders:{}};Na.total+=jn,Ia.forEach(ai=>{const ra=ai.sales_order_number||`SO ${ai.sales_order_id||"Unknown"}`,On=Hc(ai.duration),Gr=On!==null?On:0;Na.salesOrders[ra]=(Na.salesOrders[ra]||0)+Gr,Qe.add(ra)}),Yt.set(Fr,Na)});const sr=Array.from(Yt.values()).map(Ar=>{const dn=Object.values(Ar.salesOrders).reduce((ta,jn)=>ta+jn,0),Fr=Math.max(0,Ar.total-dn);return{profileName:Ar.profileName,...Ar.salesOrders,Idle:Fr}}),Mr={Idle:Lfe};return Array.from(Qe).forEach((Ar,dn)=>{Mr[Ar]=eI[dn%eI.length]}),{stackedChartData:sr,salesOrderKeys:Array.from(Qe),salesOrderColorMap:Mr}},[Dn,rn,Er,e,W,R]),At=({active:Qe,payload:Yt,label:sr})=>{if(!Qe||!Yt?.length)return null;const Mr=Yt.filter(Ar=>Ar?.value&&Ar.value>1e-4);return Mr.length?i.jsxs(xt,{sx:{p:1.5},elevation:3,children:[i.jsx(B,{variant:"subtitle2",fontWeight:700,children:sr}),Mr.map(Ar=>i.jsxs(B,{variant:"body2",children:[Ar.name,": ",Number(Ar.value).toFixed(2)," hrs"]},Ar.name))]}):null},Gt=Math.max(320,an.length*80);if(b)return i.jsx(J,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:i.jsx(nr,{})});const or=He?new Date(He):null,un=Re?new Date(Re):null,Ea=!!(G&&se!==""&&or&&un&&un.getTime()>or.getTime()),ro=G?G.profile_name||e.find(Qe=>Qe.id===G.profile_id)?.name||`Profile ${G.profile_id}`:"",Un=wt?wt.profile_name||e.find(Qe=>Qe.id===wt.profile_id)?.name||`Profile ${wt.profile_id}`:"",Kn={};R.forEach(Qe=>{if(Qe.clock_in&&Qe.clock_out){const Yt=Number(Qe.id);if(Number.isNaN(Yt))return;const sr=Number(Qe.profile_id);if(Number.isNaN(sr))return;new Date(Qe.clock_in).getTime(),new Date(Qe.clock_out).getTime();const Mr=Yw(Qe.duration,Qe.clock_in,Qe.clock_out,Er,rn,Dn),Ar=W[Yt]||[];let dn=0;Ar.forEach(Ia=>{const Na=Hc(Ia.duration);dn+=Na!==null?Na:0});const Fr=Math.max(0,Mr-dn),ta=Math.min(Mr,8),jn=Math.max(0,Mr-8);Kn[sr]||(Kn[sr]={hours:0,idle:0,regular:0,overtime:0}),Kn[sr].hours+=Mr,Kn[sr].idle+=Fr,Kn[sr].regular+=ta,Kn[sr].overtime+=jn}});let Fi={},ji={};return c&&a.forEach(Qe=>{const Yt=Qe.profile_name||"Unknown",sr=Hc(Qe.duration),Mr=sr!==null?sr:0;Fi[Yt]=(Fi[Yt]||0)+Mr,ji[Yt]||(ji[Yt]=[]),ji[Yt].push({date:Qe.date,duration:Mr})}),i.jsxs(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsx(B,{variant:"h4",gutterBottom:!0,sx:{fontSize:"2.5rem"},children:"Time Tracking Reports"}),w&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:w}),i.jsx(J,{mb:3,children:i.jsxs(xt,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,sx:{fontSize:"1.5rem"},children:"Hours by Profile (Attendance vs Sales Orders)"}),an.length>0?i.jsx(J,{sx:{width:"100%",height:Gt},children:i.jsx(SD,{children:i.jsxs(HL,{data:an,layout:"vertical",margin:{top:16,right:24,left:24,bottom:16},children:[i.jsx(uv,{strokeDasharray:"3 3"}),i.jsx(Zc,{type:"number",tickFormatter:Qe=>`${Qe}h`}),i.jsx(eu,{dataKey:"profileName",type:"category",width:180}),i.jsx(xo,{content:At}),i.jsx(Ss,{wrapperStyle:{paddingTop:8}}),Be.map(Qe=>i.jsx(yl,{dataKey:Qe,stackId:"hours",fill:tt[Qe]},Qe)),i.jsx(yl,{dataKey:"Idle",stackId:"hours",fill:tt.Idle})]})})}):i.jsx(B,{variant:"body1",sx:{color:"text.secondary"},children:"Generate a report to see attendance hours stacked by sales order and idle time."})]})}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsxs(xt,{sx:{p:2},children:[i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:2,children:i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{shrink:!0,children:"Profile"}),i.jsxs(hn,{value:s,label:"Profile",onChange:Qe=>l(Qe.target.value),displayEmpty:!0,sx:{"& .MuiSelect-select":{fontSize:"1.2rem"}},children:[i.jsx(tr,{value:"",sx:{fontSize:"1.2rem"},children:"All Profiles"}),e.map(Qe=>i.jsx(tr,{value:Qe.id,sx:{fontSize:"1.1rem"},children:Qe.name},Qe.id))]})]})}),i.jsx(ie,{item:!0,xs:12,md:2,children:i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{shrink:!0,children:"Sales Order"}),i.jsxs(hn,{value:c,label:"Sales Order",onChange:Qe=>u(Qe.target.value),displayEmpty:!0,sx:{"& .MuiSelect-select":{fontSize:"1.2rem"}},children:[i.jsx(tr,{value:"",sx:{fontSize:"1.2rem"},children:"All Sales Orders"}),r.map(Qe=>i.jsx(tr,{value:Qe.id,sx:{fontSize:"1.1rem"},children:`${Qe.number} - ${Qe.product_name||"No Product Name"} - ${Qe.customer_name||"Unknown Customer"}`},Qe.id))]})]})}),i.jsx(ie,{item:!0,xs:12,md:2,children:i.jsx(Os,{dateAdapter:Z4,children:i.jsx(os,{label:"From Date",value:p,onChange:Qe=>g(Qe),slotProps:{textField:{fullWidth:!0}}})})}),i.jsx(ie,{item:!0,xs:12,md:2,children:i.jsx(Os,{dateAdapter:Z4,children:i.jsx(os,{label:"To Date",value:m,onChange:Qe=>x(Qe),slotProps:{textField:{fullWidth:!0}}})})})]}),i.jsxs(J,{display:"flex",justifyContent:"center",gap:2,mt:2,children:[i.jsx(ye,{variant:"contained",color:"secondary",onClick:()=>{We(s===""?"":s),Nt(""),Vt(""),A(null),Ge(!0)},children:"Add Shift"}),i.jsx(ye,{variant:"contained",color:"primary",onClick:Kr,children:"Generate Report"}),i.jsx(ye,{variant:"outlined",onClick:()=>Yn("csv"),children:"Export CSV"}),i.jsx(ye,{variant:"outlined",onClick:()=>Yn("pdf"),children:"Download PDF"})]})]})}),i.jsx(ie,{item:!0,xs:12,children:c?i.jsxs(xt,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,sx:{fontSize:"1.5rem"},children:"Time Entries Report for Sales Order"}),i.jsx(J,{mb:2,children:i.jsxs(xt,{elevation:2,sx:{p:2,background:"#ede9fe",borderLeft:"6px solid #7c3aed"},children:[i.jsx(B,{variant:"h6",color:"#7c3aed",fontWeight:700,sx:{fontSize:"1.5rem"},children:"Total Hours by Profile on Sales Order"}),Object.entries(Fi).map(([Qe,Yt])=>i.jsxs(B,{variant:"body1",sx:{ml:2,fontSize:"1.2rem"},children:[" ",Qe,": ",Yt.toFixed(2)," hrs"]},Qe))]})}),i.jsxs(xt,{elevation:3,sx:{p:2,mb:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Time Entries for Sales Order"}),i.jsx(va,{children:i.jsxs(sa,{children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Profile"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Date"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Clock In"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Clock Out"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Duration"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Actions"})]})}),i.jsx(ca,{children:a.map(Qe=>i.jsxs(br,{children:[i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:Qe.profile_name}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:new Date(Qe.date).toLocaleDateString()}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:new Date(Qe.clock_in).toLocaleTimeString()}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:Qe.clock_out?new Date(Qe.clock_out).toLocaleTimeString():"-"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:Ev(Qe.duration)}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:Qe.clock_out&&i.jsx(ye,{variant:"text",startIcon:i.jsx(Ip,{}),onClick:()=>{M(null),A(null),T(Qe),S(Vl(Qe.clock_in)),z(Vl(Qe.clock_out))},sx:{ml:1},children:"Edit"})})]},Qe.id))})]})})]})]}):i.jsxs(xt,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,sx:{fontSize:"1.5rem"},children:"Time Entries Report"}),i.jsx(J,{display:"flex",alignItems:"center",mb:2,children:i.jsx(ri,{control:i.jsx(hl,{checked:ae,onChange:Qe=>he(Qe.target.checked),color:"primary"}),label:i.jsx(B,{sx:{fontSize:"1.1rem"},children:"Show time entry breakdown"})})}),R.length>0&&i.jsx(J,{mb:2,children:i.jsxs(xt,{elevation:2,sx:{p:2,background:"#ede9fe",borderLeft:"6px solid #7c3aed"},children:[i.jsx(B,{variant:"h6",color:"#7c3aed",fontWeight:700,children:"Summary of Shift Hours by Profile"}),i.jsx(va,{component:xt,sx:{mt:2},children:i.jsxs(sa,{size:"small",children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Profile Name"}),i.jsx(Pe,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Total hr"}),i.jsx(Pe,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Idle hr"}),i.jsx(Pe,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Regular hr"}),i.jsx(Pe,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Overtime hr"})]})}),i.jsx(ca,{children:Object.entries(Kn).map(([Qe,Yt])=>{const Mr=R.find(Ar=>Ar.profile_id===Number(Qe))?.profile_name||e.find(Ar=>Ar.id===Number(Qe))?.name||`Profile ${Qe}`;return i.jsxs(br,{children:[i.jsx(Pe,{sx:{fontSize:"1.2rem"},children:Mr}),i.jsx(Pe,{sx:{fontSize:"1.2rem"},children:Yt.hours.toFixed(2)}),i.jsx(Pe,{sx:{fontSize:"1.2rem"},children:Yt.idle.toFixed(2)}),i.jsx(Pe,{sx:{fontSize:"1.2rem"},children:Yt.regular.toFixed(2)}),i.jsx(Pe,{sx:{fontSize:"1.2rem"},children:Yt.overtime.toFixed(2)})]},Qe)})})]})})]})}),R.length===0&&!b&&i.jsx(Ot,{severity:"info",sx:{mb:2},children:"No shifts found"}),R.map(Qe=>{const Yt=Number(Qe.id);return Number.isNaN(Yt)?null:i.jsx(Wfe,{shift:Qe,entries:W[Yt]||[],expanded:P===Yt,onExpand:()=>$(P===Yt?null:Yt),onAddEntry:Qr,setEditEntry:T,setEditClockIn:S,setEditClockOut:z,profiles:e,setEditShift:C,showBreakdown:ae,setEditEntryError:M,setError:A,onDeleteShift:Bt,onDeleteEntry:Ve,dailyBreakStart:Er,dailyBreakEnd:rn,timeZone:Dn},Yt)}),Z.length>0&&i.jsx(xt,{elevation:3,sx:{mb:2,borderLeft:"6px solid #a21caf",background:"#f3e8ff"},children:i.jsxs(J,{p:2,children:[i.jsx(B,{variant:"subtitle1",fontWeight:700,color:"#a21caf",sx:{fontSize:"1.2rem"},children:"Unscheduled Entries"}),i.jsx(_R,{entries:Z,setEditEntry:T,setEditClockIn:S,setEditClockOut:z,setEditEntryError:M,setError:A,onDeleteEntry:Ve})]})})]})})]}),i.jsxs(gr,{open:me,onClose:nn,children:[i.jsx(vr,{children:"Add Time Entry"}),i.jsxs(yr,{children:[G&&i.jsx(B,{variant:"body2",sx:{mb:2},children:`Profile: ${ro} | Shift Date: ${new Date(G.clock_in).toLocaleDateString()}`}),i.jsxs(tn,{fullWidth:!0,sx:{mb:2},children:[i.jsx(fn,{id:"add-entry-sales-order-label",children:"Sales Order"}),i.jsxs(hn,{labelId:"add-entry-sales-order-label",value:se,label:"Sales Order",displayEmpty:!0,onChange:Qe=>{const Yt=Qe.target.value;V(Yt===""?"":Number(Yt))},children:[i.jsx(tr,{value:"",disabled:!0,children:i.jsx("em",{children:"Select a Sales Order"})}),r.map(Qe=>i.jsx(tr,{value:Qe.id,children:`${Qe.number} - ${Qe.product_name||"No Product Name"} - ${Qe.customer_name||"Unknown Customer"}`},Qe.id))]})]}),i.jsx(Ae,{label:"Clock In",type:"datetime-local",value:He,onChange:Qe=>Ne(Qe.target.value),fullWidth:!0,sx:{mb:2}}),i.jsx(Ae,{label:"Clock Out",type:"datetime-local",value:Re,onChange:Qe=>Ke(Qe.target.value),fullWidth:!0})]}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:nn,disabled:nt,children:"Cancel"}),i.jsx(ye,{onClick:Se,variant:"contained",disabled:!Ea||nt,children:"Save"})]})]}),i.jsxs(gr,{open:!!O,onClose:()=>{T(null),M(null)},children:[i.jsx(vr,{children:"Edit Time Entry"}),i.jsxs(yr,{children:[k&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:k}),i.jsx(Ae,{label:"Clock In",type:"datetime-local",value:E,onChange:Qe=>S(Qe.target.value),fullWidth:!0,sx:{mb:2}}),i.jsx(Ae,{label:"Clock Out",type:"datetime-local",value:I,onChange:Qe=>z(Qe.target.value),fullWidth:!0})]}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:()=>{T(null),M(null)},children:"Cancel"}),i.jsx(ye,{onClick:Mn,variant:"contained",startIcon:i.jsx(DI,{}),children:"Save"})]})]}),i.jsxs(gr,{open:!!qe,onClose:it,children:[i.jsx(vr,{children:"Delete Time Entry"}),i.jsxs(yr,{children:[ht&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:ht}),qe&&i.jsxs(B,{variant:"body2",children:["Are you sure you want to delete the entry for sales order ",qe.sales_order_number," on"," ",new Date(qe.clock_in).toLocaleString(),"?"]})]}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:it,disabled:Xe,children:"Cancel"}),i.jsx(ye,{onClick:Ct,variant:"contained",color:"error",disabled:Xe,children:"Delete"})]})]}),i.jsxs(gr,{open:gt,onClose:()=>{jt||Ge(!1)},children:[i.jsx(vr,{children:"Add Shift"}),i.jsxs(yr,{children:[i.jsxs(tn,{fullWidth:!0,sx:{mb:2},children:[i.jsx(fn,{id:"add-shift-profile-label",children:"Profile"}),i.jsxs(hn,{labelId:"add-shift-profile-label",value:Je,label:"Profile",onChange:Qe=>We(Qe.target.value),displayEmpty:!0,renderValue:Qe=>{if(Qe==null)return i.jsx("em",{children:"Select Profile"});if(typeof Qe=="string"&&Qe==="")return i.jsx("em",{children:"Select Profile"});const Yt=e.find(sr=>sr.id===Number(Qe));return Yt?Yt.name:String(Qe)},children:[i.jsx(tr,{value:"",children:i.jsx("em",{children:"Select Profile"})}),e.map(Qe=>i.jsx(tr,{value:Qe.id,children:Qe.name},Qe.id))]})]}),i.jsx(Ae,{label:"Clock In",type:"datetime-local",value:_t,onChange:Qe=>Nt(Qe.target.value),fullWidth:!0,sx:{mb:2},InputLabelProps:{shrink:!0}}),i.jsx(Ae,{label:"Clock Out",type:"datetime-local",value:kt,onChange:Qe=>Vt(Qe.target.value),fullWidth:!0,InputLabelProps:{shrink:!0}})]}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:()=>{jt||Ge(!1)},children:"Cancel"}),i.jsx(ye,{onClick:async()=>{if(Je===""||!_t||!kt)return;const Qe=Pu(_t),Yt=Pu(kt);if(!Qe||!Yt){A("Please provide valid shift times.");return}Tr(!0);try{await Efe(Je,Qe,Yt),Ge(!1),Nt(""),Vt(""),A(null),await Kr()}catch(sr){const Mr=sr?.response?.data?.message||sr?.response?.data?.error||"Failed to create shift.";A(Mr)}finally{Tr(!1)}},variant:"contained",color:"primary",disabled:jt||Je===""||!_t||!kt,children:"Save"})]})]}),i.jsxs(gr,{open:!!Q,onClose:()=>C(null),children:[i.jsx(vr,{children:"Edit Shift"}),i.jsxs(yr,{children:[i.jsx(Ae,{label:"Clock In",type:"datetime-local",value:L,onChange:Qe=>H(Qe.target.value),fullWidth:!0,sx:{mb:2}}),i.jsx(Ae,{label:"Clock Out",type:"datetime-local",value:U,onChange:Qe=>te(Qe.target.value),fullWidth:!0})]}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:()=>C(null),children:"Cancel"}),i.jsx(ye,{onClick:async()=>{if(Q){oe(!0);try{await Ife(Q.id,new Date(L).toISOString(),new Date(U).toISOString()),C(null),oe(!1),await Kr()}catch(Qe){oe(!1);const Yt=Qe?.response?.data?.message||Qe?.response?.data?.error||"Failed to update shift.";A(Yt)}}},variant:"contained",color:"primary",disabled:le,children:"Save"})]})]}),i.jsxs(gr,{open:!!wt,onClose:Ht,children:[i.jsx(vr,{children:"Delete Shift"}),i.jsxs(yr,{children:[qr&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:qr}),wt&&i.jsxs(B,{variant:"body2",children:["Are you sure you want to delete the shift for ",Un," on"," ",new Date(wt.clock_in).toLocaleString(),"? Any associated time entries must be removed first."]})]}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:Ht,disabled:Jt,children:"Cancel"}),i.jsx(ye,{onClick:mr,variant:"contained",color:"error",disabled:Jt,children:"Delete"})]})]})]})};function qfe(e,t){const r=window.URL.createObjectURL(e),n=document.createElement("a");n.href=r,n.download=t,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(r),document.body.removeChild(n)}function Yw(e,t,r,n,a,o){const s=Hc(e);if(s!==null&&!Number.isNaN(s))return s;if(!t||!r)return 0;const l=new Date(t),c=new Date(r);return Number.isNaN(l.getTime())||Number.isNaN(c.getTime())||c.getTime()<=l.getTime()?0:Ffe(l,c,n,a,o)}function Ffe(e,t,r,n,a){let o=t.getTime()-e.getTime();if(r&&n){const l=$fe(a),c=Bfe(e,t,r,n,l);o-=c}const s=Math.max(0,o/(1e3*60*60));return Math.round(s*100)/100}function $fe(e){const t=(e||"").trim();if(!t)return"UTC";try{return new Intl.DateTimeFormat("en-US",{timeZone:t}),t}catch{return console.warn(`Invalid timezone "${t}" supplied. Falling back to UTC.`),"UTC"}}function Bfe(e,t,r,n,a){let o=0;if(t.getUTCDate()!==e.getUTCDate()||t.getUTCMonth()!==e.getUTCMonth()||t.getUTCFullYear()!==e.getUTCFullYear()){const l=Math.round((Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())-Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()))/864e5);for(let c=0;c<=l;c++){const u=bR(e,c),{start:d,end:f}=tI(u,r,n,a),h=Math.max(e.getTime(),d.getTime()),p=Math.min(t.getTime(),f.getTime());p>h&&(o+=p-h)}}else{const{start:l,end:c}=tI(e,r,n,a),u=Math.max(e.getTime(),l.getTime()),d=Math.min(t.getTime(),c.getTime());d>u&&(o+=d-u)}return Math.max(0,o)}function tI(e,t,r,n){const a=M2(e,t,n);let o=M2(e,r,n);return o.getTime()<=a.getTime()&&(o=M2(bR(e,1),r,n)),{start:a,end:o}}function M2(e,t,r){const[n="0",a="0"]=t.split(":"),o=Number(n),s=Number(a);if(Number.isNaN(o)||Number.isNaN(s))return new Date(e.getTime());const{year:l,month:c,day:u}=Ufe(e,r),d=new Date(Date.UTC(l,c-1,u,o,s,0,0)),f=zfe(d,r);return new Date(d.getTime()-f*60*1e3)}function Ufe(e,t){const a=new Intl.DateTimeFormat("en-US",{timeZone:t,year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(e).reduce((o,s)=>(s.type!=="literal"&&(o[s.type]=s.value),o),{});return{year:Number(a.year),month:Number(a.month),day:Number(a.day)}}function zfe(e,t){const a=new Intl.DateTimeFormat("en-US",{timeZone:t,hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).formatToParts(e).reduce((s,l)=>(l.type!=="literal"&&(s[l.type]=l.value),s),{});return(Date.UTC(Number(a.year),Number(a.month)-1,Number(a.day),Number(a.hour),Number(a.minute),Number(a.second))-e.getTime())/(1e3*60)}function bR(e,t){const r=new Date(e.getTime());return r.setUTCDate(r.getUTCDate()+t),r}function Wfe({shift:e,entries:t,expanded:r,onExpand:n,onAddEntry:a,setEditEntry:o,setEditClockIn:s,setEditClockOut:l,profiles:c,setEditShift:u,showBreakdown:d,setEditEntryError:f,setError:h,onDeleteShift:p,onDeleteEntry:g,dailyBreakStart:m,dailyBreakEnd:x,timeZone:b}){const _=new Date(e.clock_in),w=e.clock_out?new Date(e.clock_out):null,A=Yw(e.duration,e.clock_in,e.clock_out,m,x,b),O=e.profile_name||c.find(S=>S.id===e.profile_id)?.name||`Profile ${e.profile_id}`;let T=0;t.forEach(S=>{const I=Hc(S.duration);T+=I!==null?I:0});const E=Math.max(0,A-T);return i.jsx(xt,{elevation:3,sx:{mb:2,borderLeft:"6px solid #7c3aed",background:r?"#f3e8ff":"white"},children:i.jsxs(J,{p:2,children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsxs(B,{variant:"subtitle1",fontWeight:700,color:"#7c3aed",sx:{fontSize:"1.2rem"},children:["Profile: ",O,"  Date: ",_.toLocaleDateString()]}),i.jsxs(J,{display:"flex",gap:1,children:[d&&i.jsx(ye,{variant:"contained",color:"primary",size:"small",onClick:n,children:r?"Hide Entries":"Show Entries"}),i.jsx(ye,{variant:"outlined",color:"primary",size:"small",onClick:()=>a(e),children:"Add Entry"}),i.jsx(ye,{variant:"contained",color:"primary",size:"small",onClick:()=>u(e),children:"Edit Shift"}),i.jsx(ye,{variant:"outlined",color:"error",size:"small",onClick:()=>p(e),startIcon:i.jsx(Id,{}),children:"Delete Shift"})]})]}),i.jsxs(B,{variant:"body1",sx:{mt:1,fontSize:"1.1rem"},children:["Shift: ",_.toLocaleTimeString(),"  ",w?w.toLocaleTimeString():"-"," (",A.toFixed(2)," hrs)"]}),d&&i.jsxs(J,{sx:{mt:1,ml:2},children:[t.map((S,I)=>{const z=Hc(S.duration),k=z!==null?z:0,M=new Date(S.clock_in),R=S.clock_out?new Date(S.clock_out):null;return i.jsxs(B,{variant:"body2",sx:{fontSize:"1.1rem"},children:[" ",S.sales_order_number,": ",M.toLocaleTimeString(),"  ",R?R.toLocaleTimeString():"-"," (",k.toFixed(3)," hrs)"]},S.id||I)}),E>0&&i.jsxs(B,{variant:"body2",sx:{fontSize:"1.1rem"},children:[" Idle: ",E.toFixed(3)," hrs"]})]}),d&&r&&i.jsx(_R,{entries:t,setEditEntry:o,setEditClockIn:s,setEditClockOut:l,setEditEntryError:f,setError:h,onDeleteEntry:g})]})})}function _R({entries:e,setEditEntry:t,setEditClockIn:r,setEditClockOut:n,setEditEntryError:a,setError:o,onDeleteEntry:s}){return i.jsx(va,{sx:{mt:1,mb:1},children:i.jsxs(sa,{size:"small",children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{children:"Sales Order"}),i.jsx(Pe,{children:"Clock In"}),i.jsx(Pe,{children:"Clock Out"}),i.jsx(Pe,{children:"Duration"}),i.jsx(Pe,{children:"Actions"})]})}),i.jsx(ca,{children:e.map(l=>i.jsxs(br,{children:[i.jsx(Pe,{children:l.sales_order_number}),i.jsx(Pe,{children:new Date(l.clock_in).toLocaleTimeString()}),i.jsx(Pe,{children:l.clock_out?new Date(l.clock_out).toLocaleTimeString():"-"}),i.jsx(Pe,{children:Ev(l.duration)}),i.jsxs(Pe,{children:[l.clock_out&&i.jsx(ye,{variant:"text",startIcon:i.jsx(Ip,{}),onClick:()=>{a(null),o(null),t(l),r(Vl(l.clock_in)),n(Vl(l.clock_out))},sx:{ml:1},children:"Edit"}),s&&i.jsx(ye,{variant:"text",color:"error",startIcon:i.jsx(Id,{}),onClick:()=>s(l),sx:{ml:l.clock_out?1:0},children:"Delete"})]})]},l.id))})]})})}const Wo={submitRequest:async e=>(await ve.post("/api/leave-management/request",e)).data,getMyRequests:async()=>(await ve.get("/api/leave-management/my-requests")).data,getAllRequests:async()=>(await ve.get("/api/leave-management/all-requests")).data,getCalendar:async(e,t)=>{const r={};return e&&(r.start_date=e),t&&(r.end_date=t),(await ve.get("/api/leave-management/calendar",{params:r})).data},approveRequest:async(e,t,r,n)=>(await ve.post(`/api/leave-management/approve/${e}`,{admin_notes:t,proposed_start_date:r,proposed_end_date:n})).data,denyRequest:async(e,t)=>(await ve.post(`/api/leave-management/deny/${e}`,{admin_notes:t})).data,proposeVacationDates:async(e,t,r,n)=>(await ve.post(`/api/leave-management/propose/${e}`,{proposed_start_date:t,proposed_end_date:r,admin_notes:n})).data,getProfiles:async()=>(await ve.get("/api/leave-management/profiles")).data,getLeaveHistory:async()=>(await ve.get("/api/leave-management/history")).data,getVacationSettings:async()=>(await ve.get("/api/leave-management/vacation-settings")).data,updateVacationSettings:async e=>(await ve.put("/api/leave-management/vacation-settings",{reset_date:e})).data,updateEmployeeVacationDays:async(e,t)=>(await ve.put(`/api/leave-management/profiles/${e}/vacation-days`,{total_vacation_days:t})).data,resetAllVacationDays:async()=>(await ve.post("/api/leave-management/reset-vacation-days")).data,getLeaveStatistics:async()=>(await ve.get("/api/leave-management/statistics")).data},Hfe=()=>{const{user:e}=ea(),t=Nn(),[r,n]=y.useState([]),[a,o]=y.useState([]),[s,l]=y.useState(!0),[c,u]=y.useState(null),[d,f]=y.useState(()=>{const P=Rt(),$=P.day();return P.subtract($,"day").startOf("day")}),[h,p]=y.useState({open:!1,requestId:0,action:"approve"}),[g,m]=y.useState(""),[x,b]=y.useState(null),[_,w]=y.useState(null),[A,O]=y.useState(!1),[T,E]=y.useState(!0);y.useEffect(()=>{console.log("LeaveManagementPage - User data:",e),(e?.access_role==="Admin"||e?.access_role==="Time Tracking")&&S()},[e]);const S=async()=>{try{console.log("LeaveManagementPage - Fetching data..."),l(!0);const[P,$]=await Promise.all([Wo.getAllRequests(),Wo.getProfiles()]);console.log("LeaveManagementPage - Data received:",{requestsData:P,profilesData:$}),n(P||[]),o($||[]),u(null)}catch(P){console.error("LeaveManagementPage - Error fetching data:",P),u(P.response?.data?.message||"Failed to load data. Please try again.")}finally{l(!1)}},I=()=>{const P=[],$=Rt();for(let Q=0;Q<7;Q++){const C=d.add(Q,"day"),L=C.isSame($,"day"),H=r.filter(U=>{if(U.status!=="approved")return!1;const te=Rt(U.start_date),le=Rt(U.end_date);return(te.isSame(C,"day")||te.isBefore(C))&&(le.isSame(C,"day")||le.isAfter(C))}).map(U=>U.profile_name);P.push({date:C,isToday:L,hasTimeOff:H.length>0,timeOffProfiles:H})}return P},z=P=>{f(P==="prev"?$=>$.subtract(7,"day"):$=>$.add(7,"day"))},k=()=>{const P=Rt(),$=P.day();f(P.subtract($,"day").startOf("day"))},M=()=>{const P=d.add(6,"day");return r.filter($=>{if($.status!=="approved")return!1;const Q=Rt($.start_date),C=Rt($.end_date);return(Q.isSame(P,"day")||Q.isBefore(P))&&(C.isSame(d,"day")||C.isAfter(d))}).map($=>({profileName:$.profile_name,startDate:Rt($.start_date),endDate:Rt($.end_date),requestType:$.request_type,reason:$.reason})).sort(($,Q)=>$.startDate.valueOf()-Q.startDate.valueOf())},R=()=>{const P=Rt(),$=P.startOf("month"),Q=P.endOf("month");return r.filter(L=>{if(L.status!=="approved")return!1;const H=Rt(L.start_date),U=Rt(L.end_date);return(H.isSame(Q,"day")||H.isBefore(Q))&&(U.isSame($,"day")||U.isAfter($))}).map(L=>({profileName:L.profile_name,startDate:Rt(L.start_date),endDate:Rt(L.end_date),requestType:L.request_type})).sort((L,H)=>L.startDate.valueOf()-H.startDate.valueOf())},F=()=>{const P=R();if(P.length===0)return"No employees on leave this month";const $=new Map;return P.forEach(C=>{$.has(C.profileName)||$.set(C.profileName,[]),$.get(C.profileName).push(C)}),Array.from($.entries()).map(([C,L])=>{const H=L.map(U=>{const te=U.startDate.format("MMM D"),le=U.endDate.format("MMM D");return`${te}-${le}`}).join(", ");return`${C}: ${H}`}).slice(0,3).join("  ")},W=(P,$)=>{p({open:!0,requestId:P,action:$}),m(""),b(null),w(null)},K=async()=>{O(!0);try{const{requestId:P,action:$}=h;if($==="approve")await Wo.approveRequest(P,g,x?.format("YYYY-MM-DD"),_?.format("YYYY-MM-DD"));else if($==="deny")await Wo.denyRequest(P,g);else if($==="propose"){if(!x||!_){u("Please enter both start and end dates"),O(!1);return}if(_.isBefore(x)){u("End date cannot be before start date"),O(!1);return}await Wo.proposeVacationDates(P,x.format("YYYY-MM-DD"),_.format("YYYY-MM-DD"),g)}p({open:!1,requestId:0,action:"approve"}),await S()}catch(P){u(P.response?.data?.message||"Action failed. Please try again.")}finally{O(!1)}},Z=P=>{const Q={pending:{color:"warning",label:"Pending"},approved:{color:"success",label:"Approved"},denied:{color:"error",label:"Denied"},modified:{color:"info",label:"Modified"}}[P]||{color:"default",label:P};return i.jsx(ot,{label:Q.label,color:Q.color,size:"small"})},D=P=>({vacation:"Vacation",sick:"Sick Day",personal:"Personal",bereavement:"Bereavement"})[P]||P;return e?e.access_role!=="Admin"&&e.access_role!=="Time Tracking"?i.jsx(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(Ot,{severity:"error",children:"Access denied. Admin or Time Tracking privileges required to view this page."})}):s?i.jsx(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(J,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:i.jsx(nr,{})})}):i.jsx(Os,{dateAdapter:oc,children:i.jsxs(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsxs(B,{variant:"h4",component:"h1",children:["Leave Management",e.access_role==="Admin"?" (Admin)":" (View Only)"]}),i.jsxs(J,{display:"flex",gap:2,children:[i.jsx(ye,{variant:"outlined",startIcon:i.jsx($2,{}),onClick:()=>t("/leave-history"),children:"View History"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Uu,{}),onClick:()=>t("/vacation-days-management"),children:"Manage Vacation Days"})]})]}),i.jsx(B,{variant:"body1",color:"text.secondary",paragraph:!0,children:F()}),c&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:c}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsxs(xt,{sx:{p:3},children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsxs(B,{variant:"h6",children:[i.jsx(zu,{sx:{mr:1,verticalAlign:"middle"}}),"Weekly Leave Schedule"]}),i.jsxs(J,{display:"flex",gap:1,children:[i.jsx(ye,{variant:"outlined",size:"small",onClick:()=>z("prev"),startIcon:i.jsx(T8,{}),children:"Previous Week"}),i.jsx(ye,{variant:"outlined",size:"small",onClick:k,startIcon:i.jsx(E8,{}),children:"Today"}),i.jsx(ye,{variant:"outlined",size:"small",onClick:()=>z("next"),endIcon:i.jsx(I8,{}),children:"Next Week"})]})]}),i.jsxs(B,{variant:"body2",color:"text.secondary",mb:3,children:["Week of ",d.format("MMMM D, YYYY")]}),i.jsx(J,{sx:{overflowX:"auto"},children:i.jsx(va,{component:xt,variant:"outlined",children:i.jsxs(sa,{size:"small",children:[i.jsx(la,{children:i.jsxs(br,{sx:{backgroundColor:"grey.50"},children:[i.jsx(Pe,{sx:{fontWeight:"bold",minWidth:140},children:"Employee Name"}),I().map((P,$)=>i.jsx(Pe,{align:"center",sx:{fontWeight:"bold",minWidth:70},children:i.jsxs(J,{children:[i.jsx(B,{variant:"caption",display:"block",sx:{fontWeight:"bold"},children:P.date.format("ddd")}),i.jsx(B,{variant:"body2",children:P.date.format("MMM D")}),P.isToday&&i.jsx(B,{variant:"caption",display:"block",sx:{color:"primary.main",fontWeight:"bold"},children:"Today"})]})},$))]})}),i.jsxs(ca,{children:[M().map((P,$)=>i.jsxs(br,{hover:!0,children:[i.jsx(Pe,{sx:{fontWeight:"medium"},children:P.profileName}),I().map((Q,C)=>{const L=(P.startDate.isSame(Q.date,"day")||P.startDate.isBefore(Q.date))&&(P.endDate.isSame(Q.date,"day")||P.endDate.isAfter(Q.date));return i.jsx(Pe,{align:"center",sx:{backgroundColor:L?"error.light":"inherit",color:L?"error.dark":"text.primary",fontWeight:L?"medium":"normal"},children:L?i.jsxs(J,{children:[i.jsx(B,{variant:"caption",display:"block",sx:{fontWeight:"bold",textTransform:"capitalize"},children:D(P.requestType)}),P.reason&&i.jsx(En,{title:P.reason,children:i.jsx(B,{variant:"caption",sx:{opacity:.75},children:P.reason.length>8?P.reason.substring(0,8)+"...":P.reason})})]}):i.jsx(B,{variant:"body2",color:"text.secondary",children:"-"})},C)})]},$)),M().length===0&&i.jsx(br,{children:i.jsx(Pe,{colSpan:8,align:"center",sx:{py:4},children:i.jsxs(J,{sx:{textAlign:"center"},children:[i.jsx(zu,{sx:{fontSize:48,color:"text.secondary",mb:2}}),i.jsx(B,{color:"text.secondary",children:"No employees on leave this week"})]})})})]})]})})})]})}),i.jsx(ie,{item:!0,xs:12,children:i.jsxs(xt,{sx:{p:3},children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsxs(B,{variant:"h6",children:[i.jsx(N8,{sx:{mr:1,verticalAlign:"middle"}}),"Leave Requests",e.access_role!=="Admin"&&i.jsx(B,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:1},children:"View-only mode. Admin actions are restricted to administrators."})]}),i.jsxs(J,{display:"flex",alignItems:"center",gap:2,children:[i.jsx(B,{variant:"body2",color:"text.secondary",children:"Show:"}),i.jsx(ye,{variant:T?"contained":"outlined",size:"small",onClick:()=>E(!0),sx:{minWidth:100},children:"Pending"}),i.jsx(ye,{variant:T?"outlined":"contained",size:"small",onClick:()=>E(!1),sx:{minWidth:100},children:"All"})]})]}),i.jsx(va,{children:i.jsxs(sa,{children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{sx:{fontWeight:"bold"},children:"Employee"}),i.jsx(Pe,{sx:{fontWeight:"bold"},children:"Type"}),i.jsx(Pe,{sx:{fontWeight:"bold"},children:"Dates"}),i.jsx(Pe,{sx:{fontWeight:"bold"},children:"Days"}),i.jsx(Pe,{sx:{fontWeight:"bold"},children:"Status"}),i.jsx(Pe,{sx:{fontWeight:"bold"},children:"Reason"}),i.jsx(Pe,{sx:{fontWeight:"bold"},children:"Admin Notes"}),i.jsx(Pe,{sx:{fontWeight:"bold"},children:"Actions"})]})}),i.jsx(ca,{children:(()=>{const P=T?r.filter($=>$.status==="pending"):r;return P.length===0?i.jsx(br,{children:i.jsx(Pe,{colSpan:8,align:"center",sx:{py:4},children:i.jsx(B,{color:"text.secondary",children:T?"No pending leave requests found":"No leave requests found"})})}):P.map($=>i.jsxs(br,{hover:!0,children:[i.jsx(Pe,{children:i.jsxs(J,{children:[i.jsx(B,{variant:"body2",sx:{fontWeight:"medium"},children:$.profile_name}),i.jsx(B,{variant:"caption",color:"text.secondary",children:$.user_email})]})}),i.jsx(Pe,{children:i.jsx(ot,{label:D($.request_type),size:"small",variant:"outlined"})}),i.jsxs(Pe,{children:[i.jsx(B,{variant:"body2",children:Rt($.start_date).format("MMM D, YYYY")}),i.jsxs(B,{variant:"body2",children:["to ",Rt($.end_date).format("MMM D, YYYY")]})]}),i.jsx(Pe,{children:i.jsxs(B,{variant:"body2",children:[$.total_days," day",$.total_days!==1?"s":""]})}),i.jsx(Pe,{children:Z($.status)}),i.jsx(Pe,{children:i.jsx(B,{variant:"body2",sx:{maxWidth:200},children:$.reason||"-"})}),i.jsx(Pe,{children:i.jsx(B,{variant:"body2",sx:{maxWidth:200},children:$.admin_notes||"-"})}),i.jsx(Pe,{children:$.status==="pending"&&e.access_role==="Admin"&&i.jsxs(J,{display:"flex",gap:1,children:[i.jsx(En,{title:"Approve Request",children:i.jsx(pr,{color:"success",size:"small",onClick:()=>W($.request_id,"approve"),children:i.jsx(jh,{})})}),i.jsx(En,{title:"Deny Request",children:i.jsx(pr,{color:"error",size:"small",onClick:()=>W($.request_id,"deny"),children:i.jsx(Eu,{})})}),($.request_type==="vacation"||$.request_type==="personal"||$.request_type==="bereavement")&&i.jsx(En,{title:"Propose Dates",children:i.jsx(pr,{color:"info",size:"small",onClick:()=>W($.request_id,"propose"),children:i.jsx(zu,{})})})]})})]},$.request_id))})()})]})})]})})]}),i.jsxs(gr,{open:h.open,onClose:()=>p({open:!1,requestId:0,action:"approve"}),maxWidth:"sm",fullWidth:!0,children:[i.jsx(vr,{children:h.action==="approve"?"Approve Request":h.action==="deny"?"Deny Request":"Propose Dates"}),i.jsx(yr,{children:i.jsxs(J,{sx:{pt:2},children:[(h.action==="propose"||h.action==="approve")&&i.jsx(J,{sx:{mb:3},children:i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,children:i.jsx(os,{label:h.action==="propose"?"Proposed Start Date":"Proposed Start Date (Optional)",value:x,onChange:P=>b(P),slotProps:{textField:{fullWidth:!0,size:"small"}}})}),i.jsx(ie,{item:!0,xs:6,children:i.jsx(os,{label:h.action==="propose"?"Proposed End Date":"Proposed End Date (Optional)",value:_,onChange:P=>w(P),minDate:x,disabled:!x,slotProps:{textField:{fullWidth:!0,size:"small"}}})})]})}),i.jsx(Ae,{fullWidth:!0,multiline:!0,rows:3,label:"Admin Notes",value:g,onChange:P=>m(P.target.value),placeholder:"Add notes about this decision...",variant:"outlined",size:"small"})]})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:()=>p({open:!1,requestId:0,action:"approve"}),disabled:A,children:"Cancel"}),i.jsx(ye,{onClick:K,disabled:A,variant:"contained",color:h.action==="deny"?"error":"primary",children:A?"Processing...":h.action==="approve"?"Approve":h.action==="deny"?"Deny":"Propose"})]})]})]})}):i.jsx(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsxs(J,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:[i.jsx(nr,{}),i.jsx(B,{variant:"body2",sx:{ml:2},children:"Loading user data..."})]})})},Vfe=()=>{const{user:e}=ea(),[t,r]=y.useState([]),[n,a]=y.useState(null),[o,s]=y.useState(!0),[l,c]=y.useState(null);y.useEffect(()=>{(e?.access_role==="Admin"||e?.access_role==="Time Tracking")&&u()},[e]);const u=async()=>{try{s(!0);const[g,m]=await Promise.all([Wo.getLeaveHistory(),Wo.getLeaveStatistics()]);r(g||[]),a(m),c(null)}catch(g){console.error("Error fetching leave history:",g),c(g.response?.data?.message||"Failed to load leave history. Please try again.")}finally{s(!1)}},d=g=>Rt(g+"-01").format("MMMM YYYY"),f=g=>{let m=0;return Object.values(g.months).forEach(x=>{m+=x.total_days}),m},h=()=>{const g=new Set;return t.forEach(m=>{Object.keys(m.months).forEach(x=>g.add(x))}),Array.from(g).sort().reverse()};if(!e)return i.jsx(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsxs(J,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:[i.jsx(nr,{}),i.jsx(B,{variant:"body2",sx:{ml:2},children:"Loading user data..."})]})});if(e.access_role!=="Admin"&&e.access_role!=="Time Tracking")return i.jsx(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(Ot,{severity:"error",children:"Access denied. Admin or Time Tracking privileges required to view this page."})});if(o)return i.jsx(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(J,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:i.jsx(nr,{})})});const p=h();return i.jsxs(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(B,{variant:"h4",component:"h1",gutterBottom:!0,children:[i.jsx($2,{sx:{mr:1,verticalAlign:"middle"}}),"Leave History (Past 12 Months)"]}),i.jsx(B,{variant:"body1",color:"text.secondary",paragraph:!0,children:"View leave history for all employees over the past 12 months"}),l&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:l}),t.length===0?i.jsxs(xt,{sx:{p:4,textAlign:"center"},children:[i.jsx($2,{sx:{fontSize:64,color:"text.secondary",mb:2}}),i.jsx(B,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Leave History Found"}),i.jsx(B,{color:"text.secondary",children:"No approved leave requests found in the past 12 months."})]}):i.jsxs(J,{children:[i.jsxs(ie,{container:!0,spacing:3,sx:{mb:4},children:[i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(Br,{children:i.jsx(Vr,{children:i.jsxs(J,{display:"flex",alignItems:"center",children:[i.jsx(MI,{sx:{fontSize:40,color:"primary.main",mr:2}}),i.jsxs(J,{children:[i.jsx(B,{variant:"h4",component:"div",children:n?.employees_with_leave_this_month||0}),i.jsx(B,{color:"text.secondary",children:"Employees with Leave This Month"})]})]})})})}),i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(Br,{children:i.jsx(Vr,{children:i.jsxs(J,{display:"flex",alignItems:"center",children:[i.jsx(zu,{sx:{fontSize:40,color:"success.main",mr:2}}),i.jsxs(J,{children:[i.jsx(B,{variant:"h4",component:"div",children:n?.total_days_this_month||0}),i.jsx(B,{color:"text.secondary",children:"Total Days of Leave This Month"})]})]})})})}),i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(Br,{children:i.jsx(Vr,{children:i.jsxs(J,{display:"flex",alignItems:"center",children:[i.jsx(LI,{sx:{fontSize:40,color:"info.main",mr:2}}),i.jsxs(J,{children:[i.jsx(B,{variant:"h4",component:"div",children:n?.total_days_past_12_months||0}),i.jsx(B,{color:"text.secondary",children:"Total Days of Leave (Past 12 Months)"})]})]})})})})]}),t.map(g=>i.jsxs(D8,{sx:{mb:2},children:[i.jsx(M8,{expandIcon:i.jsx(RI,{}),children:i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",children:[i.jsxs(J,{children:[i.jsx(B,{variant:"h6",children:g.profile_name}),i.jsx(B,{variant:"body2",color:"text.secondary",children:g.profile_email})]}),i.jsxs(J,{display:"flex",alignItems:"center",gap:2,children:[i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Total: ",f(g).toFixed(1)," days"]}),i.jsx(ot,{label:`${Object.keys(g.months).length} months`,size:"small",variant:"outlined"})]})]})}),i.jsx(L8,{children:i.jsx(va,{component:xt,variant:"outlined",children:i.jsxs(sa,{size:"small",children:[i.jsx(la,{children:i.jsxs(br,{sx:{backgroundColor:"grey.50"},children:[i.jsx(Pe,{sx:{fontWeight:"bold"},children:"Month"}),i.jsx(Pe,{align:"center",sx:{fontWeight:"bold"},children:"Vacation"}),i.jsx(Pe,{align:"center",sx:{fontWeight:"bold"},children:"Sick"}),i.jsx(Pe,{align:"center",sx:{fontWeight:"bold"},children:"Personal"}),i.jsx(Pe,{align:"center",sx:{fontWeight:"bold"},children:"Bereavement"}),i.jsx(Pe,{align:"center",sx:{fontWeight:"bold"},children:"Total"})]})}),i.jsx(ca,{children:p.map(m=>{const x=g.months[m];return!x||x.total_days===0?null:i.jsxs(br,{hover:!0,children:[i.jsx(Pe,{sx:{fontWeight:"medium"},children:d(m)}),i.jsx(Pe,{align:"center",children:x.vacation_days>0?i.jsx(ot,{label:x.vacation_days,size:"small",color:"success",variant:"outlined"}):"-"}),i.jsx(Pe,{align:"center",children:x.sick_days>0?i.jsx(ot,{label:x.sick_days,size:"small",color:"error",variant:"outlined"}):"-"}),i.jsx(Pe,{align:"center",children:x.personal_days>0?i.jsx(ot,{label:x.personal_days,size:"small",color:"info",variant:"outlined"}):"-"}),i.jsx(Pe,{align:"center",children:x.bereavement_days>0?i.jsx(ot,{label:x.bereavement_days,size:"small",color:"warning",variant:"outlined"}):"-"}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"body2",sx:{fontWeight:"bold"},children:x.total_days})})]},m)})})]})})})]},g.profile_id))]})]})},Gfe=()=>{const{user:e}=ea(),[t,r]=y.useState([]),[n,a]=y.useState(null),[o,s]=y.useState(!0),[l,c]=y.useState(null),[u,d]=y.useState(null),[f,h]=y.useState(0),[p,g]=y.useState(!1),[m,x]=y.useState(null),[b,_]=y.useState(!1);y.useEffect(()=>{e?.access_role==="Admin"&&w()},[e]);const w=async()=>{try{s(!0);const[R,F]=await Promise.all([Wo.getProfiles(),Wo.getVacationSettings()]);r(R||[]),a(F),c(null)}catch(R){console.error("Error fetching data:",R),c(R.response?.data?.message||"Failed to load data. Please try again.")}finally{s(!1)}},A=R=>{d(R.id),h(R.total_vacation_days||R.vacation_days_available||20)},O=async()=>{if(!u)return;const R=Math.round(f);try{_(!0),await Wo.updateEmployeeVacationDays(u,R),await w(),d(null),h(0)}catch(F){c(F.response?.data?.message||"Failed to update vacation days.")}finally{_(!1)}},T=()=>{d(null),h(0)},E=()=>{x(n?.reset_date?Rt(n.reset_date):null),g(!0)},S=async()=>{if(!m){c("Please select a reset date.");return}try{_(!0),await Wo.updateVacationSettings(m.format("YYYY-MM-DD")),await w(),g(!1)}catch(R){c(R.response?.data?.message||"Failed to update settings.")}finally{_(!1)}},I=async()=>{if(window.confirm("This will reset vacation days for ALL employees. Are you sure?"))try{_(!0),await Wo.resetAllVacationDays(),await w()}catch(R){c(R.response?.data?.message||"Failed to reset vacation days.")}finally{_(!1)}};if(!e)return i.jsx(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsxs(J,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:[i.jsx(nr,{}),i.jsx(B,{variant:"body2",sx:{ml:2},children:"Loading user data..."})]})});if(e.access_role!=="Admin")return i.jsx(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(Ot,{severity:"error",children:"Access denied. Admin privileges required to view this page."})});if(o)return i.jsx(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(J,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:i.jsx(nr,{})})});const z=t.length,k=t.reduce((R,F)=>R+(F.total_vacation_days||F.vacation_days_available||20),0),M=t.reduce((R,F)=>R+Math.round(F.days_used||0),0);return i.jsx(Os,{dateAdapter:oc,children:i.jsxs(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsxs(B,{variant:"h4",component:"h1",children:[i.jsx(Uu,{sx:{mr:1,verticalAlign:"middle"}}),"Vacation Days Management"]}),i.jsxs(J,{display:"flex",gap:2,children:[i.jsx(ye,{variant:"outlined",startIcon:i.jsx(zu,{}),onClick:E,children:"Reset Settings"}),i.jsx(ye,{variant:"contained",color:"warning",startIcon:i.jsx(Zw,{}),onClick:I,disabled:b,children:"Reset All Days"})]})]}),i.jsx(B,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Manage vacation days allocation for each employee and set the global reset date."}),l&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:l}),i.jsxs(ie,{container:!0,spacing:3,sx:{mb:4},children:[i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsx(Br,{children:i.jsx(Vr,{children:i.jsxs(J,{display:"flex",alignItems:"center",children:[i.jsx(MI,{sx:{fontSize:40,color:"primary.main",mr:2}}),i.jsxs(J,{children:[i.jsx(B,{variant:"h4",component:"div",children:z}),i.jsx(B,{color:"text.secondary",children:"Total Employees"})]})]})})})}),i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsx(Br,{children:i.jsx(Vr,{children:i.jsxs(J,{display:"flex",alignItems:"center",children:[i.jsx(zu,{sx:{fontSize:40,color:"success.main",mr:2}}),i.jsxs(J,{children:[i.jsx(B,{variant:"h4",component:"div",children:k}),i.jsx(B,{color:"text.secondary",children:"Total Days Allocated"})]})]})})})}),i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsx(Br,{children:i.jsx(Vr,{children:i.jsxs(J,{display:"flex",alignItems:"center",children:[i.jsx(LI,{sx:{fontSize:40,color:"info.main",mr:2}}),i.jsxs(J,{children:[i.jsx(B,{variant:"h4",component:"div",children:M}),i.jsx(B,{color:"text.secondary",children:"Days Used"})]})]})})})}),i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsx(Br,{children:i.jsx(Vr,{children:i.jsxs(J,{display:"flex",alignItems:"center",children:[i.jsx(Uu,{sx:{fontSize:40,color:"warning.main",mr:2}}),i.jsxs(J,{children:[i.jsx(B,{variant:"h6",component:"div",children:n?.reset_date?Rt(n.reset_date).format("MMM D, YYYY"):"Not Set"}),i.jsx(B,{color:"text.secondary",children:"Reset Date"})]})]})})})})]}),i.jsxs(xt,{sx:{p:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Employee Vacation Days"}),i.jsx(va,{children:i.jsxs(sa,{children:[i.jsx(la,{children:i.jsxs(br,{sx:{backgroundColor:"grey.50"},children:[i.jsx(Pe,{sx:{fontWeight:"bold"},children:"Employee"}),i.jsx(Pe,{align:"center",sx:{fontWeight:"bold"},children:"Total Days"}),i.jsx(Pe,{align:"center",sx:{fontWeight:"bold"},children:"Days Used"}),i.jsx(Pe,{align:"center",sx:{fontWeight:"bold"},children:"Days Remaining"}),i.jsx(Pe,{align:"center",sx:{fontWeight:"bold"},children:"Reset Date"}),i.jsx(Pe,{align:"center",sx:{fontWeight:"bold"},children:"Actions"})]})}),i.jsx(ca,{children:t.map(R=>i.jsxs(br,{hover:!0,children:[i.jsx(Pe,{children:i.jsxs(J,{children:[i.jsx(B,{variant:"body2",sx:{fontWeight:"medium"},children:R.name}),i.jsx(B,{variant:"caption",color:"text.secondary",children:R.email})]})}),i.jsx(Pe,{align:"center",children:u===R.id?i.jsx(Ae,{type:"number",value:f,onChange:F=>h(Math.max(0,parseInt(F.target.value)||0)),size:"small",sx:{width:80},inputProps:{min:0,step:1}}):i.jsx(B,{variant:"body2",sx:{fontWeight:"bold"},children:R.total_vacation_days||R.vacation_days_available||20})}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"body2",color:"text.secondary",children:Math.round(R.days_used||0)})}),i.jsx(Pe,{align:"center",children:i.jsx(ot,{label:Math.round(R.days_remaining||R.vacation_days_available||20),size:"small",color:R.days_remaining&&R.days_remaining<5?"warning":"success",variant:"outlined"})}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"body2",color:"text.secondary",children:R.reset_date?Rt(R.reset_date).format("MMM D, YYYY"):"-"})}),i.jsx(Pe,{align:"center",children:u===R.id?i.jsxs(J,{display:"flex",gap:1,children:[i.jsx(En,{title:"Save",children:i.jsx(pr,{color:"success",size:"small",onClick:O,disabled:b,children:i.jsx(DI,{})})}),i.jsx(En,{title:"Cancel",children:i.jsx(pr,{color:"error",size:"small",onClick:T,disabled:b,children:i.jsx(Eu,{})})})]}):i.jsx(En,{title:"Edit Vacation Days",children:i.jsx(pr,{color:"primary",size:"small",onClick:()=>A(R),children:i.jsx(Ip,{})})})})]},R.id))})]})})]}),i.jsxs(gr,{open:p,onClose:()=>g(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(vr,{children:i.jsxs(J,{display:"flex",alignItems:"center",children:[i.jsx(Uu,{sx:{mr:1}}),"Vacation Reset Settings"]})}),i.jsx(yr,{children:i.jsxs(J,{sx:{pt:2},children:[i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Set the date when vacation days will reset for all employees. This date will be the same for everyone and will repeat on the same month and day every year (e.g., January 1st, July 1st, etc.)."}),i.jsx(os,{label:"Reset Date",value:m,onChange:R=>x(R),slotProps:{textField:{fullWidth:!0,size:"small"}}}),m&&i.jsxs(Ot,{severity:"info",sx:{mt:2},children:["Vacation days will reset on ",m.format("MMMM D")," every year for all employees."]})]})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:()=>g(!1),disabled:b,children:"Cancel"}),i.jsx(ye,{onClick:S,disabled:b||!m,variant:"contained",children:b?"Saving...":"Save Settings"})]})]})]})})},Yfe=async()=>(await ve.get("/api/products")).data,Kfe=()=>{const[e,t]=y.useState([]),[r,n]=y.useState(!1),[a,o]=y.useState(null),[s,l]=y.useState({page:0,pageSize:10}),[c,u]=y.useState(""),[d,f]=y.useState(!1),[h,p]=y.useState(null),[g,m]=y.useState(null);y.useEffect(()=>{x()},[]);const x=async()=>{n(!0),o(null);try{const S=[...await Yfe()].sort((I,z)=>Number(z.product_id)-Number(I.product_id));t(S)}catch{o("Failed to fetch products"),ge.error("Failed to fetch products")}finally{n(!1)}},b=e.filter(E=>{const S=c.toLowerCase();return E.product_name?.toLowerCase().includes(S)||E.product_description?.toLowerCase?.().includes(S)||String(E.product_id??"").toLowerCase().includes(S)}),_=async E=>{if(window.confirm("Are you sure you want to delete this product?"))try{await ve.delete(`/api/products/${E}`),t(S=>S.filter(I=>I.product_id!==E)),ge.success("Product deleted successfully")}catch{ge.error("Failed to delete product")}},w=()=>{const E=b.map(M=>({"Product ID":M.product_id,"Product Name":M.product_name,"Product Description":M.product_description??""})),S=Cl.unparse(E),I=new Blob([S],{type:"text/csv;charset=utf-8;"}),z=document.createElement("a"),k=URL.createObjectURL(I);z.href=k,z.setAttribute("download","products.csv"),z.style.visibility="hidden",document.body.appendChild(z),z.click(),document.body.removeChild(z),m("Products exported to CSV.")},A=()=>f(!0),O=()=>f(!1),T=[{field:"product_id",headerName:"Product ID",flex:.8,minWidth:110},{field:"product_name",headerName:"Product Name",flex:1.4,minWidth:200},{field:"product_description",headerName:"Product Description",flex:2,minWidth:250,valueGetter:E=>E.row.product_description??""},{field:"actions",headerName:"Actions",width:90,sortable:!1,filterable:!1,disableColumnMenu:!0,renderCell:E=>i.jsx(pr,{size:"small",color:"error",onClick:S=>{S.stopPropagation(),_(E.row.product_id)},children:i.jsx(ua,{})})}];return i.jsxs(ir,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(J,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Product List"}),i.jsx(J,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:i.jsxs(ct,{direction:"row",spacing:2,children:[i.jsx(ye,{variant:"contained",startIcon:i.jsx(Ba,{}),onClick:A,children:"New Product"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(da,{}),onClick:w,children:"Export CSV"})]})})]}),i.jsx(xt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(J,{sx:{p:2},children:[i.jsx(Ae,{fullWidth:!0,label:"Search",variant:"outlined",value:c,onChange:E=>u(E.target.value),InputProps:{startAdornment:i.jsx(oa,{position:"start",children:i.jsx(hi,{sx:{fontSize:22}})})},sx:{mb:2,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"small"}),i.jsx(Po,{rows:b.map(E=>({...E,id:E.product_id})),columns:T,loading:r,paginationModel:s,onPaginationModelChange:l,pageSizeOptions:[10,25,50],getRowId:E=>E.id,disableRowSelectionOnClick:!0,initialState:{sorting:{sortModel:[{field:"product_id",sort:"desc"}]}},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),h&&i.jsx(Ot,{severity:"error",sx:{mt:2},onClose:()=>p(null),children:h}),g&&i.jsx(Ot,{severity:"success",sx:{mt:2},onClose:()=>m(null),children:g}),a&&i.jsx(B,{color:"error",children:a}),i.jsx(SS,{open:d,onClose:O,onSave:async E=>{try{await ve.post("/api/products",E),ge.success("Product added successfully!"),f(!1),x()}catch{ge.error("Failed to add product")}},isEditMode:!1})]})},Qfe=({open:e,onClose:t,onSettingsSaved:r})=>{const[n,a]=y.useState({customBackupDir:"",customRestoreDir:""}),[o,s]=y.useState(!1),[l,c]=y.useState(!1),[u,d]=y.useState(null),[f,h]=y.useState(!1);y.useEffect(()=>{e&&p()},[e]);const p=async()=>{s(!0);try{const w=await ve.get("/api/backup/settings");a(w.data)}catch(w){console.error("Error fetching backup settings:",w),ge.error("Failed to load backup settings")}finally{s(!1)}},g=async()=>{c(!0);try{await ve.post("/api/backup/settings",n),ge.success("Backup settings saved successfully!"),r(),t()}catch(w){console.error("Error saving backup settings:",w),ge.error("Failed to save backup settings")}finally{c(!1)}},m=w=>{const A=w.target.files?.[0];A&&d(A)},x=async()=>{if(!u){ge.error("Please select a backup file to upload");return}h(!0);try{const w=new FormData;w.append("backup",u);const A=await ve.post("/api/backup/upload",w,{headers:{"Content-Type":"multipart/form-data"}});ge.success("Backup uploaded successfully!"),d(null),r(),t()}catch(w){console.error("Error uploading backup:",w),ge.error("Failed to upload backup file")}finally{h(!1)}},b=async()=>{try{if(window.api?.browseDirectory){const w=await window.api.browseDirectory({title:"Select Restore Directory"});w.success&&w.directory&&a(A=>({...A,customRestoreDir:w.directory}))}else ge.info("Please enter the restore directory path manually")}catch(w){console.error("Error browsing restore directory:",w),ge.error("Failed to browse directory")}},_=async()=>{try{if(window.api?.browseDirectory){const w=await window.api.browseDirectory({title:"Select Backup Directory"});w.success&&w.directory&&a(A=>({...A,customBackupDir:w.directory}))}else ge.info("In web version, please enter the backup directory path manually. Example: C:\\MyBackups or /home/user/backups")}catch(w){console.error("Error browsing backup directory:",w),ge.error("Failed to browse directory")}};return i.jsxs(gr,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,children:[i.jsx(vr,{children:i.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:1},children:[i.jsx(Uu,{}),"Backup Settings"]})}),i.jsx(yr,{children:o?i.jsx(J,{sx:{display:"flex",justifyContent:"center",p:3},children:i.jsx(nr,{})}):i.jsxs(J,{sx:{mt:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Custom Backup Directory"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Set a custom directory where backups will be stored on the server device. Note: Backups are created on the server, not your local device. The directory must be accessible from the server where the application is running."}),i.jsxs(ie,{container:!0,spacing:2,alignItems:"center",children:[i.jsx(ie,{item:!0,xs:!0,children:i.jsx(Ae,{fullWidth:!0,label:"Backup Directory Path",value:n.customBackupDir,onChange:w=>a(A=>({...A,customBackupDir:w.target.value})),placeholder:"e.g., C:\\MyBackups or /home/user/backups",helperText:n.customBackupDir?`Backups will be stored in: ${n.customBackupDir}`:"Leave empty to use default backup location (backups folder in server directory)"})}),i.jsx(ie,{item:!0,children:i.jsx(En,{title:"Browse for backup directory (Desktop app only)",children:i.jsx(pr,{onClick:_,children:i.jsx(s5,{})})})})]}),!n.customBackupDir&&i.jsxs(Ot,{severity:"info",sx:{mt:1},children:[i.jsx(ax,{children:"Default Backup Location"}),"Backups will be stored in the default location: ",i.jsx("strong",{children:"backups/"})," folder in the server directory. To use a custom location, enter a valid directory path above."]}),n.customBackupDir&&!n.customDirExists&&i.jsxs(Ot,{severity:"warning",sx:{mt:1},children:[i.jsx(ax,{children:"Directory Not Found"}),"The specified backup directory does not exist: ",i.jsx("strong",{children:n.customBackupDir}),"Backups will fall back to the default location until this directory is created."]}),n.currentBackupDir&&i.jsxs(Ot,{severity:"success",sx:{mt:1},children:[i.jsx(ax,{children:"Current Backup Location"}),"Backups are currently being stored in: ",i.jsx("strong",{children:n.currentBackupDir})]}),i.jsx(Gn,{sx:{my:3}}),i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Custom Restore Directory"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Set a custom directory on the server to look for backup files when restoring. Note: This directory must be accessible from the server."}),i.jsxs(ie,{container:!0,spacing:2,alignItems:"center",children:[i.jsx(ie,{item:!0,xs:!0,children:i.jsx(Ae,{fullWidth:!0,label:"Restore Directory Path",value:n.customRestoreDir,onChange:w=>a(A=>({...A,customRestoreDir:w.target.value})),placeholder:"e.g., C:\\ExternalBackups or /home/user/external-backups",helperText:"Leave empty to use default restore location"})}),i.jsx(ie,{item:!0,children:i.jsx(En,{title:"Browse for restore directory",children:i.jsx(pr,{onClick:b,children:i.jsx(s5,{})})})})]}),i.jsx(Gn,{sx:{my:3}}),i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Upload External Backup"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Upload a backup file from your device to restore from"}),i.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsxs(ye,{variant:"outlined",component:"label",startIcon:i.jsx(fg,{}),disabled:f,children:["Select Backup File",i.jsx("input",{type:"file",hidden:!0,accept:".zip,.sql,.json",onChange:m})]}),u&&i.jsxs(B,{variant:"body2",children:["Selected: ",u.name]}),u&&i.jsx(ye,{variant:"contained",onClick:x,disabled:f,startIcon:f?i.jsx(nr,{size:20}):i.jsx(fg,{}),children:f?"Uploading...":"Upload & Restore"})]}),i.jsx(Ot,{severity:"info",sx:{mt:2},children:i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"Note:"})," Custom directories must be accessible by the application. Make sure the directories exist and have proper read/write permissions."]})})]})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:t,children:"Cancel"}),i.jsx(ye,{onClick:g,variant:"contained",disabled:l||o,startIcon:l?i.jsx(nr,{size:20}):void 0,children:l?"Saving...":"Save Settings"})]})]})},Xfe=()=>{const[e,t]=y.useState([]),[r,n]=y.useState(null),[a,o]=y.useState(!1),[s,l]=y.useState(!1),[c,u]=y.useState(null),[d,f]=y.useState(null),[h,p]=y.useState(null),[g,m]=y.useState(!1),x=async()=>{o(!0);try{const[I,z]=await Promise.all([ve.get("/api/backup/list"),ve.get("/api/backup/stats")]);t(I.data.backups),n(z.data)}catch(I){console.error("Error fetching backups:",I),ge.error("Failed to fetch backups")}finally{o(!1)}};y.useEffect(()=>{x()},[]);const b=async()=>{l(!0);try{const I=await ve.post("/api/backup/create");ge.success("Backup created successfully!"),x()}catch(I){console.error("Error creating backup:",I),ge.error("Failed to create backup")}finally{l(!1)}},_=async I=>{try{const z=await ve.get(`/api/backup/download/${I}`,{responseType:"blob"}),k=window.URL.createObjectURL(new Blob([z.data])),M=document.createElement("a");M.href=k,M.setAttribute("download",I),document.body.appendChild(M),M.click(),M.remove(),window.URL.revokeObjectURL(k),ge.success("Backup downloaded successfully!")}catch(z){console.error("Error downloading backup:",z),ge.error("Failed to download backup")}},w=async I=>{try{await ve.delete(`/api/backup/delete/${I}`),ge.success("Backup deleted successfully!"),f(null),x()}catch(z){console.error("Error deleting backup:",z),ge.error("Failed to delete backup")}},A=async I=>{u(I.manifest);try{const k=(await ve.post(`/api/backup/restore/${I.manifest}`)).data.results,M=Object.values(k).filter(F=>F==="success").length,R=Object.keys(k).length;M===R?ge.success("Backup restored successfully! Please refresh the page."):ge.warning(`Restore completed with ${M}/${R} components successful`),p(null),u(null)}catch(z){console.error("Error restoring backup:",z),ge.error("Failed to restore backup"),u(null)}},O=I=>{if(I===0)return"0 Bytes";const z=1024,k=["Bytes","KB","MB","GB"],M=Math.floor(Math.log(I)/Math.log(z));return parseFloat((I/Math.pow(z,M)).toFixed(2))+" "+k[M]},T=I=>I.replace(/(\d{4}-\d{2}-\d{2})T(\d{2})-(\d{2})-(\d{2})-(\d{3})Z/,"$1T$2:$3:$4.$5Z"),E=I=>new Date(T(I)).toLocaleString(),S=I=>{const z=I.components,k=Object.keys(z).length;return`${Object.values(z).filter(R=>R!==null).length}/${k}`};return i.jsxs(ir,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(J,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Backup Management"}),i.jsx(B,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:"Create, manage, and restore backups of your application data"})]}),r&&i.jsxs(ie,{container:!0,spacing:3,sx:{mb:4},children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Br,{children:i.jsxs(Vr,{children:[i.jsx(B,{color:"text.secondary",gutterBottom:!0,children:"Total Backups"}),i.jsx(B,{variant:"h4",component:"div",children:r.total_backups})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Br,{children:i.jsxs(Vr,{children:[i.jsx(B,{color:"text.secondary",gutterBottom:!0,children:"Total Size"}),i.jsx(B,{variant:"h4",component:"div",children:O(r.total_size)})]})})})]}),i.jsxs(J,{sx:{mb:3,display:"flex",gap:2,flexWrap:"wrap"},children:[i.jsx(ye,{variant:"contained",startIcon:s?i.jsx(nr,{size:20}):i.jsx(Xw,{}),onClick:b,disabled:s,children:s?"Creating Backup...":"Create Backup"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Zw,{}),onClick:x,disabled:a,children:"Refresh"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Uu,{}),onClick:()=>m(!0),children:"Backup Settings"})]}),i.jsx(Ot,{severity:"warning",sx:{mb:3},children:i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"Important:"})," Restoring a backup will overwrite your current data. Make sure you have a backup of your current data before proceeding."]})}),i.jsx(xt,{sx:{width:"100%",overflow:"hidden"},children:i.jsx(va,{children:i.jsxs(sa,{children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{children:"Date & Time"}),i.jsx(Pe,{children:"Components"}),i.jsx(Pe,{children:"Size"}),i.jsx(Pe,{children:"System Info"}),i.jsx(Pe,{align:"center",children:"Actions"})]})}),i.jsx(ca,{children:a?i.jsx(br,{children:i.jsx(Pe,{colSpan:5,align:"center",children:i.jsx(nr,{})})}):e.length===0?i.jsx(br,{children:i.jsx(Pe,{colSpan:5,align:"center",children:i.jsx(B,{variant:"body2",color:"text.secondary",children:"No backups found. Create your first backup to get started."})})}):e.map(I=>i.jsxs(br,{hover:!0,children:[i.jsx(Pe,{children:i.jsx(B,{variant:"body2",children:E(I.timestamp)})}),i.jsxs(Pe,{children:[i.jsxs(J,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[I.components.database&&i.jsx(ot,{label:"Database",size:"small",color:"primary"}),I.components.uploads&&i.jsx(ot,{label:"Uploads",size:"small",color:"secondary"}),I.components.config&&i.jsx(ot,{label:"Config",size:"small",color:"default"})]}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[S(I)," components available"]})]}),i.jsx(Pe,{children:i.jsx(B,{variant:"body2",children:O(I.size)})}),i.jsx(Pe,{children:i.jsxs(B,{variant:"caption",color:"text.secondary",children:[I.system_info.platform,"  ",I.system_info.arch]})}),i.jsx(Pe,{align:"center",children:i.jsxs(J,{sx:{display:"flex",gap:1,justifyContent:"center"},children:[i.jsx(En,{title:"Download Backup",children:i.jsx(pr,{size:"small",onClick:()=>_(I.manifest),children:i.jsx(II,{})})}),i.jsx(En,{title:"Restore Backup",children:i.jsx(pr,{size:"small",color:"primary",onClick:()=>p(I),children:i.jsx(l5,{})})}),i.jsx(En,{title:"Delete Backup",children:i.jsx(pr,{size:"small",color:"error",onClick:()=>f(I.manifest),children:i.jsx(Id,{})})})]})})]},I.manifest))})]})})}),i.jsxs(gr,{open:!!d,onClose:()=>f(null),children:[i.jsx(vr,{children:"Delete Backup"}),i.jsx(yr,{children:i.jsx(B,{children:"Are you sure you want to delete this backup? This action cannot be undone."})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:()=>f(null),children:"Cancel"}),i.jsx(ye,{onClick:()=>d&&w(d),color:"error",variant:"contained",children:"Delete"})]})]}),i.jsxs(gr,{open:!!h,onClose:()=>p(null),maxWidth:"sm",fullWidth:!0,children:[i.jsx(vr,{children:i.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:1},children:[i.jsx(R8,{color:"warning"}),"Restore Backup"]})}),i.jsxs(yr,{children:[i.jsx(Ot,{severity:"warning",sx:{mb:2},children:i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"Warning:"})," This will overwrite your current data with the backup from"," ",h?E(h.timestamp):"","."]})}),i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Backup components:"}),i.jsxs(J,{sx:{display:"flex",gap:1,mb:2},children:[h?.components.database&&i.jsx(ot,{label:"Database",size:"small",color:"primary"}),h?.components.uploads&&i.jsx(ot,{label:"Uploads",size:"small",color:"secondary"}),h?.components.config&&i.jsx(ot,{label:"Config",size:"small",color:"default"})]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Make sure you have a backup of your current data before proceeding."})]}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:()=>p(null),children:"Cancel"}),i.jsx(ye,{onClick:()=>h&&A(h),color:"warning",variant:"contained",disabled:c===h?.manifest,startIcon:c===h?.manifest?i.jsx(nr,{size:20}):i.jsx(l5,{}),children:c===h?.manifest?"Restoring...":"Restore"})]})]}),i.jsx(Qfe,{open:g,onClose:()=>m(!1),onSettingsSaved:x})]})},Jfe=()=>{const{user:e}=ea(),[t,r]=y.useState([]),[n,a]=y.useState([]),[o,s]=y.useState([]),[l,c]=y.useState(""),[u,d]=y.useState(!0),[f,h]=y.useState(!1),[p,g]=y.useState(null),[m,x]=y.useState(!1),[b,_]=y.useState({name:"",email:"",phone_number:""}),[w,A]=y.useState(null),[O,T]=y.useState(!1),[E,S]=y.useState(null),I=y.useRef(null),z=(P,$)=>P?.response?.data?.message||P?.response?.data?.error||P?.message||$,k=P=>{I.current&&window.clearTimeout(I.current),S(P),I.current=window.setTimeout(()=>{S(null),I.current=null},2500)};y.useEffect(()=>()=>{I.current&&window.clearTimeout(I.current)},[]),y.useEffect(()=>{M()},[]),y.useEffect(()=>{l?R():a([])},[l]),y.useEffect(()=>{const P=setInterval(()=>{a($=>$.map(Q=>{if(!Q.clock_out){const C=new Date,L=new Date(Q.clock_in),H=(C.getTime()-L.getTime())/(1e3*60*60);return{...Q,duration:H}}return Q})),s($=>$.map(Q=>{if(!Q.clock_out){const C=new Date,L=new Date(Q.clock_in),H=(C.getTime()-L.getTime())/(1e3*60*60);return{...Q,duration:H}}return Q}))},1e3);return()=>clearInterval(P)},[]);const M=async()=>{try{d(!0);const P=await AS();r(P),F(P),g(null)}catch(P){g("Failed to fetch data. Please try again."),console.error("Error fetching data:",P)}finally{d(!1)}},R=async()=>{if(l)try{const P=await Ofe(l);a(P);const $=new Date;$.setDate($.getDate()-1);const Q=P.find(C=>!C.clock_out&&new Date(C.clock_in).toDateString()!==new Date().toDateString());T(!!Q)}catch(P){g("Failed to fetch shifts. Please try again."),console.error("Error fetching shifts:",P)}},F=async P=>{const $=P||t;if(!$.length){s([]);return}try{h(!0);const Q=[];await Promise.all($.map(async C=>{try{const L=await Dfe(C.id);L&&Q.push({...L,profile_name:C.name})}catch(L){console.error(`Failed to fetch active shift for profile ${C.id}`,L)}})),s(Q)}catch(Q){console.error("Error fetching active shifts:",Q)}finally{h(!1)}},W=async()=>{if(!l){g("Please select a profile");return}if(n.some(P=>!P.clock_out)){g("You are already clocked in. Please clock out first.");return}try{S(null);const P=await kfe(l);a([P,...n]),g(null),c(""),a([]),k("Successfully clocked in."),F()}catch(P){S(null),g(z(P,"Failed to clock in. Please try again.")),console.error("Error clocking in:",P)}},K=async P=>{try{S(null);const $=await Tfe(P);a(n.map(Q=>Q.id===P?$:Q)),g(null),c(""),a([]),k("Successfully clocked out."),F()}catch($){S(null),g(z($,"Failed to clock out. Please try again.")),console.error("Error clocking out:",$)}},Z=async()=>{if(!b.name||!b.email){g("Name and email are required");return}try{let P;w?(P=await cfe(w,b.name,b.email,b.phone_number||void 0),r($=>$.map(Q=>Q.id===w?P:Q)),ge.success("Profile updated")):(P=await lfe(b.name,b.email,b.phone_number||void 0),r([...t,P]),ge.success("Profile created")),x(!1),_({name:"",email:"",phone_number:""}),A(null),g(null)}catch(P){g("Failed to save profile. Please try again."),console.error("Error saving profile:",P)}},D=l&&n.some(P=>P.profile_id===l&&!P.clock_out);return u?i.jsx(J,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:i.jsx(nr,{})}):i.jsxs(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Attendance (Shift Tracking)"}),p&&i.jsx(Ot,{severity:"error",variant:"filled",sx:{mb:2,fontSize:"1.1rem",fontWeight:700,py:2},children:p}),O&&i.jsx(Ot,{severity:"warning",sx:{mb:2},children:"You have an unclosed shift from a previous day. Please clock out before starting a new shift."}),i.jsxs(gr,{open:!!E,onClose:()=>S(null),PaperProps:{sx:{px:6,py:4,textAlign:"center"}},children:[i.jsx(vr,{sx:{fontSize:"2rem"},children:"Success"}),i.jsx(yr,{children:i.jsx(B,{variant:"h4",component:"p",children:E})})]}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(xt,{sx:{p:2},children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[i.jsx(B,{variant:"h6",children:"Profile"}),e?.access_role!=="Time Tracking"&&i.jsx(ye,{startIcon:i.jsx(Iv,{}),onClick:()=>{A(null),_({name:"",email:"",phone_number:""}),x(!0)},children:"Add Profile"})]}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Select Profile"}),i.jsx(hn,{value:l,label:"Select Profile",onChange:P=>c(P.target.value),sx:{"& .MuiSelect-select":{fontSize:"1.25rem",py:1.5,minHeight:56}},MenuProps:{PaperProps:{sx:{"& .MuiMenuItem-root":{fontSize:"1.25rem",py:1.5,minHeight:56},"& .MuiMenuItem-root.Mui-selected, & .MuiMenuItem-root.Mui-selected:hover":{backgroundColor:"rgba(25, 118, 210, 0.2)",color:"primary.main",fontWeight:700},"& .MuiMenuItem-root:hover":{backgroundColor:"rgba(25, 118, 210, 0.15)"}}}},renderValue:P=>{const $=t.find(Q=>Q.id===P);return $?$.name:""},children:t.map(P=>i.jsxs(tr,{value:P.id,sx:{fontSize:"1.1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("span",{children:P.name}),e?.access_role==="Admin"&&i.jsxs(J,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(pr,{"aria-label":`Edit ${P.name}`,size:"small",edge:"end",onClick:$=>{$.preventDefault(),$.stopPropagation(),A(P.id),_({name:P.name||"",email:P.email||"",phone_number:P.phone_number||""}),x(!0)},sx:{color:"primary.main"},children:i.jsx(Ip,{fontSize:"small"})}),i.jsx(pr,{"aria-label":`Delete ${P.name}`,size:"small",edge:"end",onClick:async $=>{if($.preventDefault(),$.stopPropagation(),!!window.confirm(`Delete profile "${P.name}"? This cannot be undone.`))try{await ve.delete(`/api/time-tracking/profiles/${P.id}`),r(C=>C.filter(L=>L.id!==P.id)),l===P.id&&c(""),ge.success("Profile deleted")}catch(C){const L=C?.response?.data?.error||"Failed to delete profile";ge.error(L)}},sx:{color:"error.main"},children:i.jsx(Id,{fontSize:"small"})})]})]},P.id))})]})]})}),l&&!D&&i.jsx(ie,{item:!0,xs:12,children:i.jsx(xt,{sx:{p:2},children:i.jsx(J,{display:"flex",justifyContent:"center",gap:2,children:i.jsx(ye,{variant:"contained",sx:{backgroundColor:"green",px:4,py:2,fontSize:"1.2rem",fontWeight:700,borderRadius:"12px",minWidth:220,"&:hover":{backgroundColor:"darkgreen"}},onClick:W,children:"Clock In"})})})}),l&&i.jsx(ie,{item:!0,xs:12,children:i.jsxs(xt,{sx:{p:2},children:[i.jsx(J,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:i.jsxs(B,{variant:"h6",gutterBottom:!0,children:["Shift History for ",t.find(P=>P.id===l)?.name]})}),i.jsx(va,{children:i.jsxs(sa,{children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Clock In"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Clock Out"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Duration"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Actions"})]})}),i.jsx(ca,{children:n.map(P=>{const $=new Date(P.clock_in),Q=P.clock_out?new Date(P.clock_out):null,C=P.duration!==null&&P.duration!==void 0?Number(P.duration):null;return i.jsxs(br,{children:[i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:$.toLocaleString()}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:Q?Q.toLocaleString():"-"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:C!==null?`${C.toFixed(2)} hrs`:"-"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:!P.clock_out&&i.jsx(ye,{variant:"contained",sx:{backgroundColor:"red",px:3,py:1.5,fontSize:"1.1rem",fontWeight:700,borderRadius:"12px","&:hover":{backgroundColor:"darkred"}},onClick:()=>K(P.id),children:"Clock Out"})})]},P.id)})})]})})]})}),i.jsx(ie,{item:!0,xs:12,children:i.jsxs(xt,{sx:{p:2},children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[i.jsx(B,{variant:"h6",children:"Active Clock Ins"}),f&&i.jsx(nr,{size:24})]}),o.length===0&&!f?i.jsx(B,{color:"text.secondary",children:"No active clock ins."}):i.jsx(va,{children:i.jsxs(sa,{children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Profile"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Clock In"}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:"Duration"})]})}),i.jsx(ca,{children:o.map(P=>{const $=P.duration!==null&&P.duration!==void 0?Number(P.duration):null;return i.jsxs(br,{children:[i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:P.profile_name}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:new Date(P.clock_in).toLocaleString()}),i.jsx(Pe,{sx:{fontSize:"1.1rem"},children:$!==null?`${$.toFixed(2)} hrs`:"-"})]},P.id)})})]})})]})})]}),i.jsxs(gr,{open:m,onClose:()=>x(!1),children:[i.jsx(vr,{children:w?"Edit Profile":"Add Profile"}),i.jsxs(yr,{children:[i.jsx(Ae,{label:"Name",value:b.name,onChange:P=>_({...b,name:P.target.value}),fullWidth:!0,sx:{mb:2}}),i.jsx(Ae,{label:"Email",value:b.email,onChange:P=>_({...b,email:P.target.value}),fullWidth:!0,sx:{mb:2}}),i.jsx(Ae,{label:"Phone Number",value:b.phone_number,onChange:P=>_({...b,phone_number:P.target.value}),fullWidth:!0})]}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:()=>x(!1),children:"Cancel"}),i.jsx(ye,{onClick:Z,variant:"contained",children:"Save"})]})]})]})};var fh={},rI;function Zfe(){if(rI)return fh;rI=1;var e=cr();Object.defineProperty(fh,"__esModule",{value:!0}),fh.default=void 0;var t=e(dr()),r=ur();return fh.default=(0,t.default)((0,r.jsx)("path",{d:"M4 10h3v7H4zm6.5 0h3v7h-3zM2 19h20v3H2zm15-9h3v7h-3zm-5-9L2 6v2h20V6z"}),"AccountBalance"),fh}var ehe=Zfe();const Kw=It(ehe),the=()=>{const e=Nn(),[t,r]=y.useState(!0),[n,a]=y.useState(!1),[o,s]=y.useState([]),[l,c]=y.useState({}),[u,d]=y.useState(null),[f,h]=y.useState(null),[p,g]=y.useState(""),[m,x]=y.useState(""),[b,_]=y.useState(""),[w,A]=y.useState(""),[O,T]=y.useState(""),[E,S]=y.useState(""),[I,z]=y.useState(""),[k,M]=y.useState(""),[R,F]=y.useState(""),[W,K]=y.useState(""),[Z,D]=y.useState(""),[P,$]=y.useState(""),[Q,C]=y.useState(!1),[L,H]=y.useState(""),[U,te]=y.useState("");y.useEffect(()=>{oe()},[]);const le=()=>{const ee=`${Wu().baseURL}/api/qbo/auth`;window.location.href=ee},oe=async()=>{r(!0);try{const G=await ve.get("/api/qbo-accounts/test-connection");if(h(G.data),G.data.connected){const ee=await ve.get("/api/qbo-accounts/accounts");s(ee.data.accounts),c(ee.data.accountTypes);const se=await ve.get("/api/qbo-accounts/mapping");se.data.mapping&&(d(se.data.mapping),g(se.data.mapping.qbo_inventory_account_id),x(se.data.mapping.qbo_gst_account_id),_(se.data.mapping.qbo_ap_account_id),A(se.data.mapping.qbo_supply_expense_account_id||""),T(se.data.mapping.qbo_sales_account_id||""),S(se.data.mapping.qbo_labour_sales_account_id||""),z(se.data.mapping.qbo_ar_account_id||""),M(se.data.mapping.qbo_cogs_account_id||""),F(se.data.mapping.qbo_cost_of_labour_account_id||""),K(se.data.mapping.qbo_cost_of_materials_account_id||""),D(se.data.mapping.qbo_labour_expense_reduction_account_id||""),$(se.data.mapping.qbo_overhead_cogs_account_id||""))}}catch(G){console.error("Error loading QBO data:",G),ge.error("Failed to load QuickBooks data")}finally{r(!1)}},ae=async()=>{if(!p||!m||!b){ge.error("Please select all required accounts");return}a(!0);try{const G=await ve.post("/api/qbo-accounts/mapping",{qbo_inventory_account_id:p,qbo_gst_account_id:m,qbo_ap_account_id:b,qbo_supply_expense_account_id:w,qbo_sales_account_id:O,qbo_labour_sales_account_id:E,qbo_ar_account_id:I,qbo_cogs_account_id:k,qbo_cost_of_labour_account_id:R,qbo_cost_of_materials_account_id:W,qbo_labour_expense_reduction_account_id:Z,qbo_overhead_cogs_account_id:P});d(G.data.mapping),ge.success("Account mapping saved successfully")}catch(G){console.error("Error saving mapping:",G),ge.error("Failed to save account mapping")}finally{a(!1)}},he=G=>{const ee=G.AccountNumber?`#${G.AccountNumber}`:"";return`${G.Name} ${ee} (${G.AccountType})`},me=G=>{let ee=o.filter(se=>se.Classification===G);if(U){const se=U.toLowerCase();ee=ee.filter(V=>V.Name.toLowerCase().includes(se)||V.AccountNumber&&V.AccountNumber.includes(se)||V.Description&&V.Description.toLowerCase().includes(se))}return ee},X=()=>i.jsxs(gr,{open:Q,onClose:()=>C(!1),maxWidth:"md",fullWidth:!0,children:[i.jsxs(vr,{children:["QuickBooks Accounts - ",L]}),i.jsx(yr,{children:i.jsx(J,{sx:{mt:2},children:l[L]?.map(G=>i.jsx(Br,{sx:{mb:1,p:2},children:i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[i.jsxs(J,{children:[i.jsx(B,{variant:"h6",children:G.Name}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Type: ",G.AccountType," | Subtype: ",G.AccountSubType]}),G.AccountNumber&&i.jsxs(B,{variant:"body2",color:"primary",fontWeight:500,children:["Account #: ",G.AccountNumber]}),G.Description&&i.jsx(B,{variant:"body2",color:"text.secondary",children:G.Description})]}),i.jsx(ot,{label:G.AccountNumber||"No Number",size:"small",color:G.AccountNumber?"primary":"default",variant:"outlined"})]})},G.Id))})}),i.jsx(Cr,{children:i.jsx(ye,{onClick:()=>C(!1),children:"Close"})})]});return t?i.jsx(J,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:i.jsx(nr,{})}):i.jsxs(ir,{maxWidth:"lg",sx:{py:4},children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsxs(J,{display:"flex",alignItems:"center",children:[i.jsx(ye,{startIcon:i.jsx(Vp,{}),onClick:()=>e("/business-profile"),sx:{mr:2},children:"Back"}),i.jsx(B,{variant:"h4",component:"h1",children:"QuickBooks Account Mapping"})]}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Kw,{}),onClick:le,sx:{borderRadius:2,fontWeight:600},children:"Connect to QuickBooks"})]}),f&&i.jsx(Br,{sx:{mb:3},children:i.jsxs(Vr,{children:[i.jsxs(J,{display:"flex",alignItems:"center",gap:2,children:[f.connected?i.jsx(ac,{color:"success"}):i.jsx(Fy,{color:"error"}),i.jsx(B,{variant:"h6",children:f.connected?"Connected to QuickBooks":"Not Connected"})]}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mt:1},children:f.message}),f.connected&&f.realmId&&i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Realm ID: ",f.realmId]})]})}),f?.connected?i.jsxs(i.Fragment,{children:[i.jsx(ie,{container:!0,spacing:3,sx:{mb:3},children:Object.entries(l).map(([G,ee])=>i.jsx(ie,{item:!0,xs:12,sm:6,md:4,children:i.jsx(Br,{children:i.jsxs(Vr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:G}),i.jsx(B,{variant:"h4",color:"primary",children:ee.length}),i.jsx(ye,{size:"small",onClick:()=>{H(G),C(!0)},sx:{mt:1},children:"View Accounts"})]})})},G))}),i.jsxs(xt,{sx:{p:3},children:[i.jsx(B,{variant:"h5",gutterBottom:!0,children:"Map QuickBooks Accounts"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Select the QuickBooks accounts that correspond to your business accounts. Different companies use different account names, so choose the accounts that make sense for your business."}),i.jsxs(Ot,{severity:"info",sx:{mb:3},children:[i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"How this works:"})," Configure your QuickBooks accounts to map to your business transactions. Accounts used by both purchase orders and sales orders are shown at the top."]}),i.jsxs(B,{variant:"body2",sx:{mt:1},children:[i.jsx("strong",{children:"Purchase Orders:"})," Stock items  Inventory Account, Supply items  Supply Expense Account, GST  GST Account, Total  Accounts Payable."]}),i.jsxs(B,{variant:"body2",sx:{mt:1},children:[i.jsx("strong",{children:"Sales Orders:"})," Materials  Sales Account, Labour  Labour Sales Account, GST  GST Account, Total  Accounts Receivable, Costs  COGS Account."]})]}),i.jsx(J,{sx:{mb:3},children:i.jsx(Ae,{fullWidth:!0,label:"Search accounts by name, number, or description",value:U,onChange:G=>te(G.target.value),placeholder:"e.g., 1200, Inventory, GST...",size:"small",InputProps:{startAdornment:i.jsx(hi,{sx:{mr:1,color:"text.secondary"}})}})}),i.jsx(B,{variant:"h6",sx:{mt:4,mb:2,color:"primary.main"},children:"Shared Accounts (Purchase Orders & Sales Orders)"}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"GST/Tax Account"}),i.jsx(hn,{value:m,onChange:G=>x(G.target.value),label:"GST/Tax Account",children:me("Liability").map(G=>i.jsx(tr,{value:G.Id,children:he(G)},G.Id))})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Account for GST/HST/tax tracking (used by both purchase orders and sales orders)"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Inventory Account"}),i.jsx(hn,{value:p,onChange:G=>g(G.target.value),label:"Inventory Account",children:me("Asset").map(G=>i.jsx(tr,{value:G.Id,children:he(G)},G.Id))})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Account for tracking inventory (stock purchases and sales cost reduction)"})]})]}),i.jsx(B,{variant:"h6",sx:{mt:4,mb:2},children:"Purchase Order Account Mapping"}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Supply Expense Account"}),i.jsxs(hn,{value:w,onChange:G=>A(G.target.value),label:"Supply Expense Account",children:[i.jsx(tr,{value:"",children:i.jsx("em",{children:"Optional - Select an expense account"})}),me("Expense").map(G=>i.jsx(tr,{value:G.Id,children:he(G)},G.Id))]})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Account for supply items (e.g., Office Supplies, Tools, etc.) - Optional"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Accounts Payable"}),i.jsx(hn,{value:b,onChange:G=>_(G.target.value),label:"Accounts Payable",children:me("Liability").map(G=>i.jsx(tr,{value:G.Id,children:he(G)},G.Id))})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:'Account for tracking vendor payables (usually "Accounts Payable")'})]})]}),i.jsx(B,{variant:"h6",sx:{mt:4,mb:2},children:"Sales Order Account Mapping"}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Sales Account"}),i.jsx(hn,{value:O,onChange:G=>T(G.target.value),label:"Sales Account",children:me("Revenue").map(G=>i.jsx(tr,{value:G.Id,children:he(G)},G.Id))})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Revenue account for sales (e.g., Sales, Revenue, etc.) - Used for invoice creation"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Accounts Receivable"}),i.jsx(hn,{value:I,onChange:G=>z(G.target.value),label:"Accounts Receivable",children:me("Asset").map(G=>i.jsx(tr,{value:G.Id,children:he(G)},G.Id))})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:'Account for tracking customer receivables (usually "Accounts Receivable") - Used for invoice total amount'})]})]}),i.jsx(B,{variant:"h6",sx:{mt:4,mb:2},children:"Cost Accounts (Journal Entries)"}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Cost of Materials"}),i.jsxs(hn,{value:W,onChange:G=>K(G.target.value),label:"Cost of Materials",children:[i.jsx(tr,{value:"",children:i.jsx("em",{children:"Optional - Select an expense account"})}),me("Expense").map(G=>i.jsx(tr,{value:G.Id,children:he(G)},G.Id))]})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Expense account for tracking cost of materials sold - Used for COGS journal entries - Optional"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Cost of Labour"}),i.jsxs(hn,{value:R,onChange:G=>F(G.target.value),label:"Cost of Labour",children:[i.jsx(tr,{value:"",children:i.jsx("em",{children:"Optional - Select an expense account"})}),me("Expense").map(G=>i.jsx(tr,{value:G.Id,children:he(G)},G.Id))]})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Expense account for tracking cost of labour sold - Used for COGS journal entries - Optional"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Labour Expense Reduction Account"}),i.jsxs(hn,{value:Z,onChange:G=>D(G.target.value),label:"Labour Expense Reduction Account",children:[i.jsx(tr,{value:"",children:i.jsx("em",{children:"Optional - Select an expense account"})}),me("Expense").map(G=>i.jsx(tr,{value:G.Id,children:he(G)},G.Id))]})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Expense account for reducing labour costs when sold (e.g., Labour Expense, Wages Expense) - Used for COGS journal entries - Optional"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Overhead COGS Account"}),i.jsxs(hn,{value:P,onChange:G=>$(G.target.value),label:"Overhead COGS Account",children:[i.jsx(tr,{value:"",children:i.jsx("em",{children:"Optional - Select an expense account"})}),me("Expense").map(G=>i.jsx(tr,{value:G.Id,children:he(G)},G.Id))]})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Expense account for tracking overhead costs when sold - Used for COGS journal entries - Optional"})]})]}),i.jsx(J,{sx:{mt:3,display:"flex",justifyContent:"center"},children:i.jsx(ye,{variant:"outlined",onClick:()=>e("/overhead-management"),sx:{width:"100%",maxWidth:"600px",borderRadius:2,fontWeight:600,py:1.5,fontSize:"1.1rem"},children:"Manage Overhead Settings"})}),i.jsxs(J,{sx:{mt:3,display:"flex",gap:2},children:[i.jsx(ye,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:ae,disabled:n||!p||!m||!b,children:n?"Saving...":"Save Mapping"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Es,{}),onClick:oe,disabled:t,children:"Refresh"})]}),u&&i.jsxs(J,{sx:{mt:3,p:2,bgcolor:"grey.50",borderRadius:1},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Current Mapping"}),i.jsx(B,{variant:"subtitle2",color:"primary",sx:{mt:2,mb:1},children:"Shared Accounts (Purchase Orders & Sales Orders)"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["GST/Tax: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_gst_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Inventory: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_inventory_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})})]}),i.jsx(B,{variant:"subtitle2",color:"primary",sx:{mt:2,mb:1},children:"Purchase Order Accounts"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Supply Expense: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_supply_expense_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Accounts Payable: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_ap_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})})]}),i.jsx(B,{variant:"subtitle2",color:"primary",sx:{mt:2,mb:1},children:"Sales Order Accounts"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Sales: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_sales_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Accounts Receivable: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_ar_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})})]}),i.jsx(B,{variant:"subtitle2",color:"primary",sx:{mt:2,mb:1},children:"Cost Accounts"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Cost of Materials: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_cost_of_materials_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Cost of Labour: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_cost_of_labour_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Labour Expense Reduction: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_labour_expense_reduction_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Overhead COGS: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_overhead_cogs_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})})]})]})]})]}):i.jsx(Ot,{severity:"warning",sx:{mb:3},children:"Please connect your QuickBooks account first in the Business Profile page."}),X()]})},rhe=()=>{const e=Nn(),[t,r]=y.useState(!0),[n,a]=y.useState(!1),[o,s]=y.useState([]),[l,c]=y.useState({}),[u,d]=y.useState([]),[f,h]=y.useState(null),[p,g]=y.useState(!1),[m,x]=y.useState(""),[b,_]=y.useState(""),[w,A]=y.useState(!1),[O,T]=y.useState(null),[E,S]=y.useState({expense_account_id:"",percentage:"",description:""});y.useEffect(()=>{I()},[]);const I=async()=>{r(!0);try{const[D,P]=await Promise.all([ve.get("/api/qbo-accounts/accounts"),ve.get("/api/overhead/distribution")]);s(D.data.accounts||[]),c(D.data.accountTypes||{}),d(P.data||[]),h({connected:!0,message:"Connected to QuickBooks"})}catch(D){console.error("Error loading data:",D),h({connected:!1,message:D.response?.data?.error||"Failed to connect to QuickBooks"}),ge.error("Failed to load overhead management data")}finally{r(!1)}},z=async()=>{if(!E.expense_account_id||!E.percentage){ge.error("Please fill in all required fields");return}const D=parseFloat(E.percentage);if(isNaN(D)||D<=0||D>100){ge.error("Percentage must be between 0 and 100");return}const P=u.filter($=>$.id!==O?.id).reduce(($,Q)=>$+Q.percentage,0);if(P+D>100){ge.error(`Total percentage would exceed 100%. Current total: ${P}%, adding: ${D}%`);return}a(!0);try{O?(await ve.put(`/api/overhead/distribution/${O.id}`,{expense_account_id:E.expense_account_id,percentage:D,description:E.description}),ge.success("Distribution updated successfully")):(await ve.post("/api/overhead/distribution",{expense_account_id:E.expense_account_id,percentage:D,description:E.description}),ge.success("Distribution added successfully")),A(!1),T(null),S({expense_account_id:"",percentage:"",description:""}),I()}catch($){console.error("Error saving distribution:",$),ge.error($.response?.data?.error||"Failed to save distribution")}finally{a(!1)}},k=D=>{T(D),S({expense_account_id:D.expense_account_id,percentage:D.percentage.toString(),description:D.description}),A(!0)},M=async D=>{if(window.confirm("Are you sure you want to delete this distribution?"))try{await ve.delete(`/api/overhead/distribution/${D}`),ge.success("Distribution deleted successfully"),I()}catch(P){console.error("Error deleting distribution:",P),ge.error(P.response?.data?.error||"Failed to delete distribution")}},R=()=>{T(null),S({expense_account_id:"",percentage:"",description:""}),A(!0)},F=D=>`${D.Name} (${D.AccountType})`,W=D=>(l[D]||[]).filter(P=>P.Classification===D).map(P=>({label:F(P),value:P.Id,account:P})),K=()=>i.jsxs(gr,{open:p,onClose:()=>g(!1),maxWidth:"md",fullWidth:!0,children:[i.jsx(vr,{children:i.jsxs(J,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(Kw,{}),"QuickBooks Accounts"]})}),i.jsxs(yr,{children:[i.jsx(J,{mb:2,children:i.jsx(Ae,{fullWidth:!0,label:"Search accounts",value:b,onChange:D=>_(D.target.value),InputProps:{startAdornment:i.jsx(hi,{})}})}),i.jsxs(tn,{fullWidth:!0,sx:{mb:2},children:[i.jsx(fn,{children:"Account Type"}),i.jsxs(hn,{value:m,onChange:D=>x(D.target.value),label:"Account Type",children:[i.jsx(tr,{value:"",children:"All Types"}),i.jsx(tr,{value:"Asset",children:"Asset"}),i.jsx(tr,{value:"Liability",children:"Liability"}),i.jsx(tr,{value:"Equity",children:"Equity"}),i.jsx(tr,{value:"Revenue",children:"Revenue"}),i.jsx(tr,{value:"Expense",children:"Expense"})]})]}),i.jsx(J,{maxHeight:400,overflow:"auto",children:Object.entries(l).map(([D,P])=>{if(m&&D!==m)return null;const $=P.filter(Q=>Q.Name.toLowerCase().includes(b.toLowerCase())||Q.AccountType.toLowerCase().includes(b.toLowerCase()));return $.length===0?null:i.jsxs(J,{mb:3,children:[i.jsxs(B,{variant:"h6",gutterBottom:!0,children:[D," Accounts (",$.length,")"]}),i.jsx(ie,{container:!0,spacing:1,children:$.map(Q=>i.jsx(ie,{item:!0,xs:12,sm:6,md:4,children:i.jsxs(Br,{variant:"outlined",sx:{p:1},children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:Q.Name}),i.jsx(B,{variant:"caption",color:"textSecondary",children:Q.AccountType}),Q.AccountNumber&&i.jsxs(B,{variant:"caption",display:"block",color:"textSecondary",children:["#",Q.AccountNumber]})]})},Q.Id))})]},D)})})]}),i.jsx(Cr,{children:i.jsx(ye,{onClick:()=>g(!1),children:"Close"})})]}),Z=u.reduce((D,P)=>D+P.percentage,0);return i.jsxs(ir,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(pr,{onClick:()=>e(-1),children:i.jsx(Vp,{})}),i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Overhead Management"})]}),i.jsxs(ct,{direction:"row",spacing:2,children:[i.jsx(ye,{variant:"outlined",onClick:()=>g(!0),startIcon:i.jsx(Kw,{}),children:"View QBO Accounts"}),i.jsx(ye,{variant:"contained",onClick:R,startIcon:i.jsx(Ba,{}),children:"Add Distribution"}),i.jsx(ye,{variant:"outlined",onClick:I,startIcon:i.jsx(Es,{}),children:"Refresh"})]})]}),f&&i.jsx(Ot,{severity:f.connected?"success":"error",icon:f.connected?i.jsx(ac,{}):i.jsx(Fy,{}),sx:{mb:3},children:f.message}),i.jsxs(xt,{sx:{p:3,mb:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Distribution Summary"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Br,{children:i.jsxs(Vr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Total Distributions"}),i.jsx(B,{variant:"h4",children:u.length})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Br,{children:i.jsxs(Vr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Total Percentage"}),i.jsxs(B,{variant:"h4",color:Z===100?"success.main":"warning.main",children:[Z.toFixed(1),"%"]})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Br,{children:i.jsxs(Vr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Remaining"}),i.jsxs(B,{variant:"h4",color:Z>100?"error.main":"text.primary",children:[(100-Z).toFixed(1),"%"]})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Br,{children:i.jsxs(Vr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Status"}),i.jsx(ot,{label:Z===100?"Complete":Z>100?"Over 100%":"Incomplete",color:Z===100?"success":Z>100?"error":"warning"})]})})})]})]}),i.jsx(xt,{sx:{width:"100%",overflow:"hidden"},children:i.jsxs(J,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Expense Distributions"}),t?i.jsx(J,{display:"flex",justifyContent:"center",p:3,children:i.jsx(nr,{})}):u.length===0?i.jsx(Ot,{severity:"info",children:'No expense distributions configured. Click "Add Distribution" to get started.'}):i.jsx(ie,{container:!0,spacing:2,children:u.map(D=>{const P=o.find($=>$.Id===D.expense_account_id);return i.jsx(ie,{item:!0,xs:12,sm:6,md:4,children:i.jsx(Br,{children:i.jsx(Vr,{children:i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[i.jsxs(J,{flex:1,children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:D.description||P?.Name||"Unknown Account"}),i.jsxs(B,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:[P?.Name," (",P?.AccountType,")"]}),i.jsx(ot,{label:`${D.percentage}%`,color:"primary",size:"small"})]}),i.jsxs(J,{children:[i.jsx(pr,{size:"small",onClick:()=>k(D),children:i.jsx(tu,{})}),i.jsx(pr,{size:"small",color:"error",onClick:()=>M(D.id),children:i.jsx(ua,{})})]})]})})})},D.id)})})]})}),i.jsxs(gr,{open:w,onClose:()=>A(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(vr,{children:O?"Edit Distribution":"Add Distribution"}),i.jsx(yr,{children:i.jsxs(ct,{spacing:3,sx:{mt:1},children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Expense Account"}),i.jsx(hn,{value:E.expense_account_id,onChange:D=>S(P=>({...P,expense_account_id:D.target.value})),label:"Expense Account",children:W("Expense").map(D=>i.jsx(tr,{value:D.value,children:D.label},D.value))})]}),i.jsx(Ae,{label:"Percentage",type:"number",value:E.percentage,onChange:D=>S(P=>({...P,percentage:D.target.value})),inputProps:{min:0,max:100,step:.01},helperText:`Current total: ${Z}%${O?` (excluding this item: ${(Z-O.percentage).toFixed(1)}%)`:""}`}),i.jsx(Ae,{label:"Description (Optional)",value:E.description,onChange:D=>S(P=>({...P,description:D.target.value})),helperText:"A description to help identify this distribution"})]})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:()=>A(!1),children:"Cancel"}),i.jsx(ye,{onClick:z,variant:"contained",disabled:n||!E.expense_account_id||!E.percentage,startIcon:n?i.jsx(nr,{size:20}):i.jsx(Is,{}),children:n?"Saving...":"Save"})]})]}),K()]})},nhe=()=>{const[e,t]=y.useState(!1),[r,n]=y.useState(!1),[a,o]=y.useState([]),[s,l]=y.useState(new Set),[c,u]=y.useState(new Set),[d,f]=y.useState(!1),[h,p]=y.useState([]),[g,m]=y.useState([]),x=Nn();y.useEffect(()=>{b();const k=()=>{console.log(" Parts to order update event received, refreshing data..."),b()};return window.addEventListener("parts-to-order-updated",k),()=>{window.removeEventListener("parts-to-order-updated",k)}},[]);const b=async()=>{t(!0);try{const[k,M]=await Promise.all([ve.get("/api/sales-orders/parts-to-order/all"),ve.get("/api/inventory")]),{individualParts:R,aggregatedParts:F}=k.data,W=M.data||[];m(W);const K=Z=>{const D=$=>($||"").replace(/[\-\s"]/g,"").toUpperCase(),P=new Map(W.map($=>[D(String($.part_number)),$]));return Z.map($=>{const Q=P.get(D($.part_number));if(!Q)return $;const C=Q.unit||$.unit,L=Q.part_description||$.part_description,H=Number(Q.last_unit_cost)||Number($.unit_price)||0,U=H*(Number($.total_quantity_needed)||0);return{...$,unit:C,part_description:L,unit_price:H,total_line_amount:U,sales_orders:($.sales_orders||[]).map(te=>{const le=Number(Q.last_unit_cost)||Number(te.unit_price)||0,oe=le*(Number(te.quantity_needed)||0);return{...te,unit:Q.unit||te.unit,unit_price:le,line_amount:oe}})}})};if(F&&F.length>0)o(K(F));else{const Z=_(R);o(K(Z))}}catch(k){console.error("Error fetching parts to order:",k),ge.error("Failed to load parts to order data")}finally{t(!1)}},_=k=>{const M={};return k.forEach(R=>{M[R.part_number]||(M[R.part_number]={part_number:R.part_number,part_description:R.part_description,total_quantity_needed:0,unit:R.unit,unit_price:R.unit_price,total_line_amount:0,sales_orders:[]}),M[R.part_number].total_quantity_needed+=R.quantity_needed,M[R.part_number].total_line_amount+=R.line_amount,M[R.part_number].sales_orders.push(R)}),Object.values(M)},w=k=>{const M=new Set(s);M.has(k)?M.delete(k):M.add(k),l(M)},A=()=>{b()},O=k=>{u(M=>{const R=new Set(M);return R.has(k)?R.delete(k):R.add(k),R})},T=()=>{c.size===a.length?u(new Set):u(new Set(a.map(k=>k.part_number)))},E=()=>{if(c.size===0){ge.warning("Please select at least one part to create a purchase order");return}const k=a.filter(M=>c.has(M.part_number));p(k),f(!0)},S=()=>{f(!1),p([])},I=async()=>{if(h.length===0){ge.warning("No parts selected for purchase order");return}n(!0);try{const k=await ve.post("/api/purchase-orders/auto-create-from-parts-to-order",{parts:h});if(k.data.success)if(ge.success(`Purchase order created successfully! PO Number: ${k.data.purchase_order_number}`),k.data.purchase_orders&&k.data.purchase_orders.length===1){const M=k.data.purchase_orders[0].purchase_id;S(),u(new Set),x(`/open-purchase-orders/${M}`)}else S(),u(new Set),b();else ge.error(k.data.message||"Failed to create purchase order")}catch(k){console.error("Error creating purchase order:",k),ge.error(k.response?.data?.error||"Failed to create purchase order")}finally{n(!1)}},z=async k=>{let M=a;if(k){const R=a.find(F=>F.part_number===k);if(!R){ge.warning(`Part ${k} not found for purchase order creation.`);return}M=[R]}if(M.length===0){ge.warning("No parts to order");return}n(!0);try{const R=await ve.post("/api/purchase-orders/auto-create-from-parts-to-order",{parts:M});if(R.data.success)if(ge.success(`Purchase order created successfully! PO Number: ${R.data.purchase_order_number}`),R.data.purchase_orders&&R.data.purchase_orders.length===1){const F=R.data.purchase_orders[0].purchase_id;x(`/open-purchase-orders/${F}`)}else b();else ge.error(R.data.message||"Failed to create purchase order")}catch(R){console.error("Error creating purchase order:",R),ge.error(R.response?.data?.error||"Failed to create purchase order")}finally{n(!1)}};return e?i.jsx(J,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:i.jsx(nr,{})}):i.jsxs(J,{p:3,children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsx(B,{variant:"h3",component:"h1",children:"Parts to Order"}),i.jsxs(J,{display:"flex",gap:2,children:[c.size>0&&i.jsxs(ye,{variant:"contained",color:"primary",startIcon:i.jsx(q8,{}),onClick:E,disabled:r,children:["Create PO (",c.size,")"]}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Zw,{}),onClick:A,children:"Refresh"})]})]}),a.length===0?i.jsx(Ot,{severity:"info",children:"No parts currently need to be ordered."}):i.jsx(va,{component:xt,children:i.jsxs(sa,{size:"medium",children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{padding:"checkbox",children:i.jsx(Xi,{indeterminate:c.size>0&&c.size<a.length,checked:a.length>0&&c.size===a.length,onChange:T})}),i.jsx(Pe,{children:i.jsx(B,{variant:"h6",fontWeight:"bold"})}),i.jsx(Pe,{children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Part Number"})}),i.jsx(Pe,{children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Description"})}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Quantity to Order"})}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Unit"})}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Unit Price"})}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Total Amount"})}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Actions"})})]})}),i.jsx(ca,{children:a.map(k=>i.jsxs(Ce.Fragment,{children:[i.jsxs(br,{children:[i.jsx(Pe,{padding:"checkbox",children:i.jsx(Xi,{checked:c.has(k.part_number),onChange:()=>O(k.part_number)})}),i.jsx(Pe,{children:i.jsx(pr,{size:"small",onClick:()=>w(k.part_number),children:s.has(k.part_number)?i.jsx(F8,{}):i.jsx(RI,{})})}),i.jsx(Pe,{children:i.jsx(B,{variant:"body1",fontWeight:"medium",fontSize:"1.1rem",children:k.part_number})}),i.jsx(Pe,{children:i.jsx(B,{variant:"body1",fontSize:"1.1rem",children:k.part_description})}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"body1",fontWeight:"medium",fontSize:"1.1rem",children:Number(k.total_quantity_needed)||0})}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"body1",fontSize:"1.1rem",children:k.unit})}),i.jsx(Pe,{align:"center",children:i.jsxs(B,{variant:"body1",fontSize:"1.1rem",children:["$",(Number(k.unit_price)||0).toFixed(2)]})}),i.jsx(Pe,{align:"center",children:i.jsxs(B,{variant:"body1",fontSize:"1.1rem",children:["$",(Number(k.total_line_amount)||0).toFixed(2)]})}),i.jsx(Pe,{align:"center",children:i.jsx(ye,{variant:"contained",color:"primary",size:"medium",startIcon:i.jsx(c5,{}),onClick:()=>z(k.part_number),disabled:r,children:"Create PO"})})]}),i.jsx(br,{children:i.jsx(Pe,{style:{paddingBottom:0,paddingTop:0},colSpan:9,children:i.jsx(NI,{in:s.has(k.part_number),timeout:"auto",unmountOnExit:!0,children:i.jsxs(J,{sx:{margin:1},children:[i.jsx(B,{variant:"h5",gutterBottom:!0,component:"div",children:"Sales Orders Requiring This Part"}),i.jsxs(sa,{size:"medium",children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{children:i.jsx(B,{variant:"subtitle1",fontWeight:"bold",children:"Sales Order"})}),i.jsx(Pe,{children:i.jsx(B,{variant:"subtitle1",fontWeight:"bold",children:"Customer"})}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"subtitle1",fontWeight:"bold",children:"Quantity to Order"})}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"subtitle1",fontWeight:"bold",children:"Unit Price"})}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"subtitle1",fontWeight:"bold",children:"Line Amount"})})]})}),i.jsx(ca,{children:k.sales_orders.map(M=>i.jsxs(br,{children:[i.jsx(Pe,{children:i.jsx(B,{variant:"body1",fontSize:"1rem",children:M.sales_order_number})}),i.jsx(Pe,{children:i.jsx(B,{variant:"body1",fontSize:"1rem",children:M.customer_name})}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"body1",fontSize:"1rem",children:Number(M.quantity_needed)||0})}),i.jsx(Pe,{align:"center",children:i.jsxs(B,{variant:"body1",fontSize:"1rem",children:["$",(Number(M.unit_price)||0).toFixed(2)]})}),i.jsx(Pe,{align:"center",children:i.jsxs(B,{variant:"body1",fontSize:"1rem",children:["$",(Number(M.line_amount)||0).toFixed(2)]})})]},`${M.sales_order_id}-${M.part_number}`))})]})]})})})})]},k.part_number))})]})}),i.jsxs(gr,{open:d,onClose:S,maxWidth:"md",fullWidth:!0,children:[i.jsx(vr,{children:"Create Purchase Order"}),i.jsxs(yr,{children:[i.jsx(B,{variant:"body1",sx:{mb:2},children:"Selected parts for purchase order:"}),i.jsx(va,{component:xt,variant:"outlined",children:i.jsxs(sa,{size:"small",children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{children:"Part Number"}),i.jsx(Pe,{children:"Description"}),i.jsx(Pe,{align:"center",children:"Quantity"}),i.jsx(Pe,{align:"center",children:"Unit"}),i.jsx(Pe,{align:"center",children:"Unit Price"}),i.jsx(Pe,{align:"center",children:"Total"})]})}),i.jsx(ca,{children:h.map(k=>i.jsxs(br,{children:[i.jsx(Pe,{children:i.jsx(B,{variant:"body2",fontWeight:"medium",children:k.part_number})}),i.jsx(Pe,{children:i.jsx(B,{variant:"body2",children:k.part_description})}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"body2",children:Number(k.total_quantity_needed)||0})}),i.jsx(Pe,{align:"center",children:i.jsx(B,{variant:"body2",children:k.unit})}),i.jsx(Pe,{align:"center",children:i.jsxs(B,{variant:"body2",children:["$",(Number(k.unit_price)||0).toFixed(2)]})}),i.jsx(Pe,{align:"center",children:i.jsxs(B,{variant:"body2",fontWeight:"medium",children:["$",(Number(k.total_line_amount)||0).toFixed(2)]})})]},k.part_number))})]})}),i.jsx(J,{sx:{mt:2,p:2,backgroundColor:"grey.50",borderRadius:1},children:i.jsxs(B,{variant:"h6",align:"right",children:["Total Amount: $",h.reduce((k,M)=>k+(Number(M.total_line_amount)||0),0).toFixed(2)]})})]}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:S,disabled:r,children:"Cancel"}),i.jsx(ye,{onClick:I,variant:"contained",color:"primary",disabled:r,startIcon:r?i.jsx(nr,{size:20}):i.jsx(c5,{}),children:r?"Creating...":"Create Purchase Order"})]})]})]})},ahe=()=>{const e=Nn(),[t,r]=y.useState(!0),[n,a]=y.useState(!1),[o,s]=y.useState([]),[l,c]=y.useState([]),[u,d]=y.useState([]),[f,h]=y.useState(!1),[p,g]=y.useState(""),[m,x]=y.useState("");y.useEffect(()=>{b()},[]);const b=async()=>{r(!0);try{const[T,E,S]=await Promise.all([ve.get("/api/time-tracking/admin/available-users"),ve.get("/api/time-tracking/profiles"),ve.get("/api/time-tracking/admin/user-profile-access")]);s(T.data||[]),c(E.data||[]),d(S.data||[])}catch(T){console.error("Error loading data:",T),ge.error("Failed to load mobile user access data")}finally{r(!1)}},_=async()=>{if(!p||!m){ge.error("Please select both a user and a profile");return}a(!0);try{await ve.post("/api/time-tracking/admin/user-profile-access",{user_id:p,profile_id:m}),ge.success("Profile access granted successfully"),h(!1),g(""),x(""),b()}catch(T){console.error("Error granting access:",T),ge.error(T.response?.data?.error||"Failed to grant access")}finally{a(!1)}},w=async T=>{if(window.confirm("Are you sure you want to revoke this profile access?"))try{await ve.delete(`/api/time-tracking/admin/user-profile-access/${T}`),ge.success("Profile access revoked successfully"),b()}catch(E){console.error("Error revoking access:",E),ge.error(E.response?.data?.error||"Failed to revoke access")}},A=u.filter(T=>T.is_active),O=u.filter(T=>!T.is_active);return i.jsxs(ir,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(pr,{onClick:()=>e(-1),children:i.jsx(Vp,{})}),i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Mobile User Access Management"})]}),i.jsxs(ct,{direction:"row",spacing:2,children:[i.jsx(ye,{variant:"contained",onClick:()=>h(!0),startIcon:i.jsx(Ba,{}),children:"Grant Access"}),i.jsx(ye,{variant:"outlined",onClick:b,startIcon:i.jsx(Es,{}),children:"Refresh"})]})]}),i.jsxs(ie,{container:!0,spacing:3,sx:{mb:4},children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Br,{children:i.jsxs(Vr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Mobile Users"}),i.jsx(B,{variant:"h4",children:o.length})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Br,{children:i.jsxs(Vr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Available Profiles"}),i.jsx(B,{variant:"h4",children:l.length})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Br,{children:i.jsxs(Vr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Active Access"}),i.jsx(B,{variant:"h4",color:"success.main",children:A.length})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Br,{children:i.jsxs(Vr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Revoked Access"}),i.jsx(B,{variant:"h4",color:"text.secondary",children:O.length})]})})})]}),t?i.jsx(J,{display:"flex",justifyContent:"center",p:3,children:i.jsx(nr,{})}):i.jsxs(i.Fragment,{children:[i.jsx(xt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(J,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Active Profile Access"}),A.length===0?i.jsx(Ot,{severity:"info",children:'No active profile access assignments. Click "Grant Access" to get started.'}):i.jsx(va,{children:i.jsxs(sa,{children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{children:"Mobile User"}),i.jsx(Pe,{children:"Profile"}),i.jsx(Pe,{children:"Granted By"}),i.jsx(Pe,{children:"Granted At"}),i.jsx(Pe,{children:"Actions"})]})}),i.jsx(ca,{children:A.map(T=>i.jsxs(br,{children:[i.jsx(Pe,{children:i.jsxs(J,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:T.user_email}),i.jsx(ot,{label:T.user_role,size:"small",color:"primary",variant:"outlined"})]})}),i.jsx(Pe,{children:i.jsxs(J,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:T.profile_name}),i.jsx(B,{variant:"caption",color:"textSecondary",children:T.profile_email})]})}),i.jsx(Pe,{children:i.jsx(B,{variant:"body2",children:T.granted_by_email||"System"})}),i.jsx(Pe,{children:i.jsx(B,{variant:"body2",children:new Date(T.granted_at).toLocaleDateString()})}),i.jsx(Pe,{children:i.jsx(pr,{color:"error",onClick:()=>w(T.id),title:"Revoke Access",children:i.jsx(ua,{})})})]},T.id))})]})})]})}),O.length>0&&i.jsx(xt,{sx:{width:"100%",overflow:"hidden"},children:i.jsxs(J,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Revoked Profile Access"}),i.jsx(va,{children:i.jsxs(sa,{children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{children:"Mobile User"}),i.jsx(Pe,{children:"Profile"}),i.jsx(Pe,{children:"Revoked At"})]})}),i.jsx(ca,{children:O.map(T=>i.jsxs(br,{children:[i.jsx(Pe,{children:i.jsxs(J,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:T.user_email}),i.jsx(ot,{label:T.user_role,size:"small",color:"default",variant:"outlined"})]})}),i.jsx(Pe,{children:i.jsxs(J,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:T.profile_name}),i.jsx(B,{variant:"caption",color:"textSecondary",children:T.profile_email})]})}),i.jsx(Pe,{children:i.jsx(B,{variant:"body2",children:new Date(T.updated_at).toLocaleDateString()})})]},T.id))})]})})]})})]}),i.jsxs(gr,{open:f,onClose:()=>h(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(vr,{children:i.jsxs(J,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(Ba,{}),"Grant Profile Access"]})}),i.jsx(yr,{children:i.jsxs(ct,{spacing:3,sx:{mt:1},children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Mobile User"}),i.jsx(hn,{value:p,onChange:T=>g(Number(T.target.value)),label:"Mobile User",children:o.map(T=>i.jsx(tr,{value:T.id,children:i.jsxs(J,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:T.email}),i.jsx(B,{variant:"caption",color:"textSecondary",children:T.access_role})]})},T.id))})]}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Profile"}),i.jsx(hn,{value:m,onChange:T=>x(Number(T.target.value)),label:"Profile",children:l.map(T=>i.jsx(tr,{value:T.id,children:i.jsxs(J,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:T.name}),i.jsx(B,{variant:"caption",color:"textSecondary",children:T.email})]})},T.id))})]})]})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:()=>h(!1),children:"Cancel"}),i.jsx(ye,{onClick:_,variant:"contained",disabled:n||!p||!m,startIcon:n?i.jsx(nr,{size:20}):i.jsx(ac,{}),children:n?"Granting...":"Grant Access"})]})]})]})};var hh={},nI;function ihe(){if(nI)return hh;nI=1;var e=cr();Object.defineProperty(hh,"__esModule",{value:!0}),hh.default=void 0;var t=e(dr()),r=ur();return hh.default=(0,t.default)((0,r.jsx)("path",{d:"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20zm-6 8h-4v-2h4zm0-4h-4v-2h4z"}),"BugReport"),hh}var ohe=ihe();const she=It(ohe);var ph={},aI;function lhe(){if(aI)return ph;aI=1;var e=cr();Object.defineProperty(ph,"__esModule",{value:!0}),ph.default=void 0;var t=e(dr()),r=ur();return ph.default=(0,t.default)((0,r.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 16H8v-2h8zm0-4H8v-2h8zm-3-5V3.5L18.5 9z"}),"Description"),ph}var che=lhe();const uhe=It(che),iI=[{value:"gmail",label:"Gmail",host:"smtp.gmail.com",port:587,secure:!1},{value:"outlook",label:"Outlook/Hotmail",host:"smtp-mail.outlook.com",port:587,secure:!1},{value:"yahoo",label:"Yahoo",host:"smtp.mail.yahoo.com",port:587,secure:!1},{value:"icloud",label:"iCloud",host:"smtp.mail.me.com",port:587,secure:!1},{value:"titan",label:"Titan Email",host:"smtp.titan.email",port:465,secure:!0},{value:"custom",label:"Custom SMTP",host:"",port:587,secure:!1}],dhe=()=>{const e=Nn(),[t,r]=y.useState({email_provider:"gmail",email_host:"smtp.gmail.com",email_port:587,email_secure:!1,email_user:"",email_from:""}),[n,a]=y.useState(""),[o,s]=y.useState(!1),[l,c]=y.useState(!1),[u,d]=y.useState(!1),[f,h]=y.useState("unknown");y.useEffect(()=>{p()},[]);const p=async()=>{try{const A=await ve.get("/api/email/user-settings");if(A.data.success&&A.data.settings){const O=A.data.settings;r({email_provider:O.email_provider,email_host:O.email_host,email_port:O.email_port,email_secure:O.email_secure,email_user:O.email_user,email_from:O.email_from||O.email_user}),d(!0)}}catch(A){console.error("Error loading user email settings:",A)}},g=async()=>{if(!t.email_host||!t.email_port||!t.email_user){ge.error("Please fill in all required fields");return}u&&!n&&ge.info("Password field is empty - keeping existing password"),s(!0);try{const A={...t,...n&&{email_pass:n}},O=await ve.post("/api/email/user-settings",A);O.data.success?(ge.success("Email settings saved successfully!"),d(!0),a(""),h("unknown")):ge.error(O.data.message||"Failed to save email settings")}catch(A){console.error("Error saving email settings:",A),ge.error(A.response?.data?.message||"Failed to save email settings")}finally{s(!1)}},m=async()=>{if(!u){ge.error("Please save your email settings first");return}c(!0);try{const A=await ve.post("/api/email/test-user-connection");A.data.success?(h("connected"),ge.success("Email connection test successful!")):(h("failed"),ge.error(A.data.message||"Email connection test failed"))}catch(A){console.error("Error testing email connection:",A),h("failed"),ge.error(A.response?.data?.message||"Email connection test failed")}finally{c(!1)}},x=A=>{const O=iI.find(T=>T.value===A);O&&r(T=>({...T,email_provider:A,email_host:O.host,email_port:O.port,email_secure:O.secure}))},b=(A,O)=>{r(T=>({...T,[A]:O}))},_=()=>{switch(f){case"connected":return"success";case"failed":return"error";default:return"info"}},w=()=>{switch(f){case"connected":return"Connected";case"failed":return"Connection Failed";default:return"Not Tested"}};return i.jsxs(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(J,{sx:{display:"flex",alignItems:"center",mb:3},children:[i.jsx(bS,{sx:{mr:2,fontSize:32}}),i.jsx(B,{variant:"h4",component:"h1",children:"My Email Settings"})]}),i.jsx(Ot,{severity:"info",sx:{mb:3},children:"Configure your personal email settings to send emails from your own email account. These settings are private to your account and will be used when you send emails from the system."}),i.jsxs(Ot,{severity:"warning",sx:{mb:3},children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:i.jsx("strong",{children:"Important for Gmail users:"})}),i.jsxs(B,{variant:"body2",children:[`If you're using Gmail with 2-Factor Authentication, you need to use an "App Password" instead of your regular password.`,i.jsx("br",{})," Go to ",i.jsx("a",{href:"https://myaccount.google.com/apppasswords",target:"_blank",rel:"noopener noreferrer",children:"Google App Passwords"}),i.jsx("br",{}),' Generate an app password for "Mail"',i.jsx("br",{}),' Use that 16-character password in the "App Password" field below']})]}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,md:8,children:i.jsxs(Br,{children:[i.jsxs(Vr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Email Configuration"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{select:!0,label:"Email Provider",value:t.email_provider,onChange:A=>x(A.target.value),fullWidth:!0,helperText:"Select your email provider or choose Custom for other SMTP servers",children:iI.map(A=>i.jsx(tr,{value:A.value,children:A.label},A.value))})}),i.jsx(ie,{item:!0,xs:12,sm:8,children:i.jsx(Ae,{label:"SMTP Host",value:t.email_host,onChange:A=>b("email_host",A.target.value),fullWidth:!0,required:!0,disabled:t.email_provider!=="custom"})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ae,{label:"SMTP Port",type:"number",value:t.email_port,onChange:A=>b("email_port",parseInt(A.target.value)),fullWidth:!0,required:!0,disabled:t.email_provider!=="custom"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(ri,{control:i.jsx(hl,{checked:t.email_secure,onChange:A=>b("email_secure",A.target.checked),disabled:t.email_provider!=="custom"}),label:"Use SSL/TLS (usually for port 465)"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{label:"Email Address",type:"email",value:t.email_user,onChange:A=>b("email_user",A.target.value),fullWidth:!0,required:!0,helperText:"Your email address for authentication"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{label:u?"Update App Password":"App Password",type:"password",value:n,onChange:A=>a(A.target.value),fullWidth:!0,required:!u,helperText:u?"Leave blank to keep current password, or enter new password to update":"Your email password or app password (for Gmail with 2FA)"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{label:"From Name (Optional)",value:t.email_from,onChange:A=>b("email_from",A.target.value),fullWidth:!0,helperText:"Display name for outgoing emails (defaults to email address)"})})]})]}),i.jsx(Bh,{children:i.jsx(ye,{variant:"contained",startIcon:o?i.jsx(nr,{size:20}):i.jsx(Is,{}),onClick:g,disabled:o,children:o?"Saving...":"Save Settings"})})]})}),i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsxs(Br,{children:[i.jsxs(Vr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Connection Status"}),i.jsx(Ot,{severity:_(),sx:{mb:2},children:w()}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Test your email configuration to ensure it works correctly."})]}),i.jsx(Bh,{children:i.jsx(ye,{variant:"outlined",startIcon:l?i.jsx(nr,{size:20}):i.jsx(she,{}),onClick:m,disabled:l||!u,fullWidth:!0,children:l?"Testing...":"Test Connection"})})]}),i.jsx(Br,{sx:{mt:2},children:i.jsxs(Vr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Setup Instructions"}),i.jsxs(B,{variant:"body2",sx:{mb:1},children:[i.jsx("strong",{children:"Gmail:"})," Use an App Password instead of your regular password."]}),i.jsxs(B,{variant:"body2",sx:{mb:1},children:[i.jsx("strong",{children:"Outlook:"})," Use an App Password for enhanced security."]}),i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"Other providers:"})," Check your email provider's SMTP settings."]})]})}),i.jsx(Br,{sx:{mt:2,border:"2px solid red"},children:i.jsxs(Vr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Quick Actions"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Manage your email templates and customize email content for different types of communications."}),i.jsx(ye,{fullWidth:!0,variant:"outlined",onClick:()=>e("/email-templates"),startIcon:i.jsx(uhe,{}),sx:{mb:1},color:"primary",children:"Manage Email Templates"})]})})]})]})]})};var mh={},oI;function fhe(){if(oI)return mh;oI=1;var e=cr();Object.defineProperty(mh,"__esModule",{value:!0}),mh.default=void 0;var t=e(dr()),r=ur();return mh.default=(0,t.default)((0,r.jsx)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link"),mh}var hhe=fhe();const sI=It(hhe);var gh={},lI;function phe(){if(lI)return gh;lI=1;var e=cr();Object.defineProperty(gh,"__esModule",{value:!0}),gh.default=void 0;var t=e(dr()),r=ur();return gh.default=(0,t.default)((0,r.jsx)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8m0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4z"}),"Sync"),gh}var mhe=phe();const ghe=It(mhe),vhe=e=>{switch(e){case"created_po":return"success";case"needs_review":return"warning";case"processing":return"info";case"error":return"error";default:return"default"}},yhe=()=>{const[e,t]=y.useState(!1),[r,n]=y.useState(!0),[a,o]=y.useState(!1),[s,l]=y.useState(!1),[c,u]=y.useState(""),[d,f]=y.useState(""),[h,p]=y.useState("imap.titan.email"),[g,m]=y.useState(993),[x,b]=y.useState("smtp.titan.email"),[_,w]=y.useState(465),[A,O]=y.useState('unread:true has:attachment subject:invoice subject:inv subject:bill subject:billing subject:receipt subject:facture subject:"tax invoice" subject:"commercial invoice"'),[T,E]=y.useState(20),[S,I]=y.useState(!0),[z,k]=y.useState(!1),[M,R]=y.useState(!0),[F,W]=y.useState([]),[K,Z]=y.useState(!1),D=async()=>{n(!0);try{const U=await ve.get("/api/email/titan/status");U.data?.success?t(!!U.data.connected):t(!1)}catch{t(!1)}finally{n(!1)}},P=async()=>{R(!0);try{const U=await ve.get("/api/invoice-automator/ingestions?limit=50");W(Array.isArray(U.data?.ingestions)?U.data.ingestions:[])}catch{ge.error("Failed to load ingestions")}finally{R(!1)}};y.useEffect(()=>{D().finally(()=>P())},[]);const $=async()=>{o(!0);try{const U={email:c,password:d,hostImap:h,portImap:g,hostSmtp:x,portSmtp:_},te=await ve.post("/api/email/connect/titan",U);te.data?.success?(ge.success("Titan connected"),f(""),await D()):ge.error(te.data?.message||"Failed to connect Titan")}catch(U){ge.error(U?.response?.data?.message||"Failed to connect Titan")}finally{o(!1)}},Q=async()=>{l(!0);try{const U=await ve.post("/api/email/disconnect");U.data?.success?(ge.success("Disconnected"),await D()):ge.error(U.data?.message||"Failed to disconnect")}catch(U){ge.error(U?.response?.data?.message||"Failed to disconnect")}finally{l(!1)}},C=async()=>{k(!0);try{const U=await ve.post("/api/invoice-automator/titan/sync",{query:A,maxMessages:T,autoCreatePurchaseOrders:S});U.data?.success?(ge.success(`Synced: ${U.data.processedAttachments||0} attachments, ${U.data.createdPurchaseOrders||0} POs created`),await P()):ge.error(U.data?.message||"Sync failed")}catch(U){ge.error(U?.response?.data?.message||"Sync failed")}finally{k(!1)}},L=async U=>{try{const te=await ve.post(`/api/invoice-automator/ingestions/${U.id}/create-po`,{});te.data?.success?(ge.success("Purchase order created"),await P()):ge.error(te.data?.message||"Failed to create purchase order")}catch(te){ge.error(te?.response?.data?.message||"Failed to create purchase order")}},H=y.useMemo(()=>K?F:F.filter(U=>!String(U.status||"").startsWith("rejected")),[F,K]);return i.jsxs(J,{p:3,children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Invoice Automator"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Connect a Titan mailbox, scan invoice attachments, run OCR, and create purchase orders automatically when the vendor can be matched."}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,md:5,children:[i.jsxs(Br,{children:[i.jsxs(Vr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Titan Connection"}),i.jsx(Ot,{severity:e?"success":"warning",sx:{mb:2},children:r?"Checking...":e?"Connected":"Not connected"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{label:"Email",value:c,onChange:U=>u(U.target.value),fullWidth:!0,disabled:e})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{label:"Password",type:"password",value:d,onChange:U=>f(U.target.value),fullWidth:!0,disabled:e,helperText:e?"Disconnect to update credentials":"Your Titan mailbox password"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"IMAP Host",value:h,onChange:U=>p(U.target.value),fullWidth:!0,disabled:e})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"IMAP Port",type:"number",value:g,onChange:U=>m(Number(U.target.value)),fullWidth:!0,disabled:e})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"SMTP Host",value:x,onChange:U=>b(U.target.value),fullWidth:!0,disabled:e})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"SMTP Port",type:"number",value:_,onChange:U=>w(Number(U.target.value)),fullWidth:!0,disabled:e})})]})]}),i.jsx(Bh,{children:e?i.jsx(ye,{variant:"outlined",color:"warning",startIcon:s?i.jsx(nr,{size:18}):i.jsx(sI,{}),onClick:Q,disabled:s,children:s?"Disconnecting...":"Disconnect"}):i.jsx(ye,{variant:"contained",startIcon:a?i.jsx(nr,{size:18}):i.jsx(sI,{}),onClick:$,disabled:a||!c||!d,children:a?"Connecting...":"Connect Titan"})})]}),i.jsx(Br,{sx:{mt:2},children:i.jsxs(Vr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Sync Settings"}),i.jsx(Ae,{label:"Titan Search Query",value:A,onChange:U=>O(U.target.value),fullWidth:!0,sx:{mb:2},helperText:'Examples: `unread:true has:attachment subject:invoice`, `from:"billing@vendor.com" unread:true has:attachment subject:invoice`'}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Ae,{label:"Max Messages",type:"number",value:T,onChange:U=>E(Number(U.target.value)),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(ri,{control:i.jsx(hl,{checked:S,onChange:U=>I(U.target.checked)}),label:"Auto-create POs"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(ri,{control:i.jsx(hl,{checked:K,onChange:U=>Z(U.target.checked)}),label:"Show rejected statements"})})]}),i.jsx(Gn,{sx:{my:2}}),i.jsx(ye,{variant:"contained",startIcon:z?i.jsx(nr,{size:18}):i.jsx(ghe,{}),onClick:C,disabled:!e||z,fullWidth:!0,children:z?"Syncing...":"Sync Inbox"})]})})]}),i.jsx(ie,{item:!0,xs:12,md:7,children:i.jsx(Br,{children:i.jsxs(Vr,{children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[i.jsx(B,{variant:"h6",children:"Recent Ingestions"}),i.jsx(ye,{size:"small",onClick:P,disabled:M,children:"Refresh"})]}),M?i.jsx(J,{display:"flex",justifyContent:"center",py:4,children:i.jsx(nr,{})}):H.length===0?i.jsx(Ot,{severity:"info",children:"No ingestions yet. Connect Titan and run a sync."}):i.jsx(J,{display:"flex",flexDirection:"column",gap:1,children:H.map(U=>{const te=U.ocr_normalized,le=te?.vendorName,oe=te?.billNumber,ae=te?.vendorMatch?.status==="existing"?te?.vendorMatch?.vendorId:null,he=te?.documentType==="invoice",me=he&&!U.purchase_id&&(U.status==="needs_review"||U.status==="processed")&&ae;return i.jsxs(Br,{variant:"outlined",children:[i.jsxs(Vr,{sx:{pb:1},children:[i.jsxs(J,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:U.attachment_filename||"attachment"}),i.jsx(ot,{size:"small",label:U.status,color:vhe(U.status)})]}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:[U.subject||"(no subject)","  ",U.from_address||"unknown sender"]}),i.jsxs(B,{variant:"body2",sx:{mt:1},children:["Vendor: ",le||"","  Bill: ",oe||""]}),U.error?i.jsx(Ot,{severity:"error",sx:{mt:1},children:U.error}):null]}),i.jsxs(Bh,{sx:{pt:0},children:[U.purchase_id?i.jsx(ye,{size:"small",component:YI,to:`/open-purchase-orders/${U.purchase_id}`,startIcon:i.jsx(Uw,{}),children:"Open PO"}):i.jsx(ye,{size:"small",variant:"contained",onClick:()=>L(U),disabled:!me,startIcon:i.jsx(Uw,{}),children:"Create PO"}),!ae&&he?i.jsx(B,{variant:"caption",color:"text.secondary",children:"Vendor not matched (add vendor, then re-sync)"}):null]})]},U.id)})})]})})})]})]})},xhe=()=>{const{user:e}=ea(),[t,r]=y.useState([]),[n,a]=y.useState(!0),[o,s]=y.useState(!1),[l,c]=y.useState(null),[u,d]=y.useState({name:"",type:"purchase_order",subject:"",html_content:"",text_content:"",is_default:!1}),[f,h]=y.useState(""),[p,g]=y.useState("");y.useEffect(()=>{m()},[]);const m=async()=>{try{a(!0);const T=await ve.get("/api/email/templates");T.data.success&&r(T.data.templates)}catch(T){console.error("Error loading templates:",T),h("Failed to load email templates")}finally{a(!1)}},x=T=>{T?(c(T),d({name:T.name,type:T.type,subject:T.subject,html_content:T.html_content,text_content:T.text_content||"",is_default:T.is_default})):(c(null),d({name:"",type:"purchase_order",subject:"",html_content:"",text_content:"",is_default:!1})),s(!0)},b=()=>{s(!1),c(null),d({name:"",type:"purchase_order",subject:"",html_content:"",text_content:"",is_default:!1})},_=async()=>{try{l?(await ve.put(`/api/email/templates/${l.id}`,u),g("Email template updated successfully")):(await ve.post("/api/email/templates",u),g("Email template created successfully")),b(),m()}catch(T){console.error("Error saving template:",T),h(T.response?.data?.message||"Failed to save template")}},w=async T=>{if(window.confirm("Are you sure you want to delete this template?"))try{await ve.delete(`/api/email/templates/${T}`),g("Email template deleted successfully"),m()}catch(E){console.error("Error deleting template:",E),h(E.response?.data?.message||"Failed to delete template")}},A=T=>{switch(T){case"purchase_order":return"primary";case"sales_order":return"success";case"quote":return"warning";case"custom":return"info";default:return"default"}},O=T=>{switch(T){case"purchase_order":return"Purchase Order";case"sales_order":return"Sales Order";case"quote":return"Quote";case"custom":return"Custom";default:return T}};return n?i.jsx(ir,{maxWidth:"lg",children:i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Loading..."})}):i.jsxs(ir,{maxWidth:"lg",children:[i.jsxs(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Email Templates"}),i.jsx(ye,{variant:"contained",startIcon:i.jsx(Iv,{}),onClick:()=>x(),children:"Create Template"})]}),i.jsx(ie,{container:!0,spacing:3,children:t.map(T=>i.jsx(ie,{item:!0,xs:12,md:6,lg:4,children:i.jsx(Br,{children:i.jsxs(Vr,{children:[i.jsxs(J,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[i.jsx(B,{variant:"h6",component:"div",children:T.name}),i.jsxs(J,{children:[i.jsx(pr,{size:"small",onClick:()=>x(T),color:"primary",children:i.jsx(Ip,{})}),i.jsx(pr,{size:"small",onClick:()=>w(T.id),color:"error",children:i.jsx(Id,{})})]})]}),i.jsx(ot,{label:O(T.type),color:A(T.type),size:"small",sx:{mb:1}}),T.is_default&&i.jsx(ot,{label:"Default",color:"secondary",size:"small",sx:{ml:1}}),i.jsxs(B,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[i.jsx("strong",{children:"Subject:"})," ",T.subject]}),i.jsxs(B,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[i.jsx("strong",{children:"Created:"})," ",new Date(T.created_at).toLocaleDateString()]}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:[i.jsx("strong",{children:"Updated:"})," ",new Date(T.updated_at).toLocaleDateString()]})]})})},T.id))}),t.length===0&&i.jsxs(J,{sx:{textAlign:"center",mt:4},children:[i.jsx(B,{variant:"h6",color:"text.secondary",children:"No email templates found"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Create your first email template to get started"})]}),i.jsxs(gr,{open:o,onClose:b,maxWidth:"md",fullWidth:!0,children:[i.jsx(vr,{children:l?"Edit Email Template":"Create Email Template"}),i.jsx(yr,{children:i.jsxs(J,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[i.jsx(Ae,{label:"Template Name",value:u.name,onChange:T=>d({...u,name:T.target.value}),fullWidth:!0,required:!0}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{children:"Template Type"}),i.jsxs(hn,{value:u.type,onChange:T=>d({...u,type:T.target.value}),label:"Template Type",children:[i.jsx(tr,{value:"purchase_order",children:"Purchase Order"}),i.jsx(tr,{value:"sales_order",children:"Sales Order"}),i.jsx(tr,{value:"quote",children:"Quote"}),i.jsx(tr,{value:"custom",children:"Custom"})]})]}),i.jsx(Ae,{label:"Subject",value:u.subject,onChange:T=>d({...u,subject:T.target.value}),fullWidth:!0,required:!0}),i.jsx(Ae,{label:"HTML Content",value:u.html_content,onChange:T=>d({...u,html_content:T.target.value}),fullWidth:!0,multiline:!0,rows:8,required:!0,helperText:"Use HTML formatting for rich email content"}),i.jsx(Ae,{label:"Text Content (Optional)",value:u.text_content,onChange:T=>d({...u,text_content:T.target.value}),fullWidth:!0,multiline:!0,rows:4,helperText:"Plain text version for email clients that don't support HTML"}),i.jsx(ri,{control:i.jsx(hl,{checked:u.is_default,onChange:T=>d({...u,is_default:T.target.checked})}),label:"Set as default template for this type"})]})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:b,children:"Cancel"}),i.jsx(ye,{onClick:_,variant:"contained",children:l?"Update":"Create"})]})]}),i.jsx(pl,{open:!!f,autoHideDuration:6e3,onClose:()=>h(""),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>h(""),severity:"error",sx:{width:"100%"},children:f})}),i.jsx(pl,{open:!!p,autoHideDuration:6e3,onClose:()=>g(""),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>g(""),severity:"success",sx:{width:"100%"},children:p})})]})};var og={exports:{}},bhe=og.exports,cI;function _he(){return cI||(cI=1,function(e,t){(function(r,n){e.exports=n()})(bhe,function(){return function(r,n,a){r=r||{};var o=n.prototype,s={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function l(u,d,f,h){return o.fromToBase(u,d,f,h)}a.en.relativeTime=s,o.fromToBase=function(u,d,f,h,p){for(var g,m,x,b=f.$locale().relativeTime||s,_=r.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],w=_.length,A=0;A<w;A+=1){var O=_[A];O.d&&(g=h?a(u).diff(f,O.d,!0):f.diff(u,O.d,!0));var T=(r.rounding||Math.round)(Math.abs(g));if(x=g>0,T<=O.r||!O.r){T<=1&&A>0&&(O=_[A-1]);var E=b[O.l];p&&(T=p(""+T)),m=typeof E=="string"?E.replace("%d",T):E(T,d,O.l,x);break}}if(d)return m;var S=x?b.future:b.past;return typeof S=="function"?S(m):S.replace("%s",m)},o.to=function(u,d){return l(u,d,this,!0)},o.from=function(u,d){return l(u,d,this)};var c=function(u){return u.$u?a.utc():a()};o.toNow=function(u){return this.to(c(this),u)},o.fromNow=function(u){return this.from(c(this),u)}}})}(og)),og.exports}var whe=_he();const wR=It(whe),sg={async fetchMessages(e,t){return(await ve.get(`/api/tasks/${e}/messages`,{params:t?{after:t}:void 0})).data},async postMessage(e,t){return(await ve.post(`/api/tasks/${e}/messages`,t)).data},async markMessagesRead(e,t){return(await ve.post(`/api/tasks/${e}/messages/mark-read`,{lastMessageId:t})).data},async getTaskDetail(e){return(await ve.get(`/api/tasks/${e}`)).data}};Rt.extend(wR);const jR=e=>[...e].sort((t,r)=>{const n=new Date(t.createdAt).getTime(),a=new Date(r.createdAt).getTime();return n===a?t.id-r.id:n-a}),jhe=(e,t)=>{if(!t.length)return{merged:e,appended:[]};const r=new Map;e.forEach(o=>r.set(o.id,o));const n=[];return t.forEach(o=>{r.has(o.id)||n.push(o),r.set(o.id,o)}),{merged:jR(Array.from(r.values())),appended:n}},She=({taskId:e,pollIntervalMs:t=15e3,onUnreadChange:r})=>{const{user:n}=ea(),a=y.useMemo(()=>{if(!n?.id)return null;const C=Number(n.id);return Number.isFinite(C)?C:null},[n?.id]),[o,s]=y.useState([]),[l,c]=y.useState(null),[u,d]=y.useState(0),[f,h]=y.useState(!0),[p,g]=y.useState(!1),[m,x]=y.useState(!1),[b,_]=y.useState(""),[w,A]=y.useState(null),[O,T]=y.useState(null),E=y.useRef(null),S=y.useRef(null),I=y.useRef(!0),z=y.useRef(null),k=y.useCallback(C=>{d(C),r?.(C)},[r]),M=y.useCallback((C=!1)=>{const L=E.current;L&&L.scrollTo({top:L.scrollHeight,behavior:C?"smooth":"auto"})},[]),R=y.useCallback(()=>{const C=E.current;return C?C.scrollHeight-C.scrollTop-C.clientHeight<=120:!0},[]),F=y.useCallback(async C=>{try{const L=await sg.markMessagesRead(e,C??void 0);c(L.participant),k(L.unreadCount)}catch(L){console.warn("Failed to update read state for task chat",L)}},[k,e]),W=y.useCallback(C=>{!C.length||I.current||C.filter(L=>L.sender?.userId&&a&&L.sender.userId!==a).forEach(L=>{const H=L.sender?.name||"Task teammate";ge.info(`New message from ${H}`)})},[a]),K=y.useCallback((C,L=!1)=>{const H=R();let U=[],te=z.current;return s(le=>{if(L){const he=jR(C);return U=he,te=he.length?he[he.length-1].id:null,he}const{merged:oe,appended:ae}=jhe(le,C);return U=ae,te=oe.length?oe[oe.length-1].id:te,oe}),te!=null&&(z.current==null||te>z.current)&&(z.current=te),U.length?(W(U),H&&setTimeout(()=>M(!0),50)):H&&L&&setTimeout(()=>M(!0),50),{appended:U,latestId:te}},[W,M,R]),Z=y.useCallback(async C=>{try{C?.initial?h(!0):T(null);const L=C?.forceFull?void 0:z.current??void 0,H=await sg.fetchMessages(e,L);c(H.participant),A(H.lastSyncedAt);const{appended:U,latestId:te}=K(H.messages,!!C?.initial||C?.forceFull);k(H.unreadCount),(H.unreadCount>0||U.length>0)&&te!=null&&await F(te),C?.initial&&(I.current=!1)}catch(L){console.error("Failed to load task messages",L);const H=L?.response?.data?.message||"Unable to load task messages.";T(H),C?.initial&&ge.error(H)}finally{C?.initial&&h(!1)}},[K,F,k,e]);y.useEffect(()=>(I.current=!0,z.current=null,s([]),c(null),k(0),Z({initial:!0,forceFull:!0}).catch(()=>{}),()=>{S.current&&(clearInterval(S.current),S.current=null)}),[Z,k,e]),y.useEffect(()=>{if(S.current&&clearInterval(S.current),!(t<=0))return S.current=setInterval(()=>{Z({forceFull:!1}).catch(()=>{})},t),()=>{S.current&&(clearInterval(S.current),S.current=null)}},[Z,t]);const D=y.useCallback(async C=>{if(C.preventDefault(),!!b.trim())try{x(!0);const L=await sg.postMessage(e,{content:b.trim()});c(L.participant),k(L.unreadCount),K([L.message]),z.current=L.message.id,_(""),setTimeout(()=>M(!0),50)}catch(L){console.error("Failed to send message",L),ge.error(L?.response?.data?.message||"Failed to send message")}finally{x(!1)}},[K,b,k,M,e]),P=y.useCallback(async()=>{try{g(!0),await Z({forceFull:!0})}finally{g(!1)}},[Z]),$=y.useMemo(()=>w?`Updated ${Rt(w).fromNow()}`:"Not synced yet",[w]),Q=C=>{const L=!!(C.metadata&&C.metadata.agent||C.isSystem),H=!L&&a!=null&&C.sender?.userId===a,U=L?"System":H?"You":C.sender?.name||"Team member",te=Rt(C.createdAt).format("MMM D, YYYY h:mm A");return i.jsxs(J,{display:"flex",flexDirection:"column",alignItems:H?"flex-end":"flex-start",mb:2,children:[i.jsx(J,{sx:{maxWidth:"80%",bgcolor:L?"rgba(25, 118, 210, 0.08)":H?"primary.main":"grey.100",color:L?"text.primary":H?"primary.contrastText":"text.primary",px:2,py:1,borderRadius:2,boxShadow:1,border:L?"1px solid":void 0,borderColor:L?"info.light":void 0},children:i.jsx(B,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:C.content})}),i.jsxs(B,{variant:"caption",color:"text.secondary",sx:{mt:.5},children:[U,"  ",te]})]},C.id)};return i.jsxs(xt,{elevation:2,sx:{display:"flex",flexDirection:"column",height:"100%"},children:[i.jsxs(J,{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,py:1.5,children:[i.jsxs(J,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(B,{variant:"h6",children:"Task chat"}),i.jsx(Jw,{color:"secondary",badgeContent:u,invisible:u===0,children:i.jsx(ot,{label:"Unread",size:"small",variant:u?"filled":"outlined"})})]}),i.jsxs(J,{display:"flex",alignItems:"center",gap:1,children:[w&&i.jsx(B,{variant:"caption",color:"text.secondary",children:$}),i.jsx(En,{title:"Refresh conversation",children:i.jsx("span",{children:i.jsx(pr,{onClick:P,disabled:p||f,size:"small",children:p?i.jsx(nr,{size:18}):i.jsx(Es,{fontSize:"small"})})})})]})]}),i.jsx(Gn,{}),i.jsx(J,{ref:E,flex:1,overflow:"auto",px:2,py:2,children:f?i.jsx(J,{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",children:i.jsx(nr,{size:32})}):O?i.jsx(B,{color:"error",variant:"body2",children:O}):o.length===0?i.jsx(J,{textAlign:"center",color:"text.secondary",children:i.jsx(B,{variant:"body2",children:"No messages yet. Start the conversation below."})}):o.map(C=>Q(C))}),i.jsx(Gn,{}),i.jsxs(J,{component:"form",onSubmit:D,display:"flex",gap:1,px:2,py:1.5,children:[i.jsx(Ae,{value:b,onChange:C=>_(C.target.value),placeholder:"Write a message",fullWidth:!0,minRows:2,maxRows:4,multiline:!0,disabled:m}),i.jsx(ye,{type:"submit",variant:"contained",endIcon:m?i.jsx(nr,{color:"inherit",size:18}):i.jsx(jN,{}),disabled:m||b.trim().length===0,children:"Send"})]})]})};Rt.extend(wR);const Che=()=>{const{id:e}=Ms(),t=y.useMemo(()=>{if(!e)return NaN;const g=Number(e);return Number.isFinite(g)?g:NaN},[e]),[r,n]=y.useState(null),[a,o]=y.useState(!0),[s,l]=y.useState(null),[c,u]=y.useState(0),d=y.useCallback(async()=>{if(!Number.isFinite(t)){l("Invalid task identifier"),o(!1);return}try{o(!0),l(null);const g=await sg.getTaskDetail(t);n(g)}catch(g){console.error("Failed to load task details",g);const m=g?.response?.data?.message||"Unable to load task details.";l(m),ge.error(m)}finally{o(!1)}},[t]);y.useEffect(()=>{d()},[d]);const f=y.useCallback(g=>{u(g)},[]);if(!Number.isFinite(t))return i.jsx(J,{p:3,children:i.jsx(B,{color:"error",children:"Invalid task identifier."})});if(a)return i.jsx(J,{p:3,display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40vh",children:i.jsx(nr,{})});if(s)return i.jsx(J,{p:3,children:i.jsx(B,{color:"error",children:s})});if(!r)return null;const{task:h,participants:p}=r;return i.jsxs(J,{p:3,display:"flex",flexDirection:"column",gap:3,children:[i.jsxs(J,{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,justifyContent:"space-between",children:[i.jsxs(J,{children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:h.title}),i.jsxs(J,{display:"flex",flexWrap:"wrap",gap:1,alignItems:"center",children:[i.jsx(ot,{label:h.status,color:h.status==="completed"?"success":"default"}),i.jsx(ot,{label:`Priority: ${h.priority??"N/A"}`,variant:"outlined"}),h.dueDate&&i.jsx(ot,{label:`Due ${Rt(h.dueDate).format("MMM D, YYYY")}`,color:"warning"}),c>0&&i.jsx(ot,{label:`${c} unread`,color:"secondary"})]})]}),i.jsxs(J,{textAlign:{xs:"left",md:"right"},color:"text.secondary",children:[h.updatedAt&&i.jsxs(B,{variant:"body2",children:["Updated ",Rt(h.updatedAt).format("MMM D, YYYY h:mm A")]}),h.createdAt&&i.jsxs(B,{variant:"body2",children:["Created ",Rt(h.createdAt).format("MMM D, YYYY h:mm A")]})]})]}),h.description&&i.jsxs(xt,{variant:"outlined",sx:{p:2},children:[i.jsx(B,{variant:"subtitle1",gutterBottom:!0,children:"Description"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{whiteSpace:"pre-wrap"},children:h.description})]}),i.jsxs(ie,{container:!0,spacing:3,alignItems:"stretch",children:[i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsxs(xt,{variant:"outlined",sx:{p:2,height:"100%"},children:[i.jsx(B,{variant:"subtitle1",gutterBottom:!0,children:"Participants"}),p.length===0?i.jsx(B,{variant:"body2",color:"text.secondary",children:"No participants assigned."}):i.jsx(J,{display:"flex",flexDirection:"column",gap:1.5,children:p.map(g=>{const m=(g.name||g.email||"T")[0]?.toUpperCase();return i.jsxs(J,{display:"flex",alignItems:"center",gap:1.5,children:[i.jsx(Tp,{sx:{bgcolor:"primary.main"},children:m}),i.jsxs(J,{flex:1,children:[i.jsx(B,{variant:"body2",children:g.name||"Unnamed user"}),i.jsxs(B,{variant:"caption",color:"text.secondary",display:"block",children:[g.email||"No email","  ",g.role||"Participant"]}),g.lastReadAt&&i.jsxs(B,{variant:"caption",color:"text.secondary",display:"block",children:["Read ",Rt(g.lastReadAt).fromNow()]})]})]},g.id)})})]})}),i.jsx(ie,{item:!0,xs:12,md:8,children:i.jsx(She,{taskId:t,onUnreadChange:f})})]})]})},uI=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}],Ahe=({filters:e,assignees:t,onChange:r,onReset:n})=>{const a=c=>{const u=c.target.value,d=typeof u=="string"?u.split(","):u;r({...e,status:d.filter(Boolean)})},o=c=>{const u=c.target.value;r({...e,assignedTo:u?Number(u):void 0})},s=c=>u=>{r({...e,[c]:u.target.value||void 0})},l=c=>u=>{r({...e,[c]:u.target.checked})};return i.jsx(xt,{variant:"outlined",sx:{p:{xs:2.5,md:3},borderRadius:3,backgroundColor:"background.paper"},children:i.jsxs(ct,{direction:{xs:"column",lg:"row"},spacing:2,useFlexGap:!0,flexWrap:"wrap",alignItems:{xs:"stretch",lg:"flex-end"},children:[i.jsxs(tn,{sx:{minWidth:180,flex:"1 1 200px"},size:"small",children:[i.jsx(fn,{id:"task-status-label",children:"Status"}),i.jsx(hn,{labelId:"task-status-label",multiple:!0,value:e.status??[],onChange:a,input:i.jsx(qI,{label:"Status"}),renderValue:c=>c.map(u=>uI.find(d=>d.value===u)?.label??u).join(", "),children:uI.map(c=>i.jsxs(tr,{value:c.value,children:[i.jsx(Xi,{checked:e.status?.includes(c.value)??!1}),i.jsx(Jn,{primary:c.label})]},c.value))})]}),i.jsxs(tn,{sx:{minWidth:180,flex:"1 1 200px"},size:"small",children:[i.jsx(fn,{id:"task-assigned-label",children:"Assigned to"}),i.jsxs(hn,{labelId:"task-assigned-label",value:e.assignedTo?String(e.assignedTo):"",label:"Assigned to",onChange:o,children:[i.jsx(tr,{value:"",children:i.jsx("em",{children:"All team members"})}),t.map(c=>i.jsx(tr,{value:c.id,children:c.username||c.email},c.id))]})]}),i.jsx(Ae,{label:"Search",size:"small",value:e.search??"",onChange:s("search"),sx:{flex:"1 1 200px"}}),i.jsx(Ae,{label:"Due from",type:"date",size:"small",value:e.dueFrom?.slice(0,10)??"",onChange:s("dueFrom"),InputLabelProps:{shrink:!0},sx:{flex:"1 1 180px"}}),i.jsx(Ae,{label:"Due to",type:"date",size:"small",value:e.dueTo?.slice(0,10)??"",onChange:s("dueTo"),InputLabelProps:{shrink:!0},sx:{flex:"1 1 180px"}}),i.jsxs(J,{sx:{display:"flex",flexDirection:"column",gap:1,flex:"1 1 220px"},children:[i.jsx(ri,{control:i.jsx(Xi,{checked:e.includeCompleted??!1,onChange:l("includeCompleted")}),label:"Show completed"}),i.jsx(ri,{control:i.jsx(Xi,{checked:e.includeArchived??!1,onChange:l("includeArchived")}),label:"Show archived"})]}),n&&i.jsx(J,{sx:{display:"flex",alignItems:"center"},children:i.jsx(ye,{variant:"text",onClick:n,color:"secondary",children:"Reset"})})]})})};var vh={},dI;function Phe(){if(dI)return vh;dI=1;var e=cr();Object.defineProperty(vh,"__esModule",{value:!0}),vh.default=void 0;var t=e(dr()),r=ur();return vh.default=(0,t.default)((0,r.jsx)("path",{d:"M3 18h12v-2H3zM3 6v2h18V6zm0 7h18v-2H3z"}),"Notes"),vh}var Ohe=Phe();const fI=It(Ohe);var yh={},hI;function khe(){if(hI)return yh;hI=1;var e=cr();Object.defineProperty(yh,"__esModule",{value:!0}),yh.default=void 0;var t=e(dr()),r=ur();return yh.default=(0,t.default)([(0,r.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),(0,r.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"Schedule"),yh}var The=khe();const Ehe=It(The),SR=({completed:e,disabled:t,onToggle:r,label:n})=>{const a=o=>{r(o.target.checked)};return i.jsx(En,{title:e?"Mark as incomplete":"Mark as completed",children:i.jsx(ri,{control:i.jsx(hl,{checked:e,onChange:a,disabled:t,color:"success",size:"small"}),label:n??(e?"Completed":"Mark complete")})})},Ihe={pending:"Pending",in_progress:"In Progress",completed:"Completed",archived:"Archived"},Nhe={pending:"warning",in_progress:"info",completed:"success",archived:"default"},CR=e=>e?new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric",year:"numeric"}).format(new Date(e)):"No due date",L2=typeof Intl<"u"&&"RelativeTimeFormat"in Intl?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null,pI=e=>{if(!e)return"Never";const t=new Date(e);if(Number.isNaN(t.getTime())||!L2)return CR(e);const r=t.getTime()-Date.now(),n=Math.abs(r),a=[["day",1e3*60*60*24],["hour",1e3*60*60],["minute",1e3*60]];for(const[o,s]of a)if(n>=s||o==="minute"){const l=Math.round(r/s);return L2.format(l,o)}return L2.format(0,"minute")},Dhe=({tasks:e,onSelect:t,onToggleComplete:r,onEdit:n,onDelete:a})=>e.length===0?i.jsxs(J,{textAlign:"center",py:6,color:"text.secondary",sx:{border:"1px dashed",borderColor:"divider",borderRadius:3,backgroundColor:"background.paper"},children:[i.jsx(fI,{sx:{fontSize:48,mb:1}}),i.jsx(B,{variant:"h6",children:"No tasks found"}),i.jsx(B,{variant:"body2",children:"Use the New task button above to create your first assignment."})]}):i.jsx(ct,{spacing:2.5,children:e.map(o=>{const s=o.dueDate?new Date(o.dueDate):null,l=Date.now(),c=!!(s&&s.getTime()<l&&o.status!=="completed"),u=s&&o.status!=="completed"?Math.ceil((s.getTime()-l)/(1e3*60*60*24)):null,d=typeof u=="number"&&u>=0&&u<=3,f=c?"error.main":o.status==="completed"?"success.main":d?"warning.main":"info.main";return i.jsxs(Br,{elevation:0,sx:{position:"relative",borderRadius:3,border:"1px solid",borderColor:"divider",overflow:"hidden",transition:"all 0.2s ease-in-out",backgroundColor:"background.paper","&:hover":{boxShadow:8,transform:"translateY(-2px)"}},children:[i.jsx(J,{sx:{position:"absolute",top:0,left:0,bottom:0,width:6,bgcolor:f}}),i.jsx($8,{onClick:()=>t(o),sx:{alignSelf:"stretch"},children:i.jsx(J,{sx:{p:{xs:2.5,sm:3}},children:i.jsxs(ct,{spacing:2,children:[i.jsxs(ct,{direction:{xs:"column",md:"row"},spacing:1.5,justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},children:[i.jsx(B,{variant:"h6",children:o.title}),i.jsxs(ct,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",useFlexGap:!0,children:[i.jsx(ot,{label:Ihe[o.status],color:Nhe[o.status],size:"small"}),c&&o.status!=="completed"&&i.jsx(ot,{label:"Overdue",color:"error",size:"small",variant:"outlined"}),o.status==="completed"&&i.jsx(ot,{label:`Completed ${pI(o.completedAt)}`,color:"success",size:"small",variant:"outlined"})]})]}),o.description&&i.jsx(B,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:o.description}),i.jsxs(ct,{direction:{xs:"column",md:"row"},spacing:2,justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},children:[i.jsxs(ct,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:[i.jsx(ot,{icon:i.jsx(VL,{fontSize:"small"}),label:CR(o.dueDate),color:c?"error":d?"warning":"default",variant:o.dueDate?"filled":"outlined",size:"small"}),i.jsx(ot,{icon:i.jsx(fI,{fontSize:"small"}),label:`${o.noteCount} note${o.noteCount===1?"":"s"}`,size:"small",variant:"outlined"}),i.jsx(ot,{icon:i.jsx(Ehe,{fontSize:"small"}),label:`Updated ${pI(o.updatedAt)}`,size:"small",variant:"outlined"})]}),o.assignees.length>0?i.jsx(B8,{max:4,sx:{"& .MuiAvatar-root":{width:32,height:32,fontSize:14}},children:o.assignees.map(h=>i.jsx(En,{title:h.username||h.email,children:i.jsx(Tp,{children:(h.username||h.email||"?").charAt(0).toUpperCase()})},`${o.id}-assignee-${h.id}`))}):i.jsx(ot,{label:"Unassigned",size:"small",variant:"outlined"})]})]})})}),i.jsx(Gn,{}),i.jsxs(Bh,{sx:{px:{xs:2,sm:3},py:1.5,justifyContent:"space-between",alignItems:"center"},children:[i.jsx(J,{onClick:h=>h.stopPropagation(),sx:{display:"flex",alignItems:"center"},children:i.jsx(SR,{completed:o.status==="completed",onToggle:h=>r(o,h),label:o.status==="completed"?"Completed":"Mark complete"})}),i.jsxs(ct,{direction:"row",spacing:1.5,alignItems:"center",children:[i.jsx(En,{title:"Edit task",children:i.jsx(pr,{onClick:h=>{h.stopPropagation(),n(o)},children:i.jsx(tu,{})})}),i.jsx(En,{title:"Delete task",children:i.jsx(pr,{color:"error",onClick:h=>{h.stopPropagation(),a(o)},children:i.jsx(ua,{})})})]})]})]},o.id)})}),xh=e=>e?new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric"}).format(new Date(e)):"Not set",Mhe=({open:e,task:t,loading:r,onClose:n,onEdit:a,onToggleComplete:o,onAddNote:s})=>{const[l,c]=y.useState(""),[u,d]=y.useState(!1),[f,h]=y.useState(!1);y.useEffect(()=>{e||(c(""),d(!1),h(!1))},[e]);const p=async()=>{if(l.trim()){d(!0);try{await s(l.trim()),c("")}finally{d(!1)}}},g=async m=>{h(!0);try{await o(m)}finally{h(!1)}};return i.jsxs(gr,{open:e,onClose:n,fullWidth:!0,maxWidth:"md",children:[i.jsxs(vr,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsx(B,{variant:"h6",children:"Task details"}),i.jsx(pr,{onClick:n,children:i.jsx(lj,{})})]}),i.jsx(yr,{dividers:!0,children:r&&!t?i.jsx(B,{variant:"body2",children:"Loading task details"}):t?i.jsxs(ct,{spacing:3,children:[i.jsxs(J,{children:[i.jsxs(ct,{direction:"row",spacing:2,alignItems:"center",flexWrap:"wrap",children:[i.jsx(B,{variant:"h5",children:t.title}),i.jsx(ot,{label:t.status.replace("_"," "),color:t.status==="completed"?"success":"default"})]}),t.description&&i.jsx(B,{variant:"body1",sx:{mt:1},color:"text.secondary",children:t.description})]}),i.jsxs(ct,{direction:{xs:"column",sm:"row"},spacing:3,children:[i.jsxs(J,{children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",children:"Due date"}),i.jsx(B,{variant:"body1",children:xh(t.dueDate)})]}),i.jsxs(J,{children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",children:"Last updated"}),i.jsx(B,{variant:"body1",children:xh(t.updatedAt)})]}),i.jsxs(J,{children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",children:"Completed at"}),i.jsx(B,{variant:"body1",children:xh(t.completedAt)})]})]}),i.jsxs(J,{children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Assigned team members"}),t.assignees.length===0?i.jsx(B,{variant:"body2",color:"text.secondary",children:"No assignees yet."}):i.jsx(ct,{direction:"row",spacing:1,flexWrap:"wrap",children:t.assignees.map(m=>i.jsx(ot,{label:m.username||m.email},m.id))})]}),i.jsx(Gn,{}),i.jsxs(ct,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:{xs:"flex-start",sm:"center"},children:[i.jsx(SR,{completed:t.status==="completed",onToggle:g,disabled:f}),i.jsx(ye,{variant:"outlined",onClick:a,children:"Edit task"})]}),i.jsxs(J,{children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Notes"}),t.notes&&t.notes.length>0?i.jsx(ga,{dense:!0,children:t.notes.map(m=>i.jsx(Ca,{alignItems:"flex-start",disableGutters:!0,children:i.jsx(Jn,{primary:m.note,secondary:m.authorName?`${m.authorName}  ${xh(m.createdAt)}`:xh(m.createdAt)})},m.id))}):i.jsx(B,{variant:"body2",color:"text.secondary",children:"No notes yet."})]}),i.jsxs(ct,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:{xs:"stretch",sm:"center"},children:[i.jsx(Ae,{label:"Add a note",fullWidth:!0,value:l,onChange:m=>c(m.target.value),multiline:!0,minRows:2}),i.jsx(ye,{variant:"contained",onClick:p,disabled:!l.trim()||u,children:"Add note"})]})]}):i.jsx(B,{variant:"body2",children:"Task not found."})}),i.jsx(Cr,{children:i.jsx(ye,{onClick:n,children:"Close"})})]})},Lhe=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}],Rhe=e=>{if(!e)return"";try{const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toISOString().slice(0,10)}catch{return""}},qhe=({open:e,mode:t,initialTask:r,assignees:n,submitting:a,onClose:o,onSubmit:s})=>{const[l,c]=y.useState(""),[u,d]=y.useState(""),[f,h]=y.useState(""),[p,g]=y.useState("pending"),[m,x]=y.useState([]),[b,_]=y.useState(""),[w,A]=y.useState({});y.useEffect(()=>{e&&(t==="edit"&&r?(c(r.title),d(r.description??""),h(Rhe(r.dueDate)),g(r.status),x(r.assignees.map(S=>S.id))):(c(""),d(""),h(""),g("pending"),x([])),_(""),A({}))},[e,t,r]);const O=y.useMemo(()=>[...n].sort((S,I)=>(S.username||S.email||"").localeCompare(I.username||I.email||"")),[n]),T=async()=>{const S=l.trim();if(!S){A({title:"Title is required"});return}const I=u.trim(),z={title:S,description:I.length>0?I:null,dueDate:f?new Date(f).toISOString():null,status:p,assigneeIds:m};t==="create"&&b.trim()&&(z.initialNote=b.trim()),await s(z)},E=t==="create"?"Create task":"Edit task";return i.jsxs(gr,{open:e,onClose:o,fullWidth:!0,maxWidth:"sm",children:[i.jsx(vr,{children:E}),i.jsx(yr,{children:i.jsxs(ct,{spacing:3,sx:{mt:1},children:[i.jsx(Ae,{label:"Title",value:l,onChange:S=>c(S.target.value),error:!!w.title,helperText:w.title,required:!0,autoFocus:!0}),i.jsx(Ae,{label:"Description",value:u,onChange:S=>d(S.target.value),multiline:!0,minRows:3}),i.jsx(Ae,{label:"Due date",type:"date",value:f,onChange:S=>h(S.target.value),InputLabelProps:{shrink:!0}}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{id:"task-status-select",children:"Status"}),i.jsx(hn,{labelId:"task-status-select",value:p,label:"Status",onChange:S=>g(S.target.value),children:Lhe.map(S=>i.jsx(tr,{value:S.value,children:S.label},S.value))})]}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(fn,{id:"task-assignees-label",children:"Assign to"}),i.jsx(hn,{labelId:"task-assignees-label",multiple:!0,value:m.map(String),onChange:S=>{const I=S.target.value,z=typeof I=="string"?I.split(","):I;x(z.map(k=>Number(k)).filter(k=>!Number.isNaN(k)))},input:i.jsx(qI,{label:"Assign to"}),renderValue:S=>{const I=S;return I.length===0?"No assignees":I.map(z=>{const k=O.find(M=>M.id===Number(z));return k?.username||k?.email||z}).join(", ")},children:O.map(S=>i.jsx(tr,{value:String(S.id),children:i.jsx(Jn,{primary:S.username||S.email})},S.id))})]}),t==="create"&&i.jsxs(J,{children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Initial note (optional)"}),i.jsx(Ae,{placeholder:"Share context with your team",value:b,onChange:S=>_(S.target.value),fullWidth:!0,multiline:!0,minRows:2})]})]})}),i.jsxs(Cr,{children:[i.jsx(ye,{onClick:o,disabled:a,children:"Cancel"}),i.jsx(ye,{onClick:T,variant:"contained",disabled:a,children:t==="create"?"Create task":"Save changes"})]})]})};var bh={},mI;function Fhe(){if(mI)return bh;mI=1;var e=cr();Object.defineProperty(bh,"__esModule",{value:!0}),bh.default=void 0;var t=e(dr()),r=ur();return bh.default=(0,t.default)((0,r.jsx)("path",{d:"M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V10h14zM9 14H7v-2h2zm4 0h-2v-2h2zm4 0h-2v-2h2zm-8 4H7v-2h2zm4 0h-2v-2h2zm4 0h-2v-2h2z"}),"CalendarMonth"),bh}var $he=Fhe();const Bhe=It($he),Uhe={pending:"Pending",in_progress:"In Progress",completed:"Completed",archived:"Archived"},zhe={pending:"warning",in_progress:"info",completed:"success",archived:"default"},Whe=({tasks:e,loading:t,onSelectTask:r})=>{const n=y.useMemo(()=>{const h=new Map;return e.forEach(p=>{if(!p.dueDate)return;const g=Rt(p.dueDate);if(!g.isValid())return;const m=g.format("YYYY-MM-DD"),x=h.get(m)??[];x.push(p),h.set(m,x)}),h.forEach(p=>{p.sort((g,m)=>{const x=Rt(g.dueDate??0).valueOf(),b=Rt(m.dueDate??0).valueOf();return x-b})}),h},[e]),a=y.useMemo(()=>{if(n.size===0)return Rt();const h=Rt().format("YYYY-MM-DD");if(n.has(h))return Rt();const p=Array.from(n.keys()).sort()[0];return p?Rt(p):Rt()},[n]),[o,s]=y.useState(a);y.useEffect(()=>{const h=o.format("YYYY-MM-DD");if(n.size===0||n.has(h))return;const p=Rt(),g=p.format("YYYY-MM-DD");if(n.has(g)){s(p);return}const m=Array.from(n.keys()).sort()[0];m&&s(Rt(m))},[o,n]);const l=o.format("YYYY-MM-DD"),c=n.get(l)??[],u=n.size>0,d=Rt(),f=h=>{const p=h.day.format("YYYY-MM-DD"),g=n.get(p)??[],m=g.length>0,x=g.some(b=>b.dueDate&&Rt(b.dueDate).isBefore(d)&&b.status!=="completed");return i.jsx(Jw,{overlap:"circular",variant:m?"dot":"standard",color:x?"error":"primary",anchorOrigin:{vertical:"bottom",horizontal:"right"},children:i.jsx(z8,{...h,sx:{...m?{fontWeight:600}:null}})},p)};return i.jsx(Br,{sx:{borderRadius:3,border:"1px solid",borderColor:"divider",boxShadow:"0 24px 60px -36px rgba(15, 23, 42, 0.35)"},children:i.jsxs(Vr,{sx:{p:{xs:3,md:4}},children:[i.jsxs(ct,{direction:"row",spacing:1.5,alignItems:"center",mb:2,children:[i.jsx(Bhe,{color:"primary"}),i.jsx(B,{variant:"h5",component:"h2",sx:{fontWeight:600},children:"Due date calendar"})]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Visualize upcoming deadlines and jump directly to the tasks that need your attention."}),i.jsxs(ct,{direction:{xs:"column",lg:"row"},spacing:{xs:3,lg:4},mt:3,alignItems:{xs:"stretch",lg:"flex-start"},children:[i.jsx(U8,{value:o,onChange:h=>h&&s(h),views:["day"],slots:{day:f},sx:{borderRadius:2,border:"1px solid",borderColor:"divider",p:1.5}}),i.jsxs(J,{sx:{flex:1,width:"100%"},children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:o.format("MMMM D, YYYY")}),t?i.jsx(J,{display:"flex",justifyContent:"center",py:4,children:i.jsx(nr,{size:28})}):u?c.length===0?i.jsx(J,{sx:{mt:2,p:3,borderRadius:2,border:"1px dashed",borderColor:"divider",textAlign:"center",color:"text.secondary"},children:i.jsx(B,{variant:"body2",children:"No tasks are due on this day. Select another date to explore upcoming work."})}):i.jsx(ct,{spacing:1.5,mt:2,children:c.map(h=>{const p=Rt(h.dueDate),g=h.dueDate&&p.isBefore(d)&&h.status!=="completed";return i.jsx(J,{onClick:()=>r?.(h),role:r?"button":void 0,tabIndex:r?0:void 0,onKeyDown:m=>{r&&(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),r(h))},sx:{p:2.25,borderRadius:2,border:"1px solid",borderColor:"divider",backgroundColor:"background.paper",cursor:r?"pointer":"default",transition:"all 0.2s ease-in-out","&:hover":r?{borderColor:"primary.main",boxShadow:3}:void 0},children:i.jsxs(ct,{spacing:1,children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:h.title}),h.description&&i.jsx(B,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:h.description}),i.jsxs(ct,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",useFlexGap:!0,children:[i.jsx(ot,{label:Uhe[h.status],color:zhe[h.status],size:"small"}),g&&i.jsx(ot,{label:"Overdue",color:"error",size:"small",variant:"outlined"}),h.dueDate&&i.jsx(ot,{label:`Due ${p.format("MMM D, YYYY")}`,color:"info",size:"small",variant:"outlined"})]})]})},h.id)})}):i.jsx(J,{sx:{mt:2,p:3,borderRadius:2,border:"1px dashed",borderColor:"divider",textAlign:"center",color:"text.secondary"},children:i.jsx(B,{variant:"body2",children:"None of your tasks have due dates yet. Add due dates to see them on the calendar."})})]})]})]})})},gI=e=>[...e].sort((t,r)=>t-r),Hhe=(e,t)=>{if(e.length!==t.length)return!1;const r=gI(e),n=gI(t);return r.every((a,o)=>a===n[o])},vI={includeCompleted:!1,includeArchived:!1},Vhe=()=>{const[e,t]=y.useState([]),[r,n]=y.useState(vI),[a,o]=y.useState([]),[s,l]=y.useState(null),[c,u]=y.useState(!0),[d,f]=y.useState(null),[h,p]=y.useState(null),[g,m]=y.useState(!1),[x,b]=y.useState(!1),[_,w]=y.useState(!1),[A,O]=y.useState("create"),[T,E]=y.useState(!1),[S,I]=y.useState(null),z=y.useCallback(async()=>{u(!0),f(null);try{const[H,U]=await Promise.all([wne(r),yw()]);t(H),l(U)}catch(H){console.error(H),f("Failed to load tasks. Please try again later.")}finally{u(!1)}},[r]),k=y.useCallback(async()=>{try{const H=await yw();l(H)}catch(H){console.error("Failed to refresh task summary",H)}},[]);y.useEffect(()=>{z()},[z]),y.useEffect(()=>{(async()=>{try{const U=await Tne();o(U)}catch(U){console.error(U),ge.error("Unable to load team members")}})()},[]);const M=H=>{n(H)},R=()=>{n(vI)},F=()=>{z()},W=()=>{O("create"),I(null),w(!0)},K=H=>{O("edit"),I(H),w(!0)},Z=async H=>{b(!0);try{const U=await jne(H.id);p(U),m(!0)}catch(U){console.error(U),ge.error("Unable to load task details")}finally{b(!1)}},D=y.useCallback(H=>{t(U=>U.some(le=>le.id===H.id)?U.map(le=>le.id===H.id?{...le,...H}:le):[H,...U])},[]),P=async H=>{try{if(E(!0),A==="create"){const U=await Sne({...H,description:H.description??null});ge.success("Task created successfully"),w(!1),I(null),D(U)}else if(A==="edit"&&S){const U=await Cne(S.id,{title:H.title,description:H.description??null,status:H.status,dueDate:H.dueDate??null}),te=S.assignees?.map(ae=>ae.id)??[],oe=!Hhe(te,H.assigneeIds)?await Ane(S.id,H.assigneeIds):{...U,assignees:S.assignees};ge.success("Task updated successfully"),w(!1),I(null),D(oe),p(ae=>ae&&ae.id===oe.id?{...ae,...oe,notes:ae.notes}:ae)}await z()}catch(U){console.error(U),ge.error("Failed to save task changes")}finally{E(!1)}},$=async(H,U)=>{try{const te=await Pne(H.id,U);D(te),p(le=>le&&le.id===te.id?{...le,...te,notes:le.notes}:le),ge.success(U?"Task marked as completed":"Task reopened"),await k()}catch(te){console.error(te),ge.error("Failed to update task status")}},Q=async H=>{if(window.confirm(`Delete task "${H.title}"? This action cannot be undone.`))try{await kne(H.id),t(te=>te.filter(le=>le.id!==H.id)),h?.id===H.id&&(m(!1),p(null)),ge.success("Task deleted"),await z()}catch(te){console.error(te),ge.error("Failed to delete task")}},C=async H=>{if(h)try{const U=await One(h.id,H);p(te=>te&&{...te,notes:[U,...te.notes??[]],noteCount:(te.noteCount??0)+1,lastNoteAt:U.createdAt}),t(te=>te.map(le=>le.id===h.id?{...le,noteCount:le.noteCount+1,lastNoteAt:U.createdAt}:le)),ge.success("Note added")}catch(U){console.error(U),ge.error("Failed to add note")}},L=y.useMemo(()=>r,[r]);return i.jsxs(ir,{maxWidth:"lg",sx:{py:4},children:[i.jsxs(ct,{spacing:3,children:[i.jsx(YL,{summary:s,loading:c&&e.length===0,onRefresh:F}),i.jsx(Whe,{tasks:e,loading:c&&e.length===0,onSelectTask:Z}),i.jsxs(xt,{sx:{p:{xs:2.5,md:4},borderRadius:3,border:"1px solid",borderColor:"divider",boxShadow:"0 24px 60px -36px rgba(15, 23, 42, 0.45)",background:"linear-gradient(145deg, rgba(15, 118, 110, 0.04) 0%, rgba(30, 64, 175, 0.05) 100%)"},children:[i.jsxs(ct,{direction:{xs:"column",md:"row"},spacing:2,justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},children:[i.jsxs(J,{children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Tasks"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Manage assignments, due dates, and shared notes for your team."})]}),i.jsxs(ct,{direction:"row",spacing:1,children:[i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Es,{}),onClick:F,children:"Refresh"}),i.jsx(ye,{variant:"contained",startIcon:i.jsx(Ba,{}),onClick:W,children:"New task"})]})]}),i.jsx(J,{sx:{mt:3},children:i.jsx(Ahe,{filters:L,assignees:a,onChange:M,onReset:R})}),d&&i.jsx(Ot,{severity:"error",sx:{mt:2},children:d}),i.jsx(J,{sx:{mt:3},children:c&&e.length===0?i.jsx(J,{display:"flex",justifyContent:"center",py:6,children:i.jsx(nr,{})}):i.jsx(Dhe,{tasks:e,onSelect:Z,onToggleComplete:$,onEdit:K,onDelete:Q})})]})]}),i.jsx(Mhe,{open:g,task:h,loading:x,onClose:()=>m(!1),onEdit:()=>{h&&K(h)},onToggleComplete:H=>h?$(h,H):Promise.resolve(),onAddNote:C}),i.jsx(qhe,{open:_,mode:A,initialTask:S,assignees:a,submitting:T,onClose:()=>w(!1),onSubmit:P})]})},Ghe=async(e="all")=>(await ve.get("/api/return-orders",{params:{status:e}})).data,Yhe=async e=>(await ve.get(`/api/return-orders/${e}`)).data,Khe=async e=>(await ve.post("/api/return-orders",e)).data,Qhe=async(e,t)=>{await ve.put(`/api/return-orders/${e}`,t)},Xhe=async e=>{await ve.delete(`/api/return-orders/${e}`)},Jhe=async e=>(await ve.get(`/api/return-orders/by-purchase/${e}`)).data,Zhe=async(e,t)=>{const n=(await ve.get(`/api/return-orders/purchase/${e}/line-items`,{params:t?{excludeReturnId:t}:void 0})).data;return Array.isArray(n)?n:Array.isArray(n?.items)?n.items:Array.isArray(n?.available_items)?n.available_items:[]},epe=e=>{if(!e)return;const t=/filename\*=UTF-8''([^;]+)/i.exec(e);if(t?.[1])try{return decodeURIComponent(t[1])}catch{return t[1]}return/filename="?([^";]+)"?/i.exec(e)?.[1]},tpe=async e=>{try{const t=await ve.get(`/api/return-orders/${e}/pdf`,{responseType:"blob"}),r=new Blob([t.data],{type:"application/pdf"}),n=window.URL.createObjectURL(r),a=epe(t.headers["content-disposition"])||`return-order-${e}.pdf`,o=document.createElement("a");return o.href=n,o.setAttribute("download",a),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(n),!0}catch(t){return console.error("Failed to download return order PDF",t),!1}},rpe=[{label:"All",value:"all"},{label:"Return Requested",value:"Requested"},{label:"Returned",value:"Returned"}],npe=()=>{const[e,t]=y.useState("Requested"),[r,n]=y.useState(""),[a,o]=y.useState([]),[s,l]=y.useState(!1),[c,u]=y.useState(null),d=Nn(),f=y.useCallback(async()=>{l(!0);try{const m=await Ghe(e);o(m)}catch(m){console.error("Failed to load return orders",m),o([])}finally{l(!1)}},[e]);y.useEffect(()=>{f()},[f]);const h=y.useMemo(()=>{if(!r)return a;const m=r.toLowerCase();return a.filter(x=>x.return_number?.toLowerCase().includes(m)||x.purchase_number?.toLowerCase().includes(m)||x.vendor_name?.toLowerCase().includes(m))},[a,r]),p=y.useCallback(async m=>{if(window.confirm(`Delete return order ${m.return_number}? This will restore any associated inventory adjustments.`)){u(m.return_id);try{await Xhe(m.return_id),ge.success(`Return order ${m.return_number} deleted.`),await f()}catch(b){console.error("Failed to delete return order",b);const _=b?.response?.data?.error||"Failed to delete return order.";ge.error(_)}finally{u(null)}}},[f]),g=[{field:"return_number",headerName:"Return #",flex:1,minWidth:150,renderCell:m=>i.jsx(B,{color:"primary",sx:{cursor:"pointer"},children:m.value})},{field:"purchase_number",headerName:"Purchase Order",flex:1,minWidth:150,renderCell:m=>i.jsx(B,{color:"primary",sx:{cursor:"pointer"},children:m.value||"-"})},{field:"vendor_name",headerName:"Vendor",flex:1.3,minWidth:160,valueGetter:m=>m.value||"No Vendor"},{field:"status",headerName:"Status",flex:.8,minWidth:130,renderCell:m=>i.jsx(ot,{label:m.value,color:m.value==="Returned"?"success":"warning",variant:"outlined",size:"small"})},{field:"requested_at",headerName:"Requested On",flex:.9,minWidth:150,valueFormatter:m=>m.value?Rt(m.value).format("YYYY-MM-DD HH:mm"):""},{field:"returned_at",headerName:"Returned On",flex:.9,minWidth:150,valueFormatter:m=>m.value?Rt(m.value).format("YYYY-MM-DD HH:mm"):""},{field:"total_quantity",headerName:"Total Qty",flex:.6,minWidth:110,type:"number",valueFormatter:m=>Number(m.value??0).toFixed(2)},{field:"actions",headerName:"Actions",sortable:!1,filterable:!1,width:80,renderCell:m=>i.jsx(ct,{direction:"row",spacing:.5,children:i.jsx(pr,{size:"small",color:"error","aria-label":"Delete return order",disabled:c===m.row.return_id,onClick:x=>{x.stopPropagation(),p(m.row)},children:i.jsx(ua,{})})})}];return i.jsx(ir,{maxWidth:"xl",sx:{mt:4},children:i.jsxs(J,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Return Orders"}),i.jsxs(ct,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[i.jsx(ye,{variant:"contained",startIcon:i.jsx(Ba,{}),onClick:()=>d("/return-orders/new"),children:"New Return Order"}),i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Es,{}),onClick:f,disabled:s,children:"Refresh"})]}),i.jsx(xt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(J,{sx:{p:2},children:[i.jsxs(ct,{direction:"row",spacing:3,sx:{mb:3},children:[i.jsx(Ae,{label:"Search",variant:"outlined",value:r,onChange:m=>n(m.target.value),InputProps:{startAdornment:i.jsx(oa,{position:"start",children:i.jsx(hi,{sx:{fontSize:32}})}),sx:{fontSize:22,height:56}},sx:{minWidth:340,maxWidth:400,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"medium"}),rpe.map(m=>i.jsx(ot,{label:m.label,onClick:()=>t(m.value),color:e===m.value?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}},m.value))]}),i.jsx(Po,{rows:h,columns:g,loading:s,getRowId:m=>m.return_id,disableRowSelectionOnClick:!0,onRowClick:m=>d(`/return-orders/${m.row.return_id}`),sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224,224,224,1)",cursor:"pointer"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224,224,224,1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"},cursor:"pointer"}})]})})]})})};function ape(){const e=Ds();return y.useMemo(()=>new URLSearchParams(e.search),[e.search])}const yI=()=>{const{id:e}=Ms(),t=Nn(),r=ape(),n=!e||e==="new",[a,o]=y.useState(!0),[s,l]=y.useState(!1),[c,u]=y.useState([]),[d,f]=y.useState(null),[h,p]=y.useState("Requested"),[g,m]=y.useState(""),[x,b]=y.useState(void 0),[_,w]=y.useState(""),[A,O]=y.useState([]),[T,E]=y.useState(null),[S,I]=y.useState(null),[z,k]=y.useState({}),M=y.useCallback(async()=>{try{const Q=(await _de({status:"all"})).map(C=>({label:`${C.purchase_number}  ${C.vendor_name??"No Vendor"}`,purchase_id:C.purchase_id,purchase_number:C.purchase_number,vendor_name:C.vendor_name}));return u(Q),Q}catch($){return console.error("Failed to load purchase orders",$),u([]),[]}},[]),R=y.useCallback(async $=>{try{const Q=await Jhe($),C=Q.filter(H=>H.status==="Requested").length,L=Q.filter(H=>H.status==="Returned").length;k(H=>({...H,[$]:{requested:C,returned:L}}))}catch(Q){console.warn("Unable to load return summary for purchase",Q)}},[]),F=y.useCallback(async($,Q,C)=>{try{const H=(await Zhe($,C))?.map(U=>{const te=Q?.find(le=>le.purchase_line_item_id===U.line_item_id);return{purchase_line_item_id:U.line_item_id,part_number:U.part_number,part_description:U.part_description,unit:U.unit,quantityPurchased:U.quantity,returnable_quantity:U.returnable_quantity,already_requested:U.already_requested,inputQuantity:te?String(te.quantity):"",reason:te?.reason??"",selected:!!te}});O(H??[])}catch(L){console.error("Failed to load available return items",L),O([])}},[]);y.useEffect(()=>{(async()=>{const Q=await M(),C=r.get("purchaseId");if(!n&&e){try{const L=await Yhe(Number(e));E(L),p(L.status),m(L.requested_by??""),b(L.requested_at),w(L.notes??"");const H={label:`${L.purchase_number||""}  ${L.vendor_name||"No Vendor"}`,purchase_id:L.purchase_id,purchase_number:L.purchase_number||"",vendor_name:L.vendor_name||void 0};f(H),await F(L.purchase_id,L.line_items,L.return_id),await R(L.purchase_id)}catch(L){console.error("Failed to load return order detail",L),I("Unable to load return order.")}finally{o(!1)}return}if(C){const L=Number(C);if(Number.isFinite(L)){const U=(Q.length?Q:c).find(te=>te.purchase_id===L);U&&(f(U),await F(L),await R(L))}}o(!1)})()},[F,e,n,M,R,r]);const W=async($,Q)=>{f(Q),Q?(await F(Q.purchase_id,T?.line_items,T?.return_id??void 0),await R(Q.purchase_id)):O([])},K=y.useMemo(()=>A.reduce(($,Q)=>{if(!Q.selected)return $;const C=parseFloat(Q.inputQuantity||"0");return $+(Number.isFinite(C)?C:0)},0),[A]),Z=y.useMemo(()=>A.some($=>$.returnable_quantity>0),[A]),D=y.useMemo(()=>A.some($=>$.selected),[A]),P=async()=>{if(I(null),!d){I("Select a purchase order before saving.");return}const $=A.filter(C=>C.selected).map(C=>({purchase_line_item_id:C.purchase_line_item_id,quantity:parseFloat(C.inputQuantity||"0"),reason:C.reason?.trim()?C.reason.trim():void 0,maxQuantity:C.returnable_quantity,part_number:C.part_number})).filter(C=>Number.isFinite(C.quantity)&&C.quantity>0);if($.length===0){I("Select at least one part and enter a quantity to return.");return}for(const C of $)if(C.quantity>(C.maxQuantity??0)+1e-6){I(`Return quantity for part ${C.part_number} exceeds the available quantity.`);return}const Q={purchase_id:d.purchase_id,status:h,requested_by:g||void 0,requested_at:x,notes:_||void 0,line_items:$.map(({purchase_line_item_id:C,quantity:L,reason:H})=>({purchase_line_item_id:C,quantity:L,reason:H}))};try{if(l(!0),n){const C=await Khe(Q);ge.success(`Return order ${C.return_number} created.`)}else e&&(await Qhe(Number(e),{status:Q.status,requested_by:Q.requested_by,requested_at:Q.requested_at,notes:Q.notes,line_items:Q.line_items}),ge.success("Return order updated."));t("/return-orders")}catch(C){console.error("Failed to save return order",C);const L=C?.response?.data?.error||"Unable to save return order.";I(L),ge.error(L)}finally{l(!1)}};return a?i.jsx(J,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:i.jsx(nr,{})}):i.jsx(ir,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsxs(ct,{spacing:3,children:[i.jsxs(ct,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[i.jsxs(J,{children:[i.jsx(B,{variant:"h4",component:"h1",children:n?"Create Return Order":`Return Order ${T?.return_number??""}`}),d&&i.jsxs(ct,{direction:"row",spacing:1,sx:{mt:1},children:[i.jsx(ot,{label:`Purchase: ${d.purchase_number}`,color:"primary",variant:"outlined"}),i.jsx(ot,{label:`Vendor: ${d.vendor_name??"No Vendor"}`,variant:"outlined",color:"secondary"}),z[d.purchase_id]&&i.jsx(ot,{label:`Returns - Requested: ${z[d.purchase_id].requested}  Completed: ${z[d.purchase_id].returned}`,color:"default",variant:"outlined"})]})]}),i.jsxs(ct,{direction:{xs:"column",sm:"row"},spacing:2,children:[i.jsx(ye,{variant:"outlined",startIcon:i.jsx(Vp,{}),onClick:()=>t("/return-orders"),children:"Back to List"}),!n&&e&&i.jsx(ye,{variant:"outlined",startIcon:i.jsx(da,{}),onClick:async()=>{await tpe(Number(e))||ge.error("Failed to download return order PDF. Please try again.")},children:"Download"}),i.jsx(ye,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:P,disabled:s,children:s?"Saving":"Save & Close"})]})]}),S&&i.jsx(Ot,{severity:"error",children:S}),i.jsx(xt,{sx:{p:3},elevation:1,children:i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Fa,{options:c,value:d,onChange:W,getOptionLabel:$=>$.label,renderInput:$=>i.jsx(Ae,{...$,label:"Purchase Order",placeholder:"Select purchase order"}),disabled:!n&&!!T})}),i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsxs(Ae,{select:!0,SelectProps:{native:!0},label:"Status",value:h,onChange:$=>p($.target.value),fullWidth:!0,children:[i.jsx("option",{value:"Requested",children:"Requested"}),i.jsx("option",{value:"Returned",children:"Returned"})]})}),i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsx(Ae,{label:"Requested By",value:g,onChange:$=>m($.target.value),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Ae,{label:"Requested At",type:"datetime-local",fullWidth:!0,value:x?Rt(x).format("YYYY-MM-DDTHH:mm"):"",onChange:$=>b($.target.value?new Date($.target.value).toISOString():void 0),helperText:"Optional timestamp for when the return was requested"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ae,{label:"Notes",value:_,onChange:$=>w($.target.value),multiline:!0,rows:3,fullWidth:!0,placeholder:"Add any notes for the vendor or internal team"})})]})}),i.jsx(xt,{sx:{p:3},elevation:1,children:i.jsxs(ct,{spacing:2,children:[i.jsxs(ct,{direction:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},children:[i.jsx(B,{variant:"h6",children:"Return Line Items"}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Total Selected Quantity: ",K.toFixed(2)]})]}),A.length>0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"Check the boxes to add parts to this return, then adjust the quantity being sent back."}),A.length===0?i.jsx(B,{variant:"body2",color:"text.secondary",children:"Select a purchase order to view parts eligible for return."}):i.jsxs(i.Fragment,{children:[!Z&&i.jsx(Ot,{severity:"info",children:"All parts on this purchase order have already been requested for return."}),i.jsx(va,{sx:{maxHeight:420},children:i.jsxs(sa,{size:"small",stickyHeader:!0,children:[i.jsx(la,{children:i.jsxs(br,{children:[i.jsx(Pe,{padding:"checkbox",children:"Select"}),i.jsx(Pe,{children:"Part Number"}),i.jsx(Pe,{children:"Description"}),i.jsx(Pe,{align:"right",children:"Purchased"}),i.jsx(Pe,{align:"right",children:"Available"}),i.jsx(Pe,{align:"right",children:"Qty to Return"}),i.jsx(Pe,{children:"Reason"})]})}),i.jsx(ca,{children:A.map($=>{const Q=$.returnable_quantity<=0&&!$.selected;return i.jsxs(br,{hover:!0,selected:$.selected,sx:{"&.Mui-selected":{backgroundColor:C=>C.palette.action.hover}},children:[i.jsx(Pe,{padding:"checkbox",children:i.jsx(Xi,{checked:$.selected,onChange:C=>{const L=C.target.checked;O(H=>H.map(U=>{if(U.purchase_line_item_id!==$.purchase_line_item_id)return U;const te=U.returnable_quantity>0?String(U.returnable_quantity):"";return{...U,selected:L,inputQuantity:L?U.inputQuantity||te:"",reason:L?U.reason:""}}))},disabled:Q,inputProps:{"aria-label":`Select ${$.part_number}`}})}),i.jsxs(Pe,{children:[i.jsx(B,{variant:"body2",fontWeight:600,children:$.part_number}),$.unit&&i.jsxs(B,{variant:"caption",color:"text.secondary",display:"block",children:["Unit: ",$.unit]})]}),i.jsx(Pe,{children:i.jsx(B,{variant:"body2",children:$.part_description||"-"})}),i.jsx(Pe,{align:"right",children:i.jsx(B,{variant:"body2",children:$.quantityPurchased.toFixed(2)})}),i.jsxs(Pe,{align:"right",children:[i.jsx(B,{variant:"body2",children:$.returnable_quantity.toFixed(2)}),$.already_requested>0&&i.jsxs(B,{variant:"caption",color:"text.secondary",display:"block",children:["Already requested: ",$.already_requested.toFixed(2)]})]}),i.jsx(Pe,{align:"right",sx:{minWidth:140},children:i.jsx(Ae,{type:"number",size:"small",value:$.inputQuantity,onChange:C=>{const L=C.target.value;O(H=>H.map(U=>{if(U.purchase_line_item_id!==$.purchase_line_item_id)return U;const te=parseFloat(L),le=!Number.isNaN(te)&&te>0;return{...U,inputQuantity:L,selected:le?!0:U.selected}}))},inputProps:{min:0,step:.01,max:$.returnable_quantity},fullWidth:!0,disabled:!$.selected})}),i.jsx(Pe,{sx:{minWidth:200},children:i.jsx(Ae,{size:"small",value:$.reason,onChange:C=>{const L=C.target.value;O(H=>H.map(U=>U.purchase_line_item_id===$.purchase_line_item_id?{...U,reason:L}:U))},placeholder:"Optional",fullWidth:!0,disabled:!$.selected,multiline:!0,minRows:1})})]},$.purchase_line_item_id)})})]})})]}),A.length>0&&!D&&Z&&i.jsx(Ot,{severity:"info",children:"Select at least one part to include it in the return order."})]})})]})})};var _h={},xI;function ipe(){if(xI)return _h;xI=1;var e=cr();Object.defineProperty(_h,"__esModule",{value:!0}),_h.default=void 0;var t=e(dr()),r=ur();return _h.default=(0,t.default)((0,r.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility"),_h}var ope=ipe();const bI=It(ope);var wh={},_I;function spe(){if(_I)return wh;_I=1;var e=cr();Object.defineProperty(wh,"__esModule",{value:!0}),wh.default=void 0;var t=e(dr()),r=ur();return wh.default=(0,t.default)((0,r.jsx)("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"}),"Replay"),wh}var lpe=spe();const cpe=It(lpe),upe=[{key:"customerPoNumber",label:"Customer PO #"},{key:"quotedPrice",label:"Quoted Price"},{key:"sourceQuote",label:"Source Quote"},{key:"vin",label:"VIN #"},{key:"unitNumber",label:"Unit #"},{key:"vehicleMake",label:"Vehicle Make"},{key:"vehicleModel",label:"Vehicle Model"},{key:"invoiceStatus",label:"Invoice Status"},{key:"wantedByDate",label:"Wanted By Date"},{key:"wantedByTimeOfDay",label:"Wanted By Time of Day"},{key:"productDescription",label:"Product Description"},{key:"terms",label:"Terms"},{key:"mileage",label:"Mileage"}],dpe=[{key:"vin",label:"VIN #"},{key:"productDescription",label:"Product Description"},{key:"unitNumber",label:"Unit #"},{key:"vehicleMake",label:"Vehicle Make"},{key:"vehicleModel",label:"Vehicle Model"},{key:"mileage",label:"Mileage"}],fpe=()=>{const{user:e}=ea(),t=e?.access_role==="Admin",[r,n]=y.useState(kd),[a,o]=y.useState(!0),[s,l]=y.useState(!1),[c,u]=y.useState(null),[d,f]=y.useState(null);y.useEffect(()=>{(async()=>{o(!0),u(null);try{const x=await Av.fetchSettings();n(x)}catch(x){console.error("Failed to load field visibility settings",x),u("Could not load field visibility settings. Using defaults.")}finally{o(!1)}})()},[]);const h=(x,b)=>(_,w)=>{n(A=>({...A,[x]:{...A[x],[b]:w}}))},p=()=>{n(kd),f(null),u(null)},g=async()=>{if(!t){u("Only admins can change field visibility defaults.");return}l(!0),u(null),f(null);try{const x=await Av.updateSettings(r);n(x),f("Field visibility updated. Users can still adjust their own view within these limits.")}catch(x){console.error("Failed to save field visibility settings",x),u("Failed to save field visibility settings. Please try again.")}finally{l(!1)}},m=(x,b,_,w)=>i.jsxs(xt,{elevation:2,sx:{p:3},children:[i.jsxs(ct,{direction:"row",spacing:1,alignItems:"center",sx:{mb:1},children:[i.jsx(bI,{color:"primary"}),i.jsx(B,{variant:"h6",children:x})]}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:b}),i.jsx(ie,{container:!0,spacing:2,children:w.map(A=>i.jsx(ie,{item:!0,xs:12,sm:6,md:4,children:i.jsx(ri,{control:i.jsx(hl,{color:"primary",checked:!!r[_][A.key],onChange:h(_,A.key),disabled:!t}),label:A.label})},A.key))})]});return i.jsxs(ir,{maxWidth:"lg",children:[i.jsxs(ct,{direction:"row",alignItems:"center",spacing:1,sx:{mb:2},children:[i.jsx(bI,{color:"primary"}),i.jsx(B,{variant:"h5",children:"Field Visibility"}),i.jsx(ot,{label:"Admin default",color:"primary",size:"small"})]}),i.jsx(B,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Choose which sales order and invoice fields are available to users by default. Users can still hide fields locally with the Customize fields/columns toggles, but cannot turn on anything you disable here."}),c?i.jsx(Ot,{severity:"warning",sx:{mb:2},children:c}):null,d?i.jsx(Ot,{severity:"success",sx:{mb:2},children:d}):null,t?null:i.jsx(Ot,{severity:"info",sx:{mb:2},children:"Only admins can change these defaults. You can view the current configuration below."}),a?i.jsx(J,{sx:{display:"flex",justifyContent:"center",py:6},children:i.jsx(nr,{})}):i.jsxs(ct,{spacing:3,children:[m("Sales Orders","Toggle which optional fields appear on sales orders. These act as the baseline for all users.","salesOrders",upe),i.jsx(Gn,{}),m("Invoices","Toggle which optional fields appear on invoices.","invoices",dpe)]}),i.jsxs(ct,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mt:3},children:[i.jsx(ye,{variant:"outlined",startIcon:i.jsx(cpe,{}),onClick:p,disabled:!t||a||s,children:"Reset to defaults"}),i.jsx(ye,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:g,disabled:!t||a||s,children:s?"Saving":"Save"})]})]})},hpe=({children:e})=>{const{isAuthenticated:t,user:r}=ea(),a=Ds().pathname;if(!t)return i.jsx(Ou,{to:"/login",replace:!0});if(r?.access_role==="Time Tracking"){if(a==="/"||a==="/dashboard")return i.jsx(Ou,{to:"/attendance",replace:!0});if(a!=="/time-tracking"&&a!=="/attendance"&&a!=="/messaging"&&!a.startsWith("/open-sales-orders")&&!a.startsWith("/worker-sales-orders"))return i.jsx(Ou,{to:"/attendance",replace:!0})}return r?.access_role==="Sales and Purchase"&&!["/","/open-sales-orders","/invoices","/open-purchase-orders","/purchase-order","/return-orders","/parts-to-order","/inventory","/inventory/smart-search","/supply","/service","/email-settings","/tasks","/messaging"].includes(a)&&!a.startsWith("/open-sales-orders/")&&!a.startsWith("/invoices/")&&!a.startsWith("/open-purchase-orders/")&&!a.startsWith("/purchase-order/")&&!a.startsWith("/return-orders/")?i.jsx(Ou,{to:"/",replace:!0}):r?.access_role==="Quotes"&&a!=="/quotes"&&!a.startsWith("/quotes/")&&a!=="/messaging"?i.jsx(Ou,{to:"/quotes",replace:!0}):i.jsx(i.Fragment,{children:e})},ppe=()=>i.jsxs(Wq,{children:[i.jsx(hr,{path:"/login",element:i.jsx(nne,{})}),i.jsx(hr,{path:"/register",element:i.jsx(ane,{})}),i.jsxs(hr,{path:"/",element:i.jsx(hpe,{children:i.jsx(rne,{})}),children:[i.jsx(hr,{index:!0,element:i.jsx(tE,{})}),i.jsx(hr,{path:"dashboard",element:i.jsx(tE,{})}),i.jsx(hr,{path:"business-profile",element:i.jsx(Xne,{})}),i.jsx(hr,{path:"qbo-account-mapping",element:i.jsx(the,{})}),i.jsx(hr,{path:"customers",element:i.jsx(_ae,{})}),i.jsx(hr,{path:"customers/:id",element:i.jsx(Eae,{})}),i.jsx(hr,{path:"products",element:i.jsx(Kfe,{})}),i.jsx(hr,{path:"products/:id",element:i.jsx(Vae,{})}),i.jsx(hr,{path:"purchase-order",element:i.jsx(R4,{})}),i.jsx(hr,{path:"purchase-order/:id",element:i.jsx(U4,{})}),i.jsx(hr,{path:"open-purchase-orders",element:i.jsx(R4,{})}),i.jsx(hr,{path:"open-purchase-orders/:id",element:i.jsx(U4,{})}),i.jsx(hr,{path:"return-orders",element:i.jsx(npe,{})}),i.jsx(hr,{path:"return-orders/new",element:i.jsx(yI,{})}),i.jsx(hr,{path:"return-orders/:id",element:i.jsx(yI,{})}),i.jsx(hr,{path:"vendors",element:i.jsx(Wae,{})}),i.jsx(hr,{path:"vendors/:id",element:i.jsx(Hae,{})}),i.jsx(hr,{path:"inventory",element:i.jsx(lie,{})}),i.jsx(hr,{path:"inventory/smart-search",element:i.jsx(Kue,{})}),i.jsx(hr,{path:"supply",element:i.jsx(cie,{})}),i.jsx(hr,{path:"service",element:i.jsx(uie,{})}),i.jsx(hr,{path:"employees",element:i.jsx(Xue,{})}),i.jsx(hr,{path:"profile-documents",element:i.jsx(Jue,{})}),i.jsx(hr,{path:"time-tracking",element:i.jsx(yfe,{})}),i.jsx(hr,{path:"attendance",element:i.jsx(Jfe,{})}),i.jsx(hr,{path:"time-tracking/reports",element:i.jsx(Rfe,{})}),i.jsx(hr,{path:"leave-management",element:i.jsx(Hfe,{})}),i.jsx(hr,{path:"leave-history",element:i.jsx(Vfe,{})}),i.jsx(hr,{path:"vacation-days-management",element:i.jsx(Gfe,{})}),i.jsx(hr,{path:"open-sales-orders",element:i.jsx(dde,{})}),i.jsx(hr,{path:"open-sales-orders/:id",element:i.jsx(bde,{})}),i.jsx(hr,{path:"invoices",element:i.jsx(Rde,{})}),i.jsx(hr,{path:"invoices/:id",element:i.jsx(Fde,{})}),i.jsx(hr,{path:"worker-sales-orders",element:i.jsx(Q4,{})}),i.jsx(hr,{path:"worker-sales-orders/:id",element:i.jsx(Q4,{})}),i.jsx(hr,{path:"quotes",element:i.jsx(ple,{})}),i.jsx(hr,{path:"quotes/new",element:i.jsx(x4,{})}),i.jsx(hr,{path:"quotes/:id",element:i.jsx(x4,{})}),i.jsx(hr,{path:"margin-schedule",element:i.jsx(Zue,{})}),i.jsx(hr,{path:"overhead-management",element:i.jsx(rhe,{})}),i.jsx(hr,{path:"parts-to-order",element:i.jsx(nhe,{})}),i.jsx(hr,{path:"tasks",element:i.jsx(Vhe,{})}),i.jsx(hr,{path:"backup-management",element:i.jsx(Xfe,{})}),i.jsx(hr,{path:"field-visibility",element:i.jsx(fpe,{})}),i.jsx(hr,{path:"mobile-user-access",element:i.jsx(ahe,{})}),i.jsx(hr,{path:"email-settings",element:i.jsx(dhe,{})}),i.jsx(hr,{path:"invoice-automator",element:i.jsx(yhe,{})}),i.jsx(hr,{path:"email-templates",element:i.jsx(xhe,{})}),i.jsx(hr,{path:"tasks/:id",element:i.jsx(Che,{})}),i.jsx(hr,{path:"messaging",element:i.jsx(Oue,{})})]}),i.jsx(hr,{path:"*",element:i.jsx(Ou,{to:"/",replace:!0})})]}),mpe=()=>{const[e,t]=y.useState(0),[r,n]=y.useState(!!window.__backendUnavailableSince),[a,o]=y.useState(typeof navigator<"u"?navigator.onLine===!1:!1),s=y.useRef(0),l=y.useRef(r),c=y.useRef(a);return y.useEffect(()=>{l.current=r},[r]),y.useEffect(()=>{c.current=a},[a]),y.useEffect(()=>{window.__triggerSync=async()=>{try{await Sh()>0&&!window.__backendUnavailableSince&&!l.current&&!c.current&&(await B5(),t(await Sh()))}catch{}};let u=!0;const d=async()=>{try{const h=await Sh();if(u&&t(h),!window.__backendUnavailableSince&&!l.current&&!c.current&&h>0){await B5();const p=await Sh();u&&t(p)}}catch{}},f=setInterval(d,15e3);return d(),()=>{u=!1,clearInterval(f)}},[]),y.useEffect(()=>{const u=()=>Date.now(),d=()=>{const b=s.current||0,_=u();return _-b<3e3?!1:(s.current=_,!0)},f=()=>{o(!0),d()&&ge.warn("You appear to be offline. We will retry automatically.")},h=()=>{o(!1),n(!1),d()&&ge.success("Connection restored.")},p=()=>{n(!0),d()&&ge.error("Cannot reach the server. We will keep retrying.")},g=()=>{n(!1)},m=b=>{const _=b?.detail;_?.message&&d()&&ge.error(_.message)},x=()=>{d()&&ge.error("Session expired. Please sign in again.")};return window.addEventListener("offline",f),window.addEventListener("online",h),window.addEventListener("backend:unavailable",p),window.addEventListener("backend:available",g),window.addEventListener("app:error",m),window.addEventListener("auth:expired",x),()=>{window.removeEventListener("offline",f),window.removeEventListener("online",h),window.removeEventListener("backend:unavailable",p),window.removeEventListener("backend:available",g),window.removeEventListener("app:error",m),window.removeEventListener("auth:expired",x)}},[a]),i.jsxs(W8,{theme:L$,children:[i.jsx(H8,{}),i.jsx(N$,{children:i.jsx(M$,{children:i.jsxs(Os,{dateAdapter:oc,children:[i.jsx(Xq,{children:i.jsx(ppe,{})}),i.jsx(Kne,{position:"top-right",autoClose:3e3,newestOnTop:!1,closeOnClick:!0,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"colored"})]})})})]})};Q8.createRoot(document.getElementById("root")).render(i.jsx(mpe,{}));export{Kt as _};
