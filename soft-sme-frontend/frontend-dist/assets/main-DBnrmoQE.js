const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-DBnXEFbX.js","assets/vendor-Bs7gn1Hv.js","assets/mui-DSi_KIbq.js"])))=>i.map(i=>d[i]);
import{r as x,R as a8,j as i,c as i8,b as o8,_ as vI,u as s8,a as sr,d as lr,e as Tr,f as Ce,P as yn,g as yI,h as l8,B as Z,i as mn,A as kp,T as B,I as xr,k as xe,l as Pe,F as ti,S as hl,C as tr,m as Hn,n as c8,o as u8,p as bt,D as qn,q as d8,s as L2,t as ZS,v as Bu,w as sg,x as lg,y as ui,z as xI,L as R2,E as xs,G as Fh,H as bI,J as e5,K as Nc,Q as _I,M as wI,N as f8,O as jI,U as Yw,V as cg,W as SI,X as ug,Y as Kw,Z as rx,$ as ha,a0 as h8,a1 as ja,a2 as p8,a3 as Qw,a4 as Qn,a5 as m8,a6 as CI,a7 as g8,a8 as v8,a9 as t5,aa as rr,ab as Ot,ac as Qi,ad as y8,ae as ie,af as qr,ag as Wr,ah as dt,ai as r5,aj as sa,ak as n5,al as pr,am as mr,an as gr,ao as jr,ap as Ed,aq as Po,ar as st,as as Zt,at as gn,au as x8,av as Qt,aw as AI,ax as pl,ay as tn,az as ln,aA as cn,aB as Jn,aC as Zn,aD as hr,aE as Ae,aF as ea,aG as Os,aH as Ra,aI as os,aJ as Ev,aK as b8,aL as _8,aM as w8,aN as q2,aO as al,aP as pa,aQ as jh,aR as Eu,aS as PI,aT as Id,aU as Tp,aV as dg,aW as Iv,aX as a5,aY as OI,aZ as j8,a_ as S8,a$ as Ep,b0 as kI,b1 as F2,b2 as Uu,b3 as zu,b4 as C8,b5 as A8,b6 as P8,b7 as O8,b8 as TI,b9 as EI,ba as k8,bb as T8,bc as II,bd as E8,be as Xw,bf as i5,bg as nx,bh as o5,bi as I8,bj as N8,bk as D8,bl as s5,bm as $h,bn as NI,bo as M8,bp as L8,bq as R8,br as q8,bs as F8,bt as $8}from"./mui-DSi_KIbq.js";import{a as B8,g as Et,b as U8,c as hm}from"./vendor-Bs7gn1Hv.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=r(a);fetch(a.href,o)}})();var pm={},l5;function z8(){if(l5)return pm;l5=1;var e=B8();return pm.createRoot=e.createRoot,pm.hydrateRoot=e.hydrateRoot,pm}var W8=z8();const H8=Et(W8);/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Bh(){return Bh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Bh.apply(this,arguments)}var Yl;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Yl||(Yl={}));const c5="popstate";function V8(e){e===void 0&&(e={});function t(a,o){let{pathname:s="/",search:l="",hash:c=""}=nu(a.location.hash.substr(1));return!s.startsWith("/")&&!s.startsWith(".")&&(s="/"+s),$2("",{pathname:s,search:l,hash:c},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function r(a,o){let s=a.document.querySelector("base"),l="";if(s&&s.getAttribute("href")){let c=a.location.href,u=c.indexOf("#");l=u===-1?c:c.slice(0,u)}return l+"#"+(typeof o=="string"?o:fg(o))}function n(a,o){Jw(a.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(o)+")")}return Y8(t,r,n,e)}function Aa(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Jw(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function G8(){return Math.random().toString(36).substr(2,8)}function u5(e,t){return{usr:e.state,key:e.key,idx:t}}function $2(e,t,r,n){return r===void 0&&(r=null),Bh({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?nu(t):t,{state:r,key:t&&t.key||n||G8()})}function fg(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function nu(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function Y8(e,t,r,n){n===void 0&&(n={});let{window:a=document.defaultView,v5Compat:o=!1}=n,s=a.history,l=Yl.Pop,c=null,u=d();u==null&&(u=0,s.replaceState(Bh({},s.state,{idx:u}),""));function d(){return(s.state||{idx:null}).idx}function f(){l=Yl.Pop;let y=d(),b=y==null?null:y-u;u=y,c&&c({action:l,location:m.location,delta:b})}function h(y,b){l=Yl.Push;let _=$2(m.location,y,b);r&&r(_,y),u=d()+1;let w=u5(_,u),A=m.createHref(_);try{s.pushState(w,"",A)}catch(P){if(P instanceof DOMException&&P.name==="DataCloneError")throw P;a.location.assign(A)}o&&c&&c({action:l,location:m.location,delta:1})}function p(y,b){l=Yl.Replace;let _=$2(m.location,y,b);r&&r(_,y),u=d();let w=u5(_,u),A=m.createHref(_);s.replaceState(w,"",A),o&&c&&c({action:l,location:m.location,delta:0})}function v(y){let b=a.location.origin!=="null"?a.location.origin:a.location.href,_=typeof y=="string"?y:fg(y);return _=_.replace(/ $/,"%20"),Aa(b,"No window.location.(origin|href) available to create URL for href: "+_),new URL(_,b)}let m={get action(){return l},get location(){return e(a,s)},listen(y){if(c)throw new Error("A history only accepts one active listener");return a.addEventListener(c5,f),c=y,()=>{a.removeEventListener(c5,f),c=null}},createHref(y){return t(a,y)},createURL:v,encodeLocation(y){let b=v(y);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:h,replace:p,go(y){return s.go(y)}};return m}var d5;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(d5||(d5={}));function K8(e,t,r){return r===void 0&&(r="/"),Q8(e,t,r)}function Q8(e,t,r,n){let a=typeof t=="string"?nu(t):t,o=Zw(a.pathname||"/",r);if(o==null)return null;let s=DI(e);X8(s);let l=null;for(let c=0;l==null&&c<s.length;++c){let u=cq(o);l=oq(s[c],u)}return l}function DI(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let a=(o,s,l)=>{let c={relativePath:l===void 0?o.path||"":l,caseSensitive:o.caseSensitive===!0,childrenIndex:s,route:o};c.relativePath.startsWith("/")&&(Aa(c.relativePath.startsWith(n),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(n.length));let u=Jl([n,c.relativePath]),d=r.concat(c);o.children&&o.children.length>0&&(Aa(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),DI(o.children,t,d,u)),!(o.path==null&&!o.index)&&t.push({path:u,score:aq(u,o.index),routesMeta:d})};return e.forEach((o,s)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))a(o,s);else for(let c of MI(o.path))a(o,s,c)}),t}function MI(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,a=r.endsWith("?"),o=r.replace(/\?$/,"");if(n.length===0)return a?[o,""]:[o];let s=MI(n.join("/")),l=[];return l.push(...s.map(c=>c===""?o:[o,c].join("/"))),a&&l.push(...s),l.map(c=>e.startsWith("/")&&c===""?"/":c)}function X8(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:iq(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const J8=/^:[\w-]+$/,Z8=3,eq=2,tq=1,rq=10,nq=-2,f5=e=>e==="*";function aq(e,t){let r=e.split("/"),n=r.length;return r.some(f5)&&(n+=nq),t&&(n+=eq),r.filter(a=>!f5(a)).reduce((a,o)=>a+(J8.test(o)?Z8:o===""?tq:rq),n)}function iq(e,t){return e.length===t.length&&e.slice(0,-1).every((n,a)=>n===t[a])?e[e.length-1]-t[t.length-1]:0}function oq(e,t,r){let{routesMeta:n}=e,a={},o="/",s=[];for(let l=0;l<n.length;++l){let c=n[l],u=l===n.length-1,d=o==="/"?t:t.slice(o.length)||"/",f=sq({path:c.relativePath,caseSensitive:c.caseSensitive,end:u},d),h=c.route;if(!f)return null;Object.assign(a,f.params),s.push({params:a,pathname:Jl([o,f.pathname]),pathnameBase:hq(Jl([o,f.pathnameBase])),route:h}),f.pathnameBase!=="/"&&(o=Jl([o,f.pathnameBase]))}return s}function sq(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=lq(e.path,e.caseSensitive,e.end),a=t.match(r);if(!a)return null;let o=a[0],s=o.replace(/(.)\/+$/,"$1"),l=a.slice(1);return{params:n.reduce((u,d,f)=>{let{paramName:h,isOptional:p}=d;if(h==="*"){let m=l[f]||"";s=o.slice(0,o.length-m.length).replace(/(.)\/+$/,"$1")}const v=l[f];return p&&!v?u[h]=void 0:u[h]=(v||"").replace(/%2F/g,"/"),u},{}),pathname:o,pathnameBase:s,pattern:e}}function lq(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),Jw(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(s,l,c)=>(n.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),a+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?a+="\\/*$":e!==""&&e!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,t?void 0:"i"),n]}function cq(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Jw(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Zw(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function uq(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:a=""}=typeof e=="string"?nu(e):e;return{pathname:r?r.startsWith("/")?r:dq(r,t):t,search:pq(n),hash:mq(a)}}function dq(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(a=>{a===".."?r.length>1&&r.pop():a!=="."&&r.push(a)}),r.length>1?r.join("/"):"/"}function ax(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function fq(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function ej(e,t){let r=fq(e);return t?r.map((n,a)=>a===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function tj(e,t,r,n){n===void 0&&(n=!1);let a;typeof e=="string"?a=nu(e):(a=Bh({},e),Aa(!a.pathname||!a.pathname.includes("?"),ax("?","pathname","search",a)),Aa(!a.pathname||!a.pathname.includes("#"),ax("#","pathname","hash",a)),Aa(!a.search||!a.search.includes("#"),ax("#","search","hash",a)));let o=e===""||a.pathname==="",s=o?"/":a.pathname,l;if(s==null)l=r;else{let f=t.length-1;if(!n&&s.startsWith("..")){let h=s.split("/");for(;h[0]==="..";)h.shift(),f-=1;a.pathname=h.join("/")}l=f>=0?t[f]:"/"}let c=uq(a,l),u=s&&s!=="/"&&s.endsWith("/"),d=(o||s===".")&&r.endsWith("/");return!c.pathname.endsWith("/")&&(u||d)&&(c.pathname+="/"),c}const Jl=e=>e.join("/").replace(/\/\/+/g,"/"),hq=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),pq=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,mq=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function gq(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const LI=["post","put","patch","delete"];new Set(LI);const vq=["get",...LI];new Set(vq);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Uh(){return Uh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Uh.apply(this,arguments)}const rj=x.createContext(null),yq=x.createContext(null),ic=x.createContext(null),Nv=x.createContext(null),Ns=x.createContext({outlet:null,matches:[],isDataRoute:!1}),RI=x.createContext(null);function xq(e,t){let{relative:r}=t===void 0?{}:t;Nd()||Aa(!1);let{basename:n,navigator:a}=x.useContext(ic),{hash:o,pathname:s,search:l}=FI(e,{relative:r}),c=s;return n!=="/"&&(c=s==="/"?n:Jl([n,s])),a.createHref({pathname:c,search:l,hash:o})}function Nd(){return x.useContext(Nv)!=null}function Ds(){return Nd()||Aa(!1),x.useContext(Nv).location}function qI(e){x.useContext(ic).static||x.useLayoutEffect(e)}function Tn(){let{isDataRoute:e}=x.useContext(Ns);return e?Dq():bq()}function bq(){Nd()||Aa(!1);let e=x.useContext(rj),{basename:t,future:r,navigator:n}=x.useContext(ic),{matches:a}=x.useContext(Ns),{pathname:o}=Ds(),s=JSON.stringify(ej(a,r.v7_relativeSplatPath)),l=x.useRef(!1);return qI(()=>{l.current=!0}),x.useCallback(function(u,d){if(d===void 0&&(d={}),!l.current)return;if(typeof u=="number"){n.go(u);return}let f=tj(u,JSON.parse(s),o,d.relative==="path");e==null&&t!=="/"&&(f.pathname=f.pathname==="/"?t:Jl([t,f.pathname])),(d.replace?n.replace:n.push)(f,d.state,d)},[t,n,s,o,e])}const _q=x.createContext(null);function wq(e){let t=x.useContext(Ns).outlet;return t&&x.createElement(_q.Provider,{value:e},t)}function Ms(){let{matches:e}=x.useContext(Ns),t=e[e.length-1];return t?t.params:{}}function FI(e,t){let{relative:r}=t===void 0?{}:t,{future:n}=x.useContext(ic),{matches:a}=x.useContext(Ns),{pathname:o}=Ds(),s=JSON.stringify(ej(a,n.v7_relativeSplatPath));return x.useMemo(()=>tj(e,JSON.parse(s),o,r==="path"),[e,s,o,r])}function jq(e,t){return Sq(e,t)}function Sq(e,t,r,n){Nd()||Aa(!1);let{navigator:a}=x.useContext(ic),{matches:o}=x.useContext(Ns),s=o[o.length-1],l=s?s.params:{};s&&s.pathname;let c=s?s.pathnameBase:"/";s&&s.route;let u=Ds(),d;if(t){var f;let y=typeof t=="string"?nu(t):t;c==="/"||(f=y.pathname)!=null&&f.startsWith(c)||Aa(!1),d=y}else d=u;let h=d.pathname||"/",p=h;if(c!=="/"){let y=c.replace(/^\//,"").split("/");p="/"+h.replace(/^\//,"").split("/").slice(y.length).join("/")}let v=K8(e,{pathname:p}),m=kq(v&&v.map(y=>Object.assign({},y,{params:Object.assign({},l,y.params),pathname:Jl([c,a.encodeLocation?a.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?c:Jl([c,a.encodeLocation?a.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),o,r,n);return t&&m?x.createElement(Nv.Provider,{value:{location:Uh({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:Yl.Pop}},m):m}function Cq(){let e=Nq(),t=gq(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,a={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return x.createElement(x.Fragment,null,x.createElement("h2",null,"Unexpected Application Error!"),x.createElement("h3",{style:{fontStyle:"italic"}},t),r?x.createElement("pre",{style:a},r):null,null)}const Aq=x.createElement(Cq,null);class Pq extends x.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?x.createElement(Ns.Provider,{value:this.props.routeContext},x.createElement(RI.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Oq(e){let{routeContext:t,match:r,children:n}=e,a=x.useContext(rj);return a&&a.static&&a.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=r.route.id),x.createElement(Ns.Provider,{value:t},n)}function kq(e,t,r,n){var a;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var o;if(!r)return null;if(r.errors)e=r.matches;else if((o=n)!=null&&o.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let s=e,l=(a=r)==null?void 0:a.errors;if(l!=null){let d=s.findIndex(f=>f.route.id&&l?.[f.route.id]!==void 0);d>=0||Aa(!1),s=s.slice(0,Math.min(s.length,d+1))}let c=!1,u=-1;if(r&&n&&n.v7_partialHydration)for(let d=0;d<s.length;d++){let f=s[d];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(u=d),f.route.id){let{loaderData:h,errors:p}=r,v=f.route.loader&&h[f.route.id]===void 0&&(!p||p[f.route.id]===void 0);if(f.route.lazy||v){c=!0,u>=0?s=s.slice(0,u+1):s=[s[0]];break}}}return s.reduceRight((d,f,h)=>{let p,v=!1,m=null,y=null;r&&(p=l&&f.route.id?l[f.route.id]:void 0,m=f.route.errorElement||Aq,c&&(u<0&&h===0?(Mq("route-fallback"),v=!0,y=null):u===h&&(v=!0,y=f.route.hydrateFallbackElement||null)));let b=t.concat(s.slice(0,h+1)),_=()=>{let w;return p?w=m:v?w=y:f.route.Component?w=x.createElement(f.route.Component,null):f.route.element?w=f.route.element:w=d,x.createElement(Oq,{match:f,routeContext:{outlet:d,matches:b,isDataRoute:r!=null},children:w})};return r&&(f.route.ErrorBoundary||f.route.errorElement||h===0)?x.createElement(Pq,{location:r.location,revalidation:r.revalidation,component:m,error:p,children:_(),routeContext:{outlet:null,matches:b,isDataRoute:!0}}):_()},null)}var $I=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}($I||{}),BI=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(BI||{});function Tq(e){let t=x.useContext(rj);return t||Aa(!1),t}function Eq(e){let t=x.useContext(yq);return t||Aa(!1),t}function Iq(e){let t=x.useContext(Ns);return t||Aa(!1),t}function UI(e){let t=Iq(),r=t.matches[t.matches.length-1];return r.route.id||Aa(!1),r.route.id}function Nq(){var e;let t=x.useContext(RI),r=Eq(),n=UI();return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function Dq(){let{router:e}=Tq($I.UseNavigateStable),t=UI(BI.UseNavigateStable),r=x.useRef(!1);return qI(()=>{r.current=!0}),x.useCallback(function(a,o){o===void 0&&(o={}),r.current&&(typeof a=="number"?e.navigate(a):e.navigate(a,Uh({fromRouteId:t},o)))},[e,t])}const h5={};function Mq(e,t,r){h5[e]||(h5[e]=!0)}function Lq(e,t){e?.v7_startTransition,e?.v7_relativeSplatPath}function Ou(e){let{to:t,replace:r,state:n,relative:a}=e;Nd()||Aa(!1);let{future:o,static:s}=x.useContext(ic),{matches:l}=x.useContext(Ns),{pathname:c}=Ds(),u=Tn(),d=tj(t,ej(l,o.v7_relativeSplatPath),c,a==="path"),f=JSON.stringify(d);return x.useEffect(()=>u(JSON.parse(f),{replace:r,state:n,relative:a}),[u,f,a,r,n]),null}function Rq(e){return wq(e.context)}function fr(e){Aa(!1)}function qq(e){let{basename:t="/",children:r=null,location:n,navigationType:a=Yl.Pop,navigator:o,static:s=!1,future:l}=e;Nd()&&Aa(!1);let c=t.replace(/^\/*/,"/"),u=x.useMemo(()=>({basename:c,navigator:o,static:s,future:Uh({v7_relativeSplatPath:!1},l)}),[c,l,o,s]);typeof n=="string"&&(n=nu(n));let{pathname:d="/",search:f="",hash:h="",state:p=null,key:v="default"}=n,m=x.useMemo(()=>{let y=Zw(d,c);return y==null?null:{location:{pathname:y,search:f,hash:h,state:p,key:v},navigationType:a}},[c,d,f,h,p,v,a]);return m==null?null:x.createElement(ic.Provider,{value:u},x.createElement(Nv.Provider,{children:r,value:m}))}function Fq(e){let{children:t,location:r}=e;return jq(B2(t),r)}new Promise(()=>{});function B2(e,t){t===void 0&&(t=[]);let r=[];return x.Children.forEach(e,(n,a)=>{if(!x.isValidElement(n))return;let o=[...t,a];if(n.type===x.Fragment){r.push.apply(r,B2(n.props.children,o));return}n.type!==fr&&Aa(!1),!n.props.index||!n.props.children||Aa(!1);let s={id:n.props.id||o.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(s.children=B2(n.props.children,o)),r.push(s)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function U2(){return U2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},U2.apply(this,arguments)}function $q(e,t){if(e==null)return{};var r={},n=Object.keys(e),a,o;for(o=0;o<n.length;o++)a=n[o],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}function Bq(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Uq(e,t){return e.button===0&&(!t||t==="_self")&&!Bq(e)}const zq=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Wq="6";try{window.__reactRouterVersion=Wq}catch{}const Hq="startTransition",p5=a8[Hq];function Vq(e){let{basename:t,children:r,future:n,window:a}=e,o=x.useRef();o.current==null&&(o.current=V8({window:a,v5Compat:!0}));let s=o.current,[l,c]=x.useState({action:s.action,location:s.location}),{v7_startTransition:u}=n||{},d=x.useCallback(f=>{u&&p5?p5(()=>c(f)):c(f)},[c,u]);return x.useLayoutEffect(()=>s.listen(d),[s,d]),x.useEffect(()=>Lq(n),[n]),x.createElement(qq,{basename:t,children:r,location:l.location,navigationType:l.action,navigator:s,future:n})}const Gq=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Yq=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,zI=x.forwardRef(function(t,r){let{onClick:n,relative:a,reloadDocument:o,replace:s,state:l,target:c,to:u,preventScrollReset:d,viewTransition:f}=t,h=$q(t,zq),{basename:p}=x.useContext(ic),v,m=!1;if(typeof u=="string"&&Yq.test(u)&&(v=u,Gq))try{let w=new URL(window.location.href),A=u.startsWith("//")?new URL(w.protocol+u):new URL(u),P=Zw(A.pathname,p);A.origin===w.origin&&P!=null?u=P+A.search+A.hash:m=!0}catch{}let y=xq(u,{relative:a}),b=Kq(u,{replace:s,state:l,target:c,preventScrollReset:d,relative:a,viewTransition:f});function _(w){n&&n(w),w.defaultPrevented||b(w)}return x.createElement("a",U2({},h,{href:v||y,onClick:m||o?n:_,ref:r,target:c}))});var m5;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(m5||(m5={}));var g5;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(g5||(g5={}));function Kq(e,t){let{target:r,replace:n,state:a,preventScrollReset:o,relative:s,viewTransition:l}=t===void 0?{}:t,c=Tn(),u=Ds(),d=FI(e,{relative:s});return x.useCallback(f=>{if(Uq(f,r)){f.preventDefault();let h=n!==void 0?n:fg(u)===fg(d);c(e,{replace:h,state:a,preventScrollReset:o,relative:s,viewTransition:l})}},[u,c,d,n,a,r,e,o,s,l])}function WI(e,t){return function(){return e.apply(t,arguments)}}const{toString:Qq}=Object.prototype,{getPrototypeOf:nj}=Object,{iterator:Dv,toStringTag:HI}=Symbol,Mv=(e=>t=>{const r=Qq.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),ss=e=>(e=e.toLowerCase(),t=>Mv(t)===e),Lv=e=>t=>typeof t===e,{isArray:Dd}=Array,zh=Lv("undefined");function Xq(e){return e!==null&&!zh(e)&&e.constructor!==null&&!zh(e.constructor)&&Xi(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const VI=ss("ArrayBuffer");function Jq(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&VI(e.buffer),t}const Zq=Lv("string"),Xi=Lv("function"),GI=Lv("number"),Rv=e=>e!==null&&typeof e=="object",eF=e=>e===!0||e===!1,Bm=e=>{if(Mv(e)!=="object")return!1;const t=nj(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(HI in e)&&!(Dv in e)},tF=ss("Date"),rF=ss("File"),nF=ss("Blob"),aF=ss("FileList"),iF=e=>Rv(e)&&Xi(e.pipe),oF=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Xi(e.append)&&((t=Mv(e))==="formdata"||t==="object"&&Xi(e.toString)&&e.toString()==="[object FormData]"))},sF=ss("URLSearchParams"),[lF,cF,uF,dF]=["ReadableStream","Request","Response","Headers"].map(ss),fF=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Ip(e,t,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let n,a;if(typeof e!="object"&&(e=[e]),Dd(e))for(n=0,a=e.length;n<a;n++)t.call(null,e[n],n,e);else{const o=r?Object.getOwnPropertyNames(e):Object.keys(e),s=o.length;let l;for(n=0;n<s;n++)l=o[n],t.call(null,e[l],l,e)}}function YI(e,t){t=t.toLowerCase();const r=Object.keys(e);let n=r.length,a;for(;n-- >0;)if(a=r[n],t===a.toLowerCase())return a;return null}const Dc=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,KI=e=>!zh(e)&&e!==Dc;function z2(){const{caseless:e}=KI(this)&&this||{},t={},r=(n,a)=>{const o=e&&YI(t,a)||a;Bm(t[o])&&Bm(n)?t[o]=z2(t[o],n):Bm(n)?t[o]=z2({},n):Dd(n)?t[o]=n.slice():t[o]=n};for(let n=0,a=arguments.length;n<a;n++)arguments[n]&&Ip(arguments[n],r);return t}const hF=(e,t,r,{allOwnKeys:n}={})=>(Ip(t,(a,o)=>{r&&Xi(a)?e[o]=WI(a,r):e[o]=a},{allOwnKeys:n}),e),pF=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),mF=(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},gF=(e,t,r,n)=>{let a,o,s;const l={};if(t=t||{},e==null)return t;do{for(a=Object.getOwnPropertyNames(e),o=a.length;o-- >0;)s=a[o],(!n||n(s,e,t))&&!l[s]&&(t[s]=e[s],l[s]=!0);e=r!==!1&&nj(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},vF=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return n!==-1&&n===r},yF=e=>{if(!e)return null;if(Dd(e))return e;let t=e.length;if(!GI(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},xF=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&nj(Uint8Array)),bF=(e,t)=>{const n=(e&&e[Dv]).call(e);let a;for(;(a=n.next())&&!a.done;){const o=a.value;t.call(e,o[0],o[1])}},_F=(e,t)=>{let r;const n=[];for(;(r=e.exec(t))!==null;)n.push(r);return n},wF=ss("HTMLFormElement"),jF=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,a){return n.toUpperCase()+a}),v5=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),SF=ss("RegExp"),QI=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};Ip(r,(a,o)=>{let s;(s=t(a,o,e))!==!1&&(n[o]=s||a)}),Object.defineProperties(e,n)},CF=e=>{QI(e,(t,r)=>{if(Xi(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=e[r];if(Xi(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},AF=(e,t)=>{const r={},n=a=>{a.forEach(o=>{r[o]=!0})};return Dd(e)?n(e):n(String(e).split(t)),r},PF=()=>{},OF=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function kF(e){return!!(e&&Xi(e.append)&&e[HI]==="FormData"&&e[Dv])}const TF=e=>{const t=new Array(10),r=(n,a)=>{if(Rv(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[a]=n;const o=Dd(n)?[]:{};return Ip(n,(s,l)=>{const c=r(s,a+1);!zh(c)&&(o[l]=c)}),t[a]=void 0,o}}return n};return r(e,0)},EF=ss("AsyncFunction"),IF=e=>e&&(Rv(e)||Xi(e))&&Xi(e.then)&&Xi(e.catch),XI=((e,t)=>e?setImmediate:t?((r,n)=>(Dc.addEventListener("message",({source:a,data:o})=>{a===Dc&&o===r&&n.length&&n.shift()()},!1),a=>{n.push(a),Dc.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",Xi(Dc.postMessage)),NF=typeof queueMicrotask<"u"?queueMicrotask.bind(Dc):typeof process<"u"&&process.nextTick||XI,DF=e=>e!=null&&Xi(e[Dv]),ct={isArray:Dd,isArrayBuffer:VI,isBuffer:Xq,isFormData:oF,isArrayBufferView:Jq,isString:Zq,isNumber:GI,isBoolean:eF,isObject:Rv,isPlainObject:Bm,isReadableStream:lF,isRequest:cF,isResponse:uF,isHeaders:dF,isUndefined:zh,isDate:tF,isFile:rF,isBlob:nF,isRegExp:SF,isFunction:Xi,isStream:iF,isURLSearchParams:sF,isTypedArray:xF,isFileList:aF,forEach:Ip,merge:z2,extend:hF,trim:fF,stripBOM:pF,inherits:mF,toFlatObject:gF,kindOf:Mv,kindOfTest:ss,endsWith:vF,toArray:yF,forEachEntry:bF,matchAll:_F,isHTMLForm:wF,hasOwnProperty:v5,hasOwnProp:v5,reduceDescriptors:QI,freezeMethods:CF,toObjectSet:AF,toCamelCase:jF,noop:PF,toFiniteNumber:OF,findKey:YI,global:Dc,isContextDefined:KI,isSpecCompliantForm:kF,toJSONObject:TF,isAsyncFn:EF,isThenable:IF,setImmediate:XI,asap:NF,isIterable:DF};function Ur(e,t,r,n,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),a&&(this.response=a,this.status=a.status?a.status:null)}ct.inherits(Ur,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ct.toJSONObject(this.config),code:this.code,status:this.status}}});const JI=Ur.prototype,ZI={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{ZI[e]={value:e}});Object.defineProperties(Ur,ZI);Object.defineProperty(JI,"isAxiosError",{value:!0});Ur.from=(e,t,r,n,a,o)=>{const s=Object.create(JI);return ct.toFlatObject(e,s,function(c){return c!==Error.prototype},l=>l!=="isAxiosError"),Ur.call(s,e.message,t,r,n,a),s.cause=e,s.name=e.name,o&&Object.assign(s,o),s};const MF=null;function W2(e){return ct.isPlainObject(e)||ct.isArray(e)}function eN(e){return ct.endsWith(e,"[]")?e.slice(0,-2):e}function y5(e,t,r){return e?e.concat(t).map(function(a,o){return a=eN(a),!r&&o?"["+a+"]":a}).join(r?".":""):t}function LF(e){return ct.isArray(e)&&!e.some(W2)}const RF=ct.toFlatObject(ct,{},null,function(t){return/^is[A-Z]/.test(t)});function qv(e,t,r){if(!ct.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=ct.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,y){return!ct.isUndefined(y[m])});const n=r.metaTokens,a=r.visitor||d,o=r.dots,s=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&ct.isSpecCompliantForm(t);if(!ct.isFunction(a))throw new TypeError("visitor must be a function");function u(v){if(v===null)return"";if(ct.isDate(v))return v.toISOString();if(ct.isBoolean(v))return v.toString();if(!c&&ct.isBlob(v))throw new Ur("Blob is not supported. Use a Buffer instead.");return ct.isArrayBuffer(v)||ct.isTypedArray(v)?c&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function d(v,m,y){let b=v;if(v&&!y&&typeof v=="object"){if(ct.endsWith(m,"{}"))m=n?m:m.slice(0,-2),v=JSON.stringify(v);else if(ct.isArray(v)&&LF(v)||(ct.isFileList(v)||ct.endsWith(m,"[]"))&&(b=ct.toArray(v)))return m=eN(m),b.forEach(function(w,A){!(ct.isUndefined(w)||w===null)&&t.append(s===!0?y5([m],A,o):s===null?m:m+"[]",u(w))}),!1}return W2(v)?!0:(t.append(y5(y,m,o),u(v)),!1)}const f=[],h=Object.assign(RF,{defaultVisitor:d,convertValue:u,isVisitable:W2});function p(v,m){if(!ct.isUndefined(v)){if(f.indexOf(v)!==-1)throw Error("Circular reference detected in "+m.join("."));f.push(v),ct.forEach(v,function(b,_){(!(ct.isUndefined(b)||b===null)&&a.call(t,b,ct.isString(_)?_.trim():_,m,h))===!0&&p(b,m?m.concat(_):[_])}),f.pop()}}if(!ct.isObject(e))throw new TypeError("data must be an object");return p(e),t}function x5(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function aj(e,t){this._pairs=[],e&&qv(e,this,t)}const tN=aj.prototype;tN.append=function(t,r){this._pairs.push([t,r])};tN.toString=function(t){const r=t?function(n){return t.call(this,n,x5)}:x5;return this._pairs.map(function(a){return r(a[0])+"="+r(a[1])},"").join("&")};function qF(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function rN(e,t,r){if(!t)return e;const n=r&&r.encode||qF;ct.isFunction(r)&&(r={serialize:r});const a=r&&r.serialize;let o;if(a?o=a(t,r):o=ct.isURLSearchParams(t)?t.toString():new aj(t,r).toString(n),o){const s=e.indexOf("#");s!==-1&&(e=e.slice(0,s)),e+=(e.indexOf("?")===-1?"?":"&")+o}return e}class b5{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){ct.forEach(this.handlers,function(n){n!==null&&t(n)})}}const nN={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},FF=typeof URLSearchParams<"u"?URLSearchParams:aj,$F=typeof FormData<"u"?FormData:null,BF=typeof Blob<"u"?Blob:null,UF={isBrowser:!0,classes:{URLSearchParams:FF,FormData:$F,Blob:BF},protocols:["http","https","file","blob","url","data"]},ij=typeof window<"u"&&typeof document<"u",H2=typeof navigator=="object"&&navigator||void 0,zF=ij&&(!H2||["ReactNative","NativeScript","NS"].indexOf(H2.product)<0),WF=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",HF=ij&&window.location.href||"http://localhost",VF=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ij,hasStandardBrowserEnv:zF,hasStandardBrowserWebWorkerEnv:WF,navigator:H2,origin:HF},Symbol.toStringTag,{value:"Module"})),_i={...VF,...UF};function GF(e,t){return qv(e,new _i.classes.URLSearchParams,Object.assign({visitor:function(r,n,a,o){return _i.isNode&&ct.isBuffer(r)?(this.append(n,r.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},t))}function YF(e){return ct.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function KF(e){const t={},r=Object.keys(e);let n;const a=r.length;let o;for(n=0;n<a;n++)o=r[n],t[o]=e[o];return t}function aN(e){function t(r,n,a,o){let s=r[o++];if(s==="__proto__")return!0;const l=Number.isFinite(+s),c=o>=r.length;return s=!s&&ct.isArray(a)?a.length:s,c?(ct.hasOwnProp(a,s)?a[s]=[a[s],n]:a[s]=n,!l):((!a[s]||!ct.isObject(a[s]))&&(a[s]=[]),t(r,n,a[s],o)&&ct.isArray(a[s])&&(a[s]=KF(a[s])),!l)}if(ct.isFormData(e)&&ct.isFunction(e.entries)){const r={};return ct.forEachEntry(e,(n,a)=>{t(YF(n),a,r,0)}),r}return null}function QF(e,t,r){if(ct.isString(e))try{return(t||JSON.parse)(e),ct.trim(e)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(e)}const Np={transitional:nN,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",a=n.indexOf("application/json")>-1,o=ct.isObject(t);if(o&&ct.isHTMLForm(t)&&(t=new FormData(t)),ct.isFormData(t))return a?JSON.stringify(aN(t)):t;if(ct.isArrayBuffer(t)||ct.isBuffer(t)||ct.isStream(t)||ct.isFile(t)||ct.isBlob(t)||ct.isReadableStream(t))return t;if(ct.isArrayBufferView(t))return t.buffer;if(ct.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let l;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return GF(t,this.formSerializer).toString();if((l=ct.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return qv(l?{"files[]":t}:t,c&&new c,this.formSerializer)}}return o||a?(r.setContentType("application/json",!1),QF(t)):t}],transformResponse:[function(t){const r=this.transitional||Np.transitional,n=r&&r.forcedJSONParsing,a=this.responseType==="json";if(ct.isResponse(t)||ct.isReadableStream(t))return t;if(t&&ct.isString(t)&&(n&&!this.responseType||a)){const s=!(r&&r.silentJSONParsing)&&a;try{return JSON.parse(t)}catch(l){if(s)throw l.name==="SyntaxError"?Ur.from(l,Ur.ERR_BAD_RESPONSE,this,null,this.response):l}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:_i.classes.FormData,Blob:_i.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ct.forEach(["delete","get","head","post","put","patch"],e=>{Np.headers[e]={}});const XF=ct.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),JF=e=>{const t={};let r,n,a;return e&&e.split(`
`).forEach(function(s){a=s.indexOf(":"),r=s.substring(0,a).trim().toLowerCase(),n=s.substring(a+1).trim(),!(!r||t[r]&&XF[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},_5=Symbol("internals");function tf(e){return e&&String(e).trim().toLowerCase()}function Um(e){return e===!1||e==null?e:ct.isArray(e)?e.map(Um):String(e)}function ZF(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}const e$=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function ix(e,t,r,n,a){if(ct.isFunction(n))return n.call(this,t,r);if(a&&(t=r),!!ct.isString(t)){if(ct.isString(n))return t.indexOf(n)!==-1;if(ct.isRegExp(n))return n.test(t)}}function t$(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function r$(e,t){const r=ct.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(a,o,s){return this[n].call(this,t,a,o,s)},configurable:!0})})}let Ji=class{constructor(t){t&&this.set(t)}set(t,r,n){const a=this;function o(l,c,u){const d=tf(c);if(!d)throw new Error("header name must be a non-empty string");const f=ct.findKey(a,d);(!f||a[f]===void 0||u===!0||u===void 0&&a[f]!==!1)&&(a[f||c]=Um(l))}const s=(l,c)=>ct.forEach(l,(u,d)=>o(u,d,c));if(ct.isPlainObject(t)||t instanceof this.constructor)s(t,r);else if(ct.isString(t)&&(t=t.trim())&&!e$(t))s(JF(t),r);else if(ct.isObject(t)&&ct.isIterable(t)){let l={},c,u;for(const d of t){if(!ct.isArray(d))throw TypeError("Object iterator must return a key-value pair");l[u=d[0]]=(c=l[u])?ct.isArray(c)?[...c,d[1]]:[c,d[1]]:d[1]}s(l,r)}else t!=null&&o(r,t,n);return this}get(t,r){if(t=tf(t),t){const n=ct.findKey(this,t);if(n){const a=this[n];if(!r)return a;if(r===!0)return ZF(a);if(ct.isFunction(r))return r.call(this,a,n);if(ct.isRegExp(r))return r.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=tf(t),t){const n=ct.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||ix(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let a=!1;function o(s){if(s=tf(s),s){const l=ct.findKey(n,s);l&&(!r||ix(n,n[l],l,r))&&(delete n[l],a=!0)}}return ct.isArray(t)?t.forEach(o):o(t),a}clear(t){const r=Object.keys(this);let n=r.length,a=!1;for(;n--;){const o=r[n];(!t||ix(this,this[o],o,t,!0))&&(delete this[o],a=!0)}return a}normalize(t){const r=this,n={};return ct.forEach(this,(a,o)=>{const s=ct.findKey(n,o);if(s){r[s]=Um(a),delete r[o];return}const l=t?t$(o):String(o).trim();l!==o&&delete r[o],r[l]=Um(a),n[l]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return ct.forEach(this,(n,a)=>{n!=null&&n!==!1&&(r[a]=t&&ct.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(a=>n.set(a)),n}static accessor(t){const n=(this[_5]=this[_5]={accessors:{}}).accessors,a=this.prototype;function o(s){const l=tf(s);n[l]||(r$(a,s),n[l]=!0)}return ct.isArray(t)?t.forEach(o):o(t),this}};Ji.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ct.reduceDescriptors(Ji.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(n){this[r]=n}}});ct.freezeMethods(Ji);function ox(e,t){const r=this||Np,n=t||r,a=Ji.from(n.headers);let o=n.data;return ct.forEach(e,function(l){o=l.call(r,o,a.normalize(),t?t.status:void 0)}),a.normalize(),o}function iN(e){return!!(e&&e.__CANCEL__)}function Md(e,t,r){Ur.call(this,e??"canceled",Ur.ERR_CANCELED,t,r),this.name="CanceledError"}ct.inherits(Md,Ur,{__CANCEL__:!0});function oN(e,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?e(r):t(new Ur("Request failed with status code "+r.status,[Ur.ERR_BAD_REQUEST,Ur.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function n$(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function a$(e,t){e=e||10;const r=new Array(e),n=new Array(e);let a=0,o=0,s;return t=t!==void 0?t:1e3,function(c){const u=Date.now(),d=n[o];s||(s=u),r[a]=c,n[a]=u;let f=o,h=0;for(;f!==a;)h+=r[f++],f=f%e;if(a=(a+1)%e,a===o&&(o=(o+1)%e),u-s<t)return;const p=d&&u-d;return p?Math.round(h*1e3/p):void 0}}function i$(e,t){let r=0,n=1e3/t,a,o;const s=(u,d=Date.now())=>{r=d,a=null,o&&(clearTimeout(o),o=null),e.apply(null,u)};return[(...u)=>{const d=Date.now(),f=d-r;f>=n?s(u,d):(a=u,o||(o=setTimeout(()=>{o=null,s(a)},n-f)))},()=>a&&s(a)]}const hg=(e,t,r=3)=>{let n=0;const a=a$(50,250);return i$(o=>{const s=o.loaded,l=o.lengthComputable?o.total:void 0,c=s-n,u=a(c),d=s<=l;n=s;const f={loaded:s,total:l,progress:l?s/l:void 0,bytes:c,rate:u||void 0,estimated:u&&l&&d?(l-s)/u:void 0,event:o,lengthComputable:l!=null,[t?"download":"upload"]:!0};e(f)},r)},w5=(e,t)=>{const r=e!=null;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},j5=e=>(...t)=>ct.asap(()=>e(...t)),o$=_i.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,_i.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(_i.origin),_i.navigator&&/(msie|trident)/i.test(_i.navigator.userAgent)):()=>!0,s$=_i.hasStandardBrowserEnv?{write(e,t,r,n,a,o){const s=[e+"="+encodeURIComponent(t)];ct.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),ct.isString(n)&&s.push("path="+n),ct.isString(a)&&s.push("domain="+a),o===!0&&s.push("secure"),document.cookie=s.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function l$(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function c$(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function sN(e,t,r){let n=!l$(t);return e&&(n||r==!1)?c$(e,t):t}const S5=e=>e instanceof Ji?{...e}:e;function Vc(e,t){t=t||{};const r={};function n(u,d,f,h){return ct.isPlainObject(u)&&ct.isPlainObject(d)?ct.merge.call({caseless:h},u,d):ct.isPlainObject(d)?ct.merge({},d):ct.isArray(d)?d.slice():d}function a(u,d,f,h){if(ct.isUndefined(d)){if(!ct.isUndefined(u))return n(void 0,u,f,h)}else return n(u,d,f,h)}function o(u,d){if(!ct.isUndefined(d))return n(void 0,d)}function s(u,d){if(ct.isUndefined(d)){if(!ct.isUndefined(u))return n(void 0,u)}else return n(void 0,d)}function l(u,d,f){if(f in t)return n(u,d);if(f in e)return n(void 0,u)}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:l,headers:(u,d,f)=>a(S5(u),S5(d),f,!0)};return ct.forEach(Object.keys(Object.assign({},e,t)),function(d){const f=c[d]||a,h=f(e[d],t[d],d);ct.isUndefined(h)&&f!==l||(r[d]=h)}),r}const lN=e=>{const t=Vc({},e);let{data:r,withXSRFToken:n,xsrfHeaderName:a,xsrfCookieName:o,headers:s,auth:l}=t;t.headers=s=Ji.from(s),t.url=rN(sN(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&s.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let c;if(ct.isFormData(r)){if(_i.hasStandardBrowserEnv||_i.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if((c=s.getContentType())!==!1){const[u,...d]=c?c.split(";").map(f=>f.trim()).filter(Boolean):[];s.setContentType([u||"multipart/form-data",...d].join("; "))}}if(_i.hasStandardBrowserEnv&&(n&&ct.isFunction(n)&&(n=n(t)),n||n!==!1&&o$(t.url))){const u=a&&o&&s$.read(o);u&&s.set(a,u)}return t},u$=typeof XMLHttpRequest<"u",d$=u$&&function(e){return new Promise(function(r,n){const a=lN(e);let o=a.data;const s=Ji.from(a.headers).normalize();let{responseType:l,onUploadProgress:c,onDownloadProgress:u}=a,d,f,h,p,v;function m(){p&&p(),v&&v(),a.cancelToken&&a.cancelToken.unsubscribe(d),a.signal&&a.signal.removeEventListener("abort",d)}let y=new XMLHttpRequest;y.open(a.method.toUpperCase(),a.url,!0),y.timeout=a.timeout;function b(){if(!y)return;const w=Ji.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),P={data:!l||l==="text"||l==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:w,config:e,request:y};oN(function(E){r(E),m()},function(E){n(E),m()},P),y=null}"onloadend"in y?y.onloadend=b:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(b)},y.onabort=function(){y&&(n(new Ur("Request aborted",Ur.ECONNABORTED,e,y)),y=null)},y.onerror=function(){n(new Ur("Network Error",Ur.ERR_NETWORK,e,y)),y=null},y.ontimeout=function(){let A=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const P=a.transitional||nN;a.timeoutErrorMessage&&(A=a.timeoutErrorMessage),n(new Ur(A,P.clarifyTimeoutError?Ur.ETIMEDOUT:Ur.ECONNABORTED,e,y)),y=null},o===void 0&&s.setContentType(null),"setRequestHeader"in y&&ct.forEach(s.toJSON(),function(A,P){y.setRequestHeader(P,A)}),ct.isUndefined(a.withCredentials)||(y.withCredentials=!!a.withCredentials),l&&l!=="json"&&(y.responseType=a.responseType),u&&([h,v]=hg(u,!0),y.addEventListener("progress",h)),c&&y.upload&&([f,p]=hg(c),y.upload.addEventListener("progress",f),y.upload.addEventListener("loadend",p)),(a.cancelToken||a.signal)&&(d=w=>{y&&(n(!w||w.type?new Md(null,e,y):w),y.abort(),y=null)},a.cancelToken&&a.cancelToken.subscribe(d),a.signal&&(a.signal.aborted?d():a.signal.addEventListener("abort",d)));const _=n$(a.url);if(_&&_i.protocols.indexOf(_)===-1){n(new Ur("Unsupported protocol "+_+":",Ur.ERR_BAD_REQUEST,e));return}y.send(o||null)})},f$=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let n=new AbortController,a;const o=function(u){if(!a){a=!0,l();const d=u instanceof Error?u:this.reason;n.abort(d instanceof Ur?d:new Md(d instanceof Error?d.message:d))}};let s=t&&setTimeout(()=>{s=null,o(new Ur(`timeout ${t} of ms exceeded`,Ur.ETIMEDOUT))},t);const l=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(u=>{u.unsubscribe?u.unsubscribe(o):u.removeEventListener("abort",o)}),e=null)};e.forEach(u=>u.addEventListener("abort",o));const{signal:c}=n;return c.unsubscribe=()=>ct.asap(l),c}},h$=function*(e,t){let r=e.byteLength;if(r<t){yield e;return}let n=0,a;for(;n<r;)a=n+t,yield e.slice(n,a),n=a},p$=async function*(e,t){for await(const r of m$(e))yield*h$(r,t)},m$=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},C5=(e,t,r,n)=>{const a=p$(e,t);let o=0,s,l=c=>{s||(s=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:u,value:d}=await a.next();if(u){l(),c.close();return}let f=d.byteLength;if(r){let h=o+=f;r(h)}c.enqueue(new Uint8Array(d))}catch(u){throw l(u),u}},cancel(c){return l(c),a.return()}},{highWaterMark:2})},Fv=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",cN=Fv&&typeof ReadableStream=="function",g$=Fv&&(typeof TextEncoder=="function"?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),uN=(e,...t)=>{try{return!!e(...t)}catch{return!1}},v$=cN&&uN(()=>{let e=!1;const t=new Request(_i.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),A5=64*1024,V2=cN&&uN(()=>ct.isReadableStream(new Response("").body)),pg={stream:V2&&(e=>e.body)};Fv&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!pg[t]&&(pg[t]=ct.isFunction(e[t])?r=>r[t]():(r,n)=>{throw new Ur(`Response type '${t}' is not supported`,Ur.ERR_NOT_SUPPORT,n)})})})(new Response);const y$=async e=>{if(e==null)return 0;if(ct.isBlob(e))return e.size;if(ct.isSpecCompliantForm(e))return(await new Request(_i.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(ct.isArrayBufferView(e)||ct.isArrayBuffer(e))return e.byteLength;if(ct.isURLSearchParams(e)&&(e=e+""),ct.isString(e))return(await g$(e)).byteLength},x$=async(e,t)=>{const r=ct.toFiniteNumber(e.getContentLength());return r??y$(t)},b$=Fv&&(async e=>{let{url:t,method:r,data:n,signal:a,cancelToken:o,timeout:s,onDownloadProgress:l,onUploadProgress:c,responseType:u,headers:d,withCredentials:f="same-origin",fetchOptions:h}=lN(e);u=u?(u+"").toLowerCase():"text";let p=f$([a,o&&o.toAbortSignal()],s),v;const m=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let y;try{if(c&&v$&&r!=="get"&&r!=="head"&&(y=await x$(d,n))!==0){let P=new Request(t,{method:"POST",body:n,duplex:"half"}),T;if(ct.isFormData(n)&&(T=P.headers.get("content-type"))&&d.setContentType(T),P.body){const[E,S]=w5(y,hg(j5(c)));n=C5(P.body,A5,E,S)}}ct.isString(f)||(f=f?"include":"omit");const b="credentials"in Request.prototype;v=new Request(t,{...h,signal:p,method:r.toUpperCase(),headers:d.normalize().toJSON(),body:n,duplex:"half",credentials:b?f:void 0});let _=await fetch(v,h);const w=V2&&(u==="stream"||u==="response");if(V2&&(l||w&&m)){const P={};["status","statusText","headers"].forEach(I=>{P[I]=_[I]});const T=ct.toFiniteNumber(_.headers.get("content-length")),[E,S]=l&&w5(T,hg(j5(l),!0))||[];_=new Response(C5(_.body,A5,E,()=>{S&&S(),m&&m()}),P)}u=u||"text";let A=await pg[ct.findKey(pg,u)||"text"](_,e);return!w&&m&&m(),await new Promise((P,T)=>{oN(P,T,{data:A,headers:Ji.from(_.headers),status:_.status,statusText:_.statusText,config:e,request:v})})}catch(b){throw m&&m(),b&&b.name==="TypeError"&&/Load failed|fetch/i.test(b.message)?Object.assign(new Ur("Network Error",Ur.ERR_NETWORK,e,v),{cause:b.cause||b}):Ur.from(b,b&&b.code,e,v)}}),G2={http:MF,xhr:d$,fetch:b$};ct.forEach(G2,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const P5=e=>`- ${e}`,_$=e=>ct.isFunction(e)||e===null||e===!1,dN={getAdapter:e=>{e=ct.isArray(e)?e:[e];const{length:t}=e;let r,n;const a={};for(let o=0;o<t;o++){r=e[o];let s;if(n=r,!_$(r)&&(n=G2[(s=String(r)).toLowerCase()],n===void 0))throw new Ur(`Unknown adapter '${s}'`);if(n)break;a[s||"#"+o]=n}if(!n){const o=Object.entries(a).map(([l,c])=>`adapter ${l} `+(c===!1?"is not supported by the environment":"is not available in the build"));let s=t?o.length>1?`since :
`+o.map(P5).join(`
`):" "+P5(o[0]):"as no adapter specified";throw new Ur("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return n},adapters:G2};function sx(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Md(null,e)}function O5(e){return sx(e),e.headers=Ji.from(e.headers),e.data=ox.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),dN.getAdapter(e.adapter||Np.adapter)(e).then(function(n){return sx(e),n.data=ox.call(e,e.transformResponse,n),n.headers=Ji.from(n.headers),n},function(n){return iN(n)||(sx(e),n&&n.response&&(n.response.data=ox.call(e,e.transformResponse,n.response),n.response.headers=Ji.from(n.response.headers))),Promise.reject(n)})}const fN="1.10.0",$v={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{$v[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const k5={};$v.transitional=function(t,r,n){function a(o,s){return"[Axios v"+fN+"] Transitional option '"+o+"'"+s+(n?". "+n:"")}return(o,s,l)=>{if(t===!1)throw new Ur(a(s," has been removed"+(r?" in "+r:"")),Ur.ERR_DEPRECATED);return r&&!k5[s]&&(k5[s]=!0,console.warn(a(s," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(o,s,l):!0}};$v.spelling=function(t){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function w$(e,t,r){if(typeof e!="object")throw new Ur("options must be an object",Ur.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let a=n.length;for(;a-- >0;){const o=n[a],s=t[o];if(s){const l=e[o],c=l===void 0||s(l,o,e);if(c!==!0)throw new Ur("option "+o+" must be "+c,Ur.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new Ur("Unknown option "+o,Ur.ERR_BAD_OPTION)}}const zm={assertOptions:w$,validators:$v},gs=zm.validators;let Fc=class{constructor(t){this.defaults=t||{},this.interceptors={request:new b5,response:new b5}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const o=a.stack?a.stack.replace(/^.+\n/,""):"";try{n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=Vc(this.defaults,r);const{transitional:n,paramsSerializer:a,headers:o}=r;n!==void 0&&zm.assertOptions(n,{silentJSONParsing:gs.transitional(gs.boolean),forcedJSONParsing:gs.transitional(gs.boolean),clarifyTimeoutError:gs.transitional(gs.boolean)},!1),a!=null&&(ct.isFunction(a)?r.paramsSerializer={serialize:a}:zm.assertOptions(a,{encode:gs.function,serialize:gs.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),zm.assertOptions(r,{baseUrl:gs.spelling("baseURL"),withXsrfToken:gs.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let s=o&&ct.merge(o.common,o[r.method]);o&&ct.forEach(["delete","get","head","post","put","patch","common"],v=>{delete o[v]}),r.headers=Ji.concat(s,o);const l=[];let c=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(r)===!1||(c=c&&m.synchronous,l.unshift(m.fulfilled,m.rejected))});const u=[];this.interceptors.response.forEach(function(m){u.push(m.fulfilled,m.rejected)});let d,f=0,h;if(!c){const v=[O5.bind(this),void 0];for(v.unshift.apply(v,l),v.push.apply(v,u),h=v.length,d=Promise.resolve(r);f<h;)d=d.then(v[f++],v[f++]);return d}h=l.length;let p=r;for(f=0;f<h;){const v=l[f++],m=l[f++];try{p=v(p)}catch(y){m.call(this,y);break}}try{d=O5.call(this,p)}catch(v){return Promise.reject(v)}for(f=0,h=u.length;f<h;)d=d.then(u[f++],u[f++]);return d}getUri(t){t=Vc(this.defaults,t);const r=sN(t.baseURL,t.url,t.allowAbsoluteUrls);return rN(r,t.params,t.paramsSerializer)}};ct.forEach(["delete","get","head","options"],function(t){Fc.prototype[t]=function(r,n){return this.request(Vc(n||{},{method:t,url:r,data:(n||{}).data}))}});ct.forEach(["post","put","patch"],function(t){function r(n){return function(o,s,l){return this.request(Vc(l||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:s}))}}Fc.prototype[t]=r(),Fc.prototype[t+"Form"]=r(!0)});let j$=class hN{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(o){r=o});const n=this;this.promise.then(a=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](a);n._listeners=null}),this.promise.then=a=>{let o;const s=new Promise(l=>{n.subscribe(l),o=l}).then(a);return s.cancel=function(){n.unsubscribe(o)},s},t(function(o,s,l){n.reason||(n.reason=new Md(o,s,l),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new hN(function(a){t=a}),cancel:t}}};function S$(e){return function(r){return e.apply(null,r)}}function C$(e){return ct.isObject(e)&&e.isAxiosError===!0}const Y2={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Y2).forEach(([e,t])=>{Y2[t]=e});function pN(e){const t=new Fc(e),r=WI(Fc.prototype.request,t);return ct.extend(r,Fc.prototype,t,{allOwnKeys:!0}),ct.extend(r,t,null,{allOwnKeys:!0}),r.create=function(a){return pN(Vc(e,a))},r}const Pa=pN(Np);Pa.Axios=Fc;Pa.CanceledError=Md;Pa.CancelToken=j$;Pa.isCancel=iN;Pa.VERSION=fN;Pa.toFormData=qv;Pa.AxiosError=Ur;Pa.Cancel=Pa.CanceledError;Pa.all=function(t){return Promise.all(t)};Pa.spread=S$;Pa.isAxiosError=C$;Pa.mergeConfig=Vc;Pa.AxiosHeaders=Ji;Pa.formToJSON=e=>aN(ct.isHTMLForm(e)?new FormData(e):e);Pa.getAdapter=dN.getAdapter;Pa.HttpStatusCode=Y2;Pa.default=Pa;const{Axios:ppe,AxiosError:di,CanceledError:mpe,isCancel:gpe,CancelToken:vpe,VERSION:ype,all:xpe,Cancel:bpe,isAxiosError:_pe,spread:wpe,toFormData:jpe,AxiosHeaders:Spe,HttpStatusCode:Cpe,formToJSON:Ape,getAdapter:Ppe,mergeConfig:Ope}=Pa,K2=typeof window<"u"&&!!window.electronAPI;function A$(e){return e&&e.includes("localhost")&&e.startsWith("https://")?e.replace("https://","http://"):e}console.log("API baseURL:",void 0);console.log("Is Electron:",K2);const P$={cloudflare:{baseURL:"https://api.yourdomain.com"}};function Wu(){return console.log("Environment variables:",{VITE_API_BASE_URL:void 0,VITE_CLOUDFLARE_URL:void 0,MODE:"production",NODE_ENV:"production",isElectron:K2}),K2&&console.log("Running in Electron - checking environment variables"),console.log("Using production config"),{baseURL:A$(P$.cloudflare.baseURL),timeout:12e4}}const T5=Wu(),Ac=(e,t)=>{try{window.dispatchEvent(new CustomEvent(e,{detail:t}))}catch{}},lx=()=>{localStorage.setItem("authRedirectMessage","Your session expired. Please sign in again."),Ac("auth:expired"),localStorage.removeItem("sessionToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),window.location.href="/login"};let mm=null;const ve=Pa.create({baseURL:T5.baseURL,timeout:T5.timeout,withCredentials:!0});ve.interceptors.request.use(e=>{const t=localStorage.getItem("sessionToken");t&&(e.headers.Authorization=`Bearer ${t}`);try{const n=localStorage.getItem("user"),o=(n?JSON.parse(n):null)?.company_id;o!=null&&o!==""&&(e.headers["x-tenant-id"]=String(o))}catch{}const r=localStorage.getItem("deviceId");r&&(e.headers["x-device-id"]=r);try{const n=typeof Intl<"u"?Intl.DateTimeFormat().resolvedOptions().timeZone:void 0;n&&(e.headers["x-timezone"]=n)}catch{}return e},e=>Promise.reject(e));ve.interceptors.response.use(e=>{try{window.__backendUnavailableSince=void 0,Ac("backend:available"),Ac("connectivity:online");const t=window.__triggerSync;typeof t=="function"&&setTimeout(()=>{try{t()}catch{}},0)}catch{}return e},async e=>{try{const n=e?.response?.status,a=!e.response&&(e.code==="ECONNABORTED"||e.message?.includes("Network Error"));(typeof n=="number"&&n>=500||a)&&(window.__backendUnavailableSince=window.__backendUnavailableSince||Date.now(),Ac("backend:unavailable",{status:n,networkDown:a}),Ac("connectivity:offline",{reason:"backend"})),typeof navigator<"u"&&navigator&&navigator.onLine===!1&&Ac("connectivity:offline",{reason:"network"})}catch{}const t=e.config;if(e.response?.status===401&&t?.url?.includes("/api/auth/refresh"))return lx(),Promise.reject(e);if(e.response?.status===401&&!t._retry){t._retry=!0;const n=localStorage.getItem("refreshToken");if(n)try{return mm||(mm=ve.post("/api/auth/refresh",{refreshToken:n}).then(a=>{const{sessionToken:o,refreshToken:s}=a.data;return localStorage.setItem("sessionToken",o),localStorage.setItem("refreshToken",s),ve.defaults.headers.common.Authorization=`Bearer ${o}`,o}).catch(a=>{throw lx(),a}).finally(()=>{mm=null})),await mm,ve(t)}catch(a){return Promise.reject(a)}else lx()}const r=e?.response?.data?.message||e?.message||"Request failed. Please check your connection and try again.";return Ac("app:error",{message:r}),Promise.reject(e)});const mN=x.createContext(void 0),O$=({children:e})=>{const[t,r]=x.useState(null),[n,a]=x.useState(!1),[o,s]=x.useState("");x.useEffect(()=>{let p=localStorage.getItem("deviceId");p||(p=crypto.randomUUID(),localStorage.setItem("deviceId",p)),s(p)},[]),x.useEffect(()=>{const p=localStorage.getItem("sessionToken"),v=localStorage.getItem("refreshToken"),m=localStorage.getItem("user");if(p&&v&&m)try{const y=JSON.parse(m);r(y),a(!0),ve.defaults.headers.common.Authorization=`Bearer ${p}`,ve.defaults.headers.common["x-device-id"]=o}catch(y){console.error("Error parsing user data:",y),c()}},[o]);const l=(p,v,m)=>{localStorage.setItem("sessionToken",p),localStorage.setItem("refreshToken",v),localStorage.setItem("user",JSON.stringify(m)),ve.defaults.headers.common.Authorization=`Bearer ${p}`;const y=localStorage.getItem("deviceId");y&&(ve.defaults.headers.common["x-device-id"]=y),r(m),a(!0)},c=()=>{localStorage.removeItem("sessionToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),delete ve.defaults.headers.common.Authorization,r(null),a(!1)},u=async()=>{try{await ve.post("/api/auth/logout-all"),c()}catch(p){console.error("Error logging out from all devices:",p),c()}},d=async()=>{try{const p=localStorage.getItem("refreshToken");if(!p)return!1;const v=await ve.post("/api/auth/refresh",{refreshToken:p}),{sessionToken:m,refreshToken:y}=v.data;return localStorage.setItem("sessionToken",m),localStorage.setItem("refreshToken",y),ve.defaults.headers.common.Authorization=`Bearer ${m}`,!0}catch(p){return console.error("Error refreshing session:",p),c(),!1}},f=async()=>{try{return(await ve.get("/api/auth/sessions")).data}catch(p){return console.error("Error fetching user sessions:",p),[]}},h=async p=>{try{return await ve.delete(`/api/auth/sessions/${p}`),!0}catch(v){return console.error("Error deactivating session:",v),!1}};return i.jsx(mN.Provider,{value:{user:t,isAuthenticated:n,login:l,logout:c,logoutFromAllDevices:u,refreshSession:d,getUserSessions:f,deactivateSession:h,currentDeviceId:o},children:e})},ta=()=>{const e=x.useContext(mN);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e},E5=e=>({id:Number(e.id),companyId:Number(e.companyId??e.company_id),conversationType:e.conversationType??e.conversation_type,title:e.title??null,createdBy:Number(e.createdBy??e.created_by),createdAt:e.createdAt??e.created_at,updatedAt:e.updatedAt??e.updated_at,lastMessageAt:e.lastMessageAt??e.last_message_at??null,participants:Array.isArray(e.participants)?e.participants.map(t=>({id:Number(t.id),username:t.username??null,email:t.email??null,isAdmin:!!(t.isAdmin??t.is_admin??!1)})):[],lastMessage:e.lastMessage?{id:Number(e.lastMessage.id),conversationId:Number(e.lastMessage.conversationId??e.lastMessage.conversation_id??e.id),senderId:e.lastMessage.senderId!==void 0&&e.lastMessage.senderId!==null?Number(e.lastMessage.senderId):null,senderName:e.lastMessage.senderName??null,content:e.lastMessage.isDeletedForUser||e.lastMessage.is_deleted_for_user?"Message deleted":e.lastMessage.content??"",isSystem:!!e.lastMessage.isSystem,createdAt:e.lastMessage.createdAt??"",updatedAt:e.lastMessage.updatedAt??e.lastMessage.createdAt??"",isDeletedForUser:!!(e.lastMessage.isDeletedForUser??e.lastMessage.is_deleted_for_user??!1),deletedAt:e.lastMessage.deletedAt??e.lastMessage.deleted_at??null}:null}),cx=e=>({id:typeof e.id=="number"||typeof e.id=="string"?e.id:Number(e.id),conversationId:Number(e.conversationId??e.conversation_id),senderId:e.senderId!==void 0&&e.senderId!==null?Number(e.senderId):e.sender_id!==void 0&&e.sender_id!==null?Number(e.sender_id):null,senderName:e.senderName??e.sender_name??e.username??null,content:e.isDeletedForUser||e.is_deleted_for_user?"Message deleted":e.content??"",isSystem:!!(e.isSystem??e.is_system??!1),createdAt:e.createdAt??e.created_at??new Date().toISOString(),updatedAt:e.updatedAt??e.updated_at??e.createdAt??e.created_at??new Date().toISOString(),pending:e.pending,error:e.error,isDeletedForUser:!!(e.isDeletedForUser??e.is_deleted_for_user??!1),deletedAt:e.deletedAt??e.deleted_at??null}),rf={async createConversation(e){const t=await ve.post("/api/messaging/conversations",e),{conversation:r,created:n}=t.data;return{conversation:E5(r),created:!!n}},async getConversations(){return((await ve.get("/api/messaging/conversations")).data?.conversations??[]).map(r=>E5(r))},async getMessages(e,t={}){return((await ve.get(`/api/messaging/conversations/${e}/messages`,{params:t})).data?.messages??[]).map(a=>cx(a))},async postMessage(e,t){const r=await ve.post(`/api/messaging/conversations/${e}/messages`,{content:t});return cx(r.data?.message??r.data)},async deleteMessage(e,t){const r=await ve.delete(`/api/messaging/conversations/${e}/messages/${t}`);return cx(r.data?.message??r.data)}},gN=x.createContext(void 0),k$=(e,t)=>{const r=e.participants??[],n=t?r.filter(s=>s.id!==t):r,a=r.map(s=>s.username||s.email||"Unknown user").join(", ");if(e.conversationType==="group"){const s=e.title?.trim(),l=`${r.length} participants`;return{displayName:s||l,otherParticipants:n,participantNames:a}}if(n.length===1){const s=n[0];return{displayName:s.username||s.email||"Direct message",otherParticipants:n,participantNames:a}}return{displayName:n.length>0?n.map(s=>s.username||s.email||"Direct message").join(", "):e.title||"Direct message",otherParticipants:n,participantNames:a}},I5=e=>[...e].sort((t,r)=>{const n=t.lastMessageAt||t.updatedAt||t.createdAt,a=r.lastMessageAt||r.updatedAt||r.createdAt;return new Date(a).getTime()-new Date(n).getTime()}),T$=({children:e})=>{const{isAuthenticated:t,user:r}=ta(),n=r?Number(r.id):null,[a,o]=x.useState([]),[s,l]=x.useState(!1),[c,u]=x.useState({}),[d,f]=x.useState({}),[h,p]=x.useState(null),[v,m]=x.useState({}),[y,b]=x.useState([]),_=x.useRef({});x.useEffect(()=>{_.current=c},[c]);const w=x.useMemo(()=>n?`messaging:last-read:${n}`:null,[n]);x.useEffect(()=>{if(!w){m({});return}try{const R=localStorage.getItem(w);if(R){const F=JSON.parse(R);m(F)}else m({})}catch{m({})}},[w]),x.useEffect(()=>{if(w)try{localStorage.setItem(w,JSON.stringify(v))}catch{}},[v,w]);const A=x.useCallback((R,F)=>{w&&m(z=>{const K=F??new Date().toISOString(),J=z[R];return J&&new Date(J).getTime()>=new Date(K).getTime()?z:{...z,[R]:K}})},[w]),P=x.useCallback(R=>{const{displayName:F,otherParticipants:z,participantNames:K}=k$(R,n);return{...R,displayName:F,otherParticipants:z,participantNames:K}},[n]),T=x.useCallback(async(R={})=>{if(t){R.silent||l(!0);try{const F=await rf.getConversations(),z=I5(F.map(P));o(z)}catch(F){console.error("Failed to load conversations",F)}finally{R.silent||l(!1)}}},[P,t]);x.useEffect(()=>{if(!t){o([]),u({}),l(!1),f({}),p(null),b([]);return}T()},[t,T]),x.useEffect(()=>{if(!t)return;const R=setInterval(()=>{T({silent:!0}).catch(()=>{})},1e4);return()=>clearInterval(R)},[t,T]),x.useEffect(()=>{!t||a.length===0||(!h||!a.some(R=>R.id===h))&&p(a[0].id)},[h,a,t]);const E=x.useCallback(async(R,F={})=>{if(t&&!(!F.force&&_.current[R])){F.silent||f(z=>({...z,[R]:!0}));try{const z=await rf.getMessages(R);u(K=>({...K,[R]:z.map(J=>({...J,pending:!1,error:!1}))}))}catch(z){console.error("Failed to load messages",z)}finally{F.silent||f(z=>({...z,[R]:!1}))}}},[t]);x.useEffect(()=>{h&&E(h).catch(()=>{})},[h,E]),x.useEffect(()=>{if(!h||!t)return;const R=setInterval(()=>{E(h,{force:!0,silent:!0}).catch(()=>{})},1e4);return()=>clearInterval(R)},[h,t,E]);const S=x.useCallback(R=>{p(R),R&&E(R).catch(()=>{})},[E]),I=x.useCallback(async(R,F)=>{if(!t||!r)throw new Error("Not authenticated");const z=F.trim();if(!z)throw new Error("Message cannot be empty");const K=`temp-${Date.now()}`,J={id:K,conversationId:R,senderId:n,senderName:r.username||r.email||null,content:z,isSystem:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),pending:!0};u(L=>{const k=L[R]??[];return{...L,[R]:[...k,J]}});try{const L=await rf.postMessage(R,z);return u(k=>{const $=k[R]??[];return{...k,[R]:$.map(X=>X.id===K?L:X)}}),await T(),A(R,new Date().toISOString()),L}catch(L){throw u(k=>{const $=k[R]??[];return{...k,[R]:$.map(X=>X.id===K?{...X,pending:!1,error:!0}:X)}}),L}},[n,t,T,r]),W=x.useCallback(async(R,F)=>{if(!t)throw new Error("Not authenticated");const z=await rf.deleteMessage(R,F);return u(K=>{const J=K[R]??[];return{...K,[R]:J.map(L=>Number(L.id)===Number(F)?{...L,...z,id:L.id,content:"Message deleted",isDeletedForUser:!0,deletedAt:z.deletedAt??null,pending:!1,error:!1}:L)}}),T({silent:!0}).catch(()=>{}),z},[t,T]),O=x.useCallback(async R=>{if(!t)throw new Error("Not authenticated");const F=await rf.createConversation(R),z=P(F.conversation);return o(K=>{const J=K.filter(L=>L.id!==z.id);return I5([z,...J])}),p(z.id),F.created&&u(K=>({...K,[z.id]:[]})),A(z.id,new Date().toISOString()),{conversation:z,created:F.created}},[P,t,A]);x.useEffect(()=>{if(!t){b([]);return}const R=a.filter(F=>{const z=F.lastMessage;if(!z)return!1;const K=F.lastMessageAt||z.updatedAt||z.createdAt;if(!K)return!1;const J=new Date(K).getTime();if(!J||Number.isNaN(J))return!1;const L=v[F.id]?new Date(v[F.id]).getTime():0;if(L&&L>=J)return!1;const k=z.senderId!==null&&z.senderId!==void 0?Number(z.senderId):null;return!(k!==null&&n!==null&&k===n)}).map(F=>F.id);b(R)},[a,n,t,v]),x.useEffect(()=>{if(!h)return;const R=a.find(z=>z.id===h);if(!R)return;const F=R.lastMessageAt||R.updatedAt||R.createdAt;F&&A(h,F)},[h,a,A]);const D=x.useMemo(()=>({conversations:a,isLoadingConversations:s,activeConversationId:h,selectConversation:S,messagesByConversation:c,loadMessages:E,isLoadingMessages:d,sendMessage:I,createConversation:O,refreshConversations:T,deleteMessage:W,unreadConversationIds:y,unreadConversationCount:y.length,markConversationRead:A}),[a,s,h,S,c,E,d,I,O,T,W,y,A]);return i.jsx(gN.Provider,{value:D,children:e})},vN=()=>{const e=x.useContext(gN);if(!e)throw new Error("useMessaging must be used within a MessagingProvider");return e},E$=i8({palette:{primary:{main:"#7c3aed"},secondary:{main:"#ffd600"}},typography:{h4:{fontSize:"1.5rem",fontWeight:600},h6:{fontSize:"1.2rem",fontWeight:500}}});var Wm={exports:{}},I$=Wm.exports,N5;function N$(){return N5||(N5=1,function(e,t){(function(r,n){e.exports=n()})(I$,function(){var r=1e3,n=6e4,a=36e5,o="millisecond",s="second",l="minute",c="hour",u="day",d="week",f="month",h="quarter",p="year",v="date",m="Invalid Date",y=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,b=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,_={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(F){var z=["th","st","nd","rd"],K=F%100;return"["+F+(z[(K-20)%10]||z[K]||z[0])+"]"}},w=function(F,z,K){var J=String(F);return!J||J.length>=z?F:""+Array(z+1-J.length).join(K)+F},A={s:w,z:function(F){var z=-F.utcOffset(),K=Math.abs(z),J=Math.floor(K/60),L=K%60;return(z<=0?"+":"-")+w(J,2,"0")+":"+w(L,2,"0")},m:function F(z,K){if(z.date()<K.date())return-F(K,z);var J=12*(K.year()-z.year())+(K.month()-z.month()),L=z.clone().add(J,f),k=K-L<0,$=z.clone().add(J+(k?-1:1),f);return+(-(J+(K-L)/(k?L-$:$-L))||0)},a:function(F){return F<0?Math.ceil(F)||0:Math.floor(F)},p:function(F){return{M:f,y:p,w:d,d:u,D:v,h:c,m:l,s,ms:o,Q:h}[F]||String(F||"").toLowerCase().replace(/s$/,"")},u:function(F){return F===void 0}},P="en",T={};T[P]=_;var E="$isDayjsObject",S=function(F){return F instanceof D||!(!F||!F[E])},I=function F(z,K,J){var L;if(!z)return P;if(typeof z=="string"){var k=z.toLowerCase();T[k]&&(L=k),K&&(T[k]=K,L=k);var $=z.split("-");if(!L&&$.length>1)return F($[0])}else{var X=z.name;T[X]=z,L=X}return!J&&L&&(P=L),L||!J&&P},W=function(F,z){if(S(F))return F.clone();var K=typeof z=="object"?z:{};return K.date=F,K.args=arguments,new D(K)},O=A;O.l=I,O.i=S,O.w=function(F,z){return W(F,{locale:z.$L,utc:z.$u,x:z.$x,$offset:z.$offset})};var D=function(){function F(K){this.$L=I(K.locale,null,!0),this.parse(K),this.$x=this.$x||K.x||{},this[E]=!0}var z=F.prototype;return z.parse=function(K){this.$d=function(J){var L=J.date,k=J.utc;if(L===null)return new Date(NaN);if(O.u(L))return new Date;if(L instanceof Date)return new Date(L);if(typeof L=="string"&&!/Z$/i.test(L)){var $=L.match(y);if($){var X=$[2]-1||0,C=($[7]||"0").substring(0,3);return k?new Date(Date.UTC($[1],X,$[3]||1,$[4]||0,$[5]||0,$[6]||0,C)):new Date($[1],X,$[3]||1,$[4]||0,$[5]||0,$[6]||0,C)}}return new Date(L)}(K),this.init()},z.init=function(){var K=this.$d;this.$y=K.getFullYear(),this.$M=K.getMonth(),this.$D=K.getDate(),this.$W=K.getDay(),this.$H=K.getHours(),this.$m=K.getMinutes(),this.$s=K.getSeconds(),this.$ms=K.getMilliseconds()},z.$utils=function(){return O},z.isValid=function(){return this.$d.toString()!==m},z.isSame=function(K,J){var L=W(K);return this.startOf(J)<=L&&L<=this.endOf(J)},z.isAfter=function(K,J){return W(K)<this.startOf(J)},z.isBefore=function(K,J){return this.endOf(J)<W(K)},z.$g=function(K,J,L){return O.u(K)?this[J]:this.set(L,K)},z.unix=function(){return Math.floor(this.valueOf()/1e3)},z.valueOf=function(){return this.$d.getTime()},z.startOf=function(K,J){var L=this,k=!!O.u(J)||J,$=O.p(K),X=function(ae,he){var me=O.w(L.$u?Date.UTC(L.$y,he,ae):new Date(L.$y,he,ae),L);return k?me:me.endOf(u)},C=function(ae,he){return O.w(L.toDate()[ae].apply(L.toDate("s"),(k?[0,0,0,0]:[23,59,59,999]).slice(he)),L)},M=this.$W,H=this.$M,U=this.$D,te="set"+(this.$u?"UTC":"");switch($){case p:return k?X(1,0):X(31,11);case f:return k?X(1,H):X(0,H+1);case d:var le=this.$locale().weekStart||0,oe=(M<le?M+7:M)-le;return X(k?U-oe:U+(6-oe),H);case u:case v:return C(te+"Hours",0);case c:return C(te+"Minutes",1);case l:return C(te+"Seconds",2);case s:return C(te+"Milliseconds",3);default:return this.clone()}},z.endOf=function(K){return this.startOf(K,!1)},z.$set=function(K,J){var L,k=O.p(K),$="set"+(this.$u?"UTC":""),X=(L={},L[u]=$+"Date",L[v]=$+"Date",L[f]=$+"Month",L[p]=$+"FullYear",L[c]=$+"Hours",L[l]=$+"Minutes",L[s]=$+"Seconds",L[o]=$+"Milliseconds",L)[k],C=k===u?this.$D+(J-this.$W):J;if(k===f||k===p){var M=this.clone().set(v,1);M.$d[X](C),M.init(),this.$d=M.set(v,Math.min(this.$D,M.daysInMonth())).$d}else X&&this.$d[X](C);return this.init(),this},z.set=function(K,J){return this.clone().$set(K,J)},z.get=function(K){return this[O.p(K)]()},z.add=function(K,J){var L,k=this;K=Number(K);var $=O.p(J),X=function(H){var U=W(k);return O.w(U.date(U.date()+Math.round(H*K)),k)};if($===f)return this.set(f,this.$M+K);if($===p)return this.set(p,this.$y+K);if($===u)return X(1);if($===d)return X(7);var C=(L={},L[l]=n,L[c]=a,L[s]=r,L)[$]||1,M=this.$d.getTime()+K*C;return O.w(M,this)},z.subtract=function(K,J){return this.add(-1*K,J)},z.format=function(K){var J=this,L=this.$locale();if(!this.isValid())return L.invalidDate||m;var k=K||"YYYY-MM-DDTHH:mm:ssZ",$=O.z(this),X=this.$H,C=this.$m,M=this.$M,H=L.weekdays,U=L.months,te=L.meridiem,le=function(he,me,Q,G){return he&&(he[me]||he(J,k))||Q[me].slice(0,G)},oe=function(he){return O.s(X%12||12,he,"0")},ae=te||function(he,me,Q){var G=he<12?"AM":"PM";return Q?G.toLowerCase():G};return k.replace(b,function(he,me){return me||function(Q){switch(Q){case"YY":return String(J.$y).slice(-2);case"YYYY":return O.s(J.$y,4,"0");case"M":return M+1;case"MM":return O.s(M+1,2,"0");case"MMM":return le(L.monthsShort,M,U,3);case"MMMM":return le(U,M);case"D":return J.$D;case"DD":return O.s(J.$D,2,"0");case"d":return String(J.$W);case"dd":return le(L.weekdaysMin,J.$W,H,2);case"ddd":return le(L.weekdaysShort,J.$W,H,3);case"dddd":return H[J.$W];case"H":return String(X);case"HH":return O.s(X,2,"0");case"h":return oe(1);case"hh":return oe(2);case"a":return ae(X,C,!0);case"A":return ae(X,C,!1);case"m":return String(C);case"mm":return O.s(C,2,"0");case"s":return String(J.$s);case"ss":return O.s(J.$s,2,"0");case"SSS":return O.s(J.$ms,3,"0");case"Z":return $}return null}(he)||$.replace(":","")})},z.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},z.diff=function(K,J,L){var k,$=this,X=O.p(J),C=W(K),M=(C.utcOffset()-this.utcOffset())*n,H=this-C,U=function(){return O.m($,C)};switch(X){case p:k=U()/12;break;case f:k=U();break;case h:k=U()/3;break;case d:k=(H-M)/6048e5;break;case u:k=(H-M)/864e5;break;case c:k=H/a;break;case l:k=H/n;break;case s:k=H/r;break;default:k=H}return L?k:O.a(k)},z.daysInMonth=function(){return this.endOf(f).$D},z.$locale=function(){return T[this.$L]},z.locale=function(K,J){if(!K)return this.$L;var L=this.clone(),k=I(K,J,!0);return k&&(L.$L=k),L},z.clone=function(){return O.w(this.$d,this)},z.toDate=function(){return new Date(this.valueOf())},z.toJSON=function(){return this.isValid()?this.toISOString():null},z.toISOString=function(){return this.$d.toISOString()},z.toString=function(){return this.$d.toUTCString()},F}(),R=D.prototype;return W.prototype=R,[["$ms",o],["$s",s],["$m",l],["$H",c],["$W",u],["$M",f],["$y",p],["$D",v]].forEach(function(F){R[F[1]]=function(z){return this.$g(z,F[0],F[1])}}),W.extend=function(F,z){return F.$i||(F(z,D,W),F.$i=!0),W},W.locale=I,W.isDayjs=S,W.unix=function(F){return W(1e3*F)},W.en=T[P],W.Ls=T,W.p={},W})}(Wm)),Wm.exports}var D$=N$();const Rt=Et(D$);var Hm={exports:{}},M$=Hm.exports,D5;function L$(){return D5||(D5=1,function(e,t){(function(r,n){e.exports=n()})(M$,function(){var r="week",n="year";return function(a,o,s){var l=o.prototype;l.week=function(c){if(c===void 0&&(c=null),c!==null)return this.add(7*(c-this.week()),"day");var u=this.$locale().yearStart||1;if(this.month()===11&&this.date()>25){var d=s(this).startOf(n).add(1,n).date(u),f=s(this).endOf(r);if(d.isBefore(f))return 1}var h=s(this).startOf(n).date(u).startOf(r).subtract(1,"millisecond"),p=this.diff(h,r,!0);return p<0?s(this).startOf("week").week():Math.ceil(p)},l.weeks=function(c){return c===void 0&&(c=null),this.week(c)}}})}(Hm)),Hm.exports}var R$=L$();const q$=Et(R$);var Vm={exports:{}},F$=Vm.exports,M5;function $$(){return M5||(M5=1,function(e,t){(function(r,n){e.exports=n()})(F$,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},n=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,a=/\d/,o=/\d\d/,s=/\d\d?/,l=/\d*[^-_:/,()\s\d]+/,c={},u=function(y){return(y=+y)+(y>68?1900:2e3)},d=function(y){return function(b){this[y]=+b}},f=[/[+-]\d\d:?(\d\d)?|Z/,function(y){(this.zone||(this.zone={})).offset=function(b){if(!b||b==="Z")return 0;var _=b.match(/([+-]|\d\d)/g),w=60*_[1]+(+_[2]||0);return w===0?0:_[0]==="+"?-w:w}(y)}],h=function(y){var b=c[y];return b&&(b.indexOf?b:b.s.concat(b.f))},p=function(y,b){var _,w=c.meridiem;if(w){for(var A=1;A<=24;A+=1)if(y.indexOf(w(A,0,b))>-1){_=A>12;break}}else _=y===(b?"pm":"PM");return _},v={A:[l,function(y){this.afternoon=p(y,!1)}],a:[l,function(y){this.afternoon=p(y,!0)}],Q:[a,function(y){this.month=3*(y-1)+1}],S:[a,function(y){this.milliseconds=100*+y}],SS:[o,function(y){this.milliseconds=10*+y}],SSS:[/\d{3}/,function(y){this.milliseconds=+y}],s:[s,d("seconds")],ss:[s,d("seconds")],m:[s,d("minutes")],mm:[s,d("minutes")],H:[s,d("hours")],h:[s,d("hours")],HH:[s,d("hours")],hh:[s,d("hours")],D:[s,d("day")],DD:[o,d("day")],Do:[l,function(y){var b=c.ordinal,_=y.match(/\d+/);if(this.day=_[0],b)for(var w=1;w<=31;w+=1)b(w).replace(/\[|\]/g,"")===y&&(this.day=w)}],w:[s,d("week")],ww:[o,d("week")],M:[s,d("month")],MM:[o,d("month")],MMM:[l,function(y){var b=h("months"),_=(h("monthsShort")||b.map(function(w){return w.slice(0,3)})).indexOf(y)+1;if(_<1)throw new Error;this.month=_%12||_}],MMMM:[l,function(y){var b=h("months").indexOf(y)+1;if(b<1)throw new Error;this.month=b%12||b}],Y:[/[+-]?\d+/,d("year")],YY:[o,function(y){this.year=u(y)}],YYYY:[/\d{4}/,d("year")],Z:f,ZZ:f};function m(y){var b,_;b=y,_=c&&c.formats;for(var w=(y=b.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(W,O,D){var R=D&&D.toUpperCase();return O||_[D]||r[D]||_[R].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(F,z,K){return z||K.slice(1)})})).match(n),A=w.length,P=0;P<A;P+=1){var T=w[P],E=v[T],S=E&&E[0],I=E&&E[1];w[P]=I?{regex:S,parser:I}:T.replace(/^\[|\]$/g,"")}return function(W){for(var O={},D=0,R=0;D<A;D+=1){var F=w[D];if(typeof F=="string")R+=F.length;else{var z=F.regex,K=F.parser,J=W.slice(R),L=z.exec(J)[0];K.call(O,L),W=W.replace(L,"")}}return function(k){var $=k.afternoon;if($!==void 0){var X=k.hours;$?X<12&&(k.hours+=12):X===12&&(k.hours=0),delete k.afternoon}}(O),O}}return function(y,b,_){_.p.customParseFormat=!0,y&&y.parseTwoDigitYear&&(u=y.parseTwoDigitYear);var w=b.prototype,A=w.parse;w.parse=function(P){var T=P.date,E=P.utc,S=P.args;this.$u=E;var I=S[1];if(typeof I=="string"){var W=S[2]===!0,O=S[3]===!0,D=W||O,R=S[2];O&&(R=S[2]),c=this.$locale(),!W&&R&&(c=_.Ls[R]),this.$d=function(J,L,k,$){try{if(["x","X"].indexOf(L)>-1)return new Date((L==="X"?1e3:1)*J);var X=m(L)(J),C=X.year,M=X.month,H=X.day,U=X.hours,te=X.minutes,le=X.seconds,oe=X.milliseconds,ae=X.zone,he=X.week,me=new Date,Q=H||(C||M?1:me.getDate()),G=C||me.getFullYear(),ee=0;C&&!M||(ee=M>0?M-1:me.getMonth());var se,V=U||0,Ge=te||0,De=le||0,Fe=oe||0;return ae?new Date(Date.UTC(G,ee,Q,V,Ge,De,Fe+60*ae.offset*1e3)):k?new Date(Date.UTC(G,ee,Q,V,Ge,De,Fe)):(se=new Date(G,ee,Q,V,Ge,De,Fe),he&&(se=$(se).week(he).toDate()),se)}catch{return new Date("")}}(T,I,E,_),this.init(),R&&R!==!0&&(this.$L=this.locale(R).$L),D&&T!=this.format(I)&&(this.$d=new Date("")),c={}}else if(I instanceof Array)for(var F=I.length,z=1;z<=F;z+=1){S[1]=I[z-1];var K=_.apply(this,S);if(K.isValid()){this.$d=K.$d,this.$L=K.$L,this.init();break}z===F&&(this.$d=new Date(""))}else A.call(this,P)}}})}(Vm)),Vm.exports}var B$=$$();const U$=Et(B$);var Gm={exports:{}},z$=Gm.exports,L5;function W$(){return L5||(L5=1,function(e,t){(function(r,n){e.exports=n()})(z$,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(n,a,o){var s=a.prototype,l=s.format;o.en.formats=r,s.format=function(c){c===void 0&&(c="YYYY-MM-DDTHH:mm:ssZ");var u=this.$locale().formats,d=function(f,h){return f.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(p,v,m){var y=m&&m.toUpperCase();return v||h[m]||r[m]||h[y].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(b,_,w){return _||w.slice(1)})})}(c,u===void 0?{}:u);return l.call(this,d)}}})}(Gm)),Gm.exports}var H$=W$();const V$=Et(H$);var Ym={exports:{}},G$=Ym.exports,R5;function Y$(){return R5||(R5=1,function(e,t){(function(r,n){e.exports=n()})(G$,function(){return function(r,n,a){n.prototype.isBetween=function(o,s,l,c){var u=a(o),d=a(s),f=(c=c||"()")[0]==="(",h=c[1]===")";return(f?this.isAfter(u,l):!this.isBefore(u,l))&&(h?this.isBefore(d,l):!this.isAfter(d,l))||(f?this.isBefore(u,l):!this.isAfter(u,l))&&(h?this.isAfter(d,l):!this.isBefore(d,l))}}})}(Ym)),Ym.exports}var K$=Y$();const Q$=Et(K$);Rt.extend(U$);Rt.extend(V$);Rt.extend(Q$);const X$=o8(["Your locale has not been found.","Either the locale key is not a supported one. Locales supported by dayjs are available here: https://github.com/iamkun/dayjs/tree/dev/src/locale","Or you forget to import the locale from 'dayjs/locale/{localeUsed}'","fallback on English locale"]),J$={YY:"year",YYYY:{sectionType:"year",contentType:"digit",maxLength:4},M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMM:{sectionType:"month",contentType:"letter"},MMMM:{sectionType:"month",contentType:"letter"},D:{sectionType:"day",contentType:"digit",maxLength:2},DD:"day",Do:{sectionType:"day",contentType:"digit-with-letter"},d:{sectionType:"weekDay",contentType:"digit",maxLength:2},dd:{sectionType:"weekDay",contentType:"letter"},ddd:{sectionType:"weekDay",contentType:"letter"},dddd:{sectionType:"weekDay",contentType:"letter"},A:"meridiem",a:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},Z$={year:"YYYY",month:"MMMM",monthShort:"MMM",dayOfMonth:"D",weekday:"dddd",weekdayShort:"dd",hours24h:"HH",hours12h:"hh",meridiem:"A",minutes:"mm",seconds:"ss",fullDate:"ll",fullDateWithWeekday:"dddd, LL",keyboardDate:"L",shortDate:"MMM D",normalDate:"D MMMM",normalDateWithWeekday:"ddd, MMM D",monthAndYear:"MMMM YYYY",monthAndDate:"MMMM D",fullTime:"LT",fullTime12h:"hh:mm A",fullTime24h:"HH:mm",fullDateTime:"lll",fullDateTime12h:"ll hh:mm A",fullDateTime24h:"ll HH:mm",keyboardDateTime:"L LT",keyboardDateTime12h:"L hh:mm A",keyboardDateTime24h:"L HH:mm"},ux=["Missing UTC plugin","To be able to use UTC or timezones, you have to enable the `utc` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-utc"].join(`
`),q5=["Missing timezone plugin","To be able to use timezones, you have to enable both the `utc` and the `timezone` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-timezone"].join(`
`),e7=(e,t)=>t?(...r)=>e(...r).locale(t):e;class oc{constructor({locale:t,formats:r,instance:n}={}){var a;this.isMUIAdapter=!0,this.isTimezoneCompatible=!0,this.lib="dayjs",this.rawDayJsInstance=void 0,this.dayjs=void 0,this.locale=void 0,this.formats=void 0,this.escapedCharacters={start:"[",end:"]"},this.formatTokenMap=J$,this.setLocaleToValue=o=>{const s=this.getCurrentLocaleCode();return s===o.locale()?o:o.locale(s)},this.hasUTCPlugin=()=>typeof Rt.utc<"u",this.hasTimezonePlugin=()=>typeof Rt.tz<"u",this.isSame=(o,s,l)=>{const c=this.setTimezone(s,this.getTimezone(o));return o.format(l)===c.format(l)},this.cleanTimezone=o=>{switch(o){case"default":return;case"system":return Rt.tz.guess();default:return o}},this.createSystemDate=o=>{if(this.rawDayJsInstance)return this.rawDayJsInstance(o);if(this.hasUTCPlugin()&&this.hasTimezonePlugin()){const s=Rt.tz.guess();return s!=="UTC"?Rt.tz(o,s):Rt(o)}return Rt(o)},this.createUTCDate=o=>{if(!this.hasUTCPlugin())throw new Error(ux);return Rt.utc(o)},this.createTZDate=(o,s)=>{if(!this.hasUTCPlugin())throw new Error(ux);if(!this.hasTimezonePlugin())throw new Error(q5);const l=o!==void 0&&!o.endsWith("Z");return Rt(o).tz(this.cleanTimezone(s),l)},this.getLocaleFormats=()=>{const o=Rt.Ls,s=this.locale||"en";let l=o[s];return l===void 0&&(X$(),l=o.en),l.formats},this.adjustOffset=o=>{if(!this.hasTimezonePlugin())return o;const s=this.getTimezone(o);if(s!=="UTC"){var l,c;const u=o.tz(this.cleanTimezone(s),!0);if(((l=u.$offset)!=null?l:0)===((c=o.$offset)!=null?c:0))return o;o.$offset=u.$offset}return o},this.date=o=>o===null?null:this.dayjs(o),this.dateWithTimezone=(o,s)=>{if(o===null)return null;let l;return s==="UTC"?l=this.createUTCDate(o):s==="system"||s==="default"&&!this.hasTimezonePlugin()?l=this.createSystemDate(o):l=this.createTZDate(o,s),this.locale===void 0?l:l.locale(this.locale)},this.getTimezone=o=>{if(this.hasTimezonePlugin()){var s;const l=(s=o.$x)==null?void 0:s.$timezone;if(l)return l}return this.hasUTCPlugin()&&o.isUTC()?"UTC":"system"},this.setTimezone=(o,s)=>{if(this.getTimezone(o)===s)return o;if(s==="UTC"){if(!this.hasUTCPlugin())throw new Error(ux);return o.utc()}if(s==="system")return o.local();if(!this.hasTimezonePlugin()){if(s==="default")return o;throw new Error(q5)}return Rt.tz(o,this.cleanTimezone(s))},this.toJsDate=o=>o.toDate(),this.parseISO=o=>this.dayjs(o),this.toISO=o=>o.toISOString(),this.parse=(o,s)=>o===""?null:this.dayjs(o,s,this.locale,!0),this.getCurrentLocaleCode=()=>this.locale||"en",this.is12HourCycleInCurrentLocale=()=>/A|a/.test(this.getLocaleFormats().LT||""),this.expandFormat=o=>{const s=this.getLocaleFormats(),l=c=>c.replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(u,d,f)=>d||f.slice(1));return o.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(c,u,d)=>{const f=d&&d.toUpperCase();return u||s[d]||l(s[f])})},this.getFormatHelperText=o=>this.expandFormat(o).replace(/a/gi,"(a|p)m").toLocaleLowerCase(),this.isNull=o=>o===null,this.isValid=o=>this.dayjs(o).isValid(),this.format=(o,s)=>this.formatByString(o,this.formats[s]),this.formatByString=(o,s)=>this.dayjs(o).format(s),this.formatNumber=o=>o,this.getDiff=(o,s,l)=>o.diff(s,l),this.isEqual=(o,s)=>o===null&&s===null?!0:this.dayjs(o).toDate().getTime()===this.dayjs(s).toDate().getTime(),this.isSameYear=(o,s)=>this.isSame(o,s,"YYYY"),this.isSameMonth=(o,s)=>this.isSame(o,s,"YYYY-MM"),this.isSameDay=(o,s)=>this.isSame(o,s,"YYYY-MM-DD"),this.isSameHour=(o,s)=>o.isSame(s,"hour"),this.isAfter=(o,s)=>o>s,this.isAfterYear=(o,s)=>this.hasUTCPlugin()?!this.isSameYear(o,s)&&o.utc()>s.utc():o.isAfter(s,"year"),this.isAfterDay=(o,s)=>this.hasUTCPlugin()?!this.isSameDay(o,s)&&o.utc()>s.utc():o.isAfter(s,"day"),this.isBefore=(o,s)=>o<s,this.isBeforeYear=(o,s)=>this.hasUTCPlugin()?!this.isSameYear(o,s)&&o.utc()<s.utc():o.isBefore(s,"year"),this.isBeforeDay=(o,s)=>this.hasUTCPlugin()?!this.isSameDay(o,s)&&o.utc()<s.utc():o.isBefore(s,"day"),this.isWithinRange=(o,[s,l])=>o>=s&&o<=l,this.startOfYear=o=>this.adjustOffset(o.startOf("year")),this.startOfMonth=o=>this.adjustOffset(o.startOf("month")),this.startOfWeek=o=>this.adjustOffset(o.startOf("week")),this.startOfDay=o=>this.adjustOffset(o.startOf("day")),this.endOfYear=o=>this.adjustOffset(o.endOf("year")),this.endOfMonth=o=>this.adjustOffset(o.endOf("month")),this.endOfWeek=o=>this.adjustOffset(o.endOf("week")),this.endOfDay=o=>this.adjustOffset(o.endOf("day")),this.addYears=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"year"):o.add(s,"year")),this.addMonths=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"month"):o.add(s,"month")),this.addWeeks=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"week"):o.add(s,"week")),this.addDays=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"day"):o.add(s,"day")),this.addHours=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"hour"):o.add(s,"hour")),this.addMinutes=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"minute"):o.add(s,"minute")),this.addSeconds=(o,s)=>this.adjustOffset(s<0?o.subtract(Math.abs(s),"second"):o.add(s,"second")),this.getYear=o=>o.year(),this.getMonth=o=>o.month(),this.getDate=o=>o.date(),this.getHours=o=>o.hour(),this.getMinutes=o=>o.minute(),this.getSeconds=o=>o.second(),this.getMilliseconds=o=>o.millisecond(),this.setYear=(o,s)=>this.adjustOffset(o.set("year",s)),this.setMonth=(o,s)=>this.adjustOffset(o.set("month",s)),this.setDate=(o,s)=>this.adjustOffset(o.set("date",s)),this.setHours=(o,s)=>this.adjustOffset(o.set("hour",s)),this.setMinutes=(o,s)=>this.adjustOffset(o.set("minute",s)),this.setSeconds=(o,s)=>this.adjustOffset(o.set("second",s)),this.setMilliseconds=(o,s)=>this.adjustOffset(o.set("millisecond",s)),this.getDaysInMonth=o=>o.daysInMonth(),this.getNextMonth=o=>this.addMonths(o,1),this.getPreviousMonth=o=>this.addMonths(o,-1),this.getMonthArray=o=>{const l=[o.startOf("year")];for(;l.length<12;){const c=l[l.length-1];l.push(this.addMonths(c,1))}return l},this.mergeDateAndTime=(o,s)=>o.hour(s.hour()).minute(s.minute()).second(s.second()),this.getWeekdays=()=>{const o=this.dayjs().startOf("week");return[0,1,2,3,4,5,6].map(s=>this.formatByString(this.addDays(o,s),"dd"))},this.getWeekArray=o=>{const s=this.setLocaleToValue(o),l=s.startOf("month").startOf("week"),c=s.endOf("month").endOf("week");let u=0,d=l;const f=[];for(;d<c;){const h=Math.floor(u/7);f[h]=f[h]||[],f[h].push(d),d=this.addDays(d,1),u+=1}return f},this.getWeekNumber=o=>o.week(),this.getYearRange=(o,s)=>{const l=o.startOf("year"),c=s.endOf("year"),u=[];let d=l;for(;d<c;)u.push(d),d=this.addYears(d,1);return u},this.getMeridiemText=o=>o==="am"?"AM":"PM",this.rawDayJsInstance=n,this.dayjs=e7((a=this.rawDayJsInstance)!=null?a:Rt,t),this.locale=t,this.formats=vI({},Z$,r),Rt.extend(q$)}}const Sh=async()=>{try{const e=await window?.api?.timeEvents?.pendingCount?.();return e?.success?e.count:0}catch{return 0}},t7=async(e=200)=>{const t=await window?.api?.timeEvents?.listPending?.(e);return t?.success?t.rows:[]},F5=async()=>{const e=await t7(200);let t=0,r=0;const n=[];for(const a of e)try{const o=JSON.parse(a.payload_json||"{}");switch(a.type){case"attendance_clock_in":await ve.post("/api/attendance/clock-in",{profile_id:o.profile_id,latitude:o.latitude,longitude:o.longitude});break;case"attendance_clock_out":await ve.post("/api/attendance/clock-out",{shift_id:o.shift_id});break;case"attendance_update":await ve.put(`/api/attendance/${o.shift_id}`,{clock_in:o.clock_in,clock_out:o.clock_out});break;case"time_clock_in":await ve.post("/api/time-tracking/time-entries/clock-in",{profile_id:o.profile_id,so_id:o.so_id});break;case"time_clock_out":await ve.post(`/api/time-tracking/time-entries/${o.id}/clock-out`);break;default:r++;continue}n.push(a.event_id),t++}catch{r++}return n.length&&await window?.api?.timeEvents?.markSynced?.(n),{synced:t,failed:r}};var nf={},dx={};const r7=U8(s8);var $5;function cr(){return $5||($5=1,function(e){"use client";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=r7}(dx)),dx}var B5;function n7(){if(B5)return nf;B5=1;var e=sr();Object.defineProperty(nf,"__esModule",{value:!0}),nf.default=void 0;var t=e(cr()),r=lr();return nf.default=(0,t.default)((0,r.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 9h12v2H6zm8 5H6v-2h8zm4-6H6V6h12z"}),"Chat"),nf}var a7=n7();const i7=Et(a7);var af={},U5;function o7(){if(U5)return af;U5=1;var e=sr();Object.defineProperty(af,"__esModule",{value:!0}),af.default=void 0;var t=e(cr()),r=lr();return af.default=(0,t.default)((0,r.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),af}var s7=o7();const oj=Et(s7);var of={},z5;function l7(){if(z5)return of;z5=1;var e=sr();Object.defineProperty(of,"__esModule",{value:!0}),of.default=void 0;var t=e(cr()),r=lr();return of.default=(0,t.default)((0,r.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),of}var c7=l7();const yN=Et(c7);var sf={},W5;function u7(){if(W5)return sf;W5=1;var e=sr();Object.defineProperty(sf,"__esModule",{value:!0}),sf.default=void 0;var t=e(cr()),r=lr();return sf.default=(0,t.default)((0,r.jsx)("path",{d:"M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3M7.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S9.83 13 9 13s-1.5-.67-1.5-1.5M16 17H8v-2h8zm-1-4c-.83 0-1.5-.67-1.5-1.5S14.17 10 15 10s1.5.67 1.5 1.5S15.83 13 15 13"}),"SmartToy"),sf}var d7=u7();const f7=Et(d7);var lf={},H5;function h7(){if(H5)return lf;H5=1;var e=sr();Object.defineProperty(lf,"__esModule",{value:!0}),lf.default=void 0;var t=e(cr()),r=lr();return lf.default=(0,t.default)((0,r.jsx)("path",{d:"M9 17H7v-7h2zm4 0h-2V7h2zm4 0h-2v-4h2zm2.5 2.1h-15V5h15zm0-16.1h-15c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"}),"InsertChartOutlined"),lf}var p7=h7();const m7=Et(p7);var cf={},V5;function g7(){if(V5)return cf;V5=1;var e=sr();Object.defineProperty(cf,"__esModule",{value:!0}),cf.default=void 0;var t=e(cr()),r=lr();return cf.default=(0,t.default)((0,r.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7zm-8 2V5h2v6h1.17L12 13.17 9.83 11zm-6 7h14v2H5z"}),"DownloadOutlined"),cf}var v7=g7();const y7=Et(v7);async function x7(e,t){return(await ve.post("/api/assistant",{prompt:e,mode:t})).data}var fx,G5;function Zi(){if(G5)return fx;G5=1;var e=Array.isArray;return fx=e,fx}var hx,Y5;function xN(){if(Y5)return hx;Y5=1;var e=typeof hm=="object"&&hm&&hm.Object===Object&&hm;return hx=e,hx}var px,K5;function Ls(){if(K5)return px;K5=1;var e=xN(),t=typeof self=="object"&&self&&self.Object===Object&&self,r=e||t||Function("return this")();return px=r,px}var mx,Q5;function Dp(){if(Q5)return mx;Q5=1;var e=Ls(),t=e.Symbol;return mx=t,mx}var gx,X5;function b7(){if(X5)return gx;X5=1;var e=Dp(),t=Object.prototype,r=t.hasOwnProperty,n=t.toString,a=e?e.toStringTag:void 0;function o(s){var l=r.call(s,a),c=s[a];try{s[a]=void 0;var u=!0}catch{}var d=n.call(s);return u&&(l?s[a]=c:delete s[a]),d}return gx=o,gx}var vx,J5;function _7(){if(J5)return vx;J5=1;var e=Object.prototype,t=e.toString;function r(n){return t.call(n)}return vx=r,vx}var yx,Z5;function _l(){if(Z5)return yx;Z5=1;var e=Dp(),t=b7(),r=_7(),n="[object Null]",a="[object Undefined]",o=e?e.toStringTag:void 0;function s(l){return l==null?l===void 0?a:n:o&&o in Object(l)?t(l):r(l)}return yx=s,yx}var xx,eC;function wl(){if(eC)return xx;eC=1;function e(t){return t!=null&&typeof t=="object"}return xx=e,xx}var bx,tC;function Ld(){if(tC)return bx;tC=1;var e=_l(),t=wl(),r="[object Symbol]";function n(a){return typeof a=="symbol"||t(a)&&e(a)==r}return bx=n,bx}var _x,rC;function sj(){if(rC)return _x;rC=1;var e=Zi(),t=Ld(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function a(o,s){if(e(o))return!1;var l=typeof o;return l=="number"||l=="symbol"||l=="boolean"||o==null||t(o)?!0:n.test(o)||!r.test(o)||s!=null&&o in Object(s)}return _x=a,_x}var wx,nC;function sc(){if(nC)return wx;nC=1;function e(t){var r=typeof t;return t!=null&&(r=="object"||r=="function")}return wx=e,wx}var jx,aC;function lj(){if(aC)return jx;aC=1;var e=_l(),t=sc(),r="[object AsyncFunction]",n="[object Function]",a="[object GeneratorFunction]",o="[object Proxy]";function s(l){if(!t(l))return!1;var c=e(l);return c==n||c==a||c==r||c==o}return jx=s,jx}var Sx,iC;function w7(){if(iC)return Sx;iC=1;var e=Ls(),t=e["__core-js_shared__"];return Sx=t,Sx}var Cx,oC;function j7(){if(oC)return Cx;oC=1;var e=w7(),t=function(){var n=/[^.]+$/.exec(e&&e.keys&&e.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function r(n){return!!t&&t in n}return Cx=r,Cx}var Ax,sC;function bN(){if(sC)return Ax;sC=1;var e=Function.prototype,t=e.toString;function r(n){if(n!=null){try{return t.call(n)}catch{}try{return n+""}catch{}}return""}return Ax=r,Ax}var Px,lC;function S7(){if(lC)return Px;lC=1;var e=lj(),t=j7(),r=sc(),n=bN(),a=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,s=Function.prototype,l=Object.prototype,c=s.toString,u=l.hasOwnProperty,d=RegExp("^"+c.call(u).replace(a,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function f(h){if(!r(h)||t(h))return!1;var p=e(h)?d:o;return p.test(n(h))}return Px=f,Px}var Ox,cC;function C7(){if(cC)return Ox;cC=1;function e(t,r){return t?.[r]}return Ox=e,Ox}var kx,uC;function au(){if(uC)return kx;uC=1;var e=S7(),t=C7();function r(n,a){var o=t(n,a);return e(o)?o:void 0}return kx=r,kx}var Tx,dC;function Bv(){if(dC)return Tx;dC=1;var e=au(),t=e(Object,"create");return Tx=t,Tx}var Ex,fC;function A7(){if(fC)return Ex;fC=1;var e=Bv();function t(){this.__data__=e?e(null):{},this.size=0}return Ex=t,Ex}var Ix,hC;function P7(){if(hC)return Ix;hC=1;function e(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r}return Ix=e,Ix}var Nx,pC;function O7(){if(pC)return Nx;pC=1;var e=Bv(),t="__lodash_hash_undefined__",r=Object.prototype,n=r.hasOwnProperty;function a(o){var s=this.__data__;if(e){var l=s[o];return l===t?void 0:l}return n.call(s,o)?s[o]:void 0}return Nx=a,Nx}var Dx,mC;function k7(){if(mC)return Dx;mC=1;var e=Bv(),t=Object.prototype,r=t.hasOwnProperty;function n(a){var o=this.__data__;return e?o[a]!==void 0:r.call(o,a)}return Dx=n,Dx}var Mx,gC;function T7(){if(gC)return Mx;gC=1;var e=Bv(),t="__lodash_hash_undefined__";function r(n,a){var o=this.__data__;return this.size+=this.has(n)?0:1,o[n]=e&&a===void 0?t:a,this}return Mx=r,Mx}var Lx,vC;function E7(){if(vC)return Lx;vC=1;var e=A7(),t=P7(),r=O7(),n=k7(),a=T7();function o(s){var l=-1,c=s==null?0:s.length;for(this.clear();++l<c;){var u=s[l];this.set(u[0],u[1])}}return o.prototype.clear=e,o.prototype.delete=t,o.prototype.get=r,o.prototype.has=n,o.prototype.set=a,Lx=o,Lx}var Rx,yC;function I7(){if(yC)return Rx;yC=1;function e(){this.__data__=[],this.size=0}return Rx=e,Rx}var qx,xC;function cj(){if(xC)return qx;xC=1;function e(t,r){return t===r||t!==t&&r!==r}return qx=e,qx}var Fx,bC;function Uv(){if(bC)return Fx;bC=1;var e=cj();function t(r,n){for(var a=r.length;a--;)if(e(r[a][0],n))return a;return-1}return Fx=t,Fx}var $x,_C;function N7(){if(_C)return $x;_C=1;var e=Uv(),t=Array.prototype,r=t.splice;function n(a){var o=this.__data__,s=e(o,a);if(s<0)return!1;var l=o.length-1;return s==l?o.pop():r.call(o,s,1),--this.size,!0}return $x=n,$x}var Bx,wC;function D7(){if(wC)return Bx;wC=1;var e=Uv();function t(r){var n=this.__data__,a=e(n,r);return a<0?void 0:n[a][1]}return Bx=t,Bx}var Ux,jC;function M7(){if(jC)return Ux;jC=1;var e=Uv();function t(r){return e(this.__data__,r)>-1}return Ux=t,Ux}var zx,SC;function L7(){if(SC)return zx;SC=1;var e=Uv();function t(r,n){var a=this.__data__,o=e(a,r);return o<0?(++this.size,a.push([r,n])):a[o][1]=n,this}return zx=t,zx}var Wx,CC;function zv(){if(CC)return Wx;CC=1;var e=I7(),t=N7(),r=D7(),n=M7(),a=L7();function o(s){var l=-1,c=s==null?0:s.length;for(this.clear();++l<c;){var u=s[l];this.set(u[0],u[1])}}return o.prototype.clear=e,o.prototype.delete=t,o.prototype.get=r,o.prototype.has=n,o.prototype.set=a,Wx=o,Wx}var Hx,AC;function uj(){if(AC)return Hx;AC=1;var e=au(),t=Ls(),r=e(t,"Map");return Hx=r,Hx}var Vx,PC;function R7(){if(PC)return Vx;PC=1;var e=E7(),t=zv(),r=uj();function n(){this.size=0,this.__data__={hash:new e,map:new(r||t),string:new e}}return Vx=n,Vx}var Gx,OC;function q7(){if(OC)return Gx;OC=1;function e(t){var r=typeof t;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?t!=="__proto__":t===null}return Gx=e,Gx}var Yx,kC;function Wv(){if(kC)return Yx;kC=1;var e=q7();function t(r,n){var a=r.__data__;return e(n)?a[typeof n=="string"?"string":"hash"]:a.map}return Yx=t,Yx}var Kx,TC;function F7(){if(TC)return Kx;TC=1;var e=Wv();function t(r){var n=e(this,r).delete(r);return this.size-=n?1:0,n}return Kx=t,Kx}var Qx,EC;function $7(){if(EC)return Qx;EC=1;var e=Wv();function t(r){return e(this,r).get(r)}return Qx=t,Qx}var Xx,IC;function B7(){if(IC)return Xx;IC=1;var e=Wv();function t(r){return e(this,r).has(r)}return Xx=t,Xx}var Jx,NC;function U7(){if(NC)return Jx;NC=1;var e=Wv();function t(r,n){var a=e(this,r),o=a.size;return a.set(r,n),this.size+=a.size==o?0:1,this}return Jx=t,Jx}var Zx,DC;function dj(){if(DC)return Zx;DC=1;var e=R7(),t=F7(),r=$7(),n=B7(),a=U7();function o(s){var l=-1,c=s==null?0:s.length;for(this.clear();++l<c;){var u=s[l];this.set(u[0],u[1])}}return o.prototype.clear=e,o.prototype.delete=t,o.prototype.get=r,o.prototype.has=n,o.prototype.set=a,Zx=o,Zx}var eb,MC;function _N(){if(MC)return eb;MC=1;var e=dj(),t="Expected a function";function r(n,a){if(typeof n!="function"||a!=null&&typeof a!="function")throw new TypeError(t);var o=function(){var s=arguments,l=a?a.apply(this,s):s[0],c=o.cache;if(c.has(l))return c.get(l);var u=n.apply(this,s);return o.cache=c.set(l,u)||c,u};return o.cache=new(r.Cache||e),o}return r.Cache=e,eb=r,eb}var tb,LC;function z7(){if(LC)return tb;LC=1;var e=_N(),t=500;function r(n){var a=e(n,function(s){return o.size===t&&o.clear(),s}),o=a.cache;return a}return tb=r,tb}var rb,RC;function W7(){if(RC)return rb;RC=1;var e=z7(),t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,n=e(function(a){var o=[];return a.charCodeAt(0)===46&&o.push(""),a.replace(t,function(s,l,c,u){o.push(c?u.replace(r,"$1"):l||s)}),o});return rb=n,rb}var nb,qC;function fj(){if(qC)return nb;qC=1;function e(t,r){for(var n=-1,a=t==null?0:t.length,o=Array(a);++n<a;)o[n]=r(t[n],n,t);return o}return nb=e,nb}var ab,FC;function H7(){if(FC)return ab;FC=1;var e=Dp(),t=fj(),r=Zi(),n=Ld(),a=e?e.prototype:void 0,o=a?a.toString:void 0;function s(l){if(typeof l=="string")return l;if(r(l))return t(l,s)+"";if(n(l))return o?o.call(l):"";var c=l+"";return c=="0"&&1/l==-1/0?"-0":c}return ab=s,ab}var ib,$C;function wN(){if($C)return ib;$C=1;var e=H7();function t(r){return r==null?"":e(r)}return ib=t,ib}var ob,BC;function jN(){if(BC)return ob;BC=1;var e=Zi(),t=sj(),r=W7(),n=wN();function a(o,s){return e(o)?o:t(o,s)?[o]:r(n(o))}return ob=a,ob}var sb,UC;function Hv(){if(UC)return sb;UC=1;var e=Ld();function t(r){if(typeof r=="string"||e(r))return r;var n=r+"";return n=="0"&&1/r==-1/0?"-0":n}return sb=t,sb}var lb,zC;function hj(){if(zC)return lb;zC=1;var e=jN(),t=Hv();function r(n,a){a=e(a,n);for(var o=0,s=a.length;n!=null&&o<s;)n=n[t(a[o++])];return o&&o==s?n:void 0}return lb=r,lb}var cb,WC;function SN(){if(WC)return cb;WC=1;var e=hj();function t(r,n,a){var o=r==null?void 0:e(r,n);return o===void 0?a:o}return cb=t,cb}var V7=SN();const Co=Et(V7);var ub,HC;function G7(){if(HC)return ub;HC=1;function e(t){return t==null}return ub=e,ub}var Y7=G7();const $r=Et(Y7);var db,VC;function K7(){if(VC)return db;VC=1;var e=_l(),t=Zi(),r=wl(),n="[object String]";function a(o){return typeof o=="string"||!t(o)&&r(o)&&e(o)==n}return db=a,db}var Q7=K7();const Gc=Et(Q7);var X7=lj();const Nr=Et(X7);var J7=sc();const Rd=Et(J7);var fb={exports:{}},xn={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GC;function Z7(){if(GC)return xn;GC=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),s=Symbol.for("react.context"),l=Symbol.for("react.server_context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.for("react.offscreen"),v;v=Symbol.for("react.module.reference");function m(y){if(typeof y=="object"&&y!==null){var b=y.$$typeof;switch(b){case e:switch(y=y.type,y){case r:case a:case n:case u:case d:return y;default:switch(y=y&&y.$$typeof,y){case l:case s:case c:case h:case f:case o:return y;default:return b}}case t:return b}}}return xn.ContextConsumer=s,xn.ContextProvider=o,xn.Element=e,xn.ForwardRef=c,xn.Fragment=r,xn.Lazy=h,xn.Memo=f,xn.Portal=t,xn.Profiler=a,xn.StrictMode=n,xn.Suspense=u,xn.SuspenseList=d,xn.isAsyncMode=function(){return!1},xn.isConcurrentMode=function(){return!1},xn.isContextConsumer=function(y){return m(y)===s},xn.isContextProvider=function(y){return m(y)===o},xn.isElement=function(y){return typeof y=="object"&&y!==null&&y.$$typeof===e},xn.isForwardRef=function(y){return m(y)===c},xn.isFragment=function(y){return m(y)===r},xn.isLazy=function(y){return m(y)===h},xn.isMemo=function(y){return m(y)===f},xn.isPortal=function(y){return m(y)===t},xn.isProfiler=function(y){return m(y)===a},xn.isStrictMode=function(y){return m(y)===n},xn.isSuspense=function(y){return m(y)===u},xn.isSuspenseList=function(y){return m(y)===d},xn.isValidElementType=function(y){return typeof y=="string"||typeof y=="function"||y===r||y===a||y===n||y===u||y===d||y===p||typeof y=="object"&&y!==null&&(y.$$typeof===h||y.$$typeof===f||y.$$typeof===o||y.$$typeof===s||y.$$typeof===c||y.$$typeof===v||y.getModuleId!==void 0)},xn.typeOf=m,xn}var YC;function eB(){return YC||(YC=1,fb.exports=Z7()),fb.exports}var tB=eB(),hb,KC;function CN(){if(KC)return hb;KC=1;var e=_l(),t=wl(),r="[object Number]";function n(a){return typeof a=="number"||t(a)&&e(a)==r}return hb=n,hb}var pb,QC;function rB(){if(QC)return pb;QC=1;var e=CN();function t(r){return e(r)&&r!=+r}return pb=t,pb}var nB=rB();const Mp=Et(nB);var aB=CN();const iB=Et(aB);var Mi=function(t){return t===0?0:t>0?1:-1},Mc=function(t){return Gc(t)&&t.indexOf("%")===t.length-1},Mt=function(t){return iB(t)&&!Mp(t)},Ha=function(t){return Mt(t)||Gc(t)},oB=0,qd=function(t){var r=++oB;return"".concat(t||"").concat(r)},Li=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!Mt(t)&&!Gc(t))return n;var o;if(Mc(t)){var s=t.indexOf("%");o=r*parseFloat(t.slice(0,s))/100}else o=+t;return Mp(o)&&(o=n),a&&o>r&&(o=r),o},Gl=function(t){if(!t)return null;var r=Object.keys(t);return r&&r.length?t[r[0]]:null},sB=function(t){if(!Array.isArray(t))return!1;for(var r=t.length,n={},a=0;a<r;a++)if(!n[t[a]])n[t[a]]=!0;else return!0;return!1},_o=function(t,r){return Mt(t)&&Mt(r)?function(n){return t+n*(r-t)}:function(){return r}};function mg(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):Co(n,t))===r})}var lB=function(t,r){return Mt(t)&&Mt(r)?t-r:Gc(t)&&Gc(r)?t.localeCompare(r):t instanceof Date&&r instanceof Date?t.getTime()-r.getTime():String(t).localeCompare(String(r))};function Hu(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function Q2(e){"@babel/helpers - typeof";return Q2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Q2(e)}var cB=["viewBox","children"],uB=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],XC=["points","pathLength"],mb={svg:cB,polygon:XC,polyline:XC},pj=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],gg=function(t,r){if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(x.isValidElement(t)&&(n=t.props),!Rd(n))return null;var a={};return Object.keys(n).forEach(function(o){pj.includes(o)&&(a[o]=r||function(s){return n[o](n,s)})}),a},dB=function(t,r,n){return function(a){return t(r,n,a),null}},Yc=function(t,r,n){if(!Rd(t)||Q2(t)!=="object")return null;var a=null;return Object.keys(t).forEach(function(o){var s=t[o];pj.includes(o)&&typeof s=="function"&&(a||(a={}),a[o]=dB(s,r,n))}),a},fB=["children"],hB=["children"];function JC(e,t){if(e==null)return{};var r=pB(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function pB(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function X2(e){"@babel/helpers - typeof";return X2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X2(e)}var ZC={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},ul=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},eA=null,gb=null,mj=function e(t){if(t===eA&&Array.isArray(gb))return gb;var r=[];return x.Children.forEach(t,function(n){$r(n)||(tB.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),gb=r,eA=t,r};function Ao(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(a){return ul(a)}):n=[ul(t)],mj(e).forEach(function(a){var o=Co(a,"type.displayName")||Co(a,"type.name");n.indexOf(o)!==-1&&r.push(a)}),r}function yo(e,t){var r=Ao(e,t);return r&&r[0]}var tA=function(t){if(!t||!t.props)return!1;var r=t.props,n=r.width,a=r.height;return!(!Mt(n)||n<=0||!Mt(a)||a<=0)},mB=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],gB=function(t){return t&&t.type&&Gc(t.type)&&mB.indexOf(t.type)>=0},vB=function(t){return t&&X2(t)==="object"&&"clipDot"in t},yB=function(t,r,n,a){var o,s=(o=mb?.[a])!==null&&o!==void 0?o:[];return r.startsWith("data-")||!Nr(t)&&(a&&s.includes(r)||uB.includes(r))||n&&pj.includes(r)},yr=function(t,r,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var a=t;if(x.isValidElement(t)&&(a=t.props),!Rd(a))return null;var o={};return Object.keys(a).forEach(function(s){var l;yB((l=a)===null||l===void 0?void 0:l[s],s,r,n)&&(o[s]=a[s])}),o},J2=function e(t,r){if(t===r)return!0;var n=x.Children.count(t);if(n!==x.Children.count(r))return!1;if(n===0)return!0;if(n===1)return rA(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var a=0;a<n;a++){var o=t[a],s=r[a];if(Array.isArray(o)||Array.isArray(s)){if(!e(o,s))return!1}else if(!rA(o,s))return!1}return!0},rA=function(t,r){if($r(t)&&$r(r))return!0;if(!$r(t)&&!$r(r)){var n=t.props||{},a=n.children,o=JC(n,fB),s=r.props||{},l=s.children,c=JC(s,hB);return a&&l?Hu(o,c)&&J2(a,l):!a&&!l?Hu(o,c):!1}return!1},nA=function(t,r){var n=[],a={};return mj(t).forEach(function(o,s){if(gB(o))n.push(o);else if(o){var l=ul(o.type),c=r[l]||{},u=c.handler,d=c.once;if(u&&(!d||!a[l])){var f=u(o,l,s);n.push(f),a[l]=!0}}}),n},xB=function(t){var r=t&&t.type;return r&&ZC[r]?ZC[r]:null},bB=function(t,r){return mj(r).indexOf(t)},_B=["children","width","height","viewBox","className","style","title","desc"];function Z2(){return Z2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Z2.apply(this,arguments)}function wB(e,t){if(e==null)return{};var r=jB(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function jB(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function e_(e){var t=e.children,r=e.width,n=e.height,a=e.viewBox,o=e.className,s=e.style,l=e.title,c=e.desc,u=wB(e,_B),d=a||{width:r,height:n,x:0,y:0},f=Tr("recharts-surface",o);return Ce.createElement("svg",Z2({},yr(u,!0,"svg"),{className:f,width:r,height:n,style:s,viewBox:"".concat(d.x," ").concat(d.y," ").concat(d.width," ").concat(d.height)}),Ce.createElement("title",null,l),Ce.createElement("desc",null,c),t)}var SB=["children","className"];function t_(){return t_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},t_.apply(this,arguments)}function CB(e,t){if(e==null)return{};var r=AB(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function AB(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var un=Ce.forwardRef(function(e,t){var r=e.children,n=e.className,a=CB(e,SB),o=Tr("recharts-layer",n);return Ce.createElement("g",t_({className:o},yr(a,!0),{ref:t}),r)}),is=function(t,r){for(var n=arguments.length,a=new Array(n>2?n-2:0),o=2;o<n;o++)a[o-2]=arguments[o]},vb,aA;function PB(){if(aA)return vb;aA=1;function e(t,r,n){var a=-1,o=t.length;r<0&&(r=-r>o?0:o+r),n=n>o?o:n,n<0&&(n+=o),o=r>n?0:n-r>>>0,r>>>=0;for(var s=Array(o);++a<o;)s[a]=t[a+r];return s}return vb=e,vb}var yb,iA;function OB(){if(iA)return yb;iA=1;var e=PB();function t(r,n,a){var o=r.length;return a=a===void 0?o:a,!n&&a>=o?r:e(r,n,a)}return yb=t,yb}var xb,oA;function AN(){if(oA)return xb;oA=1;var e="\\ud800-\\udfff",t="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",a=t+r+n,o="\\ufe0e\\ufe0f",s="\\u200d",l=RegExp("["+s+e+a+o+"]");function c(u){return l.test(u)}return xb=c,xb}var bb,sA;function kB(){if(sA)return bb;sA=1;function e(t){return t.split("")}return bb=e,bb}var _b,lA;function TB(){if(lA)return _b;lA=1;var e="\\ud800-\\udfff",t="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",a=t+r+n,o="\\ufe0e\\ufe0f",s="["+e+"]",l="["+a+"]",c="\\ud83c[\\udffb-\\udfff]",u="(?:"+l+"|"+c+")",d="[^"+e+"]",f="(?:\\ud83c[\\udde6-\\uddff]){2}",h="[\\ud800-\\udbff][\\udc00-\\udfff]",p="\\u200d",v=u+"?",m="["+o+"]?",y="(?:"+p+"(?:"+[d,f,h].join("|")+")"+m+v+")*",b=m+v+y,_="(?:"+[d+l+"?",l,f,h,s].join("|")+")",w=RegExp(c+"(?="+c+")|"+_+b,"g");function A(P){return P.match(w)||[]}return _b=A,_b}var wb,cA;function EB(){if(cA)return wb;cA=1;var e=kB(),t=AN(),r=TB();function n(a){return t(a)?r(a):e(a)}return wb=n,wb}var jb,uA;function IB(){if(uA)return jb;uA=1;var e=OB(),t=AN(),r=EB(),n=wN();function a(o){return function(s){s=n(s);var l=t(s)?r(s):void 0,c=l?l[0]:s.charAt(0),u=l?e(l,1).join(""):s.slice(1);return c[o]()+u}}return jb=a,jb}var Sb,dA;function NB(){if(dA)return Sb;dA=1;var e=IB(),t=e("toUpperCase");return Sb=t,Sb}var DB=NB();const Vv=Et(DB);function Rn(e){return function(){return e}}const PN=Math.cos,vg=Math.sin,ls=Math.sqrt,yg=Math.PI,Gv=2*yg,r_=Math.PI,n_=2*r_,Pc=1e-6,MB=n_-Pc;function ON(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function LB(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return ON;const r=10**t;return function(n){this._+=n[0];for(let a=1,o=n.length;a<o;++a)this._+=Math.round(arguments[a]*r)/r+n[a]}}class RB{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?ON:LB(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,a){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+a}`}bezierCurveTo(t,r,n,a,o,s){this._append`C${+t},${+r},${+n},${+a},${this._x1=+o},${this._y1=+s}`}arcTo(t,r,n,a,o){if(t=+t,r=+r,n=+n,a=+a,o=+o,o<0)throw new Error(`negative radius: ${o}`);let s=this._x1,l=this._y1,c=n-t,u=a-r,d=s-t,f=l-r,h=d*d+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(h>Pc)if(!(Math.abs(f*c-u*d)>Pc)||!o)this._append`L${this._x1=t},${this._y1=r}`;else{let p=n-s,v=a-l,m=c*c+u*u,y=p*p+v*v,b=Math.sqrt(m),_=Math.sqrt(h),w=o*Math.tan((r_-Math.acos((m+h-y)/(2*b*_)))/2),A=w/_,P=w/b;Math.abs(A-1)>Pc&&this._append`L${t+A*d},${r+A*f}`,this._append`A${o},${o},0,0,${+(f*p>d*v)},${this._x1=t+P*c},${this._y1=r+P*u}`}}arc(t,r,n,a,o,s){if(t=+t,r=+r,n=+n,s=!!s,n<0)throw new Error(`negative radius: ${n}`);let l=n*Math.cos(a),c=n*Math.sin(a),u=t+l,d=r+c,f=1^s,h=s?a-o:o-a;this._x1===null?this._append`M${u},${d}`:(Math.abs(this._x1-u)>Pc||Math.abs(this._y1-d)>Pc)&&this._append`L${u},${d}`,n&&(h<0&&(h=h%n_+n_),h>MB?this._append`A${n},${n},0,1,${f},${t-l},${r-c}A${n},${n},0,1,${f},${this._x1=u},${this._y1=d}`:h>Pc&&this._append`A${n},${n},0,${+(h>=r_)},${f},${this._x1=t+n*Math.cos(o)},${this._y1=r+n*Math.sin(o)}`)}rect(t,r,n,a){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+a}h${-n}Z`}toString(){return this._}}function gj(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new RB(t)}function vj(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function kN(e){this._context=e}kN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Yv(e){return new kN(e)}function TN(e){return e[0]}function EN(e){return e[1]}function IN(e,t){var r=Rn(!0),n=null,a=Yv,o=null,s=gj(l);e=typeof e=="function"?e:e===void 0?TN:Rn(e),t=typeof t=="function"?t:t===void 0?EN:Rn(t);function l(c){var u,d=(c=vj(c)).length,f,h=!1,p;for(n==null&&(o=a(p=s())),u=0;u<=d;++u)!(u<d&&r(f=c[u],u,c))===h&&((h=!h)?o.lineStart():o.lineEnd()),h&&o.point(+e(f,u,c),+t(f,u,c));if(p)return o=null,p+""||null}return l.x=function(c){return arguments.length?(e=typeof c=="function"?c:Rn(+c),l):e},l.y=function(c){return arguments.length?(t=typeof c=="function"?c:Rn(+c),l):t},l.defined=function(c){return arguments.length?(r=typeof c=="function"?c:Rn(!!c),l):r},l.curve=function(c){return arguments.length?(a=c,n!=null&&(o=a(n)),l):a},l.context=function(c){return arguments.length?(c==null?n=o=null:o=a(n=c),l):n},l}function gm(e,t,r){var n=null,a=Rn(!0),o=null,s=Yv,l=null,c=gj(u);e=typeof e=="function"?e:e===void 0?TN:Rn(+e),t=typeof t=="function"?t:Rn(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?EN:Rn(+r);function u(f){var h,p,v,m=(f=vj(f)).length,y,b=!1,_,w=new Array(m),A=new Array(m);for(o==null&&(l=s(_=c())),h=0;h<=m;++h){if(!(h<m&&a(y=f[h],h,f))===b)if(b=!b)p=h,l.areaStart(),l.lineStart();else{for(l.lineEnd(),l.lineStart(),v=h-1;v>=p;--v)l.point(w[v],A[v]);l.lineEnd(),l.areaEnd()}b&&(w[h]=+e(y,h,f),A[h]=+t(y,h,f),l.point(n?+n(y,h,f):w[h],r?+r(y,h,f):A[h]))}if(_)return l=null,_+""||null}function d(){return IN().defined(a).curve(s).context(o)}return u.x=function(f){return arguments.length?(e=typeof f=="function"?f:Rn(+f),n=null,u):e},u.x0=function(f){return arguments.length?(e=typeof f=="function"?f:Rn(+f),u):e},u.x1=function(f){return arguments.length?(n=f==null?null:typeof f=="function"?f:Rn(+f),u):n},u.y=function(f){return arguments.length?(t=typeof f=="function"?f:Rn(+f),r=null,u):t},u.y0=function(f){return arguments.length?(t=typeof f=="function"?f:Rn(+f),u):t},u.y1=function(f){return arguments.length?(r=f==null?null:typeof f=="function"?f:Rn(+f),u):r},u.lineX0=u.lineY0=function(){return d().x(e).y(t)},u.lineY1=function(){return d().x(e).y(r)},u.lineX1=function(){return d().x(n).y(t)},u.defined=function(f){return arguments.length?(a=typeof f=="function"?f:Rn(!!f),u):a},u.curve=function(f){return arguments.length?(s=f,o!=null&&(l=s(o)),u):s},u.context=function(f){return arguments.length?(f==null?o=l=null:l=s(o=f),u):o},u}class NN{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function qB(e){return new NN(e,!0)}function FB(e){return new NN(e,!1)}const yj={draw(e,t){const r=ls(t/yg);e.moveTo(r,0),e.arc(0,0,r,0,Gv)}},$B={draw(e,t){const r=ls(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},DN=ls(1/3),BB=DN*2,UB={draw(e,t){const r=ls(t/BB),n=r*DN;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},zB={draw(e,t){const r=ls(t),n=-r/2;e.rect(n,n,r,r)}},WB=.8908130915292852,MN=vg(yg/10)/vg(7*yg/10),HB=vg(Gv/10)*MN,VB=-PN(Gv/10)*MN,GB={draw(e,t){const r=ls(t*WB),n=HB*r,a=VB*r;e.moveTo(0,-r),e.lineTo(n,a);for(let o=1;o<5;++o){const s=Gv*o/5,l=PN(s),c=vg(s);e.lineTo(c*r,-l*r),e.lineTo(l*n-c*a,c*n+l*a)}e.closePath()}},Cb=ls(3),YB={draw(e,t){const r=-ls(t/(Cb*3));e.moveTo(0,r*2),e.lineTo(-Cb*r,-r),e.lineTo(Cb*r,-r),e.closePath()}},$o=-.5,Bo=ls(3)/2,a_=1/ls(12),KB=(a_/2+1)*3,QB={draw(e,t){const r=ls(t/KB),n=r/2,a=r*a_,o=n,s=r*a_+r,l=-o,c=s;e.moveTo(n,a),e.lineTo(o,s),e.lineTo(l,c),e.lineTo($o*n-Bo*a,Bo*n+$o*a),e.lineTo($o*o-Bo*s,Bo*o+$o*s),e.lineTo($o*l-Bo*c,Bo*l+$o*c),e.lineTo($o*n+Bo*a,$o*a-Bo*n),e.lineTo($o*o+Bo*s,$o*s-Bo*o),e.lineTo($o*l+Bo*c,$o*c-Bo*l),e.closePath()}};function XB(e,t){let r=null,n=gj(a);e=typeof e=="function"?e:Rn(e||yj),t=typeof t=="function"?t:Rn(t===void 0?64:+t);function a(){let o;if(r||(r=o=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),o)return r=null,o+""||null}return a.type=function(o){return arguments.length?(e=typeof o=="function"?o:Rn(o),a):e},a.size=function(o){return arguments.length?(t=typeof o=="function"?o:Rn(+o),a):t},a.context=function(o){return arguments.length?(r=o??null,a):r},a}function xg(){}function bg(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function LN(e){this._context=e}LN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:bg(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:bg(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function JB(e){return new LN(e)}function RN(e){this._context=e}RN.prototype={areaStart:xg,areaEnd:xg,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:bg(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function ZB(e){return new RN(e)}function qN(e){this._context=e}qN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:bg(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function eU(e){return new qN(e)}function FN(e){this._context=e}FN.prototype={areaStart:xg,areaEnd:xg,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function tU(e){return new FN(e)}function fA(e){return e<0?-1:1}function hA(e,t,r){var n=e._x1-e._x0,a=t-e._x1,o=(e._y1-e._y0)/(n||a<0&&-0),s=(r-e._y1)/(a||n<0&&-0),l=(o*a+s*n)/(n+a);return(fA(o)+fA(s))*Math.min(Math.abs(o),Math.abs(s),.5*Math.abs(l))||0}function pA(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function Ab(e,t,r){var n=e._x0,a=e._y0,o=e._x1,s=e._y1,l=(o-n)/3;e._context.bezierCurveTo(n+l,a+l*t,o-l,s-l*r,o,s)}function _g(e){this._context=e}_g.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Ab(this,this._t0,pA(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Ab(this,pA(this,r=hA(this,e,t)),r);break;default:Ab(this,this._t0,r=hA(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function $N(e){this._context=new BN(e)}($N.prototype=Object.create(_g.prototype)).point=function(e,t){_g.prototype.point.call(this,t,e)};function BN(e){this._context=e}BN.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,a,o){this._context.bezierCurveTo(t,e,n,r,o,a)}};function rU(e){return new _g(e)}function nU(e){return new $N(e)}function UN(e){this._context=e}UN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=mA(e),a=mA(t),o=0,s=1;s<r;++o,++s)this._context.bezierCurveTo(n[0][o],a[0][o],n[1][o],a[1][o],e[s],t[s]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function mA(e){var t,r=e.length-1,n,a=new Array(r),o=new Array(r),s=new Array(r);for(a[0]=0,o[0]=2,s[0]=e[0]+2*e[1],t=1;t<r-1;++t)a[t]=1,o[t]=4,s[t]=4*e[t]+2*e[t+1];for(a[r-1]=2,o[r-1]=7,s[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=a[t]/o[t-1],o[t]-=n,s[t]-=n*s[t-1];for(a[r-1]=s[r-1]/o[r-1],t=r-2;t>=0;--t)a[t]=(s[t]-a[t+1])/o[t];for(o[r-1]=(e[r]+a[r-1])/2,t=0;t<r-1;++t)o[t]=2*e[t+1]-a[t+1];return[a,o]}function aU(e){return new UN(e)}function Kv(e,t){this._context=e,this._t=t}Kv.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function iU(e){return new Kv(e,.5)}function oU(e){return new Kv(e,0)}function sU(e){return new Kv(e,1)}function ed(e,t){if((s=e.length)>1)for(var r=1,n,a,o=e[t[0]],s,l=o.length;r<s;++r)for(a=o,o=e[t[r]],n=0;n<l;++n)o[n][1]+=o[n][0]=isNaN(a[n][1])?a[n][0]:a[n][1]}function i_(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function lU(e,t){return e[t]}function cU(e){const t=[];return t.key=e,t}function uU(){var e=Rn([]),t=i_,r=ed,n=lU;function a(o){var s=Array.from(e.apply(this,arguments),cU),l,c=s.length,u=-1,d;for(const f of o)for(l=0,++u;l<c;++l)(s[l][u]=[0,+n(f,s[l].key,u,o)]).data=f;for(l=0,d=vj(t(s));l<c;++l)s[d[l]].index=l;return r(s,d),s}return a.keys=function(o){return arguments.length?(e=typeof o=="function"?o:Rn(Array.from(o)),a):e},a.value=function(o){return arguments.length?(n=typeof o=="function"?o:Rn(+o),a):n},a.order=function(o){return arguments.length?(t=o==null?i_:typeof o=="function"?o:Rn(Array.from(o)),a):t},a.offset=function(o){return arguments.length?(r=o??ed,a):r},a}function dU(e,t){if((n=e.length)>0){for(var r,n,a=0,o=e[0].length,s;a<o;++a){for(s=r=0;r<n;++r)s+=e[r][a][1]||0;if(s)for(r=0;r<n;++r)e[r][a][1]/=s}ed(e,t)}}function fU(e,t){if((a=e.length)>0){for(var r=0,n=e[t[0]],a,o=n.length;r<o;++r){for(var s=0,l=0;s<a;++s)l+=e[s][r][1]||0;n[r][1]+=n[r][0]=-l/2}ed(e,t)}}function hU(e,t){if(!(!((s=e.length)>0)||!((o=(a=e[t[0]]).length)>0))){for(var r=0,n=1,a,o,s;n<o;++n){for(var l=0,c=0,u=0;l<s;++l){for(var d=e[t[l]],f=d[n][1]||0,h=d[n-1][1]||0,p=(f-h)/2,v=0;v<l;++v){var m=e[t[v]],y=m[n][1]||0,b=m[n-1][1]||0;p+=y-b}c+=f,u+=p*f}a[n-1][1]+=a[n-1][0]=r,c&&(r-=u/c)}a[n-1][1]+=a[n-1][0]=r,ed(e,t)}}function Wh(e){"@babel/helpers - typeof";return Wh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wh(e)}var pU=["type","size","sizeType"];function o_(){return o_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o_.apply(this,arguments)}function gA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function vA(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gA(Object(r),!0).forEach(function(n){mU(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gA(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function mU(e,t,r){return t=gU(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gU(e){var t=vU(e,"string");return Wh(t)=="symbol"?t:t+""}function vU(e,t){if(Wh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Wh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function yU(e,t){if(e==null)return{};var r=xU(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function xU(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var zN={symbolCircle:yj,symbolCross:$B,symbolDiamond:UB,symbolSquare:zB,symbolStar:GB,symbolTriangle:YB,symbolWye:QB},bU=Math.PI/180,_U=function(t){var r="symbol".concat(Vv(t));return zN[r]||yj},wU=function(t,r,n){if(r==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var a=18*bU;return 1.25*t*t*(Math.tan(a)-Math.tan(a*2)*Math.pow(Math.tan(a),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},jU=function(t,r){zN["symbol".concat(Vv(t))]=r},xj=function(t){var r=t.type,n=r===void 0?"circle":r,a=t.size,o=a===void 0?64:a,s=t.sizeType,l=s===void 0?"area":s,c=yU(t,pU),u=vA(vA({},c),{},{type:n,size:o,sizeType:l}),d=function(){var y=_U(n),b=XB().type(y).size(wU(o,l,n));return b()},f=u.className,h=u.cx,p=u.cy,v=yr(u,!0);return h===+h&&p===+p&&o===+o?Ce.createElement("path",o_({},v,{className:Tr("recharts-symbols",f),transform:"translate(".concat(h,", ").concat(p,")"),d:d()})):null};xj.registerSymbol=jU;function td(e){"@babel/helpers - typeof";return td=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},td(e)}function s_(){return s_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s_.apply(this,arguments)}function yA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function SU(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yA(Object(r),!0).forEach(function(n){Hh(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yA(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function CU(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function AU(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,HN(n.key),n)}}function PU(e,t,r){return t&&AU(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function OU(e,t,r){return t=wg(t),kU(e,WN()?Reflect.construct(t,r||[],wg(e).constructor):t.apply(e,r))}function kU(e,t){if(t&&(td(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return TU(e)}function TU(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function WN(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(WN=function(){return!!e})()}function wg(e){return wg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},wg(e)}function EU(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l_(e,t)}function l_(e,t){return l_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},l_(e,t)}function Hh(e,t,r){return t=HN(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function HN(e){var t=IU(e,"string");return td(t)=="symbol"?t:t+""}function IU(e,t){if(td(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(td(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Uo=32,bj=function(e){function t(){return CU(this,t),OU(this,t,arguments)}return EU(t,e),PU(t,[{key:"renderIcon",value:function(n){var a=this.props.inactiveColor,o=Uo/2,s=Uo/6,l=Uo/3,c=n.inactive?a:n.color;if(n.type==="plainline")return Ce.createElement("line",{strokeWidth:4,fill:"none",stroke:c,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:o,x2:Uo,y2:o,className:"recharts-legend-icon"});if(n.type==="line")return Ce.createElement("path",{strokeWidth:4,fill:"none",stroke:c,d:"M0,".concat(o,"h").concat(l,`
            A`).concat(s,",").concat(s,",0,1,1,").concat(2*l,",").concat(o,`
            H`).concat(Uo,"M").concat(2*l,",").concat(o,`
            A`).concat(s,",").concat(s,",0,1,1,").concat(l,",").concat(o),className:"recharts-legend-icon"});if(n.type==="rect")return Ce.createElement("path",{stroke:"none",fill:c,d:"M0,".concat(Uo/8,"h").concat(Uo,"v").concat(Uo*3/4,"h").concat(-Uo,"z"),className:"recharts-legend-icon"});if(Ce.isValidElement(n.legendIcon)){var u=SU({},n);return delete u.legendIcon,Ce.cloneElement(n.legendIcon,u)}return Ce.createElement(xj,{fill:c,cx:o,cy:o,size:Uo,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,a=this.props,o=a.payload,s=a.iconSize,l=a.layout,c=a.formatter,u=a.inactiveColor,d={x:0,y:0,width:Uo,height:Uo},f={display:l==="horizontal"?"inline-block":"block",marginRight:10},h={display:"inline-block",verticalAlign:"middle",marginRight:4};return o.map(function(p,v){var m=p.formatter||c,y=Tr(Hh(Hh({"recharts-legend-item":!0},"legend-item-".concat(v),!0),"inactive",p.inactive));if(p.type==="none")return null;var b=Nr(p.value)?null:p.value;is(!Nr(p.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var _=p.inactive?u:p.color;return Ce.createElement("li",s_({className:y,style:f,key:"legend-item-".concat(v)},Yc(n.props,p,v)),Ce.createElement(e_,{width:s,height:s,viewBox:d,style:h},n.renderIcon(p)),Ce.createElement("span",{className:"recharts-legend-item-text",style:{color:_}},m?m(b,p,v):b))})}},{key:"render",value:function(){var n=this.props,a=n.payload,o=n.layout,s=n.align;if(!a||!a.length)return null;var l={padding:0,margin:0,textAlign:o==="horizontal"?s:"left"};return Ce.createElement("ul",{className:"recharts-default-legend",style:l},this.renderItems())}}])}(x.PureComponent);Hh(bj,"displayName","Legend");Hh(bj,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var Pb,xA;function NU(){if(xA)return Pb;xA=1;var e=zv();function t(){this.__data__=new e,this.size=0}return Pb=t,Pb}var Ob,bA;function DU(){if(bA)return Ob;bA=1;function e(t){var r=this.__data__,n=r.delete(t);return this.size=r.size,n}return Ob=e,Ob}var kb,_A;function MU(){if(_A)return kb;_A=1;function e(t){return this.__data__.get(t)}return kb=e,kb}var Tb,wA;function LU(){if(wA)return Tb;wA=1;function e(t){return this.__data__.has(t)}return Tb=e,Tb}var Eb,jA;function RU(){if(jA)return Eb;jA=1;var e=zv(),t=uj(),r=dj(),n=200;function a(o,s){var l=this.__data__;if(l instanceof e){var c=l.__data__;if(!t||c.length<n-1)return c.push([o,s]),this.size=++l.size,this;l=this.__data__=new r(c)}return l.set(o,s),this.size=l.size,this}return Eb=a,Eb}var Ib,SA;function VN(){if(SA)return Ib;SA=1;var e=zv(),t=NU(),r=DU(),n=MU(),a=LU(),o=RU();function s(l){var c=this.__data__=new e(l);this.size=c.size}return s.prototype.clear=t,s.prototype.delete=r,s.prototype.get=n,s.prototype.has=a,s.prototype.set=o,Ib=s,Ib}var Nb,CA;function qU(){if(CA)return Nb;CA=1;var e="__lodash_hash_undefined__";function t(r){return this.__data__.set(r,e),this}return Nb=t,Nb}var Db,AA;function FU(){if(AA)return Db;AA=1;function e(t){return this.__data__.has(t)}return Db=e,Db}var Mb,PA;function GN(){if(PA)return Mb;PA=1;var e=dj(),t=qU(),r=FU();function n(a){var o=-1,s=a==null?0:a.length;for(this.__data__=new e;++o<s;)this.add(a[o])}return n.prototype.add=n.prototype.push=t,n.prototype.has=r,Mb=n,Mb}var Lb,OA;function YN(){if(OA)return Lb;OA=1;function e(t,r){for(var n=-1,a=t==null?0:t.length;++n<a;)if(r(t[n],n,t))return!0;return!1}return Lb=e,Lb}var Rb,kA;function KN(){if(kA)return Rb;kA=1;function e(t,r){return t.has(r)}return Rb=e,Rb}var qb,TA;function QN(){if(TA)return qb;TA=1;var e=GN(),t=YN(),r=KN(),n=1,a=2;function o(s,l,c,u,d,f){var h=c&n,p=s.length,v=l.length;if(p!=v&&!(h&&v>p))return!1;var m=f.get(s),y=f.get(l);if(m&&y)return m==l&&y==s;var b=-1,_=!0,w=c&a?new e:void 0;for(f.set(s,l),f.set(l,s);++b<p;){var A=s[b],P=l[b];if(u)var T=h?u(P,A,b,l,s,f):u(A,P,b,s,l,f);if(T!==void 0){if(T)continue;_=!1;break}if(w){if(!t(l,function(E,S){if(!r(w,S)&&(A===E||d(A,E,c,u,f)))return w.push(S)})){_=!1;break}}else if(!(A===P||d(A,P,c,u,f))){_=!1;break}}return f.delete(s),f.delete(l),_}return qb=o,qb}var Fb,EA;function $U(){if(EA)return Fb;EA=1;var e=Ls(),t=e.Uint8Array;return Fb=t,Fb}var $b,IA;function BU(){if(IA)return $b;IA=1;function e(t){var r=-1,n=Array(t.size);return t.forEach(function(a,o){n[++r]=[o,a]}),n}return $b=e,$b}var Bb,NA;function _j(){if(NA)return Bb;NA=1;function e(t){var r=-1,n=Array(t.size);return t.forEach(function(a){n[++r]=a}),n}return Bb=e,Bb}var Ub,DA;function UU(){if(DA)return Ub;DA=1;var e=Dp(),t=$U(),r=cj(),n=QN(),a=BU(),o=_j(),s=1,l=2,c="[object Boolean]",u="[object Date]",d="[object Error]",f="[object Map]",h="[object Number]",p="[object RegExp]",v="[object Set]",m="[object String]",y="[object Symbol]",b="[object ArrayBuffer]",_="[object DataView]",w=e?e.prototype:void 0,A=w?w.valueOf:void 0;function P(T,E,S,I,W,O,D){switch(S){case _:if(T.byteLength!=E.byteLength||T.byteOffset!=E.byteOffset)return!1;T=T.buffer,E=E.buffer;case b:return!(T.byteLength!=E.byteLength||!O(new t(T),new t(E)));case c:case u:case h:return r(+T,+E);case d:return T.name==E.name&&T.message==E.message;case p:case m:return T==E+"";case f:var R=a;case v:var F=I&s;if(R||(R=o),T.size!=E.size&&!F)return!1;var z=D.get(T);if(z)return z==E;I|=l,D.set(T,E);var K=n(R(T),R(E),I,W,O,D);return D.delete(T),K;case y:if(A)return A.call(T)==A.call(E)}return!1}return Ub=P,Ub}var zb,MA;function XN(){if(MA)return zb;MA=1;function e(t,r){for(var n=-1,a=r.length,o=t.length;++n<a;)t[o+n]=r[n];return t}return zb=e,zb}var Wb,LA;function zU(){if(LA)return Wb;LA=1;var e=XN(),t=Zi();function r(n,a,o){var s=a(n);return t(n)?s:e(s,o(n))}return Wb=r,Wb}var Hb,RA;function WU(){if(RA)return Hb;RA=1;function e(t,r){for(var n=-1,a=t==null?0:t.length,o=0,s=[];++n<a;){var l=t[n];r(l,n,t)&&(s[o++]=l)}return s}return Hb=e,Hb}var Vb,qA;function HU(){if(qA)return Vb;qA=1;function e(){return[]}return Vb=e,Vb}var Gb,FA;function VU(){if(FA)return Gb;FA=1;var e=WU(),t=HU(),r=Object.prototype,n=r.propertyIsEnumerable,a=Object.getOwnPropertySymbols,o=a?function(s){return s==null?[]:(s=Object(s),e(a(s),function(l){return n.call(s,l)}))}:t;return Gb=o,Gb}var Yb,$A;function GU(){if($A)return Yb;$A=1;function e(t,r){for(var n=-1,a=Array(t);++n<t;)a[n]=r(n);return a}return Yb=e,Yb}var Kb,BA;function YU(){if(BA)return Kb;BA=1;var e=_l(),t=wl(),r="[object Arguments]";function n(a){return t(a)&&e(a)==r}return Kb=n,Kb}var Qb,UA;function wj(){if(UA)return Qb;UA=1;var e=YU(),t=wl(),r=Object.prototype,n=r.hasOwnProperty,a=r.propertyIsEnumerable,o=e(function(){return arguments}())?e:function(s){return t(s)&&n.call(s,"callee")&&!a.call(s,"callee")};return Qb=o,Qb}var Ch={exports:{}},Xb,zA;function KU(){if(zA)return Xb;zA=1;function e(){return!1}return Xb=e,Xb}Ch.exports;var WA;function JN(){return WA||(WA=1,function(e,t){var r=Ls(),n=KU(),a=t&&!t.nodeType&&t,o=a&&!0&&e&&!e.nodeType&&e,s=o&&o.exports===a,l=s?r.Buffer:void 0,c=l?l.isBuffer:void 0,u=c||n;e.exports=u}(Ch,Ch.exports)),Ch.exports}var Jb,HA;function jj(){if(HA)return Jb;HA=1;var e=9007199254740991,t=/^(?:0|[1-9]\d*)$/;function r(n,a){var o=typeof n;return a=a??e,!!a&&(o=="number"||o!="symbol"&&t.test(n))&&n>-1&&n%1==0&&n<a}return Jb=r,Jb}var Zb,VA;function Sj(){if(VA)return Zb;VA=1;var e=9007199254740991;function t(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=e}return Zb=t,Zb}var e0,GA;function QU(){if(GA)return e0;GA=1;var e=_l(),t=Sj(),r=wl(),n="[object Arguments]",a="[object Array]",o="[object Boolean]",s="[object Date]",l="[object Error]",c="[object Function]",u="[object Map]",d="[object Number]",f="[object Object]",h="[object RegExp]",p="[object Set]",v="[object String]",m="[object WeakMap]",y="[object ArrayBuffer]",b="[object DataView]",_="[object Float32Array]",w="[object Float64Array]",A="[object Int8Array]",P="[object Int16Array]",T="[object Int32Array]",E="[object Uint8Array]",S="[object Uint8ClampedArray]",I="[object Uint16Array]",W="[object Uint32Array]",O={};O[_]=O[w]=O[A]=O[P]=O[T]=O[E]=O[S]=O[I]=O[W]=!0,O[n]=O[a]=O[y]=O[o]=O[b]=O[s]=O[l]=O[c]=O[u]=O[d]=O[f]=O[h]=O[p]=O[v]=O[m]=!1;function D(R){return r(R)&&t(R.length)&&!!O[e(R)]}return e0=D,e0}var t0,YA;function ZN(){if(YA)return t0;YA=1;function e(t){return function(r){return t(r)}}return t0=e,t0}var Ah={exports:{}};Ah.exports;var KA;function XU(){return KA||(KA=1,function(e,t){var r=xN(),n=t&&!t.nodeType&&t,a=n&&!0&&e&&!e.nodeType&&e,o=a&&a.exports===n,s=o&&r.process,l=function(){try{var c=a&&a.require&&a.require("util").types;return c||s&&s.binding&&s.binding("util")}catch{}}();e.exports=l}(Ah,Ah.exports)),Ah.exports}var r0,QA;function eD(){if(QA)return r0;QA=1;var e=QU(),t=ZN(),r=XU(),n=r&&r.isTypedArray,a=n?t(n):e;return r0=a,r0}var n0,XA;function JU(){if(XA)return n0;XA=1;var e=GU(),t=wj(),r=Zi(),n=JN(),a=jj(),o=eD(),s=Object.prototype,l=s.hasOwnProperty;function c(u,d){var f=r(u),h=!f&&t(u),p=!f&&!h&&n(u),v=!f&&!h&&!p&&o(u),m=f||h||p||v,y=m?e(u.length,String):[],b=y.length;for(var _ in u)(d||l.call(u,_))&&!(m&&(_=="length"||p&&(_=="offset"||_=="parent")||v&&(_=="buffer"||_=="byteLength"||_=="byteOffset")||a(_,b)))&&y.push(_);return y}return n0=c,n0}var a0,JA;function ZU(){if(JA)return a0;JA=1;var e=Object.prototype;function t(r){var n=r&&r.constructor,a=typeof n=="function"&&n.prototype||e;return r===a}return a0=t,a0}var i0,ZA;function tD(){if(ZA)return i0;ZA=1;function e(t,r){return function(n){return t(r(n))}}return i0=e,i0}var o0,eP;function ez(){if(eP)return o0;eP=1;var e=tD(),t=e(Object.keys,Object);return o0=t,o0}var s0,tP;function tz(){if(tP)return s0;tP=1;var e=ZU(),t=ez(),r=Object.prototype,n=r.hasOwnProperty;function a(o){if(!e(o))return t(o);var s=[];for(var l in Object(o))n.call(o,l)&&l!="constructor"&&s.push(l);return s}return s0=a,s0}var l0,rP;function Lp(){if(rP)return l0;rP=1;var e=lj(),t=Sj();function r(n){return n!=null&&t(n.length)&&!e(n)}return l0=r,l0}var c0,nP;function Qv(){if(nP)return c0;nP=1;var e=JU(),t=tz(),r=Lp();function n(a){return r(a)?e(a):t(a)}return c0=n,c0}var u0,aP;function rz(){if(aP)return u0;aP=1;var e=zU(),t=VU(),r=Qv();function n(a){return e(a,r,t)}return u0=n,u0}var d0,iP;function nz(){if(iP)return d0;iP=1;var e=rz(),t=1,r=Object.prototype,n=r.hasOwnProperty;function a(o,s,l,c,u,d){var f=l&t,h=e(o),p=h.length,v=e(s),m=v.length;if(p!=m&&!f)return!1;for(var y=p;y--;){var b=h[y];if(!(f?b in s:n.call(s,b)))return!1}var _=d.get(o),w=d.get(s);if(_&&w)return _==s&&w==o;var A=!0;d.set(o,s),d.set(s,o);for(var P=f;++y<p;){b=h[y];var T=o[b],E=s[b];if(c)var S=f?c(E,T,b,s,o,d):c(T,E,b,o,s,d);if(!(S===void 0?T===E||u(T,E,l,c,d):S)){A=!1;break}P||(P=b=="constructor")}if(A&&!P){var I=o.constructor,W=s.constructor;I!=W&&"constructor"in o&&"constructor"in s&&!(typeof I=="function"&&I instanceof I&&typeof W=="function"&&W instanceof W)&&(A=!1)}return d.delete(o),d.delete(s),A}return d0=a,d0}var f0,oP;function az(){if(oP)return f0;oP=1;var e=au(),t=Ls(),r=e(t,"DataView");return f0=r,f0}var h0,sP;function iz(){if(sP)return h0;sP=1;var e=au(),t=Ls(),r=e(t,"Promise");return h0=r,h0}var p0,lP;function rD(){if(lP)return p0;lP=1;var e=au(),t=Ls(),r=e(t,"Set");return p0=r,p0}var m0,cP;function oz(){if(cP)return m0;cP=1;var e=au(),t=Ls(),r=e(t,"WeakMap");return m0=r,m0}var g0,uP;function sz(){if(uP)return g0;uP=1;var e=az(),t=uj(),r=iz(),n=rD(),a=oz(),o=_l(),s=bN(),l="[object Map]",c="[object Object]",u="[object Promise]",d="[object Set]",f="[object WeakMap]",h="[object DataView]",p=s(e),v=s(t),m=s(r),y=s(n),b=s(a),_=o;return(e&&_(new e(new ArrayBuffer(1)))!=h||t&&_(new t)!=l||r&&_(r.resolve())!=u||n&&_(new n)!=d||a&&_(new a)!=f)&&(_=function(w){var A=o(w),P=A==c?w.constructor:void 0,T=P?s(P):"";if(T)switch(T){case p:return h;case v:return l;case m:return u;case y:return d;case b:return f}return A}),g0=_,g0}var v0,dP;function lz(){if(dP)return v0;dP=1;var e=VN(),t=QN(),r=UU(),n=nz(),a=sz(),o=Zi(),s=JN(),l=eD(),c=1,u="[object Arguments]",d="[object Array]",f="[object Object]",h=Object.prototype,p=h.hasOwnProperty;function v(m,y,b,_,w,A){var P=o(m),T=o(y),E=P?d:a(m),S=T?d:a(y);E=E==u?f:E,S=S==u?f:S;var I=E==f,W=S==f,O=E==S;if(O&&s(m)){if(!s(y))return!1;P=!0,I=!1}if(O&&!I)return A||(A=new e),P||l(m)?t(m,y,b,_,w,A):r(m,y,E,b,_,w,A);if(!(b&c)){var D=I&&p.call(m,"__wrapped__"),R=W&&p.call(y,"__wrapped__");if(D||R){var F=D?m.value():m,z=R?y.value():y;return A||(A=new e),w(F,z,b,_,A)}}return O?(A||(A=new e),n(m,y,b,_,w,A)):!1}return v0=v,v0}var y0,fP;function Cj(){if(fP)return y0;fP=1;var e=lz(),t=wl();function r(n,a,o,s,l){return n===a?!0:n==null||a==null||!t(n)&&!t(a)?n!==n&&a!==a:e(n,a,o,s,r,l)}return y0=r,y0}var x0,hP;function cz(){if(hP)return x0;hP=1;var e=VN(),t=Cj(),r=1,n=2;function a(o,s,l,c){var u=l.length,d=u,f=!c;if(o==null)return!d;for(o=Object(o);u--;){var h=l[u];if(f&&h[2]?h[1]!==o[h[0]]:!(h[0]in o))return!1}for(;++u<d;){h=l[u];var p=h[0],v=o[p],m=h[1];if(f&&h[2]){if(v===void 0&&!(p in o))return!1}else{var y=new e;if(c)var b=c(v,m,p,o,s,y);if(!(b===void 0?t(m,v,r|n,c,y):b))return!1}}return!0}return x0=a,x0}var b0,pP;function nD(){if(pP)return b0;pP=1;var e=sc();function t(r){return r===r&&!e(r)}return b0=t,b0}var _0,mP;function uz(){if(mP)return _0;mP=1;var e=nD(),t=Qv();function r(n){for(var a=t(n),o=a.length;o--;){var s=a[o],l=n[s];a[o]=[s,l,e(l)]}return a}return _0=r,_0}var w0,gP;function aD(){if(gP)return w0;gP=1;function e(t,r){return function(n){return n==null?!1:n[t]===r&&(r!==void 0||t in Object(n))}}return w0=e,w0}var j0,vP;function dz(){if(vP)return j0;vP=1;var e=cz(),t=uz(),r=aD();function n(a){var o=t(a);return o.length==1&&o[0][2]?r(o[0][0],o[0][1]):function(s){return s===a||e(s,a,o)}}return j0=n,j0}var S0,yP;function fz(){if(yP)return S0;yP=1;function e(t,r){return t!=null&&r in Object(t)}return S0=e,S0}var C0,xP;function hz(){if(xP)return C0;xP=1;var e=jN(),t=wj(),r=Zi(),n=jj(),a=Sj(),o=Hv();function s(l,c,u){c=e(c,l);for(var d=-1,f=c.length,h=!1;++d<f;){var p=o(c[d]);if(!(h=l!=null&&u(l,p)))break;l=l[p]}return h||++d!=f?h:(f=l==null?0:l.length,!!f&&a(f)&&n(p,f)&&(r(l)||t(l)))}return C0=s,C0}var A0,bP;function pz(){if(bP)return A0;bP=1;var e=fz(),t=hz();function r(n,a){return n!=null&&t(n,a,e)}return A0=r,A0}var P0,_P;function mz(){if(_P)return P0;_P=1;var e=Cj(),t=SN(),r=pz(),n=sj(),a=nD(),o=aD(),s=Hv(),l=1,c=2;function u(d,f){return n(d)&&a(f)?o(s(d),f):function(h){var p=t(h,d);return p===void 0&&p===f?r(h,d):e(f,p,l|c)}}return P0=u,P0}var O0,wP;function Fd(){if(wP)return O0;wP=1;function e(t){return t}return O0=e,O0}var k0,jP;function gz(){if(jP)return k0;jP=1;function e(t){return function(r){return r?.[t]}}return k0=e,k0}var T0,SP;function vz(){if(SP)return T0;SP=1;var e=hj();function t(r){return function(n){return e(n,r)}}return T0=t,T0}var E0,CP;function yz(){if(CP)return E0;CP=1;var e=gz(),t=vz(),r=sj(),n=Hv();function a(o){return r(o)?e(n(o)):t(o)}return E0=a,E0}var I0,AP;function Rs(){if(AP)return I0;AP=1;var e=dz(),t=mz(),r=Fd(),n=Zi(),a=yz();function o(s){return typeof s=="function"?s:s==null?r:typeof s=="object"?n(s)?t(s[0],s[1]):e(s):a(s)}return I0=o,I0}var N0,PP;function iD(){if(PP)return N0;PP=1;function e(t,r,n,a){for(var o=t.length,s=n+(a?1:-1);a?s--:++s<o;)if(r(t[s],s,t))return s;return-1}return N0=e,N0}var D0,OP;function xz(){if(OP)return D0;OP=1;function e(t){return t!==t}return D0=e,D0}var M0,kP;function bz(){if(kP)return M0;kP=1;function e(t,r,n){for(var a=n-1,o=t.length;++a<o;)if(t[a]===r)return a;return-1}return M0=e,M0}var L0,TP;function _z(){if(TP)return L0;TP=1;var e=iD(),t=xz(),r=bz();function n(a,o,s){return o===o?r(a,o,s):e(a,t,s)}return L0=n,L0}var R0,EP;function wz(){if(EP)return R0;EP=1;var e=_z();function t(r,n){var a=r==null?0:r.length;return!!a&&e(r,n,0)>-1}return R0=t,R0}var q0,IP;function jz(){if(IP)return q0;IP=1;function e(t,r,n){for(var a=-1,o=t==null?0:t.length;++a<o;)if(n(r,t[a]))return!0;return!1}return q0=e,q0}var F0,NP;function Sz(){if(NP)return F0;NP=1;function e(){}return F0=e,F0}var $0,DP;function Cz(){if(DP)return $0;DP=1;var e=rD(),t=Sz(),r=_j(),n=1/0,a=e&&1/r(new e([,-0]))[1]==n?function(o){return new e(o)}:t;return $0=a,$0}var B0,MP;function Az(){if(MP)return B0;MP=1;var e=GN(),t=wz(),r=jz(),n=KN(),a=Cz(),o=_j(),s=200;function l(c,u,d){var f=-1,h=t,p=c.length,v=!0,m=[],y=m;if(d)v=!1,h=r;else if(p>=s){var b=u?null:a(c);if(b)return o(b);v=!1,h=n,y=new e}else y=u?[]:m;e:for(;++f<p;){var _=c[f],w=u?u(_):_;if(_=d||_!==0?_:0,v&&w===w){for(var A=y.length;A--;)if(y[A]===w)continue e;u&&y.push(w),m.push(_)}else h(y,w,d)||(y!==m&&y.push(w),m.push(_))}return m}return B0=l,B0}var U0,LP;function Pz(){if(LP)return U0;LP=1;var e=Rs(),t=Az();function r(n,a){return n&&n.length?t(n,e(a,2)):[]}return U0=r,U0}var Oz=Pz();const RP=Et(Oz);function oD(e,t,r){return t===!0?RP(e,r):Nr(t)?RP(e,t):e}function rd(e){"@babel/helpers - typeof";return rd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rd(e)}var kz=["ref"];function qP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Js(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?qP(Object(r),!0).forEach(function(n){Xv(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qP(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Tz(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function FP(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,lD(n.key),n)}}function Ez(e,t,r){return t&&FP(e.prototype,t),r&&FP(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Iz(e,t,r){return t=jg(t),Nz(e,sD()?Reflect.construct(t,r||[],jg(e).constructor):t.apply(e,r))}function Nz(e,t){if(t&&(rd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Dz(e)}function Dz(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function sD(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(sD=function(){return!!e})()}function jg(e){return jg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},jg(e)}function Mz(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c_(e,t)}function c_(e,t){return c_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},c_(e,t)}function Xv(e,t,r){return t=lD(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lD(e){var t=Lz(e,"string");return rd(t)=="symbol"?t:t+""}function Lz(e,t){if(rd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(rd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Rz(e,t){if(e==null)return{};var r=qz(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function qz(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Fz(e){return e.value}function $z(e,t){if(Ce.isValidElement(e))return Ce.cloneElement(e,t);if(typeof e=="function")return Ce.createElement(e,t);t.ref;var r=Rz(t,kz);return Ce.createElement(bj,r)}var $P=1,Ss=function(e){function t(){var r;Tz(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return r=Iz(this,t,[].concat(a)),Xv(r,"lastBoundingBox",{width:-1,height:-1}),r}return Mz(t,e),Ez(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,a=this.getBBox();a?(Math.abs(a.width-this.lastBoundingBox.width)>$P||Math.abs(a.height-this.lastBoundingBox.height)>$P)&&(this.lastBoundingBox.width=a.width,this.lastBoundingBox.height=a.height,n&&n(a)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?Js({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var a=this.props,o=a.layout,s=a.align,l=a.verticalAlign,c=a.margin,u=a.chartWidth,d=a.chartHeight,f,h;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(s==="center"&&o==="vertical"){var p=this.getBBoxSnapshot();f={left:((u||0)-p.width)/2}}else f=s==="right"?{right:c&&c.right||0}:{left:c&&c.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(l==="middle"){var v=this.getBBoxSnapshot();h={top:((d||0)-v.height)/2}}else h=l==="bottom"?{bottom:c&&c.bottom||0}:{top:c&&c.top||0};return Js(Js({},f),h)}},{key:"render",value:function(){var n=this,a=this.props,o=a.content,s=a.width,l=a.height,c=a.wrapperStyle,u=a.payloadUniqBy,d=a.payload,f=Js(Js({position:"absolute",width:s||"auto",height:l||"auto"},this.getDefaultPosition(c)),c);return Ce.createElement("div",{className:"recharts-legend-wrapper",style:f,ref:function(p){n.wrapperNode=p}},$z(o,Js(Js({},this.props),{},{payload:oD(d,u,Fz)})))}}],[{key:"getWithHeight",value:function(n,a){var o=Js(Js({},this.defaultProps),n.props),s=o.layout;return s==="vertical"&&Mt(n.props.height)?{height:n.props.height}:s==="horizontal"?{width:n.props.width||a}:null}}])}(x.PureComponent);Xv(Ss,"displayName","Legend");Xv(Ss,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var z0,BP;function Bz(){if(BP)return z0;BP=1;var e=Dp(),t=wj(),r=Zi(),n=e?e.isConcatSpreadable:void 0;function a(o){return r(o)||t(o)||!!(n&&o&&o[n])}return z0=a,z0}var W0,UP;function cD(){if(UP)return W0;UP=1;var e=XN(),t=Bz();function r(n,a,o,s,l){var c=-1,u=n.length;for(o||(o=t),l||(l=[]);++c<u;){var d=n[c];a>0&&o(d)?a>1?r(d,a-1,o,s,l):e(l,d):s||(l[l.length]=d)}return l}return W0=r,W0}var H0,zP;function Uz(){if(zP)return H0;zP=1;function e(t){return function(r,n,a){for(var o=-1,s=Object(r),l=a(r),c=l.length;c--;){var u=l[t?c:++o];if(n(s[u],u,s)===!1)break}return r}}return H0=e,H0}var V0,WP;function zz(){if(WP)return V0;WP=1;var e=Uz(),t=e();return V0=t,V0}var G0,HP;function uD(){if(HP)return G0;HP=1;var e=zz(),t=Qv();function r(n,a){return n&&e(n,a,t)}return G0=r,G0}var Y0,VP;function Wz(){if(VP)return Y0;VP=1;var e=Lp();function t(r,n){return function(a,o){if(a==null)return a;if(!e(a))return r(a,o);for(var s=a.length,l=n?s:-1,c=Object(a);(n?l--:++l<s)&&o(c[l],l,c)!==!1;);return a}}return Y0=t,Y0}var K0,GP;function Aj(){if(GP)return K0;GP=1;var e=uD(),t=Wz(),r=t(e);return K0=r,K0}var Q0,YP;function dD(){if(YP)return Q0;YP=1;var e=Aj(),t=Lp();function r(n,a){var o=-1,s=t(n)?Array(n.length):[];return e(n,function(l,c,u){s[++o]=a(l,c,u)}),s}return Q0=r,Q0}var X0,KP;function Hz(){if(KP)return X0;KP=1;function e(t,r){var n=t.length;for(t.sort(r);n--;)t[n]=t[n].value;return t}return X0=e,X0}var J0,QP;function Vz(){if(QP)return J0;QP=1;var e=Ld();function t(r,n){if(r!==n){var a=r!==void 0,o=r===null,s=r===r,l=e(r),c=n!==void 0,u=n===null,d=n===n,f=e(n);if(!u&&!f&&!l&&r>n||l&&c&&d&&!u&&!f||o&&c&&d||!a&&d||!s)return 1;if(!o&&!l&&!f&&r<n||f&&a&&s&&!o&&!l||u&&a&&s||!c&&s||!d)return-1}return 0}return J0=t,J0}var Z0,XP;function Gz(){if(XP)return Z0;XP=1;var e=Vz();function t(r,n,a){for(var o=-1,s=r.criteria,l=n.criteria,c=s.length,u=a.length;++o<c;){var d=e(s[o],l[o]);if(d){if(o>=u)return d;var f=a[o];return d*(f=="desc"?-1:1)}}return r.index-n.index}return Z0=t,Z0}var e1,JP;function Yz(){if(JP)return e1;JP=1;var e=fj(),t=hj(),r=Rs(),n=dD(),a=Hz(),o=ZN(),s=Gz(),l=Fd(),c=Zi();function u(d,f,h){f.length?f=e(f,function(m){return c(m)?function(y){return t(y,m.length===1?m[0]:m)}:m}):f=[l];var p=-1;f=e(f,o(r));var v=n(d,function(m,y,b){var _=e(f,function(w){return w(m)});return{criteria:_,index:++p,value:m}});return a(v,function(m,y){return s(m,y,h)})}return e1=u,e1}var t1,ZP;function Kz(){if(ZP)return t1;ZP=1;function e(t,r,n){switch(n.length){case 0:return t.call(r);case 1:return t.call(r,n[0]);case 2:return t.call(r,n[0],n[1]);case 3:return t.call(r,n[0],n[1],n[2])}return t.apply(r,n)}return t1=e,t1}var r1,eO;function Qz(){if(eO)return r1;eO=1;var e=Kz(),t=Math.max;function r(n,a,o){return a=t(a===void 0?n.length-1:a,0),function(){for(var s=arguments,l=-1,c=t(s.length-a,0),u=Array(c);++l<c;)u[l]=s[a+l];l=-1;for(var d=Array(a+1);++l<a;)d[l]=s[l];return d[a]=o(u),e(n,this,d)}}return r1=r,r1}var n1,tO;function Xz(){if(tO)return n1;tO=1;function e(t){return function(){return t}}return n1=e,n1}var a1,rO;function fD(){if(rO)return a1;rO=1;var e=au(),t=function(){try{var r=e(Object,"defineProperty");return r({},"",{}),r}catch{}}();return a1=t,a1}var i1,nO;function Jz(){if(nO)return i1;nO=1;var e=Xz(),t=fD(),r=Fd(),n=t?function(a,o){return t(a,"toString",{configurable:!0,enumerable:!1,value:e(o),writable:!0})}:r;return i1=n,i1}var o1,aO;function Zz(){if(aO)return o1;aO=1;var e=800,t=16,r=Date.now;function n(a){var o=0,s=0;return function(){var l=r(),c=t-(l-s);if(s=l,c>0){if(++o>=e)return arguments[0]}else o=0;return a.apply(void 0,arguments)}}return o1=n,o1}var s1,iO;function eW(){if(iO)return s1;iO=1;var e=Jz(),t=Zz(),r=t(e);return s1=r,s1}var l1,oO;function tW(){if(oO)return l1;oO=1;var e=Fd(),t=Qz(),r=eW();function n(a,o){return r(t(a,o,e),a+"")}return l1=n,l1}var c1,sO;function Jv(){if(sO)return c1;sO=1;var e=cj(),t=Lp(),r=jj(),n=sc();function a(o,s,l){if(!n(l))return!1;var c=typeof s;return(c=="number"?t(l)&&r(s,l.length):c=="string"&&s in l)?e(l[s],o):!1}return c1=a,c1}var u1,lO;function rW(){if(lO)return u1;lO=1;var e=cD(),t=Yz(),r=tW(),n=Jv(),a=r(function(o,s){if(o==null)return[];var l=s.length;return l>1&&n(o,s[0],s[1])?s=[]:l>2&&n(s[0],s[1],s[2])&&(s=[s[0]]),t(o,e(s,1),[])});return u1=a,u1}var nW=rW();const Pj=Et(nW);function Vh(e){"@babel/helpers - typeof";return Vh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vh(e)}function u_(){return u_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u_.apply(this,arguments)}function aW(e,t){return lW(e)||sW(e,t)||oW(e,t)||iW()}function iW(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oW(e,t){if(e){if(typeof e=="string")return cO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cO(e,t)}}function cO(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function sW(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function lW(e){if(Array.isArray(e))return e}function uO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function d1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uO(Object(r),!0).forEach(function(n){cW(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uO(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function cW(e,t,r){return t=uW(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uW(e){var t=dW(e,"string");return Vh(t)=="symbol"?t:t+""}function dW(e,t){if(Vh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Vh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function fW(e){return Array.isArray(e)&&Ha(e[0])&&Ha(e[1])?e.join(" ~ "):e}var hW=function(t){var r=t.separator,n=r===void 0?" : ":r,a=t.contentStyle,o=a===void 0?{}:a,s=t.itemStyle,l=s===void 0?{}:s,c=t.labelStyle,u=c===void 0?{}:c,d=t.payload,f=t.formatter,h=t.itemSorter,p=t.wrapperClassName,v=t.labelClassName,m=t.label,y=t.labelFormatter,b=t.accessibilityLayer,_=b===void 0?!1:b,w=function(){if(d&&d.length){var D={padding:0,margin:0},R=(h?Pj(d,h):d).map(function(F,z){if(F.type==="none")return null;var K=d1({display:"block",paddingTop:4,paddingBottom:4,color:F.color||"#000"},l),J=F.formatter||f||fW,L=F.value,k=F.name,$=L,X=k;if(J&&$!=null&&X!=null){var C=J(L,k,F,z,d);if(Array.isArray(C)){var M=aW(C,2);$=M[0],X=M[1]}else $=C}return Ce.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(z),style:K},Ha(X)?Ce.createElement("span",{className:"recharts-tooltip-item-name"},X):null,Ha(X)?Ce.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,Ce.createElement("span",{className:"recharts-tooltip-item-value"},$),Ce.createElement("span",{className:"recharts-tooltip-item-unit"},F.unit||""))});return Ce.createElement("ul",{className:"recharts-tooltip-item-list",style:D},R)}return null},A=d1({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},o),P=d1({margin:0},u),T=!$r(m),E=T?m:"",S=Tr("recharts-default-tooltip",p),I=Tr("recharts-tooltip-label",v);T&&y&&d!==void 0&&d!==null&&(E=y(m,d));var W=_?{role:"status","aria-live":"assertive"}:{};return Ce.createElement("div",u_({className:S,style:A},W),Ce.createElement("p",{className:I,style:P},Ce.isValidElement(E)?E:"".concat(E)),w())};function Gh(e){"@babel/helpers - typeof";return Gh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gh(e)}function vm(e,t,r){return t=pW(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pW(e){var t=mW(e,"string");return Gh(t)=="symbol"?t:t+""}function mW(e,t){if(Gh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Gh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var uf="recharts-tooltip-wrapper",gW={visibility:"hidden"};function vW(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return Tr(uf,vm(vm(vm(vm({},"".concat(uf,"-right"),Mt(r)&&t&&Mt(t.x)&&r>=t.x),"".concat(uf,"-left"),Mt(r)&&t&&Mt(t.x)&&r<t.x),"".concat(uf,"-bottom"),Mt(n)&&t&&Mt(t.y)&&n>=t.y),"".concat(uf,"-top"),Mt(n)&&t&&Mt(t.y)&&n<t.y))}function dO(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,a=e.offsetTopLeft,o=e.position,s=e.reverseDirection,l=e.tooltipDimension,c=e.viewBox,u=e.viewBoxDimension;if(o&&Mt(o[n]))return o[n];var d=r[n]-l-a,f=r[n]+a;if(t[n])return s[n]?d:f;if(s[n]){var h=d,p=c[n];return h<p?Math.max(f,c[n]):Math.max(d,c[n])}var v=f+l,m=c[n]+u;return v>m?Math.max(d,c[n]):Math.max(f,c[n])}function yW(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function xW(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,a=e.position,o=e.reverseDirection,s=e.tooltipBox,l=e.useTranslate3d,c=e.viewBox,u,d,f;return s.height>0&&s.width>0&&r?(d=dO({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:a,reverseDirection:o,tooltipDimension:s.width,viewBox:c,viewBoxDimension:c.width}),f=dO({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:a,reverseDirection:o,tooltipDimension:s.height,viewBox:c,viewBoxDimension:c.height}),u=yW({translateX:d,translateY:f,useTranslate3d:l})):u=gW,{cssProperties:u,cssClasses:vW({translateX:d,translateY:f,coordinate:r})}}function nd(e){"@babel/helpers - typeof";return nd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nd(e)}function fO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function hO(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fO(Object(r),!0).forEach(function(n){f_(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fO(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function bW(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _W(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,pD(n.key),n)}}function wW(e,t,r){return t&&_W(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function jW(e,t,r){return t=Sg(t),SW(e,hD()?Reflect.construct(t,r||[],Sg(e).constructor):t.apply(e,r))}function SW(e,t){if(t&&(nd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return CW(e)}function CW(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hD(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hD=function(){return!!e})()}function Sg(e){return Sg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Sg(e)}function AW(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d_(e,t)}function d_(e,t){return d_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},d_(e,t)}function f_(e,t,r){return t=pD(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pD(e){var t=PW(e,"string");return nd(t)=="symbol"?t:t+""}function PW(e,t){if(nd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(nd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var pO=1,OW=function(e){function t(){var r;bW(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return r=jW(this,t,[].concat(a)),f_(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),f_(r,"handleKeyDown",function(s){if(s.key==="Escape"){var l,c,u,d;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(l=(c=r.props.coordinate)===null||c===void 0?void 0:c.x)!==null&&l!==void 0?l:0,y:(u=(d=r.props.coordinate)===null||d===void 0?void 0:d.y)!==null&&u!==void 0?u:0}})}}),r}return AW(t,e),wW(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>pO||Math.abs(n.height-this.state.lastBoundingBox.height)>pO)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,a;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((a=this.props.coordinate)===null||a===void 0?void 0:a.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,a=this.props,o=a.active,s=a.allowEscapeViewBox,l=a.animationDuration,c=a.animationEasing,u=a.children,d=a.coordinate,f=a.hasPayload,h=a.isAnimationActive,p=a.offset,v=a.position,m=a.reverseDirection,y=a.useTranslate3d,b=a.viewBox,_=a.wrapperStyle,w=xW({allowEscapeViewBox:s,coordinate:d,offsetTopLeft:p,position:v,reverseDirection:m,tooltipBox:this.state.lastBoundingBox,useTranslate3d:y,viewBox:b}),A=w.cssClasses,P=w.cssProperties,T=hO(hO({transition:h&&o?"transform ".concat(l,"ms ").concat(c):void 0},P),{},{pointerEvents:"none",visibility:!this.state.dismissed&&o&&f?"visible":"hidden",position:"absolute",top:0,left:0},_);return Ce.createElement("div",{tabIndex:-1,className:A,style:T,ref:function(S){n.wrapperNode=S}},u)}}])}(x.PureComponent),kW=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},iu={isSsr:kW()};function ad(e){"@babel/helpers - typeof";return ad=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ad(e)}function mO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function gO(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mO(Object(r),!0).forEach(function(n){Oj(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mO(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function TW(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function EW(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,gD(n.key),n)}}function IW(e,t,r){return t&&EW(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function NW(e,t,r){return t=Cg(t),DW(e,mD()?Reflect.construct(t,r||[],Cg(e).constructor):t.apply(e,r))}function DW(e,t){if(t&&(ad(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return MW(e)}function MW(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mD(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mD=function(){return!!e})()}function Cg(e){return Cg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Cg(e)}function LW(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h_(e,t)}function h_(e,t){return h_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},h_(e,t)}function Oj(e,t,r){return t=gD(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gD(e){var t=RW(e,"string");return ad(t)=="symbol"?t:t+""}function RW(e,t){if(ad(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ad(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function qW(e){return e.dataKey}function FW(e,t){return Ce.isValidElement(e)?Ce.cloneElement(e,t):typeof e=="function"?Ce.createElement(e,t):Ce.createElement(hW,t)}var xo=function(e){function t(){return TW(this,t),NW(this,t,arguments)}return LW(t,e),IW(t,[{key:"render",value:function(){var n=this,a=this.props,o=a.active,s=a.allowEscapeViewBox,l=a.animationDuration,c=a.animationEasing,u=a.content,d=a.coordinate,f=a.filterNull,h=a.isAnimationActive,p=a.offset,v=a.payload,m=a.payloadUniqBy,y=a.position,b=a.reverseDirection,_=a.useTranslate3d,w=a.viewBox,A=a.wrapperStyle,P=v??[];f&&P.length&&(P=oD(v.filter(function(E){return E.value!=null&&(E.hide!==!0||n.props.includeHidden)}),m,qW));var T=P.length>0;return Ce.createElement(OW,{allowEscapeViewBox:s,animationDuration:l,animationEasing:c,isAnimationActive:h,active:o,coordinate:d,hasPayload:T,offset:p,position:y,reverseDirection:b,useTranslate3d:_,viewBox:w,wrapperStyle:A},FW(u,gO(gO({},this.props),{},{payload:P})))}}])}(x.PureComponent);Oj(xo,"displayName","Tooltip");Oj(xo,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!iu.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var f1,vO;function $W(){if(vO)return f1;vO=1;var e=Ls(),t=function(){return e.Date.now()};return f1=t,f1}var h1,yO;function BW(){if(yO)return h1;yO=1;var e=/\s/;function t(r){for(var n=r.length;n--&&e.test(r.charAt(n)););return n}return h1=t,h1}var p1,xO;function UW(){if(xO)return p1;xO=1;var e=BW(),t=/^\s+/;function r(n){return n&&n.slice(0,e(n)+1).replace(t,"")}return p1=r,p1}var m1,bO;function vD(){if(bO)return m1;bO=1;var e=UW(),t=sc(),r=Ld(),n=NaN,a=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,s=/^0o[0-7]+$/i,l=parseInt;function c(u){if(typeof u=="number")return u;if(r(u))return n;if(t(u)){var d=typeof u.valueOf=="function"?u.valueOf():u;u=t(d)?d+"":d}if(typeof u!="string")return u===0?u:+u;u=e(u);var f=o.test(u);return f||s.test(u)?l(u.slice(2),f?2:8):a.test(u)?n:+u}return m1=c,m1}var g1,_O;function zW(){if(_O)return g1;_O=1;var e=sc(),t=$W(),r=vD(),n="Expected a function",a=Math.max,o=Math.min;function s(l,c,u){var d,f,h,p,v,m,y=0,b=!1,_=!1,w=!0;if(typeof l!="function")throw new TypeError(n);c=r(c)||0,e(u)&&(b=!!u.leading,_="maxWait"in u,h=_?a(r(u.maxWait)||0,c):h,w="trailing"in u?!!u.trailing:w);function A(R){var F=d,z=f;return d=f=void 0,y=R,p=l.apply(z,F),p}function P(R){return y=R,v=setTimeout(S,c),b?A(R):p}function T(R){var F=R-m,z=R-y,K=c-F;return _?o(K,h-z):K}function E(R){var F=R-m,z=R-y;return m===void 0||F>=c||F<0||_&&z>=h}function S(){var R=t();if(E(R))return I(R);v=setTimeout(S,T(R))}function I(R){return v=void 0,w&&d?A(R):(d=f=void 0,p)}function W(){v!==void 0&&clearTimeout(v),y=0,d=m=f=v=void 0}function O(){return v===void 0?p:I(t())}function D(){var R=t(),F=E(R);if(d=arguments,f=this,m=R,F){if(v===void 0)return P(m);if(_)return clearTimeout(v),v=setTimeout(S,c),A(m)}return v===void 0&&(v=setTimeout(S,c)),p}return D.cancel=W,D.flush=O,D}return g1=s,g1}var v1,wO;function WW(){if(wO)return v1;wO=1;var e=zW(),t=sc(),r="Expected a function";function n(a,o,s){var l=!0,c=!0;if(typeof a!="function")throw new TypeError(r);return t(s)&&(l="leading"in s?!!s.leading:l,c="trailing"in s?!!s.trailing:c),e(a,o,{leading:l,maxWait:o,trailing:c})}return v1=n,v1}var HW=WW();const yD=Et(HW);function Yh(e){"@babel/helpers - typeof";return Yh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yh(e)}function jO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ym(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jO(Object(r),!0).forEach(function(n){VW(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jO(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function VW(e,t,r){return t=GW(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function GW(e){var t=YW(e,"string");return Yh(t)=="symbol"?t:t+""}function YW(e,t){if(Yh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Yh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function KW(e,t){return ZW(e)||JW(e,t)||XW(e,t)||QW()}function QW(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XW(e,t){if(e){if(typeof e=="string")return SO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return SO(e,t)}}function SO(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function JW(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function ZW(e){if(Array.isArray(e))return e}var xD=x.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,a=n===void 0?{width:-1,height:-1}:n,o=e.width,s=o===void 0?"100%":o,l=e.height,c=l===void 0?"100%":l,u=e.minWidth,d=u===void 0?0:u,f=e.minHeight,h=e.maxHeight,p=e.children,v=e.debounce,m=v===void 0?0:v,y=e.id,b=e.className,_=e.onResize,w=e.style,A=w===void 0?{}:w,P=x.useRef(null),T=x.useRef();T.current=_,x.useImperativeHandle(t,function(){return Object.defineProperty(P.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),P.current},configurable:!0})});var E=x.useState({containerWidth:a.width,containerHeight:a.height}),S=KW(E,2),I=S[0],W=S[1],O=x.useCallback(function(R,F){W(function(z){var K=Math.round(R),J=Math.round(F);return z.containerWidth===K&&z.containerHeight===J?z:{containerWidth:K,containerHeight:J}})},[]);x.useEffect(function(){var R=function(k){var $,X=k[0].contentRect,C=X.width,M=X.height;O(C,M),($=T.current)===null||$===void 0||$.call(T,C,M)};m>0&&(R=yD(R,m,{trailing:!0,leading:!1}));var F=new ResizeObserver(R),z=P.current.getBoundingClientRect(),K=z.width,J=z.height;return O(K,J),F.observe(P.current),function(){F.disconnect()}},[O,m]);var D=x.useMemo(function(){var R=I.containerWidth,F=I.containerHeight;if(R<0||F<0)return null;is(Mc(s)||Mc(c),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,s,c),is(!r||r>0,"The aspect(%s) must be greater than zero.",r);var z=Mc(s)?R:s,K=Mc(c)?F:c;r&&r>0&&(z?K=z/r:K&&(z=K*r),h&&K>h&&(K=h)),is(z>0||K>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,z,K,s,c,d,f,r);var J=!Array.isArray(p)&&ul(p.type).endsWith("Chart");return Ce.Children.map(p,function(L){return Ce.isValidElement(L)?x.cloneElement(L,ym({width:z,height:K},J?{style:ym({height:"100%",width:"100%",maxHeight:K,maxWidth:z},L.props.style)}:{})):L})},[r,p,c,h,f,d,I,s]);return Ce.createElement("div",{id:y?"".concat(y):void 0,className:Tr("recharts-responsive-container",b),style:ym(ym({},A),{},{width:s,height:c,minWidth:d,minHeight:f,maxHeight:h}),ref:P},D)}),Zv=function(t){return null};Zv.displayName="Cell";function Kh(e){"@babel/helpers - typeof";return Kh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kh(e)}function CO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function p_(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CO(Object(r),!0).forEach(function(n){e9(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CO(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function e9(e,t,r){return t=t9(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function t9(e){var t=r9(e,"string");return Kh(t)=="symbol"?t:t+""}function r9(e,t){if(Kh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Kh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var xu={widthCache:{},cacheCount:0},n9=2e3,a9={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},AO="recharts_measurement_span";function i9(e){var t=p_({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var kh=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||iu.isSsr)return{width:0,height:0};var n=i9(r),a=JSON.stringify({text:t,copyStyle:n});if(xu.widthCache[a])return xu.widthCache[a];try{var o=document.getElementById(AO);o||(o=document.createElement("span"),o.setAttribute("id",AO),o.setAttribute("aria-hidden","true"),document.body.appendChild(o));var s=p_(p_({},a9),n);Object.assign(o.style,s),o.textContent="".concat(t);var l=o.getBoundingClientRect(),c={width:l.width,height:l.height};return xu.widthCache[a]=c,++xu.cacheCount>n9&&(xu.cacheCount=0,xu.widthCache={}),c}catch{return{width:0,height:0}}},o9=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function Qh(e){"@babel/helpers - typeof";return Qh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qh(e)}function Ag(e,t){return u9(e)||c9(e,t)||l9(e,t)||s9()}function s9(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function l9(e,t){if(e){if(typeof e=="string")return PO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return PO(e,t)}}function PO(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c9(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function u9(e){if(Array.isArray(e))return e}function d9(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function OO(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,h9(n.key),n)}}function f9(e,t,r){return t&&OO(e.prototype,t),r&&OO(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function h9(e){var t=p9(e,"string");return Qh(t)=="symbol"?t:t+""}function p9(e,t){if(Qh(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Qh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var kO=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,TO=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,m9=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,g9=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,bD={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},v9=Object.keys(bD),Iu="NaN";function y9(e,t){return e*bD[t]}var xm=function(){function e(t,r){d9(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!m9.test(r)&&(this.num=NaN,this.unit=""),v9.includes(r)&&(this.num=y9(t,r),this.unit="px")}return f9(e,[{key:"add",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var n,a=(n=g9.exec(r))!==null&&n!==void 0?n:[],o=Ag(a,3),s=o[1],l=o[2];return new e(parseFloat(s),l??"")}}])}();function _D(e){if(e.includes(Iu))return Iu;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=kO.exec(t))!==null&&r!==void 0?r:[],a=Ag(n,4),o=a[1],s=a[2],l=a[3],c=xm.parse(o??""),u=xm.parse(l??""),d=s==="*"?c.multiply(u):c.divide(u);if(d.isNaN())return Iu;t=t.replace(kO,d.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var f,h=(f=TO.exec(t))!==null&&f!==void 0?f:[],p=Ag(h,4),v=p[1],m=p[2],y=p[3],b=xm.parse(v??""),_=xm.parse(y??""),w=m==="+"?b.add(_):b.subtract(_);if(w.isNaN())return Iu;t=t.replace(TO,w.toString())}return t}var EO=/\(([^()]*)\)/;function x9(e){for(var t=e;t.includes("(");){var r=EO.exec(t),n=Ag(r,2),a=n[1];t=t.replace(EO,_D(a))}return t}function b9(e){var t=e.replace(/\s+/g,"");return t=x9(t),t=_D(t),t}function _9(e){try{return b9(e)}catch{return Iu}}function y1(e){var t=_9(e.slice(5,-1));return t===Iu?"":t}var w9=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],j9=["dx","dy","angle","className","breakAll"];function m_(){return m_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},m_.apply(this,arguments)}function IO(e,t){if(e==null)return{};var r=S9(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function S9(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function NO(e,t){return O9(e)||P9(e,t)||A9(e,t)||C9()}function C9(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function A9(e,t){if(e){if(typeof e=="string")return DO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return DO(e,t)}}function DO(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function P9(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function O9(e){if(Array.isArray(e))return e}var wD=/[ \f\n\r\t\v\u2028\u2029]+/,jD=function(t){var r=t.children,n=t.breakAll,a=t.style;try{var o=[];$r(r)||(n?o=r.toString().split(""):o=r.toString().split(wD));var s=o.map(function(c){return{word:c,width:kh(c,a).width}}),l=n?0:kh("",a).width;return{wordsWithComputedWidth:s,spaceWidth:l}}catch{return null}},k9=function(t,r,n,a,o){var s=t.maxLines,l=t.children,c=t.style,u=t.breakAll,d=Mt(s),f=l,h=function(){var z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return z.reduce(function(K,J){var L=J.word,k=J.width,$=K[K.length-1];if($&&(a==null||o||$.width+k+n<Number(a)))$.words.push(L),$.width+=k+n;else{var X={words:[L],width:k};K.push(X)}return K},[])},p=h(r),v=function(z){return z.reduce(function(K,J){return K.width>J.width?K:J})};if(!d)return p;for(var m="",y=function(z){var K=f.slice(0,z),J=jD({breakAll:u,style:c,children:K+m}).wordsWithComputedWidth,L=h(J),k=L.length>s||v(L).width>Number(a);return[k,L]},b=0,_=f.length-1,w=0,A;b<=_&&w<=f.length-1;){var P=Math.floor((b+_)/2),T=P-1,E=y(T),S=NO(E,2),I=S[0],W=S[1],O=y(P),D=NO(O,1),R=D[0];if(!I&&!R&&(b=P+1),I&&R&&(_=P-1),!I&&R){A=W;break}w++}return A||p},MO=function(t){var r=$r(t)?[]:t.toString().split(wD);return[{words:r}]},T9=function(t){var r=t.width,n=t.scaleToFit,a=t.children,o=t.style,s=t.breakAll,l=t.maxLines;if((r||n)&&!iu.isSsr){var c,u,d=jD({breakAll:s,children:a,style:o});if(d){var f=d.wordsWithComputedWidth,h=d.spaceWidth;c=f,u=h}else return MO(a);return k9({breakAll:s,children:a,maxLines:l,style:o},c,u,r,n)}return MO(a)},LO="#808080",Kc=function(t){var r=t.x,n=r===void 0?0:r,a=t.y,o=a===void 0?0:a,s=t.lineHeight,l=s===void 0?"1em":s,c=t.capHeight,u=c===void 0?"0.71em":c,d=t.scaleToFit,f=d===void 0?!1:d,h=t.textAnchor,p=h===void 0?"start":h,v=t.verticalAnchor,m=v===void 0?"end":v,y=t.fill,b=y===void 0?LO:y,_=IO(t,w9),w=x.useMemo(function(){return T9({breakAll:_.breakAll,children:_.children,maxLines:_.maxLines,scaleToFit:f,style:_.style,width:_.width})},[_.breakAll,_.children,_.maxLines,f,_.style,_.width]),A=_.dx,P=_.dy,T=_.angle,E=_.className,S=_.breakAll,I=IO(_,j9);if(!Ha(n)||!Ha(o))return null;var W=n+(Mt(A)?A:0),O=o+(Mt(P)?P:0),D;switch(m){case"start":D=y1("calc(".concat(u,")"));break;case"middle":D=y1("calc(".concat((w.length-1)/2," * -").concat(l," + (").concat(u," / 2))"));break;default:D=y1("calc(".concat(w.length-1," * -").concat(l,")"));break}var R=[];if(f){var F=w[0].width,z=_.width;R.push("scale(".concat((Mt(z)?z/F:1)/F,")"))}return T&&R.push("rotate(".concat(T,", ").concat(W,", ").concat(O,")")),R.length&&(I.transform=R.join(" ")),Ce.createElement("text",m_({},yr(I,!0),{x:W,y:O,className:Tr("recharts-text",E),textAnchor:p,fill:b.includes("url")?LO:b}),w.map(function(K,J){var L=K.words.join(S?"":" ");return Ce.createElement("tspan",{x:W,dy:J===0?D:l,key:"".concat(L,"-").concat(J)},L)}))};function Zl(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function E9(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function kj(e){let t,r,n;e.length!==2?(t=Zl,r=(l,c)=>Zl(e(l),c),n=(l,c)=>e(l)-c):(t=e===Zl||e===E9?e:I9,r=e,n=e);function a(l,c,u=0,d=l.length){if(u<d){if(t(c,c)!==0)return d;do{const f=u+d>>>1;r(l[f],c)<0?u=f+1:d=f}while(u<d)}return u}function o(l,c,u=0,d=l.length){if(u<d){if(t(c,c)!==0)return d;do{const f=u+d>>>1;r(l[f],c)<=0?u=f+1:d=f}while(u<d)}return u}function s(l,c,u=0,d=l.length){const f=a(l,c,u,d-1);return f>u&&n(l[f-1],c)>-n(l[f],c)?f-1:f}return{left:a,center:s,right:o}}function I9(){return 0}function SD(e){return e===null?NaN:+e}function*N9(e,t){for(let r of e)r!=null&&(r=+r)>=r&&(yield r)}const D9=kj(Zl),Rp=D9.right;kj(SD).center;class RO extends Map{constructor(t,r=R9){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,a]of t)this.set(n,a)}get(t){return super.get(qO(this,t))}has(t){return super.has(qO(this,t))}set(t,r){return super.set(M9(this,t),r)}delete(t){return super.delete(L9(this,t))}}function qO({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function M9({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function L9({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function R9(e){return e!==null&&typeof e=="object"?e.valueOf():e}function q9(e=Zl){if(e===Zl)return CD;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function CD(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const F9=Math.sqrt(50),$9=Math.sqrt(10),B9=Math.sqrt(2);function Pg(e,t,r){const n=(t-e)/Math.max(0,r),a=Math.floor(Math.log10(n)),o=n/Math.pow(10,a),s=o>=F9?10:o>=$9?5:o>=B9?2:1;let l,c,u;return a<0?(u=Math.pow(10,-a)/s,l=Math.round(e*u),c=Math.round(t*u),l/u<e&&++l,c/u>t&&--c,u=-u):(u=Math.pow(10,a)*s,l=Math.round(e/u),c=Math.round(t/u),l*u<e&&++l,c*u>t&&--c),c<l&&.5<=r&&r<2?Pg(e,t,r*2):[l,c,u]}function g_(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[a,o,s]=n?Pg(t,e,r):Pg(e,t,r);if(!(o>=a))return[];const l=o-a+1,c=new Array(l);if(n)if(s<0)for(let u=0;u<l;++u)c[u]=(o-u)/-s;else for(let u=0;u<l;++u)c[u]=(o-u)*s;else if(s<0)for(let u=0;u<l;++u)c[u]=(a+u)/-s;else for(let u=0;u<l;++u)c[u]=(a+u)*s;return c}function v_(e,t,r){return t=+t,e=+e,r=+r,Pg(e,t,r)[2]}function y_(e,t,r){t=+t,e=+e,r=+r;const n=t<e,a=n?v_(t,e,r):v_(e,t,r);return(n?-1:1)*(a<0?1/-a:a)}function FO(e,t){let r;for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function $O(e,t){let r;for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function AD(e,t,r=0,n=1/0,a){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(a=a===void 0?CD:q9(a);n>r;){if(n-r>600){const c=n-r+1,u=t-r+1,d=Math.log(c),f=.5*Math.exp(2*d/3),h=.5*Math.sqrt(d*f*(c-f)/c)*(u-c/2<0?-1:1),p=Math.max(r,Math.floor(t-u*f/c+h)),v=Math.min(n,Math.floor(t+(c-u)*f/c+h));AD(e,t,p,v,a)}const o=e[t];let s=r,l=n;for(df(e,r,t),a(e[n],o)>0&&df(e,r,n);s<l;){for(df(e,s,l),++s,--l;a(e[s],o)<0;)++s;for(;a(e[l],o)>0;)--l}a(e[r],o)===0?df(e,r,l):(++l,df(e,l,n)),l<=t&&(r=l+1),t<=l&&(n=l-1)}return e}function df(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function U9(e,t,r){if(e=Float64Array.from(N9(e)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return $O(e);if(t>=1)return FO(e);var n,a=(n-1)*t,o=Math.floor(a),s=FO(AD(e,o).subarray(0,o+1)),l=$O(e.subarray(o+1));return s+(l-s)*(a-o)}}function z9(e,t,r=SD){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*t,o=Math.floor(a),s=+r(e[o],o,e),l=+r(e[o+1],o+1,e);return s+(l-s)*(a-o)}}function W9(e,t,r){e=+e,t=+t,r=(a=arguments.length)<2?(t=e,e=0,1):a<3?1:+r;for(var n=-1,a=Math.max(0,Math.ceil((t-e)/r))|0,o=new Array(a);++n<a;)o[n]=e+n*r;return o}function Go(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function jl(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const x_=Symbol("implicit");function Tj(){var e=new RO,t=[],r=[],n=x_;function a(o){let s=e.get(o);if(s===void 0){if(n!==x_)return n;e.set(o,s=t.push(o)-1)}return r[s%r.length]}return a.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new RO;for(const s of o)e.has(s)||e.set(s,t.push(s)-1);return a},a.range=function(o){return arguments.length?(r=Array.from(o),a):r.slice()},a.unknown=function(o){return arguments.length?(n=o,a):n},a.copy=function(){return Tj(t,r).unknown(n)},Go.apply(a,arguments),a}function Xh(){var e=Tj().unknown(void 0),t=e.domain,r=e.range,n=0,a=1,o,s,l=!1,c=0,u=0,d=.5;delete e.unknown;function f(){var h=t().length,p=a<n,v=p?a:n,m=p?n:a;o=(m-v)/Math.max(1,h-c+u*2),l&&(o=Math.floor(o)),v+=(m-v-o*(h-c))*d,s=o*(1-c),l&&(v=Math.round(v),s=Math.round(s));var y=W9(h).map(function(b){return v+o*b});return r(p?y.reverse():y)}return e.domain=function(h){return arguments.length?(t(h),f()):t()},e.range=function(h){return arguments.length?([n,a]=h,n=+n,a=+a,f()):[n,a]},e.rangeRound=function(h){return[n,a]=h,n=+n,a=+a,l=!0,f()},e.bandwidth=function(){return s},e.step=function(){return o},e.round=function(h){return arguments.length?(l=!!h,f()):l},e.padding=function(h){return arguments.length?(c=Math.min(1,u=+h),f()):c},e.paddingInner=function(h){return arguments.length?(c=Math.min(1,h),f()):c},e.paddingOuter=function(h){return arguments.length?(u=+h,f()):u},e.align=function(h){return arguments.length?(d=Math.max(0,Math.min(1,h)),f()):d},e.copy=function(){return Xh(t(),[n,a]).round(l).paddingInner(c).paddingOuter(u).align(d)},Go.apply(f(),arguments)}function PD(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return PD(t())},e}function Th(){return PD(Xh.apply(null,arguments).paddingInner(1))}function Ej(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function OD(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function qp(){}var Jh=.7,Og=1/Jh,Vu="\\s*([+-]?\\d+)\\s*",Zh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Cs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",H9=/^#([0-9a-f]{3,8})$/,V9=new RegExp(`^rgb\\(${Vu},${Vu},${Vu}\\)$`),G9=new RegExp(`^rgb\\(${Cs},${Cs},${Cs}\\)$`),Y9=new RegExp(`^rgba\\(${Vu},${Vu},${Vu},${Zh}\\)$`),K9=new RegExp(`^rgba\\(${Cs},${Cs},${Cs},${Zh}\\)$`),Q9=new RegExp(`^hsl\\(${Zh},${Cs},${Cs}\\)$`),X9=new RegExp(`^hsla\\(${Zh},${Cs},${Cs},${Zh}\\)$`),BO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ej(qp,ep,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:UO,formatHex:UO,formatHex8:J9,formatHsl:Z9,formatRgb:zO,toString:zO});function UO(){return this.rgb().formatHex()}function J9(){return this.rgb().formatHex8()}function Z9(){return kD(this).formatHsl()}function zO(){return this.rgb().formatRgb()}function ep(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=H9.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?WO(t):r===3?new Ki(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?bm(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?bm(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=V9.exec(e))?new Ki(t[1],t[2],t[3],1):(t=G9.exec(e))?new Ki(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Y9.exec(e))?bm(t[1],t[2],t[3],t[4]):(t=K9.exec(e))?bm(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Q9.exec(e))?GO(t[1],t[2]/100,t[3]/100,1):(t=X9.exec(e))?GO(t[1],t[2]/100,t[3]/100,t[4]):BO.hasOwnProperty(e)?WO(BO[e]):e==="transparent"?new Ki(NaN,NaN,NaN,0):null}function WO(e){return new Ki(e>>16&255,e>>8&255,e&255,1)}function bm(e,t,r,n){return n<=0&&(e=t=r=NaN),new Ki(e,t,r,n)}function eH(e){return e instanceof qp||(e=ep(e)),e?(e=e.rgb(),new Ki(e.r,e.g,e.b,e.opacity)):new Ki}function b_(e,t,r,n){return arguments.length===1?eH(e):new Ki(e,t,r,n??1)}function Ki(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}Ej(Ki,b_,OD(qp,{brighter(e){return e=e==null?Og:Math.pow(Og,e),new Ki(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Jh:Math.pow(Jh,e),new Ki(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ki($c(this.r),$c(this.g),$c(this.b),kg(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:HO,formatHex:HO,formatHex8:tH,formatRgb:VO,toString:VO}));function HO(){return`#${Lc(this.r)}${Lc(this.g)}${Lc(this.b)}`}function tH(){return`#${Lc(this.r)}${Lc(this.g)}${Lc(this.b)}${Lc((isNaN(this.opacity)?1:this.opacity)*255)}`}function VO(){const e=kg(this.opacity);return`${e===1?"rgb(":"rgba("}${$c(this.r)}, ${$c(this.g)}, ${$c(this.b)}${e===1?")":`, ${e})`}`}function kg(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function $c(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Lc(e){return e=$c(e),(e<16?"0":"")+e.toString(16)}function GO(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new as(e,t,r,n)}function kD(e){if(e instanceof as)return new as(e.h,e.s,e.l,e.opacity);if(e instanceof qp||(e=ep(e)),!e)return new as;if(e instanceof as)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,a=Math.min(t,r,n),o=Math.max(t,r,n),s=NaN,l=o-a,c=(o+a)/2;return l?(t===o?s=(r-n)/l+(r<n)*6:r===o?s=(n-t)/l+2:s=(t-r)/l+4,l/=c<.5?o+a:2-o-a,s*=60):l=c>0&&c<1?0:s,new as(s,l,c,e.opacity)}function rH(e,t,r,n){return arguments.length===1?kD(e):new as(e,t,r,n??1)}function as(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}Ej(as,rH,OD(qp,{brighter(e){return e=e==null?Og:Math.pow(Og,e),new as(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Jh:Math.pow(Jh,e),new as(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,a=2*r-n;return new Ki(x1(e>=240?e-240:e+120,a,n),x1(e,a,n),x1(e<120?e+240:e-120,a,n),this.opacity)},clamp(){return new as(YO(this.h),_m(this.s),_m(this.l),kg(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=kg(this.opacity);return`${e===1?"hsl(":"hsla("}${YO(this.h)}, ${_m(this.s)*100}%, ${_m(this.l)*100}%${e===1?")":`, ${e})`}`}}));function YO(e){return e=(e||0)%360,e<0?e+360:e}function _m(e){return Math.max(0,Math.min(1,e||0))}function x1(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const Ij=e=>()=>e;function nH(e,t){return function(r){return e+r*t}}function aH(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function iH(e){return(e=+e)==1?TD:function(t,r){return r-t?aH(t,r,e):Ij(isNaN(t)?r:t)}}function TD(e,t){var r=t-e;return r?nH(e,r):Ij(isNaN(e)?t:e)}const KO=function e(t){var r=iH(t);function n(a,o){var s=r((a=b_(a)).r,(o=b_(o)).r),l=r(a.g,o.g),c=r(a.b,o.b),u=TD(a.opacity,o.opacity);return function(d){return a.r=s(d),a.g=l(d),a.b=c(d),a.opacity=u(d),a+""}}return n.gamma=e,n}(1);function oH(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),a;return function(o){for(a=0;a<r;++a)n[a]=e[a]*(1-o)+t[a]*o;return n}}function sH(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function lH(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,a=new Array(n),o=new Array(r),s;for(s=0;s<n;++s)a[s]=$d(e[s],t[s]);for(;s<r;++s)o[s]=t[s];return function(l){for(s=0;s<n;++s)o[s]=a[s](l);return o}}function cH(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function Tg(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function uH(e,t){var r={},n={},a;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(a in t)a in e?r[a]=$d(e[a],t[a]):n[a]=t[a];return function(o){for(a in r)n[a]=r[a](o);return n}}var __=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,b1=new RegExp(__.source,"g");function dH(e){return function(){return e}}function fH(e){return function(t){return e(t)+""}}function hH(e,t){var r=__.lastIndex=b1.lastIndex=0,n,a,o,s=-1,l=[],c=[];for(e=e+"",t=t+"";(n=__.exec(e))&&(a=b1.exec(t));)(o=a.index)>r&&(o=t.slice(r,o),l[s]?l[s]+=o:l[++s]=o),(n=n[0])===(a=a[0])?l[s]?l[s]+=a:l[++s]=a:(l[++s]=null,c.push({i:s,x:Tg(n,a)})),r=b1.lastIndex;return r<t.length&&(o=t.slice(r),l[s]?l[s]+=o:l[++s]=o),l.length<2?c[0]?fH(c[0].x):dH(t):(t=c.length,function(u){for(var d=0,f;d<t;++d)l[(f=c[d]).i]=f.x(u);return l.join("")})}function $d(e,t){var r=typeof t,n;return t==null||r==="boolean"?Ij(t):(r==="number"?Tg:r==="string"?(n=ep(t))?(t=n,KO):hH:t instanceof ep?KO:t instanceof Date?cH:sH(t)?oH:Array.isArray(t)?lH:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?uH:Tg)(e,t)}function Nj(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function pH(e,t){t===void 0&&(t=e,e=$d);for(var r=0,n=t.length-1,a=t[0],o=new Array(n<0?0:n);r<n;)o[r]=e(a,a=t[++r]);return function(s){var l=Math.max(0,Math.min(n-1,Math.floor(s*=n)));return o[l](s-l)}}function mH(e){return function(){return e}}function Eg(e){return+e}var QO=[0,1];function Ri(e){return e}function w_(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:mH(isNaN(t)?NaN:.5)}function gH(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function vH(e,t,r){var n=e[0],a=e[1],o=t[0],s=t[1];return a<n?(n=w_(a,n),o=r(s,o)):(n=w_(n,a),o=r(o,s)),function(l){return o(n(l))}}function yH(e,t,r){var n=Math.min(e.length,t.length)-1,a=new Array(n),o=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<n;)a[s]=w_(e[s],e[s+1]),o[s]=r(t[s],t[s+1]);return function(l){var c=Rp(e,l,1,n)-1;return o[c](a[c](l))}}function Fp(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function ey(){var e=QO,t=QO,r=$d,n,a,o,s=Ri,l,c,u;function d(){var h=Math.min(e.length,t.length);return s!==Ri&&(s=gH(e[0],e[h-1])),l=h>2?yH:vH,c=u=null,f}function f(h){return h==null||isNaN(h=+h)?o:(c||(c=l(e.map(n),t,r)))(n(s(h)))}return f.invert=function(h){return s(a((u||(u=l(t,e.map(n),Tg)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,Eg),d()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),d()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),r=Nj,d()},f.clamp=function(h){return arguments.length?(s=h?!0:Ri,d()):s!==Ri},f.interpolate=function(h){return arguments.length?(r=h,d()):r},f.unknown=function(h){return arguments.length?(o=h,f):o},function(h,p){return n=h,a=p,d()}}function Dj(){return ey()(Ri,Ri)}function xH(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Ig(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function id(e){return e=Ig(Math.abs(e)),e?e[1]:NaN}function bH(e,t){return function(r,n){for(var a=r.length,o=[],s=0,l=e[0],c=0;a>0&&l>0&&(c+l+1>n&&(l=Math.max(1,n-c)),o.push(r.substring(a-=l,a+l)),!((c+=l+1)>n));)l=e[s=(s+1)%e.length];return o.reverse().join(t)}}function _H(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var wH=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function tp(e){if(!(t=wH.exec(e)))throw new Error("invalid format: "+e);var t;return new Mj({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}tp.prototype=Mj.prototype;function Mj(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Mj.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function jH(e){e:for(var t=e.length,r=1,n=-1,a;r<t;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var ED;function SH(e,t){var r=Ig(e,t);if(!r)return e+"";var n=r[0],a=r[1],o=a-(ED=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,s=n.length;return o===s?n:o>s?n+new Array(o-s+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+Ig(e,Math.max(0,t+o-1))[0]}function XO(e,t){var r=Ig(e,t);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}const JO={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:xH,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>XO(e*100,t),r:XO,s:SH,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function ZO(e){return e}var ek=Array.prototype.map,tk=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function CH(e){var t=e.grouping===void 0||e.thousands===void 0?ZO:bH(ek.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?ZO:_H(ek.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function u(f){f=tp(f);var h=f.fill,p=f.align,v=f.sign,m=f.symbol,y=f.zero,b=f.width,_=f.comma,w=f.precision,A=f.trim,P=f.type;P==="n"?(_=!0,P="g"):JO[P]||(w===void 0&&(w=12),A=!0,P="g"),(y||h==="0"&&p==="=")&&(y=!0,h="0",p="=");var T=m==="$"?r:m==="#"&&/[boxX]/.test(P)?"0"+P.toLowerCase():"",E=m==="$"?n:/[%p]/.test(P)?s:"",S=JO[P],I=/[defgprs%]/.test(P);w=w===void 0?6:/[gprs]/.test(P)?Math.max(1,Math.min(21,w)):Math.max(0,Math.min(20,w));function W(O){var D=T,R=E,F,z,K;if(P==="c")R=S(O)+R,O="";else{O=+O;var J=O<0||1/O<0;if(O=isNaN(O)?c:S(Math.abs(O),w),A&&(O=jH(O)),J&&+O==0&&v!=="+"&&(J=!1),D=(J?v==="("?v:l:v==="-"||v==="("?"":v)+D,R=(P==="s"?tk[8+ED/3]:"")+R+(J&&v==="("?")":""),I){for(F=-1,z=O.length;++F<z;)if(K=O.charCodeAt(F),48>K||K>57){R=(K===46?a+O.slice(F+1):O.slice(F))+R,O=O.slice(0,F);break}}}_&&!y&&(O=t(O,1/0));var L=D.length+O.length+R.length,k=L<b?new Array(b-L+1).join(h):"";switch(_&&y&&(O=t(k+O,k.length?b-R.length:1/0),k=""),p){case"<":O=D+O+R+k;break;case"=":O=D+k+O+R;break;case"^":O=k.slice(0,L=k.length>>1)+D+O+R+k.slice(L);break;default:O=k+D+O+R;break}return o(O)}return W.toString=function(){return f+""},W}function d(f,h){var p=u((f=tp(f),f.type="f",f)),v=Math.max(-8,Math.min(8,Math.floor(id(h)/3)))*3,m=Math.pow(10,-v),y=tk[8+v/3];return function(b){return p(m*b)+y}}return{format:u,formatPrefix:d}}var wm,Lj,ID;AH({thousands:",",grouping:[3],currency:["$",""]});function AH(e){return wm=CH(e),Lj=wm.format,ID=wm.formatPrefix,wm}function PH(e){return Math.max(0,-id(Math.abs(e)))}function OH(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(id(t)/3)))*3-id(Math.abs(e)))}function kH(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,id(t)-id(e))+1}function ND(e,t,r,n){var a=y_(e,t,r),o;switch(n=tp(n??",f"),n.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(o=OH(a,s))&&(n.precision=o),ID(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=kH(a,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=PH(a))&&(n.precision=o-(n.type==="%")*2);break}}return Lj(n)}function lc(e){var t=e.domain;return e.ticks=function(r){var n=t();return g_(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var a=t();return ND(a[0],a[a.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),a=0,o=n.length-1,s=n[a],l=n[o],c,u,d=10;for(l<s&&(u=s,s=l,l=u,u=a,a=o,o=u);d-- >0;){if(u=v_(s,l,r),u===c)return n[a]=s,n[o]=l,t(n);if(u>0)s=Math.floor(s/u)*u,l=Math.ceil(l/u)*u;else if(u<0)s=Math.ceil(s*u)/u,l=Math.floor(l*u)/u;else break;c=u}return e},e}function Ng(){var e=Dj();return e.copy=function(){return Fp(e,Ng())},Go.apply(e,arguments),lc(e)}function DD(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,Eg),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return DD(e).unknown(t)},e=arguments.length?Array.from(e,Eg):[0,1],lc(r)}function MD(e,t){e=e.slice();var r=0,n=e.length-1,a=e[r],o=e[n],s;return o<a&&(s=r,r=n,n=s,s=a,a=o,o=s),e[r]=t.floor(a),e[n]=t.ceil(o),e}function rk(e){return Math.log(e)}function nk(e){return Math.exp(e)}function TH(e){return-Math.log(-e)}function EH(e){return-Math.exp(-e)}function IH(e){return isFinite(e)?+("1e"+e):e<0?0:e}function NH(e){return e===10?IH:e===Math.E?Math.exp:t=>Math.pow(e,t)}function DH(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function ak(e){return(t,r)=>-e(-t,r)}function Rj(e){const t=e(rk,nk),r=t.domain;let n=10,a,o;function s(){return a=DH(n),o=NH(n),r()[0]<0?(a=ak(a),o=ak(o),e(TH,EH)):e(rk,nk),t}return t.base=function(l){return arguments.length?(n=+l,s()):n},t.domain=function(l){return arguments.length?(r(l),s()):r()},t.ticks=l=>{const c=r();let u=c[0],d=c[c.length-1];const f=d<u;f&&([u,d]=[d,u]);let h=a(u),p=a(d),v,m;const y=l==null?10:+l;let b=[];if(!(n%1)&&p-h<y){if(h=Math.floor(h),p=Math.ceil(p),u>0){for(;h<=p;++h)for(v=1;v<n;++v)if(m=h<0?v/o(-h):v*o(h),!(m<u)){if(m>d)break;b.push(m)}}else for(;h<=p;++h)for(v=n-1;v>=1;--v)if(m=h>0?v/o(-h):v*o(h),!(m<u)){if(m>d)break;b.push(m)}b.length*2<y&&(b=g_(u,d,y))}else b=g_(h,p,Math.min(p-h,y)).map(o);return f?b.reverse():b},t.tickFormat=(l,c)=>{if(l==null&&(l=10),c==null&&(c=n===10?"s":","),typeof c!="function"&&(!(n%1)&&(c=tp(c)).precision==null&&(c.trim=!0),c=Lj(c)),l===1/0)return c;const u=Math.max(1,n*l/t.ticks().length);return d=>{let f=d/o(Math.round(a(d)));return f*n<n-.5&&(f*=n),f<=u?c(d):""}},t.nice=()=>r(MD(r(),{floor:l=>o(Math.floor(a(l))),ceil:l=>o(Math.ceil(a(l)))})),t}function LD(){const e=Rj(ey()).domain([1,10]);return e.copy=()=>Fp(e,LD()).base(e.base()),Go.apply(e,arguments),e}function ik(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function ok(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function qj(e){var t=1,r=e(ik(t),ok(t));return r.constant=function(n){return arguments.length?e(ik(t=+n),ok(t)):t},lc(r)}function RD(){var e=qj(ey());return e.copy=function(){return Fp(e,RD()).constant(e.constant())},Go.apply(e,arguments)}function sk(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function MH(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function LH(e){return e<0?-e*e:e*e}function Fj(e){var t=e(Ri,Ri),r=1;function n(){return r===1?e(Ri,Ri):r===.5?e(MH,LH):e(sk(r),sk(1/r))}return t.exponent=function(a){return arguments.length?(r=+a,n()):r},lc(t)}function $j(){var e=Fj(ey());return e.copy=function(){return Fp(e,$j()).exponent(e.exponent())},Go.apply(e,arguments),e}function RH(){return $j.apply(null,arguments).exponent(.5)}function lk(e){return Math.sign(e)*e*e}function qH(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function qD(){var e=Dj(),t=[0,1],r=!1,n;function a(o){var s=qH(e(o));return isNaN(s)?n:r?Math.round(s):s}return a.invert=function(o){return e.invert(lk(o))},a.domain=function(o){return arguments.length?(e.domain(o),a):e.domain()},a.range=function(o){return arguments.length?(e.range((t=Array.from(o,Eg)).map(lk)),a):t.slice()},a.rangeRound=function(o){return a.range(o).round(!0)},a.round=function(o){return arguments.length?(r=!!o,a):r},a.clamp=function(o){return arguments.length?(e.clamp(o),a):e.clamp()},a.unknown=function(o){return arguments.length?(n=o,a):n},a.copy=function(){return qD(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},Go.apply(a,arguments),lc(a)}function FD(){var e=[],t=[],r=[],n;function a(){var s=0,l=Math.max(1,t.length);for(r=new Array(l-1);++s<l;)r[s-1]=z9(e,s/l);return o}function o(s){return s==null||isNaN(s=+s)?n:t[Rp(r,s)]}return o.invertExtent=function(s){var l=t.indexOf(s);return l<0?[NaN,NaN]:[l>0?r[l-1]:e[0],l<r.length?r[l]:e[e.length-1]]},o.domain=function(s){if(!arguments.length)return e.slice();e=[];for(let l of s)l!=null&&!isNaN(l=+l)&&e.push(l);return e.sort(Zl),a()},o.range=function(s){return arguments.length?(t=Array.from(s),a()):t.slice()},o.unknown=function(s){return arguments.length?(n=s,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return FD().domain(e).range(t).unknown(n)},Go.apply(o,arguments)}function $D(){var e=0,t=1,r=1,n=[.5],a=[0,1],o;function s(c){return c!=null&&c<=c?a[Rp(n,c,0,r)]:o}function l(){var c=-1;for(n=new Array(r);++c<r;)n[c]=((c+1)*t-(c-r)*e)/(r+1);return s}return s.domain=function(c){return arguments.length?([e,t]=c,e=+e,t=+t,l()):[e,t]},s.range=function(c){return arguments.length?(r=(a=Array.from(c)).length-1,l()):a.slice()},s.invertExtent=function(c){var u=a.indexOf(c);return u<0?[NaN,NaN]:u<1?[e,n[0]]:u>=r?[n[r-1],t]:[n[u-1],n[u]]},s.unknown=function(c){return arguments.length&&(o=c),s},s.thresholds=function(){return n.slice()},s.copy=function(){return $D().domain([e,t]).range(a).unknown(o)},Go.apply(lc(s),arguments)}function BD(){var e=[.5],t=[0,1],r,n=1;function a(o){return o!=null&&o<=o?t[Rp(e,o,0,n)]:r}return a.domain=function(o){return arguments.length?(e=Array.from(o),n=Math.min(e.length,t.length-1),a):e.slice()},a.range=function(o){return arguments.length?(t=Array.from(o),n=Math.min(e.length,t.length-1),a):t.slice()},a.invertExtent=function(o){var s=t.indexOf(o);return[e[s-1],e[s]]},a.unknown=function(o){return arguments.length?(r=o,a):r},a.copy=function(){return BD().domain(e).range(t).unknown(r)},Go.apply(a,arguments)}const _1=new Date,w1=new Date;function Ga(e,t,r,n){function a(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return a.floor=o=>(e(o=new Date(+o)),o),a.ceil=o=>(e(o=new Date(o-1)),t(o,1),e(o),o),a.round=o=>{const s=a(o),l=a.ceil(o);return o-s<l-o?s:l},a.offset=(o,s)=>(t(o=new Date(+o),s==null?1:Math.floor(s)),o),a.range=(o,s,l)=>{const c=[];if(o=a.ceil(o),l=l==null?1:Math.floor(l),!(o<s)||!(l>0))return c;let u;do c.push(u=new Date(+o)),t(o,l),e(o);while(u<o&&o<s);return c},a.filter=o=>Ga(s=>{if(s>=s)for(;e(s),!o(s);)s.setTime(s-1)},(s,l)=>{if(s>=s)if(l<0)for(;++l<=0;)for(;t(s,-1),!o(s););else for(;--l>=0;)for(;t(s,1),!o(s););}),r&&(a.count=(o,s)=>(_1.setTime(+o),w1.setTime(+s),e(_1),e(w1),Math.floor(r(_1,w1))),a.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?a.filter(n?s=>n(s)%o===0:s=>a.count(0,s)%o===0):a)),a}const Dg=Ga(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);Dg.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ga(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):Dg);Dg.range;const il=1e3,Ho=il*60,ol=Ho*60,ml=ol*24,Bj=ml*7,ck=ml*30,j1=ml*365,Rc=Ga(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*il)},(e,t)=>(t-e)/il,e=>e.getUTCSeconds());Rc.range;const Uj=Ga(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*il)},(e,t)=>{e.setTime(+e+t*Ho)},(e,t)=>(t-e)/Ho,e=>e.getMinutes());Uj.range;const zj=Ga(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Ho)},(e,t)=>(t-e)/Ho,e=>e.getUTCMinutes());zj.range;const Wj=Ga(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*il-e.getMinutes()*Ho)},(e,t)=>{e.setTime(+e+t*ol)},(e,t)=>(t-e)/ol,e=>e.getHours());Wj.range;const Hj=Ga(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*ol)},(e,t)=>(t-e)/ol,e=>e.getUTCHours());Hj.range;const $p=Ga(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Ho)/ml,e=>e.getDate()-1);$p.range;const ty=Ga(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/ml,e=>e.getUTCDate()-1);ty.range;const UD=Ga(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/ml,e=>Math.floor(e/ml));UD.range;function ou(e){return Ga(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*Ho)/Bj)}const ry=ou(0),Mg=ou(1),FH=ou(2),$H=ou(3),od=ou(4),BH=ou(5),UH=ou(6);ry.range;Mg.range;FH.range;$H.range;od.range;BH.range;UH.range;function su(e){return Ga(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/Bj)}const ny=su(0),Lg=su(1),zH=su(2),WH=su(3),sd=su(4),HH=su(5),VH=su(6);ny.range;Lg.range;zH.range;WH.range;sd.range;HH.range;VH.range;const Vj=Ga(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());Vj.range;const Gj=Ga(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());Gj.range;const gl=Ga(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());gl.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ga(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});gl.range;const vl=Ga(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());vl.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ga(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});vl.range;function zD(e,t,r,n,a,o){const s=[[Rc,1,il],[Rc,5,5*il],[Rc,15,15*il],[Rc,30,30*il],[o,1,Ho],[o,5,5*Ho],[o,15,15*Ho],[o,30,30*Ho],[a,1,ol],[a,3,3*ol],[a,6,6*ol],[a,12,12*ol],[n,1,ml],[n,2,2*ml],[r,1,Bj],[t,1,ck],[t,3,3*ck],[e,1,j1]];function l(u,d,f){const h=d<u;h&&([u,d]=[d,u]);const p=f&&typeof f.range=="function"?f:c(u,d,f),v=p?p.range(u,+d+1):[];return h?v.reverse():v}function c(u,d,f){const h=Math.abs(d-u)/f,p=kj(([,,y])=>y).right(s,h);if(p===s.length)return e.every(y_(u/j1,d/j1,f));if(p===0)return Dg.every(Math.max(y_(u,d,f),1));const[v,m]=s[h/s[p-1][2]<s[p][2]/h?p-1:p];return v.every(m)}return[l,c]}const[GH,YH]=zD(vl,Gj,ny,UD,Hj,zj),[KH,QH]=zD(gl,Vj,ry,$p,Wj,Uj);function S1(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function C1(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function ff(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function XH(e){var t=e.dateTime,r=e.date,n=e.time,a=e.periods,o=e.days,s=e.shortDays,l=e.months,c=e.shortMonths,u=hf(a),d=pf(a),f=hf(o),h=pf(o),p=hf(s),v=pf(s),m=hf(l),y=pf(l),b=hf(c),_=pf(c),w={a:J,A:L,b:k,B:$,c:null,d:mk,e:mk,f:bV,g:TV,G:IV,H:vV,I:yV,j:xV,L:WD,m:_V,M:wV,p:X,q:C,Q:yk,s:xk,S:jV,u:SV,U:CV,V:AV,w:PV,W:OV,x:null,X:null,y:kV,Y:EV,Z:NV,"%":vk},A={a:M,A:H,b:U,B:te,c:null,d:gk,e:gk,f:RV,g:GV,G:KV,H:DV,I:MV,j:LV,L:VD,m:qV,M:FV,p:le,q:oe,Q:yk,s:xk,S:$V,u:BV,U:UV,V:zV,w:WV,W:HV,x:null,X:null,y:VV,Y:YV,Z:QV,"%":vk},P={a:W,A:O,b:D,B:R,c:F,d:hk,e:hk,f:hV,g:fk,G:dk,H:pk,I:pk,j:cV,L:fV,m:lV,M:uV,p:I,q:sV,Q:mV,s:gV,S:dV,u:rV,U:nV,V:aV,w:tV,W:iV,x:z,X:K,y:fk,Y:dk,Z:oV,"%":pV};w.x=T(r,w),w.X=T(n,w),w.c=T(t,w),A.x=T(r,A),A.X=T(n,A),A.c=T(t,A);function T(ae,he){return function(me){var Q=[],G=-1,ee=0,se=ae.length,V,Ge,De;for(me instanceof Date||(me=new Date(+me));++G<se;)ae.charCodeAt(G)===37&&(Q.push(ae.slice(ee,G)),(Ge=uk[V=ae.charAt(++G)])!=null?V=ae.charAt(++G):Ge=V==="e"?" ":"0",(De=he[V])&&(V=De(me,Ge)),Q.push(V),ee=G+1);return Q.push(ae.slice(ee,G)),Q.join("")}}function E(ae,he){return function(me){var Q=ff(1900,void 0,1),G=S(Q,ae,me+="",0),ee,se;if(G!=me.length)return null;if("Q"in Q)return new Date(Q.Q);if("s"in Q)return new Date(Q.s*1e3+("L"in Q?Q.L:0));if(he&&!("Z"in Q)&&(Q.Z=0),"p"in Q&&(Q.H=Q.H%12+Q.p*12),Q.m===void 0&&(Q.m="q"in Q?Q.q:0),"V"in Q){if(Q.V<1||Q.V>53)return null;"w"in Q||(Q.w=1),"Z"in Q?(ee=C1(ff(Q.y,0,1)),se=ee.getUTCDay(),ee=se>4||se===0?Lg.ceil(ee):Lg(ee),ee=ty.offset(ee,(Q.V-1)*7),Q.y=ee.getUTCFullYear(),Q.m=ee.getUTCMonth(),Q.d=ee.getUTCDate()+(Q.w+6)%7):(ee=S1(ff(Q.y,0,1)),se=ee.getDay(),ee=se>4||se===0?Mg.ceil(ee):Mg(ee),ee=$p.offset(ee,(Q.V-1)*7),Q.y=ee.getFullYear(),Q.m=ee.getMonth(),Q.d=ee.getDate()+(Q.w+6)%7)}else("W"in Q||"U"in Q)&&("w"in Q||(Q.w="u"in Q?Q.u%7:"W"in Q?1:0),se="Z"in Q?C1(ff(Q.y,0,1)).getUTCDay():S1(ff(Q.y,0,1)).getDay(),Q.m=0,Q.d="W"in Q?(Q.w+6)%7+Q.W*7-(se+5)%7:Q.w+Q.U*7-(se+6)%7);return"Z"in Q?(Q.H+=Q.Z/100|0,Q.M+=Q.Z%100,C1(Q)):S1(Q)}}function S(ae,he,me,Q){for(var G=0,ee=he.length,se=me.length,V,Ge;G<ee;){if(Q>=se)return-1;if(V=he.charCodeAt(G++),V===37){if(V=he.charAt(G++),Ge=P[V in uk?he.charAt(G++):V],!Ge||(Q=Ge(ae,me,Q))<0)return-1}else if(V!=me.charCodeAt(Q++))return-1}return Q}function I(ae,he,me){var Q=u.exec(he.slice(me));return Q?(ae.p=d.get(Q[0].toLowerCase()),me+Q[0].length):-1}function W(ae,he,me){var Q=p.exec(he.slice(me));return Q?(ae.w=v.get(Q[0].toLowerCase()),me+Q[0].length):-1}function O(ae,he,me){var Q=f.exec(he.slice(me));return Q?(ae.w=h.get(Q[0].toLowerCase()),me+Q[0].length):-1}function D(ae,he,me){var Q=b.exec(he.slice(me));return Q?(ae.m=_.get(Q[0].toLowerCase()),me+Q[0].length):-1}function R(ae,he,me){var Q=m.exec(he.slice(me));return Q?(ae.m=y.get(Q[0].toLowerCase()),me+Q[0].length):-1}function F(ae,he,me){return S(ae,t,he,me)}function z(ae,he,me){return S(ae,r,he,me)}function K(ae,he,me){return S(ae,n,he,me)}function J(ae){return s[ae.getDay()]}function L(ae){return o[ae.getDay()]}function k(ae){return c[ae.getMonth()]}function $(ae){return l[ae.getMonth()]}function X(ae){return a[+(ae.getHours()>=12)]}function C(ae){return 1+~~(ae.getMonth()/3)}function M(ae){return s[ae.getUTCDay()]}function H(ae){return o[ae.getUTCDay()]}function U(ae){return c[ae.getUTCMonth()]}function te(ae){return l[ae.getUTCMonth()]}function le(ae){return a[+(ae.getUTCHours()>=12)]}function oe(ae){return 1+~~(ae.getUTCMonth()/3)}return{format:function(ae){var he=T(ae+="",w);return he.toString=function(){return ae},he},parse:function(ae){var he=E(ae+="",!1);return he.toString=function(){return ae},he},utcFormat:function(ae){var he=T(ae+="",A);return he.toString=function(){return ae},he},utcParse:function(ae){var he=E(ae+="",!0);return he.toString=function(){return ae},he}}}var uk={"-":"",_:" ",0:"0"},ri=/^\s*\d+/,JH=/^%/,ZH=/[\\^$*+?|[\]().{}]/g;function dn(e,t,r){var n=e<0?"-":"",a=(n?-e:e)+"",o=a.length;return n+(o<r?new Array(r-o+1).join(t)+a:a)}function eV(e){return e.replace(ZH,"\\$&")}function hf(e){return new RegExp("^(?:"+e.map(eV).join("|")+")","i")}function pf(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function tV(e,t,r){var n=ri.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function rV(e,t,r){var n=ri.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function nV(e,t,r){var n=ri.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function aV(e,t,r){var n=ri.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function iV(e,t,r){var n=ri.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function dk(e,t,r){var n=ri.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function fk(e,t,r){var n=ri.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function oV(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function sV(e,t,r){var n=ri.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function lV(e,t,r){var n=ri.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function hk(e,t,r){var n=ri.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function cV(e,t,r){var n=ri.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function pk(e,t,r){var n=ri.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function uV(e,t,r){var n=ri.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function dV(e,t,r){var n=ri.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function fV(e,t,r){var n=ri.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function hV(e,t,r){var n=ri.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function pV(e,t,r){var n=JH.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function mV(e,t,r){var n=ri.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function gV(e,t,r){var n=ri.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function mk(e,t){return dn(e.getDate(),t,2)}function vV(e,t){return dn(e.getHours(),t,2)}function yV(e,t){return dn(e.getHours()%12||12,t,2)}function xV(e,t){return dn(1+$p.count(gl(e),e),t,3)}function WD(e,t){return dn(e.getMilliseconds(),t,3)}function bV(e,t){return WD(e,t)+"000"}function _V(e,t){return dn(e.getMonth()+1,t,2)}function wV(e,t){return dn(e.getMinutes(),t,2)}function jV(e,t){return dn(e.getSeconds(),t,2)}function SV(e){var t=e.getDay();return t===0?7:t}function CV(e,t){return dn(ry.count(gl(e)-1,e),t,2)}function HD(e){var t=e.getDay();return t>=4||t===0?od(e):od.ceil(e)}function AV(e,t){return e=HD(e),dn(od.count(gl(e),e)+(gl(e).getDay()===4),t,2)}function PV(e){return e.getDay()}function OV(e,t){return dn(Mg.count(gl(e)-1,e),t,2)}function kV(e,t){return dn(e.getFullYear()%100,t,2)}function TV(e,t){return e=HD(e),dn(e.getFullYear()%100,t,2)}function EV(e,t){return dn(e.getFullYear()%1e4,t,4)}function IV(e,t){var r=e.getDay();return e=r>=4||r===0?od(e):od.ceil(e),dn(e.getFullYear()%1e4,t,4)}function NV(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+dn(t/60|0,"0",2)+dn(t%60,"0",2)}function gk(e,t){return dn(e.getUTCDate(),t,2)}function DV(e,t){return dn(e.getUTCHours(),t,2)}function MV(e,t){return dn(e.getUTCHours()%12||12,t,2)}function LV(e,t){return dn(1+ty.count(vl(e),e),t,3)}function VD(e,t){return dn(e.getUTCMilliseconds(),t,3)}function RV(e,t){return VD(e,t)+"000"}function qV(e,t){return dn(e.getUTCMonth()+1,t,2)}function FV(e,t){return dn(e.getUTCMinutes(),t,2)}function $V(e,t){return dn(e.getUTCSeconds(),t,2)}function BV(e){var t=e.getUTCDay();return t===0?7:t}function UV(e,t){return dn(ny.count(vl(e)-1,e),t,2)}function GD(e){var t=e.getUTCDay();return t>=4||t===0?sd(e):sd.ceil(e)}function zV(e,t){return e=GD(e),dn(sd.count(vl(e),e)+(vl(e).getUTCDay()===4),t,2)}function WV(e){return e.getUTCDay()}function HV(e,t){return dn(Lg.count(vl(e)-1,e),t,2)}function VV(e,t){return dn(e.getUTCFullYear()%100,t,2)}function GV(e,t){return e=GD(e),dn(e.getUTCFullYear()%100,t,2)}function YV(e,t){return dn(e.getUTCFullYear()%1e4,t,4)}function KV(e,t){var r=e.getUTCDay();return e=r>=4||r===0?sd(e):sd.ceil(e),dn(e.getUTCFullYear()%1e4,t,4)}function QV(){return"+0000"}function vk(){return"%"}function yk(e){return+e}function xk(e){return Math.floor(+e/1e3)}var bu,YD,KD;XV({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function XV(e){return bu=XH(e),YD=bu.format,bu.parse,KD=bu.utcFormat,bu.utcParse,bu}function JV(e){return new Date(e)}function ZV(e){return e instanceof Date?+e:+new Date(+e)}function Yj(e,t,r,n,a,o,s,l,c,u){var d=Dj(),f=d.invert,h=d.domain,p=u(".%L"),v=u(":%S"),m=u("%I:%M"),y=u("%I %p"),b=u("%a %d"),_=u("%b %d"),w=u("%B"),A=u("%Y");function P(T){return(c(T)<T?p:l(T)<T?v:s(T)<T?m:o(T)<T?y:n(T)<T?a(T)<T?b:_:r(T)<T?w:A)(T)}return d.invert=function(T){return new Date(f(T))},d.domain=function(T){return arguments.length?h(Array.from(T,ZV)):h().map(JV)},d.ticks=function(T){var E=h();return e(E[0],E[E.length-1],T??10)},d.tickFormat=function(T,E){return E==null?P:u(E)},d.nice=function(T){var E=h();return(!T||typeof T.range!="function")&&(T=t(E[0],E[E.length-1],T??10)),T?h(MD(E,T)):d},d.copy=function(){return Fp(d,Yj(e,t,r,n,a,o,s,l,c,u))},d}function eG(){return Go.apply(Yj(KH,QH,gl,Vj,ry,$p,Wj,Uj,Rc,YD).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function tG(){return Go.apply(Yj(GH,YH,vl,Gj,ny,ty,Hj,zj,Rc,KD).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function ay(){var e=0,t=1,r,n,a,o,s=Ri,l=!1,c;function u(f){return f==null||isNaN(f=+f)?c:s(a===0?.5:(f=(o(f)-r)*a,l?Math.max(0,Math.min(1,f)):f))}u.domain=function(f){return arguments.length?([e,t]=f,r=o(e=+e),n=o(t=+t),a=r===n?0:1/(n-r),u):[e,t]},u.clamp=function(f){return arguments.length?(l=!!f,u):l},u.interpolator=function(f){return arguments.length?(s=f,u):s};function d(f){return function(h){var p,v;return arguments.length?([p,v]=h,s=f(p,v),u):[s(0),s(1)]}}return u.range=d($d),u.rangeRound=d(Nj),u.unknown=function(f){return arguments.length?(c=f,u):c},function(f){return o=f,r=f(e),n=f(t),a=r===n?0:1/(n-r),u}}function cc(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function QD(){var e=lc(ay()(Ri));return e.copy=function(){return cc(e,QD())},jl.apply(e,arguments)}function XD(){var e=Rj(ay()).domain([1,10]);return e.copy=function(){return cc(e,XD()).base(e.base())},jl.apply(e,arguments)}function JD(){var e=qj(ay());return e.copy=function(){return cc(e,JD()).constant(e.constant())},jl.apply(e,arguments)}function Kj(){var e=Fj(ay());return e.copy=function(){return cc(e,Kj()).exponent(e.exponent())},jl.apply(e,arguments)}function rG(){return Kj.apply(null,arguments).exponent(.5)}function ZD(){var e=[],t=Ri;function r(n){if(n!=null&&!isNaN(n=+n))return t((Rp(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let a of n)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(Zl),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,a)=>t(a/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(a,o)=>U9(e,o/n))},r.copy=function(){return ZD(t).domain(e)},jl.apply(r,arguments)}function iy(){var e=0,t=.5,r=1,n=1,a,o,s,l,c,u=Ri,d,f=!1,h;function p(m){return isNaN(m=+m)?h:(m=.5+((m=+d(m))-o)*(n*m<n*o?l:c),u(f?Math.max(0,Math.min(1,m)):m))}p.domain=function(m){return arguments.length?([e,t,r]=m,a=d(e=+e),o=d(t=+t),s=d(r=+r),l=a===o?0:.5/(o-a),c=o===s?0:.5/(s-o),n=o<a?-1:1,p):[e,t,r]},p.clamp=function(m){return arguments.length?(f=!!m,p):f},p.interpolator=function(m){return arguments.length?(u=m,p):u};function v(m){return function(y){var b,_,w;return arguments.length?([b,_,w]=y,u=pH(m,[b,_,w]),p):[u(0),u(.5),u(1)]}}return p.range=v($d),p.rangeRound=v(Nj),p.unknown=function(m){return arguments.length?(h=m,p):h},function(m){return d=m,a=m(e),o=m(t),s=m(r),l=a===o?0:.5/(o-a),c=o===s?0:.5/(s-o),n=o<a?-1:1,p}}function eM(){var e=lc(iy()(Ri));return e.copy=function(){return cc(e,eM())},jl.apply(e,arguments)}function tM(){var e=Rj(iy()).domain([.1,1,10]);return e.copy=function(){return cc(e,tM()).base(e.base())},jl.apply(e,arguments)}function rM(){var e=qj(iy());return e.copy=function(){return cc(e,rM()).constant(e.constant())},jl.apply(e,arguments)}function Qj(){var e=Fj(iy());return e.copy=function(){return cc(e,Qj()).exponent(e.exponent())},jl.apply(e,arguments)}function nG(){return Qj.apply(null,arguments).exponent(.5)}const bk=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:Xh,scaleDiverging:eM,scaleDivergingLog:tM,scaleDivergingPow:Qj,scaleDivergingSqrt:nG,scaleDivergingSymlog:rM,scaleIdentity:DD,scaleImplicit:x_,scaleLinear:Ng,scaleLog:LD,scaleOrdinal:Tj,scalePoint:Th,scalePow:$j,scaleQuantile:FD,scaleQuantize:$D,scaleRadial:qD,scaleSequential:QD,scaleSequentialLog:XD,scaleSequentialPow:Kj,scaleSequentialQuantile:ZD,scaleSequentialSqrt:rG,scaleSequentialSymlog:JD,scaleSqrt:RH,scaleSymlog:RD,scaleThreshold:BD,scaleTime:eG,scaleUtc:tG,tickFormat:ND},Symbol.toStringTag,{value:"Module"}));var A1,_k;function oy(){if(_k)return A1;_k=1;var e=Ld();function t(r,n,a){for(var o=-1,s=r.length;++o<s;){var l=r[o],c=n(l);if(c!=null&&(u===void 0?c===c&&!e(c):a(c,u)))var u=c,d=l}return d}return A1=t,A1}var P1,wk;function nM(){if(wk)return P1;wk=1;function e(t,r){return t>r}return P1=e,P1}var O1,jk;function aG(){if(jk)return O1;jk=1;var e=oy(),t=nM(),r=Fd();function n(a){return a&&a.length?e(a,r,t):void 0}return O1=n,O1}var iG=aG();const sy=Et(iG);var k1,Sk;function aM(){if(Sk)return k1;Sk=1;function e(t,r){return t<r}return k1=e,k1}var T1,Ck;function oG(){if(Ck)return T1;Ck=1;var e=oy(),t=aM(),r=Fd();function n(a){return a&&a.length?e(a,r,t):void 0}return T1=n,T1}var sG=oG();const ly=Et(sG);var E1,Ak;function lG(){if(Ak)return E1;Ak=1;var e=fj(),t=Rs(),r=dD(),n=Zi();function a(o,s){var l=n(o)?e:r;return l(o,t(s,3))}return E1=a,E1}var I1,Pk;function cG(){if(Pk)return I1;Pk=1;var e=cD(),t=lG();function r(n,a){return e(t(n,a),1)}return I1=r,I1}var uG=cG();const dG=Et(uG);var N1,Ok;function fG(){if(Ok)return N1;Ok=1;var e=Cj();function t(r,n){return e(r,n)}return N1=t,N1}var hG=fG();const Bp=Et(hG);var Bd=1e9,pG={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Jj,Xn=!0,Vo="[DecimalError] ",Bc=Vo+"Invalid argument: ",Xj=Vo+"Exponent out of range: ",Ud=Math.floor,Oc=Math.pow,mG=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,wo,Ja=1e7,zn=7,iM=9007199254740991,Rg=Ud(iM/zn),Xt={};Xt.absoluteValue=Xt.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Xt.comparedTo=Xt.cmp=function(e){var t,r,n,a,o=this;if(e=new o.constructor(e),o.s!==e.s)return o.s||-e.s;if(o.e!==e.e)return o.e>e.e^o.s<0?1:-1;for(n=o.d.length,a=e.d.length,t=0,r=n<a?n:a;t<r;++t)if(o.d[t]!==e.d[t])return o.d[t]>e.d[t]^o.s<0?1:-1;return n===a?0:n>a^o.s<0?1:-1};Xt.decimalPlaces=Xt.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*zn;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};Xt.dividedBy=Xt.div=function(e){return dl(this,new this.constructor(e))};Xt.dividedToIntegerBy=Xt.idiv=function(e){var t=this,r=t.constructor;return kn(dl(t,new r(e),0,1),r.precision)};Xt.equals=Xt.eq=function(e){return!this.cmp(e)};Xt.exponent=function(){return qa(this)};Xt.greaterThan=Xt.gt=function(e){return this.cmp(e)>0};Xt.greaterThanOrEqualTo=Xt.gte=function(e){return this.cmp(e)>=0};Xt.isInteger=Xt.isint=function(){return this.e>this.d.length-2};Xt.isNegative=Xt.isneg=function(){return this.s<0};Xt.isPositive=Xt.ispos=function(){return this.s>0};Xt.isZero=function(){return this.s===0};Xt.lessThan=Xt.lt=function(e){return this.cmp(e)<0};Xt.lessThanOrEqualTo=Xt.lte=function(e){return this.cmp(e)<1};Xt.logarithm=Xt.log=function(e){var t,r=this,n=r.constructor,a=n.precision,o=a+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(wo))throw Error(Vo+"NaN");if(r.s<1)throw Error(Vo+(r.s?"NaN":"-Infinity"));return r.eq(wo)?new n(0):(Xn=!1,t=dl(rp(r,o),rp(e,o),o),Xn=!0,kn(t,a))};Xt.minus=Xt.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?lM(t,e):oM(t,(e.s=-e.s,e))};Xt.modulo=Xt.mod=function(e){var t,r=this,n=r.constructor,a=n.precision;if(e=new n(e),!e.s)throw Error(Vo+"NaN");return r.s?(Xn=!1,t=dl(r,e,0,1).times(e),Xn=!0,r.minus(t)):kn(new n(r),a)};Xt.naturalExponential=Xt.exp=function(){return sM(this)};Xt.naturalLogarithm=Xt.ln=function(){return rp(this)};Xt.negated=Xt.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Xt.plus=Xt.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?oM(t,e):lM(t,(e.s=-e.s,e))};Xt.precision=Xt.sd=function(e){var t,r,n,a=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Bc+e);if(t=qa(a)+1,n=a.d.length-1,r=n*zn+1,n=a.d[n],n){for(;n%10==0;n/=10)r--;for(n=a.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};Xt.squareRoot=Xt.sqrt=function(){var e,t,r,n,a,o,s,l=this,c=l.constructor;if(l.s<1){if(!l.s)return new c(0);throw Error(Vo+"NaN")}for(e=qa(l),Xn=!1,a=Math.sqrt(+l),a==0||a==1/0?(t=ws(l.d),(t.length+e)%2==0&&(t+="0"),a=Math.sqrt(t),e=Ud((e+1)/2)-(e<0||e%2),a==1/0?t="5e"+e:(t=a.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new c(t)):n=new c(a.toString()),r=c.precision,a=s=r+3;;)if(o=n,n=o.plus(dl(l,o,s+2)).times(.5),ws(o.d).slice(0,s)===(t=ws(n.d)).slice(0,s)){if(t=t.slice(s-3,s+1),a==s&&t=="4999"){if(kn(o,r+1,0),o.times(o).eq(l)){n=o;break}}else if(t!="9999")break;s+=4}return Xn=!0,kn(n,r)};Xt.times=Xt.mul=function(e){var t,r,n,a,o,s,l,c,u,d=this,f=d.constructor,h=d.d,p=(e=new f(e)).d;if(!d.s||!e.s)return new f(0);for(e.s*=d.s,r=d.e+e.e,c=h.length,u=p.length,c<u&&(o=h,h=p,p=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(t=0,a=c+n;a>n;)l=o[a]+p[n]*h[a-n-1]+t,o[a--]=l%Ja|0,t=l/Ja|0;o[a]=(o[a]+t)%Ja|0}for(;!o[--s];)o.pop();return t?++r:o.shift(),e.d=o,e.e=r,Xn?kn(e,f.precision):e};Xt.toDecimalPlaces=Xt.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(ks(e,0,Bd),t===void 0?t=n.rounding:ks(t,0,8),kn(r,e+qa(r)+1,t))};Xt.toExponential=function(e,t){var r,n=this,a=n.constructor;return e===void 0?r=Qc(n,!0):(ks(e,0,Bd),t===void 0?t=a.rounding:ks(t,0,8),n=kn(new a(n),e+1,t),r=Qc(n,!0,e+1)),r};Xt.toFixed=function(e,t){var r,n,a=this,o=a.constructor;return e===void 0?Qc(a):(ks(e,0,Bd),t===void 0?t=o.rounding:ks(t,0,8),n=kn(new o(a),e+qa(a)+1,t),r=Qc(n.abs(),!1,e+qa(n)+1),a.isneg()&&!a.isZero()?"-"+r:r)};Xt.toInteger=Xt.toint=function(){var e=this,t=e.constructor;return kn(new t(e),qa(e)+1,t.rounding)};Xt.toNumber=function(){return+this};Xt.toPower=Xt.pow=function(e){var t,r,n,a,o,s,l=this,c=l.constructor,u=12,d=+(e=new c(e));if(!e.s)return new c(wo);if(l=new c(l),!l.s){if(e.s<1)throw Error(Vo+"Infinity");return l}if(l.eq(wo))return l;if(n=c.precision,e.eq(wo))return kn(l,n);if(t=e.e,r=e.d.length-1,s=t>=r,o=l.s,s){if((r=d<0?-d:d)<=iM){for(a=new c(wo),t=Math.ceil(n/zn+4),Xn=!1;r%2&&(a=a.times(l),Tk(a.d,t)),r=Ud(r/2),r!==0;)l=l.times(l),Tk(l.d,t);return Xn=!0,e.s<0?new c(wo).div(a):kn(a,n)}}else if(o<0)throw Error(Vo+"NaN");return o=o<0&&e.d[Math.max(t,r)]&1?-1:1,l.s=1,Xn=!1,a=e.times(rp(l,n+u)),Xn=!0,a=sM(a),a.s=o,a};Xt.toPrecision=function(e,t){var r,n,a=this,o=a.constructor;return e===void 0?(r=qa(a),n=Qc(a,r<=o.toExpNeg||r>=o.toExpPos)):(ks(e,1,Bd),t===void 0?t=o.rounding:ks(t,0,8),a=kn(new o(a),e,t),r=qa(a),n=Qc(a,e<=r||r<=o.toExpNeg,e)),n};Xt.toSignificantDigits=Xt.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(ks(e,1,Bd),t===void 0?t=n.rounding:ks(t,0,8)),kn(new n(r),e,t)};Xt.toString=Xt.valueOf=Xt.val=Xt.toJSON=Xt[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=qa(e),r=e.constructor;return Qc(e,t<=r.toExpNeg||t>=r.toExpPos)};function oM(e,t){var r,n,a,o,s,l,c,u,d=e.constructor,f=d.precision;if(!e.s||!t.s)return t.s||(t=new d(e)),Xn?kn(t,f):t;if(c=e.d,u=t.d,s=e.e,a=t.e,c=c.slice(),o=s-a,o){for(o<0?(n=c,o=-o,l=u.length):(n=u,a=s,l=c.length),s=Math.ceil(f/zn),l=s>l?s+1:l+1,o>l&&(o=l,n.length=1),n.reverse();o--;)n.push(0);n.reverse()}for(l=c.length,o=u.length,l-o<0&&(o=l,n=u,u=c,c=n),r=0;o;)r=(c[--o]=c[o]+u[o]+r)/Ja|0,c[o]%=Ja;for(r&&(c.unshift(r),++a),l=c.length;c[--l]==0;)c.pop();return t.d=c,t.e=a,Xn?kn(t,f):t}function ks(e,t,r){if(e!==~~e||e<t||e>r)throw Error(Bc+e)}function ws(e){var t,r,n,a=e.length-1,o="",s=e[0];if(a>0){for(o+=s,t=1;t<a;t++)n=e[t]+"",r=zn-n.length,r&&(o+=Hl(r)),o+=n;s=e[t],n=s+"",r=zn-n.length,r&&(o+=Hl(r))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}var dl=function(){function e(n,a){var o,s=0,l=n.length;for(n=n.slice();l--;)o=n[l]*a+s,n[l]=o%Ja|0,s=o/Ja|0;return s&&n.unshift(s),n}function t(n,a,o,s){var l,c;if(o!=s)c=o>s?1:-1;else for(l=c=0;l<o;l++)if(n[l]!=a[l]){c=n[l]>a[l]?1:-1;break}return c}function r(n,a,o){for(var s=0;o--;)n[o]-=s,s=n[o]<a[o]?1:0,n[o]=s*Ja+n[o]-a[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,a,o,s){var l,c,u,d,f,h,p,v,m,y,b,_,w,A,P,T,E,S,I=n.constructor,W=n.s==a.s?1:-1,O=n.d,D=a.d;if(!n.s)return new I(n);if(!a.s)throw Error(Vo+"Division by zero");for(c=n.e-a.e,E=D.length,P=O.length,p=new I(W),v=p.d=[],u=0;D[u]==(O[u]||0);)++u;if(D[u]>(O[u]||0)&&--c,o==null?_=o=I.precision:s?_=o+(qa(n)-qa(a))+1:_=o,_<0)return new I(0);if(_=_/zn+2|0,u=0,E==1)for(d=0,D=D[0],_++;(u<P||d)&&_--;u++)w=d*Ja+(O[u]||0),v[u]=w/D|0,d=w%D|0;else{for(d=Ja/(D[0]+1)|0,d>1&&(D=e(D,d),O=e(O,d),E=D.length,P=O.length),A=E,m=O.slice(0,E),y=m.length;y<E;)m[y++]=0;S=D.slice(),S.unshift(0),T=D[0],D[1]>=Ja/2&&++T;do d=0,l=t(D,m,E,y),l<0?(b=m[0],E!=y&&(b=b*Ja+(m[1]||0)),d=b/T|0,d>1?(d>=Ja&&(d=Ja-1),f=e(D,d),h=f.length,y=m.length,l=t(f,m,h,y),l==1&&(d--,r(f,E<h?S:D,h))):(d==0&&(l=d=1),f=D.slice()),h=f.length,h<y&&f.unshift(0),r(m,f,y),l==-1&&(y=m.length,l=t(D,m,E,y),l<1&&(d++,r(m,E<y?S:D,y))),y=m.length):l===0&&(d++,m=[0]),v[u++]=d,l&&m[0]?m[y++]=O[A]||0:(m=[O[A]],y=1);while((A++<P||m[0]!==void 0)&&_--)}return v[0]||v.shift(),p.e=c,kn(p,s?o+qa(p)+1:o)}}();function sM(e,t){var r,n,a,o,s,l,c=0,u=0,d=e.constructor,f=d.precision;if(qa(e)>16)throw Error(Xj+qa(e));if(!e.s)return new d(wo);for(Xn=!1,l=f,s=new d(.03125);e.abs().gte(.1);)e=e.times(s),u+=5;for(n=Math.log(Oc(2,u))/Math.LN10*2+5|0,l+=n,r=a=o=new d(wo),d.precision=l;;){if(a=kn(a.times(e),l),r=r.times(++c),s=o.plus(dl(a,r,l)),ws(s.d).slice(0,l)===ws(o.d).slice(0,l)){for(;u--;)o=kn(o.times(o),l);return d.precision=f,t==null?(Xn=!0,kn(o,f)):o}o=s}}function qa(e){for(var t=e.e*zn,r=e.d[0];r>=10;r/=10)t++;return t}function D1(e,t,r){if(t>e.LN10.sd())throw Xn=!0,r&&(e.precision=r),Error(Vo+"LN10 precision limit exceeded");return kn(new e(e.LN10),t)}function Hl(e){for(var t="";e--;)t+="0";return t}function rp(e,t){var r,n,a,o,s,l,c,u,d,f=1,h=10,p=e,v=p.d,m=p.constructor,y=m.precision;if(p.s<1)throw Error(Vo+(p.s?"NaN":"-Infinity"));if(p.eq(wo))return new m(0);if(t==null?(Xn=!1,u=y):u=t,p.eq(10))return t==null&&(Xn=!0),D1(m,u);if(u+=h,m.precision=u,r=ws(v),n=r.charAt(0),o=qa(p),Math.abs(o)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)p=p.times(e),r=ws(p.d),n=r.charAt(0),f++;o=qa(p),n>1?(p=new m("0."+r),o++):p=new m(n+"."+r.slice(1))}else return c=D1(m,u+2,y).times(o+""),p=rp(new m(n+"."+r.slice(1)),u-h).plus(c),m.precision=y,t==null?(Xn=!0,kn(p,y)):p;for(l=s=p=dl(p.minus(wo),p.plus(wo),u),d=kn(p.times(p),u),a=3;;){if(s=kn(s.times(d),u),c=l.plus(dl(s,new m(a),u)),ws(c.d).slice(0,u)===ws(l.d).slice(0,u))return l=l.times(2),o!==0&&(l=l.plus(D1(m,u+2,y).times(o+""))),l=dl(l,new m(f),u),m.precision=y,t==null?(Xn=!0,kn(l,y)):l;l=c,a+=2}}function kk(e,t){var r,n,a;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(a=t.length;t.charCodeAt(a-1)===48;)--a;if(t=t.slice(n,a),t){if(a-=n,r=r-n-1,e.e=Ud(r/zn),e.d=[],n=(r+1)%zn,r<0&&(n+=zn),n<a){for(n&&e.d.push(+t.slice(0,n)),a-=zn;n<a;)e.d.push(+t.slice(n,n+=zn));t=t.slice(n),n=zn-t.length}else n-=a;for(;n--;)t+="0";if(e.d.push(+t),Xn&&(e.e>Rg||e.e<-Rg))throw Error(Xj+r)}else e.s=0,e.e=0,e.d=[0];return e}function kn(e,t,r){var n,a,o,s,l,c,u,d,f=e.d;for(s=1,o=f[0];o>=10;o/=10)s++;if(n=t-s,n<0)n+=zn,a=t,u=f[d=0];else{if(d=Math.ceil((n+1)/zn),o=f.length,d>=o)return e;for(u=o=f[d],s=1;o>=10;o/=10)s++;n%=zn,a=n-zn+s}if(r!==void 0&&(o=Oc(10,s-a-1),l=u/o%10|0,c=t<0||f[d+1]!==void 0||u%o,c=r<4?(l||c)&&(r==0||r==(e.s<0?3:2)):l>5||l==5&&(r==4||c||r==6&&(n>0?a>0?u/Oc(10,s-a):0:f[d-1])%10&1||r==(e.s<0?8:7))),t<1||!f[0])return c?(o=qa(e),f.length=1,t=t-o-1,f[0]=Oc(10,(zn-t%zn)%zn),e.e=Ud(-t/zn)||0):(f.length=1,f[0]=e.e=e.s=0),e;if(n==0?(f.length=d,o=1,d--):(f.length=d+1,o=Oc(10,zn-n),f[d]=a>0?(u/Oc(10,s-a)%Oc(10,a)|0)*o:0),c)for(;;)if(d==0){(f[0]+=o)==Ja&&(f[0]=1,++e.e);break}else{if(f[d]+=o,f[d]!=Ja)break;f[d--]=0,o=1}for(n=f.length;f[--n]===0;)f.pop();if(Xn&&(e.e>Rg||e.e<-Rg))throw Error(Xj+qa(e));return e}function lM(e,t){var r,n,a,o,s,l,c,u,d,f,h=e.constructor,p=h.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new h(e),Xn?kn(t,p):t;if(c=e.d,f=t.d,n=t.e,u=e.e,c=c.slice(),s=u-n,s){for(d=s<0,d?(r=c,s=-s,l=f.length):(r=f,n=u,l=c.length),a=Math.max(Math.ceil(p/zn),l)+2,s>a&&(s=a,r.length=1),r.reverse(),a=s;a--;)r.push(0);r.reverse()}else{for(a=c.length,l=f.length,d=a<l,d&&(l=a),a=0;a<l;a++)if(c[a]!=f[a]){d=c[a]<f[a];break}s=0}for(d&&(r=c,c=f,f=r,t.s=-t.s),l=c.length,a=f.length-l;a>0;--a)c[l++]=0;for(a=f.length;a>s;){if(c[--a]<f[a]){for(o=a;o&&c[--o]===0;)c[o]=Ja-1;--c[o],c[a]+=Ja}c[a]-=f[a]}for(;c[--l]===0;)c.pop();for(;c[0]===0;c.shift())--n;return c[0]?(t.d=c,t.e=n,Xn?kn(t,p):t):new h(0)}function Qc(e,t,r){var n,a=qa(e),o=ws(e.d),s=o.length;return t?(r&&(n=r-s)>0?o=o.charAt(0)+"."+o.slice(1)+Hl(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(a<0?"e":"e+")+a):a<0?(o="0."+Hl(-a-1)+o,r&&(n=r-s)>0&&(o+=Hl(n))):a>=s?(o+=Hl(a+1-s),r&&(n=r-a-1)>0&&(o=o+"."+Hl(n))):((n=a+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),r&&(n=r-s)>0&&(a+1===s&&(o+="."),o+=Hl(n))),e.s<0?"-"+o:o}function Tk(e,t){if(e.length>t)return e.length=t,!0}function cM(e){var t,r,n;function a(o){var s=this;if(!(s instanceof a))return new a(o);if(s.constructor=a,o instanceof a){s.s=o.s,s.e=o.e,s.d=(o=o.d)?o.slice():o;return}if(typeof o=="number"){if(o*0!==0)throw Error(Bc+o);if(o>0)s.s=1;else if(o<0)o=-o,s.s=-1;else{s.s=0,s.e=0,s.d=[0];return}if(o===~~o&&o<1e7){s.e=0,s.d=[o];return}return kk(s,o.toString())}else if(typeof o!="string")throw Error(Bc+o);if(o.charCodeAt(0)===45?(o=o.slice(1),s.s=-1):s.s=1,mG.test(o))kk(s,o);else throw Error(Bc+o)}if(a.prototype=Xt,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=cM,a.config=a.set=gG,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return a.config(e),a}function gG(e){if(!e||typeof e!="object")throw Error(Vo+"Object expected");var t,r,n,a=["precision",1,Bd,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<a.length;t+=3)if((n=e[r=a[t]])!==void 0)if(Ud(n)===n&&n>=a[t+1]&&n<=a[t+2])this[r]=n;else throw Error(Bc+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(Bc+r+": "+n);return this}var Jj=cM(pG);wo=new Jj(1);const Cn=Jj;function vG(e){return _G(e)||bG(e)||xG(e)||yG()}function yG(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xG(e,t){if(e){if(typeof e=="string")return j_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j_(e,t)}}function bG(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function _G(e){if(Array.isArray(e))return j_(e)}function j_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var wG=function(t){return t},uM={},dM=function(t){return t===uM},Ek=function(t){return function r(){return arguments.length===0||arguments.length===1&&dM(arguments.length<=0?void 0:arguments[0])?r:t.apply(void 0,arguments)}},jG=function e(t,r){return t===1?r:Ek(function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];var s=a.filter(function(l){return l!==uM}).length;return s>=t?r.apply(void 0,a):e(t-s,Ek(function(){for(var l=arguments.length,c=new Array(l),u=0;u<l;u++)c[u]=arguments[u];var d=a.map(function(f){return dM(f)?c.shift():f});return r.apply(void 0,vG(d).concat(c))}))})},cy=function(t){return jG(t.length,t)},S_=function(t,r){for(var n=[],a=t;a<r;++a)n[a-t]=a;return n},SG=cy(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),CG=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!r.length)return wG;var a=r.reverse(),o=a[0],s=a.slice(1);return function(){return s.reduce(function(l,c){return c(l)},o.apply(void 0,arguments))}},C_=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},fM=function(t){var r=null,n=null;return function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return r&&o.every(function(l,c){return l===r[c]})||(r=o,n=t.apply(void 0,o)),n}};function AG(e){var t;return e===0?t=1:t=Math.floor(new Cn(e).abs().log(10).toNumber())+1,t}function PG(e,t,r){for(var n=new Cn(e),a=0,o=[];n.lt(t)&&a<1e5;)o.push(n.toNumber()),n=n.add(r),a++;return o}var OG=cy(function(e,t,r){var n=+e,a=+t;return n+r*(a-n)}),kG=cy(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),TG=cy(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const uy={rangeStep:PG,getDigitCount:AG,interpolateNumber:OG,uninterpolateNumber:kG,uninterpolateTruncation:TG};function A_(e){return NG(e)||IG(e)||hM(e)||EG()}function EG(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function IG(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function NG(e){if(Array.isArray(e))return P_(e)}function np(e,t){return LG(e)||MG(e,t)||hM(e,t)||DG()}function DG(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hM(e,t){if(e){if(typeof e=="string")return P_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return P_(e,t)}}function P_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function MG(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,a=!1,o=void 0;try{for(var s=e[Symbol.iterator](),l;!(n=(l=s.next()).done)&&(r.push(l.value),!(t&&r.length===t));n=!0);}catch(c){a=!0,o=c}finally{try{!n&&s.return!=null&&s.return()}finally{if(a)throw o}}return r}}function LG(e){if(Array.isArray(e))return e}function pM(e){var t=np(e,2),r=t[0],n=t[1],a=r,o=n;return r>n&&(a=n,o=r),[a,o]}function mM(e,t,r){if(e.lte(0))return new Cn(0);var n=uy.getDigitCount(e.toNumber()),a=new Cn(10).pow(n),o=e.div(a),s=n!==1?.05:.1,l=new Cn(Math.ceil(o.div(s).toNumber())).add(r).mul(s),c=l.mul(a);return t?c:new Cn(Math.ceil(c))}function RG(e,t,r){var n=1,a=new Cn(e);if(!a.isint()&&r){var o=Math.abs(e);o<1?(n=new Cn(10).pow(uy.getDigitCount(e)-1),a=new Cn(Math.floor(a.div(n).toNumber())).mul(n)):o>1&&(a=new Cn(Math.floor(e)))}else e===0?a=new Cn(Math.floor((t-1)/2)):r||(a=new Cn(Math.floor(e)));var s=Math.floor((t-1)/2),l=CG(SG(function(c){return a.add(new Cn(c-s).mul(n)).toNumber()}),S_);return l(0,t)}function gM(e,t,r,n){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new Cn(0),tickMin:new Cn(0),tickMax:new Cn(0)};var o=mM(new Cn(t).sub(e).div(r-1),n,a),s;e<=0&&t>=0?s=new Cn(0):(s=new Cn(e).add(t).div(2),s=s.sub(new Cn(s).mod(o)));var l=Math.ceil(s.sub(e).div(o).toNumber()),c=Math.ceil(new Cn(t).sub(s).div(o).toNumber()),u=l+c+1;return u>r?gM(e,t,r,n,a+1):(u<r&&(c=t>0?c+(r-u):c,l=t>0?l:l+(r-u)),{step:o,tickMin:s.sub(new Cn(l).mul(o)),tickMax:s.add(new Cn(c).mul(o))})}function qG(e){var t=np(e,2),r=t[0],n=t[1],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=Math.max(a,2),l=pM([r,n]),c=np(l,2),u=c[0],d=c[1];if(u===-1/0||d===1/0){var f=d===1/0?[u].concat(A_(S_(0,a-1).map(function(){return 1/0}))):[].concat(A_(S_(0,a-1).map(function(){return-1/0})),[d]);return r>n?C_(f):f}if(u===d)return RG(u,a,o);var h=gM(u,d,s,o),p=h.step,v=h.tickMin,m=h.tickMax,y=uy.rangeStep(v,m.add(new Cn(.1).mul(p)),p);return r>n?C_(y):y}function FG(e,t){var r=np(e,2),n=r[0],a=r[1],o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=pM([n,a]),l=np(s,2),c=l[0],u=l[1];if(c===-1/0||u===1/0)return[n,a];if(c===u)return[c];var d=Math.max(t,2),f=mM(new Cn(u).sub(c).div(d-1),o,0),h=[].concat(A_(uy.rangeStep(new Cn(c),new Cn(u).sub(new Cn(.99).mul(f)),f)),[u]);return n>a?C_(h):h}var $G=fM(qG),BG=fM(FG),UG="Invariant failed";function Xc(e,t){throw new Error(UG)}var zG=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function ld(e){"@babel/helpers - typeof";return ld=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ld(e)}function qg(){return qg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qg.apply(this,arguments)}function WG(e,t){return YG(e)||GG(e,t)||VG(e,t)||HG()}function HG(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VG(e,t){if(e){if(typeof e=="string")return Ik(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ik(e,t)}}function Ik(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function GG(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function YG(e){if(Array.isArray(e))return e}function KG(e,t){if(e==null)return{};var r=QG(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function QG(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function XG(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function JG(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,xM(n.key),n)}}function ZG(e,t,r){return t&&JG(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function eY(e,t,r){return t=Fg(t),tY(e,vM()?Reflect.construct(t,r||[],Fg(e).constructor):t.apply(e,r))}function tY(e,t){if(t&&(ld(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return rY(e)}function rY(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vM(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vM=function(){return!!e})()}function Fg(e){return Fg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Fg(e)}function nY(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&O_(e,t)}function O_(e,t){return O_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},O_(e,t)}function yM(e,t,r){return t=xM(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xM(e){var t=aY(e,"string");return ld(t)=="symbol"?t:t+""}function aY(e,t){if(ld(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ld(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Up=function(e){function t(){return XG(this,t),eY(this,t,arguments)}return nY(t,e),ZG(t,[{key:"render",value:function(){var n=this.props,a=n.offset,o=n.layout,s=n.width,l=n.dataKey,c=n.data,u=n.dataPointFormatter,d=n.xAxis,f=n.yAxis,h=KG(n,zG),p=yr(h,!1);this.props.direction==="x"&&d.type!=="number"&&Xc();var v=c.map(function(m){var y=u(m,l),b=y.x,_=y.y,w=y.value,A=y.errorVal;if(!A)return null;var P=[],T,E;if(Array.isArray(A)){var S=WG(A,2);T=S[0],E=S[1]}else T=E=A;if(o==="vertical"){var I=d.scale,W=_+a,O=W+s,D=W-s,R=I(w-T),F=I(w+E);P.push({x1:F,y1:O,x2:F,y2:D}),P.push({x1:R,y1:W,x2:F,y2:W}),P.push({x1:R,y1:O,x2:R,y2:D})}else if(o==="horizontal"){var z=f.scale,K=b+a,J=K-s,L=K+s,k=z(w-T),$=z(w+E);P.push({x1:J,y1:$,x2:L,y2:$}),P.push({x1:K,y1:k,x2:K,y2:$}),P.push({x1:J,y1:k,x2:L,y2:k})}return Ce.createElement(un,qg({className:"recharts-errorBar",key:"bar-".concat(P.map(function(X){return"".concat(X.x1,"-").concat(X.x2,"-").concat(X.y1,"-").concat(X.y2)}))},p),P.map(function(X){return Ce.createElement("line",qg({},X,{key:"line-".concat(X.x1,"-").concat(X.x2,"-").concat(X.y1,"-").concat(X.y2)}))}))});return Ce.createElement(un,{className:"recharts-errorBars"},v)}}])}(Ce.Component);yM(Up,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});yM(Up,"displayName","ErrorBar");function ap(e){"@babel/helpers - typeof";return ap=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ap(e)}function Nk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function wc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Nk(Object(r),!0).forEach(function(n){iY(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function iY(e,t,r){return t=oY(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oY(e){var t=sY(e,"string");return ap(t)=="symbol"?t:t+""}function sY(e,t){if(ap(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ap(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var bM=function(t){var r=t.children,n=t.formattedGraphicalItems,a=t.legendWidth,o=t.legendContent,s=yo(r,Ss);if(!s)return null;var l=Ss.defaultProps,c=l!==void 0?wc(wc({},l),s.props):{},u;return s.props&&s.props.payload?u=s.props&&s.props.payload:o==="children"?u=(n||[]).reduce(function(d,f){var h=f.item,p=f.props,v=p.sectors||p.data||[];return d.concat(v.map(function(m){return{type:s.props.iconType||h.props.legendType,value:m.name,color:m.fill,payload:m}}))},[]):u=(n||[]).map(function(d){var f=d.item,h=f.type.defaultProps,p=h!==void 0?wc(wc({},h),f.props):{},v=p.dataKey,m=p.name,y=p.legendType,b=p.hide;return{inactive:b,dataKey:v,type:c.iconType||y||"square",color:Zj(f),value:m||v,payload:p}}),wc(wc(wc({},c),Ss.getWithHeight(s,a)),{},{payload:u,item:s})};function ip(e){"@babel/helpers - typeof";return ip=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ip(e)}function Dk(e){return dY(e)||uY(e)||cY(e)||lY()}function lY(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cY(e,t){if(e){if(typeof e=="string")return k_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k_(e,t)}}function uY(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function dY(e){if(Array.isArray(e))return k_(e)}function k_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Mk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function fa(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Mk(Object(r),!0).forEach(function(n){Gu(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Gu(e,t,r){return t=fY(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fY(e){var t=hY(e,"string");return ip(t)=="symbol"?t:t+""}function hY(e,t){if(ip(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ip(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Wa(e,t,r){return $r(e)||$r(t)?r:Ha(t)?Co(e,t,r):Nr(t)?t(e):r}function Eh(e,t,r,n){var a=dG(e,function(l){return Wa(l,t)});if(r==="number"){var o=a.filter(function(l){return Mt(l)||parseFloat(l)});return o.length?[ly(o),sy(o)]:[1/0,-1/0]}var s=n?a.filter(function(l){return!$r(l)}):a;return s.map(function(l){return Ha(l)||l instanceof Date?l:""})}var pY=function(t){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,s=-1,l=(r=n?.length)!==null&&r!==void 0?r:0;if(l<=1)return 0;if(o&&o.axisType==="angleAxis"&&Math.abs(Math.abs(o.range[1]-o.range[0])-360)<=1e-6)for(var c=o.range,u=0;u<l;u++){var d=u>0?a[u-1].coordinate:a[l-1].coordinate,f=a[u].coordinate,h=u>=l-1?a[0].coordinate:a[u+1].coordinate,p=void 0;if(Mi(f-d)!==Mi(h-f)){var v=[];if(Mi(h-f)===Mi(c[1]-c[0])){p=h;var m=f+c[1]-c[0];v[0]=Math.min(m,(m+d)/2),v[1]=Math.max(m,(m+d)/2)}else{p=d;var y=h+c[1]-c[0];v[0]=Math.min(f,(y+f)/2),v[1]=Math.max(f,(y+f)/2)}var b=[Math.min(f,(p+f)/2),Math.max(f,(p+f)/2)];if(t>b[0]&&t<=b[1]||t>=v[0]&&t<=v[1]){s=a[u].index;break}}else{var _=Math.min(d,h),w=Math.max(d,h);if(t>(_+f)/2&&t<=(w+f)/2){s=a[u].index;break}}}else for(var A=0;A<l;A++)if(A===0&&t<=(n[A].coordinate+n[A+1].coordinate)/2||A>0&&A<l-1&&t>(n[A].coordinate+n[A-1].coordinate)/2&&t<=(n[A].coordinate+n[A+1].coordinate)/2||A===l-1&&t>(n[A].coordinate+n[A-1].coordinate)/2){s=n[A].index;break}return s},Zj=function(t){var r,n=t,a=n.type.displayName,o=(r=t.type)!==null&&r!==void 0&&r.defaultProps?fa(fa({},t.type.defaultProps),t.props):t.props,s=o.stroke,l=o.fill,c;switch(a){case"Line":c=s;break;case"Area":case"Radar":c=s&&s!=="none"?s:l;break;default:c=l;break}return c},mY=function(t){var r=t.barSize,n=t.totalSize,a=t.stackGroups,o=a===void 0?{}:a;if(!o)return{};for(var s={},l=Object.keys(o),c=0,u=l.length;c<u;c++)for(var d=o[l[c]].stackGroups,f=Object.keys(d),h=0,p=f.length;h<p;h++){var v=d[f[h]],m=v.items,y=v.cateAxisId,b=m.filter(function(E){return ul(E.type).indexOf("Bar")>=0});if(b&&b.length){var _=b[0].type.defaultProps,w=_!==void 0?fa(fa({},_),b[0].props):b[0].props,A=w.barSize,P=w[y];s[P]||(s[P]=[]);var T=$r(A)?r:A;s[P].push({item:b[0],stackList:b.slice(1),barSize:$r(T)?void 0:Li(T,n,0)})}}return s},gY=function(t){var r=t.barGap,n=t.barCategoryGap,a=t.bandSize,o=t.sizeList,s=o===void 0?[]:o,l=t.maxBarSize,c=s.length;if(c<1)return null;var u=Li(r,a,0,!0),d,f=[];if(s[0].barSize===+s[0].barSize){var h=!1,p=a/c,v=s.reduce(function(A,P){return A+P.barSize||0},0);v+=(c-1)*u,v>=a&&(v-=(c-1)*u,u=0),v>=a&&p>0&&(h=!0,p*=.9,v=c*p);var m=(a-v)/2>>0,y={offset:m-u,size:0};d=s.reduce(function(A,P){var T={item:P.item,position:{offset:y.offset+y.size+u,size:h?p:P.barSize}},E=[].concat(Dk(A),[T]);return y=E[E.length-1].position,P.stackList&&P.stackList.length&&P.stackList.forEach(function(S){E.push({item:S,position:y})}),E},f)}else{var b=Li(n,a,0,!0);a-2*b-(c-1)*u<=0&&(u=0);var _=(a-2*b-(c-1)*u)/c;_>1&&(_>>=0);var w=l===+l?Math.min(_,l):_;d=s.reduce(function(A,P,T){var E=[].concat(Dk(A),[{item:P.item,position:{offset:b+(_+u)*T+(_-w)/2,size:w}}]);return P.stackList&&P.stackList.length&&P.stackList.forEach(function(S){E.push({item:S,position:E[E.length-1].position})}),E},f)}return d},vY=function(t,r,n,a){var o=n.children,s=n.width,l=n.margin,c=s-(l.left||0)-(l.right||0),u=bM({children:o,legendWidth:c});if(u){var d=a||{},f=d.width,h=d.height,p=u.align,v=u.verticalAlign,m=u.layout;if((m==="vertical"||m==="horizontal"&&v==="middle")&&p!=="center"&&Mt(t[p]))return fa(fa({},t),{},Gu({},p,t[p]+(f||0)));if((m==="horizontal"||m==="vertical"&&p==="center")&&v!=="middle"&&Mt(t[v]))return fa(fa({},t),{},Gu({},v,t[v]+(h||0)))}return t},yY=function(t,r,n){return $r(r)?!0:t==="horizontal"?r==="yAxis":t==="vertical"||n==="x"?r==="xAxis":n==="y"?r==="yAxis":!0},_M=function(t,r,n,a,o){var s=r.props.children,l=Ao(s,Up).filter(function(u){return yY(a,o,u.props.direction)});if(l&&l.length){var c=l.map(function(u){return u.props.dataKey});return t.reduce(function(u,d){var f=Wa(d,n);if($r(f))return u;var h=Array.isArray(f)?[ly(f),sy(f)]:[f,f],p=c.reduce(function(v,m){var y=Wa(d,m,0),b=h[0]-Math.abs(Array.isArray(y)?y[0]:y),_=h[1]+Math.abs(Array.isArray(y)?y[1]:y);return[Math.min(b,v[0]),Math.max(_,v[1])]},[1/0,-1/0]);return[Math.min(p[0],u[0]),Math.max(p[1],u[1])]},[1/0,-1/0])}return null},xY=function(t,r,n,a,o){var s=r.map(function(l){return _M(t,l,n,o,a)}).filter(function(l){return!$r(l)});return s&&s.length?s.reduce(function(l,c){return[Math.min(l[0],c[0]),Math.max(l[1],c[1])]},[1/0,-1/0]):null},wM=function(t,r,n,a,o){var s=r.map(function(c){var u=c.props.dataKey;return n==="number"&&u&&_M(t,c,u,a)||Eh(t,u,n,o)});if(n==="number")return s.reduce(function(c,u){return[Math.min(c[0],u[0]),Math.max(c[1],u[1])]},[1/0,-1/0]);var l={};return s.reduce(function(c,u){for(var d=0,f=u.length;d<f;d++)l[u[d]]||(l[u[d]]=!0,c.push(u[d]));return c},[])},jM=function(t,r){return t==="horizontal"&&r==="xAxis"||t==="vertical"&&r==="yAxis"||t==="centric"&&r==="angleAxis"||t==="radial"&&r==="radiusAxis"},SM=function(t,r,n,a){if(a)return t.map(function(c){return c.coordinate});var o,s,l=t.map(function(c){return c.coordinate===r&&(o=!0),c.coordinate===n&&(s=!0),c.coordinate});return o||l.push(r),s||l.push(n),l},sl=function(t,r,n){if(!t)return null;var a=t.scale,o=t.duplicateDomain,s=t.type,l=t.range,c=t.realScaleType==="scaleBand"?a.bandwidth()/2:2,u=(r||n)&&s==="category"&&a.bandwidth?a.bandwidth()/c:0;if(u=t.axisType==="angleAxis"&&l?.length>=2?Mi(l[0]-l[1])*2*u:u,r&&(t.ticks||t.niceTicks)){var d=(t.ticks||t.niceTicks).map(function(f){var h=o?o.indexOf(f):f;return{coordinate:a(h)+u,value:f,offset:u}});return d.filter(function(f){return!Mp(f.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(f,h){return{coordinate:a(f)+u,value:f,index:h,offset:u}}):a.ticks&&!n?a.ticks(t.tickCount).map(function(f){return{coordinate:a(f)+u,value:f,offset:u}}):a.domain().map(function(f,h){return{coordinate:a(f)+u,value:o?o[f]:f,index:h,offset:u}})},M1=new WeakMap,jm=function(t,r){if(typeof r!="function")return t;M1.has(t)||M1.set(t,new WeakMap);var n=M1.get(t);if(n.has(r))return n.get(r);var a=function(){t.apply(void 0,arguments),r.apply(void 0,arguments)};return n.set(r,a),a},CM=function(t,r,n){var a=t.scale,o=t.type,s=t.layout,l=t.axisType;if(a==="auto")return s==="radial"&&l==="radiusAxis"?{scale:Xh(),realScaleType:"band"}:s==="radial"&&l==="angleAxis"?{scale:Ng(),realScaleType:"linear"}:o==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?{scale:Th(),realScaleType:"point"}:o==="category"?{scale:Xh(),realScaleType:"band"}:{scale:Ng(),realScaleType:"linear"};if(Gc(a)){var c="scale".concat(Vv(a));return{scale:(bk[c]||Th)(),realScaleType:bk[c]?c:"point"}}return Nr(a)?{scale:a}:{scale:Th(),realScaleType:"point"}},Lk=1e-4,AM=function(t){var r=t.domain();if(!(!r||r.length<=2)){var n=r.length,a=t.range(),o=Math.min(a[0],a[1])-Lk,s=Math.max(a[0],a[1])+Lk,l=t(r[0]),c=t(r[n-1]);(l<o||l>s||c<o||c>s)&&t.domain([r[0],r[n-1]])}},bY=function(t,r){if(!t)return null;for(var n=0,a=t.length;n<a;n++)if(t[n].item===r)return t[n].position;return null},_Y=function(t,r){if(!r||r.length!==2||!Mt(r[0])||!Mt(r[1]))return t;var n=Math.min(r[0],r[1]),a=Math.max(r[0],r[1]),o=[t[0],t[1]];return(!Mt(t[0])||t[0]<n)&&(o[0]=n),(!Mt(t[1])||t[1]>a)&&(o[1]=a),o[0]>a&&(o[0]=a),o[1]<n&&(o[1]=n),o},wY=function(t){var r=t.length;if(!(r<=0))for(var n=0,a=t[0].length;n<a;++n)for(var o=0,s=0,l=0;l<r;++l){var c=Mp(t[l][n][1])?t[l][n][0]:t[l][n][1];c>=0?(t[l][n][0]=o,t[l][n][1]=o+c,o=t[l][n][1]):(t[l][n][0]=s,t[l][n][1]=s+c,s=t[l][n][1])}},jY=function(t){var r=t.length;if(!(r<=0))for(var n=0,a=t[0].length;n<a;++n)for(var o=0,s=0;s<r;++s){var l=Mp(t[s][n][1])?t[s][n][0]:t[s][n][1];l>=0?(t[s][n][0]=o,t[s][n][1]=o+l,o=t[s][n][1]):(t[s][n][0]=0,t[s][n][1]=0)}},SY={sign:wY,expand:dU,none:ed,silhouette:fU,wiggle:hU,positive:jY},CY=function(t,r,n){var a=r.map(function(l){return l.props.dataKey}),o=SY[n],s=uU().keys(a).value(function(l,c){return+Wa(l,c,0)}).order(i_).offset(o);return s(t)},AY=function(t,r,n,a,o,s){if(!t)return null;var l=s?r.reverse():r,c={},u=l.reduce(function(f,h){var p,v=(p=h.type)!==null&&p!==void 0&&p.defaultProps?fa(fa({},h.type.defaultProps),h.props):h.props,m=v.stackId,y=v.hide;if(y)return f;var b=v[n],_=f[b]||{hasStack:!1,stackGroups:{}};if(Ha(m)){var w=_.stackGroups[m]||{numericAxisId:n,cateAxisId:a,items:[]};w.items.push(h),_.hasStack=!0,_.stackGroups[m]=w}else _.stackGroups[qd("_stackId_")]={numericAxisId:n,cateAxisId:a,items:[h]};return fa(fa({},f),{},Gu({},b,_))},c),d={};return Object.keys(u).reduce(function(f,h){var p=u[h];if(p.hasStack){var v={};p.stackGroups=Object.keys(p.stackGroups).reduce(function(m,y){var b=p.stackGroups[y];return fa(fa({},m),{},Gu({},y,{numericAxisId:n,cateAxisId:a,items:b.items,stackedData:CY(t,b.items,o)}))},v)}return fa(fa({},f),{},Gu({},h,p))},d)},PM=function(t,r){var n=r.realScaleType,a=r.type,o=r.tickCount,s=r.originalDomain,l=r.allowDecimals,c=n||r.scale;if(c!=="auto"&&c!=="linear")return null;if(o&&a==="number"&&s&&(s[0]==="auto"||s[1]==="auto")){var u=t.domain();if(!u.length)return null;var d=$G(u,o,l);return t.domain([ly(d),sy(d)]),{niceTicks:d}}if(o&&a==="number"){var f=t.domain(),h=BG(f,o,l);return{niceTicks:h}}return null};function Rk(e){var t=e.axis,r=e.ticks,n=e.bandSize,a=e.entry,o=e.index,s=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!$r(a[t.dataKey])){var l=mg(r,"value",a[t.dataKey]);if(l)return l.coordinate+n/2}return r[o]?r[o].coordinate+n/2:null}var c=Wa(a,$r(s)?t.dataKey:s);return $r(c)?null:t.scale(c)}var qk=function(t){var r=t.axis,n=t.ticks,a=t.offset,o=t.bandSize,s=t.entry,l=t.index;if(r.type==="category")return n[l]?n[l].coordinate+a:null;var c=Wa(s,r.dataKey,r.domain[l]);return $r(c)?null:r.scale(c)-o/2+a},PY=function(t){var r=t.numericAxis,n=r.scale.domain();if(r.type==="number"){var a=Math.min(n[0],n[1]),o=Math.max(n[0],n[1]);return a<=0&&o>=0?0:o<0?o:a}return n[0]},OY=function(t,r){var n,a=(n=t.type)!==null&&n!==void 0&&n.defaultProps?fa(fa({},t.type.defaultProps),t.props):t.props,o=a.stackId;if(Ha(o)){var s=r[o];if(s){var l=s.items.indexOf(t);return l>=0?s.stackedData[l]:null}}return null},kY=function(t){return t.reduce(function(r,n){return[ly(n.concat([r[0]]).filter(Mt)),sy(n.concat([r[1]]).filter(Mt))]},[1/0,-1/0])},OM=function(t,r,n){return Object.keys(t).reduce(function(a,o){var s=t[o],l=s.stackedData,c=l.reduce(function(u,d){var f=kY(d.slice(r,n+1));return[Math.min(u[0],f[0]),Math.max(u[1],f[1])]},[1/0,-1/0]);return[Math.min(c[0],a[0]),Math.max(c[1],a[1])]},[1/0,-1/0]).map(function(a){return a===1/0||a===-1/0?0:a})},Fk=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,$k=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,T_=function(t,r,n){if(Nr(t))return t(r,n);if(!Array.isArray(t))return r;var a=[];if(Mt(t[0]))a[0]=n?t[0]:Math.min(t[0],r[0]);else if(Fk.test(t[0])){var o=+Fk.exec(t[0])[1];a[0]=r[0]-o}else Nr(t[0])?a[0]=t[0](r[0]):a[0]=r[0];if(Mt(t[1]))a[1]=n?t[1]:Math.max(t[1],r[1]);else if($k.test(t[1])){var s=+$k.exec(t[1])[1];a[1]=r[1]+s}else Nr(t[1])?a[1]=t[1](r[1]):a[1]=r[1];return a},$g=function(t,r,n){if(t&&t.scale&&t.scale.bandwidth){var a=t.scale.bandwidth();if(!n||a>0)return a}if(t&&r&&r.length>=2){for(var o=Pj(r,function(f){return f.coordinate}),s=1/0,l=1,c=o.length;l<c;l++){var u=o[l],d=o[l-1];s=Math.min((u.coordinate||0)-(d.coordinate||0),s)}return s===1/0?0:s}return n?void 0:0},Bk=function(t,r,n){return!t||!t.length||Bp(t,Co(n,"type.defaultProps.domain"))?r:t},kM=function(t,r){var n=t.type.defaultProps?fa(fa({},t.type.defaultProps),t.props):t.props,a=n.dataKey,o=n.name,s=n.unit,l=n.formatter,c=n.tooltipType,u=n.chartType,d=n.hide;return fa(fa({},yr(t,!1)),{},{dataKey:a,unit:s,formatter:l,name:o||a,color:Zj(t),value:Wa(r,a),type:c,payload:r,chartType:u,hide:d})};function op(e){"@babel/helpers - typeof";return op=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},op(e)}function Uk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function nl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Uk(Object(r),!0).forEach(function(n){TM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Uk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function TM(e,t,r){return t=TY(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function TY(e){var t=EY(e,"string");return op(t)=="symbol"?t:t+""}function EY(e,t){if(op(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(op(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function IY(e,t){return LY(e)||MY(e,t)||DY(e,t)||NY()}function NY(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DY(e,t){if(e){if(typeof e=="string")return zk(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zk(e,t)}}function zk(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function MY(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function LY(e){if(Array.isArray(e))return e}var Bg=Math.PI/180,RY=function(t){return t*180/Math.PI},Fn=function(t,r,n,a){return{x:t+Math.cos(-Bg*a)*n,y:r+Math.sin(-Bg*a)*n}},EM=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(n.left||0)-(n.right||0)),Math.abs(r-(n.top||0)-(n.bottom||0)))/2},qY=function(t,r,n,a,o){var s=t.width,l=t.height,c=t.startAngle,u=t.endAngle,d=Li(t.cx,s,s/2),f=Li(t.cy,l,l/2),h=EM(s,l,n),p=Li(t.innerRadius,h,0),v=Li(t.outerRadius,h,h*.8),m=Object.keys(r);return m.reduce(function(y,b){var _=r[b],w=_.domain,A=_.reversed,P;if($r(_.range))a==="angleAxis"?P=[c,u]:a==="radiusAxis"&&(P=[p,v]),A&&(P=[P[1],P[0]]);else{P=_.range;var T=P,E=IY(T,2);c=E[0],u=E[1]}var S=CM(_,o),I=S.realScaleType,W=S.scale;W.domain(w).range(P),AM(W);var O=PM(W,nl(nl({},_),{},{realScaleType:I})),D=nl(nl(nl({},_),O),{},{range:P,radius:v,realScaleType:I,scale:W,cx:d,cy:f,innerRadius:p,outerRadius:v,startAngle:c,endAngle:u});return nl(nl({},y),{},TM({},b,D))},{})},FY=function(t,r){var n=t.x,a=t.y,o=r.x,s=r.y;return Math.sqrt(Math.pow(n-o,2)+Math.pow(a-s,2))},$Y=function(t,r){var n=t.x,a=t.y,o=r.cx,s=r.cy,l=FY({x:n,y:a},{x:o,y:s});if(l<=0)return{radius:l};var c=(n-o)/l,u=Math.acos(c);return a>s&&(u=2*Math.PI-u),{radius:l,angle:RY(u),angleInRadian:u}},BY=function(t){var r=t.startAngle,n=t.endAngle,a=Math.floor(r/360),o=Math.floor(n/360),s=Math.min(a,o);return{startAngle:r-s*360,endAngle:n-s*360}},UY=function(t,r){var n=r.startAngle,a=r.endAngle,o=Math.floor(n/360),s=Math.floor(a/360),l=Math.min(o,s);return t+l*360},Wk=function(t,r){var n=t.x,a=t.y,o=$Y({x:n,y:a},r),s=o.radius,l=o.angle,c=r.innerRadius,u=r.outerRadius;if(s<c||s>u)return!1;if(s===0)return!0;var d=BY(r),f=d.startAngle,h=d.endAngle,p=l,v;if(f<=h){for(;p>h;)p-=360;for(;p<f;)p+=360;v=p>=f&&p<=h}else{for(;p>f;)p-=360;for(;p<h;)p+=360;v=p>=h&&p<=f}return v?nl(nl({},r),{},{radius:s,angle:UY(p,r)}):null},IM=function(t){return!x.isValidElement(t)&&!Nr(t)&&typeof t!="boolean"?t.className:""};function sp(e){"@babel/helpers - typeof";return sp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sp(e)}var zY=["offset"];function WY(e){return YY(e)||GY(e)||VY(e)||HY()}function HY(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VY(e,t){if(e){if(typeof e=="string")return E_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return E_(e,t)}}function GY(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function YY(e){if(Array.isArray(e))return E_(e)}function E_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function KY(e,t){if(e==null)return{};var r=QY(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function QY(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Hk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ua(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Hk(Object(r),!0).forEach(function(n){XY(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function XY(e,t,r){return t=JY(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function JY(e){var t=ZY(e,"string");return sp(t)=="symbol"?t:t+""}function ZY(e,t){if(sp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(sp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function lp(){return lp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lp.apply(this,arguments)}var eK=function(t){var r=t.value,n=t.formatter,a=$r(t.children)?r:t.children;return Nr(n)?n(a):a},tK=function(t,r){var n=Mi(r-t),a=Math.min(Math.abs(r-t),360);return n*a},rK=function(t,r,n){var a=t.position,o=t.viewBox,s=t.offset,l=t.className,c=o,u=c.cx,d=c.cy,f=c.innerRadius,h=c.outerRadius,p=c.startAngle,v=c.endAngle,m=c.clockWise,y=(f+h)/2,b=tK(p,v),_=b>=0?1:-1,w,A;a==="insideStart"?(w=p+_*s,A=m):a==="insideEnd"?(w=v-_*s,A=!m):a==="end"&&(w=v+_*s,A=m),A=b<=0?A:!A;var P=Fn(u,d,y,w),T=Fn(u,d,y,w+(A?1:-1)*359),E="M".concat(P.x,",").concat(P.y,`
    A`).concat(y,",").concat(y,",0,1,").concat(A?0:1,`,
    `).concat(T.x,",").concat(T.y),S=$r(t.id)?qd("recharts-radial-line-"):t.id;return Ce.createElement("text",lp({},n,{dominantBaseline:"central",className:Tr("recharts-radial-bar-label",l)}),Ce.createElement("defs",null,Ce.createElement("path",{id:S,d:E})),Ce.createElement("textPath",{xlinkHref:"#".concat(S)},r))},nK=function(t){var r=t.viewBox,n=t.offset,a=t.position,o=r,s=o.cx,l=o.cy,c=o.innerRadius,u=o.outerRadius,d=o.startAngle,f=o.endAngle,h=(d+f)/2;if(a==="outside"){var p=Fn(s,l,u+n,h),v=p.x,m=p.y;return{x:v,y:m,textAnchor:v>=s?"start":"end",verticalAnchor:"middle"}}if(a==="center")return{x:s,y:l,textAnchor:"middle",verticalAnchor:"middle"};if(a==="centerTop")return{x:s,y:l,textAnchor:"middle",verticalAnchor:"start"};if(a==="centerBottom")return{x:s,y:l,textAnchor:"middle",verticalAnchor:"end"};var y=(c+u)/2,b=Fn(s,l,y,h),_=b.x,w=b.y;return{x:_,y:w,textAnchor:"middle",verticalAnchor:"middle"}},aK=function(t){var r=t.viewBox,n=t.parentViewBox,a=t.offset,o=t.position,s=r,l=s.x,c=s.y,u=s.width,d=s.height,f=d>=0?1:-1,h=f*a,p=f>0?"end":"start",v=f>0?"start":"end",m=u>=0?1:-1,y=m*a,b=m>0?"end":"start",_=m>0?"start":"end";if(o==="top"){var w={x:l+u/2,y:c-f*a,textAnchor:"middle",verticalAnchor:p};return Ua(Ua({},w),n?{height:Math.max(c-n.y,0),width:u}:{})}if(o==="bottom"){var A={x:l+u/2,y:c+d+h,textAnchor:"middle",verticalAnchor:v};return Ua(Ua({},A),n?{height:Math.max(n.y+n.height-(c+d),0),width:u}:{})}if(o==="left"){var P={x:l-y,y:c+d/2,textAnchor:b,verticalAnchor:"middle"};return Ua(Ua({},P),n?{width:Math.max(P.x-n.x,0),height:d}:{})}if(o==="right"){var T={x:l+u+y,y:c+d/2,textAnchor:_,verticalAnchor:"middle"};return Ua(Ua({},T),n?{width:Math.max(n.x+n.width-T.x,0),height:d}:{})}var E=n?{width:u,height:d}:{};return o==="insideLeft"?Ua({x:l+y,y:c+d/2,textAnchor:_,verticalAnchor:"middle"},E):o==="insideRight"?Ua({x:l+u-y,y:c+d/2,textAnchor:b,verticalAnchor:"middle"},E):o==="insideTop"?Ua({x:l+u/2,y:c+h,textAnchor:"middle",verticalAnchor:v},E):o==="insideBottom"?Ua({x:l+u/2,y:c+d-h,textAnchor:"middle",verticalAnchor:p},E):o==="insideTopLeft"?Ua({x:l+y,y:c+h,textAnchor:_,verticalAnchor:v},E):o==="insideTopRight"?Ua({x:l+u-y,y:c+h,textAnchor:b,verticalAnchor:v},E):o==="insideBottomLeft"?Ua({x:l+y,y:c+d-h,textAnchor:_,verticalAnchor:p},E):o==="insideBottomRight"?Ua({x:l+u-y,y:c+d-h,textAnchor:b,verticalAnchor:p},E):Rd(o)&&(Mt(o.x)||Mc(o.x))&&(Mt(o.y)||Mc(o.y))?Ua({x:l+Li(o.x,u),y:c+Li(o.y,d),textAnchor:"end",verticalAnchor:"end"},E):Ua({x:l+u/2,y:c+d/2,textAnchor:"middle",verticalAnchor:"middle"},E)},iK=function(t){return"cx"in t&&Mt(t.cx)};function ei(e){var t=e.offset,r=t===void 0?5:t,n=KY(e,zY),a=Ua({offset:r},n),o=a.viewBox,s=a.position,l=a.value,c=a.children,u=a.content,d=a.className,f=d===void 0?"":d,h=a.textBreakAll;if(!o||$r(l)&&$r(c)&&!x.isValidElement(u)&&!Nr(u))return null;if(x.isValidElement(u))return x.cloneElement(u,a);var p;if(Nr(u)){if(p=x.createElement(u,a),x.isValidElement(p))return p}else p=eK(a);var v=iK(o),m=yr(a,!0);if(v&&(s==="insideStart"||s==="insideEnd"||s==="end"))return rK(a,p,m);var y=v?nK(a):aK(a);return Ce.createElement(Kc,lp({className:Tr("recharts-label",f)},m,y,{breakAll:h}),p)}ei.displayName="Label";var NM=function(t){var r=t.cx,n=t.cy,a=t.angle,o=t.startAngle,s=t.endAngle,l=t.r,c=t.radius,u=t.innerRadius,d=t.outerRadius,f=t.x,h=t.y,p=t.top,v=t.left,m=t.width,y=t.height,b=t.clockWise,_=t.labelViewBox;if(_)return _;if(Mt(m)&&Mt(y)){if(Mt(f)&&Mt(h))return{x:f,y:h,width:m,height:y};if(Mt(p)&&Mt(v))return{x:p,y:v,width:m,height:y}}return Mt(f)&&Mt(h)?{x:f,y:h,width:0,height:0}:Mt(r)&&Mt(n)?{cx:r,cy:n,startAngle:o||a||0,endAngle:s||a||0,innerRadius:u||0,outerRadius:d||c||l||0,clockWise:b}:t.viewBox?t.viewBox:{}},oK=function(t,r){return t?t===!0?Ce.createElement(ei,{key:"label-implicit",viewBox:r}):Ha(t)?Ce.createElement(ei,{key:"label-implicit",viewBox:r,value:t}):x.isValidElement(t)?t.type===ei?x.cloneElement(t,{key:"label-implicit",viewBox:r}):Ce.createElement(ei,{key:"label-implicit",content:t,viewBox:r}):Nr(t)?Ce.createElement(ei,{key:"label-implicit",content:t,viewBox:r}):Rd(t)?Ce.createElement(ei,lp({viewBox:r},t,{key:"label-implicit"})):null:null},sK=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&n&&!t.label)return null;var a=t.children,o=NM(t),s=Ao(a,ei).map(function(c,u){return x.cloneElement(c,{viewBox:r||o,key:"label-".concat(u)})});if(!n)return s;var l=oK(t.label,r||o);return[l].concat(WY(s))};ei.parseViewBox=NM;ei.renderCallByParent=sK;var L1,Vk;function lK(){if(Vk)return L1;Vk=1;function e(t){var r=t==null?0:t.length;return r?t[r-1]:void 0}return L1=e,L1}var cK=lK();const uK=Et(cK);function cp(e){"@babel/helpers - typeof";return cp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cp(e)}var dK=["valueAccessor"],fK=["data","dataKey","clockWise","id","textBreakAll"];function hK(e){return vK(e)||gK(e)||mK(e)||pK()}function pK(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mK(e,t){if(e){if(typeof e=="string")return I_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I_(e,t)}}function gK(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function vK(e){if(Array.isArray(e))return I_(e)}function I_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ug(){return Ug=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ug.apply(this,arguments)}function Gk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Yk(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Gk(Object(r),!0).forEach(function(n){yK(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yK(e,t,r){return t=xK(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xK(e){var t=bK(e,"string");return cp(t)=="symbol"?t:t+""}function bK(e,t){if(cp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(cp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Kk(e,t){if(e==null)return{};var r=_K(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function _K(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var wK=function(t){return Array.isArray(t.value)?uK(t.value):t.value};function fl(e){var t=e.valueAccessor,r=t===void 0?wK:t,n=Kk(e,dK),a=n.data,o=n.dataKey,s=n.clockWise,l=n.id,c=n.textBreakAll,u=Kk(n,fK);return!a||!a.length?null:Ce.createElement(un,{className:"recharts-label-list"},a.map(function(d,f){var h=$r(o)?r(d,f):Wa(d&&d.payload,o),p=$r(l)?{}:{id:"".concat(l,"-").concat(f)};return Ce.createElement(ei,Ug({},yr(d,!0),u,p,{parentViewBox:d.parentViewBox,value:h,textBreakAll:c,viewBox:ei.parseViewBox($r(s)?d:Yk(Yk({},d),{},{clockWise:s})),key:"label-".concat(f),index:f}))}))}fl.displayName="LabelList";function jK(e,t){return e?e===!0?Ce.createElement(fl,{key:"labelList-implicit",data:t}):Ce.isValidElement(e)||Nr(e)?Ce.createElement(fl,{key:"labelList-implicit",data:t,content:e}):Rd(e)?Ce.createElement(fl,Ug({data:t},e,{key:"labelList-implicit"})):null:null}function SK(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,a=Ao(n,fl).map(function(s,l){return x.cloneElement(s,{data:t,key:"labelList-".concat(l)})});if(!r)return a;var o=jK(e.label,t);return[o].concat(hK(a))}fl.renderCallByParent=SK;function up(e){"@babel/helpers - typeof";return up=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},up(e)}function N_(){return N_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},N_.apply(this,arguments)}function Qk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xk(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Qk(Object(r),!0).forEach(function(n){CK(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function CK(e,t,r){return t=AK(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function AK(e){var t=PK(e,"string");return up(t)=="symbol"?t:t+""}function PK(e,t){if(up(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(up(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var OK=function(t,r){var n=Mi(r-t),a=Math.min(Math.abs(r-t),359.999);return n*a},Sm=function(t){var r=t.cx,n=t.cy,a=t.radius,o=t.angle,s=t.sign,l=t.isExternal,c=t.cornerRadius,u=t.cornerIsExternal,d=c*(l?1:-1)+a,f=Math.asin(c/d)/Bg,h=u?o:o+s*f,p=Fn(r,n,d,h),v=Fn(r,n,a,h),m=u?o-s*f:o,y=Fn(r,n,d*Math.cos(f*Bg),m);return{center:p,circleTangency:v,lineTangency:y,theta:f}},DM=function(t){var r=t.cx,n=t.cy,a=t.innerRadius,o=t.outerRadius,s=t.startAngle,l=t.endAngle,c=OK(s,l),u=s+c,d=Fn(r,n,o,s),f=Fn(r,n,o,u),h="M ".concat(d.x,",").concat(d.y,`
    A `).concat(o,",").concat(o,`,0,
    `).concat(+(Math.abs(c)>180),",").concat(+(s>u),`,
    `).concat(f.x,",").concat(f.y,`
  `);if(a>0){var p=Fn(r,n,a,s),v=Fn(r,n,a,u);h+="L ".concat(v.x,",").concat(v.y,`
            A `).concat(a,",").concat(a,`,0,
            `).concat(+(Math.abs(c)>180),",").concat(+(s<=u),`,
            `).concat(p.x,",").concat(p.y," Z")}else h+="L ".concat(r,",").concat(n," Z");return h},kK=function(t){var r=t.cx,n=t.cy,a=t.innerRadius,o=t.outerRadius,s=t.cornerRadius,l=t.forceCornerRadius,c=t.cornerIsExternal,u=t.startAngle,d=t.endAngle,f=Mi(d-u),h=Sm({cx:r,cy:n,radius:o,angle:u,sign:f,cornerRadius:s,cornerIsExternal:c}),p=h.circleTangency,v=h.lineTangency,m=h.theta,y=Sm({cx:r,cy:n,radius:o,angle:d,sign:-f,cornerRadius:s,cornerIsExternal:c}),b=y.circleTangency,_=y.lineTangency,w=y.theta,A=c?Math.abs(u-d):Math.abs(u-d)-m-w;if(A<0)return l?"M ".concat(v.x,",").concat(v.y,`
        a`).concat(s,",").concat(s,",0,0,1,").concat(s*2,`,0
        a`).concat(s,",").concat(s,",0,0,1,").concat(-s*2,`,0
      `):DM({cx:r,cy:n,innerRadius:a,outerRadius:o,startAngle:u,endAngle:d});var P="M ".concat(v.x,",").concat(v.y,`
    A`).concat(s,",").concat(s,",0,0,").concat(+(f<0),",").concat(p.x,",").concat(p.y,`
    A`).concat(o,",").concat(o,",0,").concat(+(A>180),",").concat(+(f<0),",").concat(b.x,",").concat(b.y,`
    A`).concat(s,",").concat(s,",0,0,").concat(+(f<0),",").concat(_.x,",").concat(_.y,`
  `);if(a>0){var T=Sm({cx:r,cy:n,radius:a,angle:u,sign:f,isExternal:!0,cornerRadius:s,cornerIsExternal:c}),E=T.circleTangency,S=T.lineTangency,I=T.theta,W=Sm({cx:r,cy:n,radius:a,angle:d,sign:-f,isExternal:!0,cornerRadius:s,cornerIsExternal:c}),O=W.circleTangency,D=W.lineTangency,R=W.theta,F=c?Math.abs(u-d):Math.abs(u-d)-I-R;if(F<0&&s===0)return"".concat(P,"L").concat(r,",").concat(n,"Z");P+="L".concat(D.x,",").concat(D.y,`
      A`).concat(s,",").concat(s,",0,0,").concat(+(f<0),",").concat(O.x,",").concat(O.y,`
      A`).concat(a,",").concat(a,",0,").concat(+(F>180),",").concat(+(f>0),",").concat(E.x,",").concat(E.y,`
      A`).concat(s,",").concat(s,",0,0,").concat(+(f<0),",").concat(S.x,",").concat(S.y,"Z")}else P+="L".concat(r,",").concat(n,"Z");return P},TK={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},MM=function(t){var r=Xk(Xk({},TK),t),n=r.cx,a=r.cy,o=r.innerRadius,s=r.outerRadius,l=r.cornerRadius,c=r.forceCornerRadius,u=r.cornerIsExternal,d=r.startAngle,f=r.endAngle,h=r.className;if(s<o||d===f)return null;var p=Tr("recharts-sector",h),v=s-o,m=Li(l,v,0,!0),y;return m>0&&Math.abs(d-f)<360?y=kK({cx:n,cy:a,innerRadius:o,outerRadius:s,cornerRadius:Math.min(m,v/2),forceCornerRadius:c,cornerIsExternal:u,startAngle:d,endAngle:f}):y=DM({cx:n,cy:a,innerRadius:o,outerRadius:s,startAngle:d,endAngle:f}),Ce.createElement("path",N_({},yr(r,!0),{className:p,d:y,role:"img"}))};function dp(e){"@babel/helpers - typeof";return dp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dp(e)}function D_(){return D_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},D_.apply(this,arguments)}function Jk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Zk(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Jk(Object(r),!0).forEach(function(n){EK(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jk(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function EK(e,t,r){return t=IK(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function IK(e){var t=NK(e,"string");return dp(t)=="symbol"?t:t+""}function NK(e,t){if(dp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(dp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var e3={curveBasisClosed:ZB,curveBasisOpen:eU,curveBasis:JB,curveBumpX:qB,curveBumpY:FB,curveLinearClosed:tU,curveLinear:Yv,curveMonotoneX:rU,curveMonotoneY:nU,curveNatural:aU,curveStep:iU,curveStepAfter:sU,curveStepBefore:oU},Cm=function(t){return t.x===+t.x&&t.y===+t.y},mf=function(t){return t.x},gf=function(t){return t.y},DK=function(t,r){if(Nr(t))return t;var n="curve".concat(Vv(t));return(n==="curveMonotone"||n==="curveBump")&&r?e3["".concat(n).concat(r==="vertical"?"Y":"X")]:e3[n]||Yv},MK=function(t){var r=t.type,n=r===void 0?"linear":r,a=t.points,o=a===void 0?[]:a,s=t.baseLine,l=t.layout,c=t.connectNulls,u=c===void 0?!1:c,d=DK(n,l),f=u?o.filter(function(m){return Cm(m)}):o,h;if(Array.isArray(s)){var p=u?s.filter(function(m){return Cm(m)}):s,v=f.map(function(m,y){return Zk(Zk({},m),{},{base:p[y]})});return l==="vertical"?h=gm().y(gf).x1(mf).x0(function(m){return m.base.x}):h=gm().x(mf).y1(gf).y0(function(m){return m.base.y}),h.defined(Cm).curve(d),h(v)}return l==="vertical"&&Mt(s)?h=gm().y(gf).x1(mf).x0(s):Mt(s)?h=gm().x(mf).y1(gf).y0(s):h=IN().x(mf).y(gf),h.defined(Cm).curve(d),h(f)},zg=function(t){var r=t.className,n=t.points,a=t.path,o=t.pathRef;if((!n||!n.length)&&!a)return null;var s=n&&n.length?MK(t):a;return Ce.createElement("path",D_({},yr(t,!1),gg(t),{className:Tr("recharts-curve",r),d:s,ref:o}))},LK=Object.getOwnPropertyNames,RK=Object.getOwnPropertySymbols,qK=Object.prototype.hasOwnProperty;function t3(e,t){return function(n,a,o){return e(n,a,o)&&t(n,a,o)}}function Am(e){return function(r,n,a){if(!r||!n||typeof r!="object"||typeof n!="object")return e(r,n,a);var o=a.cache,s=o.get(r),l=o.get(n);if(s&&l)return s===n&&l===r;o.set(r,n),o.set(n,r);var c=e(r,n,a);return o.delete(r),o.delete(n),c}}function r3(e){return LK(e).concat(RK(e))}var FK=Object.hasOwn||function(e,t){return qK.call(e,t)};function lu(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var $K="__v",BK="__o",UK="_owner",n3=Object.getOwnPropertyDescriptor,a3=Object.keys;function zK(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function WK(e,t){return lu(e.getTime(),t.getTime())}function HK(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function VK(e,t){return e===t}function i3(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var a=new Array(n),o=e.entries(),s,l,c=0;(s=o.next())&&!s.done;){for(var u=t.entries(),d=!1,f=0;(l=u.next())&&!l.done;){if(a[f]){f++;continue}var h=s.value,p=l.value;if(r.equals(h[0],p[0],c,f,e,t,r)&&r.equals(h[1],p[1],h[0],p[0],e,t,r)){d=a[f]=!0;break}f++}if(!d)return!1;c++}return!0}var GK=lu;function YK(e,t,r){var n=a3(e),a=n.length;if(a3(t).length!==a)return!1;for(;a-- >0;)if(!LM(e,t,r,n[a]))return!1;return!0}function vf(e,t,r){var n=r3(e),a=n.length;if(r3(t).length!==a)return!1;for(var o,s,l;a-- >0;)if(o=n[a],!LM(e,t,r,o)||(s=n3(e,o),l=n3(t,o),(s||l)&&(!s||!l||s.configurable!==l.configurable||s.enumerable!==l.enumerable||s.writable!==l.writable)))return!1;return!0}function KK(e,t){return lu(e.valueOf(),t.valueOf())}function QK(e,t){return e.source===t.source&&e.flags===t.flags}function o3(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var a=new Array(n),o=e.values(),s,l;(s=o.next())&&!s.done;){for(var c=t.values(),u=!1,d=0;(l=c.next())&&!l.done;){if(!a[d]&&r.equals(s.value,l.value,s.value,l.value,e,t,r)){u=a[d]=!0;break}d++}if(!u)return!1}return!0}function XK(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function JK(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function LM(e,t,r,n){return(n===UK||n===BK||n===$K)&&(e.$$typeof||t.$$typeof)?!0:FK(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}var ZK="[object Arguments]",eQ="[object Boolean]",tQ="[object Date]",rQ="[object Error]",nQ="[object Map]",aQ="[object Number]",iQ="[object Object]",oQ="[object RegExp]",sQ="[object Set]",lQ="[object String]",cQ="[object URL]",uQ=Array.isArray,s3=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,l3=Object.assign,dQ=Object.prototype.toString.call.bind(Object.prototype.toString);function fQ(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areErrorsEqual,a=e.areFunctionsEqual,o=e.areMapsEqual,s=e.areNumbersEqual,l=e.areObjectsEqual,c=e.arePrimitiveWrappersEqual,u=e.areRegExpsEqual,d=e.areSetsEqual,f=e.areTypedArraysEqual,h=e.areUrlsEqual;return function(v,m,y){if(v===m)return!0;if(v==null||m==null)return!1;var b=typeof v;if(b!==typeof m)return!1;if(b!=="object")return b==="number"?s(v,m,y):b==="function"?a(v,m,y):!1;var _=v.constructor;if(_!==m.constructor)return!1;if(_===Object)return l(v,m,y);if(uQ(v))return t(v,m,y);if(s3!=null&&s3(v))return f(v,m,y);if(_===Date)return r(v,m,y);if(_===RegExp)return u(v,m,y);if(_===Map)return o(v,m,y);if(_===Set)return d(v,m,y);var w=dQ(v);return w===tQ?r(v,m,y):w===oQ?u(v,m,y):w===nQ?o(v,m,y):w===sQ?d(v,m,y):w===iQ?typeof v.then!="function"&&typeof m.then!="function"&&l(v,m,y):w===cQ?h(v,m,y):w===rQ?n(v,m,y):w===ZK?l(v,m,y):w===eQ||w===aQ||w===lQ?c(v,m,y):!1}}function hQ(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,a={areArraysEqual:n?vf:zK,areDatesEqual:WK,areErrorsEqual:HK,areFunctionsEqual:VK,areMapsEqual:n?t3(i3,vf):i3,areNumbersEqual:GK,areObjectsEqual:n?vf:YK,arePrimitiveWrappersEqual:KK,areRegExpsEqual:QK,areSetsEqual:n?t3(o3,vf):o3,areTypedArraysEqual:n?vf:XK,areUrlsEqual:JK};if(r&&(a=l3({},a,r(a))),t){var o=Am(a.areArraysEqual),s=Am(a.areMapsEqual),l=Am(a.areObjectsEqual),c=Am(a.areSetsEqual);a=l3({},a,{areArraysEqual:o,areMapsEqual:s,areObjectsEqual:l,areSetsEqual:c})}return a}function pQ(e){return function(t,r,n,a,o,s,l){return e(t,r,l)}}function mQ(e){var t=e.circular,r=e.comparator,n=e.createState,a=e.equals,o=e.strict;if(n)return function(c,u){var d=n(),f=d.cache,h=f===void 0?t?new WeakMap:void 0:f,p=d.meta;return r(c,u,{cache:h,equals:a,meta:p,strict:o})};if(t)return function(c,u){return r(c,u,{cache:new WeakMap,equals:a,meta:void 0,strict:o})};var s={cache:void 0,equals:a,meta:void 0,strict:o};return function(c,u){return r(c,u,s)}}var gQ=uc();uc({strict:!0});uc({circular:!0});uc({circular:!0,strict:!0});uc({createInternalComparator:function(){return lu}});uc({strict:!0,createInternalComparator:function(){return lu}});uc({circular:!0,createInternalComparator:function(){return lu}});uc({circular:!0,createInternalComparator:function(){return lu},strict:!0});function uc(e){e===void 0&&(e={});var t=e.circular,r=t===void 0?!1:t,n=e.createInternalComparator,a=e.createState,o=e.strict,s=o===void 0?!1:o,l=hQ(e),c=fQ(l),u=n?n(c):pQ(c);return mQ({circular:r,comparator:c,createState:a,equals:u,strict:s})}function vQ(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function c3(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function a(o){r<0&&(r=o),o-r>t?(e(o),r=-1):vQ(a)};requestAnimationFrame(n)}function M_(e){"@babel/helpers - typeof";return M_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M_(e)}function yQ(e){return wQ(e)||_Q(e)||bQ(e)||xQ()}function xQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bQ(e,t){if(e){if(typeof e=="string")return u3(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u3(e,t)}}function u3(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _Q(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function wQ(e){if(Array.isArray(e))return e}function jQ(){var e={},t=function(){return null},r=!1,n=function a(o){if(!r){if(Array.isArray(o)){if(!o.length)return;var s=o,l=yQ(s),c=l[0],u=l.slice(1);if(typeof c=="number"){c3(a.bind(null,u),c);return}a(c),c3(a.bind(null,u));return}M_(o)==="object"&&(e=o,t(e)),typeof o=="function"&&o()}};return{stop:function(){r=!0},start:function(o){r=!1,n(o)},subscribe:function(o){return t=o,function(){t=function(){return null}}}}}function fp(e){"@babel/helpers - typeof";return fp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fp(e)}function d3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function f3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?d3(Object(r),!0).forEach(function(n){RM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function RM(e,t,r){return t=SQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SQ(e){var t=CQ(e,"string");return fp(t)==="symbol"?t:String(t)}function CQ(e,t){if(fp(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(fp(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var AQ=function(t,r){return[Object.keys(t),Object.keys(r)].reduce(function(n,a){return n.filter(function(o){return a.includes(o)})})},PQ=function(t){return t},OQ=function(t){return t.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},Ih=function(t,r){return Object.keys(r).reduce(function(n,a){return f3(f3({},n),{},RM({},a,t(a,r[a])))},{})},h3=function(t,r,n){return t.map(function(a){return"".concat(OQ(a)," ").concat(r,"ms ").concat(n)}).join(",")};function kQ(e,t){return IQ(e)||EQ(e,t)||qM(e,t)||TQ()}function TQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EQ(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function IQ(e){if(Array.isArray(e))return e}function NQ(e){return LQ(e)||MQ(e)||qM(e)||DQ()}function DQ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qM(e,t){if(e){if(typeof e=="string")return L_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return L_(e,t)}}function MQ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function LQ(e){if(Array.isArray(e))return L_(e)}function L_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Wg=1e-4,FM=function(t,r){return[0,3*t,3*r-6*t,3*t-3*r+1]},$M=function(t,r){return t.map(function(n,a){return n*Math.pow(r,a)}).reduce(function(n,a){return n+a})},p3=function(t,r){return function(n){var a=FM(t,r);return $M(a,n)}},RQ=function(t,r){return function(n){var a=FM(t,r),o=[].concat(NQ(a.map(function(s,l){return s*l}).slice(1)),[0]);return $M(o,n)}},m3=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=r[0],o=r[1],s=r[2],l=r[3];if(r.length===1)switch(r[0]){case"linear":a=0,o=0,s=1,l=1;break;case"ease":a=.25,o=.1,s=.25,l=1;break;case"ease-in":a=.42,o=0,s=1,l=1;break;case"ease-out":a=.42,o=0,s=.58,l=1;break;case"ease-in-out":a=0,o=0,s=.58,l=1;break;default:{var c=r[0].split("(");if(c[0]==="cubic-bezier"&&c[1].split(")")[0].split(",").length===4){var u=c[1].split(")")[0].split(",").map(function(y){return parseFloat(y)}),d=kQ(u,4);a=d[0],o=d[1],s=d[2],l=d[3]}}}var f=p3(a,s),h=p3(o,l),p=RQ(a,s),v=function(b){return b>1?1:b<0?0:b},m=function(b){for(var _=b>1?1:b,w=_,A=0;A<8;++A){var P=f(w)-_,T=p(w);if(Math.abs(P-_)<Wg||T<Wg)return h(w);w=v(w-P/T)}return h(w)};return m.isStepper=!1,m},qQ=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.stiff,n=r===void 0?100:r,a=t.damping,o=a===void 0?8:a,s=t.dt,l=s===void 0?17:s,c=function(d,f,h){var p=-(d-f)*n,v=h*o,m=h+(p-v)*l/1e3,y=h*l/1e3+d;return Math.abs(y-f)<Wg&&Math.abs(m)<Wg?[f,0]:[y,m]};return c.isStepper=!0,c.dt=l,c},FQ=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=r[0];if(typeof a=="string")switch(a){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return m3(a);case"spring":return qQ();default:if(a.split("(")[0]==="cubic-bezier")return m3(a)}return typeof a=="function"?a:null};function hp(e){"@babel/helpers - typeof";return hp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hp(e)}function g3(e){return UQ(e)||BQ(e)||BM(e)||$Q()}function $Q(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function BQ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function UQ(e){if(Array.isArray(e))return q_(e)}function v3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ci(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?v3(Object(r),!0).forEach(function(n){R_(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function R_(e,t,r){return t=zQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zQ(e){var t=WQ(e,"string");return hp(t)==="symbol"?t:String(t)}function WQ(e,t){if(hp(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(hp(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function HQ(e,t){return YQ(e)||GQ(e,t)||BM(e,t)||VQ()}function VQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function BM(e,t){if(e){if(typeof e=="string")return q_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return q_(e,t)}}function q_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function GQ(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function YQ(e){if(Array.isArray(e))return e}var Hg=function(t,r,n){return t+(r-t)*n},F_=function(t){var r=t.from,n=t.to;return r!==n},KQ=function e(t,r,n){var a=Ih(function(o,s){if(F_(s)){var l=t(s.from,s.to,s.velocity),c=HQ(l,2),u=c[0],d=c[1];return ci(ci({},s),{},{from:u,velocity:d})}return s},r);return n<1?Ih(function(o,s){return F_(s)?ci(ci({},s),{},{velocity:Hg(s.velocity,a[o].velocity,n),from:Hg(s.from,a[o].from,n)}):s},r):e(t,a,n-1)};const QQ=function(e,t,r,n,a){var o=AQ(e,t),s=o.reduce(function(y,b){return ci(ci({},y),{},R_({},b,[e[b],t[b]]))},{}),l=o.reduce(function(y,b){return ci(ci({},y),{},R_({},b,{from:e[b],velocity:0,to:t[b]}))},{}),c=-1,u,d,f=function(){return null},h=function(){return Ih(function(b,_){return _.from},l)},p=function(){return!Object.values(l).filter(F_).length},v=function(b){u||(u=b);var _=b-u,w=_/r.dt;l=KQ(r,l,w),a(ci(ci(ci({},e),t),h())),u=b,p()||(c=requestAnimationFrame(f))},m=function(b){d||(d=b);var _=(b-d)/n,w=Ih(function(P,T){return Hg.apply(void 0,g3(T).concat([r(_)]))},s);if(a(ci(ci(ci({},e),t),w)),_<1)c=requestAnimationFrame(f);else{var A=Ih(function(P,T){return Hg.apply(void 0,g3(T).concat([r(1)]))},s);a(ci(ci(ci({},e),t),A))}};return f=r.isStepper?v:m,function(){return requestAnimationFrame(f),function(){cancelAnimationFrame(c)}}};function cd(e){"@babel/helpers - typeof";return cd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cd(e)}var XQ=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function JQ(e,t){if(e==null)return{};var r=ZQ(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ZQ(e,t){if(e==null)return{};var r={},n=Object.keys(e),a,o;for(o=0;o<n.length;o++)a=n[o],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}function R1(e){return nX(e)||rX(e)||tX(e)||eX()}function eX(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tX(e,t){if(e){if(typeof e=="string")return $_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $_(e,t)}}function rX(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function nX(e){if(Array.isArray(e))return $_(e)}function $_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function y3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Jo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?y3(Object(r),!0).forEach(function(n){Ph(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ph(e,t,r){return t=UM(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aX(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function iX(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,UM(n.key),n)}}function oX(e,t,r){return t&&iX(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function UM(e){var t=sX(e,"string");return cd(t)==="symbol"?t:String(t)}function sX(e,t){if(cd(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(cd(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function lX(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B_(e,t)}function B_(e,t){return B_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},B_(e,t)}function cX(e){var t=uX();return function(){var n=Vg(e),a;if(t){var o=Vg(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return U_(this,a)}}function U_(e,t){if(t&&(cd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return z_(e)}function z_(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function uX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Vg(e){return Vg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Vg(e)}var Ts=function(e){lX(r,e);var t=cX(r);function r(n,a){var o;aX(this,r),o=t.call(this,n,a);var s=o.props,l=s.isActive,c=s.attributeName,u=s.from,d=s.to,f=s.steps,h=s.children,p=s.duration;if(o.handleStyleChange=o.handleStyleChange.bind(z_(o)),o.changeStyle=o.changeStyle.bind(z_(o)),!l||p<=0)return o.state={style:{}},typeof h=="function"&&(o.state={style:d}),U_(o);if(f&&f.length)o.state={style:f[0].style};else if(u){if(typeof h=="function")return o.state={style:u},U_(o);o.state={style:c?Ph({},c,u):u}}else o.state={style:{}};return o}return oX(r,[{key:"componentDidMount",value:function(){var a=this.props,o=a.isActive,s=a.canBegin;this.mounted=!0,!(!o||!s)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(a){var o=this.props,s=o.isActive,l=o.canBegin,c=o.attributeName,u=o.shouldReAnimate,d=o.to,f=o.from,h=this.state.style;if(l){if(!s){var p={style:c?Ph({},c,d):d};this.state&&h&&(c&&h[c]!==d||!c&&h!==d)&&this.setState(p);return}if(!(gQ(a.to,d)&&a.canBegin&&a.isActive)){var v=!a.canBegin||!a.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var m=v||u?f:a.to;if(this.state&&h){var y={style:c?Ph({},c,m):m};(c&&h[c]!==m||!c&&h!==m)&&this.setState(y)}this.runAnimation(Jo(Jo({},this.props),{},{from:m,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var a=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),a&&a()}},{key:"handleStyleChange",value:function(a){this.changeStyle(a)}},{key:"changeStyle",value:function(a){this.mounted&&this.setState({style:a})}},{key:"runJSAnimation",value:function(a){var o=this,s=a.from,l=a.to,c=a.duration,u=a.easing,d=a.begin,f=a.onAnimationEnd,h=a.onAnimationStart,p=QQ(s,l,FQ(u),c,this.changeStyle),v=function(){o.stopJSAnimation=p()};this.manager.start([h,d,v,c,f])}},{key:"runStepAnimation",value:function(a){var o=this,s=a.steps,l=a.begin,c=a.onAnimationStart,u=s[0],d=u.style,f=u.duration,h=f===void 0?0:f,p=function(m,y,b){if(b===0)return m;var _=y.duration,w=y.easing,A=w===void 0?"ease":w,P=y.style,T=y.properties,E=y.onAnimationEnd,S=b>0?s[b-1]:y,I=T||Object.keys(P);if(typeof A=="function"||A==="spring")return[].concat(R1(m),[o.runJSAnimation.bind(o,{from:S.style,to:P,duration:_,easing:A}),_]);var W=h3(I,_,A),O=Jo(Jo(Jo({},S.style),P),{},{transition:W});return[].concat(R1(m),[O,_,E]).filter(PQ)};return this.manager.start([c].concat(R1(s.reduce(p,[d,Math.max(h,l)])),[a.onAnimationEnd]))}},{key:"runAnimation",value:function(a){this.manager||(this.manager=jQ());var o=a.begin,s=a.duration,l=a.attributeName,c=a.to,u=a.easing,d=a.onAnimationStart,f=a.onAnimationEnd,h=a.steps,p=a.children,v=this.manager;if(this.unSubscribe=v.subscribe(this.handleStyleChange),typeof u=="function"||typeof p=="function"||u==="spring"){this.runJSAnimation(a);return}if(h.length>1){this.runStepAnimation(a);return}var m=l?Ph({},l,c):c,y=h3(Object.keys(m),s,u);v.start([d,o,Jo(Jo({},m),{},{transition:y}),s,f])}},{key:"render",value:function(){var a=this.props,o=a.children;a.begin;var s=a.duration;a.attributeName,a.easing;var l=a.isActive;a.steps,a.from,a.to,a.canBegin,a.onAnimationEnd,a.shouldReAnimate,a.onAnimationReStart;var c=JQ(a,XQ),u=x.Children.count(o),d=this.state.style;if(typeof o=="function")return o(d);if(!l||u===0||s<=0)return o;var f=function(p){var v=p.props,m=v.style,y=m===void 0?{}:m,b=v.className,_=x.cloneElement(p,Jo(Jo({},c),{},{style:Jo(Jo({},y),d),className:b}));return _};return u===1?f(x.Children.only(o)):Ce.createElement("div",null,x.Children.map(o,function(h){return f(h)}))}}]),r}(x.PureComponent);Ts.displayName="Animate";Ts.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Ts.propTypes={from:yn.oneOfType([yn.object,yn.string]),to:yn.oneOfType([yn.object,yn.string]),attributeName:yn.string,duration:yn.number,begin:yn.number,easing:yn.oneOfType([yn.string,yn.func]),steps:yn.arrayOf(yn.shape({duration:yn.number.isRequired,style:yn.object.isRequired,easing:yn.oneOfType([yn.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),yn.func]),properties:yn.arrayOf("string"),onAnimationEnd:yn.func})),children:yn.oneOfType([yn.node,yn.func]),isActive:yn.bool,canBegin:yn.bool,onAnimationEnd:yn.func,shouldReAnimate:yn.bool,onAnimationStart:yn.func,onAnimationReStart:yn.func};function pp(e){"@babel/helpers - typeof";return pp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pp(e)}function Gg(){return Gg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Gg.apply(this,arguments)}function dX(e,t){return mX(e)||pX(e,t)||hX(e,t)||fX()}function fX(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hX(e,t){if(e){if(typeof e=="string")return x3(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return x3(e,t)}}function x3(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function pX(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function mX(e){if(Array.isArray(e))return e}function b3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?b3(Object(r),!0).forEach(function(n){gX(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gX(e,t,r){return t=vX(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vX(e){var t=yX(e,"string");return pp(t)=="symbol"?t:t+""}function yX(e,t){if(pp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(pp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var w3=function(t,r,n,a,o){var s=Math.min(Math.abs(n)/2,Math.abs(a)/2),l=a>=0?1:-1,c=n>=0?1:-1,u=a>=0&&n>=0||a<0&&n<0?1:0,d;if(s>0&&o instanceof Array){for(var f=[0,0,0,0],h=0,p=4;h<p;h++)f[h]=o[h]>s?s:o[h];d="M".concat(t,",").concat(r+l*f[0]),f[0]>0&&(d+="A ".concat(f[0],",").concat(f[0],",0,0,").concat(u,",").concat(t+c*f[0],",").concat(r)),d+="L ".concat(t+n-c*f[1],",").concat(r),f[1]>0&&(d+="A ".concat(f[1],",").concat(f[1],",0,0,").concat(u,`,
        `).concat(t+n,",").concat(r+l*f[1])),d+="L ".concat(t+n,",").concat(r+a-l*f[2]),f[2]>0&&(d+="A ".concat(f[2],",").concat(f[2],",0,0,").concat(u,`,
        `).concat(t+n-c*f[2],",").concat(r+a)),d+="L ".concat(t+c*f[3],",").concat(r+a),f[3]>0&&(d+="A ".concat(f[3],",").concat(f[3],",0,0,").concat(u,`,
        `).concat(t,",").concat(r+a-l*f[3])),d+="Z"}else if(s>0&&o===+o&&o>0){var v=Math.min(s,o);d="M ".concat(t,",").concat(r+l*v,`
            A `).concat(v,",").concat(v,",0,0,").concat(u,",").concat(t+c*v,",").concat(r,`
            L `).concat(t+n-c*v,",").concat(r,`
            A `).concat(v,",").concat(v,",0,0,").concat(u,",").concat(t+n,",").concat(r+l*v,`
            L `).concat(t+n,",").concat(r+a-l*v,`
            A `).concat(v,",").concat(v,",0,0,").concat(u,",").concat(t+n-c*v,",").concat(r+a,`
            L `).concat(t+c*v,",").concat(r+a,`
            A `).concat(v,",").concat(v,",0,0,").concat(u,",").concat(t,",").concat(r+a-l*v," Z")}else d="M ".concat(t,",").concat(r," h ").concat(n," v ").concat(a," h ").concat(-n," Z");return d},xX=function(t,r){if(!t||!r)return!1;var n=t.x,a=t.y,o=r.x,s=r.y,l=r.width,c=r.height;if(Math.abs(l)>0&&Math.abs(c)>0){var u=Math.min(o,o+l),d=Math.max(o,o+l),f=Math.min(s,s+c),h=Math.max(s,s+c);return n>=u&&n<=d&&a>=f&&a<=h}return!1},bX={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},eS=function(t){var r=_3(_3({},bX),t),n=x.useRef(),a=x.useState(-1),o=dX(a,2),s=o[0],l=o[1];x.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var A=n.current.getTotalLength();A&&l(A)}catch{}},[]);var c=r.x,u=r.y,d=r.width,f=r.height,h=r.radius,p=r.className,v=r.animationEasing,m=r.animationDuration,y=r.animationBegin,b=r.isAnimationActive,_=r.isUpdateAnimationActive;if(c!==+c||u!==+u||d!==+d||f!==+f||d===0||f===0)return null;var w=Tr("recharts-rectangle",p);return _?Ce.createElement(Ts,{canBegin:s>0,from:{width:d,height:f,x:c,y:u},to:{width:d,height:f,x:c,y:u},duration:m,animationEasing:v,isActive:_},function(A){var P=A.width,T=A.height,E=A.x,S=A.y;return Ce.createElement(Ts,{canBegin:s>0,from:"0px ".concat(s===-1?1:s,"px"),to:"".concat(s,"px 0px"),attributeName:"strokeDasharray",begin:y,duration:m,isActive:b,easing:v},Ce.createElement("path",Gg({},yr(r,!0),{className:w,d:w3(E,S,P,T,h),ref:n})))}):Ce.createElement("path",Gg({},yr(r,!0),{className:w,d:w3(c,u,d,f,h)}))},_X=["points","className","baseLinePoints","connectNulls"];function Nu(){return Nu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Nu.apply(this,arguments)}function wX(e,t){if(e==null)return{};var r=jX(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function jX(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function j3(e){return PX(e)||AX(e)||CX(e)||SX()}function SX(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CX(e,t){if(e){if(typeof e=="string")return W_(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return W_(e,t)}}function AX(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function PX(e){if(Array.isArray(e))return W_(e)}function W_(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var S3=function(t){return t&&t.x===+t.x&&t.y===+t.y},OX=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=[[]];return t.forEach(function(n){S3(n)?r[r.length-1].push(n):r[r.length-1].length>0&&r.push([])}),S3(t[0])&&r[r.length-1].push(t[0]),r[r.length-1].length<=0&&(r=r.slice(0,-1)),r},Nh=function(t,r){var n=OX(t);r&&(n=[n.reduce(function(o,s){return[].concat(j3(o),j3(s))},[])]);var a=n.map(function(o){return o.reduce(function(s,l,c){return"".concat(s).concat(c===0?"M":"L").concat(l.x,",").concat(l.y)},"")}).join("");return n.length===1?"".concat(a,"Z"):a},kX=function(t,r,n){var a=Nh(t,n);return"".concat(a.slice(-1)==="Z"?a.slice(0,-1):a,"L").concat(Nh(r.reverse(),n).slice(1))},TX=function(t){var r=t.points,n=t.className,a=t.baseLinePoints,o=t.connectNulls,s=wX(t,_X);if(!r||!r.length)return null;var l=Tr("recharts-polygon",n);if(a&&a.length){var c=s.stroke&&s.stroke!=="none",u=kX(r,a,o);return Ce.createElement("g",{className:l},Ce.createElement("path",Nu({},yr(s,!0),{fill:u.slice(-1)==="Z"?s.fill:"none",stroke:"none",d:u})),c?Ce.createElement("path",Nu({},yr(s,!0),{fill:"none",d:Nh(r,o)})):null,c?Ce.createElement("path",Nu({},yr(s,!0),{fill:"none",d:Nh(a,o)})):null)}var d=Nh(r,o);return Ce.createElement("path",Nu({},yr(s,!0),{fill:d.slice(-1)==="Z"?s.fill:"none",className:l,d}))};function H_(){return H_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},H_.apply(this,arguments)}var dy=function(t){var r=t.cx,n=t.cy,a=t.r,o=t.className,s=Tr("recharts-dot",o);return r===+r&&n===+n&&a===+a?Ce.createElement("circle",H_({},yr(t,!1),gg(t),{className:s,cx:r,cy:n,r:a})):null};function mp(e){"@babel/helpers - typeof";return mp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mp(e)}var EX=["x","y","top","left","width","height","className"];function V_(){return V_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},V_.apply(this,arguments)}function C3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function IX(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?C3(Object(r),!0).forEach(function(n){NX(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function NX(e,t,r){return t=DX(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function DX(e){var t=MX(e,"string");return mp(t)=="symbol"?t:t+""}function MX(e,t){if(mp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(mp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function LX(e,t){if(e==null)return{};var r=RX(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function RX(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var qX=function(t,r,n,a,o,s){return"M".concat(t,",").concat(o,"v").concat(a,"M").concat(s,",").concat(r,"h").concat(n)},FX=function(t){var r=t.x,n=r===void 0?0:r,a=t.y,o=a===void 0?0:a,s=t.top,l=s===void 0?0:s,c=t.left,u=c===void 0?0:c,d=t.width,f=d===void 0?0:d,h=t.height,p=h===void 0?0:h,v=t.className,m=LX(t,EX),y=IX({x:n,y:o,top:l,left:u,width:f,height:p},m);return!Mt(n)||!Mt(o)||!Mt(f)||!Mt(p)||!Mt(l)||!Mt(u)?null:Ce.createElement("path",V_({},yr(y,!0),{className:Tr("recharts-cross",v),d:qX(n,o,f,p,l,u)}))},q1,A3;function $X(){if(A3)return q1;A3=1;var e=oy(),t=nM(),r=Rs();function n(a,o){return a&&a.length?e(a,r(o,2),t):void 0}return q1=n,q1}var BX=$X();const UX=Et(BX);var F1,P3;function zX(){if(P3)return F1;P3=1;var e=oy(),t=Rs(),r=aM();function n(a,o){return a&&a.length?e(a,t(o,2),r):void 0}return F1=n,F1}var WX=zX();const HX=Et(WX);var VX=["cx","cy","angle","ticks","axisLine"],GX=["ticks","tick","angle","tickFormatter","stroke"];function ud(e){"@babel/helpers - typeof";return ud=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ud(e)}function Dh(){return Dh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Dh.apply(this,arguments)}function O3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function jc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?O3(Object(r),!0).forEach(function(n){fy(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function k3(e,t){if(e==null)return{};var r=YX(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function YX(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function KX(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T3(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,WM(n.key),n)}}function QX(e,t,r){return t&&T3(e.prototype,t),r&&T3(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function XX(e,t,r){return t=Yg(t),JX(e,zM()?Reflect.construct(t,r||[],Yg(e).constructor):t.apply(e,r))}function JX(e,t){if(t&&(ud(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ZX(e)}function ZX(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zM(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(zM=function(){return!!e})()}function Yg(e){return Yg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Yg(e)}function eJ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&G_(e,t)}function G_(e,t){return G_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},G_(e,t)}function fy(e,t,r){return t=WM(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function WM(e){var t=tJ(e,"string");return ud(t)=="symbol"?t:t+""}function tJ(e,t){if(ud(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ud(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var hy=function(e){function t(){return KX(this,t),XX(this,t,arguments)}return eJ(t,e),QX(t,[{key:"getTickValueCoord",value:function(n){var a=n.coordinate,o=this.props,s=o.angle,l=o.cx,c=o.cy;return Fn(l,c,a,s)}},{key:"getTickTextAnchor",value:function(){var n=this.props.orientation,a;switch(n){case"left":a="end";break;case"right":a="start";break;default:a="middle";break}return a}},{key:"getViewBox",value:function(){var n=this.props,a=n.cx,o=n.cy,s=n.angle,l=n.ticks,c=UX(l,function(d){return d.coordinate||0}),u=HX(l,function(d){return d.coordinate||0});return{cx:a,cy:o,startAngle:s,endAngle:s,innerRadius:u.coordinate||0,outerRadius:c.coordinate||0}}},{key:"renderAxisLine",value:function(){var n=this.props,a=n.cx,o=n.cy,s=n.angle,l=n.ticks,c=n.axisLine,u=k3(n,VX),d=l.reduce(function(v,m){return[Math.min(v[0],m.coordinate),Math.max(v[1],m.coordinate)]},[1/0,-1/0]),f=Fn(a,o,d[0],s),h=Fn(a,o,d[1],s),p=jc(jc(jc({},yr(u,!1)),{},{fill:"none"},yr(c,!1)),{},{x1:f.x,y1:f.y,x2:h.x,y2:h.y});return Ce.createElement("line",Dh({className:"recharts-polar-radius-axis-line"},p))}},{key:"renderTicks",value:function(){var n=this,a=this.props,o=a.ticks,s=a.tick,l=a.angle,c=a.tickFormatter,u=a.stroke,d=k3(a,GX),f=this.getTickTextAnchor(),h=yr(d,!1),p=yr(s,!1),v=o.map(function(m,y){var b=n.getTickValueCoord(m),_=jc(jc(jc(jc({textAnchor:f,transform:"rotate(".concat(90-l,", ").concat(b.x,", ").concat(b.y,")")},h),{},{stroke:"none",fill:u},p),{},{index:y},b),{},{payload:m});return Ce.createElement(un,Dh({className:Tr("recharts-polar-radius-axis-tick",IM(s)),key:"tick-".concat(m.coordinate)},Yc(n.props,m,y)),t.renderTickItem(s,_,c?c(m.value,y):m.value))});return Ce.createElement(un,{className:"recharts-polar-radius-axis-ticks"},v)}},{key:"render",value:function(){var n=this.props,a=n.ticks,o=n.axisLine,s=n.tick;return!a||!a.length?null:Ce.createElement(un,{className:Tr("recharts-polar-radius-axis",this.props.className)},o&&this.renderAxisLine(),s&&this.renderTicks(),ei.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(n,a,o){var s;return Ce.isValidElement(n)?s=Ce.cloneElement(n,a):Nr(n)?s=n(a):s=Ce.createElement(Kc,Dh({},a,{className:"recharts-polar-radius-axis-tick-value"}),o),s}}])}(x.PureComponent);fy(hy,"displayName","PolarRadiusAxis");fy(hy,"axisType","radiusAxis");fy(hy,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function dd(e){"@babel/helpers - typeof";return dd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dd(e)}function Ec(){return Ec=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ec.apply(this,arguments)}function E3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Sc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?E3(Object(r),!0).forEach(function(n){py(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rJ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I3(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,VM(n.key),n)}}function nJ(e,t,r){return t&&I3(e.prototype,t),r&&I3(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function aJ(e,t,r){return t=Kg(t),iJ(e,HM()?Reflect.construct(t,r||[],Kg(e).constructor):t.apply(e,r))}function iJ(e,t){if(t&&(dd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return oJ(e)}function oJ(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function HM(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(HM=function(){return!!e})()}function Kg(e){return Kg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Kg(e)}function sJ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Y_(e,t)}function Y_(e,t){return Y_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Y_(e,t)}function py(e,t,r){return t=VM(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function VM(e){var t=lJ(e,"string");return dd(t)=="symbol"?t:t+""}function lJ(e,t){if(dd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(dd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var cJ=Math.PI/180,N3=1e-5,my=function(e){function t(){return rJ(this,t),aJ(this,t,arguments)}return sJ(t,e),nJ(t,[{key:"getTickLineCoord",value:function(n){var a=this.props,o=a.cx,s=a.cy,l=a.radius,c=a.orientation,u=a.tickSize,d=u||8,f=Fn(o,s,l,n.coordinate),h=Fn(o,s,l+(c==="inner"?-1:1)*d,n.coordinate);return{x1:f.x,y1:f.y,x2:h.x,y2:h.y}}},{key:"getTickTextAnchor",value:function(n){var a=this.props.orientation,o=Math.cos(-n.coordinate*cJ),s;return o>N3?s=a==="outer"?"start":"end":o<-N3?s=a==="outer"?"end":"start":s="middle",s}},{key:"renderAxisLine",value:function(){var n=this.props,a=n.cx,o=n.cy,s=n.radius,l=n.axisLine,c=n.axisLineType,u=Sc(Sc({},yr(this.props,!1)),{},{fill:"none"},yr(l,!1));if(c==="circle")return Ce.createElement(dy,Ec({className:"recharts-polar-angle-axis-line"},u,{cx:a,cy:o,r:s}));var d=this.props.ticks,f=d.map(function(h){return Fn(a,o,s,h.coordinate)});return Ce.createElement(TX,Ec({className:"recharts-polar-angle-axis-line"},u,{points:f}))}},{key:"renderTicks",value:function(){var n=this,a=this.props,o=a.ticks,s=a.tick,l=a.tickLine,c=a.tickFormatter,u=a.stroke,d=yr(this.props,!1),f=yr(s,!1),h=Sc(Sc({},d),{},{fill:"none"},yr(l,!1)),p=o.map(function(v,m){var y=n.getTickLineCoord(v),b=n.getTickTextAnchor(v),_=Sc(Sc(Sc({textAnchor:b},d),{},{stroke:"none",fill:u},f),{},{index:m,payload:v,x:y.x2,y:y.y2});return Ce.createElement(un,Ec({className:Tr("recharts-polar-angle-axis-tick",IM(s)),key:"tick-".concat(v.coordinate)},Yc(n.props,v,m)),l&&Ce.createElement("line",Ec({className:"recharts-polar-angle-axis-tick-line"},h,y)),s&&t.renderTickItem(s,_,c?c(v.value,m):v.value))});return Ce.createElement(un,{className:"recharts-polar-angle-axis-ticks"},p)}},{key:"render",value:function(){var n=this.props,a=n.ticks,o=n.radius,s=n.axisLine;return o<=0||!a||!a.length?null:Ce.createElement(un,{className:Tr("recharts-polar-angle-axis",this.props.className)},s&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(n,a,o){var s;return Ce.isValidElement(n)?s=Ce.cloneElement(n,a):Nr(n)?s=n(a):s=Ce.createElement(Kc,Ec({},a,{className:"recharts-polar-angle-axis-tick-value"}),o),s}}])}(x.PureComponent);py(my,"displayName","PolarAngleAxis");py(my,"axisType","angleAxis");py(my,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var $1,D3;function uJ(){if(D3)return $1;D3=1;var e=tD(),t=e(Object.getPrototypeOf,Object);return $1=t,$1}var B1,M3;function dJ(){if(M3)return B1;M3=1;var e=_l(),t=uJ(),r=wl(),n="[object Object]",a=Function.prototype,o=Object.prototype,s=a.toString,l=o.hasOwnProperty,c=s.call(Object);function u(d){if(!r(d)||e(d)!=n)return!1;var f=t(d);if(f===null)return!0;var h=l.call(f,"constructor")&&f.constructor;return typeof h=="function"&&h instanceof h&&s.call(h)==c}return B1=u,B1}var fJ=dJ();const hJ=Et(fJ);var U1,L3;function pJ(){if(L3)return U1;L3=1;var e=_l(),t=wl(),r="[object Boolean]";function n(a){return a===!0||a===!1||t(a)&&e(a)==r}return U1=n,U1}var mJ=pJ();const gJ=Et(mJ);function gp(e){"@babel/helpers - typeof";return gp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gp(e)}function Qg(){return Qg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Qg.apply(this,arguments)}function vJ(e,t){return _J(e)||bJ(e,t)||xJ(e,t)||yJ()}function yJ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xJ(e,t){if(e){if(typeof e=="string")return R3(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return R3(e,t)}}function R3(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function bJ(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function _J(e){if(Array.isArray(e))return e}function q3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function F3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?q3(Object(r),!0).forEach(function(n){wJ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wJ(e,t,r){return t=jJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jJ(e){var t=SJ(e,"string");return gp(t)=="symbol"?t:t+""}function SJ(e,t){if(gp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(gp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var $3=function(t,r,n,a,o){var s=n-a,l;return l="M ".concat(t,",").concat(r),l+="L ".concat(t+n,",").concat(r),l+="L ".concat(t+n-s/2,",").concat(r+o),l+="L ".concat(t+n-s/2-a,",").concat(r+o),l+="L ".concat(t,",").concat(r," Z"),l},CJ={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},AJ=function(t){var r=F3(F3({},CJ),t),n=x.useRef(),a=x.useState(-1),o=vJ(a,2),s=o[0],l=o[1];x.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var w=n.current.getTotalLength();w&&l(w)}catch{}},[]);var c=r.x,u=r.y,d=r.upperWidth,f=r.lowerWidth,h=r.height,p=r.className,v=r.animationEasing,m=r.animationDuration,y=r.animationBegin,b=r.isUpdateAnimationActive;if(c!==+c||u!==+u||d!==+d||f!==+f||h!==+h||d===0&&f===0||h===0)return null;var _=Tr("recharts-trapezoid",p);return b?Ce.createElement(Ts,{canBegin:s>0,from:{upperWidth:0,lowerWidth:0,height:h,x:c,y:u},to:{upperWidth:d,lowerWidth:f,height:h,x:c,y:u},duration:m,animationEasing:v,isActive:b},function(w){var A=w.upperWidth,P=w.lowerWidth,T=w.height,E=w.x,S=w.y;return Ce.createElement(Ts,{canBegin:s>0,from:"0px ".concat(s===-1?1:s,"px"),to:"".concat(s,"px 0px"),attributeName:"strokeDasharray",begin:y,duration:m,easing:v},Ce.createElement("path",Qg({},yr(r,!0),{className:_,d:$3(E,S,A,P,T),ref:n})))}):Ce.createElement("g",null,Ce.createElement("path",Qg({},yr(r,!0),{className:_,d:$3(c,u,d,f,h)})))},PJ=["option","shapeType","propTransformer","activeClassName","isActive"];function vp(e){"@babel/helpers - typeof";return vp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vp(e)}function OJ(e,t){if(e==null)return{};var r=kJ(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function kJ(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function B3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?B3(Object(r),!0).forEach(function(n){TJ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function TJ(e,t,r){return t=EJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function EJ(e){var t=IJ(e,"string");return vp(t)=="symbol"?t:t+""}function IJ(e,t){if(vp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(vp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function NJ(e,t){return Xg(Xg({},t),e)}function DJ(e,t){return e==="symbols"}function U3(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return Ce.createElement(eS,r);case"trapezoid":return Ce.createElement(AJ,r);case"sector":return Ce.createElement(MM,r);case"symbols":if(DJ(t))return Ce.createElement(xj,r);break;default:return null}}function MJ(e){return x.isValidElement(e)?e.props:e}function GM(e){var t=e.option,r=e.shapeType,n=e.propTransformer,a=n===void 0?NJ:n,o=e.activeClassName,s=o===void 0?"recharts-active-shape":o,l=e.isActive,c=OJ(e,PJ),u;if(x.isValidElement(t))u=x.cloneElement(t,Xg(Xg({},c),MJ(t)));else if(Nr(t))u=t(c);else if(hJ(t)&&!gJ(t)){var d=a(t,c);u=Ce.createElement(U3,{shapeType:r,elementProps:d})}else{var f=c;u=Ce.createElement(U3,{shapeType:r,elementProps:f})}return l?Ce.createElement(un,{className:s},u):u}function gy(e,t){return t!=null&&"trapezoids"in e.props}function vy(e,t){return t!=null&&"sectors"in e.props}function yp(e,t){return t!=null&&"points"in e.props}function LJ(e,t){var r,n,a=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,o=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return a&&o}function RJ(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function qJ(e,t){var r=e.x===t.x,n=e.y===t.y,a=e.z===t.z;return r&&n&&a}function FJ(e,t){var r;return gy(e,t)?r=LJ:vy(e,t)?r=RJ:yp(e,t)&&(r=qJ),r}function $J(e,t){var r;return gy(e,t)?r="trapezoids":vy(e,t)?r="sectors":yp(e,t)&&(r="points"),r}function BJ(e,t){if(gy(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(vy(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return yp(e,t)?t.payload:{}}function UJ(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,a=$J(r,t),o=BJ(r,t),s=n.filter(function(c,u){var d=Bp(o,c),f=r.props[a].filter(function(v){var m=FJ(r,t);return m(v,t)}),h=r.props[a].indexOf(f[f.length-1]),p=u===h;return d&&p}),l=n.indexOf(s[s.length-1]);return l}var Km;function fd(e){"@babel/helpers - typeof";return fd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fd(e)}function Du(){return Du=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Du.apply(this,arguments)}function z3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ln(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?z3(Object(r),!0).forEach(function(n){zo(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function zJ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function W3(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,KM(n.key),n)}}function WJ(e,t,r){return t&&W3(e.prototype,t),r&&W3(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function HJ(e,t,r){return t=Jg(t),VJ(e,YM()?Reflect.construct(t,r||[],Jg(e).constructor):t.apply(e,r))}function VJ(e,t){if(t&&(fd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return GJ(e)}function GJ(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function YM(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(YM=function(){return!!e})()}function Jg(e){return Jg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Jg(e)}function YJ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&K_(e,t)}function K_(e,t){return K_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},K_(e,t)}function zo(e,t,r){return t=KM(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function KM(e){var t=KJ(e,"string");return fd(t)=="symbol"?t:t+""}function KJ(e,t){if(fd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(fd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Sl=function(e){function t(r){var n;return zJ(this,t),n=HJ(this,t,[r]),zo(n,"pieRef",null),zo(n,"sectorRefs",[]),zo(n,"id",qd("recharts-pie-")),zo(n,"handleAnimationEnd",function(){var a=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),Nr(a)&&a()}),zo(n,"handleAnimationStart",function(){var a=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),Nr(a)&&a()}),n.state={isAnimationFinished:!r.isAnimationActive,prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,sectorToFocus:0},n}return YJ(t,e),WJ(t,[{key:"isActiveIndex",value:function(n){var a=this.props.activeIndex;return Array.isArray(a)?a.indexOf(n)!==-1:n===a}},{key:"hasActiveIndex",value:function(){var n=this.props.activeIndex;return Array.isArray(n)?n.length!==0:n||n===0}},{key:"renderLabels",value:function(n){var a=this.props.isAnimationActive;if(a&&!this.state.isAnimationFinished)return null;var o=this.props,s=o.label,l=o.labelLine,c=o.dataKey,u=o.valueKey,d=yr(this.props,!1),f=yr(s,!1),h=yr(l,!1),p=s&&s.offsetRadius||20,v=n.map(function(m,y){var b=(m.startAngle+m.endAngle)/2,_=Fn(m.cx,m.cy,m.outerRadius+p,b),w=Ln(Ln(Ln(Ln({},d),m),{},{stroke:"none"},f),{},{index:y,textAnchor:t.getTextAnchor(_.x,m.cx)},_),A=Ln(Ln(Ln(Ln({},d),m),{},{fill:"none",stroke:m.fill},h),{},{index:y,points:[Fn(m.cx,m.cy,m.outerRadius,b),_]}),P=c;return $r(c)&&$r(u)?P="value":$r(c)&&(P=u),Ce.createElement(un,{key:"label-".concat(m.startAngle,"-").concat(m.endAngle,"-").concat(m.midAngle,"-").concat(y)},l&&t.renderLabelLineItem(l,A,"line"),t.renderLabelItem(s,w,Wa(m,P)))});return Ce.createElement(un,{className:"recharts-pie-labels"},v)}},{key:"renderSectorsStatically",value:function(n){var a=this,o=this.props,s=o.activeShape,l=o.blendStroke,c=o.inactiveShape;return n.map(function(u,d){if(u?.startAngle===0&&u?.endAngle===0&&n.length!==1)return null;var f=a.isActiveIndex(d),h=c&&a.hasActiveIndex()?c:null,p=f?s:h,v=Ln(Ln({},u),{},{stroke:l?u.fill:u.stroke,tabIndex:-1});return Ce.createElement(un,Du({ref:function(y){y&&!a.sectorRefs.includes(y)&&a.sectorRefs.push(y)},tabIndex:-1,className:"recharts-pie-sector"},Yc(a.props,u,d),{key:"sector-".concat(u?.startAngle,"-").concat(u?.endAngle,"-").concat(u.midAngle,"-").concat(d)}),Ce.createElement(GM,Du({option:p,isActive:f,shapeType:"sector"},v)))})}},{key:"renderSectorsWithAnimation",value:function(){var n=this,a=this.props,o=a.sectors,s=a.isAnimationActive,l=a.animationBegin,c=a.animationDuration,u=a.animationEasing,d=a.animationId,f=this.state,h=f.prevSectors,p=f.prevIsAnimationActive;return Ce.createElement(Ts,{begin:l,duration:c,isActive:s,easing:u,from:{t:0},to:{t:1},key:"pie-".concat(d,"-").concat(p),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(v){var m=v.t,y=[],b=o&&o[0],_=b.startAngle;return o.forEach(function(w,A){var P=h&&h[A],T=A>0?Co(w,"paddingAngle",0):0;if(P){var E=_o(P.endAngle-P.startAngle,w.endAngle-w.startAngle),S=Ln(Ln({},w),{},{startAngle:_+T,endAngle:_+E(m)+T});y.push(S),_=S.endAngle}else{var I=w.endAngle,W=w.startAngle,O=_o(0,I-W),D=O(m),R=Ln(Ln({},w),{},{startAngle:_+T,endAngle:_+D+T});y.push(R),_=R.endAngle}}),Ce.createElement(un,null,n.renderSectorsStatically(y))})}},{key:"attachKeyboardHandlers",value:function(n){var a=this;n.onkeydown=function(o){if(!o.altKey)switch(o.key){case"ArrowLeft":{var s=++a.state.sectorToFocus%a.sectorRefs.length;a.sectorRefs[s].focus(),a.setState({sectorToFocus:s});break}case"ArrowRight":{var l=--a.state.sectorToFocus<0?a.sectorRefs.length-1:a.state.sectorToFocus%a.sectorRefs.length;a.sectorRefs[l].focus(),a.setState({sectorToFocus:l});break}case"Escape":{a.sectorRefs[a.state.sectorToFocus].blur(),a.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var n=this.props,a=n.sectors,o=n.isAnimationActive,s=this.state.prevSectors;return o&&a&&a.length&&(!s||!Bp(s,a))?this.renderSectorsWithAnimation():this.renderSectorsStatically(a)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var n=this,a=this.props,o=a.hide,s=a.sectors,l=a.className,c=a.label,u=a.cx,d=a.cy,f=a.innerRadius,h=a.outerRadius,p=a.isAnimationActive,v=this.state.isAnimationFinished;if(o||!s||!s.length||!Mt(u)||!Mt(d)||!Mt(f)||!Mt(h))return null;var m=Tr("recharts-pie",l);return Ce.createElement(un,{tabIndex:this.props.rootTabIndex,className:m,ref:function(b){n.pieRef=b}},this.renderSectors(),c&&this.renderLabels(s),ei.renderCallByParent(this.props,null,!1),(!p||v)&&fl.renderCallByParent(this.props,s,!1))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return a.prevIsAnimationActive!==n.isAnimationActive?{prevIsAnimationActive:n.isAnimationActive,prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:[],isAnimationFinished:!0}:n.isAnimationActive&&n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:a.curSectors,isAnimationFinished:!0}:n.sectors!==a.curSectors?{curSectors:n.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(n,a){return n>a?"start":n<a?"end":"middle"}},{key:"renderLabelLineItem",value:function(n,a,o){if(Ce.isValidElement(n))return Ce.cloneElement(n,a);if(Nr(n))return n(a);var s=Tr("recharts-pie-label-line",typeof n!="boolean"?n.className:"");return Ce.createElement(zg,Du({},a,{key:o,type:"linear",className:s}))}},{key:"renderLabelItem",value:function(n,a,o){if(Ce.isValidElement(n))return Ce.cloneElement(n,a);var s=o;if(Nr(n)&&(s=n(a),Ce.isValidElement(s)))return s;var l=Tr("recharts-pie-label-text",typeof n!="boolean"&&!Nr(n)?n.className:"");return Ce.createElement(Kc,Du({},a,{alignmentBaseline:"middle",className:l}),s)}}])}(x.PureComponent);Km=Sl;zo(Sl,"displayName","Pie");zo(Sl,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!iu.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});zo(Sl,"parseDeltaAngle",function(e,t){var r=Mi(t-e),n=Math.min(Math.abs(t-e),360);return r*n});zo(Sl,"getRealPieData",function(e){var t=e.data,r=e.children,n=yr(e,!1),a=Ao(r,Zv);return t&&t.length?t.map(function(o,s){return Ln(Ln(Ln({payload:o},n),o),a&&a[s]&&a[s].props)}):a&&a.length?a.map(function(o){return Ln(Ln({},n),o.props)}):[]});zo(Sl,"parseCoordinateOfPie",function(e,t){var r=t.top,n=t.left,a=t.width,o=t.height,s=EM(a,o),l=n+Li(e.cx,a,a/2),c=r+Li(e.cy,o,o/2),u=Li(e.innerRadius,s,0),d=Li(e.outerRadius,s,s*.8),f=e.maxRadius||Math.sqrt(a*a+o*o)/2;return{cx:l,cy:c,innerRadius:u,outerRadius:d,maxRadius:f}});zo(Sl,"getComposedData",function(e){var t=e.item,r=e.offset,n=t.type.defaultProps!==void 0?Ln(Ln({},t.type.defaultProps),t.props):t.props,a=Km.getRealPieData(n);if(!a||!a.length)return null;var o=n.cornerRadius,s=n.startAngle,l=n.endAngle,c=n.paddingAngle,u=n.dataKey,d=n.nameKey,f=n.valueKey,h=n.tooltipType,p=Math.abs(n.minAngle),v=Km.parseCoordinateOfPie(n,r),m=Km.parseDeltaAngle(s,l),y=Math.abs(m),b=u;$r(u)&&$r(f)?(is(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),b="value"):$r(u)&&(is(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),b=f);var _=a.filter(function(S){return Wa(S,b,0)!==0}).length,w=(y>=360?_:_-1)*c,A=y-_*p-w,P=a.reduce(function(S,I){var W=Wa(I,b,0);return S+(Mt(W)?W:0)},0),T;if(P>0){var E;T=a.map(function(S,I){var W=Wa(S,b,0),O=Wa(S,d,I),D=(Mt(W)?W:0)/P,R;I?R=E.endAngle+Mi(m)*c*(W!==0?1:0):R=s;var F=R+Mi(m)*((W!==0?p:0)+D*A),z=(R+F)/2,K=(v.innerRadius+v.outerRadius)/2,J=[{name:O,value:W,payload:S,dataKey:b,type:h}],L=Fn(v.cx,v.cy,K,z);return E=Ln(Ln(Ln({percent:D,cornerRadius:o,name:O,tooltipPayload:J,midAngle:z,middleRadius:K,tooltipPosition:L},S),v),{},{value:Wa(S,b),startAngle:R,endAngle:F,payload:S,paddingAngle:Mi(m)*c}),E})}return Ln(Ln({},v),{},{sectors:T,data:a})});var z1,H3;function QJ(){if(H3)return z1;H3=1;var e=Math.ceil,t=Math.max;function r(n,a,o,s){for(var l=-1,c=t(e((a-n)/(o||1)),0),u=Array(c);c--;)u[s?c:++l]=n,n+=o;return u}return z1=r,z1}var W1,V3;function QM(){if(V3)return W1;V3=1;var e=vD(),t=1/0,r=17976931348623157e292;function n(a){if(!a)return a===0?a:0;if(a=e(a),a===t||a===-t){var o=a<0?-1:1;return o*r}return a===a?a:0}return W1=n,W1}var H1,G3;function XJ(){if(G3)return H1;G3=1;var e=QJ(),t=Jv(),r=QM();function n(a){return function(o,s,l){return l&&typeof l!="number"&&t(o,s,l)&&(s=l=void 0),o=r(o),s===void 0?(s=o,o=0):s=r(s),l=l===void 0?o<s?1:-1:r(l),e(o,s,l,a)}}return H1=n,H1}var V1,Y3;function JJ(){if(Y3)return V1;Y3=1;var e=XJ(),t=e();return V1=t,V1}var ZJ=JJ();const Zg=Et(ZJ);function xp(e){"@babel/helpers - typeof";return xp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xp(e)}function K3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Q3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?K3(Object(r),!0).forEach(function(n){XM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function XM(e,t,r){return t=eZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function eZ(e){var t=tZ(e,"string");return xp(t)=="symbol"?t:t+""}function tZ(e,t){if(xp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(xp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var rZ=["Webkit","Moz","O","ms"],nZ=function(t,r){var n=t.replace(/(\w)/,function(o){return o.toUpperCase()}),a=rZ.reduce(function(o,s){return Q3(Q3({},o),{},XM({},s+n,r))},{});return a[t]=r,a};function hd(e){"@babel/helpers - typeof";return hd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hd(e)}function ev(){return ev=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ev.apply(this,arguments)}function X3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function G1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?X3(Object(r),!0).forEach(function(n){vo(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function aZ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function J3(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ZM(n.key),n)}}function iZ(e,t,r){return t&&J3(e.prototype,t),r&&J3(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function oZ(e,t,r){return t=tv(t),sZ(e,JM()?Reflect.construct(t,r||[],tv(e).constructor):t.apply(e,r))}function sZ(e,t){if(t&&(hd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return lZ(e)}function lZ(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function JM(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(JM=function(){return!!e})()}function tv(e){return tv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},tv(e)}function cZ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Q_(e,t)}function Q_(e,t){return Q_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Q_(e,t)}function vo(e,t,r){return t=ZM(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ZM(e){var t=uZ(e,"string");return hd(t)=="symbol"?t:t+""}function uZ(e,t){if(hd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(hd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var dZ=function(t){var r=t.data,n=t.startIndex,a=t.endIndex,o=t.x,s=t.width,l=t.travellerWidth;if(!r||!r.length)return{};var c=r.length,u=Th().domain(Zg(0,c)).range([o,o+s-l]),d=u.domain().map(function(f){return u(f)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:u(n),endX:u(a),scale:u,scaleValues:d}},Z3=function(t){return t.changedTouches&&!!t.changedTouches.length},pd=function(e){function t(r){var n;return aZ(this,t),n=oZ(this,t,[r]),vo(n,"handleDrag",function(a){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(a):n.state.isSlideMoving&&n.handleSlideDrag(a)}),vo(n,"handleTouchMove",function(a){a.changedTouches!=null&&a.changedTouches.length>0&&n.handleDrag(a.changedTouches[0])}),vo(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var a=n.props,o=a.endIndex,s=a.onDragEnd,l=a.startIndex;s?.({endIndex:o,startIndex:l})}),n.detachDragEndListener()}),vo(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),vo(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),vo(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),vo(n,"handleSlideDragStart",function(a){var o=Z3(a)?a.changedTouches[0]:a;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:o.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return cZ(t,e),iZ(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var a=n.startX,o=n.endX,s=this.state.scaleValues,l=this.props,c=l.gap,u=l.data,d=u.length-1,f=Math.min(a,o),h=Math.max(a,o),p=t.getIndexInRange(s,f),v=t.getIndexInRange(s,h);return{startIndex:p-p%c,endIndex:v===d?d:v-v%c}}},{key:"getTextOfTick",value:function(n){var a=this.props,o=a.data,s=a.tickFormatter,l=a.dataKey,c=Wa(o[n],l,n);return Nr(s)?s(c,n):c}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var a=this.state,o=a.slideMoveStartX,s=a.startX,l=a.endX,c=this.props,u=c.x,d=c.width,f=c.travellerWidth,h=c.startIndex,p=c.endIndex,v=c.onChange,m=n.pageX-o;m>0?m=Math.min(m,u+d-f-l,u+d-f-s):m<0&&(m=Math.max(m,u-s,u-l));var y=this.getIndex({startX:s+m,endX:l+m});(y.startIndex!==h||y.endIndex!==p)&&v&&v(y),this.setState({startX:s+m,endX:l+m,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,a){var o=Z3(a)?a.changedTouches[0]:a;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:o.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var a=this.state,o=a.brushMoveStartX,s=a.movingTravellerId,l=a.endX,c=a.startX,u=this.state[s],d=this.props,f=d.x,h=d.width,p=d.travellerWidth,v=d.onChange,m=d.gap,y=d.data,b={startX:this.state.startX,endX:this.state.endX},_=n.pageX-o;_>0?_=Math.min(_,f+h-p-u):_<0&&(_=Math.max(_,f-u)),b[s]=u+_;var w=this.getIndex(b),A=w.startIndex,P=w.endIndex,T=function(){var S=y.length-1;return s==="startX"&&(l>c?A%m===0:P%m===0)||l<c&&P===S||s==="endX"&&(l>c?P%m===0:A%m===0)||l>c&&P===S};this.setState(vo(vo({},s,u+_),"brushMoveStartX",n.pageX),function(){v&&T()&&v(w)})}},{key:"handleTravellerMoveKeyboard",value:function(n,a){var o=this,s=this.state,l=s.scaleValues,c=s.startX,u=s.endX,d=this.state[a],f=l.indexOf(d);if(f!==-1){var h=f+n;if(!(h===-1||h>=l.length)){var p=l[h];a==="startX"&&p>=u||a==="endX"&&p<=c||this.setState(vo({},a,p),function(){o.props.onChange(o.getIndex({startX:o.state.startX,endX:o.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,a=n.x,o=n.y,s=n.width,l=n.height,c=n.fill,u=n.stroke;return Ce.createElement("rect",{stroke:u,fill:c,x:a,y:o,width:s,height:l})}},{key:"renderPanorama",value:function(){var n=this.props,a=n.x,o=n.y,s=n.width,l=n.height,c=n.data,u=n.children,d=n.padding,f=x.Children.only(u);return f?Ce.cloneElement(f,{x:a,y:o,width:s,height:l,margin:d,compact:!0,data:c}):null}},{key:"renderTravellerLayer",value:function(n,a){var o,s,l=this,c=this.props,u=c.y,d=c.travellerWidth,f=c.height,h=c.traveller,p=c.ariaLabel,v=c.data,m=c.startIndex,y=c.endIndex,b=Math.max(n,this.props.x),_=G1(G1({},yr(this.props,!1)),{},{x:b,y:u,width:d,height:f}),w=p||"Min value: ".concat((o=v[m])===null||o===void 0?void 0:o.name,", Max value: ").concat((s=v[y])===null||s===void 0?void 0:s.name);return Ce.createElement(un,{tabIndex:0,role:"slider","aria-label":w,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[a],onTouchStart:this.travellerDragStartHandlers[a],onKeyDown:function(P){["ArrowLeft","ArrowRight"].includes(P.key)&&(P.preventDefault(),P.stopPropagation(),l.handleTravellerMoveKeyboard(P.key==="ArrowRight"?1:-1,a))},onFocus:function(){l.setState({isTravellerFocused:!0})},onBlur:function(){l.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(h,_))}},{key:"renderSlide",value:function(n,a){var o=this.props,s=o.y,l=o.height,c=o.stroke,u=o.travellerWidth,d=Math.min(n,a)+u,f=Math.max(Math.abs(a-n)-u,0);return Ce.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:c,fillOpacity:.2,x:d,y:s,width:f,height:l})}},{key:"renderText",value:function(){var n=this.props,a=n.startIndex,o=n.endIndex,s=n.y,l=n.height,c=n.travellerWidth,u=n.stroke,d=this.state,f=d.startX,h=d.endX,p=5,v={pointerEvents:"none",fill:u};return Ce.createElement(un,{className:"recharts-brush-texts"},Ce.createElement(Kc,ev({textAnchor:"end",verticalAnchor:"middle",x:Math.min(f,h)-p,y:s+l/2},v),this.getTextOfTick(a)),Ce.createElement(Kc,ev({textAnchor:"start",verticalAnchor:"middle",x:Math.max(f,h)+c+p,y:s+l/2},v),this.getTextOfTick(o)))}},{key:"render",value:function(){var n=this.props,a=n.data,o=n.className,s=n.children,l=n.x,c=n.y,u=n.width,d=n.height,f=n.alwaysShowText,h=this.state,p=h.startX,v=h.endX,m=h.isTextActive,y=h.isSlideMoving,b=h.isTravellerMoving,_=h.isTravellerFocused;if(!a||!a.length||!Mt(l)||!Mt(c)||!Mt(u)||!Mt(d)||u<=0||d<=0)return null;var w=Tr("recharts-brush",o),A=Ce.Children.count(s)===1,P=nZ("userSelect","none");return Ce.createElement(un,{className:w,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:P},this.renderBackground(),A&&this.renderPanorama(),this.renderSlide(p,v),this.renderTravellerLayer(p,"startX"),this.renderTravellerLayer(v,"endX"),(m||y||b||_||f)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var a=n.x,o=n.y,s=n.width,l=n.height,c=n.stroke,u=Math.floor(o+l/2)-1;return Ce.createElement(Ce.Fragment,null,Ce.createElement("rect",{x:a,y:o,width:s,height:l,fill:c,stroke:"none"}),Ce.createElement("line",{x1:a+1,y1:u,x2:a+s-1,y2:u,fill:"none",stroke:"#fff"}),Ce.createElement("line",{x1:a+1,y1:u+2,x2:a+s-1,y2:u+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,a){var o;return Ce.isValidElement(n)?o=Ce.cloneElement(n,a):Nr(n)?o=n(a):o=t.renderDefaultTraveller(a),o}},{key:"getDerivedStateFromProps",value:function(n,a){var o=n.data,s=n.width,l=n.x,c=n.travellerWidth,u=n.updateId,d=n.startIndex,f=n.endIndex;if(o!==a.prevData||u!==a.prevUpdateId)return G1({prevData:o,prevTravellerWidth:c,prevUpdateId:u,prevX:l,prevWidth:s},o&&o.length?dZ({data:o,width:s,x:l,travellerWidth:c,startIndex:d,endIndex:f}):{scale:null,scaleValues:null});if(a.scale&&(s!==a.prevWidth||l!==a.prevX||c!==a.prevTravellerWidth)){a.scale.range([l,l+s-c]);var h=a.scale.domain().map(function(p){return a.scale(p)});return{prevData:o,prevTravellerWidth:c,prevUpdateId:u,prevX:l,prevWidth:s,startX:a.scale(n.startIndex),endX:a.scale(n.endIndex),scaleValues:h}}return null}},{key:"getIndexInRange",value:function(n,a){for(var o=n.length,s=0,l=o-1;l-s>1;){var c=Math.floor((s+l)/2);n[c]>a?l=c:s=c}return a>=n[l]?l:s}}])}(x.PureComponent);vo(pd,"displayName","Brush");vo(pd,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var Y1,eT;function fZ(){if(eT)return Y1;eT=1;var e=Aj();function t(r,n){var a;return e(r,function(o,s,l){return a=n(o,s,l),!a}),!!a}return Y1=t,Y1}var K1,tT;function hZ(){if(tT)return K1;tT=1;var e=YN(),t=Rs(),r=fZ(),n=Zi(),a=Jv();function o(s,l,c){var u=n(s)?e:r;return c&&a(s,l,c)&&(l=void 0),u(s,t(l,3))}return K1=o,K1}var pZ=hZ();const mZ=Et(pZ);var As=function(t,r){var n=t.alwaysShow,a=t.ifOverflow;return n&&(a="extendDomain"),a===r},Q1,rT;function gZ(){if(rT)return Q1;rT=1;var e=fD();function t(r,n,a){n=="__proto__"&&e?e(r,n,{configurable:!0,enumerable:!0,value:a,writable:!0}):r[n]=a}return Q1=t,Q1}var X1,nT;function vZ(){if(nT)return X1;nT=1;var e=gZ(),t=uD(),r=Rs();function n(a,o){var s={};return o=r(o,3),t(a,function(l,c,u){e(s,c,o(l,c,u))}),s}return X1=n,X1}var yZ=vZ();const xZ=Et(yZ);var J1,aT;function bZ(){if(aT)return J1;aT=1;function e(t,r){for(var n=-1,a=t==null?0:t.length;++n<a;)if(!r(t[n],n,t))return!1;return!0}return J1=e,J1}var Z1,iT;function _Z(){if(iT)return Z1;iT=1;var e=Aj();function t(r,n){var a=!0;return e(r,function(o,s,l){return a=!!n(o,s,l),a}),a}return Z1=t,Z1}var e2,oT;function wZ(){if(oT)return e2;oT=1;var e=bZ(),t=_Z(),r=Rs(),n=Zi(),a=Jv();function o(s,l,c){var u=n(s)?e:t;return c&&a(s,l,c)&&(l=void 0),u(s,r(l,3))}return e2=o,e2}var jZ=wZ();const eL=Et(jZ);var SZ=["x","y"];function bp(e){"@babel/helpers - typeof";return bp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bp(e)}function X_(){return X_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},X_.apply(this,arguments)}function sT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function yf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?sT(Object(r),!0).forEach(function(n){CZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function CZ(e,t,r){return t=AZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function AZ(e){var t=PZ(e,"string");return bp(t)=="symbol"?t:t+""}function PZ(e,t){if(bp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(bp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function OZ(e,t){if(e==null)return{};var r=kZ(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function kZ(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function TZ(e,t){var r=e.x,n=e.y,a=OZ(e,SZ),o="".concat(r),s=parseInt(o,10),l="".concat(n),c=parseInt(l,10),u="".concat(t.height||a.height),d=parseInt(u,10),f="".concat(t.width||a.width),h=parseInt(f,10);return yf(yf(yf(yf(yf({},t),a),s?{x:s}:{}),c?{y:c}:{}),{},{height:d,width:h,name:t.name,radius:t.radius})}function lT(e){return Ce.createElement(GM,X_({shapeType:"rectangle",propTransformer:TZ,activeClassName:"recharts-active-bar"},e))}var EZ=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,a){if(typeof t=="number")return t;var o=typeof n=="number";return o?t(n,a):(o||Xc(),r)}},IZ=["value","background"],tL;function md(e){"@babel/helpers - typeof";return md=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},md(e)}function NZ(e,t){if(e==null)return{};var r=DZ(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function DZ(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function rv(){return rv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},rv.apply(this,arguments)}function cT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function La(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?cT(Object(r),!0).forEach(function(n){Kl(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function MZ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function uT(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,nL(n.key),n)}}function LZ(e,t,r){return t&&uT(e.prototype,t),r&&uT(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function RZ(e,t,r){return t=nv(t),qZ(e,rL()?Reflect.construct(t,r||[],nv(e).constructor):t.apply(e,r))}function qZ(e,t){if(t&&(md(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return FZ(e)}function FZ(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rL=function(){return!!e})()}function nv(e){return nv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},nv(e)}function $Z(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&J_(e,t)}function J_(e,t){return J_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},J_(e,t)}function Kl(e,t,r){return t=nL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nL(e){var t=BZ(e,"string");return md(t)=="symbol"?t:t+""}function BZ(e,t){if(md(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(md(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var yl=function(e){function t(){var r;MZ(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return r=RZ(this,t,[].concat(a)),Kl(r,"state",{isAnimationFinished:!1}),Kl(r,"id",qd("recharts-bar-")),Kl(r,"handleAnimationEnd",function(){var s=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),s&&s()}),Kl(r,"handleAnimationStart",function(){var s=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),s&&s()}),r}return $Z(t,e),LZ(t,[{key:"renderRectanglesStatically",value:function(n){var a=this,o=this.props,s=o.shape,l=o.dataKey,c=o.activeIndex,u=o.activeBar,d=yr(this.props,!1);return n&&n.map(function(f,h){var p=h===c,v=p?u:s,m=La(La(La({},d),f),{},{isActive:p,option:v,index:h,dataKey:l,onAnimationStart:a.handleAnimationStart,onAnimationEnd:a.handleAnimationEnd});return Ce.createElement(un,rv({className:"recharts-bar-rectangle"},Yc(a.props,f,h),{key:"rectangle-".concat(f?.x,"-").concat(f?.y,"-").concat(f?.value,"-").concat(h)}),Ce.createElement(lT,m))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,a=this.props,o=a.data,s=a.layout,l=a.isAnimationActive,c=a.animationBegin,u=a.animationDuration,d=a.animationEasing,f=a.animationId,h=this.state.prevData;return Ce.createElement(Ts,{begin:c,duration:u,isActive:l,easing:d,from:{t:0},to:{t:1},key:"bar-".concat(f),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(p){var v=p.t,m=o.map(function(y,b){var _=h&&h[b];if(_){var w=_o(_.x,y.x),A=_o(_.y,y.y),P=_o(_.width,y.width),T=_o(_.height,y.height);return La(La({},y),{},{x:w(v),y:A(v),width:P(v),height:T(v)})}if(s==="horizontal"){var E=_o(0,y.height),S=E(v);return La(La({},y),{},{y:y.y+y.height-S,height:S})}var I=_o(0,y.width),W=I(v);return La(La({},y),{},{width:W})});return Ce.createElement(un,null,n.renderRectanglesStatically(m))})}},{key:"renderRectangles",value:function(){var n=this.props,a=n.data,o=n.isAnimationActive,s=this.state.prevData;return o&&a&&a.length&&(!s||!Bp(s,a))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(a)}},{key:"renderBackground",value:function(){var n=this,a=this.props,o=a.data,s=a.dataKey,l=a.activeIndex,c=yr(this.props.background,!1);return o.map(function(u,d){u.value;var f=u.background,h=NZ(u,IZ);if(!f)return null;var p=La(La(La(La(La({},h),{},{fill:"#eee"},f),c),Yc(n.props,u,d)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:s,index:d,className:"recharts-bar-background-rectangle"});return Ce.createElement(lT,rv({key:"background-bar-".concat(d),option:n.props.background,isActive:d===l},p))})}},{key:"renderErrorBar",value:function(n,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,s=o.data,l=o.xAxis,c=o.yAxis,u=o.layout,d=o.children,f=Ao(d,Up);if(!f)return null;var h=u==="vertical"?s[0].height/2:s[0].width/2,p=function(y,b){var _=Array.isArray(y.value)?y.value[1]:y.value;return{x:y.x,y:y.y,value:_,errorVal:Wa(y,b)}},v={clipPath:n?"url(#clipPath-".concat(a,")"):null};return Ce.createElement(un,v,f.map(function(m){return Ce.cloneElement(m,{key:"error-bar-".concat(a,"-").concat(m.props.dataKey),data:s,xAxis:l,yAxis:c,layout:u,offset:h,dataPointFormatter:p})}))}},{key:"render",value:function(){var n=this.props,a=n.hide,o=n.data,s=n.className,l=n.xAxis,c=n.yAxis,u=n.left,d=n.top,f=n.width,h=n.height,p=n.isAnimationActive,v=n.background,m=n.id;if(a||!o||!o.length)return null;var y=this.state.isAnimationFinished,b=Tr("recharts-bar",s),_=l&&l.allowDataOverflow,w=c&&c.allowDataOverflow,A=_||w,P=$r(m)?this.id:m;return Ce.createElement(un,{className:b},_||w?Ce.createElement("defs",null,Ce.createElement("clipPath",{id:"clipPath-".concat(P)},Ce.createElement("rect",{x:_?u:u-f/2,y:w?d:d-h/2,width:_?f:f*2,height:w?h:h*2}))):null,Ce.createElement(un,{className:"recharts-bar-rectangles",clipPath:A?"url(#clipPath-".concat(P,")"):null},v?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(A,P),(!p||y)&&fl.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:a.curData}:n.data!==a.curData?{curData:n.data}:null}}])}(x.PureComponent);tL=yl;Kl(yl,"displayName","Bar");Kl(yl,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!iu.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});Kl(yl,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,a=e.bandSize,o=e.xAxis,s=e.yAxis,l=e.xAxisTicks,c=e.yAxisTicks,u=e.stackedData,d=e.dataStartIndex,f=e.displayedData,h=e.offset,p=bY(n,r);if(!p)return null;var v=t.layout,m=r.type.defaultProps,y=m!==void 0?La(La({},m),r.props):r.props,b=y.dataKey,_=y.children,w=y.minPointSize,A=v==="horizontal"?s:o,P=u?A.scale.domain():null,T=PY({numericAxis:A}),E=Ao(_,Zv),S=f.map(function(I,W){var O,D,R,F,z,K;u?O=_Y(u[d+W],P):(O=Wa(I,b),Array.isArray(O)||(O=[T,O]));var J=EZ(w,tL.defaultProps.minPointSize)(O[1],W);if(v==="horizontal"){var L,k=[s.scale(O[0]),s.scale(O[1])],$=k[0],X=k[1];D=qk({axis:o,ticks:l,bandSize:a,offset:p.offset,entry:I,index:W}),R=(L=X??$)!==null&&L!==void 0?L:void 0,F=p.size;var C=$-X;if(z=Number.isNaN(C)?0:C,K={x:D,y:s.y,width:F,height:s.height},Math.abs(J)>0&&Math.abs(z)<Math.abs(J)){var M=Mi(z||J)*(Math.abs(J)-Math.abs(z));R-=M,z+=M}}else{var H=[o.scale(O[0]),o.scale(O[1])],U=H[0],te=H[1];if(D=U,R=qk({axis:s,ticks:c,bandSize:a,offset:p.offset,entry:I,index:W}),F=te-U,z=p.size,K={x:o.x,y:R,width:o.width,height:z},Math.abs(J)>0&&Math.abs(F)<Math.abs(J)){var le=Mi(F||J)*(Math.abs(J)-Math.abs(F));F+=le}}return La(La(La({},I),{},{x:D,y:R,width:F,height:z,value:u?O:O[1],payload:I,background:K},E&&E[W]&&E[W].props),{},{tooltipPayload:[kM(r,I)],tooltipPosition:{x:D+F/2,y:R+z/2}})});return La({data:S,layout:v},h)});function _p(e){"@babel/helpers - typeof";return _p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_p(e)}function UZ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function dT(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,aL(n.key),n)}}function zZ(e,t,r){return t&&dT(e.prototype,t),r&&dT(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function fT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function rs(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fT(Object(r),!0).forEach(function(n){yy(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yy(e,t,r){return t=aL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aL(e){var t=WZ(e,"string");return _p(t)=="symbol"?t:t+""}function WZ(e,t){if(_p(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(_p(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var iL=function(t,r,n,a,o){var s=t.width,l=t.height,c=t.layout,u=t.children,d=Object.keys(r),f={left:n.left,leftMirror:n.left,right:s-n.right,rightMirror:s-n.right,top:n.top,topMirror:n.top,bottom:l-n.bottom,bottomMirror:l-n.bottom},h=!!yo(u,yl);return d.reduce(function(p,v){var m=r[v],y=m.orientation,b=m.domain,_=m.padding,w=_===void 0?{}:_,A=m.mirror,P=m.reversed,T="".concat(y).concat(A?"Mirror":""),E,S,I,W,O;if(m.type==="number"&&(m.padding==="gap"||m.padding==="no-gap")){var D=b[1]-b[0],R=1/0,F=m.categoricalDomain.sort(lB);if(F.forEach(function(H,U){U>0&&(R=Math.min((H||0)-(F[U-1]||0),R))}),Number.isFinite(R)){var z=R/D,K=m.layout==="vertical"?n.height:n.width;if(m.padding==="gap"&&(E=z*K/2),m.padding==="no-gap"){var J=Li(t.barCategoryGap,z*K),L=z*K/2;E=L-J-(L-J)/K*J}}}a==="xAxis"?S=[n.left+(w.left||0)+(E||0),n.left+n.width-(w.right||0)-(E||0)]:a==="yAxis"?S=c==="horizontal"?[n.top+n.height-(w.bottom||0),n.top+(w.top||0)]:[n.top+(w.top||0)+(E||0),n.top+n.height-(w.bottom||0)-(E||0)]:S=m.range,P&&(S=[S[1],S[0]]);var k=CM(m,o,h),$=k.scale,X=k.realScaleType;$.domain(b).range(S),AM($);var C=PM($,rs(rs({},m),{},{realScaleType:X}));a==="xAxis"?(O=y==="top"&&!A||y==="bottom"&&A,I=n.left,W=f[T]-O*m.height):a==="yAxis"&&(O=y==="left"&&!A||y==="right"&&A,I=f[T]-O*m.width,W=n.top);var M=rs(rs(rs({},m),C),{},{realScaleType:X,x:I,y:W,scale:$,width:a==="xAxis"?n.width:m.width,height:a==="yAxis"?n.height:m.height});return M.bandSize=$g(M,C),!m.hide&&a==="xAxis"?f[T]+=(O?-1:1)*M.height:m.hide||(f[T]+=(O?-1:1)*M.width),rs(rs({},p),{},yy({},v,M))},{})},oL=function(t,r){var n=t.x,a=t.y,o=r.x,s=r.y;return{x:Math.min(n,o),y:Math.min(a,s),width:Math.abs(o-n),height:Math.abs(s-a)}},HZ=function(t){var r=t.x1,n=t.y1,a=t.x2,o=t.y2;return oL({x:r,y:n},{x:a,y:o})},sL=function(){function e(t){UZ(this,e),this.scale=t}return zZ(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.bandAware,o=n.position;if(r!==void 0){if(o)switch(o){case"start":return this.scale(r);case"middle":{var s=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+s}case"end":{var l=this.bandwidth?this.bandwidth():0;return this.scale(r)+l}default:return this.scale(r)}if(a){var c=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+c}return this.scale(r)}}},{key:"isInRange",value:function(r){var n=this.range(),a=n[0],o=n[n.length-1];return a<=o?r>=a&&r<=o:r>=o&&r<=a}}],[{key:"create",value:function(r){return new e(r)}}])}();yy(sL,"EPS",1e-4);var tS=function(t){var r=Object.keys(t).reduce(function(n,a){return rs(rs({},n),{},yy({},a,sL.create(t[a])))},{});return rs(rs({},r),{},{apply:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=o.bandAware,l=o.position;return xZ(a,function(c,u){return r[u].apply(c,{bandAware:s,position:l})})},isInRange:function(a){return eL(a,function(o,s){return r[s].isInRange(o)})}})};function VZ(e){return(e%180+180)%180}var GZ=function(t){var r=t.width,n=t.height,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=VZ(a),s=o*Math.PI/180,l=Math.atan(n/r),c=s>l&&s<Math.PI-l?n/Math.sin(s):r/Math.cos(s);return Math.abs(c)},t2,hT;function YZ(){if(hT)return t2;hT=1;var e=Rs(),t=Lp(),r=Qv();function n(a){return function(o,s,l){var c=Object(o);if(!t(o)){var u=e(s,3);o=r(o),s=function(f){return u(c[f],f,c)}}var d=a(o,s,l);return d>-1?c[u?o[d]:d]:void 0}}return t2=n,t2}var r2,pT;function KZ(){if(pT)return r2;pT=1;var e=QM();function t(r){var n=e(r),a=n%1;return n===n?a?n-a:n:0}return r2=t,r2}var n2,mT;function QZ(){if(mT)return n2;mT=1;var e=iD(),t=Rs(),r=KZ(),n=Math.max;function a(o,s,l){var c=o==null?0:o.length;if(!c)return-1;var u=l==null?0:r(l);return u<0&&(u=n(c+u,0)),e(o,t(s,3),u)}return n2=a,n2}var a2,gT;function XZ(){if(gT)return a2;gT=1;var e=YZ(),t=QZ(),r=e(t);return a2=r,a2}var JZ=XZ();const ZZ=Et(JZ);var eee=_N();const tee=Et(eee);var ree=tee(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),rS=x.createContext(void 0),nS=x.createContext(void 0),lL=x.createContext(void 0),cL=x.createContext({}),uL=x.createContext(void 0),dL=x.createContext(0),fL=x.createContext(0),vT=function(t){var r=t.state,n=r.xAxisMap,a=r.yAxisMap,o=r.offset,s=t.clipPathId,l=t.children,c=t.width,u=t.height,d=ree(o);return Ce.createElement(rS.Provider,{value:n},Ce.createElement(nS.Provider,{value:a},Ce.createElement(cL.Provider,{value:o},Ce.createElement(lL.Provider,{value:d},Ce.createElement(uL.Provider,{value:s},Ce.createElement(dL.Provider,{value:u},Ce.createElement(fL.Provider,{value:c},l)))))))},nee=function(){return x.useContext(uL)},hL=function(t){var r=x.useContext(rS);r==null&&Xc();var n=r[t];return n==null&&Xc(),n},aee=function(){var t=x.useContext(rS);return Gl(t)},iee=function(){var t=x.useContext(nS),r=ZZ(t,function(n){return eL(n.domain,Number.isFinite)});return r||Gl(t)},pL=function(t){var r=x.useContext(nS);r==null&&Xc();var n=r[t];return n==null&&Xc(),n},oee=function(){var t=x.useContext(lL);return t},see=function(){return x.useContext(cL)},aS=function(){return x.useContext(fL)},iS=function(){return x.useContext(dL)};function gd(e){"@babel/helpers - typeof";return gd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gd(e)}function lee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cee(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,gL(n.key),n)}}function uee(e,t,r){return t&&cee(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function dee(e,t,r){return t=av(t),fee(e,mL()?Reflect.construct(t,r||[],av(e).constructor):t.apply(e,r))}function fee(e,t){if(t&&(gd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return hee(e)}function hee(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mL=function(){return!!e})()}function av(e){return av=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},av(e)}function pee(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Z_(e,t)}function Z_(e,t){return Z_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Z_(e,t)}function yT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function xT(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yT(Object(r),!0).forEach(function(n){oS(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oS(e,t,r){return t=gL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gL(e){var t=mee(e,"string");return gd(t)=="symbol"?t:t+""}function mee(e,t){if(gd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(gd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function gee(e,t){return bee(e)||xee(e,t)||yee(e,t)||vee()}function vee(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yee(e,t){if(e){if(typeof e=="string")return bT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bT(e,t)}}function bT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function xee(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function bee(e){if(Array.isArray(e))return e}function ew(){return ew=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ew.apply(this,arguments)}var _ee=function(t,r){var n;return Ce.isValidElement(t)?n=Ce.cloneElement(t,r):Nr(t)?n=t(r):n=Ce.createElement("line",ew({},r,{className:"recharts-reference-line-line"})),n},wee=function(t,r,n,a,o,s,l,c,u){var d=o.x,f=o.y,h=o.width,p=o.height;if(n){var v=u.y,m=t.y.apply(v,{position:s});if(As(u,"discard")&&!t.y.isInRange(m))return null;var y=[{x:d+h,y:m},{x:d,y:m}];return c==="left"?y.reverse():y}if(r){var b=u.x,_=t.x.apply(b,{position:s});if(As(u,"discard")&&!t.x.isInRange(_))return null;var w=[{x:_,y:f+p},{x:_,y:f}];return l==="top"?w.reverse():w}if(a){var A=u.segment,P=A.map(function(T){return t.apply(T,{position:s})});return As(u,"discard")&&mZ(P,function(T){return!t.isInRange(T)})?null:P}return null};function jee(e){var t=e.x,r=e.y,n=e.segment,a=e.xAxisId,o=e.yAxisId,s=e.shape,l=e.className,c=e.alwaysShow,u=nee(),d=hL(a),f=pL(o),h=oee();if(!u||!h)return null;is(c===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var p=tS({x:d.scale,y:f.scale}),v=Ha(t),m=Ha(r),y=n&&n.length===2,b=wee(p,v,m,y,h,e.position,d.orientation,f.orientation,e);if(!b)return null;var _=gee(b,2),w=_[0],A=w.x,P=w.y,T=_[1],E=T.x,S=T.y,I=As(e,"hidden")?"url(#".concat(u,")"):void 0,W=xT(xT({clipPath:I},yr(e,!0)),{},{x1:A,y1:P,x2:E,y2:S});return Ce.createElement(un,{className:Tr("recharts-reference-line",l)},_ee(s,W),ei.renderCallByParent(e,HZ({x1:A,y1:P,x2:E,y2:S})))}var sS=function(e){function t(){return lee(this,t),dee(this,t,arguments)}return pee(t,e),uee(t,[{key:"render",value:function(){return Ce.createElement(jee,this.props)}}])}(Ce.Component);oS(sS,"displayName","ReferenceLine");oS(sS,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function tw(){return tw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},tw.apply(this,arguments)}function vd(e){"@babel/helpers - typeof";return vd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vd(e)}function _T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function wT(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_T(Object(r),!0).forEach(function(n){xy(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_T(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function See(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Cee(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,yL(n.key),n)}}function Aee(e,t,r){return t&&Cee(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Pee(e,t,r){return t=iv(t),Oee(e,vL()?Reflect.construct(t,r||[],iv(e).constructor):t.apply(e,r))}function Oee(e,t){if(t&&(vd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kee(e)}function kee(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vL=function(){return!!e})()}function iv(e){return iv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},iv(e)}function Tee(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&rw(e,t)}function rw(e,t){return rw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},rw(e,t)}function xy(e,t,r){return t=yL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function yL(e){var t=Eee(e,"string");return vd(t)=="symbol"?t:t+""}function Eee(e,t){if(vd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(vd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Iee=function(t){var r=t.x,n=t.y,a=t.xAxis,o=t.yAxis,s=tS({x:a.scale,y:o.scale}),l=s.apply({x:r,y:n},{bandAware:!0});return As(t,"discard")&&!s.isInRange(l)?null:l},by=function(e){function t(){return See(this,t),Pee(this,t,arguments)}return Tee(t,e),Aee(t,[{key:"render",value:function(){var n=this.props,a=n.x,o=n.y,s=n.r,l=n.alwaysShow,c=n.clipPathId,u=Ha(a),d=Ha(o);if(is(l===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!u||!d)return null;var f=Iee(this.props);if(!f)return null;var h=f.x,p=f.y,v=this.props,m=v.shape,y=v.className,b=As(this.props,"hidden")?"url(#".concat(c,")"):void 0,_=wT(wT({clipPath:b},yr(this.props,!0)),{},{cx:h,cy:p});return Ce.createElement(un,{className:Tr("recharts-reference-dot",y)},t.renderDot(m,_),ei.renderCallByParent(this.props,{x:h-s,y:p-s,width:2*s,height:2*s}))}}])}(Ce.Component);xy(by,"displayName","ReferenceDot");xy(by,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});xy(by,"renderDot",function(e,t){var r;return Ce.isValidElement(e)?r=Ce.cloneElement(e,t):Nr(e)?r=e(t):r=Ce.createElement(dy,tw({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function nw(){return nw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nw.apply(this,arguments)}function yd(e){"@babel/helpers - typeof";return yd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yd(e)}function jT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ST(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jT(Object(r),!0).forEach(function(n){_y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Nee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Dee(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,bL(n.key),n)}}function Mee(e,t,r){return t&&Dee(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Lee(e,t,r){return t=ov(t),Ree(e,xL()?Reflect.construct(t,r||[],ov(e).constructor):t.apply(e,r))}function Ree(e,t){if(t&&(yd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return qee(e)}function qee(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(xL=function(){return!!e})()}function ov(e){return ov=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ov(e)}function Fee(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&aw(e,t)}function aw(e,t){return aw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},aw(e,t)}function _y(e,t,r){return t=bL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bL(e){var t=$ee(e,"string");return yd(t)=="symbol"?t:t+""}function $ee(e,t){if(yd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(yd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Bee=function(t,r,n,a,o){var s=o.x1,l=o.x2,c=o.y1,u=o.y2,d=o.xAxis,f=o.yAxis;if(!d||!f)return null;var h=tS({x:d.scale,y:f.scale}),p={x:t?h.x.apply(s,{position:"start"}):h.x.rangeMin,y:n?h.y.apply(c,{position:"start"}):h.y.rangeMin},v={x:r?h.x.apply(l,{position:"end"}):h.x.rangeMax,y:a?h.y.apply(u,{position:"end"}):h.y.rangeMax};return As(o,"discard")&&(!h.isInRange(p)||!h.isInRange(v))?null:oL(p,v)},wy=function(e){function t(){return Nee(this,t),Lee(this,t,arguments)}return Fee(t,e),Mee(t,[{key:"render",value:function(){var n=this.props,a=n.x1,o=n.x2,s=n.y1,l=n.y2,c=n.className,u=n.alwaysShow,d=n.clipPathId;is(u===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var f=Ha(a),h=Ha(o),p=Ha(s),v=Ha(l),m=this.props.shape;if(!f&&!h&&!p&&!v&&!m)return null;var y=Bee(f,h,p,v,this.props);if(!y&&!m)return null;var b=As(this.props,"hidden")?"url(#".concat(d,")"):void 0;return Ce.createElement(un,{className:Tr("recharts-reference-area",c)},t.renderRect(m,ST(ST({clipPath:b},yr(this.props,!0)),y)),ei.renderCallByParent(this.props,y))}}])}(Ce.Component);_y(wy,"displayName","ReferenceArea");_y(wy,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});_y(wy,"renderRect",function(e,t){var r;return Ce.isValidElement(e)?r=Ce.cloneElement(e,t):Nr(e)?r=e(t):r=Ce.createElement(eS,nw({},t,{className:"recharts-reference-area-rect"})),r});function _L(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],a=0;a<e.length;a+=t)n.push(e[a]);return n}function Uee(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return GZ(n,r)}function zee(e,t,r){var n=r==="width",a=e.x,o=e.y,s=e.width,l=e.height;return t===1?{start:n?a:o,end:n?a+s:o+l}:{start:n?a+s:o+l,end:n?a:o}}function sv(e,t,r,n,a){if(e*t<e*n||e*t>e*a)return!1;var o=r();return e*(t-e*o/2-n)>=0&&e*(t+e*o/2-a)<=0}function Wee(e,t){return _L(e,t+1)}function Hee(e,t,r,n,a){for(var o=(n||[]).slice(),s=t.start,l=t.end,c=0,u=1,d=s,f=function(){var v=n?.[c];if(v===void 0)return{v:_L(n,u)};var m=c,y,b=function(){return y===void 0&&(y=r(v,m)),y},_=v.coordinate,w=c===0||sv(e,_,b,d,l);w||(c=0,d=s,u+=1),w&&(d=_+e*(b()/2+a),c+=u)},h;u<=o.length;)if(h=f(),h)return h.v;return[]}function wp(e){"@babel/helpers - typeof";return wp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wp(e)}function CT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function xi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CT(Object(r),!0).forEach(function(n){Vee(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Vee(e,t,r){return t=Gee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Gee(e){var t=Yee(e,"string");return wp(t)=="symbol"?t:t+""}function Yee(e,t){if(wp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(wp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Kee(e,t,r,n,a){for(var o=(n||[]).slice(),s=o.length,l=t.start,c=t.end,u=function(h){var p=o[h],v,m=function(){return v===void 0&&(v=r(p,h)),v};if(h===s-1){var y=e*(p.coordinate+e*m()/2-c);o[h]=p=xi(xi({},p),{},{tickCoord:y>0?p.coordinate-y*e:p.coordinate})}else o[h]=p=xi(xi({},p),{},{tickCoord:p.coordinate});var b=sv(e,p.tickCoord,m,l,c);b&&(c=p.tickCoord-e*(m()/2+a),o[h]=xi(xi({},p),{},{isShow:!0}))},d=s-1;d>=0;d--)u(d);return o}function Qee(e,t,r,n,a,o){var s=(n||[]).slice(),l=s.length,c=t.start,u=t.end;if(o){var d=n[l-1],f=r(d,l-1),h=e*(d.coordinate+e*f/2-u);s[l-1]=d=xi(xi({},d),{},{tickCoord:h>0?d.coordinate-h*e:d.coordinate});var p=sv(e,d.tickCoord,function(){return f},c,u);p&&(u=d.tickCoord-e*(f/2+a),s[l-1]=xi(xi({},d),{},{isShow:!0}))}for(var v=o?l-1:l,m=function(_){var w=s[_],A,P=function(){return A===void 0&&(A=r(w,_)),A};if(_===0){var T=e*(w.coordinate-e*P()/2-c);s[_]=w=xi(xi({},w),{},{tickCoord:T<0?w.coordinate-T*e:w.coordinate})}else s[_]=w=xi(xi({},w),{},{tickCoord:w.coordinate});var E=sv(e,w.tickCoord,P,c,u);E&&(c=w.tickCoord+e*(P()/2+a),s[_]=xi(xi({},w),{},{isShow:!0}))},y=0;y<v;y++)m(y);return s}function lS(e,t,r){var n=e.tick,a=e.ticks,o=e.viewBox,s=e.minTickGap,l=e.orientation,c=e.interval,u=e.tickFormatter,d=e.unit,f=e.angle;if(!a||!a.length||!n)return[];if(Mt(c)||iu.isSsr)return Wee(a,typeof c=="number"&&Mt(c)?c:0);var h=[],p=l==="top"||l==="bottom"?"width":"height",v=d&&p==="width"?kh(d,{fontSize:t,letterSpacing:r}):{width:0,height:0},m=function(w,A){var P=Nr(u)?u(w.value,A):w.value;return p==="width"?Uee(kh(P,{fontSize:t,letterSpacing:r}),v,f):kh(P,{fontSize:t,letterSpacing:r})[p]},y=a.length>=2?Mi(a[1].coordinate-a[0].coordinate):1,b=zee(o,y,p);return c==="equidistantPreserveStart"?Hee(y,b,m,a,s):(c==="preserveStart"||c==="preserveStartEnd"?h=Qee(y,b,m,a,s,c==="preserveStartEnd"):h=Kee(y,b,m,a,s),h.filter(function(_){return _.isShow}))}var Xee=["viewBox"],Jee=["viewBox"],Zee=["ticks"];function xd(e){"@babel/helpers - typeof";return xd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xd(e)}function Mu(){return Mu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Mu.apply(this,arguments)}function AT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ni(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?AT(Object(r),!0).forEach(function(n){cS(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):AT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function i2(e,t){if(e==null)return{};var r=ete(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ete(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function tte(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function PT(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,jL(n.key),n)}}function rte(e,t,r){return t&&PT(e.prototype,t),r&&PT(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function nte(e,t,r){return t=lv(t),ate(e,wL()?Reflect.construct(t,r||[],lv(e).constructor):t.apply(e,r))}function ate(e,t){if(t&&(xd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ite(e)}function ite(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(wL=function(){return!!e})()}function lv(e){return lv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},lv(e)}function ote(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&iw(e,t)}function iw(e,t){return iw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},iw(e,t)}function cS(e,t,r){return t=jL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jL(e){var t=ste(e,"string");return xd(t)=="symbol"?t:t+""}function ste(e,t){if(xd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(xd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var zd=function(e){function t(r){var n;return tte(this,t),n=nte(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return ote(t,e),rte(t,[{key:"shouldComponentUpdate",value:function(n,a){var o=n.viewBox,s=i2(n,Xee),l=this.props,c=l.viewBox,u=i2(l,Jee);return!Hu(o,c)||!Hu(s,u)||!Hu(a,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var a=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];a&&this.setState({fontSize:window.getComputedStyle(a).fontSize,letterSpacing:window.getComputedStyle(a).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var a=this.props,o=a.x,s=a.y,l=a.width,c=a.height,u=a.orientation,d=a.tickSize,f=a.mirror,h=a.tickMargin,p,v,m,y,b,_,w=f?-1:1,A=n.tickSize||d,P=Mt(n.tickCoord)?n.tickCoord:n.coordinate;switch(u){case"top":p=v=n.coordinate,y=s+ +!f*c,m=y-w*A,_=m-w*h,b=P;break;case"left":m=y=n.coordinate,v=o+ +!f*l,p=v-w*A,b=p-w*h,_=P;break;case"right":m=y=n.coordinate,v=o+ +f*l,p=v+w*A,b=p+w*h,_=P;break;default:p=v=n.coordinate,y=s+ +f*c,m=y+w*A,_=m+w*h,b=P;break}return{line:{x1:p,y1:m,x2:v,y2:y},tick:{x:b,y:_}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,a=n.orientation,o=n.mirror,s;switch(a){case"left":s=o?"start":"end";break;case"right":s=o?"end":"start";break;default:s="middle";break}return s}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,a=n.orientation,o=n.mirror,s="end";switch(a){case"left":case"right":s="middle";break;case"top":s=o?"start":"end";break;default:s=o?"end":"start";break}return s}},{key:"renderAxisLine",value:function(){var n=this.props,a=n.x,o=n.y,s=n.width,l=n.height,c=n.orientation,u=n.mirror,d=n.axisLine,f=Ni(Ni(Ni({},yr(this.props,!1)),yr(d,!1)),{},{fill:"none"});if(c==="top"||c==="bottom"){var h=+(c==="top"&&!u||c==="bottom"&&u);f=Ni(Ni({},f),{},{x1:a,y1:o+h*l,x2:a+s,y2:o+h*l})}else{var p=+(c==="left"&&!u||c==="right"&&u);f=Ni(Ni({},f),{},{x1:a+p*s,y1:o,x2:a+p*s,y2:o+l})}return Ce.createElement("line",Mu({},f,{className:Tr("recharts-cartesian-axis-line",Co(d,"className"))}))}},{key:"renderTicks",value:function(n,a,o){var s=this,l=this.props,c=l.tickLine,u=l.stroke,d=l.tick,f=l.tickFormatter,h=l.unit,p=lS(Ni(Ni({},this.props),{},{ticks:n}),a,o),v=this.getTickTextAnchor(),m=this.getTickVerticalAnchor(),y=yr(this.props,!1),b=yr(d,!1),_=Ni(Ni({},y),{},{fill:"none"},yr(c,!1)),w=p.map(function(A,P){var T=s.getTickLineCoord(A),E=T.line,S=T.tick,I=Ni(Ni(Ni(Ni({textAnchor:v,verticalAnchor:m},y),{},{stroke:"none",fill:u},b),S),{},{index:P,payload:A,visibleTicksCount:p.length,tickFormatter:f});return Ce.createElement(un,Mu({className:"recharts-cartesian-axis-tick",key:"tick-".concat(A.value,"-").concat(A.coordinate,"-").concat(A.tickCoord)},Yc(s.props,A,P)),c&&Ce.createElement("line",Mu({},_,E,{className:Tr("recharts-cartesian-axis-tick-line",Co(c,"className"))})),d&&t.renderTickItem(d,I,"".concat(Nr(f)?f(A.value,P):A.value).concat(h||"")))});return Ce.createElement("g",{className:"recharts-cartesian-axis-ticks"},w)}},{key:"render",value:function(){var n=this,a=this.props,o=a.axisLine,s=a.width,l=a.height,c=a.ticksGenerator,u=a.className,d=a.hide;if(d)return null;var f=this.props,h=f.ticks,p=i2(f,Zee),v=h;return Nr(c)&&(v=h&&h.length>0?c(this.props):c(p)),s<=0||l<=0||!v||!v.length?null:Ce.createElement(un,{className:Tr("recharts-cartesian-axis",u),ref:function(y){n.layerReference=y}},o&&this.renderAxisLine(),this.renderTicks(v,this.state.fontSize,this.state.letterSpacing),ei.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,a,o){var s;return Ce.isValidElement(n)?s=Ce.cloneElement(n,a):Nr(n)?s=n(a):s=Ce.createElement(Kc,Mu({},a,{className:"recharts-cartesian-axis-tick-value"}),o),s}}])}(x.Component);cS(zd,"displayName","CartesianAxis");cS(zd,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var lte=["x1","y1","x2","y2","key"],cte=["offset"];function Jc(e){"@babel/helpers - typeof";return Jc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jc(e)}function OT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function bi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?OT(Object(r),!0).forEach(function(n){ute(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):OT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ute(e,t,r){return t=dte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dte(e){var t=fte(e,"string");return Jc(t)=="symbol"?t:t+""}function fte(e,t){if(Jc(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Jc(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function qc(){return qc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qc.apply(this,arguments)}function kT(e,t){if(e==null)return{};var r=hte(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function hte(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var pte=function(t){var r=t.fill;if(!r||r==="none")return null;var n=t.fillOpacity,a=t.x,o=t.y,s=t.width,l=t.height,c=t.ry;return Ce.createElement("rect",{x:a,y:o,ry:c,width:s,height:l,stroke:"none",fill:r,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function SL(e,t){var r;if(Ce.isValidElement(e))r=Ce.cloneElement(e,t);else if(Nr(e))r=e(t);else{var n=t.x1,a=t.y1,o=t.x2,s=t.y2,l=t.key,c=kT(t,lte),u=yr(c,!1);u.offset;var d=kT(u,cte);r=Ce.createElement("line",qc({},d,{x1:n,y1:a,x2:o,y2:s,fill:"none",key:l}))}return r}function mte(e){var t=e.x,r=e.width,n=e.horizontal,a=n===void 0?!0:n,o=e.horizontalPoints;if(!a||!o||!o.length)return null;var s=o.map(function(l,c){var u=bi(bi({},e),{},{x1:t,y1:l,x2:t+r,y2:l,key:"line-".concat(c),index:c});return SL(a,u)});return Ce.createElement("g",{className:"recharts-cartesian-grid-horizontal"},s)}function gte(e){var t=e.y,r=e.height,n=e.vertical,a=n===void 0?!0:n,o=e.verticalPoints;if(!a||!o||!o.length)return null;var s=o.map(function(l,c){var u=bi(bi({},e),{},{x1:l,y1:t,x2:l,y2:t+r,key:"line-".concat(c),index:c});return SL(a,u)});return Ce.createElement("g",{className:"recharts-cartesian-grid-vertical"},s)}function vte(e){var t=e.horizontalFill,r=e.fillOpacity,n=e.x,a=e.y,o=e.width,s=e.height,l=e.horizontalPoints,c=e.horizontal,u=c===void 0?!0:c;if(!u||!t||!t.length)return null;var d=l.map(function(h){return Math.round(h+a-a)}).sort(function(h,p){return h-p});a!==d[0]&&d.unshift(0);var f=d.map(function(h,p){var v=!d[p+1],m=v?a+s-h:d[p+1]-h;if(m<=0)return null;var y=p%t.length;return Ce.createElement("rect",{key:"react-".concat(p),y:h,x:n,height:m,width:o,stroke:"none",fill:t[y],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return Ce.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},f)}function yte(e){var t=e.vertical,r=t===void 0?!0:t,n=e.verticalFill,a=e.fillOpacity,o=e.x,s=e.y,l=e.width,c=e.height,u=e.verticalPoints;if(!r||!n||!n.length)return null;var d=u.map(function(h){return Math.round(h+o-o)}).sort(function(h,p){return h-p});o!==d[0]&&d.unshift(0);var f=d.map(function(h,p){var v=!d[p+1],m=v?o+l-h:d[p+1]-h;if(m<=0)return null;var y=p%n.length;return Ce.createElement("rect",{key:"react-".concat(p),x:h,y:s,width:m,height:c,stroke:"none",fill:n[y],fillOpacity:a,className:"recharts-cartesian-grid-bg"})});return Ce.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},f)}var xte=function(t,r){var n=t.xAxis,a=t.width,o=t.height,s=t.offset;return SM(lS(bi(bi(bi({},zd.defaultProps),n),{},{ticks:sl(n,!0),viewBox:{x:0,y:0,width:a,height:o}})),s.left,s.left+s.width,r)},bte=function(t,r){var n=t.yAxis,a=t.width,o=t.height,s=t.offset;return SM(lS(bi(bi(bi({},zd.defaultProps),n),{},{ticks:sl(n,!0),viewBox:{x:0,y:0,width:a,height:o}})),s.top,s.top+s.height,r)},_u={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function cv(e){var t,r,n,a,o,s,l=aS(),c=iS(),u=see(),d=bi(bi({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:_u.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:_u.fill,horizontal:(n=e.horizontal)!==null&&n!==void 0?n:_u.horizontal,horizontalFill:(a=e.horizontalFill)!==null&&a!==void 0?a:_u.horizontalFill,vertical:(o=e.vertical)!==null&&o!==void 0?o:_u.vertical,verticalFill:(s=e.verticalFill)!==null&&s!==void 0?s:_u.verticalFill,x:Mt(e.x)?e.x:u.left,y:Mt(e.y)?e.y:u.top,width:Mt(e.width)?e.width:u.width,height:Mt(e.height)?e.height:u.height}),f=d.x,h=d.y,p=d.width,v=d.height,m=d.syncWithTicks,y=d.horizontalValues,b=d.verticalValues,_=aee(),w=iee();if(!Mt(p)||p<=0||!Mt(v)||v<=0||!Mt(f)||f!==+f||!Mt(h)||h!==+h)return null;var A=d.verticalCoordinatesGenerator||xte,P=d.horizontalCoordinatesGenerator||bte,T=d.horizontalPoints,E=d.verticalPoints;if((!T||!T.length)&&Nr(P)){var S=y&&y.length,I=P({yAxis:w?bi(bi({},w),{},{ticks:S?y:w.ticks}):void 0,width:l,height:c,offset:u},S?!0:m);is(Array.isArray(I),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Jc(I),"]")),Array.isArray(I)&&(T=I)}if((!E||!E.length)&&Nr(A)){var W=b&&b.length,O=A({xAxis:_?bi(bi({},_),{},{ticks:W?b:_.ticks}):void 0,width:l,height:c,offset:u},W?!0:m);is(Array.isArray(O),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Jc(O),"]")),Array.isArray(O)&&(E=O)}return Ce.createElement("g",{className:"recharts-cartesian-grid"},Ce.createElement(pte,{fill:d.fill,fillOpacity:d.fillOpacity,x:d.x,y:d.y,width:d.width,height:d.height,ry:d.ry}),Ce.createElement(mte,qc({},d,{offset:u,horizontalPoints:T,xAxis:_,yAxis:w})),Ce.createElement(gte,qc({},d,{offset:u,verticalPoints:E,xAxis:_,yAxis:w})),Ce.createElement(vte,qc({},d,{horizontalPoints:T})),Ce.createElement(yte,qc({},d,{verticalPoints:E})))}cv.displayName="CartesianGrid";var _te=["type","layout","connectNulls","ref"],wte=["key"];function bd(e){"@babel/helpers - typeof";return bd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bd(e)}function TT(e,t){if(e==null)return{};var r=jte(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function jte(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Mh(){return Mh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Mh.apply(this,arguments)}function ET(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function go(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ET(Object(r),!0).forEach(function(n){ns(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ET(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wu(e){return Pte(e)||Ate(e)||Cte(e)||Ste()}function Ste(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Cte(e,t){if(e){if(typeof e=="string")return ow(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ow(e,t)}}function Ate(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Pte(e){if(Array.isArray(e))return ow(e)}function ow(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ote(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function IT(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,AL(n.key),n)}}function kte(e,t,r){return t&&IT(e.prototype,t),r&&IT(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Tte(e,t,r){return t=uv(t),Ete(e,CL()?Reflect.construct(t,r||[],uv(e).constructor):t.apply(e,r))}function Ete(e,t){if(t&&(bd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ite(e)}function Ite(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function CL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(CL=function(){return!!e})()}function uv(e){return uv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},uv(e)}function Nte(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&sw(e,t)}function sw(e,t){return sw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},sw(e,t)}function ns(e,t,r){return t=AL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function AL(e){var t=Dte(e,"string");return bd(t)=="symbol"?t:t+""}function Dte(e,t){if(bd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(bd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var zp=function(e){function t(){var r;Ote(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return r=Tte(this,t,[].concat(a)),ns(r,"state",{isAnimationFinished:!0,totalLength:0}),ns(r,"generateSimpleStrokeDasharray",function(s,l){return"".concat(l,"px ").concat(s-l,"px")}),ns(r,"getStrokeDasharray",function(s,l,c){var u=c.reduce(function(b,_){return b+_});if(!u)return r.generateSimpleStrokeDasharray(l,s);for(var d=Math.floor(s/u),f=s%u,h=l-s,p=[],v=0,m=0;v<c.length;m+=c[v],++v)if(m+c[v]>f){p=[].concat(wu(c.slice(0,v)),[f-m]);break}var y=p.length%2===0?[0,h]:[h];return[].concat(wu(t.repeat(c,d)),wu(p),y).map(function(b){return"".concat(b,"px")}).join(", ")}),ns(r,"id",qd("recharts-line-")),ns(r,"pathRef",function(s){r.mainCurve=s}),ns(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),ns(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return Nte(t,e),kte(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,s=o.points,l=o.xAxis,c=o.yAxis,u=o.layout,d=o.children,f=Ao(d,Up);if(!f)return null;var h=function(m,y){return{x:m.x,y:m.y,value:m.value,errorVal:Wa(m.payload,y)}},p={clipPath:n?"url(#clipPath-".concat(a,")"):null};return Ce.createElement(un,p,f.map(function(v){return Ce.cloneElement(v,{key:"bar-".concat(v.props.dataKey),data:s,xAxis:l,yAxis:c,layout:u,dataPointFormatter:h})}))}},{key:"renderDots",value:function(n,a,o){var s=this.props.isAnimationActive;if(s&&!this.state.isAnimationFinished)return null;var l=this.props,c=l.dot,u=l.points,d=l.dataKey,f=yr(this.props,!1),h=yr(c,!0),p=u.map(function(m,y){var b=go(go(go({key:"dot-".concat(y),r:3},f),h),{},{index:y,cx:m.x,cy:m.y,value:m.value,dataKey:d,payload:m.payload,points:u});return t.renderDotItem(c,b)}),v={clipPath:n?"url(#clipPath-".concat(a?"":"dots-").concat(o,")"):null};return Ce.createElement(un,Mh({className:"recharts-line-dots",key:"dots"},v),p)}},{key:"renderCurveStatically",value:function(n,a,o,s){var l=this.props,c=l.type,u=l.layout,d=l.connectNulls;l.ref;var f=TT(l,_te),h=go(go(go({},yr(f,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:a?"url(#clipPath-".concat(o,")"):null,points:n},s),{},{type:c,layout:u,connectNulls:d});return Ce.createElement(zg,Mh({},h,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,a){var o=this,s=this.props,l=s.points,c=s.strokeDasharray,u=s.isAnimationActive,d=s.animationBegin,f=s.animationDuration,h=s.animationEasing,p=s.animationId,v=s.animateNewValues,m=s.width,y=s.height,b=this.state,_=b.prevPoints,w=b.totalLength;return Ce.createElement(Ts,{begin:d,duration:f,isActive:u,easing:h,from:{t:0},to:{t:1},key:"line-".concat(p),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(A){var P=A.t;if(_){var T=_.length/l.length,E=l.map(function(D,R){var F=Math.floor(R*T);if(_[F]){var z=_[F],K=_o(z.x,D.x),J=_o(z.y,D.y);return go(go({},D),{},{x:K(P),y:J(P)})}if(v){var L=_o(m*2,D.x),k=_o(y/2,D.y);return go(go({},D),{},{x:L(P),y:k(P)})}return go(go({},D),{},{x:D.x,y:D.y})});return o.renderCurveStatically(E,n,a)}var S=_o(0,w),I=S(P),W;if(c){var O="".concat(c).split(/[,\s]+/gim).map(function(D){return parseFloat(D)});W=o.getStrokeDasharray(I,w,O)}else W=o.generateSimpleStrokeDasharray(w,I);return o.renderCurveStatically(l,n,a,{strokeDasharray:W})})}},{key:"renderCurve",value:function(n,a){var o=this.props,s=o.points,l=o.isAnimationActive,c=this.state,u=c.prevPoints,d=c.totalLength;return l&&s&&s.length&&(!u&&d>0||!Bp(u,s))?this.renderCurveWithAnimation(n,a):this.renderCurveStatically(s,n,a)}},{key:"render",value:function(){var n,a=this.props,o=a.hide,s=a.dot,l=a.points,c=a.className,u=a.xAxis,d=a.yAxis,f=a.top,h=a.left,p=a.width,v=a.height,m=a.isAnimationActive,y=a.id;if(o||!l||!l.length)return null;var b=this.state.isAnimationFinished,_=l.length===1,w=Tr("recharts-line",c),A=u&&u.allowDataOverflow,P=d&&d.allowDataOverflow,T=A||P,E=$r(y)?this.id:y,S=(n=yr(s,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},I=S.r,W=I===void 0?3:I,O=S.strokeWidth,D=O===void 0?2:O,R=vB(s)?s:{},F=R.clipDot,z=F===void 0?!0:F,K=W*2+D;return Ce.createElement(un,{className:w},A||P?Ce.createElement("defs",null,Ce.createElement("clipPath",{id:"clipPath-".concat(E)},Ce.createElement("rect",{x:A?h:h-p/2,y:P?f:f-v/2,width:A?p:p*2,height:P?v:v*2})),!z&&Ce.createElement("clipPath",{id:"clipPath-dots-".concat(E)},Ce.createElement("rect",{x:h-K/2,y:f-K/2,width:p+K,height:v+K}))):null,!_&&this.renderCurve(T,E),this.renderErrorBar(T,E),(_||s)&&this.renderDots(T,z,E),(!m||b)&&fl.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:a.curPoints}:n.points!==a.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,a){for(var o=n.length%2!==0?[].concat(wu(n),[0]):n,s=[],l=0;l<a;++l)s=[].concat(wu(s),wu(o));return s}},{key:"renderDotItem",value:function(n,a){var o;if(Ce.isValidElement(n))o=Ce.cloneElement(n,a);else if(Nr(n))o=n(a);else{var s=a.key,l=TT(a,wte),c=Tr("recharts-line-dot",typeof n!="boolean"?n.className:"");o=Ce.createElement(dy,Mh({key:s},l,{className:c}))}return o}}])}(x.PureComponent);ns(zp,"displayName","Line");ns(zp,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!iu.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});ns(zp,"getComposedData",function(e){var t=e.props,r=e.xAxis,n=e.yAxis,a=e.xAxisTicks,o=e.yAxisTicks,s=e.dataKey,l=e.bandSize,c=e.displayedData,u=e.offset,d=t.layout,f=c.map(function(h,p){var v=Wa(h,s);return d==="horizontal"?{x:Rk({axis:r,ticks:a,bandSize:l,entry:h,index:p}),y:$r(v)?null:n.scale(v),value:v,payload:h}:{x:$r(v)?null:r.scale(v),y:Rk({axis:n,ticks:o,bandSize:l,entry:h,index:p}),value:v,payload:h}});return go({points:f,layout:d},u)});function _d(e){"@babel/helpers - typeof";return _d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_d(e)}function Mte(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Lte(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,kL(n.key),n)}}function Rte(e,t,r){return t&&Lte(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function qte(e,t,r){return t=dv(t),Fte(e,PL()?Reflect.construct(t,r||[],dv(e).constructor):t.apply(e,r))}function Fte(e,t){if(t&&(_d(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $te(e)}function $te(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function PL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(PL=function(){return!!e})()}function dv(e){return dv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},dv(e)}function Bte(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&lw(e,t)}function lw(e,t){return lw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},lw(e,t)}function OL(e,t,r){return t=kL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kL(e){var t=Ute(e,"string");return _d(t)=="symbol"?t:t+""}function Ute(e,t){if(_d(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(_d(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function cw(){return cw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},cw.apply(this,arguments)}function zte(e){var t=e.xAxisId,r=aS(),n=iS(),a=hL(t);return a==null?null:Ce.createElement(zd,cw({},a,{className:Tr("recharts-".concat(a.axisType," ").concat(a.axisType),a.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(s){return sl(s,!0)}}))}var Zc=function(e){function t(){return Mte(this,t),qte(this,t,arguments)}return Bte(t,e),Rte(t,[{key:"render",value:function(){return Ce.createElement(zte,this.props)}}])}(Ce.Component);OL(Zc,"displayName","XAxis");OL(Zc,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function wd(e){"@babel/helpers - typeof";return wd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wd(e)}function Wte(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Hte(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,IL(n.key),n)}}function Vte(e,t,r){return t&&Hte(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Gte(e,t,r){return t=fv(t),Yte(e,TL()?Reflect.construct(t,r||[],fv(e).constructor):t.apply(e,r))}function Yte(e,t){if(t&&(wd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Kte(e)}function Kte(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function TL(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(TL=function(){return!!e})()}function fv(e){return fv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},fv(e)}function Qte(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&uw(e,t)}function uw(e,t){return uw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},uw(e,t)}function EL(e,t,r){return t=IL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function IL(e){var t=Xte(e,"string");return wd(t)=="symbol"?t:t+""}function Xte(e,t){if(wd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(wd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function dw(){return dw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},dw.apply(this,arguments)}var Jte=function(t){var r=t.yAxisId,n=aS(),a=iS(),o=pL(r);return o==null?null:Ce.createElement(zd,dw({},o,{className:Tr("recharts-".concat(o.axisType," ").concat(o.axisType),o.className),viewBox:{x:0,y:0,width:n,height:a},ticksGenerator:function(l){return sl(l,!0)}}))},eu=function(e){function t(){return Wte(this,t),Gte(this,t,arguments)}return Qte(t,e),Vte(t,[{key:"render",value:function(){return Ce.createElement(Jte,this.props)}}])}(Ce.Component);EL(eu,"displayName","YAxis");EL(eu,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function NT(e){return rre(e)||tre(e)||ere(e)||Zte()}function Zte(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ere(e,t){if(e){if(typeof e=="string")return fw(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fw(e,t)}}function tre(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function rre(e){if(Array.isArray(e))return fw(e)}function fw(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var hw=function(t,r,n,a,o){var s=Ao(t,sS),l=Ao(t,by),c=[].concat(NT(s),NT(l)),u=Ao(t,wy),d="".concat(a,"Id"),f=a[0],h=r;if(c.length&&(h=c.reduce(function(m,y){if(y.props[d]===n&&As(y.props,"extendDomain")&&Mt(y.props[f])){var b=y.props[f];return[Math.min(m[0],b),Math.max(m[1],b)]}return m},h)),u.length){var p="".concat(f,"1"),v="".concat(f,"2");h=u.reduce(function(m,y){if(y.props[d]===n&&As(y.props,"extendDomain")&&Mt(y.props[p])&&Mt(y.props[v])){var b=y.props[p],_=y.props[v];return[Math.min(m[0],b,_),Math.max(m[1],b,_)]}return m},h)}return o&&o.length&&(h=o.reduce(function(m,y){return Mt(y)?[Math.min(m[0],y),Math.max(m[1],y)]:m},h)),h},o2={exports:{}},DT;function nre(){return DT||(DT=1,function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function a(c,u,d){this.fn=c,this.context=u,this.once=d||!1}function o(c,u,d,f,h){if(typeof d!="function")throw new TypeError("The listener must be a function");var p=new a(d,f||c,h),v=r?r+u:u;return c._events[v]?c._events[v].fn?c._events[v]=[c._events[v],p]:c._events[v].push(p):(c._events[v]=p,c._eventsCount++),c}function s(c,u){--c._eventsCount===0?c._events=new n:delete c._events[u]}function l(){this._events=new n,this._eventsCount=0}l.prototype.eventNames=function(){var u=[],d,f;if(this._eventsCount===0)return u;for(f in d=this._events)t.call(d,f)&&u.push(r?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(d)):u},l.prototype.listeners=function(u){var d=r?r+u:u,f=this._events[d];if(!f)return[];if(f.fn)return[f.fn];for(var h=0,p=f.length,v=new Array(p);h<p;h++)v[h]=f[h].fn;return v},l.prototype.listenerCount=function(u){var d=r?r+u:u,f=this._events[d];return f?f.fn?1:f.length:0},l.prototype.emit=function(u,d,f,h,p,v){var m=r?r+u:u;if(!this._events[m])return!1;var y=this._events[m],b=arguments.length,_,w;if(y.fn){switch(y.once&&this.removeListener(u,y.fn,void 0,!0),b){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,d),!0;case 3:return y.fn.call(y.context,d,f),!0;case 4:return y.fn.call(y.context,d,f,h),!0;case 5:return y.fn.call(y.context,d,f,h,p),!0;case 6:return y.fn.call(y.context,d,f,h,p,v),!0}for(w=1,_=new Array(b-1);w<b;w++)_[w-1]=arguments[w];y.fn.apply(y.context,_)}else{var A=y.length,P;for(w=0;w<A;w++)switch(y[w].once&&this.removeListener(u,y[w].fn,void 0,!0),b){case 1:y[w].fn.call(y[w].context);break;case 2:y[w].fn.call(y[w].context,d);break;case 3:y[w].fn.call(y[w].context,d,f);break;case 4:y[w].fn.call(y[w].context,d,f,h);break;default:if(!_)for(P=1,_=new Array(b-1);P<b;P++)_[P-1]=arguments[P];y[w].fn.apply(y[w].context,_)}}return!0},l.prototype.on=function(u,d,f){return o(this,u,d,f,!1)},l.prototype.once=function(u,d,f){return o(this,u,d,f,!0)},l.prototype.removeListener=function(u,d,f,h){var p=r?r+u:u;if(!this._events[p])return this;if(!d)return s(this,p),this;var v=this._events[p];if(v.fn)v.fn===d&&(!h||v.once)&&(!f||v.context===f)&&s(this,p);else{for(var m=0,y=[],b=v.length;m<b;m++)(v[m].fn!==d||h&&!v[m].once||f&&v[m].context!==f)&&y.push(v[m]);y.length?this._events[p]=y.length===1?y[0]:y:s(this,p)}return this},l.prototype.removeAllListeners=function(u){var d;return u?(d=r?r+u:u,this._events[d]&&s(this,d)):(this._events=new n,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=r,l.EventEmitter=l,e.exports=l}(o2)),o2.exports}var are=nre();const ire=Et(are);var s2=new ire,l2="recharts.syncMouseEvents";function jp(e){"@babel/helpers - typeof";return jp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jp(e)}function ore(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function sre(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,NL(n.key),n)}}function lre(e,t,r){return t&&sre(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function c2(e,t,r){return t=NL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function NL(e){var t=cre(e,"string");return jp(t)=="symbol"?t:t+""}function cre(e,t){if(jp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(jp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var ure=function(){function e(){ore(this,e),c2(this,"activeIndex",0),c2(this,"coordinateList",[]),c2(this,"layout","horizontal")}return lre(e,[{key:"setDetails",value:function(r){var n,a=r.coordinateList,o=a===void 0?null:a,s=r.container,l=s===void 0?null:s,c=r.layout,u=c===void 0?null:c,d=r.offset,f=d===void 0?null:d,h=r.mouseHandlerCallback,p=h===void 0?null:h;this.coordinateList=(n=o??this.coordinateList)!==null&&n!==void 0?n:[],this.container=l??this.container,this.layout=u??this.layout,this.offset=f??this.offset,this.mouseHandlerCallback=p??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var a=this.container.getBoundingClientRect(),o=a.x,s=a.y,l=a.height,c=this.coordinateList[this.activeIndex].coordinate,u=((r=window)===null||r===void 0?void 0:r.scrollX)||0,d=((n=window)===null||n===void 0?void 0:n.scrollY)||0,f=o+c+u,h=s+this.offset.top+l/2+d;this.mouseHandlerCallback({pageX:f,pageY:h})}}}])}();function dre(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e?.[0],a=e?.[1];if(n&&a&&Mt(n)&&Mt(a))return!0}return!1}function fre(e,t,r,n){var a=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-a:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-a,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function DL(e){var t=e.cx,r=e.cy,n=e.radius,a=e.startAngle,o=e.endAngle,s=Fn(t,r,n,a),l=Fn(t,r,n,o);return{points:[s,l],cx:t,cy:r,radius:n,startAngle:a,endAngle:o}}function hre(e,t,r){var n,a,o,s;if(e==="horizontal")n=t.x,o=n,a=r.top,s=r.top+r.height;else if(e==="vertical")a=t.y,s=a,n=r.left,o=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var l=t.cx,c=t.cy,u=t.innerRadius,d=t.outerRadius,f=t.angle,h=Fn(l,c,u,f),p=Fn(l,c,d,f);n=h.x,a=h.y,o=p.x,s=p.y}else return DL(t);return[{x:n,y:a},{x:o,y:s}]}function Sp(e){"@babel/helpers - typeof";return Sp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sp(e)}function MT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Pm(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?MT(Object(r),!0).forEach(function(n){pre(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):MT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function pre(e,t,r){return t=mre(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mre(e){var t=gre(e,"string");return Sp(t)=="symbol"?t:t+""}function gre(e,t){if(Sp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Sp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function vre(e){var t,r,n=e.element,a=e.tooltipEventType,o=e.isActive,s=e.activeCoordinate,l=e.activePayload,c=e.offset,u=e.activeTooltipIndex,d=e.tooltipAxisBandSize,f=e.layout,h=e.chartName,p=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!p||!o||!s||h!=="ScatterChart"&&a!=="axis")return null;var v,m=zg;if(h==="ScatterChart")v=s,m=FX;else if(h==="BarChart")v=fre(f,s,c,d),m=eS;else if(f==="radial"){var y=DL(s),b=y.cx,_=y.cy,w=y.radius,A=y.startAngle,P=y.endAngle;v={cx:b,cy:_,startAngle:A,endAngle:P,innerRadius:w,outerRadius:w},m=MM}else v={points:hre(f,s,c)},m=zg;var T=Pm(Pm(Pm(Pm({stroke:"#ccc",pointerEvents:"none"},c),v),yr(p,!1)),{},{payload:l,payloadIndex:u,className:Tr("recharts-tooltip-cursor",p.className)});return x.isValidElement(p)?x.cloneElement(p,T):x.createElement(m,T)}var yre=["item"],xre=["children","className","width","height","style","compact","title","desc"];function jd(e){"@babel/helpers - typeof";return jd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jd(e)}function Lu(){return Lu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Lu.apply(this,arguments)}function LT(e,t){return wre(e)||_re(e,t)||LL(e,t)||bre()}function bre(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _re(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,s,l=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}function wre(e){if(Array.isArray(e))return e}function RT(e,t){if(e==null)return{};var r=jre(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function jre(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Sre(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Cre(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,RL(n.key),n)}}function Are(e,t,r){return t&&Cre(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Pre(e,t,r){return t=hv(t),Ore(e,ML()?Reflect.construct(t,r||[],hv(e).constructor):t.apply(e,r))}function Ore(e,t){if(t&&(jd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kre(e)}function kre(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ML(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ML=function(){return!!e})()}function hv(e){return hv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},hv(e)}function Tre(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pw(e,t)}function pw(e,t){return pw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},pw(e,t)}function Sd(e){return Nre(e)||Ire(e)||LL(e)||Ere()}function Ere(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LL(e,t){if(e){if(typeof e=="string")return mw(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mw(e,t)}}function Ire(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Nre(e){if(Array.isArray(e))return mw(e)}function mw(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function qT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ht(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?qT(Object(r),!0).forEach(function(n){_r(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qT(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _r(e,t,r){return t=RL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function RL(e){var t=Dre(e,"string");return jd(t)=="symbol"?t:t+""}function Dre(e,t){if(jd(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(jd(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Mre={xAxis:["bottom","top"],yAxis:["left","right"]},Lre={width:"100%",height:"100%"},qL={x:0,y:0};function Om(e){return e}var Rre=function(t,r){return r==="horizontal"?t.x:r==="vertical"?t.y:r==="centric"?t.angle:t.radius},qre=function(t,r,n,a){var o=r.find(function(d){return d&&d.index===n});if(o){if(t==="horizontal")return{x:o.coordinate,y:a.y};if(t==="vertical")return{x:a.x,y:o.coordinate};if(t==="centric"){var s=o.coordinate,l=a.radius;return ht(ht(ht({},a),Fn(a.cx,a.cy,l,s)),{},{angle:s,radius:l})}var c=o.coordinate,u=a.angle;return ht(ht(ht({},a),Fn(a.cx,a.cy,c,u)),{},{angle:u,radius:c})}return qL},jy=function(t,r){var n=r.graphicalItems,a=r.dataStartIndex,o=r.dataEndIndex,s=(n??[]).reduce(function(l,c){var u=c.props.data;return u&&u.length?[].concat(Sd(l),Sd(u)):l},[]);return s.length>0?s:t&&t.length&&Mt(a)&&Mt(o)?t.slice(a,o+1):[]};function FL(e){return e==="number"?[0,"auto"]:void 0}var gw=function(t,r,n,a){var o=t.graphicalItems,s=t.tooltipAxis,l=jy(r,t);return n<0||!o||!o.length||n>=l.length?null:o.reduce(function(c,u){var d,f=(d=u.props.data)!==null&&d!==void 0?d:r;f&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=n&&(f=f.slice(t.dataStartIndex,t.dataEndIndex+1));var h;if(s.dataKey&&!s.allowDuplicatedCategory){var p=f===void 0?l:f;h=mg(p,s.dataKey,a)}else h=f&&f[n]||l[n];return h?[].concat(Sd(c),[kM(u,h)]):c},[])},FT=function(t,r,n,a){var o=a||{x:t.chartX,y:t.chartY},s=Rre(o,n),l=t.orderedTooltipTicks,c=t.tooltipAxis,u=t.tooltipTicks,d=pY(s,l,u,c);if(d>=0&&u){var f=u[d]&&u[d].value,h=gw(t,r,d,f),p=qre(n,l,d,o);return{activeTooltipIndex:d,activeLabel:f,activePayload:h,activeCoordinate:p}}return null},Fre=function(t,r){var n=r.axes,a=r.graphicalItems,o=r.axisType,s=r.axisIdKey,l=r.stackGroups,c=r.dataStartIndex,u=r.dataEndIndex,d=t.layout,f=t.children,h=t.stackOffset,p=jM(d,o);return n.reduce(function(v,m){var y,b=m.type.defaultProps!==void 0?ht(ht({},m.type.defaultProps),m.props):m.props,_=b.type,w=b.dataKey,A=b.allowDataOverflow,P=b.allowDuplicatedCategory,T=b.scale,E=b.ticks,S=b.includeHidden,I=b[s];if(v[I])return v;var W=jy(t.data,{graphicalItems:a.filter(function(C){var M,H=s in C.props?C.props[s]:(M=C.type.defaultProps)===null||M===void 0?void 0:M[s];return H===I}),dataStartIndex:c,dataEndIndex:u}),O=W.length,D,R,F;dre(b.domain,A,_)&&(D=T_(b.domain,null,A),p&&(_==="number"||T!=="auto")&&(F=Eh(W,w,"category")));var z=FL(_);if(!D||D.length===0){var K,J=(K=b.domain)!==null&&K!==void 0?K:z;if(w){if(D=Eh(W,w,_),_==="category"&&p){var L=sB(D);P&&L?(R=D,D=Zg(0,O)):P||(D=Bk(J,D,m).reduce(function(C,M){return C.indexOf(M)>=0?C:[].concat(Sd(C),[M])},[]))}else if(_==="category")P?D=D.filter(function(C){return C!==""&&!$r(C)}):D=Bk(J,D,m).reduce(function(C,M){return C.indexOf(M)>=0||M===""||$r(M)?C:[].concat(Sd(C),[M])},[]);else if(_==="number"){var k=xY(W,a.filter(function(C){var M,H,U=s in C.props?C.props[s]:(M=C.type.defaultProps)===null||M===void 0?void 0:M[s],te="hide"in C.props?C.props.hide:(H=C.type.defaultProps)===null||H===void 0?void 0:H.hide;return U===I&&(S||!te)}),w,o,d);k&&(D=k)}p&&(_==="number"||T!=="auto")&&(F=Eh(W,w,"category"))}else p?D=Zg(0,O):l&&l[I]&&l[I].hasStack&&_==="number"?D=h==="expand"?[0,1]:OM(l[I].stackGroups,c,u):D=wM(W,a.filter(function(C){var M=s in C.props?C.props[s]:C.type.defaultProps[s],H="hide"in C.props?C.props.hide:C.type.defaultProps.hide;return M===I&&(S||!H)}),_,d,!0);if(_==="number")D=hw(f,D,I,o,E),J&&(D=T_(J,D,A));else if(_==="category"&&J){var $=J,X=D.every(function(C){return $.indexOf(C)>=0});X&&(D=$)}}return ht(ht({},v),{},_r({},I,ht(ht({},b),{},{axisType:o,domain:D,categoricalDomain:F,duplicateDomain:R,originalDomain:(y=b.domain)!==null&&y!==void 0?y:z,isCategorical:p,layout:d})))},{})},$re=function(t,r){var n=r.graphicalItems,a=r.Axis,o=r.axisType,s=r.axisIdKey,l=r.stackGroups,c=r.dataStartIndex,u=r.dataEndIndex,d=t.layout,f=t.children,h=jy(t.data,{graphicalItems:n,dataStartIndex:c,dataEndIndex:u}),p=h.length,v=jM(d,o),m=-1;return n.reduce(function(y,b){var _=b.type.defaultProps!==void 0?ht(ht({},b.type.defaultProps),b.props):b.props,w=_[s],A=FL("number");if(!y[w]){m++;var P;return v?P=Zg(0,p):l&&l[w]&&l[w].hasStack?(P=OM(l[w].stackGroups,c,u),P=hw(f,P,w,o)):(P=T_(A,wM(h,n.filter(function(T){var E,S,I=s in T.props?T.props[s]:(E=T.type.defaultProps)===null||E===void 0?void 0:E[s],W="hide"in T.props?T.props.hide:(S=T.type.defaultProps)===null||S===void 0?void 0:S.hide;return I===w&&!W}),"number",d),a.defaultProps.allowDataOverflow),P=hw(f,P,w,o)),ht(ht({},y),{},_r({},w,ht(ht({axisType:o},a.defaultProps),{},{hide:!0,orientation:Co(Mre,"".concat(o,".").concat(m%2),null),domain:P,originalDomain:A,isCategorical:v,layout:d})))}return y},{})},Bre=function(t,r){var n=r.axisType,a=n===void 0?"xAxis":n,o=r.AxisComp,s=r.graphicalItems,l=r.stackGroups,c=r.dataStartIndex,u=r.dataEndIndex,d=t.children,f="".concat(a,"Id"),h=Ao(d,o),p={};return h&&h.length?p=Fre(t,{axes:h,graphicalItems:s,axisType:a,axisIdKey:f,stackGroups:l,dataStartIndex:c,dataEndIndex:u}):s&&s.length&&(p=$re(t,{Axis:o,graphicalItems:s,axisType:a,axisIdKey:f,stackGroups:l,dataStartIndex:c,dataEndIndex:u})),p},Ure=function(t){var r=Gl(t),n=sl(r,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:Pj(n,function(a){return a.coordinate}),tooltipAxis:r,tooltipAxisBandSize:$g(r,n)}},$T=function(t){var r=t.children,n=t.defaultShowTooltip,a=yo(r,pd),o=0,s=0;return t.data&&t.data.length!==0&&(s=t.data.length-1),a&&a.props&&(a.props.startIndex>=0&&(o=a.props.startIndex),a.props.endIndex>=0&&(s=a.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:o,dataEndIndex:s,activeTooltipIndex:-1,isTooltipActive:!!n}},zre=function(t){return!t||!t.length?!1:t.some(function(r){var n=ul(r&&r.type);return n&&n.indexOf("Bar")>=0})},BT=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},Wre=function(t,r){var n=t.props,a=t.graphicalItems,o=t.xAxisMap,s=o===void 0?{}:o,l=t.yAxisMap,c=l===void 0?{}:l,u=n.width,d=n.height,f=n.children,h=n.margin||{},p=yo(f,pd),v=yo(f,Ss),m=Object.keys(c).reduce(function(P,T){var E=c[T],S=E.orientation;return!E.mirror&&!E.hide?ht(ht({},P),{},_r({},S,P[S]+E.width)):P},{left:h.left||0,right:h.right||0}),y=Object.keys(s).reduce(function(P,T){var E=s[T],S=E.orientation;return!E.mirror&&!E.hide?ht(ht({},P),{},_r({},S,Co(P,"".concat(S))+E.height)):P},{top:h.top||0,bottom:h.bottom||0}),b=ht(ht({},y),m),_=b.bottom;p&&(b.bottom+=p.props.height||pd.defaultProps.height),v&&r&&(b=vY(b,a,n,r));var w=u-b.left-b.right,A=d-b.top-b.bottom;return ht(ht({brushBottom:_},b),{},{width:Math.max(w,0),height:Math.max(A,0)})},Hre=function(t,r){if(r==="xAxis")return t[r].width;if(r==="yAxis")return t[r].height},uS=function(t){var r=t.chartName,n=t.GraphicalChild,a=t.defaultTooltipEventType,o=a===void 0?"axis":a,s=t.validateTooltipEventTypes,l=s===void 0?["axis"]:s,c=t.axisComponents,u=t.legendContent,d=t.formatAxisMap,f=t.defaultProps,h=function(b,_){var w=_.graphicalItems,A=_.stackGroups,P=_.offset,T=_.updateId,E=_.dataStartIndex,S=_.dataEndIndex,I=b.barSize,W=b.layout,O=b.barGap,D=b.barCategoryGap,R=b.maxBarSize,F=BT(W),z=F.numericAxisName,K=F.cateAxisName,J=zre(w),L=[];return w.forEach(function(k,$){var X=jy(b.data,{graphicalItems:[k],dataStartIndex:E,dataEndIndex:S}),C=k.type.defaultProps!==void 0?ht(ht({},k.type.defaultProps),k.props):k.props,M=C.dataKey,H=C.maxBarSize,U=C["".concat(z,"Id")],te=C["".concat(K,"Id")],le={},oe=c.reduce(function(it,lt){var vt=_["".concat(lt.axisType,"Map")],Ye=C["".concat(lt.axisType,"Id")];vt&&vt[Ye]||lt.axisType==="zAxis"||Xc();var Ze=vt[Ye];return ht(ht({},it),{},_r(_r({},lt.axisType,Ze),"".concat(lt.axisType,"Ticks"),sl(Ze)))},le),ae=oe[K],he=oe["".concat(K,"Ticks")],me=A&&A[U]&&A[U].hasStack&&OY(k,A[U].stackGroups),Q=ul(k.type).indexOf("Bar")>=0,G=$g(ae,he),ee=[],se=J&&mY({barSize:I,stackGroups:A,totalSize:Hre(oe,K)});if(Q){var V,Ge,De=$r(H)?R:H,Fe=(V=(Ge=$g(ae,he,!0))!==null&&Ge!==void 0?Ge:De)!==null&&V!==void 0?V:0;ee=gY({barGap:O,barCategoryGap:D,bandSize:Fe!==G?Fe:G,sizeList:se[te],maxBarSize:De}),Fe!==G&&(ee=ee.map(function(it){return ht(ht({},it),{},{position:ht(ht({},it.position),{},{offset:it.position.offset-Fe/2})})}))}var Xe=k&&k.type&&k.type.getComposedData;Xe&&L.push({props:ht(ht({},Xe(ht(ht({},oe),{},{displayedData:X,props:b,dataKey:M,item:k,bandSize:G,barPosition:ee,offset:P,stackedData:me,layout:W,dataStartIndex:E,dataEndIndex:S}))),{},_r(_r(_r({key:k.key||"item-".concat($)},z,oe[z]),K,oe[K]),"animationId",T)),childIndex:bB(k,b.children),item:k})}),L},p=function(b,_){var w=b.props,A=b.dataStartIndex,P=b.dataEndIndex,T=b.updateId;if(!tA({props:w}))return null;var E=w.children,S=w.layout,I=w.stackOffset,W=w.data,O=w.reverseStackOrder,D=BT(S),R=D.numericAxisName,F=D.cateAxisName,z=Ao(E,n),K=AY(W,z,"".concat(R,"Id"),"".concat(F,"Id"),I,O),J=c.reduce(function(C,M){var H="".concat(M.axisType,"Map");return ht(ht({},C),{},_r({},H,Bre(w,ht(ht({},M),{},{graphicalItems:z,stackGroups:M.axisType===R&&K,dataStartIndex:A,dataEndIndex:P}))))},{}),L=Wre(ht(ht({},J),{},{props:w,graphicalItems:z}),_?.legendBBox);Object.keys(J).forEach(function(C){J[C]=d(w,J[C],L,C.replace("Map",""),r)});var k=J["".concat(F,"Map")],$=Ure(k),X=h(w,ht(ht({},J),{},{dataStartIndex:A,dataEndIndex:P,updateId:T,graphicalItems:z,stackGroups:K,offset:L}));return ht(ht({formattedGraphicalItems:X,graphicalItems:z,offset:L,stackGroups:K},$),J)},v=function(y){function b(_){var w,A,P;return Sre(this,b),P=Pre(this,b,[_]),_r(P,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),_r(P,"accessibilityManager",new ure),_r(P,"handleLegendBBoxUpdate",function(T){if(T){var E=P.state,S=E.dataStartIndex,I=E.dataEndIndex,W=E.updateId;P.setState(ht({legendBBox:T},p({props:P.props,dataStartIndex:S,dataEndIndex:I,updateId:W},ht(ht({},P.state),{},{legendBBox:T}))))}}),_r(P,"handleReceiveSyncEvent",function(T,E,S){if(P.props.syncId===T){if(S===P.eventEmitterSymbol&&typeof P.props.syncMethod!="function")return;P.applySyncEvent(E)}}),_r(P,"handleBrushChange",function(T){var E=T.startIndex,S=T.endIndex;if(E!==P.state.dataStartIndex||S!==P.state.dataEndIndex){var I=P.state.updateId;P.setState(function(){return ht({dataStartIndex:E,dataEndIndex:S},p({props:P.props,dataStartIndex:E,dataEndIndex:S,updateId:I},P.state))}),P.triggerSyncEvent({dataStartIndex:E,dataEndIndex:S})}}),_r(P,"handleMouseEnter",function(T){var E=P.getMouseInfo(T);if(E){var S=ht(ht({},E),{},{isTooltipActive:!0});P.setState(S),P.triggerSyncEvent(S);var I=P.props.onMouseEnter;Nr(I)&&I(S,T)}}),_r(P,"triggeredAfterMouseMove",function(T){var E=P.getMouseInfo(T),S=E?ht(ht({},E),{},{isTooltipActive:!0}):{isTooltipActive:!1};P.setState(S),P.triggerSyncEvent(S);var I=P.props.onMouseMove;Nr(I)&&I(S,T)}),_r(P,"handleItemMouseEnter",function(T){P.setState(function(){return{isTooltipActive:!0,activeItem:T,activePayload:T.tooltipPayload,activeCoordinate:T.tooltipPosition||{x:T.cx,y:T.cy}}})}),_r(P,"handleItemMouseLeave",function(){P.setState(function(){return{isTooltipActive:!1}})}),_r(P,"handleMouseMove",function(T){T.persist(),P.throttleTriggeredAfterMouseMove(T)}),_r(P,"handleMouseLeave",function(T){P.throttleTriggeredAfterMouseMove.cancel();var E={isTooltipActive:!1};P.setState(E),P.triggerSyncEvent(E);var S=P.props.onMouseLeave;Nr(S)&&S(E,T)}),_r(P,"handleOuterEvent",function(T){var E=xB(T),S=Co(P.props,"".concat(E));if(E&&Nr(S)){var I,W;/.*touch.*/i.test(E)?W=P.getMouseInfo(T.changedTouches[0]):W=P.getMouseInfo(T),S((I=W)!==null&&I!==void 0?I:{},T)}}),_r(P,"handleClick",function(T){var E=P.getMouseInfo(T);if(E){var S=ht(ht({},E),{},{isTooltipActive:!0});P.setState(S),P.triggerSyncEvent(S);var I=P.props.onClick;Nr(I)&&I(S,T)}}),_r(P,"handleMouseDown",function(T){var E=P.props.onMouseDown;if(Nr(E)){var S=P.getMouseInfo(T);E(S,T)}}),_r(P,"handleMouseUp",function(T){var E=P.props.onMouseUp;if(Nr(E)){var S=P.getMouseInfo(T);E(S,T)}}),_r(P,"handleTouchMove",function(T){T.changedTouches!=null&&T.changedTouches.length>0&&P.throttleTriggeredAfterMouseMove(T.changedTouches[0])}),_r(P,"handleTouchStart",function(T){T.changedTouches!=null&&T.changedTouches.length>0&&P.handleMouseDown(T.changedTouches[0])}),_r(P,"handleTouchEnd",function(T){T.changedTouches!=null&&T.changedTouches.length>0&&P.handleMouseUp(T.changedTouches[0])}),_r(P,"handleDoubleClick",function(T){var E=P.props.onDoubleClick;if(Nr(E)){var S=P.getMouseInfo(T);E(S,T)}}),_r(P,"handleContextMenu",function(T){var E=P.props.onContextMenu;if(Nr(E)){var S=P.getMouseInfo(T);E(S,T)}}),_r(P,"triggerSyncEvent",function(T){P.props.syncId!==void 0&&s2.emit(l2,P.props.syncId,T,P.eventEmitterSymbol)}),_r(P,"applySyncEvent",function(T){var E=P.props,S=E.layout,I=E.syncMethod,W=P.state.updateId,O=T.dataStartIndex,D=T.dataEndIndex;if(T.dataStartIndex!==void 0||T.dataEndIndex!==void 0)P.setState(ht({dataStartIndex:O,dataEndIndex:D},p({props:P.props,dataStartIndex:O,dataEndIndex:D,updateId:W},P.state)));else if(T.activeTooltipIndex!==void 0){var R=T.chartX,F=T.chartY,z=T.activeTooltipIndex,K=P.state,J=K.offset,L=K.tooltipTicks;if(!J)return;if(typeof I=="function")z=I(L,T);else if(I==="value"){z=-1;for(var k=0;k<L.length;k++)if(L[k].value===T.activeLabel){z=k;break}}var $=ht(ht({},J),{},{x:J.left,y:J.top}),X=Math.min(R,$.x+$.width),C=Math.min(F,$.y+$.height),M=L[z]&&L[z].value,H=gw(P.state,P.props.data,z),U=L[z]?{x:S==="horizontal"?L[z].coordinate:X,y:S==="horizontal"?C:L[z].coordinate}:qL;P.setState(ht(ht({},T),{},{activeLabel:M,activeCoordinate:U,activePayload:H,activeTooltipIndex:z}))}else P.setState(T)}),_r(P,"renderCursor",function(T){var E,S=P.state,I=S.isTooltipActive,W=S.activeCoordinate,O=S.activePayload,D=S.offset,R=S.activeTooltipIndex,F=S.tooltipAxisBandSize,z=P.getTooltipEventType(),K=(E=T.props.active)!==null&&E!==void 0?E:I,J=P.props.layout,L=T.key||"_recharts-cursor";return Ce.createElement(vre,{key:L,activeCoordinate:W,activePayload:O,activeTooltipIndex:R,chartName:r,element:T,isActive:K,layout:J,offset:D,tooltipAxisBandSize:F,tooltipEventType:z})}),_r(P,"renderPolarAxis",function(T,E,S){var I=Co(T,"type.axisType"),W=Co(P.state,"".concat(I,"Map")),O=T.type.defaultProps,D=O!==void 0?ht(ht({},O),T.props):T.props,R=W&&W[D["".concat(I,"Id")]];return x.cloneElement(T,ht(ht({},R),{},{className:Tr(I,R.className),key:T.key||"".concat(E,"-").concat(S),ticks:sl(R,!0)}))}),_r(P,"renderPolarGrid",function(T){var E=T.props,S=E.radialLines,I=E.polarAngles,W=E.polarRadius,O=P.state,D=O.radiusAxisMap,R=O.angleAxisMap,F=Gl(D),z=Gl(R),K=z.cx,J=z.cy,L=z.innerRadius,k=z.outerRadius;return x.cloneElement(T,{polarAngles:Array.isArray(I)?I:sl(z,!0).map(function($){return $.coordinate}),polarRadius:Array.isArray(W)?W:sl(F,!0).map(function($){return $.coordinate}),cx:K,cy:J,innerRadius:L,outerRadius:k,key:T.key||"polar-grid",radialLines:S})}),_r(P,"renderLegend",function(){var T=P.state.formattedGraphicalItems,E=P.props,S=E.children,I=E.width,W=E.height,O=P.props.margin||{},D=I-(O.left||0)-(O.right||0),R=bM({children:S,formattedGraphicalItems:T,legendWidth:D,legendContent:u});if(!R)return null;var F=R.item,z=RT(R,yre);return x.cloneElement(F,ht(ht({},z),{},{chartWidth:I,chartHeight:W,margin:O,onBBoxUpdate:P.handleLegendBBoxUpdate}))}),_r(P,"renderTooltip",function(){var T,E=P.props,S=E.children,I=E.accessibilityLayer,W=yo(S,xo);if(!W)return null;var O=P.state,D=O.isTooltipActive,R=O.activeCoordinate,F=O.activePayload,z=O.activeLabel,K=O.offset,J=(T=W.props.active)!==null&&T!==void 0?T:D;return x.cloneElement(W,{viewBox:ht(ht({},K),{},{x:K.left,y:K.top}),active:J,label:z,payload:J?F:[],coordinate:R,accessibilityLayer:I})}),_r(P,"renderBrush",function(T){var E=P.props,S=E.margin,I=E.data,W=P.state,O=W.offset,D=W.dataStartIndex,R=W.dataEndIndex,F=W.updateId;return x.cloneElement(T,{key:T.key||"_recharts-brush",onChange:jm(P.handleBrushChange,T.props.onChange),data:I,x:Mt(T.props.x)?T.props.x:O.left,y:Mt(T.props.y)?T.props.y:O.top+O.height+O.brushBottom-(S.bottom||0),width:Mt(T.props.width)?T.props.width:O.width,startIndex:D,endIndex:R,updateId:"brush-".concat(F)})}),_r(P,"renderReferenceElement",function(T,E,S){if(!T)return null;var I=P,W=I.clipPathId,O=P.state,D=O.xAxisMap,R=O.yAxisMap,F=O.offset,z=T.type.defaultProps||{},K=T.props,J=K.xAxisId,L=J===void 0?z.xAxisId:J,k=K.yAxisId,$=k===void 0?z.yAxisId:k;return x.cloneElement(T,{key:T.key||"".concat(E,"-").concat(S),xAxis:D[L],yAxis:R[$],viewBox:{x:F.left,y:F.top,width:F.width,height:F.height},clipPathId:W})}),_r(P,"renderActivePoints",function(T){var E=T.item,S=T.activePoint,I=T.basePoint,W=T.childIndex,O=T.isRange,D=[],R=E.props.key,F=E.item.type.defaultProps!==void 0?ht(ht({},E.item.type.defaultProps),E.item.props):E.item.props,z=F.activeDot,K=F.dataKey,J=ht(ht({index:W,dataKey:K,cx:S.x,cy:S.y,r:4,fill:Zj(E.item),strokeWidth:2,stroke:"#fff",payload:S.payload,value:S.value},yr(z,!1)),gg(z));return D.push(b.renderActiveDot(z,J,"".concat(R,"-activePoint-").concat(W))),I?D.push(b.renderActiveDot(z,ht(ht({},J),{},{cx:I.x,cy:I.y}),"".concat(R,"-basePoint-").concat(W))):O&&D.push(null),D}),_r(P,"renderGraphicChild",function(T,E,S){var I=P.filterFormatItem(T,E,S);if(!I)return null;var W=P.getTooltipEventType(),O=P.state,D=O.isTooltipActive,R=O.tooltipAxis,F=O.activeTooltipIndex,z=O.activeLabel,K=P.props.children,J=yo(K,xo),L=I.props,k=L.points,$=L.isRange,X=L.baseLine,C=I.item.type.defaultProps!==void 0?ht(ht({},I.item.type.defaultProps),I.item.props):I.item.props,M=C.activeDot,H=C.hide,U=C.activeBar,te=C.activeShape,le=!!(!H&&D&&J&&(M||U||te)),oe={};W!=="axis"&&J&&J.props.trigger==="click"?oe={onClick:jm(P.handleItemMouseEnter,T.props.onClick)}:W!=="axis"&&(oe={onMouseLeave:jm(P.handleItemMouseLeave,T.props.onMouseLeave),onMouseEnter:jm(P.handleItemMouseEnter,T.props.onMouseEnter)});var ae=x.cloneElement(T,ht(ht({},I.props),oe));function he(lt){return typeof R.dataKey=="function"?R.dataKey(lt.payload):null}if(le)if(F>=0){var me,Q;if(R.dataKey&&!R.allowDuplicatedCategory){var G=typeof R.dataKey=="function"?he:"payload.".concat(R.dataKey.toString());me=mg(k,G,z),Q=$&&X&&mg(X,G,z)}else me=k?.[F],Q=$&&X&&X[F];if(te||U){var ee=T.props.activeIndex!==void 0?T.props.activeIndex:F;return[x.cloneElement(T,ht(ht(ht({},I.props),oe),{},{activeIndex:ee})),null,null]}if(!$r(me))return[ae].concat(Sd(P.renderActivePoints({item:I,activePoint:me,basePoint:Q,childIndex:F,isRange:$})))}else{var se,V=(se=P.getItemByXY(P.state.activeCoordinate))!==null&&se!==void 0?se:{graphicalItem:ae},Ge=V.graphicalItem,De=Ge.item,Fe=De===void 0?T:De,Xe=Ge.childIndex,it=ht(ht(ht({},I.props),oe),{},{activeIndex:Xe});return[x.cloneElement(Fe,it),null,null]}return $?[ae,null,null]:[ae,null]}),_r(P,"renderCustomized",function(T,E,S){return x.cloneElement(T,ht(ht({key:"recharts-customized-".concat(S)},P.props),P.state))}),_r(P,"renderMap",{CartesianGrid:{handler:Om,once:!0},ReferenceArea:{handler:P.renderReferenceElement},ReferenceLine:{handler:Om},ReferenceDot:{handler:P.renderReferenceElement},XAxis:{handler:Om},YAxis:{handler:Om},Brush:{handler:P.renderBrush,once:!0},Bar:{handler:P.renderGraphicChild},Line:{handler:P.renderGraphicChild},Area:{handler:P.renderGraphicChild},Radar:{handler:P.renderGraphicChild},RadialBar:{handler:P.renderGraphicChild},Scatter:{handler:P.renderGraphicChild},Pie:{handler:P.renderGraphicChild},Funnel:{handler:P.renderGraphicChild},Tooltip:{handler:P.renderCursor,once:!0},PolarGrid:{handler:P.renderPolarGrid,once:!0},PolarAngleAxis:{handler:P.renderPolarAxis},PolarRadiusAxis:{handler:P.renderPolarAxis},Customized:{handler:P.renderCustomized}}),P.clipPathId="".concat((w=_.id)!==null&&w!==void 0?w:qd("recharts"),"-clip"),P.throttleTriggeredAfterMouseMove=yD(P.triggeredAfterMouseMove,(A=_.throttleDelay)!==null&&A!==void 0?A:1e3/60),P.state={},P}return Tre(b,y),Are(b,[{key:"componentDidMount",value:function(){var w,A;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(w=this.props.margin.left)!==null&&w!==void 0?w:0,top:(A=this.props.margin.top)!==null&&A!==void 0?A:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var w=this.props,A=w.children,P=w.data,T=w.height,E=w.layout,S=yo(A,xo);if(S){var I=S.props.defaultIndex;if(!(typeof I!="number"||I<0||I>this.state.tooltipTicks.length-1)){var W=this.state.tooltipTicks[I]&&this.state.tooltipTicks[I].value,O=gw(this.state,P,I,W),D=this.state.tooltipTicks[I].coordinate,R=(this.state.offset.top+T)/2,F=E==="horizontal",z=F?{x:D,y:R}:{y:D,x:R},K=this.state.formattedGraphicalItems.find(function(L){var k=L.item;return k.type.name==="Scatter"});K&&(z=ht(ht({},z),K.props.points[I].tooltipPosition),O=K.props.points[I].tooltipPayload);var J={activeTooltipIndex:I,isTooltipActive:!0,activeLabel:W,activePayload:O,activeCoordinate:z};this.setState(J),this.renderCursor(S),this.accessibilityManager.setIndex(I)}}}},{key:"getSnapshotBeforeUpdate",value:function(w,A){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==A.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==w.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==w.margin){var P,T;this.accessibilityManager.setDetails({offset:{left:(P=this.props.margin.left)!==null&&P!==void 0?P:0,top:(T=this.props.margin.top)!==null&&T!==void 0?T:0}})}return null}},{key:"componentDidUpdate",value:function(w){J2([yo(w.children,xo)],[yo(this.props.children,xo)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var w=yo(this.props.children,xo);if(w&&typeof w.props.shared=="boolean"){var A=w.props.shared?"axis":"item";return l.indexOf(A)>=0?A:o}return o}},{key:"getMouseInfo",value:function(w){if(!this.container)return null;var A=this.container,P=A.getBoundingClientRect(),T=o9(P),E={chartX:Math.round(w.pageX-T.left),chartY:Math.round(w.pageY-T.top)},S=P.width/A.offsetWidth||1,I=this.inRange(E.chartX,E.chartY,S);if(!I)return null;var W=this.state,O=W.xAxisMap,D=W.yAxisMap,R=this.getTooltipEventType(),F=FT(this.state,this.props.data,this.props.layout,I);if(R!=="axis"&&O&&D){var z=Gl(O).scale,K=Gl(D).scale,J=z&&z.invert?z.invert(E.chartX):null,L=K&&K.invert?K.invert(E.chartY):null;return ht(ht({},E),{},{xValue:J,yValue:L},F)}return F?ht(ht({},E),F):null}},{key:"inRange",value:function(w,A){var P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,T=this.props.layout,E=w/P,S=A/P;if(T==="horizontal"||T==="vertical"){var I=this.state.offset,W=E>=I.left&&E<=I.left+I.width&&S>=I.top&&S<=I.top+I.height;return W?{x:E,y:S}:null}var O=this.state,D=O.angleAxisMap,R=O.radiusAxisMap;if(D&&R){var F=Gl(D);return Wk({x:E,y:S},F)}return null}},{key:"parseEventsOfWrapper",value:function(){var w=this.props.children,A=this.getTooltipEventType(),P=yo(w,xo),T={};P&&A==="axis"&&(P.props.trigger==="click"?T={onClick:this.handleClick}:T={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var E=gg(this.props,this.handleOuterEvent);return ht(ht({},E),T)}},{key:"addListener",value:function(){s2.on(l2,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){s2.removeListener(l2,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(w,A,P){for(var T=this.state.formattedGraphicalItems,E=0,S=T.length;E<S;E++){var I=T[E];if(I.item===w||I.props.key===w.key||A===ul(I.item.type)&&P===I.childIndex)return I}return null}},{key:"renderClipPath",value:function(){var w=this.clipPathId,A=this.state.offset,P=A.left,T=A.top,E=A.height,S=A.width;return Ce.createElement("defs",null,Ce.createElement("clipPath",{id:w},Ce.createElement("rect",{x:P,y:T,height:E,width:S})))}},{key:"getXScales",value:function(){var w=this.state.xAxisMap;return w?Object.entries(w).reduce(function(A,P){var T=LT(P,2),E=T[0],S=T[1];return ht(ht({},A),{},_r({},E,S.scale))},{}):null}},{key:"getYScales",value:function(){var w=this.state.yAxisMap;return w?Object.entries(w).reduce(function(A,P){var T=LT(P,2),E=T[0],S=T[1];return ht(ht({},A),{},_r({},E,S.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(w){var A;return(A=this.state.xAxisMap)===null||A===void 0||(A=A[w])===null||A===void 0?void 0:A.scale}},{key:"getYScaleByAxisId",value:function(w){var A;return(A=this.state.yAxisMap)===null||A===void 0||(A=A[w])===null||A===void 0?void 0:A.scale}},{key:"getItemByXY",value:function(w){var A=this.state,P=A.formattedGraphicalItems,T=A.activeItem;if(P&&P.length)for(var E=0,S=P.length;E<S;E++){var I=P[E],W=I.props,O=I.item,D=O.type.defaultProps!==void 0?ht(ht({},O.type.defaultProps),O.props):O.props,R=ul(O.type);if(R==="Bar"){var F=(W.data||[]).find(function(L){return xX(w,L)});if(F)return{graphicalItem:I,payload:F}}else if(R==="RadialBar"){var z=(W.data||[]).find(function(L){return Wk(w,L)});if(z)return{graphicalItem:I,payload:z}}else if(gy(I,T)||vy(I,T)||yp(I,T)){var K=UJ({graphicalItem:I,activeTooltipItem:T,itemData:D.data}),J=D.activeIndex===void 0?K:D.activeIndex;return{graphicalItem:ht(ht({},I),{},{childIndex:J}),payload:yp(I,T)?D.data[K]:I.props.data[K]}}}return null}},{key:"render",value:function(){var w=this;if(!tA(this))return null;var A=this.props,P=A.children,T=A.className,E=A.width,S=A.height,I=A.style,W=A.compact,O=A.title,D=A.desc,R=RT(A,xre),F=yr(R,!1);if(W)return Ce.createElement(vT,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ce.createElement(e_,Lu({},F,{width:E,height:S,title:O,desc:D}),this.renderClipPath(),nA(P,this.renderMap)));if(this.props.accessibilityLayer){var z,K;F.tabIndex=(z=this.props.tabIndex)!==null&&z!==void 0?z:0,F.role=(K=this.props.role)!==null&&K!==void 0?K:"application",F.onKeyDown=function(L){w.accessibilityManager.keyboardEvent(L)},F.onFocus=function(){w.accessibilityManager.focus()}}var J=this.parseEventsOfWrapper();return Ce.createElement(vT,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ce.createElement("div",Lu({className:Tr("recharts-wrapper",T),style:ht({position:"relative",cursor:"default",width:E,height:S},I)},J,{ref:function(k){w.container=k}}),Ce.createElement(e_,Lu({},F,{width:E,height:S,title:O,desc:D,style:Lre}),this.renderClipPath(),nA(P,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(x.Component);_r(v,"displayName",r),_r(v,"defaultProps",ht({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},f)),_r(v,"getDerivedStateFromProps",function(y,b){var _=y.dataKey,w=y.data,A=y.children,P=y.width,T=y.height,E=y.layout,S=y.stackOffset,I=y.margin,W=b.dataStartIndex,O=b.dataEndIndex;if(b.updateId===void 0){var D=$T(y);return ht(ht(ht({},D),{},{updateId:0},p(ht(ht({props:y},D),{},{updateId:0}),b)),{},{prevDataKey:_,prevData:w,prevWidth:P,prevHeight:T,prevLayout:E,prevStackOffset:S,prevMargin:I,prevChildren:A})}if(_!==b.prevDataKey||w!==b.prevData||P!==b.prevWidth||T!==b.prevHeight||E!==b.prevLayout||S!==b.prevStackOffset||!Hu(I,b.prevMargin)){var R=$T(y),F={chartX:b.chartX,chartY:b.chartY,isTooltipActive:b.isTooltipActive},z=ht(ht({},FT(b,w,E)),{},{updateId:b.updateId+1}),K=ht(ht(ht({},R),F),z);return ht(ht(ht({},K),p(ht({props:y},K),b)),{},{prevDataKey:_,prevData:w,prevWidth:P,prevHeight:T,prevLayout:E,prevStackOffset:S,prevMargin:I,prevChildren:A})}if(!J2(A,b.prevChildren)){var J,L,k,$,X=yo(A,pd),C=X&&(J=(L=X.props)===null||L===void 0?void 0:L.startIndex)!==null&&J!==void 0?J:W,M=X&&(k=($=X.props)===null||$===void 0?void 0:$.endIndex)!==null&&k!==void 0?k:O,H=C!==W||M!==O,U=!$r(w),te=U&&!H?b.updateId:b.updateId+1;return ht(ht({updateId:te},p(ht(ht({props:y},b),{},{updateId:te,dataStartIndex:C,dataEndIndex:M}),b)),{},{prevChildren:A,dataStartIndex:C,dataEndIndex:M})}return null}),_r(v,"renderActiveDot",function(y,b,_){var w;return x.isValidElement(y)?w=x.cloneElement(y,b):Nr(y)?w=y(b):w=Ce.createElement(dy,b),Ce.createElement(un,{className:"recharts-active-dot",key:_},w)});var m=x.forwardRef(function(b,_){return Ce.createElement(v,Lu({},b,{ref:_}))});return m.displayName=v.displayName,m},Vre=uS({chartName:"LineChart",GraphicalChild:zp,axisComponents:[{axisType:"xAxis",AxisComp:Zc},{axisType:"yAxis",AxisComp:eu}],formatAxisMap:iL}),$L=uS({chartName:"BarChart",GraphicalChild:yl,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:Zc},{axisType:"yAxis",AxisComp:eu}],formatAxisMap:iL}),Gre=uS({chartName:"PieChart",GraphicalChild:Sl,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:my},{axisType:"radiusAxis",AxisComp:hy}],formatAxisMap:qY,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const u2=()=>Math.random().toString(36).slice(2),Yre=({open:e,onOpen:t,onClose:r,panelWidth:n=360,rightOffset:a=24,desktopTopOffset:o=72,desktopWidth:s,onDesktopResize:l,desktopMinWidth:c=280,desktopMaxWidth:u=640,desktopHandleWidth:d=12,desktopBottomOffset:f=32})=>{const{user:h}=ta(),[p,v]=x.useState(!1),[m,y]=x.useState(""),[b,_]=x.useState([]),w=x.useRef(null),A=yI(),P=l8(A.breakpoints.up("md")),[T,E]=x.useState(n),S=x.useRef(0),I=x.useRef(n),[W,O]=x.useState(!1),[D,R]=x.useState({}),F=x.useMemo(()=>Math.min(u,Math.max(c,typeof s=="number"?s:T)),[s,T,u,c]),z=x.useMemo(()=>`calc(100vh - ${o+f}px)`,[f,o]),K=o+72;x.useEffect(()=>{_([]),y("")},[h?.id]),x.useEffect(()=>{w.current&&(w.current.scrollTop=w.current.scrollHeight)},[b,e]),x.useEffect(()=>{typeof s=="number"&&E(s)},[s]),x.useEffect(()=>{if(!W)return;let le=null,oe=null;const ae=()=>{if(oe==null)return;const Q=oe;oe=null,l?l(Q):E(Q),le=null},he=Q=>{const G=S.current-Q.clientX;oe=Math.min(u,Math.max(c,I.current+G)),le==null&&(le=requestAnimationFrame(ae))},me=()=>{O(!1),document.body.style.userSelect="",document.body.style.cursor=""};return window.addEventListener("mousemove",he),window.addEventListener("mouseup",me),()=>{window.removeEventListener("mousemove",he),window.removeEventListener("mouseup",me),le!=null&&cancelAnimationFrame(le)}},[u,c,W,l]),x.useEffect(()=>()=>{document.body.style.userSelect="",document.body.style.cursor=""},[]);const J=x.useCallback(le=>{P&&(le.preventDefault(),S.current=le.clientX,I.current=F,O(!0),document.body.style.userSelect="none",document.body.style.cursor="col-resize")},[F,P]),L=x.useCallback(async()=>{const le=m.trim();if(!le||p)return;const oe={id:u2(),role:"user",text:le};_(ae=>[...ae,oe]),y(""),v(!0);try{const ae=await x7(le),he={id:u2(),role:"assistant",text:ae?.text||"",rows:ae?.rows||void 0};_(me=>[...me,he])}catch{_(he=>[...he,{id:u2(),role:"assistant",text:"Error contacting assistant. Please try again."}])}finally{v(!1)}},[m,p]),k=x.useCallback(le=>{le.preventDefault(),L()},[L]);if(!h)return null;function $(le){if(!le||le.length===0)return{};const oe=le[0],ae=Object.keys(oe);let he,me;for(const Q of ae){const G=oe[Q];he===void 0&&(typeof G=="string"||G instanceof Date)&&(he=Q)}for(const Q of ae){const G=oe[Q];if(typeof G=="number"){me=Q;break}me===void 0&&typeof G=="string"&&!isNaN(Number(G))&&(me=Q)}return he||(he=ae.find(Q=>!isNaN(Date.parse(String(oe[Q]))))||ae.find(Q=>typeof oe[Q]=="string")),me||(me=ae.find(Q=>typeof oe[Q]=="number")),{xKey:he,yKey:me}}function X(le,oe,ae){const he=new Map;for(const me of le){const Q=me?.[oe],G=Q==null?"":String(Q),ee=me?.[ae],se=typeof ee=="number"?ee:Number(ee);isFinite(se)&&he.set(G,(he.get(G)||0)+se)}return Array.from(he.entries()).map(([me,Q])=>({[oe]:me,[ae]:Number(Q.toFixed(2))}))}function C(le,oe,ae,he="chart_data"){try{const me=`${oe},${ae}`,Q=le.map(Ge=>{const De=String(Ge[oe]).replace(/"/g,'""'),Fe=Number(Ge[ae]);return`"${De}",${isFinite(Fe)?Fe.toFixed(2):""}`}),G=[me,...Q].join(`
`),ee=new Blob([G],{type:"text/csv;charset=utf-8;"}),se=URL.createObjectURL(ee),V=document.createElement("a");V.href=se,V.download=`${he}.csv`,document.body.appendChild(V),V.click(),document.body.removeChild(V),URL.revokeObjectURL(se)}catch{}}function M(le,oe){if(oe&&Array.isArray(oe)&&oe.length>0){const ae=le.match(/(^|\n)\s*Headline\s*:[^\n]*/i);if(ae)return ae[0].replace(/^\s*/,"").trim();const he=le.split(/\r?\n/)[0]?.trim()??"";return he.length>0?he:""}return le}const H=i.jsxs(Z,{sx:{px:2.5,py:1.75,display:"flex",alignItems:"center",gap:1.5,background:`linear-gradient(135deg, ${mn(A.palette.primary.main,.95)}, ${mn(A.palette.primary.dark,.9)})`,color:A.palette.primary.contrastText},children:[i.jsx(kp,{sx:{bgcolor:mn("#ffffff",.2)},children:i.jsx(f7,{fontSize:"small"})}),i.jsxs(Z,{sx:{flex:1},children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:"Aiven Assistant"}),i.jsx(B,{variant:"caption",sx:{opacity:.85},children:"Your workspace copilot for instant answers"})]}),i.jsx(xr,{size:"small",onClick:r,sx:{color:"inherit"},children:i.jsx(oj,{fontSize:"small"})})]}),U=i.jsxs(Z,{ref:w,sx:{flex:1,px:2.5,py:2,background:`radial-gradient(circle at top right, ${mn(A.palette.primary.light,.14)} 0%, transparent 60%)`,overflowY:"auto"},children:[b.length===0&&i.jsxs(Z,{sx:{textAlign:"center",py:4,px:2,color:"text.secondary"},children:[i.jsx(B,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:"Welcome! Ask anything about your operations."}),i.jsx(B,{variant:"body2",children:"Try Show me overdue tasks for this week or How do I add a purchase order?. This chat clears automatically when you sign out."})]}),b.map(le=>{const oe=le.role==="user",ae=M(le.text,le.rows);return i.jsx(Z,{sx:{mb:2,display:"flex",justifyContent:oe?"flex-end":"flex-start"},children:i.jsxs(Z,{sx:{maxWidth:"80%",px:1.75,py:1.25,borderRadius:3,background:oe?`linear-gradient(135deg, ${A.palette.primary.main}, ${A.palette.primary.dark})`:mn(A.palette.background.paper,.95),color:oe?A.palette.primary.contrastText:A.palette.text.primary,boxShadow:oe?"0 12px 25px rgba(28, 97, 234, 0.35)":`0 8px 16px ${mn(A.palette.common.black,.08)}`,border:oe?"none":`1px solid ${mn(A.palette.primary.main,.15)}`,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[ae?i.jsx(B,{variant:"body2",children:ae}):null,le.rows&&Array.isArray(le.rows)&&le.rows.length>0&&i.jsxs(Z,{sx:{mt:1.5,borderRadius:2,border:`1px solid ${mn(A.palette.primary.main,.2)}`,backgroundColor:mn(A.palette.background.default,.95),overflow:"hidden"},children:[i.jsxs(Z,{sx:{px:1,py:.75,borderBottom:`1px solid ${mn(A.palette.primary.main,.1)}`,backgroundColor:mn(A.palette.primary.light,.1),display:"flex",alignItems:"center",justifyContent:"space-between",gap:1},children:[i.jsx(B,{variant:"caption",sx:{fontWeight:600,letterSpacing:.5},children:"Data preview"}),i.jsx(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:i.jsx(xe,{size:"small",variant:"outlined",startIcon:i.jsx(m7,{fontSize:"small"}),onClick:()=>{R(he=>{const me=he[le.id]||{open:!1},Q=!me.open,G=$(le.rows);return{...he,[le.id]:{open:Q,xKey:me.xKey||G.xKey,yKey:me.yKey||G.yKey,chartType:me.chartType||"bar",showLabels:me.showLabels??!0}}})},children:D[le.id]?.open?"Hide chart":"Visualize"})})]}),i.jsx(Z,{sx:{maxHeight:160,overflow:"auto"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[i.jsx("thead",{children:i.jsx("tr",{children:Object.keys(le.rows[0]).slice(0,6).map(he=>i.jsx("th",{style:{textAlign:"left",padding:"6px 8px",borderBottom:`1px solid ${mn(A.palette.divider,.7)}`,fontWeight:600},children:he},he))})}),i.jsx("tbody",{children:le.rows.slice(0,10).map((he,me)=>i.jsx("tr",{children:Object.keys(le.rows[0]).slice(0,6).map(Q=>i.jsx("td",{style:{padding:"6px 8px",borderBottom:`1px solid ${mn(A.palette.divider,.4)}`},children:String(he[Q])},Q))},me))})]})}),D[le.id]?.open&&i.jsx(Z,{sx:{p:1.25,borderTop:`1px solid ${mn(A.palette.primary.main,.1)}`},children:(()=>{const he=D[le.id]||{},me=le.rows[0],Q=Object.keys(me),G=Q.filter(Xe=>typeof me[Xe]=="number"||!isNaN(Number(me[Xe]))),ee=he.xKey&&Q.includes(he.xKey)?he.xKey:$(le.rows).xKey,se=he.yKey&&Q.includes(he.yKey)?he.yKey:$(le.rows).yKey,V=he.chartType||"bar",Ge=he.showLabels!==!1,De=ee&&se,Fe=De?X(le.rows,ee,se):[];return i.jsxs(i.Fragment,{children:[i.jsxs(Z,{sx:{display:"flex",gap:1.5,mb:1,flexWrap:"wrap",alignItems:"center"},children:[i.jsxs(Pe,{select:!0,size:"small",label:"Chart type",value:V,onChange:Xe=>R(it=>({...it,[le.id]:{...it[le.id]??{},open:!0,chartType:Xe.target.value,xKey:ee,yKey:se}})),SelectProps:{native:!0},sx:{minWidth:140},children:[i.jsx("option",{value:"bar",children:"Bar"}),i.jsx("option",{value:"line",children:"Line"}),i.jsx("option",{value:"pie",children:"Pie"})]}),i.jsxs(Pe,{select:!0,size:"small",label:"X axis",value:ee||"",onChange:Xe=>R(it=>({...it,[le.id]:{...it[le.id]??{},open:!0,xKey:Xe.target.value,yKey:se}})),SelectProps:{native:!0},sx:{minWidth:160},children:[i.jsx("option",{value:"",disabled:!0,children:"Select field"}),Q.map(Xe=>i.jsx("option",{value:Xe,children:Xe},Xe))]}),i.jsxs(Pe,{select:!0,size:"small",label:"Y value",value:se||"",onChange:Xe=>R(it=>({...it,[le.id]:{...it[le.id]??{},open:!0,xKey:ee,yKey:Xe.target.value}})),SelectProps:{native:!0},sx:{minWidth:160},children:[i.jsx("option",{value:"",disabled:!0,children:"Select field"}),G.map(Xe=>i.jsx("option",{value:Xe,children:Xe},Xe))]}),i.jsx(ti,{sx:{ml:.5},control:i.jsx(hl,{size:"small",checked:Ge,onChange:Xe=>R(it=>({...it,[le.id]:{...it[le.id]??{},open:!0,showLabels:Xe.target.checked}}))}),label:"Labels"}),i.jsx(xe,{size:"small",variant:"text",startIcon:i.jsx(y7,{fontSize:"small"}),onClick:()=>Fe&&ee&&se&&C(Fe,ee,se),children:"Download CSV"})]}),De?i.jsx(Z,{sx:{height:260},children:i.jsx(xD,{width:"100%",height:"100%",children:V==="bar"?i.jsxs($L,{data:Fe,layout:"vertical",margin:{left:12,right:16,top:8,bottom:8},children:[i.jsx(cv,{strokeDasharray:"3 3"}),i.jsx(Zc,{type:"number",tick:Ge?{fontSize:11}:!1}),i.jsx(eu,{type:"category",dataKey:ee,width:160,tick:Ge?{fontSize:12}:!1}),i.jsx(xo,{}),Ge&&i.jsx(Ss,{}),i.jsx(yl,{dataKey:se,fill:A.palette.primary.main})]}):V==="line"?i.jsxs(Vre,{data:Fe,margin:{left:8,right:16,top:8,bottom:8},children:[i.jsx(cv,{strokeDasharray:"3 3"}),i.jsx(Zc,{dataKey:ee,interval:0,tick:Ge?{fontSize:11}:!1,height:40}),i.jsx(eu,{tick:Ge?void 0:!1}),i.jsx(xo,{}),Ge&&i.jsx(Ss,{}),i.jsx(zp,{type:"monotone",dataKey:se,stroke:A.palette.primary.main,strokeWidth:2,dot:{r:2}})]}):i.jsxs(Gre,{children:[i.jsx(xo,{}),Ge&&i.jsx(Ss,{}),i.jsx(Sl,{data:Fe,dataKey:se,nameKey:ee,outerRadius:90,children:Fe.map((Xe,it)=>i.jsx(Zv,{fill:A.palette.primary[it%2===0?"main":"light"]},`cell-${it}`))})]})})}):i.jsx(B,{variant:"caption",color:"text.secondary",children:"Pick an x (category/date) and a numeric y field to chart."})]})})()})]})]})},le.id)}),p&&i.jsxs(Z,{sx:{display:"flex",gap:1,alignItems:"center",color:"text.secondary",mt:1},children:[i.jsx(tr,{size:18,thickness:5}),i.jsx(B,{variant:"body2",children:"Aiven is thinking..."})]})]}),te=i.jsxs(Z,{component:"form",onSubmit:k,sx:{p:2,display:"flex",alignItems:"center",gap:1.25,backgroundColor:mn(A.palette.background.paper,.98)},children:[i.jsx(Pe,{fullWidth:!0,size:"small",placeholder:"Ask Aiven anything about your data or workflows...",value:m,onChange:le=>y(le.target.value),InputProps:{sx:{borderRadius:3,backgroundColor:mn(A.palette.background.default,.9),boxShadow:`inset 0 0 0 1px ${mn(A.palette.primary.main,.08)}`}}}),i.jsx(xr,{type:"submit",color:"primary",disabled:p||!m.trim(),sx:{bgcolor:p||!m.trim()?"action.disabledBackground":A.palette.primary.main,color:p||!m.trim()?"text.disabled":A.palette.primary.contrastText,"&:hover":p||!m.trim()?void 0:{bgcolor:A.palette.primary.dark,color:A.palette.primary.contrastText},transition:"background-color 0.2s ease, transform 0.2s ease",transform:p||!m.trim()?"none":"translateY(0)",boxShadow:p||!m.trim()?"none":"0 12px 24px rgba(28, 97, 234, 0.3)"},children:i.jsx(yN,{})})]});return P?i.jsxs(i.Fragment,{children:[!e&&i.jsx(Z,{sx:{position:"fixed",top:`${K}px`,right:`${a}px`,zIndex:1400,display:"flex",justifyContent:"flex-end",alignItems:"flex-start"},children:i.jsx(Z,{onClick:t,role:"button",tabIndex:0,onKeyDown:le=>{(le.key==="Enter"||le.key===" ")&&(le.preventDefault(),t())},sx:{width:44,px:1,py:2,borderTopLeftRadius:16,borderBottomLeftRadius:16,background:`linear-gradient(135deg, ${A.palette.primary.main}, ${A.palette.primary.dark})`,boxShadow:"0 18px 35px rgba(28, 97, 234, 0.35)",color:A.palette.primary.contrastText,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",outline:"none"},children:i.jsx(B,{variant:"button",sx:{writingMode:"vertical-rl",transform:"rotate(180deg)",letterSpacing:1,fontWeight:600},children:"Aiven Assistant"})})}),e&&i.jsxs(Z,{sx:{position:"fixed",top:`${o}px`,right:`${a}px`,zIndex:1500,display:"flex",flexDirection:"row-reverse",alignItems:"stretch",height:z,maxHeight:z,minWidth:`${F+d}px`},children:[i.jsxs(bt,{elevation:0,sx:{width:`${F}px`,height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",borderRadius:0,borderLeft:`1px solid ${mn(A.palette.divider,.7)}`,borderRight:"none",borderTop:"none",borderBottom:"none",boxShadow:"none",backgroundColor:A.palette.background.paper},children:[H,i.jsx(qn,{sx:{borderColor:mn("#fff",.18)}}),U,i.jsx(qn,{}),te]}),i.jsx(Z,{onMouseDown:J,role:"presentation",sx:{width:`${d}px`,cursor:"col-resize",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:mn(A.palette.background.paper,.6),borderTopLeftRadius:12,borderBottomLeftRadius:12,border:`1px solid ${mn(A.palette.primary.main,.15)}`,borderRight:"none",ml:"-1px",height:"100%","&:hover":{backgroundColor:mn(A.palette.primary.main,.12)}},children:i.jsx(Z,{sx:{width:4,height:28,borderRadius:999,backgroundColor:mn(A.palette.text.primary,.3)}})})]})]}):i.jsxs(i.Fragment,{children:[!e&&i.jsx(Hn,{title:"Ask Aiven Assistant",children:i.jsx(c8,{onClick:t,sx:{position:"fixed",bottom:32,right:32,zIndex:1400,background:`linear-gradient(135deg, ${A.palette.primary.main}, ${A.palette.primary.dark})`,color:A.palette.primary.contrastText,boxShadow:"0 18px 35px rgba(28, 97, 234, 0.35)","&:hover":{background:`linear-gradient(135deg, ${A.palette.primary.dark}, ${A.palette.primary.main})`}},children:i.jsx(i7,{})})}),i.jsx(u8,{direction:"left",in:e,mountOnEnter:!0,unmountOnExit:!0,children:i.jsx(Z,{sx:{position:"fixed",top:0,bottom:0,right:0,width:"100%",zIndex:1500,display:"flex",flexDirection:"column"},children:i.jsxs(bt,{elevation:12,sx:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",borderRadius:0,border:`1px solid ${mn(A.palette.primary.main,.2)}`,backgroundColor:mn(A.palette.background.paper,.96),backdropFilter:"blur(10px)"},children:[H,i.jsx(qn,{sx:{borderColor:mn("#fff",.18)}}),U,i.jsx(qn,{}),te]})})})]})},ju=240,UT=360,zT=0,Kre=0,Qre=0,WT=12,HT=280,VT=640,Xre=()=>{const[e,t]=Ce.useState(!1),r=Tn(),n=Ds(),{logout:a,user:o}=ta(),{unreadConversationCount:s}=vN(),[l,c]=x.useState(0),[u,d]=x.useState(!1),[f,h]=x.useState(UT),[p,v]=x.useState(!!window.__backendUnavailableSince),[m,y]=x.useState(typeof navigator<"u"?navigator.onLine===!1:!1);x.useEffect(()=>{let D=!0;const R=async()=>{try{const z=await Sh();D&&c(z)}catch{}},F=setInterval(R,15e3);return R(),()=>{D=!1,clearInterval(F)}},[]),x.useEffect(()=>{const D=()=>y(!0),R=()=>y(!1),F=()=>v(!0),z=()=>v(!1);return window.addEventListener("offline",D),window.addEventListener("online",R),window.addEventListener("backend:unavailable",F),window.addEventListener("backend:available",z),()=>{window.removeEventListener("offline",D),window.removeEventListener("online",R),window.removeEventListener("backend:unavailable",F),window.removeEventListener("backend:available",z)}},[]);const b=()=>{t(!e)},_=()=>{a(),r("/login")},w=D=>"type"in D&&D.type==="header",A=x.useMemo(()=>({text:"Messages",icon:i.jsx(d8,{}),path:"/messaging",showUnreadDot:s>0}),[s]),P=D=>D,T=x.useMemo(()=>[{type:"header",text:"Dashboard"},{text:"Dashboard",icon:i.jsx(L2,{}),path:"/dashboard"},{text:"Tasks",icon:i.jsx(ZS,{}),path:"/tasks"},A,{type:"header",text:"Purchasing"},{text:"Purchase Orders",icon:i.jsx(Bu,{}),path:"/open-purchase-orders"},{text:"Invoice Automator",icon:i.jsx(sg,{}),path:"/invoice-automator"},{text:"Return Orders",icon:i.jsx(lg,{}),path:"/return-orders"},{text:"Parts to Order",icon:i.jsx(ui,{}),path:"/parts-to-order"},{text:"Vendors",icon:i.jsx(xI,{}),path:"/vendors"},{type:"header",text:"Sales"},{text:"Quotes",icon:i.jsx(R2,{}),path:"/quotes"},{text:"Sales Orders",icon:i.jsx(xs,{}),path:"/open-sales-orders"},{text:"Invoices",icon:i.jsx(xs,{}),path:"/invoices"},{text:"Customers",icon:i.jsx(Fh,{}),path:"/customers"},{type:"header",text:"Products & Inventory"},{text:"Products",icon:i.jsx(bI,{}),path:"/products"},{text:"Smart Search",icon:i.jsx(e5,{}),path:"/inventory/smart-search"},{text:"Stock",icon:i.jsx(ui,{}),path:"/inventory"},{text:"Supply",icon:i.jsx(ui,{}),path:"/supply"},{text:"Service",icon:i.jsx(ui,{}),path:"/service"},{type:"header",text:"Time Tracking"},{text:"Attendance",icon:i.jsx(Nc,{}),path:"/attendance"},{text:"Time Tracking",icon:i.jsx(Nc,{}),path:"/time-tracking"},{text:"Time Tracking Reports",icon:i.jsx(_I,{}),path:"/time-tracking/reports"},{type:"header",text:"Human Resources"},{text:"Employees",icon:i.jsx(wI,{}),path:"/employees"},{text:"Profile Documents",icon:i.jsx(f8,{}),path:"/profile-documents"},{text:"Leave Management",icon:i.jsx(jI,{}),path:"/leave-management"},{text:"Mobile User Access",icon:i.jsx(Fh,{}),path:"/mobile-user-access"},{type:"header",text:"Settings"},{text:"Business Profile",icon:i.jsx(Yw,{}),path:"/business-profile"},{text:"Accounting",icon:i.jsx(cg,{}),path:"/qbo-account-mapping"},{text:"Global Variables",icon:i.jsx(cg,{}),path:"/margin-schedule"},{text:"Field Visibility",icon:i.jsx(SI,{}),path:"/field-visibility"},{text:"Email Settings",icon:i.jsx(ug,{}),path:"/email-settings"},{text:"Backup Management",icon:i.jsx(Kw,{}),path:"/backup-management"}],[A]),E=Ce.useMemo(()=>{if(o?.access_role==="Time Tracking")return[{type:"header",text:"Dashboard"},{text:"Attendance",icon:i.jsx(Nc,{}),path:"/attendance"},{text:"Time Tracking",icon:i.jsx(Nc,{}),path:"/time-tracking"},A,{type:"header",text:"Sales"},{text:"Sales Orders",icon:i.jsx(xs,{}),path:"/open-sales-orders"}];const D=[{type:"header",text:"Main"},{text:"Dashboard",icon:i.jsx(L2,{}),path:"/"},{text:"Tasks",icon:i.jsx(ZS,{}),path:"/tasks"},A];return o?.access_role==="Sales and Purchase"?[...D,{type:"header",text:"Sales & Purchase"},{text:"Sales Orders",icon:i.jsx(xs,{}),path:"/open-sales-orders"},{text:"Invoices",icon:i.jsx(xs,{}),path:"/invoices"},{text:"Purchase Orders",icon:i.jsx(Bu,{}),path:"/open-purchase-orders"},{text:"Invoice Automator",icon:i.jsx(sg,{}),path:"/invoice-automator"},{text:"Return Orders",icon:i.jsx(lg,{}),path:"/return-orders"},{text:"Parts to Order",icon:i.jsx(ui,{}),path:"/parts-to-order"},{type:"header",text:"Inventory"},{text:"Smart Search",icon:i.jsx(e5,{}),path:"/inventory/smart-search"},{text:"Stock",icon:i.jsx(ui,{}),path:"/inventory"},{text:"Supply",icon:i.jsx(ui,{}),path:"/supply"},{text:"Service",icon:i.jsx(ui,{}),path:"/service"},{type:"header",text:"Settings"},{text:"Email Settings",icon:i.jsx(ug,{}),path:"/email-settings"}]:T},[o,T,A]),S=i.jsxs("div",{children:[i.jsx(rx,{}),i.jsx(ha,{children:E.map((D,R)=>{if(w(D))return i.jsx(h8,{sx:{bgcolor:"inherit",color:"text.secondary",fontWeight:"bold",fontSize:13,textAlign:"left",pl:2},children:D.text},`header-${D.text}-${R}`);const F=D;return i.jsxs(ja,{onClick:()=>{const z=P(F.path);n.pathname!==z&&r(z),t(!1)},sx:{cursor:"pointer"},children:[i.jsx(p8,{children:F.showUnreadDot?i.jsx(Qw,{color:"error",variant:"dot",overlap:"circular",children:F.icon}):F.icon}),i.jsx(Qn,{primary:F.text,primaryTypographyProps:F.showUnreadDot?{fontWeight:600}:void 0})]},F.path||`${F.text}-${R}`)})})]}),I=f+zT+WT,W=`${I}px`,O=u?`calc(100% - ${ju}px - ${I}px)`:`calc(100% - ${ju}px)`;return i.jsxs(Z,{sx:{display:"flex"},children:[i.jsx(m8,{position:"fixed",sx:{left:{xs:0,sm:`${ju}px`},right:{xs:0,sm:u?W:0},width:{xs:"100%",sm:"auto"},transition:"right 0.2s ease"},children:i.jsxs(rx,{children:[i.jsx(xe,{color:"inherit",startIcon:i.jsx(CI,{}),onClick:()=>r(-1),sx:{mr:2,display:{xs:"none",sm:"inline-flex"}},children:"Back"}),i.jsx(xr,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:b,sx:{mr:2,display:{sm:"none"}},children:i.jsx(g8,{})}),i.jsxs(Z,{sx:{marginLeft:"auto",display:"flex",alignItems:"center",gap:2},children:[(p||m)&&i.jsx(Hn,{title:"We could not reach the server. Check your connection; pending events will sync automatically when back online.",children:i.jsxs(Z,{sx:{bgcolor:"orange",color:"black",px:1.5,py:.5,borderRadius:1,fontSize:12},children:["Offline",l?` - Pending: ${l}`:""]})}),i.jsx(xe,{color:"inherit",onClick:_,startIcon:i.jsx(v8,{}),children:"Logout"})]})]})}),i.jsxs(Z,{component:"nav",sx:{width:{sm:ju},flexShrink:{sm:0}},children:[i.jsx(t5,{variant:"temporary",open:e,onClose:b,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",sm:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:ju}},children:S}),i.jsx(t5,{variant:"permanent",sx:{display:{xs:"none",sm:"block"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:ju}},open:!0,children:S})]}),i.jsxs(Z,{component:"main",sx:{flexGrow:1,p:3,width:{xs:"100%",sm:O},transition:"width 0.2s ease"},children:[i.jsx(rx,{}),i.jsx(Rq,{})]}),i.jsx(Yre,{open:u,onOpen:()=>d(!0),onClose:()=>d(!1),panelWidth:UT,rightOffset:zT,desktopTopOffset:Kre,desktopWidth:f,onDesktopResize:D=>h(Math.min(Math.max(D,HT),VT)),desktopMinWidth:HT,desktopMaxWidth:VT,desktopHandleWidth:WT,desktopBottomOffset:Qre})]})},Jre=()=>{const e=Tn(),{login:t}=ta(),[r,n]=x.useState({email:"",password:""}),[a,o]=x.useState(null),[s,l]=x.useState(null),[c,u]=x.useState(!1),[d,f]=x.useState(!1);x.useEffect(()=>{const v=localStorage.getItem("rememberedEmail"),m=localStorage.getItem("rememberedPassword");v&&m&&(n({email:v,password:m}),f(!0));const y=localStorage.getItem("authRedirectMessage");y&&(l(y),localStorage.removeItem("authRedirectMessage"))},[]);const h=v=>{const{name:m,value:y}=v.target;n(b=>({...b,[m]:y}))},p=async v=>{v.preventDefault(),o(null),l(null),u(!0),d?(localStorage.setItem("rememberedEmail",r.email),localStorage.setItem("rememberedPassword",r.password)):(localStorage.removeItem("rememberedEmail"),localStorage.removeItem("rememberedPassword"));try{const m=await ve.post("/api/auth/login",r),{sessionToken:y,refreshToken:b,user:_}=m.data;t(y,b,_),_.access_role==="Time Tracking"?e("/time-tracking"):_.access_role==="Quotes"?e("/quotes"):e("/")}catch(m){console.error("Login error:",m);try{const y=localStorage.getItem("user"),b=y?JSON.parse(y):null,_=localStorage.getItem("sessionToken"),w=localStorage.getItem("refreshToken");if(b&&b.access_role==="Time Tracking"&&_&&w){e("/time-tracking");return}}catch{}navigator.onLine===!1?o("You appear to be offline. Reconnect to sign in or try again once you have internet."):o(m.response?.data?.message||"Failed to login. Please try again.")}finally{u(!1)}};return i.jsx(rr,{component:"main",maxWidth:"xs",children:i.jsx(Z,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:i.jsxs(bt,{elevation:3,sx:{padding:4,display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[i.jsx(B,{component:"h1",variant:"h5",gutterBottom:!0,children:"Sign In"}),s&&i.jsx(Ot,{severity:"info",sx:{width:"100%",mb:2},children:s}),a&&i.jsx(Ot,{severity:"error",sx:{width:"100%",mb:2},children:a}),i.jsxs(Z,{component:"form",onSubmit:p,sx:{mt:1,width:"100%"},children:[i.jsx(Pe,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:r.email,onChange:h}),i.jsx(Pe,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:r.password,onChange:h}),i.jsx(ti,{control:i.jsx(Qi,{value:"remember",color:"primary",checked:d,onChange:v=>f(v.target.checked)}),label:"Remember me"}),i.jsx(xe,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:c,children:c?"Signing in...":"Sign In"}),i.jsx(Z,{sx:{textAlign:"center"},children:i.jsx(y8,{component:zI,to:"/register",variant:"body2",children:"Don't have an account? Register your company"})})]})]})})})},Zre=()=>{const e=Tn(),{login:t}=ta(),[r,n]=x.useState({companyName:"",adminUsername:"",adminEmail:"",adminPassword:"",confirmPassword:""}),[a,o]=x.useState(null),[s,l]=x.useState(!1),c=d=>{const{name:f,value:h}=d.target;n(p=>({...p,[f]:h}))},u=async d=>{if(d.preventDefault(),o(null),r.adminPassword!==r.confirmPassword){o("Passwords do not match");return}l(!0);try{const f=await ve.post("/api/auth/register-company",{company_name:r.companyName,admin_username:r.adminUsername,admin_email:r.adminEmail,admin_password:r.adminPassword}),{sessionToken:h,refreshToken:p,user:v}=f.data;t(h,p,v),e("/dashboard")}catch(f){console.error("Registration error:",f),o(f.response?.data?.message||"Failed to register company. Please try again.")}finally{l(!1)}};return i.jsx(rr,{component:"main",maxWidth:"sm",children:i.jsx(Z,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:i.jsxs(bt,{elevation:3,sx:{padding:4,display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[i.jsx(B,{component:"h1",variant:"h5",gutterBottom:!0,children:"Register Your Company"}),a&&i.jsx(Ot,{severity:"error",sx:{width:"100%",mb:2},children:a}),i.jsxs(Z,{component:"form",onSubmit:u,sx:{mt:3,width:"100%"},children:[i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{required:!0,fullWidth:!0,label:"Company Name",name:"companyName",value:r.companyName,onChange:c})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{required:!0,fullWidth:!0,label:"Admin Username",name:"adminUsername",value:r.adminUsername,onChange:c})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{required:!0,fullWidth:!0,label:"Admin Email",name:"adminEmail",type:"email",value:r.adminEmail,onChange:c})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{required:!0,fullWidth:!0,label:"Admin Password",name:"adminPassword",type:"password",value:r.adminPassword,onChange:c})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{required:!0,fullWidth:!0,label:"Confirm Password",name:"confirmPassword",type:"password",value:r.confirmPassword,onChange:c})})]}),i.jsx(xe,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:s,children:s?"Registering...":"Register Company"})]})]})})})};var xf={},GT;function ene(){if(GT)return xf;GT=1;var e=sr();Object.defineProperty(xf,"__esModule",{value:!0}),xf.default=void 0;var t=e(cr()),r=lr();return xf.default=(0,t.default)((0,r.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),xf}var tne=ene();const Es=Et(tne);var bf={},YT;function rne(){if(YT)return bf;YT=1;var e=sr();Object.defineProperty(bf,"__esModule",{value:!0}),bf.default=void 0;var t=e(cr()),r=lr();return bf.default=(0,t.default)((0,r.jsx)("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m0 4c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3m6 12H6v-1.4c0-2 4-3.1 6-3.1s6 1.1 6 3.1z"}),"AssignmentInd"),bf}var nne=rne();const ane=Et(nne);var _f={},KT;function ine(){if(KT)return _f;KT=1;var e=sr();Object.defineProperty(_f,"__esModule",{value:!0}),_f.default=void 0;var t=e(cr()),r=lr();return _f.default=(0,t.default)((0,r.jsx)("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 18H4V8h16z"}),"CalendarToday"),_f}var one=ine();const BL=Et(one);var wf={},QT;function sne(){if(QT)return wf;QT=1;var e=sr();Object.defineProperty(wf,"__esModule",{value:!0}),wf.default=void 0;var t=e(cr()),r=lr();return wf.default=(0,t.default)([(0,r.jsx)("path",{d:"M12 5.99 19.53 19H4.47zM12 2 1 21h22z"},"0"),(0,r.jsx)("path",{d:"M13 16h-2v2h2zm0-6h-2v5h2z"},"1")],"WarningAmber"),wf}var lne=sne();const UL=Et(lne);var jf={},XT;function cne(){if(XT)return jf;XT=1;var e=sr();Object.defineProperty(jf,"__esModule",{value:!0}),jf.default=void 0;var t=e(cr()),r=lr();return jf.default=(0,t.default)((0,r.jsx)("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-6 15h-2v-2h2zm0-4h-2V8h2zm-1-9c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"}),"AssignmentLate"),jf}var une=cne();const dne=Et(une);var Sf={},JT;function fne(){if(JT)return Sf;JT=1;var e=sr();Object.defineProperty(Sf,"__esModule",{value:!0}),Sf.default=void 0;var t=e(cr()),r=lr();return Sf.default=(0,t.default)((0,r.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"ReportProblem"),Sf}var hne=fne();const pne=Et(hne),mne=[{key:"myOpen",label:"My open tasks",icon:i.jsx(ane,{fontSize:"large"}),palette:"info"},{key:"myDueToday",label:"My tasks due today",icon:i.jsx(BL,{fontSize:"large"}),palette:"warning"},{key:"myOverdue",label:"My overdue tasks",icon:i.jsx(UL,{fontSize:"large"}),palette:"error"},{key:"assignedByMeOverdue",label:"Overdue tasks I assigned",icon:i.jsx(dne,{fontSize:"large"}),palette:"secondary"},{key:"allOverdue",label:"All overdue tasks",icon:i.jsx(pne,{fontSize:"large"}),palette:"error"}],zL=({summary:e,loading:t,onRefresh:r,onViewTasks:n})=>{const a=e?.total??0;return i.jsxs(qr,{sx:{borderRadius:3,overflow:"hidden",position:"relative",boxShadow:"0 24px 60px -32px rgba(15, 23, 42, 0.45)"},children:[i.jsx(Z,{sx:{position:"absolute",inset:0,background:"linear-gradient(140deg, rgba(59, 130, 246, 0.12) 0%, rgba(99, 102, 241, 0.08) 45%, rgba(168, 85, 247, 0.05) 100%)",pointerEvents:"none"}}),i.jsxs(Wr,{sx:{position:"relative",p:{xs:3,md:4}},children:[i.jsxs(dt,{direction:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},spacing:3,children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"overline",color:"text.secondary",sx:{letterSpacing:1.2},children:"Team workload snapshot"}),i.jsx(B,{variant:"h4",sx:{fontWeight:600},children:"Task overview"}),i.jsxs(B,{variant:"body1",color:"text.secondary",sx:{mt:.5},children:["Tracking ",i.jsx("strong",{children:a})," task",a===1?"":"s"," across your workspace."]})]}),i.jsxs(dt,{direction:{xs:"column",sm:"row"},spacing:1.5,width:{xs:"100%",sm:"auto"},children:[r&&i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Es,{}),onClick:r,disabled:t,sx:{width:{xs:"100%",sm:"auto"}},children:"Refresh"}),n&&i.jsx(xe,{variant:"contained",onClick:n,sx:{width:{xs:"100%",sm:"auto"}},children:"View tasks"})]})]}),i.jsx(Z,{sx:{mt:4},children:t?i.jsx(Z,{display:"flex",justifyContent:"center",py:4,children:i.jsx(tr,{})}):e?i.jsx(Z,{sx:{display:"grid",gap:2.5,gridTemplateColumns:{xs:"repeat(1, minmax(0, 1fr))",sm:"repeat(2, minmax(0, 1fr))",md:"repeat(3, minmax(0, 1fr))",lg:"repeat(5, minmax(0, 1fr))"}},children:mne.map(o=>i.jsxs(Z,{sx:s=>({borderRadius:3,p:3,display:"flex",flexDirection:"column",gap:1,border:`1px solid ${mn(s.palette[o.palette].main,.28)}`,background:`linear-gradient(135deg, ${mn(s.palette[o.palette].main,.18)} 0%, ${mn(s.palette[o.palette].main,.06)} 100%)`,boxShadow:`0 12px 30px -20px ${mn(s.palette[o.palette].main,.6)}`,color:s.palette.text.primary}),children:[i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:1.25},children:[i.jsx(Z,{sx:s=>({display:"inline-flex",alignItems:"center",justifyContent:"center",width:40,height:40,borderRadius:"50%",backgroundColor:mn(s.palette[o.palette].main,.2),color:s.palette[o.palette].dark}),children:o.icon}),i.jsx(B,{variant:"subtitle2",color:"text.secondary",children:o.label})]}),i.jsx(B,{variant:"h4",sx:{fontWeight:600},children:e[o.key]??0})]},o.key))}):i.jsx(B,{variant:"body2",color:"text.secondary",children:"Task data is not available yet. Create your first task to populate this overview."})})]})]})},gne=e=>{if(!e)return{};const t={};return e.status&&e.status.length>0&&(t.status=e.status.join(",")),typeof e.assignedTo=="number"&&(t.assignedTo=String(e.assignedTo)),e.dueFrom&&(t.dueFrom=e.dueFrom),e.dueTo&&(t.dueTo=e.dueTo),e.search&&(t.search=e.search.trim()),typeof e.includeCompleted=="boolean"&&(t.includeCompleted=String(e.includeCompleted)),typeof e.includeArchived=="boolean"&&(t.includeArchived=String(e.includeArchived)),t},vne=async e=>(await ve.get("/api/tasks",{params:gne(e)})).data.tasks,yne=async e=>(await ve.get(`/api/tasks/${e}/overview`)).data,xne=async e=>(await ve.post("/api/tasks",e)).data,bne=async(e,t)=>(await ve.put(`/api/tasks/${e}`,t)).data,_ne=async(e,t)=>(await ve.patch(`/api/tasks/${e}/assignments`,{assigneeIds:t})).data,wne=async(e,t)=>(await ve.patch(`/api/tasks/${e}/complete`,{completed:t})).data,jne=async(e,t)=>(await ve.post(`/api/tasks/${e}/notes`,{note:t})).data,Sne=async e=>{await ve.delete(`/api/tasks/${e}`)},vw=async()=>(await ve.get("/api/tasks/summary")).data,Cne=async()=>(await ve.get("/api/tasks/assignees")).data.assignees,Ane={Purchasing:i.jsx(Bu,{sx:{color:"primary.main"}}),Sales:i.jsx(xs,{sx:{color:"primary.main"}}),"Products & Inventory":i.jsx(ui,{sx:{color:"primary.main"}}),"Time Tracking":i.jsx(Nc,{sx:{color:"primary.main"}}),"Human Resources":i.jsx(Fh,{sx:{color:"primary.main"}}),Settings:i.jsx(Yw,{sx:{color:"primary.main"}})},ZT=()=>{const e=Tn(),t=yI(),{user:r}=ta(),[n,a]=x.useState(null),[o,s]=x.useState(!1),l=x.useCallback(async()=>{s(!0);try{const d=await vw();a(d)}catch(d){console.error("Failed to load task summary",d)}finally{s(!1)}},[]);x.useEffect(()=>{l()},[l]),console.log("[LandingPage] user:",r);let u=[{title:"Purchasing",items:[{title:"Purchase Orders",description:"Manage purchase orders",icon:i.jsx(Bu,{sx:{fontSize:40,color:"primary.main"}}),path:"/open-purchase-orders"},{title:"Invoice Automator",description:"Create purchase orders from invoice emails",icon:i.jsx(sg,{sx:{fontSize:40,color:"primary.main"}}),path:"/invoice-automator"},{title:"Return Orders",description:"Track vendor returns tied to POs",icon:i.jsx(lg,{sx:{fontSize:40,color:"primary.main"}}),path:"/return-orders"},{title:"Parts to Order",description:"Manage parts ordering",icon:i.jsx(ui,{sx:{fontSize:40,color:"primary.main"}}),path:"/parts-to-order"},{title:"Vendors",description:"Manage your vendors",icon:i.jsx(xI,{sx:{fontSize:40,color:"primary.main"}}),path:"/vendors"}]},{title:"Sales",items:[{title:"Quotes",description:"Manage and track quotes",icon:i.jsx(R2,{sx:{fontSize:40,color:"primary.main"}}),path:"/quotes"},{title:"Sales Orders",description:"Manage sales orders",icon:i.jsx(xs,{sx:{fontSize:40,color:"primary.main"}}),path:"/open-sales-orders"},{title:"Invoices",description:"Track and edit invoices",icon:i.jsx(xs,{sx:{fontSize:40,color:"primary.main"}}),path:"/invoices"},{title:"Customers",description:"Track and manage your customer relationships",icon:i.jsx(Fh,{sx:{fontSize:40,color:"primary.main"}}),path:"/customers"}]},{title:"Products & Inventory",items:[{title:"Products",description:"Manage your products",icon:i.jsx(bI,{sx:{fontSize:40,color:"primary.main"}}),path:"/products"},{title:"Stock",description:"Manage your product inventory and stock levels",icon:i.jsx(ui,{sx:{fontSize:40,color:"primary.main"}}),path:"/inventory"},{title:"Supply",description:"Manage supply and materials",icon:i.jsx(ui,{sx:{fontSize:40,color:"primary.main"}}),path:"/supply"},{title:"Service",description:"Manage service line items",icon:i.jsx(ui,{sx:{fontSize:40,color:"primary.main"}}),path:"/service"}]},{title:"Time Tracking",items:[{title:"Attendance",description:"View and manage attendance records",icon:i.jsx(Nc,{sx:{fontSize:40,color:"primary.main"}}),path:"/attendance"},{title:"Time Tracking",description:"Track employee time and project hours",icon:i.jsx(Nc,{sx:{fontSize:40,color:"primary.main"}}),path:"/time-tracking"},{title:"Time Tracking Reports",description:"View and export time tracking reports",icon:i.jsx(_I,{sx:{fontSize:40,color:"primary.main"}}),path:"/time-tracking/reports"}]},{title:"Human Resources",items:[{title:"Employees",description:"Manage employee accounts and roles",icon:i.jsx(wI,{sx:{fontSize:40,color:"primary.main"}}),path:"/employees"},{title:"Profile Documents",description:"Manage and track employee document access and read status",icon:i.jsx(Bu,{sx:{fontSize:40,color:"primary.main"}}),path:"/profile-documents"},{title:"Leave Management",description:"Manage employee leave requests and approvals",icon:i.jsx(jI,{sx:{fontSize:40,color:"primary.main"}}),path:"/leave-management"},{title:"Mobile User Access",description:"Manage mobile user access to profiles",icon:i.jsx(Fh,{sx:{fontSize:40,color:"primary.main"}}),path:"/mobile-user-access"}]},{title:"Settings",items:[{title:"Business Profile",description:"Manage your company information and settings",icon:i.jsx(Yw,{sx:{fontSize:40,color:"primary.main"}}),path:"/business-profile"},{title:"Accounting",description:"Configure QuickBooks account mappings",icon:i.jsx(cg,{sx:{fontSize:40,color:"primary.main"}}),path:"/qbo-account-mapping"},{title:"Global Variables",description:"Set and manage margin, labour, and overhead rates",icon:i.jsx(cg,{sx:{fontSize:40,color:"primary.main"}}),path:"/margin-schedule"},{title:"Email Settings",description:"Configure system email settings",icon:i.jsx(ug,{sx:{fontSize:40,color:"primary.main"}}),path:"/email-settings"},{title:"Backup Management",description:"Manage system backups and restores",icon:i.jsx(Kw,{sx:{fontSize:40,color:"primary.main"}}),path:"/backup-management"}]}];return r?.access_role==="Sales and Purchase"&&(u=[{title:"Sales & Purchase",items:[{title:"Sales Orders",description:"Manage sales orders",icon:i.jsx(xs,{sx:{fontSize:40,color:"primary.main"}}),path:"/open-sales-orders"},{title:"Invoices",description:"Track and edit invoices",icon:i.jsx(xs,{sx:{fontSize:40,color:"primary.main"}}),path:"/invoices"},{title:"Purchase Orders",description:"Manage purchase orders",icon:i.jsx(Bu,{sx:{fontSize:40,color:"primary.main"}}),path:"/open-purchase-orders"},{title:"Invoice Automator",description:"Create purchase orders from invoice emails",icon:i.jsx(sg,{sx:{fontSize:40,color:"primary.main"}}),path:"/invoice-automator"},{title:"Return Orders",description:"Track vendor returns tied to POs",icon:i.jsx(lg,{sx:{fontSize:40,color:"primary.main"}}),path:"/return-orders"},{title:"Parts to Order",description:"View parts that need to be ordered",icon:i.jsx(ui,{sx:{fontSize:40,color:"primary.main"}}),path:"/parts-to-order"}]},{title:"Inventory",items:[{title:"Stock",description:"Manage your product inventory and stock levels",icon:i.jsx(ui,{sx:{fontSize:40,color:"primary.main"}}),path:"/inventory"},{title:"Supply",description:"Manage supply and materials",icon:i.jsx(ui,{sx:{fontSize:40,color:"primary.main"}}),path:"/supply"},{title:"Service",description:"Manage service line items",icon:i.jsx(ui,{sx:{fontSize:40,color:"primary.main"}}),path:"/service"}]},{title:"Settings",items:[{title:"Email Settings",description:"Configure your email settings",icon:i.jsx(ug,{sx:{fontSize:40,color:"primary.main"}}),path:"/email-settings"}]}]),r?.access_role==="Quotes"&&(u=[{title:"Quotes",items:[{title:"Quotes",description:"Manage and track quotes",icon:i.jsx(R2,{sx:{fontSize:40,color:"primary.main"}}),path:"/quotes"}]}]),console.log("[LandingPage] filteredSections:",u),i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{background:`linear-gradient(90deg, ${t.palette.primary.main} 0%, ${t.palette.secondary.main} 100%)`,borderRadius:3,p:4,mb:6,color:t.palette.primary.contrastText,boxShadow:3,textAlign:"center"},children:[i.jsx(B,{variant:"h3",component:"h1",gutterBottom:!0,sx:{color:"inherit"},children:"Welcome to Aiven"}),i.jsx(B,{variant:"h5",component:"h2",gutterBottom:!0,sx:{color:"inherit",opacity:.85},children:"Your all-in-one business management solution"})]}),i.jsx(Z,{sx:{mb:6},children:i.jsx(zL,{summary:n,loading:o,onRefresh:l,onViewTasks:()=>e("/tasks")})}),u.map((d,f)=>i.jsx(r5,{in:!0,timeout:700+f*200,children:i.jsxs(Z,{sx:{mt:6,mb:4,p:3,borderRadius:3,background:t.palette.mode==="light"?t.palette.grey[50]:t.palette.grey[900],boxShadow:1},children:[i.jsxs(Z,{sx:{display:"flex",alignItems:"center",mb:2},children:[i.jsx(kp,{sx:{bgcolor:"primary.main",mr:2},children:Ane[d.title]||i.jsx(L2,{sx:{color:"primary.main"}})}),i.jsx(B,{variant:"h4",component:"h2",sx:{color:"primary.main",fontWeight:600},children:d.title})]}),i.jsx(ie,{container:!0,spacing:4,children:d.items.map((h,p)=>i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(r5,{in:!0,timeout:900+p*150,children:i.jsx(qr,{sx:{height:"100%",display:"flex",flexDirection:"column",borderRadius:2,boxShadow:2,transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-6px) scale(1.03)",boxShadow:6,cursor:"pointer"},bgcolor:"background.paper"},onClick:()=>e(h.path),tabIndex:0,role:"button","aria-label":h.title,children:i.jsxs(Wr,{sx:{flexGrow:1,textAlign:"center"},children:[h.icon,i.jsx(B,{gutterBottom:!0,variant:"h5",component:"h2",children:h.title}),i.jsx(B,{children:h.description})]})})})},p))}),f<u.length-1&&i.jsx(qn,{sx:{mt:4,mb:2}})]})},d.title))]})};var Cf={},e4;function Pne(){if(e4)return Cf;e4=1;var e=sr();Object.defineProperty(Cf,"__esModule",{value:!0}),Cf.default=void 0;var t=e(cr()),r=lr();return Cf.default=(0,t.default)((0,r.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),Cf}var One=Pne();const ma=Et(One);var Af={},t4;function kne(){if(t4)return Af;t4=1;var e=sr();Object.defineProperty(Af,"__esModule",{value:!0}),Af.default=void 0;var t=e(cr()),r=lr();return Af.default=(0,t.default)((0,r.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),Af}var Tne=kne();const Cp=Et(Tne);var Pf={},r4;function Ene(){if(r4)return Pf;r4=1;var e=sr();Object.defineProperty(Pf,"__esModule",{value:!0}),Pf.default=void 0;var t=e(cr()),r=lr();return Pf.default=(0,t.default)((0,r.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),Pf}var Ine=Ene();const tu=Et(Ine),Ap=e=>typeof e=="number"&&!isNaN(e),Uc=e=>typeof e=="string",jo=e=>typeof e=="function",Qm=e=>Uc(e)||jo(e)?e:null,yw=e=>x.isValidElement(e)||Uc(e)||jo(e)||Ap(e);function Nne(e,t,r){r===void 0&&(r=300);const{scrollHeight:n,style:a}=e;requestAnimationFrame(()=>{a.minHeight="initial",a.height=n+"px",a.transition=`all ${r}ms`,requestAnimationFrame(()=>{a.height="0",a.padding="0",a.margin="0",setTimeout(t,r)})})}function Sy(e){let{enter:t,exit:r,appendPosition:n=!1,collapse:a=!0,collapseDuration:o=300}=e;return function(s){let{children:l,position:c,preventExitTransition:u,done:d,nodeRef:f,isIn:h,playToast:p}=s;const v=n?`${t}--${c}`:t,m=n?`${r}--${c}`:r,y=x.useRef(0);return x.useLayoutEffect(()=>{const b=f.current,_=v.split(" "),w=A=>{A.target===f.current&&(p(),b.removeEventListener("animationend",w),b.removeEventListener("animationcancel",w),y.current===0&&A.type!=="animationcancel"&&b.classList.remove(..._))};b.classList.add(..._),b.addEventListener("animationend",w),b.addEventListener("animationcancel",w)},[]),x.useEffect(()=>{const b=f.current,_=()=>{b.removeEventListener("animationend",_),a?Nne(b,d,o):d()};h||(u?_():(y.current=1,b.className+=` ${m}`,b.addEventListener("animationend",_)))},[h]),Ce.createElement(Ce.Fragment,null,l)}}function n4(e,t){return e!=null?{content:e.content,containerId:e.props.containerId,id:e.props.toastId,theme:e.props.theme,type:e.props.type,data:e.props.data||{},isLoading:e.props.isLoading,icon:e.props.icon,status:t}:{}}const Di=new Map;let Pp=[];const xw=new Set,Dne=e=>xw.forEach(t=>t(e)),WL=()=>Di.size>0;function HL(e,t){var r;if(t)return!((r=Di.get(t))==null||!r.isToastActive(e));let n=!1;return Di.forEach(a=>{a.isToastActive(e)&&(n=!0)}),n}function VL(e,t){yw(e)&&(WL()||Pp.push({content:e,options:t}),Di.forEach(r=>{r.buildToast(e,t)}))}function a4(e,t){Di.forEach(r=>{t!=null&&t!=null&&t.containerId?t?.containerId===r.id&&r.toggle(e,t?.id):r.toggle(e,t?.id)})}function Mne(e){const{subscribe:t,getSnapshot:r,setProps:n}=x.useRef(function(o){const s=o.containerId||1;return{subscribe(l){const c=function(d,f,h){let p=1,v=0,m=[],y=[],b=[],_=f;const w=new Map,A=new Set,P=()=>{b=Array.from(w.values()),A.forEach(S=>S())},T=S=>{y=S==null?[]:y.filter(I=>I!==S),P()},E=S=>{const{toastId:I,onOpen:W,updateId:O,children:D}=S.props,R=O==null;S.staleId&&w.delete(S.staleId),w.set(I,S),y=[...y,S.props.toastId].filter(F=>F!==S.staleId),P(),h(n4(S,R?"added":"updated")),R&&jo(W)&&W(x.isValidElement(D)&&D.props)};return{id:d,props:_,observe:S=>(A.add(S),()=>A.delete(S)),toggle:(S,I)=>{w.forEach(W=>{I!=null&&I!==W.props.toastId||jo(W.toggle)&&W.toggle(S)})},removeToast:T,toasts:w,clearQueue:()=>{v-=m.length,m=[]},buildToast:(S,I)=>{if((C=>{let{containerId:M,toastId:H,updateId:U}=C;const te=M?M!==d:d!==1,le=w.has(H)&&U==null;return te||le})(I))return;const{toastId:W,updateId:O,data:D,staleId:R,delay:F}=I,z=()=>{T(W)},K=O==null;K&&v++;const J={..._,style:_.toastStyle,key:p++,...Object.fromEntries(Object.entries(I).filter(C=>{let[M,H]=C;return H!=null})),toastId:W,updateId:O,data:D,closeToast:z,isIn:!1,className:Qm(I.className||_.toastClassName),bodyClassName:Qm(I.bodyClassName||_.bodyClassName),progressClassName:Qm(I.progressClassName||_.progressClassName),autoClose:!I.isLoading&&(L=I.autoClose,k=_.autoClose,L===!1||Ap(L)&&L>0?L:k),deleteToast(){const C=w.get(W),{onClose:M,children:H}=C.props;jo(M)&&M(x.isValidElement(H)&&H.props),h(n4(C,"removed")),w.delete(W),v--,v<0&&(v=0),m.length>0?E(m.shift()):P()}};var L,k;J.closeButton=_.closeButton,I.closeButton===!1||yw(I.closeButton)?J.closeButton=I.closeButton:I.closeButton===!0&&(J.closeButton=!yw(_.closeButton)||_.closeButton);let $=S;x.isValidElement(S)&&!Uc(S.type)?$=x.cloneElement(S,{closeToast:z,toastProps:J,data:D}):jo(S)&&($=S({closeToast:z,toastProps:J,data:D}));const X={content:$,props:J,staleId:R};_.limit&&_.limit>0&&v>_.limit&&K?m.push(X):Ap(F)?setTimeout(()=>{E(X)},F):E(X)},setProps(S){_=S},setToggle:(S,I)=>{w.get(S).toggle=I},isToastActive:S=>y.some(I=>I===S),getSnapshot:()=>b}}(s,o,Dne);Di.set(s,c);const u=c.observe(l);return Pp.forEach(d=>VL(d.content,d.options)),Pp=[],()=>{u(),Di.delete(s)}},setProps(l){var c;(c=Di.get(s))==null||c.setProps(l)},getSnapshot(){var l;return(l=Di.get(s))==null?void 0:l.getSnapshot()}}}(e)).current;n(e);const a=x.useSyncExternalStore(t,r,r);return{getToastToRender:function(o){if(!a)return[];const s=new Map;return e.newestOnTop&&a.reverse(),a.forEach(l=>{const{position:c}=l.props;s.has(c)||s.set(c,[]),s.get(c).push(l)}),Array.from(s,l=>o(l[0],l[1]))},isToastActive:HL,count:a?.length}}function Lne(e){const[t,r]=x.useState(!1),[n,a]=x.useState(!1),o=x.useRef(null),s=x.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:l,pauseOnHover:c,closeToast:u,onClick:d,closeOnClick:f}=e;var h,p;function v(){r(!0)}function m(){r(!1)}function y(w){const A=o.current;s.canDrag&&A&&(s.didMove=!0,t&&m(),s.delta=e.draggableDirection==="x"?w.clientX-s.start:w.clientY-s.start,s.start!==w.clientX&&(s.canCloseOnClick=!1),A.style.transform=`translate3d(${e.draggableDirection==="x"?`${s.delta}px, var(--y)`:`0, calc(${s.delta}px + var(--y))`},0)`,A.style.opacity=""+(1-Math.abs(s.delta/s.removalDistance)))}function b(){document.removeEventListener("pointermove",y),document.removeEventListener("pointerup",b);const w=o.current;if(s.canDrag&&s.didMove&&w){if(s.canDrag=!1,Math.abs(s.delta)>s.removalDistance)return a(!0),e.closeToast(),void e.collapseAll();w.style.transition="transform 0.2s, opacity 0.2s",w.style.removeProperty("transform"),w.style.removeProperty("opacity")}}(p=Di.get((h={id:e.toastId,containerId:e.containerId,fn:r}).containerId||1))==null||p.setToggle(h.id,h.fn),x.useEffect(()=>{if(e.pauseOnFocusLoss)return document.hasFocus()||m(),window.addEventListener("focus",v),window.addEventListener("blur",m),()=>{window.removeEventListener("focus",v),window.removeEventListener("blur",m)}},[e.pauseOnFocusLoss]);const _={onPointerDown:function(w){if(e.draggable===!0||e.draggable===w.pointerType){s.didMove=!1,document.addEventListener("pointermove",y),document.addEventListener("pointerup",b);const A=o.current;s.canCloseOnClick=!0,s.canDrag=!0,A.style.transition="none",e.draggableDirection==="x"?(s.start=w.clientX,s.removalDistance=A.offsetWidth*(e.draggablePercent/100)):(s.start=w.clientY,s.removalDistance=A.offsetHeight*(e.draggablePercent===80?1.5*e.draggablePercent:e.draggablePercent)/100)}},onPointerUp:function(w){const{top:A,bottom:P,left:T,right:E}=o.current.getBoundingClientRect();w.nativeEvent.type!=="touchend"&&e.pauseOnHover&&w.clientX>=T&&w.clientX<=E&&w.clientY>=A&&w.clientY<=P?m():v()}};return l&&c&&(_.onMouseEnter=m,e.stacked||(_.onMouseLeave=v)),f&&(_.onClick=w=>{d&&d(w),s.canCloseOnClick&&u()}),{playToast:v,pauseToast:m,isRunning:t,preventExitTransition:n,toastRef:o,eventHandlers:_}}function Rne(e){let{delay:t,isRunning:r,closeToast:n,type:a="default",hide:o,className:s,style:l,controlledProgress:c,progress:u,rtl:d,isIn:f,theme:h}=e;const p=o||c&&u===0,v={...l,animationDuration:`${t}ms`,animationPlayState:r?"running":"paused"};c&&(v.transform=`scaleX(${u})`);const m=Tr("Toastify__progress-bar",c?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${h}`,`Toastify__progress-bar--${a}`,{"Toastify__progress-bar--rtl":d}),y=jo(s)?s({rtl:d,type:a,defaultClassName:m}):Tr(m,s),b={[c&&u>=1?"onTransitionEnd":"onAnimationEnd"]:c&&u<1?null:()=>{f&&n()}};return Ce.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":p},Ce.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${h} Toastify__progress-bar--${a}`}),Ce.createElement("div",{role:"progressbar","aria-hidden":p?"true":"false","aria-label":"notification timer",className:y,style:v,...b}))}let qne=1;const GL=()=>""+qne++;function Fne(e){return e&&(Uc(e.toastId)||Ap(e.toastId))?e.toastId:GL()}function Lh(e,t){return VL(e,t),t.toastId}function pv(e,t){return{...t,type:t&&t.type||e,toastId:Fne(t)}}function km(e){return(t,r)=>Lh(t,pv(e,r))}function ge(e,t){return Lh(e,pv("default",t))}ge.loading=(e,t)=>Lh(e,pv("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...t})),ge.promise=function(e,t,r){let n,{pending:a,error:o,success:s}=t;a&&(n=Uc(a)?ge.loading(a,r):ge.loading(a.render,{...r,...a}));const l={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},c=(d,f,h)=>{if(f==null)return void ge.dismiss(n);const p={type:d,...l,...r,data:h},v=Uc(f)?{render:f}:f;return n?ge.update(n,{...p,...v}):ge(v.render,{...p,...v}),h},u=jo(e)?e():e;return u.then(d=>c("success",s,d)).catch(d=>c("error",o,d)),u},ge.success=km("success"),ge.info=km("info"),ge.error=km("error"),ge.warning=km("warning"),ge.warn=ge.warning,ge.dark=(e,t)=>Lh(e,pv("default",{theme:"dark",...t})),ge.dismiss=function(e){(function(t){var r;if(WL()){if(t==null||Uc(r=t)||Ap(r))Di.forEach(n=>{n.removeToast(t)});else if(t&&("containerId"in t||"id"in t)){const n=Di.get(t.containerId);n?n.removeToast(t.id):Di.forEach(a=>{a.removeToast(t.id)})}}else Pp=Pp.filter(n=>t!=null&&n.options.toastId!==t)})(e)},ge.clearWaitingQueue=function(e){e===void 0&&(e={}),Di.forEach(t=>{!t.props.limit||e.containerId&&t.id!==e.containerId||t.clearQueue()})},ge.isActive=HL,ge.update=function(e,t){t===void 0&&(t={});const r=((n,a)=>{var o;let{containerId:s}=a;return(o=Di.get(s||1))==null?void 0:o.toasts.get(n)})(e,t);if(r){const{props:n,content:a}=r,o={delay:100,...n,...t,toastId:t.toastId||e,updateId:GL()};o.toastId!==e&&(o.staleId=e);const s=o.render||a;delete o.render,Lh(s,o)}},ge.done=e=>{ge.update(e,{progress:1})},ge.onChange=function(e){return xw.add(e),()=>{xw.delete(e)}},ge.play=e=>a4(!0,e),ge.pause=e=>a4(!1,e);const $ne=typeof window<"u"?x.useLayoutEffect:x.useEffect,Tm=e=>{let{theme:t,type:r,isLoading:n,...a}=e;return Ce.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:t==="colored"?"currentColor":`var(--toastify-icon-color-${r})`,...a})},d2={info:function(e){return Ce.createElement(Tm,{...e},Ce.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(e){return Ce.createElement(Tm,{...e},Ce.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(e){return Ce.createElement(Tm,{...e},Ce.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(e){return Ce.createElement(Tm,{...e},Ce.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return Ce.createElement("div",{className:"Toastify__spinner"})}},Bne=e=>{const{isRunning:t,preventExitTransition:r,toastRef:n,eventHandlers:a,playToast:o}=Lne(e),{closeButton:s,children:l,autoClose:c,onClick:u,type:d,hideProgressBar:f,closeToast:h,transition:p,position:v,className:m,style:y,bodyClassName:b,bodyStyle:_,progressClassName:w,progressStyle:A,updateId:P,role:T,progress:E,rtl:S,toastId:I,deleteToast:W,isIn:O,isLoading:D,closeOnClick:R,theme:F}=e,z=Tr("Toastify__toast",`Toastify__toast-theme--${F}`,`Toastify__toast--${d}`,{"Toastify__toast--rtl":S},{"Toastify__toast--close-on-click":R}),K=jo(m)?m({rtl:S,position:v,type:d,defaultClassName:z}):Tr(z,m),J=function(X){let{theme:C,type:M,isLoading:H,icon:U}=X,te=null;const le={theme:C,type:M};return U===!1||(jo(U)?te=U({...le,isLoading:H}):x.isValidElement(U)?te=x.cloneElement(U,le):H?te=d2.spinner():(oe=>oe in d2)(M)&&(te=d2[M](le))),te}(e),L=!!E||!c,k={closeToast:h,type:d,theme:F};let $=null;return s===!1||($=jo(s)?s(k):x.isValidElement(s)?x.cloneElement(s,k):function(X){let{closeToast:C,theme:M,ariaLabel:H="close"}=X;return Ce.createElement("button",{className:`Toastify__close-button Toastify__close-button--${M}`,type:"button",onClick:U=>{U.stopPropagation(),C(U)},"aria-label":H},Ce.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},Ce.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}(k)),Ce.createElement(p,{isIn:O,done:W,position:v,preventExitTransition:r,nodeRef:n,playToast:o},Ce.createElement("div",{id:I,onClick:u,"data-in":O,className:K,...a,style:y,ref:n},Ce.createElement("div",{...O&&{role:T},className:jo(b)?b({type:d}):Tr("Toastify__toast-body",b),style:_},J!=null&&Ce.createElement("div",{className:Tr("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!D})},J),Ce.createElement("div",null,l)),$,Ce.createElement(Rne,{...P&&!L?{key:`pb-${P}`}:{},rtl:S,theme:F,delay:c,isRunning:t,isIn:O,closeToast:h,hide:f,type:d,style:A,className:w,controlledProgress:L,progress:E||0})))},Cy=function(e,t){return t===void 0&&(t=!1),{enter:`Toastify--animate Toastify__${e}-enter`,exit:`Toastify--animate Toastify__${e}-exit`,appendPosition:t}},Une=Sy(Cy("bounce",!0));Sy(Cy("slide",!0));Sy(Cy("zoom"));Sy(Cy("flip"));const zne={position:"top-right",transition:Une,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"};function Wne(e){let t={...zne,...e};const r=e.stacked,[n,a]=x.useState(!0),o=x.useRef(null),{getToastToRender:s,isToastActive:l,count:c}=Mne(t),{className:u,style:d,rtl:f,containerId:h}=t;function p(m){const y=Tr("Toastify__toast-container",`Toastify__toast-container--${m}`,{"Toastify__toast-container--rtl":f});return jo(u)?u({position:m,rtl:f,defaultClassName:y}):Tr(y,Qm(u))}function v(){r&&(a(!0),ge.play())}return $ne(()=>{if(r){var m;const y=o.current.querySelectorAll('[data-in="true"]'),b=12,_=(m=t.position)==null?void 0:m.includes("top");let w=0,A=0;Array.from(y).reverse().forEach((P,T)=>{const E=P;E.classList.add("Toastify__toast--stacked"),T>0&&(E.dataset.collapsed=`${n}`),E.dataset.pos||(E.dataset.pos=_?"top":"bot");const S=w*(n?.2:1)+(n?0:b*T);E.style.setProperty("--y",`${_?S:-1*S}px`),E.style.setProperty("--g",`${b}`),E.style.setProperty("--s",""+(1-(n?A:0))),w+=E.offsetHeight,A+=.025})}},[n,c,r]),Ce.createElement("div",{ref:o,className:"Toastify",id:h,onMouseEnter:()=>{r&&(a(!1),ge.pause())},onMouseLeave:v},s((m,y)=>{const b=y.length?{...d}:{...d,pointerEvents:"none"};return Ce.createElement("div",{className:p(m),style:b,key:`container-${m}`},y.map(_=>{let{content:w,props:A}=_;return Ce.createElement(Bne,{...A,stacked:r,collapseAll:v,isIn:l(A.toastId,A.containerId),style:A.style,key:`toast-${A.key}`},w)}))}))}const Ql="/assets/default-logo-BbiCiEKs.png",za=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),Hne=e=>{const t=Number(e);if(!Number.isFinite(t))return"0.00";let n=Number(t.toFixed(4)).toFixed(4);if(n=n.replace(/0+$/,""),n.endsWith(".")&&(n=n.slice(0,-1)),!n.includes("."))return`${n}.00`;const[a,o]=n.split(".");return o.length<2?`${a}.${o.padEnd(2,"0")}`:n},i4=e=>{if(console.log("getLogoUrl called with:",e),!e)return console.log("No logo URL provided, using default"),Ql;if(e.startsWith("http://")||e.startsWith("https://"))return console.log("Logo URL is already a full URL:",e),e;if(e.includes("\\")||e.includes(":/")||e.includes(":\\")){const n=e.split(/[\\\/]/).pop()||e;if(console.log("Extracted filename from Windows path:",n),!n||n===e)return console.warn("Could not extract valid filename from Windows path, using default"),Ql;const{baseURL:a}=Wu(),o=`${a.replace(/\/$/,"")}/uploads/${n}`;return console.log("Built final URL from Windows path:",o),o}if(e.startsWith("/")){const n=e.split("/").pop()||e;if(console.log("Extracted filename from Unix path:",n),!n||n===e)return console.warn("Could not extract valid filename from Unix path, using default"),Ql;const{baseURL:a}=Wu(),o=`${a.replace(/\/$/,"")}/uploads/${n}`;return console.log("Built final URL from Unix path:",o),o}if(e.includes("\\")||e.includes(":/")||e.includes(":\\"))return console.warn("Invalid filename format, using default"),Ql;const{baseURL:t}=Wu(),r=`${t.replace(/\/$/,"")}/uploads/${e}`;return console.log("Built final URL from filename:",r),r};Wu().baseURL;const Vne=()=>{Tn();const[e,t]=x.useState({id:"",business_name:"",street_address:"",city:"",province:"",country:"",postal_code:"",telephone_number:"",email:"",business_number:"",website:"",logo_url:"",geo_fence_enabled:!1,geo_fence_center_latitude:"",geo_fence_center_longitude:"",geo_fence_radius_meters:"",created_at:"",updated_at:""}),[r,n]=x.useState(!1),[a,o]=x.useState(null),[s,l]=x.useState(null),[c,u]=x.useState(!1),d=w=>({id:w.id||"",business_name:w.business_name||"",street_address:w.street_address||"",city:w.city||"",province:w.province||"",country:w.country||"",postal_code:w.postal_code||"",telephone_number:w.telephone_number||"",email:w.email||"",business_number:w.business_number||"",website:w.website||"",logo_url:w.logo_url||"",geo_fence_enabled:!!w.geo_fence_enabled,geo_fence_center_latitude:w.geo_fence_center_latitude??"",geo_fence_center_longitude:w.geo_fence_center_longitude??"",geo_fence_radius_meters:w.geo_fence_radius_meters??"",created_at:w.created_at||"",updated_at:w.updated_at||""});x.useEffect(()=>{f()},[]);const f=async()=>{try{const w=await ve.get("/api/business-profile");console.log("Business Profile API Response:",w.data),console.log("Logo URL from API:",w.data.logo_url),t(d(w.data))}catch(w){if(w.response?.status===404){u(!0);return}console.error("Error fetching business profile:",w),ge.error("Failed to load business profile")}},h=w=>{const{name:A,value:P}=w.target;t(T=>({...T,[A]:P}))},p=w=>{if(w.target.files&&w.target.files[0]){const A=w.target.files[0];o(A);const P=URL.createObjectURL(A);l(P)}},v=async()=>{if(e.logo_url)try{n(!0),await ve.delete("/api/business-profile/logo"),t(w=>({...w,logo_url:""})),ge.success("Logo deleted successfully")}catch(w){console.error("Error deleting logo:",w),ge.error("Failed to delete logo")}finally{n(!1)}},m=async w=>{w.preventDefault(),n(!0);try{const A=new FormData;Object.entries(e).forEach(([P,T])=>{let E=P;switch(P){case"business_name":E="business_name";break;case"street_address":E="street_address";break;case"telephone_number":E="telephone_number";break;case"business_number":E="business_number";break;case"email":E="email";break;case"website":E="website";break;case"city":E="city";break;case"province":E="province";break;case"country":E="country";break;case"postal_code":E="postal_code";break;case"logo_url":return;case"id":case"created_at":case"updated_at":return}T!=null&&A.append(E,T)}),a&&A.append("logo",a),console.log("Form data being sent:");for(let[P,T]of A.entries())console.log(`${P}:`,T);await ve.post("/api/business-profile",A,{headers:{"Content-Type":"multipart/form-data"}}),ge.success("Business profile updated successfully"),u(!1),o(null),l(null),f()}catch(A){console.error("Error updating business profile:",A),console.error("Error response:",A.response),console.error("Error message:",A.message),A.response?.status===401?ge.error("Authentication failed. Please log in again."):A.response?.status===403?ge.error("Access denied. You do not have permission to update the business profile."):A.response?.status===404?ge.error("Business profile endpoint not found. Please check your API configuration."):A.response?.status===500?ge.error("Server error. Please try again later."):A.code==="NETWORK_ERROR"?ge.error("Network error. Please check your connection and try again."):A.message?.includes("timeout")?ge.error("Request timed out. Please try again."):ge.error(`Failed to update business profile: ${A.response?.data?.error||A.message||"Unknown error"}`)}finally{n(!1)}},y=()=>{u(!1),o(null),l(null),e.id?f():t({id:"",business_name:"",street_address:"",city:"",province:"",country:"",postal_code:"",telephone_number:"",email:"",business_number:"",logo_url:"",geo_fence_enabled:!1,geo_fence_center_latitude:"",geo_fence_center_longitude:"",geo_fence_radius_meters:"",created_at:"",updated_at:""})};if(r)return i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:i.jsx(tr,{})});const b=()=>{const w=!!e.id;return i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"flex-start",minHeight:"70vh",children:i.jsx(bt,{sx:{p:{xs:2,md:4},width:"100%",maxWidth:650,borderRadius:4,boxShadow:6,bgcolor:"background.paper"},elevation:6,children:i.jsxs(dt,{spacing:4,children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsx(B,{variant:"h5",fontWeight:700,color:"primary.main",children:w?"Current Business Profile":"Business Profile"}),i.jsx(Z,{children:i.jsx(xe,{variant:"contained",startIcon:i.jsx(tu,{}),onClick:()=>u(!0),sx:{borderRadius:2,fontWeight:600},children:w?"Edit Profile":"Create Profile"})})]}),i.jsx(qn,{sx:{bgcolor:"primary.light",height:3,borderRadius:2}}),w?i.jsxs(i.Fragment,{children:[e.logo_url&&i.jsxs(Z,{display:"flex",flexDirection:"column",alignItems:"center",mb:2,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,color:"primary.dark",gutterBottom:!0,children:"Business Logo"}),i.jsx(qr,{sx:{maxWidth:180,borderRadius:3,boxShadow:3,border:"2px solid",borderColor:"primary.light",p:1,mb:1,bgcolor:"grey.50"},children:i.jsx(n5,{component:"img",image:e.logo_url?i4(e.logo_url):Ql,onError:A=>A.currentTarget.src=Ql,alt:"Business Logo",sx:{height:120,objectFit:"contain",borderRadius:2,bgcolor:"white"}})})]}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Business Name"}),i.jsx(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:e.business_name})]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Business Number"}),i.jsx(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:e.business_number})]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Address"}),i.jsxs(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:[e.street_address,i.jsx("br",{}),e.city,", ",e.province,e.postal_code?`, ${e.postal_code}`:"",i.jsx("br",{}),e.country]})]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Email"}),i.jsx(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:e.email})]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Telephone"}),i.jsx(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:e.telephone_number})]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Website"}),i.jsx(B,{variant:"body1",fontWeight:500,mb:2,sx:{fontSize:"1.1rem"},children:e.website?i.jsx("a",{href:e.website.startsWith("http")?e.website:`https://${e.website}`,target:"_blank",rel:"noopener noreferrer",style:{color:"inherit",textDecoration:"underline"},children:e.website}):"Not provided"})]}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx(B,{variant:"subtitle2",color:"primary",fontWeight:600,gutterBottom:!0,sx:{fontSize:"1rem"},children:"Attendance Geofence"}),e.geo_fence_enabled?i.jsxs(Z,{sx:{p:2,border:"1px solid",borderColor:"primary.light",borderRadius:2,bgcolor:"grey.50"},children:[i.jsx(B,{variant:"body1",fontWeight:600,children:"Enabled"}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Lat: ",e.geo_fence_center_latitude||""," | Lng: ",e.geo_fence_center_longitude||""]}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Radius: ",e.geo_fence_radius_meters||""," meters"]})]}):i.jsx(B,{variant:"body1",fontWeight:500,mb:2,children:"Disabled"})]})]})]}):i.jsxs(Z,{textAlign:"center",py:4,children:[i.jsx(B,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Business Profile Found"}),i.jsx(B,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Create your business profile to get started. This information will be used in your quotes, invoices, and other business documents."}),i.jsx(xe,{variant:"contained",size:"large",startIcon:i.jsx(tu,{}),onClick:()=>u(!0),sx:{borderRadius:2,fontWeight:600},children:"Create Business Profile"})]})]})})})},_=()=>i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"flex-start",minHeight:"70vh",children:i.jsx(bt,{sx:{p:{xs:2,md:4},width:"100%",maxWidth:650,borderRadius:4,boxShadow:6,bgcolor:"background.paper"},elevation:6,component:"form",onSubmit:m,children:i.jsxs(dt,{spacing:4,children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsx(B,{variant:"h5",fontWeight:700,color:"primary.main",children:e.id?"Edit Business Profile":"Create Business Profile"}),i.jsxs(Z,{children:[i.jsx(xe,{variant:"outlined",onClick:y,sx:{borderRadius:2,fontWeight:600,mr:2},children:"Cancel"}),i.jsx(xe,{variant:"contained",type:"submit",disabled:r,sx:{borderRadius:2,fontWeight:600},children:r?i.jsx(tr,{size:24}):e.id?"Save Changes":"Create Profile"})]})]}),i.jsx(qn,{sx:{bgcolor:"primary.light",height:3,borderRadius:2}}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Business Name",name:"business_name",value:e.business_name,onChange:h,fullWidth:!0,required:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Business Number/GST-HST Registration Number",name:"business_number",value:e.business_number,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Street Address",name:"street_address",value:e.street_address,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"City",name:"city",value:e.city,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Province",name:"province",value:e.province,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Country",name:"country",value:e.country,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Postal Code",name:"postal_code",value:e.postal_code,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Telephone Number",name:"telephone_number",value:e.telephone_number,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Email",name:"email",value:e.email,onChange:h,fullWidth:!0,type:"email"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Website",name:"website",value:e.website,onChange:h,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsxs(Z,{sx:{border:"1px solid",borderColor:"divider",borderRadius:2,p:2,bgcolor:"grey.50"},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle1",fontWeight:700,children:"Attendance Geofence"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Require staff to be inside this fence to clock in from the mobile app."})]}),i.jsx(ti,{control:i.jsx(hl,{checked:!!e.geo_fence_enabled,onChange:w=>t(A=>({...A,geo_fence_enabled:w.target.checked}))}),label:e.geo_fence_enabled?"Enabled":"Disabled",sx:{m:0}})]}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"Latitude",name:"geo_fence_center_latitude",value:e.geo_fence_center_latitude??"",onChange:h,fullWidth:!0,type:"number",inputProps:{step:"0.000001",min:-90,max:90},disabled:!e.geo_fence_enabled})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"Longitude",name:"geo_fence_center_longitude",value:e.geo_fence_center_longitude??"",onChange:h,fullWidth:!0,type:"number",inputProps:{step:"0.000001",min:-180,max:180},disabled:!e.geo_fence_enabled})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"Radius (meters)",name:"geo_fence_radius_meters",value:e.geo_fence_radius_meters??"",onChange:h,fullWidth:!0,type:"number",inputProps:{min:1},disabled:!e.geo_fence_enabled,InputProps:{endAdornment:i.jsx(sa,{position:"end",children:"m"})}})})]}),!e.geo_fence_enabled&&i.jsx(Ot,{severity:"info",sx:{mt:2},children:"Geofence is turned off. Clock-in will not check location until you enable it."})]})}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx(B,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Business Logo"}),e.logo_url&&i.jsxs(Z,{display:"flex",flexDirection:"column",alignItems:"center",mb:2,children:[i.jsx(qr,{sx:{maxWidth:180,borderRadius:3,boxShadow:3,border:"2px solid",borderColor:"primary.light",p:1,mb:1,bgcolor:"grey.50"},children:i.jsx(n5,{component:"img",image:e.logo_url?i4(e.logo_url):Ql,onError:w=>w.currentTarget.src=Ql,alt:"Business Logo",sx:{height:120,objectFit:"contain",borderRadius:2,bgcolor:"white"}})}),i.jsx(xe,{variant:"outlined",color:"error",startIcon:i.jsx(ma,{}),onClick:v,sx:{borderRadius:2,fontWeight:600},children:"Delete Current Logo"})]}),i.jsxs(xe,{variant:"contained",component:"label",startIcon:i.jsx(Cp,{}),sx:{borderRadius:2,fontWeight:600},children:[e.logo_url?"Change Logo":"Upload Logo",i.jsx("input",{type:"file",hidden:!0,onChange:p,accept:"image/*"})]}),s&&i.jsxs(Z,{mt:2,display:"flex",flexDirection:"column",alignItems:"center",children:[i.jsx(B,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"New Logo Preview:"}),i.jsx("img",{src:s,alt:"Logo Preview",style:{maxWidth:"100px",maxHeight:"100px"}})]})]})]})]})})});return i.jsx(rr,{sx:{mt:4,mb:4},children:c?_():b()})};var Of={},o4;function Gne(){if(o4)return Of;o4=1;var e=sr();Object.defineProperty(Of,"__esModule",{value:!0}),Of.default=void 0;var t=e(cr()),r=lr();return Of.default=(0,t.default)((0,r.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),Of}var Yne=Gne();const fi=Et(Yne);var kf={},s4;function Kne(){if(s4)return kf;s4=1;var e=sr();Object.defineProperty(kf,"__esModule",{value:!0}),kf.default=void 0;var t=e(cr()),r=lr();return kf.default=(0,t.default)((0,r.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),kf}var Qne=Kne();const Va=Et(Qne);var Tf={},l4;function Xne(){if(l4)return Tf;l4=1;var e=sr();Object.defineProperty(Tf,"__esModule",{value:!0}),Tf.default=void 0;var t=e(cr()),r=lr();return Tf.default=(0,t.default)((0,r.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download"),Tf}var Jne=Xne();const la=Et(Jne);var Ef={},c4;function Zne(){if(c4)return Ef;c4=1;var e=sr();Object.defineProperty(Ef,"__esModule",{value:!0}),Ef.default=void 0;var t=e(cr()),r=lr();return Ef.default=(0,t.default)((0,r.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile"),Ef}var eae=Zne();const YL=Et(eae),u4=async e=>(await ve.get(`/api/customers/${e}/contacts`)).data,tae=async(e,t)=>(await ve.post(`/api/customers/${e}/contacts/people`,t)).data,rae=async(e,t,r)=>(await ve.put(`/api/customers/${e}/contacts/people/${t}`,r)).data,nae=async(e,t)=>(await ve.delete(`/api/customers/${e}/contacts/people/${t}`)).data,aae=async(e,t)=>(await ve.post(`/api/customers/${e}/contacts/emails`,t)).data,iae=async(e,t,r)=>(await ve.put(`/api/customers/${e}/contacts/emails/${t}`,r)).data,oae=async(e,t)=>(await ve.delete(`/api/customers/${e}/contacts/emails/${t}`)).data,sae=async(e,t)=>(await ve.post(`/api/customers/${e}/contacts/phones`,t)).data,lae=async(e,t,r)=>(await ve.put(`/api/customers/${e}/contacts/phones/${t}`,r)).data,cae=async(e,t)=>(await ve.delete(`/api/customers/${e}/contacts/phones/${t}`)).data,dS=async()=>(await ve.get("/api/customers")).data,KL=async e=>(await ve.get(`/api/customers/${e}`)).data,QL=async e=>{const t={...e};return t.default_payment_terms_in_days!==void 0&&(t.default_payment_terms_in_days=Number(t.default_payment_terms_in_days)),(await ve.post("/api/customers",t)).data},fS=async(e,t)=>{const r={...t};return r.default_payment_terms_in_days!==void 0&&(r.default_payment_terms_in_days=Number(r.default_payment_terms_in_days)),(await ve.put(`/api/customers/${e}`,r)).data},uae=async e=>{await ve.delete(`/api/customers/${e}`)},dae=async(e,t)=>{const r=new FormData;return r.append("file",e),(await ve.post("/api/customers/import-excel",r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:t})).data},fae=()=>ve.get("/api/customers/import-excel/template",{responseType:"blob"});var Xm={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var hae=Xm.exports,d4;function pae(){return d4||(d4=1,function(e,t){((r,n)=>{e.exports=n()})(hae,function r(){var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},a,o=!n.document&&!!n.postMessage,s=n.IS_PAPA_WORKER||!1,l={},c=0,u={};function d(S){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(I){var W=P(I);W.chunkSize=parseInt(W.chunkSize),I.step||I.chunk||(W.chunkSize=null),this._handle=new m(W),(this._handle.streamer=this)._config=W}).call(this,S),this.parseChunk=function(I,W){var O=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<O){let R=this._config.newline;R||(D=this._config.quoteChar||'"',R=this._handle.guessLineEndings(I,D)),I=[...I.split(R).slice(O)].join(R)}this.isFirstChunk&&E(this._config.beforeFirstChunk)&&(D=this._config.beforeFirstChunk(I))!==void 0&&(I=D),this.isFirstChunk=!1,this._halted=!1;var O=this._partialLine+I,D=(this._partialLine="",this._handle.parse(O,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(I=D.meta.cursor,O=(this._finished||(this._partialLine=O.substring(I-this._baseIndex),this._baseIndex=I),D&&D.data&&(this._rowCount+=D.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),s)n.postMessage({results:D,workerId:u.WORKER_ID,finished:O});else if(E(this._config.chunk)&&!W){if(this._config.chunk(D,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=D=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(D.data),this._completeResults.errors=this._completeResults.errors.concat(D.errors),this._completeResults.meta=D.meta),this._completed||!O||!E(this._config.complete)||D&&D.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),O||D&&D.meta.paused||this._nextChunk(),D}this._halted=!0},this._sendError=function(I){E(this._config.error)?this._config.error(I):s&&this._config.error&&n.postMessage({workerId:u.WORKER_ID,error:I,finished:!1})}}function f(S){var I;(S=S||{}).chunkSize||(S.chunkSize=u.RemoteChunkSize),d.call(this,S),this._nextChunk=o?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(W){this._input=W,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(I=new XMLHttpRequest,this._config.withCredentials&&(I.withCredentials=this._config.withCredentials),o||(I.onload=T(this._chunkLoaded,this),I.onerror=T(this._chunkError,this)),I.open(this._config.downloadRequestBody?"POST":"GET",this._input,!o),this._config.downloadRequestHeaders){var W,O=this._config.downloadRequestHeaders;for(W in O)I.setRequestHeader(W,O[W])}var D;this._config.chunkSize&&(D=this._start+this._config.chunkSize-1,I.setRequestHeader("Range","bytes="+this._start+"-"+D));try{I.send(this._config.downloadRequestBody)}catch(R){this._chunkError(R.message)}o&&I.status===0&&this._chunkError()}},this._chunkLoaded=function(){I.readyState===4&&(I.status<200||400<=I.status?this._chunkError():(this._start+=this._config.chunkSize||I.responseText.length,this._finished=!this._config.chunkSize||this._start>=(W=>(W=W.getResponseHeader("Content-Range"))!==null?parseInt(W.substring(W.lastIndexOf("/")+1)):-1)(I),this.parseChunk(I.responseText)))},this._chunkError=function(W){W=I.statusText||W,this._sendError(new Error(W))}}function h(S){(S=S||{}).chunkSize||(S.chunkSize=u.LocalChunkSize),d.call(this,S);var I,W,O=typeof FileReader<"u";this.stream=function(D){this._input=D,W=D.slice||D.webkitSlice||D.mozSlice,O?((I=new FileReader).onload=T(this._chunkLoaded,this),I.onerror=T(this._chunkError,this)):I=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var D=this._input,R=(this._config.chunkSize&&(R=Math.min(this._start+this._config.chunkSize,this._input.size),D=W.call(D,this._start,R)),I.readAsText(D,this._config.encoding));O||this._chunkLoaded({target:{result:R}})},this._chunkLoaded=function(D){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(D.target.result)},this._chunkError=function(){this._sendError(I.error)}}function p(S){var I;d.call(this,S=S||{}),this.stream=function(W){return I=W,this._nextChunk()},this._nextChunk=function(){var W,O;if(!this._finished)return W=this._config.chunkSize,I=W?(O=I.substring(0,W),I.substring(W)):(O=I,""),this._finished=!I,this.parseChunk(O)}}function v(S){d.call(this,S=S||{});var I=[],W=!0,O=!1;this.pause=function(){d.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){d.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(D){this._input=D,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){O&&I.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),I.length?this.parseChunk(I.shift()):W=!0},this._streamData=T(function(D){try{I.push(typeof D=="string"?D:D.toString(this._config.encoding)),W&&(W=!1,this._checkIsFinished(),this.parseChunk(I.shift()))}catch(R){this._streamError(R)}},this),this._streamError=T(function(D){this._streamCleanUp(),this._sendError(D)},this),this._streamEnd=T(function(){this._streamCleanUp(),O=!0,this._streamData("")},this),this._streamCleanUp=T(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function m(S){var I,W,O,D,R=Math.pow(2,53),F=-R,z=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,K=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,J=this,L=0,k=0,$=!1,X=!1,C=[],M={data:[],errors:[],meta:{}};function H(oe){return S.skipEmptyLines==="greedy"?oe.join("").trim()==="":oe.length===1&&oe[0].length===0}function U(){if(M&&O&&(le("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+u.DefaultDelimiter+"'"),O=!1),S.skipEmptyLines&&(M.data=M.data.filter(function(me){return!H(me)})),te()){let me=function(Q,G){E(S.transformHeader)&&(Q=S.transformHeader(Q,G)),C.push(Q)};if(M)if(Array.isArray(M.data[0])){for(var oe=0;te()&&oe<M.data.length;oe++)M.data[oe].forEach(me);M.data.splice(0,1)}else M.data.forEach(me)}function ae(me,Q){for(var G=S.header?{}:[],ee=0;ee<me.length;ee++){var se=ee,V=me[ee],V=((Ge,De)=>(Fe=>(S.dynamicTypingFunction&&S.dynamicTyping[Fe]===void 0&&(S.dynamicTyping[Fe]=S.dynamicTypingFunction(Fe)),(S.dynamicTyping[Fe]||S.dynamicTyping)===!0))(Ge)?De==="true"||De==="TRUE"||De!=="false"&&De!=="FALSE"&&((Fe=>{if(z.test(Fe)&&(Fe=parseFloat(Fe),F<Fe&&Fe<R))return 1})(De)?parseFloat(De):K.test(De)?new Date(De):De===""?null:De):De)(se=S.header?ee>=C.length?"__parsed_extra":C[ee]:se,V=S.transform?S.transform(V,se):V);se==="__parsed_extra"?(G[se]=G[se]||[],G[se].push(V)):G[se]=V}return S.header&&(ee>C.length?le("FieldMismatch","TooManyFields","Too many fields: expected "+C.length+" fields but parsed "+ee,k+Q):ee<C.length&&le("FieldMismatch","TooFewFields","Too few fields: expected "+C.length+" fields but parsed "+ee,k+Q)),G}var he;M&&(S.header||S.dynamicTyping||S.transform)&&(he=1,!M.data.length||Array.isArray(M.data[0])?(M.data=M.data.map(ae),he=M.data.length):M.data=ae(M.data,0),S.header&&M.meta&&(M.meta.fields=C),k+=he)}function te(){return S.header&&C.length===0}function le(oe,ae,he,me){oe={type:oe,code:ae,message:he},me!==void 0&&(oe.row=me),M.errors.push(oe)}E(S.step)&&(D=S.step,S.step=function(oe){M=oe,te()?U():(U(),M.data.length!==0&&(L+=oe.data.length,S.preview&&L>S.preview?W.abort():(M.data=M.data[0],D(M,J))))}),this.parse=function(oe,ae,he){var me=S.quoteChar||'"',me=(S.newline||(S.newline=this.guessLineEndings(oe,me)),O=!1,S.delimiter?E(S.delimiter)&&(S.delimiter=S.delimiter(oe),M.meta.delimiter=S.delimiter):((me=((Q,G,ee,se,V)=>{var Ge,De,Fe,Xe;V=V||[",","	","|",";",u.RECORD_SEP,u.UNIT_SEP];for(var it=0;it<V.length;it++){for(var lt,vt=V[it],Ye=0,Ze=0,We=0,wt=(Fe=void 0,new b({comments:se,delimiter:vt,newline:G,preview:10}).parse(Q)),Nt=0;Nt<wt.data.length;Nt++)ee&&H(wt.data[Nt])?We++:(lt=wt.data[Nt].length,Ze+=lt,Fe===void 0?Fe=lt:0<lt&&(Ye+=Math.abs(lt-Fe),Fe=lt));0<wt.data.length&&(Ze/=wt.data.length-We),(De===void 0||Ye<=De)&&(Xe===void 0||Xe<Ze)&&1.99<Ze&&(De=Ye,Ge=vt,Xe=Ze)}return{successful:!!(S.delimiter=Ge),bestDelimiter:Ge}})(oe,S.newline,S.skipEmptyLines,S.comments,S.delimitersToGuess)).successful?S.delimiter=me.bestDelimiter:(O=!0,S.delimiter=u.DefaultDelimiter),M.meta.delimiter=S.delimiter),P(S));return S.preview&&S.header&&me.preview++,I=oe,W=new b(me),M=W.parse(I,ae,he),U(),$?{meta:{paused:!0}}:M||{meta:{paused:!1}}},this.paused=function(){return $},this.pause=function(){$=!0,W.abort(),I=E(S.chunk)?"":I.substring(W.getCharIndex())},this.resume=function(){J.streamer._halted?($=!1,J.streamer.parseChunk(I,!0)):setTimeout(J.resume,3)},this.aborted=function(){return X},this.abort=function(){X=!0,W.abort(),M.meta.aborted=!0,E(S.complete)&&S.complete(M),I=""},this.guessLineEndings=function(Q,me){Q=Q.substring(0,1048576);var me=new RegExp(y(me)+"([^]*?)"+y(me),"gm"),he=(Q=Q.replace(me,"")).split("\r"),me=Q.split(`
`),Q=1<me.length&&me[0].length<he[0].length;if(he.length===1||Q)return`
`;for(var G=0,ee=0;ee<he.length;ee++)he[ee][0]===`
`&&G++;return G>=he.length/2?`\r
`:"\r"}}function y(S){return S.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function b(S){var I=(S=S||{}).delimiter,W=S.newline,O=S.comments,D=S.step,R=S.preview,F=S.fastMode,z=null,K=!1,J=S.quoteChar==null?'"':S.quoteChar,L=J;if(S.escapeChar!==void 0&&(L=S.escapeChar),(typeof I!="string"||-1<u.BAD_DELIMITERS.indexOf(I))&&(I=","),O===I)throw new Error("Comment character same as delimiter");O===!0?O="#":(typeof O!="string"||-1<u.BAD_DELIMITERS.indexOf(O))&&(O=!1),W!==`
`&&W!=="\r"&&W!==`\r
`&&(W=`
`);var k=0,$=!1;this.parse=function(X,C,M){if(typeof X!="string")throw new Error("Input must be a string");var H=X.length,U=I.length,te=W.length,le=O.length,oe=E(D),ae=[],he=[],me=[],Q=k=0;if(!X)return Ye();if(F||F!==!1&&X.indexOf(J)===-1){for(var G=X.split(W),ee=0;ee<G.length;ee++){if(me=G[ee],k+=me.length,ee!==G.length-1)k+=W.length;else if(M)return Ye();if(!O||me.substring(0,le)!==O){if(oe){if(ae=[],Xe(me.split(I)),Ze(),$)return Ye()}else Xe(me.split(I));if(R&&R<=ee)return ae=ae.slice(0,R),Ye(!0)}}return Ye()}for(var se=X.indexOf(I,k),V=X.indexOf(W,k),Ge=new RegExp(y(L)+y(J),"g"),De=X.indexOf(J,k);;)if(X[k]===J)for(De=k,k++;;){if((De=X.indexOf(J,De+1))===-1)return M||he.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:ae.length,index:k}),lt();if(De===H-1)return lt(X.substring(k,De).replace(Ge,J));if(J===L&&X[De+1]===L)De++;else if(J===L||De===0||X[De-1]!==L){se!==-1&&se<De+1&&(se=X.indexOf(I,De+1));var Fe=it((V=V!==-1&&V<De+1?X.indexOf(W,De+1):V)===-1?se:Math.min(se,V));if(X.substr(De+1+Fe,U)===I){me.push(X.substring(k,De).replace(Ge,J)),X[k=De+1+Fe+U]!==J&&(De=X.indexOf(J,k)),se=X.indexOf(I,k),V=X.indexOf(W,k);break}if(Fe=it(V),X.substring(De+1+Fe,De+1+Fe+te)===W){if(me.push(X.substring(k,De).replace(Ge,J)),vt(De+1+Fe+te),se=X.indexOf(I,k),De=X.indexOf(J,k),oe&&(Ze(),$))return Ye();if(R&&ae.length>=R)return Ye(!0);break}he.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:ae.length,index:k}),De++}}else if(O&&me.length===0&&X.substring(k,k+le)===O){if(V===-1)return Ye();k=V+te,V=X.indexOf(W,k),se=X.indexOf(I,k)}else if(se!==-1&&(se<V||V===-1))me.push(X.substring(k,se)),k=se+U,se=X.indexOf(I,k);else{if(V===-1)break;if(me.push(X.substring(k,V)),vt(V+te),oe&&(Ze(),$))return Ye();if(R&&ae.length>=R)return Ye(!0)}return lt();function Xe(We){ae.push(We),Q=k}function it(We){var wt=0;return wt=We!==-1&&(We=X.substring(De+1,We))&&We.trim()===""?We.length:wt}function lt(We){return M||(We===void 0&&(We=X.substring(k)),me.push(We),k=H,Xe(me),oe&&Ze()),Ye()}function vt(We){k=We,Xe(me),me=[],V=X.indexOf(W,k)}function Ye(We){if(S.header&&!C&&ae.length&&!K){var wt=ae[0],Nt=Object.create(null),kt=new Set(wt);let Wt=!1;for(let jt=0;jt<wt.length;jt++){let ur=wt[jt];if(Nt[ur=E(S.transformHeader)?S.transformHeader(ur,jt):ur]){let $e,He=Nt[ur];for(;$e=ur+"_"+He,He++,kt.has($e););kt.add($e),wt[jt]=$e,Nt[ur]++,Wt=!0,(z=z===null?{}:z)[$e]=ur}else Nt[ur]=1,wt[jt]=ur;kt.add(ur)}Wt&&console.warn("Duplicate headers found and renamed."),K=!0}return{data:ae,errors:he,meta:{delimiter:I,linebreak:W,aborted:$,truncated:!!We,cursor:Q+(C||0),renamedHeaders:z}}}function Ze(){D(Ye()),ae=[],he=[]}},this.abort=function(){$=!0},this.getCharIndex=function(){return k}}function _(S){var I=S.data,W=l[I.workerId],O=!1;if(I.error)W.userError(I.error,I.file);else if(I.results&&I.results.data){var D={abort:function(){O=!0,w(I.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:A,resume:A};if(E(W.userStep)){for(var R=0;R<I.results.data.length&&(W.userStep({data:I.results.data[R],errors:I.results.errors,meta:I.results.meta},D),!O);R++);delete I.results}else E(W.userChunk)&&(W.userChunk(I.results,D,I.file),delete I.results)}I.finished&&!O&&w(I.workerId,I.results)}function w(S,I){var W=l[S];E(W.userComplete)&&W.userComplete(I),W.terminate(),delete l[S]}function A(){throw new Error("Not implemented.")}function P(S){if(typeof S!="object"||S===null)return S;var I,W=Array.isArray(S)?[]:{};for(I in S)W[I]=P(S[I]);return W}function T(S,I){return function(){S.apply(I,arguments)}}function E(S){return typeof S=="function"}return u.parse=function(S,I){var W=(I=I||{}).dynamicTyping||!1;if(E(W)&&(I.dynamicTypingFunction=W,W={}),I.dynamicTyping=W,I.transform=!!E(I.transform)&&I.transform,!I.worker||!u.WORKERS_SUPPORTED)return W=null,u.NODE_STREAM_INPUT,typeof S=="string"?(S=(O=>O.charCodeAt(0)!==65279?O:O.slice(1))(S),W=new(I.download?f:p)(I)):S.readable===!0&&E(S.read)&&E(S.on)?W=new v(I):(n.File&&S instanceof File||S instanceof Object)&&(W=new h(I)),W.stream(S);(W=(()=>{var O;return!!u.WORKERS_SUPPORTED&&(O=(()=>{var D=n.URL||n.webkitURL||null,R=r.toString();return u.BLOB_URL||(u.BLOB_URL=D.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",R,")();"],{type:"text/javascript"})))})(),(O=new n.Worker(O)).onmessage=_,O.id=c++,l[O.id]=O)})()).userStep=I.step,W.userChunk=I.chunk,W.userComplete=I.complete,W.userError=I.error,I.step=E(I.step),I.chunk=E(I.chunk),I.complete=E(I.complete),I.error=E(I.error),delete I.worker,W.postMessage({input:S,config:I,workerId:W.id})},u.unparse=function(S,I){var W=!1,O=!0,D=",",R=`\r
`,F='"',z=F+F,K=!1,J=null,L=!1,k=((()=>{if(typeof I=="object"){if(typeof I.delimiter!="string"||u.BAD_DELIMITERS.filter(function(C){return I.delimiter.indexOf(C)!==-1}).length||(D=I.delimiter),typeof I.quotes!="boolean"&&typeof I.quotes!="function"&&!Array.isArray(I.quotes)||(W=I.quotes),typeof I.skipEmptyLines!="boolean"&&typeof I.skipEmptyLines!="string"||(K=I.skipEmptyLines),typeof I.newline=="string"&&(R=I.newline),typeof I.quoteChar=="string"&&(F=I.quoteChar),typeof I.header=="boolean"&&(O=I.header),Array.isArray(I.columns)){if(I.columns.length===0)throw new Error("Option columns is empty");J=I.columns}I.escapeChar!==void 0&&(z=I.escapeChar+F),I.escapeFormulae instanceof RegExp?L=I.escapeFormulae:typeof I.escapeFormulae=="boolean"&&I.escapeFormulae&&(L=/^[=+\-@\t\r].*$/)}})(),new RegExp(y(F),"g"));if(typeof S=="string"&&(S=JSON.parse(S)),Array.isArray(S)){if(!S.length||Array.isArray(S[0]))return $(null,S,K);if(typeof S[0]=="object")return $(J||Object.keys(S[0]),S,K)}else if(typeof S=="object")return typeof S.data=="string"&&(S.data=JSON.parse(S.data)),Array.isArray(S.data)&&(S.fields||(S.fields=S.meta&&S.meta.fields||J),S.fields||(S.fields=Array.isArray(S.data[0])?S.fields:typeof S.data[0]=="object"?Object.keys(S.data[0]):[]),Array.isArray(S.data[0])||typeof S.data[0]=="object"||(S.data=[S.data])),$(S.fields||[],S.data||[],K);throw new Error("Unable to serialize unrecognized input");function $(C,M,H){var U="",te=(typeof C=="string"&&(C=JSON.parse(C)),typeof M=="string"&&(M=JSON.parse(M)),Array.isArray(C)&&0<C.length),le=!Array.isArray(M[0]);if(te&&O){for(var oe=0;oe<C.length;oe++)0<oe&&(U+=D),U+=X(C[oe],oe);0<M.length&&(U+=R)}for(var ae=0;ae<M.length;ae++){var he=(te?C:M[ae]).length,me=!1,Q=te?Object.keys(M[ae]).length===0:M[ae].length===0;if(H&&!te&&(me=H==="greedy"?M[ae].join("").trim()==="":M[ae].length===1&&M[ae][0].length===0),H==="greedy"&&te){for(var G=[],ee=0;ee<he;ee++){var se=le?C[ee]:ee;G.push(M[ae][se])}me=G.join("").trim()===""}if(!me){for(var V=0;V<he;V++){0<V&&!Q&&(U+=D);var Ge=te&&le?C[V]:V;U+=X(M[ae][Ge],V)}ae<M.length-1&&(!H||0<he&&!Q)&&(U+=R)}}return U}function X(C,M){var H,U;return C==null?"":C.constructor===Date?JSON.stringify(C).slice(1,25):(U=!1,L&&typeof C=="string"&&L.test(C)&&(C="'"+C,U=!0),H=C.toString().replace(k,z),(U=U||W===!0||typeof W=="function"&&W(C,M)||Array.isArray(W)&&W[M]||((te,le)=>{for(var oe=0;oe<le.length;oe++)if(-1<te.indexOf(le[oe]))return!0;return!1})(H,u.BAD_DELIMITERS)||-1<H.indexOf(D)||H.charAt(0)===" "||H.charAt(H.length-1)===" ")?F+H+F:H)}},u.RECORD_SEP="",u.UNIT_SEP="",u.BYTE_ORDER_MARK="\uFEFF",u.BAD_DELIMITERS=["\r",`
`,'"',u.BYTE_ORDER_MARK],u.WORKERS_SUPPORTED=!o&&!!n.Worker,u.NODE_STREAM_INPUT=1,u.LocalChunkSize=10485760,u.RemoteChunkSize=5242880,u.DefaultDelimiter=",",u.Parser=b,u.ParserHandle=m,u.NetworkStreamer=f,u.FileStreamer=h,u.StringStreamer=p,u.ReadableStreamStreamer=v,n.jQuery&&((a=n.jQuery).fn.parse=function(S){var I=S.config||{},W=[];return this.each(function(R){if(!(a(this).prop("tagName").toUpperCase()==="INPUT"&&a(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var F=0;F<this.files.length;F++)W.push({file:this.files[F],inputElem:this,instanceConfig:a.extend({},I)})}),O(),this;function O(){if(W.length===0)E(S.complete)&&S.complete();else{var R,F,z,K,J=W[0];if(E(S.before)){var L=S.before(J.file,J.inputElem);if(typeof L=="object"){if(L.action==="abort")return R="AbortError",F=J.file,z=J.inputElem,K=L.reason,void(E(S.error)&&S.error({name:R},F,z,K));if(L.action==="skip")return void D();typeof L.config=="object"&&(J.instanceConfig=a.extend(J.instanceConfig,L.config))}else if(L==="skip")return void D()}var k=J.instanceConfig.complete;J.instanceConfig.complete=function($){E(k)&&k($,J.file,J.inputElem),D()},u.parse(J.file,J.instanceConfig)}}function D(){W.splice(0,1),O()}}),s&&(n.onmessage=function(S){S=S.data,u.WORKER_ID===void 0&&S&&(u.WORKER_ID=S.workerId),typeof S.input=="string"?n.postMessage({workerId:u.WORKER_ID,results:u.parse(S.input,S.config),finished:!0}):(n.File&&S.input instanceof File||S.input instanceof Object)&&(S=u.parse(S.input,S.config))&&n.postMessage({workerId:u.WORKER_ID,results:S,finished:!0})}),(f.prototype=Object.create(d.prototype)).constructor=f,(h.prototype=Object.create(d.prototype)).constructor=h,(p.prototype=Object.create(p.prototype)).constructor=p,(v.prototype=Object.create(d.prototype)).constructor=v,u})}(Xm)),Xm.exports}var mae=pae();const Cl=Et(mae),XL=async()=>{try{const e=await ve.get("/api/business-profile");return{city:e.data.city||"",province:e.data.province||"",country:e.data.country||""}}catch(e){return console.error("Error fetching business profile:",e),{city:"",province:"",country:""}}};function Ay(e,t){const[r,n]=x.useState(e);return x.useEffect(()=>{const a=setTimeout(()=>{n(e)},t);return()=>{clearTimeout(a)}},[e,t]),r}const f4={customer_id:"",customer_name:"",contact_person:"",email:"",phone_number:"",street_address:"",city:"",province:"",country:"",postal_code:"",default_payment_terms_in_days:30,website:"",general_notes:""},Wd=({open:e,onClose:t,onSave:r,initialCustomer:n,isEditMode:a=!1,loading:o=!1,onUseExisting:s})=>{const[l,c]=x.useState(f4),[u,d]=x.useState(null),[f,h]=x.useState({}),p=Ay(l,300),[v,m]=x.useState([]),[y,b]=x.useState(null),[_,w]=x.useState([]),[A,P]=x.useState([]),[T,E]=x.useState([]),[S,I]=x.useState(""),[W,O]=x.useState(""),[D,R]=x.useState(""),[F,z]=x.useState(""),K=async()=>{try{const G=await XL();c(ee=>({...ee,city:G.city,province:G.province,country:G.country}))}catch(G){console.error("Error autofilling from business profile:",G)}};x.useEffect(()=>{if(e){const G={...f4,...n};c(G),d(null),(async()=>{try{const se=await ve.get("/api/customers");m(se.data||[])}catch{}})(),!a&&(!n?.city||n.city==="")&&(!n?.province||n.province==="")&&(!n?.country||n.country==="")&&K();const ee=n?.customer_id;a&&ee?(async()=>{try{const se=await u4(ee);w(se.people||[]),P(se.emails||[]),E(se.phones||[])}catch{}})():(w([]),P([]),E([]))}},[e,n,a]);const J=G=>{const{name:ee,value:se}=G.target;c(V=>({...V,[ee]:se})),f[ee]&&h(V=>({...V,[ee]:void 0}))},L=()=>l.customer_name.trim()?(d(null),!0):(d("Customer name is required"),!1),k=()=>{L()&&r(l)},$=G=>G.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim().toUpperCase(),X=(G,ee)=>{const se=Math.floor(Math.max(G.length,ee.length)/2)-1;if(se<0)return 0;const V=new Array(G.length).fill(!1),Ge=new Array(ee.length).fill(!1);let De=0;for(let We=0;We<G.length;We++){const wt=Math.max(0,We-se),Nt=Math.min(We+se+1,ee.length);for(let kt=wt;kt<Nt;kt++)if(!Ge[kt]&&G[We]===ee[kt]){V[We]=!0,Ge[kt]=!0,De++;break}}if(De===0)return 0;const Fe=[],Xe=[];for(let We=0;We<G.length;We++)V[We]&&Fe.push(G[We]);for(let We=0;We<ee.length;We++)Ge[We]&&Xe.push(ee[We]);let it=0;for(let We=0;We<Fe.length;We++)Fe[We]!==Xe[We]&&it++;it=Math.floor(it/2);const lt=(De/G.length+De/ee.length+(De-it)/De)/3;let vt=0;const Ye=4;for(let We=0;We<Math.min(Ye,G.length,ee.length)&&G[We]===ee[We];We++)vt++;return lt+vt*.1*(1-lt)};x.useEffect(()=>{if(!e)return;const G={};p.email&&p.email.trim().length>0&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p.email.trim())||(G.email="Invalid email format"));let ee=null,se=0;if(p.customer_name&&p.customer_name.trim().length>0){const V=$(p.customer_name),Ge=(n?.customer_id??p.customer_id)||"";for(const De of v){if(String(De.customer_id)===String(Ge||""))continue;const Xe=$(De.customer_name||""),lt=Xe===V?1:X(Xe,V);lt>se&&(se=lt,ee=De)}se>=.92&&(G.customer_name="A similar customer already exists")}b(se>=.92&&ee?ee:null),h(V=>({...V,...G}))},[p,e]);const C=n?.customer_id,M=async()=>{if(!(!a||!C))try{const G=await u4(C);w(G.people||[]),P(G.emails||[]),E(G.phones||[])}catch{}},H=async()=>{!C||!S.trim()||(await tae(C,{name:S.trim()}),I(""),M())},U=async G=>{C&&(await rae(C,G,{is_preferred:!0}),M())},te=async G=>{C&&(await nae(C,G),M())},le=async()=>{!C||!W.trim()||(await aae(C,{email:W.trim()}),O(""),M())},oe=async G=>{C&&(await iae(C,G,{is_preferred:!0}),M())},ae=async G=>{C&&(await oae(C,G),M())},he=async()=>{!C||!D.trim()||(await sae(C,{phone:D.trim(),label:F.trim()||void 0}),R(""),z(""),M())},me=async G=>{C&&(await lae(C,G,{is_preferred:!0}),M())},Q=async G=>{C&&(await cae(C,G),M())};return i.jsxs(pr,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,children:[i.jsx(mr,{children:a?"Edit Customer":"Add New Customer"}),i.jsxs(gr,{children:[i.jsxs(ie,{container:!0,spacing:2,sx:{mt:1},children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"customer_name",label:"Customer Name",value:l.customer_name,onChange:J,fullWidth:!0,required:!0,error:!!f.customer_name,helperText:f.customer_name,autoFocus:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"contact_person",label:"Contact Person",value:l.contact_person,onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"email",label:"Email",type:"email",value:l.email,onChange:J,fullWidth:!0,error:!!f.email,helperText:f.email})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"phone_number",label:"Phone Number",value:l.phone_number,onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{name:"street_address",label:"Street Address",value:l.street_address,onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"city",label:"City",value:l.city,onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"province",label:"Province/State",value:l.province,onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"country",label:"Country",value:l.country,onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"postal_code",label:"Postal Code",value:l.postal_code,onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"default_payment_terms_in_days",label:"Payment Terms (days)",type:"number",value:l.default_payment_terms_in_days??"",onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{name:"website",label:"Website",value:l.website,onChange:J,fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{name:"general_notes",label:"General Notes",value:l.general_notes,onChange:J,fullWidth:!0,multiline:!0,minRows:4})}),a&&C&&i.jsx(ie,{item:!0,xs:12,children:i.jsxs(Z,{sx:{mt:2},children:[i.jsx(B,{variant:"h6",sx:{mb:1},children:"Contacts"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"People"}),i.jsxs(dt,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Pe,{size:"small",label:"Name",value:S,onChange:G=>I(G.target.value),fullWidth:!0}),i.jsx(xe,{variant:"outlined",size:"small",onClick:H,children:"Add"})]}),i.jsxs(dt,{spacing:1,children:[_.map(G=>i.jsxs(dt,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[G.name," ",G.is_preferred?"(Preferred)":""]}),!G.is_preferred&&i.jsx(xe,{size:"small",onClick:()=>U(G.id),children:"Set Preferred"}),i.jsx(xe,{size:"small",color:"error",onClick:()=>te(G.id),children:"Remove"})]},G.id)),_.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No people yet."})]})]}),i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"Emails"}),i.jsxs(dt,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Pe,{size:"small",label:"Email",value:W,onChange:G=>O(G.target.value),fullWidth:!0}),i.jsx(xe,{variant:"outlined",size:"small",onClick:le,children:"Add"})]}),i.jsxs(dt,{spacing:1,children:[A.map(G=>i.jsxs(dt,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[G.email," ",G.is_preferred?"(Preferred)":""]}),!G.is_preferred&&i.jsx(xe,{size:"small",onClick:()=>oe(G.id),children:"Set Preferred"}),i.jsx(xe,{size:"small",color:"error",onClick:()=>ae(G.id),children:"Remove"})]},G.id)),A.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No emails yet."})]})]}),i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"Phones"}),i.jsxs(dt,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Pe,{size:"small",label:"Phone",value:D,onChange:G=>R(G.target.value),fullWidth:!0}),i.jsx(Pe,{size:"small",label:"Label",value:F,onChange:G=>z(G.target.value),sx:{width:120}}),i.jsx(xe,{variant:"outlined",size:"small",onClick:he,children:"Add"})]}),i.jsxs(dt,{spacing:1,children:[T.map(G=>i.jsxs(dt,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[G.phone,G.label?` (${G.label})`:""," ",G.is_preferred?"(Preferred)":""]}),!G.is_preferred&&i.jsx(xe,{size:"small",onClick:()=>me(G.id),children:"Set Preferred"}),i.jsx(xe,{size:"small",color:"error",onClick:()=>Q(G.id),children:"Remove"})]},G.id)),T.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No phones yet."})]})]})]})]})})]}),u&&i.jsx("div",{style:{color:"red",marginTop:8},children:u}),y&&i.jsxs("div",{style:{marginTop:12},children:[i.jsxs("div",{style:{color:"#b26a00",marginBottom:8},children:['Looks like "',y.customer_name,'" already exists.']}),typeof s=="function"&&i.jsx(xe,{variant:"outlined",size:"small",onClick:()=>{s(y)},children:"Use existing"})]})]}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:t,children:"Cancel"}),i.jsx(xe,{onClick:k,variant:"contained",disabled:o,children:a?"Save Changes":"Add Customer"})]})]})},gae=()=>{Tn();const[e,t]=x.useState([]),[r,n]=x.useState(""),[a,o]=x.useState(null),[s,l]=x.useState(null),[c,u]=x.useState(!1),[d,f]=x.useState({pageSize:10,page:0}),[h,p]=x.useState(!1),[v,m]=x.useState(!1),[y,b]=x.useState(0),[_,w]=x.useState(null),[A,P]=x.useState(!1),T=x.useRef(null);x.useEffect(()=>{E()},[]);const E=async()=>{try{const k=await dS();t(k)}catch(k){console.error("Error fetching customers:",k),ge.error("Failed to fetch customers")}},S=async k=>{if(window.confirm("Are you sure you want to delete this customer?"))try{await uae(k),t($=>$.filter(X=>X.id!==k)),ge.success("Customer deleted successfully")}catch($){console.error("Error deleting customer:",$),ge.error("Failed to delete customer")}},I=k=>{o(k),l({...k}),p(!0),u(!0)},W=()=>{u(!1),o(null),l(null)},O=async()=>{try{const k=await fae(),$=new Blob([k.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),X=window.URL.createObjectURL($),C=document.createElement("a");C.href=X,C.download="customer_import_template.xlsx",document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL(X)}catch(k){console.error("Error downloading template",k),ge.error("Failed to download template")}},D=()=>{T.current?.click()},R=async k=>{const $=k.target.files?.[0];$&&(await F($),k.target.value="")},F=async k=>{m(!0),b(0),w(null);try{const $=await dae(k,X=>{if(X?.total){const C=Math.round(X.loaded*90/X.total);b(C)}});b(100),w($),P(!0),Array.isArray($?.createdCustomers)&&$.createdCustomers.length>0?t(X=>[...X,...$.createdCustomers]):E(),ge.success("Customer import completed")}catch($){console.error("Error uploading Excel:",$);const X=$?.response?.data,C=X?.error||"Failed to import customers";w({error:C,errors:X?.errors||[],warnings:X?.warnings||[]}),P(!0),ge.error(C)}finally{m(!1),b(0)}},z=()=>{P(!1),w(null)},K=e.filter(k=>k.customer_name.toLowerCase().includes(r.toLowerCase())||k.email?.toLowerCase().includes(r.toLowerCase())||k.phone_number?.toLowerCase().includes(r.toLowerCase())||`${k.street_address}, ${k.city}, ${k.province}, ${k.country}`.toLowerCase().includes(r.toLowerCase())),J=[{field:"customer_name",headerName:"Customer Name",flex:1.5},{field:"contact_person",headerName:"Contact Person",flex:1},{field:"email",headerName:"Email",flex:1.5},{field:"phone_number",headerName:"Phone Number",flex:1},{field:"actions",headerName:"Actions",width:80,sortable:!1,renderCell:k=>i.jsx(xr,{size:"small",color:"error",onClick:$=>{$.stopPropagation(),S(k.row.id)},children:i.jsx(ma,{})})}],L=()=>{const k=K.map(M=>({customer_name:M.customer_name,contact_person:M.contact_person,email:M.email,phone_number:M.phone_number})),$=Cl.unparse(k),X=new Blob([$],{type:"text/csv;charset=utf-8;"}),C=document.createElement("a");if(C.download!==void 0){const M=URL.createObjectURL(X);C.setAttribute("href",M),C.setAttribute("download","customer_list.csv"),C.style.visibility="hidden",document.body.appendChild(C),C.click(),document.body.removeChild(C)}};return i.jsx(rr,{maxWidth:"xl",children:i.jsxs(Z,{sx:{my:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Customer List"}),i.jsxs(dt,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:()=>{l({id:"",customer_id:"",customer_name:"",email:"",phone:"",phone_number:"",address:"",street_address:"",city:"",state:"",province:"",country:"",postal_code:"",contact_person:"",website:"",general_notes:"",created_at:"",updated_at:""}),p(!1),u(!0)},children:"New Customer"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(YL,{}),onClick:D,children:"Import Excel"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:O,children:"Download Template"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:L,children:"Export CSV"})]}),i.jsx("input",{type:"file",accept:".xlsx,.xls",ref:T,style:{display:"none"},onChange:R}),v&&i.jsxs(bt,{sx:{p:2,mb:2},children:[i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Uploading Excel file..."}),i.jsx(Ed,{variant:"determinate",value:y}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[y,"% complete"]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(Pe,{fullWidth:!0,variant:"outlined",placeholder:"Search customers...",value:r,onChange:k=>n(k.target.value),InputProps:{startAdornment:i.jsx(sa,{position:"start",children:i.jsx(fi,{})})},sx:{mb:2}}),i.jsx(Po,{rows:K,columns:J,pageSizeOptions:[10,25,50],paginationModel:d,onPaginationModelChange:f,getRowId:k=>k.id,loading:!1,disableRowSelectionOnClick:!0,onRowClick:k=>I(k.row),sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),i.jsxs(pr,{open:A,onClose:z,maxWidth:"md",fullWidth:!0,children:[i.jsx(mr,{children:_?.error?"Import Failed":"Import Completed"}),i.jsx(gr,{children:_&&i.jsxs(Z,{children:[_.error?i.jsx(Ot,{severity:"error",sx:{mb:2},children:_.error}):i.jsx(Ot,{severity:"success",sx:{mb:2},children:_.message||"Customers imported successfully"}),_.summary&&i.jsx(Z,{sx:{mb:3},children:i.jsxs(ie,{container:!0,spacing:1,children:[i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(st,{label:`Total rows: ${_.summary.totalRows||0}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(st,{label:`Accepted: ${_.summary.acceptedRows||0}`,color:"info"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(st,{label:`Created: ${_.summary.created||0}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(st,{label:`Skipped: ${_.summary.skipped||0}`,color:"warning"})})]})}),_.errors&&_.errors.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"error",gutterBottom:!0,children:["Errors (",_.errors.length,")"]}),i.jsx(ha,{dense:!0,children:_.errors.map((k,$)=>i.jsx(ja,{children:i.jsx(Qn,{primary:k})},$))})]}),_.warnings&&_.warnings.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"warning.main",gutterBottom:!0,children:["Warnings (",_.warnings.length,")"]}),i.jsx(ha,{dense:!0,children:_.warnings.map((k,$)=>i.jsx(ja,{children:i.jsx(Qn,{primary:k})},$))})]})]})}),i.jsx(jr,{children:i.jsx(xe,{onClick:z,variant:"contained",children:"Close"})})]}),i.jsx(Wd,{open:c,onClose:W,onSave:async k=>{try{if(h&&s)await fS(s.id,k),t($=>$.map(X=>X.id===s.id?{...X,...k}:X)),ge.success("Customer updated successfully");else{const $=await QL(k);t(X=>[...X,$]),ge.success("Customer created successfully")}W()}catch($){console.error("Error saving customer:",$),ge.error(h?"Failed to update customer":"Failed to create customer")}},initialCustomer:s||{},isEditMode:h})]})})},h4=async e=>(await ve.get("/api/invoices",{params:e})).data,vae=async e=>(await ve.get(`/api/invoices/${e}`)).data,yae=async e=>(await ve.post("/api/invoices",e)).data,xae=async(e,t)=>(await ve.put("/api/invoices/"+e,t)).data,bae=async e=>(await ve.delete("/api/invoices/"+e)).data,_ae=async(e,t)=>ve.get(`/api/invoices/customers/${e}/statement`,{params:{month:t},responseType:"blob"}),wae=async e=>ve.get("/api/invoices/statement",{params:e,responseType:"blob"}),jae=async()=>ve.get("/api/invoices/csv-template",{responseType:"blob"}),Sae=async e=>{const t=new FormData;return t.append("file",e),(await ve.post("/api/invoices/upload-csv",t,{headers:{"Content-Type":"multipart/form-data"}})).data},Cae=async e=>{const t=new FormData;return t.append("file",e),(await ve.post("/api/invoices/upload-unit-numbers",t,{headers:{"Content-Type":"multipart/form-data"}})).data},Aae=()=>{const{id:e}=Ms(),t=Tn(),r=e==="new";console.log("Debug - URL id parameter:",e),console.log("Debug - isNewCustomer calculated:",r);const[n,a]=x.useState(!1),[o,s]=x.useState(!1),[l,c]=x.useState(null),[u,d]=x.useState(!1),[f,h]=x.useState(()=>Rt().format("YYYY-MM")),[p,v]=x.useState({customer_name:"",email:"",phone_number:"",street_address:"",city:"",province:"",country:"",postal_code:"",contact_person:"",website:"",general_notes:"",default_payment_terms_in_days:30});x.useEffect(()=>{!r&&e?m():r&&d(!0)},[e,r]);const m=async()=>{a(!0);try{if(!e)throw new Error("Customer ID is required");const _=await KL(e);v(_)}catch(_){console.error("Error fetching customer:",_),c("Failed to load customer data"),ge.error("Failed to load customer data")}finally{a(!1)}},y=async()=>{if(e)try{const _=await _ae(Number(e),f),w=new Blob([_.data],{type:"application/pdf"}),A=window.URL.createObjectURL(w),P=document.createElement("a");P.href=A,P.download=`statement-${p.customer_name||"customer"}-${f||"current"}.pdf`,P.click(),window.URL.revokeObjectURL(A)}catch(_){console.error("Error downloading statement:",_),ge.error("Failed to download statement")}},b=()=>{t("/customers")};return n?i.jsx(rr,{maxWidth:"md",children:i.jsx(Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:i.jsx(tr,{})})}):i.jsx(rr,{maxWidth:"md",children:i.jsxs(Z,{sx:{my:4},children:[i.jsxs(Z,{sx:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:2,mb:3},children:[i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(xe,{startIcon:i.jsx(CI,{}),onClick:b,sx:{mr:0},children:"Back to Customers"}),i.jsx(B,{variant:"h4",component:"h1",children:r?"Add New Customer":"Edit Customer"})]}),!r&&i.jsxs(dt,{direction:"row",spacing:1,alignItems:"center",sx:{marginLeft:{xs:0,sm:"auto"}},children:[i.jsx(Pe,{label:"Statement Month",type:"month",size:"small",value:f,onChange:_=>h(_.target.value),InputLabelProps:{shrink:!0}}),i.jsx(xe,{variant:"outlined",onClick:y,children:"Download Monthly Statement"})]})]}),l&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:l}),i.jsx(Wd,{open:u,onClose:()=>{d(!1),b()},onSave:async _=>{s(!0);try{r?(await QL(_),ge.success("Customer created successfully")):(await fS(e,_),ge.success("Customer updated successfully")),t("/customers")}catch{ge.error("Failed to save customer")}finally{s(!1)}},initialCustomer:r?{}:p,isEditMode:!r,loading:o})]})})},Pae=async()=>(await ve.get("/api/vendors")).data,p4=async e=>(await ve.get(`/api/vendors/${e}/contacts`)).data,Oae=async(e,t)=>(await ve.post(`/api/vendors/${e}/contacts/people`,t)).data,kae=async(e,t,r)=>(await ve.put(`/api/vendors/${e}/contacts/people/${t}`,r)).data,Tae=async(e,t)=>(await ve.delete(`/api/vendors/${e}/contacts/people/${t}`)).data,Eae=async(e,t)=>(await ve.post(`/api/vendors/${e}/contacts/emails`,t)).data,Iae=async(e,t,r)=>(await ve.put(`/api/vendors/${e}/contacts/emails/${t}`,r)).data,Nae=async(e,t)=>(await ve.delete(`/api/vendors/${e}/contacts/emails/${t}`)).data,Dae=async(e,t)=>(await ve.post(`/api/vendors/${e}/contacts/phones`,t)).data,Mae=async(e,t,r)=>(await ve.put(`/api/vendors/${e}/contacts/phones/${t}`,r)).data,Lae=async(e,t)=>(await ve.delete(`/api/vendors/${e}/contacts/phones/${t}`)).data,Rae=async(e,t)=>{const r=new FormData;return r.append("file",e),(await ve.post("/api/vendors/import-excel",r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:t})).data},qae=()=>ve.get("/api/vendors/import-excel/template",{responseType:"blob"}),m4={vendor_name:"",street_address:"",city:"",province:"",country:"",postal_code:"",contact_person:"",telephone_number:"",email:"",website:""},JL=({open:e,onClose:t,onSave:r,initialVendor:n,isEditMode:a=!1,loading:o=!1})=>{const[s,l]=x.useState(m4),[c,u]=x.useState({}),d=Ay(s,300),[f,h]=x.useState([]),[p,v]=x.useState([]),[m,y]=x.useState([]),[b,_]=x.useState([]),[w,A]=x.useState(""),[P,T]=x.useState(""),[E,S]=x.useState(""),[I,W]=x.useState("");x.useEffect(()=>{if(e){console.log("UnifiedVendorDialog: Setting vendor with initialVendor:",n);const U={...m4,...n};l(U),!a&&!n?.city&&!n?.province&&!n?.country&&R(),(async()=>{try{const le=await ve.get("/api/vendors");h(le.data||[])}catch{}})();const te=n?.vendor_id;a&&te?(async()=>{try{const le=await p4(te);v(le.people||[]),y(le.emails||[]),_(le.phones||[])}catch{}})():(v([]),y([]),_([]))}},[e,n,a]);const O=U=>{const{name:te,value:le}=U.target;l(oe=>({...oe,[te]:le})),c[te]&&u(oe=>({...oe,[te]:void 0}))},D=()=>{r(s)};x.useEffect(()=>{if(!e)return;const U={};if(d.email&&d.email.trim().length>0&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email.trim())||(U.email="Invalid email format")),d.vendor_name&&d.vendor_name.trim().length>0){const te=d.vendor_name.trim().toLowerCase();f.some(oe=>(oe.vendor_name||"").trim().toLowerCase()===te)&&!a&&(U.vendor_name="Vendor name already exists")}u(te=>({...te,...U}))},[d,e,a,f]);const R=async()=>{try{const U=await XL();l(te=>({...te,city:U.city,province:U.province,country:U.country})),console.log("Autofilled vendor form with business profile data:",U)}catch(U){console.error("Error autofilling from business profile:",U)}},F=n?.vendor_id,z=async()=>{if(!(!a||!F))try{const U=await p4(F);v(U.people||[]),y(U.emails||[]),_(U.phones||[])}catch{}},K=async()=>{!F||!w.trim()||(await Oae(F,{name:w.trim()}),A(""),z())},J=async U=>{F&&(await kae(F,U,{is_preferred:!0}),z())},L=async U=>{F&&(await Tae(F,U),z())},k=async()=>{!F||!P.trim()||(await Eae(F,{email:P.trim()}),T(""),z())},$=async U=>{F&&(await Iae(F,U,{is_preferred:!0}),z())},X=async U=>{F&&(await Nae(F,U),z())},C=async()=>{!F||!E.trim()||(await Dae(F,{phone:E.trim(),label:I.trim()||void 0}),S(""),W(""),z())},M=async U=>{F&&(await Mae(F,U,{is_preferred:!0}),z())},H=async U=>{F&&(await Lae(F,U),z())};return i.jsxs(pr,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,sx:{zIndex:U=>U.zIndex.modal+5},children:[i.jsx(mr,{children:a?"Edit Vendor":"Add New Vendor"}),i.jsx(gr,{sx:{form:{autoComplete:"off"}},children:i.jsxs(ie,{container:!0,spacing:2,sx:{mt:1},children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"vendor_name",label:"Vendor Name",value:s.vendor_name,onChange:O,fullWidth:!0,required:!0,error:!!c.vendor_name,helperText:c.vendor_name,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"contact_person",label:"Contact Person",value:s.contact_person,onChange:O,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"email",label:"Email",type:"email",value:s.email,onChange:O,fullWidth:!0,error:!!c.email,helperText:c.email,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"telephone_number",label:"Telephone",value:s.telephone_number,onChange:O,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{name:"street_address",label:"Street Address",value:s.street_address,onChange:O,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"city",label:"City",value:s.city,onChange:O,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"province",label:"Province/State",value:s.province,onChange:O,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"country",label:"Country",value:s.country,onChange:O,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{name:"postal_code",label:"Postal Code",value:s.postal_code,onChange:O,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{name:"website",label:"Website",value:s.website,onChange:O,fullWidth:!0,autoComplete:"new-password",inputProps:{autoComplete:"new-password"}})}),a&&F&&i.jsx(ie,{item:!0,xs:12,children:i.jsxs(Z,{sx:{mt:2},children:[i.jsx(B,{variant:"h6",sx:{mb:1},children:"Contacts"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"People"}),i.jsxs(dt,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Pe,{size:"small",label:"Name",value:w,onChange:U=>A(U.target.value),fullWidth:!0}),i.jsx(xe,{variant:"outlined",size:"small",onClick:K,children:"Add"})]}),i.jsxs(dt,{spacing:1,children:[p.map(U=>i.jsxs(dt,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[U.name," ",U.is_preferred?"(Preferred)":""]}),!U.is_preferred&&i.jsx(xe,{size:"small",onClick:()=>J(U.id),children:"Set Preferred"}),i.jsx(xe,{size:"small",color:"error",onClick:()=>L(U.id),children:"Remove"})]},U.id)),p.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No people yet."})]})]}),i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"Emails"}),i.jsxs(dt,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Pe,{size:"small",label:"Email",value:P,onChange:U=>T(U.target.value),fullWidth:!0}),i.jsx(xe,{variant:"outlined",size:"small",onClick:k,children:"Add"})]}),i.jsxs(dt,{spacing:1,children:[m.map(U=>i.jsxs(dt,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[U.email," ",U.is_preferred?"(Preferred)":""]}),!U.is_preferred&&i.jsx(xe,{size:"small",onClick:()=>$(U.id),children:"Set Preferred"}),i.jsx(xe,{size:"small",color:"error",onClick:()=>X(U.id),children:"Remove"})]},U.id)),m.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No emails yet."})]})]}),i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"Phones"}),i.jsxs(dt,{direction:"row",spacing:1,sx:{mb:1},children:[i.jsx(Pe,{size:"small",label:"Phone",value:E,onChange:U=>S(U.target.value),fullWidth:!0}),i.jsx(Pe,{size:"small",label:"Label",value:I,onChange:U=>W(U.target.value),sx:{width:120}}),i.jsx(xe,{variant:"outlined",size:"small",onClick:C,children:"Add"})]}),i.jsxs(dt,{spacing:1,children:[b.map(U=>i.jsxs(dt,{direction:"row",spacing:1,alignItems:"center",children:[i.jsxs(B,{variant:"body2",sx:{flex:1},children:[U.phone,U.label?` (${U.label})`:""," ",U.is_preferred?"(Preferred)":""]}),!U.is_preferred&&i.jsx(xe,{size:"small",onClick:()=>M(U.id),children:"Set Preferred"}),i.jsx(xe,{size:"small",color:"error",onClick:()=>H(U.id),children:"Remove"})]},U.id)),b.length===0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"No phones yet."})]})]})]})]})})]})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:t,children:"Cancel"}),i.jsx(xe,{onClick:D,variant:"contained",disabled:o,children:a?"Save Changes":"Add Vendor"})]})]})},Fae=()=>{const[e,t]=x.useState(""),[r,n]=x.useState([]),[a,o]=x.useState(!1),[s,l]=x.useState({page:0,pageSize:10}),[c,u]=x.useState(!1),[d,f]=x.useState(!1),[h,p]=x.useState({}),[v,m]=x.useState(!1),[y,b]=x.useState(0),[_,w]=x.useState(null),[A,P]=x.useState(!1),T=x.useRef(null),E=r.filter(k=>(k.vendor_name||"").toLowerCase().includes(e.toLowerCase())||(k.contact_person||"").toLowerCase().includes(e.toLowerCase())||(k.email||"").toLowerCase().includes(e.toLowerCase())),S=[{field:"vendor_name",headerName:"Vendor Name",flex:1.5},{field:"contact_person",headerName:"Contact Person",flex:1},{field:"email",headerName:"Email",flex:1.5},{field:"telephone_number",headerName:"Phone Number",flex:1},{field:"actions",headerName:"Actions",width:100,sortable:!1,renderCell:k=>i.jsx(xr,{size:"small",color:"error",onClick:$=>{$.stopPropagation(),J(k.row.vendor_id)},children:i.jsx(ma,{})})}],I=async()=>{o(!0);try{const $=(await Pae()).map(X=>({...X,id:X.vendor_id}));n($)}catch{ge.error("Failed to fetch vendors.")}finally{o(!1)}};x.useEffect(()=>{I()},[]);const W=(k=null)=>{k?(f(!0),p(k)):(f(!1),p({vendor_name:"",street_address:"",city:"",province:"",country:"",contact_person:"",telephone_number:"",email:"",website:"",postal_code:""})),u(!0)},O=()=>{u(!1),p({})},D=()=>{T.current?.click()},R=async k=>{const $=k.target.files?.[0];$&&(await F($),k.target.value="")},F=async k=>{m(!0),b(0),w(null);try{const $=await Rae(k,X=>{if(X?.total){const C=Math.round(X.loaded*90/X.total);b(C)}});if(b(100),w($),P(!0),Array.isArray($?.createdVendors)&&$.createdVendors.length>0){const X=$.createdVendors.map(C=>({...C,id:C.vendor_id??C.id}));n(C=>[...C,...X])}else I();ge.success("Vendor import completed")}catch($){console.error("Error uploading Excel:",$);const X=$?.response?.data,C=X?.error||"Failed to import vendors";w({error:C,errors:X?.errors||[],warnings:X?.warnings||[]}),P(!0),ge.error(C)}finally{m(!1),b(0)}},z=async()=>{try{const k=await qae(),$=new Blob([k.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),X=window.URL.createObjectURL($),C=document.createElement("a");C.href=X,C.download="vendor_import_template.xlsx",document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL(X)}catch(k){console.error("Error downloading vendor template",k),ge.error("Failed to download vendor template")}},K=()=>{P(!1),w(null)},J=async k=>{if(window.confirm("Are you sure you want to delete this vendor?"))try{await ve.delete(`/api/vendors/${k}`),ge.success("Vendor deleted successfully!"),I()}catch($){$ instanceof di?ge.error($.response?.data?.error||"Failed to delete vendor."):ge.error("An unexpected error occurred while deleting the vendor.")}},L=()=>{const k=Cl.unparse(E),$=new Blob([k],{type:"text/csv;charset=utf-8;"}),X=document.createElement("a");if(X.download!==void 0){const C=URL.createObjectURL($);X.setAttribute("href",C),X.setAttribute("download","vendor_list.csv"),X.style.visibility="hidden",document.body.appendChild(X),X.click(),document.body.removeChild(X)}};return i.jsxs(rr,{maxWidth:"xl",children:[i.jsxs(Z,{sx:{my:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Vendor Management"}),i.jsxs(dt,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:()=>W(),children:"New Vendor"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(YL,{}),onClick:D,children:"Import Excel"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:z,children:"Download Template"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:L,children:"Export CSV"})]}),i.jsx("input",{type:"file",accept:".xlsx,.xls",ref:T,style:{display:"none"},onChange:R}),v&&i.jsxs(bt,{sx:{p:2,mb:2},children:[i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Uploading Excel file..."}),i.jsx(Ed,{variant:"determinate",value:y}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[y,"% complete"]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2,width:"100%"},children:[i.jsx(Pe,{fullWidth:!0,variant:"outlined",placeholder:"Search vendors...",value:e,onChange:k=>t(k.target.value),InputProps:{startAdornment:i.jsx(sa,{position:"start",children:i.jsx(fi,{})})},sx:{mb:2}}),i.jsx(Po,{rows:E,columns:S,loading:a,paginationModel:s,onPaginationModelChange:l,pageSizeOptions:[10,25,50],getRowId:k=>k.vendor_id,onRowClick:k=>W(k.row),disableRowSelectionOnClick:!0,sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),i.jsxs(pr,{open:A,onClose:K,maxWidth:"md",fullWidth:!0,children:[i.jsx(mr,{children:_?.error?"Import Failed":"Import Completed"}),i.jsx(gr,{children:_&&i.jsxs(Z,{children:[_.error?i.jsx(Ot,{severity:"error",sx:{mb:2},children:_.error}):i.jsx(Ot,{severity:"success",sx:{mb:2},children:_.message||"Vendors imported successfully"}),_.summary&&i.jsx(Z,{sx:{mb:3},children:i.jsxs(ie,{container:!0,spacing:1,children:[i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(st,{label:`Total rows: ${_.summary.totalRows||0}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(st,{label:`Accepted: ${_.summary.acceptedRows||0}`,color:"info"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(st,{label:`Created: ${_.summary.created||0}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:3,children:i.jsx(st,{label:`Skipped: ${_.summary.skipped||0}`,color:"warning"})})]})}),_.errors&&_.errors.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"error",gutterBottom:!0,children:["Errors (",_.errors.length,")"]}),i.jsx(ha,{dense:!0,children:_.errors.map((k,$)=>i.jsx(ja,{children:i.jsx(Qn,{primary:k})},$))})]}),_.warnings&&_.warnings.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"warning.main",gutterBottom:!0,children:["Warnings (",_.warnings.length,")"]}),i.jsx(ha,{dense:!0,children:_.warnings.map((k,$)=>i.jsx(ja,{children:i.jsx(Qn,{primary:k})},$))})]})]})}),i.jsx(jr,{children:i.jsx(xe,{onClick:K,variant:"contained",children:"Close"})})]})]}),i.jsx(JL,{open:c,onClose:O,onSave:async k=>{try{d?(await ve.put(`/api/vendors/${h.vendor_id}`,k),ge.success("Vendor updated successfully!")):(await ve.post("/api/vendors",k),ge.success("Vendor added successfully!")),O(),I()}catch($){$ instanceof di?ge.error($.response?.data?.error||`Failed to ${d?"update":"add"} vendor.`):ge.error(`An unexpected error occurred while ${d?"updating":"adding"} the vendor.`)}},initialVendor:h,isEditMode:d})]})},$ae=()=>{const{id:e}=Ms();return i.jsx(rr,{maxWidth:"md",children:i.jsxs(Z,{sx:{my:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Vendor Detail Page"}),i.jsxs(bt,{sx:{p:3},children:[i.jsxs(B,{variant:"h6",children:["Vendor ID: ",e]}),i.jsx(B,{variant:"body1",children:"This is a placeholder for the Vendor Detail Page."})]})]})})},Bae=()=>{const{id:e}=Ms();return i.jsx(rr,{maxWidth:"md",children:i.jsxs(Z,{sx:{my:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Product Detail Page"}),i.jsxs(bt,{sx:{p:3},children:[i.jsxs(B,{variant:"h6",children:["Product ID: ",e]}),i.jsx(B,{variant:"body1",children:"This is a placeholder for the Product Detail Page."})]})]})})};var If={},g4;function Uae(){if(g4)return If;g4=1;var e=sr();Object.defineProperty(If,"__esModule",{value:!0}),If.default=void 0;var t=e(cr()),r=lr();return If.default=(0,t.default)((0,r.jsx)("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"}),"Upload"),If}var zae=Uae();const Cd=Et(zae),Py=async e=>{const t=e?{partType:e}:{};return(await ve.get("/api/inventory",{params:t})).data},Wae=async()=>Py("stock"),Hae=async()=>Py("supply"),Vae=async()=>Py("service"),ZL=async e=>(await ve.get(`/api/inventory/${encodeURIComponent(e)}`)).data,e6=async e=>(await ve.post("/api/inventory/cleanup-enforce",{partType:e,apply:!1})).data,hS=async(e,t)=>(await ve.post("/api/inventory/cleanup-enforce",{partType:e,apply:!0,merges:t})).data,Jm=async e=>(await ve.get(`/api/inventory/${encodeURIComponent(e)}/vendors`)).data,Em=async e=>(await ve.get(`/api/inventory/part/${e}/vendors`)).data,Gae=async(e,t)=>(await ve.post(`/api/inventory/${encodeURIComponent(e)}/vendors`,t)).data,Yae=async(e,t)=>(await ve.post(`/api/inventory/part/${e}/vendors`,t)).data,Kae=async(e,t,r)=>(await ve.put(`/api/inventory/${encodeURIComponent(e)}/vendors/${t}`,r)).data,Qae=async(e,t,r)=>(await ve.put(`/api/inventory/part/${e}/vendors/${t}`,r)).data,Xae=async(e,t)=>(await ve.delete(`/api/inventory/${encodeURIComponent(e)}/vendors/${t}`)).data,Jae=async(e,t)=>(await ve.delete(`/api/inventory/part/${e}/vendors/${t}`)).data,Zae=async()=>(await ve.get("/api/categories")).data,eie=async e=>(await ve.post("/api/categories",e)).data.category,v4=async(e,t)=>{const r=t?{reassign:"true"}:{};await ve.delete(`/api/categories/${e}`,{params:r})},f2="__ADD_NEW_CATEGORY__",tie=({value:e,onChange:t,label:r="Category",error:n,errorMessage:a,fullWidth:o=!0,disabled:s})=>{const[l,c]=x.useState([]),[u,d]=x.useState(!1),[f,h]=x.useState(!1),[p,v]=x.useState(""),[m,y]=x.useState(""),[b,_]=x.useState(!1),{user:w}=ta();x.useEffect(()=>{let S=!0;return(async()=>{d(!0);try{const W=await Zae();S&&c(W)}catch(W){console.error("CategorySelect: failed to load categories",W),ge.error("Failed to load categories")}finally{S&&d(!1)}})(),()=>{S=!1}},[]);const A=x.useMemo(()=>{const S=l.map(I=>I.category_name);return S.some(I=>I.toLowerCase()==="uncategorized")||S.unshift("Uncategorized"),S.sort((I,W)=>I.localeCompare(W))},[l]),P=S=>{const I=S.target.value;if(I===f2){h(!0);return}t(I)},T=async(S,I)=>{if(I?.preventDefault(),I?.stopPropagation(),S.category_name.toLowerCase()==="uncategorized"){ge.warn('Cannot delete the default "Uncategorized" category');return}if(w?.access_role!=="Admin"){ge.error("Only Admin users can delete categories");return}if(window.confirm(`Delete category "${S.category_name}"? This cannot be undone.`))try{await v4(S.category_id),c(O=>O.filter(D=>D.category_id!==S.category_id)),e&&e.toLowerCase()===S.category_name.toLowerCase()&&t("Uncategorized"),ge.success("Category deleted")}catch(O){const D=O?.response?.data;if(D?.error==="Cannot delete category"&&D?.suggestion){if(window.confirm(`${D.details}

${D.suggestion}

Would you like to reassign all items to "Uncategorized" and delete the category?`))try{await v4(S.category_id,!0),c(F=>F.filter(z=>z.category_id!==S.category_id)),e&&e.toLowerCase()===S.category_name.toLowerCase()&&t("Uncategorized"),ge.success(D.details?`Category deleted. ${D.details}`:"Category deleted")}catch(F){const z=F?.response?.data?.error||"Failed to delete category";ge.error(z)}}else{const R=D?.error||"Failed to delete category";ge.error(R)}}},E=async()=>{const S=p.trim();if(!S){ge.warn("Please enter a category name");return}if(A.some(I=>I.toLowerCase()===S.toLowerCase())){ge.warn("Category already exists");return}_(!0);try{const I=m.trim(),W=await eie({category_name:S,description:I||void 0});c(O=>[...O,W]),h(!1),v(""),y(""),t(W.category_name),ge.success("Category added")}catch(I){console.error("CategorySelect: failed to create category",I),ge.error("Failed to add category")}finally{_(!1)}};return i.jsxs(i.Fragment,{children:[i.jsxs(Pe,{label:r,value:e,onChange:P,select:!0,fullWidth:o,required:!0,error:!!n,helperText:a,disabled:s||u,children:[l.slice().sort((S,I)=>S.category_name.localeCompare(I.category_name)).map(S=>i.jsxs(Zt,{value:S.category_name,sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("span",{children:S.category_name}),w?.access_role==="Admin"&&S.category_name.toLowerCase()!=="uncategorized"&&i.jsx(xr,{"aria-label":`Delete ${S.category_name}`,size:"small",edge:"end",onClick:I=>T(S,I),sx:{ml:2,color:"error.main"},children:i.jsx(ma,{fontSize:"small"})})]},S.category_id)),i.jsx(Zt,{value:f2,children:"+ Add new category"},f2)]}),i.jsxs(pr,{open:f,onClose:()=>h(!1),maxWidth:"xs",fullWidth:!0,children:[i.jsx(mr,{children:"Add New Category"}),i.jsx(gr,{children:i.jsxs(dt,{spacing:2,sx:{mt:1},children:[i.jsx(Pe,{label:"Category Name",value:p,onChange:S=>v(S.target.value),autoFocus:!0,fullWidth:!0}),i.jsx(Pe,{label:"Description (optional)",value:m,onChange:S=>y(S.target.value),fullWidth:!0,multiline:!0,minRows:2})]})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:()=>h(!1),disabled:b,children:"Cancel"}),i.jsx(xe,{onClick:E,variant:"contained",disabled:b,children:"Save"})]})]})]})},h2=["Each","cm","ft","ft^2","kg","pcs","L"],rie=["stock","supply","service"],tc=({open:e,onClose:t,onSave:r,initialPart:n,isEditMode:a=!1,title:o})=>{const{user:s}=ta(),[l,c]=x.useState({part_number:"",part_description:"",unit:h2[0],last_unit_cost:"",quantity_on_hand:"",reorder_point:"",part_type:"stock",category:"Uncategorized",...n||{}}),[u,d]=x.useState({}),[f,h]=x.useState(!1),p=x.useRef(null),[v,m]=x.useState(null),y=x.useRef(null);x.useEffect(()=>{e&&(c({part_id:n?.part_id,part_number:n?.part_number||"",part_description:n?.part_description||"",unit:n?.unit||h2[0],last_unit_cost:n?.last_unit_cost||"",quantity_on_hand:n?.quantity_on_hand||"",reorder_point:n?.reorder_point||"",part_type:n?.part_type||"stock",category:n?.category||"Uncategorized"}),d({}),h(!1),m(null))},[e,n?.part_id,n?.part_number]),x.useEffect(()=>{e&&p.current&&setTimeout(()=>p.current?.focus(),100)},[e]);const b=(C,M)=>{C==="part_number"&&(M=M.toUpperCase()),c(C==="part_type"&&(M==="supply"||M==="service")?H=>({...H,[C]:M,quantity_on_hand:"NA"}):H=>({...H,[C]:M})),u[C]&&d(H=>({...H,[C]:void 0}))};x.useEffect(()=>{if(!e)return;const C=(l.part_number||"").trim();if(y.current&&window.clearTimeout(y.current),!C){m(null);return}return y.current=window.setTimeout(async()=>{try{const M=await ZL(C),H=M?.item||M,U=String(H?.part_number||"").toUpperCase(),te=String(n?.part_number||"").toUpperCase(),le=H?.part_id,oe=te&&te===U;U&&U===C.toUpperCase()&&!oe&&(!l.part_id||l.part_id!==le)?m(`Part number ${U} already exists. Saving will update that part.`):m(null)}catch{m(null)}},400),()=>{y.current&&window.clearTimeout(y.current)}},[l.part_number,l.part_id,e,n?.part_number]);const _=()=>{const C={};if(l.part_number.trim()||(C.part_number="Part Number is required"),l.part_description.trim()||(C.part_description="Part Description is required"),l.unit||(C.unit="Unit is required"),l.part_type||(C.part_type="Part Type is required"),["stock","supply","service"].includes(l.part_type)||(C.part_type='Part Type must be either "stock", "supply", or "service"'),(!l.category||l.category.trim()==="")&&(C.category="Category is required"),!(l.part_type==="supply"||l.part_type==="service")){const U=parseFloat(String(l.quantity_on_hand));l.quantity_on_hand!==""&&(isNaN(U)||U<0)&&(C.quantity_on_hand="Quantity on Hand must be a valid number >= 0")}const M=parseFloat(String(l.last_unit_cost));l.last_unit_cost!==""&&isNaN(M)&&(C.last_unit_cost="Last Unit Cost must be a valid number");const H=parseFloat(String(l.reorder_point));return l.reorder_point!==""&&isNaN(H)&&(C.reorder_point="Reorder Point must be a valid number"),d(C),Object.keys(C).length===0},w=async()=>{if(!_()){ge.error("Please correct the errors before saving.");return}h(!0);try{const C={...l,part_number:l.part_number.trim().toUpperCase(),part_description:l.part_description.trim(),unit:l.unit.trim(),last_unit_cost:l.last_unit_cost===""?null:parseFloat(String(l.last_unit_cost)),quantity_on_hand:l.part_type==="supply"||l.part_type==="service"?"NA":l.quantity_on_hand===""?0:parseFloat(String(l.quantity_on_hand)),reorder_point:l.reorder_point===""?null:parseFloat(String(l.reorder_point)),part_type:l.part_type.trim(),category:l.category.trim()},M=await r(C);M?.warning&&ge.warning(M.warning),ge.success(`Part ${a?"updated":"added"} successfully!`),t()}catch(C){console.error("Error saving part:",C);let M=`Failed to ${a?"update":"add"} part.`;C.response?.data?.error?M=C.response.data.error:C.response?.data?.message&&(M=C.response.data.message),C.response?.status===409||M.includes("Part number already exists")||M.includes("duplicate key value")||M.includes("already exists")?(d(H=>({...H,part_number:"Part number already exists. Please use a unique part number."})),ge.error("Part number already exists. Please use a unique part number.")):ge.error(M)}finally{h(!1)}},A=()=>{f||t()},P=o||(a?"Edit Part":"Add New Part"),[T,E]=x.useState([]),[S,I]=x.useState([]),[W,O]=x.useState(""),[D,R]=x.useState(""),[F,z]=x.useState(""),[K,J]=x.useState(!1),L=!!l.part_id;x.useEffect(()=>{e&&(async()=>{try{const C=await ve.get("/api/vendors");I(C.data||[])}catch{}})()},[e]),x.useEffect(()=>{if(!e)return;const C=l.part_id;if(!C){E([]);return}(async()=>{try{const M=await Em(C);E(M||[])}catch{E([])}})()},[e,l.part_id]);const k=async()=>{const C=String(l.part_number||"").trim().toUpperCase();if(C){if(!W||!D.trim()){ge.error("Select a vendor and enter vendor part number");return}try{const M={vendor_id:Number(W),vendor_part_number:D.trim().toUpperCase(),vendor_part_description:F||void 0,preferred:K};if(l.part_id){await Yae(l.part_id,M);const H=await Em(l.part_id);E(H||[])}else{await Gae(C,M);const H=await Jm(C);E(H||[])}O(""),R(""),z(""),J(!1),ge.success("Vendor mapping added")}catch(M){ge.error(M?.response?.data?.error||"Failed to add vendor mapping")}}},$=async C=>{try{if(l.part_id){await Qae(l.part_id,C.id,{preferred:!C.preferred});const M=await Em(l.part_id);E(M||[])}else{await Kae(l.part_number.toUpperCase(),C.id,{preferred:!C.preferred});const M=await Jm(l.part_number.toUpperCase());E(M||[])}}catch{ge.error("Failed to update preferred")}},X=async C=>{if(window.confirm("Remove this vendor mapping?"))try{if(l.part_id){await Jae(l.part_id,C.id);const M=await Em(l.part_id);E(M||[])}else{await Xae(l.part_number.toUpperCase(),C.id);const M=await Jm(l.part_number.toUpperCase());E(M||[])}}catch{ge.error("Failed to delete mapping")}};return i.jsxs(pr,{open:e,onClose:A,maxWidth:"md",fullWidth:!0,children:[i.jsx(mr,{children:P}),i.jsx(gr,{children:i.jsxs(dt,{spacing:3,sx:{mt:1},children:[i.jsxs(ie,{container:!0,spacing:2,children:[i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx(Pe,{label:"Part Number",value:l.part_number,onChange:C=>b("part_number",C.target.value),fullWidth:!0,required:!0,error:!!u.part_number,helperText:u.part_number,inputRef:p}),!u.part_number&&v&&i.jsx(Ot,{severity:"warning",sx:{mt:1},children:v})]}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Part Type",value:l.part_type,onChange:C=>b("part_type",C.target.value),select:!0,fullWidth:!0,required:!0,error:!!u.part_type,helperText:u.part_type,children:rie.map(C=>i.jsx(Zt,{value:C,children:C.charAt(0).toUpperCase()+C.slice(1)},C))})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(tie,{label:"Category",value:l.category,onChange:C=>b("category",C),error:!!u.category,errorMessage:u.category})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Part Description",value:l.part_description,onChange:C=>b("part_description",C.target.value),fullWidth:!0,required:!0,error:!!u.part_description,helperText:u.part_description,multiline:!0,rows:2})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"Unit",value:l.unit,onChange:C=>b("unit",C.target.value),select:!0,fullWidth:!0,required:!0,error:!!u.unit,helperText:u.unit,children:h2.map(C=>i.jsx(Zt,{value:C,children:C},C))})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"Last Unit Cost",value:l.last_unit_cost,onChange:C=>b("last_unit_cost",C.target.value),type:"number",fullWidth:!0,error:!!u.last_unit_cost,helperText:u.last_unit_cost,inputProps:{step:"0.01",min:"0"}})}),l.part_type==="stock"&&i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"Quantity on Hand",value:l.quantity_on_hand,onChange:C=>b("quantity_on_hand",C.target.value),type:"number",fullWidth:!0,error:!!u.quantity_on_hand,helperText:u.quantity_on_hand,inputProps:{step:"1",min:"0"},disabled:s?.access_role==="Sales and Purchase"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Reorder Point",value:l.reorder_point,onChange:C=>b("reorder_point",C.target.value),type:"number",fullWidth:!0,error:!!u.reorder_point,helperText:u.reorder_point,inputProps:{step:"1",min:"0"}})})]}),Object.keys(u).length>0&&i.jsx(Ot,{severity:"error",children:i.jsx(B,{variant:"body2",children:"Please correct the errors above before saving."})}),i.jsxs(Z,{children:[i.jsx(B,{variant:"h6",sx:{mb:1},children:"Vendors"}),!L&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"Save the part first to manage vendor mappings."}),L&&i.jsxs(i.Fragment,{children:[i.jsxs(ie,{container:!0,spacing:1,sx:{mb:1},children:[i.jsx(ie,{item:!0,xs:12,sm:3,children:i.jsxs(Pe,{label:"Vendor",select:!0,value:W,onChange:C=>O(C.target.value===""?"":Number(C.target.value)),fullWidth:!0,SelectProps:{native:!0},children:[i.jsx("option",{value:""}),S.map(C=>i.jsx("option",{value:C.vendor_id,children:C.vendor_name},C.vendor_id))]})}),i.jsx(ie,{item:!0,xs:12,sm:3,children:i.jsx(Pe,{label:"Vendor Part #",value:D,onChange:C=>R(C.target.value),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"Vendor Part Description",value:F,onChange:C=>z(C.target.value),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:2,children:i.jsx(xe,{variant:"outlined",onClick:()=>J(C=>!C),fullWidth:!0,children:K?"Preferred ":"Preferred"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(xe,{variant:"contained",onClick:k,children:"Add Vendor Mapping"})})]}),T.length===0?i.jsx(B,{variant:"body2",color:"text.secondary",children:"No vendor mappings yet."}):i.jsxs(ie,{container:!0,spacing:1,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsxs(ie,{container:!0,spacing:1,sx:{fontWeight:600,mb:1},children:[i.jsx(ie,{item:!0,xs:12,sm:2.5,children:"Vendor"}),i.jsx(ie,{item:!0,xs:12,sm:2.5,children:"Vendor Part #"}),i.jsx(ie,{item:!0,xs:12,sm:3,children:"Description"}),i.jsx(ie,{item:!0,xs:12,sm:1,children:"Pref"}),i.jsx(ie,{item:!0,xs:12,sm:3,children:"Actions"})]})}),T.map(C=>i.jsx(ie,{item:!0,xs:12,children:i.jsxs(ie,{container:!0,spacing:1,alignItems:"center",sx:{py:1,borderBottom:"1px solid #e0e0e0"},children:[i.jsx(ie,{item:!0,xs:12,sm:2.5,children:i.jsx(B,{variant:"body2",noWrap:!0,children:C.vendor_name||C.vendor_id})}),i.jsx(ie,{item:!0,xs:12,sm:2.5,children:i.jsx(B,{variant:"body2",noWrap:!0,children:C.vendor_part_number})}),i.jsx(ie,{item:!0,xs:12,sm:3,children:i.jsx(B,{variant:"body2",noWrap:!0,children:C.vendor_part_description||""})}),i.jsx(ie,{item:!0,xs:12,sm:1,sx:{textAlign:"center"},children:C.preferred?"":""}),i.jsx(ie,{item:!0,xs:12,sm:3,children:i.jsxs(dt,{direction:"row",spacing:1,sx:{flexWrap:"wrap"},children:[i.jsx(xe,{size:"small",variant:"outlined",onClick:()=>$(C),sx:{minWidth:"fit-content"},children:C.preferred?"Unset":"Set Preferred"}),i.jsx(xe,{size:"small",color:"error",variant:"outlined",onClick:()=>X(C),sx:{minWidth:"fit-content"},children:"Remove"})]})})]})},C.id))]})]})]})]})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:A,disabled:f,children:"Cancel"}),i.jsx(xe,{onClick:w,variant:"contained",disabled:f,children:f?"Saving...":a?"Update Part":"Save Part"})]})]})},nie=()=>{const[e,t]=x.useState(""),[r,n]=x.useState([]),[a,o]=x.useState(!1),[s,l]=x.useState(!1),[c,u]=x.useState(null),[d,f]=x.useState(!1),[h,p]=x.useState(0),[v,m]=x.useState(null),[y,b]=x.useState(!1),_=x.useRef(null),[w,A]=x.useState(!1),[P,T]=x.useState(null),[E,S]=x.useState(!1),[I,W]=x.useState(null),[O,D]=x.useState(!1),[R,F]=x.useState({page:0,pageSize:10}),{user:z}=ta(),K=async()=>{o(!0);try{const ee=await Wae();console.log("Raw inventory response:",ee),ee.length>0&&console.log("Sample inventory item from frontend:",{part_id:ee[0].part_id,part_number:ee[0].part_number,last_unit_cost:ee[0].last_unit_cost,last_unit_cost_type:typeof ee[0].last_unit_cost,quantity_on_hand:ee[0].quantity_on_hand,quantity_on_hand_type:typeof ee[0].quantity_on_hand});const se=ee.map((V,Ge)=>({...V,id:V.part_number||Ge}));n(se)}catch(ee){console.error("Error fetching inventory:",ee)}finally{o(!1)}};x.useEffect(()=>{K();const ee=()=>K();return window.addEventListener("inventory-updated",ee),()=>window.removeEventListener("inventory-updated",ee)},[]);const J=r.filter(ee=>ee.part_number?.toUpperCase().includes(e.toUpperCase())||ee.part_description?.toLowerCase().includes(e.toLowerCase())),L=[{field:"part_number",headerName:"Part #",flex:1,headerAlign:"left",editable:!0},{field:"part_description",headerName:"Part Description",flex:2,headerAlign:"left"},{field:"category",headerName:"Category",flex:1,headerAlign:"left"},{field:"quantity_on_hand",headerName:"Quantity on Hand",flex:1,type:"number",editable:z?.access_role!=="Sales and Purchase",align:"center",headerAlign:"left"},{field:"unit",headerName:"UOM",flex:.5,headerAlign:"left"},{field:"last_unit_cost",headerName:"Last Unit Cost",flex:1,type:"number",editable:!0,align:"center",headerAlign:"left",valueFormatter:ee=>`$${(Number(ee.value)||0).toFixed(2)}`,valueGetter:ee=>Number(ee.value)||0},{field:"reorder_point",headerName:"Reorder Point",flex:.75,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"value",headerName:"Value",flex:1,type:"number",valueGetter:ee=>{const se=Number(ee.row.quantity_on_hand)||0,V=Number(ee.row.last_unit_cost)||0;return se*V},valueFormatter:ee=>`$${(Number(ee.value)||0).toFixed(2)}`,headerAlign:"center",align:"center"},{field:"actions",headerName:"Actions",width:100,headerAlign:"left",sortable:!1,renderCell:ee=>i.jsx(xr,{size:"small",color:"error",onClick:se=>{se.stopPropagation(),k(ee.row.part_number)},children:i.jsx(ma,{fontSize:"medium",sx:{fontSize:28}})})}].filter(Boolean),k=async ee=>{if(window.confirm(`Are you sure you want to delete part ${ee}?`))try{console.log(`Deleting part: ${ee}`);const se=await ve.delete(`/api/inventory/${encodeURIComponent(ee)}`);console.log(`Part ${ee} deleted successfully:`,se.data),alert(`Part ${ee} deleted successfully!`),K()}catch(se){console.error(`Error deleting part ${ee}:`,se),alert(`Error deleting part ${ee}. Please check the console.`)}},$=async(ee,se)=>{console.log("Attempting to update row:",ee);const V={};if(ee.part_number!==se.part_number){const De=String(ee.part_number).trim().toUpperCase();if(!De)return alert("Part number cannot be empty."),Promise.reject("Invalid part number");V.part_number=De}if(ee.quantity_on_hand!==se.quantity_on_hand){if(z?.access_role==="Sales and Purchase")return alert("Sales and Purchase users cannot modify quantity on hand for existing parts."),Promise.reject("Access denied");const De=parseFloat(String(ee.quantity_on_hand));if(isNaN(De))return alert("Invalid quantity value. Please enter a valid number."),Promise.reject("Invalid quantity");V.quantity_on_hand=De}if(ee.reorder_point!==se.reorder_point){const De=parseFloat(String(ee.reorder_point));if(isNaN(De))return alert("Invalid reorder point value. Please enter a valid number."),Promise.reject("Invalid reorder point");V.reorder_point=De}if(ee.last_unit_cost!==se.last_unit_cost){const De=parseFloat(String(ee.last_unit_cost));if(isNaN(De))return alert("Invalid last unit cost value. Please enter a valid number."),Promise.reject("Invalid last unit cost");V.last_unit_cost=De}if(ee.category!==se.category&&(V.category=ee.category),Object.keys(V).length===0)return console.log("No fields changed."),ee;const Ge=se.part_number;try{console.log(" processRowUpdate: Sending PUT request"),console.log(" URL:",`/api/inventory/${encodeURIComponent(Ge)}`),console.log(" Request body:",V),console.log(" Old part number:",se.part_number),console.log(" New part number:",ee.part_number);const De=await ve.put(`/api/inventory/${encodeURIComponent(Ge)}`,V);return console.log(`Inventory updated for part ${Ge}:`,De.data),alert(`Part ${Ge} updated successfully!`),await K(),De.data.updatedItem||ee}catch(De){return console.error(`Error updating inventory for part ${Ge}:`,De),De instanceof di&&De.response&&De.response.data&&De.response.data.error?alert(`Error updating inventory: ${De.response.data.error}`):alert(`Error updating inventory for part ${Ge}. Please check the console.`),Promise.reject(De)}},X=()=>{const ee=J.map(De=>({...De,value:(Number(De.quantity_on_hand)||0)*(Number(De.last_unit_cost)||0)})),se=Cl.unparse(ee),V=new Blob([se],{type:"text/csv;charset=utf-8;"}),Ge=document.createElement("a");if(Ge.download!==void 0){const De=URL.createObjectURL(V);Ge.setAttribute("href",De),Ge.setAttribute("download","inventory_list.csv"),Ge.style.visibility="hidden",document.body.appendChild(Ge),Ge.click()}},C=()=>{u(null),l(!0)},M=async ee=>{const se={...ee,part_number:ee.part_number.trim().toUpperCase(),part_description:ee.part_description.trim(),unit:ee.unit.trim(),part_type:ee.part_type.trim()};try{let V;if(c){const Ge={...se,part_number:se.part_number};console.log('dY"? Frontend: Sending PUT request'),console.log('dY"< URL:',`/api/inventory/${encodeURIComponent(c.part_number)}`),console.log('dY"< Request body:',Ge),console.log('dY"< Original part number:',c.part_number),console.log('dY"< New part number:',se.part_number),V=await ve.put(`/api/inventory/${encodeURIComponent(c.part_number)}`,Ge)}else V=await ve.post("/api/inventory",se);return K(),V.data}catch(V){throw V}},H=()=>{l(!1),u(null)},U=ee=>{u({part_id:ee.row.part_id,part_number:ee.row.part_number,part_description:ee.row.part_description||"",unit:ee.row.unit||"Each",last_unit_cost:ee.row.last_unit_cost||"",quantity_on_hand:ee.row.quantity_on_hand||"",reorder_point:ee.row.reorder_point||"",part_type:ee.row.part_type||"stock",category:ee.row.category||"Uncategorized"}),l(!0)},te=()=>{_.current?.click()},le=async ee=>{const se=ee.target.files?.[0];if(se){if(!se.name.endsWith(".csv")&&se.type!=="text/csv"){alert("Please select a valid CSV file");return}if(se.size>5*1024*1024){alert("File size must be less than 5MB");return}await oe(se)}},oe=async ee=>{f(!0),p(0),m(null);const se=new FormData;se.append("csvFile",ee);try{const V=setInterval(()=>{p(De=>De>=90?(clearInterval(V),90):De+10)},200),Ge=await ve.post("/api/inventory/upload-csv",se,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:De=>{if(De.total){const Fe=Math.round(De.loaded*90/De.total);p(Fe)}}});clearInterval(V),p(100),m(Ge.data),b(!0),setTimeout(()=>{K()},1e3)}catch(V){console.error("Error uploading CSV:",V),V instanceof di&&V.response?.data?m({error:"Upload failed",errors:V.response.data.errors||[V.response.data.error||"Unknown error"],warnings:V.response.data.warnings||[]}):m({error:"Upload failed",errors:["An unexpected error occurred during upload"]}),b(!0)}finally{f(!1),p(0),_.current&&(_.current.value="")}},ae=async()=>{try{const ee=await ve.get("/api/inventory/csv-template",{responseType:"blob"}),se=window.URL.createObjectURL(new Blob([ee.data])),V=document.createElement("a");V.href=se,V.setAttribute("download","inventory_template.csv"),document.body.appendChild(V),V.click(),V.remove(),window.URL.revokeObjectURL(se)}catch(ee){console.error("Error downloading template:",ee),alert("Error downloading template")}},he=()=>{b(!1),m(null)},me=async()=>{A(!0);try{const ee=[],se=[],V=Xe=>{const it=[],lt=[];let vt=String(Xe||"");const Ye=vt,Ze=vt.replace(/\s+/g,"");Ze!==vt&&it.push("Removed spaces"),vt=Ze;const We=vt.toUpperCase();We!==vt&&it.push("Converted to uppercase"),vt=We;const wt=vt.replace(/[^A-Z0-9\/()]/g,"");wt!==vt&&it.push("Removed punctuation excluding ( ) /"),vt=wt;const Nt=vt;return vt=vt.replace(/(\d)\/(1\d|\d)/g,(kt,Wt,jt,ur,$e)=>{const He=$e[ur-1]||"",Je=$e[ur+kt.length]||"";return He==="("&&Je===")"?kt:`(${Wt}/${jt})`}),vt!==Nt&&it.push("Wrapped fractions with parentheses"),vt.includes("/")&&(/^[A-Z]{3,}/.test(vt)||/[A-Z]{3,}$/.test(vt))&&lt.push("Description text detected with fraction"),/\d\.|\.\d/.test(vt)&&lt.push("Decimal detected; consider fraction"),{cleaned:vt,actions:it,warnings:lt,original:Ye}},Ge=r.map(Xe=>{const it=V(Xe.part_number);return(it.cleaned!==Xe.part_number||it.actions.length>0)&&ee.push({part_number:Xe.part_number,cleaned_part_number:it.cleaned,actions:it.actions}),it.warnings.length>0&&se.push({part_number:Xe.part_number,warnings:it.warnings}),{...Xe,_clean:it.cleaned}}),De={};Ge.forEach(Xe=>{De[Xe._clean]||(De[Xe._clean]=[]),De[Xe._clean].push(Xe)});const Fe=Object.entries(De).filter(([,Xe])=>Xe.length>1).map(([,Xe])=>{const it=Xe.map(Ye=>({part_number:Ye.part_number,unit:Ye.unit})),lt=Xe[0].part_number,vt=new Set(Xe.map(Ye=>Ye.unit)).size>1;return{proposedKeep:lt,candidates:it,unitMismatch:vt}});W({fixes:ee,flags:se,duplicateGroups:Fe}),D(!0)}catch(ee){console.error("Error during cleanup preview:",ee),alert("Failed to analyze inventory for cleanup.")}finally{A(!1)}},Q=async()=>{if(!I)return;const ee=(I.duplicateGroups||[]).map(se=>({keepPartNumber:se.proposedKeep,mergePartNumbers:se.candidates.map(V=>V.part_number).filter(V=>V!==se.proposedKeep)}));A(!0);try{const se=await hS("stock",ee);D(!1),T(se),S(!0),await K()}catch(se){console.error("Error applying cleanup:",se),alert("Failed to apply cleanup.")}finally{A(!1)}},G=()=>{S(!1),T(null)};return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4},children:[i.jsxs(Z,{sx:{mb:4},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Stock"}),i.jsxs(dt,{direction:"row",spacing:2,children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:C,children:"New Part"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Cd,{}),onClick:te,children:"Upload CSV"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:ae,children:"Download Template"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:X,children:"Export CSV"}),i.jsx(xe,{variant:"outlined",color:"warning",onClick:me,disabled:w,startIcon:w?i.jsx(tr,{size:20}):i.jsx(ma,{}),children:w?"Cleaning...":"Clean"})]})]}),i.jsx("input",{type:"file",ref:_,onChange:le,accept:".csv",style:{display:"none"}}),d&&i.jsxs(bt,{sx:{p:2,mb:2},children:[i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Uploading CSV file..."}),i.jsx(Ed,{variant:"determinate",value:h}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[h,"% complete"]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(Pe,{fullWidth:!0,variant:"outlined",placeholder:"Search stock...",value:e,onChange:ee=>t(ee.target.value),InputProps:{startAdornment:i.jsx(sa,{position:"start",children:i.jsx(fi,{})})},sx:{mb:2}}),i.jsx(Po,{rows:J,columns:L,loading:a,paginationModel:R,onPaginationModelChange:ee=>F(ee),pageSizeOptions:[10,20,50],processRowUpdate:$,getRowId:ee=>ee.id,onRowClick:(ee,se)=>{const V=se.target;V.closest('.MuiDataGrid-cell[data-field="part_number"]')||V.closest('.MuiDataGrid-cell[data-field="quantity_on_hand"]')||V.closest('.MuiDataGrid-cell[data-field="last_unit_cost"]')||V.closest('.MuiDataGrid-cell[data-field="reorder_point"]')||U(ee)},sx:{cursor:"pointer","& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})})]}),i.jsxs(pr,{open:O,onClose:()=>D(!1),maxWidth:"md",fullWidth:!0,children:[i.jsx(mr,{children:"Clean and Enforce Rules (Preview)"}),i.jsx(gr,{children:I?i.jsxs(Z,{children:[i.jsx(B,{variant:"h6",children:"Fixes"}),i.jsx(ha,{dense:!0,children:(I.fixes||[]).slice(0,200).map((ee,se)=>i.jsx(ja,{button:!0,onClick:()=>{const V=r.find(Ge=>Ge.part_number===ee.part_number);V&&(u({part_id:V.part_id,part_number:V.part_number,part_description:V.part_description||"",unit:V.unit||"Each",last_unit_cost:V.last_unit_cost||"",quantity_on_hand:V.quantity_on_hand||"",reorder_point:V.reorder_point||"",part_type:V.part_type||"stock",category:V.category||"Uncategorized"}),l(!0))},children:i.jsx(Qn,{primary:`${ee.part_number} -> ${ee.cleaned_part_number}`,secondary:(ee.actions||[]).join(", ")})},se))}),I.flags&&I.flags.length>0&&i.jsxs(i.Fragment,{children:[i.jsx(B,{variant:"h6",sx:{mt:2},children:"Flags"}),i.jsx(ha,{dense:!0,children:(I.flags||[]).map((ee,se)=>i.jsx(ja,{button:!0,onClick:()=>{const V=r.find(Ge=>Ge.part_number===ee.part_number);V&&(u({part_id:V.part_id,part_number:V.part_number,part_description:V.part_description||"",unit:V.unit||"Each",last_unit_cost:V.last_unit_cost||"",quantity_on_hand:V.quantity_on_hand||"",reorder_point:V.reorder_point||"",part_type:V.part_type||"stock",category:V.category||"Uncategorized"}),l(!0))},children:i.jsx(Qn,{primary:`${ee.part_number}`,secondary:(ee.warnings||[]).join(", ")})},se))})]}),i.jsx(B,{variant:"h6",sx:{mt:2},children:"Potential Duplicates"}),i.jsx(ha,{dense:!0,children:(I.duplicateGroups||[]).map((ee,se)=>i.jsx(ja,{children:i.jsx(Qn,{primary:`Keep ${ee.proposedKeep}  merge ${ee.candidates.map(V=>V.part_number).filter(V=>V!==ee.proposedKeep).join(", ")||"none"}`,secondary:ee.unitMismatch?"Unit mismatch detected - will not merge differing units":void 0})},se))})]}):i.jsx(B,{children:"Loading preview..."})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:()=>D(!1),children:"Cancel"}),i.jsx(xe,{onClick:Q,variant:"contained",disabled:w,children:"Apply"})]})]}),i.jsx(tc,{open:s,onClose:H,onSave:M,initialPart:c||void 0,isEditMode:!!c,title:c?"Edit Inventory Part":"Add New Inventory Part"}),i.jsxs(pr,{open:y,onClose:he,maxWidth:"md",fullWidth:!0,children:[i.jsx(mr,{children:v?.error?"Upload Failed":"Upload Completed"}),i.jsx(gr,{children:v&&i.jsxs(Z,{children:[v.error?i.jsx(Ot,{severity:"error",sx:{mb:2},children:v.error}):i.jsx(Ot,{severity:"success",sx:{mb:2},children:v.message}),v.summary&&i.jsxs(Z,{sx:{mb:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Summary"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`Total: ${v.summary.totalProcessed}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`New: ${v.summary.newItems}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`Updated: ${v.summary.updatedItems}`,color:"info"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`Vendor Mappings: ${v.summary.vendorMappings||0}`,color:"secondary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`Errors: ${v.summary.errors}`,color:"error"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`Warnings: ${v.summary.warnings}`,color:"warning"})})]})]}),v.errors&&v.errors.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"error",gutterBottom:!0,children:["Errors (",v.errors.length,")"]}),i.jsx(ha,{dense:!0,children:v.errors.map((ee,se)=>i.jsx(ja,{children:i.jsx(Qn,{primary:ee})},se))})]}),v.warnings&&v.warnings.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"warning.main",gutterBottom:!0,children:["Warnings (",v.warnings.length,")"]}),i.jsx(ha,{dense:!0,children:v.warnings.map((ee,se)=>i.jsx(ja,{children:i.jsx(Qn,{primary:ee})},se))})]})]})}),i.jsx(jr,{children:i.jsx(xe,{onClick:he,variant:"contained",children:"Close"})})]}),i.jsxs(pr,{open:E,onClose:G,maxWidth:"sm",fullWidth:!0,children:[i.jsx(mr,{children:P?.error?"Cleanup Failed":"Cleanup Completed"}),i.jsx(gr,{children:P&&i.jsxs(Z,{children:[P.error?i.jsxs(Ot,{severity:"error",sx:{mb:2},children:[P.message,P.details&&i.jsxs(B,{variant:"body2",sx:{mt:1},children:["Details: ",P.details]})]}):i.jsx(Ot,{severity:"success",sx:{mb:2},children:P.message}),P.summary&&i.jsxs(Z,{sx:{mb:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Summary"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:4,children:i.jsx(st,{label:`Total: ${P.summary.totalProcessed}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:4,children:i.jsx(st,{label:`Updated: ${P.summary.itemsUpdated}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:4,children:i.jsx(st,{label:`Errors: ${P.summary.errors}`,color:"error"})})]})]})]})}),i.jsx(jr,{children:i.jsx(xe,{onClick:G,variant:"contained",children:"Close"})})]})]})},aie=()=>{const[e,t]=x.useState(""),[r,n]=x.useState([]),[a,o]=x.useState(!1),[s,l]=x.useState(!1),[c,u]=x.useState(null),[d,f]=x.useState(!1),[h,p]=x.useState(0),[v,m]=x.useState(null),[y,b]=x.useState(!1),_=x.useRef(null),[w,A]=x.useState({page:0,pageSize:10}),[P,T]=x.useState(!1),[E,S]=x.useState(null),[I,W]=x.useState(!1),[O,D]=x.useState(null),[R,F]=x.useState(!1),z=async()=>{o(!0);try{const G=(await Hae()).map((ee,se)=>({...ee,id:ee.part_number||se}));n(G)}catch(Q){console.error("Error fetching supply inventory:",Q)}finally{o(!1)}};x.useEffect(()=>{z();const Q=()=>z();return window.addEventListener("supply-updated",Q),()=>window.removeEventListener("supply-updated",Q)},[]);const K=r.filter(Q=>Q.part_number?.toUpperCase().includes(e.toUpperCase())||Q.part_description?.toLowerCase().includes(e.toLowerCase())),J=[{field:"part_number",headerName:"Part #",flex:1,headerAlign:"left",editable:!0},{field:"part_description",headerName:"Part Description",flex:2,headerAlign:"left"},{field:"category",headerName:"Category",flex:1,headerAlign:"left"},{field:"unit",headerName:"UOM",flex:.5,headerAlign:"left"},{field:"last_unit_cost",headerName:"Last Unit Cost",flex:1,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"reorder_point",headerName:"Reorder Point",flex:.75,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"part_type",headerName:"Type",flex:.5,headerAlign:"left"},{field:"value",headerName:"Value",flex:1,type:"number",valueGetter:Q=>{const G=Q.row.quantity_on_hand==="NA"?0:Number(Q.row.quantity_on_hand)||0,ee=Number(Q.row.last_unit_cost)||0;return G*ee},valueFormatter:Q=>`$${(Number(Q.value)||0).toFixed(2)}`,headerAlign:"center",align:"center"},{field:"actions",headerName:"Actions",width:100,headerAlign:"left",sortable:!1,renderCell:Q=>i.jsx(xr,{size:"small",color:"error",onClick:G=>{G.stopPropagation(),L(Q.row.part_number)},children:i.jsx(ma,{fontSize:"medium",sx:{fontSize:28}})})}],L=async Q=>{if(window.confirm(`Are you sure you want to delete part ${Q}?`))try{console.log(`Deleting part: ${Q}`);const G=await ve.delete(`/api/inventory/${encodeURIComponent(Q)}`);console.log(`Part ${Q} deleted successfully:`,G.data),alert(`Part ${Q} deleted successfully!`),z()}catch(G){console.error(`Error deleting part ${Q}:`,G),alert(`Error deleting part ${Q}. Please check the console.`)}},k=async(Q,G)=>{console.log("Attempting to update row:",Q);const ee={};if(Q.part_number!==G.part_number){const V=String(Q.part_number).trim().toUpperCase();if(!V)return alert("Part number cannot be empty."),Promise.reject("Invalid part number");ee.part_number=V}if(Q.reorder_point!==G.reorder_point){const V=parseFloat(String(Q.reorder_point));if(isNaN(V))return alert("Invalid reorder point value. Please enter a valid number."),Promise.reject("Invalid reorder point");ee.reorder_point=V}if(Q.last_unit_cost!==G.last_unit_cost){const V=parseFloat(String(Q.last_unit_cost));if(isNaN(V))return alert("Invalid last unit cost value. Please enter a valid number."),Promise.reject("Invalid last unit cost");ee.last_unit_cost=V}if(Q.category!==G.category&&(ee.category=Q.category),Object.keys(ee).length===0)return console.log("No fields changed."),Q;const se=ee.part_number?G.part_number:Q.part_number;try{const V=await ve.put(`/api/inventory/${encodeURIComponent(se)}`,ee);return console.log(`Supply inventory updated for part ${se}:`,V.data),alert(`Part ${se} updated successfully!`),await z(),V.data.updatedItem||Q}catch(V){return console.error(`Error updating supply inventory for part ${se}:`,V),V instanceof di&&V.response&&V.response.data&&V.response.data.error?alert(`Error updating inventory: ${V.response.data.error}`):alert(`Error updating inventory for part ${se}. Please check the console.`),Promise.reject(V)}},$=()=>{const Q=K.map(V=>({...V,value:(V.quantity_on_hand==="NA"?0:Number(V.quantity_on_hand)||0)*(Number(V.last_unit_cost)||0)})),G=Cl.unparse(Q),ee=new Blob([G],{type:"text/csv;charset=utf-8;"}),se=document.createElement("a");if(se.download!==void 0){const V=URL.createObjectURL(ee);se.setAttribute("href",V),se.setAttribute("download","supply_list.csv"),se.style.visibility="hidden",document.body.appendChild(se),se.click()}},X=()=>{u({part_number:"",part_description:"",unit:"",last_unit_cost:"",quantity_on_hand:"NA",reorder_point:"",part_type:"supply",category:"Uncategorized"}),l(!0)},C=async()=>{T(!0);try{const Q=await e6("supply");S(Q?.preview||Q),W(!0)}catch(Q){console.error("Error during cleanup preview:",Q),alert("Failed to analyze supply for cleanup.")}finally{T(!1)}},M=async()=>{if(!E)return;const Q=(E.duplicateGroups||[]).map(G=>({keepPartNumber:G.proposedKeep,mergePartNumbers:G.candidates.map(ee=>ee.part_number).filter(ee=>ee!==G.proposedKeep)}));T(!0);try{const G=await hS("supply",Q);W(!1),D(G),F(!0),await z()}catch(G){console.error("Error applying cleanup:",G),alert("Failed to apply cleanup.")}finally{T(!1)}},H=async Q=>{const G={...Q,part_number:Q.part_number.trim().toUpperCase(),part_description:Q.part_description.trim(),unit:Q.unit.trim(),part_type:Q.part_type.trim()};try{if(c){const{part_number:ee,...se}=G;await ve.put(`/api/inventory/${encodeURIComponent(ee)}`,se)}else await ve.post("/api/inventory",G);z()}catch(ee){throw ee}},U=()=>{l(!1),u(null)},te=Q=>{u({part_id:Q.row.part_id,part_number:Q.row.part_number,part_description:Q.row.part_description||"",unit:Q.row.unit||"Each",last_unit_cost:Q.row.last_unit_cost||"",quantity_on_hand:Q.row.quantity_on_hand||"",reorder_point:Q.row.reorder_point||"",part_type:Q.row.part_type||"supply",category:Q.row.category||"Uncategorized"}),l(!0)},le=()=>{_.current?.click()},oe=async Q=>{const G=Q.target.files?.[0];if(G){if(!G.name.endsWith(".csv")&&G.type!=="text/csv"){alert("Please select a valid CSV file");return}if(G.size>5*1024*1024){alert("File size must be less than 5MB");return}await ae(G)}},ae=async Q=>{f(!0),p(0),m(null);const G=new FormData;G.append("csvFile",Q);try{const ee=setInterval(()=>{p(V=>V>=90?(clearInterval(ee),90):V+10)},200),se=await ve.post("/api/inventory/upload-csv",G,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:V=>{if(V.total){const Ge=Math.round(V.loaded*90/V.total);p(Ge)}}});clearInterval(ee),p(100),m(se.data),b(!0),setTimeout(()=>{z()},1e3)}catch(ee){console.error("Error uploading CSV:",ee),ee instanceof di&&ee.response?.data?m({error:"Upload failed",errors:ee.response.data.errors||[ee.response.data.error||"Unknown error"],warnings:ee.response.data.warnings||[]}):m({error:"Upload failed",errors:["An unexpected error occurred during upload"]}),b(!0)}finally{f(!1),p(0),_.current&&(_.current.value="")}},he=async()=>{try{const Q=await ve.get("/api/inventory/csv-template",{responseType:"blob"}),G=window.URL.createObjectURL(new Blob([Q.data])),ee=document.createElement("a");ee.href=G,ee.setAttribute("download","supply_template.csv"),document.body.appendChild(ee),ee.click(),ee.remove(),window.URL.revokeObjectURL(G)}catch(Q){console.error("Error downloading template:",Q),alert("Error downloading template")}},me=()=>{b(!1),m(null)};return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4},children:[i.jsxs(Z,{sx:{mb:4},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Supply List"}),i.jsxs(dt,{direction:"row",spacing:2,children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:X,children:"New Part"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Cd,{}),onClick:le,children:"Upload CSV"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:he,children:"Download Template"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:$,children:"Export CSV"}),i.jsx(xe,{variant:"outlined",color:"warning",onClick:C,disabled:P,startIcon:i.jsx(ma,{}),children:P?"Cleaning...":"Clean"})]})]}),i.jsx("input",{type:"file",ref:_,onChange:oe,accept:".csv",style:{display:"none"}}),d&&i.jsxs(bt,{sx:{p:2,mb:2},children:[i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Uploading CSV file..."}),i.jsx(Ed,{variant:"determinate",value:h}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[h,"% complete"]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(Pe,{fullWidth:!0,variant:"outlined",placeholder:"Search supply...",value:e,onChange:Q=>t(Q.target.value),InputProps:{startAdornment:i.jsx(sa,{position:"start",children:i.jsx(fi,{})})},sx:{mb:2}}),i.jsx(Po,{rows:K,columns:J,loading:a,paginationModel:w,onPaginationModelChange:Q=>A(Q),pageSizeOptions:[10,20,50],processRowUpdate:k,getRowId:Q=>Q.id,onRowClick:(Q,G)=>{const ee=G.target;ee.closest('.MuiDataGrid-cell[data-field="part_number"]')||ee.closest('.MuiDataGrid-cell[data-field="last_unit_cost"]')||ee.closest('.MuiDataGrid-cell[data-field="reorder_point"]')||te(Q)},sx:{cursor:"pointer","& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})})]}),i.jsx(tc,{open:s,onClose:U,onSave:H,initialPart:c||void 0,isEditMode:!!c,title:c?"Edit Supply Part":"Add New Supply Part"}),i.jsxs(pr,{open:y,onClose:me,maxWidth:"md",fullWidth:!0,children:[i.jsx(mr,{children:v?.error?"Upload Failed":"Upload Completed"}),i.jsx(gr,{children:v&&i.jsxs(Z,{children:[v.error?i.jsx(Ot,{severity:"error",sx:{mb:2},children:v.error}):i.jsx(Ot,{severity:"success",sx:{mb:2},children:v.message}),v.summary&&i.jsxs(Z,{sx:{mb:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Summary"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`Total: ${v.summary.totalProcessed}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`New: ${v.summary.newItems}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`Updated: ${v.summary.updatedItems}`,color:"info"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`Vendor Mappings: ${v.summary.vendorMappings||0}`,color:"secondary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`Errors: ${v.summary.errors}`,color:"error"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`Warnings: ${v.summary.warnings}`,color:"warning"})})]})]}),v.errors&&v.errors.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"error",gutterBottom:!0,children:["Errors (",v.errors.length,")"]}),i.jsx(ha,{dense:!0,children:v.errors.map((Q,G)=>i.jsx(ja,{children:i.jsx(Qn,{primary:Q})},G))})]}),v.warnings&&v.warnings.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"warning.main",gutterBottom:!0,children:["Warnings (",v.warnings.length,")"]}),i.jsx(ha,{dense:!0,children:v.warnings.map((Q,G)=>i.jsx(ja,{children:i.jsx(Qn,{primary:Q})},G))})]})]})}),i.jsx(jr,{children:i.jsx(xe,{onClick:me,variant:"contained",children:"Close"})})]}),i.jsxs(pr,{open:I,onClose:()=>W(!1),maxWidth:"md",fullWidth:!0,children:[i.jsx(mr,{children:"Clean and Enforce Rules (Preview)"}),i.jsx(gr,{children:E?i.jsxs(Z,{children:[i.jsx(B,{variant:"h6",children:"Fixes"}),i.jsx(ha,{dense:!0,children:(E.fixes||[]).slice(0,200).map((Q,G)=>i.jsx(ja,{children:i.jsx(Qn,{primary:`${Q.part_number} -> ${Q.cleaned_part_number}`,secondary:(Q.actions||[]).join(", ")})},G))}),i.jsx(B,{variant:"h6",sx:{mt:2},children:"Potential Duplicates"}),i.jsx(ha,{dense:!0,children:(E.duplicateGroups||[]).map((Q,G)=>i.jsx(ja,{children:i.jsx(Qn,{primary:`Keep ${Q.proposedKeep}  merge ${Q.candidates.map(ee=>ee.part_number).filter(ee=>ee!==Q.proposedKeep).join(", ")||"none"}`,secondary:Q.unitMismatch?"Unit mismatch detected - will not merge differing units":void 0})},G))})]}):i.jsx(B,{children:"Loading preview..."})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:()=>W(!1),children:"Cancel"}),i.jsx(xe,{onClick:M,variant:"contained",disabled:P,children:"Apply"})]})]}),i.jsxs(pr,{open:R,onClose:()=>F(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(mr,{children:"Cleanup Completed"}),i.jsx(gr,{children:O?i.jsxs(Z,{children:[i.jsx(Ot,{severity:"success",sx:{mb:2},children:"Cleanup applied successfully."}),i.jsxs(B,{variant:"body2",children:["Fixes applied: ",O?.applied?.fixesApplied||0]}),i.jsxs(B,{variant:"body2",children:["Fixes skipped: ",O?.applied?.fixesSkipped||0]}),i.jsxs(B,{variant:"body2",children:["Merged groups: ",O?.applied?.mergedGroups||0]}),i.jsxs(B,{variant:"body2",children:["Merged items: ",O?.applied?.mergedItems||0]})]}):i.jsx(B,{children:"Loading..."})}),i.jsx(jr,{children:i.jsx(xe,{onClick:()=>F(!1),variant:"contained",children:"Close"})})]})]})},iie=()=>{const[e,t]=x.useState(""),[r,n]=x.useState([]),[a,o]=x.useState(!1),[s,l]=x.useState(!1),[c,u]=x.useState(null),[d,f]=x.useState(!1),[h,p]=x.useState(0),[v,m]=x.useState(null),[y,b]=x.useState(!1),_=x.useRef(null),[w,A]=x.useState({page:0,pageSize:10}),[P,T]=x.useState(!1),[E,S]=x.useState(null),[I,W]=x.useState(!1),[O,D]=x.useState(null),[R,F]=x.useState(!1),z=async()=>{o(!0);try{const G=(await Vae()).map((ee,se)=>({...ee,id:ee.part_number||se}));n(G)}catch(Q){console.error("Error fetching service inventory:",Q)}finally{o(!1)}};x.useEffect(()=>{z();const Q=()=>z();return window.addEventListener("service-updated",Q),()=>window.removeEventListener("service-updated",Q)},[]);const K=r.filter(Q=>Q.part_number?.toUpperCase().includes(e.toUpperCase())||Q.part_description?.toLowerCase().includes(e.toLowerCase())),J=[{field:"part_number",headerName:"Part #",flex:1,headerAlign:"left",editable:!0},{field:"part_description",headerName:"Part Description",flex:2,headerAlign:"left"},{field:"category",headerName:"Category",flex:1,headerAlign:"left"},{field:"unit",headerName:"UOM",flex:.5,headerAlign:"left"},{field:"last_unit_cost",headerName:"Last Unit Cost",flex:1,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"reorder_point",headerName:"Reorder Point",flex:.75,type:"number",editable:!0,align:"center",headerAlign:"left"},{field:"part_type",headerName:"Type",flex:.5,headerAlign:"left"},{field:"value",headerName:"Value",flex:1,type:"number",valueGetter:Q=>{const G=Q.row.quantity_on_hand==="NA"?0:Number(Q.row.quantity_on_hand)||0,ee=Number(Q.row.last_unit_cost)||0;return G*ee},valueFormatter:Q=>`$${(Number(Q.value)||0).toFixed(2)}`,headerAlign:"center",align:"center"},{field:"actions",headerName:"Actions",width:100,headerAlign:"left",sortable:!1,renderCell:Q=>i.jsx(xr,{size:"small",color:"error",onClick:G=>{G.stopPropagation(),L(Q.row.part_number)},children:i.jsx(ma,{fontSize:"medium",sx:{fontSize:28}})})}],L=async Q=>{if(window.confirm(`Are you sure you want to delete part ${Q}?`))try{console.log(`Deleting part: ${Q}`);const G=await ve.delete(`/api/inventory/${encodeURIComponent(Q)}`);console.log(`Part ${Q} deleted successfully:`,G.data),alert(`Part ${Q} deleted successfully!`),z()}catch(G){console.error(`Error deleting part ${Q}:`,G),alert(`Error deleting part ${Q}. Please check the console.`)}},k=async(Q,G)=>{console.log("Attempting to update row:",Q);const ee={};if(Q.part_number!==G.part_number){const V=String(Q.part_number).trim().toUpperCase();if(!V)return alert("Part number cannot be empty."),Promise.reject("Invalid part number");ee.part_number=V}if(Q.reorder_point!==G.reorder_point){const V=parseFloat(String(Q.reorder_point));if(isNaN(V))return alert("Invalid reorder point value. Please enter a valid number."),Promise.reject("Invalid reorder point");ee.reorder_point=V}if(Q.last_unit_cost!==G.last_unit_cost){const V=parseFloat(String(Q.last_unit_cost));if(isNaN(V))return alert("Invalid last unit cost value. Please enter a valid number."),Promise.reject("Invalid last unit cost");ee.last_unit_cost=V}if(Q.category!==G.category&&(ee.category=Q.category),Object.keys(ee).length===0)return console.log("No fields changed."),Q;const se=ee.part_number?G.part_number:Q.part_number;try{const V=await ve.put(`/api/inventory/${encodeURIComponent(se)}`,ee);return console.log(`Service inventory updated for part ${se}:`,V.data),alert(`Part ${se} updated successfully!`),await z(),V.data.updatedItem||Q}catch(V){return console.error(`Error updating service inventory for part ${se}:`,V),V instanceof di&&V.response&&V.response.data&&V.response.data.error?alert(`Error updating inventory: ${V.response.data.error}`):alert(`Error updating inventory for part ${se}. Please check the console.`),Promise.reject(V)}},$=()=>{const Q=K.map(V=>({...V,value:(V.quantity_on_hand==="NA"?0:Number(V.quantity_on_hand)||0)*(Number(V.last_unit_cost)||0)})),G=Cl.unparse(Q),ee=new Blob([G],{type:"text/csv;charset=utf-8;"}),se=document.createElement("a");if(se.download!==void 0){const V=URL.createObjectURL(ee);se.setAttribute("href",V),se.setAttribute("download","service_list.csv"),se.style.visibility="hidden",document.body.appendChild(se),se.click()}},X=()=>{u({part_number:"",part_description:"",unit:"",last_unit_cost:"",quantity_on_hand:"NA",reorder_point:"",part_type:"service",category:"Uncategorized"}),l(!0)},C=async()=>{T(!0);try{const Q=await e6("service");S(Q?.preview||Q),W(!0)}catch(Q){console.error("Error during cleanup preview:",Q),alert("Failed to analyze service for cleanup.")}finally{T(!1)}},M=async()=>{if(!E)return;const Q=(E.duplicateGroups||[]).map(G=>({keepPartNumber:G.proposedKeep,mergePartNumbers:G.candidates.map(ee=>ee.part_number).filter(ee=>ee!==G.proposedKeep)}));T(!0);try{const G=await hS("service",Q);W(!1),D(G),F(!0),await z()}catch(G){console.error("Error applying cleanup:",G),alert("Failed to apply cleanup.")}finally{T(!1)}},H=async Q=>{const G={...Q,part_number:Q.part_number.trim().toUpperCase(),part_description:Q.part_description.trim(),unit:Q.unit.trim(),part_type:Q.part_type.trim()};try{if(c){const{part_number:ee,...se}=G;await ve.put(`/api/inventory/${encodeURIComponent(ee)}`,se)}else await ve.post("/api/inventory",G);z()}catch(ee){throw ee}},U=()=>{l(!1),u(null)},te=Q=>{u({part_id:Q.row.part_id,part_number:Q.row.part_number,part_description:Q.row.part_description||"",unit:Q.row.unit||"Each",last_unit_cost:Q.row.last_unit_cost||"",quantity_on_hand:Q.row.quantity_on_hand||"",reorder_point:Q.row.reorder_point||"",part_type:Q.row.part_type||"service",category:Q.row.category||"Uncategorized"}),l(!0)},le=()=>{_.current?.click()},oe=async Q=>{const G=Q.target.files?.[0];if(G){if(!G.name.endsWith(".csv")&&G.type!=="text/csv"){alert("Please select a valid CSV file");return}if(G.size>5*1024*1024){alert("File size must be less than 5MB");return}await ae(G)}},ae=async Q=>{f(!0),p(0),m(null);const G=new FormData;G.append("csvFile",Q);try{const ee=setInterval(()=>{p(V=>V>=90?(clearInterval(ee),90):V+10)},200),se=await ve.post("/api/inventory/upload-csv",G,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:V=>{if(V.total){const Ge=Math.round(V.loaded*90/V.total);p(Ge)}}});clearInterval(ee),p(100),m(se.data),b(!0),setTimeout(()=>{z()},1e3)}catch(ee){console.error("Error uploading CSV:",ee),ee instanceof di&&ee.response?.data?m({error:"Upload failed",errors:ee.response.data.errors||[ee.response.data.error||"Unknown error"],warnings:ee.response.data.warnings||[]}):m({error:"Upload failed",errors:["An unexpected error occurred during upload"]}),b(!0)}finally{f(!1),p(0),_.current&&(_.current.value="")}},he=async()=>{try{const Q=await ve.get("/api/inventory/csv-template",{responseType:"blob"}),G=window.URL.createObjectURL(new Blob([Q.data])),ee=document.createElement("a");ee.href=G,ee.setAttribute("download","service_template.csv"),document.body.appendChild(ee),ee.click(),ee.remove(),window.URL.revokeObjectURL(G)}catch(Q){console.error("Error downloading template:",Q),alert("Error downloading template")}},me=()=>{b(!1),m(null)};return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4},children:[i.jsxs(Z,{sx:{mb:4},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Service List"}),i.jsxs(dt,{direction:"row",spacing:2,children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:X,children:"New Part"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Cd,{}),onClick:le,children:"Upload CSV"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:he,children:"Download Template"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:$,children:"Export CSV"}),i.jsx(xe,{variant:"outlined",color:"warning",onClick:C,disabled:P,startIcon:i.jsx(ma,{}),children:P?"Cleaning...":"Clean"})]})]}),i.jsx("input",{type:"file",ref:_,onChange:oe,accept:".csv",style:{display:"none"}}),d&&i.jsxs(bt,{sx:{p:2,mb:2},children:[i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Uploading CSV file..."}),i.jsx(Ed,{variant:"determinate",value:h}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[h,"% complete"]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(Pe,{fullWidth:!0,variant:"outlined",placeholder:"Search service...",value:e,onChange:Q=>t(Q.target.value),InputProps:{startAdornment:i.jsx(sa,{position:"start",children:i.jsx(fi,{})})},sx:{mb:2}}),i.jsx(Po,{rows:K,columns:J,loading:a,paginationModel:w,onPaginationModelChange:Q=>A(Q),pageSizeOptions:[10,20,50],processRowUpdate:k,getRowId:Q=>Q.id,onRowClick:(Q,G)=>{const ee=G.target;ee.closest('.MuiDataGrid-cell[data-field="part_number"]')||ee.closest('.MuiDataGrid-cell[data-field="last_unit_cost"]')||ee.closest('.MuiDataGrid-cell[data-field="reorder_point"]')||te(Q)},sx:{cursor:"pointer","& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})})]}),i.jsx(tc,{open:s,onClose:U,onSave:H,initialPart:c||void 0,isEditMode:!!c,title:c?"Edit Service Part":"Add New Service Part"}),i.jsxs(pr,{open:y,onClose:me,maxWidth:"md",fullWidth:!0,children:[i.jsx(mr,{children:v?.error?"Upload Failed":"Upload Completed"}),i.jsx(gr,{children:v&&i.jsxs(Z,{children:[v.error?i.jsx(Ot,{severity:"error",sx:{mb:2},children:v.error}):i.jsx(Ot,{severity:"success",sx:{mb:2},children:v.message}),v.summary&&i.jsxs(Z,{sx:{mb:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Summary"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`Total: ${v.summary.totalProcessed}`,color:"primary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`New: ${v.summary.newItems}`,color:"success"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`Updated: ${v.summary.updatedItems}`,color:"info"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`Vendor Mappings: ${v.summary.vendorMappings||0}`,color:"secondary"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`Errors: ${v.summary.errors}`,color:"error"})}),i.jsx(ie,{item:!0,xs:6,sm:2,children:i.jsx(st,{label:`Warnings: ${v.summary.warnings}`,color:"warning"})})]})]}),v.errors&&v.errors.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"error",gutterBottom:!0,children:["Errors (",v.errors.length,")"]}),i.jsx(ha,{dense:!0,children:v.errors.map((Q,G)=>i.jsx(ja,{children:i.jsx(Qn,{primary:Q})},G))})]}),v.warnings&&v.warnings.length>0&&i.jsxs(Z,{sx:{mb:3},children:[i.jsxs(B,{variant:"h6",color:"warning.main",gutterBottom:!0,children:["Warnings (",v.warnings.length,")"]}),i.jsx(ha,{dense:!0,children:v.warnings.map((Q,G)=>i.jsx(ja,{children:i.jsx(Qn,{primary:Q})},G))})]})]})}),i.jsx(jr,{children:i.jsx(xe,{onClick:me,variant:"contained",children:"Close"})})]}),i.jsxs(pr,{open:I,onClose:()=>W(!1),maxWidth:"md",fullWidth:!0,children:[i.jsx(mr,{children:"Clean and Enforce Rules (Preview)"}),i.jsx(gr,{children:E?i.jsxs(Z,{children:[i.jsx(B,{variant:"h6",children:"Fixes"}),i.jsx(ha,{dense:!0,children:(E.fixes||[]).slice(0,200).map((Q,G)=>i.jsx(ja,{children:i.jsx(Qn,{primary:`${Q.part_number} -> ${Q.cleaned_part_number}`,secondary:(Q.actions||[]).join(", ")})},G))}),i.jsx(B,{variant:"h6",sx:{mt:2},children:"Potential Duplicates"}),i.jsx(ha,{dense:!0,children:(E.duplicateGroups||[]).map((Q,G)=>i.jsx(ja,{children:i.jsx(Qn,{primary:`Keep ${Q.proposedKeep}  merge ${Q.candidates.map(ee=>ee.part_number).filter(ee=>ee!==Q.proposedKeep).join(", ")||"none"}`,secondary:Q.unitMismatch?"Unit mismatch detected - will not merge differing units":void 0})},G))})]}):i.jsx(B,{children:"Loading preview..."})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:()=>W(!1),children:"Cancel"}),i.jsx(xe,{onClick:M,variant:"contained",disabled:P,children:"Apply"})]})]}),i.jsxs(pr,{open:R,onClose:()=>F(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(mr,{children:"Cleanup Completed"}),i.jsx(gr,{children:O?i.jsxs(Z,{children:[i.jsx(Ot,{severity:"success",sx:{mb:2},children:"Cleanup applied successfully."}),i.jsxs(B,{variant:"body2",children:["Fixes applied: ",O?.applied?.fixesApplied||0]}),i.jsxs(B,{variant:"body2",children:["Fixes skipped: ",O?.applied?.fixesSkipped||0]}),i.jsxs(B,{variant:"body2",children:["Merged groups: ",O?.applied?.mergedGroups||0]}),i.jsxs(B,{variant:"body2",children:["Merged items: ",O?.applied?.mergedItems||0]})]}):i.jsx(B,{children:"Loading..."})}),i.jsx(jr,{children:i.jsx(xe,{onClick:()=>F(!1),variant:"contained",children:"Close"})})]})]})};function an(e){if(e===null||e===!0||e===!1)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function Ft(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function qt(e){Ft(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||gn(e)==="object"&&t==="[object Date]"?new Date(e.getTime()):typeof e=="number"||t==="[object Number]"?new Date(e):((typeof e=="string"||t==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function Zm(e,t){Ft(2,arguments);var r=qt(e),n=an(t);return isNaN(n)?new Date(NaN):(n&&r.setDate(r.getDate()+n),r)}function eg(e,t){Ft(2,arguments);var r=qt(e),n=an(t);if(isNaN(n))return new Date(NaN);if(!n)return r;var a=r.getDate(),o=new Date(r.getTime());o.setMonth(r.getMonth()+n+1,0);var s=o.getDate();return a>=s?o:(r.setFullYear(o.getFullYear(),o.getMonth(),a),r)}function Oy(e,t){Ft(2,arguments);var r=qt(e).getTime(),n=an(t);return new Date(r+n)}var oie=36e5;function sie(e,t){Ft(2,arguments);var r=an(t);return Oy(e,r*oie)}var lie={};function cs(){return lie}function zc(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=cs(),f=an((r=(n=(a=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&a!==void 0?a:d.weekStartsOn)!==null&&n!==void 0?n:(c=d.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=qt(e),p=h.getDay(),v=(p<f?7:0)+p-f;return h.setDate(h.getDate()-v),h.setHours(0,0,0,0),h}function Ad(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function Pd(e){Ft(1,arguments);var t=qt(e);return t.setHours(0,0,0,0),t}var cie=864e5;function uie(e,t){Ft(2,arguments);var r=Pd(e),n=Pd(t),a=r.getTime()-Ad(r),o=n.getTime()-Ad(n);return Math.round((a-o)/cie)}var die=6e4;function fie(e,t){Ft(2,arguments);var r=an(t);return Oy(e,r*die)}function hie(e,t){Ft(2,arguments);var r=an(t);return Oy(e,r*1e3)}function pie(e,t){Ft(2,arguments);var r=an(t),n=r*7;return Zm(e,n)}function y4(e,t){Ft(2,arguments);var r=an(t);return eg(e,r*12)}function Yu(e,t){Ft(2,arguments);var r=qt(e),n=qt(t),a=r.getTime()-n.getTime();return a<0?-1:a>0?1:a}var ky=6e4,Ty=36e5,mie=1e3;function gie(e,t){Ft(2,arguments);var r=Pd(e),n=Pd(t);return r.getTime()===n.getTime()}function vie(e){return Ft(1,arguments),e instanceof Date||gn(e)==="object"&&Object.prototype.toString.call(e)==="[object Date]"}function t6(e){if(Ft(1,arguments),!vie(e)&&typeof e!="number")return!1;var t=qt(e);return!isNaN(Number(t))}function yie(e,t){Ft(2,arguments);var r=qt(e),n=qt(t),a=r.getFullYear()-n.getFullYear(),o=r.getMonth()-n.getMonth();return a*12+o}function xie(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getFullYear()-n.getFullYear()}function x4(e,t){var r=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return r<0?-1:r>0?1:r}function r6(e,t){Ft(2,arguments);var r=qt(e),n=qt(t),a=x4(r,n),o=Math.abs(uie(r,n));r.setDate(r.getDate()-a*o);var s=+(x4(r,n)===-a),l=a*(o-s);return l===0?0:l}function Ey(e,t){return Ft(2,arguments),qt(e).getTime()-qt(t).getTime()}var b4={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(t){return t<0?Math.ceil(t):Math.floor(t)}},bie="trunc";function Wp(e){return e?b4[e]:b4[bie]}function _ie(e,t,r){Ft(2,arguments);var n=Ey(e,t)/Ty;return Wp(void 0)(n)}function wie(e,t,r){Ft(2,arguments);var n=Ey(e,t)/ky;return Wp(void 0)(n)}function bw(e){Ft(1,arguments);var t=qt(e);return t.setHours(23,59,59,999),t}function _w(e){Ft(1,arguments);var t=qt(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function jie(e){Ft(1,arguments);var t=qt(e);return bw(t).getTime()===_w(t).getTime()}function n6(e,t){Ft(2,arguments);var r=qt(e),n=qt(t),a=Yu(r,n),o=Math.abs(yie(r,n)),s;if(o<1)s=0;else{r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-a*o);var l=Yu(r,n)===-a;jie(qt(e))&&o===1&&Yu(e,n)===1&&(l=!1),s=a*(o-Number(l))}return s===0?0:s}function Sie(e,t,r){Ft(2,arguments);var n=n6(e,t)/3;return Wp(void 0)(n)}function Cie(e,t,r){Ft(2,arguments);var n=Ey(e,t)/1e3;return Wp(void 0)(n)}function Aie(e,t,r){Ft(2,arguments);var n=r6(e,t)/7;return Wp(void 0)(n)}function Pie(e,t){Ft(2,arguments);var r=qt(e),n=qt(t),a=Yu(r,n),o=Math.abs(xie(r,n));r.setFullYear(1584),n.setFullYear(1584);var s=Yu(r,n)===-a,l=a*(o-Number(s));return l===0?0:l}function Oie(e,t){var r;Ft(1,arguments);var n=e||{},a=qt(n.start),o=qt(n.end),s=o.getTime();if(!(a.getTime()<=s))throw new RangeError("Invalid interval");var l=[],c=a;c.setHours(0,0,0,0);var u=Number((r=void 0)!==null&&r!==void 0?r:1);if(u<1||isNaN(u))throw new RangeError("`options.step` must be a number greater than 1");for(;c.getTime()<=s;)l.push(qt(c)),c.setDate(c.getDate()+u),c.setHours(0,0,0,0);return l}function _4(e){Ft(1,arguments);var t=qt(e);return t.setDate(1),t.setHours(0,0,0,0),t}function p2(e){Ft(1,arguments);var t=qt(e),r=t.getFullYear();return t.setFullYear(r+1,0,0),t.setHours(23,59,59,999),t}function Im(e){Ft(1,arguments);var t=qt(e),r=new Date(0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}function m2(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=cs(),f=an((r=(n=(a=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&a!==void 0?a:d.weekStartsOn)!==null&&n!==void 0?n:(c=d.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=qt(e),p=h.getDay(),v=(p<f?-7:0)+6-(p-f);return h.setDate(h.getDate()+v),h.setHours(23,59,59,999),h}function a6(e,t){Ft(2,arguments);var r=an(t);return Oy(e,-r)}var kie=864e5;function Tie(e){Ft(1,arguments);var t=qt(e),r=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var n=t.getTime(),a=r-n;return Math.floor(a/kie)+1}function Od(e){Ft(1,arguments);var t=1,r=qt(e),n=r.getUTCDay(),a=(n<t?7:0)+n-t;return r.setUTCDate(r.getUTCDate()-a),r.setUTCHours(0,0,0,0),r}function i6(e){Ft(1,arguments);var t=qt(e),r=t.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(r+1,0,4),n.setUTCHours(0,0,0,0);var a=Od(n),o=new Date(0);o.setUTCFullYear(r,0,4),o.setUTCHours(0,0,0,0);var s=Od(o);return t.getTime()>=a.getTime()?r+1:t.getTime()>=s.getTime()?r:r-1}function Eie(e){Ft(1,arguments);var t=i6(e),r=new Date(0);r.setUTCFullYear(t,0,4),r.setUTCHours(0,0,0,0);var n=Od(r);return n}var Iie=6048e5;function o6(e){Ft(1,arguments);var t=qt(e),r=Od(t).getTime()-Eie(t).getTime();return Math.round(r/Iie)+1}function ru(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=cs(),f=an((r=(n=(a=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&a!==void 0?a:d.weekStartsOn)!==null&&n!==void 0?n:(c=d.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.weekStartsOn)!==null&&r!==void 0?r:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=qt(e),p=h.getUTCDay(),v=(p<f?7:0)+p-f;return h.setUTCDate(h.getUTCDate()-v),h.setUTCHours(0,0,0,0),h}function pS(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=qt(e),f=d.getUTCFullYear(),h=cs(),p=an((r=(n=(a=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&a!==void 0?a:h.firstWeekContainsDate)!==null&&n!==void 0?n:(c=h.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&r!==void 0?r:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var v=new Date(0);v.setUTCFullYear(f+1,0,p),v.setUTCHours(0,0,0,0);var m=ru(v,t),y=new Date(0);y.setUTCFullYear(f,0,p),y.setUTCHours(0,0,0,0);var b=ru(y,t);return d.getTime()>=m.getTime()?f+1:d.getTime()>=b.getTime()?f:f-1}function Nie(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=cs(),f=an((r=(n=(a=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&a!==void 0?a:d.firstWeekContainsDate)!==null&&n!==void 0?n:(c=d.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&r!==void 0?r:1),h=pS(e,t),p=new Date(0);p.setUTCFullYear(h,0,f),p.setUTCHours(0,0,0,0);var v=ru(p,t);return v}var Die=6048e5;function s6(e,t){Ft(1,arguments);var r=qt(e),n=ru(r,t).getTime()-Nie(r,t).getTime();return Math.round(n/Die)+1}function Gr(e,t){for(var r=e<0?"-":"",n=Math.abs(e).toString();n.length<t;)n="0"+n;return r+n}var Ul={y:function(t,r){var n=t.getUTCFullYear(),a=n>0?n:1-n;return Gr(r==="yy"?a%100:a,r.length)},M:function(t,r){var n=t.getUTCMonth();return r==="M"?String(n+1):Gr(n+1,2)},d:function(t,r){return Gr(t.getUTCDate(),r.length)},a:function(t,r){var n=t.getUTCHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h:function(t,r){return Gr(t.getUTCHours()%12||12,r.length)},H:function(t,r){return Gr(t.getUTCHours(),r.length)},m:function(t,r){return Gr(t.getUTCMinutes(),r.length)},s:function(t,r){return Gr(t.getUTCSeconds(),r.length)},S:function(t,r){var n=r.length,a=t.getUTCMilliseconds(),o=Math.floor(a*Math.pow(10,n-3));return Gr(o,r.length)}},Su={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Mie={G:function(t,r,n){var a=t.getUTCFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return n.era(a,{width:"abbreviated"});case"GGGGG":return n.era(a,{width:"narrow"});case"GGGG":default:return n.era(a,{width:"wide"})}},y:function(t,r,n){if(r==="yo"){var a=t.getUTCFullYear(),o=a>0?a:1-a;return n.ordinalNumber(o,{unit:"year"})}return Ul.y(t,r)},Y:function(t,r,n,a){var o=pS(t,a),s=o>0?o:1-o;if(r==="YY"){var l=s%100;return Gr(l,2)}return r==="Yo"?n.ordinalNumber(s,{unit:"year"}):Gr(s,r.length)},R:function(t,r){var n=i6(t);return Gr(n,r.length)},u:function(t,r){var n=t.getUTCFullYear();return Gr(n,r.length)},Q:function(t,r,n){var a=Math.ceil((t.getUTCMonth()+1)/3);switch(r){case"Q":return String(a);case"QQ":return Gr(a,2);case"Qo":return n.ordinalNumber(a,{unit:"quarter"});case"QQQ":return n.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(a,{width:"wide",context:"formatting"})}},q:function(t,r,n){var a=Math.ceil((t.getUTCMonth()+1)/3);switch(r){case"q":return String(a);case"qq":return Gr(a,2);case"qo":return n.ordinalNumber(a,{unit:"quarter"});case"qqq":return n.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(a,{width:"wide",context:"standalone"})}},M:function(t,r,n){var a=t.getUTCMonth();switch(r){case"M":case"MM":return Ul.M(t,r);case"Mo":return n.ordinalNumber(a+1,{unit:"month"});case"MMM":return n.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(a,{width:"wide",context:"formatting"})}},L:function(t,r,n){var a=t.getUTCMonth();switch(r){case"L":return String(a+1);case"LL":return Gr(a+1,2);case"Lo":return n.ordinalNumber(a+1,{unit:"month"});case"LLL":return n.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(a,{width:"wide",context:"standalone"})}},w:function(t,r,n,a){var o=s6(t,a);return r==="wo"?n.ordinalNumber(o,{unit:"week"}):Gr(o,r.length)},I:function(t,r,n){var a=o6(t);return r==="Io"?n.ordinalNumber(a,{unit:"week"}):Gr(a,r.length)},d:function(t,r,n){return r==="do"?n.ordinalNumber(t.getUTCDate(),{unit:"date"}):Ul.d(t,r)},D:function(t,r,n){var a=Tie(t);return r==="Do"?n.ordinalNumber(a,{unit:"dayOfYear"}):Gr(a,r.length)},E:function(t,r,n){var a=t.getUTCDay();switch(r){case"E":case"EE":case"EEE":return n.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(a,{width:"short",context:"formatting"});case"EEEE":default:return n.day(a,{width:"wide",context:"formatting"})}},e:function(t,r,n,a){var o=t.getUTCDay(),s=(o-a.weekStartsOn+8)%7||7;switch(r){case"e":return String(s);case"ee":return Gr(s,2);case"eo":return n.ordinalNumber(s,{unit:"day"});case"eee":return n.day(o,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(o,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(o,{width:"short",context:"formatting"});case"eeee":default:return n.day(o,{width:"wide",context:"formatting"})}},c:function(t,r,n,a){var o=t.getUTCDay(),s=(o-a.weekStartsOn+8)%7||7;switch(r){case"c":return String(s);case"cc":return Gr(s,r.length);case"co":return n.ordinalNumber(s,{unit:"day"});case"ccc":return n.day(o,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(o,{width:"narrow",context:"standalone"});case"cccccc":return n.day(o,{width:"short",context:"standalone"});case"cccc":default:return n.day(o,{width:"wide",context:"standalone"})}},i:function(t,r,n){var a=t.getUTCDay(),o=a===0?7:a;switch(r){case"i":return String(o);case"ii":return Gr(o,r.length);case"io":return n.ordinalNumber(o,{unit:"day"});case"iii":return n.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(a,{width:"short",context:"formatting"});case"iiii":default:return n.day(a,{width:"wide",context:"formatting"})}},a:function(t,r,n){var a=t.getUTCHours(),o=a/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},b:function(t,r,n){var a=t.getUTCHours(),o;switch(a===12?o=Su.noon:a===0?o=Su.midnight:o=a/12>=1?"pm":"am",r){case"b":case"bb":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},B:function(t,r,n){var a=t.getUTCHours(),o;switch(a>=17?o=Su.evening:a>=12?o=Su.afternoon:a>=4?o=Su.morning:o=Su.night,r){case"B":case"BB":case"BBB":return n.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(o,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(o,{width:"wide",context:"formatting"})}},h:function(t,r,n){if(r==="ho"){var a=t.getUTCHours()%12;return a===0&&(a=12),n.ordinalNumber(a,{unit:"hour"})}return Ul.h(t,r)},H:function(t,r,n){return r==="Ho"?n.ordinalNumber(t.getUTCHours(),{unit:"hour"}):Ul.H(t,r)},K:function(t,r,n){var a=t.getUTCHours()%12;return r==="Ko"?n.ordinalNumber(a,{unit:"hour"}):Gr(a,r.length)},k:function(t,r,n){var a=t.getUTCHours();return a===0&&(a=24),r==="ko"?n.ordinalNumber(a,{unit:"hour"}):Gr(a,r.length)},m:function(t,r,n){return r==="mo"?n.ordinalNumber(t.getUTCMinutes(),{unit:"minute"}):Ul.m(t,r)},s:function(t,r,n){return r==="so"?n.ordinalNumber(t.getUTCSeconds(),{unit:"second"}):Ul.s(t,r)},S:function(t,r){return Ul.S(t,r)},X:function(t,r,n,a){var o=a._originalDate||t,s=o.getTimezoneOffset();if(s===0)return"Z";switch(r){case"X":return j4(s);case"XXXX":case"XX":return kc(s);case"XXXXX":case"XXX":default:return kc(s,":")}},x:function(t,r,n,a){var o=a._originalDate||t,s=o.getTimezoneOffset();switch(r){case"x":return j4(s);case"xxxx":case"xx":return kc(s);case"xxxxx":case"xxx":default:return kc(s,":")}},O:function(t,r,n,a){var o=a._originalDate||t,s=o.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+w4(s,":");case"OOOO":default:return"GMT"+kc(s,":")}},z:function(t,r,n,a){var o=a._originalDate||t,s=o.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+w4(s,":");case"zzzz":default:return"GMT"+kc(s,":")}},t:function(t,r,n,a){var o=a._originalDate||t,s=Math.floor(o.getTime()/1e3);return Gr(s,r.length)},T:function(t,r,n,a){var o=a._originalDate||t,s=o.getTime();return Gr(s,r.length)}};function w4(e,t){var r=e>0?"-":"+",n=Math.abs(e),a=Math.floor(n/60),o=n%60;if(o===0)return r+String(a);var s=t;return r+String(a)+s+Gr(o,2)}function j4(e,t){if(e%60===0){var r=e>0?"-":"+";return r+Gr(Math.abs(e)/60,2)}return kc(e,t)}function kc(e,t){var r=t||"",n=e>0?"-":"+",a=Math.abs(e),o=Gr(Math.floor(a/60),2),s=Gr(a%60,2);return n+o+r+s}var S4=function(t,r){switch(t){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},l6=function(t,r){switch(t){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},Lie=function(t,r){var n=t.match(/(P+)(p+)?/)||[],a=n[1],o=n[2];if(!o)return S4(t,r);var s;switch(a){case"P":s=r.dateTime({width:"short"});break;case"PP":s=r.dateTime({width:"medium"});break;case"PPP":s=r.dateTime({width:"long"});break;case"PPPP":default:s=r.dateTime({width:"full"});break}return s.replace("{{date}}",S4(a,r)).replace("{{time}}",l6(o,r))},ww={p:l6,P:Lie},Rie=["D","DD"],qie=["YY","YYYY"];function c6(e){return Rie.indexOf(e)!==-1}function u6(e){return qie.indexOf(e)!==-1}function mv(e,t,r){if(e==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var Fie={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},$ie=function(t,r,n){var a,o=Fie[t];return typeof o=="string"?a=o:r===1?a=o.one:a=o.other.replace("{{count}}",r.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+a:a+" ago":a};function g2(e){return function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.width?String(t.width):e.defaultWidth,n=e.formats[r]||e.formats[e.defaultWidth];return n}}var Bie={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Uie={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},zie={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Wie={date:g2({formats:Bie,defaultWidth:"full"}),time:g2({formats:Uie,defaultWidth:"full"}),dateTime:g2({formats:zie,defaultWidth:"full"})},Hie={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Vie=function(t,r,n,a){return Hie[t]};function Nf(e){return function(t,r){var n=r!=null&&r.context?String(r.context):"standalone",a;if(n==="formatting"&&e.formattingValues){var o=e.defaultFormattingWidth||e.defaultWidth,s=r!=null&&r.width?String(r.width):o;a=e.formattingValues[s]||e.formattingValues[o]}else{var l=e.defaultWidth,c=r!=null&&r.width?String(r.width):e.defaultWidth;a=e.values[c]||e.values[l]}var u=e.argumentCallback?e.argumentCallback(t):t;return a[u]}}var Gie={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Yie={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Kie={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Qie={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Xie={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Jie={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Zie=function(t,r){var n=Number(t),a=n%100;if(a>20||a<10)switch(a%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},eoe={ordinalNumber:Zie,era:Nf({values:Gie,defaultWidth:"wide"}),quarter:Nf({values:Yie,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:Nf({values:Kie,defaultWidth:"wide"}),day:Nf({values:Qie,defaultWidth:"wide"}),dayPeriod:Nf({values:Xie,defaultWidth:"wide",formattingValues:Jie,defaultFormattingWidth:"wide"})};function Df(e){return function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=r.width,a=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],o=t.match(a);if(!o)return null;var s=o[0],l=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(l)?roe(l,function(f){return f.test(s)}):toe(l,function(f){return f.test(s)}),u;u=e.valueCallback?e.valueCallback(c):c,u=r.valueCallback?r.valueCallback(u):u;var d=t.slice(s.length);return{value:u,rest:d}}}function toe(e,t){for(var r in e)if(e.hasOwnProperty(r)&&t(e[r]))return r}function roe(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return r}function noe(e){return function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.match(e.matchPattern);if(!n)return null;var a=n[0],o=t.match(e.parsePattern);if(!o)return null;var s=e.valueCallback?e.valueCallback(o[0]):o[0];s=r.valueCallback?r.valueCallback(s):s;var l=t.slice(a.length);return{value:s,rest:l}}}var aoe=/^(\d+)(th|st|nd|rd)?/i,ioe=/\d+/i,ooe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},soe={any:[/^b/i,/^(a|c)/i]},loe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},coe={any:[/1/i,/2/i,/3/i,/4/i]},uoe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},doe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},foe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},hoe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},poe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},moe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},goe={ordinalNumber:noe({matchPattern:aoe,parsePattern:ioe,valueCallback:function(t){return parseInt(t,10)}}),era:Df({matchPatterns:ooe,defaultMatchWidth:"wide",parsePatterns:soe,defaultParseWidth:"any"}),quarter:Df({matchPatterns:loe,defaultMatchWidth:"wide",parsePatterns:coe,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:Df({matchPatterns:uoe,defaultMatchWidth:"wide",parsePatterns:doe,defaultParseWidth:"any"}),day:Df({matchPatterns:foe,defaultMatchWidth:"wide",parsePatterns:hoe,defaultParseWidth:"any"}),dayPeriod:Df({matchPatterns:poe,defaultMatchWidth:"any",parsePatterns:moe,defaultParseWidth:"any"})},Iy={code:"en-US",formatDistance:$ie,formatLong:Wie,formatRelative:Vie,localize:eoe,match:goe,options:{weekStartsOn:0,firstWeekContainsDate:1}},voe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,yoe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,xoe=/^'([^]*?)'?$/,boe=/''/g,_oe=/[a-zA-Z]/;function Ru(e,t,r){var n,a,o,s,l,c,u,d,f,h,p,v,m,y,b,_,w,A;Ft(2,arguments);var P=String(t),T=cs(),E=(n=(a=r?.locale)!==null&&a!==void 0?a:T.locale)!==null&&n!==void 0?n:Iy,S=an((o=(s=(l=(c=r?.firstWeekContainsDate)!==null&&c!==void 0?c:r==null||(u=r.locale)===null||u===void 0||(d=u.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&l!==void 0?l:T.firstWeekContainsDate)!==null&&s!==void 0?s:(f=T.locale)===null||f===void 0||(h=f.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&o!==void 0?o:1);if(!(S>=1&&S<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var I=an((p=(v=(m=(y=r?.weekStartsOn)!==null&&y!==void 0?y:r==null||(b=r.locale)===null||b===void 0||(_=b.options)===null||_===void 0?void 0:_.weekStartsOn)!==null&&m!==void 0?m:T.weekStartsOn)!==null&&v!==void 0?v:(w=T.locale)===null||w===void 0||(A=w.options)===null||A===void 0?void 0:A.weekStartsOn)!==null&&p!==void 0?p:0);if(!(I>=0&&I<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!E.localize)throw new RangeError("locale must contain localize property");if(!E.formatLong)throw new RangeError("locale must contain formatLong property");var W=qt(e);if(!t6(W))throw new RangeError("Invalid time value");var O=Ad(W),D=a6(W,O),R={firstWeekContainsDate:S,weekStartsOn:I,locale:E,_originalDate:W},F=P.match(yoe).map(function(z){var K=z[0];if(K==="p"||K==="P"){var J=ww[K];return J(z,E.formatLong)}return z}).join("").match(voe).map(function(z){if(z==="''")return"'";var K=z[0];if(K==="'")return woe(z);var J=Mie[K];if(J)return!(r!=null&&r.useAdditionalWeekYearTokens)&&u6(z)&&mv(z,t,String(e)),!(r!=null&&r.useAdditionalDayOfYearTokens)&&c6(z)&&mv(z,t,String(e)),J(D,z,E.localize,R);if(K.match(_oe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+K+"`");return z}).join("");return F}function woe(e){var t=e.match(xoe);return t?t[1].replace(boe,"'"):e}function mS(e,t){if(e==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}function joe(e){return mS({},e)}var C4=1e3*60,gv=60*24,A4=gv*30,P4=gv*365;function Soe(e,t,r){var n,a,o;Ft(2,arguments);var s=cs(),l=(n=(a=r?.locale)!==null&&a!==void 0?a:s.locale)!==null&&n!==void 0?n:Iy;if(!l.formatDistance)throw new RangeError("locale must contain localize.formatDistance property");var c=Yu(e,t);if(isNaN(c))throw new RangeError("Invalid time value");var u=mS(joe(r),{addSuffix:!!r?.addSuffix,comparison:c}),d,f;c>0?(d=qt(t),f=qt(e)):(d=qt(e),f=qt(t));var h=String((o=r?.roundingMethod)!==null&&o!==void 0?o:"round"),p;if(h==="floor")p=Math.floor;else if(h==="ceil")p=Math.ceil;else if(h==="round")p=Math.round;else throw new RangeError("roundingMethod must be 'floor', 'ceil' or 'round'");var v=f.getTime()-d.getTime(),m=v/C4,y=Ad(f)-Ad(d),b=(v-y)/C4,_=r?.unit,w;if(_?w=String(_):m<1?w="second":m<60?w="minute":m<gv?w="hour":b<A4?w="day":b<P4?w="month":w="year",w==="second"){var A=p(v/1e3);return l.formatDistance("xSeconds",A,u)}else if(w==="minute"){var P=p(m);return l.formatDistance("xMinutes",P,u)}else if(w==="hour"){var T=p(m/60);return l.formatDistance("xHours",T,u)}else if(w==="day"){var E=p(b/gv);return l.formatDistance("xDays",E,u)}else if(w==="month"){var S=p(b/A4);return S===12&&_!=="month"?l.formatDistance("xYears",1,u):l.formatDistance("xMonths",S,u)}else if(w==="year"){var I=p(b/P4);return l.formatDistance("xYears",I,u)}throw new RangeError("unit must be 'second', 'minute', 'hour', 'day', 'month' or 'year'")}function Coe(e,t){return Ft(1,arguments),Soe(e,Date.now(),t)}function Aoe(e,t){var r,n;Ft(1,arguments);var a=qt(e);if(isNaN(a.getTime()))throw new RangeError("Invalid time value");var o=String((r=t?.format)!==null&&r!==void 0?r:"extended"),s=String((n=t?.representation)!==null&&n!==void 0?n:"complete");if(o!=="extended"&&o!=="basic")throw new RangeError("format must be 'extended' or 'basic'");if(s!=="date"&&s!=="time"&&s!=="complete")throw new RangeError("representation must be 'date', 'time', or 'complete'");var l="",c="",u=o==="extended"?"-":"",d=o==="extended"?":":"";if(s!=="time"){var f=Gr(a.getDate(),2),h=Gr(a.getMonth()+1,2),p=Gr(a.getFullYear(),4);l="".concat(p).concat(u).concat(h).concat(u).concat(f)}if(s!=="date"){var v=a.getTimezoneOffset();if(v!==0){var m=Math.abs(v),y=Gr(Math.floor(m/60),2),b=Gr(m%60,2),_=v<0?"+":"-";c="".concat(_).concat(y,":").concat(b)}else c="Z";var w=Gr(a.getHours(),2),A=Gr(a.getMinutes(),2),P=Gr(a.getSeconds(),2),T=l===""?"":"T",E=[w,A,P].join(d);l="".concat(l).concat(T).concat(E).concat(c)}return l}function Poe(e){Ft(1,arguments);var t=qt(e),r=t.getDate();return r}function d6(e){Ft(1,arguments);var t=qt(e),r=t.getFullYear(),n=t.getMonth(),a=new Date(0);return a.setFullYear(r,n+1,0),a.setHours(0,0,0,0),a.getDate()}function Ooe(e){Ft(1,arguments);var t=qt(e),r=t.getHours();return r}function koe(e){Ft(1,arguments);var t=qt(e),r=t.getMilliseconds();return r}function Toe(e){Ft(1,arguments);var t=qt(e),r=t.getMinutes();return r}function Eoe(e){Ft(1,arguments);var t=qt(e),r=t.getMonth();return r}function Ioe(e){Ft(1,arguments);var t=qt(e),r=t.getSeconds();return r}function Noe(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=qt(e),f=d.getFullYear(),h=cs(),p=an((r=(n=(a=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&a!==void 0?a:h.firstWeekContainsDate)!==null&&n!==void 0?n:(c=h.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&r!==void 0?r:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var v=new Date(0);v.setFullYear(f+1,0,p),v.setHours(0,0,0,0);var m=zc(v,t),y=new Date(0);y.setFullYear(f,0,p),y.setHours(0,0,0,0);var b=zc(y,t);return d.getTime()>=m.getTime()?f+1:d.getTime()>=b.getTime()?f:f-1}function Doe(e,t){var r,n,a,o,s,l,c,u;Ft(1,arguments);var d=cs(),f=an((r=(n=(a=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&a!==void 0?a:d.firstWeekContainsDate)!==null&&n!==void 0?n:(c=d.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&r!==void 0?r:1),h=Noe(e,t),p=new Date(0);p.setFullYear(h,0,f),p.setHours(0,0,0,0);var v=zc(p,t);return v}var Moe=6048e5;function Loe(e,t){Ft(1,arguments);var r=qt(e),n=zc(r,t).getTime()-Doe(r,t).getTime();return Math.round(n/Moe)+1}function Roe(e){return Ft(1,arguments),qt(e).getFullYear()}function v2(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getTime()>n.getTime()}function Mf(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getTime()<n.getTime()}function qoe(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getTime()===n.getTime()}function O4(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Foe(e,t){if(e){if(typeof e=="string")return O4(e,t);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?O4(e,t):void 0}}function k4(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Foe(e))||t){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var u=r.next();return s=u.done,u},e:function(u){l=!0,o=u},f:function(){try{s||r.return==null||r.return()}finally{if(l)throw o}}}}function on(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&x8(e,t)}function vv(e){return vv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vv(e)}function f6(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(f6=function(){return!!e})()}function $oe(e,t){if(t&&(gn(t)=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Qt(e)}function sn(e){var t=f6();return function(){var r,n=vv(e);if(t){var a=vv(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return $oe(this,r)}}function Zr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Boe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,AI(n.key),n)}}function en(e,t,r){return t&&Boe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ht(e,t,r){return(t=AI(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Uoe=10,h6=function(){function e(){Zr(this,e),Ht(this,"priority",void 0),Ht(this,"subPriority",0)}return en(e,[{key:"validate",value:function(r,n){return!0}}]),e}(),zoe=function(e){on(r,e);var t=sn(r);function r(n,a,o,s,l){var c;return Zr(this,r),c=t.call(this),c.value=n,c.validateValue=a,c.setValue=o,c.priority=s,l&&(c.subPriority=l),c}return en(r,[{key:"validate",value:function(a,o){return this.validateValue(a,this.value,o)}},{key:"set",value:function(a,o,s){return this.setValue(a,o,this.value,s)}}]),r}(h6),Woe=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",Uoe),Ht(Qt(n),"subPriority",-1),n}return en(r,[{key:"set",value:function(a,o){if(o.timestampIsSet)return a;var s=new Date(0);return s.setFullYear(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()),s.setHours(a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),s}}]),r}(h6),vn=function(){function e(){Zr(this,e),Ht(this,"incompatibleTokens",void 0),Ht(this,"priority",void 0),Ht(this,"subPriority",void 0)}return en(e,[{key:"run",value:function(r,n,a,o){var s=this.parse(r,n,a,o);return s?{setter:new zoe(s.value,this.validate,this.set,this.priority,this.subPriority),rest:s.rest}:null}},{key:"validate",value:function(r,n,a){return!0}}]),e}(),Hoe=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",140),Ht(Qt(n),"incompatibleTokens",["R","u","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"G":case"GG":case"GGG":return s.era(a,{width:"abbreviated"})||s.era(a,{width:"narrow"});case"GGGGG":return s.era(a,{width:"narrow"});case"GGGG":default:return s.era(a,{width:"wide"})||s.era(a,{width:"abbreviated"})||s.era(a,{width:"narrow"})}}},{key:"set",value:function(a,o,s){return o.era=s,a.setUTCFullYear(s,0,1),a.setUTCHours(0,0,0,0),a}}]),r}(vn),Sa={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},bs={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function Ca(e,t){return e&&{value:t(e.value),rest:e.rest}}function oa(e,t){var r=t.match(e);return r?{value:parseInt(r[0],10),rest:t.slice(r[0].length)}:null}function _s(e,t){var r=t.match(e);if(!r)return null;if(r[0]==="Z")return{value:0,rest:t.slice(1)};var n=r[1]==="+"?1:-1,a=r[2]?parseInt(r[2],10):0,o=r[3]?parseInt(r[3],10):0,s=r[5]?parseInt(r[5],10):0;return{value:n*(a*Ty+o*ky+s*mie),rest:t.slice(r[0].length)}}function p6(e){return oa(Sa.anyDigitsSigned,e)}function ga(e,t){switch(e){case 1:return oa(Sa.singleDigit,t);case 2:return oa(Sa.twoDigits,t);case 3:return oa(Sa.threeDigits,t);case 4:return oa(Sa.fourDigits,t);default:return oa(new RegExp("^\\d{1,"+e+"}"),t)}}function yv(e,t){switch(e){case 1:return oa(Sa.singleDigitSigned,t);case 2:return oa(Sa.twoDigitsSigned,t);case 3:return oa(Sa.threeDigitsSigned,t);case 4:return oa(Sa.fourDigitsSigned,t);default:return oa(new RegExp("^-?\\d{1,"+e+"}"),t)}}function gS(e){switch(e){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function m6(e,t){var r=t>0,n=r?t:1-t,a;if(n<=50)a=e||100;else{var o=n+50,s=Math.floor(o/100)*100,l=e>=o%100;a=e+s-(l?100:0)}return r?a:1-a}function g6(e){return e%400===0||e%4===0&&e%100!==0}var Voe=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",130),Ht(Qt(n),"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){var l=function(u){return{year:u,isTwoDigitYear:o==="yy"}};switch(o){case"y":return Ca(ga(4,a),l);case"yo":return Ca(s.ordinalNumber(a,{unit:"year"}),l);default:return Ca(ga(o.length,a),l)}}},{key:"validate",value:function(a,o){return o.isTwoDigitYear||o.year>0}},{key:"set",value:function(a,o,s){var l=a.getUTCFullYear();if(s.isTwoDigitYear){var c=m6(s.year,l);return a.setUTCFullYear(c,0,1),a.setUTCHours(0,0,0,0),a}var u=!("era"in o)||o.era===1?s.year:1-s.year;return a.setUTCFullYear(u,0,1),a.setUTCHours(0,0,0,0),a}}]),r}(vn),Goe=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",130),Ht(Qt(n),"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){var l=function(u){return{year:u,isTwoDigitYear:o==="YY"}};switch(o){case"Y":return Ca(ga(4,a),l);case"Yo":return Ca(s.ordinalNumber(a,{unit:"year"}),l);default:return Ca(ga(o.length,a),l)}}},{key:"validate",value:function(a,o){return o.isTwoDigitYear||o.year>0}},{key:"set",value:function(a,o,s,l){var c=pS(a,l);if(s.isTwoDigitYear){var u=m6(s.year,c);return a.setUTCFullYear(u,0,l.firstWeekContainsDate),a.setUTCHours(0,0,0,0),ru(a,l)}var d=!("era"in o)||o.era===1?s.year:1-s.year;return a.setUTCFullYear(d,0,l.firstWeekContainsDate),a.setUTCHours(0,0,0,0),ru(a,l)}}]),r}(vn),Yoe=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",130),Ht(Qt(n),"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o){return yv(o==="R"?4:o.length,a)}},{key:"set",value:function(a,o,s){var l=new Date(0);return l.setUTCFullYear(s,0,4),l.setUTCHours(0,0,0,0),Od(l)}}]),r}(vn),Koe=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",130),Ht(Qt(n),"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o){return yv(o==="u"?4:o.length,a)}},{key:"set",value:function(a,o,s){return a.setUTCFullYear(s,0,1),a.setUTCHours(0,0,0,0),a}}]),r}(vn),Qoe=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",120),Ht(Qt(n),"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"Q":case"QQ":return ga(o.length,a);case"Qo":return s.ordinalNumber(a,{unit:"quarter"});case"QQQ":return s.quarter(a,{width:"abbreviated",context:"formatting"})||s.quarter(a,{width:"narrow",context:"formatting"});case"QQQQQ":return s.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(a,{width:"wide",context:"formatting"})||s.quarter(a,{width:"abbreviated",context:"formatting"})||s.quarter(a,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(a,o){return o>=1&&o<=4}},{key:"set",value:function(a,o,s){return a.setUTCMonth((s-1)*3,1),a.setUTCHours(0,0,0,0),a}}]),r}(vn),Xoe=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",120),Ht(Qt(n),"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"q":case"qq":return ga(o.length,a);case"qo":return s.ordinalNumber(a,{unit:"quarter"});case"qqq":return s.quarter(a,{width:"abbreviated",context:"standalone"})||s.quarter(a,{width:"narrow",context:"standalone"});case"qqqqq":return s.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(a,{width:"wide",context:"standalone"})||s.quarter(a,{width:"abbreviated",context:"standalone"})||s.quarter(a,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(a,o){return o>=1&&o<=4}},{key:"set",value:function(a,o,s){return a.setUTCMonth((s-1)*3,1),a.setUTCHours(0,0,0,0),a}}]),r}(vn),Joe=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]),Ht(Qt(n),"priority",110),n}return en(r,[{key:"parse",value:function(a,o,s){var l=function(u){return u-1};switch(o){case"M":return Ca(oa(Sa.month,a),l);case"MM":return Ca(ga(2,a),l);case"Mo":return Ca(s.ordinalNumber(a,{unit:"month"}),l);case"MMM":return s.month(a,{width:"abbreviated",context:"formatting"})||s.month(a,{width:"narrow",context:"formatting"});case"MMMMM":return s.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(a,{width:"wide",context:"formatting"})||s.month(a,{width:"abbreviated",context:"formatting"})||s.month(a,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(a,o){return o>=0&&o<=11}},{key:"set",value:function(a,o,s){return a.setUTCMonth(s,1),a.setUTCHours(0,0,0,0),a}}]),r}(vn),Zoe=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",110),Ht(Qt(n),"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){var l=function(u){return u-1};switch(o){case"L":return Ca(oa(Sa.month,a),l);case"LL":return Ca(ga(2,a),l);case"Lo":return Ca(s.ordinalNumber(a,{unit:"month"}),l);case"LLL":return s.month(a,{width:"abbreviated",context:"standalone"})||s.month(a,{width:"narrow",context:"standalone"});case"LLLLL":return s.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(a,{width:"wide",context:"standalone"})||s.month(a,{width:"abbreviated",context:"standalone"})||s.month(a,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(a,o){return o>=0&&o<=11}},{key:"set",value:function(a,o,s){return a.setUTCMonth(s,1),a.setUTCHours(0,0,0,0),a}}]),r}(vn);function ese(e,t,r){Ft(2,arguments);var n=qt(e),a=an(t),o=s6(n,r)-a;return n.setUTCDate(n.getUTCDate()-o*7),n}var tse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",100),Ht(Qt(n),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"w":return oa(Sa.week,a);case"wo":return s.ordinalNumber(a,{unit:"week"});default:return ga(o.length,a)}}},{key:"validate",value:function(a,o){return o>=1&&o<=53}},{key:"set",value:function(a,o,s,l){return ru(ese(a,s,l),l)}}]),r}(vn);function rse(e,t){Ft(2,arguments);var r=qt(e),n=an(t),a=o6(r)-n;return r.setUTCDate(r.getUTCDate()-a*7),r}var nse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",100),Ht(Qt(n),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"I":return oa(Sa.week,a);case"Io":return s.ordinalNumber(a,{unit:"week"});default:return ga(o.length,a)}}},{key:"validate",value:function(a,o){return o>=1&&o<=53}},{key:"set",value:function(a,o,s){return Od(rse(a,s))}}]),r}(vn),ase=[31,28,31,30,31,30,31,31,30,31,30,31],ise=[31,29,31,30,31,30,31,31,30,31,30,31],ose=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",90),Ht(Qt(n),"subPriority",1),Ht(Qt(n),"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"d":return oa(Sa.date,a);case"do":return s.ordinalNumber(a,{unit:"date"});default:return ga(o.length,a)}}},{key:"validate",value:function(a,o){var s=a.getUTCFullYear(),l=g6(s),c=a.getUTCMonth();return l?o>=1&&o<=ise[c]:o>=1&&o<=ase[c]}},{key:"set",value:function(a,o,s){return a.setUTCDate(s),a.setUTCHours(0,0,0,0),a}}]),r}(vn),sse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",90),Ht(Qt(n),"subpriority",1),Ht(Qt(n),"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"D":case"DD":return oa(Sa.dayOfYear,a);case"Do":return s.ordinalNumber(a,{unit:"date"});default:return ga(o.length,a)}}},{key:"validate",value:function(a,o){var s=a.getUTCFullYear(),l=g6(s);return l?o>=1&&o<=366:o>=1&&o<=365}},{key:"set",value:function(a,o,s){return a.setUTCMonth(0,s),a.setUTCHours(0,0,0,0),a}}]),r}(vn);function vS(e,t,r){var n,a,o,s,l,c,u,d;Ft(2,arguments);var f=cs(),h=an((n=(a=(o=(s=r?.weekStartsOn)!==null&&s!==void 0?s:r==null||(l=r.locale)===null||l===void 0||(c=l.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&o!==void 0?o:f.weekStartsOn)!==null&&a!==void 0?a:(u=f.locale)===null||u===void 0||(d=u.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&n!==void 0?n:0);if(!(h>=0&&h<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var p=qt(e),v=an(t),m=p.getUTCDay(),y=v%7,b=(y+7)%7,_=(b<h?7:0)+v-m;return p.setUTCDate(p.getUTCDate()+_),p}var lse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",90),Ht(Qt(n),"incompatibleTokens",["D","i","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"E":case"EE":case"EEE":return s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"});case"EEEEE":return s.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"});case"EEEE":default:return s.day(a,{width:"wide",context:"formatting"})||s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(a,o){return o>=0&&o<=6}},{key:"set",value:function(a,o,s,l){return a=vS(a,s,l),a.setUTCHours(0,0,0,0),a}}]),r}(vn),cse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",90),Ht(Qt(n),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s,l){var c=function(d){var f=Math.floor((d-1)/7)*7;return(d+l.weekStartsOn+6)%7+f};switch(o){case"e":case"ee":return Ca(ga(o.length,a),c);case"eo":return Ca(s.ordinalNumber(a,{unit:"day"}),c);case"eee":return s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"});case"eeeee":return s.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"});case"eeee":default:return s.day(a,{width:"wide",context:"formatting"})||s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(a,o){return o>=0&&o<=6}},{key:"set",value:function(a,o,s,l){return a=vS(a,s,l),a.setUTCHours(0,0,0,0),a}}]),r}(vn),use=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",90),Ht(Qt(n),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s,l){var c=function(d){var f=Math.floor((d-1)/7)*7;return(d+l.weekStartsOn+6)%7+f};switch(o){case"c":case"cc":return Ca(ga(o.length,a),c);case"co":return Ca(s.ordinalNumber(a,{unit:"day"}),c);case"ccc":return s.day(a,{width:"abbreviated",context:"standalone"})||s.day(a,{width:"short",context:"standalone"})||s.day(a,{width:"narrow",context:"standalone"});case"ccccc":return s.day(a,{width:"narrow",context:"standalone"});case"cccccc":return s.day(a,{width:"short",context:"standalone"})||s.day(a,{width:"narrow",context:"standalone"});case"cccc":default:return s.day(a,{width:"wide",context:"standalone"})||s.day(a,{width:"abbreviated",context:"standalone"})||s.day(a,{width:"short",context:"standalone"})||s.day(a,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(a,o){return o>=0&&o<=6}},{key:"set",value:function(a,o,s,l){return a=vS(a,s,l),a.setUTCHours(0,0,0,0),a}}]),r}(vn);function dse(e,t){Ft(2,arguments);var r=an(t);r%7===0&&(r=r-7);var n=1,a=qt(e),o=a.getUTCDay(),s=r%7,l=(s+7)%7,c=(l<n?7:0)+r-o;return a.setUTCDate(a.getUTCDate()+c),a}var fse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",90),Ht(Qt(n),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){var l=function(u){return u===0?7:u};switch(o){case"i":case"ii":return ga(o.length,a);case"io":return s.ordinalNumber(a,{unit:"day"});case"iii":return Ca(s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"}),l);case"iiiii":return Ca(s.day(a,{width:"narrow",context:"formatting"}),l);case"iiiiii":return Ca(s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"}),l);case"iiii":default:return Ca(s.day(a,{width:"wide",context:"formatting"})||s.day(a,{width:"abbreviated",context:"formatting"})||s.day(a,{width:"short",context:"formatting"})||s.day(a,{width:"narrow",context:"formatting"}),l)}}},{key:"validate",value:function(a,o){return o>=1&&o<=7}},{key:"set",value:function(a,o,s){return a=dse(a,s),a.setUTCHours(0,0,0,0),a}}]),r}(vn),hse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",80),Ht(Qt(n),"incompatibleTokens",["b","B","H","k","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"a":case"aa":case"aaa":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaaa":return s.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(a,{width:"wide",context:"formatting"})||s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(a,o,s){return a.setUTCHours(gS(s),0,0,0),a}}]),r}(vn),pse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",80),Ht(Qt(n),"incompatibleTokens",["a","B","H","k","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"b":case"bb":case"bbb":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbbb":return s.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(a,{width:"wide",context:"formatting"})||s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(a,o,s){return a.setUTCHours(gS(s),0,0,0),a}}]),r}(vn),mse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",80),Ht(Qt(n),"incompatibleTokens",["a","b","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"B":case"BB":case"BBB":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBBB":return s.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(a,{width:"wide",context:"formatting"})||s.dayPeriod(a,{width:"abbreviated",context:"formatting"})||s.dayPeriod(a,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(a,o,s){return a.setUTCHours(gS(s),0,0,0),a}}]),r}(vn),gse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",70),Ht(Qt(n),"incompatibleTokens",["H","K","k","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"h":return oa(Sa.hour12h,a);case"ho":return s.ordinalNumber(a,{unit:"hour"});default:return ga(o.length,a)}}},{key:"validate",value:function(a,o){return o>=1&&o<=12}},{key:"set",value:function(a,o,s){var l=a.getUTCHours()>=12;return l&&s<12?a.setUTCHours(s+12,0,0,0):!l&&s===12?a.setUTCHours(0,0,0,0):a.setUTCHours(s,0,0,0),a}}]),r}(vn),vse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",70),Ht(Qt(n),"incompatibleTokens",["a","b","h","K","k","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"H":return oa(Sa.hour23h,a);case"Ho":return s.ordinalNumber(a,{unit:"hour"});default:return ga(o.length,a)}}},{key:"validate",value:function(a,o){return o>=0&&o<=23}},{key:"set",value:function(a,o,s){return a.setUTCHours(s,0,0,0),a}}]),r}(vn),yse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",70),Ht(Qt(n),"incompatibleTokens",["h","H","k","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"K":return oa(Sa.hour11h,a);case"Ko":return s.ordinalNumber(a,{unit:"hour"});default:return ga(o.length,a)}}},{key:"validate",value:function(a,o){return o>=0&&o<=11}},{key:"set",value:function(a,o,s){var l=a.getUTCHours()>=12;return l&&s<12?a.setUTCHours(s+12,0,0,0):a.setUTCHours(s,0,0,0),a}}]),r}(vn),xse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",70),Ht(Qt(n),"incompatibleTokens",["a","b","h","H","K","t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"k":return oa(Sa.hour24h,a);case"ko":return s.ordinalNumber(a,{unit:"hour"});default:return ga(o.length,a)}}},{key:"validate",value:function(a,o){return o>=1&&o<=24}},{key:"set",value:function(a,o,s){var l=s<=24?s%24:s;return a.setUTCHours(l,0,0,0),a}}]),r}(vn),bse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",60),Ht(Qt(n),"incompatibleTokens",["t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"m":return oa(Sa.minute,a);case"mo":return s.ordinalNumber(a,{unit:"minute"});default:return ga(o.length,a)}}},{key:"validate",value:function(a,o){return o>=0&&o<=59}},{key:"set",value:function(a,o,s){return a.setUTCMinutes(s,0,0),a}}]),r}(vn),_se=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",50),Ht(Qt(n),"incompatibleTokens",["t","T"]),n}return en(r,[{key:"parse",value:function(a,o,s){switch(o){case"s":return oa(Sa.second,a);case"so":return s.ordinalNumber(a,{unit:"second"});default:return ga(o.length,a)}}},{key:"validate",value:function(a,o){return o>=0&&o<=59}},{key:"set",value:function(a,o,s){return a.setUTCSeconds(s,0),a}}]),r}(vn),wse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",30),Ht(Qt(n),"incompatibleTokens",["t","T"]),n}return en(r,[{key:"parse",value:function(a,o){var s=function(c){return Math.floor(c*Math.pow(10,-o.length+3))};return Ca(ga(o.length,a),s)}},{key:"set",value:function(a,o,s){return a.setUTCMilliseconds(s),a}}]),r}(vn),jse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",10),Ht(Qt(n),"incompatibleTokens",["t","T","x"]),n}return en(r,[{key:"parse",value:function(a,o){switch(o){case"X":return _s(bs.basicOptionalMinutes,a);case"XX":return _s(bs.basic,a);case"XXXX":return _s(bs.basicOptionalSeconds,a);case"XXXXX":return _s(bs.extendedOptionalSeconds,a);case"XXX":default:return _s(bs.extended,a)}}},{key:"set",value:function(a,o,s){return o.timestampIsSet?a:new Date(a.getTime()-s)}}]),r}(vn),Sse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",10),Ht(Qt(n),"incompatibleTokens",["t","T","X"]),n}return en(r,[{key:"parse",value:function(a,o){switch(o){case"x":return _s(bs.basicOptionalMinutes,a);case"xx":return _s(bs.basic,a);case"xxxx":return _s(bs.basicOptionalSeconds,a);case"xxxxx":return _s(bs.extendedOptionalSeconds,a);case"xxx":default:return _s(bs.extended,a)}}},{key:"set",value:function(a,o,s){return o.timestampIsSet?a:new Date(a.getTime()-s)}}]),r}(vn),Cse=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",40),Ht(Qt(n),"incompatibleTokens","*"),n}return en(r,[{key:"parse",value:function(a){return p6(a)}},{key:"set",value:function(a,o,s){return[new Date(s*1e3),{timestampIsSet:!0}]}}]),r}(vn),Ase=function(e){on(r,e);var t=sn(r);function r(){var n;Zr(this,r);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n=t.call.apply(t,[this].concat(o)),Ht(Qt(n),"priority",20),Ht(Qt(n),"incompatibleTokens","*"),n}return en(r,[{key:"parse",value:function(a){return p6(a)}},{key:"set",value:function(a,o,s){return[new Date(s),{timestampIsSet:!0}]}}]),r}(vn),Pse={G:new Hoe,y:new Voe,Y:new Goe,R:new Yoe,u:new Koe,Q:new Qoe,q:new Xoe,M:new Joe,L:new Zoe,w:new tse,I:new nse,d:new ose,D:new sse,E:new lse,e:new cse,c:new use,i:new fse,a:new hse,b:new pse,B:new mse,h:new gse,H:new vse,K:new yse,k:new xse,m:new bse,s:new _se,S:new wse,X:new jse,x:new Sse,t:new Cse,T:new Ase},Ose=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,kse=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Tse=/^'([^]*?)'?$/,Ese=/''/g,Ise=/\S/,Nse=/[a-zA-Z]/;function Dse(e,t,r,n){var a,o,s,l,c,u,d,f,h,p,v,m,y,b,_,w,A,P;Ft(3,arguments);var T=String(e),E=String(t),S=cs(),I=(a=(o=n?.locale)!==null&&o!==void 0?o:S.locale)!==null&&a!==void 0?a:Iy;if(!I.match)throw new RangeError("locale must contain match property");var W=an((s=(l=(c=(u=n?.firstWeekContainsDate)!==null&&u!==void 0?u:n==null||(d=n.locale)===null||d===void 0||(f=d.options)===null||f===void 0?void 0:f.firstWeekContainsDate)!==null&&c!==void 0?c:S.firstWeekContainsDate)!==null&&l!==void 0?l:(h=S.locale)===null||h===void 0||(p=h.options)===null||p===void 0?void 0:p.firstWeekContainsDate)!==null&&s!==void 0?s:1);if(!(W>=1&&W<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var O=an((v=(m=(y=(b=n?.weekStartsOn)!==null&&b!==void 0?b:n==null||(_=n.locale)===null||_===void 0||(w=_.options)===null||w===void 0?void 0:w.weekStartsOn)!==null&&y!==void 0?y:S.weekStartsOn)!==null&&m!==void 0?m:(A=S.locale)===null||A===void 0||(P=A.options)===null||P===void 0?void 0:P.weekStartsOn)!==null&&v!==void 0?v:0);if(!(O>=0&&O<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(E==="")return T===""?qt(r):new Date(NaN);var D={firstWeekContainsDate:W,weekStartsOn:O,locale:I},R=[new Woe],F=E.match(kse).map(function(oe){var ae=oe[0];if(ae in ww){var he=ww[ae];return he(oe,I.formatLong)}return oe}).join("").match(Ose),z=[],K=k4(F),J;try{var L=function(){var ae=J.value;!(n!=null&&n.useAdditionalWeekYearTokens)&&u6(ae)&&mv(ae,E,e),!(n!=null&&n.useAdditionalDayOfYearTokens)&&c6(ae)&&mv(ae,E,e);var he=ae[0],me=Pse[he];if(me){var Q=me.incompatibleTokens;if(Array.isArray(Q)){var G=z.find(function(se){return Q.includes(se.token)||se.token===he});if(G)throw new RangeError("The format string mustn't contain `".concat(G.fullToken,"` and `").concat(ae,"` at the same time"))}else if(me.incompatibleTokens==="*"&&z.length>0)throw new RangeError("The format string mustn't contain `".concat(ae,"` and any other token at the same time"));z.push({token:he,fullToken:ae});var ee=me.run(T,ae,I.match,D);if(!ee)return{v:new Date(NaN)};R.push(ee.setter),T=ee.rest}else{if(he.match(Nse))throw new RangeError("Format string contains an unescaped latin alphabet character `"+he+"`");if(ae==="''"?ae="'":he==="'"&&(ae=Mse(ae)),T.indexOf(ae)===0)T=T.slice(ae.length);else return{v:new Date(NaN)}}};for(K.s();!(J=K.n()).done;){var k=L();if(gn(k)==="object")return k.v}}catch(oe){K.e(oe)}finally{K.f()}if(T.length>0&&Ise.test(T))return new Date(NaN);var $=R.map(function(oe){return oe.priority}).sort(function(oe,ae){return ae-oe}).filter(function(oe,ae,he){return he.indexOf(oe)===ae}).map(function(oe){return R.filter(function(ae){return ae.priority===oe}).sort(function(ae,he){return he.subPriority-ae.subPriority})}).map(function(oe){return oe[0]}),X=qt(r);if(isNaN(X.getTime()))return new Date(NaN);var C=a6(X,Ad(X)),M={},H=k4($),U;try{for(H.s();!(U=H.n()).done;){var te=U.value;if(!te.validate(C,D))return new Date(NaN);var le=te.set(C,M,D);Array.isArray(le)?(C=le[0],mS(M,le[1])):C=le}}catch(oe){H.e(oe)}finally{H.f()}return C}function Mse(e){return e.match(Tse)[1].replace(Ese,"'")}function T4(e){Ft(1,arguments);var t=qt(e);return t.setMinutes(0,0,0),t}function Lse(e,t){Ft(2,arguments);var r=T4(e),n=T4(t);return r.getTime()===n.getTime()}function Rse(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getFullYear()===n.getFullYear()&&r.getMonth()===n.getMonth()}function qse(e,t){Ft(2,arguments);var r=qt(e),n=qt(t);return r.getFullYear()===n.getFullYear()}function Fse(e,t){Ft(2,arguments);var r=qt(e).getTime(),n=qt(t.start).getTime(),a=qt(t.end).getTime();if(!(n<=a))throw new RangeError("Invalid interval");return r>=n&&r<=a}function $se(e,t){var r;Ft(1,arguments);var n=an((r=void 0)!==null&&r!==void 0?r:2);if(n!==2&&n!==1&&n!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var a=Wse(e),o;if(a.date){var s=Hse(a.date,n);o=Vse(s.restDateString,s.year)}if(!o||isNaN(o.getTime()))return new Date(NaN);var l=o.getTime(),c=0,u;if(a.time&&(c=Gse(a.time),isNaN(c)))return new Date(NaN);if(a.timezone){if(u=Yse(a.timezone),isNaN(u))return new Date(NaN)}else{var d=new Date(l+c),f=new Date(0);return f.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),f.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),f}return new Date(l+c+u)}var Nm={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Bse=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Use=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,zse=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Wse(e){var t={},r=e.split(Nm.dateTimeDelimiter),n;if(r.length>2)return t;if(/:/.test(r[0])?n=r[0]:(t.date=r[0],n=r[1],Nm.timeZoneDelimiter.test(t.date)&&(t.date=e.split(Nm.timeZoneDelimiter)[0],n=e.substr(t.date.length,e.length))),n){var a=Nm.timezone.exec(n);a?(t.time=n.replace(a[1],""),t.timezone=a[1]):t.time=n}return t}function Hse(e,t){var r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=e.match(r);if(!n)return{year:NaN,restDateString:""};var a=n[1]?parseInt(n[1]):null,o=n[2]?parseInt(n[2]):null;return{year:o===null?a:o*100,restDateString:e.slice((n[1]||n[2]).length)}}function Vse(e,t){if(t===null)return new Date(NaN);var r=e.match(Bse);if(!r)return new Date(NaN);var n=!!r[4],a=Lf(r[1]),o=Lf(r[2])-1,s=Lf(r[3]),l=Lf(r[4]),c=Lf(r[5])-1;if(n)return Zse(t,l,c)?Kse(t,l,c):new Date(NaN);var u=new Date(0);return!Xse(t,o,s)||!Jse(t,a)?new Date(NaN):(u.setUTCFullYear(t,o,Math.max(a,s)),u)}function Lf(e){return e?parseInt(e):1}function Gse(e){var t=e.match(Use);if(!t)return NaN;var r=y2(t[1]),n=y2(t[2]),a=y2(t[3]);return ele(r,n,a)?r*Ty+n*ky+a*1e3:NaN}function y2(e){return e&&parseFloat(e.replace(",","."))||0}function Yse(e){if(e==="Z")return 0;var t=e.match(zse);if(!t)return 0;var r=t[1]==="+"?-1:1,n=parseInt(t[2]),a=t[3]&&parseInt(t[3])||0;return tle(n,a)?r*(n*Ty+a*ky):NaN}function Kse(e,t,r){var n=new Date(0);n.setUTCFullYear(e,0,4);var a=n.getUTCDay()||7,o=(t-1)*7+r+1-a;return n.setUTCDate(n.getUTCDate()+o),n}var Qse=[31,null,31,30,31,30,31,31,30,31,30,31];function v6(e){return e%400===0||e%4===0&&e%100!==0}function Xse(e,t,r){return t>=0&&t<=11&&r>=1&&r<=(Qse[t]||(v6(e)?29:28))}function Jse(e,t){return t>=1&&t<=(v6(e)?366:365)}function Zse(e,t,r){return t>=1&&t<=53&&r>=0&&r<=6}function ele(e,t,r){return e===24?t===0&&r===0:r>=0&&r<60&&t>=0&&t<60&&e>=0&&e<25}function tle(e,t){return t>=0&&t<=59}function rle(e,t){Ft(2,arguments);var r=qt(e),n=an(t),a=r.getFullYear(),o=r.getDate(),s=new Date(0);s.setFullYear(a,n,15),s.setHours(0,0,0,0);var l=d6(s);return r.setMonth(n,Math.min(o,l)),r}function nle(e,t){Ft(2,arguments);var r=qt(e),n=an(t);return r.setDate(n),r}function ale(e,t){Ft(2,arguments);var r=qt(e),n=an(t);return r.setHours(n),r}function ile(e,t){Ft(2,arguments);var r=qt(e),n=an(t);return r.setMilliseconds(n),r}function ole(e,t){Ft(2,arguments);var r=qt(e),n=an(t);return r.setMinutes(n),r}function sle(e,t){Ft(2,arguments);var r=qt(e),n=an(t);return r.setSeconds(n),r}function lle(e,t){Ft(2,arguments);var r=qt(e),n=an(t);return isNaN(r.getTime())?new Date(NaN):(r.setFullYear(n),r)}const Oh=e=>{const t=(e??"").toString().trim().toLowerCase();return t==="approved"?"Approved":t==="rejected"?"Rejected":"Open"},E4=e=>{const t=Number(e);return isFinite(t)?new Intl.NumberFormat("en-CA",{maximumFractionDigits:0}).format(t):""},cle=()=>{const e=Tn(),[t,r]=x.useState([]),[n,a]=x.useState(""),[o,s]=x.useState("Open"),[l,c]=x.useState({page:0,pageSize:10}),[u,d]=x.useState(null),[f,h]=x.useState(null);x.useEffect(()=>{p()},[]);const p=async()=>{try{const E=((await ve.get("/api/quotes")).data||[]).map(S=>({...S,status:Oh(S.status)}));r(E)}catch(T){console.error("Error fetching quotes:",T),d("Failed to fetch quotes")}},v=async T=>{if(window.confirm("Are you sure you want to delete this quote?"))try{await ve.delete(`/api/quotes/${T}`),h("Quote deleted successfully"),p()}catch{d("Failed to delete quote")}},m=()=>{const T=t.map(O=>({"Quote #":O.quote_number,Customer:O.customer_name,Product:O.product_name,Make:O.vehicle_make||"",Model:O.vehicle_model||"","Est. Price":E4(O.estimated_cost),"Quote Date":O.quote_date?Ru(new Date(O.quote_date),"MM/dd/yyyy"):"","Valid Until":O.valid_until?Ru(new Date(O.valid_until),"MM/dd/yyyy"):"",Status:O.status})),E=Cl.unparse(T),S=new Blob([E],{type:"text/csv;charset=utf-8;"}),I=document.createElement("a"),W=URL.createObjectURL(S);I.setAttribute("href",W),I.setAttribute("download","quotes.csv"),I.style.visibility="hidden",document.body.appendChild(I),I.click(),document.body.removeChild(I)},y=n.toLowerCase(),b=x.useMemo(()=>{const T=t.filter(E=>E.status===o);return y?T.filter(E=>E.quote_number?.toLowerCase?.().includes(y)||E.customer_name?.toLowerCase?.().includes(y)||E.product_name?.toLowerCase?.().includes(y)||E.vehicle_make?.toLowerCase?.().includes(y)||E.vehicle_model?.toLowerCase?.().includes(y)):T},[t,o,y]),_=T=>{switch(T){case"Approved":return{backgroundColor:"rgba(76, 175, 80, 0.12)",color:"#2e7d32"};case"Rejected":return{backgroundColor:"rgba(244, 67, 54, 0.12)",color:"#c62828"};default:return{backgroundColor:"rgba(33, 150, 243, 0.12)",color:"#1565c0"}}},w=b.map(T=>({...T,id:T.quote_id})),A=[{field:"quote_number",headerName:"Quote #",flex:1.05,minWidth:150,valueFormatter:T=>T.value?String(T.value).replace("QO-",""):""},{field:"customer_name",headerName:"Customer",flex:1.2,minWidth:170},{field:"product_name",headerName:"Product",flex:1.1,minWidth:160},{field:"vehicle_make",headerName:"Make",flex:.9,minWidth:130},{field:"vehicle_model",headerName:"Model",flex:.9,minWidth:130},{field:"estimated_cost",headerName:"Est. Price",type:"number",flex:.8,minWidth:110,headerAlign:"left",align:"left",valueFormatter:T=>E4(T.value)},{field:"quote_date",headerName:"Quote Date",flex:.95,minWidth:130,valueFormatter:T=>T.value?Ru(new Date(T.value),"yyyy-MM-dd"):""},{field:"valid_until",headerName:"Valid Until",flex:.95,minWidth:130,valueFormatter:T=>T.value?Ru(new Date(T.value),"yyyy-MM-dd"):""},{field:"status",headerName:"Status",flex:.8,minWidth:130,sortable:!1,renderCell:T=>{const E=T.value,S=_(E);return i.jsx(st,{label:E,size:"small",sx:{fontWeight:600,...S}})}},{field:"actions",headerName:"Actions",width:120,flex:0,sortable:!1,filterable:!1,disableColumnMenu:!0,renderCell:T=>i.jsx(Z,{sx:{display:"flex",alignItems:"center"},children:i.jsx(Hn,{title:"Delete",children:i.jsx(xr,{size:"small",color:"error",onClick:E=>{E.stopPropagation();const S=T.row.quote_id;v(S)},children:i.jsx(ma,{})})})})}],P=T=>{const E=T.row;e(`/quotes/${E.quote_id}`)};return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Quotes"}),i.jsxs(dt,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:()=>e("/quotes/new"),children:"New Quote"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:m,children:"Export CSV"})]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsxs(dt,{direction:"row",spacing:3,sx:{mb:3},children:[i.jsx(Pe,{label:"Search",value:n,onChange:T=>a(T.target.value),InputProps:{startAdornment:i.jsx(sa,{position:"start",children:i.jsx(fi,{sx:{fontSize:32}})}),sx:{fontSize:22,height:56}},sx:{minWidth:340,maxWidth:400,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"medium",variant:"outlined"}),i.jsx(st,{label:"Open",onClick:()=>s("Open"),color:o==="Open"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),i.jsx(st,{label:"Approved",onClick:()=>s("Approved"),color:o==="Approved"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),i.jsx(st,{label:"Rejected",onClick:()=>s("Rejected"),color:o==="Rejected"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}})]}),i.jsx(Po,{rows:w,columns:A,paginationModel:l,onPaginationModelChange:c,pageSizeOptions:[10,25,50],getRowId:T=>T.id,onRowClick:P,disableRowSelectionOnClick:!0,hideFooterSelectedRowCount:!0,initialState:{sorting:{sortModel:[{field:"quote_number",sort:"desc"}]}},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224,224,224,1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224,224,224,1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"},cursor:"pointer"}})]})}),i.jsx(pl,{open:!!f,autoHideDuration:6e3,onClose:()=>h(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>h(null),severity:"success",sx:{width:"100%"},children:f})}),i.jsx(pl,{open:!!u,autoHideDuration:6e3,onClose:()=>d(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>d(null),severity:"error",sx:{width:"100%"},children:u})})]})};var Rf={},I4;function ule(){if(I4)return Rf;I4=1;var e=sr();Object.defineProperty(Rf,"__esModule",{value:!0}),Rf.default=void 0;var t=e(cr()),r=lr();return Rf.default=(0,t.default)((0,r.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),Rf}var dle=ule();const Is=Et(dle);var qf={},N4;function fle(){if(N4)return qf;N4=1;var e=sr();Object.defineProperty(qf,"__esModule",{value:!0}),qf.default=void 0;var t=e(cr()),r=lr();return qf.default=(0,t.default)((0,r.jsx)("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"}),"DoneAll"),qf}var hle=fle();const xv=Et(hle);var Ff={},D4;function ple(){if(D4)return Ff;D4=1;var e=sr();Object.defineProperty(Ff,"__esModule",{value:!0}),Ff.default=void 0;var t=e(cr()),r=lr();return Ff.default=(0,t.default)((0,r.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Email"),Ff}var mle=ple();const yS=Et(mle);var $f={},M4;function gle(){if(M4)return $f;M4=1;var e=sr();Object.defineProperty($f,"__esModule",{value:!0}),$f.default=void 0;var t=e(cr()),r=lr();return $f.default=(0,t.default)((0,r.jsx)("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"AddCircleOutline"),$f}var vle=gle();const ec=Et(vle);var Bf={},L4;function yle(){if(L4)return Bf;L4=1;var e=sr();Object.defineProperty(Bf,"__esModule",{value:!0}),Bf.default=void 0;var t=e(cr()),r=lr();return Bf.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12m8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8"}),"Block"),Bf}var xle=yle();const ble=Et(xle);var Uf={},R4;function _le(){if(R4)return Uf;R4=1;var e=sr();Object.defineProperty(Uf,"__esModule",{value:!0}),Uf.default=void 0;var t=e(cr()),r=lr();return Uf.default=(0,t.default)((0,r.jsx)("path",{d:"M10 10.02h5V21h-5zM17 21h3c1.1 0 2-.9 2-2v-9h-5zm3-18H5c-1.1 0-2 .9-2 2v3h19V5c0-1.1-.9-2-2-2M3 19c0 1.1.9 2 2 2h3V10H3z"}),"TableChart"),Uf}var wle=_le();const jw=Et(wle),jle="modulepreload",Sle=function(e){return"/"+e},q4={},Sw=function(t,r,n){let a=Promise.resolve();if(r&&r.length>0){let c=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),l=s?.nonce||s?.getAttribute("nonce");a=c(r.map(u=>{if(u=Sle(u),u in q4)return;q4[u]=!0;const d=u.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${f}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":jle,d||(h.as="script"),h.crossOrigin="",h.href=u,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((p,v)=>{h.addEventListener("load",p),h.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(s){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s}return a.then(s=>{for(const l of s||[])l.status==="rejected"&&o(l.reason);return t().catch(o)})};var wi=Uint8Array,So=Uint16Array,xS=Int32Array,Ny=new wi([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Dy=new wi([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Cw=new wi([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),y6=function(e,t){for(var r=new So(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var a=new xS(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)a[o]=o-r[n]<<5|n;return{b:r,r:a}},x6=y6(Ny,2),b6=x6.b,Aw=x6.r;b6[28]=258,Aw[258]=28;var _6=y6(Dy,0),Cle=_6.b,F4=_6.r,Pw=new So(32768);for(var Wn=0;Wn<32768;++Wn){var zl=(Wn&43690)>>1|(Wn&21845)<<1;zl=(zl&52428)>>2|(zl&13107)<<2,zl=(zl&61680)>>4|(zl&3855)<<4,Pw[Wn]=((zl&65280)>>8|(zl&255)<<8)>>1}var Ps=function(e,t,r){for(var n=e.length,a=0,o=new So(t);a<n;++a)e[a]&&++o[e[a]-1];var s=new So(t);for(a=1;a<t;++a)s[a]=s[a-1]+o[a-1]<<1;var l;if(r){l=new So(1<<t);var c=15-t;for(a=0;a<n;++a)if(e[a])for(var u=a<<4|e[a],d=t-e[a],f=s[e[a]-1]++<<d,h=f|(1<<d)-1;f<=h;++f)l[Pw[f]>>c]=u}else for(l=new So(n),a=0;a<n;++a)e[a]&&(l[a]=Pw[s[e[a]-1]++]>>15-e[a]);return l},rc=new wi(288);for(var Wn=0;Wn<144;++Wn)rc[Wn]=8;for(var Wn=144;Wn<256;++Wn)rc[Wn]=9;for(var Wn=256;Wn<280;++Wn)rc[Wn]=7;for(var Wn=280;Wn<288;++Wn)rc[Wn]=8;var Op=new wi(32);for(var Wn=0;Wn<32;++Wn)Op[Wn]=5;var Ale=Ps(rc,9,0),Ple=Ps(rc,9,1),Ole=Ps(Op,5,0),kle=Ps(Op,5,1),x2=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},Zo=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(t&7)&r},b2=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(t&7)},bS=function(e){return(e+7)/8|0},w6=function(e,t,r){return(r==null||r>e.length)&&(r=e.length),new wi(e.subarray(t,r))},Tle=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ts=function(e,t,r){var n=new Error(t||Tle[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,ts),!r)throw n;return n},Ele=function(e,t,r,n){var a=e.length,o=0;if(!a||t.f&&!t.l)return r||new wi(0);var s=!r,l=s||t.i!=2,c=t.i;s&&(r=new wi(a*3));var u=function(me){var Q=r.length;if(me>Q){var G=new wi(Math.max(Q*2,me));G.set(r),r=G}},d=t.f||0,f=t.p||0,h=t.b||0,p=t.l,v=t.d,m=t.m,y=t.n,b=a*8;do{if(!p){d=Zo(e,f,1);var _=Zo(e,f+1,3);if(f+=3,_)if(_==1)p=Ple,v=kle,m=9,y=5;else if(_==2){var T=Zo(e,f,31)+257,E=Zo(e,f+10,15)+4,S=T+Zo(e,f+5,31)+1;f+=14;for(var I=new wi(S),W=new wi(19),O=0;O<E;++O)W[Cw[O]]=Zo(e,f+O*3,7);f+=E*3;for(var D=x2(W),R=(1<<D)-1,F=Ps(W,D,1),O=0;O<S;){var z=F[Zo(e,f,R)];f+=z&15;var w=z>>4;if(w<16)I[O++]=w;else{var K=0,J=0;for(w==16?(J=3+Zo(e,f,3),f+=2,K=I[O-1]):w==17?(J=3+Zo(e,f,7),f+=3):w==18&&(J=11+Zo(e,f,127),f+=7);J--;)I[O++]=K}}var L=I.subarray(0,T),k=I.subarray(T);m=x2(L),y=x2(k),p=Ps(L,m,1),v=Ps(k,y,1)}else ts(1);else{var w=bS(f)+4,A=e[w-4]|e[w-3]<<8,P=w+A;if(P>a){c&&ts(0);break}l&&u(h+A),r.set(e.subarray(w,P),h),t.b=h+=A,t.p=f=P*8,t.f=d;continue}if(f>b){c&&ts(0);break}}l&&u(h+131072);for(var $=(1<<m)-1,X=(1<<y)-1,C=f;;C=f){var K=p[b2(e,f)&$],M=K>>4;if(f+=K&15,f>b){c&&ts(0);break}if(K||ts(2),M<256)r[h++]=M;else if(M==256){C=f,p=null;break}else{var H=M-254;if(M>264){var O=M-257,U=Ny[O];H=Zo(e,f,(1<<U)-1)+b6[O],f+=U}var te=v[b2(e,f)&X],le=te>>4;te||ts(3),f+=te&15;var k=Cle[le];if(le>3){var U=Dy[le];k+=b2(e,f)&(1<<U)-1,f+=U}if(f>b){c&&ts(0);break}l&&u(h+131072);var oe=h+H;if(h<k){var ae=o-k,he=Math.min(k,oe);for(ae+h<0&&ts(3);h<he;++h)r[h]=n[ae+h]}for(;h<oe;++h)r[h]=r[h-k]}}t.l=p,t.p=C,t.b=h,t.f=d,p&&(d=1,t.m=m,t.d=v,t.n=y)}while(!d);return h!=r.length&&s?w6(r,0,h):r.subarray(0,h)},Zs=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8},zf=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8,e[n+2]|=r>>16},_2=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var a=r.length,o=r.slice();if(!a)return{t:S6,l:0};if(a==1){var s=new wi(r[0].s+1);return s[r[0].s]=1,{t:s,l:1}}r.sort(function(P,T){return P.f-T.f}),r.push({s:-1,f:25001});var l=r[0],c=r[1],u=0,d=1,f=2;for(r[0]={s:-1,f:l.f+c.f,l,r:c};d!=a-1;)l=r[r[u].f<r[f].f?u++:f++],c=r[u!=d&&r[u].f<r[f].f?u++:f++],r[d++]={s:-1,f:l.f+c.f,l,r:c};for(var h=o[0].s,n=1;n<a;++n)o[n].s>h&&(h=o[n].s);var p=new So(h+1),v=Ow(r[d-1],p,0);if(v>t){var n=0,m=0,y=v-t,b=1<<y;for(o.sort(function(T,E){return p[E.s]-p[T.s]||T.f-E.f});n<a;++n){var _=o[n].s;if(p[_]>t)m+=b-(1<<v-p[_]),p[_]=t;else break}for(m>>=y;m>0;){var w=o[n].s;p[w]<t?m-=1<<t-p[w]++-1:++n}for(;n>=0&&m;--n){var A=o[n].s;p[A]==t&&(--p[A],++m)}v=t}return{t:new wi(p),l:v}},Ow=function(e,t,r){return e.s==-1?Math.max(Ow(e.l,t,r+1),Ow(e.r,t,r+1)):t[e.s]=r},$4=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new So(++t),n=0,a=e[0],o=1,s=function(c){r[n++]=c},l=1;l<=t;++l)if(e[l]==a&&l!=t)++o;else{if(!a&&o>2){for(;o>138;o-=138)s(32754);o>2&&(s(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(s(a),--o;o>6;o-=6)s(8304);o>2&&(s(o-3<<5|8208),o=0)}for(;o--;)s(a);o=1,a=e[l]}return{c:r.subarray(0,n),n:t}},Wf=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},j6=function(e,t,r){var n=r.length,a=bS(t+2);e[a]=n&255,e[a+1]=n>>8,e[a+2]=e[a]^255,e[a+3]=e[a+1]^255;for(var o=0;o<n;++o)e[a+o+4]=r[o];return(a+4+n)*8},B4=function(e,t,r,n,a,o,s,l,c,u,d){Zs(t,d++,r),++a[256];for(var f=_2(a,15),h=f.t,p=f.l,v=_2(o,15),m=v.t,y=v.l,b=$4(h),_=b.c,w=b.n,A=$4(m),P=A.c,T=A.n,E=new So(19),S=0;S<_.length;++S)++E[_[S]&31];for(var S=0;S<P.length;++S)++E[P[S]&31];for(var I=_2(E,7),W=I.t,O=I.l,D=19;D>4&&!W[Cw[D-1]];--D);var R=u+5<<3,F=Wf(a,rc)+Wf(o,Op)+s,z=Wf(a,h)+Wf(o,m)+s+14+3*D+Wf(E,W)+2*E[16]+3*E[17]+7*E[18];if(c>=0&&R<=F&&R<=z)return j6(t,d,e.subarray(c,c+u));var K,J,L,k;if(Zs(t,d,1+(z<F)),d+=2,z<F){K=Ps(h,p,0),J=h,L=Ps(m,y,0),k=m;var $=Ps(W,O,0);Zs(t,d,w-257),Zs(t,d+5,T-1),Zs(t,d+10,D-4),d+=14;for(var S=0;S<D;++S)Zs(t,d+3*S,W[Cw[S]]);d+=3*D;for(var X=[_,P],C=0;C<2;++C)for(var M=X[C],S=0;S<M.length;++S){var H=M[S]&31;Zs(t,d,$[H]),d+=W[H],H>15&&(Zs(t,d,M[S]>>5&127),d+=M[S]>>12)}}else K=Ale,J=rc,L=Ole,k=Op;for(var S=0;S<l;++S){var U=n[S];if(U>255){var H=U>>18&31;zf(t,d,K[H+257]),d+=J[H+257],H>7&&(Zs(t,d,U>>23&31),d+=Ny[H]);var te=U&31;zf(t,d,L[te]),d+=k[te],te>3&&(zf(t,d,U>>5&8191),d+=Dy[te])}else zf(t,d,K[U]),d+=J[U]}return zf(t,d,K[256]),d+J[256]},Ile=new xS([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),S6=new wi(0),Nle=function(e,t,r,n,a,o){var s=o.z||e.length,l=new wi(n+s+5*(1+Math.ceil(s/7e3))+a),c=l.subarray(n,l.length-a),u=o.l,d=(o.r||0)&7;if(t){d&&(c[0]=o.r>>3);for(var f=Ile[t-1],h=f>>13,p=f&8191,v=(1<<r)-1,m=o.p||new So(32768),y=o.h||new So(v+1),b=Math.ceil(r/3),_=2*b,w=function(ee){return(e[ee]^e[ee+1]<<b^e[ee+2]<<_)&v},A=new xS(25e3),P=new So(288),T=new So(32),E=0,S=0,I=o.i||0,W=0,O=o.w||0,D=0;I+2<s;++I){var R=w(I),F=I&32767,z=y[R];if(m[F]=z,y[R]=F,O<=I){var K=s-I;if((E>7e3||W>24576)&&(K>423||!u)){d=B4(e,c,0,A,P,T,S,W,D,I-D,d),W=E=S=0,D=I;for(var J=0;J<286;++J)P[J]=0;for(var J=0;J<30;++J)T[J]=0}var L=2,k=0,$=p,X=F-z&32767;if(K>2&&R==w(I-X))for(var C=Math.min(h,K)-1,M=Math.min(32767,I),H=Math.min(258,K);X<=M&&--$&&F!=z;){if(e[I+L]==e[I+L-X]){for(var U=0;U<H&&e[I+U]==e[I+U-X];++U);if(U>L){if(L=U,k=X,U>C)break;for(var te=Math.min(X,U-2),le=0,J=0;J<te;++J){var oe=I-X+J&32767,ae=m[oe],he=oe-ae&32767;he>le&&(le=he,z=oe)}}}F=z,z=m[F],X+=F-z&32767}if(k){A[W++]=268435456|Aw[L]<<18|F4[k];var me=Aw[L]&31,Q=F4[k]&31;S+=Ny[me]+Dy[Q],++P[257+me],++T[Q],O=I+L,++E}else A[W++]=e[I],++P[e[I]]}}for(I=Math.max(I,O);I<s;++I)A[W++]=e[I],++P[e[I]];d=B4(e,c,u,A,P,T,S,W,D,I-D,d),u||(o.r=d&7|c[d/8|0]<<3,d-=7,o.h=y,o.p=m,o.i=I,o.w=O)}else{for(var I=o.w||0;I<s+u;I+=65535){var G=I+65535;G>=s&&(c[d/8|0]=u,G=s),d=j6(c,d+1,e.subarray(I,G))}o.i=s}return w6(l,0,n+bS(d)+a)},C6=function(){var e=1,t=0;return{p:function(r){for(var n=e,a=t,o=r.length|0,s=0;s!=o;){for(var l=Math.min(s+2655,o);s<l;++s)a+=n+=r[s];n=(n&65535)+15*(n>>16),a=(a&65535)+15*(a>>16)}e=n,t=a},d:function(){return e%=65521,t%=65521,(e&255)<<24|(e&65280)<<8|(t&255)<<8|t>>8}}},Dle=function(e,t,r,n,a){if(!a&&(a={l:1},t.dictionary)){var o=t.dictionary.subarray(-32768),s=new wi(o.length+e.length);s.set(o),s.set(e,o.length),e=s,a.w=o.length}return Nle(e,t.level==null?6:t.level,t.mem==null?a.l?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):20:12+t.mem,r,n,a)},A6=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},Mle=function(e,t){var r=t.level,n=r==0?0:r<6?1:r==9?3:2;if(e[0]=120,e[1]=n<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var a=C6();a.p(t.dictionary),A6(e,2,a.d())}},Lle=function(e,t){return((e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31)&&ts(6,"invalid zlib data"),(e[1]>>5&1)==1&&ts(6,"invalid zlib data: "+(e[1]&32?"need":"unexpected")+" dictionary"),(e[1]>>3&4)+2};function kw(e,t){t||(t={});var r=C6();r.p(e);var n=Dle(e,t,t.dictionary?6:2,4);return Mle(n,t),A6(n,n.length-4,r.d()),n}function Rle(e,t){return Ele(e.subarray(Lle(e),-4),{i:2},t,t)}var qle=typeof TextDecoder<"u"&&new TextDecoder,Fle=0;try{qle.decode(S6,{stream:!0}),Fle=1}catch{}var Or=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function w2(){Or.console&&typeof Or.console.log=="function"&&Or.console.log.apply(Or.console,arguments)}var On={log:w2,warn:function(e){Or.console&&(typeof Or.console.warn=="function"?Or.console.warn.apply(Or.console,arguments):w2.call(null,arguments))},error:function(e){Or.console&&(typeof Or.console.error=="function"?Or.console.error.apply(Or.console,arguments):w2(e))}};function j2(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){Tc(n.response,t,r)},n.onerror=function(){On.error("could not download file")},n.send()}function U4(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function Dm(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var Rh,Tw,Tc=Or.saveAs||((typeof window>"u"?"undefined":gn(window))!=="object"||window!==Or?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(e,t,r){var n=Or.URL||Or.webkitURL,a=document.createElement("a");t=t||e.name||"download",a.download=t,a.rel="noopener",typeof e=="string"?(a.href=e,a.origin!==location.origin?U4(a.href)?j2(e,t,r):Dm(a,a.target="_blank"):Dm(a)):(a.href=n.createObjectURL(e),setTimeout(function(){n.revokeObjectURL(a.href)},4e4),setTimeout(function(){Dm(a)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,r){if(t=t||e.name||"download",typeof e=="string")if(U4(e))j2(e,t,r);else{var n=document.createElement("a");n.href=e,n.target="_blank",setTimeout(function(){Dm(n)})}else navigator.msSaveOrOpenBlob(function(a,o){return o===void 0?o={autoBom:!1}:gn(o)!=="object"&&(On.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}(e,r),t)}:function(e,t,r,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof e=="string")return j2(e,t,r);var a=e.type==="application/octet-stream",o=/constructor/i.test(Or.HTMLElement)||Or.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);if((s||a&&o)&&(typeof FileReader>"u"?"undefined":gn(FileReader))==="object"){var l=new FileReader;l.onloadend=function(){var d=l.result;d=s?d:d.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=d:location=d,n=null},l.readAsDataURL(e)}else{var c=Or.URL||Or.webkitURL,u=c.createObjectURL(e);n?n.location=u:location.href=u,n=null,setTimeout(function(){c.revokeObjectURL(u)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function P6(e){var t;e=e||"",this.ok=!1,e.charAt(0)=="#"&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],n=0;n<r.length;n++){var a=r[n].re,o=r[n].process,s=a.exec(e);s&&(t=o(s),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var l=this.r.toString(16),c=this.g.toString(16),u=this.b.toString(16);return l.length==1&&(l="0"+l),c.length==1&&(c="0"+c),u.length==1&&(u="0"+u),"#"+l+c+u}}/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function S2(e,t){var r=e[0],n=e[1],a=e[2],o=e[3];r=mi(r,n,a,o,t[0],7,-680876936),o=mi(o,r,n,a,t[1],12,-389564586),a=mi(a,o,r,n,t[2],17,606105819),n=mi(n,a,o,r,t[3],22,-1044525330),r=mi(r,n,a,o,t[4],7,-176418897),o=mi(o,r,n,a,t[5],12,1200080426),a=mi(a,o,r,n,t[6],17,-1473231341),n=mi(n,a,o,r,t[7],22,-45705983),r=mi(r,n,a,o,t[8],7,1770035416),o=mi(o,r,n,a,t[9],12,-1958414417),a=mi(a,o,r,n,t[10],17,-42063),n=mi(n,a,o,r,t[11],22,-1990404162),r=mi(r,n,a,o,t[12],7,1804603682),o=mi(o,r,n,a,t[13],12,-40341101),a=mi(a,o,r,n,t[14],17,-1502002290),r=gi(r,n=mi(n,a,o,r,t[15],22,1236535329),a,o,t[1],5,-165796510),o=gi(o,r,n,a,t[6],9,-1069501632),a=gi(a,o,r,n,t[11],14,643717713),n=gi(n,a,o,r,t[0],20,-373897302),r=gi(r,n,a,o,t[5],5,-701558691),o=gi(o,r,n,a,t[10],9,38016083),a=gi(a,o,r,n,t[15],14,-660478335),n=gi(n,a,o,r,t[4],20,-405537848),r=gi(r,n,a,o,t[9],5,568446438),o=gi(o,r,n,a,t[14],9,-1019803690),a=gi(a,o,r,n,t[3],14,-187363961),n=gi(n,a,o,r,t[8],20,1163531501),r=gi(r,n,a,o,t[13],5,-1444681467),o=gi(o,r,n,a,t[2],9,-51403784),a=gi(a,o,r,n,t[7],14,1735328473),r=vi(r,n=gi(n,a,o,r,t[12],20,-1926607734),a,o,t[5],4,-378558),o=vi(o,r,n,a,t[8],11,-2022574463),a=vi(a,o,r,n,t[11],16,1839030562),n=vi(n,a,o,r,t[14],23,-35309556),r=vi(r,n,a,o,t[1],4,-1530992060),o=vi(o,r,n,a,t[4],11,1272893353),a=vi(a,o,r,n,t[7],16,-155497632),n=vi(n,a,o,r,t[10],23,-1094730640),r=vi(r,n,a,o,t[13],4,681279174),o=vi(o,r,n,a,t[0],11,-358537222),a=vi(a,o,r,n,t[3],16,-722521979),n=vi(n,a,o,r,t[6],23,76029189),r=vi(r,n,a,o,t[9],4,-640364487),o=vi(o,r,n,a,t[12],11,-421815835),a=vi(a,o,r,n,t[15],16,530742520),r=yi(r,n=vi(n,a,o,r,t[2],23,-995338651),a,o,t[0],6,-198630844),o=yi(o,r,n,a,t[7],10,1126891415),a=yi(a,o,r,n,t[14],15,-1416354905),n=yi(n,a,o,r,t[5],21,-57434055),r=yi(r,n,a,o,t[12],6,1700485571),o=yi(o,r,n,a,t[3],10,-1894986606),a=yi(a,o,r,n,t[10],15,-1051523),n=yi(n,a,o,r,t[1],21,-2054922799),r=yi(r,n,a,o,t[8],6,1873313359),o=yi(o,r,n,a,t[15],10,-30611744),a=yi(a,o,r,n,t[6],15,-1560198380),n=yi(n,a,o,r,t[13],21,1309151649),r=yi(r,n,a,o,t[4],6,-145523070),o=yi(o,r,n,a,t[11],10,-1120210379),a=yi(a,o,r,n,t[2],15,718787259),n=yi(n,a,o,r,t[9],21,-343485551),e[0]=Xl(r,e[0]),e[1]=Xl(n,e[1]),e[2]=Xl(a,e[2]),e[3]=Xl(o,e[3])}function My(e,t,r,n,a,o){return t=Xl(Xl(t,e),Xl(n,o)),Xl(t<<a|t>>>32-a,r)}function mi(e,t,r,n,a,o,s){return My(t&r|~t&n,e,t,a,o,s)}function gi(e,t,r,n,a,o,s){return My(t&n|r&~n,e,t,a,o,s)}function vi(e,t,r,n,a,o,s){return My(t^r^n,e,t,a,o,s)}function yi(e,t,r,n,a,o,s){return My(r^(t|~n),e,t,a,o,s)}function O6(e){var t,r=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)S2(n,$le(e.substring(t-64,t)));e=e.substring(t-64);var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)a[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(S2(n,a),t=0;t<16;t++)a[t]=0;return a[14]=8*r,S2(n,a),n}function $le(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}Rh=Or.atob.bind(Or),Tw=Or.btoa.bind(Or);var z4="0123456789abcdef".split("");function Ble(e){for(var t="",r=0;r<4;r++)t+=z4[e>>8*r+4&15]+z4[e>>8*r&15];return t}function Ule(e){return String.fromCharCode((255&e)>>0,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function Ew(e){return O6(e).map(Ule).join("")}var zle=function(e){for(var t=0;t<e.length;t++)e[t]=Ble(e[t]);return e.join("")}(O6("hello"))!="5d41402abc4b2a76b9719d911017c592";function Xl(e,t){if(zle){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}return e+t&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function Iw(e,t){var r,n,a,o;if(e!==r){for(var s=(a=e,o=1+(256/e.length>>0),new Array(o+1).join(a)),l=[],c=0;c<256;c++)l[c]=c;var u=0;for(c=0;c<256;c++){var d=l[c];u=(u+d+s.charCodeAt(c))%256,l[c]=l[u],l[u]=d}r=e,n=l}else l=n;var f=t.length,h=0,p=0,v="";for(c=0;c<f;c++)p=(p+(d=l[h=(h+1)%256]))%256,l[h]=l[p],l[p]=d,s=l[(l[h]+l[p])%256],v+=String.fromCharCode(t.charCodeAt(c)^s);return v}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var W4={print:4,modify:8,copy:16,"annot-forms":32};function ku(e,t,r,n){this.v=1,this.r=2;var a=192;e.forEach(function(l){if(W4.perm!==void 0)throw new Error("Invalid permission: "+l);a+=W4[l]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var o=(t+this.padding).substr(0,32),s=(r+this.padding).substr(0,32);this.O=this.processOwnerPassword(o,s),this.P=-(1+(255^a)),this.encryptionKey=Ew(o+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=Iw(this.encryptionKey,this.padding)}function Tu(e){if(/[^\u0000-\u00ff]/.test(e))throw new Error("Invalid PDF Name Object: "+e+", Only accept ASCII characters.");for(var t="",r=e.length,n=0;n<r;n++){var a=e.charCodeAt(n);a<33||a===35||a===37||a===40||a===41||a===47||a===60||a===62||a===91||a===93||a===123||a===125||a>126?t+="#"+("0"+a.toString(16)).slice(-2):t+=e[n]}return t}function H4(e){if(gn(e)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(r,n,a){if(a=a||!1,typeof r!="string"||typeof n!="function"||typeof a!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(r)||(t[r]={});var o=Math.random().toString(35);return t[r][o]=[n,!!a],o},this.unsubscribe=function(r){for(var n in t)if(t[n][r])return delete t[n][r],Object.keys(t[n]).length===0&&delete t[n],!0;return!1},this.publish=function(r){if(t.hasOwnProperty(r)){var n=Array.prototype.slice.call(arguments,1),a=[];for(var o in t[r]){var s=t[r][o];try{s[0].apply(e,n)}catch(l){Or.console&&On.error("jsPDF PubSub Error",l.message,l)}s[1]&&a.push(o)}a.length&&a.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function bv(e){if(!(this instanceof bv))return new bv(e);var t="opacity,stroke-opacity".split(",");for(var r in e)e.hasOwnProperty(r)&&t.indexOf(r)>=0&&(this[r]=e[r]);this.id="",this.objectNumber=-1}function k6(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function Ic(e,t,r,n,a){if(!(this instanceof Ic))return new Ic(e,t,r,n,a);this.type=e==="axial"?2:3,this.coords=t,this.colors=r,k6.call(this,n,a)}function qu(e,t,r,n,a){if(!(this instanceof qu))return new qu(e,t,r,n,a);this.boundingBox=e,this.xStep=t,this.yStep=r,this.stream="",this.cloneIndex=0,k6.call(this,n,a)}function wr(e){var t,r=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],a=arguments[2],o=arguments[3],s=[],l=1,c=16,u="S",d=null;gn(e=e||{})==="object"&&(r=e.orientation,n=e.unit||n,a=e.format||a,o=e.compress||e.compressPdf||o,(d=e.encryption||null)!==null&&(d.userPassword=d.userPassword||"",d.ownerPassword=d.ownerPassword||"",d.userPermissions=d.userPermissions||[]),l=typeof e.userUnit=="number"?Math.abs(e.userUnit):1,e.precision!==void 0&&(t=e.precision),e.floatPrecision!==void 0&&(c=e.floatPrecision),u=e.defaultPathOperation||"S"),s=e.filters||(o===!0?["FlateEncode"]:s),n=n||"mm",r=(""+(r||"P")).toLowerCase();var f=e.putOnlyUsedFonts||!1,h={},p={internal:{},__private__:{}};p.__private__.PubSub=H4;var v="1.3",m=p.__private__.getPdfVersion=function(){return v};p.__private__.setPdfVersion=function(N){v=N};var y={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};p.__private__.getPageFormats=function(){return y};var b=p.__private__.getPageFormat=function(N){return y[N]};a=a||"a4";var _={COMPAT:"compat",ADVANCED:"advanced"},w=_.COMPAT;function A(){this.saveGraphicsState(),V(new er(jt,0,0,-jt,0,si()*jt).toString()+" cm"),this.setFontSize(this.getFontSize()/jt),u="n",w=_.ADVANCED}function P(){this.restoreGraphicsState(),u="S",w=_.COMPAT}var T=p.__private__.combineFontStyleAndFontWeight=function(N,ne){if(N=="bold"&&ne=="normal"||N=="bold"&&ne==400||N=="normal"&&ne=="italic"||N=="bold"&&ne=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return ne&&(N=ne==400||ne==="normal"?N==="italic"?"italic":"normal":ne!=700&&ne!=="bold"||N!=="normal"?(ne==700?"bold":ne)+""+N:"bold"),N};p.advancedAPI=function(N){var ne=w===_.COMPAT;return ne&&A.call(this),typeof N!="function"||(N(this),ne&&P.call(this)),this},p.compatAPI=function(N){var ne=w===_.ADVANCED;return ne&&P.call(this),typeof N!="function"||(N(this),ne&&A.call(this)),this},p.isAdvancedAPI=function(){return w===_.ADVANCED};var E,S=function(N){if(w!==_.ADVANCED)throw new Error(N+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},I=p.roundToPrecision=p.__private__.roundToPrecision=function(N,ne){var Se=t||ne;if(isNaN(N)||isNaN(Se))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return N.toFixed(Se).replace(/0+$/,"")};E=p.hpf=p.__private__.hpf=typeof c=="number"?function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.hpf");return I(N,c)}:c==="smart"?function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.hpf");return I(N,N>-1&&N<1?16:5)}:function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.hpf");return I(N,16)};var W=p.f2=p.__private__.f2=function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.f2");return I(N,2)},O=p.__private__.f3=function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.f3");return I(N,3)},D=p.scale=p.__private__.scale=function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.scale");return w===_.COMPAT?N*jt:w===_.ADVANCED?N:void 0},R=function(N){return w===_.COMPAT?si()-N:w===_.ADVANCED?N:void 0},F=function(N){return D(R(N))};p.__private__.setPrecision=p.setPrecision=function(N){typeof parseInt(N,10)=="number"&&(t=parseInt(N,10))};var z,K="00000000000000000000000000000000",J=p.__private__.getFileId=function(){return K},L=p.__private__.setFileId=function(N){return K=N!==void 0&&/^[a-fA-F0-9]{32}$/.test(N)?N.toUpperCase():K.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),d!==null&&(Bn=new ku(d.userPermissions,d.userPassword,d.ownerPassword,K)),K};p.setFileId=function(N){return L(N),this},p.getFileId=function(){return J()};var k=p.__private__.convertDateToPDFDate=function(N){var ne=N.getTimezoneOffset(),Se=ne<0?"+":"-",Ie=Math.floor(Math.abs(ne/60)),Ke=Math.abs(ne%60),ft=[Se,H(Ie),"'",H(Ke),"'"].join("");return["D:",N.getFullYear(),H(N.getMonth()+1),H(N.getDate()),H(N.getHours()),H(N.getMinutes()),H(N.getSeconds()),ft].join("")},$=p.__private__.convertPDFDateToDate=function(N){var ne=parseInt(N.substr(2,4),10),Se=parseInt(N.substr(6,2),10)-1,Ie=parseInt(N.substr(8,2),10),Ke=parseInt(N.substr(10,2),10),ft=parseInt(N.substr(12,2),10),At=parseInt(N.substr(14,2),10);return new Date(ne,Se,Ie,Ke,ft,At,0)},X=p.__private__.setCreationDate=function(N){var ne;if(N===void 0&&(N=new Date),N instanceof Date)ne=k(N);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(N))throw new Error("Invalid argument passed to jsPDF.setCreationDate");ne=N}return z=ne},C=p.__private__.getCreationDate=function(N){var ne=z;return N==="jsDate"&&(ne=$(z)),ne};p.setCreationDate=function(N){return X(N),this},p.getCreationDate=function(N){return C(N)};var M,H=p.__private__.padd2=function(N){return("0"+parseInt(N)).slice(-2)},U=p.__private__.padd2Hex=function(N){return("00"+(N=N.toString())).substr(N.length)},te=0,le=[],oe=[],ae=0,he=[],me=[],Q=!1,G=oe,ee=function(){te=0,ae=0,oe=[],le=[],he=[],ot=Kr(),Oe=Kr()};p.__private__.setCustomOutputDestination=function(N){Q=!0,G=N};var se=function(N){Q||(G=N)};p.__private__.resetCustomOutputDestination=function(){Q=!1,G=oe};var V=p.__private__.out=function(N){return N=N.toString(),ae+=N.length+1,G.push(N),G},Ge=p.__private__.write=function(N){return V(arguments.length===1?N.toString():Array.prototype.join.call(arguments," "))},De=p.__private__.getArrayBuffer=function(N){for(var ne=N.length,Se=new ArrayBuffer(ne),Ie=new Uint8Array(Se);ne--;)Ie[ne]=N.charCodeAt(ne);return Se},Fe=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];p.__private__.getStandardFonts=function(){return Fe};var Xe=e.fontSize||16;p.__private__.setFontSize=p.setFontSize=function(N){return Xe=w===_.ADVANCED?N/jt:N,this};var it,lt=p.__private__.getFontSize=p.getFontSize=function(){return w===_.COMPAT?Xe:Xe*jt},vt=e.R2L||!1;p.__private__.setR2L=p.setR2L=function(N){return vt=N,this},p.__private__.getR2L=p.getR2L=function(){return vt};var Ye,Ze=p.__private__.setZoomMode=function(N){var ne=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(N))it=N;else if(isNaN(N)){if(ne.indexOf(N)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+N+'" is not recognized.');it=N}else it=parseInt(N,10)};p.__private__.getZoomMode=function(){return it};var We,wt=p.__private__.setPageMode=function(N){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(N)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+N+'" is not recognized.');Ye=N};p.__private__.getPageMode=function(){return Ye};var Nt=p.__private__.setLayoutMode=function(N){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(N)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+N+'" is not recognized.');We=N};p.__private__.getLayoutMode=function(){return We},p.__private__.setDisplayMode=p.setDisplayMode=function(N,ne,Se){return Ze(N),Nt(ne),wt(Se),this};var kt={title:"",subject:"",author:"",keywords:"",creator:""};p.__private__.getDocumentProperty=function(N){if(Object.keys(kt).indexOf(N)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return kt[N]},p.__private__.getDocumentProperties=function(){return kt},p.__private__.setDocumentProperties=p.setProperties=p.setDocumentProperties=function(N){for(var ne in kt)kt.hasOwnProperty(ne)&&N[ne]&&(kt[ne]=N[ne]);return this},p.__private__.setDocumentProperty=function(N,ne){if(Object.keys(kt).indexOf(N)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return kt[N]=ne};var Wt,jt,ur,$e,He,Je={},Ue={},pt=[],at={},St={},It={},Yt={},Sr=null,Mr=0,nr=[],Cr=new H4(p),Dr=e.hotfixes||[],fn={},Oa={},En=[],er=function N(ne,Se,Ie,Ke,ft,At){if(!(this instanceof N))return new N(ne,Se,Ie,Ke,ft,At);isNaN(ne)&&(ne=1),isNaN(Se)&&(Se=0),isNaN(Ie)&&(Ie=0),isNaN(Ke)&&(Ke=1),isNaN(ft)&&(ft=0),isNaN(At)&&(At=0),this._matrix=[ne,Se,Ie,Ke,ft,At]};Object.defineProperty(er.prototype,"sx",{get:function(){return this._matrix[0]},set:function(N){this._matrix[0]=N}}),Object.defineProperty(er.prototype,"shy",{get:function(){return this._matrix[1]},set:function(N){this._matrix[1]=N}}),Object.defineProperty(er.prototype,"shx",{get:function(){return this._matrix[2]},set:function(N){this._matrix[2]=N}}),Object.defineProperty(er.prototype,"sy",{get:function(){return this._matrix[3]},set:function(N){this._matrix[3]=N}}),Object.defineProperty(er.prototype,"tx",{get:function(){return this._matrix[4]},set:function(N){this._matrix[4]=N}}),Object.defineProperty(er.prototype,"ty",{get:function(){return this._matrix[5]},set:function(N){this._matrix[5]=N}}),Object.defineProperty(er.prototype,"a",{get:function(){return this._matrix[0]},set:function(N){this._matrix[0]=N}}),Object.defineProperty(er.prototype,"b",{get:function(){return this._matrix[1]},set:function(N){this._matrix[1]=N}}),Object.defineProperty(er.prototype,"c",{get:function(){return this._matrix[2]},set:function(N){this._matrix[2]=N}}),Object.defineProperty(er.prototype,"d",{get:function(){return this._matrix[3]},set:function(N){this._matrix[3]=N}}),Object.defineProperty(er.prototype,"e",{get:function(){return this._matrix[4]},set:function(N){this._matrix[4]=N}}),Object.defineProperty(er.prototype,"f",{get:function(){return this._matrix[5]},set:function(N){this._matrix[5]=N}}),Object.defineProperty(er.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(er.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(er.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(er.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),er.prototype.join=function(N){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(E).join(N)},er.prototype.multiply=function(N){var ne=N.sx*this.sx+N.shy*this.shx,Se=N.sx*this.shy+N.shy*this.sy,Ie=N.shx*this.sx+N.sy*this.shx,Ke=N.shx*this.shy+N.sy*this.sy,ft=N.tx*this.sx+N.ty*this.shx+this.tx,At=N.tx*this.shy+N.ty*this.sy+this.ty;return new er(ne,Se,Ie,Ke,ft,At)},er.prototype.decompose=function(){var N=this.sx,ne=this.shy,Se=this.shx,Ie=this.sy,Ke=this.tx,ft=this.ty,At=Math.sqrt(N*N+ne*ne),zt=(N/=At)*Se+(ne/=At)*Ie;Se-=N*zt,Ie-=ne*zt;var ir=Math.sqrt(Se*Se+Ie*Ie);return zt/=ir,N*(Ie/=ir)<ne*(Se/=ir)&&(N=-N,ne=-ne,zt=-zt,At=-At),{scale:new er(At,0,0,ir,0,0),translate:new er(1,0,0,1,Ke,ft),rotate:new er(N,ne,-ne,N,0,0),skew:new er(1,0,zt,1,0,0)}},er.prototype.toString=function(N){return this.join(" ")},er.prototype.inversed=function(){var N=this.sx,ne=this.shy,Se=this.shx,Ie=this.sy,Ke=this.tx,ft=this.ty,At=1/(N*Ie-ne*Se),zt=Ie*At,ir=-ne*At,Ir=-Se*At,Pr=N*At;return new er(zt,ir,Ir,Pr,-zt*Ke-Ir*ft,-ir*Ke-Pr*ft)},er.prototype.applyToPoint=function(N){var ne=N.x*this.sx+N.y*this.shx+this.tx,Se=N.x*this.shy+N.y*this.sy+this.ty;return new Fa(ne,Se)},er.prototype.applyToRectangle=function(N){var ne=this.applyToPoint(N),Se=this.applyToPoint(new Fa(N.x+N.w,N.y+N.h));return new Ui(ne.x,ne.y,Se.x-ne.x,Se.y-ne.y)},er.prototype.clone=function(){var N=this.sx,ne=this.shy,Se=this.shx,Ie=this.sy,Ke=this.tx,ft=this.ty;return new er(N,ne,Se,Ie,Ke,ft)},p.Matrix=er;var Jr=p.matrixMult=function(N,ne){return ne.multiply(N)},Vn=new er(1,0,0,1,0,0);p.unitMatrix=p.identityMatrix=Vn;var In=function(N,ne){if(!St[N]){var Se=(ne instanceof Ic?"Sh":"P")+(Object.keys(at).length+1).toString(10);ne.id=Se,St[N]=Se,at[Se]=ne,Cr.publish("addPattern",ne)}};p.ShadingPattern=Ic,p.TilingPattern=qu,p.addShadingPattern=function(N,ne){return S("addShadingPattern()"),In(N,ne),this},p.beginTilingPattern=function(N){S("beginTilingPattern()"),Io(N.boundingBox[0],N.boundingBox[1],N.boundingBox[2]-N.boundingBox[0],N.boundingBox[3]-N.boundingBox[1],N.matrix)},p.endTilingPattern=function(N,ne){S("endTilingPattern()"),ne.stream=me[M].join(`
`),In(N,ne),Cr.publish("endTilingPattern",ne),En.pop().restore()};var Yr=p.__private__.newObject=function(){var N=Kr();return je(N,!0),N},Kr=p.__private__.newObjectDeferred=function(){return te++,le[te]=function(){return ae},te},je=function(N,ne){return ne=typeof ne=="boolean"&&ne,le[N]=ae,ne&&V(N+" 0 obj"),N},Ve=p.__private__.newAdditionalObject=function(){var N={objId:Kr(),content:""};return he.push(N),N},ot=Kr(),Oe=Kr(),qe=p.__private__.decodeColorString=function(N){var ne=N.split(" ");if(ne.length!==2||ne[1]!=="g"&&ne[1]!=="G")ne.length===5&&(ne[4]==="k"||ne[4]==="K")&&(ne=[(1-ne[0])*(1-ne[3]),(1-ne[1])*(1-ne[3]),(1-ne[2])*(1-ne[3]),"r"]);else{var Se=parseFloat(ne[0]);ne=[Se,Se,Se,"r"]}for(var Ie="#",Ke=0;Ke<3;Ke++)Ie+=("0"+Math.floor(255*parseFloat(ne[Ke])).toString(16)).slice(-2);return Ie},rt=p.__private__.encodeColorString=function(N){var ne;typeof N=="string"&&(N={ch1:N});var Se=N.ch1,Ie=N.ch2,Ke=N.ch3,ft=N.ch4,At=N.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Se=="string"&&Se.charAt(0)!=="#"){var zt=new P6(Se);if(zt.ok)Se=zt.toHex();else if(!/^\d*\.?\d*$/.test(Se))throw new Error('Invalid color "'+Se+'" passed to jsPDF.encodeColorString.')}if(typeof Se=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Se)&&(Se="#"+Se[1]+Se[1]+Se[2]+Se[2]+Se[3]+Se[3]),typeof Se=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Se)){var ir=parseInt(Se.substr(1),16);Se=ir>>16&255,Ie=ir>>8&255,Ke=255&ir}if(Ie===void 0||ft===void 0&&Se===Ie&&Ie===Ke)if(typeof Se=="string")ne=Se+" "+At[0];else switch(N.precision){case 2:ne=W(Se/255)+" "+At[0];break;case 3:default:ne=O(Se/255)+" "+At[0]}else if(ft===void 0||gn(ft)==="object"){if(ft&&!isNaN(ft.a)&&ft.a===0)return ne=["1.","1.","1.",At[1]].join(" ");if(typeof Se=="string")ne=[Se,Ie,Ke,At[1]].join(" ");else switch(N.precision){case 2:ne=[W(Se/255),W(Ie/255),W(Ke/255),At[1]].join(" ");break;default:case 3:ne=[O(Se/255),O(Ie/255),O(Ke/255),At[1]].join(" ")}}else if(typeof Se=="string")ne=[Se,Ie,Ke,ft,At[2]].join(" ");else switch(N.precision){case 2:ne=[W(Se),W(Ie),W(Ke),W(ft),At[2]].join(" ");break;case 3:default:ne=[O(Se),O(Ie),O(Ke),O(ft),At[2]].join(" ")}return ne},Pt=p.__private__.getFilters=function(){return s},Kt=p.__private__.putStream=function(N){var ne=(N=N||{}).data||"",Se=N.filters||Pt(),Ie=N.alreadyAppliedFilters||[],Ke=N.addLength1||!1,ft=ne.length,At=N.objectId,zt=function($a){return $a};if(d!==null&&At===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");d!==null&&(zt=Bn.encryptor(At,0));var ir={};Se===!0&&(Se=["FlateEncode"]);var Ir=N.additionalKeyValues||[],Pr=(ir=wr.API.processDataByFilters!==void 0?wr.API.processDataByFilters(ne,Se):{data:ne,reverseChain:[]}).reverseChain+(Array.isArray(Ie)?Ie.join(" "):Ie.toString());if(ir.data.length!==0&&(Ir.push({key:"Length",value:ir.data.length}),Ke===!0&&Ir.push({key:"Length1",value:ft})),Pr.length!=0)if(Pr.split("/").length-1==1)Ir.push({key:"Filter",value:Pr});else{Ir.push({key:"Filter",value:"["+Pr+"]"});for(var Qr=0;Qr<Ir.length;Qr+=1)if(Ir[Qr].key==="DecodeParms"){for(var Nn=[],Un=0;Un<ir.reverseChain.split("/").length-1;Un+=1)Nn.push("null");Nn.push(Ir[Qr].value),Ir[Qr].value="["+Nn.join(" ")+"]"}}V("<<");for(var ia=0;ia<Ir.length;ia++)V("/"+Ir[ia].key+" "+Ir[ia].value);V(">>"),ir.data.length!==0&&(V("stream"),V(zt(ir.data)),V("endstream"))},ar=p.__private__.putPage=function(N){var ne=N.number,Se=N.data,Ie=N.objId,Ke=N.contentsObjId;je(Ie,!0),V("<</Type /Page"),V("/Parent "+N.rootDictionaryObjId+" 0 R"),V("/Resources "+N.resourceDictionaryObjId+" 0 R"),V("/MediaBox ["+parseFloat(E(N.mediaBox.bottomLeftX))+" "+parseFloat(E(N.mediaBox.bottomLeftY))+" "+E(N.mediaBox.topRightX)+" "+E(N.mediaBox.topRightY)+"]"),N.cropBox!==null&&V("/CropBox ["+E(N.cropBox.bottomLeftX)+" "+E(N.cropBox.bottomLeftY)+" "+E(N.cropBox.topRightX)+" "+E(N.cropBox.topRightY)+"]"),N.bleedBox!==null&&V("/BleedBox ["+E(N.bleedBox.bottomLeftX)+" "+E(N.bleedBox.bottomLeftY)+" "+E(N.bleedBox.topRightX)+" "+E(N.bleedBox.topRightY)+"]"),N.trimBox!==null&&V("/TrimBox ["+E(N.trimBox.bottomLeftX)+" "+E(N.trimBox.bottomLeftY)+" "+E(N.trimBox.topRightX)+" "+E(N.trimBox.topRightY)+"]"),N.artBox!==null&&V("/ArtBox ["+E(N.artBox.bottomLeftX)+" "+E(N.artBox.bottomLeftY)+" "+E(N.artBox.topRightX)+" "+E(N.artBox.topRightY)+"]"),typeof N.userUnit=="number"&&N.userUnit!==1&&V("/UserUnit "+N.userUnit),Cr.publish("putPage",{objId:Ie,pageContext:nr[ne],pageNumber:ne,page:Se}),V("/Contents "+Ke+" 0 R"),V(">>"),V("endobj");var ft=Se.join(`
`);return w===_.ADVANCED&&(ft+=`
Q`),je(Ke,!0),Kt({data:ft,filters:Pt(),objectId:Ke}),V("endobj"),Ie},kr=p.__private__.putPages=function(){var N,ne,Se=[];for(N=1;N<=Mr;N++)nr[N].objId=Kr(),nr[N].contentsObjId=Kr();for(N=1;N<=Mr;N++)Se.push(ar({number:N,data:me[N],objId:nr[N].objId,contentsObjId:nr[N].contentsObjId,mediaBox:nr[N].mediaBox,cropBox:nr[N].cropBox,bleedBox:nr[N].bleedBox,trimBox:nr[N].trimBox,artBox:nr[N].artBox,userUnit:nr[N].userUnit,rootDictionaryObjId:ot,resourceDictionaryObjId:Oe}));je(ot,!0),V("<</Type /Pages");var Ie="/Kids [";for(ne=0;ne<Mr;ne++)Ie+=Se[ne]+" 0 R ";V(Ie+"]"),V("/Count "+Mr),V(">>"),V("endobj"),Cr.publish("postPutPages")},rn=function(N){Cr.publish("putFont",{font:N,out:V,newObject:Yr,putStream:Kt}),N.isAlreadyPutted!==!0&&(N.objectNumber=Yr(),V("<<"),V("/Type /Font"),V("/BaseFont /"+Tu(N.postScriptName)),V("/Subtype /Type1"),typeof N.encoding=="string"&&V("/Encoding /"+N.encoding),V("/FirstChar 32"),V("/LastChar 255"),V(">>"),V("endobj"))},Vr=function(){for(var N in Je)Je.hasOwnProperty(N)&&(f===!1||f===!0&&h.hasOwnProperty(N))&&rn(Je[N])},$n=function(N){N.objectNumber=Yr();var ne=[];ne.push({key:"Type",value:"/XObject"}),ne.push({key:"Subtype",value:"/Form"}),ne.push({key:"BBox",value:"["+[E(N.x),E(N.y),E(N.x+N.width),E(N.y+N.height)].join(" ")+"]"}),ne.push({key:"Matrix",value:"["+N.matrix.toString()+"]"});var Se=N.pages[1].join(`
`);Kt({data:Se,additionalKeyValues:ne,objectId:N.objectNumber}),V("endobj")},ka=function(){for(var N in fn)fn.hasOwnProperty(N)&&$n(fn[N])},Ya=function(N,ne){var Se,Ie=[],Ke=1/(ne-1);for(Se=0;Se<1;Se+=Ke)Ie.push(Se);if(Ie.push(1),N[0].offset!=0){var ft={offset:0,color:N[0].color};N.unshift(ft)}if(N[N.length-1].offset!=1){var At={offset:1,color:N[N.length-1].color};N.push(At)}for(var zt="",ir=0,Ir=0;Ir<Ie.length;Ir++){for(Se=Ie[Ir];Se>N[ir+1].offset;)ir++;var Pr=N[ir].offset,Qr=(Se-Pr)/(N[ir+1].offset-Pr),Nn=N[ir].color,Un=N[ir+1].color;zt+=U(Math.round((1-Qr)*Nn[0]+Qr*Un[0]).toString(16))+U(Math.round((1-Qr)*Nn[1]+Qr*Un[1]).toString(16))+U(Math.round((1-Qr)*Nn[2]+Qr*Un[2]).toString(16))}return zt.trim()},to=function(N,ne){ne||(ne=21);var Se=Yr(),Ie=Ya(N.colors,ne),Ke=[];Ke.push({key:"FunctionType",value:"0"}),Ke.push({key:"Domain",value:"[0.0 1.0]"}),Ke.push({key:"Size",value:"["+ne+"]"}),Ke.push({key:"BitsPerSample",value:"8"}),Ke.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Ke.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Kt({data:Ie,additionalKeyValues:Ke,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Se}),V("endobj"),N.objectNumber=Yr(),V("<< /ShadingType "+N.type),V("/ColorSpace /DeviceRGB");var ft="/Coords ["+E(parseFloat(N.coords[0]))+" "+E(parseFloat(N.coords[1]))+" ";N.type===2?ft+=E(parseFloat(N.coords[2]))+" "+E(parseFloat(N.coords[3])):ft+=E(parseFloat(N.coords[2]))+" "+E(parseFloat(N.coords[3]))+" "+E(parseFloat(N.coords[4]))+" "+E(parseFloat(N.coords[5])),V(ft+="]"),N.matrix&&V("/Matrix ["+N.matrix.toString()+"]"),V("/Function "+Se+" 0 R"),V("/Extend [true true]"),V(">>"),V("endobj")},qi=function(N,ne){var Se=Kr(),Ie=Yr();ne.push({resourcesOid:Se,objectOid:Ie}),N.objectNumber=Ie;var Ke=[];Ke.push({key:"Type",value:"/Pattern"}),Ke.push({key:"PatternType",value:"1"}),Ke.push({key:"PaintType",value:"1"}),Ke.push({key:"TilingType",value:"1"}),Ke.push({key:"BBox",value:"["+N.boundingBox.map(E).join(" ")+"]"}),Ke.push({key:"XStep",value:E(N.xStep)}),Ke.push({key:"YStep",value:E(N.yStep)}),Ke.push({key:"Resources",value:Se+" 0 R"}),N.matrix&&Ke.push({key:"Matrix",value:"["+N.matrix.toString()+"]"}),Kt({data:N.stream,additionalKeyValues:Ke,objectId:N.objectNumber}),V("endobj")},Gn=function(N){var ne;for(ne in at)at.hasOwnProperty(ne)&&(at[ne]instanceof Ic?to(at[ne]):at[ne]instanceof qu&&qi(at[ne],N))},hi=function(N){for(var ne in N.objectNumber=Yr(),V("<<"),N)switch(ne){case"opacity":V("/ca "+W(N[ne]));break;case"stroke-opacity":V("/CA "+W(N[ne]))}V(">>"),V("endobj")},ro=function(){var N;for(N in It)It.hasOwnProperty(N)&&hi(It[N])},Qe=function(){for(var N in V("/XObject <<"),fn)fn.hasOwnProperty(N)&&fn[N].objectNumber>=0&&V("/"+N+" "+fn[N].objectNumber+" 0 R");Cr.publish("putXobjectDict"),V(">>")},Vt=function(){Bn.oid=Yr(),V("<<"),V("/Filter /Standard"),V("/V "+Bn.v),V("/R "+Bn.r),V("/U <"+Bn.toHexString(Bn.U)+">"),V("/O <"+Bn.toHexString(Bn.O)+">"),V("/P "+Bn.P),V(">>"),V("endobj")},or=function(){for(var N in V("/Font <<"),Je)Je.hasOwnProperty(N)&&(f===!1||f===!0&&h.hasOwnProperty(N))&&V("/"+N+" "+Je[N].objectNumber+" 0 R");V(">>")},Fr=function(){if(Object.keys(at).length>0){for(var N in V("/Shading <<"),at)at.hasOwnProperty(N)&&at[N]instanceof Ic&&at[N].objectNumber>=0&&V("/"+N+" "+at[N].objectNumber+" 0 R");Cr.publish("putShadingPatternDict"),V(">>")}},Er=function(N){if(Object.keys(at).length>0){for(var ne in V("/Pattern <<"),at)at.hasOwnProperty(ne)&&at[ne]instanceof p.TilingPattern&&at[ne].objectNumber>=0&&at[ne].objectNumber<N&&V("/"+ne+" "+at[ne].objectNumber+" 0 R");Cr.publish("putTilingPatternDict"),V(">>")}},jn=function(){if(Object.keys(It).length>0){var N;for(N in V("/ExtGState <<"),It)It.hasOwnProperty(N)&&It[N].objectNumber>=0&&V("/"+N+" "+It[N].objectNumber+" 0 R");Cr.publish("putGStateDict"),V(">>")}},Lr=function(N){je(N.resourcesOid,!0),V("<<"),V("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),or(),Fr(),Er(N.objectOid),jn(),Qe(),V(">>"),V("endobj")},ra=function(){var N=[];Vr(),ro(),ka(),Gn(N),Cr.publish("putResources"),N.forEach(Lr),Lr({resourcesOid:Oe,objectOid:Number.MAX_SAFE_INTEGER}),Cr.publish("postPutResources")},bn=function(){Cr.publish("putAdditionalObjects");for(var N=0;N<he.length;N++){var ne=he[N];je(ne.objId,!0),V(ne.content),V("endobj")}Cr.publish("postPutAdditionalObjects")},Ta=function(N){Ue[N.fontName]=Ue[N.fontName]||{},Ue[N.fontName][N.fontStyle]=N.id},Ea=function(N,ne,Se,Ie,Ke){var ft={id:"F"+(Object.keys(Je).length+1).toString(10),postScriptName:N,fontName:ne,fontStyle:Se,encoding:Ie,isStandardFont:Ke||!1,metadata:{}};return Cr.publish("addFont",{font:ft,instance:this}),Je[ft.id]=ft,Ta(ft),ft.id},ni=function(N){for(var ne=0,Se=Fe.length;ne<Se;ne++){var Ie=Ea.call(this,N[ne][0],N[ne][1],N[ne][2],Fe[ne][3],!0);f===!1&&(h[Ie]=!0);var Ke=N[ne][0].split("-");Ta({id:Ie,fontName:Ke[0],fontStyle:Ke[1]||""})}Cr.publish("addFonts",{fonts:Je,dictionary:Ue})},na=function(N){return N.foo=function(){try{return N.apply(this,arguments)}catch(Ie){var ne=Ie.stack||"";~ne.indexOf(" at ")&&(ne=ne.split(" at ")[1]);var Se="Error in function "+ne.split(`
`)[0].split("<")[0]+": "+Ie.message;if(!Or.console)throw new Error(Se);Or.console.error(Se,Ie),Or.alert&&alert(Se)}},N.foo.bar=N,N.foo},An=function(N,ne){var Se,Ie,Ke,ft,At,zt,ir,Ir,Pr;if(Ke=(ne=ne||{}).sourceEncoding||"Unicode",At=ne.outputEncoding,(ne.autoencode||At)&&Je[Wt].metadata&&Je[Wt].metadata[Ke]&&Je[Wt].metadata[Ke].encoding&&(ft=Je[Wt].metadata[Ke].encoding,!At&&Je[Wt].encoding&&(At=Je[Wt].encoding),!At&&ft.codePages&&(At=ft.codePages[0]),typeof At=="string"&&(At=ft[At]),At)){for(ir=!1,zt=[],Se=0,Ie=N.length;Se<Ie;Se++)(Ir=At[N.charCodeAt(Se)])?zt.push(String.fromCharCode(Ir)):zt.push(N[Se]),zt[Se].charCodeAt(0)>>8&&(ir=!0);N=zt.join("")}for(Se=N.length;ir===void 0&&Se!==0;)N.charCodeAt(Se-1)>>8&&(ir=!0),Se--;if(!ir)return N;for(zt=ne.noBOM?[]:[254,255],Se=0,Ie=N.length;Se<Ie;Se++){if((Pr=(Ir=N.charCodeAt(Se))>>8)>>8)throw new Error("Character at position "+Se+" of string '"+N+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");zt.push(Pr),zt.push(Ir-(Pr<<8))}return String.fromCharCode.apply(void 0,zt)},Hr=p.__private__.pdfEscape=p.pdfEscape=function(N,ne){return An(N,ne).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},no=p.__private__.beginPage=function(N){me[++Mr]=[],nr[Mr]={objId:0,contentsObjId:0,userUnit:Number(l),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(N[0]),topRightY:Number(N[1])}},ji(Mr),se(me[M])},ao=function(N,ne){var Se,Ie,Ke;switch(r=ne||r,typeof N=="string"&&(Se=b(N.toLowerCase()),Array.isArray(Se)&&(Ie=Se[0],Ke=Se[1])),Array.isArray(N)&&(Ie=N[0]*jt,Ke=N[1]*jt),isNaN(Ie)&&(Ie=a[0],Ke=a[1]),(Ie>14400||Ke>14400)&&(On.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Ie=Math.min(14400,Ie),Ke=Math.min(14400,Ke)),a=[Ie,Ke],r.substr(0,1)){case"l":Ke>Ie&&(a=[Ke,Ie]);break;case"p":Ie>Ke&&(a=[Ke,Ie])}no(a),Us(Bs),V(Lt),Pi!==0&&V(Pi+" J"),oi!==0&&V(oi+" j"),Cr.publish("addPage",{pageNumber:Mr})},io=function(N){N>0&&N<=Mr&&(me.splice(N,1),nr.splice(N,1),Mr--,M>Mr&&(M=Mr),this.setPage(M))},ji=function(N){N>0&&N<=Mr&&(M=N)},oo=p.__private__.getNumberOfPages=p.getNumberOfPages=function(){return me.length-1},pi=function(N,ne,Se){var Ie,Ke=void 0;return Se=Se||{},N=N!==void 0?N:Je[Wt].fontName,ne=ne!==void 0?ne:Je[Wt].fontStyle,Ie=N.toLowerCase(),Ue[Ie]!==void 0&&Ue[Ie][ne]!==void 0?Ke=Ue[Ie][ne]:Ue[N]!==void 0&&Ue[N][ne]!==void 0?Ke=Ue[N][ne]:Se.disableWarning===!1&&On.warn("Unable to look up font label for font '"+N+"', '"+ne+"'. Refer to getFontList() for available fonts."),Ke||Se.noFallback||(Ke=Ue.times[ne])==null&&(Ke=Ue.times.normal),Ke},Oo=p.__private__.putInfo=function(){var N=Yr(),ne=function(Ie){return Ie};for(var Se in d!==null&&(ne=Bn.encryptor(N,0)),V("<<"),V("/Producer ("+Hr(ne("jsPDF "+wr.version))+")"),kt)kt.hasOwnProperty(Se)&&kt[Se]&&V("/"+Se.substr(0,1).toUpperCase()+Se.substr(1)+" ("+Hr(ne(kt[Se]))+")");V("/CreationDate ("+Hr(ne(z))+")"),V(">>"),V("endobj")},Fi=p.__private__.putCatalog=function(N){var ne=(N=N||{}).rootDictionaryObjId||ot;switch(Yr(),V("<<"),V("/Type /Catalog"),V("/Pages "+ne+" 0 R"),it||(it="fullwidth"),it){case"fullwidth":V("/OpenAction [3 0 R /FitH null]");break;case"fullheight":V("/OpenAction [3 0 R /FitV null]");break;case"fullpage":V("/OpenAction [3 0 R /Fit]");break;case"original":V("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Se=""+it;Se.substr(Se.length-1)==="%"&&(it=parseInt(it)/100),typeof it=="number"&&V("/OpenAction [3 0 R /XYZ null null "+W(it)+"]")}switch(We||(We="continuous"),We){case"continuous":V("/PageLayout /OneColumn");break;case"single":V("/PageLayout /SinglePage");break;case"two":case"twoleft":V("/PageLayout /TwoColumnLeft");break;case"tworight":V("/PageLayout /TwoColumnRight")}Ye&&V("/PageMode /"+Ye),Cr.publish("putCatalog"),V(">>"),V("endobj")},fs=p.__private__.putTrailer=function(){V("trailer"),V("<<"),V("/Size "+(te+1)),V("/Root "+te+" 0 R"),V("/Info "+(te-1)+" 0 R"),d!==null&&V("/Encrypt "+Bn.oid+" 0 R"),V("/ID [ <"+K+"> <"+K+"> ]"),V(">>")},so=p.__private__.putHeader=function(){V("%PDF-"+v),V("%")},hs=p.__private__.putXRef=function(){var N="0000000000";V("xref"),V("0 "+(te+1)),V("0000000000 65535 f ");for(var ne=1;ne<=te;ne++)typeof le[ne]=="function"?V((N+le[ne]()).slice(-10)+" 00000 n "):le[ne]!==void 0?V((N+le[ne]).slice(-10)+" 00000 n "):V("0000000000 00000 n ")},Ka=p.__private__.buildDocument=function(){ee(),se(oe),Cr.publish("buildDocument"),so(),kr(),bn(),ra(),d!==null&&Vt(),Oo(),Fi();var N=ae;return hs(),fs(),V("startxref"),V(""+N),V("%%EOF"),se(me[M]),oe.join(`
`)},lo=p.__private__.getBlob=function(N){return new Blob([De(N)],{type:"application/pdf"})},ai=p.output=p.__private__.output=na(function(N,ne){switch(typeof(ne=ne||{})=="string"?ne={filename:ne}:ne.filename=ne.filename||"generated.pdf",N){case void 0:return Ka();case"save":p.save(ne.filename);break;case"arraybuffer":return De(Ka());case"blob":return lo(Ka());case"bloburi":case"bloburl":if(Or.URL!==void 0&&typeof Or.URL.createObjectURL=="function")return Or.URL&&Or.URL.createObjectURL(lo(Ka()))||void 0;On.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Se="",Ie=Ka();try{Se=Tw(Ie)}catch{Se=Tw(unescape(encodeURIComponent(Ie)))}return"data:application/pdf;filename="+ne.filename+";base64,"+Se;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Or)==="[object Window]"){var Ke="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",ft=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';ne.pdfObjectUrl&&(Ke=ne.pdfObjectUrl,ft="");var At='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Ke+'"'+ft+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(ne)+");<\/script></body></html>",zt=Or.open();return zt!==null&&zt.document.write(At),zt}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Or)==="[object Window]"){var ir='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(ne.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+ne.filename+'" width="500px" height="400px" /></body></html>',Ir=Or.open();if(Ir!==null){Ir.document.write(ir);var Pr=this;Ir.document.documentElement.querySelector("#pdfViewer").onload=function(){Ir.document.title=ne.filename,Ir.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Pr.output("bloburl"))}}return Ir}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Or)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Qr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",ne)+'"></iframe></body></html>',Nn=Or.open();if(Nn!==null&&(Nn.document.write(Qr),Nn.document.title=ne.filename),Nn||typeof safari>"u")return Nn;break;case"datauri":case"dataurl":return Or.document.location.href=this.output("datauristring",ne);default:return null}}),dc=function(N){return Array.isArray(Dr)===!0&&Dr.indexOf(N)>-1};switch(n){case"pt":jt=1;break;case"mm":jt=72/25.4;break;case"cm":jt=72/2.54;break;case"in":jt=72;break;case"px":jt=dc("px_scaling")==1?.75:96/72;break;case"pc":case"em":jt=12;break;case"ex":jt=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);jt=n}var Bn=null;X(),L();var Yo=function(N){return d!==null?Bn.encryptor(N,0):function(ne){return ne}},ko=p.__private__.getPageInfo=p.getPageInfo=function(N){if(isNaN(N)||N%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:nr[N].objId,pageNumber:N,pageContext:nr[N]}},br=p.__private__.getPageInfoByObjId=function(N){if(isNaN(N)||N%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var ne in nr)if(nr[ne].objId===N)break;return ko(ne)},Al=p.__private__.getCurrentPageInfo=p.getCurrentPageInfo=function(){return{objId:nr[M].objId,pageNumber:M,pageContext:nr[M]}};p.addPage=function(){return ao.apply(this,arguments),this},p.setPage=function(){return ji.apply(this,arguments),se.call(this,me[M]),this},p.insertPage=function(N){return this.addPage(),this.movePage(M,N),this},p.movePage=function(N,ne){var Se,Ie;if(N>ne){Se=me[N],Ie=nr[N];for(var Ke=N;Ke>ne;Ke--)me[Ke]=me[Ke-1],nr[Ke]=nr[Ke-1];me[ne]=Se,nr[ne]=Ie,this.setPage(ne)}else if(N<ne){Se=me[N],Ie=nr[N];for(var ft=N;ft<ne;ft++)me[ft]=me[ft+1],nr[ft]=nr[ft+1];me[ne]=Se,nr[ne]=Ie,this.setPage(ne)}return this},p.deletePage=function(){return io.apply(this,arguments),this},p.__private__.text=p.text=function(N,ne,Se,Ie,Ke){var ft,At,zt,ir,Ir,Pr,Qr,Nn,Un,ia=(Ie=Ie||{}).scope||this;if(typeof N=="number"&&typeof ne=="number"&&(typeof Se=="string"||Array.isArray(Se))){var $a=Se;Se=ne,ne=N,N=$a}if(arguments[3]instanceof er?(S("The transform parameter of text() with a Matrix value"),Un=Ke):(zt=arguments[4],ir=arguments[5],gn(Qr=arguments[3])==="object"&&Qr!==null||(typeof zt=="string"&&(ir=zt,zt=null),typeof Qr=="string"&&(ir=Qr,Qr=null),typeof Qr=="number"&&(zt=Qr,Qr=null),Ie={flags:Qr,angle:zt,align:ir})),isNaN(ne)||isNaN(Se)||N==null)throw new Error("Invalid arguments passed to jsPDF.text");if(N.length===0)return ia;var Na="",fo=!1,ki=typeof Ie.lineHeightFactor=="number"?Ie.lineHeightFactor:Ai,No=ia.internal.scaleFactor;function uu(Dn){return Dn=Dn.split("	").join(Array(Ie.TabLen||9).join(" ")),Hr(Dn,Qr)}function mc(Dn){for(var Mn,xa=Dn.concat(),Ba=[],Ys=xa.length;Ys--;)typeof(Mn=xa.shift())=="string"?Ba.push(Mn):Array.isArray(Dn)&&(Mn.length===1||Mn[1]===void 0&&Mn[2]===void 0)?Ba.push(Mn[0]):Ba.push([Mn[0],Mn[1],Mn[2]]);return Ba}function Ol(Dn,Mn){var xa;if(typeof Dn=="string")xa=Mn(Dn)[0];else if(Array.isArray(Dn)){for(var Ba,Ys,Yd=Dn.concat(),pu=[],Gp=Yd.length;Gp--;)typeof(Ba=Yd.shift())=="string"?pu.push(Mn(Ba)[0]):Array.isArray(Ba)&&typeof Ba[0]=="string"&&(Ys=Mn(Ba[0],Ba[1],Ba[2]),pu.push([Ys[0],Ys[1],Ys[2]]));xa=pu}return xa}var kl=!1,gc=!0;if(typeof N=="string")kl=!0;else if(Array.isArray(N)){var Tl=N.concat();At=[];for(var zs,ca=Tl.length;ca--;)(typeof(zs=Tl.shift())!="string"||Array.isArray(zs)&&typeof zs[0]!="string")&&(gc=!1);kl=gc}if(kl===!1)throw new Error('Type of text must be string or Array. "'+N+'" is not recognized.');typeof N=="string"&&(N=N.match(/[\r?\n]/)?N.split(/\r\n|\r|\n/g):[N]);var El=Xe/ia.internal.scaleFactor,de=El*(ki-1);switch(Ie.baseline){case"bottom":Se-=de;break;case"top":Se+=El-de;break;case"hanging":Se+=El-2*de;break;case"middle":Se+=El/2-de}if((Pr=Ie.maxWidth||0)>0&&(typeof N=="string"?N=ia.splitTextToSize(N,Pr):Object.prototype.toString.call(N)==="[object Array]"&&(N=N.reduce(function(Dn,Mn){return Dn.concat(ia.splitTextToSize(Mn,Pr))},[]))),ft={text:N,x:ne,y:Se,options:Ie,mutex:{pdfEscape:Hr,activeFontKey:Wt,fonts:Je,activeFontSize:Xe}},Cr.publish("preProcessText",ft),N=ft.text,zt=(Ie=ft.options).angle,!(Un instanceof er)&&zt&&typeof zt=="number"){zt*=Math.PI/180,Ie.rotationDirection===0&&(zt=-zt),w===_.ADVANCED&&(zt=-zt);var pe=Math.cos(zt),Te=Math.sin(zt);Un=new er(pe,Te,-Te,pe,0,0)}else zt&&zt instanceof er&&(Un=zt);w!==_.ADVANCED||Un||(Un=Vn),(Ir=Ie.charSpace||aa)!==void 0&&(Na+=E(D(Ir))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Nn=Ie.horizontalScale)!==void 0&&(Na+=E(100*Nn)+` Tz
`),Ie.lang;var ke=-1,nt=Ie.renderingMode!==void 0?Ie.renderingMode:Ie.stroke,_t=ia.internal.getCurrentPageInfo().pageContext;switch(nt){case 0:case!1:case"fill":ke=0;break;case 1:case!0:case"stroke":ke=1;break;case 2:case"fillThenStroke":ke=2;break;case 3:case"invisible":ke=3;break;case 4:case"fillAndAddForClipping":ke=4;break;case 5:case"strokeAndAddPathForClipping":ke=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":ke=6;break;case 7:case"addToPathForClipping":ke=7}var Bt=_t.usedRenderingMode!==void 0?_t.usedRenderingMode:-1;ke!==-1?Na+=ke+` Tr
`:Bt!==-1&&(Na+=`0 Tr
`),ke!==-1&&(_t.usedRenderingMode=ke),ir=Ie.align||"left";var Dt,dr=Xe*ki,Kn=ia.internal.pageSize.getWidth(),va=Je[Wt];Ir=Ie.charSpace||aa,Pr=Ie.maxWidth||0,Qr=Object.assign({autoencode:!0,noBOM:!0},Ie.flags);var Hi=[],Ws=function(Dn){return ia.getStringUnitWidth(Dn,{font:va,charSpace:Ir,fontSize:Xe,doKerning:!1})*Xe/No};if(Object.prototype.toString.call(N)==="[object Array]"){var Vi;At=mc(N),ir!=="left"&&(Dt=At.map(Ws));var Ti,Il=0;if(ir==="right"){ne-=Dt[0],N=[],ca=At.length;for(var Hs=0;Hs<ca;Hs++)Hs===0?(Ti=Me(ne),Vi=Ne(Se)):(Ti=D(Il-Dt[Hs]),Vi=-dr),N.push([At[Hs],Ti,Vi]),Il=Dt[Hs]}else if(ir==="center"){ne-=Dt[0]/2,N=[],ca=At.length;for(var Vs=0;Vs<ca;Vs++)Vs===0?(Ti=Me(ne),Vi=Ne(Se)):(Ti=D((Il-Dt[Vs])/2),Vi=-dr),N.push([At[Vs],Ti,Vi]),Il=Dt[Vs]}else if(ir==="left"){N=[],ca=At.length;for(var du=0;du<ca;du++)N.push(At[du])}else if(ir==="justify"&&va.encoding==="Identity-H"){N=[],ca=At.length,Pr=Pr!==0?Pr:Kn;for(var Gs=0,ya=0;ya<ca;ya++)if(Vi=ya===0?Ne(Se):-dr,Ti=ya===0?Me(ne):Gs,ya<ca-1){var Hd=D((Pr-Dt[ya])/(At[ya].split(" ").length-1)),Ei=At[ya].split(" ");N.push([Ei[0]+" ",Ti,Vi]),Gs=0;for(var Do=1;Do<Ei.length;Do++){var fu=(Ws(Ei[Do-1]+" "+Ei[Do])-Ws(Ei[Do]))*No+Hd;Do==Ei.length-1?N.push([Ei[Do],fu,0]):N.push([Ei[Do]+" ",fu,0]),Gs-=fu}}else N.push([At[ya],Ti,Vi]);N.push(["",Gs,0])}else{if(ir!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(N=[],ca=At.length,Pr=Pr!==0?Pr:Kn,ya=0;ya<ca;ya++)Vi=ya===0?Ne(Se):-dr,Ti=ya===0?Me(ne):0,ya<ca-1?Hi.push(E(D((Pr-Dt[ya])/(At[ya].split(" ").length-1)))):Hi.push(0),N.push([At[ya],Ti,Vi])}}var Vp=typeof Ie.R2L=="boolean"?Ie.R2L:vt;Vp===!0&&(N=Ol(N,function(Dn,Mn,xa){return[Dn.split("").reverse().join(""),Mn,xa]})),ft={text:N,x:ne,y:Se,options:Ie,mutex:{pdfEscape:Hr,activeFontKey:Wt,fonts:Je,activeFontSize:Xe}},Cr.publish("postProcessText",ft),N=ft.text,fo=ft.mutex.isHex||!1;var Vd=Je[Wt].encoding;Vd!=="WinAnsiEncoding"&&Vd!=="StandardEncoding"||(N=Ol(N,function(Dn,Mn,xa){return[uu(Dn),Mn,xa]})),At=mc(N),N=[];for(var vc,yc,Nl,xc=0,hu=1,bc=Array.isArray(At[0])?hu:xc,Dl="",Gd=function(Dn,Mn,xa){var Ba="";return xa instanceof er?(xa=typeof Ie.angle=="number"?Jr(xa,new er(1,0,0,1,Dn,Mn)):Jr(new er(1,0,0,1,Dn,Mn),xa),w===_.ADVANCED&&(xa=Jr(new er(1,0,0,-1,0,0),xa)),Ba=xa.join(" ")+` Tm
`):Ba=E(Dn)+" "+E(Mn)+` Td
`,Ba},Mo=0;Mo<At.length;Mo++){switch(Dl="",bc){case hu:Nl=(fo?"<":"(")+At[Mo][0]+(fo?">":")"),vc=parseFloat(At[Mo][1]),yc=parseFloat(At[Mo][2]);break;case xc:Nl=(fo?"<":"(")+At[Mo]+(fo?">":")"),vc=Me(ne),yc=Ne(Se)}Hi!==void 0&&Hi[Mo]!==void 0&&(Dl=Hi[Mo]+` Tw
`),Mo===0?N.push(Dl+Gd(vc,yc,Un)+Nl):bc===xc?N.push(Dl+Nl):bc===hu&&N.push(Dl+Gd(vc,yc,Un)+Nl)}N=bc===xc?N.join(` Tj
T* `):N.join(` Tj
`),N+=` Tj
`;var Lo=`BT
/`;return Lo+=Wt+" "+Xe+` Tf
`,Lo+=E(Xe*ki)+` TL
`,Lo+=zr+`
`,Lo+=Na,Lo+=N,V(Lo+="ET"),h[Wt]=!0,ia};var fc=p.__private__.clip=p.clip=function(N){return V(N==="evenodd"?"W*":"W"),this};p.clipEvenOdd=function(){return fc("evenodd")},p.__private__.discardPath=p.discardPath=function(){return V("n"),this};var Si=p.__private__.isValidStyle=function(N){var ne=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(N)!==-1&&(ne=!0),ne};p.__private__.setDefaultPathOperation=p.setDefaultPathOperation=function(N){return Si(N)&&(u=N),this};var Fs=p.__private__.getStyle=p.getStyle=function(N){var ne=u;switch(N){case"D":case"S":ne="S";break;case"F":ne="f";break;case"FD":case"DF":ne="B";break;case"f":case"f*":case"B":case"B*":ne=N}return ne},Ci=p.close=function(){return V("h"),this};p.stroke=function(){return V("S"),this},p.fill=function(N){return Ko("f",N),this},p.fillEvenOdd=function(N){return Ko("f*",N),this},p.fillStroke=function(N){return Ko("B",N),this},p.fillStrokeEvenOdd=function(N){return Ko("B*",N),this};var Ko=function(N,ne){gn(ne)==="object"?hc(ne,N):V(N)},ii=function(N){N===null||w===_.ADVANCED&&N===void 0||(N=Fs(N),V(N))};function $i(N,ne,Se,Ie,Ke){var ft=new qu(ne||this.boundingBox,Se||this.xStep,Ie||this.yStep,this.gState,Ke||this.matrix);ft.stream=this.stream;var At=N+"$$"+this.cloneIndex+++"$$";return In(At,ft),ft}var hc=function(N,ne){var Se=St[N.key],Ie=at[Se];if(Ie instanceof Ic)V("q"),V($s(ne)),Ie.gState&&p.setGState(Ie.gState),V(N.matrix.toString()+" cm"),V("/"+Se+" sh"),V("Q");else if(Ie instanceof qu){var Ke=new er(1,0,0,-1,0,si());N.matrix&&(Ke=Ke.multiply(N.matrix||Vn),Se=$i.call(Ie,N.key,N.boundingBox,N.xStep,N.yStep,Ke).id),V("q"),V("/Pattern cs"),V("/"+Se+" scn"),Ie.gState&&p.setGState(Ie.gState),V(ne),V("Q")}},$s=function(N){switch(N){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},co=p.moveTo=function(N,ne){return V(E(D(N))+" "+E(F(ne))+" m"),this},To=p.lineTo=function(N,ne){return V(E(D(N))+" "+E(F(ne))+" l"),this},Eo=p.curveTo=function(N,ne,Se,Ie,Ke,ft){return V([E(D(N)),E(F(ne)),E(D(Se)),E(F(Ie)),E(D(Ke)),E(F(ft)),"c"].join(" ")),this};p.__private__.line=p.line=function(N,ne,Se,Ie,Ke){if(isNaN(N)||isNaN(ne)||isNaN(Se)||isNaN(Ie)||!Si(Ke))throw new Error("Invalid arguments passed to jsPDF.line");return w===_.COMPAT?this.lines([[Se-N,Ie-ne]],N,ne,[1,1],Ke||"S"):this.lines([[Se-N,Ie-ne]],N,ne,[1,1]).stroke()},p.__private__.lines=p.lines=function(N,ne,Se,Ie,Ke,ft){var At,zt,ir,Ir,Pr,Qr,Nn,Un,ia,$a,Na,fo;if(typeof N=="number"&&(fo=Se,Se=ne,ne=N,N=fo),Ie=Ie||[1,1],ft=ft||!1,isNaN(ne)||isNaN(Se)||!Array.isArray(N)||!Array.isArray(Ie)||!Si(Ke)||typeof ft!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(co(ne,Se),At=Ie[0],zt=Ie[1],Ir=N.length,$a=ne,Na=Se,ir=0;ir<Ir;ir++)(Pr=N[ir]).length===2?($a=Pr[0]*At+$a,Na=Pr[1]*zt+Na,To($a,Na)):(Qr=Pr[0]*At+$a,Nn=Pr[1]*zt+Na,Un=Pr[2]*At+$a,ia=Pr[3]*zt+Na,$a=Pr[4]*At+$a,Na=Pr[5]*zt+Na,Eo(Qr,Nn,Un,ia,$a,Na));return ft&&Ci(),ii(Ke),this},p.path=function(N){for(var ne=0;ne<N.length;ne++){var Se=N[ne],Ie=Se.c;switch(Se.op){case"m":co(Ie[0],Ie[1]);break;case"l":To(Ie[0],Ie[1]);break;case"c":Eo.apply(this,Ie);break;case"h":Ci()}}return this},p.__private__.rect=p.rect=function(N,ne,Se,Ie,Ke){if(isNaN(N)||isNaN(ne)||isNaN(Se)||isNaN(Ie)||!Si(Ke))throw new Error("Invalid arguments passed to jsPDF.rect");return w===_.COMPAT&&(Ie=-Ie),V([E(D(N)),E(F(ne)),E(D(Se)),E(D(Ie)),"re"].join(" ")),ii(Ke),this},p.__private__.triangle=p.triangle=function(N,ne,Se,Ie,Ke,ft,At){if(isNaN(N)||isNaN(ne)||isNaN(Se)||isNaN(Ie)||isNaN(Ke)||isNaN(ft)||!Si(At))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Se-N,Ie-ne],[Ke-Se,ft-Ie],[N-Ke,ne-ft]],N,ne,[1,1],At,!0),this},p.__private__.roundedRect=p.roundedRect=function(N,ne,Se,Ie,Ke,ft,At){if(isNaN(N)||isNaN(ne)||isNaN(Se)||isNaN(Ie)||isNaN(Ke)||isNaN(ft)||!Si(At))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var zt=4/3*(Math.SQRT2-1);return Ke=Math.min(Ke,.5*Se),ft=Math.min(ft,.5*Ie),this.lines([[Se-2*Ke,0],[Ke*zt,0,Ke,ft-ft*zt,Ke,ft],[0,Ie-2*ft],[0,ft*zt,-Ke*zt,ft,-Ke,ft],[2*Ke-Se,0],[-Ke*zt,0,-Ke,-ft*zt,-Ke,-ft],[0,2*ft-Ie],[0,-ft*zt,Ke*zt,-ft,Ke,-ft]],N+Ke,ne,[1,1],At,!0),this},p.__private__.ellipse=p.ellipse=function(N,ne,Se,Ie,Ke){if(isNaN(N)||isNaN(ne)||isNaN(Se)||isNaN(Ie)||!Si(Ke))throw new Error("Invalid arguments passed to jsPDF.ellipse");var ft=4/3*(Math.SQRT2-1)*Se,At=4/3*(Math.SQRT2-1)*Ie;return co(N+Se,ne),Eo(N+Se,ne-At,N+ft,ne-Ie,N,ne-Ie),Eo(N-ft,ne-Ie,N-Se,ne-At,N-Se,ne),Eo(N-Se,ne+At,N-ft,ne+Ie,N,ne+Ie),Eo(N+ft,ne+Ie,N+Se,ne+At,N+Se,ne),ii(Ke),this},p.__private__.circle=p.circle=function(N,ne,Se,Ie){if(isNaN(N)||isNaN(ne)||isNaN(Se)||!Si(Ie))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(N,ne,Se,Se,Ie)},p.setFont=function(N,ne,Se){return Se&&(ne=T(ne,Se)),Wt=pi(N,ne,{disableWarning:!1}),this};var Pl=p.__private__.getFont=p.getFont=function(){return Je[pi.apply(p,arguments)]};p.__private__.getFontList=p.getFontList=function(){var N,ne,Se={};for(N in Ue)if(Ue.hasOwnProperty(N))for(ne in Se[N]=[],Ue[N])Ue[N].hasOwnProperty(ne)&&Se[N].push(ne);return Se},p.addFont=function(N,ne,Se,Ie,Ke){var ft=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&ft.indexOf(arguments[3])!==-1?Ke=arguments[3]:arguments[3]&&ft.indexOf(arguments[3])==-1&&(Se=T(Se,Ie)),Ke=Ke||"Identity-H",Ea.call(this,N,ne,Se,Ke)};var Ai,Bs=e.lineWidth||.200025,Bi=p.__private__.getLineWidth=p.getLineWidth=function(){return Bs},Us=p.__private__.setLineWidth=p.setLineWidth=function(N){return Bs=N,V(E(D(N))+" w"),this};p.__private__.setLineDash=wr.API.setLineDash=wr.API.setLineDashPattern=function(N,ne){if(N=N||[],ne=ne||0,isNaN(ne)||!Array.isArray(N))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return N=N.map(function(Se){return E(D(Se))}).join(" "),ne=E(D(ne)),V("["+N+"] "+ne+" d"),this};var be=p.__private__.getLineHeight=p.getLineHeight=function(){return Xe*Ai};p.__private__.getLineHeight=p.getLineHeight=function(){return Xe*Ai};var we=p.__private__.setLineHeightFactor=p.setLineHeightFactor=function(N){return typeof(N=N||1.15)=="number"&&(Ai=N),this},Ee=p.__private__.getLineHeightFactor=p.getLineHeightFactor=function(){return Ai};we(e.lineHeight);var Me=p.__private__.getHorizontalCoordinate=function(N){return D(N)},Ne=p.__private__.getVerticalCoordinate=function(N){return w===_.ADVANCED?N:nr[M].mediaBox.topRightY-nr[M].mediaBox.bottomLeftY-D(N)},mt=p.__private__.getHorizontalCoordinateString=p.getHorizontalCoordinateString=function(N){return E(Me(N))},Tt=p.__private__.getVerticalCoordinateString=p.getVerticalCoordinateString=function(N){return E(Ne(N))},Lt=e.strokeColor||"0 G";p.__private__.getStrokeColor=p.getDrawColor=function(){return qe(Lt)},p.__private__.setStrokeColor=p.setDrawColor=function(N,ne,Se,Ie){return Lt=rt({ch1:N,ch2:ne,ch3:Se,ch4:Ie,pdfColorType:"draw",precision:2}),V(Lt),this};var Ar=e.fillColor||"0 g";p.__private__.getFillColor=p.getFillColor=function(){return qe(Ar)},p.__private__.setFillColor=p.setFillColor=function(N,ne,Se,Ie){return Ar=rt({ch1:N,ch2:ne,ch3:Se,ch4:Ie,pdfColorType:"fill",precision:2}),V(Ar),this};var zr=e.textColor||"0 g",hn=p.__private__.getTextColor=p.getTextColor=function(){return qe(zr)};p.__private__.setTextColor=p.setTextColor=function(N,ne,Se,Ie){return zr=rt({ch1:N,ch2:ne,ch3:Se,ch4:Ie,pdfColorType:"text",precision:3}),this};var aa=e.charSpace,Yn=p.__private__.getCharSpace=p.getCharSpace=function(){return parseFloat(aa||0)};p.__private__.setCharSpace=p.setCharSpace=function(N){if(isNaN(N))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return aa=N,this};var Pi=0;p.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},p.__private__.setLineCap=p.setLineCap=function(N){var ne=p.CapJoinStyles[N];if(ne===void 0)throw new Error("Line cap style of '"+N+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Pi=ne,V(ne+" J"),this};var oi=0;p.__private__.setLineJoin=p.setLineJoin=function(N){var ne=p.CapJoinStyles[N];if(ne===void 0)throw new Error("Line join style of '"+N+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return oi=ne,V(ne+" j"),this},p.__private__.setLineMiterLimit=p.__private__.setMiterLimit=p.setLineMiterLimit=p.setMiterLimit=function(N){if(N=N||0,isNaN(N))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return V(E(D(N))+" M"),this},p.GState=bv,p.setGState=function(N){(N=typeof N=="string"?It[Yt[N]]:Ia(null,N)).equals(Sr)||(V("/"+N.id+" gs"),Sr=N)};var Ia=function(N,ne){if(!N||!Yt[N]){var Se=!1;for(var Ie in It)if(It.hasOwnProperty(Ie)&&It[Ie].equals(ne)){Se=!0;break}if(Se)ne=It[Ie];else{var Ke="GS"+(Object.keys(It).length+1).toString(10);It[Ke]=ne,ne.id=Ke}return N&&(Yt[N]=ne.id),Cr.publish("addGState",ne),ne}};p.addGState=function(N,ne){return Ia(N,ne),this},p.saveGraphicsState=function(){return V("q"),pt.push({key:Wt,size:Xe,color:zr}),this},p.restoreGraphicsState=function(){V("Q");var N=pt.pop();return Wt=N.key,Xe=N.size,zr=N.color,Sr=null,this},p.setCurrentTransformationMatrix=function(N){return V(N.toString()+" cm"),this},p.comment=function(N){return V("#"+N),this};var Fa=function(N,ne){var Se=N||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Se},set:function(ft){isNaN(ft)||(Se=parseFloat(ft))}});var Ie=ne||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Ie},set:function(ft){isNaN(ft)||(Ie=parseFloat(ft))}});var Ke="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Ke},set:function(ft){Ke=ft.toString()}}),this},Ui=function(N,ne,Se,Ie){Fa.call(this,N,ne),this.type="rect";var Ke=Se||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Ke},set:function(At){isNaN(At)||(Ke=parseFloat(At))}});var ft=Ie||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return ft},set:function(At){isNaN(At)||(ft=parseFloat(At))}}),this},uo=function(){this.page=Mr,this.currentPage=M,this.pages=me.slice(0),this.pagesContext=nr.slice(0),this.x=ur,this.y=$e,this.matrix=He,this.width=Wi(M),this.height=si(M),this.outputDestination=G,this.id="",this.objectNumber=-1};uo.prototype.restore=function(){Mr=this.page,M=this.currentPage,nr=this.pagesContext,me=this.pages,ur=this.x,$e=this.y,He=this.matrix,ps(M,this.width),pc(M,this.height),G=this.outputDestination};var Io=function(N,ne,Se,Ie,Ke){En.push(new uo),Mr=M=0,me=[],ur=N,$e=ne,He=Ke,no([Se,Ie])},Oi=function(N){if(Oa[N])En.pop().restore();else{var ne=new uo,Se="Xo"+(Object.keys(fn).length+1).toString(10);ne.id=Se,Oa[N]=Se,fn[Se]=ne,Cr.publish("addFormObject",ne),En.pop().restore()}};for(var zi in p.beginFormObject=function(N,ne,Se,Ie,Ke){return Io(N,ne,Se,Ie,Ke),this},p.endFormObject=function(N){return Oi(N),this},p.doFormObject=function(N,ne){var Se=fn[Oa[N]];return V("q"),V(ne.toString()+" cm"),V("/"+Se.id+" Do"),V("Q"),this},p.getFormObject=function(N){var ne=fn[Oa[N]];return{x:ne.x,y:ne.y,width:ne.width,height:ne.height,matrix:ne.matrix}},p.save=function(N,ne){return N=N||"generated.pdf",(ne=ne||{}).returnPromise=ne.returnPromise||!1,ne.returnPromise===!1?(Tc(lo(Ka()),N),typeof Tc.unload=="function"&&Or.setTimeout&&setTimeout(Tc.unload,911),this):new Promise(function(Se,Ie){try{var Ke=Tc(lo(Ka()),N);typeof Tc.unload=="function"&&Or.setTimeout&&setTimeout(Tc.unload,911),Se(Ke)}catch(ft){Ie(ft.message)}})},wr.API)wr.API.hasOwnProperty(zi)&&(zi==="events"&&wr.API.events.length?function(N,ne){var Se,Ie,Ke;for(Ke=ne.length-1;Ke!==-1;Ke--)Se=ne[Ke][0],Ie=ne[Ke][1],N.subscribe.apply(N,[Se].concat(typeof Ie=="function"?[Ie]:Ie))}(Cr,wr.API.events):p[zi]=wr.API[zi]);var Wi=p.getPageWidth=function(N){return(nr[N=N||M].mediaBox.topRightX-nr[N].mediaBox.bottomLeftX)/jt},ps=p.setPageWidth=function(N,ne){nr[N].mediaBox.topRightX=ne*jt+nr[N].mediaBox.bottomLeftX},si=p.getPageHeight=function(N){return(nr[N=N||M].mediaBox.topRightY-nr[N].mediaBox.bottomLeftY)/jt},pc=p.setPageHeight=function(N,ne){nr[N].mediaBox.topRightY=ne*jt+nr[N].mediaBox.bottomLeftY};return p.internal={pdfEscape:Hr,getStyle:Fs,getFont:Pl,getFontSize:lt,getCharSpace:Yn,getTextColor:hn,getLineHeight:be,getLineHeightFactor:Ee,getLineWidth:Bi,write:Ge,getHorizontalCoordinate:Me,getVerticalCoordinate:Ne,getCoordinateString:mt,getVerticalCoordinateString:Tt,collections:{},newObject:Yr,newAdditionalObject:Ve,newObjectDeferred:Kr,newObjectDeferredBegin:je,getFilters:Pt,putStream:Kt,events:Cr,scaleFactor:jt,pageSize:{getWidth:function(){return Wi(M)},setWidth:function(N){ps(M,N)},getHeight:function(){return si(M)},setHeight:function(N){pc(M,N)}},encryptionOptions:d,encryption:Bn,getEncryptor:Yo,output:ai,getNumberOfPages:oo,pages:me,out:V,f2:W,f3:O,getPageInfo:ko,getPageInfoByObjId:br,getCurrentPageInfo:Al,getPDFVersion:m,Point:Fa,Rectangle:Ui,Matrix:er,hasHotfix:dc},Object.defineProperty(p.internal.pageSize,"width",{get:function(){return Wi(M)},set:function(N){ps(M,N)},enumerable:!0,configurable:!0}),Object.defineProperty(p.internal.pageSize,"height",{get:function(){return si(M)},set:function(N){pc(M,N)},enumerable:!0,configurable:!0}),ni.call(p,Fe),Wt="F1",ao(a,r),Cr.publish("initialized"),p}ku.prototype.lsbFirstWord=function(e){return String.fromCharCode(e>>0&255,e>>8&255,e>>16&255,e>>24&255)},ku.prototype.toHexString=function(e){return e.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},ku.prototype.hexToBytes=function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(String.fromCharCode(parseInt(e.substr(r,2),16)));return t.join("")},ku.prototype.processOwnerPassword=function(e,t){return Iw(Ew(t).substr(0,5),e)},ku.prototype.encryptor=function(e,t){var r=Ew(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(n){return Iw(r,n)}},bv.prototype.equals=function(e){var t,r="id,objectNumber,equals";if(!e||gn(e)!==gn(this))return!1;var n=0;for(t in this)if(!(r.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t)||this[t]!==e[t])return!1;n++}for(t in e)e.hasOwnProperty(t)&&r.indexOf(t)<0&&n--;return n===0},wr.API={events:[]},wr.version="3.0.1";var da=wr.API,_S=1,cu=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Cu=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Rr=function(e){return e.toFixed(2)},Wl=function(e){return e.toFixed(5)};da.__acroform__={};var eo=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},V4=function(e){return e*_S},ys=function(e){var t=new E6,r=Jt.internal.getHeight(e)||0,n=Jt.internal.getWidth(e)||0;return t.BBox=[0,0,Number(Rr(n)),Number(Rr(r))],t},Wle=da.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|=1<<t},Hle=da.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&=~(1<<t)},Vle=da.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return(e&1<<t)==0?0:1},ba=da.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Vle(e,t-1)},_a=da.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Wle(e,t-1)},wa=da.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Hle(e,t-1)},Gle=da.__acroform__.calculateCoordinates=function(e,t){var r=t.internal.getHorizontalCoordinate,n=t.internal.getVerticalCoordinate,a=e[0],o=e[1],s=e[2],l=e[3],c={};return c.lowerLeft_X=r(a)||0,c.lowerLeft_Y=n(o+l)||0,c.upperRight_X=r(a+s)||0,c.upperRight_Y=n(o)||0,[Number(Rr(c.lowerLeft_X)),Number(Rr(c.lowerLeft_Y)),Number(Rr(c.upperRight_X)),Number(Rr(c.upperRight_Y))]},Yle=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],r=e._V||e.DV,n=Nw(e,r),a=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+a+" "+Rr(n.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(n.text),t.push("ET"),t.push("Q"),t.push("EMC");var o=ys(e);return o.scope=e.scope,o.stream=t.join(`
`),o}},Nw=function(e,t){var r=e.fontSize===0?e.maxFontSize:e.fontSize,n={text:"",fontSize:""},a=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");a=e.multiline?a.map(function(O){return O.split(`
`)}):a.map(function(O){return[O]});var o=r,s=Jt.internal.getHeight(e)||0;s=s<0?-s:s;var l=Jt.internal.getWidth(e)||0;l=l<0?-l:l;var c=function(O,D,R){if(O+1<a.length){var F=D+" "+a[O+1][0];return Mm(F,e,R).width<=l-4}return!1};o++;e:for(;o>0;){t="",o--;var u,d,f=Mm("3",e,o).height,h=e.multiline?s-o:(s-f)/2,p=h+=2,v=0,m=0,y=0;if(o<=0){t=`(...) Tj
`,t+="% Width of Text: "+Mm(t,e,o=12).width+", FieldWidth:"+l+`
`;break}for(var b="",_=0,w=0;w<a.length;w++)if(a.hasOwnProperty(w)){var A=!1;if(a[w].length!==1&&y!==a[w].length-1){if((f+2)*(_+2)+2>s)continue e;b+=a[w][y],A=!0,m=w,w--}else{b=(b+=a[w][y]+" ").substr(b.length-1)==" "?b.substr(0,b.length-1):b;var P=parseInt(w),T=c(P,b,o),E=w>=a.length-1;if(T&&!E){b+=" ",y=0;continue}if(T||E){if(E)m=P;else if(e.multiline&&(f+2)*(_+2)+2>s)continue e}else{if(!e.multiline||(f+2)*(_+2)+2>s)continue e;m=P}}for(var S="",I=v;I<=m;I++){var W=a[I];if(e.multiline){if(I===m){S+=W[y]+" ",y=(y+1)%W.length;continue}if(I===v){S+=W[W.length-1]+" ";continue}}S+=W[0]+" "}switch(S=S.substr(S.length-1)==" "?S.substr(0,S.length-1):S,d=Mm(S,e,o).width,e.textAlign){case"right":u=l-d-2;break;case"center":u=(l-d)/2;break;case"left":default:u=2}t+=Rr(u)+" "+Rr(p)+` Td
`,t+="("+cu(S)+`) Tj
`,t+=-Rr(u)+` 0 Td
`,p=-(o+2),d=0,v=A?m:m+1,_++,b=""}break}return n.text=t,n.fontSize=o,n},Mm=function(e,t,r){var n=t.scope.internal.getFont(t.fontName,t.fontStyle),a=t.scope.getStringUnitWidth(e,{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r);return{height:t.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r)*1.5,width:a}},Kle={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Qle=function(e,t){var r={type:"reference",object:e};t.internal.getPageInfo(e.page).pageContext.annotations.find(function(n){return n.type===r.type&&n.object===r.object})===void 0&&t.internal.getPageInfo(e.page).pageContext.annotations.push(r)},Xle=function(e,t){for(var r in e)if(e.hasOwnProperty(r)){var n=r,a=e[r];t.internal.newObjectDeferredBegin(a.objId,!0),gn(a)==="object"&&typeof a.putStream=="function"&&a.putStream(),delete e[n]}},Jle=function(e,t){if(t.scope=e,e.internal!==void 0&&(e.internal.acroformPlugin===void 0||e.internal.acroformPlugin.isInitialized===!1)){if(us.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify(Kle)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");_S=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new I6,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",function(){(function(r){r.internal.events.unsubscribe(r.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete r.internal.acroformPlugin.acroFormDictionaryRoot._eventID,r.internal.acroformPlugin.printedOut=!0})(e)}),e.internal.events.subscribe("buildDocument",function(){(function(r){r.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=r.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var a in n)if(n.hasOwnProperty(a)){var o=n[a];o.objId=void 0,o.hasAnnotation&&Qle(o,r)}})(e)}),e.internal.events.subscribe("putCatalog",function(){(function(r){if(r.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");r.internal.write("/AcroForm "+r.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(e)}),e.internal.events.subscribe("postPutPages",function(r){(function(n,a){var o=!n;for(var s in n||(a.internal.newObjectDeferredBegin(a.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),a.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||a.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(s)){var l=n[s],c=[],u=l.Rect;if(l.Rect&&(l.Rect=Gle(l.Rect,a)),a.internal.newObjectDeferredBegin(l.objId,!0),l.DA=Jt.createDefaultAppearanceStream(l),gn(l)==="object"&&typeof l.getKeyValueListForStream=="function"&&(c=l.getKeyValueListForStream()),l.Rect=u,l.hasAppearanceStream&&!l.appearanceStreamContent){var d=Yle(l);c.push({key:"AP",value:"<</N "+d+">>"}),a.internal.acroformPlugin.xForms.push(d)}if(l.appearanceStreamContent){var f="";for(var h in l.appearanceStreamContent)if(l.appearanceStreamContent.hasOwnProperty(h)){var p=l.appearanceStreamContent[h];if(f+="/"+h+" ",f+="<<",Object.keys(p).length>=1||Array.isArray(p)){for(var s in p)if(p.hasOwnProperty(s)){var v=p[s];typeof v=="function"&&(v=v.call(a,l)),f+="/"+s+" "+v+" ",a.internal.acroformPlugin.xForms.indexOf(v)>=0||a.internal.acroformPlugin.xForms.push(v)}}else typeof(v=p)=="function"&&(v=v.call(a,l)),f+="/"+s+" "+v,a.internal.acroformPlugin.xForms.indexOf(v)>=0||a.internal.acroformPlugin.xForms.push(v);f+=">>"}c.push({key:"AP",value:`<<
`+f+">>"})}a.internal.putStream({additionalKeyValues:c,objectId:l.objId}),a.internal.out("endobj")}o&&Xle(a.internal.acroformPlugin.xForms,a)})(r,e)}),e.internal.acroformPlugin.isInitialized=!0}},T6=da.__acroform__.arrayToPdfArray=function(e,t,r){var n=function(s){return s};if(Array.isArray(e)){for(var a="[",o=0;o<e.length;o++)switch(o!==0&&(a+=" "),gn(e[o])){case"boolean":case"number":case"object":a+=e[o].toString();break;case"string":e[o].substr(0,1)!=="/"?(t!==void 0&&r&&(n=r.internal.getEncryptor(t)),a+="("+cu(n(e[o].toString()))+")"):a+=e[o].toString()}return a+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},C2=function(e,t,r){var n=function(a){return a};return t!==void 0&&r&&(n=r.internal.getEncryptor(t)),(e=e||"").toString(),e="("+cu(n(e))+")"},js=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};js.prototype.toString=function(){return this.objId+" 0 R"},js.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},js.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter(function(o){return o!="content"&&o!="appearanceStreamContent"&&o!="scope"&&o!="objId"&&o.substring(0,1)!="_"});for(var r in t)if(Object.getOwnPropertyDescriptor(this,t[r]).configurable===!1){var n=t[r],a=this[n];a&&(Array.isArray(a)?e.push({key:n,value:T6(a,this.objId,this.scope)}):a instanceof js?(a.scope=this.scope,e.push({key:n,value:a.objId+" 0 R"})):typeof a!="function"&&e.push({key:n,value:a}))}return e};var E6=function(){js.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(r){e=r.trim()},get:function(){return e||null}})};eo(E6,js);var I6=function(){js.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var r=function(n){return n};return this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),"("+cu(r(e))+")"}},set:function(r){e=r}})};eo(I6,js);var us=function e(){js.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(b){if(isNaN(b))throw new Error('Invalid value "'+b+'" for attribute F supplied.');t=b}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!ba(t,3)},set:function(b){b?this.F=_a(t,3):this.F=wa(t,3)}});var r=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return r},set:function(b){if(isNaN(b))throw new Error('Invalid value "'+b+'" for attribute Ff supplied.');r=b}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(b){n=b!==void 0?b:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(b){n[0]=b}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(b){n[1]=b}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(b){n[2]=b}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(b){n[3]=b}});var a="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return a},set:function(b){switch(b){case"/Btn":case"/Tx":case"/Ch":case"/Sig":a=b;break;default:throw new Error('Invalid value "'+b+'" for attribute FT supplied.')}}});var o=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!o||o.length<1){if(this instanceof _v)return;o="FieldObject"+e.FieldNum++}var b=function(_){return _};return this.scope&&(b=this.scope.internal.getEncryptor(this.objId)),"("+cu(b(o))+")"},set:function(b){o=b.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return o},set:function(b){o=b}});var s="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return s},set:function(b){s=b}});var l="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return l},set:function(b){l=b}});var c=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return c},set:function(b){c=b}});var u=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return u===void 0?50/_S:u},set:function(b){u=b}});var d="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return d},set:function(b){d=b}});var f="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!f||this instanceof _v||this instanceof Wc))return C2(f,this.objId,this.scope)},set:function(b){b=b.toString(),f=b}});var h=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(h)return this instanceof Za?h:C2(h,this.objId,this.scope)},set:function(b){b=b.toString(),h=this instanceof Za?b:b.substr(0,1)==="("?Cu(b.substr(1,b.length-2)):Cu(b)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Za?Cu(h.substr(1,h.length-1)):h},set:function(b){b=b.toString(),h=this instanceof Za?"/"+b:b}});var p=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(p)return p},set:function(b){this.V=b}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(p)return this instanceof Za?p:C2(p,this.objId,this.scope)},set:function(b){b=b.toString(),p=this instanceof Za?b:b.substr(0,1)==="("?Cu(b.substr(1,b.length-2)):Cu(b)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Za?Cu(p.substr(1,p.length-1)):p},set:function(b){b=b.toString(),p=this instanceof Za?"/"+b:b}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var v,m=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return m},set:function(b){b=!!b,m=b}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(v)return v},set:function(b){v=b}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,1)},set:function(b){b?this.Ff=_a(this.Ff,1):this.Ff=wa(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,2)},set:function(b){b?this.Ff=_a(this.Ff,2):this.Ff=wa(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,3)},set:function(b){b?this.Ff=_a(this.Ff,3):this.Ff=wa(this.Ff,3)}});var y=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(y!==null)return y},set:function(b){if([0,1,2].indexOf(b)===-1)throw new Error('Invalid value "'+b+'" for attribute Q supplied.');y=b}}),Object.defineProperty(this,"textAlign",{get:function(){var b;switch(y){case 0:default:b="left";break;case 1:b="center";break;case 2:b="right"}return b},configurable:!0,enumerable:!0,set:function(b){switch(b){case"right":case 2:y=2;break;case"center":case 1:y=1;break;case"left":case 0:default:y=0}}})};eo(us,js);var Ku=function(){us.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(r){e=r}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return T6(t,this.objId,this.scope)},set:function(r){var n,a;a=[],typeof(n=r)=="string"&&(a=function(o,s,l){l||(l=1);for(var c,u=[];c=s.exec(o);)u.push(c[l]);return u}(n,/\((.*?)\)/g)),t=a}}),this.getOptions=function(){return t},this.setOptions=function(r){t=r,this.sort&&t.sort()},this.addOption=function(r){r=(r=r||"").toString(),t.push(r),this.sort&&t.sort()},this.removeOption=function(r,n){for(n=n||!1,r=(r=r||"").toString();t.indexOf(r)!==-1&&(t.splice(t.indexOf(r),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,18)},set:function(r){r?this.Ff=_a(this.Ff,18):this.Ff=wa(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,19)},set:function(r){this.combo===!0&&(r?this.Ff=_a(this.Ff,19):this.Ff=wa(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,20)},set:function(r){r?(this.Ff=_a(this.Ff,20),t.sort()):this.Ff=wa(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,22)},set:function(r){r?this.Ff=_a(this.Ff,22):this.Ff=wa(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,23)},set:function(r){r?this.Ff=_a(this.Ff,23):this.Ff=wa(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,27)},set:function(r){r?this.Ff=_a(this.Ff,27):this.Ff=wa(this.Ff,27)}}),this.hasAppearanceStream=!1};eo(Ku,us);var Qu=function(){Ku.call(this),this.fontName="helvetica",this.combo=!1};eo(Qu,Ku);var Xu=function(){Qu.call(this),this.combo=!0};eo(Xu,Qu);var tg=function(){Xu.call(this),this.edit=!0};eo(tg,Xu);var Za=function(){us.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,15)},set:function(r){r?this.Ff=_a(this.Ff,15):this.Ff=wa(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,16)},set:function(r){r?this.Ff=_a(this.Ff,16):this.Ff=wa(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,17)},set:function(r){r?this.Ff=_a(this.Ff,17):this.Ff=wa(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,26)},set:function(r){r?this.Ff=_a(this.Ff,26):this.Ff=wa(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(o){return o};if(this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var n,a=[];for(n in a.push("<<"),t)a.push("/"+n+" ("+cu(r(t[n]))+")");return a.push(">>"),a.join(`
`)}},set:function(r){gn(r)==="object"&&(t=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(r){typeof r=="string"&&(t.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(r){e="/"+r}})};eo(Za,us);var rg=function(){Za.call(this),this.pushButton=!0};eo(rg,Za);var Ju=function(){Za.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t!==void 0?t:[]}})};eo(Ju,Za);var _v=function(){var e,t;us.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(a){e=a}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(a){t=a}});var r,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var a=function(l){return l};this.scope&&(a=this.scope.internal.getEncryptor(this.objId));var o,s=[];for(o in s.push("<<"),n)s.push("/"+o+" ("+cu(a(n[o]))+")");return s.push(">>"),s.join(`
`)},set:function(a){gn(a)==="object"&&(n=a)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(a){typeof a=="string"&&(n.CA=a)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(a){r=a}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(a){r="/"+a}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Jt.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};eo(_v,us),Ju.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var r=this.Kids[t];r.appearanceStreamContent=e.createAppearanceStream(r.optionName),r.caption=e.getCA()}},Ju.prototype.createOption=function(e){var t=new _v;return t.Parent=this,t.optionName=e,this.Kids.push(t),Zle.call(this.scope,t),t};var ng=function(){Za.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Jt.CheckBox.createAppearanceStream()};eo(ng,Za);var Wc=function(){us.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,13)},set:function(t){t?this.Ff=_a(this.Ff,13):this.Ff=wa(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,21)},set:function(t){t?this.Ff=_a(this.Ff,21):this.Ff=wa(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,23)},set:function(t){t?this.Ff=_a(this.Ff,23):this.Ff=wa(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,24)},set:function(t){t?this.Ff=_a(this.Ff,24):this.Ff=wa(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,25)},set:function(t){t?this.Ff=_a(this.Ff,25):this.Ff=wa(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,26)},set:function(t){t?this.Ff=_a(this.Ff,26):this.Ff=wa(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};eo(Wc,us);var ag=function(){Wc.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!ba(this.Ff,14)},set:function(e){e?this.Ff=_a(this.Ff,14):this.Ff=wa(this.Ff,14)}}),this.password=!0};eo(ag,Wc);var Jt={CheckBox:{createAppearanceStream:function(){return{N:{On:Jt.CheckBox.YesNormal},D:{On:Jt.CheckBox.YesPushDown,Off:Jt.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=[],n=e.scope.internal.getFont(e.fontName,e.fontStyle).id,a=e.scope.__private__.encodeColorString(e.color),o=Nw(e,e.caption);return r.push("0.749023 g"),r.push("0 0 "+Rr(Jt.internal.getWidth(e))+" "+Rr(Jt.internal.getHeight(e))+" re"),r.push("f"),r.push("BMC"),r.push("q"),r.push("0 0 1 rg"),r.push("/"+n+" "+Rr(o.fontSize)+" Tf "+a),r.push("BT"),r.push(o.text),r.push("ET"),r.push("Q"),r.push("EMC"),t.stream=r.join(`
`),t},YesNormal:function(e){var t=ys(e);t.scope=e.scope;var r=e.scope.internal.getFont(e.fontName,e.fontStyle).id,n=e.scope.__private__.encodeColorString(e.color),a=[],o=Jt.internal.getHeight(e),s=Jt.internal.getWidth(e),l=Nw(e,e.caption);return a.push("1 g"),a.push("0 0 "+Rr(s)+" "+Rr(o)+" re"),a.push("f"),a.push("q"),a.push("0 0 1 rg"),a.push("0 0 "+Rr(s-1)+" "+Rr(o-1)+" re"),a.push("W"),a.push("n"),a.push("0 g"),a.push("BT"),a.push("/"+r+" "+Rr(l.fontSize)+" Tf "+n),a.push(l.text),a.push("ET"),a.push("Q"),t.stream=a.join(`
`),t},OffPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+Rr(Jt.internal.getWidth(e))+" "+Rr(Jt.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:Jt.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=Jt.RadioButton.Circle.YesNormal,t.D[e]=Jt.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=ys(e);t.scope=e.scope;var r=[],n=Jt.internal.getWidth(e)<=Jt.internal.getHeight(e)?Jt.internal.getWidth(e)/4:Jt.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var a=Jt.internal.Bezier_C,o=Number((n*a).toFixed(5));return r.push("q"),r.push("1 0 0 1 "+Wl(Jt.internal.getWidth(e)/2)+" "+Wl(Jt.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),r.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),r.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),r.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=[],n=Jt.internal.getWidth(e)<=Jt.internal.getHeight(e)?Jt.internal.getWidth(e)/4:Jt.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var a=Number((2*n).toFixed(5)),o=Number((a*Jt.internal.Bezier_C).toFixed(5)),s=Number((n*Jt.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+Wl(Jt.internal.getWidth(e)/2)+" "+Wl(Jt.internal.getHeight(e)/2)+" cm"),r.push(a+" 0 m"),r.push(a+" "+o+" "+o+" "+a+" 0 "+a+" c"),r.push("-"+o+" "+a+" -"+a+" "+o+" -"+a+" 0 c"),r.push("-"+a+" -"+o+" -"+o+" -"+a+" 0 -"+a+" c"),r.push(o+" -"+a+" "+a+" -"+o+" "+a+" 0 c"),r.push("f"),r.push("Q"),r.push("0 g"),r.push("q"),r.push("1 0 0 1 "+Wl(Jt.internal.getWidth(e)/2)+" "+Wl(Jt.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),r.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),r.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),r.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},OffPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=[],n=Jt.internal.getWidth(e)<=Jt.internal.getHeight(e)?Jt.internal.getWidth(e)/4:Jt.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var a=Number((2*n).toFixed(5)),o=Number((a*Jt.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+Wl(Jt.internal.getWidth(e)/2)+" "+Wl(Jt.internal.getHeight(e)/2)+" cm"),r.push(a+" 0 m"),r.push(a+" "+o+" "+o+" "+a+" 0 "+a+" c"),r.push("-"+o+" "+a+" -"+a+" "+o+" -"+a+" 0 c"),r.push("-"+a+" -"+o+" -"+o+" -"+a+" 0 -"+a+" c"),r.push(o+" -"+a+" "+a+" -"+o+" "+a+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:Jt.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=Jt.RadioButton.Cross.YesNormal,t.D[e]=Jt.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=ys(e);t.scope=e.scope;var r=[],n=Jt.internal.calculateCross(e);return r.push("q"),r.push("1 1 "+Rr(Jt.internal.getWidth(e)-2)+" "+Rr(Jt.internal.getHeight(e)-2)+" re"),r.push("W"),r.push("n"),r.push(Rr(n.x1.x)+" "+Rr(n.x1.y)+" m"),r.push(Rr(n.x2.x)+" "+Rr(n.x2.y)+" l"),r.push(Rr(n.x4.x)+" "+Rr(n.x4.y)+" m"),r.push(Rr(n.x3.x)+" "+Rr(n.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=Jt.internal.calculateCross(e),n=[];return n.push("0.749023 g"),n.push("0 0 "+Rr(Jt.internal.getWidth(e))+" "+Rr(Jt.internal.getHeight(e))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+Rr(Jt.internal.getWidth(e)-2)+" "+Rr(Jt.internal.getHeight(e)-2)+" re"),n.push("W"),n.push("n"),n.push(Rr(r.x1.x)+" "+Rr(r.x1.y)+" m"),n.push(Rr(r.x2.x)+" "+Rr(r.x2.y)+" l"),n.push(Rr(r.x4.x)+" "+Rr(r.x4.y)+" m"),n.push(Rr(r.x3.x)+" "+Rr(r.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join(`
`),t},OffPushDown:function(e){var t=ys(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+Rr(Jt.internal.getWidth(e))+" "+Rr(Jt.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,r=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+r}};Jt.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=Jt.internal.getWidth(e),r=Jt.internal.getHeight(e),n=Math.min(t,r);return{x1:{x:(t-n)/2,y:(r-n)/2+n},x2:{x:(t-n)/2+n,y:(r-n)/2},x3:{x:(t-n)/2,y:(r-n)/2},x4:{x:(t-n)/2+n,y:(r-n)/2+n}}}},Jt.internal.getWidth=function(e){var t=0;return gn(e)==="object"&&(t=V4(e.Rect[2])),t},Jt.internal.getHeight=function(e){var t=0;return gn(e)==="object"&&(t=V4(e.Rect[3])),t};var Zle=da.addField=function(e){if(Jle(this,e),!(e instanceof us))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};da.AcroFormChoiceField=Ku,da.AcroFormListBox=Qu,da.AcroFormComboBox=Xu,da.AcroFormEditBox=tg,da.AcroFormButton=Za,da.AcroFormPushButton=rg,da.AcroFormRadioButton=Ju,da.AcroFormCheckBox=ng,da.AcroFormTextField=Wc,da.AcroFormPasswordField=ag,da.AcroFormAppearance=Jt,da.AcroForm={ChoiceField:Ku,ListBox:Qu,ComboBox:Xu,EditBox:tg,Button:Za,PushButton:rg,RadioButton:Ju,CheckBox:ng,TextField:Wc,PasswordField:ag,Appearance:Jt},wr.AcroForm={ChoiceField:Ku,ListBox:Qu,ComboBox:Xu,EditBox:tg,Button:Za,PushButton:rg,RadioButton:Ju,CheckBox:ng,TextField:Wc,PasswordField:ag,Appearance:Jt};wr.AcroForm;function N6(e){return e.reduce(function(t,r,n){return t[r]=n,t},{})}(function(e){e.__addimage__={};var t="UNKNOWN",r={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},n=e.__addimage__.getImageFileTypeByImageData=function(O,D){var R,F,z,K,J,L=t;if((D=D||t)==="RGBA"||O.data!==void 0&&O.data instanceof Uint8ClampedArray&&"height"in O&&"width"in O)return"RGBA";if(T(O))for(J in r)for(z=r[J],R=0;R<z.length;R+=1){for(K=!0,F=0;F<z[R].length;F+=1)if(z[R][F]!==void 0&&z[R][F]!==O[F]){K=!1;break}if(K===!0){L=J;break}}else for(J in r)for(z=r[J],R=0;R<z.length;R+=1){for(K=!0,F=0;F<z[R].length;F+=1)if(z[R][F]!==void 0&&z[R][F]!==O.charCodeAt(F)){K=!1;break}if(K===!0){L=J;break}}return L===t&&D!==t&&(L=D),L},a=function O(D){for(var R=this.internal.write,F=this.internal.putStream,z=(0,this.internal.getFilters)();z.indexOf("FlateEncode")!==-1;)z.splice(z.indexOf("FlateEncode"),1);D.objectId=this.internal.newObject();var K=[];if(K.push({key:"Type",value:"/XObject"}),K.push({key:"Subtype",value:"/Image"}),K.push({key:"Width",value:D.width}),K.push({key:"Height",value:D.height}),D.colorSpace===y.INDEXED?K.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(D.palette.length/3-1)+" "+("sMask"in D&&D.sMask!==void 0?D.objectId+2:D.objectId+1)+" 0 R]"}):(K.push({key:"ColorSpace",value:"/"+D.colorSpace}),D.colorSpace===y.DEVICE_CMYK&&K.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),K.push({key:"BitsPerComponent",value:D.bitsPerComponent}),"decodeParameters"in D&&D.decodeParameters!==void 0&&K.push({key:"DecodeParms",value:"<<"+D.decodeParameters+">>"}),"transparency"in D&&Array.isArray(D.transparency)){for(var J="",L=0,k=D.transparency.length;L<k;L++)J+=D.transparency[L]+" "+D.transparency[L]+" ";K.push({key:"Mask",value:"["+J+"]"})}D.sMask!==void 0&&K.push({key:"SMask",value:D.objectId+1+" 0 R"});var $=D.filter!==void 0?["/"+D.filter]:void 0;if(F({data:D.data,additionalKeyValues:K,alreadyAppliedFilters:$,objectId:D.objectId}),R("endobj"),"sMask"in D&&D.sMask!==void 0){var X="/Predictor "+D.predictor+" /Colors 1 /BitsPerComponent "+D.bitsPerComponent+" /Columns "+D.width,C={width:D.width,height:D.height,colorSpace:"DeviceGray",bitsPerComponent:D.bitsPerComponent,decodeParameters:X,data:D.sMask};"filter"in D&&(C.filter=D.filter),O.call(this,C)}if(D.colorSpace===y.INDEXED){var M=this.internal.newObject();F({data:S(new Uint8Array(D.palette)),objectId:M}),R("endobj")}},o=function(){var O=this.internal.collections.addImage_images;for(var D in O)a.call(this,O[D])},s=function(){var O,D=this.internal.collections.addImage_images,R=this.internal.write;for(var F in D)R("/I"+(O=D[F]).index,O.objectId,"0","R")},l=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",s))},c=function(){var O=this.internal.collections.addImage_images;return l.call(this),O},u=function(){return Object.keys(this.internal.collections.addImage_images).length},d=function(O){return typeof e["process"+O.toUpperCase()]=="function"},f=function(O){return gn(O)==="object"&&O.nodeType===1},h=function(O,D){if(O.nodeName==="IMG"&&O.hasAttribute("src")){var R=""+O.getAttribute("src");if(R.indexOf("data:image/")===0)return Rh(unescape(R).split("base64,").pop());var F=e.loadFile(R,!0);if(F!==void 0)return F}if(O.nodeName==="CANVAS"){if(O.width===0||O.height===0)throw new Error("Given canvas must have data. Canvas width: "+O.width+", height: "+O.height);var z;switch(D){case"PNG":z="image/png";break;case"WEBP":z="image/webp";break;case"JPEG":case"JPG":default:z="image/jpeg"}return Rh(O.toDataURL(z,1).split("base64,").pop())}},p=function(O){var D=this.internal.collections.addImage_images;if(D){for(var R in D)if(O===D[R].alias)return D[R]}},v=function(O,D,R){return O||D||(O=-96,D=-96),O<0&&(O=-1*R.width*72/O/this.internal.scaleFactor),D<0&&(D=-1*R.height*72/D/this.internal.scaleFactor),O===0&&(O=D*R.width/R.height),D===0&&(D=O*R.height/R.width),[O,D]},m=function(O,D,R,F,z,K){var J=v.call(this,R,F,z),L=this.internal.getCoordinateString,k=this.internal.getVerticalCoordinateString,$=c.call(this);if(R=J[0],F=J[1],$[z.index]=z,K){K*=Math.PI/180;var X=Math.cos(K),C=Math.sin(K),M=function(U){return U.toFixed(4)},H=[M(X),M(C),M(-1*C),M(X),0,0,"cm"]}this.internal.write("q"),K?(this.internal.write([1,"0","0",1,L(O),k(D+F),"cm"].join(" ")),this.internal.write(H.join(" ")),this.internal.write([L(R),"0","0",L(F),"0","0","cm"].join(" "))):this.internal.write([L(R),"0","0",L(F),L(O),k(D+F),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+z.index+" Do"),this.internal.write("Q")},y=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var b=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},_=e.__addimage__.sHashCode=function(O){var D,R,F=0;if(typeof O=="string")for(R=O.length,D=0;D<R;D++)F=(F<<5)-F+O.charCodeAt(D),F|=0;else if(T(O))for(R=O.byteLength/2,D=0;D<R;D++)F=(F<<5)-F+O[D],F|=0;return F},w=e.__addimage__.validateStringAsBase64=function(O){(O=O||"").toString().trim();var D=!0;return O.length===0&&(D=!1),O.length%4!=0&&(D=!1),/^[A-Za-z0-9+/]+$/.test(O.substr(0,O.length-2))===!1&&(D=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(O.substr(-2))===!1&&(D=!1),D},A=e.__addimage__.extractImageFromDataUrl=function(O){if(O==null||!(O=O.trim()).startsWith("data:"))return null;var D=O.indexOf(",");return D<0?null:O.substring(0,D).trim().endsWith("base64")?O.substring(D+1):null},P=e.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};e.__addimage__.isArrayBuffer=function(O){return P()&&O instanceof ArrayBuffer};var T=e.__addimage__.isArrayBufferView=function(O){return P()&&typeof Uint32Array<"u"&&(O instanceof Int8Array||O instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&O instanceof Uint8ClampedArray||O instanceof Int16Array||O instanceof Uint16Array||O instanceof Int32Array||O instanceof Uint32Array||O instanceof Float32Array||O instanceof Float64Array)},E=e.__addimage__.binaryStringToUint8Array=function(O){for(var D=O.length,R=new Uint8Array(D),F=0;F<D;F++)R[F]=O.charCodeAt(F);return R},S=e.__addimage__.arrayBufferToBinaryString=function(O){for(var D="",R=T(O)?O:new Uint8Array(O),F=0;F<R.length;F+=8192)D+=String.fromCharCode.apply(null,R.subarray(F,F+8192));return D};e.addImage=function(){var O,D,R,F,z,K,J,L,k;if(typeof arguments[1]=="number"?(D=t,R=arguments[1],F=arguments[2],z=arguments[3],K=arguments[4],J=arguments[5],L=arguments[6],k=arguments[7]):(D=arguments[1],R=arguments[2],F=arguments[3],z=arguments[4],K=arguments[5],J=arguments[6],L=arguments[7],k=arguments[8]),gn(O=arguments[0])==="object"&&!f(O)&&"imageData"in O){var $=O;O=$.imageData,D=$.format||D||t,R=$.x||R||0,F=$.y||F||0,z=$.w||$.width||z,K=$.h||$.height||K,J=$.alias||J,L=$.compression||L,k=$.rotation||$.angle||k}var X=this.internal.getFilters();if(L===void 0&&X.indexOf("FlateEncode")!==-1&&(L="SLOW"),isNaN(R)||isNaN(F))throw new Error("Invalid coordinates passed to jsPDF.addImage");l.call(this);var C=I.call(this,O,D,J,L);return m.call(this,R,F,z,K,C,k),this};var I=function(O,D,R,F){var z,K,J;if(typeof O=="string"&&n(O)===t){O=unescape(O);var L=W(O,!1);(L!==""||(L=e.loadFile(O,!0))!==void 0)&&(O=L)}if(f(O)&&(O=h(O,D)),D=n(O,D),!d(D))throw new Error("addImage does not support files of type '"+D+"', please ensure that a plugin for '"+D+"' support is added.");if(((J=R)==null||J.length===0)&&(R=function(k){return typeof k=="string"||T(k)?_(k):T(k.data)?_(k.data):null}(O)),(z=p.call(this,R))||(P()&&(O instanceof Uint8Array||D==="RGBA"||(K=O,O=E(O))),z=this["process"+D.toUpperCase()](O,u.call(this),R,function(k){return k&&typeof k=="string"&&(k=k.toUpperCase()),k in e.image_compression?k:b.NONE}(F),K)),!z)throw new Error("An unknown error occurred whilst processing the image.");return z},W=e.__addimage__.convertBase64ToBinaryString=function(O,D){D=typeof D!="boolean"||D;var R,F="";if(typeof O=="string"){var z;R=(z=A(O))!==null&&z!==void 0?z:O;try{F=Rh(R)}catch(K){if(D)throw w(R)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+K.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return F};e.getImageProperties=function(O){var D,R,F="";if(f(O)&&(O=h(O)),typeof O=="string"&&n(O)===t&&((F=W(O,!1))===""&&(F=e.loadFile(O)||""),O=F),R=n(O),!d(R))throw new Error("addImage does not support files of type '"+R+"', please ensure that a plugin for '"+R+"' support is added.");if(!P()||O instanceof Uint8Array||(O=E(O)),!(D=this["process"+R.toUpperCase()](O)))throw new Error("An unknown error occurred whilst processing the image");return D.fileType=R,D}})(wr.API),function(e){var t=function(r){if(r!==void 0&&r!="")return!0};wr.API.events.push(["addPage",function(r){this.internal.getPageInfo(r.pageNumber).pageContext.annotations=[]}]),e.events.push(["putPage",function(r){for(var n,a,o,s=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,c=this.internal.getPageInfoByObjId(r.objId),u=r.pageContext.annotations,d=!1,f=0;f<u.length&&!d;f++)switch((n=u[f]).type){case"link":(t(n.options.url)||t(n.options.pageNumber))&&(d=!0);break;case"reference":case"text":case"freetext":d=!0}if(d!=0){this.internal.write("/Annots [");for(var h=0;h<u.length;h++){n=u[h];var p=this.internal.pdfEscape,v=this.internal.getEncryptor(r.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var m=this.internal.newAdditionalObject(),y=this.internal.newAdditionalObject(),b=this.internal.getEncryptor(m.objId),_=n.title||"Note";o="<</Type /Annot /Subtype /Text "+(a="/Rect ["+s(n.bounds.x)+" "+l(n.bounds.y+n.bounds.h)+" "+s(n.bounds.x+n.bounds.w)+" "+l(n.bounds.y)+"] ")+"/Contents ("+p(b(n.contents))+")",o+=" /Popup "+y.objId+" 0 R",o+=" /P "+c.objId+" 0 R",o+=" /T ("+p(b(_))+") >>",m.content=o;var w=m.objId+" 0 R";o="<</Type /Annot /Subtype /Popup "+(a="/Rect ["+s(n.bounds.x+30)+" "+l(n.bounds.y+n.bounds.h)+" "+s(n.bounds.x+n.bounds.w+30)+" "+l(n.bounds.y)+"] ")+" /Parent "+w,n.open&&(o+=" /Open true"),o+=" >>",y.content=o,this.internal.write(m.objId,"0 R",y.objId,"0 R");break;case"freetext":a="/Rect ["+s(n.bounds.x)+" "+l(n.bounds.y)+" "+s(n.bounds.x+n.bounds.w)+" "+l(n.bounds.y+n.bounds.h)+"] ";var A=n.color||"#000000";o="<</Type /Annot /Subtype /FreeText "+a+"/Contents ("+p(v(n.contents))+")",o+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+A+")",o+=" /Border [0 0 0]",o+=" >>",this.internal.write(o);break;case"link":if(n.options.name){var P=this.annotations._nameMap[n.options.name];n.options.pageNumber=P.page,n.options.top=P.y}else n.options.top||(n.options.top=0);if(a="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",o="",n.options.url)o="<</Type /Annot /Subtype /Link "+a+"/Border [0 0 0] /A <</S /URI /URI ("+p(v(n.options.url))+") >>";else if(n.options.pageNumber)switch(o="<</Type /Annot /Subtype /Link "+a+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":o+=" /Fit]";break;case"FitH":o+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,o+=" /FitV "+n.options.left+"]";break;case"XYZ":default:var T=l(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),o+=" /XYZ "+n.options.left+" "+T+" "+n.options.zoom+"]"}o!=""&&(o+=" >>",this.internal.write(o))}}this.internal.write("]")}}]),e.createAnnotation=function(r){var n=this.internal.getCurrentPageInfo();switch(r.type){case"link":this.link(r.bounds.x,r.bounds.y,r.bounds.w,r.bounds.h,r);break;case"text":case"freetext":n.pageContext.annotations.push(r)}},e.link=function(r,n,a,o,s){var l=this.internal.getCurrentPageInfo(),c=this.internal.getCoordinateString,u=this.internal.getVerticalCoordinateString;l.pageContext.annotations.push({finalBounds:{x:c(r),y:u(n),w:c(r+a),h:u(n+o)},options:s,type:"link"})},e.textWithLink=function(r,n,a,o){var s,l,c=this.getTextWidth(r),u=this.internal.getLineHeight()/this.internal.scaleFactor;if(o.maxWidth!==void 0){l=o.maxWidth;var d=this.splitTextToSize(r,l).length;s=Math.ceil(u*d)}else l=c,s=u;return this.text(r,n,a,o),a+=.2*u,o.align==="center"&&(n-=c/2),o.align==="right"&&(n-=c),this.link(n,a-u,l,s,o),c},e.getTextWidth=function(r){var n=this.internal.getFontSize();return this.getStringUnitWidth(r)*n/this.internal.scaleFactor}}(wr.API),function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},r={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},a=[1570,1571,1573,1575];e.__arabicParser__={};var o=e.__arabicParser__.isInArabicSubstitutionA=function(m){return t[m.charCodeAt(0)]!==void 0},s=e.__arabicParser__.isArabicLetter=function(m){return typeof m=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(m)},l=e.__arabicParser__.isArabicEndLetter=function(m){return s(m)&&o(m)&&t[m.charCodeAt(0)].length<=2},c=e.__arabicParser__.isArabicAlfLetter=function(m){return s(m)&&a.indexOf(m.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(m){return s(m)&&o(m)&&t[m.charCodeAt(0)].length>=1};var u=e.__arabicParser__.arabicLetterHasFinalForm=function(m){return s(m)&&o(m)&&t[m.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(m){return s(m)&&o(m)&&t[m.charCodeAt(0)].length>=3};var d=e.__arabicParser__.arabicLetterHasMedialForm=function(m){return s(m)&&o(m)&&t[m.charCodeAt(0)].length==4},f=e.__arabicParser__.resolveLigatures=function(m){var y=0,b=r,_="",w=0;for(y=0;y<m.length;y+=1)b[m.charCodeAt(y)]!==void 0?(w++,typeof(b=b[m.charCodeAt(y)])=="number"&&(_+=String.fromCharCode(b),b=r,w=0),y===m.length-1&&(b=r,_+=m.charAt(y-(w-1)),y-=w-1,w=0)):(b=r,_+=m.charAt(y-w),y-=w,w=0);return _};e.__arabicParser__.isArabicDiacritic=function(m){return m!==void 0&&n[m.charCodeAt(0)]!==void 0};var h=e.__arabicParser__.getCorrectForm=function(m,y,b){return s(m)?o(m)===!1?-1:!u(m)||!s(y)&&!s(b)||!s(b)&&l(y)||l(m)&&!s(y)||l(m)&&c(y)||l(m)&&l(y)?0:d(m)&&s(y)&&!l(y)&&s(b)&&u(b)?3:l(m)||!s(b)?1:2:-1},p=function(m){var y=0,b=0,_=0,w="",A="",P="",T=(m=m||"").split("\\s+"),E=[];for(y=0;y<T.length;y+=1){for(E.push(""),b=0;b<T[y].length;b+=1)w=T[y][b],A=T[y][b-1],P=T[y][b+1],s(w)?(_=h(w,A,P),E[y]+=_!==-1?String.fromCharCode(t[w.charCodeAt(0)][_]):w):E[y]+=w;E[y]=f(E[y])}return E.join(" ")},v=e.__arabicParser__.processArabic=e.processArabic=function(){var m,y=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,b=[];if(Array.isArray(y)){var _=0;for(b=[],_=0;_<y.length;_+=1)Array.isArray(y[_])?b.push([p(y[_][0]),y[_][1],y[_][2]]):b.push([p(y[_])]);m=b}else m=p(y);return typeof arguments[0]=="string"?m:(arguments[0].text=m,arguments[0])};e.events.push(["preProcessText",v])}(wr.API),wr.API.autoPrint=function(e){var t;switch((e=e||{}).variant=e.variant||"non-conform",e.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})}return this},function(e){var t=function(){var r=void 0;Object.defineProperty(this,"pdf",{get:function(){return r},set:function(l){r=l}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(l){n=isNaN(l)||Number.isInteger(l)===!1||l<0?150:l,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var a=300;Object.defineProperty(this,"height",{get:function(){return a},set:function(l){a=isNaN(l)||Number.isInteger(l)===!1||l<0?300:l,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=a+1)}});var o=[];Object.defineProperty(this,"childNodes",{get:function(){return o},set:function(l){o=l}});var s={};Object.defineProperty(this,"style",{get:function(){return s},set:function(l){s=l}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(r,n){var a;if((r=r||"2d")!=="2d")return null;for(a in n)this.pdf.context2d.hasOwnProperty(a)&&(this.pdf.context2d[a]=n[a]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(wr.API),function(e){var t={left:0,top:0,bottom:0,right:0},r=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),a.call(this))},a=function(){this.internal.__cell__.lastCell=new o,this.internal.__cell__.pages=1},o=function(){var c=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return c},set:function(m){c=m}});var u=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return u},set:function(m){u=m}});var d=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return d},set:function(m){d=m}});var f=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return f},set:function(m){f=m}});var h=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return h},set:function(m){h=m}});var p=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return p},set:function(m){p=m}});var v=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return v},set:function(m){v=m}}),this};o.prototype.clone=function(){return new o(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},o.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(c){return n.call(this),this.internal.__cell__.headerFunction=typeof c=="function"?c:void 0,this},e.getTextDimensions=function(c,u){n.call(this);var d=(u=u||{}).fontSize||this.getFontSize(),f=u.font||this.getFont(),h=u.scaleFactor||this.internal.scaleFactor,p=0,v=0,m=0,y=this;if(!Array.isArray(c)&&typeof c!="string"){if(typeof c!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");c=String(c)}var b=u.maxWidth;b>0?typeof c=="string"?c=this.splitTextToSize(c,b):Object.prototype.toString.call(c)==="[object Array]"&&(c=c.reduce(function(w,A){return w.concat(y.splitTextToSize(A,b))},[])):c=Array.isArray(c)?c:[c];for(var _=0;_<c.length;_++)p<(m=this.getStringUnitWidth(c[_],{font:f})*d)&&(p=m);return p!==0&&(v=c.length),{w:p/=h,h:Math.max((v*d*this.getLineHeightFactor()-d*(this.getLineHeightFactor()-1))/h,0)}},e.cellAddPage=function(){n.call(this),this.addPage();var c=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new o(c.left,c.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var s=e.cell=function(){var c;c=arguments[0]instanceof o?arguments[0]:new o(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var u=this.internal.__cell__.lastCell,d=this.internal.__cell__.padding,f=this.internal.__cell__.margins||t,h=this.internal.__cell__.tableHeaderRow,p=this.internal.__cell__.printHeaders;return u.lineNumber!==void 0&&(u.lineNumber===c.lineNumber?(c.x=(u.x||0)+(u.width||0),c.y=u.y||0):u.y+u.height+c.height+f.bottom>this.getPageHeight()?(this.cellAddPage(),c.y=f.top,p&&h&&(this.printHeaderRow(c.lineNumber,!0),c.y+=h[0].height)):c.y=u.y+u.height||c.y),c.text[0]!==void 0&&(this.rect(c.x,c.y,c.width,c.height,r===!0?"FD":void 0),c.align==="right"?this.text(c.text,c.x+c.width-d,c.y+d,{align:"right",baseline:"top"}):c.align==="center"?this.text(c.text,c.x+c.width/2,c.y+d,{align:"center",baseline:"top",maxWidth:c.width-d-d}):this.text(c.text,c.x+d,c.y+d,{align:"left",baseline:"top",maxWidth:c.width-d-d})),this.internal.__cell__.lastCell=c,this};e.table=function(c,u,d,f,h){if(n.call(this),!d)throw new Error("No data for PDF table.");var p,v,m,y,b=[],_=[],w=[],A={},P={},T=[],E=[],S=(h=h||{}).autoSize||!1,I=h.printHeaders!==!1,W=h.css&&h.css["font-size"]!==void 0?16*h.css["font-size"]:h.fontSize||12,O=h.margins||Object.assign({width:this.getPageWidth()},t),D=typeof h.padding=="number"?h.padding:3,R=h.headerBackgroundColor||"#c8c8c8",F=h.headerTextColor||"#000";if(a.call(this),this.internal.__cell__.printHeaders=I,this.internal.__cell__.margins=O,this.internal.__cell__.table_font_size=W,this.internal.__cell__.padding=D,this.internal.__cell__.headerBackgroundColor=R,this.internal.__cell__.headerTextColor=F,this.setFontSize(W),f==null)_=b=Object.keys(d[0]),w=b.map(function(){return"left"});else if(Array.isArray(f)&&gn(f[0])==="object")for(b=f.map(function($){return $.name}),_=f.map(function($){return $.prompt||$.name||""}),w=f.map(function($){return $.align||"left"}),p=0;p<f.length;p+=1)P[f[p].name]=f[p].width*(19.049976/25.4);else Array.isArray(f)&&typeof f[0]=="string"&&(_=b=f,w=b.map(function(){return"left"}));if(S||Array.isArray(f)&&typeof f[0]=="string")for(p=0;p<b.length;p+=1){for(A[y=b[p]]=d.map(function($){return $[y]}),this.setFont(void 0,"bold"),T.push(this.getTextDimensions(_[p],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),v=A[y],this.setFont(void 0,"normal"),m=0;m<v.length;m+=1)T.push(this.getTextDimensions(v[m],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);P[y]=Math.max.apply(null,T)+D+D,T=[]}if(I){var z={};for(p=0;p<b.length;p+=1)z[b[p]]={},z[b[p]].text=_[p],z[b[p]].align=w[p];var K=l.call(this,z,P);E=b.map(function($){return new o(c,u,P[$],K,z[$].text,void 0,z[$].align)}),this.setTableHeaderRow(E),this.printHeaderRow(1,!1)}var J=f.reduce(function($,X){return $[X.name]=X.align,$},{});for(p=0;p<d.length;p+=1){"rowStart"in h&&h.rowStart instanceof Function&&h.rowStart({row:p,data:d[p]},this);var L=l.call(this,d[p],P);for(m=0;m<b.length;m+=1){var k=d[p][b[m]];"cellStart"in h&&h.cellStart instanceof Function&&h.cellStart({row:p,col:m,data:k},this),s.call(this,new o(c,u,P[b[m]],L,k,p+2,J[b[m]]))}}return this.internal.__cell__.table_x=c,this.internal.__cell__.table_y=u,this};var l=function(c,u){var d=this.internal.__cell__.padding,f=this.internal.__cell__.table_font_size,h=this.internal.scaleFactor;return Object.keys(c).map(function(p){var v=c[p];return this.splitTextToSize(v.hasOwnProperty("text")?v.text:v,u[p]-d-d)},this).map(function(p){return this.getLineHeightFactor()*p.length*f/h+d+d},this).reduce(function(p,v){return Math.max(p,v)},0)};e.setTableHeaderRow=function(c){n.call(this),this.internal.__cell__.tableHeaderRow=c},e.printHeaderRow=function(c,u){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var d;if(r=!0,typeof this.internal.__cell__.headerFunction=="function"){var f=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new o(f[0],f[1],f[2],f[3],void 0,-1)}this.setFont(void 0,"bold");for(var h=[],p=0;p<this.internal.__cell__.tableHeaderRow.length;p+=1){d=this.internal.__cell__.tableHeaderRow[p].clone(),u&&(d.y=this.internal.__cell__.margins.top||0,h.push(d)),d.lineNumber=c;var v=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),s.call(this,d),this.setTextColor(v)}h.length>0&&this.setTableHeaderRow(h),this.setFont(void 0,"normal"),r=!1}}(wr.API);var D6={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},M6=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],Dw=N6(M6),L6=[100,200,300,400,500,600,700,800,900],ece=N6(L6);function Mw(e){var t=e.family.replace(/"|'/g,"").toLowerCase(),r=function(o){return D6[o=o||"normal"]?o:"normal"}(e.style),n=function(o){if(!o)return 400;if(typeof o=="number")return o>=100&&o<=900&&o%100==0?o:400;if(/^\d00$/.test(o))return parseInt(o);switch(o){case"bold":return 700;case"normal":default:return 400}}(e.weight),a=function(o){return typeof Dw[o=o||"normal"]=="number"?o:"normal"}(e.stretch);return{family:t,style:r,weight:n,stretch:a,src:e.src||[],ref:e.ref||{name:t,style:[a,r,n].join(" ")}}}function G4(e,t,r,n){var a;for(a=r;a>=0&&a<t.length;a+=n)if(e[t[a]])return e[t[a]];for(a=r;a>=0&&a<t.length;a-=n)if(e[t[a]])return e[t[a]]}var tce={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},Y4={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function K4(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function rce(e,t,r){for(var n=(r=r||{}).defaultFontFamily||"times",a=Object.assign({},tce,r.genericFontFamilies||{}),o=null,s=null,l=0;l<t.length;++l)if(a[(o=Mw(t[l])).family]&&(o.family=a[o.family]),e.hasOwnProperty(o.family)){s=e[o.family];break}if(!(s=s||e[n]))throw new Error("Could not find a font-family for the rule '"+K4(o)+"' and default family '"+n+"'.");if(s=function(c,u){if(u[c])return u[c];var d=Dw[c],f=d<=Dw.normal?-1:1,h=G4(u,M6,d,f);if(!h)throw new Error("Could not find a matching font-stretch value for "+c);return h}(o.stretch,s),s=function(c,u){if(u[c])return u[c];for(var d=D6[c],f=0;f<d.length;++f)if(u[d[f]])return u[d[f]];throw new Error("Could not find a matching font-style for "+c)}(o.style,s),!(s=function(c,u){if(u[c])return u[c];if(c===400&&u[500])return u[500];if(c===500&&u[400])return u[400];var d=ece[c],f=G4(u,L6,d,c<400?-1:1);if(!f)throw new Error("Could not find a matching font-weight for value "+c);return f}(o.weight,s)))throw new Error("Failed to resolve a font for the rule '"+K4(o)+"'.");return s}function Q4(e){return e.trimLeft()}function nce(e,t){for(var r=0;r<e.length;){if(e.charAt(r)===t)return[e.substring(0,r),e.substring(r+1)];r+=1}return null}function ace(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],e.substring(t[0].length)]}var Lm,X4,J4,A2=["times"];(function(e){var t,r,n,a,o,s,l,c,u,d=function(C){return C=C||{},this.isStrokeTransparent=C.isStrokeTransparent||!1,this.strokeOpacity=C.strokeOpacity||1,this.strokeStyle=C.strokeStyle||"#000000",this.fillStyle=C.fillStyle||"#000000",this.isFillTransparent=C.isFillTransparent||!1,this.fillOpacity=C.fillOpacity||1,this.font=C.font||"10px sans-serif",this.textBaseline=C.textBaseline||"alphabetic",this.textAlign=C.textAlign||"left",this.lineWidth=C.lineWidth||1,this.lineJoin=C.lineJoin||"miter",this.lineCap=C.lineCap||"butt",this.path=C.path||[],this.transform=C.transform!==void 0?C.transform.clone():new c,this.globalCompositeOperation=C.globalCompositeOperation||"normal",this.globalAlpha=C.globalAlpha||1,this.clip_path=C.clip_path||[],this.currentPoint=C.currentPoint||new s,this.miterLimit=C.miterLimit||10,this.lastPoint=C.lastPoint||new s,this.lineDashOffset=C.lineDashOffset||0,this.lineDash=C.lineDash||[],this.margin=C.margin||[0,0,0,0],this.prevPageLastElemOffset=C.prevPageLastElemOffset||0,this.ignoreClearRect=typeof C.ignoreClearRect!="boolean"||C.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new f(this),t=this.internal.f2,r=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,a=this.internal.getHorizontalCoordinate,o=this.internal.getVerticalCoordinate,s=this.internal.Point,l=this.internal.Rectangle,c=this.internal.Matrix,u=new d}]);var f=function(C){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var M=C;Object.defineProperty(this,"pdf",{get:function(){return M}});var H=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return H},set:function(se){H=!!se}});var U=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return U},set:function(se){U=!!se}});var te=0;Object.defineProperty(this,"posX",{get:function(){return te},set:function(se){isNaN(se)||(te=se)}});var le=0;Object.defineProperty(this,"posY",{get:function(){return le},set:function(se){isNaN(se)||(le=se)}}),Object.defineProperty(this,"margin",{get:function(){return u.margin},set:function(se){var V;typeof se=="number"?V=[se,se,se,se]:((V=new Array(4))[0]=se[0],V[1]=se.length>=2?se[1]:V[0],V[2]=se.length>=3?se[2]:V[0],V[3]=se.length>=4?se[3]:V[1]),u.margin=V}});var oe=!1;Object.defineProperty(this,"autoPaging",{get:function(){return oe},set:function(se){oe=se}});var ae=0;Object.defineProperty(this,"lastBreak",{get:function(){return ae},set:function(se){ae=se}});var he=[];Object.defineProperty(this,"pageBreaks",{get:function(){return he},set:function(se){he=se}}),Object.defineProperty(this,"ctx",{get:function(){return u},set:function(se){se instanceof d&&(u=se)}}),Object.defineProperty(this,"path",{get:function(){return u.path},set:function(se){u.path=se}});var me=[];Object.defineProperty(this,"ctxStack",{get:function(){return me},set:function(se){me=se}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(se){var V;V=h(se),this.ctx.fillStyle=V.style,this.ctx.isFillTransparent=V.a===0,this.ctx.fillOpacity=V.a,this.pdf.setFillColor(V.r,V.g,V.b,{a:V.a}),this.pdf.setTextColor(V.r,V.g,V.b,{a:V.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(se){var V=h(se);this.ctx.strokeStyle=V.style,this.ctx.isStrokeTransparent=V.a===0,this.ctx.strokeOpacity=V.a,V.a===0?this.pdf.setDrawColor(255,255,255):(V.a,this.pdf.setDrawColor(V.r,V.g,V.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(se){["butt","round","square"].indexOf(se)!==-1&&(this.ctx.lineCap=se,this.pdf.setLineCap(se))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(se){isNaN(se)||(this.ctx.lineWidth=se,this.pdf.setLineWidth(se))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(se){["bevel","round","miter"].indexOf(se)!==-1&&(this.ctx.lineJoin=se,this.pdf.setLineJoin(se))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(se){isNaN(se)||(this.ctx.miterLimit=se,this.pdf.setMiterLimit(se))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(se){this.ctx.textBaseline=se}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(se){["right","end","center","left","start"].indexOf(se)!==-1&&(this.ctx.textAlign=se)}});var Q=null;function G(se,V){if(Q===null){var Ge=function(De){var Fe=[];return Object.keys(De).forEach(function(Xe){De[Xe].forEach(function(it){var lt=null;switch(it){case"bold":lt={family:Xe,weight:"bold"};break;case"italic":lt={family:Xe,style:"italic"};break;case"bolditalic":lt={family:Xe,weight:"bold",style:"italic"};break;case"":case"normal":lt={family:Xe}}lt!==null&&(lt.ref={name:Xe,style:it},Fe.push(lt))})}),Fe}(se.getFontList());Q=function(De){for(var Fe={},Xe=0;Xe<De.length;++Xe){var it=Mw(De[Xe]),lt=it.family,vt=it.stretch,Ye=it.style,Ze=it.weight;Fe[lt]=Fe[lt]||{},Fe[lt][vt]=Fe[lt][vt]||{},Fe[lt][vt][Ye]=Fe[lt][vt][Ye]||{},Fe[lt][vt][Ye][Ze]=it}return Fe}(Ge.concat(V))}return Q}var ee=null;Object.defineProperty(this,"fontFaces",{get:function(){return ee},set:function(se){Q=null,ee=se}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(se){var V;if(this.ctx.font=se,(V=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(se))!==null){var Ge=V[1];V[2];var De=V[3],Fe=V[4];V[5];var Xe=V[6],it=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Fe)[2];Fe=Math.floor(it==="px"?parseFloat(Fe)*this.pdf.internal.scaleFactor:it==="em"?parseFloat(Fe)*this.pdf.getFontSize():parseFloat(Fe)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Fe);var lt=function(kt){var Wt,jt,ur=[],$e=kt.trim();if($e==="")return A2;if($e in Y4)return[Y4[$e]];for(;$e!=="";){switch(jt=null,Wt=($e=Q4($e)).charAt(0)){case'"':case"'":jt=nce($e.substring(1),Wt);break;default:jt=ace($e)}if(jt===null||(ur.push(jt[0]),($e=Q4(jt[1]))!==""&&$e.charAt(0)!==","))return A2;$e=$e.replace(/^,/,"")}return ur}(Xe);if(this.fontFaces){var vt=rce(G(this.pdf,this.fontFaces),lt.map(function(kt){return{family:kt,stretch:"normal",weight:De,style:Ge}}));this.pdf.setFont(vt.ref.name,vt.ref.style)}else{var Ye="";(De==="bold"||parseInt(De,10)>=700||Ge==="bold")&&(Ye="bold"),Ge==="italic"&&(Ye+="italic"),Ye.length===0&&(Ye="normal");for(var Ze="",We={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},wt=0;wt<lt.length;wt++){if(this.pdf.internal.getFont(lt[wt],Ye,{noFallback:!0,disableWarning:!0})!==void 0){Ze=lt[wt];break}if(Ye==="bolditalic"&&this.pdf.internal.getFont(lt[wt],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Ze=lt[wt],Ye="bold";else if(this.pdf.internal.getFont(lt[wt],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Ze=lt[wt],Ye="normal";break}}if(Ze===""){for(var Nt=0;Nt<lt.length;Nt++)if(We[lt[Nt]]){Ze=We[lt[Nt]];break}}Ze=Ze===""?"Times":Ze,this.pdf.setFont(Ze,Ye)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(se){this.ctx.globalCompositeOperation=se}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(se){this.ctx.globalAlpha=se}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(se){this.ctx.lineDashOffset=se,X.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(se){this.ctx.lineDash=se,X.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(se){this.ctx.ignoreClearRect=!!se}})};f.prototype.setLineDash=function(C){this.lineDash=C},f.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},f.prototype.fill=function(){A.call(this,"fill",!1)},f.prototype.stroke=function(){A.call(this,"stroke",!1)},f.prototype.beginPath=function(){this.path=[{type:"begin"}]},f.prototype.moveTo=function(C,M){if(isNaN(C)||isNaN(M))throw On.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var H=this.ctx.transform.applyToPoint(new s(C,M));this.path.push({type:"mt",x:H.x,y:H.y}),this.ctx.lastPoint=new s(C,M)},f.prototype.closePath=function(){var C=new s(0,0),M=0;for(M=this.path.length-1;M!==-1;M--)if(this.path[M].type==="begin"&&gn(this.path[M+1])==="object"&&typeof this.path[M+1].x=="number"){C=new s(this.path[M+1].x,this.path[M+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new s(C.x,C.y)},f.prototype.lineTo=function(C,M){if(isNaN(C)||isNaN(M))throw On.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var H=this.ctx.transform.applyToPoint(new s(C,M));this.path.push({type:"lt",x:H.x,y:H.y}),this.ctx.lastPoint=new s(H.x,H.y)},f.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),A.call(this,null,!0)},f.prototype.quadraticCurveTo=function(C,M,H,U){if(isNaN(H)||isNaN(U)||isNaN(C)||isNaN(M))throw On.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var te=this.ctx.transform.applyToPoint(new s(H,U)),le=this.ctx.transform.applyToPoint(new s(C,M));this.path.push({type:"qct",x1:le.x,y1:le.y,x:te.x,y:te.y}),this.ctx.lastPoint=new s(te.x,te.y)},f.prototype.bezierCurveTo=function(C,M,H,U,te,le){if(isNaN(te)||isNaN(le)||isNaN(C)||isNaN(M)||isNaN(H)||isNaN(U))throw On.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var oe=this.ctx.transform.applyToPoint(new s(te,le)),ae=this.ctx.transform.applyToPoint(new s(C,M)),he=this.ctx.transform.applyToPoint(new s(H,U));this.path.push({type:"bct",x1:ae.x,y1:ae.y,x2:he.x,y2:he.y,x:oe.x,y:oe.y}),this.ctx.lastPoint=new s(oe.x,oe.y)},f.prototype.arc=function(C,M,H,U,te,le){if(isNaN(C)||isNaN(M)||isNaN(H)||isNaN(U)||isNaN(te))throw On.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(le=!!le,!this.ctx.transform.isIdentity){var oe=this.ctx.transform.applyToPoint(new s(C,M));C=oe.x,M=oe.y;var ae=this.ctx.transform.applyToPoint(new s(0,H)),he=this.ctx.transform.applyToPoint(new s(0,0));H=Math.sqrt(Math.pow(ae.x-he.x,2)+Math.pow(ae.y-he.y,2))}Math.abs(te-U)>=2*Math.PI&&(U=0,te=2*Math.PI),this.path.push({type:"arc",x:C,y:M,radius:H,startAngle:U,endAngle:te,counterclockwise:le})},f.prototype.arcTo=function(C,M,H,U,te){throw new Error("arcTo not implemented.")},f.prototype.rect=function(C,M,H,U){if(isNaN(C)||isNaN(M)||isNaN(H)||isNaN(U))throw On.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(C,M),this.lineTo(C+H,M),this.lineTo(C+H,M+U),this.lineTo(C,M+U),this.lineTo(C,M),this.lineTo(C+H,M),this.lineTo(C,M)},f.prototype.fillRect=function(C,M,H,U){if(isNaN(C)||isNaN(M)||isNaN(H)||isNaN(U))throw On.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!p.call(this)){var te={};this.lineCap!=="butt"&&(te.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(te.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(C,M,H,U),this.fill(),te.hasOwnProperty("lineCap")&&(this.lineCap=te.lineCap),te.hasOwnProperty("lineJoin")&&(this.lineJoin=te.lineJoin)}},f.prototype.strokeRect=function(C,M,H,U){if(isNaN(C)||isNaN(M)||isNaN(H)||isNaN(U))throw On.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");v.call(this)||(this.beginPath(),this.rect(C,M,H,U),this.stroke())},f.prototype.clearRect=function(C,M,H,U){if(isNaN(C)||isNaN(M)||isNaN(H)||isNaN(U))throw On.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(C,M,H,U))},f.prototype.save=function(C){C=typeof C!="boolean"||C;for(var M=this.pdf.internal.getCurrentPageInfo().pageNumber,H=0;H<this.pdf.internal.getNumberOfPages();H++)this.pdf.setPage(H+1),this.pdf.internal.out("q");if(this.pdf.setPage(M),C){this.ctx.fontSize=this.pdf.internal.getFontSize();var U=new d(this.ctx);this.ctxStack.push(this.ctx),this.ctx=U}},f.prototype.restore=function(C){C=typeof C!="boolean"||C;for(var M=this.pdf.internal.getCurrentPageInfo().pageNumber,H=0;H<this.pdf.internal.getNumberOfPages();H++)this.pdf.setPage(H+1),this.pdf.internal.out("Q");this.pdf.setPage(M),C&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},f.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var h=function(C){var M,H,U,te;if(C.isCanvasGradient===!0&&(C=C.getColor()),!C)return{r:0,g:0,b:0,a:0,style:C};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(C))M=0,H=0,U=0,te=0;else{var le=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(C);if(le!==null)M=parseInt(le[1]),H=parseInt(le[2]),U=parseInt(le[3]),te=1;else if((le=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(C))!==null)M=parseInt(le[1]),H=parseInt(le[2]),U=parseInt(le[3]),te=parseFloat(le[4]);else{if(te=1,typeof C=="string"&&C.charAt(0)!=="#"){var oe=new P6(C);C=oe.ok?oe.toHex():"#000000"}C.length===4?(M=C.substring(1,2),M+=M,H=C.substring(2,3),H+=H,U=C.substring(3,4),U+=U):(M=C.substring(1,3),H=C.substring(3,5),U=C.substring(5,7)),M=parseInt(M,16),H=parseInt(H,16),U=parseInt(U,16)}}return{r:M,g:H,b:U,a:te,style:C}},p=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},v=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};f.prototype.fillText=function(C,M,H,U){if(isNaN(M)||isNaN(H)||typeof C!="string")throw On.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(U=isNaN(U)?void 0:U,!p.call(this)){var te=L(this.ctx.transform.rotation),le=this.ctx.transform.scaleX;D.call(this,{text:C,x:M,y:H,scale:le,angle:te,align:this.textAlign,maxWidth:U})}},f.prototype.strokeText=function(C,M,H,U){if(isNaN(M)||isNaN(H)||typeof C!="string")throw On.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!v.call(this)){U=isNaN(U)?void 0:U;var te=L(this.ctx.transform.rotation),le=this.ctx.transform.scaleX;D.call(this,{text:C,x:M,y:H,scale:le,renderingMode:"stroke",angle:te,align:this.textAlign,maxWidth:U})}},f.prototype.measureText=function(C){if(typeof C!="string")throw On.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var M=this.pdf,H=this.pdf.internal.scaleFactor,U=M.internal.getFontSize(),te=M.getStringUnitWidth(C)*U/M.internal.scaleFactor,le=function(oe){var ae=(oe=oe||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return ae}}),this};return new le({width:te*=Math.round(96*H/72*1e4)/1e4})},f.prototype.scale=function(C,M){if(isNaN(C)||isNaN(M))throw On.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var H=new c(C,0,0,M,0,0);this.ctx.transform=this.ctx.transform.multiply(H)},f.prototype.rotate=function(C){if(isNaN(C))throw On.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var M=new c(Math.cos(C),Math.sin(C),-Math.sin(C),Math.cos(C),0,0);this.ctx.transform=this.ctx.transform.multiply(M)},f.prototype.translate=function(C,M){if(isNaN(C)||isNaN(M))throw On.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var H=new c(1,0,0,1,C,M);this.ctx.transform=this.ctx.transform.multiply(H)},f.prototype.transform=function(C,M,H,U,te,le){if(isNaN(C)||isNaN(M)||isNaN(H)||isNaN(U)||isNaN(te)||isNaN(le))throw On.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var oe=new c(C,M,H,U,te,le);this.ctx.transform=this.ctx.transform.multiply(oe)},f.prototype.setTransform=function(C,M,H,U,te,le){C=isNaN(C)?1:C,M=isNaN(M)?0:M,H=isNaN(H)?0:H,U=isNaN(U)?1:U,te=isNaN(te)?0:te,le=isNaN(le)?0:le,this.ctx.transform=new c(C,M,H,U,te,le)};var m=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};f.prototype.drawImage=function(C,M,H,U,te,le,oe,ae,he){var me=this.pdf.getImageProperties(C),Q=1,G=1,ee=1,se=1;U!==void 0&&ae!==void 0&&(ee=ae/U,se=he/te,Q=me.width/U*ae/U,G=me.height/te*he/te),le===void 0&&(le=M,oe=H,M=0,H=0),U!==void 0&&ae===void 0&&(ae=U,he=te),U===void 0&&ae===void 0&&(ae=me.width,he=me.height);for(var V,Ge=this.ctx.transform.decompose(),De=L(Ge.rotate.shx),Fe=new c,Xe=(Fe=(Fe=(Fe=Fe.multiply(Ge.translate)).multiply(Ge.skew)).multiply(Ge.scale)).applyToRectangle(new l(le-M*ee,oe-H*se,U*Q,te*G)),it=y.call(this,Xe),lt=[],vt=0;vt<it.length;vt+=1)lt.indexOf(it[vt])===-1&&lt.push(it[vt]);if(w(lt),this.autoPaging)for(var Ye=lt[0],Ze=lt[lt.length-1],We=Ye;We<Ze+1;We++){this.pdf.setPage(We);var wt=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Nt=We===1?this.posY+this.margin[0]:this.margin[0],kt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Wt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],jt=We===1?0:kt+(We-2)*Wt;if(this.ctx.clip_path.length!==0){var ur=this.path;V=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=_(V,this.posX+this.margin[3],-jt+Nt+this.ctx.prevPageLastElemOffset),P.call(this,"fill",!0),this.path=ur}var $e=JSON.parse(JSON.stringify(Xe));$e=_([$e],this.posX+this.margin[3],-jt+Nt+this.ctx.prevPageLastElemOffset)[0];var He=(We>Ye||We<Ze)&&m.call(this);He&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],wt,Wt,null).clip().discardPath()),this.pdf.addImage(C,"JPEG",$e.x,$e.y,$e.w,$e.h,null,null,De),He&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(C,"JPEG",Xe.x,Xe.y,Xe.w,Xe.h,null,null,De)};var y=function(C,M,H){var U=[];M=M||this.pdf.internal.pageSize.width,H=H||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var te=this.posY+this.ctx.prevPageLastElemOffset;switch(C.type){default:case"mt":case"lt":U.push(Math.floor((C.y+te)/H)+1);break;case"arc":U.push(Math.floor((C.y+te-C.radius)/H)+1),U.push(Math.floor((C.y+te+C.radius)/H)+1);break;case"qct":var le=k(this.ctx.lastPoint.x,this.ctx.lastPoint.y,C.x1,C.y1,C.x,C.y);U.push(Math.floor((le.y+te)/H)+1),U.push(Math.floor((le.y+le.h+te)/H)+1);break;case"bct":var oe=$(this.ctx.lastPoint.x,this.ctx.lastPoint.y,C.x1,C.y1,C.x2,C.y2,C.x,C.y);U.push(Math.floor((oe.y+te)/H)+1),U.push(Math.floor((oe.y+oe.h+te)/H)+1);break;case"rect":U.push(Math.floor((C.y+te)/H)+1),U.push(Math.floor((C.y+C.h+te)/H)+1)}for(var ae=0;ae<U.length;ae+=1)for(;this.pdf.internal.getNumberOfPages()<U[ae];)b.call(this);return U},b=function(){var C=this.fillStyle,M=this.strokeStyle,H=this.font,U=this.lineCap,te=this.lineWidth,le=this.lineJoin;this.pdf.addPage(),this.fillStyle=C,this.strokeStyle=M,this.font=H,this.lineCap=U,this.lineWidth=te,this.lineJoin=le},_=function(C,M,H){for(var U=0;U<C.length;U++)switch(C[U].type){case"bct":C[U].x2+=M,C[U].y2+=H;case"qct":C[U].x1+=M,C[U].y1+=H;case"mt":case"lt":case"arc":default:C[U].x+=M,C[U].y+=H}return C},w=function(C){return C.sort(function(M,H){return M-H})},A=function(C,M){for(var H,U,te=this.fillStyle,le=this.strokeStyle,oe=this.lineCap,ae=this.lineWidth,he=Math.abs(ae*this.ctx.transform.scaleX),me=this.lineJoin,Q=JSON.parse(JSON.stringify(this.path)),G=JSON.parse(JSON.stringify(this.path)),ee=[],se=0;se<G.length;se++)if(G[se].x!==void 0)for(var V=y.call(this,G[se]),Ge=0;Ge<V.length;Ge+=1)ee.indexOf(V[Ge])===-1&&ee.push(V[Ge]);for(var De=0;De<ee.length;De++)for(;this.pdf.internal.getNumberOfPages()<ee[De];)b.call(this);if(w(ee),this.autoPaging)for(var Fe=ee[0],Xe=ee[ee.length-1],it=Fe;it<Xe+1;it++){this.pdf.setPage(it),this.fillStyle=te,this.strokeStyle=le,this.lineCap=oe,this.lineWidth=he,this.lineJoin=me;var lt=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],vt=it===1?this.posY+this.margin[0]:this.margin[0],Ye=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ze=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],We=it===1?0:Ye+(it-2)*Ze;if(this.ctx.clip_path.length!==0){var wt=this.path;H=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=_(H,this.posX+this.margin[3],-We+vt+this.ctx.prevPageLastElemOffset),P.call(this,C,!0),this.path=wt}if(U=JSON.parse(JSON.stringify(Q)),this.path=_(U,this.posX+this.margin[3],-We+vt+this.ctx.prevPageLastElemOffset),M===!1||it===0){var Nt=(it>Fe||it<Xe)&&m.call(this);Nt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],lt,Ze,null).clip().discardPath()),P.call(this,C,M),Nt&&this.pdf.restoreGraphicsState()}this.lineWidth=ae}else this.lineWidth=he,P.call(this,C,M),this.lineWidth=ae;this.path=Q},P=function(C,M){if((C!=="stroke"||M||!v.call(this))&&(C==="stroke"||M||!p.call(this))){for(var H,U,te=[],le=this.path,oe=0;oe<le.length;oe++){var ae=le[oe];switch(ae.type){case"begin":te.push({begin:!0});break;case"close":te.push({close:!0});break;case"mt":te.push({start:ae,deltas:[],abs:[]});break;case"lt":var he=te.length;if(le[oe-1]&&!isNaN(le[oe-1].x)&&(H=[ae.x-le[oe-1].x,ae.y-le[oe-1].y],he>0)){for(;he>=0;he--)if(te[he-1].close!==!0&&te[he-1].begin!==!0){te[he-1].deltas.push(H),te[he-1].abs.push(ae);break}}break;case"bct":H=[ae.x1-le[oe-1].x,ae.y1-le[oe-1].y,ae.x2-le[oe-1].x,ae.y2-le[oe-1].y,ae.x-le[oe-1].x,ae.y-le[oe-1].y],te[te.length-1].deltas.push(H);break;case"qct":var me=le[oe-1].x+2/3*(ae.x1-le[oe-1].x),Q=le[oe-1].y+2/3*(ae.y1-le[oe-1].y),G=ae.x+2/3*(ae.x1-ae.x),ee=ae.y+2/3*(ae.y1-ae.y),se=ae.x,V=ae.y;H=[me-le[oe-1].x,Q-le[oe-1].y,G-le[oe-1].x,ee-le[oe-1].y,se-le[oe-1].x,V-le[oe-1].y],te[te.length-1].deltas.push(H);break;case"arc":te.push({deltas:[],abs:[],arc:!0}),Array.isArray(te[te.length-1].abs)&&te[te.length-1].abs.push(ae)}}U=M?null:C==="stroke"?"stroke":"fill";for(var Ge=!1,De=0;De<te.length;De++)if(te[De].arc)for(var Fe=te[De].abs,Xe=0;Xe<Fe.length;Xe++){var it=Fe[Xe];it.type==="arc"?S.call(this,it.x,it.y,it.radius,it.startAngle,it.endAngle,it.counterclockwise,void 0,M,!Ge):R.call(this,it.x,it.y),Ge=!0}else if(te[De].close===!0)this.pdf.internal.out("h"),Ge=!1;else if(te[De].begin!==!0){var lt=te[De].start.x,vt=te[De].start.y;F.call(this,te[De].deltas,lt,vt),Ge=!0}U&&I.call(this,U),M&&W.call(this)}},T=function(C){var M=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,H=M*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return C-H;case"top":return C+M-H;case"hanging":return C+M-2*H;case"middle":return C+M/2-H;case"ideographic":return C;case"alphabetic":default:return C}},E=function(C){return C+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};f.prototype.createLinearGradient=function(){var C=function(){};return C.colorStops=[],C.addColorStop=function(M,H){this.colorStops.push([M,H])},C.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},C.isCanvasGradient=!0,C},f.prototype.createPattern=function(){return this.createLinearGradient()},f.prototype.createRadialGradient=function(){return this.createLinearGradient()};var S=function(C,M,H,U,te,le,oe,ae,he){for(var me=K.call(this,H,U,te,le),Q=0;Q<me.length;Q++){var G=me[Q];Q===0&&(he?O.call(this,G.x1+C,G.y1+M):R.call(this,G.x1+C,G.y1+M)),z.call(this,C,M,G.x2,G.y2,G.x3,G.y3,G.x4,G.y4)}ae?W.call(this):I.call(this,oe)},I=function(C){switch(C){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},W=function(){this.pdf.clip(),this.pdf.discardPath()},O=function(C,M){this.pdf.internal.out(r(C)+" "+n(M)+" m")},D=function(C){var M;switch(C.align){case"right":case"end":M="right";break;case"center":M="center";break;case"left":case"start":default:M="left"}var H=this.pdf.getTextDimensions(C.text),U=T.call(this,C.y),te=E.call(this,U)-H.h,le=this.ctx.transform.applyToPoint(new s(C.x,U)),oe=this.ctx.transform.decompose(),ae=new c;ae=(ae=(ae=ae.multiply(oe.translate)).multiply(oe.skew)).multiply(oe.scale);for(var he,me,Q,G=this.ctx.transform.applyToRectangle(new l(C.x,U,H.w,H.h)),ee=ae.applyToRectangle(new l(C.x,te,H.w,H.h)),se=y.call(this,ee),V=[],Ge=0;Ge<se.length;Ge+=1)V.indexOf(se[Ge])===-1&&V.push(se[Ge]);if(w(V),this.autoPaging)for(var De=V[0],Fe=V[V.length-1],Xe=De;Xe<Fe+1;Xe++){this.pdf.setPage(Xe);var it=Xe===1?this.posY+this.margin[0]:this.margin[0],lt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],vt=this.pdf.internal.pageSize.height-this.margin[2],Ye=vt-this.margin[0],Ze=this.pdf.internal.pageSize.width-this.margin[1],We=Ze-this.margin[3],wt=Xe===1?0:lt+(Xe-2)*Ye;if(this.ctx.clip_path.length!==0){var Nt=this.path;he=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=_(he,this.posX+this.margin[3],-1*wt+it),P.call(this,"fill",!0),this.path=Nt}var kt=_([JSON.parse(JSON.stringify(ee))],this.posX+this.margin[3],-wt+it+this.ctx.prevPageLastElemOffset)[0];C.scale>=.01&&(me=this.pdf.internal.getFontSize(),this.pdf.setFontSize(me*C.scale),Q=this.lineWidth,this.lineWidth=Q*C.scale);var Wt=this.autoPaging!=="text";if(Wt||kt.y+kt.h<=vt){if(Wt||kt.y>=it&&kt.x<=Ze){var jt=Wt?C.text:this.pdf.splitTextToSize(C.text,C.maxWidth||Ze-kt.x)[0],ur=_([JSON.parse(JSON.stringify(G))],this.posX+this.margin[3],-wt+it+this.ctx.prevPageLastElemOffset)[0],$e=Wt&&(Xe>De||Xe<Fe)&&m.call(this);$e&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],We,Ye,null).clip().discardPath()),this.pdf.text(jt,ur.x,ur.y,{angle:C.angle,align:M,renderingMode:C.renderingMode}),$e&&this.pdf.restoreGraphicsState()}}else kt.y<vt&&(this.ctx.prevPageLastElemOffset+=vt-kt.y);C.scale>=.01&&(this.pdf.setFontSize(me),this.lineWidth=Q)}else C.scale>=.01&&(me=this.pdf.internal.getFontSize(),this.pdf.setFontSize(me*C.scale),Q=this.lineWidth,this.lineWidth=Q*C.scale),this.pdf.text(C.text,le.x+this.posX,le.y+this.posY,{angle:C.angle,align:M,renderingMode:C.renderingMode,maxWidth:C.maxWidth}),C.scale>=.01&&(this.pdf.setFontSize(me),this.lineWidth=Q)},R=function(C,M,H,U){H=H||0,U=U||0,this.pdf.internal.out(r(C+H)+" "+n(M+U)+" l")},F=function(C,M,H){return this.pdf.lines(C,M,H,null,null)},z=function(C,M,H,U,te,le,oe,ae){this.pdf.internal.out([t(a(H+C)),t(o(U+M)),t(a(te+C)),t(o(le+M)),t(a(oe+C)),t(o(ae+M)),"c"].join(" "))},K=function(C,M,H,U){for(var te=2*Math.PI,le=Math.PI/2;M>H;)M-=te;var oe=Math.abs(H-M);oe<te&&U&&(oe=te-oe);for(var ae=[],he=U?-1:1,me=M;oe>1e-5;){var Q=me+he*Math.min(oe,le);ae.push(J.call(this,C,me,Q)),oe-=Math.abs(Q-me),me=Q}return ae},J=function(C,M,H){var U=(H-M)/2,te=C*Math.cos(U),le=C*Math.sin(U),oe=te,ae=-le,he=oe*oe+ae*ae,me=he+oe*te+ae*le,Q=4/3*(Math.sqrt(2*he*me)-me)/(oe*le-ae*te),G=oe-Q*ae,ee=ae+Q*oe,se=G,V=-ee,Ge=U+M,De=Math.cos(Ge),Fe=Math.sin(Ge);return{x1:C*Math.cos(M),y1:C*Math.sin(M),x2:G*De-ee*Fe,y2:G*Fe+ee*De,x3:se*De-V*Fe,y3:se*Fe+V*De,x4:C*Math.cos(H),y4:C*Math.sin(H)}},L=function(C){return 180*C/Math.PI},k=function(C,M,H,U,te,le){var oe=C+.5*(H-C),ae=M+.5*(U-M),he=te+.5*(H-te),me=le+.5*(U-le),Q=Math.min(C,te,oe,he),G=Math.max(C,te,oe,he),ee=Math.min(M,le,ae,me),se=Math.max(M,le,ae,me);return new l(Q,ee,G-Q,se-ee)},$=function(C,M,H,U,te,le,oe,ae){var he,me,Q,G,ee,se,V,Ge,De,Fe,Xe,it,lt,vt,Ye=H-C,Ze=U-M,We=te-H,wt=le-U,Nt=oe-te,kt=ae-le;for(me=0;me<41;me++)De=(V=(Q=C+(he=me/40)*Ye)+he*((ee=H+he*We)-Q))+he*(ee+he*(te+he*Nt-ee)-V),Fe=(Ge=(G=M+he*Ze)+he*((se=U+he*wt)-G))+he*(se+he*(le+he*kt-se)-Ge),me==0?(Xe=De,it=Fe,lt=De,vt=Fe):(Xe=Math.min(Xe,De),it=Math.min(it,Fe),lt=Math.max(lt,De),vt=Math.max(vt,Fe));return new l(Math.round(Xe),Math.round(it),Math.round(lt-Xe),Math.round(vt-it))},X=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var C,M,H=(C=this.ctx.lineDash,M=this.ctx.lineDashOffset,JSON.stringify({lineDash:C,lineDashOffset:M}));this.prevLineDash!==H&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=H)}}})(wr.API),function(e){var t=function(o){var s,l,c,u,d,f,h,p,v,m;for(l=[],c=0,u=(o+=s="\0\0\0\0".slice(o.length%4||4)).length;u>c;c+=4)(d=(o.charCodeAt(c)<<24)+(o.charCodeAt(c+1)<<16)+(o.charCodeAt(c+2)<<8)+o.charCodeAt(c+3))!==0?(f=(d=((d=((d=((d=(d-(m=d%85))/85)-(v=d%85))/85)-(p=d%85))/85)-(h=d%85))/85)%85,l.push(f+33,h+33,p+33,v+33,m+33)):l.push(122);return function(y,b){for(var _=b;_>0;_--)y.pop()}(l,s.length),String.fromCharCode.apply(String,l)+"~>"},r=function(o){var s,l,c,u,d,f=String,h="length",p=255,v="charCodeAt",m="slice",y="replace";for(o[m](-2),o=o[m](0,-2)[y](/\s/g,"")[y]("z","!!!!!"),c=[],u=0,d=(o+=s="uuuuu"[m](o[h]%5||5))[h];d>u;u+=5)l=52200625*(o[v](u)-33)+614125*(o[v](u+1)-33)+7225*(o[v](u+2)-33)+85*(o[v](u+3)-33)+(o[v](u+4)-33),c.push(p&l>>24,p&l>>16,p&l>>8,p&l);return function(b,_){for(var w=_;w>0;w--)b.pop()}(c,s[h]),f.fromCharCode.apply(f,c)},n=function(o){var s=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((o=o.replace(/\s/g,"")).indexOf(">")!==-1&&(o=o.substr(0,o.indexOf(">"))),o.length%2&&(o+="0"),s.test(o)===!1)return"";for(var l="",c=0;c<o.length;c+=2)l+=String.fromCharCode("0x"+(o[c]+o[c+1]));return l},a=function(o){for(var s=new Uint8Array(o.length),l=o.length;l--;)s[l]=o.charCodeAt(l);return o=(s=kw(s)).reduce(function(c,u){return c+String.fromCharCode(u)},"")};e.processDataByFilters=function(o,s){var l=0,c=o||"",u=[];for(typeof(s=s||[])=="string"&&(s=[s]),l=0;l<s.length;l+=1)switch(s[l]){case"ASCII85Decode":case"/ASCII85Decode":c=r(c),u.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":c=t(c),u.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":c=n(c),u.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":c=c.split("").map(function(d){return("0"+d.charCodeAt().toString(16)).slice(-2)}).join("")+">",u.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":c=a(c),u.push("/FlateDecode");break;default:throw new Error('The filter: "'+s[l]+'" is not implemented')}return{data:c,reverseChain:u.reverse().join(" ")}}}(wr.API),function(e){e.loadFile=function(t,r,n){return function(a,o,s){o=o!==!1,s=typeof s=="function"?s:function(){};var l=void 0;try{l=function(c,u,d){var f=new XMLHttpRequest,h=0,p=function(v){var m=v.length,y=[],b=String.fromCharCode;for(h=0;h<m;h+=1)y.push(b(255&v.charCodeAt(h)));return y.join("")};if(f.open("GET",c,!u),f.overrideMimeType("text/plain; charset=x-user-defined"),u===!1&&(f.onload=function(){f.status===200?d(p(this.responseText)):d(void 0)}),f.send(null),u&&f.status===200)return p(f.responseText)}(a,o,s)}catch{}return l}(t,r,n)},e.loadImageFile=e.loadFile}(wr.API),function(e){function t(){return(Or.html2canvas?Promise.resolve(Or.html2canvas):Sw(()=>import("./html2canvas.esm-BfxBtG_O.js"),[])).catch(function(s){return Promise.reject(new Error("Could not load html2canvas: "+s))}).then(function(s){return s.default?s.default:s})}function r(){return(Or.DOMPurify?Promise.resolve(Or.DOMPurify):Sw(()=>import("./purify.es-CQJ0hv7W.js"),[])).catch(function(s){return Promise.reject(new Error("Could not load dompurify: "+s))}).then(function(s){return s.default?s.default:s})}var n=function(s){var l=gn(s);return l==="undefined"?"undefined":l==="string"||s instanceof String?"string":l==="number"||s instanceof Number?"number":l==="function"||s instanceof Function?"function":s&&s.constructor===Array?"array":s&&s.nodeType===1?"element":l==="object"?"object":"unknown"},a=function(s,l){var c=document.createElement(s);for(var u in l.className&&(c.className=l.className),l.innerHTML&&l.dompurify&&(c.innerHTML=l.dompurify.sanitize(l.innerHTML)),l.style)c.style[u]=l.style[u];return c},o=function s(l){var c=Object.assign(s.convert(Promise.resolve()),JSON.parse(JSON.stringify(s.template))),u=s.convert(Promise.resolve(),c);return u=(u=u.setProgress(1,s,1,[s])).set(l)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(s,l){return s.__proto__=l||o.prototype,s},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(s,l){return this.then(function(){switch(l=l||function(c){switch(n(c)){case"string":return"string";case"element":return c.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(s)){case"string":return this.then(r).then(function(c){return this.set({src:a("div",{innerHTML:s,dompurify:c})})});case"element":return this.set({src:s});case"canvas":return this.set({canvas:s});case"img":return this.set({img:s});default:return this.error("Unknown source type.")}})},o.prototype.to=function(s){switch(s){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var s={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},l=function c(u,d){for(var f=u.nodeType===3?document.createTextNode(u.nodeValue):u.cloneNode(!1),h=u.firstChild;h;h=h.nextSibling)d!==!0&&h.nodeType===1&&h.nodeName==="SCRIPT"||f.appendChild(c(h,d));return u.nodeType===1&&(u.nodeName==="CANVAS"?(f.width=u.width,f.height=u.height,f.getContext("2d").drawImage(u,0,0)):u.nodeName!=="TEXTAREA"&&u.nodeName!=="SELECT"||(f.value=u.value),f.addEventListener("load",function(){f.scrollTop=u.scrollTop,f.scrollLeft=u.scrollLeft},!0)),f}(this.prop.src,this.opt.html2canvas.javascriptEnabled);l.tagName==="BODY"&&(s.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=a("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=a("div",{className:"html2pdf__container",style:s}),this.prop.container.appendChild(l),this.prop.container.firstChild.appendChild(a("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var s=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(s).then(t).then(function(l){var c=Object.assign({},this.opt.html2canvas);return delete c.onrendered,l(this.prop.container,c)}).then(function(l){(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var s=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(s).then(t).then(function(l){var c=this.opt.jsPDF,u=this.opt.fontFaces,d=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,f=Object.assign({async:!0,allowTaint:!0,scale:d,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete f.onrendered,c.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,c.context2d.posX=this.opt.x,c.context2d.posY=this.opt.y,c.context2d.margin=this.opt.margin,c.context2d.fontFaces=u,u)for(var h=0;h<u.length;++h){var p=u[h],v=p.src.find(function(m){return m.format==="truetype"});v&&c.addFont(v.url,p.ref.name,p.ref.style)}return f.windowHeight=f.windowHeight||0,f.windowHeight=f.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):f.windowHeight,c.context2d.save(!0),l(this.prop.container,f)}).then(function(l){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var s=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=s})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(s,l,c){return(c=c||"pdf").toLowerCase()==="img"||c.toLowerCase()==="image"?this.outputImg(s,l):this.outputPdf(s,l)},o.prototype.outputPdf=function(s,l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(s,l)})},o.prototype.outputImg=function(s){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(s){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+s+'" is not supported.'}})},o.prototype.save=function(s){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(s?{filename:s}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(s){if(n(s)!=="object")return this;var l=Object.keys(s||{}).map(function(c){if(c in o.template.prop)return function(){this.prop[c]=s[c]};switch(c){case"margin":return this.setMargin.bind(this,s.margin);case"jsPDF":return function(){return this.opt.jsPDF=s.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,s.pageSize);default:return function(){this.opt[c]=s[c]}}},this);return this.then(function(){return this.thenList(l)})},o.prototype.get=function(s,l){return this.then(function(){var c=s in o.template.prop?this.prop[s]:this.opt[s];return l?l(c):c})},o.prototype.setMargin=function(s){return this.then(function(){switch(n(s)){case"number":s=[s,s,s,s];case"array":if(s.length===2&&(s=[s[0],s[1],s[0],s[1]]),s.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=s}).then(this.setPageSize)},o.prototype.setPageSize=function(s){function l(c,u){return Math.floor(c*u/72*96)}return this.then(function(){(s=s||wr.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(s.inner={width:s.width-this.opt.margin[1]-this.opt.margin[3],height:s.height-this.opt.margin[0]-this.opt.margin[2]},s.inner.px={width:l(s.inner.width,s.k),height:l(s.inner.height,s.k)},s.inner.ratio=s.inner.height/s.inner.width),this.prop.pageSize=s})},o.prototype.setProgress=function(s,l,c,u){return s!=null&&(this.progress.val=s),l!=null&&(this.progress.state=l),c!=null&&(this.progress.n=c),u!=null&&(this.progress.stack=u),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(s,l,c,u){return this.setProgress(s?this.progress.val+s:null,l||null,c?this.progress.n+c:null,u?this.progress.stack.concat(u):null)},o.prototype.then=function(s,l){var c=this;return this.thenCore(s,l,function(u,d){return c.updateProgress(null,null,1,[u]),Promise.prototype.then.call(this,function(f){return c.updateProgress(null,u),f}).then(u,d).then(function(f){return c.updateProgress(1),f})})},o.prototype.thenCore=function(s,l,c){c=c||Promise.prototype.then,s&&(s=s.bind(this)),l&&(l=l.bind(this));var u=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:o.convert(Object.assign({},this),Promise.prototype),d=c.call(u,s,l);return o.convert(d,this.__proto__)},o.prototype.thenExternal=function(s,l){return Promise.prototype.then.call(this,s,l)},o.prototype.thenList=function(s){var l=this;return s.forEach(function(c){l=l.thenCore(c)}),l},o.prototype.catch=function(s){s&&(s=s.bind(this));var l=Promise.prototype.catch.call(this,s);return o.convert(l,this)},o.prototype.catchExternal=function(s){return Promise.prototype.catch.call(this,s)},o.prototype.error=function(s){return this.then(function(){throw new Error(s)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,wr.getPageSize=function(s,l,c){if(gn(s)==="object"){var u=s;s=u.orientation,l=u.unit||l,c=u.format||c}l=l||"mm",c=c||"a4",s=(""+(s||"P")).toLowerCase();var d,f=(""+c).toLowerCase(),h={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(l){case"pt":d=1;break;case"mm":d=72/25.4;break;case"cm":d=72/2.54;break;case"in":d=72;break;case"px":d=.75;break;case"pc":case"em":d=12;break;case"ex":d=6;break;default:throw"Invalid unit: "+l}var p,v=0,m=0;if(h.hasOwnProperty(f))v=h[f][1]/d,m=h[f][0]/d;else try{v=c[1],m=c[0]}catch{throw new Error("Invalid format: "+c)}if(s==="p"||s==="portrait")s="p",m>v&&(p=m,m=v,v=p);else{if(s!=="l"&&s!=="landscape")throw"Invalid orientation: "+s;s="l",v>m&&(p=m,m=v,v=p)}return{width:m,height:v,unit:l,k:d,orientation:s}},e.html=function(s,l){(l=l||{}).callback=l.callback||function(){},l.html2canvas=l.html2canvas||{},l.html2canvas.canvas=l.html2canvas.canvas||this.canvas,l.jsPDF=l.jsPDF||this,l.fontFaces=l.fontFaces?l.fontFaces.map(Mw):null;var c=new o(l);return l.worker?c:c.from(s).doCallback()}}(wr.API),wr.API.addJS=function(e){return J4=e,this.internal.events.subscribe("postPutResources",function(){Lm=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Lm+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),X4=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+J4+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Lm!==void 0&&X4!==void 0&&this.internal.out("/Names <</JavaScript "+Lm+" 0 R>>")}),this},function(e){var t;e.events.push(["postPutResources",function(){var r=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var a=r.outline.render().split(/\r\n/),o=0;o<a.length;o++){var s=a[o],l=n.exec(s);if(l!=null){var c=l[1];r.internal.newObjectDeferredBegin(c,!1)}r.internal.write(s)}if(this.outline.createNamedDestinations){var u=this.internal.pages.length,d=[];for(o=0;o<u;o++){var f=r.internal.newObject();d.push(f);var h=r.internal.getPageInfo(o+1);r.internal.write("<< /D["+h.objId+" 0 R /XYZ null null null]>> endobj")}var p=r.internal.newObject();for(r.internal.write("<< /Names [ "),o=0;o<d.length;o++)r.internal.write("(page_"+(o+1)+")"+d[o]+" 0 R");r.internal.write(" ] >>","endobj"),t=r.internal.newObject(),r.internal.write("<< /Dests "+p+" 0 R"),r.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var r=this;r.outline={createNamedDestinations:!1,root:{children:[]}},r.outline.add=function(n,a,o){var s={title:a,options:o,children:[]};return n==null&&(n=this.root),n.children.push(s),s},r.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=r,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},r.outline.genIds_r=function(n){n.id=r.internal.newObjectDeferred();for(var a=0;a<n.children.length;a++)this.genIds_r(n.children[a])},r.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},r.outline.renderItems=function(n){for(var a=this.ctx.pdf.internal.getVerticalCoordinateString,o=0;o<n.children.length;o++){var s=n.children[o];this.objStart(s),this.line("/Title "+this.makeString(s.title)),this.line("/Parent "+this.makeRef(n)),o>0&&this.line("/Prev "+this.makeRef(n.children[o-1])),o<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[o+1])),s.children.length>0&&(this.line("/First "+this.makeRef(s.children[0])),this.line("/Last "+this.makeRef(s.children[s.children.length-1])));var l=this.count=this.count_r({count:0},s);if(l>0&&this.line("/Count "+l),s.options&&s.options.pageNumber){var c=r.internal.getPageInfo(s.options.pageNumber);this.line("/Dest ["+c.objId+" 0 R /XYZ 0 "+a(0)+" 0]")}this.objEnd()}for(var u=0;u<n.children.length;u++)this.renderItems(n.children[u])},r.outline.line=function(n){this.ctx.val+=n+`\r
`},r.outline.makeRef=function(n){return n.id+" 0 R"},r.outline.makeString=function(n){return"("+r.internal.pdfEscape(n)+")"},r.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},r.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},r.outline.count_r=function(n,a){for(var o=0;o<a.children.length;o++)n.count++,this.count_r(n,a.children[o]);return n.count}}])}(wr.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(r,n,a,o,s,l){var c,u=this.decode.DCT_DECODE,d=null;if(typeof r=="string"||this.__addimage__.isArrayBuffer(r)||this.__addimage__.isArrayBufferView(r)){switch(r=s||r,r=this.__addimage__.isArrayBuffer(r)?new Uint8Array(r):r,(c=function(f){for(var h,p=256*f.charCodeAt(4)+f.charCodeAt(5),v=f.length,m={width:0,height:0,numcomponents:1},y=4;y<v;y+=2){if(y+=p,t.indexOf(f.charCodeAt(y+1))!==-1){h=256*f.charCodeAt(y+5)+f.charCodeAt(y+6),m={width:256*f.charCodeAt(y+7)+f.charCodeAt(y+8),height:h,numcomponents:f.charCodeAt(y+9)};break}p=256*f.charCodeAt(y+2)+f.charCodeAt(y+3)}return m}(r=this.__addimage__.isArrayBufferView(r)?this.__addimage__.arrayBufferToBinaryString(r):r)).numcomponents){case 1:l=this.color_spaces.DEVICE_GRAY;break;case 4:l=this.color_spaces.DEVICE_CMYK;break;case 3:l=this.color_spaces.DEVICE_RGB}d={data:r,width:c.width,height:c.height,colorSpace:l,bitsPerComponent:8,filter:u,index:n,alias:a}}return d}}(wr.API);var Au,Rm,Z4,eE,tE,ice=function(){var e,t,r;function n(o){var s,l,c,u,d,f,h,p,v,m,y,b,_,w;for(this.data=o,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},f=null;;){switch(s=this.readUInt32(),v=(function(){var A,P;for(P=[],A=0;A<4;++A)P.push(String.fromCharCode(this.data[this.pos++]));return P}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(s);break;case"fcTL":f&&this.animation.frames.push(f),this.pos+=4,f={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},d=this.readUInt16(),u=this.readUInt16()||100,f.delay=1e3*d/u,f.disposeOp=this.data[this.pos++],f.blendOp=this.data[this.pos++],f.data=[];break;case"IDAT":case"fdAT":for(v==="fdAT"&&(this.pos+=4,s-=4),o=f?.data||this.imgData,b=0;0<=s?b<s:b>s;0<=s?++b:--b)o.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(c=this.palette.length/3,this.transparency.indexed=this.read(s),this.transparency.indexed.length>c)throw new Error("More transparent colors than palette size");if((m=c-this.transparency.indexed.length)>0)for(_=0;0<=m?_<m:_>m;0<=m?++_:--_)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(s)[0];break;case 2:this.transparency.rgb=this.read(s)}break;case"tEXt":h=(y=this.read(s)).indexOf(0),p=String.fromCharCode.apply(String,y.slice(0,h)),this.text[p]=String.fromCharCode.apply(String,y.slice(h+1));break;case"IEND":return f&&this.animation.frames.push(f),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(w=this.colorType)===4||w===6,l=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*l,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=s}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}n.prototype.read=function(o){var s,l;for(l=[],s=0;0<=o?s<o:s>o;0<=o?++s:--s)l.push(this.data[this.pos++]);return l},n.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.decodePixels=function(o){var s=this.pixelBitlength/8,l=new Uint8Array(this.width*this.height*s),c=0,u=this;if(o==null&&(o=this.imgData),o.length===0)return new Uint8Array(0);function d(f,h,p,v){var m,y,b,_,w,A,P,T,E,S,I,W,O,D,R,F,z,K,J,L,k,$=Math.ceil((u.width-f)/p),X=Math.ceil((u.height-h)/v),C=u.width==$&&u.height==X;for(D=s*$,W=C?l:new Uint8Array(D*X),A=o.length,O=0,y=0;O<X&&c<A;){switch(o[c++]){case 0:for(_=z=0;z<D;_=z+=1)W[y++]=o[c++];break;case 1:for(_=K=0;K<D;_=K+=1)m=o[c++],w=_<s?0:W[y-s],W[y++]=(m+w)%256;break;case 2:for(_=J=0;J<D;_=J+=1)m=o[c++],b=(_-_%s)/s,R=O&&W[(O-1)*D+b*s+_%s],W[y++]=(R+m)%256;break;case 3:for(_=L=0;L<D;_=L+=1)m=o[c++],b=(_-_%s)/s,w=_<s?0:W[y-s],R=O&&W[(O-1)*D+b*s+_%s],W[y++]=(m+Math.floor((w+R)/2))%256;break;case 4:for(_=k=0;k<D;_=k+=1)m=o[c++],b=(_-_%s)/s,w=_<s?0:W[y-s],O===0?R=F=0:(R=W[(O-1)*D+b*s+_%s],F=b&&W[(O-1)*D+(b-1)*s+_%s]),P=w+R-F,T=Math.abs(P-w),S=Math.abs(P-R),I=Math.abs(P-F),E=T<=S&&T<=I?w:S<=I?R:F,W[y++]=(m+E)%256;break;default:throw new Error("Invalid filter algorithm: "+o[c-1])}if(!C){var M=((h+O*v)*u.width+f)*s,H=O*D;for(_=0;_<$;_+=1){for(var U=0;U<s;U+=1)l[M++]=W[H++];M+=(p-1)*s}}O++}}return o=Rle(o),u.interlaceMethod==1?(d(0,0,8,8),d(4,0,8,8),d(0,4,4,8),d(2,0,4,4),d(0,2,2,4),d(1,0,2,2),d(0,1,1,2)):d(0,0,1,1),l},n.prototype.decodePalette=function(){var o,s,l,c,u,d,f,h,p;for(l=this.palette,d=this.transparency.indexed||[],u=new Uint8Array((d.length||0)+l.length),c=0,o=0,s=f=0,h=l.length;f<h;s=f+=3)u[c++]=l[s],u[c++]=l[s+1],u[c++]=l[s+2],u[c++]=(p=d[o++])!=null?p:255;return u},n.prototype.copyToImageData=function(o,s){var l,c,u,d,f,h,p,v,m,y,b;if(c=this.colors,m=null,l=this.hasAlphaChannel,this.palette.length&&(m=(b=this._decodedPalette)!=null?b:this._decodedPalette=this.decodePalette(),c=4,l=!0),v=(u=o.data||o).length,f=m||s,d=h=0,c===1)for(;d<v;)p=m?4*s[d/4]:h,y=f[p++],u[d++]=y,u[d++]=y,u[d++]=y,u[d++]=l?f[p++]:255,h=p;else for(;d<v;)p=m?4*s[d/4]:h,u[d++]=f[p++],u[d++]=f[p++],u[d++]=f[p++],u[d++]=l?f[p++]:255,h=p},n.prototype.decode=function(){var o;return o=new Uint8Array(this.width*this.height*4),this.copyToImageData(o,this.decodePixels()),o};var a=function(){if(Object.prototype.toString.call(Or)==="[object Window]"){try{t=Or.document.createElement("canvas"),r=t.getContext("2d")}catch{return!1}return!0}return!1};return a(),e=function(o){var s;if(a()===!0)return r.width=o.width,r.height=o.height,r.clearRect(0,0,o.width,o.height),r.putImageData(o,0,0),(s=new Image).src=t.toDataURL(),s;throw new Error("This method requires a Browser with Canvas-capability.")},n.prototype.decodeFrames=function(o){var s,l,c,u,d,f,h,p;if(this.animation){for(p=[],l=d=0,f=(h=this.animation.frames).length;d<f;l=++d)s=h[l],c=o.createImageData(s.width,s.height),u=this.decodePixels(new Uint8Array(s.data)),this.copyToImageData(c,u),s.imageData=c,p.push(s.image=e(c));return p}},n.prototype.renderFrame=function(o,s){var l,c,u;return l=(c=this.animation.frames)[s],u=c[s-1],s===0&&o.clearRect(0,0,this.width,this.height),u?.disposeOp===1?o.clearRect(u.xOffset,u.yOffset,u.width,u.height):u?.disposeOp===2&&o.putImageData(u.imageData,u.xOffset,u.yOffset),l.blendOp===0&&o.clearRect(l.xOffset,l.yOffset,l.width,l.height),o.drawImage(l.image,l.xOffset,l.yOffset)},n.prototype.animate=function(o){var s,l,c,u,d,f,h=this;return l=0,f=this.animation,u=f.numFrames,c=f.frames,d=f.numPlays,(s=function(){var p,v;if(p=l++%u,v=c[p],h.renderFrame(o,p),u>1&&l/u<d)return h.animation._timeout=setTimeout(s,v.delay)})()},n.prototype.stopAnimation=function(){var o;return clearTimeout((o=this.animation)!=null?o._timeout:void 0)},n.prototype.render=function(o){var s,l;return o._png&&o._png.stopAnimation(),o._png=this,o.width=this.width,o.height=this.height,s=o.getContext("2d"),this.animation?(this.decodeFrames(s),this.animate(s)):(l=s.createImageData(this.width,this.height),this.copyToImageData(l,this.decodePixels()),s.putImageData(l,0,0))},n}();/**
 * @license
 *
 * Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 *//**
 * @license
 * (c) Dean McNamee <dean@gmail.com>, 2013.
 *
 * https://github.com/deanm/omggif
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
 * including animation and compression.  It does not rely on any specific
 * underlying system, so should run in the browser, Node, or Plask.
 */function oce(e){var t=0;if(e[t++]!==71||e[t++]!==73||e[t++]!==70||e[t++]!==56||(e[t++]+1&253)!=56||e[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var r=e[t++]|e[t++]<<8,n=e[t++]|e[t++]<<8,a=e[t++],o=a>>7,s=1<<(7&a)+1;e[t++],e[t++];var l=null,c=null;o&&(l=t,c=s,t+=3*s);var u=!0,d=[],f=0,h=null,p=0,v=null;for(this.width=r,this.height=n;u&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(e[t]!==11||e[t+1]==78&&e[t+2]==69&&e[t+3]==84&&e[t+4]==83&&e[t+5]==67&&e[t+6]==65&&e[t+7]==80&&e[t+8]==69&&e[t+9]==50&&e[t+10]==46&&e[t+11]==48&&e[t+12]==3&&e[t+13]==1&&e[t+16]==0)t+=14,v=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((O=e[t++])>=0))throw Error("Invalid block size");if(O===0)break;t+=O}break;case 249:if(e[t++]!==4||e[t+4]!==0)throw new Error("Invalid graphics extension block.");var m=e[t++];f=e[t++]|e[t++]<<8,h=e[t++],(1&m)==0&&(h=null),p=m>>2&7,t++;break;case 254:for(;;){if(!((O=e[t++])>=0))throw Error("Invalid block size");if(O===0)break;t+=O}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var y=e[t++]|e[t++]<<8,b=e[t++]|e[t++]<<8,_=e[t++]|e[t++]<<8,w=e[t++]|e[t++]<<8,A=e[t++],P=A>>6&1,T=1<<(7&A)+1,E=l,S=c,I=!1;A>>7&&(I=!0,E=t,S=T,t+=3*T);var W=t;for(t++;;){var O;if(!((O=e[t++])>=0))throw Error("Invalid block size");if(O===0)break;t+=O}d.push({x:y,y:b,width:_,height:w,has_local_palette:I,palette_offset:E,palette_size:S,data_offset:W,data_length:t-W,transparent_index:h,interlaced:!!P,delay:f,disposal:p});break;case 59:u=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return d.length},this.loopCount=function(){return v},this.frameInfo=function(D){if(D<0||D>=d.length)throw new Error("Frame index out of range.");return d[D]},this.decodeAndBlitFrameBGRA=function(D,R){var F=this.frameInfo(D),z=F.width*F.height,K=new Uint8Array(z);rE(e,F.data_offset,K,z);var J=F.palette_offset,L=F.transparent_index;L===null&&(L=256);var k=F.width,$=r-k,X=k,C=4*(F.y*r+F.x),M=4*((F.y+F.height)*r+F.x),H=C,U=4*$;F.interlaced===!0&&(U+=4*r*7);for(var te=8,le=0,oe=K.length;le<oe;++le){var ae=K[le];if(X===0&&(X=k,(H+=U)>=M&&(U=4*$+4*r*(te-1),H=C+(k+$)*(te<<1),te>>=1)),ae===L)H+=4;else{var he=e[J+3*ae],me=e[J+3*ae+1],Q=e[J+3*ae+2];R[H++]=Q,R[H++]=me,R[H++]=he,R[H++]=255}--X}},this.decodeAndBlitFrameRGBA=function(D,R){var F=this.frameInfo(D),z=F.width*F.height,K=new Uint8Array(z);rE(e,F.data_offset,K,z);var J=F.palette_offset,L=F.transparent_index;L===null&&(L=256);var k=F.width,$=r-k,X=k,C=4*(F.y*r+F.x),M=4*((F.y+F.height)*r+F.x),H=C,U=4*$;F.interlaced===!0&&(U+=4*r*7);for(var te=8,le=0,oe=K.length;le<oe;++le){var ae=K[le];if(X===0&&(X=k,(H+=U)>=M&&(U=4*$+4*r*(te-1),H=C+(k+$)*(te<<1),te>>=1)),ae===L)H+=4;else{var he=e[J+3*ae],me=e[J+3*ae+1],Q=e[J+3*ae+2];R[H++]=he,R[H++]=me,R[H++]=Q,R[H++]=255}--X}}}function rE(e,t,r,n){for(var a=e[t++],o=1<<a,s=o+1,l=s+1,c=a+1,u=(1<<c)-1,d=0,f=0,h=0,p=e[t++],v=new Int32Array(4096),m=null;;){for(;d<16&&p!==0;)f|=e[t++]<<d,d+=8,p===1?p=e[t++]:--p;if(d<c)break;var y=f&u;if(f>>=c,d-=c,y!==o){if(y===s)break;for(var b=y<l?y:m,_=0,w=b;w>o;)w=v[w]>>8,++_;var A=w;if(h+_+(b!==y?1:0)>n)return void On.log("Warning, gif stream longer than expected.");r[h++]=A;var P=h+=_;for(b!==y&&(r[h++]=A),w=b;_--;)w=v[w],r[--P]=255&w,w>>=8;m!==null&&l<4096&&(v[l++]=m<<8|A,l>=u+1&&c<12&&(++c,u=u<<1|1)),m=y}else l=s+1,u=(1<<(c=a+1))-1,m=null}return h!==n&&On.log("Warning, gif stream shorter than expected."),r}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function P2(e){var t,r,n,a,o,s=Math.floor,l=new Array(64),c=new Array(64),u=new Array(64),d=new Array(64),f=new Array(65535),h=new Array(65535),p=new Array(64),v=new Array(64),m=[],y=0,b=7,_=new Array(64),w=new Array(64),A=new Array(64),P=new Array(256),T=new Array(2048),E=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],S=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],I=[0,1,2,3,4,5,6,7,8,9,10,11],W=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],O=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],D=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],R=[0,1,2,3,4,5,6,7,8,9,10,11],F=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],z=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function K(C,M){for(var H=0,U=0,te=new Array,le=1;le<=16;le++){for(var oe=1;oe<=C[le];oe++)te[M[U]]=[],te[M[U]][0]=H,te[M[U]][1]=le,U++,H++;H*=2}return te}function J(C){for(var M=C[0],H=C[1]-1;H>=0;)M&1<<H&&(y|=1<<b),H--,--b<0&&(y==255?(L(255),L(0)):L(y),b=7,y=0)}function L(C){m.push(C)}function k(C){L(C>>8&255),L(255&C)}function $(C,M,H,U,te){for(var le,oe=te[0],ae=te[240],he=function(Fe,Xe){var it,lt,vt,Ye,Ze,We,wt,Nt,kt,Wt,jt=0;for(kt=0;kt<8;++kt){it=Fe[jt],lt=Fe[jt+1],vt=Fe[jt+2],Ye=Fe[jt+3],Ze=Fe[jt+4],We=Fe[jt+5],wt=Fe[jt+6];var ur=it+(Nt=Fe[jt+7]),$e=it-Nt,He=lt+wt,Je=lt-wt,Ue=vt+We,pt=vt-We,at=Ye+Ze,St=Ye-Ze,It=ur+at,Yt=ur-at,Sr=He+Ue,Mr=He-Ue;Fe[jt]=It+Sr,Fe[jt+4]=It-Sr;var nr=.707106781*(Mr+Yt);Fe[jt+2]=Yt+nr,Fe[jt+6]=Yt-nr;var Cr=.382683433*((It=St+pt)-(Mr=Je+$e)),Dr=.5411961*It+Cr,fn=1.306562965*Mr+Cr,Oa=.707106781*(Sr=pt+Je),En=$e+Oa,er=$e-Oa;Fe[jt+5]=er+Dr,Fe[jt+3]=er-Dr,Fe[jt+1]=En+fn,Fe[jt+7]=En-fn,jt+=8}for(jt=0,kt=0;kt<8;++kt){it=Fe[jt],lt=Fe[jt+8],vt=Fe[jt+16],Ye=Fe[jt+24],Ze=Fe[jt+32],We=Fe[jt+40],wt=Fe[jt+48];var Jr=it+(Nt=Fe[jt+56]),Vn=it-Nt,In=lt+wt,Yr=lt-wt,Kr=vt+We,je=vt-We,Ve=Ye+Ze,ot=Ye-Ze,Oe=Jr+Ve,qe=Jr-Ve,rt=In+Kr,Pt=In-Kr;Fe[jt]=Oe+rt,Fe[jt+32]=Oe-rt;var Kt=.707106781*(Pt+qe);Fe[jt+16]=qe+Kt,Fe[jt+48]=qe-Kt;var ar=.382683433*((Oe=ot+je)-(Pt=Yr+Vn)),kr=.5411961*Oe+ar,rn=1.306562965*Pt+ar,Vr=.707106781*(rt=je+Yr),$n=Vn+Vr,ka=Vn-Vr;Fe[jt+40]=ka+kr,Fe[jt+24]=ka-kr,Fe[jt+8]=$n+rn,Fe[jt+56]=$n-rn,jt++}for(kt=0;kt<64;++kt)Wt=Fe[kt]*Xe[kt],p[kt]=Wt>0?Wt+.5|0:Wt-.5|0;return p}(C,M),me=0;me<64;++me)v[E[me]]=he[me];var Q=v[0]-H;H=v[0],Q==0?J(U[0]):(J(U[h[le=32767+Q]]),J(f[le]));for(var G=63;G>0&&v[G]==0;)G--;if(G==0)return J(oe),H;for(var ee,se=1;se<=G;){for(var V=se;v[se]==0&&se<=G;)++se;var Ge=se-V;if(Ge>=16){ee=Ge>>4;for(var De=1;De<=ee;++De)J(ae);Ge&=15}le=32767+v[se],J(te[(Ge<<4)+h[le]]),J(f[le]),se++}return G!=63&&J(oe),H}function X(C){C=Math.min(Math.max(C,1),100),o!=C&&(function(M){for(var H=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],U=0;U<64;U++){var te=s((H[U]*M+50)/100);te=Math.min(Math.max(te,1),255),l[E[U]]=te}for(var le=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],oe=0;oe<64;oe++){var ae=s((le[oe]*M+50)/100);ae=Math.min(Math.max(ae,1),255),c[E[oe]]=ae}for(var he=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],me=0,Q=0;Q<8;Q++)for(var G=0;G<8;G++)u[me]=1/(l[E[me]]*he[Q]*he[G]*8),d[me]=1/(c[E[me]]*he[Q]*he[G]*8),me++}(C<50?Math.floor(5e3/C):Math.floor(200-2*C)),o=C)}this.encode=function(C,M){M&&X(M),m=new Array,y=0,b=7,k(65496),k(65504),k(16),L(74),L(70),L(73),L(70),L(0),L(1),L(1),L(0),k(1),k(1),L(0),L(0),function(){k(65499),k(132),L(0);for(var lt=0;lt<64;lt++)L(l[lt]);L(1);for(var vt=0;vt<64;vt++)L(c[vt])}(),function(lt,vt){k(65472),k(17),L(8),k(vt),k(lt),L(3),L(1),L(17),L(0),L(2),L(17),L(1),L(3),L(17),L(1)}(C.width,C.height),function(){k(65476),k(418),L(0);for(var lt=0;lt<16;lt++)L(S[lt+1]);for(var vt=0;vt<=11;vt++)L(I[vt]);L(16);for(var Ye=0;Ye<16;Ye++)L(W[Ye+1]);for(var Ze=0;Ze<=161;Ze++)L(O[Ze]);L(1);for(var We=0;We<16;We++)L(D[We+1]);for(var wt=0;wt<=11;wt++)L(R[wt]);L(17);for(var Nt=0;Nt<16;Nt++)L(F[Nt+1]);for(var kt=0;kt<=161;kt++)L(z[kt])}(),k(65498),k(12),L(3),L(1),L(0),L(2),L(17),L(3),L(17),L(0),L(63),L(0);var H=0,U=0,te=0;y=0,b=7,this.encode.displayName="_encode_";for(var le,oe,ae,he,me,Q,G,ee,se,V=C.data,Ge=C.width,De=C.height,Fe=4*Ge,Xe=0;Xe<De;){for(le=0;le<Fe;){for(me=Fe*Xe+le,G=-1,ee=0,se=0;se<64;se++)Q=me+(ee=se>>3)*Fe+(G=4*(7&se)),Xe+ee>=De&&(Q-=Fe*(Xe+1+ee-De)),le+G>=Fe&&(Q-=le+G-Fe+4),oe=V[Q++],ae=V[Q++],he=V[Q++],_[se]=(T[oe]+T[ae+256>>0]+T[he+512>>0]>>16)-128,w[se]=(T[oe+768>>0]+T[ae+1024>>0]+T[he+1280>>0]>>16)-128,A[se]=(T[oe+1280>>0]+T[ae+1536>>0]+T[he+1792>>0]>>16)-128;H=$(_,u,H,t,n),U=$(w,d,U,r,a),te=$(A,d,te,r,a),le+=32}Xe+=8}if(b>=0){var it=[];it[1]=b+1,it[0]=(1<<b+1)-1,J(it)}return k(65497),new Uint8Array(m)},e=e||50,function(){for(var C=String.fromCharCode,M=0;M<256;M++)P[M]=C(M)}(),t=K(S,I),r=K(D,R),n=K(W,O),a=K(F,z),function(){for(var C=1,M=2,H=1;H<=15;H++){for(var U=C;U<M;U++)h[32767+U]=H,f[32767+U]=[],f[32767+U][1]=H,f[32767+U][0]=U;for(var te=-(M-1);te<=-C;te++)h[32767+te]=H,f[32767+te]=[],f[32767+te][1]=H,f[32767+te][0]=M-1+te;C<<=1,M<<=1}}(),function(){for(var C=0;C<256;C++)T[C]=19595*C,T[C+256>>0]=38470*C,T[C+512>>0]=7471*C+32768,T[C+768>>0]=-11059*C,T[C+1024>>0]=-21709*C,T[C+1280>>0]=32768*C+8421375,T[C+1536>>0]=-27439*C,T[C+1792>>0]=-5329*C}(),X(e)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function es(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function nE(e){function t(S){if(!S)throw Error("assert :P")}function r(S,I,W){for(var O=0;4>O;O++)if(S[I+O]!=W.charCodeAt(O))return!0;return!1}function n(S,I,W,O,D){for(var R=0;R<D;R++)S[I+R]=W[O+R]}function a(S,I,W,O){for(var D=0;D<O;D++)S[I+D]=W}function o(S){return new Int32Array(S)}function s(S,I){for(var W=[],O=0;O<S;O++)W.push(new I);return W}function l(S,I){var W=[];return function O(D,R,F){for(var z=F[R],K=0;K<z&&(D.push(F.length>R+1?[]:new I),!(F.length<R+1));K++)O(D[K],R+1,F)}(W,0,S),W}var c=function(){var S=this;function I(g,j){for(var q=1<<j-1>>>0;g&q;)q>>>=1;return q?(g&q-1)+q:g}function W(g,j,q,Y,re){t(!(Y%q));do g[j+(Y-=q)]=re;while(0<Y)}function O(g,j,q,Y,re){if(t(2328>=re),512>=re)var ce=o(512);else if((ce=o(re))==null)return 0;return function(ue,fe,ye,_e,Le,et){var tt,ze,xt=fe,ut=1<<ye,Re=o(16),Be=o(16);for(t(Le!=0),t(_e!=null),t(ue!=null),t(0<ye),ze=0;ze<Le;++ze){if(15<_e[ze])return 0;++Re[_e[ze]]}if(Re[0]==Le)return 0;for(Be[1]=0,tt=1;15>tt;++tt){if(Re[tt]>1<<tt)return 0;Be[tt+1]=Be[tt]+Re[tt]}for(ze=0;ze<Le;++ze)tt=_e[ze],0<_e[ze]&&(et[Be[tt]++]=ze);if(Be[15]==1)return(_e=new D).g=0,_e.value=et[0],W(ue,xt,1,ut,_e),ut;var gt,Ct=-1,yt=ut-1,Gt=0,$t=1,vr=1,Ut=1<<ye;for(ze=0,tt=1,Le=2;tt<=ye;++tt,Le<<=1){if($t+=vr<<=1,0>(vr-=Re[tt]))return 0;for(;0<Re[tt];--Re[tt])(_e=new D).g=tt,_e.value=et[ze++],W(ue,xt+Gt,Le,Ut,_e),Gt=I(Gt,tt)}for(tt=ye+1,Le=2;15>=tt;++tt,Le<<=1){if($t+=vr<<=1,0>(vr-=Re[tt]))return 0;for(;0<Re[tt];--Re[tt]){if(_e=new D,(Gt&yt)!=Ct){for(xt+=Ut,gt=1<<(Ct=tt)-ye;15>Ct&&!(0>=(gt-=Re[Ct]));)++Ct,gt<<=1;ut+=Ut=1<<(gt=Ct-ye),ue[fe+(Ct=Gt&yt)].g=gt+ye,ue[fe+Ct].value=xt-fe-Ct}_e.g=tt-ye,_e.value=et[ze++],W(ue,xt+(Gt>>ye),Le,Ut,_e),Gt=I(Gt,tt)}}return $t!=2*Be[15]-1?0:ut}(g,j,q,Y,re,ce)}function D(){this.value=this.g=0}function R(){this.value=this.g=0}function F(){this.G=s(5,D),this.H=o(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=s(ca,R)}function z(g,j,q,Y){t(g!=null),t(j!=null),t(2147483648>Y),g.Ca=254,g.I=0,g.b=-8,g.Ka=0,g.oa=j,g.pa=q,g.Jd=j,g.Yc=q+Y,g.Zc=4<=Y?q+Y-4+1:q,le(g)}function K(g,j){for(var q=0;0<j--;)q|=ae(g,128)<<j;return q}function J(g,j){var q=K(g,j);return oe(g)?-q:q}function L(g,j,q,Y){var re,ce=0;for(t(g!=null),t(j!=null),t(4294967288>Y),g.Sb=Y,g.Ra=0,g.u=0,g.h=0,4<Y&&(Y=4),re=0;re<Y;++re)ce+=j[q+re]<<8*re;g.Ra=ce,g.bb=Y,g.oa=j,g.pa=q}function k(g){for(;8<=g.u&&g.bb<g.Sb;)g.Ra>>>=8,g.Ra+=g.oa[g.pa+g.bb]<<pe-8>>>0,++g.bb,g.u-=8;H(g)&&(g.h=1,g.u=0)}function $(g,j){if(t(0<=j),!g.h&&j<=de){var q=M(g)&El[j];return g.u+=j,k(g),q}return g.h=1,g.u=0}function X(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function C(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function M(g){return g.Ra>>>(g.u&pe-1)>>>0}function H(g){return t(g.bb<=g.Sb),g.h||g.bb==g.Sb&&g.u>pe}function U(g,j){g.u=j,g.h=H(g)}function te(g){g.u>=Te&&(t(g.u>=Te),k(g))}function le(g){t(g!=null&&g.oa!=null),g.pa<g.Zc?(g.I=(g.oa[g.pa++]|g.I<<8)>>>0,g.b+=8):(t(g!=null&&g.oa!=null),g.pa<g.Yc?(g.b+=8,g.I=g.oa[g.pa++]|g.I<<8):g.Ka?g.b=0:(g.I<<=8,g.b+=8,g.Ka=1))}function oe(g){return K(g,1)}function ae(g,j){var q=g.Ca;0>g.b&&le(g);var Y=g.b,re=q*j>>>8,ce=(g.I>>>Y>re)+0;for(ce?(q-=re,g.I-=re+1<<Y>>>0):q=re+1,Y=q,re=0;256<=Y;)re+=8,Y>>=8;return Y=7^re+ke[Y],g.b-=Y,g.Ca=(q<<Y)-1,ce}function he(g,j,q){g[j+0]=q>>24&255,g[j+1]=q>>16&255,g[j+2]=q>>8&255,g[j+3]=q>>0&255}function me(g,j){return g[j+0]<<0|g[j+1]<<8}function Q(g,j){return me(g,j)|g[j+2]<<16}function G(g,j){return me(g,j)|me(g,j+2)<<16}function ee(g,j){var q=1<<j;return t(g!=null),t(0<j),g.X=o(q),g.X==null?0:(g.Mb=32-j,g.Xa=j,1)}function se(g,j){t(g!=null),t(j!=null),t(g.Xa==j.Xa),n(j.X,0,g.X,0,1<<j.Xa)}function V(){this.X=[],this.Xa=this.Mb=0}function Ge(g,j,q,Y){t(q!=null),t(Y!=null);var re=q[0],ce=Y[0];return re==0&&(re=(g*ce+j/2)/j),ce==0&&(ce=(j*re+g/2)/g),0>=re||0>=ce?0:(q[0]=re,Y[0]=ce,1)}function De(g,j){return g+(1<<j)-1>>>j}function Fe(g,j){return((4278255360&g)+(4278255360&j)>>>0&4278255360)+((16711935&g)+(16711935&j)>>>0&16711935)>>>0}function Xe(g,j){S[j]=function(q,Y,re,ce,ue,fe,ye){var _e;for(_e=0;_e<ue;++_e){var Le=S[g](fe[ye+_e-1],re,ce+_e);fe[ye+_e]=Fe(q[Y+_e],Le)}}}function it(){this.ud=this.hd=this.jd=0}function lt(g,j){return((4278124286&(g^j))>>>1)+(g&j)>>>0}function vt(g){return 0<=g&&256>g?g:0>g?0:255<g?255:void 0}function Ye(g,j){return vt(g+(g-j+.5>>1))}function Ze(g,j,q){return Math.abs(j-q)-Math.abs(g-q)}function We(g,j,q,Y,re,ce,ue){for(Y=ce[ue-1],q=0;q<re;++q)ce[ue+q]=Y=Fe(g[j+q],Y)}function wt(g,j,q,Y,re){var ce;for(ce=0;ce<q;++ce){var ue=g[j+ce],fe=ue>>8&255,ye=16711935&(ye=(ye=16711935&ue)+((fe<<16)+fe));Y[re+ce]=(4278255360&ue)+ye>>>0}}function Nt(g,j){j.jd=g>>0&255,j.hd=g>>8&255,j.ud=g>>16&255}function kt(g,j,q,Y,re,ce){var ue;for(ue=0;ue<Y;++ue){var fe=j[q+ue],ye=fe>>>8,_e=fe,Le=255&(Le=(Le=fe>>>16)+((g.jd<<24>>24)*(ye<<24>>24)>>>5));_e=255&(_e=(_e=_e+((g.hd<<24>>24)*(ye<<24>>24)>>>5))+((g.ud<<24>>24)*(Le<<24>>24)>>>5)),re[ce+ue]=(4278255360&fe)+(Le<<16)+_e}}function Wt(g,j,q,Y,re){S[j]=function(ce,ue,fe,ye,_e,Le,et,tt,ze){for(ye=et;ye<tt;++ye)for(et=0;et<ze;++et)_e[Le++]=re(fe[Y(ce[ue++])])},S[g]=function(ce,ue,fe,ye,_e,Le,et){var tt=8>>ce.b,ze=ce.Ea,xt=ce.K[0],ut=ce.w;if(8>tt)for(ce=(1<<ce.b)-1,ut=(1<<tt)-1;ue<fe;++ue){var Re,Be=0;for(Re=0;Re<ze;++Re)Re&ce||(Be=Y(ye[_e++])),Le[et++]=re(xt[Be&ut]),Be>>=tt}else S["VP8LMapColor"+q](ye,_e,xt,ut,Le,et,ue,fe,ze)}}function jt(g,j,q,Y,re){for(q=j+q;j<q;){var ce=g[j++];Y[re++]=ce>>16&255,Y[re++]=ce>>8&255,Y[re++]=ce>>0&255}}function ur(g,j,q,Y,re){for(q=j+q;j<q;){var ce=g[j++];Y[re++]=ce>>16&255,Y[re++]=ce>>8&255,Y[re++]=ce>>0&255,Y[re++]=ce>>24&255}}function $e(g,j,q,Y,re){for(q=j+q;j<q;){var ce=(ue=g[j++])>>16&240|ue>>12&15,ue=ue>>0&240|ue>>28&15;Y[re++]=ce,Y[re++]=ue}}function He(g,j,q,Y,re){for(q=j+q;j<q;){var ce=(ue=g[j++])>>16&248|ue>>13&7,ue=ue>>5&224|ue>>3&31;Y[re++]=ce,Y[re++]=ue}}function Je(g,j,q,Y,re){for(q=j+q;j<q;){var ce=g[j++];Y[re++]=ce>>0&255,Y[re++]=ce>>8&255,Y[re++]=ce>>16&255}}function Ue(g,j,q,Y,re,ce){if(ce==0)for(q=j+q;j<q;)he(Y,((ce=g[j++])[0]>>24|ce[1]>>8&65280|ce[2]<<8&16711680|ce[3]<<24)>>>0),re+=32;else n(Y,re,g,j,q)}function pt(g,j){S[j][0]=S[g+"0"],S[j][1]=S[g+"1"],S[j][2]=S[g+"2"],S[j][3]=S[g+"3"],S[j][4]=S[g+"4"],S[j][5]=S[g+"5"],S[j][6]=S[g+"6"],S[j][7]=S[g+"7"],S[j][8]=S[g+"8"],S[j][9]=S[g+"9"],S[j][10]=S[g+"10"],S[j][11]=S[g+"11"],S[j][12]=S[g+"12"],S[j][13]=S[g+"13"],S[j][14]=S[g+"0"],S[j][15]=S[g+"0"]}function at(g){return g==By||g==Uy||g==Zp||g==zy}function St(){this.eb=[],this.size=this.A=this.fb=0}function It(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Yt(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new St,this.f.kb=new It,this.sd=null}function Sr(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Mr(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function nr(g){return alert("todo:WebPSamplerProcessPlane"),g.T}function Cr(g,j){var q=g.T,Y=j.ba.f.RGBA,re=Y.eb,ce=Y.fb+g.ka*Y.A,ue=qo[j.ba.S],fe=g.y,ye=g.O,_e=g.f,Le=g.N,et=g.ea,tt=g.W,ze=j.cc,xt=j.dc,ut=j.Mc,Re=j.Nc,Be=g.ka,gt=g.ka+g.T,Ct=g.U,yt=Ct+1>>1;for(Be==0?ue(fe,ye,null,null,_e,Le,et,tt,_e,Le,et,tt,re,ce,null,null,Ct):(ue(j.ec,j.fc,fe,ye,ze,xt,ut,Re,_e,Le,et,tt,re,ce-Y.A,re,ce,Ct),++q);Be+2<gt;Be+=2)ze=_e,xt=Le,ut=et,Re=tt,Le+=g.Rc,tt+=g.Rc,ce+=2*Y.A,ue(fe,(ye+=2*g.fa)-g.fa,fe,ye,ze,xt,ut,Re,_e,Le,et,tt,re,ce-Y.A,re,ce,Ct);return ye+=g.fa,g.j+gt<g.o?(n(j.ec,j.fc,fe,ye,Ct),n(j.cc,j.dc,_e,Le,yt),n(j.Mc,j.Nc,et,tt,yt),q--):1&gt||ue(fe,ye,null,null,_e,Le,et,tt,_e,Le,et,tt,re,ce+Y.A,null,null,Ct),q}function Dr(g,j,q){var Y=g.F,re=[g.J];if(Y!=null){var ce=g.U,ue=j.ba.S,fe=ue==Jp||ue==Zp;j=j.ba.f.RGBA;var ye=[0],_e=g.ka;ye[0]=g.T,g.Kb&&(_e==0?--ye[0]:(--_e,re[0]-=g.width),g.j+g.ka+g.T==g.o&&(ye[0]=g.o-g.j-_e));var Le=j.eb;_e=j.fb+_e*j.A,g=Mn(Y,re[0],g.width,ce,ye,Le,_e+(fe?0:3),j.A),t(q==ye),g&&at(ue)&&Lo(Le,_e,fe,ce,ye,j.A)}return 0}function fn(g){var j=g.ma,q=j.ba.S,Y=11>q,re=q==Qp||q==Xp||q==Jp||q==$y||q==12||at(q);if(j.memory=null,j.Ib=null,j.Jb=null,j.Nd=null,!gc(j.Oa,g,re?11:12))return 0;if(re&&at(q)&&At(),g.da)alert("todo:use_scaling");else{if(Y){if(j.Ib=nr,g.Kb){if(q=g.U+1>>1,j.memory=o(g.U+2*q),j.memory==null)return 0;j.ec=j.memory,j.fc=0,j.cc=j.ec,j.dc=j.fc+g.U,j.Mc=j.cc,j.Nc=j.dc+q,j.Ib=Cr,At()}}else alert("todo:EmitYUV");re&&(j.Jb=Dr,Y&&Ke())}if(Y&&!MS){for(g=0;256>g;++g)FR[g]=89858*(g-128)+tm>>em,UR[g]=-22014*(g-128)+tm,BR[g]=-45773*(g-128),$R[g]=113618*(g-128)+tm>>em;for(g=Qd;g<Vy;++g)j=76283*(g-16)+tm>>em,zR[g-Qd]=ki(j,255),WR[g-Qd]=ki(j+8>>4,15);MS=1}return 1}function Oa(g){var j=g.ma,q=g.U,Y=g.T;return t(!(1&g.ka)),0>=q||0>=Y?0:(q=j.Ib(g,j),j.Jb!=null&&j.Jb(g,j,q),j.Dc+=q,1)}function En(g){g.ma.memory=null}function er(g,j,q,Y){return $(g,8)!=47?0:(j[0]=$(g,14)+1,q[0]=$(g,14)+1,Y[0]=$(g,1),$(g,3)!=0?0:!g.h)}function Jr(g,j){if(4>g)return g+1;var q=g-2>>1;return(2+(1&g)<<q)+$(j,q)+1}function Vn(g,j){return 120<j?j-120:1<=(q=((q=CR[j-1])>>4)*g+(8-(15&q)))?q:1;var q}function In(g,j,q){var Y=M(q),re=g[j+=255&Y].g-8;return 0<re&&(U(q,q.u+8),Y=M(q),j+=g[j].value,j+=Y&(1<<re)-1),U(q,q.u+g[j].g),g[j].value}function Yr(g,j,q){return q.g+=g.g,q.value+=g.value<<j>>>0,t(8>=q.g),g.g}function Kr(g,j,q){var Y=g.xc;return t((j=Y==0?0:g.vc[g.md*(q>>Y)+(j>>Y)])<g.Wb),g.Ya[j]}function je(g,j,q,Y){var re=g.ab,ce=g.c*j,ue=g.C;j=ue+j;var fe=q,ye=Y;for(Y=g.Ta,q=g.Ua;0<re--;){var _e=g.gc[re],Le=ue,et=j,tt=fe,ze=ye,xt=(ye=Y,fe=q,_e.Ea);switch(t(Le<et),t(et<=_e.nc),_e.hc){case 2:Bt(tt,ze,(et-Le)*xt,ye,fe);break;case 0:var ut=Le,Re=et,Be=ye,gt=fe,Ct=(Ut=_e).Ea;ut==0&&(nt(tt,ze,null,null,1,Be,gt),We(tt,ze+1,0,0,Ct-1,Be,gt+1),ze+=Ct,gt+=Ct,++ut);for(var yt=1<<Ut.b,Gt=yt-1,$t=De(Ct,Ut.b),vr=Ut.K,Ut=Ut.w+(ut>>Ut.b)*$t;ut<Re;){var pn=vr,_n=Ut,nn=1;for(_t(tt,ze,Be,gt-Ct,1,Be,gt);nn<Ct;){var Xr=(nn&~Gt)+yt;Xr>Ct&&(Xr=Ct),(0,Hi[pn[_n++]>>8&15])(tt,ze+ +nn,Be,gt+nn-Ct,Xr-nn,Be,gt+nn),nn=Xr}ze+=Ct,gt+=Ct,++ut&Gt||(Ut+=$t)}et!=_e.nc&&n(ye,fe-xt,ye,fe+(et-Le-1)*xt,xt);break;case 1:for(xt=tt,Re=ze,Ct=(tt=_e.Ea)-(gt=tt&~(Be=(ze=1<<_e.b)-1)),ut=De(tt,_e.b),yt=_e.K,_e=_e.w+(Le>>_e.b)*ut;Le<et;){for(Gt=yt,$t=_e,vr=new it,Ut=Re+gt,pn=Re+tt;Re<Ut;)Nt(Gt[$t++],vr),Ws(vr,xt,Re,ze,ye,fe),Re+=ze,fe+=ze;Re<pn&&(Nt(Gt[$t++],vr),Ws(vr,xt,Re,Ct,ye,fe),Re+=Ct,fe+=Ct),++Le&Be||(_e+=ut)}break;case 3:if(tt==ye&&ze==fe&&0<_e.b){for(Re=ye,tt=xt=fe+(et-Le)*xt-(gt=(et-Le)*De(_e.Ea,_e.b)),ze=ye,Be=fe,ut=[],gt=(Ct=gt)-1;0<=gt;--gt)ut[gt]=ze[Be+gt];for(gt=Ct-1;0<=gt;--gt)Re[tt+gt]=ut[gt];Dt(_e,Le,et,ye,xt,ye,fe)}else Dt(_e,Le,et,tt,ze,ye,fe)}fe=Y,ye=q}ye!=q&&n(Y,q,fe,ye,ce)}function Ve(g,j){var q=g.V,Y=g.Ba+g.c*g.C,re=j-g.C;if(t(j<=g.l.o),t(16>=re),0<re){var ce=g.l,ue=g.Ta,fe=g.Ua,ye=ce.width;if(je(g,re,q,Y),re=fe=[fe],t((q=g.C)<(Y=j)),t(ce.v<ce.va),Y>ce.o&&(Y=ce.o),q<ce.j){var _e=ce.j-q;q=ce.j,re[0]+=_e*ye}if(q>=Y?q=0:(re[0]+=4*ce.v,ce.ka=q-ce.j,ce.U=ce.va-ce.v,ce.T=Y-q,q=1),q){if(fe=fe[0],11>(q=g.ca).S){var Le=q.f.RGBA,et=(Y=q.S,re=ce.U,ce=ce.T,_e=Le.eb,Le.A),tt=ce;for(Le=Le.fb+g.Ma*Le.A;0<tt--;){var ze=ue,xt=fe,ut=re,Re=_e,Be=Le;switch(Y){case Kp:Vi(ze,xt,ut,Re,Be);break;case Qp:Ti(ze,xt,ut,Re,Be);break;case By:Ti(ze,xt,ut,Re,Be),Lo(Re,Be,0,ut,1,0);break;case AS:Vs(ze,xt,ut,Re,Be);break;case Xp:Ue(ze,xt,ut,Re,Be,1);break;case Uy:Ue(ze,xt,ut,Re,Be,1),Lo(Re,Be,0,ut,1,0);break;case Jp:Ue(ze,xt,ut,Re,Be,0);break;case Zp:Ue(ze,xt,ut,Re,Be,0),Lo(Re,Be,1,ut,1,0);break;case $y:Il(ze,xt,ut,Re,Be);break;case zy:Il(ze,xt,ut,Re,Be),Dn(Re,Be,ut,1,0);break;case PS:Hs(ze,xt,ut,Re,Be);break;default:t(0)}fe+=ye,Le+=et}g.Ma+=ce}else alert("todo:EmitRescaledRowsYUVA");t(g.Ma<=q.height)}}g.C=j,t(g.C<=g.i)}function ot(g){var j;if(0<g.ua)return 0;for(j=0;j<g.Wb;++j){var q=g.Ya[j].G,Y=g.Ya[j].H;if(0<q[1][Y[1]+0].g||0<q[2][Y[2]+0].g||0<q[3][Y[3]+0].g)return 0}return 1}function Oe(g,j,q,Y,re,ce){if(g.Z!=0){var ue=g.qd,fe=g.rd;for(t(Ll[g.Z]!=null);j<q;++j)Ll[g.Z](ue,fe,Y,re,Y,re,ce),ue=Y,fe=re,re+=ce;g.qd=ue,g.rd=fe}}function qe(g,j){var q=g.l.ma,Y=q.Z==0||q.Z==1?g.l.j:g.C;if(Y=g.C<Y?Y:g.C,t(j<=g.l.o),j>Y){var re=g.l.width,ce=q.ca,ue=q.tb+re*Y,fe=g.V,ye=g.Ba+g.c*Y,_e=g.gc;t(g.ab==1),t(_e[0].hc==3),Kn(_e[0],Y,j,fe,ye,ce,ue),Oe(q,Y,j,ce,ue,re)}g.C=g.Ma=j}function rt(g,j,q,Y,re,ce,ue){var fe=g.$/Y,ye=g.$%Y,_e=g.m,Le=g.s,et=q+g.$,tt=et;re=q+Y*re;var ze=q+Y*ce,xt=280+Le.ua,ut=g.Pb?fe:16777216,Re=0<Le.ua?Le.Wa:null,Be=Le.wc,gt=et<ze?Kr(Le,ye,fe):null;t(g.C<ce),t(ze<=re);var Ct=!1;e:for(;;){for(;Ct||et<ze;){var yt=0;if(fe>=ut){var Gt=et-q;t((ut=g).Pb),ut.wd=ut.m,ut.xd=Gt,0<ut.s.ua&&se(ut.s.Wa,ut.s.vb),ut=fe+PR}if(ye&Be||(gt=Kr(Le,ye,fe)),t(gt!=null),gt.Qb&&(j[et]=gt.qb,Ct=!0),!Ct)if(te(_e),gt.jc){yt=_e,Gt=j;var $t=et,vr=gt.pd[M(yt)&ca-1];t(gt.jc),256>vr.g?(U(yt,yt.u+vr.g),Gt[$t]=vr.value,yt=0):(U(yt,yt.u+vr.g-256),t(256<=vr.value),yt=vr.value),yt==0&&(Ct=!0)}else yt=In(gt.G[0],gt.H[0],_e);if(_e.h)break;if(Ct||256>yt){if(!Ct)if(gt.nd)j[et]=(gt.qb|yt<<8)>>>0;else{if(te(_e),Ct=In(gt.G[1],gt.H[1],_e),te(_e),Gt=In(gt.G[2],gt.H[2],_e),$t=In(gt.G[3],gt.H[3],_e),_e.h)break;j[et]=($t<<24|Ct<<16|yt<<8|Gt)>>>0}if(Ct=!1,++et,++ye>=Y&&(ye=0,++fe,ue!=null&&fe<=ce&&!(fe%16)&&ue(g,fe),Re!=null))for(;tt<et;)yt=j[tt++],Re.X[(506832829*yt&4294967295)>>>Re.Mb]=yt}else if(280>yt){if(yt=Jr(yt-256,_e),Gt=In(gt.G[4],gt.H[4],_e),te(_e),Gt=Vn(Y,Gt=Jr(Gt,_e)),_e.h)break;if(et-q<Gt||re-et<yt)break e;for($t=0;$t<yt;++$t)j[et+$t]=j[et+$t-Gt];for(et+=yt,ye+=yt;ye>=Y;)ye-=Y,++fe,ue!=null&&fe<=ce&&!(fe%16)&&ue(g,fe);if(t(et<=re),ye&Be&&(gt=Kr(Le,ye,fe)),Re!=null)for(;tt<et;)yt=j[tt++],Re.X[(506832829*yt&4294967295)>>>Re.Mb]=yt}else{if(!(yt<xt))break e;for(Ct=yt-280,t(Re!=null);tt<et;)yt=j[tt++],Re.X[(506832829*yt&4294967295)>>>Re.Mb]=yt;yt=et,t(!(Ct>>>(Gt=Re).Xa)),j[yt]=Gt.X[Ct],Ct=!0}Ct||t(_e.h==H(_e))}if(g.Pb&&_e.h&&et<re)t(g.m.h),g.a=5,g.m=g.wd,g.$=g.xd,0<g.s.ua&&se(g.s.vb,g.s.Wa);else{if(_e.h)break e;ue?.(g,fe>ce?ce:fe),g.a=0,g.$=et-q}return 1}return g.a=3,0}function Pt(g){t(g!=null),g.vc=null,g.yc=null,g.Ya=null;var j=g.Wa;j!=null&&(j.X=null),g.vb=null,t(g!=null)}function Kt(){var g=new Oi;return g==null?null:(g.a=0,g.xb=TS,pt("Predictor","VP8LPredictors"),pt("Predictor","VP8LPredictors_C"),pt("PredictorAdd","VP8LPredictorsAdd"),pt("PredictorAdd","VP8LPredictorsAdd_C"),Bt=wt,Ws=kt,Vi=jt,Ti=ur,Il=$e,Hs=He,Vs=Je,S.VP8LMapColor32b=dr,S.VP8LMapColor8b=va,g)}function ar(g,j,q,Y,re){var ce=1,ue=[g],fe=[j],ye=Y.m,_e=Y.s,Le=null,et=0;e:for(;;){if(q)for(;ce&&$(ye,1);){var tt=ue,ze=fe,xt=Y,ut=1,Re=xt.m,Be=xt.gc[xt.ab],gt=$(Re,2);if(xt.Oc&1<<gt)ce=0;else{switch(xt.Oc|=1<<gt,Be.hc=gt,Be.Ea=tt[0],Be.nc=ze[0],Be.K=[null],++xt.ab,t(4>=xt.ab),gt){case 0:case 1:Be.b=$(Re,3)+2,ut=ar(De(Be.Ea,Be.b),De(Be.nc,Be.b),0,xt,Be.K),Be.K=Be.K[0];break;case 3:var Ct,yt=$(Re,8)+1,Gt=16<yt?0:4<yt?1:2<yt?2:3;if(tt[0]=De(Be.Ea,Gt),Be.b=Gt,Ct=ut=ar(yt,1,0,xt,Be.K)){var $t,vr=yt,Ut=Be,pn=1<<(8>>Ut.b),_n=o(pn);if(_n==null)Ct=0;else{var nn=Ut.K[0],Xr=Ut.w;for(_n[0]=Ut.K[0][0],$t=1;$t<1*vr;++$t)_n[$t]=Fe(nn[Xr+$t],_n[$t-1]);for(;$t<4*pn;++$t)_n[$t]=0;Ut.K[0]=null,Ut.K[0]=_n,Ct=1}}ut=Ct;break;case 2:break;default:t(0)}ce=ut}}if(ue=ue[0],fe=fe[0],ce&&$(ye,1)&&!(ce=1<=(et=$(ye,4))&&11>=et)){Y.a=3;break e}var Pn;if(Pn=ce)t:{var Sn,Br,Da,Gi=Y,Ma=ue,Yi=fe,wn=et,po=q,mo=Gi.m,Qa=Gi.s,li=[null],Ii=1,Fo=0,ms=AR[wn];r:for(;;){if(po&&$(mo,1)){var Xa=$(mo,3)+2,Qs=De(Ma,Xa),_c=De(Yi,Xa),mu=Qs*_c;if(!ar(Qs,_c,0,Gi,li))break r;for(li=li[0],Qa.xc=Xa,Sn=0;Sn<mu;++Sn){var Rl=li[Sn]>>8&65535;li[Sn]=Rl,Rl>=Ii&&(Ii=Rl+1)}}if(mo.h)break r;for(Br=0;5>Br;++Br){var ua=OS[Br];!Br&&0<wn&&(ua+=1<<wn),Fo<ua&&(Fo=ua)}var Gy=s(Ii*ms,D),qS=Ii,FS=s(qS,F);if(FS==null)var nm=null;else t(65536>=qS),nm=FS;var Xd=o(Fo);if(nm==null||Xd==null||Gy==null){Gi.a=1;break r}var am=Gy;for(Sn=Da=0;Sn<Ii;++Sn){var Xo=nm[Sn],gu=Xo.G,vu=Xo.H,$S=0,im=1,BS=0;for(Br=0;5>Br;++Br){ua=OS[Br],gu[Br]=am,vu[Br]=Da,!Br&&0<wn&&(ua+=1<<wn);a:{var om,Yy=ua,sm=Gi,Jd=Xd,GR=am,YR=Da,Ky=0,ql=sm.m,KR=$(ql,1);if(a(Jd,0,0,Yy),KR){var QR=$(ql,1)+1,XR=$(ql,1),US=$(ql,XR==0?1:8);Jd[US]=1,QR==2&&(Jd[US=$(ql,8)]=1);var lm=1}else{var zS=o(19),WS=$(ql,4)+4;if(19<WS){sm.a=3;var cm=0;break a}for(om=0;om<WS;++om)zS[SR[om]]=$(ql,3);var Qy=void 0,Zd=void 0,HS=sm,JR=zS,um=Yy,VS=Jd,Xy=0,Fl=HS.m,GS=8,YS=s(128,D);n:for(;O(YS,0,7,JR,19);){if($(Fl,1)){var ZR=2+2*$(Fl,3);if((Qy=2+$(Fl,ZR))>um)break n}else Qy=um;for(Zd=0;Zd<um&&Qy--;){te(Fl);var KS=YS[0+(127&M(Fl))];U(Fl,Fl.u+KS.g);var yu=KS.value;if(16>yu)VS[Zd++]=yu,yu!=0&&(GS=yu);else{var e8=yu==16,QS=yu-16,t8=wR[QS],XS=$(Fl,_R[QS])+t8;if(Zd+XS>um)break n;for(var r8=e8?GS:0;0<XS--;)VS[Zd++]=r8}}Xy=1;break n}Xy||(HS.a=3),lm=Xy}(lm=lm&&!ql.h)&&(Ky=O(GR,YR,8,Jd,Yy)),lm&&Ky!=0?cm=Ky:(sm.a=3,cm=0)}if(cm==0)break r;if(im&&jR[Br]==1&&(im=am[Da].g==0),$S+=am[Da].g,Da+=cm,3>=Br){var ef,Jy=Xd[0];for(ef=1;ef<ua;++ef)Xd[ef]>Jy&&(Jy=Xd[ef]);BS+=Jy}}if(Xo.nd=im,Xo.Qb=0,im&&(Xo.qb=(gu[3][vu[3]+0].value<<24|gu[1][vu[1]+0].value<<16|gu[2][vu[2]+0].value)>>>0,$S==0&&256>gu[0][vu[0]+0].value&&(Xo.Qb=1,Xo.qb+=gu[0][vu[0]+0].value<<8)),Xo.jc=!Xo.Qb&&6>BS,Xo.jc){var dm,Xs=Xo;for(dm=0;dm<ca;++dm){var $l=dm,Bl=Xs.pd[$l],fm=Xs.G[0][Xs.H[0]+$l];256<=fm.value?(Bl.g=fm.g+256,Bl.value=fm.value):(Bl.g=0,Bl.value=0,$l>>=Yr(fm,8,Bl),$l>>=Yr(Xs.G[1][Xs.H[1]+$l],16,Bl),$l>>=Yr(Xs.G[2][Xs.H[2]+$l],0,Bl),Yr(Xs.G[3][Xs.H[3]+$l],24,Bl))}}}Qa.vc=li,Qa.Wb=Ii,Qa.Ya=nm,Qa.yc=Gy,Pn=1;break t}Pn=0}if(!(ce=Pn)){Y.a=3;break e}if(0<et){if(_e.ua=1<<et,!ee(_e.Wa,et)){Y.a=1,ce=0;break e}}else _e.ua=0;var Zy=Y,JS=ue,n8=fe,ex=Zy.s,tx=ex.xc;if(Zy.c=JS,Zy.i=n8,ex.md=De(JS,tx),ex.wc=tx==0?-1:(1<<tx)-1,q){Y.xb=DR;break e}if((Le=o(ue*fe))==null){Y.a=1,ce=0;break e}ce=(ce=rt(Y,Le,0,ue,fe,fe,null))&&!ye.h;break e}return ce?(re!=null?re[0]=Le:(t(Le==null),t(q)),Y.$=0,q||Pt(_e)):Pt(_e),ce}function kr(g,j){var q=g.c*g.i,Y=q+j+16*j;return t(g.c<=j),g.V=o(Y),g.V==null?(g.Ta=null,g.Ua=0,g.a=1,0):(g.Ta=g.V,g.Ua=g.Ba+q+j,1)}function rn(g,j){var q=g.C,Y=j-q,re=g.V,ce=g.Ba+g.c*q;for(t(j<=g.l.o);0<Y;){var ue=16<Y?16:Y,fe=g.l.ma,ye=g.l.width,_e=ye*ue,Le=fe.ca,et=fe.tb+ye*q,tt=g.Ta,ze=g.Ua;je(g,ue,re,ce),xa(tt,ze,Le,et,_e),Oe(fe,q,q+ue,Le,et,ye),Y-=ue,re+=ue*g.c,q+=ue}t(q==j),g.C=g.Ma=j}function Vr(){this.ub=this.yd=this.td=this.Rb=0}function $n(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function ka(){this.Fb=this.Bb=this.Cb=0,this.Zb=o(4),this.Lb=o(4)}function Ya(){this.Yb=function(){var g=[];return function j(q,Y,re){for(var ce=re[Y],ue=0;ue<ce&&(q.push(re.length>Y+1?[]:0),!(re.length<Y+1));ue++)j(q[ue],Y+1,re)}(g,0,[3,11]),g}()}function to(){this.jb=o(3),this.Wc=l([4,8],Ya),this.Xc=l([4,17],Ya)}function qi(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new o(4),this.od=new o(4)}function Gn(){this.ld=this.La=this.dd=this.tc=0}function hi(){this.Na=this.la=0}function ro(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Qe(){this.ad=o(384),this.Za=0,this.Ob=o(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Vt(){this.uc=this.M=this.Nb=0,this.wa=Array(new Gn),this.Y=0,this.ya=Array(new Qe),this.aa=0,this.l=new Er}function or(){this.y=o(16),this.f=o(8),this.ea=o(8)}function Fr(){this.cb=this.a=0,this.sc="",this.m=new X,this.Od=new Vr,this.Kc=new $n,this.ed=new qi,this.Qa=new ka,this.Ic=this.$c=this.Aa=0,this.D=new Vt,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=s(8,X),this.ia=0,this.pb=s(4,ro),this.Pa=new to,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new or),this.Hd=0,this.rb=Array(new hi),this.sb=0,this.wa=Array(new Gn),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Qe),this.L=this.aa=0,this.gd=l([4,2],Gn),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Er(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function jn(){var g=new Fr;return g!=null&&(g.a=0,g.sc="OK",g.cb=0,g.Xb=0,Kd||(Kd=Ta)),g}function Lr(g,j,q){return g.a==0&&(g.a=j,g.sc=q,g.cb=0),0}function ra(g,j,q){return 3<=q&&g[j+0]==157&&g[j+1]==1&&g[j+2]==42}function bn(g,j){if(g==null)return 0;if(g.a=0,g.sc="OK",j==null)return Lr(g,2,"null VP8Io passed to VP8GetHeaders()");var q=j.data,Y=j.w,re=j.ha;if(4>re)return Lr(g,7,"Truncated header.");var ce=q[Y+0]|q[Y+1]<<8|q[Y+2]<<16,ue=g.Od;if(ue.Rb=!(1&ce),ue.td=ce>>1&7,ue.yd=ce>>4&1,ue.ub=ce>>5,3<ue.td)return Lr(g,3,"Incorrect keyframe parameters.");if(!ue.yd)return Lr(g,4,"Frame not displayable.");Y+=3,re-=3;var fe=g.Kc;if(ue.Rb){if(7>re)return Lr(g,7,"cannot parse picture header");if(!ra(q,Y,re))return Lr(g,3,"Bad code word");fe.c=16383&(q[Y+4]<<8|q[Y+3]),fe.Td=q[Y+4]>>6,fe.i=16383&(q[Y+6]<<8|q[Y+5]),fe.Ud=q[Y+6]>>6,Y+=7,re-=7,g.za=fe.c+15>>4,g.Ub=fe.i+15>>4,j.width=fe.c,j.height=fe.i,j.Da=0,j.j=0,j.v=0,j.va=j.width,j.o=j.height,j.da=0,j.ib=j.width,j.hb=j.height,j.U=j.width,j.T=j.height,a((ce=g.Pa).jb,0,255,ce.jb.length),t((ce=g.Qa)!=null),ce.Cb=0,ce.Bb=0,ce.Fb=1,a(ce.Zb,0,0,ce.Zb.length),a(ce.Lb,0,0,ce.Lb)}if(ue.ub>re)return Lr(g,7,"bad partition length");z(ce=g.m,q,Y,ue.ub),Y+=ue.ub,re-=ue.ub,ue.Rb&&(fe.Ld=oe(ce),fe.Kd=oe(ce)),fe=g.Qa;var ye,_e=g.Pa;if(t(ce!=null),t(fe!=null),fe.Cb=oe(ce),fe.Cb){if(fe.Bb=oe(ce),oe(ce)){for(fe.Fb=oe(ce),ye=0;4>ye;++ye)fe.Zb[ye]=oe(ce)?J(ce,7):0;for(ye=0;4>ye;++ye)fe.Lb[ye]=oe(ce)?J(ce,6):0}if(fe.Bb)for(ye=0;3>ye;++ye)_e.jb[ye]=oe(ce)?K(ce,8):255}else fe.Bb=0;if(ce.Ka)return Lr(g,3,"cannot parse segment header");if((fe=g.ed).zd=oe(ce),fe.Tb=K(ce,6),fe.wb=K(ce,3),fe.Pc=oe(ce),fe.Pc&&oe(ce)){for(_e=0;4>_e;++_e)oe(ce)&&(fe.vd[_e]=J(ce,6));for(_e=0;4>_e;++_e)oe(ce)&&(fe.od[_e]=J(ce,6))}if(g.L=fe.Tb==0?0:fe.zd?1:2,ce.Ka)return Lr(g,3,"cannot parse filter header");var Le=re;if(re=ye=Y,Y=ye+Le,fe=Le,g.Xb=(1<<K(g.m,2))-1,Le<3*(_e=g.Xb))q=7;else{for(ye+=3*_e,fe-=3*_e,Le=0;Le<_e;++Le){var et=q[re+0]|q[re+1]<<8|q[re+2]<<16;et>fe&&(et=fe),z(g.Jc[+Le],q,ye,et),ye+=et,fe-=et,re+=3}z(g.Jc[+_e],q,ye,fe),q=ye<Y?0:5}if(q!=0)return Lr(g,q,"cannot parse partitions");for(q=K(ye=g.m,7),re=oe(ye)?J(ye,4):0,Y=oe(ye)?J(ye,4):0,fe=oe(ye)?J(ye,4):0,_e=oe(ye)?J(ye,4):0,ye=oe(ye)?J(ye,4):0,Le=g.Qa,et=0;4>et;++et){if(Le.Cb){var tt=Le.Zb[et];Le.Fb||(tt+=q)}else{if(0<et){g.pb[et]=g.pb[0];continue}tt=q}var ze=g.pb[et];ze.Sc[0]=Wy[ki(tt+re,127)],ze.Sc[1]=Hy[ki(tt+0,127)],ze.Eb[0]=2*Wy[ki(tt+Y,127)],ze.Eb[1]=101581*Hy[ki(tt+fe,127)]>>16,8>ze.Eb[1]&&(ze.Eb[1]=8),ze.Qc[0]=Wy[ki(tt+_e,117)],ze.Qc[1]=Hy[ki(tt+ye,127)],ze.lc=tt+ye}if(!ue.Rb)return Lr(g,4,"Not a key frame.");for(oe(ce),ue=g.Pa,q=0;4>q;++q){for(re=0;8>re;++re)for(Y=0;3>Y;++Y)for(fe=0;11>fe;++fe)_e=ae(ce,IR[q][re][Y][fe])?K(ce,8):TR[q][re][Y][fe],ue.Wc[q][re].Yb[Y][fe]=_e;for(re=0;17>re;++re)ue.Xc[q][re]=ue.Wc[q][NR[re]]}return g.kc=oe(ce),g.kc&&(g.Bd=K(ce,8)),g.cb=1}function Ta(g,j,q,Y,re,ce,ue){var fe=j[re].Yb[q];for(q=0;16>re;++re){if(!ae(g,fe[q+0]))return re;for(;!ae(g,fe[q+1]);)if(fe=j[++re].Yb[0],q=0,re==16)return 16;var ye=j[re+1].Yb;if(ae(g,fe[q+2])){var _e=g,Le=0;if(ae(_e,(tt=fe)[(et=q)+3]))if(ae(_e,tt[et+6])){for(fe=0,et=2*(Le=ae(_e,tt[et+8]))+(tt=ae(_e,tt[et+9+Le])),Le=0,tt=OR[et];tt[fe];++fe)Le+=Le+ae(_e,tt[fe]);Le+=3+(8<<et)}else ae(_e,tt[et+7])?(Le=7+2*ae(_e,165),Le+=ae(_e,145)):Le=5+ae(_e,159);else Le=ae(_e,tt[et+4])?3+ae(_e,tt[et+5]):2;fe=ye[2]}else Le=1,fe=ye[1];ye=ue+kR[re],0>(_e=g).b&&le(_e);var et,tt=_e.b,ze=(et=_e.Ca>>1)-(_e.I>>tt)>>31;--_e.b,_e.Ca+=ze,_e.Ca|=1,_e.I-=(et+1&ze)<<tt,ce[ye]=((Le^ze)-ze)*Y[(0<re)+0]}return 16}function Ea(g){var j=g.rb[g.sb-1];j.la=0,j.Na=0,a(g.zc,0,0,g.zc.length),g.ja=0}function ni(g,j){if(g==null)return 0;if(j==null)return Lr(g,2,"NULL VP8Io parameter in VP8Decode().");if(!g.cb&&!bn(g,j))return 0;if(t(g.cb),j.ac==null||j.ac(j)){j.ob&&(g.L=0);var q=rm[g.L];if(g.L==2?(g.yb=0,g.zb=0):(g.yb=j.v-q>>4,g.zb=j.j-q>>4,0>g.yb&&(g.yb=0),0>g.zb&&(g.zb=0)),g.Va=j.o+15+q>>4,g.Hb=j.va+15+q>>4,g.Hb>g.za&&(g.Hb=g.za),g.Va>g.Ub&&(g.Va=g.Ub),0<g.L){var Y=g.ed;for(q=0;4>q;++q){var re;if(g.Qa.Cb){var ce=g.Qa.Lb[q];g.Qa.Fb||(ce+=Y.Tb)}else ce=Y.Tb;for(re=0;1>=re;++re){var ue=g.gd[q][re],fe=ce;if(Y.Pc&&(fe+=Y.vd[0],re&&(fe+=Y.od[0])),0<(fe=0>fe?0:63<fe?63:fe)){var ye=fe;0<Y.wb&&(ye=4<Y.wb?ye>>2:ye>>1)>9-Y.wb&&(ye=9-Y.wb),1>ye&&(ye=1),ue.dd=ye,ue.tc=2*fe+ye,ue.ld=40<=fe?2:15<=fe?1:0}else ue.tc=0;ue.La=re}}}q=0}else Lr(g,6,"Frame setup failed"),q=g.a;if(q=q==0){if(q){g.$c=0,0<g.Aa||(g.Ic=VR);e:{q=g.Ic,Y=4*(ye=g.za);var _e=32*ye,Le=ye+1,et=0<g.L?ye*(0<g.Aa?2:1):0,tt=(g.Aa==2?2:1)*ye;if((ue=Y+832+(re=3*(16*q+rm[g.L])/2*_e)+(ce=g.Fa!=null&&0<g.Fa.length?g.Kc.c*g.Kc.i:0))!=ue)q=0;else{if(ue>g.Vb){if(g.Vb=0,g.Ec=o(ue),g.Fc=0,g.Ec==null){q=Lr(g,1,"no memory during frame initialization.");break e}g.Vb=ue}ue=g.Ec,fe=g.Fc,g.Ac=ue,g.Bc=fe,fe+=Y,g.Gd=s(_e,or),g.Hd=0,g.rb=s(Le+1,hi),g.sb=1,g.wa=et?s(et,Gn):null,g.Y=0,g.D.Nb=0,g.D.wa=g.wa,g.D.Y=g.Y,0<g.Aa&&(g.D.Y+=ye),t(!0),g.oc=ue,g.pc=fe,fe+=832,g.ya=s(tt,Qe),g.aa=0,g.D.ya=g.ya,g.D.aa=g.aa,g.Aa==2&&(g.D.aa+=ye),g.R=16*ye,g.B=8*ye,ye=(_e=rm[g.L])*g.R,_e=_e/2*g.B,g.sa=ue,g.ta=fe+ye,g.qa=g.sa,g.ra=g.ta+16*q*g.R+_e,g.Ha=g.qa,g.Ia=g.ra+8*q*g.B+_e,g.$c=0,fe+=re,g.mb=ce?ue:null,g.nb=ce?fe:null,t(fe+ce<=g.Fc+g.Vb),Ea(g),a(g.Ac,g.Bc,0,Y),q=1}}if(q){if(j.ka=0,j.y=g.sa,j.O=g.ta,j.f=g.qa,j.N=g.ra,j.ea=g.Ha,j.Vd=g.Ia,j.fa=g.R,j.Rc=g.B,j.F=null,j.J=0,!Gp){for(q=-255;255>=q;++q)Ba[255+q]=0>q?-q:q;for(q=-1020;1020>=q;++q)Ys[1020+q]=-128>q?-128:127<q?127:q;for(q=-112;112>=q;++q)Yd[112+q]=-16>q?-16:15<q?15:q;for(q=-255;510>=q;++q)pu[255+q]=0>q?0:255<q?255:q;Gp=1}du=Oo,Gs=io,Hd=ji,Ei=oo,Do=pi,ya=ao,fu=Ar,Vp=zr,Vd=Yn,vc=Pi,yc=hn,Nl=aa,xc=oi,hu=Ia,bc=Ee,Dl=Me,Gd=Ne,Mo=mt,Qo[0]=Si,Qo[1]=fs,Qo[2]=Al,Qo[3]=fc,Qo[4]=Fs,Qo[5]=Ko,Qo[6]=Ci,Qo[7]=ii,Qo[8]=hc,Qo[9]=$i,Ml[0]=dc,Ml[1]=hs,Ml[2]=Ka,Ml[3]=lo,Ml[4]=Bn,Ml[5]=Yo,Ml[6]=ko,Ks[0]=Eo,Ks[1]=so,Ks[2]=$s,Ks[3]=co,Ks[4]=Ai,Ks[5]=Pl,Ks[6]=Bs,q=1}else q=0}q&&(q=function(ze,xt){for(ze.M=0;ze.M<ze.Va;++ze.M){var ut,Re=ze.Jc[ze.M&ze.Xb],Be=ze.m,gt=ze;for(ut=0;ut<gt.za;++ut){var Ct=Be,yt=gt,Gt=yt.Ac,$t=yt.Bc+4*ut,vr=yt.zc,Ut=yt.ya[yt.aa+ut];if(yt.Qa.Bb?Ut.$b=ae(Ct,yt.Pa.jb[0])?2+ae(Ct,yt.Pa.jb[2]):ae(Ct,yt.Pa.jb[1]):Ut.$b=0,yt.kc&&(Ut.Ad=ae(Ct,yt.Bd)),Ut.Za=!ae(Ct,145)+0,Ut.Za){var pn=Ut.Ob,_n=0;for(yt=0;4>yt;++yt){var nn,Xr=vr[0+yt];for(nn=0;4>nn;++nn){Xr=ER[Gt[$t+nn]][Xr];for(var Pn=kS[ae(Ct,Xr[0])];0<Pn;)Pn=kS[2*Pn+ae(Ct,Xr[Pn])];Xr=-Pn,Gt[$t+nn]=Xr}n(pn,_n,Gt,$t,4),_n+=4,vr[0+yt]=Xr}}else Xr=ae(Ct,156)?ae(Ct,128)?1:3:ae(Ct,163)?2:0,Ut.Ob[0]=Xr,a(Gt,$t,Xr,4),a(vr,0,Xr,4);Ut.Dd=ae(Ct,142)?ae(Ct,114)?ae(Ct,183)?1:3:2:0}if(gt.m.Ka)return Lr(ze,7,"Premature end-of-partition0 encountered.");for(;ze.ja<ze.za;++ze.ja){if(gt=Re,Ct=(Be=ze).rb[Be.sb-1],Gt=Be.rb[Be.sb+Be.ja],ut=Be.ya[Be.aa+Be.ja],$t=Be.kc?ut.Ad:0)Ct.la=Gt.la=0,ut.Za||(Ct.Na=Gt.Na=0),ut.Hc=0,ut.Gc=0,ut.ia=0;else{var Sn,Br;if(Ct=Gt,Gt=gt,$t=Be.Pa.Xc,vr=Be.ya[Be.aa+Be.ja],Ut=Be.pb[vr.$b],yt=vr.ad,pn=0,_n=Be.rb[Be.sb-1],Xr=nn=0,a(yt,pn,0,384),vr.Za)var Da=0,Gi=$t[3];else{Pn=o(16);var Ma=Ct.Na+_n.Na;if(Ma=Kd(Gt,$t[1],Ma,Ut.Eb,0,Pn,0),Ct.Na=_n.Na=(0<Ma)+0,1<Ma)du(Pn,0,yt,pn);else{var Yi=Pn[0]+3>>3;for(Pn=0;256>Pn;Pn+=16)yt[pn+Pn]=Yi}Da=1,Gi=$t[0]}var wn=15&Ct.la,po=15&_n.la;for(Pn=0;4>Pn;++Pn){var mo=1&po;for(Yi=Br=0;4>Yi;++Yi)wn=wn>>1|(mo=(Ma=Kd(Gt,Gi,Ma=mo+(1&wn),Ut.Sc,Da,yt,pn))>Da)<<7,Br=Br<<2|(3<Ma?3:1<Ma?2:yt[pn+0]!=0),pn+=16;wn>>=4,po=po>>1|mo<<7,nn=(nn<<8|Br)>>>0}for(Gi=wn,Da=po>>4,Sn=0;4>Sn;Sn+=2){for(Br=0,wn=Ct.la>>4+Sn,po=_n.la>>4+Sn,Pn=0;2>Pn;++Pn){for(mo=1&po,Yi=0;2>Yi;++Yi)Ma=mo+(1&wn),wn=wn>>1|(mo=0<(Ma=Kd(Gt,$t[2],Ma,Ut.Qc,0,yt,pn)))<<3,Br=Br<<2|(3<Ma?3:1<Ma?2:yt[pn+0]!=0),pn+=16;wn>>=2,po=po>>1|mo<<5}Xr|=Br<<4*Sn,Gi|=wn<<4<<Sn,Da|=(240&po)<<Sn}Ct.la=Gi,_n.la=Da,vr.Hc=nn,vr.Gc=Xr,vr.ia=43690&Xr?0:Ut.ia,$t=!(nn|Xr)}if(0<Be.L&&(Be.wa[Be.Y+Be.ja]=Be.gd[ut.$b][ut.Za],Be.wa[Be.Y+Be.ja].La|=!$t),gt.Ka)return Lr(ze,7,"Premature end-of-file encountered.")}if(Ea(ze),Be=xt,gt=1,ut=(Re=ze).D,Ct=0<Re.L&&Re.M>=Re.zb&&Re.M<=Re.Va,Re.Aa==0)e:{if(ut.M=Re.M,ut.uc=Ct,Ol(Re,ut),gt=1,ut=(Br=Re.D).Nb,Ct=(Xr=rm[Re.L])*Re.R,Gt=Xr/2*Re.B,Pn=16*ut*Re.R,Yi=8*ut*Re.B,$t=Re.sa,vr=Re.ta-Ct+Pn,Ut=Re.qa,yt=Re.ra-Gt+Yi,pn=Re.Ha,_n=Re.Ia-Gt+Yi,po=(wn=Br.M)==0,nn=wn>=Re.Va-1,Re.Aa==2&&Ol(Re,Br),Br.uc)for(mo=(Ma=Re).D.M,t(Ma.D.uc),Br=Ma.yb;Br<Ma.Hb;++Br){Da=Br,Gi=mo;var Qa=(li=(ua=Ma).D).Nb;Sn=ua.R;var li=li.wa[li.Y+Da],Ii=ua.sa,Fo=ua.ta+16*Qa*Sn+16*Da,ms=li.dd,Xa=li.tc;if(Xa!=0)if(t(3<=Xa),ua.L==1)0<Da&&Dl(Ii,Fo,Sn,Xa+4),li.La&&Mo(Ii,Fo,Sn,Xa),0<Gi&&bc(Ii,Fo,Sn,Xa+4),li.La&&Gd(Ii,Fo,Sn,Xa);else{var Qs=ua.B,_c=ua.qa,mu=ua.ra+8*Qa*Qs+8*Da,Rl=ua.Ha,ua=ua.Ia+8*Qa*Qs+8*Da;Qa=li.ld,0<Da&&(Vp(Ii,Fo,Sn,Xa+4,ms,Qa),vc(_c,mu,Rl,ua,Qs,Xa+4,ms,Qa)),li.La&&(Nl(Ii,Fo,Sn,Xa,ms,Qa),hu(_c,mu,Rl,ua,Qs,Xa,ms,Qa)),0<Gi&&(fu(Ii,Fo,Sn,Xa+4,ms,Qa),Vd(_c,mu,Rl,ua,Qs,Xa+4,ms,Qa)),li.La&&(yc(Ii,Fo,Sn,Xa,ms,Qa),xc(_c,mu,Rl,ua,Qs,Xa,ms,Qa))}}if(Re.ia&&alert("todo:DitherRow"),Be.put!=null){if(Br=16*wn,wn=16*(wn+1),po?(Be.y=Re.sa,Be.O=Re.ta+Pn,Be.f=Re.qa,Be.N=Re.ra+Yi,Be.ea=Re.Ha,Be.W=Re.Ia+Yi):(Br-=Xr,Be.y=$t,Be.O=vr,Be.f=Ut,Be.N=yt,Be.ea=pn,Be.W=_n),nn||(wn-=Xr),wn>Be.o&&(wn=Be.o),Be.F=null,Be.J=null,Re.Fa!=null&&0<Re.Fa.length&&Br<wn&&(Be.J=pc(Re,Be,Br,wn-Br),Be.F=Re.mb,Be.F==null&&Be.F.length==0)){gt=Lr(Re,3,"Could not decode alpha data.");break e}Br<Be.j&&(Xr=Be.j-Br,Br=Be.j,t(!(1&Xr)),Be.O+=Re.R*Xr,Be.N+=Re.B*(Xr>>1),Be.W+=Re.B*(Xr>>1),Be.F!=null&&(Be.J+=Be.width*Xr)),Br<wn&&(Be.O+=Be.v,Be.N+=Be.v>>1,Be.W+=Be.v>>1,Be.F!=null&&(Be.J+=Be.v),Be.ka=Br-Be.j,Be.U=Be.va-Be.v,Be.T=wn-Br,gt=Be.put(Be))}ut+1!=Re.Ic||nn||(n(Re.sa,Re.ta-Ct,$t,vr+16*Re.R,Ct),n(Re.qa,Re.ra-Gt,Ut,yt+8*Re.B,Gt),n(Re.Ha,Re.Ia-Gt,pn,_n+8*Re.B,Gt))}if(!gt)return Lr(ze,6,"Output aborted.")}return 1}(g,j)),j.bc!=null&&j.bc(j),q&=1}return q?(g.cb=0,q):0}function na(g,j,q,Y,re){re=g[j+q+32*Y]+(re>>3),g[j+q+32*Y]=-256&re?0>re?0:255:re}function An(g,j,q,Y,re,ce){na(g,j,0,q,Y+re),na(g,j,1,q,Y+ce),na(g,j,2,q,Y-ce),na(g,j,3,q,Y-re)}function Hr(g){return(20091*g>>16)+g}function no(g,j,q,Y){var re,ce=0,ue=o(16);for(re=0;4>re;++re){var fe=g[j+0]+g[j+8],ye=g[j+0]-g[j+8],_e=(35468*g[j+4]>>16)-Hr(g[j+12]),Le=Hr(g[j+4])+(35468*g[j+12]>>16);ue[ce+0]=fe+Le,ue[ce+1]=ye+_e,ue[ce+2]=ye-_e,ue[ce+3]=fe-Le,ce+=4,j++}for(re=ce=0;4>re;++re)fe=(g=ue[ce+0]+4)+ue[ce+8],ye=g-ue[ce+8],_e=(35468*ue[ce+4]>>16)-Hr(ue[ce+12]),na(q,Y,0,0,fe+(Le=Hr(ue[ce+4])+(35468*ue[ce+12]>>16))),na(q,Y,1,0,ye+_e),na(q,Y,2,0,ye-_e),na(q,Y,3,0,fe-Le),ce++,Y+=32}function ao(g,j,q,Y){var re=g[j+0]+4,ce=35468*g[j+4]>>16,ue=Hr(g[j+4]),fe=35468*g[j+1]>>16;An(q,Y,0,re+ue,g=Hr(g[j+1]),fe),An(q,Y,1,re+ce,g,fe),An(q,Y,2,re-ce,g,fe),An(q,Y,3,re-ue,g,fe)}function io(g,j,q,Y,re){no(g,j,q,Y),re&&no(g,j+16,q,Y+4)}function ji(g,j,q,Y){Gs(g,j+0,q,Y,1),Gs(g,j+32,q,Y+128,1)}function oo(g,j,q,Y){var re;for(g=g[j+0]+4,re=0;4>re;++re)for(j=0;4>j;++j)na(q,Y,j,re,g)}function pi(g,j,q,Y){g[j+0]&&Ei(g,j+0,q,Y),g[j+16]&&Ei(g,j+16,q,Y+4),g[j+32]&&Ei(g,j+32,q,Y+128),g[j+48]&&Ei(g,j+48,q,Y+128+4)}function Oo(g,j,q,Y){var re,ce=o(16);for(re=0;4>re;++re){var ue=g[j+0+re]+g[j+12+re],fe=g[j+4+re]+g[j+8+re],ye=g[j+4+re]-g[j+8+re],_e=g[j+0+re]-g[j+12+re];ce[0+re]=ue+fe,ce[8+re]=ue-fe,ce[4+re]=_e+ye,ce[12+re]=_e-ye}for(re=0;4>re;++re)ue=(g=ce[0+4*re]+3)+ce[3+4*re],fe=ce[1+4*re]+ce[2+4*re],ye=ce[1+4*re]-ce[2+4*re],_e=g-ce[3+4*re],q[Y+0]=ue+fe>>3,q[Y+16]=_e+ye>>3,q[Y+32]=ue-fe>>3,q[Y+48]=_e-ye>>3,Y+=64}function Fi(g,j,q){var Y,re=j-32,ce=ho,ue=255-g[re-1];for(Y=0;Y<q;++Y){var fe,ye=ce,_e=ue+g[j-1];for(fe=0;fe<q;++fe)g[j+fe]=ye[_e+g[re+fe]];j+=32}}function fs(g,j){Fi(g,j,4)}function so(g,j){Fi(g,j,8)}function hs(g,j){Fi(g,j,16)}function Ka(g,j){var q;for(q=0;16>q;++q)n(g,j+32*q,g,j-32,16)}function lo(g,j){var q;for(q=16;0<q;--q)a(g,j,g[j-1],16),j+=32}function ai(g,j,q){var Y;for(Y=0;16>Y;++Y)a(j,q+32*Y,g,16)}function dc(g,j){var q,Y=16;for(q=0;16>q;++q)Y+=g[j-1+32*q]+g[j+q-32];ai(Y>>5,g,j)}function Bn(g,j){var q,Y=8;for(q=0;16>q;++q)Y+=g[j-1+32*q];ai(Y>>4,g,j)}function Yo(g,j){var q,Y=8;for(q=0;16>q;++q)Y+=g[j+q-32];ai(Y>>4,g,j)}function ko(g,j){ai(128,g,j)}function br(g,j,q){return g+2*j+q+2>>2}function Al(g,j){var q,Y=j-32;for(Y=new Uint8Array([br(g[Y-1],g[Y+0],g[Y+1]),br(g[Y+0],g[Y+1],g[Y+2]),br(g[Y+1],g[Y+2],g[Y+3]),br(g[Y+2],g[Y+3],g[Y+4])]),q=0;4>q;++q)n(g,j+32*q,Y,0,Y.length)}function fc(g,j){var q=g[j-1],Y=g[j-1+32],re=g[j-1+64],ce=g[j-1+96];he(g,j+0,16843009*br(g[j-1-32],q,Y)),he(g,j+32,16843009*br(q,Y,re)),he(g,j+64,16843009*br(Y,re,ce)),he(g,j+96,16843009*br(re,ce,ce))}function Si(g,j){var q,Y=4;for(q=0;4>q;++q)Y+=g[j+q-32]+g[j-1+32*q];for(Y>>=3,q=0;4>q;++q)a(g,j+32*q,Y,4)}function Fs(g,j){var q=g[j-1+0],Y=g[j-1+32],re=g[j-1+64],ce=g[j-1-32],ue=g[j+0-32],fe=g[j+1-32],ye=g[j+2-32],_e=g[j+3-32];g[j+0+96]=br(Y,re,g[j-1+96]),g[j+1+96]=g[j+0+64]=br(q,Y,re),g[j+2+96]=g[j+1+64]=g[j+0+32]=br(ce,q,Y),g[j+3+96]=g[j+2+64]=g[j+1+32]=g[j+0+0]=br(ue,ce,q),g[j+3+64]=g[j+2+32]=g[j+1+0]=br(fe,ue,ce),g[j+3+32]=g[j+2+0]=br(ye,fe,ue),g[j+3+0]=br(_e,ye,fe)}function Ci(g,j){var q=g[j+1-32],Y=g[j+2-32],re=g[j+3-32],ce=g[j+4-32],ue=g[j+5-32],fe=g[j+6-32],ye=g[j+7-32];g[j+0+0]=br(g[j+0-32],q,Y),g[j+1+0]=g[j+0+32]=br(q,Y,re),g[j+2+0]=g[j+1+32]=g[j+0+64]=br(Y,re,ce),g[j+3+0]=g[j+2+32]=g[j+1+64]=g[j+0+96]=br(re,ce,ue),g[j+3+32]=g[j+2+64]=g[j+1+96]=br(ce,ue,fe),g[j+3+64]=g[j+2+96]=br(ue,fe,ye),g[j+3+96]=br(fe,ye,ye)}function Ko(g,j){var q=g[j-1+0],Y=g[j-1+32],re=g[j-1+64],ce=g[j-1-32],ue=g[j+0-32],fe=g[j+1-32],ye=g[j+2-32],_e=g[j+3-32];g[j+0+0]=g[j+1+64]=ce+ue+1>>1,g[j+1+0]=g[j+2+64]=ue+fe+1>>1,g[j+2+0]=g[j+3+64]=fe+ye+1>>1,g[j+3+0]=ye+_e+1>>1,g[j+0+96]=br(re,Y,q),g[j+0+64]=br(Y,q,ce),g[j+0+32]=g[j+1+96]=br(q,ce,ue),g[j+1+32]=g[j+2+96]=br(ce,ue,fe),g[j+2+32]=g[j+3+96]=br(ue,fe,ye),g[j+3+32]=br(fe,ye,_e)}function ii(g,j){var q=g[j+0-32],Y=g[j+1-32],re=g[j+2-32],ce=g[j+3-32],ue=g[j+4-32],fe=g[j+5-32],ye=g[j+6-32],_e=g[j+7-32];g[j+0+0]=q+Y+1>>1,g[j+1+0]=g[j+0+64]=Y+re+1>>1,g[j+2+0]=g[j+1+64]=re+ce+1>>1,g[j+3+0]=g[j+2+64]=ce+ue+1>>1,g[j+0+32]=br(q,Y,re),g[j+1+32]=g[j+0+96]=br(Y,re,ce),g[j+2+32]=g[j+1+96]=br(re,ce,ue),g[j+3+32]=g[j+2+96]=br(ce,ue,fe),g[j+3+64]=br(ue,fe,ye),g[j+3+96]=br(fe,ye,_e)}function $i(g,j){var q=g[j-1+0],Y=g[j-1+32],re=g[j-1+64],ce=g[j-1+96];g[j+0+0]=q+Y+1>>1,g[j+2+0]=g[j+0+32]=Y+re+1>>1,g[j+2+32]=g[j+0+64]=re+ce+1>>1,g[j+1+0]=br(q,Y,re),g[j+3+0]=g[j+1+32]=br(Y,re,ce),g[j+3+32]=g[j+1+64]=br(re,ce,ce),g[j+3+64]=g[j+2+64]=g[j+0+96]=g[j+1+96]=g[j+2+96]=g[j+3+96]=ce}function hc(g,j){var q=g[j-1+0],Y=g[j-1+32],re=g[j-1+64],ce=g[j-1+96],ue=g[j-1-32],fe=g[j+0-32],ye=g[j+1-32],_e=g[j+2-32];g[j+0+0]=g[j+2+32]=q+ue+1>>1,g[j+0+32]=g[j+2+64]=Y+q+1>>1,g[j+0+64]=g[j+2+96]=re+Y+1>>1,g[j+0+96]=ce+re+1>>1,g[j+3+0]=br(fe,ye,_e),g[j+2+0]=br(ue,fe,ye),g[j+1+0]=g[j+3+32]=br(q,ue,fe),g[j+1+32]=g[j+3+64]=br(Y,q,ue),g[j+1+64]=g[j+3+96]=br(re,Y,q),g[j+1+96]=br(ce,re,Y)}function $s(g,j){var q;for(q=0;8>q;++q)n(g,j+32*q,g,j-32,8)}function co(g,j){var q;for(q=0;8>q;++q)a(g,j,g[j-1],8),j+=32}function To(g,j,q){var Y;for(Y=0;8>Y;++Y)a(j,q+32*Y,g,8)}function Eo(g,j){var q,Y=8;for(q=0;8>q;++q)Y+=g[j+q-32]+g[j-1+32*q];To(Y>>4,g,j)}function Pl(g,j){var q,Y=4;for(q=0;8>q;++q)Y+=g[j+q-32];To(Y>>3,g,j)}function Ai(g,j){var q,Y=4;for(q=0;8>q;++q)Y+=g[j-1+32*q];To(Y>>3,g,j)}function Bs(g,j){To(128,g,j)}function Bi(g,j,q){var Y=g[j-q],re=g[j+0],ce=3*(re-Y)+Fy[1020+g[j-2*q]-g[j+q]],ue=Yp[112+(ce+4>>3)];g[j-q]=ho[255+Y+Yp[112+(ce+3>>3)]],g[j+0]=ho[255+re-ue]}function Us(g,j,q,Y){var re=g[j+0],ce=g[j+q];return Ro[255+g[j-2*q]-g[j-q]]>Y||Ro[255+ce-re]>Y}function be(g,j,q,Y){return 4*Ro[255+g[j-q]-g[j+0]]+Ro[255+g[j-2*q]-g[j+q]]<=Y}function we(g,j,q,Y,re){var ce=g[j-3*q],ue=g[j-2*q],fe=g[j-q],ye=g[j+0],_e=g[j+q],Le=g[j+2*q],et=g[j+3*q];return 4*Ro[255+fe-ye]+Ro[255+ue-_e]>Y?0:Ro[255+g[j-4*q]-ce]<=re&&Ro[255+ce-ue]<=re&&Ro[255+ue-fe]<=re&&Ro[255+et-Le]<=re&&Ro[255+Le-_e]<=re&&Ro[255+_e-ye]<=re}function Ee(g,j,q,Y){var re=2*Y+1;for(Y=0;16>Y;++Y)be(g,j+Y,q,re)&&Bi(g,j+Y,q)}function Me(g,j,q,Y){var re=2*Y+1;for(Y=0;16>Y;++Y)be(g,j+Y*q,1,re)&&Bi(g,j+Y*q,1)}function Ne(g,j,q,Y){var re;for(re=3;0<re;--re)Ee(g,j+=4*q,q,Y)}function mt(g,j,q,Y){var re;for(re=3;0<re;--re)Me(g,j+=4,q,Y)}function Tt(g,j,q,Y,re,ce,ue,fe){for(ce=2*ce+1;0<re--;){if(we(g,j,q,ce,ue))if(Us(g,j,q,fe))Bi(g,j,q);else{var ye=g,_e=j,Le=q,et=ye[_e-2*Le],tt=ye[_e-Le],ze=ye[_e+0],xt=ye[_e+Le],ut=ye[_e+2*Le],Re=27*(gt=Fy[1020+3*(ze-tt)+Fy[1020+et-xt]])+63>>7,Be=18*gt+63>>7,gt=9*gt+63>>7;ye[_e-3*Le]=ho[255+ye[_e-3*Le]+gt],ye[_e-2*Le]=ho[255+et+Be],ye[_e-Le]=ho[255+tt+Re],ye[_e+0]=ho[255+ze-Re],ye[_e+Le]=ho[255+xt-Be],ye[_e+2*Le]=ho[255+ut-gt]}j+=Y}}function Lt(g,j,q,Y,re,ce,ue,fe){for(ce=2*ce+1;0<re--;){if(we(g,j,q,ce,ue))if(Us(g,j,q,fe))Bi(g,j,q);else{var ye=g,_e=j,Le=q,et=ye[_e-Le],tt=ye[_e+0],ze=ye[_e+Le],xt=Yp[112+((ut=3*(tt-et))+4>>3)],ut=Yp[112+(ut+3>>3)],Re=xt+1>>1;ye[_e-2*Le]=ho[255+ye[_e-2*Le]+Re],ye[_e-Le]=ho[255+et+ut],ye[_e+0]=ho[255+tt-xt],ye[_e+Le]=ho[255+ze-Re]}j+=Y}}function Ar(g,j,q,Y,re,ce){Tt(g,j,q,1,16,Y,re,ce)}function zr(g,j,q,Y,re,ce){Tt(g,j,1,q,16,Y,re,ce)}function hn(g,j,q,Y,re,ce){var ue;for(ue=3;0<ue;--ue)Lt(g,j+=4*q,q,1,16,Y,re,ce)}function aa(g,j,q,Y,re,ce){var ue;for(ue=3;0<ue;--ue)Lt(g,j+=4,1,q,16,Y,re,ce)}function Yn(g,j,q,Y,re,ce,ue,fe){Tt(g,j,re,1,8,ce,ue,fe),Tt(q,Y,re,1,8,ce,ue,fe)}function Pi(g,j,q,Y,re,ce,ue,fe){Tt(g,j,1,re,8,ce,ue,fe),Tt(q,Y,1,re,8,ce,ue,fe)}function oi(g,j,q,Y,re,ce,ue,fe){Lt(g,j+4*re,re,1,8,ce,ue,fe),Lt(q,Y+4*re,re,1,8,ce,ue,fe)}function Ia(g,j,q,Y,re,ce,ue,fe){Lt(g,j+4,1,re,8,ce,ue,fe),Lt(q,Y+4,1,re,8,ce,ue,fe)}function Fa(){this.ba=new Yt,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Mr,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Ui(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function uo(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Io(){this.ua=0,this.Wa=new V,this.vb=new V,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new F,this.yc=new D}function Oi(){this.xb=this.a=0,this.l=new Er,this.ca=new Yt,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new C,this.Pb=0,this.wd=new C,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Io,this.ab=0,this.gc=s(4,uo),this.Oc=0}function zi(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Er,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Wi(g,j,q,Y,re,ce,ue){for(g=g==null?0:g[j+0],j=0;j<ue;++j)re[ce+j]=g+q[Y+j]&255,g=re[ce+j]}function ps(g,j,q,Y,re,ce,ue){var fe;if(g==null)Wi(null,null,q,Y,re,ce,ue);else for(fe=0;fe<ue;++fe)re[ce+fe]=g[j+fe]+q[Y+fe]&255}function si(g,j,q,Y,re,ce,ue){if(g==null)Wi(null,null,q,Y,re,ce,ue);else{var fe,ye=g[j+0],_e=ye,Le=ye;for(fe=0;fe<ue;++fe)_e=Le+(ye=g[j+fe])-_e,Le=q[Y+fe]+(-256&_e?0>_e?0:255:_e)&255,_e=ye,re[ce+fe]=Le}}function pc(g,j,q,Y){var re=j.width,ce=j.o;if(t(g!=null&&j!=null),0>q||0>=Y||q+Y>ce)return null;if(!g.Cc){if(g.ga==null){var ue;if(g.ga=new zi,(ue=g.ga==null)||(ue=j.width*j.o,t(g.Gb.length==0),g.Gb=o(ue),g.Uc=0,g.Gb==null?ue=0:(g.mb=g.Gb,g.nb=g.Uc,g.rc=null,ue=1),ue=!ue),!ue){ue=g.ga;var fe=g.Fa,ye=g.P,_e=g.qc,Le=g.mb,et=g.nb,tt=ye+1,ze=_e-1,xt=ue.l;if(t(fe!=null&&Le!=null&&j!=null),Ll[0]=null,Ll[1]=Wi,Ll[2]=ps,Ll[3]=si,ue.ca=Le,ue.tb=et,ue.c=j.width,ue.i=j.height,t(0<ue.c&&0<ue.i),1>=_e)j=0;else if(ue.$a=fe[ye+0]>>0&3,ue.Z=fe[ye+0]>>2&3,ue.Lc=fe[ye+0]>>4&3,ye=fe[ye+0]>>6&3,0>ue.$a||1<ue.$a||4<=ue.Z||1<ue.Lc||ye)j=0;else if(xt.put=Oa,xt.ac=fn,xt.bc=En,xt.ma=ue,xt.width=j.width,xt.height=j.height,xt.Da=j.Da,xt.v=j.v,xt.va=j.va,xt.j=j.j,xt.o=j.o,ue.$a)e:{t(ue.$a==1),j=Kt();t:for(;;){if(j==null){j=0;break e}if(t(ue!=null),ue.mc=j,j.c=ue.c,j.i=ue.i,j.l=ue.l,j.l.ma=ue,j.l.width=ue.c,j.l.height=ue.i,j.a=0,L(j.m,fe,tt,ze),!ar(ue.c,ue.i,1,j,null)||(j.ab==1&&j.gc[0].hc==3&&ot(j.s)?(ue.ic=1,fe=j.c*j.i,j.Ta=null,j.Ua=0,j.V=o(fe),j.Ba=0,j.V==null?(j.a=1,j=0):j=1):(ue.ic=0,j=kr(j,ue.c)),!j))break t;j=1;break e}ue.mc=null,j=0}else j=ze>=ue.c*ue.i;ue=!j}if(ue)return null;g.ga.Lc!=1?g.Ga=0:Y=ce-q}t(g.ga!=null),t(q+Y<=ce);e:{if(j=(fe=g.ga).c,ce=fe.l.o,fe.$a==0){if(tt=g.rc,ze=g.Vc,xt=g.Fa,ye=g.P+1+q*j,_e=g.mb,Le=g.nb+q*j,t(ye<=g.P+g.qc),fe.Z!=0)for(t(Ll[fe.Z]!=null),ue=0;ue<Y;++ue)Ll[fe.Z](tt,ze,xt,ye,_e,Le,j),tt=_e,ze=Le,Le+=j,ye+=j;else for(ue=0;ue<Y;++ue)n(_e,Le,xt,ye,j),tt=_e,ze=Le,Le+=j,ye+=j;g.rc=tt,g.Vc=ze}else{if(t(fe.mc!=null),j=q+Y,t((ue=fe.mc)!=null),t(j<=ue.i),ue.C>=j)j=1;else if(fe.ic||Ke(),fe.ic){fe=ue.V,tt=ue.Ba,ze=ue.c;var ut=ue.i,Re=(xt=1,ye=ue.$/ze,_e=ue.$%ze,Le=ue.m,et=ue.s,ue.$),Be=ze*ut,gt=ze*j,Ct=et.wc,yt=Re<gt?Kr(et,_e,ye):null;t(Re<=Be),t(j<=ut),t(ot(et));t:for(;;){for(;!Le.h&&Re<gt;){if(_e&Ct||(yt=Kr(et,_e,ye)),t(yt!=null),te(Le),256>(ut=In(yt.G[0],yt.H[0],Le)))fe[tt+Re]=ut,++Re,++_e>=ze&&(_e=0,++ye<=j&&!(ye%16)&&qe(ue,ye));else{if(!(280>ut)){xt=0;break t}ut=Jr(ut-256,Le);var Gt,$t=In(yt.G[4],yt.H[4],Le);if(te(Le),!(Re>=($t=Vn(ze,$t=Jr($t,Le)))&&Be-Re>=ut)){xt=0;break t}for(Gt=0;Gt<ut;++Gt)fe[tt+Re+Gt]=fe[tt+Re+Gt-$t];for(Re+=ut,_e+=ut;_e>=ze;)_e-=ze,++ye<=j&&!(ye%16)&&qe(ue,ye);Re<gt&&_e&Ct&&(yt=Kr(et,_e,ye))}t(Le.h==H(Le))}qe(ue,ye>j?j:ye);break t}!xt||Le.h&&Re<Be?(xt=0,ue.a=Le.h?5:3):ue.$=Re,j=xt}else j=rt(ue,ue.V,ue.Ba,ue.c,ue.i,j,rn);if(!j){Y=0;break e}}q+Y>=ce&&(g.Cc=1),Y=1}if(!Y)return null;if(g.Cc&&((Y=g.ga)!=null&&(Y.mc=null),g.ga=null,0<g.Ga))return alert("todo:WebPDequantizeLevels"),null}return g.nb+q*re}function N(g,j,q,Y,re,ce){for(;0<re--;){var ue,fe=g,ye=j+(q?1:0),_e=g,Le=j+(q?0:3);for(ue=0;ue<Y;++ue){var et=_e[Le+4*ue];et!=255&&(et*=32897,fe[ye+4*ue+0]=fe[ye+4*ue+0]*et>>23,fe[ye+4*ue+1]=fe[ye+4*ue+1]*et>>23,fe[ye+4*ue+2]=fe[ye+4*ue+2]*et>>23)}j+=ce}}function ne(g,j,q,Y,re){for(;0<Y--;){var ce;for(ce=0;ce<q;++ce){var ue=g[j+2*ce+0],fe=15&(_e=g[j+2*ce+1]),ye=4369*fe,_e=(240&_e|_e>>4)*ye>>16;g[j+2*ce+0]=(240&ue|ue>>4)*ye>>16&240|(15&ue|ue<<4)*ye>>16>>4&15,g[j+2*ce+1]=240&_e|fe}j+=re}}function Se(g,j,q,Y,re,ce,ue,fe){var ye,_e,Le=255;for(_e=0;_e<re;++_e){for(ye=0;ye<Y;++ye){var et=g[j+ye];ce[ue+4*ye]=et,Le&=et}j+=q,ue+=fe}return Le!=255}function Ie(g,j,q,Y,re){var ce;for(ce=0;ce<re;++ce)q[Y+ce]=g[j+ce]>>8}function Ke(){Lo=N,Dn=ne,Mn=Se,xa=Ie}function ft(g,j,q){S[g]=function(Y,re,ce,ue,fe,ye,_e,Le,et,tt,ze,xt,ut,Re,Be,gt,Ct){var yt,Gt=Ct-1>>1,$t=fe[ye+0]|_e[Le+0]<<16,vr=et[tt+0]|ze[xt+0]<<16;t(Y!=null);var Ut=3*$t+vr+131074>>2;for(j(Y[re+0],255&Ut,Ut>>16,ut,Re),ce!=null&&(Ut=3*vr+$t+131074>>2,j(ce[ue+0],255&Ut,Ut>>16,Be,gt)),yt=1;yt<=Gt;++yt){var pn=fe[ye+yt]|_e[Le+yt]<<16,_n=et[tt+yt]|ze[xt+yt]<<16,nn=$t+pn+vr+_n+524296,Xr=nn+2*(pn+vr)>>3;Ut=Xr+$t>>1,$t=(nn=nn+2*($t+_n)>>3)+pn>>1,j(Y[re+2*yt-1],255&Ut,Ut>>16,ut,Re+(2*yt-1)*q),j(Y[re+2*yt-0],255&$t,$t>>16,ut,Re+(2*yt-0)*q),ce!=null&&(Ut=nn+vr>>1,$t=Xr+_n>>1,j(ce[ue+2*yt-1],255&Ut,Ut>>16,Be,gt+(2*yt-1)*q),j(ce[ue+2*yt+0],255&$t,$t>>16,Be,gt+(2*yt+0)*q)),$t=pn,vr=_n}1&Ct||(Ut=3*$t+vr+131074>>2,j(Y[re+Ct-1],255&Ut,Ut>>16,ut,Re+(Ct-1)*q),ce!=null&&(Ut=3*vr+$t+131074>>2,j(ce[ue+Ct-1],255&Ut,Ut>>16,Be,gt+(Ct-1)*q)))}}function At(){qo[Kp]=MR,qo[Qp]=ES,qo[AS]=LR,qo[Xp]=IS,qo[Jp]=NS,qo[$y]=DS,qo[PS]=RR,qo[By]=ES,qo[Uy]=IS,qo[Zp]=NS,qo[zy]=DS}function zt(g){return g&-16384?0>g?0:255:g>>qR}function ir(g,j){return zt((19077*g>>8)+(26149*j>>8)-14234)}function Ir(g,j,q){return zt((19077*g>>8)-(6419*j>>8)-(13320*q>>8)+8708)}function Pr(g,j){return zt((19077*g>>8)+(33050*j>>8)-17685)}function Qr(g,j,q,Y,re){Y[re+0]=ir(g,q),Y[re+1]=Ir(g,j,q),Y[re+2]=Pr(g,j)}function Nn(g,j,q,Y,re){Y[re+0]=Pr(g,j),Y[re+1]=Ir(g,j,q),Y[re+2]=ir(g,q)}function Un(g,j,q,Y,re){var ce=Ir(g,j,q);j=ce<<3&224|Pr(g,j)>>3,Y[re+0]=248&ir(g,q)|ce>>5,Y[re+1]=j}function ia(g,j,q,Y,re){var ce=240&Pr(g,j)|15;Y[re+0]=240&ir(g,q)|Ir(g,j,q)>>4,Y[re+1]=ce}function $a(g,j,q,Y,re){Y[re+0]=255,Qr(g,j,q,Y,re+1)}function Na(g,j,q,Y,re){Nn(g,j,q,Y,re),Y[re+3]=255}function fo(g,j,q,Y,re){Qr(g,j,q,Y,re),Y[re+3]=255}function ki(g,j){return 0>g?0:g>j?j:g}function No(g,j,q){S[g]=function(Y,re,ce,ue,fe,ye,_e,Le,et){for(var tt=Le+(-2&et)*q;Le!=tt;)j(Y[re+0],ce[ue+0],fe[ye+0],_e,Le),j(Y[re+1],ce[ue+0],fe[ye+0],_e,Le+q),re+=2,++ue,++ye,Le+=2*q;1&et&&j(Y[re+0],ce[ue+0],fe[ye+0],_e,Le)}}function uu(g,j,q){return q==0?g==0?j==0?6:5:j==0?4:0:q}function mc(g,j,q,Y,re){switch(g>>>30){case 3:Gs(j,q,Y,re,0);break;case 2:ya(j,q,Y,re);break;case 1:Ei(j,q,Y,re)}}function Ol(g,j){var q,Y,re=j.M,ce=j.Nb,ue=g.oc,fe=g.pc+40,ye=g.oc,_e=g.pc+584,Le=g.oc,et=g.pc+600;for(q=0;16>q;++q)ue[fe+32*q-1]=129;for(q=0;8>q;++q)ye[_e+32*q-1]=129,Le[et+32*q-1]=129;for(0<re?ue[fe-1-32]=ye[_e-1-32]=Le[et-1-32]=129:(a(ue,fe-32-1,127,21),a(ye,_e-32-1,127,9),a(Le,et-32-1,127,9)),Y=0;Y<g.za;++Y){var tt=j.ya[j.aa+Y];if(0<Y){for(q=-1;16>q;++q)n(ue,fe+32*q-4,ue,fe+32*q+12,4);for(q=-1;8>q;++q)n(ye,_e+32*q-4,ye,_e+32*q+4,4),n(Le,et+32*q-4,Le,et+32*q+4,4)}var ze=g.Gd,xt=g.Hd+Y,ut=tt.ad,Re=tt.Hc;if(0<re&&(n(ue,fe-32,ze[xt].y,0,16),n(ye,_e-32,ze[xt].f,0,8),n(Le,et-32,ze[xt].ea,0,8)),tt.Za){var Be=ue,gt=fe-32+16;for(0<re&&(Y>=g.za-1?a(Be,gt,ze[xt].y[15],4):n(Be,gt,ze[xt+1].y,0,4)),q=0;4>q;q++)Be[gt+128+q]=Be[gt+256+q]=Be[gt+384+q]=Be[gt+0+q];for(q=0;16>q;++q,Re<<=2)Be=ue,gt=fe+LS[q],Qo[tt.Ob[q]](Be,gt),mc(Re,ut,16*+q,Be,gt)}else if(Be=uu(Y,re,tt.Ob[0]),Ml[Be](ue,fe),Re!=0)for(q=0;16>q;++q,Re<<=2)mc(Re,ut,16*+q,ue,fe+LS[q]);for(q=tt.Gc,Be=uu(Y,re,tt.Dd),Ks[Be](ye,_e),Ks[Be](Le,et),Re=ut,Be=ye,gt=_e,255&(tt=q>>0)&&(170&tt?Hd(Re,256,Be,gt):Do(Re,256,Be,gt)),tt=Le,Re=et,255&(q>>=8)&&(170&q?Hd(ut,320,tt,Re):Do(ut,320,tt,Re)),re<g.Ub-1&&(n(ze[xt].y,0,ue,fe+480,16),n(ze[xt].f,0,ye,_e+224,8),n(ze[xt].ea,0,Le,et+224,8)),q=8*ce*g.B,ze=g.sa,xt=g.ta+16*Y+16*ce*g.R,ut=g.qa,tt=g.ra+8*Y+q,Re=g.Ha,Be=g.Ia+8*Y+q,q=0;16>q;++q)n(ze,xt+q*g.R,ue,fe+32*q,16);for(q=0;8>q;++q)n(ut,tt+q*g.B,ye,_e+32*q,8),n(Re,Be+q*g.B,Le,et+32*q,8)}}function kl(g,j,q,Y,re,ce,ue,fe,ye){var _e=[0],Le=[0],et=0,tt=ye!=null?ye.kd:0,ze=ye??new Ui;if(g==null||12>q)return 7;ze.data=g,ze.w=j,ze.ha=q,j=[j],q=[q],ze.gb=[ze.gb];e:{var xt=j,ut=q,Re=ze.gb;if(t(g!=null),t(ut!=null),t(Re!=null),Re[0]=0,12<=ut[0]&&!r(g,xt[0],"RIFF")){if(r(g,xt[0]+8,"WEBP")){Re=3;break e}var Be=G(g,xt[0]+4);if(12>Be||4294967286<Be){Re=3;break e}if(tt&&Be>ut[0]-8){Re=7;break e}Re[0]=Be,xt[0]+=12,ut[0]-=12}Re=0}if(Re!=0)return Re;for(Be=0<ze.gb[0],q=q[0];;){e:{var gt=g;ut=j,Re=q;var Ct=_e,yt=Le,Gt=xt=[0];if((Ut=et=[et])[0]=0,8>Re[0])Re=7;else{if(!r(gt,ut[0],"VP8X")){if(G(gt,ut[0]+4)!=10){Re=3;break e}if(18>Re[0]){Re=7;break e}var $t=G(gt,ut[0]+8),vr=1+Q(gt,ut[0]+12);if(2147483648<=vr*(gt=1+Q(gt,ut[0]+15))){Re=3;break e}Gt!=null&&(Gt[0]=$t),Ct!=null&&(Ct[0]=vr),yt!=null&&(yt[0]=gt),ut[0]+=18,Re[0]-=18,Ut[0]=1}Re=0}}if(et=et[0],xt=xt[0],Re!=0)return Re;if(ut=!!(2&xt),!Be&&et)return 3;if(ce!=null&&(ce[0]=!!(16&xt)),ue!=null&&(ue[0]=ut),fe!=null&&(fe[0]=0),ue=_e[0],xt=Le[0],et&&ut&&ye==null){Re=0;break}if(4>q){Re=7;break}if(Be&&et||!Be&&!et&&!r(g,j[0],"ALPH")){q=[q],ze.na=[ze.na],ze.P=[ze.P],ze.Sa=[ze.Sa];e:{$t=g,Re=j,Be=q;var Ut=ze.gb;Ct=ze.na,yt=ze.P,Gt=ze.Sa,vr=22,t($t!=null),t(Be!=null),gt=Re[0];var pn=Be[0];for(t(Ct!=null),t(Gt!=null),Ct[0]=null,yt[0]=null,Gt[0]=0;;){if(Re[0]=gt,Be[0]=pn,8>pn){Re=7;break e}var _n=G($t,gt+4);if(4294967286<_n){Re=3;break e}var nn=8+_n+1&-2;if(vr+=nn,0<Ut&&vr>Ut){Re=3;break e}if(!r($t,gt,"VP8 ")||!r($t,gt,"VP8L")){Re=0;break e}if(pn[0]<nn){Re=7;break e}r($t,gt,"ALPH")||(Ct[0]=$t,yt[0]=gt+8,Gt[0]=_n),gt+=nn,pn-=nn}}if(q=q[0],ze.na=ze.na[0],ze.P=ze.P[0],ze.Sa=ze.Sa[0],Re!=0)break}q=[q],ze.Ja=[ze.Ja],ze.xa=[ze.xa];e:if(Ut=g,Re=j,Be=q,Ct=ze.gb[0],yt=ze.Ja,Gt=ze.xa,$t=Re[0],gt=!r(Ut,$t,"VP8 "),vr=!r(Ut,$t,"VP8L"),t(Ut!=null),t(Be!=null),t(yt!=null),t(Gt!=null),8>Be[0])Re=7;else{if(gt||vr){if(Ut=G(Ut,$t+4),12<=Ct&&Ut>Ct-12){Re=3;break e}if(tt&&Ut>Be[0]-8){Re=7;break e}yt[0]=Ut,Re[0]+=8,Be[0]-=8,Gt[0]=vr}else Gt[0]=5<=Be[0]&&Ut[$t+0]==47&&!(Ut[$t+4]>>5),yt[0]=Be[0];Re=0}if(q=q[0],ze.Ja=ze.Ja[0],ze.xa=ze.xa[0],j=j[0],Re!=0)break;if(4294967286<ze.Ja)return 3;if(fe==null||ut||(fe[0]=ze.xa?2:1),ue=[ue],xt=[xt],ze.xa){if(5>q){Re=7;break}fe=ue,tt=xt,ut=ce,g==null||5>q?g=0:5<=q&&g[j+0]==47&&!(g[j+4]>>5)?(Be=[0],Ut=[0],Ct=[0],L(yt=new C,g,j,q),er(yt,Be,Ut,Ct)?(fe!=null&&(fe[0]=Be[0]),tt!=null&&(tt[0]=Ut[0]),ut!=null&&(ut[0]=Ct[0]),g=1):g=0):g=0}else{if(10>q){Re=7;break}fe=xt,g==null||10>q||!ra(g,j+3,q-3)?g=0:(tt=g[j+0]|g[j+1]<<8|g[j+2]<<16,ut=16383&(g[j+7]<<8|g[j+6]),g=16383&(g[j+9]<<8|g[j+8]),1&tt||3<(tt>>1&7)||!(tt>>4&1)||tt>>5>=ze.Ja||!ut||!g?g=0:(ue&&(ue[0]=ut),fe&&(fe[0]=g),g=1))}if(!g||(ue=ue[0],xt=xt[0],et&&(_e[0]!=ue||Le[0]!=xt)))return 3;ye!=null&&(ye[0]=ze,ye.offset=j-ye.w,t(4294967286>j-ye.w),t(ye.offset==ye.ha-q));break}return Re==0||Re==7&&et&&ye==null?(ce!=null&&(ce[0]|=ze.na!=null&&0<ze.na.length),Y!=null&&(Y[0]=ue),re!=null&&(re[0]=xt),0):Re}function gc(g,j,q){var Y=j.width,re=j.height,ce=0,ue=0,fe=Y,ye=re;if(j.Da=g!=null&&0<g.Da,j.Da&&(fe=g.cd,ye=g.bd,ce=g.v,ue=g.j,11>q||(ce&=-2,ue&=-2),0>ce||0>ue||0>=fe||0>=ye||ce+fe>Y||ue+ye>re))return 0;if(j.v=ce,j.j=ue,j.va=ce+fe,j.o=ue+ye,j.U=fe,j.T=ye,j.da=g!=null&&0<g.da,j.da){if(!Ge(fe,ye,q=[g.ib],ce=[g.hb]))return 0;j.ib=q[0],j.hb=ce[0]}return j.ob=g!=null&&g.ob,j.Kb=g==null||!g.Sd,j.da&&(j.ob=j.ib<3*Y/4&&j.hb<3*re/4,j.Kb=0),1}function Tl(g){if(g==null)return 2;if(11>g.S){var j=g.f.RGBA;j.fb+=(g.height-1)*j.A,j.A=-j.A}else j=g.f.kb,g=g.height,j.O+=(g-1)*j.fa,j.fa=-j.fa,j.N+=(g-1>>1)*j.Ab,j.Ab=-j.Ab,j.W+=(g-1>>1)*j.Db,j.Db=-j.Db,j.F!=null&&(j.J+=(g-1)*j.lb,j.lb=-j.lb);return 0}function zs(g,j,q,Y){if(Y==null||0>=g||0>=j)return 2;if(q!=null){if(q.Da){var re=q.cd,ce=q.bd,ue=-2&q.v,fe=-2&q.j;if(0>ue||0>fe||0>=re||0>=ce||ue+re>g||fe+ce>j)return 2;g=re,j=ce}if(q.da){if(!Ge(g,j,re=[q.ib],ce=[q.hb]))return 2;g=re[0],j=ce[0]}}Y.width=g,Y.height=j;e:{var ye=Y.width,_e=Y.height;if(g=Y.S,0>=ye||0>=_e||!(g>=Kp&&13>g))g=2;else{if(0>=Y.Rd&&Y.sd==null){ue=ce=re=j=0;var Le=(fe=ye*RS[g])*_e;if(11>g||(ce=(_e+1)/2*(j=(ye+1)/2),g==12&&(ue=(re=ye)*_e)),(_e=o(Le+2*ce+ue))==null){g=1;break e}Y.sd=_e,11>g?((ye=Y.f.RGBA).eb=_e,ye.fb=0,ye.A=fe,ye.size=Le):((ye=Y.f.kb).y=_e,ye.O=0,ye.fa=fe,ye.Fd=Le,ye.f=_e,ye.N=0+Le,ye.Ab=j,ye.Cd=ce,ye.ea=_e,ye.W=0+Le+ce,ye.Db=j,ye.Ed=ce,g==12&&(ye.F=_e,ye.J=0+Le+2*ce),ye.Tc=ue,ye.lb=re)}if(j=1,re=Y.S,ce=Y.width,ue=Y.height,re>=Kp&&13>re)if(11>re)g=Y.f.RGBA,j&=(fe=Math.abs(g.A))*(ue-1)+ce<=g.size,j&=fe>=ce*RS[re],j&=g.eb!=null;else{g=Y.f.kb,fe=(ce+1)/2,Le=(ue+1)/2,ye=Math.abs(g.fa),_e=Math.abs(g.Ab);var et=Math.abs(g.Db),tt=Math.abs(g.lb),ze=tt*(ue-1)+ce;j&=ye*(ue-1)+ce<=g.Fd,j&=_e*(Le-1)+fe<=g.Cd,j=(j&=et*(Le-1)+fe<=g.Ed)&ye>=ce&_e>=fe&et>=fe,j&=g.y!=null,j&=g.f!=null,j&=g.ea!=null,re==12&&(j&=tt>=ce,j&=ze<=g.Tc,j&=g.F!=null)}else j=0;g=j?0:2}}return g!=0||q!=null&&q.fd&&(g=Tl(Y)),g}var ca=64,El=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],de=24,pe=32,Te=8,ke=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Xe("Predictor0","PredictorAdd0"),S.Predictor0=function(){return 4278190080},S.Predictor1=function(g){return g},S.Predictor2=function(g,j,q){return j[q+0]},S.Predictor3=function(g,j,q){return j[q+1]},S.Predictor4=function(g,j,q){return j[q-1]},S.Predictor5=function(g,j,q){return lt(lt(g,j[q+1]),j[q+0])},S.Predictor6=function(g,j,q){return lt(g,j[q-1])},S.Predictor7=function(g,j,q){return lt(g,j[q+0])},S.Predictor8=function(g,j,q){return lt(j[q-1],j[q+0])},S.Predictor9=function(g,j,q){return lt(j[q+0],j[q+1])},S.Predictor10=function(g,j,q){return lt(lt(g,j[q-1]),lt(j[q+0],j[q+1]))},S.Predictor11=function(g,j,q){var Y=j[q+0];return 0>=Ze(Y>>24&255,g>>24&255,(j=j[q-1])>>24&255)+Ze(Y>>16&255,g>>16&255,j>>16&255)+Ze(Y>>8&255,g>>8&255,j>>8&255)+Ze(255&Y,255&g,255&j)?Y:g},S.Predictor12=function(g,j,q){var Y=j[q+0];return(vt((g>>24&255)+(Y>>24&255)-((j=j[q-1])>>24&255))<<24|vt((g>>16&255)+(Y>>16&255)-(j>>16&255))<<16|vt((g>>8&255)+(Y>>8&255)-(j>>8&255))<<8|vt((255&g)+(255&Y)-(255&j)))>>>0},S.Predictor13=function(g,j,q){var Y=j[q-1];return(Ye((g=lt(g,j[q+0]))>>24&255,Y>>24&255)<<24|Ye(g>>16&255,Y>>16&255)<<16|Ye(g>>8&255,Y>>8&255)<<8|Ye(g>>0&255,Y>>0&255))>>>0};var nt=S.PredictorAdd0;S.PredictorAdd1=We,Xe("Predictor2","PredictorAdd2"),Xe("Predictor3","PredictorAdd3"),Xe("Predictor4","PredictorAdd4"),Xe("Predictor5","PredictorAdd5"),Xe("Predictor6","PredictorAdd6"),Xe("Predictor7","PredictorAdd7"),Xe("Predictor8","PredictorAdd8"),Xe("Predictor9","PredictorAdd9"),Xe("Predictor10","PredictorAdd10"),Xe("Predictor11","PredictorAdd11"),Xe("Predictor12","PredictorAdd12"),Xe("Predictor13","PredictorAdd13");var _t=S.PredictorAdd2;Wt("ColorIndexInverseTransform","MapARGB","32b",function(g){return g>>8&255},function(g){return g}),Wt("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(g){return g},function(g){return g>>8&255});var Bt,Dt=S.ColorIndexInverseTransform,dr=S.MapARGB,Kn=S.VP8LColorIndexInverseTransformAlpha,va=S.MapAlpha,Hi=S.VP8LPredictorsAdd=[];Hi.length=16,(S.VP8LPredictors=[]).length=16,(S.VP8LPredictorsAdd_C=[]).length=16,(S.VP8LPredictors_C=[]).length=16;var Ws,Vi,Ti,Il,Hs,Vs,du,Gs,ya,Hd,Ei,Do,fu,Vp,Vd,vc,yc,Nl,xc,hu,bc,Dl,Gd,Mo,Lo,Dn,Mn,xa,Ba=o(511),Ys=o(2041),Yd=o(225),pu=o(767),Gp=0,Fy=Ys,Yp=Yd,ho=pu,Ro=Ba,Kp=0,Qp=1,AS=2,Xp=3,Jp=4,$y=5,PS=6,By=7,Uy=8,Zp=9,zy=10,_R=[2,3,7],wR=[3,3,11],OS=[280,256,256,256,40],jR=[0,1,1,1,0],SR=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],CR=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],AR=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],PR=8,Wy=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Hy=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Kd=null,OR=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],kR=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],kS=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],TR=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],ER=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],IR=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],NR=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Ml=[],Qo=[],Ks=[],DR=1,TS=2,Ll=[],qo=[];ft("UpsampleRgbLinePair",Qr,3),ft("UpsampleBgrLinePair",Nn,3),ft("UpsampleRgbaLinePair",fo,4),ft("UpsampleBgraLinePair",Na,4),ft("UpsampleArgbLinePair",$a,4),ft("UpsampleRgba4444LinePair",ia,2),ft("UpsampleRgb565LinePair",Un,2);var MR=S.UpsampleRgbLinePair,LR=S.UpsampleBgrLinePair,ES=S.UpsampleRgbaLinePair,IS=S.UpsampleBgraLinePair,NS=S.UpsampleArgbLinePair,DS=S.UpsampleRgba4444LinePair,RR=S.UpsampleRgb565LinePair,em=16,tm=1<<em-1,Qd=-227,Vy=482,qR=6,MS=0,FR=o(256),$R=o(256),BR=o(256),UR=o(256),zR=o(Vy-Qd),WR=o(Vy-Qd);No("YuvToRgbRow",Qr,3),No("YuvToBgrRow",Nn,3),No("YuvToRgbaRow",fo,4),No("YuvToBgraRow",Na,4),No("YuvToArgbRow",$a,4),No("YuvToRgba4444Row",ia,2),No("YuvToRgb565Row",Un,2);var LS=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],rm=[0,2,8],HR=[8,7,6,4,4,2,2,2,1,1,1,1],VR=1;this.WebPDecodeRGBA=function(g,j,q,Y,re){var ce=Qp,ue=new Fa,fe=new Yt;ue.ba=fe,fe.S=ce,fe.width=[fe.width],fe.height=[fe.height];var ye=fe.width,_e=fe.height,Le=new Sr;if(Le==null||g==null)var et=2;else t(Le!=null),et=kl(g,j,q,Le.width,Le.height,Le.Pd,Le.Qd,Le.format,null);if(et!=0?ye=0:(ye!=null&&(ye[0]=Le.width[0]),_e!=null&&(_e[0]=Le.height[0]),ye=1),ye){fe.width=fe.width[0],fe.height=fe.height[0],Y!=null&&(Y[0]=fe.width),re!=null&&(re[0]=fe.height);e:{if(Y=new Er,(re=new Ui).data=g,re.w=j,re.ha=q,re.kd=1,j=[0],t(re!=null),((g=kl(re.data,re.w,re.ha,null,null,null,j,null,re))==0||g==7)&&j[0]&&(g=4),(j=g)==0){if(t(ue!=null),Y.data=re.data,Y.w=re.w+re.offset,Y.ha=re.ha-re.offset,Y.put=Oa,Y.ac=fn,Y.bc=En,Y.ma=ue,re.xa){if((g=Kt())==null){ue=1;break e}if(function(tt,ze){var xt=[0],ut=[0],Re=[0];t:for(;;){if(tt==null)return 0;if(ze==null)return tt.a=2,0;if(tt.l=ze,tt.a=0,L(tt.m,ze.data,ze.w,ze.ha),!er(tt.m,xt,ut,Re)){tt.a=3;break t}if(tt.xb=TS,ze.width=xt[0],ze.height=ut[0],!ar(xt[0],ut[0],1,tt,null))break t;return 1}return t(tt.a!=0),0}(g,Y)){if(Y=(j=zs(Y.width,Y.height,ue.Oa,ue.ba))==0){t:{Y=g;r:for(;;){if(Y==null){Y=0;break t}if(t(Y.s.yc!=null),t(Y.s.Ya!=null),t(0<Y.s.Wb),t((q=Y.l)!=null),t((re=q.ma)!=null),Y.xb!=0){if(Y.ca=re.ba,Y.tb=re.tb,t(Y.ca!=null),!gc(re.Oa,q,Xp)){Y.a=2;break r}if(!kr(Y,q.width)||q.da)break r;if((q.da||at(Y.ca.S))&&Ke(),11>Y.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),Y.ca.f.kb.F!=null&&Ke()),Y.Pb&&0<Y.s.ua&&Y.s.vb.X==null&&!ee(Y.s.vb,Y.s.Wa.Xa)){Y.a=1;break r}Y.xb=0}if(!rt(Y,Y.V,Y.Ba,Y.c,Y.i,q.o,Ve))break r;re.Dc=Y.Ma,Y=1;break t}t(Y.a!=0),Y=0}Y=!Y}Y&&(j=g.a)}else j=g.a}else{if((g=new jn)==null){ue=1;break e}if(g.Fa=re.na,g.P=re.P,g.qc=re.Sa,bn(g,Y)){if((j=zs(Y.width,Y.height,ue.Oa,ue.ba))==0){if(g.Aa=0,q=ue.Oa,t((re=g)!=null),q!=null){if(0<(ye=0>(ye=q.Md)?0:100<ye?255:255*ye/100)){for(_e=Le=0;4>_e;++_e)12>(et=re.pb[_e]).lc&&(et.ia=ye*HR[0>et.lc?0:et.lc]>>3),Le|=et.ia;Le&&(alert("todo:VP8InitRandom"),re.ia=1)}re.Ga=q.Id,100<re.Ga?re.Ga=100:0>re.Ga&&(re.Ga=0)}ni(g,Y)||(j=g.a)}}else j=g.a}j==0&&ue.Oa!=null&&ue.Oa.fd&&(j=Tl(ue.ba))}ue=j}ce=ue!=0?null:11>ce?fe.f.RGBA.eb:fe.f.kb.y}else ce=null;return ce};var RS=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function u(S,I){for(var W="",O=0;O<4;O++)W+=String.fromCharCode(S[I++]);return W}function d(S,I){return(S[I+0]<<0|S[I+1]<<8|S[I+2]<<16)>>>0}function f(S,I){return(S[I+0]<<0|S[I+1]<<8|S[I+2]<<16|S[I+3]<<24)>>>0}new c;var h=[0],p=[0],v=[],m=new c,y=e,b=function(S,I){var W={},O=0,D=!1,R=0,F=0;if(W.frames=[],!function(M,H,U,te){for(var le=0;le<te;le++)if(M[H+le]!=U.charCodeAt(le))return!0;return!1}(S,I,"RIFF",4)){for(f(S,I+=4),I+=8;I<S.length;){var z=u(S,I),K=f(S,I+=4);I+=4;var J=K+(1&K);switch(z){case"VP8 ":case"VP8L":W.frames[O]===void 0&&(W.frames[O]={}),($=W.frames[O]).src_off=D?F:I-8,$.src_size=R+K+8,O++,D&&(D=!1,R=0,F=0);break;case"VP8X":($=W.header={}).feature_flags=S[I];var L=I+4;$.canvas_width=1+d(S,L),L+=3,$.canvas_height=1+d(S,L),L+=3;break;case"ALPH":D=!0,R=J+8,F=I-8;break;case"ANIM":($=W.header).bgcolor=f(S,I),L=I+4,$.loop_count=(X=S)[(C=L)+0]<<0|X[C+1]<<8,L+=2;break;case"ANMF":var k,$;($=W.frames[O]={}).offset_x=2*d(S,I),I+=3,$.offset_y=2*d(S,I),I+=3,$.width=1+d(S,I),I+=3,$.height=1+d(S,I),I+=3,$.duration=d(S,I),I+=3,k=S[I++],$.dispose=1&k,$.blend=k>>1&1}z!="ANMF"&&(I+=J)}var X,C;return W}}(y,0);b.response=y,b.rgbaoutput=!0,b.dataurl=!1;var _=b.header?b.header:null,w=b.frames?b.frames:null;if(_){_.loop_counter=_.loop_count,h=[_.canvas_height],p=[_.canvas_width];for(var A=0;A<w.length&&w[A].blend!=0;A++);}var P=w[0],T=m.WebPDecodeRGBA(y,P.src_off,P.src_size,p,h);P.rgba=T,P.imgwidth=p[0],P.imgheight=h[0];for(var E=0;E<p[0]*h[0]*4;E++)v[E]=T[E];return this.width=p,this.height=h,this.data=v,this}(function(e){var t=function(){return typeof kw=="function"},r=function(h,p,v,m){var y=4,b=s;switch(m){case e.image_compression.FAST:y=1,b=o;break;case e.image_compression.MEDIUM:y=6,b=l;break;case e.image_compression.SLOW:y=9,b=c}h=n(h,p,v,b);var _=kw(h,{level:y});return e.__addimage__.arrayBufferToBinaryString(_)},n=function(h,p,v,m){for(var y,b,_,w=h.length/p,A=new Uint8Array(h.length+w),P=d(),T=0;T<w;T+=1){if(_=T*p,y=h.subarray(_,_+p),m)A.set(m(y,v,b),_+T);else{for(var E,S=P.length,I=[];E<S;E+=1)I[E]=P[E](y,v,b);var W=f(I.concat());A.set(I[W],_+T)}b=y}return A},a=function(h){var p=Array.apply([],h);return p.unshift(0),p},o=function(h,p){var v,m=[],y=h.length;m[0]=1;for(var b=0;b<y;b+=1)v=h[b-p]||0,m[b+1]=h[b]-v+256&255;return m},s=function(h,p,v){var m,y=[],b=h.length;y[0]=2;for(var _=0;_<b;_+=1)m=v&&v[_]||0,y[_+1]=h[_]-m+256&255;return y},l=function(h,p,v){var m,y,b=[],_=h.length;b[0]=3;for(var w=0;w<_;w+=1)m=h[w-p]||0,y=v&&v[w]||0,b[w+1]=h[w]+256-(m+y>>>1)&255;return b},c=function(h,p,v){var m,y,b,_,w=[],A=h.length;w[0]=4;for(var P=0;P<A;P+=1)m=h[P-p]||0,y=v&&v[P]||0,b=v&&v[P-p]||0,_=u(m,y,b),w[P+1]=h[P]-_+256&255;return w},u=function(h,p,v){if(h===p&&p===v)return h;var m=Math.abs(p-v),y=Math.abs(h-v),b=Math.abs(h+p-v-v);return m<=y&&m<=b?h:y<=b?p:v},d=function(){return[a,o,s,l,c]},f=function(h){var p=h.map(function(v){return v.reduce(function(m,y){return m+Math.abs(y)},0)});return p.indexOf(Math.min.apply(null,p))};e.processPNG=function(h,p,v,m){var y,b,_,w,A,P,T,E,S,I,W,O,D,R,F,z=this.decode.FLATE_DECODE,K="";if(this.__addimage__.isArrayBuffer(h)&&(h=new Uint8Array(h)),this.__addimage__.isArrayBufferView(h)){if(h=(_=new ice(h)).imgData,b=_.bits,y=_.colorSpace,A=_.colors,[4,6].indexOf(_.colorType)!==-1){if(_.bits===8){S=(E=_.pixelBitlength==32?new Uint32Array(_.decodePixels().buffer):_.pixelBitlength==16?new Uint16Array(_.decodePixels().buffer):new Uint8Array(_.decodePixels().buffer)).length,W=new Uint8Array(S*_.colors),I=new Uint8Array(S);var J,L=_.pixelBitlength-_.bits;for(R=0,F=0;R<S;R++){for(D=E[R],J=0;J<L;)W[F++]=D>>>J&255,J+=_.bits;I[R]=D>>>J&255}}if(_.bits===16){S=(E=new Uint32Array(_.decodePixels().buffer)).length,W=new Uint8Array(S*(32/_.pixelBitlength)*_.colors),I=new Uint8Array(S*(32/_.pixelBitlength)),O=_.colors>1,R=0,F=0;for(var k=0;R<S;)D=E[R++],W[F++]=D>>>0&255,O&&(W[F++]=D>>>16&255,D=E[R++],W[F++]=D>>>0&255),I[k++]=D>>>16&255;b=8}m!==e.image_compression.NONE&&t()?(h=r(W,_.width*_.colors,_.colors,m),T=r(I,_.width,1,m)):(h=W,T=I,z=void 0)}if(_.colorType===3&&(y=this.color_spaces.INDEXED,P=_.palette,_.transparency.indexed)){var $=_.transparency.indexed,X=0;for(R=0,S=$.length;R<S;++R)X+=$[R];if((X/=255)===S-1&&$.indexOf(0)!==-1)w=[$.indexOf(0)];else if(X!==S){for(E=_.decodePixels(),I=new Uint8Array(E.length),R=0,S=E.length;R<S;R++)I[R]=$[E[R]];T=r(I,_.width,1)}}var C=function(M){var H;switch(M){case e.image_compression.FAST:H=11;break;case e.image_compression.MEDIUM:H=13;break;case e.image_compression.SLOW:H=14;break;default:H=12}return H}(m);return z===this.decode.FLATE_DECODE&&(K="/Predictor "+C+" "),K+="/Colors "+A+" /BitsPerComponent "+b+" /Columns "+_.width,(this.__addimage__.isArrayBuffer(h)||this.__addimage__.isArrayBufferView(h))&&(h=this.__addimage__.arrayBufferToBinaryString(h)),(T&&this.__addimage__.isArrayBuffer(T)||this.__addimage__.isArrayBufferView(T))&&(T=this.__addimage__.arrayBufferToBinaryString(T)),{alias:v,data:h,index:p,filter:z,decodeParameters:K,transparency:w,palette:P,sMask:T,predictor:C,width:_.width,height:_.height,bitsPerComponent:b,colorSpace:y}}}})(wr.API),function(e){e.processGIF89A=function(t,r,n,a){var o=new oce(t),s=o.width,l=o.height,c=[];o.decodeAndBlitFrameRGBA(0,c);var u={data:c,width:s,height:l},d=new P2(100).encode(u,100);return e.processJPEG.call(this,d,r,n,a)},e.processGIF87A=e.processGIF89A}(wr.API),es.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:a,green:n,blue:r,quad:o}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},es.prototype.parseBGR=function(){this.pos=this.offset;try{var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[e]()}catch(r){On.log("bit decode error:"+r)}},es.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),r=t%4;for(e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,a=0;a<t;a++)for(var o=this.datav.getUint8(this.pos++,!0),s=n*this.width*4+8*a*4,l=0;l<8&&8*a+l<this.width;l++){var c=this.palette[o>>7-l&1];this.data[s+4*l]=c.blue,this.data[s+4*l+1]=c.green,this.data[s+4*l+2]=c.red,this.data[s+4*l+3]=255}r!==0&&(this.pos+=4-r)}},es.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,a=0;a<e;a++){var o=this.datav.getUint8(this.pos++,!0),s=n*this.width*4+2*a*4,l=o>>4,c=15&o,u=this.palette[l];if(this.data[s]=u.blue,this.data[s+1]=u.green,this.data[s+2]=u.red,this.data[s+3]=255,2*a+1>=this.width)break;u=this.palette[c],this.data[s+4]=u.blue,this.data[s+4+1]=u.green,this.data[s+4+2]=u.red,this.data[s+4+3]=255}t!==0&&(this.pos+=4-t)}},es.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var a=this.datav.getUint8(this.pos++,!0),o=r*this.width*4+4*n;if(a<this.palette.length){var s=this.palette[a];this.data[o]=s.red,this.data[o+1]=s.green,this.data[o+2]=s.blue,this.data[o+3]=255}else this.data[o]=255,this.data[o+1]=255,this.data[o+2]=255,this.data[o+3]=255}e!==0&&(this.pos+=4-e)}},es.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,a=0;a<this.width;a++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var s=(o&t)/t*255|0,l=(o>>5&t)/t*255|0,c=(o>>10&t)/t*255|0,u=o>>15?255:0,d=n*this.width*4+4*a;this.data[d]=c,this.data[d+1]=l,this.data[d+2]=s,this.data[d+3]=u}this.pos+=e}},es.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),r=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var a=this.bottom_up?n:this.height-1-n,o=0;o<this.width;o++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(s&t)/t*255|0,c=(s>>5&r)/r*255|0,u=(s>>11)/t*255|0,d=a*this.width*4+4*o;this.data[d]=u,this.data[d+1]=c,this.data[d+2]=l,this.data[d+3]=255}this.pos+=e}},es.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),s=t*this.width*4+4*r;this.data[s]=o,this.data[s+1]=a,this.data[s+2]=n,this.data[s+3]=255}this.pos+=this.width%4}},es.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),l=t*this.width*4+4*r;this.data[l]=o,this.data[l+1]=a,this.data[l+2]=n,this.data[l+3]=s}},es.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,r,n,a){var o=new es(t,!1),s=o.width,l=o.height,c={data:o.getData(),width:s,height:l},u=new P2(100).encode(c,100);return e.processJPEG.call(this,u,r,n,a)}}(wr.API),nE.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,r,n,a){var o=new nE(t),s=o.width,l=o.height,c={data:o.getData(),width:s,height:l},u=new P2(100).encode(c,100);return e.processJPEG.call(this,u,r,n,a)}}(wr.API),wr.API.processRGBA=function(e,t,r){for(var n=e.data,a=n.length,o=new Uint8Array(a/4*3),s=new Uint8Array(a/4),l=0,c=0,u=0;u<a;u+=4){var d=n[u],f=n[u+1],h=n[u+2],p=n[u+3];o[l++]=d,o[l++]=f,o[l++]=h,s[c++]=p}var v=this.__addimage__.arrayBufferToBinaryString(o);return{alpha:this.__addimage__.arrayBufferToBinaryString(s),data:v,index:t,alias:r,colorSpace:"DeviceRGB",bitsPerComponent:8,width:e.width,height:e.height}},wr.API.setLanguage=function(e){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]!==void 0&&(this.internal.languageSettings.languageCode=e,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Au=wr.API,Rm=Au.getCharWidthsArray=function(e,t){var r,n,a=(t=t||{}).font||this.internal.getFont(),o=t.fontSize||this.internal.getFontSize(),s=t.charSpace||this.internal.getCharSpace(),l=t.widths?t.widths:a.metadata.Unicode.widths,c=l.fof?l.fof:1,u=t.kerning?t.kerning:a.metadata.Unicode.kerning,d=u.fof?u.fof:1,f=t.doKerning!==!1,h=0,p=e.length,v=0,m=l[0]||c,y=[];for(r=0;r<p;r++)n=e.charCodeAt(r),typeof a.metadata.widthOfString=="function"?y.push((a.metadata.widthOfGlyph(a.metadata.characterToGlyph(n))+s*(1e3/o)||0)/1e3):(h=f&&gn(u[n])==="object"&&!isNaN(parseInt(u[n][v],10))?u[n][v]/d:0,y.push((l[n]||m)/c+h)),v=n;return y},Z4=Au.getStringUnitWidth=function(e,t){var r=(t=t||{}).fontSize||this.internal.getFontSize(),n=t.font||this.internal.getFont(),a=t.charSpace||this.internal.getCharSpace();return Au.processArabic&&(e=Au.processArabic(e)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(e,r,a)/r:Rm.apply(this,arguments).reduce(function(o,s){return o+s},0)},eE=function(e,t,r,n){for(var a=[],o=0,s=e.length,l=0;o!==s&&l+t[o]<r;)l+=t[o],o++;a.push(e.slice(0,o));var c=o;for(l=0;o!==s;)l+t[o]>n&&(a.push(e.slice(c,o)),l=0,c=o),l+=t[o],o++;return c!==o&&a.push(e.slice(c,o)),a},tE=function(e,t,r){r||(r={});var n,a,o,s,l,c,u,d=[],f=[d],h=r.textIndent||0,p=0,v=0,m=e.split(" "),y=Rm.apply(this,[" ",r])[0];if(c=r.lineIndent===-1?m[0].length+2:r.lineIndent||0){var b=Array(c).join(" "),_=[];m.map(function(A){(A=A.split(/\s*\n/)).length>1?_=_.concat(A.map(function(P,T){return(T&&P.length?`
`:"")+P})):_.push(A[0])}),m=_,c=Z4.apply(this,[b,r])}for(o=0,s=m.length;o<s;o++){var w=0;if(n=m[o],c&&n[0]==`
`&&(n=n.substr(1),w=1),h+p+(v=(a=Rm.apply(this,[n,r])).reduce(function(A,P){return A+P},0))>t||w){if(v>t){for(l=eE.apply(this,[n,a,t-(h+p),t]),d.push(l.shift()),d=[l.pop()];l.length;)f.push([l.shift()]);v=a.slice(n.length-(d[0]?d[0].length:0)).reduce(function(A,P){return A+P},0)}else d=[n];f.push(d),h=v+c,p=y}else d.push(n),h+=p+v,p=y}return u=c?function(A,P){return(P?b:"")+A.join(" ")}:function(A){return A.join(" ")},f.map(u)},Au.splitTextToSize=function(e,t,r){var n,a=(r=r||{}).fontSize||this.internal.getFontSize(),o=(function(d){if(d.widths&&d.kerning)return{widths:d.widths,kerning:d.kerning};var f=this.internal.getFont(d.fontName,d.fontStyle);return f.metadata.Unicode?{widths:f.metadata.Unicode.widths||{0:1},kerning:f.metadata.Unicode.kerning||{}}:{font:f.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,r);n=Array.isArray(e)?e:String(e).split(/\r?\n/);var s=1*this.internal.scaleFactor*t/a;o.textIndent=r.textIndent?1*r.textIndent*this.internal.scaleFactor/a:0,o.lineIndent=r.lineIndent;var l,c,u=[];for(l=0,c=n.length;l<c;l++)u=u.concat(tE.apply(this,[n[l],s,o]));return u},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="klmnopqrstuvwxyz",r={},n={},a=0;a<t.length;a++)r[t[a]]="0123456789abcdef"[a],n["0123456789abcdef"[a]]=t[a];var o=function(f){return"0x"+parseInt(f,10).toString(16)},s=e.__fontmetrics__.compress=function(f){var h,p,v,m,y=["{"];for(var b in f){if(h=f[b],isNaN(parseInt(b,10))?p="'"+b+"'":(b=parseInt(b,10),p=(p=o(b).slice(2)).slice(0,-1)+n[p.slice(-1)]),typeof h=="number")h<0?(v=o(h).slice(3),m="-"):(v=o(h).slice(2),m=""),v=m+v.slice(0,-1)+n[v.slice(-1)];else{if(gn(h)!=="object")throw new Error("Don't know what to do with value type "+gn(h)+".");v=s(h)}y.push(p+v)}return y.push("}"),y.join("")},l=e.__fontmetrics__.uncompress=function(f){if(typeof f!="string")throw new Error("Invalid argument passed to uncompress.");for(var h,p,v,m,y={},b=1,_=y,w=[],A="",P="",T=f.length-1,E=1;E<T;E+=1)(m=f[E])=="'"?h?(v=h.join(""),h=void 0):h=[]:h?h.push(m):m=="{"?(w.push([_,v]),_={},v=void 0):m=="}"?((p=w.pop())[0][p[1]]=_,v=void 0,_=p[0]):m=="-"?b=-1:v===void 0?r.hasOwnProperty(m)?(A+=r[m],v=parseInt(A,16)*b,b=1,A=""):A+=m:r.hasOwnProperty(m)?(P+=r[m],_[v]=parseInt(P,16)*b,b=1,v=void 0,P=""):P+=m;return y},c={codePages:["WinAnsiEncoding"],WinAnsiEncoding:l("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},u={Unicode:{Courier:c,"Courier-Bold":c,"Courier-BoldOblique":c,"Courier-Oblique":c,Helvetica:c,"Helvetica-Bold":c,"Helvetica-BoldOblique":c,"Helvetica-Oblique":c,"Times-Roman":c,"Times-Bold":c,"Times-BoldItalic":c,"Times-Italic":c}},d={Unicode:{"Courier-Oblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":l("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":l("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:l("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:l("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":l("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":l("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(f){var h=f.font,p=d.Unicode[h.postScriptName];p&&(h.metadata.Unicode={},h.metadata.Unicode.widths=p.widths,h.metadata.Unicode.kerning=p.kerning);var v=u.Unicode[h.postScriptName];v&&(h.metadata.Unicode.encoding=v,h.encoding=v.codePages[0])}])}(wr.API),function(e){var t=function(r){for(var n=r.length,a=new Uint8Array(n),o=0;o<n;o++)a[o]=r.charCodeAt(o);return a};e.API.events.push(["addFont",function(r){var n=void 0,a=r.font,o=r.instance;if(!a.isStandardFont){if(o===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");if(typeof(n=o.existsFileInVFS(a.postScriptName)===!1?o.loadFile(a.postScriptName):o.getFileFromVFS(a.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");(function(s,l){l=/^\x00\x01\x00\x00/.test(l)?t(l):t(Rh(l)),s.metadata=e.API.TTFFont.open(l),s.metadata.Unicode=s.metadata.Unicode||{encoding:{},kerning:{},widths:[]},s.metadata.glyIdsUsed=[0]})(a,n)}}])}(wr),function(e){function t(){return(Or.canvg?Promise.resolve(Or.canvg):Sw(()=>import("./index.es-DBnXEFbX.js"),__vite__mapDeps([0,1,2]))).catch(function(r){return Promise.reject(new Error("Could not load canvg: "+r))}).then(function(r){return r.default?r.default:r})}wr.API.addSvgAsImage=function(r,n,a,o,s,l,c,u){if(isNaN(n)||isNaN(a))throw On.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(o)||isNaN(s))throw On.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var d=document.createElement("canvas");d.width=o,d.height=s;var f=d.getContext("2d");f.fillStyle="#fff",f.fillRect(0,0,d.width,d.height);var h={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},p=this;return t().then(function(v){return v.fromString(f,r,h)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(v){return v.render(h)}).then(function(){p.addImage(d.toDataURL("image/jpeg",1),n,a,o,s,c,u)})}}(),wr.API.putTotalPages=function(e){var t,r=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),r=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),r=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var a=0;a<this.internal.pages[n].length;a++)this.internal.pages[n][a]=this.internal.pages[n][a].replace(t,r);return this},wr.API.viewerPreferences=function(e,t){var r;e=e||{},t=t||!1;var n,a,o,s={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},l=Object.keys(s),c=[],u=0,d=0,f=0;function h(v,m){var y,b=!1;for(y=0;y<v.length;y+=1)v[y]===m&&(b=!0);return b}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(s)),this.internal.viewerpreferences.isSubscribed=!1),r=this.internal.viewerpreferences.configuration,e==="reset"||t===!0){var p=l.length;for(f=0;f<p;f+=1)r[l[f]].value=r[l[f]].defaultValue,r[l[f]].explicitSet=!1}if(gn(e)==="object"){for(a in e)if(o=e[a],h(l,a)&&o!==void 0){if(r[a].type==="boolean"&&typeof o=="boolean")r[a].value=o;else if(r[a].type==="name"&&h(r[a].valueSet,o))r[a].value=o;else if(r[a].type==="integer"&&Number.isInteger(o))r[a].value=o;else if(r[a].type==="array"){for(u=0;u<o.length;u+=1)if(n=!0,o[u].length===1&&typeof o[u][0]=="number")c.push(String(o[u]-1));else if(o[u].length>1){for(d=0;d<o[u].length;d+=1)typeof o[u][d]!="number"&&(n=!1);n===!0&&c.push([o[u][0]-1,o[u][1]-1].join(" "))}r[a].value="["+c.join(" ")+"]"}else r[a].value=r[a].defaultValue;r[a].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var v,m=[];for(v in r)r[v].explicitSet===!0&&(r[v].type==="name"?m.push("/"+v+" /"+r[v].value):m.push("/"+v+" "+r[v].value));m.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+m.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=r,this},function(e){var t=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',a=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),o=unescape(encodeURIComponent(n)),s=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),l=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),c=unescape(encodeURIComponent("</x:xmpmeta>")),u=o.length+s.length+l.length+a.length+c.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+u+" >>"),this.internal.write("stream"),this.internal.write(a+o+s+l+c),this.internal.write("endstream"),this.internal.write("endobj")},r=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};e.addMetadata=function(n,a){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:a||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",r),this.internal.events.subscribe("postPutResources",t)),this}}(wr.API),function(e){var t=e.API,r=t.pdfEscape16=function(o,s){for(var l,c=s.metadata.Unicode.widths,u=["","0","00","000","0000"],d=[""],f=0,h=o.length;f<h;++f){if(l=s.metadata.characterToGlyph(o.charCodeAt(f)),s.metadata.glyIdsUsed.push(l),s.metadata.toUnicode[l]=o.charCodeAt(f),c.indexOf(l)==-1&&(c.push(l),c.push([parseInt(s.metadata.widthOfGlyph(l),10)])),l=="0")return d.join("");l=l.toString(16),d.push(u[4-l.length],l)}return d.join("")},n=function(o){var s,l,c,u,d,f,h;for(d=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,c=[],f=0,h=(l=Object.keys(o).sort(function(p,v){return p-v})).length;f<h;f++)s=l[f],c.length>=100&&(d+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar`,c=[]),o[s]!==void 0&&o[s]!==null&&typeof o[s].toString=="function"&&(u=("0000"+o[s].toString(16)).slice(-4),s=("0000"+(+s).toString(16)).slice(-4),c.push("<"+s+"><"+u+">"));return c.length&&(d+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar
`),d+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(o){(function(s){var l=s.font,c=s.out,u=s.newObject,d=s.putStream;if(l.metadata instanceof e.API.TTFFont&&l.encoding==="Identity-H"){for(var f=l.metadata.Unicode.widths,h=l.metadata.subset.encode(l.metadata.glyIdsUsed,1),p="",v=0;v<h.length;v++)p+=String.fromCharCode(h[v]);var m=u();d({data:p,addLength1:!0,objectId:m}),c("endobj");var y=u();d({data:n(l.metadata.toUnicode),addLength1:!0,objectId:y}),c("endobj");var b=u();c("<<"),c("/Type /FontDescriptor"),c("/FontName /"+Tu(l.fontName)),c("/FontFile2 "+m+" 0 R"),c("/FontBBox "+e.API.PDFObject.convert(l.metadata.bbox)),c("/Flags "+l.metadata.flags),c("/StemV "+l.metadata.stemV),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c(">>"),c("endobj");var _=u();c("<<"),c("/Type /Font"),c("/BaseFont /"+Tu(l.fontName)),c("/FontDescriptor "+b+" 0 R"),c("/W "+e.API.PDFObject.convert(f)),c("/CIDToGIDMap /Identity"),c("/DW 1000"),c("/Subtype /CIDFontType2"),c("/CIDSystemInfo"),c("<<"),c("/Supplement 0"),c("/Registry (Adobe)"),c("/Ordering ("+l.encoding+")"),c(">>"),c(">>"),c("endobj"),l.objectNumber=u(),c("<<"),c("/Type /Font"),c("/Subtype /Type0"),c("/ToUnicode "+y+" 0 R"),c("/BaseFont /"+Tu(l.fontName)),c("/Encoding /"+l.encoding),c("/DescendantFonts ["+_+" 0 R]"),c(">>"),c("endobj"),l.isAlreadyPutted=!0}})(o)}]),t.events.push(["putFont",function(o){(function(s){var l=s.font,c=s.out,u=s.newObject,d=s.putStream;if(l.metadata instanceof e.API.TTFFont&&l.encoding==="WinAnsiEncoding"){for(var f=l.metadata.rawData,h="",p=0;p<f.length;p++)h+=String.fromCharCode(f[p]);var v=u();d({data:h,addLength1:!0,objectId:v}),c("endobj");var m=u();d({data:n(l.metadata.toUnicode),addLength1:!0,objectId:m}),c("endobj");var y=u();c("<<"),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c("/StemV "+l.metadata.stemV),c("/Type /FontDescriptor"),c("/FontFile2 "+v+" 0 R"),c("/Flags 96"),c("/FontBBox "+e.API.PDFObject.convert(l.metadata.bbox)),c("/FontName /"+Tu(l.fontName)),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c(">>"),c("endobj"),l.objectNumber=u();for(var b=0;b<l.metadata.hmtx.widths.length;b++)l.metadata.hmtx.widths[b]=parseInt(l.metadata.hmtx.widths[b]*(1e3/l.metadata.head.unitsPerEm));c("<</Subtype/TrueType/Type/Font/ToUnicode "+m+" 0 R/BaseFont/"+Tu(l.fontName)+"/FontDescriptor "+y+" 0 R/Encoding/"+l.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(l.metadata.hmtx.widths)+">>"),c("endobj"),l.isAlreadyPutted=!0}})(o)}]);var a=function(o){var s,l=o.text||"",c=o.x,u=o.y,d=o.options||{},f=o.mutex||{},h=f.pdfEscape,p=f.activeFontKey,v=f.fonts,m=p,y="",b=0,_="",w=v[m].encoding;if(v[m].encoding!=="Identity-H")return{text:l,x:c,y:u,options:d,mutex:f};for(_=l,m=p,Array.isArray(l)&&(_=l[0]),b=0;b<_.length;b+=1)v[m].metadata.hasOwnProperty("cmap")&&(s=v[m].metadata.cmap.unicode.codeMap[_[b].charCodeAt(0)]),s||_[b].charCodeAt(0)<256&&v[m].metadata.hasOwnProperty("Unicode")?y+=_[b]:y+="";var A="";return parseInt(m.slice(1))<14||w==="WinAnsiEncoding"?A=h(y,m).split("").map(function(P){return P.charCodeAt(0).toString(16)}).join(""):w==="Identity-H"&&(A=r(y,v[m])),f.isHex=!0,{text:A,x:c,y:u,options:d,mutex:f}};t.events.push(["postProcessText",function(o){var s=o.text||"",l=[],c={text:s,x:o.x,y:o.y,options:o.options,mutex:o.mutex};if(Array.isArray(s)){var u=0;for(u=0;u<s.length;u+=1)Array.isArray(s[u])&&s[u].length===3?l.push([a(Object.assign({},c,{text:s[u][0]})).text,s[u][1],s[u][2]]):l.push(a(Object.assign({},c,{text:s[u]})).text);o.text=l}else o.text=a(Object.assign({},c,{text:s})).text}])}(wr),function(e){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0},e.addFileToVFS=function(r,n){return t.call(this),this.internal.vFS[r]=n,this},e.getFileFromVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0?this.internal.vFS[r]:null}}(wr.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(n){var a,o,s,l,c,u,d,f=t,h=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],p=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],v={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},m={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},y=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],b=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),_=!1,w=0;this.__bidiEngine__={};var A=function(O){var D=O.charCodeAt(),R=D>>8,F=m[R];return F!==void 0?f[256*F+(255&D)]:R===252||R===253?"AL":b.test(R)?"L":R===8?"R":"N"},P=function(O){for(var D,R=0;R<O.length;R++){if((D=A(O.charAt(R)))==="L")return!1;if(D==="R")return!0}return!1},T=function(O,D,R,F){var z,K,J,L,k=D[F];switch(k){case"L":case"R":_=!1;break;case"N":case"AN":break;case"EN":_&&(k="AN");break;case"AL":_=!0,k="R";break;case"WS":k="N";break;case"CS":F<1||F+1>=D.length||(z=R[F-1])!=="EN"&&z!=="AN"||(K=D[F+1])!=="EN"&&K!=="AN"?k="N":_&&(K="AN"),k=K===z?K:"N";break;case"ES":k=(z=F>0?R[F-1]:"B")==="EN"&&F+1<D.length&&D[F+1]==="EN"?"EN":"N";break;case"ET":if(F>0&&R[F-1]==="EN"){k="EN";break}if(_){k="N";break}for(J=F+1,L=D.length;J<L&&D[J]==="ET";)J++;k=J<L&&D[J]==="EN"?"EN":"N";break;case"NSM":if(s&&!l){for(L=D.length,J=F+1;J<L&&D[J]==="NSM";)J++;if(J<L){var $=O[F],X=$>=1425&&$<=2303||$===64286;if(z=D[J],X&&(z==="R"||z==="AL")){k="R";break}}}k=F<1||(z=D[F-1])==="B"?"N":R[F-1];break;case"B":_=!1,a=!0,k=w;break;case"S":o=!0,k="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":_=!1;break;case"BN":k="N"}return k},E=function(O,D,R){var F=O.split("");return R&&S(F,R,{hiLevel:w}),F.reverse(),D&&D.reverse(),F.join("")},S=function(O,D,R){var F,z,K,J,L,k=-1,$=O.length,X=0,C=[],M=w?p:h,H=[];for(_=!1,a=!1,o=!1,z=0;z<$;z++)H[z]=A(O[z]);for(K=0;K<$;K++){if(L=X,C[K]=T(O,H,C,K),F=240&(X=M[L][v[C[K]]]),X&=15,D[K]=J=M[X][5],F>0)if(F===16){for(z=k;z<K;z++)D[z]=1;k=-1}else k=-1;if(M[X][6])k===-1&&(k=K);else if(k>-1){for(z=k;z<K;z++)D[z]=J;k=-1}H[K]==="B"&&(D[K]=0),R.hiLevel|=J}o&&function(U,te,le){for(var oe=0;oe<le;oe++)if(U[oe]==="S"){te[oe]=w;for(var ae=oe-1;ae>=0&&U[ae]==="WS";ae--)te[ae]=w}}(H,D,$)},I=function(O,D,R,F,z){if(!(z.hiLevel<O)){if(O===1&&w===1&&!a)return D.reverse(),void(R&&R.reverse());for(var K,J,L,k,$=D.length,X=0;X<$;){if(F[X]>=O){for(L=X+1;L<$&&F[L]>=O;)L++;for(k=X,J=L-1;k<J;k++,J--)K=D[k],D[k]=D[J],D[J]=K,R&&(K=R[k],R[k]=R[J],R[J]=K);X=L}X++}}},W=function(O,D,R){var F=O.split(""),z={hiLevel:w};return R||(R=[]),S(F,R,z),function(K,J,L){if(L.hiLevel!==0&&d)for(var k,$=0;$<K.length;$++)J[$]===1&&(k=y.indexOf(K[$]))>=0&&(K[$]=y[k+1])}(F,R,z),I(2,F,D,R,z),I(1,F,D,R,z),F.join("")};return this.__bidiEngine__.doBidiReorder=function(O,D,R){if(function(z,K){if(K)for(var J=0;J<z.length;J++)K[J]=J;l===void 0&&(l=P(z)),u===void 0&&(u=P(z))}(O,D),s||!c||u)if(s&&c&&l^u)w=l?1:0,O=E(O,D,R);else if(!s&&c&&u)w=l?1:0,O=W(O,D,R),O=E(O,D);else if(!s||l||c||u){if(s&&!c&&l^u)O=E(O,D),l?(w=0,O=W(O,D,R)):(w=1,O=W(O,D,R),O=E(O,D));else if(s&&l&&!c&&u)w=1,O=W(O,D,R),O=E(O,D);else if(!s&&!c&&l^u){var F=d;l?(w=1,O=W(O,D,R),w=0,d=!1,O=W(O,D,R),d=F):(w=0,O=W(O,D,R),O=E(O,D),w=1,d=!1,O=W(O,D,R),d=F,O=E(O,D))}}else w=0,O=W(O,D,R);else w=l?1:0,O=W(O,D,R);return O},this.__bidiEngine__.setOptions=function(O){O&&(s=O.isInputVisual,c=O.isOutputVisual,l=O.isInputRtl,u=O.isOutputRtl,d=O.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],r=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(n){var a=n.text;n.x,n.y;var o=n.options||{};n.mutex,o.lang;var s=[];if(o.isInputVisual=typeof o.isInputVisual!="boolean"||o.isInputVisual,r.setOptions(o),Object.prototype.toString.call(a)==="[object Array]"){var l=0;for(s=[],l=0;l<a.length;l+=1)Object.prototype.toString.call(a[l])==="[object Array]"?s.push([r.doBidiReorder(a[l][0]),a[l][1],a[l][2]]):s.push([r.doBidiReorder(a[l])]);n.text=s}else n.text=r.doBidiReorder(a);r.setOptions({isInputVisual:!0})}])}(wr),wr.API.TTFFont=function(){function e(t){var r;if(this.rawData=t,r=this.contents=new nc(t),this.contents.pos=4,r.readString(4)==="ttcf")throw new Error("TTCF not supported.");r.pos=0,this.parse(),this.subset=new _ce(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new sce(this.contents),this.head=new cce(this),this.name=new pce(this),this.cmap=new R6(this),this.toUnicode={},this.hhea=new uce(this),this.maxp=new mce(this),this.hmtx=new gce(this),this.post=new fce(this),this.os2=new dce(this),this.loca=new bce(this),this.glyf=new vce(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var t,r,n,a,o;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var s,l,c,u;for(u=[],s=0,l=(c=this.bbox).length;s<l;s++)t=c[s],u.push(Math.round(t*this.scaleFactor));return u}).call(this),this.stemV=0,this.post.exists?(n=255&(a=this.post.italic_angle),(32768&(r=a>>16))!=0&&(r=-(1+(65535^r))),this.italicAngle=+(r+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(o=this.familyClass)===1||o===2||o===3||o===4||o===5||o===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(t){var r;return((r=this.cmap.unicode)!=null?r.codeMap[t]:void 0)||0},e.prototype.widthOfGlyph=function(t){var r;return r=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*r},e.prototype.widthOfString=function(t,r,n){var a,o,s,l;for(s=0,o=0,l=(t=""+t).length;0<=l?o<l:o>l;o=0<=l?++o:--o)a=t.charCodeAt(o),s+=this.widthOfGlyph(this.characterToGlyph(a))+n*(1e3/r)||0;return s*(r/1e3)},e.prototype.lineHeight=function(t,r){var n;return r==null&&(r=!1),n=r?this.lineGap:0,(this.ascender+n-this.decender)/1e3*t},e}();var ds,nc=function(){function e(t){this.data=t??[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(t){return this.data[this.pos++]=t},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},e.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},e.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},e.prototype.readString=function(t){var r,n;for(n=[],r=0;0<=t?r<t:r>t;r=0<=t?++r:--r)n[r]=String.fromCharCode(this.readByte());return n.join("")},e.prototype.writeString=function(t){var r,n,a;for(a=[],r=0,n=t.length;0<=n?r<n:r>n;r=0<=n?++r:--r)a.push(this.writeByte(t.charCodeAt(r)));return a},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(t){return this.writeInt16(t)},e.prototype.readLongLong=function(){var t,r,n,a,o,s,l,c;return t=this.readByte(),r=this.readByte(),n=this.readByte(),a=this.readByte(),o=this.readByte(),s=this.readByte(),l=this.readByte(),c=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^r)+1099511627776*(255^n)+4294967296*(255^a)+16777216*(255^o)+65536*(255^s)+256*(255^l)+(255^c)+1):72057594037927940*t+281474976710656*r+1099511627776*n+4294967296*a+16777216*o+65536*s+256*l+c},e.prototype.writeLongLong=function(t){var r,n;return r=Math.floor(t/4294967296),n=4294967295&t,this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(t){return this.writeInt32(t)},e.prototype.read=function(t){var r,n;for(r=[],n=0;0<=t?n<t:n>t;n=0<=t?++n:--n)r.push(this.readByte());return r},e.prototype.write=function(t){var r,n,a,o;for(o=[],n=0,a=t.length;n<a;n++)r=t[n],o.push(this.writeByte(r));return o},e}(),sce=function(){var e;function t(r){var n,a,o;for(this.scalarType=r.readInt(),this.tableCount=r.readShort(),this.searchRange=r.readShort(),this.entrySelector=r.readShort(),this.rangeShift=r.readShort(),this.tables={},a=0,o=this.tableCount;0<=o?a<o:a>o;a=0<=o?++a:--a)n={tag:r.readString(4),checksum:r.readInt(),offset:r.readInt(),length:r.readInt()},this.tables[n.tag]=n}return t.prototype.encode=function(r){var n,a,o,s,l,c,u,d,f,h,p,v,m;for(m in p=Object.keys(r).length,c=Math.log(2),f=16*Math.floor(Math.log(p)/c),s=Math.floor(f/c),d=16*p-f,(a=new nc).writeInt(this.scalarType),a.writeShort(p),a.writeShort(f),a.writeShort(s),a.writeShort(d),o=16*p,u=a.pos+o,l=null,v=[],r)for(h=r[m],a.writeString(m),a.writeInt(e(h)),a.writeInt(u),a.writeInt(h.length),v=v.concat(h),m==="head"&&(l=u),u+=h.length;u%4;)v.push(0),u++;return a.write(v),n=2981146554-e(a.data),a.pos=l+8,a.writeUInt32(n),a.data},e=function(r){var n,a,o,s;for(r=q6.call(r);r.length%4;)r.push(0);for(o=new nc(r),a=0,n=0,s=r.length;n<s;n=n+=4)a+=o.readUInt32();return 4294967295&a},t}(),lce={}.hasOwnProperty,qs=function(e,t){for(var r in t)lce.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};ds=function(){function e(t){var r;this.file=t,r=this.file.directory.tables[this.tag],this.exists=!!r,r&&(this.offset=r.offset,this.length=r.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var cce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="head",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.revision=r.readInt(),this.checkSumAdjustment=r.readInt(),this.magicNumber=r.readInt(),this.flags=r.readShort(),this.unitsPerEm=r.readShort(),this.created=r.readLongLong(),this.modified=r.readLongLong(),this.xMin=r.readShort(),this.yMin=r.readShort(),this.xMax=r.readShort(),this.yMax=r.readShort(),this.macStyle=r.readShort(),this.lowestRecPPEM=r.readShort(),this.fontDirectionHint=r.readShort(),this.indexToLocFormat=r.readShort(),this.glyphDataFormat=r.readShort()},t.prototype.encode=function(r){var n;return(n=new nc).writeInt(this.version),n.writeInt(this.revision),n.writeInt(this.checkSumAdjustment),n.writeInt(this.magicNumber),n.writeShort(this.flags),n.writeShort(this.unitsPerEm),n.writeLongLong(this.created),n.writeLongLong(this.modified),n.writeShort(this.xMin),n.writeShort(this.yMin),n.writeShort(this.xMax),n.writeShort(this.yMax),n.writeShort(this.macStyle),n.writeShort(this.lowestRecPPEM),n.writeShort(this.fontDirectionHint),n.writeShort(r),n.writeShort(this.glyphDataFormat),n.data},t}(),aE=function(){function e(t,r){var n,a,o,s,l,c,u,d,f,h,p,v,m,y,b,_,w;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=r+t.readInt(),f=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(c=0;c<256;++c)this.codeMap[c]=t.readByte();break;case 4:for(p=t.readUInt16(),h=p/2,t.pos+=6,o=function(){var A,P;for(P=[],c=A=0;0<=h?A<h:A>h;c=0<=h?++A:--A)P.push(t.readUInt16());return P}(),t.pos+=2,m=function(){var A,P;for(P=[],c=A=0;0<=h?A<h:A>h;c=0<=h?++A:--A)P.push(t.readUInt16());return P}(),u=function(){var A,P;for(P=[],c=A=0;0<=h?A<h:A>h;c=0<=h?++A:--A)P.push(t.readUInt16());return P}(),d=function(){var A,P;for(P=[],c=A=0;0<=h?A<h:A>h;c=0<=h?++A:--A)P.push(t.readUInt16());return P}(),a=(this.length-t.pos+this.offset)/2,l=function(){var A,P;for(P=[],c=A=0;0<=a?A<a:A>a;c=0<=a?++A:--A)P.push(t.readUInt16());return P}(),c=b=0,w=o.length;b<w;c=++b)for(y=o[c],n=_=v=m[c];v<=y?_<=y:_>=y;n=v<=y?++_:--_)d[c]===0?s=n+u[c]:(s=l[d[c]/2+(n-v)-(h-c)]||0)!==0&&(s+=u[c]),this.codeMap[n]=65535&s}t.pos=f}return e.encode=function(t,r){var n,a,o,s,l,c,u,d,f,h,p,v,m,y,b,_,w,A,P,T,E,S,I,W,O,D,R,F,z,K,J,L,k,$,X,C,M,H,U,te,le,oe,ae,he,me,Q;switch(F=new nc,s=Object.keys(t).sort(function(G,ee){return G-ee}),r){case"macroman":for(m=0,y=function(){var G=[];for(v=0;v<256;++v)G.push(0);return G}(),_={0:0},o={},z=0,k=s.length;z<k;z++)_[ae=t[a=s[z]]]==null&&(_[ae]=++m),o[a]={old:t[a],new:_[t[a]]},y[a]=_[t[a]];return F.writeUInt16(1),F.writeUInt16(0),F.writeUInt32(12),F.writeUInt16(0),F.writeUInt16(262),F.writeUInt16(0),F.write(y),{charMap:o,subtable:F.data,maxGlyphID:m+1};case"unicode":for(D=[],f=[],w=0,_={},n={},b=u=null,K=0,$=s.length;K<$;K++)_[P=t[a=s[K]]]==null&&(_[P]=++w),n[a]={old:P,new:_[P]},l=_[P]-a,b!=null&&l===u||(b&&f.push(b),D.push(a),u=l),b=a;for(b&&f.push(b),f.push(65535),D.push(65535),W=2*(I=D.length),S=2*Math.pow(Math.log(I)/Math.LN2,2),h=Math.log(S/2)/Math.LN2,E=2*I-S,c=[],T=[],p=[],v=J=0,X=D.length;J<X;v=++J){if(O=D[v],d=f[v],O===65535){c.push(0),T.push(0);break}if(O-(R=n[O].new)>=32768)for(c.push(0),T.push(2*(p.length+I-v)),a=L=O;O<=d?L<=d:L>=d;a=O<=d?++L:--L)p.push(n[a].new);else c.push(R-O),T.push(0)}for(F.writeUInt16(3),F.writeUInt16(1),F.writeUInt32(12),F.writeUInt16(4),F.writeUInt16(16+8*I+2*p.length),F.writeUInt16(0),F.writeUInt16(W),F.writeUInt16(S),F.writeUInt16(h),F.writeUInt16(E),le=0,C=f.length;le<C;le++)a=f[le],F.writeUInt16(a);for(F.writeUInt16(0),oe=0,M=D.length;oe<M;oe++)a=D[oe],F.writeUInt16(a);for(he=0,H=c.length;he<H;he++)l=c[he],F.writeUInt16(l);for(me=0,U=T.length;me<U;me++)A=T[me],F.writeUInt16(A);for(Q=0,te=p.length;Q<te;Q++)m=p[Q],F.writeUInt16(m);return{charMap:n,subtable:F.data,maxGlyphID:w+1}}},e}(),R6=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="cmap",t.prototype.parse=function(r){var n,a,o;for(r.pos=this.offset,this.version=r.readUInt16(),o=r.readUInt16(),this.tables=[],this.unicode=null,a=0;0<=o?a<o:a>o;a=0<=o?++a:--a)n=new aE(r,this.offset),this.tables.push(n),n.isUnicode&&this.unicode==null&&(this.unicode=n);return!0},t.encode=function(r,n){var a,o;return n==null&&(n="macroman"),a=aE.encode(r,n),(o=new nc).writeUInt16(0),o.writeUInt16(1),a.table=o.data.concat(a.subtable),a},t}(),uce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="hhea",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.ascender=r.readShort(),this.decender=r.readShort(),this.lineGap=r.readShort(),this.advanceWidthMax=r.readShort(),this.minLeftSideBearing=r.readShort(),this.minRightSideBearing=r.readShort(),this.xMaxExtent=r.readShort(),this.caretSlopeRise=r.readShort(),this.caretSlopeRun=r.readShort(),this.caretOffset=r.readShort(),r.pos+=8,this.metricDataFormat=r.readShort(),this.numberOfMetrics=r.readUInt16()},t}(),dce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="OS/2",t.prototype.parse=function(r){if(r.pos=this.offset,this.version=r.readUInt16(),this.averageCharWidth=r.readShort(),this.weightClass=r.readUInt16(),this.widthClass=r.readUInt16(),this.type=r.readShort(),this.ySubscriptXSize=r.readShort(),this.ySubscriptYSize=r.readShort(),this.ySubscriptXOffset=r.readShort(),this.ySubscriptYOffset=r.readShort(),this.ySuperscriptXSize=r.readShort(),this.ySuperscriptYSize=r.readShort(),this.ySuperscriptXOffset=r.readShort(),this.ySuperscriptYOffset=r.readShort(),this.yStrikeoutSize=r.readShort(),this.yStrikeoutPosition=r.readShort(),this.familyClass=r.readShort(),this.panose=function(){var n,a;for(a=[],n=0;n<10;++n)a.push(r.readByte());return a}(),this.charRange=function(){var n,a;for(a=[],n=0;n<4;++n)a.push(r.readInt());return a}(),this.vendorID=r.readString(4),this.selection=r.readShort(),this.firstCharIndex=r.readShort(),this.lastCharIndex=r.readShort(),this.version>0&&(this.ascent=r.readShort(),this.descent=r.readShort(),this.lineGap=r.readShort(),this.winAscent=r.readShort(),this.winDescent=r.readShort(),this.codePageRange=function(){var n,a;for(a=[],n=0;n<2;n=++n)a.push(r.readInt());return a}(),this.version>1))return this.xHeight=r.readShort(),this.capHeight=r.readShort(),this.defaultChar=r.readShort(),this.breakChar=r.readShort(),this.maxContext=r.readShort()},t}(),fce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="post",t.prototype.parse=function(r){var n,a,o;switch(r.pos=this.offset,this.format=r.readInt(),this.italicAngle=r.readInt(),this.underlinePosition=r.readShort(),this.underlineThickness=r.readShort(),this.isFixedPitch=r.readInt(),this.minMemType42=r.readInt(),this.maxMemType42=r.readInt(),this.minMemType1=r.readInt(),this.maxMemType1=r.readInt(),this.format){case 65536:break;case 131072:var s;for(a=r.readUInt16(),this.glyphNameIndex=[],s=0;0<=a?s<a:s>a;s=0<=a?++s:--s)this.glyphNameIndex.push(r.readUInt16());for(this.names=[],o=[];r.pos<this.offset+this.length;)n=r.readByte(),o.push(this.names.push(r.readString(n)));return o;case 151552:return a=r.readUInt16(),this.offsets=r.read(a);case 196608:break;case 262144:return this.map=(function(){var l,c,u;for(u=[],s=l=0,c=this.file.maxp.numGlyphs;0<=c?l<c:l>c;s=0<=c?++l:--l)u.push(r.readUInt32());return u}).call(this)}},t}(),hce=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},pce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="name",t.prototype.parse=function(r){var n,a,o,s,l,c,u,d,f,h,p;for(r.pos=this.offset,r.readShort(),n=r.readShort(),c=r.readShort(),a=[],s=0;0<=n?s<n:s>n;s=0<=n?++s:--s)a.push({platformID:r.readShort(),encodingID:r.readShort(),languageID:r.readShort(),nameID:r.readShort(),length:r.readShort(),offset:this.offset+c+r.readShort()});for(u={},s=f=0,h=a.length;f<h;s=++f)o=a[s],r.pos=o.offset,d=r.readString(o.length),l=new hce(d,o),u[p=o.nameID]==null&&(u[p]=[]),u[o.nameID].push(l);this.strings=u,this.copyright=u[0],this.fontFamily=u[1],this.fontSubfamily=u[2],this.uniqueSubfamily=u[3],this.fontName=u[4],this.version=u[5];try{this.postscriptName=u[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=u[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=u[7],this.manufacturer=u[8],this.designer=u[9],this.description=u[10],this.vendorUrl=u[11],this.designerUrl=u[12],this.license=u[13],this.licenseUrl=u[14],this.preferredFamily=u[15],this.preferredSubfamily=u[17],this.compatibleFull=u[18],this.sampleText=u[19]},t}(),mce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="maxp",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.numGlyphs=r.readUInt16(),this.maxPoints=r.readUInt16(),this.maxContours=r.readUInt16(),this.maxCompositePoints=r.readUInt16(),this.maxComponentContours=r.readUInt16(),this.maxZones=r.readUInt16(),this.maxTwilightPoints=r.readUInt16(),this.maxStorage=r.readUInt16(),this.maxFunctionDefs=r.readUInt16(),this.maxInstructionDefs=r.readUInt16(),this.maxStackElements=r.readUInt16(),this.maxSizeOfInstructions=r.readUInt16(),this.maxComponentElements=r.readUInt16(),this.maxComponentDepth=r.readUInt16()},t}(),gce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="hmtx",t.prototype.parse=function(r){var n,a,o,s,l,c,u;for(r.pos=this.offset,this.metrics=[],n=0,c=this.file.hhea.numberOfMetrics;0<=c?n<c:n>c;n=0<=c?++n:--n)this.metrics.push({advance:r.readUInt16(),lsb:r.readInt16()});for(o=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var d,f;for(f=[],n=d=0;0<=o?d<o:d>o;n=0<=o?++d:--d)f.push(r.readInt16());return f}(),this.widths=(function(){var d,f,h,p;for(p=[],d=0,f=(h=this.metrics).length;d<f;d++)s=h[d],p.push(s.advance);return p}).call(this),a=this.widths[this.widths.length-1],u=[],n=l=0;0<=o?l<o:l>o;n=0<=o?++l:--l)u.push(this.widths.push(a));return u},t.prototype.forGlyph=function(r){return r in this.metrics?this.metrics[r]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[r-this.metrics.length]}},t}(),q6=[].slice,vce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(r){var n,a,o,s,l,c,u,d,f,h;return r in this.cache?this.cache[r]:(s=this.file.loca,n=this.file.contents,a=s.indexOf(r),(o=s.lengthOf(r))===0?this.cache[r]=null:(n.pos=this.offset+a,l=(c=new nc(n.read(o))).readShort(),d=c.readShort(),h=c.readShort(),u=c.readShort(),f=c.readShort(),this.cache[r]=l===-1?new xce(c,d,h,u,f):new yce(c,l,d,h,u,f),this.cache[r]))},t.prototype.encode=function(r,n,a){var o,s,l,c,u;for(l=[],s=[],c=0,u=n.length;c<u;c++)o=r[n[c]],s.push(l.length),o&&(l=l.concat(o.encode(a)));return s.push(l.length),{table:l,offsets:s}},t}(),yce=function(){function e(t,r,n,a,o,s){this.raw=t,this.numberOfContours=r,this.xMin=n,this.yMin=a,this.xMax=o,this.yMax=s,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),xce=function(){function e(t,r,n,a,o){var s,l;for(this.raw=t,this.xMin=r,this.yMin=n,this.xMax=a,this.yMax=o,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],s=this.raw;l=s.readShort(),this.glyphOffsets.push(s.pos),this.glyphIDs.push(s.readUInt16()),32&l;)s.pos+=1&l?4:2,128&l?s.pos+=8:64&l?s.pos+=4:8&l&&(s.pos+=2)}return e.prototype.encode=function(){var t,r,n;for(r=new nc(q6.call(this.raw.data)),t=0,n=this.glyphIDs.length;t<n;++t)r.pos=this.glyphOffsets[t];return r.data},e}(),bce=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return qs(t,ds),t.prototype.tag="loca",t.prototype.parse=function(r){var n,a;return r.pos=this.offset,n=this.file.head.indexToLocFormat,this.offsets=n===0?(function(){var o,s;for(s=[],a=0,o=this.length;a<o;a+=2)s.push(2*r.readUInt16());return s}).call(this):(function(){var o,s;for(s=[],a=0,o=this.length;a<o;a+=4)s.push(r.readUInt32());return s}).call(this)},t.prototype.indexOf=function(r){return this.offsets[r]},t.prototype.lengthOf=function(r){return this.offsets[r+1]-this.offsets[r]},t.prototype.encode=function(r,n){for(var a=new Uint32Array(this.offsets.length),o=0,s=0,l=0;l<a.length;++l)if(a[l]=o,s<n.length&&n[s]==l){++s,a[l]=o;var c=this.offsets[l],u=this.offsets[l+1]-c;u>0&&(o+=u)}for(var d=new Array(4*a.length),f=0;f<a.length;++f)d[4*f+3]=255&a[f],d[4*f+2]=(65280&a[f])>>8,d[4*f+1]=(16711680&a[f])>>16,d[4*f]=(4278190080&a[f])>>24;return d},t}(),_ce=function(){function e(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var t,r,n,a,o;for(r in a=this.font.cmap.tables[0].codeMap,t={},o=this.subset)n=o[r],t[r]=a[n];return t},e.prototype.glyphsFor=function(t){var r,n,a,o,s,l,c;for(a={},s=0,l=t.length;s<l;s++)a[o=t[s]]=this.font.glyf.glyphFor(o);for(o in r=[],a)(n=a[o])!=null&&n.compound&&r.push.apply(r,n.glyphIDs);if(r.length>0)for(o in c=this.glyphsFor(r))n=c[o],a[o]=n;return a},e.prototype.encode=function(t,r){var n,a,o,s,l,c,u,d,f,h,p,v,m,y,b;for(a in n=R6.encode(this.generateCmap(),"unicode"),s=this.glyphsFor(t),p={0:0},b=n.charMap)p[(c=b[a]).old]=c.new;for(v in h=n.maxGlyphID,s)v in p||(p[v]=h++);return d=function(_){var w,A;for(w in A={},_)A[_[w]]=w;return A}(p),f=Object.keys(d).sort(function(_,w){return _-w}),m=function(){var _,w,A;for(A=[],_=0,w=f.length;_<w;_++)l=f[_],A.push(d[l]);return A}(),o=this.font.glyf.encode(s,m,p),u=this.font.loca.encode(o.offsets,m),y={cmap:this.font.cmap.raw(),glyf:o.table,loca:u,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(r)},this.font.os2.exists&&(y["OS/2"]=this.font.os2.raw()),this.font.directory.encode(y)},e}();wr.API.PDFObject=function(){var e;function t(){}return e=function(r,n){return(Array(n+1).join("0")+r).slice(-n)},t.convert=function(r){var n,a,o,s;if(Array.isArray(r))return"["+function(){var l,c,u;for(u=[],l=0,c=r.length;l<c;l++)n=r[l],u.push(t.convert(n));return u}().join(" ")+"]";if(typeof r=="string")return"/"+r;if(r?.isString)return"("+r+")";if(r instanceof Date)return"(D:"+e(r.getUTCFullYear(),4)+e(r.getUTCMonth(),2)+e(r.getUTCDate(),2)+e(r.getUTCHours(),2)+e(r.getUTCMinutes(),2)+e(r.getUTCSeconds(),2)+"Z)";if({}.toString.call(r)==="[object Object]"){for(a in o=["<<"],r)s=r[a],o.push("/"+a+" "+t.convert(s));return o.push(">>"),o.join(`
`)}return""+r},t}();function F6(e,t,r,n,a){n=n||{};var o=1.15,s=a.internal.scaleFactor,l=a.internal.getFontSize()/s,c=a.getLineHeightFactor?a.getLineHeightFactor():o,u=l*c,d=/\r\n|\r|\n/g,f="",h=1;if((n.valign==="middle"||n.valign==="bottom"||n.halign==="center"||n.halign==="right")&&(f=typeof e=="string"?e.split(d):e,h=f.length||1),r+=l*(2-o),n.valign==="middle"?r-=h/2*u:n.valign==="bottom"&&(r-=h*u),n.halign==="center"||n.halign==="right"){var p=l;if(n.halign==="center"&&(p*=.5),f&&h>=1){for(var v=0;v<f.length;v++)a.text(f[v],t-a.getStringUnitWidth(f[v])*p,r),r+=u;return a}t-=a.getStringUnitWidth(e)*p}return n.halign==="justify"?a.text(e,t,r,{maxWidth:n.maxWidth||100,align:"justify"}):a.text(e,t,r),a}var iE={},Zu=function(){function e(t){this.jsPDFDocument=t,this.userStyles={textColor:t.getTextColor?this.jsPDFDocument.getTextColor():0,fontSize:t.internal.getFontSize(),fontStyle:t.internal.getFont().fontStyle,font:t.internal.getFont().fontName,lineWidth:t.getLineWidth?this.jsPDFDocument.getLineWidth():0,lineColor:t.getDrawColor?this.jsPDFDocument.getDrawColor():0}}return e.setDefaults=function(t,r){r===void 0&&(r=null),r?r.__autoTableDocumentDefaults=t:iE=t},e.unifyColor=function(t){return Array.isArray(t)?t:typeof t=="number"?[t,t,t]:typeof t=="string"?[t]:null},e.prototype.applyStyles=function(t,r){var n,a,o;r===void 0&&(r=!1),t.fontStyle&&this.jsPDFDocument.setFontStyle&&this.jsPDFDocument.setFontStyle(t.fontStyle);var s=this.jsPDFDocument.internal.getFont(),l=s.fontStyle,c=s.fontName;if(t.font&&(c=t.font),t.fontStyle){l=t.fontStyle;var u=this.getFontList()[c];u&&u.indexOf(l)===-1&&this.jsPDFDocument.setFontStyle&&(this.jsPDFDocument.setFontStyle(u[0]),l=u[0])}if(this.jsPDFDocument.setFont(c,l),t.fontSize&&this.jsPDFDocument.setFontSize(t.fontSize),!r){var d=e.unifyColor(t.fillColor);d&&(n=this.jsPDFDocument).setFillColor.apply(n,d),d=e.unifyColor(t.textColor),d&&(a=this.jsPDFDocument).setTextColor.apply(a,d),d=e.unifyColor(t.lineColor),d&&(o=this.jsPDFDocument).setDrawColor.apply(o,d),typeof t.lineWidth=="number"&&this.jsPDFDocument.setLineWidth(t.lineWidth)}},e.prototype.splitTextToSize=function(t,r,n){return this.jsPDFDocument.splitTextToSize(t,r,n)},e.prototype.rect=function(t,r,n,a,o){return this.jsPDFDocument.rect(t,r,n,a,o)},e.prototype.getLastAutoTable=function(){return this.jsPDFDocument.lastAutoTable||null},e.prototype.getTextWidth=function(t){return this.jsPDFDocument.getTextWidth(t)},e.prototype.getDocument=function(){return this.jsPDFDocument},e.prototype.setPage=function(t){this.jsPDFDocument.setPage(t)},e.prototype.addPage=function(){return this.jsPDFDocument.addPage()},e.prototype.getFontList=function(){return this.jsPDFDocument.getFontList()},e.prototype.getGlobalOptions=function(){return iE||{}},e.prototype.getDocumentOptions=function(){return this.jsPDFDocument.__autoTableDocumentDefaults||{}},e.prototype.pageSize=function(){var t=this.jsPDFDocument.internal.pageSize;return t.width==null&&(t={width:t.getWidth(),height:t.getHeight()}),t},e.prototype.scaleFactor=function(){return this.jsPDFDocument.internal.scaleFactor},e.prototype.getLineHeightFactor=function(){var t=this.jsPDFDocument;return t.getLineHeightFactor?t.getLineHeightFactor():1.15},e.prototype.getLineHeight=function(t){return t/this.scaleFactor()*this.getLineHeightFactor()},e.prototype.pageNumber=function(){var t=this.jsPDFDocument.internal.getCurrentPageInfo();return t?t.pageNumber:this.jsPDFDocument.internal.getNumberOfPages()},e}(),Lw=function(e,t){return Lw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},Lw(e,t)};function $6(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Lw(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var B6=function(e){$6(t,e);function t(r){var n=e.call(this)||this;return n._element=r,n}return t}(Array);function wce(e){return{font:"helvetica",fontStyle:"normal",overflow:"linebreak",fillColor:!1,textColor:20,halign:"left",valign:"top",fontSize:10,cellPadding:5/e,lineColor:200,lineWidth:0,cellWidth:"auto",minCellHeight:0,minCellWidth:0}}function jce(e){var t={striped:{table:{fillColor:255,textColor:80,fontStyle:"normal"},head:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},body:{},foot:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},alternateRow:{fillColor:245}},grid:{table:{fillColor:255,textColor:80,fontStyle:"normal",lineWidth:.1},head:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},body:{},foot:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},alternateRow:{}},plain:{head:{fontStyle:"bold"},foot:{fontStyle:"bold"}}};return t[e]}function wv(e,t,r){r.applyStyles(t,!0);var n=Array.isArray(e)?e:[e],a=n.map(function(o){return r.getTextWidth(o)}).reduce(function(o,s){return Math.max(o,s)},0);return a}function U6(e,t,r,n){var a=t.settings.tableLineWidth,o=t.settings.tableLineColor;e.applyStyles({lineWidth:a,lineColor:o});var s=z6(a,!1);s&&e.rect(r.x,r.y,t.getWidth(e.pageSize().width),n.y-r.y,s)}function z6(e,t){var r=e>0,n=t||t===0;return r&&n?"DF":r?"S":n?"F":null}function Ly(e,t){var r,n,a,o;if(e=e||t,Array.isArray(e)){if(e.length>=4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(e.length===3)return{top:e[0],right:e[1],bottom:e[2],left:e[1]};if(e.length===2)return{top:e[0],right:e[1],bottom:e[0],left:e[1]};e.length===1?e=e[0]:e=t}return typeof e=="object"?(typeof e.vertical=="number"&&(e.top=e.vertical,e.bottom=e.vertical),typeof e.horizontal=="number"&&(e.right=e.horizontal,e.left=e.horizontal),{left:(r=e.left)!==null&&r!==void 0?r:t,top:(n=e.top)!==null&&n!==void 0?n:t,right:(a=e.right)!==null&&a!==void 0?a:t,bottom:(o=e.bottom)!==null&&o!==void 0?o:t}):(typeof e!="number"&&(e=t),{top:e,right:e,bottom:e,left:e})}function W6(e,t){var r=Ly(t.settings.margin,0);return e.pageSize().width-(r.left+r.right)}function Sce(e,t,r,n,a){var o={},s=1.3333333333333333,l=O2(t,function(w){return a.getComputedStyle(w).backgroundColor});l!=null&&(o.fillColor=l);var c=O2(t,function(w){return a.getComputedStyle(w).color});c!=null&&(o.textColor=c);var u=Ace(n,r);u&&(o.cellPadding=u);var d="borderTopColor",f=s*r,h=n.borderTopWidth;if(n.borderBottomWidth===h&&n.borderRightWidth===h&&n.borderLeftWidth===h){var p=(parseFloat(h)||0)/f;p&&(o.lineWidth=p)}else o.lineWidth={top:(parseFloat(n.borderTopWidth)||0)/f,right:(parseFloat(n.borderRightWidth)||0)/f,bottom:(parseFloat(n.borderBottomWidth)||0)/f,left:(parseFloat(n.borderLeftWidth)||0)/f},o.lineWidth.top||(o.lineWidth.right?d="borderRightColor":o.lineWidth.bottom?d="borderBottomColor":o.lineWidth.left&&(d="borderLeftColor"));var v=O2(t,function(w){return a.getComputedStyle(w)[d]});v!=null&&(o.lineColor=v);var m=["left","right","center","justify"];m.indexOf(n.textAlign)!==-1&&(o.halign=n.textAlign),m=["middle","bottom","top"],m.indexOf(n.verticalAlign)!==-1&&(o.valign=n.verticalAlign);var y=parseInt(n.fontSize||"");isNaN(y)||(o.fontSize=y/s);var b=Cce(n);b&&(o.fontStyle=b);var _=(n.fontFamily||"").toLowerCase();return e.indexOf(_)!==-1&&(o.font=_),o}function Cce(e){var t="";return(e.fontWeight==="bold"||e.fontWeight==="bolder"||parseInt(e.fontWeight)>=700)&&(t="bold"),(e.fontStyle==="italic"||e.fontStyle==="oblique")&&(t+="italic"),t}function O2(e,t){var r=H6(e,t);if(!r)return null;var n=r.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*\.?\d*))?\)$/);if(!n||!Array.isArray(n))return null;var a=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])],o=parseInt(n[4]);return o===0||isNaN(a[0])||isNaN(a[1])||isNaN(a[2])?null:a}function H6(e,t){var r=t(e);return r==="rgba(0, 0, 0, 0)"||r==="transparent"||r==="initial"||r==="inherit"?e.parentElement==null?null:H6(e.parentElement,t):r}function Ace(e,t){var r=[e.paddingTop,e.paddingRight,e.paddingBottom,e.paddingLeft],n=96/(72/t),a=(parseInt(e.lineHeight)-parseInt(e.fontSize))/t/2,o=r.map(function(l){return parseInt(l||"0")/n}),s=Ly(o,0);return a>s.top&&(s.top=a),a>s.bottom&&(s.bottom=a),s}function V6(e,t,r,n,a){var o,s;n===void 0&&(n=!1),a===void 0&&(a=!1);var l;typeof t=="string"?l=r.document.querySelector(t):l=t;var c=Object.keys(e.getFontList()),u=e.scaleFactor(),d=[],f=[],h=[];if(!l)return console.error("Html table could not be found with input: ",t),{head:d,body:f,foot:h};for(var p=0;p<l.rows.length;p++){var v=l.rows[p],m=(s=(o=v?.parentElement)===null||o===void 0?void 0:o.tagName)===null||s===void 0?void 0:s.toLowerCase(),y=Pce(c,u,r,v,n,a);y&&(m==="thead"?d.push(y):m==="tfoot"?h.push(y):f.push(y))}return{head:d,body:f,foot:h}}function Pce(e,t,r,n,a,o){for(var s=new B6(n),l=0;l<n.cells.length;l++){var c=n.cells[l],u=r.getComputedStyle(c);if(a||u.display!=="none"){var d=void 0;o&&(d=Sce(e,c,t,u,r)),s.push({rowSpan:c.rowSpan,colSpan:c.colSpan,styles:d,_element:c,content:Oce(c)})}}var f=r.getComputedStyle(n);if(s.length>0&&(a||f.display!=="none"))return s}function Oce(e){var t=e.cloneNode(!0);return t.innerHTML=t.innerHTML.replace(/\n/g,"").replace(/ +/g," "),t.innerHTML=t.innerHTML.split(/<br.*?>/).map(function(r){return r.trim()}).join(`
`),t.innerText||t.textContent||""}function kce(e,t,r){for(var n=0,a=[e,t,r];n<a.length;n++){var o=a[n];o&&typeof o!="object"&&console.error("The options parameter should be of type object, is: "+typeof o),o.startY&&typeof o.startY!="number"&&(console.error("Invalid value for startY option",o.startY),delete o.startY)}}function ll(e,t,r,n,a){if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(e),s=1;s<arguments.length;s++){var l=arguments[s];if(l!=null)for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(o[c]=l[c])}return o}function G6(e,t){var r=new Zu(e),n=r.getDocumentOptions(),a=r.getGlobalOptions();kce(a,n,t);var o=ll({},a,n,t),s;typeof window<"u"&&(s=window);var l=Tce(a,n,t),c=Ece(a,n,t),u=Ice(r,o),d=Dce(r,o,s);return{id:t.tableId,content:d,hooks:c,styles:l,settings:u}}function Tce(e,t,r){for(var n={styles:{},headStyles:{},bodyStyles:{},footStyles:{},alternateRowStyles:{},columnStyles:{}},a=function(c){if(c==="columnStyles"){var u=e[c],d=t[c],f=r[c];n.columnStyles=ll({},u,d,f)}else{var h=[e,t,r],p=h.map(function(v){return v[c]||{}});n[c]=ll({},p[0],p[1],p[2])}},o=0,s=Object.keys(n);o<s.length;o++){var l=s[o];a(l)}return n}function Ece(e,t,r){for(var n=[e,t,r],a={didParseCell:[],willDrawCell:[],didDrawCell:[],willDrawPage:[],didDrawPage:[]},o=0,s=n;o<s.length;o++){var l=s[o];l.didParseCell&&a.didParseCell.push(l.didParseCell),l.willDrawCell&&a.willDrawCell.push(l.willDrawCell),l.didDrawCell&&a.didDrawCell.push(l.didDrawCell),l.willDrawPage&&a.willDrawPage.push(l.willDrawPage),l.didDrawPage&&a.didDrawPage.push(l.didDrawPage)}return a}function Ice(e,t){var r,n,a,o,s,l,c,u,d,f,h,p,v=Ly(t.margin,40/e.scaleFactor()),m=(r=Nce(e,t.startY))!==null&&r!==void 0?r:v.top,y;t.showFoot===!0?y="everyPage":t.showFoot===!1?y="never":y=(n=t.showFoot)!==null&&n!==void 0?n:"everyPage";var b;t.showHead===!0?b="everyPage":t.showHead===!1?b="never":b=(a=t.showHead)!==null&&a!==void 0?a:"everyPage";var _=(o=t.useCss)!==null&&o!==void 0?o:!1,w=t.theme||(_?"plain":"striped"),A=!!t.horizontalPageBreak,P=(s=t.horizontalPageBreakRepeat)!==null&&s!==void 0?s:null;return{includeHiddenHtml:(l=t.includeHiddenHtml)!==null&&l!==void 0?l:!1,useCss:_,theme:w,startY:m,margin:v,pageBreak:(c=t.pageBreak)!==null&&c!==void 0?c:"auto",rowPageBreak:(u=t.rowPageBreak)!==null&&u!==void 0?u:"auto",tableWidth:(d=t.tableWidth)!==null&&d!==void 0?d:"auto",showHead:b,showFoot:y,tableLineWidth:(f=t.tableLineWidth)!==null&&f!==void 0?f:0,tableLineColor:(h=t.tableLineColor)!==null&&h!==void 0?h:200,horizontalPageBreak:A,horizontalPageBreakRepeat:P,horizontalPageBreakBehaviour:(p=t.horizontalPageBreakBehaviour)!==null&&p!==void 0?p:"afterAllRows"}}function Nce(e,t){var r=e.getLastAutoTable(),n=e.scaleFactor(),a=e.pageNumber(),o=!1;if(r&&r.startPageNumber){var s=r.startPageNumber+r.pageNumber-1;o=s===a}return typeof t=="number"?t:(t==null||t===!1)&&o&&r?.finalY!=null?r.finalY+20/n:null}function Dce(e,t,r){var n=t.head||[],a=t.body||[],o=t.foot||[];if(t.html){var s=t.includeHiddenHtml;if(r){var l=V6(e,t.html,r,s,t.useCss)||{};n=l.head||n,a=l.body||n,o=l.foot||n}else console.error("Cannot parse html in non browser environment")}var c=t.columns||Mce(n,a,o);return{columns:c,head:n,body:a,foot:o}}function Mce(e,t,r){var n=e[0]||t[0]||r[0]||[],a=[];return Object.keys(n).filter(function(o){return o!=="_element"}).forEach(function(o){var s=1,l;Array.isArray(n)?l=n[parseInt(o)]:l=n[o],typeof l=="object"&&!Array.isArray(l)&&(s=l?.colSpan||1);for(var c=0;c<s;c++){var u=void 0;Array.isArray(n)?u=a.length:u=o+(c>0?"_".concat(c):"");var d={dataKey:u};a.push(d)}}),a}var Rw=function(){function e(t,r,n){this.table=r,this.pageNumber=r.pageNumber,this.settings=r.settings,this.cursor=n,this.doc=t.getDocument()}return e}(),Lce=function(e){$6(t,e);function t(r,n,a,o,s,l){var c=e.call(this,r,n,l)||this;return c.cell=a,c.row=o,c.column=s,c.section=o.section,c}return t}(Rw),Rce=function(){function e(t,r){this.pageNumber=1,this.id=t.id,this.settings=t.settings,this.styles=t.styles,this.hooks=t.hooks,this.columns=r.columns,this.head=r.head,this.body=r.body,this.foot=r.foot}return e.prototype.getHeadHeight=function(t){return this.head.reduce(function(r,n){return r+n.getMaxCellHeight(t)},0)},e.prototype.getFootHeight=function(t){return this.foot.reduce(function(r,n){return r+n.getMaxCellHeight(t)},0)},e.prototype.allRows=function(){return this.head.concat(this.body).concat(this.foot)},e.prototype.callCellHooks=function(t,r,n,a,o,s){for(var l=0,c=r;l<c.length;l++){var u=c[l],d=new Lce(t,this,n,a,o,s),f=u(d)===!1;if(n.text=Array.isArray(n.text)?n.text:[n.text],f)return!1}return!0},e.prototype.callEndPageHooks=function(t,r){t.applyStyles(t.userStyles);for(var n=0,a=this.hooks.didDrawPage;n<a.length;n++){var o=a[n];o(new Rw(t,this,r))}},e.prototype.callWillDrawPageHooks=function(t,r){for(var n=0,a=this.hooks.willDrawPage;n<a.length;n++){var o=a[n];o(new Rw(t,this,r))}},e.prototype.getWidth=function(t){if(typeof this.settings.tableWidth=="number")return this.settings.tableWidth;if(this.settings.tableWidth==="wrap"){var r=this.columns.reduce(function(a,o){return a+o.wrappedWidth},0);return r}else{var n=this.settings.margin;return t-n.left-n.right}},e}(),Y6=function(){function e(t,r,n,a,o){o===void 0&&(o=!1),this.height=0,this.raw=t,t instanceof B6&&(this.raw=t._element,this.element=t._element),this.index=r,this.section=n,this.cells=a,this.spansMultiplePages=o}return e.prototype.getMaxCellHeight=function(t){var r=this;return t.reduce(function(n,a){var o;return Math.max(n,((o=r.cells[a.index])===null||o===void 0?void 0:o.height)||0)},0)},e.prototype.hasRowSpan=function(t){var r=this;return t.filter(function(n){var a=r.cells[n.index];return a?a.rowSpan>1:!1}).length>0},e.prototype.canEntireRowFit=function(t,r){return this.getMaxCellHeight(r)<=t},e.prototype.getMinimumRowHeight=function(t,r){var n=this;return t.reduce(function(a,o){var s=n.cells[o.index];if(!s)return 0;var l=r.getLineHeight(s.styles.fontSize),c=s.padding("vertical"),u=c+l;return u>a?u:a},0)},e}(),K6=function(){function e(t,r,n){var a;this.contentHeight=0,this.contentWidth=0,this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.height=0,this.x=0,this.y=0,this.styles=r,this.section=n,this.raw=t;var o=t;t!=null&&typeof t=="object"&&!Array.isArray(t)?(this.rowSpan=t.rowSpan||1,this.colSpan=t.colSpan||1,o=(a=t.content)!==null&&a!==void 0?a:t,t._element&&(this.raw=t._element)):(this.rowSpan=1,this.colSpan=1);var s=o!=null?""+o:"",l=/\r\n|\r|\n/g;this.text=s.split(l)}return e.prototype.getTextPos=function(){var t;if(this.styles.valign==="top")t=this.y+this.padding("top");else if(this.styles.valign==="bottom")t=this.y+this.height-this.padding("bottom");else{var r=this.height-this.padding("vertical");t=this.y+r/2+this.padding("top")}var n;if(this.styles.halign==="right")n=this.x+this.width-this.padding("right");else if(this.styles.halign==="center"){var a=this.width-this.padding("horizontal");n=this.x+a/2+this.padding("left")}else n=this.x+this.padding("left");return{x:n,y:t}},e.prototype.getContentHeight=function(t,r){r===void 0&&(r=1.15);var n=Array.isArray(this.text)?this.text.length:1,a=this.styles.fontSize/t*r,o=n*a+this.padding("vertical");return Math.max(o,this.styles.minCellHeight)},e.prototype.padding=function(t){var r=Ly(this.styles.cellPadding,0);return t==="vertical"?r.top+r.bottom:t==="horizontal"?r.left+r.right:r[t]},e}(),qce=function(){function e(t,r,n){this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.dataKey=t,this.raw=r,this.index=n}return e.prototype.getMaxCustomCellWidth=function(t){for(var r=0,n=0,a=t.allRows();n<a.length;n++){var o=a[n],s=o.cells[this.index];s&&typeof s.styles.cellWidth=="number"&&(r=Math.max(r,s.styles.cellWidth))}return r},e}();function Fce(e,t){$ce(e,t);var r=[],n=0;t.columns.forEach(function(o){var s=o.getMaxCustomCellWidth(t);s?o.width=s:(o.width=o.wrappedWidth,r.push(o)),n+=o.width});var a=t.getWidth(e.pageSize().width)-n;a&&(a=qw(r,a,function(o){return Math.max(o.minReadableWidth,o.minWidth)})),a&&(a=qw(r,a,function(o){return o.minWidth})),a=Math.abs(a),!t.settings.horizontalPageBreak&&a>.1/e.scaleFactor()&&(a=a<1?a:Math.round(a),console.warn("Of the table content, ".concat(a," units width could not fit page"))),Uce(t),zce(t,e),Bce(t)}function $ce(e,t){var r=e.scaleFactor(),n=t.settings.horizontalPageBreak,a=W6(e,t);t.allRows().forEach(function(o){for(var s=0,l=t.columns;s<l.length;s++){var c=l[s],u=o.cells[c.index];if(u){var d=t.hooks.didParseCell;t.callCellHooks(e,d,u,o,c,null);var f=u.padding("horizontal");u.contentWidth=wv(u.text,u.styles,e)+f;var h=wv(u.text.join(" ").split(/[^\S\u00A0]+/),u.styles,e);if(u.minReadableWidth=h+u.padding("horizontal"),typeof u.styles.cellWidth=="number")u.minWidth=u.styles.cellWidth,u.wrappedWidth=u.styles.cellWidth;else if(u.styles.cellWidth==="wrap"||n===!0)u.contentWidth>a?(u.minWidth=a,u.wrappedWidth=a):(u.minWidth=u.contentWidth,u.wrappedWidth=u.contentWidth);else{var p=10/r;u.minWidth=u.styles.minCellWidth||p,u.wrappedWidth=u.contentWidth,u.minWidth>u.wrappedWidth&&(u.wrappedWidth=u.minWidth)}}}}),t.allRows().forEach(function(o){for(var s=0,l=t.columns;s<l.length;s++){var c=l[s],u=o.cells[c.index];if(u&&u.colSpan===1)c.wrappedWidth=Math.max(c.wrappedWidth,u.wrappedWidth),c.minWidth=Math.max(c.minWidth,u.minWidth),c.minReadableWidth=Math.max(c.minReadableWidth,u.minReadableWidth);else{var d=t.styles.columnStyles[c.dataKey]||t.styles.columnStyles[c.index]||{},f=d.cellWidth||d.minCellWidth;f&&typeof f=="number"&&(c.minWidth=f,c.wrappedWidth=f)}u&&(u.colSpan>1&&!c.minWidth&&(c.minWidth=u.minWidth),u.colSpan>1&&!c.wrappedWidth&&(c.wrappedWidth=u.minWidth))}})}function qw(e,t,r){for(var n=t,a=e.reduce(function(p,v){return p+v.wrappedWidth},0),o=0;o<e.length;o++){var s=e[o],l=s.wrappedWidth/a,c=n*l,u=s.width+c,d=r(s),f=u<d?d:u;t-=f-s.width,s.width=f}if(t=Math.round(t*1e10)/1e10,t){var h=e.filter(function(p){return t<0?p.width>r(p):!0});h.length&&(t=qw(h,t,r))}return t}function Bce(e){for(var t={},r=1,n=e.allRows(),a=0;a<n.length;a++)for(var o=n[a],s=0,l=e.columns;s<l.length;s++){var c=l[s],u=t[c.index];if(r>1)r--,delete o.cells[c.index];else if(u)u.cell.height+=o.height,r=u.cell.colSpan,delete o.cells[c.index],u.left--,u.left<=1&&delete t[c.index];else{var d=o.cells[c.index];if(!d)continue;if(d.height=o.height,d.rowSpan>1){var f=n.length-a,h=d.rowSpan>f?f:d.rowSpan;t[c.index]={cell:d,left:h,row:o}}}}}function Uce(e){for(var t=e.allRows(),r=0;r<t.length;r++)for(var n=t[r],a=null,o=0,s=0,l=0;l<e.columns.length;l++){var c=e.columns[l];if(s-=1,s>1&&e.columns[l+1])o+=c.width,delete n.cells[c.index];else if(a){var u=a;delete n.cells[c.index],a=null,u.width=c.width+o}else{var u=n.cells[c.index];if(!u)continue;if(s=u.colSpan,o=0,u.colSpan>1){a=u,o+=c.width;continue}u.width=c.width+o}}}function zce(e,t){for(var r={count:0,height:0},n=0,a=e.allRows();n<a.length;n++){for(var o=a[n],s=0,l=e.columns;s<l.length;s++){var c=l[s],u=o.cells[c.index];if(u){t.applyStyles(u.styles,!0);var d=u.width-u.padding("horizontal");if(u.styles.overflow==="linebreak")u.text=t.splitTextToSize(u.text,d+1/t.scaleFactor(),{fontSize:u.styles.fontSize});else if(u.styles.overflow==="ellipsize")u.text=oE(u.text,d,u.styles,t,"...");else if(u.styles.overflow==="hidden")u.text=oE(u.text,d,u.styles,t,"");else if(typeof u.styles.overflow=="function"){var f=u.styles.overflow(u.text,d);typeof f=="string"?u.text=[f]:u.text=f}u.contentHeight=u.getContentHeight(t.scaleFactor(),t.getLineHeightFactor());var h=u.contentHeight/u.rowSpan;u.rowSpan>1&&r.count*r.height<h*u.rowSpan?r={height:h,count:u.rowSpan}:r&&r.count>0&&r.height>h&&(h=r.height),h>o.height&&(o.height=h)}}r.count--}}function oE(e,t,r,n,a){return e.map(function(o){return Wce(o,t,r,n,a)})}function Wce(e,t,r,n,a){var o=1e4*n.scaleFactor();if(t=Math.ceil(t*o)/o,t>=wv(e,r,n))return e;for(;t<wv(e+a,r,n)&&!(e.length<=1);)e=e.substring(0,e.length-1);return e.trim()+a}function Q6(e,t){var r=new Zu(e),n=Hce(t,r.scaleFactor()),a=new Rce(t,n);return Fce(r,a),r.applyStyles(r.userStyles),a}function Hce(e,t){var r=e.content,n=Gce(r.columns);if(r.head.length===0){var a=sE(n,"head");a&&r.head.push(a)}if(r.foot.length===0){var a=sE(n,"foot");a&&r.foot.push(a)}var o=e.settings.theme,s=e.styles;return{columns:n,head:k2("head",r.head,n,s,o,t),body:k2("body",r.body,n,s,o,t),foot:k2("foot",r.foot,n,s,o,t)}}function k2(e,t,r,n,a,o){var s={},l=t.map(function(c,u){for(var d=0,f={},h=0,p=0,v=0,m=r;v<m.length;v++){var y=m[v];if(s[y.index]==null||s[y.index].left===0)if(p===0){var b=void 0;Array.isArray(c)?b=c[y.index-h-d]:b=c[y.dataKey];var _={};typeof b=="object"&&!Array.isArray(b)&&(_=b?.styles||{});var w=Yce(e,y,u,a,n,o,_),A=new K6(b,w,e);f[y.dataKey]=A,f[y.index]=A,p=A.colSpan-1,s[y.index]={left:A.rowSpan-1,times:p}}else p--,h++;else s[y.index].left--,p=s[y.index].times,d++}return new Y6(c,u,e,f)});return l}function sE(e,t){var r={};return e.forEach(function(n){if(n.raw!=null){var a=Vce(t,n.raw);a!=null&&(r[n.dataKey]=a)}}),Object.keys(r).length>0?r:null}function Vce(e,t){if(e==="head"){if(typeof t=="object")return t.header||null;if(typeof t=="string"||typeof t=="number")return t}else if(e==="foot"&&typeof t=="object")return t.footer;return null}function Gce(e){return e.map(function(t,r){var n,a;return typeof t=="object"?a=(n=t.dataKey)!==null&&n!==void 0?n:r:a=r,new qce(a,t,r)})}function Yce(e,t,r,n,a,o,s){var l=jce(n),c;e==="head"?c=a.headStyles:e==="body"?c=a.bodyStyles:e==="foot"&&(c=a.footStyles);var u=ll({},l.table,l[e],a.styles,c),d=a.columnStyles[t.dataKey]||a.columnStyles[t.index]||{},f=e==="body"?d:{},h=e==="body"&&r%2===0?ll({},l.alternateRow,a.alternateRowStyles):{},p=wce(o),v=ll({},p,u,h,f);return ll(v,s)}function Kce(e,t,r){var n;r===void 0&&(r={});var a=W6(e,t),o=new Map,s=[],l=[],c=[];Array.isArray(t.settings.horizontalPageBreakRepeat)?c=t.settings.horizontalPageBreakRepeat:(typeof t.settings.horizontalPageBreakRepeat=="string"||typeof t.settings.horizontalPageBreakRepeat=="number")&&(c=[t.settings.horizontalPageBreakRepeat]),c.forEach(function(h){var p=t.columns.find(function(v){return v.dataKey===h||v.index===h});p&&!o.has(p.index)&&(o.set(p.index,!0),s.push(p.index),l.push(t.columns[p.index]),a-=p.wrappedWidth)});for(var u=!0,d=(n=r?.start)!==null&&n!==void 0?n:0;d<t.columns.length;){if(o.has(d)){d++;continue}var f=t.columns[d].wrappedWidth;if(u||a>=f)u=!1,s.push(d),l.push(t.columns[d]),a-=f;else break;d++}return{colIndexes:s,columns:l,lastIndex:d-1}}function Qce(e,t){for(var r=[],n=0;n<t.columns.length;n++){var a=Kce(e,t,{start:n});a.columns.length&&(r.push(a),n=a.lastIndex)}return r}function X6(e,t){var r=t.settings,n=r.startY,a=r.margin,o={x:a.left,y:n},s=t.getHeadHeight(t.columns)+t.getFootHeight(t.columns),l=n+a.bottom+s;if(r.pageBreak==="avoid"){var c=t.body,u=c.reduce(function(h,p){return h+p.height},0);l+=u}var d=new Zu(e);(r.pageBreak==="always"||r.startY!=null&&l>d.pageSize().height)&&(Z6(d),o.y=a.top),t.callWillDrawPageHooks(d,o);var f=ll({},o);t.startPageNumber=d.pageNumber(),r.horizontalPageBreak?Xce(d,t,f,o):(d.applyStyles(d.userStyles),(r.showHead==="firstPage"||r.showHead==="everyPage")&&t.head.forEach(function(h){return xl(d,t,h,o,t.columns)}),d.applyStyles(d.userStyles),t.body.forEach(function(h,p){var v=p===t.body.length-1;jv(d,t,h,v,f,o,t.columns)}),d.applyStyles(d.userStyles),(r.showFoot==="lastPage"||r.showFoot==="everyPage")&&t.foot.forEach(function(h){return xl(d,t,h,o,t.columns)})),U6(d,t,f,o),t.callEndPageHooks(d,o),t.finalY=o.y,e.lastAutoTable=t,d.applyStyles(d.userStyles)}function Xce(e,t,r,n){var a=Qce(e,t),o=t.settings;if(o.horizontalPageBreakBehaviour==="afterAllRows")a.forEach(function(u,d){e.applyStyles(e.userStyles),d>0?qh(e,t,r,n,u.columns,!0):lE(e,t,n,u.columns),Jce(e,t,r,n,u.columns),T2(e,t,n,u.columns)});else for(var s=-1,l=a[0],c=function(){var u=s;if(l){e.applyStyles(e.userStyles);var d=l.columns;s>=0?qh(e,t,r,n,d,!0):lE(e,t,n,d),u=cE(e,t,s+1,n,d),T2(e,t,n,d)}var f=u-s;a.slice(1).forEach(function(h){e.applyStyles(e.userStyles),qh(e,t,r,n,h.columns,!0),cE(e,t,s+1,n,h.columns,f),T2(e,t,n,h.columns)}),s=u};s<t.body.length-1;)c()}function lE(e,t,r,n){var a=t.settings;e.applyStyles(e.userStyles),(a.showHead==="firstPage"||a.showHead==="everyPage")&&t.head.forEach(function(o){return xl(e,t,o,r,n)})}function Jce(e,t,r,n,a){e.applyStyles(e.userStyles),t.body.forEach(function(o,s){var l=s===t.body.length-1;jv(e,t,o,l,r,n,a)})}function cE(e,t,r,n,a,o){e.applyStyles(e.userStyles),o=o??t.body.length;var s=Math.min(r+o,t.body.length),l=-1;return t.body.slice(r,s).forEach(function(c,u){var d=r+u===t.body.length-1,f=J6(e,t,d,n);c.canEntireRowFit(f,a)&&(xl(e,t,c,n,a),l=r+u)}),l}function T2(e,t,r,n){var a=t.settings;e.applyStyles(e.userStyles),(a.showFoot==="lastPage"||a.showFoot==="everyPage")&&t.foot.forEach(function(o){return xl(e,t,o,r,n)})}function Zce(e,t,r){var n=r.getLineHeight(e.styles.fontSize),a=e.padding("vertical"),o=Math.floor((t-a)/n);return Math.max(0,o)}function eue(e,t,r,n){var a={};e.spansMultiplePages=!0,e.height=0;for(var o=0,s=0,l=r.columns;s<l.length;s++){var c=l[s],u=e.cells[c.index];if(u){Array.isArray(u.text)||(u.text=[u.text]);var d=new K6(u.raw,u.styles,u.section);d=ll(d,u),d.text=[];var f=Zce(u,t,n);u.text.length>f&&(d.text=u.text.splice(f,u.text.length));var h=n.scaleFactor(),p=n.getLineHeightFactor();u.contentHeight=u.getContentHeight(h,p),u.contentHeight>=t&&(u.contentHeight=t,d.styles.minCellHeight-=t),u.contentHeight>e.height&&(e.height=u.contentHeight),d.contentHeight=d.getContentHeight(h,p),d.contentHeight>o&&(o=d.contentHeight),a[c.index]=d}}var v=new Y6(e.raw,-1,e.section,a,!0);v.height=o;for(var m=0,y=r.columns;m<y.length;m++){var c=y[m],d=v.cells[c.index];d&&(d.height=v.height);var u=e.cells[c.index];u&&(u.height=e.height)}return v}function tue(e,t,r,n){var a=e.pageSize().height,o=n.settings.margin,s=o.top+o.bottom,l=a-s;t.section==="body"&&(l-=n.getHeadHeight(n.columns)+n.getFootHeight(n.columns));var c=t.getMinimumRowHeight(n.columns,e),u=c<r;if(c>l)return console.error("Will not be able to print row ".concat(t.index," correctly since it's minimum height is larger than page height")),!0;if(!u)return!1;var d=t.hasRowSpan(n.columns),f=t.getMaxCellHeight(n.columns)>l;return f?(d&&console.error("The content of row ".concat(t.index," will not be drawn correctly since drawing rows with a height larger than the page height and has cells with rowspans is not supported.")),!0):!(d||n.settings.rowPageBreak==="avoid")}function jv(e,t,r,n,a,o,s){var l=J6(e,t,n,o);if(r.canEntireRowFit(l,s))xl(e,t,r,o,s);else if(tue(e,r,l,t)){var c=eue(r,l,t,e);xl(e,t,r,o,s),qh(e,t,a,o,s),jv(e,t,c,n,a,o,s)}else qh(e,t,a,o,s),jv(e,t,r,n,a,o,s)}function xl(e,t,r,n,a){n.x=t.settings.margin.left;for(var o=0,s=a;o<s.length;o++){var l=s[o],c=r.cells[l.index];if(!c){n.x+=l.width;continue}e.applyStyles(c.styles),c.x=n.x,c.y=n.y;var u=t.callCellHooks(e,t.hooks.willDrawCell,c,r,l,n);if(u===!1){n.x+=l.width;continue}rue(e,c,n);var d=c.getTextPos();F6(c.text,d.x,d.y,{halign:c.styles.halign,valign:c.styles.valign,maxWidth:Math.ceil(c.width-c.padding("left")-c.padding("right"))},e.getDocument()),t.callCellHooks(e,t.hooks.didDrawCell,c,r,l,n),n.x+=l.width}n.y+=r.height}function rue(e,t,r){var n=t.styles;if(e.getDocument().setFillColor(e.getDocument().getFillColor()),typeof n.lineWidth=="number"){var a=z6(n.lineWidth,n.fillColor);a&&e.rect(t.x,r.y,t.width,t.height,a)}else typeof n.lineWidth=="object"&&(n.fillColor&&e.rect(t.x,r.y,t.width,t.height,"F"),nue(e,t,r,n.lineWidth))}function nue(e,t,r,n){var a,o,s,l;n.top&&(a=r.x,o=r.y,s=r.x+t.width,l=r.y,n.right&&(s+=.5*n.right),n.left&&(a-=.5*n.left),c(n.top,a,o,s,l)),n.bottom&&(a=r.x,o=r.y+t.height,s=r.x+t.width,l=r.y+t.height,n.right&&(s+=.5*n.right),n.left&&(a-=.5*n.left),c(n.bottom,a,o,s,l)),n.left&&(a=r.x,o=r.y,s=r.x,l=r.y+t.height,n.top&&(o-=.5*n.top),n.bottom&&(l+=.5*n.bottom),c(n.left,a,o,s,l)),n.right&&(a=r.x+t.width,o=r.y,s=r.x+t.width,l=r.y+t.height,n.top&&(o-=.5*n.top),n.bottom&&(l+=.5*n.bottom),c(n.right,a,o,s,l));function c(u,d,f,h,p){e.getDocument().setLineWidth(u),e.getDocument().line(d,f,h,p,"S")}}function J6(e,t,r,n){var a=t.settings.margin.bottom,o=t.settings.showFoot;return(o==="everyPage"||o==="lastPage"&&r)&&(a+=t.getFootHeight(t.columns)),e.pageSize().height-n.y-a}function qh(e,t,r,n,a,o){a===void 0&&(a=[]),o===void 0&&(o=!1),e.applyStyles(e.userStyles),t.settings.showFoot==="everyPage"&&!o&&t.foot.forEach(function(l){return xl(e,t,l,n,a)}),t.callEndPageHooks(e,n);var s=t.settings.margin;U6(e,t,r,n),Z6(e),t.pageNumber++,n.x=s.left,n.y=s.top,r.y=s.top,t.callWillDrawPageHooks(e,n),t.settings.showHead==="everyPage"&&(t.head.forEach(function(l){return xl(e,t,l,n,a)}),e.applyStyles(e.userStyles))}function Z6(e){var t=e.pageNumber();e.setPage(t+1);var r=e.pageNumber();return r===t?(e.addPage(),!0):!1}function aue(e){e.API.autoTable=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t[0],a=G6(this,n),o=Q6(this,a);return X6(this,o),this},e.API.lastAutoTable=!1,e.API.autoTableText=function(t,r,n,a){F6(t,r,n,a,this)},e.API.autoTableSetDefaults=function(t){return Zu.setDefaults(t,this),this},e.autoTableSetDefaults=function(t,r){Zu.setDefaults(t,r)},e.API.autoTableHtmlToJson=function(t,r){var n;if(r===void 0&&(r=!1),typeof window>"u")return console.error("Cannot run autoTableHtmlToJson in non browser environment"),null;var a=new Zu(this),o=V6(a,t,window,r,!1),s=o.head,l=o.body,c=((n=s[0])===null||n===void 0?void 0:n.map(function(u){return u.content}))||[];return{columns:c,rows:l,data:l}}}var E2;function iue(e,t){var r=G6(e,t),n=Q6(e,r);X6(e,n)}try{if(typeof window<"u"&&window){var uE=window,dE=uE.jsPDF||((E2=uE.jspdf)===null||E2===void 0?void 0:E2.jsPDF);dE&&aue(dE)}}catch(e){console.error("Could not apply autoTable plugin",e)}const eR=({open:e,onClose:t,type:r,recordId:n,defaultTo:a,defaultSubject:o,defaultMessage:s,allowMessageEdit:l=!0})=>{const{user:c}=ta(),[u,d]=x.useState(a||""),[f,h]=x.useState(o||""),[p,v]=x.useState(s||""),[m,y]=x.useState(""),[b,_]=x.useState(!1),[w,A]=x.useState(""),[P,T]=x.useState([]),[E,S]=x.useState("");x.useEffect(()=>{console.log("EmailModal useEffect: open =",e,"defaultTo =",a,"current to =",u),e&&a&&(console.log("Setting to field to:",a),d(a))},[e,a]),x.useEffect(()=>{e&&I()},[e,r]);const I=async()=>{try{const F=await ve.get("/api/email/templates");if(F.data.success){const z=F.data.templates.filter(J=>J.type===r);T(z);const K=z.find(J=>J.is_default);K?(S(K.id),h(K.subject),v(K.html_content)):z.length===0&&(r==="quote"?(h("Quote Information"),v("Please find attached the quote details.")):r==="purchase-order"?(h("Purchase Order Information"),v("Please find attached the purchase order details.")):r==="sales-order"&&(h("Sales Order Information"),v("Please find attached the sales order details.")))}}catch(F){console.error("Error loading templates:",F),r==="quote"?(h("Quote Information"),v("Please find attached the quote details.")):r==="purchase-order"?(h("Purchase Order Information"),v("Please find attached the purchase order details.")):r==="sales-order"&&(h("Sales Order Information"),v("Please find attached the sales order details."))}},W=F=>{if(S(F),F!==""){const z=P.find(K=>K.id===F);z&&(h(z.subject),v(z.html_content))}},O=async()=>{if(r==="custom"){if(!u||!f||!p){A("Please fill in all required fields");return}}else if(!u){A("Please enter a recipient email address");return}_(!0),A("");try{let F="/api/email/send",z={to:u,subject:f,message:p};r!=="custom"&&n&&(F=`/api/email/${r.replace("-","-")}/${n}`,z={to:u,...m&&{customMessage:m}});const K=await ve.post(F,z);K.data.success?(ge.success("Email sent successfully!"),t(),d(""),h(""),v(""),y(""),S("")):A(K.data.message||"Failed to send email")}catch(F){console.error("Error sending email:",F),A(F.response?.data?.message||"Failed to send email")}finally{_(!1)}},D=()=>{b||(t(),A(""))},R=()=>{switch(r){case"sales-order":return"Send Sales Order Email";case"purchase-order":return"Send Purchase Order Email";case"quote":return"Send Quote Email";default:return"Send Email"}};return i.jsxs(pr,{open:e,onClose:D,maxWidth:"md",fullWidth:!0,children:[i.jsx(mr,{children:R()}),i.jsx(gr,{children:i.jsxs(Z,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[r!=="custom"&&P.length>0&&i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Email Template"}),i.jsxs(cn,{value:E,onChange:F=>W(F.target.value),label:"Email Template",children:[i.jsx(Zt,{value:"",children:i.jsx("em",{children:"Use default template"})}),P.map(F=>i.jsx(Zt,{value:F.id,children:i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[F.name,F.is_default&&i.jsx(st,{label:"Default",size:"small",color:"secondary"})]})},F.id))]})]}),i.jsx(Pe,{label:"To",value:u,onChange:F=>d(F.target.value),fullWidth:!0,required:!0,type:"email"}),r==="custom"&&i.jsxs(i.Fragment,{children:[i.jsx(Pe,{label:"Subject",value:f,onChange:F=>h(F.target.value),fullWidth:!0,required:!0}),i.jsx(Pe,{label:"Message",value:p,onChange:F=>v(F.target.value),fullWidth:!0,multiline:!0,rows:6,required:!0})]}),r!=="custom"&&l&&i.jsx(Pe,{label:"Additional Message (Optional)",value:m,onChange:F=>y(F.target.value),fullWidth:!0,multiline:!0,rows:4,helperText:"Add a custom message to include with the email"}),w&&i.jsx(Ot,{severity:"error",sx:{mt:2},children:w})]})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:D,disabled:b,children:"Cancel"}),i.jsx(xe,{onClick:O,variant:"contained",disabled:b,startIcon:b?i.jsx(tr,{size:20}):void 0,children:b?"Sending...":"Send Email"})]})]})},fE={product_name:""},wS=({open:e,onClose:t,onSave:r,initialProduct:n,isEditMode:a=!1,loading:o=!1})=>{const[s,l]=x.useState(fE),[c,u]=x.useState(null),d=Ay(s,300);x.useEffect(()=>{e&&(l({...fE,...n}),u(null))},[e,n]);const f=v=>{const{name:m,value:y}=v.target;l(b=>({...b,[m]:y}))},h=()=>s.product_name.trim()?(u(null),!0):(u("Product name is required"),!1),p=()=>{h()&&r(s)};return x.useEffect(()=>{},[d,e]),i.jsxs(pr,{open:e,onClose:t,maxWidth:"sm",fullWidth:!0,children:[i.jsx(mr,{children:a?"Edit Product":"Add New Product"}),i.jsxs(gr,{children:[i.jsx(ie,{container:!0,spacing:2,sx:{mt:1},children:i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{name:"product_name",label:"Product Name",value:s.product_name,onChange:f,fullWidth:!0,required:!0,autoFocus:!0})})}),c&&i.jsx("div",{style:{color:"red",marginTop:8},children:c})]}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:t,children:"Cancel"}),i.jsx(xe,{onClick:p,variant:"contained",disabled:o,children:a?"Save Changes":"Add Product"})]})]})},Ry=({when:e,onSave:t})=>{console.log("[UnsavedChangesGuard] Component rendered with when=",e);const[r,n]=x.useState(!1),[a,o]=x.useState(!1),s=x.useRef(""),l=x.useRef(null),c=x.useRef(!1);x.useEffect(()=>{if(!e)return;s.current=window.location.hash,console.log("[UnsavedChangesGuard] activating interceptors. prevHash=",s.current);const h=_=>_.metaKey||_.ctrlKey||_.shiftKey||_.altKey||_.button!==0,p=_=>{let w=_;for(;w&&w!==document.body;){if(w.tagName==="A")return w;w=w.parentElement}return null},v=_=>{if(!e||r)return;const w=p(_.target);if(!w||h(_))return;const A=w.getAttribute("href")||"";if(!A.startsWith("#"))return;const P=A;if(P!==window.location.hash){if(window.__unsavedGuardAllowNext){console.log("[UnsavedChangesGuard] bypass flag set -> allowing click navigation"),window.__unsavedGuardAllowNext=!1,c.current=!0;return}console.log("[UnsavedChangesGuard] click capture -> intercept anchor to",P),_.preventDefault(),_.stopPropagation(),l.current=P,n(!0)}},m=()=>{if(!e)return;if(window.__unsavedGuardAllowNext){console.log("[UnsavedChangesGuard] bypass flag set -> allowing hashchange"),window.__unsavedGuardAllowNext=!1,c.current=!0,s.current=window.location.hash;return}if(c.current){c.current=!1,s.current=window.location.hash,console.log("[UnsavedChangesGuard] hashchange allowed. prevHash ->",s.current);return}if(r)return;const _=window.location.hash;console.log("[UnsavedChangesGuard] hashchange detected -> attempted",_,"reverting to",s.current),l.current=_,n(!0),setTimeout(()=>{window.location.hash!==s.current&&(window.location.hash=s.current)},0)},y=history.pushState,b=history.replaceState;return history.pushState=function(..._){try{const w=_[2],A=typeof w=="string"?w:w?String(w):"",P=A&&A.includes("#")?A.slice(A.indexOf("#")):A;if(window.__unsavedGuardAllowNext)return console.log("[UnsavedChangesGuard] bypass flag set -> allowing pushState",A),window.__unsavedGuardAllowNext=!1,c.current=!0,y.apply(this,_);if(e&&!c.current){console.log("[UnsavedChangesGuard] pushState intercepted ->",A),l.current=P||null,n(!0);return}}catch{}return y.apply(this,_)},history.replaceState=function(..._){try{const w=_[2],A=typeof w=="string"?w:w?String(w):"",P=A&&A.includes("#")?A.slice(A.indexOf("#")):A;if(window.__unsavedGuardAllowNext)return console.log("[UnsavedChangesGuard] bypass flag set -> allowing replaceState",A),window.__unsavedGuardAllowNext=!1,c.current=!0,b.apply(this,_);if(e&&!c.current){console.log("[UnsavedChangesGuard] replaceState intercepted ->",A),l.current=P||null,n(!0);return}}catch{}return b.apply(this,_)},document.addEventListener("click",v,!0),window.addEventListener("hashchange",m),window.addEventListener("popstate",m),()=>{console.log("[UnsavedChangesGuard] deactivating interceptors"),document.removeEventListener("click",v,!0),window.removeEventListener("hashchange",m),window.removeEventListener("popstate",m),history.pushState=y,history.replaceState=b}},[e,r]),x.useEffect(()=>{console.log("[UnsavedChangesGuard] beforeunload useEffect triggered with when=",e);const h=p=>{e&&(console.log("[UnsavedChangesGuard] beforeunload fired"),p.preventDefault(),p.returnValue="")};return e&&(console.log("[UnsavedChangesGuard] registering beforeunload"),window.addEventListener("beforeunload",h)),()=>{console.log("[UnsavedChangesGuard] removing beforeunload listener"),window.removeEventListener("beforeunload",h)}},[e]);const u=()=>{console.log("[UnsavedChangesGuard] user chose: Stay"),n(!1),l.current=null},d=()=>{console.log("[UnsavedChangesGuard] user chose: Leave -> proceeding to",l.current);const h=l.current;n(!1),h&&(c.current=!0,l.current=null,window.location.hash!==h&&(window.location.hash=h))},f=async()=>{if(console.log("[UnsavedChangesGuard] user chose: Save and leave"),!t){d();return}try{o(!0),await t(),d()}catch(h){console.log("[UnsavedChangesGuard] save failed, staying on page",h),o(!1)}finally{o(!1)}};return i.jsxs(pr,{open:r,onClose:u,maxWidth:"xs",fullWidth:!0,children:[i.jsx(mr,{children:"Unsaved Changes"}),i.jsx(gr,{children:i.jsx(B,{variant:"body2",children:"You have unsaved changes. Would you like to save before leaving this page?"})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:u,children:"Cancel"}),i.jsx(xe,{onClick:d,color:"warning",children:"Leave without saving"}),i.jsx(xe,{onClick:f,variant:"contained",disabled:a,children:a?"Saving":"Save and leave"})]})]})};var Hf={},hE;function oue(){if(hE)return Hf;hE=1;var e=sr();Object.defineProperty(Hf,"__esModule",{value:!0}),Hf.default=void 0;var t=e(cr()),r=lr();return Hf.default=(0,t.default)([(0,r.jsx)("path",{d:"M5 5h2v3h10V5h2v6h2V5c0-1.1-.9-2-2-2h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h5v-2H5zm7-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1"},"0"),(0,r.jsx)("path",{d:"m18.01 13-1.42 1.41 1.58 1.58H12v2h6.17l-1.58 1.59 1.42 1.41 3.99-4z"},"1")],"ContentPasteGo"),Hf}var sue=oue();const lue=Et(sue),Fw=e=>{if(!e.includes("|"))return null;let n=e.trim().split("|");if(n.length>=2&&n[0].trim()===""&&(n=n.slice(1)),n.length>=2&&n[n.length-1].trim()===""&&(n=n.slice(0,-1)),n.length===0)return null;const a=n.map(o=>o.trim());return a.every(o=>o.length===0)?null:a},cue=e=>{const t=Fw(e);return!t||t.length===0?!1:t.every(r=>/^:?-{3,}:?$/.test(r))},uue=e=>{const t=e.replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(!t.trim())return[];const r=t.split(`
`),n=[];let a=[];const o=()=>{const s=a.join(`
`);s.trim().length>0&&n.push({kind:"text",text:s}),a=[]};for(let s=0;s<r.length;s+=1){const l=r[s],c=Fw(l);if(c&&s+1<r.length&&cue(r[s+1])){o();const u=c,d=[];for(s+=2;s<r.length;s+=1){const f=r[s];if(f.trim().length===0)break;const h=Fw(f);if(!h){s-=1;break}d.push(h)}n.push({kind:"table",header:u,rows:d});continue}a.push(l)}return o(),n},tR=({value:e})=>{const t=x.useMemo(()=>uue(e),[e]);return t.length===0?i.jsx(B,{variant:"body2",color:"text.secondary",children:"Nothing to preview yet."}):i.jsx(Z,{sx:{display:"grid",gap:1.5},children:t.map((r,n)=>{if(r.kind==="text")return i.jsx(Z,{sx:{fontFamily:"Roboto Mono, Consolas, Menlo, monospace",fontSize:13,whiteSpace:"pre-wrap",lineHeight:1.4},children:r.text},`text-${n}`);const a=Math.max(r.header.length,r.rows.reduce((l,c)=>Math.max(l,c.length),0)),o=Array.from({length:a},(l,c)=>r.header[c]??""),s=r.rows.map(l=>Array.from({length:a},(c,u)=>l[u]??""));return i.jsxs(Jn,{size:"small",sx:{width:"100%","& th, & td":{border:"none",padding:"2px 10px 2px 0",verticalAlign:"top"},"& th":{fontWeight:700}},children:[i.jsx(Zn,{children:i.jsx(hr,{children:o.map((l,c)=>i.jsx(Ae,{children:l},`h-${c}`))})}),i.jsx(ea,{children:s.map((l,c)=>i.jsx(hr,{children:l.map((u,d)=>i.jsx(Ae,{children:u},`c-${c}-${d}`))},`r-${c}`))})]},`table-${n}`)})})},qm={name:"",content:""},due={"& textarea":{fontFamily:"Roboto Mono, Consolas, Menlo, monospace",fontSize:14,whiteSpace:"pre"}},fue=({open:e,onClose:t,onTemplateSelected:r,onSuccess:n,onError:a})=>{const[o,s]=x.useState([]),[l,c]=x.useState(!1),[u,d]=x.useState(null),[f,h]=x.useState(!1),[p,v]=x.useState(qm),[m,y]=x.useState({}),[b,_]=x.useState(!1),[w,A]=x.useState(null),P=x.useRef(null);x.useEffect(()=>{e&&T()},[e]);const T=async()=>{try{c(!0),d(null);const z=await ve.get("/api/quote-templates"),K=Array.isArray(z.data?.templates)?z.data.templates:[];s(K)}catch(z){console.error("Failed to load quote templates",z);const K=z?.response?.data&&typeof z.response?.data=="object"&&"message"in z.response?.data?(z.response?.data).message:"Failed to load quote templates";d(K),a?.(K)}finally{c(!1)}},E=z=>{z?(A(z),v({name:z.name,content:z.content})):(A(null),v(qm)),y({}),h(!0)},S=()=>{b||(h(!1),A(null),v(qm),y({}))},I=()=>{const z={};return p.name.trim()||(z.name="Template name is required"),p.content.trim()||(z.content="Template content is required"),y(z),Object.keys(z).length===0},W=async()=>{if(I())try{_(!0);const z={name:p.name.trim(),content:p.content};w?(await ve.put(`/api/quote-templates/${w.template_id}`,z),n?.("Template updated successfully")):(await ve.post("/api/quote-templates",z),n?.("Template created successfully")),h(!1),A(null),v(qm),await T()}catch(z){console.error("Failed to save quote template",z);const K=z,J=K.response?.data&&typeof K.response.data=="object"&&"message"in K.response.data?K.response.data.message:"Failed to save quote template";y(L=>({...L,submit:J})),a?.(J)}finally{_(!1)}},O=()=>{const z=`| Column 1 | Column 2 |
| --- | --- |
|  |  |
`,K=P.current;if(!K){v(C=>({...C,content:`${C.content}${C.content.endsWith(`
`)?"":`
`}${z}`}));return}const J=K.selectionStart??K.value.length,L=K.selectionEnd??K.value.length,k=p.content.slice(0,J),$=p.content.slice(L),X=`${k}${z}${$}`;v(C=>({...C,content:X})),window.requestAnimationFrame(()=>{K.focus();const C=J+z.length;K.setSelectionRange(C,C)})},D=async z=>{if(window.confirm(`Delete template "${z.name}"?`))try{await ve.delete(`/api/quote-templates/${z.template_id}`),n?.("Template deleted"),await T()}catch(J){console.error("Failed to delete quote template",J);const L=J,k=L.response?.data&&typeof L.response.data=="object"&&"message"in L.response.data?L.response.data.message:"Failed to delete template";a?.(k)}},R=z=>{r(z)},F=x.useMemo(()=>o,[o]);return i.jsxs(pr,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,children:[i.jsxs(mr,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(jw,{color:"primary"}),"Quote Description Templates"]}),i.jsx(gr,{dividers:!0,children:i.jsxs(dt,{spacing:2,sx:{minHeight:260},children:[i.jsxs(dt,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:"Saved templates"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Create reusable descriptions, including ASCII or HTML tables, and insert them into your quotes."})]}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:()=>E(),size:"small",children:"New Template"})]}),l?i.jsx(Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexGrow:1},children:i.jsx(tr,{size:32})}):u?i.jsx(Ot,{severity:"error",children:u}):F.length===0?i.jsx(Z,{sx:{textAlign:"center",py:6},children:i.jsx(B,{variant:"body1",color:"text.secondary",children:"No templates yet. Create your first template to speed up quote creation."})}):i.jsx(ha,{sx:{maxHeight:360,overflowY:"auto"},children:F.map((z,K)=>i.jsxs(Ce.Fragment,{children:[i.jsxs(ja,{alignItems:"flex-start",sx:{alignItems:"flex-start",gap:2},children:[i.jsx(Qn,{primary:i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:z.name}),secondary:i.jsxs(B,{variant:"caption",color:"text.secondary",children:["Updated ",new Date(z.updated_at||z.created_at).toLocaleString()]})}),i.jsxs(dt,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",justifyContent:"flex-end",children:[i.jsx(xe,{variant:"outlined",size:"small",startIcon:i.jsx(lue,{}),onClick:()=>R(z),children:"Insert"}),i.jsx(Hn,{title:"Edit template",children:i.jsx("span",{children:i.jsx(xr,{onClick:()=>E(z),size:"small",children:i.jsx(tu,{fontSize:"small"})})})}),i.jsx(Hn,{title:"Delete template",children:i.jsx("span",{children:i.jsx(xr,{onClick:()=>D(z),size:"small",color:"error",children:i.jsx(ma,{fontSize:"small"})})})})]})]}),K<F.length-1&&i.jsx(qn,{component:"li"})]},z.template_id))})]})}),i.jsx(jr,{children:i.jsx(xe,{onClick:t,children:"Close"})}),i.jsxs(pr,{open:f,onClose:S,maxWidth:"sm",fullWidth:!0,children:[i.jsx(mr,{children:w?"Edit Template":"New Template"}),i.jsx(gr,{children:i.jsxs(dt,{spacing:2,sx:{mt:1},children:[i.jsx(Pe,{label:"Template Name",value:p.name,onChange:z=>v(K=>({...K,name:z.target.value})),error:!!m.name,helperText:m.name,fullWidth:!0,autoFocus:!0}),i.jsx(Pe,{label:"Template Content",value:p.content,onChange:z=>v(K=>({...K,content:z.target.value})),error:!!m.content,helperText:m.content||"Supports multi-line descriptions and table layouts.",fullWidth:!0,multiline:!0,minRows:8,inputRef:P,InputProps:{sx:due}}),i.jsx(dt,{direction:"row",spacing:1,justifyContent:"flex-end",children:i.jsx(xe,{variant:"outlined",size:"small",startIcon:i.jsx(jw,{fontSize:"small"}),onClick:O,children:"Insert Table"})}),i.jsx(qn,{}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",sx:{fontWeight:700,mb:1},children:"Preview"}),i.jsx(Z,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1,p:1.5,bgcolor:"background.paper"},children:i.jsx(tR,{value:p.content})})]}),m.submit&&i.jsx(Ot,{severity:"error",children:m.submit})]})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:S,disabled:b,children:"Cancel"}),i.jsx(xe,{onClick:W,variant:"contained",disabled:b,children:b?"Saving":w?"Update Template":"Create Template"})]})]})]})},el={"& .MuiOutlinedInput-root":{height:56,borderRadius:1},"& .MuiInputBase-input":{py:1.25,fontSize:16}},vs={fontSize:18,transform:"translate(14px, 18px) scale(1)","&.MuiInputLabel-shrink":{fontSize:14,transform:"translate(14px, -9px) scale(0.9)"}},Fu=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim().toUpperCase(),hue=e=>{switch(e){case"Approved":return{backgroundColor:"rgba(76, 175, 80, 0.12)",color:"#2e7d32"};case"Rejected":return{backgroundColor:"rgba(244, 67, 54, 0.12)",color:"#c62828"};default:return{backgroundColor:"rgba(33, 150, 243, 0.12)",color:"#1565c0"}}},pue=(e,t)=>{const r=Fu(t);return r?e.map(a=>{const o=Fu(a.label);let s=-1;return o.startsWith(r)?s=3:o.split(" ").some(l=>l.startsWith(r))?s=2:o.includes(r)&&(s=1),{opt:a,score:s}}).filter(a=>a.score>=0).sort((a,o)=>o.score-a.score||a.opt.label.localeCompare(o.opt.label)).slice(0,8).map(a=>a.opt):e.slice(0,8)},pE=()=>{const{id:e}=Ms(),t=Tn(),n=!!e&&!(e==="new"),[a,o]=x.useState([]),[s,l]=x.useState([]),[c,u]=x.useState(null),[d,f]=x.useState(null),[h,p]=x.useState(null),[v,m]=x.useState(Rt()),[y,b]=x.useState(Rt().add(30,"day")),[_,w]=x.useState(null),[A,P]=x.useState(""),[T,E]=x.useState(""),[S,I]=x.useState(""),[W,O]=x.useState(""),[D,R]=x.useState(""),[F,z]=x.useState(""),[K,J]=x.useState(!1),[L,k]=x.useState(null),[$,X]=x.useState(null),[C,M]=x.useState(!1),[H,U]=x.useState(""),[te,le]=x.useState(null),[oe,ae]=x.useState(!1),he=x.useRef(null),me=x.useRef(null),[Q,G]=x.useState(!1),[ee,se]=x.useState(""),[V,Ge]=x.useState(null),[De,Fe]=x.useState(!1),[Xe,it]=x.useState(""),[lt,vt]=x.useState(!1),[Ye,Ze]=x.useState(""),[We,wt]=x.useState(!1),[Nt,kt]=x.useState(!1),[Wt,jt]=x.useState(!1),[ur,$e]=x.useState(""),[He,Je]=x.useState(!1),[Ue,pt]=x.useState(!1),at=x.useCallback(()=>({customer:d?.id||c?.customer_id||null,product:h?.label||c?.product_name||"",quoteDate:v?.toISOString?.()||c?.quote_date||null,validUntil:y?.toISOString?.()||c?.valid_until||null,estimatedCost:_??c?.estimated_cost??null,productDescription:(A||"").trim(),terms:(T||"").trim(),customerPoNumber:(S||"").trim(),vinNumber:(W||"").trim(),vehicleMake:(D||"").trim(),vehicleModel:(F||"").trim()}),[d,c,h,v,y,_,A,T,S,W,D,F]),St=x.useCallback(Oe=>{P(Oe.content),kt(!1),X(`Template "${Oe.name}" inserted into the description.`),window.setTimeout(()=>{if(me.current){const qe=me.current;qe.focus();try{const rt=Oe.content.length;qe.setSelectionRange(rt,rt)}catch{}}},0)},[P,kt,X]),It=x.useCallback(()=>{const Oe=`| Column 1 | Column 2 |
| --- | --- |
|  |  |
`,qe=me.current;if(!qe){P(rn=>`${rn}${rn.endsWith(`
`)?"":`
`}${Oe}`);return}const rt=qe.selectionStart??qe.value.length,Pt=qe.selectionEnd??qe.value.length,Kt=A.slice(0,rt),ar=A.slice(Pt),kr=`${Kt}${Oe}${ar}`;P(kr),window.requestAnimationFrame(()=>{qe.focus();const rn=rt+Oe.length;qe.setSelectionRange(rn,rn)})},[A]);x.useEffect(()=>{if(He&&ur===""){const Oe=JSON.stringify(at());$e(Oe),console.log("[QuoteEditor] Initial signature set:",Oe)}},[He,ur,at]);const Yt=x.useMemo(()=>JSON.stringify(at()),[at]),Sr=!!ur&&ur!==Yt&&!Ue;x.useEffect(()=>{ur&&console.log("[QuoteEditor] Signature comparison:",{isDirty:Sr,initialSignature:ur.slice(0,100)+"...",currentSignature:Yt.slice(0,100)+"...",signaturesMatch:ur===Yt})},[Sr,ur,Yt]),x.useEffect(()=>{Mr(),nr(),n||Je(!0)},[]),x.useEffect(()=>{!n||!e||(async()=>{try{const Oe=await ve.get(`/api/quotes/${e}`),qe={...Oe.data,status:Oh(Oe.data?.status)};u(qe),f(null),p({label:qe.product_name}),m(Rt(qe.quote_date)),b(Rt(qe.valid_until)),w(Number(qe.estimated_cost??0)),P(qe.product_description||""),E(qe.terms||""),I(qe.customer_po_number||""),O(qe.vin_number||""),R(qe.vehicle_make||""),z(qe.vehicle_model||""),U(qe.customer_name||""),se(qe.product_name||""),Je(!0)}catch(Oe){console.error("Failed to load quote:",Oe),k("Failed to load quote")}})()},[e,n]),x.useEffect(()=>{if(c&&a.length>0){const Oe=a.find(qe=>qe.id===c.customer_id);Oe&&f(Oe)}},[a,c]),x.useEffect(()=>()=>{te&&window.clearTimeout(te),V&&window.clearTimeout(V)},[te,V]);const Mr=async()=>{try{const qe=((await ve.get("/api/customers")).data||[]).map(rt=>({label:rt.customer_name,id:rt.customer_id,email:rt.email}));o(qe)}catch{k("Failed to load customers")}},nr=async()=>{try{const Oe=await ve.get("/api/products");l((Oe.data||[]).map(qe=>({label:qe.product_name,id:qe.product_id,description:qe.product_description})))}catch{k("Failed to load products")}},Cr=Oe=>{const qe=Fu(Oe);return a.find(rt=>Fu(rt.label)===qe)||null},Dr=async()=>{if(!d||!h||!v||!y||_==null){k("Please fill in all required fields");return}J(!0),pt(!0);try{const Oe={customer_id:d.id,product_name:h.label.trim(),quote_date:v.format("YYYY-MM-DD"),valid_until:y.format("YYYY-MM-DD"),estimated_cost:Number(_),product_description:A,terms:T,customer_po_number:S,vin_number:W,vehicle_make:D.trim(),vehicle_model:F.trim(),status:c?.status??"Open"};if(n&&c){const qe=await ve.put(`/api/quotes/${c.quote_id}`,Oe);X("Quote updated successfully");const rt=qe?.data;u(rt?Kt=>Kt&&{...Kt,...rt,status:Oh(rt.status??Kt.status)}:Kt=>Kt&&{...Kt,...Oe});const Pt=JSON.stringify(at());$e(Pt),console.log("[QuoteEditor] Signature reset after save:",Pt.slice(0,100)+"..."),setTimeout(()=>{window.__unsavedGuardAllowNext=!0},100)}else{if(window.__quoteCreateInFlight){console.log("[QuoteEditor] Skipping duplicate create (in flight)");return}window.__quoteCreateInFlight=!0;const qe=await ve.post("/api/quotes",Oe);X("Quote created successfully");const rt=qe?.data??{},Pt=rt.quote_id??rt.quoteId??rt.id??rt?.quote?.quote_id;if(Pt){const Kt={quote_id:Pt,quote_number:rt.quote_number||`Q${Pt}`,customer_id:d.id,customer_name:d.label,quote_date:Oe.quote_date,valid_until:Oe.valid_until,product_name:Oe.product_name,product_description:Oe.product_description,estimated_cost:Oe.estimated_cost,status:"Open",terms:Oe.terms,customer_po_number:Oe.customer_po_number,vin_number:Oe.vin_number,vehicle_make:Oe.vehicle_make,vehicle_model:Oe.vehicle_model};u(Kt),window.__unsavedGuardAllowNext=!0,t(`/quotes/${Pt}`,{replace:!0}),$e(JSON.stringify(at()));return}}}catch(Oe){const qe=Oe,rt=qe.response?.data&&typeof qe.response.data=="object"&&"message"in qe.response.data?qe.response.data.message:"Failed to save quote";k(rt)}finally{J(!1),pt(!1),window.__quoteCreateInFlight=!1}},fn=async()=>{if(c)try{const Oe=await ve.get(`/api/quotes/${c.quote_id}/pdf`,{responseType:"blob"}),qe=window.URL.createObjectURL(new Blob([Oe.data])),rt=document.createElement("a");rt.href=qe,rt.setAttribute("download",`Quote_${c.quote_number}.pdf`),document.body.appendChild(rt),rt.click(),rt.parentNode?.removeChild(rt),window.URL.revokeObjectURL(qe),X("PDF downloaded successfully.")}catch{k("Failed to download PDF. Please try again.")}},Oa=()=>{const Oe=new wr({unit:"pt"}),qe=40,rt=Oe.internal.pageSize.getWidth(),Pt=rt-qe*2,Kt="Estimate Cost";Oe.setFontSize(16),Oe.setFont("helvetica","bold"),Oe.text(Kt,qe,40),Oe.setFontSize(10),Oe.setFont("helvetica","normal");let ar=58;c?.quote_number&&(Oe.text(`Quote: ${c.quote_number}`,qe,ar),ar+=14),d?.label&&(Oe.text(`Customer: ${d.label}`,qe,ar),ar+=14),h?.label&&(Oe.text(`Product: ${h.label}`,qe,ar),ar+=14);const kr=[["SN","Item Code","Description","Qty","Unit","Unit Price","Line Total"]],rn=[["1","LABOUR","Labour Hours","52.41","hr","40.00","2096.40"],["2","1705110",'48" ALUM UNDERBODY TOOLBOX',"2","Each","1246.94","2493.88"],["3","3X(3/8)","Flatbar","75","ft","3.91","293.25"],["4","2X2X(3/16)AG L","Angle","10","ft","2.68","26.80"],["5","(3/4)(A36/44W)","HR ROUND - ASTM A36/44W","10","ft","1.67","16.70"],["6","5X3X(1/4)ANG LE3","HEAT # 52118708","20","ft","7.01","140.20"],["7","(4-1)(A36/44W)","CHANNEL ASTM A36/44W","100","ft","4.14","414.00"],["8","83021K05","CLOVAPRIME 21 EPOXY PRIM GREY 5 GAL KIT","1","Each","441.29","441.29"],["9","83904K05","GEMINI AMOURSHIELD BLACK 5G KIT","2","Each","639.73","1279.46"],["10","CLS-AS2620C","CR ANTI SAIL BRACKET","3","Each","8.70","26.10"],["11","AUP-IMXGT-2436CD",'1/4" RUBBER BLACK CHEVRO',"3","Each","19.53","58.59"],["12","SUPPLY","Supply","1","Each","209.64","209.64"],["13","OVERHEAD","Overhead Hours","52.41","hr","30.00","1572.30"]],Vr={sn:26,code:80,qty:44,unit:40,unitPrice:72,lineTotal:80},$n=Vr.sn+Vr.code+Vr.qty+Vr.unit+Vr.unitPrice+Vr.lineTotal,ka=Math.max(140,Pt-$n);iue(Oe,{head:kr,body:rn,startY:Math.max(110,ar+10),margin:{left:qe,right:qe},tableWidth:Pt,styles:{fontSize:9,cellPadding:4,overflow:"linebreak"},headStyles:{fillColor:[33,150,243],halign:"center"},columnStyles:{0:{cellWidth:Vr.sn,halign:"right"},1:{cellWidth:Vr.code},2:{cellWidth:ka},3:{cellWidth:Vr.qty,halign:"right"},4:{cellWidth:Vr.unit},5:{cellWidth:Vr.unitPrice,halign:"right"},6:{cellWidth:Vr.lineTotal,halign:"right"}},theme:"striped",didParseCell:Qe=>{Qe.section==="body"&&[0,3,5,6].includes(Qe.column.index)&&(Qe.cell.styles.halign="right")}});const Ya=Oe.lastAutoTable?.finalY||110,to="Sub Total: 9068.61",qi="Total GST: 453.43",Gn="Total: 9522.04";Oe.setFont("helvetica","bold"),Oe.setFontSize(11);const hi=rt-qe;Oe.text(to,hi,Ya+24,{align:"right"}),Oe.text(qi,hi,Ya+44,{align:"right"}),Oe.setFontSize(12),Oe.text(Gn,hi,Ya+70,{align:"right"});const ro=c?.quote_number?`Estimate_${c.quote_number}`:"Estimate_Cost";Oe.save(`${ro}.pdf`)},En=()=>{Wt||(jt(!0),window.setTimeout(()=>{jt(!1);try{Oa(),X("Estimate generated successfully.")}catch{k("Failed to generate estimate PDF.")}},15e3))},er=()=>{if(!c?.quote_id){k("Please save the quote before emailing.");return}wt(!0)},Jr=async()=>{if(!c?.quote_id){k("Please save the quote before converting.");return}J(!0);try{const Oe=await ve.post(`/api/quotes/${c.quote_id}/convert-to-sales-order`);X("Quote converted to sales order successfully!");const qe=Oe?.data?.quote;u(qe?Pt=>Pt&&{...Pt,...qe,status:Oh(qe.status??"Approved")}:Pt=>Pt&&{...Pt,status:"Approved"});const rt=Oe.data.salesOrder?.sales_order_id;setTimeout(rt?()=>{t(`/open-sales-orders/${rt}`)}:()=>{t("/open-sales-orders")},1500)}catch(Oe){const qe=Oe,rt=qe.response?.data&&typeof qe.response.data=="object"&&"message"in qe.response.data?qe.response.data.message:"Failed to convert quote to sales order";k(rt)}finally{J(!1)}},Vn=Oe=>{const qe=H.trim(),rt=Oe.key==="Enter",Pt=Oe.key==="Tab",Kt=Oe.key==="Escape",ar=Oe.key==="ArrowDown"||Oe.key==="ArrowUp";if(Kt){M(!1);return}if(!ar&&(rt||Pt)){if(rt&&Oe.ctrlKey&&qe){Oe.preventDefault(),ae(!0),it(qe),Fe(!0);return}const kr=Cr(qe);if(C||!qe)return;Oe.preventDefault(),kr?(f(kr),U(kr.label)):(ae(!0),it(qe),Fe(!0))}},In=Oe=>{if(Oe.key==="Enter"){Oe.preventDefault();const qe=ee.trim();if(!qe)return;const rt=s.find(Pt=>Pt.label.toLowerCase()===qe.toLowerCase());rt?(p(rt),se(rt.label)):(Ze(qe),vt(!0))}},Yr=n&&c?`Edit Quote: ${c.quote_number}`:n?"Edit Quote":"New Quote",Kr=c?c.status:"Open",je=Kr==="Approved",Ve=Kr==="Rejected",ot=async()=>{if(!c?.quote_id){k("Please save the quote before rejecting.");return}if(window.confirm("Are you sure you want to mark this quote as rejected?")){J(!0);try{const Oe=await ve.post(`/api/quotes/${c.quote_id}/reject`),qe=Oe?.data?.quote??Oe?.data;u(qe?rt=>rt&&{...rt,...qe,status:Oh(qe.status??"Rejected")}:rt=>rt&&{...rt,status:"Rejected"}),X("Quote marked as rejected.")}catch(Oe){const qe=Oe,rt=qe.response?.data&&typeof qe.response.data=="object"&&"message"in qe.response.data?qe.response.data.message:"Failed to reject quote";k(rt)}finally{J(!1)}}};return i.jsxs(Os,{dateAdapter:oc,children:[i.jsx(Ry,{when:Sr,onSave:Dr}),i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4,px:{xs:2,sm:3}},children:[i.jsxs(Z,{sx:{maxWidth:1e3,mx:"auto",mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs(dt,{direction:"row",spacing:1.5,alignItems:"center",children:[i.jsx(B,{variant:"h5",sx:{fontWeight:700},children:Yr}),n&&c&&i.jsx(st,{label:Kr,sx:{fontWeight:600,...hue(Kr)}})]}),i.jsxs(dt,{direction:"row",spacing:1.25,children:[i.jsx(xe,{variant:"contained",color:"primary",startIcon:i.jsx(Is,{}),onClick:Dr,disabled:K,children:n?"SAVE CHANGES":"CREATE QUOTE"}),n&&c&&i.jsxs(i.Fragment,{children:[i.jsx(xe,{variant:"contained",color:"primary",startIcon:i.jsx(xv,{}),onClick:Jr,disabled:K||je||Ve,children:"CONVERT TO SO"}),i.jsx(xe,{variant:"contained",color:"error",startIcon:i.jsx(ble,{}),onClick:ot,disabled:K||je||Ve,children:"MARK REJECTED"}),i.jsx(xe,{variant:"contained",color:"primary",startIcon:i.jsx(la,{}),onClick:fn,children:"DOWNLOAD PDF"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(yS,{}),sx:{backgroundColor:"#ff9800","&:hover":{backgroundColor:"#f57c00"}},onClick:er,children:"EMAIL QUOTE"})]})]})]}),i.jsx(Z,{sx:{maxWidth:1e3,mx:"auto",mt:1.5},children:i.jsx(bt,{sx:{p:3,backgroundColor:"#fff"},elevation:3,children:i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(Ra,{open:C,onOpen:()=>M(!0),onClose:()=>M(!1),autoHighlight:!0,options:a,value:d,onChange:(Oe,qe)=>{if(oe){ae(!1);return}qe&&qe.isNew?(Fe(!0),it(H),f(null),U("")):f(qe)},filterOptions:(Oe,qe)=>{const rt=pue(Oe,qe.inputValue||""),Pt=!!(qe.inputValue&&a.some(ar=>Fu(ar.label)===Fu(qe.inputValue))),Kt=[...rt];return(qe.inputValue||"").trim()!==""&&!Pt&&Kt.push({label:`Add "${qe.inputValue}" as New Customer`,isNew:!0}),rt.length===0&&(qe.inputValue||"").trim()!==""&&!Pt,Kt},inputValue:H,onInputChange:(Oe,qe,rt)=>{if(U(qe),te&&window.clearTimeout(te),rt==="reset")return;if(qe.trim().length>0){const Kt=window.setTimeout(()=>M(!0),180);le(Kt)}else M(!1)},getOptionLabel:Oe=>typeof Oe=="string"?Oe:Oe.label,isOptionEqualToValue:(Oe,qe)=>Oe.id===qe?.id,renderOption:(Oe,qe)=>{const rt=qe.isNew,{key:Pt,...Kt}=Oe;return i.jsxs("li",{...Kt,style:{display:"flex",alignItems:"center",opacity:rt?.9:1},children:[rt&&i.jsx(ec,{fontSize:"small",style:{marginRight:8,color:"#666"}}),i.jsx("span",{children:qe.label})]},Pt)},renderInput:Oe=>{const qe=!!Oe.inputProps?.value,rt=!!d||qe;return i.jsx(Pe,{...Oe,label:"Customer",fullWidth:!0,required:!0,onKeyDown:Vn,onBlur:()=>{if(!d){const Pt=H.trim();if(Pt){const Kt=Cr(Pt);Kt&&(f(Kt),U(Kt.label))}}},inputRef:Pt=>{he.current=Pt},sx:el,InputLabelProps:{...Oe.InputLabelProps,sx:vs,shrink:rt}})}})}),i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(Pe,{label:"Customer PO #",fullWidth:!0,value:S,onChange:Oe=>I(Oe.target.value),sx:el,InputLabelProps:{sx:vs}})}),i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(Pe,{label:"Estimated Price",type:"number",value:_??"",onChange:Oe=>w(Oe.target.value===""?null:parseFloat(Oe.target.value)),fullWidth:!0,required:!0,InputProps:{startAdornment:i.jsx(sa,{position:"start",children:"$"})},inputProps:{step:"0.01",onWheel:Oe=>Oe.currentTarget.blur()},sx:el,InputLabelProps:{sx:vs}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Ra,{disablePortal:!0,open:Q,onOpen:()=>G(!0),onClose:()=>G(!1),autoHighlight:!0,options:s,value:h,onChange:(Oe,qe)=>{if(qe&&qe.isNew){const rt=qe.inputValue?.toString?.()||ee.trim();vt(!0),Ze(rt),p(null),se(""),G(!1)}else p(qe),G(!1)},filterOptions:(Oe,qe)=>{const rt=Oe.filter(Pt=>Pt.label.toLowerCase().includes(qe.inputValue.toLowerCase()));return qe.inputValue!==""&&!Oe.some(Pt=>Pt.label.toLowerCase()===qe.inputValue.toLowerCase())&&rt.push({label:`Add "${qe.inputValue}"`,isNew:!0,inputValue:qe.inputValue}),rt},inputValue:ee,onInputChange:(Oe,qe,rt)=>{if(se(qe),Ze(qe),V&&window.clearTimeout(V),rt==="reset")return;if(qe.trim().length>0){const Kt=window.setTimeout(()=>G(!0),180);Ge(Kt)}else G(!1)},getOptionLabel:Oe=>typeof Oe=="string"?Oe:Oe.label,isOptionEqualToValue:(Oe,qe)=>Oe.id===qe?.id,renderInput:Oe=>{const qe=!!Oe.inputProps?.value,rt=!!h||qe;return i.jsx(Pe,{...Oe,label:"Product",fullWidth:!0,required:!0,onKeyDown:In,onBlur:()=>{if(!h){const Pt=ee.trim();if(Pt){const Kt=s.find(ar=>ar.label.toLowerCase()===Pt.toLowerCase());Kt&&(p(Kt),se(Kt.label))}}},sx:el,InputLabelProps:{...Oe.InputLabelProps,sx:vs,shrink:rt}})}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Pe,{label:"VIN #",fullWidth:!0,placeholder:"Optional",value:W,onChange:Oe=>O(Oe.target.value),sx:el,InputLabelProps:{sx:vs}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Pe,{label:"Make",fullWidth:!0,value:D,onChange:Oe=>R(Oe.target.value),sx:el,InputLabelProps:{sx:vs}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Pe,{label:"Model",fullWidth:!0,value:F,onChange:Oe=>z(Oe.target.value),sx:el,InputLabelProps:{sx:vs}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(os,{label:"Quote Date",value:v,onChange:Oe=>m(Oe),slotProps:{textField:{fullWidth:!0,sx:el,InputLabelProps:{sx:vs}}}})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(os,{label:"Valid Until",value:y,onChange:Oe=>b(Oe),slotProps:{textField:{fullWidth:!0,sx:el,InputLabelProps:{sx:vs}}}})}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsxs(dt,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:"Product Description"}),i.jsxs(dt,{direction:"row",spacing:1,children:[i.jsx(xe,{variant:"outlined",size:"small",onClick:()=>kt(!0),children:"Templates"}),i.jsx(xe,{variant:"outlined",size:"small",startIcon:i.jsx(jw,{fontSize:"small"}),onClick:It,children:"Insert Table"})]})]}),i.jsx(Pe,{placeholder:"Add the quote details here...",fullWidth:!0,multiline:!0,minRows:6,value:A,onChange:Oe=>P(Oe.target.value),inputRef:me,sx:{"& .MuiOutlinedInput-root":{borderRadius:1},"& textarea":{fontSize:15,fontFamily:"Roboto Mono, Consolas, Menlo, monospace",whiteSpace:"pre-wrap"}}}),i.jsxs(Z,{sx:{mt:1.5},children:[i.jsx(B,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.75},children:"Preview"}),i.jsx(Z,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1,p:1.5,bgcolor:"background.paper"},children:i.jsx(tR,{value:A})})]}),i.jsxs(Z,{sx:{mt:1.5,display:"flex",alignItems:"center",gap:1.5},children:[i.jsx(xe,{variant:"contained",color:"secondary",onClick:En,disabled:Wt,children:"ESTIMATE COST"}),Wt&&i.jsxs(dt,{direction:"row",alignItems:"center",spacing:1,children:[i.jsx(tr,{size:22}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Generating estimate"})]})]})]}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Terms and Conditions",fullWidth:!0,multiline:!0,minRows:4,value:T,onChange:Oe=>E(Oe.target.value),sx:{"& .MuiOutlinedInput-root":{borderRadius:1},"& .MuiOutlinedInput-input":{fontSize:15}},InputLabelProps:{sx:vs,shrink:!0}})})]})})}),i.jsx(fue,{open:Nt,onClose:()=>kt(!1),onTemplateSelected:St,onSuccess:Oe=>X(Oe),onError:Oe=>k(Oe)}),i.jsx(eR,{open:We,onClose:()=>wt(!1),type:"quote",recordId:c?.quote_id,defaultTo:d?.email||"",allowMessageEdit:!0}),i.jsx(Wd,{open:De,onClose:()=>Fe(!1),onSave:async Oe=>{try{const rt=(await ve.post("/api/customers",Oe)).data,Pt={label:rt.customer_name,id:rt.customer_id,email:rt.email||Oe.email};o(Kt=>[...Kt,Pt]),f(Pt),Fe(!1),U(Pt.label)}catch{k("Failed to add customer")}},initialCustomer:{customer_name:Xe},isEditMode:!1}),i.jsx(wS,{open:lt,onClose:()=>vt(!1),onSave:async Oe=>{try{const qe=await ve.post("/api/products",Oe),rt={label:Oe.product_name,id:qe.data.product_id,description:Oe.product_name};l(Pt=>[...Pt,rt]),p(rt),se(rt.label),vt(!1),Ze("")}catch{k("Failed to add product.")}},initialProduct:{product_name:Ye||ee},isEditMode:!1}),i.jsx(pl,{open:!!$,autoHideDuration:6e3,onClose:()=>X(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>X(null),severity:"success",sx:{width:"100%"},children:$})}),i.jsx(pl,{open:!!L,autoHideDuration:6e3,onClose:()=>k(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>k(null),severity:"error",sx:{width:"100%"},children:L})})]})]})},mue=({conversations:e,activeConversationId:t,onSelect:r,onStartConversation:n,isLoading:a=!1,unreadConversationIds:o})=>{const[s,l]=x.useState(""),c=x.useMemo(()=>new Set(o??[]),[o]),u=x.useMemo(()=>{const d=s.trim().toLowerCase();return d?e.filter(f=>{const h=f.displayName.toLowerCase(),p=f.participantNames.toLowerCase();return h.includes(d)||p.includes(d)}):e},[e,s]);return i.jsxs(Z,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[i.jsxs(dt,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:2,sx:{mb:2},children:[i.jsx(B,{variant:"h6",component:"h2",children:"Conversations"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Ev,{}),onClick:n,size:"small",children:"New"})]}),i.jsx(Pe,{fullWidth:!0,size:"small",placeholder:"Search conversations",value:s,onChange:d=>l(d.target.value),sx:{mb:2}}),i.jsx(qn,{}),i.jsx(Z,{sx:{flexGrow:1,overflowY:"auto"},children:a?i.jsx(Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",py:4},children:i.jsx(tr,{size:32})}):u.length===0?i.jsx(Z,{sx:{textAlign:"center",py:6,px:2},children:i.jsx(B,{variant:"body2",color:"text.secondary",children:s?"No conversations match your search.":"Start a new conversation to begin messaging."})}):i.jsx(ha,{disablePadding:!0,children:u.map(d=>{const f=d.lastMessage?.content,h=d.lastMessageAt||d.updatedAt||d.createdAt,p=Coe(new Date(h),{addSuffix:!0}),v=c.has(d.id);return i.jsxs(Ce.Fragment,{children:[i.jsxs(b8,{selected:d.id===t,alignItems:"flex-start",onClick:()=>r(d.id),sx:{py:1.5,"&.Mui-selected":{backgroundColor:"action.selected"},bgcolor:v?"action.hover":void 0,"& .MuiListItemText-secondary":{display:"-webkit-box",overflow:"hidden",WebkitBoxOrient:"vertical",WebkitLineClamp:2}},children:[i.jsx(_8,{children:i.jsx(kp,{children:d.displayName.charAt(0).toUpperCase()})}),i.jsx(Qn,{primary:i.jsxs(dt,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:1,children:[i.jsx(B,{variant:"subtitle1",noWrap:!0,sx:{fontWeight:v?600:500},children:d.displayName}),i.jsxs(dt,{direction:"row",alignItems:"center",spacing:1.25,sx:{flexShrink:0},children:[v&&i.jsx(Z,{component:"span",sx:{width:8,height:8,borderRadius:"50%",bgcolor:"primary.main"}}),i.jsx(B,{variant:"caption",color:"text.secondary",children:p})]})]}),secondaryTypographyProps:{fontWeight:v?600:void 0},secondary:f||"No messages yet"})]}),i.jsx(qn,{component:"li"})]},d.id)})})})]})},gue=({onSendMessage:e,disabled:t=!1,placeholder:r="Type your message...",withTopBorder:n=!0})=>{const[a,o]=x.useState(""),s=()=>{a.trim()&&!t&&(e(a.trim()),o(""))},l=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),s())};return i.jsx(bt,{elevation:0,sx:{px:{xs:2,sm:3},py:2.5,borderTop:n?"1px solid":"none",borderColor:"divider",bgcolor:"transparent",backdropFilter:"blur(6px)"},children:i.jsxs(Z,{sx:{display:"flex",alignItems:{xs:"stretch",sm:"center"},gap:1.5,bgcolor:"rgba(255, 255, 255, 0.92)",borderRadius:3,px:{xs:1.5,sm:2.5},py:{xs:1.25,sm:1.5},border:"1px solid rgba(148, 163, 184, 0.25)",boxShadow:"0 18px 36px -28px rgba(15, 23, 42, 0.4)"},children:[i.jsx(Pe,{fullWidth:!0,multiline:!0,maxRows:4,value:a,onChange:c=>o(c.target.value),onKeyDown:l,placeholder:r,disabled:t,variant:"standard",size:"medium",sx:{"& .MuiInputBase-root":{fontSize:15,lineHeight:1.7,"&::before, &::after":{display:"none"}},"& textarea":{padding:0}}}),i.jsx(Hn,{title:"Send message",children:i.jsx("span",{children:i.jsx(xr,{onClick:s,disabled:!a.trim()||t,sx:{bgcolor:"primary.main",color:"common.white",p:1.4,borderRadius:"18px",transition:"transform 0.2s ease, box-shadow 0.2s ease",boxShadow:c=>`0 16px 32px -18px ${c.palette.primary.main}`,"&:hover":{bgcolor:"primary.dark",transform:"translateY(-1px)",boxShadow:c=>`0 20px 38px -20px ${c.palette.primary.dark}`},"&.Mui-disabled":{bgcolor:"grey.200",color:"grey.500",boxShadow:"none",transform:"none"}},children:i.jsx(w8,{fontSize:"small"})})})})]})})};var Vf={},mE;function vue(){if(mE)return Vf;mE=1;var e=sr();Object.defineProperty(Vf,"__esModule",{value:!0}),Vf.default=void 0;var t=e(cr()),r=lr();return Vf.default=(0,t.default)((0,r.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"}),"DeleteOutlineOutlined"),Vf}var yue=vue();const xue=Et(yue),bue=e=>{try{return Ru(new Date(e),"MMM d, yyyy h:mm a")}catch{return e}},_ue=({conversation:e,messages:t,currentUserId:r,isLoading:n,isSending:a,onSendMessage:o,onDeleteMessage:s})=>{const l=x.useRef(null);x.useEffect(()=>{const u=l.current;u&&(u.scrollTop=u.scrollHeight)},[t.length,n]);const c=x.useMemo(()=>e?e.otherParticipants.length>0?e.otherParticipants.map(u=>u.username||u.email||"Unknown user").join(", "):e.participantNames:"",[e]);return e?i.jsxs(bt,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[i.jsxs(Z,{sx:{p:2},children:[i.jsx(B,{variant:"h6",component:"h2",children:e.displayName}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:c})]}),i.jsx(qn,{}),i.jsx(Z,{ref:l,sx:{flexGrow:1,overflowY:"auto",p:2},children:n?i.jsx(Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:i.jsx(tr,{size:36})}):t.length===0?i.jsx(Z,{sx:{textAlign:"center",color:"text.secondary",mt:6},children:i.jsx(B,{variant:"body2",children:"No messages yet. Start the conversation below."})}):i.jsx(dt,{spacing:2,children:t.map(u=>{const d=r!==null&&u.senderId===r,f=!!u.isDeletedForUser,h=d?"flex-end":"flex-start",p=u.error?"error.light":f?"grey.300":d?"primary.main":"grey.100",v=u.error?"error.dark":f?"text.secondary":d?"common.white":"text.primary",m=!f&&!u.error&&!u.pending&&typeof u.id=="number",y=f?d?"You deleted this message":"Message deleted":u.content;return i.jsx(Z,{sx:{display:"flex",justifyContent:h},children:i.jsxs(Z,{sx:{maxWidth:"75%",display:"flex",flexDirection:"column",gap:.5},children:[i.jsxs(bt,{elevation:d?3:1,sx:{p:1.5,bgcolor:p,color:v,borderRadius:2,border:u.error?"1px solid":"none",borderColor:u.error?"error.main":void 0,position:"relative"},children:[i.jsxs(dt,{spacing:.5,children:[i.jsx(B,{variant:"caption",sx:{opacity:d?.85:.6},children:u.senderName||(d?"You":"Unknown user")}),i.jsx(B,{variant:"body2",sx:{whiteSpace:"pre-wrap",fontStyle:f?"italic":"normal"},children:y}),i.jsx(B,{variant:"caption",sx:{opacity:d?.85:.6,textAlign:"right"},children:bue(u.createdAt)})]}),m&&i.jsx(Hn,{title:"Delete for me",children:i.jsx(xr,{size:"small",onClick:()=>s(Number(u.id)),sx:{position:"absolute",top:4,right:4,color:d?"common.white":"text.secondary",bgcolor:d?"rgba(255,255,255,0.1)":"transparent","&:hover":{bgcolor:d?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.04)"}},children:i.jsx(xue,{fontSize:"inherit"})})})]}),u.pending&&!u.error&&i.jsx(st,{label:"Sending...",size:"small",color:"default",sx:{alignSelf:d?"flex-end":"flex-start",mt:.5}}),u.error&&i.jsx(B,{variant:"caption",color:"error",sx:{alignSelf:d?"flex-end":"flex-start"},children:"Failed to send. Please try again."})]})},u.id)})})}),i.jsx(qn,{}),i.jsx(gue,{onSendMessage:u=>o(u),disabled:a})]}):i.jsx(bt,{sx:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",p:4},children:i.jsx(B,{variant:"body1",color:"text.secondary",align:"center",children:"Select a conversation to view messages or start a new chat."})})},wue=()=>{const{user:e}=ta(),t=e?Number(e.id):null,{conversations:r,isLoadingConversations:n,activeConversationId:a,selectConversation:o,messagesByConversation:s,isLoadingMessages:l,sendMessage:c,createConversation:u,loadMessages:d,deleteMessage:f,unreadConversationIds:h}=vN(),[p,v]=x.useState([]),[m,y]=x.useState(!1),[b,_]=x.useState(!1),[w,A]=x.useState([]),[P,T]=x.useState(""),[E,S]=x.useState(!1),[I,W]=x.useState(!1);x.useEffect(()=>{let $=!0;return(async()=>{try{y(!0);const C=await ve.get("/api/employees");if(!$)return;const H=(Array.isArray(C.data)?C.data:[]).map(U=>({id:Number(U.id),username:U.username??null,email:U.email??null,access_role:U.access_role})).filter(U=>U.id!==t).sort((U,te)=>{const le=(U.username||U.email||"").toLowerCase(),oe=(te.username||te.email||"").toLowerCase();return le.localeCompare(oe)});v(H)}catch(C){console.error("Failed to load employees",C),ge.error("Unable to load team members.")}finally{$&&y(!1)}})(),()=>{$=!1}},[t]);const O=x.useMemo(()=>r.find($=>$.id===a),[a,r]),D=a?s[a]??[]:[],R=a?!!l[a]:!1,F=()=>{A([]),T(""),_(!0)},z=()=>{E||_(!1)},K=async()=>{if(w.length===0){ge.error("Select at least one teammate to start a conversation.");return}const $=w.map(C=>C.id),X=$.length>1?"group":"direct";if(X==="group"&&!P.trim()){ge.error("Enter a name for the group conversation.");return}try{S(!0);const C=await u({participantIds:$,title:X==="group"?P.trim():void 0,type:X}),{conversation:M,created:H}=C;ge.success(H?"Conversation created successfully.":"Conversation already existed. Opening chat."),_(!1),A([]),T(""),await d(M.id,{force:!0})}catch(C){console.error("Failed to create conversation",C),ge.error("Unable to start conversation. Please try again.")}finally{S(!1)}},J=async $=>{if(!a){ge.error("Select a conversation before sending a message.");return}try{W(!0),await c(a,$)}catch(X){console.error("Failed to send message",X),ge.error("Failed to send message. Please try again.")}finally{W(!1)}},L=async $=>{if(!a){ge.error("Select a conversation before deleting a message.");return}try{await f(a,$),ge.info("Message deleted for you.")}catch(X){console.error("Failed to delete message",X),ge.error("Unable to delete message. Please try again.")}},k=x.useMemo(()=>p,[p]);return i.jsxs(Z,{sx:{display:"flex",flexDirection:"column",height:"100%",p:{xs:2,md:3},gap:3},children:[i.jsxs(dt,{spacing:1,children:[i.jsx(B,{variant:"h4",component:"h1",children:"Messaging"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Collaborate with your team using direct messages and group chats."})]}),i.jsxs(bt,{elevation:0,sx:{flexGrow:1,minHeight:{xs:480,md:540},display:"flex",flexDirection:{xs:"column",md:"row"},borderRadius:3,overflow:"hidden",border:"1px solid",borderColor:"divider",backgroundColor:"background.paper"},children:[i.jsx(Z,{sx:{width:{xs:"100%",md:340},flexShrink:0,borderRight:{md:"1px solid",xs:"none"},borderColor:"divider",backgroundColor:"background.default"},children:i.jsx(Z,{sx:{height:"100%",p:{xs:2,md:2.5}},children:i.jsx(mue,{conversations:r,activeConversationId:a,onSelect:o,onStartConversation:F,isLoading:n,unreadConversationIds:h})})}),i.jsx(qn,{orientation:"vertical",flexItem:!0,sx:{display:{xs:"none",md:"block"}}}),i.jsx(Z,{sx:{flex:1,p:{xs:2,md:2.5},display:"flex",flexDirection:"column",backgroundColor:"background.paper"},children:i.jsx(_ue,{conversation:O,messages:D,currentUserId:t,isLoading:R,isSending:I,onSendMessage:J,onDeleteMessage:L})})]}),i.jsxs(pr,{open:b,onClose:z,fullWidth:!0,maxWidth:"sm",children:[i.jsx(mr,{children:"Start a Conversation"}),i.jsx(gr,{dividers:!0,children:i.jsxs(dt,{spacing:2,sx:{mt:1},children:[i.jsx(Ra,{multiple:!0,options:k,value:w,onChange:($,X)=>A(X),getOptionLabel:$=>$.username||$.email||`User ${$.id}`,renderOption:($,X)=>x.createElement("li",{...$,key:X.id},i.jsxs(dt,{spacing:.25,children:[i.jsx(B,{variant:"body2",children:X.username||X.email||`User ${X.id}`}),X.email&&i.jsx(B,{variant:"caption",color:"text.secondary",children:X.email})]})),filterSelectedOptions:!0,renderInput:$=>i.jsx(Pe,{...$,label:"Participants",placeholder:"Select team members",helperText:"Choose one teammate for a direct chat or multiple for a group conversation."}),loading:m,loadingText:"Loading team members..."}),w.length>1&&i.jsx(Pe,{label:"Group name",value:P,onChange:$=>T($.target.value),placeholder:"e.g., Operations Leads",inputProps:{maxLength:80}})]})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:z,disabled:E,children:"Cancel"}),i.jsx(xe,{variant:"contained",onClick:K,disabled:E||w.length===0||w.length>1&&!P.trim(),children:E?"Creating":"Start"})]})]})]})};var Gf={},gE;function jue(){if(gE)return Gf;gE=1;var e=sr();Object.defineProperty(Gf,"__esModule",{value:!0}),Gf.default=void 0;var t=e(cr()),r=lr();return Gf.default=(0,t.default)((0,r.jsx)("path",{d:"m19 9 1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25zm-7.5.5L9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12zM19 15l-1.25 2.75L15 19l2.75 1.25L19 23l1.25-2.75L23 19l-2.75-1.25z"}),"AutoAwesome"),Gf}var Sue=jue();const $w=Et(Sue);var Yf={},vE;function Cue(){if(vE)return Yf;vE=1;var e=sr();Object.defineProperty(Yf,"__esModule",{value:!0}),Yf.default=void 0;var t=e(cr()),r=lr();return Yf.default=(0,t.default)([(0,r.jsx)("path",{d:"M21 8c-1.45 0-2.26 1.44-1.93 2.51l-3.55 3.56c-.3-.09-.74-.09-1.04 0l-2.55-2.55C12.27 10.45 11.46 9 10 9c-1.45 0-2.27 1.44-1.93 2.52l-4.56 4.55C2.44 15.74 1 16.55 1 18c0 1.1.9 2 2 2 1.45 0 2.26-1.44 1.93-2.51l4.55-4.56c.3.09.74.09 1.04 0l2.55 2.55C12.73 16.55 13.54 18 15 18c1.45 0 2.27-1.44 1.93-2.52l3.56-3.55c1.07.33 2.51-.48 2.51-1.93 0-1.1-.9-2-2-2"},"0"),(0,r.jsx)("path",{d:"m15 9 .94-2.07L18 6l-2.06-.93L15 3l-.92 2.07L12 6l2.08.93zM3.5 11 4 9l2-.5L4 8l-.5-2L3 8l-2 .5L3 9z"},"1")],"Insights"),Yf}var Aue=Cue();const Pue=Et(Aue);var Kf={},yE;function Oue(){if(yE)return Kf;yE=1;var e=sr();Object.defineProperty(Kf,"__esModule",{value:!0}),Kf.default=void 0;var t=e(cr()),r=lr();return Kf.default=(0,t.default)((0,r.jsx)("path",{d:"M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2m-5 12H9v-2h6zm5-7H4V4l16-.02z"}),"Inventory"),Kf}var kue=Oue();const Tue=Et(kue);var Qf={},xE;function Eue(){if(xE)return Qf;xE=1;var e=sr();Object.defineProperty(Qf,"__esModule",{value:!0}),Qf.default=void 0;var t=e(cr()),r=lr();return Qf.default=(0,t.default)((0,r.jsx)("path",{d:"M4.25 5.61C6.27 8.2 10 13 10 13v6c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-6s3.72-4.8 5.74-7.39c.51-.66.04-1.61-.79-1.61H5.04c-.83 0-1.3.95-.79 1.61"}),"FilterAlt"),Qf}var Iue=Eue();const Nue=Et(Iue),bl={version:"1.0",domain:"truck_trailer_fabrication",description:"Master synonym + normalization dictionary for searching truck/trailer fabrication parts by description and number.",abbreviation_map:{GR:["grade"],GR2:["grade 2"],GR5:["grade 5"],GR8:["grade 8","high tensile"],G2:["grade 2"],G5:["grade 5"],G8:["grade 8"],NC:["national coarse","coarse thread"],NF:["national fine","fine thread"],UNC:["unified national coarse"],UNF:["unified national fine"],UN:["unified thread"],STOVER:["prevailing torque","locknut"],LOCKNUT:["lock nut","torque nut"],CSK:["countersunk"],PL:["plow","plow bolt"],HD:["heavy duty"],HT:["high tensile"],HEX:["hex head","hexagon head"],HHCS:["hex head cap screw"],CAP:["cap screw","cap bolt"],BOLT:["bolt","cap screw"],SCREW:["screw"],ROD:["rod","ready rod","all-thread"],RR:["ready rod","all-thread"],RRD:["ready rod","all-thread"],NUT:["nut"],WASH:["washer"],WASHER:["washer"],STL:["steel"],AL:["aluminum"],ALUM:["aluminum"],SS:["stainless steel"],SS304:["stainless steel 304"],SS316:["stainless steel 316"],GALV:["galvanized"],GALVANIZING:["galvanized coating","zinc rich coating"],ZINC:["zinc plated"],BRZ:["bronze"],BRASS:["brass"],COP:["copper"],HR:["hot rolled"],HRS:["hot rolled steel"],CR:["cold rolled"],HSS:["hollow structural section"],QT:["quenched and tempered"],QT100:["quenched and tempered 100 ksi plate"],A36:["ASTM A36 structural steel"],A53:["ASTM A53 pipe"],A500:["ASTM A500 tube"],CSA:["canadian standards association"],ASTM:["american society for testing and materials"],GA:["gauge"],GAUGE:["gauge"],SCH:["schedule"],OD:["outside diameter"],ID:["inside diameter"],NPT:["national pipe thread tapered"],MPT:["male pipe thread"],FPT:["female pipe thread"],M:["male"],F:["female"],MNPT:["male npt"],FNPT:["female npt"],ELB:["elbow"],ELBOW:["elbow"],TEE:["tee"],CAPS:["caps","end caps"],FLG:["flange"],FLANGE:["flange"],TTMA:["ttma flange pattern"],VALVE:["valve"],CHK:["check"],DC:["dual check","direct current (context dependent)"],CV:["check valve"],STT:["stop turn tail"],"ST/T":["stop tail turn"],"STT/T":["stop tail turn"],"B/U":["back up"],BACKUP:["back up"],BU:["back up"],CLR:["clearance"],MARKER:["marker light"],IDLF:["identification light function"],LED:["led","light emitting diode"],INCAND:["incandescent"],LAMP:["light","lamp"],LIC:["license"],LICENCE:["license"],PLUG:["plug"],PIGTAIL:["pigtail harness"],JBOX:["junction box"],JUNCTION:["junction"],"JUNCTION BOX":["junction box"],CABLE:["cable","wire"],WIRE:["wire"],SYNFLEX:["air brake nylon hose"],AIRLINE:["air line"],AB:["air brake"],ABS:["anti lock brake system"],AXL:["axle"],AXLE:["axle"],SPR:["spring"],EQ:["equalizer"],EQUALIZER:["equalizer"],HUB:["hub"],DRUM:["drum"],SHOE:["brake shoe"],LINED:["lined"],GLAD:["gladhand"],GH:["gladhand"],CAM:["camshaft","s-cam"],SLACK:["slack adjuster"],SUSP:["suspension"],SUSPENSION:["suspension"],JACK:["jack"],DL:["dropleg"],DROPLEG:["dropleg"],LEG:["leg"],COUPLER:["coupler"],EYE:["lunette eye"],LUNETTE:["lunette ring"],ADJ:["adjustable"],ADJUST:["adjustable"],"25K":["25000 lb","25,000 lb"],"20K":["20000 lb","20,000 lb"],TUBE:["tube"],TUBING:["tubing"],PIPE:["pipe"],CH:["channel"],CHANNEL:["channel"],ANG:["angle"],ANGLE:["angle"],PLATE:["plate"],BAR:["bar"],FLAT:["flat bar"],FB:["flat bar"],DECK:["decking"],DECKING:["decking"],FIR:["douglas fir"],"T&G":["tongue and groove"],"S-DRY":["surface dry"],"S DRY":["surface dry"],INV:["invoice"],PO:["purchase order"],ENV:["environmental"],ECO:["environmental"],FEE:["fee"],KIT:["kit"],ASSY:["assembly"],ASSM:["assembly"],ASM:["assembly"],WLD:["welded"],WELD:["weld"],WELDED:["welded"],GLV:["gloves"],GLVS:["gloves"],OZ:["ounce"],LB:["pound"],PK:["pack"],BG:["bag"],EA:["each"],EACH:["each"],FT:["foot","feet"],IN:["inch","inches"],MM:["millimeter","millimetre"],CM:["centimeter","centimetre"],WHEEL:["wheel"],RIM:["rim"],TIRE:["tire"],TYRE:["tire"],RECYCLE:["recycle"],RECYCLING:["recycling"],ECOFEE:["environmental fee","tire levy"]},material_grade_map:{A36:["mild steel","astm a36"],A53:["astm a53 pipe","standard pipe"],A500B:["astm a500 grade b tube"],HSS:["structural tube","hollow structural section"],QT100:["quenched and tempered 100 ksi plate"],"350W":["csa g40.21 350w structural steel"],"44W":["csa g40.21 44w structural steel"],"50W":["csa g40.21 50w structural steel"],"CSA G40.21":["csa g40.21 structural steel specification"],"H.S.S":["hollow structural section"],FIR:["douglas fir lumber"],SPF:["spruce pine fir lumber"]},finish_map:{"HOT DIP GALV":["hot dip galvanized"],GALV:["galvanized"],GALVANIZED:["galvanized"],"ZINC PLATED":["zinc plated"],ZP:["zinc plated"],PRIMED:["shop primed"],PRIMER:["primer coated"],PAINTED:["painted finish"],PLAIN:["no coating","mill finish"],MILL:["mill finish"],"BRIGHT GALVANIZING":["zinc rich galvanizing spray","cold galvanizing"],"SS POLISHED":["polished stainless"]},thread_map:{NC:["coarse","unc"],NF:["fine","unf"],UNC:["coarse","unified coarse"],UNF:["fine","unified fine"],NPT:["tapered pipe thread"],NPS:["straight pipe thread"],MPT:["male npt","male pipe thread"],FPT:["female pipe thread"],NS:["national special thread"],DRYSEAL:["nptf","dryseal pipe thread"]},product_type_keywords:{fasteners:["bolt","cap screw","screw","machine screw","ready rod","all-thread","nut","stover","locknut","jam nut","flange nut","washer","flat washer","lock washer","split lock","rivets","blind rivet","huck","pins","cotter pin","hitch pin","spring pin"],structural_steel:["plate","qt100","qt 100","hss","tube","tubing","pipe","channel","c-channel","c shape","angle","angle iron","flat bar","round bar","square bar","frame rail","rail","decking","t&g","checker plate","floor plate"],lumber:["2x4","2x6","2x8","fir","spf","decking","t&g","tongue and groove","spruce","pine"],trailer_running_gear:["axle","hub","drum","rotor","spindle","bearing","seal","dust cap","spring","leaf spring","equalizer","hanger","shackle","u-bolt","u bolt","torque arm","suspension"],brake_system:["air tank","air brake","hose","air line","synflex","gladhand","slack adjuster","brake shoe","cam","s-cam","valve","relay valve","foot valve","abs","anti lock","chamber","brake kit","anti lock brakes kit"],lighting_electrical:["led","lamp","light","marker","clearance","stop","tail","turn","stt","b/u","backup","license","pigtail","plug","connector","junction box","cable","wire","trailer cable","7-way","7way","4-way","4way","breakaway","battery box","battery"],coupling_jacks:["jack","dropleg","drop leg","sidewind","topwind","jack foot","coupler","ball coupler","lunette","eye coupler","adjustable coupler","pintle","kingpin"],body_components:["fender","fender steps","stake pocket","rub rail","d-ring","tie down","winch","winch track","bumper","step","ladder","toolbox","door latch","hinge","hood catch"],consumables:["grinding wheel","cutting disc","wire wheel","welding rod","mig wire","anti-seize","grease","spray paint","primer","galvanizing spray","shop towels","gloves","zip tie","shrink tube"],fluid_lubricants:["10w30","15w40","gear oil","hydraulic oil","grease","brake cleaner","penetrant","anti-seize","silicone"],documentation_misc:["invoice","po","document holder","registration tube","permit holder","label","tag"]},tire_wheel_keywords:{rim:["wheel rim","steel rim"],"steel rim":["steel wheel","rim steel"],hub_pilot:["hub piloted","piloted wheel"],stud_pilot:["stud piloted"],tire:["tire","tyre"],recycling_fee:["tire recycling","eco fee","environmental fee","tire levy"]},pipe_tube_patterns:{pipe_designation_keywords:["a53","schedule","sch","pipe","nom","nominal"],tube_designation_keywords:["hss","rect tube","square tube","round tube","a500"],common_schedules:["10","20","40","80"],examples:['2" sch 40 pipe',"2in sch40 a53","3 x 2 x 0.250 hss","3x2x1/4 hss"]},dimension_patterns:[{name:"fractional_dia_by_length_inch",description:"Patterns like 3/8X1, 3/8 X 1-1/2, 1/2-13 x 2",regexes:["(?<diameter>\\d+/\\d+|\\d+\\.?\\d*)(?:\\s*[xX-]\\s*)(?<length>\\d+/\\d+|\\d+\\.?\\d*)"],normalized_form:"{diameter} x {length} in"},{name:"nominal_pipe_size_with_schedule",description:'Pipe like 2" SCH 40, 0 2 P 2(nom) X .154 (SCH 40)',regexes:['(?<nominal>\\d+(?:/\\d+)?)\\s*\\"?\\s*(?:NOM|nom)?\\s*(?:X|x)?\\s*(?<wall>\\d*\\.?\\d+)?\\s*\\(?(?:SCH|Sch|schedule)\\s*(?<schedule>10|20|40|80)\\)?'],normalized_form:"{nominal} in pipe SCH {schedule}"},{name:"rectangular_hss",description:"Rectangular hollow section, e.g., 3 X 2 X .250 HSS",regexes:["(?<depth>\\d+\\.?\\d*)\\s*[xX]\\s*(?<width>\\d+\\.?\\d*)\\s*[xX]\\s*(?<thickness>\\d*\\.?\\d+)\\s*(?:HSS|hss)?"],normalized_form:"HSS {depth} x {width} x {thickness}"},{name:"plate_thickness",description:"Plate like 1/4 PL, 3/8 PLATE, .250 PL",regexes:["(?<thickness>\\d+/\\d+|\\d*\\.?\\d+)\\s*(?:PL|plate|PLT)"],normalized_form:"{thickness} in plate"},{name:"ga_thickness",description:"Gauge thickness e.g., 14 GA, 11 GA",regexes:["(?<gauge>\\d+)\\s*(?:GA|ga|gauge)"],normalized_form:"{gauge} gauge"},{name:"lumber_2x",description:"Lumber e.g., 2X6-16, 2x8x12",regexes:["2\\s*[xX]\\s*(?<width>\\d+)\\s*(?:[-xX]\\s*(?<length>\\d+))?"],normalized_form:"2 x {width}{length_ft}",length_ft_suffix:" ft"}],part_number_normalization:{strip_characters:[" ","	",`
`,"\r"],collapse_characters_to_dash:["_","/"],remove_leading_zeros:!0,case:"upper",examples_equivalent:[["01202616A","1202616-A"],["066366630152","66366630152"],["01-117","01117"]]},description_normalization:{to_upper:!0,replace_characters:{"":'"',"":'"',"":"'","":"-","":"x"},collapse_whitespace:!0,remove_punctuation_except:["/","-",'"',"."]},unit_map:{EA:"each",EACH:"each",PC:"each",PCS:"each",FT:"foot",IN:"inch",'"':"inch",MM:"millimeter",CM:"centimeter",M:"meter",PK:"pack",PKG:"package",BG:"bag",SET:"set",LB:"pound",OZ:"ounce",GAL:"gallon",L:"liter"},stopwords:["THE","AND","&","OF","FOR","WITH","W/","IN","ON","OR","TO","BY","EA","EACH","NEW","OLD","ASSY","KIT"],category_inference_rules:[{category:"fasteners",if_description_contains_any:["BOLT","SCREW","NUT","WASHER","RIVET","READY ROD","ALL THREAD","STOVER"]},{category:"structural_steel",if_description_contains_any:["HSS","PLATE","ANGLE","CHANNEL","TUBE","PIPE","FRAME RAIL","QT100","A36","A53","350W","50W"]},{category:"lighting_electrical",if_description_contains_any:["LED","LAMP","LIGHT","MARKER","CLEARANCE","STT","STOP","TAIL","TURN","B/U","BACK UP","JUNCTION BOX","PIGTAIL","CABLE","WIRE"]},{category:"brake_system",if_description_contains_any:["AIR BRAKE","SYNFLEX","GLADHAND","SLACK ADJ","BRAKE SHOE","CAM","ABS","AIR TANK","CHAMBER"]},{category:"trailer_running_gear",if_description_contains_any:["AXLE","HUB","DRUM","SPINDLE","SPRING","EQUALIZER","HANGER","U-BOLT","U BOLT"]},{category:"coupling_jacks",if_description_contains_any:["JACK","DROPLEG","COUPLER","LUNETTE","EYE COUPLER","PINTLE","KINGPIN"]},{category:"tire_wheel",if_description_contains_any:["RIM","WHEEL","TIRE","HUB PILOT","STUD PILOT","STEEL RIM"]},{category:"consumables",if_description_contains_any:["GRINDING WHEEL","CUT OFF","WIRE WHEEL","SPRAY","PAINT","PRIMER","GALVANIZING","GLVS","GLOVES","SHRINK TUBE","ZIP TIE"]}]},Due=new Set((bl.stopwords||[]).map(e=>e.toUpperCase())),bE=e=>(e||"").split(/[^A-Za-z0-9]+/).map(t=>t.trim()).filter(Boolean).map(t=>t.toUpperCase()),Mue=e=>{const t=new Map,r=(a,o)=>{if(!a||!o||a===o)return;const s=a.toUpperCase(),l=o.toUpperCase();t.has(s)||t.set(s,new Set),t.get(s).add(l)},n=a=>{a&&Object.entries(a).forEach(([o,s])=>{const l=Array.isArray(s)?s:[s],c=new Set;bE(o).forEach(d=>c.add(d)),l.forEach(d=>bE(String(d)).forEach(f=>c.add(f)));const u=Array.from(c);u.forEach(d=>u.forEach(f=>r(d,f)))})};return n(e.abbreviation_map),n(e.material_grade_map),n(e.finish_map),n(e.thread_map),n(e.unit_map),t},Lue=Mue(bl),jS=(e,t=bl)=>{if(!e)return"";let r=String(e);const n=t.description_normalization?.replace_characters||{};Object.entries(n).forEach(([s,l])=>{const c=String(s),u=String(l);r=r.split(c).join(u)});const a=[...t.description_normalization?.remove_punctuation_except??[]],o=new RegExp(`[^A-Za-z0-9\\s${a.map(s=>"\\"+s).join("")}]+`,"g");return r=r.replace(o," "),t.description_normalization?.collapse_whitespace&&(r=r.replace(/\s+/g," ")),t.description_normalization?.to_upper&&(r=r.toUpperCase()),r.trim()},rR=(e,t=bl)=>{if(!e)return"";let r=String(e);return[...t.part_number_normalization?.strip_characters??[]].forEach(o=>{const s=new RegExp(o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g");r=r.replace(s,"")}),[...t.part_number_normalization?.collapse_characters_to_dash??[]].forEach(o=>{const s=new RegExp(o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g");r=r.replace(s,"-")}),t.part_number_normalization?.remove_leading_zeros&&(r=r.replace(/(^|[^0-9])0+([0-9]+)/g,"$1$2"),r=r.replace(/^0+/,"")),t.part_number_normalization?.case==="upper"&&(r=r.toUpperCase()),r.trim()},Rue=e=>(e.dimension_patterns||[]).map(t=>({...t,regexes:t.regexes.map(r=>new RegExp(r,"gi"))})),que=Rue(bl),Fue=(e,t)=>{let r=e.normalized_form||"";return r=r.replace(/\{(\w+)\}/g,(n,a)=>t[a]||""),e.length_ft_suffix&&t.length?r=r.replace("{length_ft}",`${t.length}${e.length_ft_suffix}`):r=r.replace("{length_ft}",t.length||""),r.replace(/\s+/g," ").trim().toUpperCase()},nR=e=>{const t=new Set;if(!e)return t;for(const r of que)for(const n of r.regexes){let a;for(;(a=n.exec(e))!==null;){const o=a.groups||{},s=Fue(r,o);s&&t.add(s)}n.lastIndex=0}return t},aR=e=>jS(e).split(/[^A-Z0-9]+/).map(r=>r.trim()).filter(r=>r.length>0&&!Due.has(r)),iR=e=>{const t=new Set;for(const r of e){const n=r.toUpperCase();t.add(n);const a=Lue.get(n);a&&a.forEach(o=>t.add(o))}return t},_E=(e,t)=>{const r=new Set;return e.forEach(n=>{t.has(n)&&r.add(n)}),r},$ue=(e,t=bl)=>{if(!e)return;const r=e.toUpperCase();for(const n of t.category_inference_rules||[])if(n.if_description_contains_any?.some(a=>r.includes(a)))return n.category},Bue=(e,t=bl)=>e.map(r=>{const n=`${r.part_number||""} ${r.part_description||""}`,a=iR(aR(n)),o=nR(n),s=rR(r.part_number||"",t),l=jS(r.part_description||"",t),c=r.category||$ue(l,t);return{item:r,tokenSet:a,dimensionSet:o,normalizedPartNumber:s,normalizedDescription:l,categoryHint:c}}),Bw=e=>{const t=jS(e),r=rR(e),n=aR(e),a=iR(n),o=nR(e);return{normalized:t,normalizedPartNumber:r,tokens:n,expandedTokens:Array.from(a),dimensions:Array.from(o)}},Uue=(e,t)=>{const r=t.trim();if(!r)return[];const{normalized:n,normalizedPartNumber:a,expandedTokens:o,dimensions:s}=Bw(r),l=new Set(o),c=new Set(s),u=[];for(const d of e){const f=_E(d.tokenSet,l),h=_E(d.dimensionSet,c),p=a.length>0&&d.normalizedPartNumber.includes(a),v=n.length>2&&d.normalizedDescription.includes(n);let m=0;if(m+=f.size*2,m+=h.size*3,p&&(m+=5),v&&(m+=2),m>0){const y=d.categoryHint&&(l.has(d.categoryHint.toUpperCase())||n.includes(d.categoryHint.toUpperCase()))?d.categoryHint:void 0;u.push({item:d.item,score:m,matchedTokens:Array.from(f),matchedDimensions:Array.from(h),matchedCategory:y,partNumberMatched:p,descriptionMatched:v})}}return u.sort((d,f)=>f.score-d.score||String(d.item.part_number||"").localeCompare(String(f.item.part_number||"")))},zue=()=>{const[e,t]=x.useState(""),[r,n]=x.useState("all"),[a,o]=x.useState([]),[s,l]=x.useState(!1),[c,u]=x.useState(null),[d,f]=x.useState([]),[h,p]=x.useState(()=>Bw("")),v=x.useMemo(()=>Bue(a),[a]),m=x.useCallback(async()=>{l(!0),u(null);try{const _=await Py(r==="all"?void 0:r);o(_||[])}catch(_){console.error("Failed to load inventory for smart search",_);const w=_?.response?.data?.message||_?.message||"Could not load inventory. Check your connection and try again.";u(w)}finally{l(!1)}},[r]);x.useEffect(()=>{m()},[m]),x.useEffect(()=>{const _=()=>m();return window.addEventListener("inventory-updated",_),()=>window.removeEventListener("inventory-updated",_)},[m]),x.useEffect(()=>{const _=setTimeout(()=>{p(Bw(e)),f(Uue(v,e))},180);return()=>clearTimeout(_)},[e,v]);const y=(_,w,A)=>i.jsxs(dt,{direction:"row",spacing:1,flexWrap:"wrap",alignItems:"center",children:[i.jsx(B,{variant:"caption",color:"text.secondary",sx:{minWidth:120,fontWeight:600},children:_}),w.length===0&&A?i.jsx(B,{variant:"caption",color:"text.disabled",children:A}):w.slice(0,24).map(P=>i.jsx(st,{label:P,size:"small"},`${_}-${P}`))]}),b=x.useMemo(()=>{const _=new Set(h.expandedTokens);return h.tokens.forEach(w=>_.delete(w)),Array.from(_)},[h]);return i.jsxs(Z,{children:[i.jsx(bt,{elevation:0,sx:{p:3,mb:3,borderRadius:3,background:"linear-gradient(120deg, #0f172a, #0b5dab)",color:"white"},children:i.jsxs(dt,{direction:{xs:"column",md:"row"},spacing:2,alignItems:"flex-start",justifyContent:"space-between",children:[i.jsxs(Z,{children:[i.jsxs(dt,{direction:"row",spacing:1,alignItems:"center",mb:1,children:[i.jsx($w,{fontSize:"small"}),i.jsxs(B,{variant:"body2",sx:{letterSpacing:.5},children:["Dictionary-driven search  v",bl.version]})]}),i.jsx(B,{variant:"h4",fontWeight:800,children:"Smart Inventory Search"}),i.jsx(B,{variant:"body1",sx:{opacity:.8,maxWidth:720,mt:1},children:"Find parts using abbreviations, grades, finishes, or full descriptions. The search engine expands synonyms, grades, and dimensions from the truck/trailer fabrication dictionary before matching against your inventory."})]}),i.jsxs(dt,{spacing:1.5,alignItems:{xs:"flex-start",md:"flex-end"},children:[i.jsx(st,{icon:i.jsx(Tue,{}),label:`${a.length} parts indexed`,variant:"filled",color:"default",sx:{bgcolor:"rgba(255,255,255,0.12)",color:"white"}}),i.jsx(st,{icon:i.jsx(Pue,{}),label:`Domain: ${bl.domain}`,variant:"outlined",sx:{borderColor:"rgba(255,255,255,0.4)",color:"white"}})]})]})}),i.jsx(bt,{elevation:1,sx:{p:2.5,mb:2.5,borderRadius:3},children:i.jsxs(dt,{spacing:2,children:[i.jsxs(dt,{direction:{xs:"column",md:"row"},spacing:2,alignItems:{xs:"stretch",md:"center"},children:[i.jsx(Z,{sx:{flex:1,position:"relative"},children:i.jsx(Pe,{fullWidth:!0,value:e,onChange:_=>t(_.target.value),placeholder:'Try "gr8 hex bolt 3/8 x 1 galvanized" or "2in sch40 pipe"',InputProps:{startAdornment:i.jsx(fi,{sx:{mr:1,color:"text.secondary"}})}})}),i.jsxs(dt,{direction:"row",alignItems:"center",spacing:1,children:[i.jsx(Nue,{color:"action"}),i.jsxs(q2,{value:r,exclusive:!0,onChange:(_,w)=>w&&n(w),size:"small",color:"primary",children:[i.jsx(al,{value:"all",children:"All"}),i.jsx(al,{value:"stock",children:"Stock"}),i.jsx(al,{value:"supply",children:"Supply"}),i.jsx(al,{value:"service",children:"Service"})]})]})]}),i.jsx(qn,{}),i.jsxs(dt,{spacing:1,children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",fontWeight:700,children:"How your query is interpreted"}),y("Normalized",h.normalized?[h.normalized]:[],"No query yet"),y("Part # form",h.normalizedPartNumber?[h.normalizedPartNumber]:[],"Waiting for part # text"),y("Tokens",h.tokens,"No tokens extracted"),y("Synonyms added",b,"No synonym expansions yet"),y("Dimensions",h.dimensions,"No dimensional pattern found")]})]})}),c&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:c}),s&&i.jsx(Ed,{sx:{mb:2}}),i.jsx(bt,{elevation:0,sx:{p:2,borderRadius:3,border:"1px solid #e5e7eb",mb:1},children:i.jsxs(dt,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:{xs:"flex-start",sm:"center"},justifyContent:"space-between",children:[i.jsxs(B,{variant:"h6",fontWeight:800,children:["Results ",d.length>0?` ${d.length} matches`:""]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Matching uses abbreviations, finishes, grades, thread types, units, and dimensional patterns from the dictionary."})]})}),d.length===0&&!s?i.jsx(bt,{variant:"outlined",sx:{p:3,borderRadius:3},children:i.jsxs(dt,{direction:"row",spacing:1,alignItems:"center",children:[i.jsx(fi,{color:"action"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:'Start typing to see smart matches. Use abbreviations like "GR8", "UNC", "SCH40", or material names like "A36", "HSS".'})]})}):i.jsx(ie,{container:!0,spacing:2,children:d.map(_=>i.jsx(ie,{item:!0,xs:12,md:6,lg:4,children:i.jsxs(bt,{elevation:1,sx:{p:2,height:"100%",borderRadius:3,border:"1px solid #e5e7eb",display:"flex",flexDirection:"column",gap:1},children:[i.jsxs(dt,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:1,children:[i.jsx(B,{variant:"h6",fontWeight:800,sx:{wordBreak:"break-all"},children:_.item.part_number}),i.jsx(st,{label:`Score ${_.score}`,size:"small",color:"primary"})]}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{minHeight:48},children:_.item.part_description||"No description"}),i.jsxs(dt,{direction:"row",spacing:1,flexWrap:"wrap",children:[_.item.category&&i.jsx(st,{label:_.item.category,size:"small"}),_.item.part_type&&i.jsx(st,{label:_.item.part_type,size:"small",variant:"outlined"}),typeof _.item.quantity_on_hand=="number"&&i.jsx(st,{label:`On hand: ${_.item.quantity_on_hand} ${_.item.unit||""}`.trim(),size:"small",variant:"outlined"}),typeof _.item.last_unit_cost=="number"&&i.jsx(st,{label:`Last cost: ${_.item.last_unit_cost}`,size:"small",variant:"outlined"})]}),i.jsx(qn,{}),i.jsxs(dt,{spacing:.5,children:[i.jsx(B,{variant:"caption",color:"text.secondary",fontWeight:700,children:"Match reasons"}),i.jsxs(dt,{direction:"row",spacing:1,flexWrap:"wrap",children:[_.partNumberMatched&&i.jsx(st,{label:"Part #",size:"small",color:"success",variant:"outlined"}),_.descriptionMatched&&i.jsx(st,{label:"Description",size:"small",color:"success",variant:"outlined"}),_.matchedTokens.slice(0,6).map(w=>i.jsx(st,{label:w,size:"small"},`${_.item.part_number}-tok-${w}`)),_.matchedDimensions.slice(0,4).map(w=>i.jsx(st,{label:w,size:"small",variant:"outlined"},`${_.item.part_number}-dim-${w}`)),_.matchedCategory&&i.jsx(st,{label:`Category: ${_.matchedCategory}`,size:"small",color:"secondary",variant:"outlined"})]})]})]})},_.item.part_number))}),s&&d.length>0&&i.jsx(Z,{display:"flex",justifyContent:"center",mt:2,children:i.jsx(tr,{size:24})})]})},Wue=async()=>(await ve.get("/api/employees")).data,wE=["Admin","Sales and Purchase","Time Tracking","Mobile Time Tracker"],Hue=()=>{const[e,t]=x.useState(""),[r,n]=x.useState(""),[a,o]=x.useState(""),[s,l]=x.useState(""),[c,u]=x.useState("Employee"),[d,f]=x.useState(null),[h,p]=x.useState(null),[v,m]=x.useState([]),[y,b]=x.useState(!0);Tn();const[_,w]=x.useState(null),[A,P]=x.useState(""),[T,E]=x.useState(""),[S,I]=x.useState(""),[W,O]=x.useState(!1);x.useEffect(()=>{D()},[]);const D=async()=>{b(!0);try{const L=await Wue();m(L)}catch{f("Failed to fetch employees.")}finally{b(!1)}},R=async L=>{if(L.preventDefault(),f(null),p(null),a!==s){f("Passwords do not match");return}try{const k=await ve.post("/api/employees",{username:e,email:r,password:a,access_role:c});p(k.data.message),t(""),n(""),o(""),l(""),u("Employee"),D()}catch(k){k instanceof di?f(k.response?.data?.message||"Employee registration failed"):f("An unexpected error occurred")}},F=async L=>{if(window.confirm("Are you sure you want to delete this employee?"))try{await ve.delete(`/api/employees/${L}`),p("Employee deleted successfully"),D()}catch(k){console.error("Error deleting employee:",k),k instanceof di?f(k.response?.data?.message||"Failed to delete employee"):f("An unexpected error occurred")}},z=L=>{w(L),P(L.username),E(L.access_role),I(""),O(!0)},K=()=>{O(!1),w(null),f(null),p(null)},J=async()=>{if(_){f(null),p(null);try{const L={username:A,access_role:T};S&&(L.password=S);const k=await ve.put(`/api/employees/${_.id}`,L);p(k.data.message||"Employee updated successfully"),D(),K()}catch(L){console.error("Error updating employee:",L),L instanceof di?f(L.response?.data?.message||"Failed to update employee"):f("An unexpected error occurred")}}};return y?i.jsxs(rr,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(tr,{}),i.jsx(B,{children:"Loading employees..."})]}):i.jsxs(rr,{component:"main",maxWidth:"md",children:[i.jsxs(Z,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[i.jsxs(bt,{elevation:6,sx:{p:4,width:"100%",borderRadius:2,mb:4},children:[i.jsx(B,{component:"h1",variant:"h5",sx:{mb:3,textAlign:"center"},children:"Register New Employee"}),i.jsxs(Z,{component:"form",onSubmit:R,noValidate:!0,sx:{mt:1},children:[i.jsx(Pe,{margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Username",name:"username",autoComplete:"new-username",value:e,onChange:L=>t(L.target.value)}),i.jsx(Pe,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"new-email",value:r,onChange:L=>n(L.target.value)}),i.jsx(Pe,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Initial Password",type:"password",id:"password",autoComplete:"new-password",value:a,onChange:L=>o(L.target.value)}),i.jsx(Pe,{margin:"normal",required:!0,fullWidth:!0,name:"confirmPassword",label:"Confirm Initial Password",type:"password",id:"confirmPassword",autoComplete:"new-password",value:s,onChange:L=>l(L.target.value)}),i.jsxs(tn,{fullWidth:!0,margin:"normal",children:[i.jsx(ln,{id:"access-role-label",children:"Access Role"}),i.jsx(cn,{labelId:"access-role-label",id:"access-role",value:c,label:"Access Role",onChange:L=>u(L.target.value),children:wE.map(L=>i.jsx(Zt,{value:L,children:L},L))})]}),i.jsx(xe,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},children:"Register Employee"}),d&&i.jsx(Ot,{severity:"error",sx:{mt:2},children:d}),h&&i.jsx(Ot,{severity:"success",sx:{mt:2},children:h})]})]}),i.jsxs(bt,{elevation:6,sx:{p:4,width:"100%",borderRadius:2},children:[i.jsx(B,{component:"h2",variant:"h5",sx:{mb:3,textAlign:"center"},children:"Existing Employees"}),i.jsx(ha,{children:v.map(L=>i.jsx(ja,{secondaryAction:i.jsxs(Z,{children:[i.jsx(xr,{edge:"end","aria-label":"edit",onClick:()=>z(L),sx:{mr:1},children:i.jsx(tu,{})}),i.jsx(xr,{edge:"end","aria-label":"delete",onClick:()=>F(L.id),children:i.jsx(ma,{})})]}),children:i.jsx(Qn,{primary:L.username,secondary:`Email: ${L.email} | Role: ${L.role} | Access: ${L.access_role}`})},L.id))})]})]}),i.jsxs(pr,{open:W,onClose:K,children:[i.jsx(mr,{children:"Edit Employee Roles"}),i.jsxs(gr,{children:[_&&i.jsxs(Z,{component:"form",noValidate:!0,sx:{mt:1},children:[i.jsx(Pe,{margin:"normal",fullWidth:!0,id:"edit-username",label:"Username",value:A,onChange:L=>P(L.target.value),variant:"standard"}),i.jsx(Pe,{margin:"normal",fullWidth:!0,id:"edit-email",label:"Email",value:_.email,InputProps:{readOnly:!0,disableUnderline:!0},variant:"standard"}),i.jsx(Pe,{margin:"normal",fullWidth:!0,id:"edit-password",label:"New Password (leave blank to keep current)",type:"password",value:S,onChange:L=>I(L.target.value),variant:"standard"}),i.jsxs(tn,{fullWidth:!0,margin:"normal",children:[i.jsx(ln,{id:"edit-access-role-label",children:"Access Role"}),i.jsx(cn,{labelId:"edit-access-role-label",id:"edit-access-role",value:T,label:"Access Role",onChange:L=>E(L.target.value),children:wE.map(L=>i.jsx(Zt,{value:L,children:L},L))})]})]}),d&&i.jsx(Ot,{severity:"error",sx:{mt:2},children:d}),h&&i.jsx(Ot,{severity:"success",sx:{mt:2},children:h})]}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:K,children:"Cancel"}),i.jsx(xe,{onClick:J,variant:"contained",color:"primary",children:"Save Changes"})]})]})]})},Vue=()=>{const[e,t]=x.useState([]),[r,n]=x.useState(""),[a,o]=x.useState([]),[s,l]=x.useState(!1),[c,u]=x.useState(!1),[d,f]=x.useState(null),[h,p]=x.useState(""),[v,m]=x.useState(!1),[y,b]=x.useState(!1),[_,w]=x.useState(null),[A,P]=x.useState([]),[T,E]=x.useState([]),[S,I]=x.useState("admin");x.useEffect(()=>{W()},[]),x.useEffect(()=>{S==="admin"?D():r?O(r):o([])},[r,S]);const W=async()=>{try{const k=await ve.get("/api/profile-documents/profiles");t(k.data)}catch(k){console.error("Error fetching profiles:",k),ge.error("Failed to fetch profiles")}},O=async k=>{l(!0);try{const $=await ve.get(`/api/profile-documents/profile/${k}`);o($.data)}catch($){console.error("Error fetching documents:",$),ge.error("Failed to fetch documents")}finally{l(!1)}},D=async()=>{l(!0);try{const $=(await ve.get("/api/profile-documents/all")).data.reduce((C,M)=>{const H=M.id;return C[H]||(C[H]={id:M.id,filename:M.filename,original_filename:M.original_filename,file_size:M.file_size,mime_type:M.mime_type,uploaded_by:M.uploaded_by,uploaded_by_name:M.uploaded_by_name,created_at:M.created_at,visible_to_profiles:[],profile_read_status:{},profile_details:[]}),C[H].visible_to_profiles.push(M.profile_id),C[H].profile_read_status[M.profile_id]=M.has_read,C[H].profile_details.push({profile_id:M.profile_id,profile_name:M.profile_name,has_read:M.has_read,read_at:M.read_at}),C},{}),X=Object.values($);console.log("Grouped documents:",X),o(X)}catch(k){console.error("Error fetching all documents:",k),ge.error("Failed to fetch documents")}finally{l(!1)}},R=k=>{const $=k.target.files?.[0];$&&(f($),h||p($.name))},F=async()=>{if(!d||T.length===0){ge.error("Please select a file and at least one profile");return}m(!0);try{const k=new FormData;k.append("document",d),k.append("customName",h),k.append("visibleToProfiles",JSON.stringify(T)),(await ve.post("/api/profile-documents/upload",k,{headers:{"Content-Type":"multipart/form-data"}})).data.success&&(ge.success("Document uploaded successfully"),u(!1),f(null),p(""),E([]),S==="admin"?D():r&&O(r))}catch(k){console.error("Error uploading document:",k),ge.error(k.response?.data?.error||"Failed to upload document")}finally{m(!1)}},z=async k=>{if(window.confirm("Are you sure you want to delete this document?"))try{await ve.delete(`/api/profile-documents/${k}`),ge.success("Document deleted successfully"),S==="admin"?D():r&&O(r)}catch($){console.error("Error deleting document:",$),ge.error("Failed to delete document")}},K=async k=>{w(k),b(!0);try{const $=await ve.get(`/api/profile-documents/${k.id}/stats`);P($.data)}catch($){console.error("Error fetching document stats:",$),ge.error("Failed to fetch document statistics")}},J=k=>{if(k===0)return"0 Bytes";const $=1024,X=["Bytes","KB","MB","GB"],C=Math.floor(Math.log(k)/Math.log($));return parseFloat((k/Math.pow($,C)).toFixed(2))+" "+X[C]},L=k=>new Date(k).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return i.jsxs(Z,{p:3,children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsx(B,{variant:"h4",component:"h1",children:"Profile Documents Management"}),i.jsxs(Z,{display:"flex",gap:2,alignItems:"center",children:[i.jsxs(tn,{size:"small",sx:{minWidth:120},children:[i.jsx(ln,{children:"View Mode"}),i.jsxs(cn,{value:S,onChange:k=>I(k.target.value),label:"View Mode",children:[i.jsx(Zt,{value:"admin",children:"Admin View"}),i.jsx(Zt,{value:"profile",children:"Profile View"})]})]}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Ev,{}),onClick:()=>u(!0),disabled:S==="profile"&&!r,children:"Upload Document"})]})]}),i.jsxs(ie,{container:!0,spacing:3,children:[S==="profile"&&i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(qr,{children:i.jsxs(Wr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Select Profile"}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Profile"}),i.jsx(cn,{value:r,onChange:k=>n(k.target.value),label:"Profile",children:e.map(k=>i.jsx(Zt,{value:k.id,children:k.name},k.id))})]}),r&&i.jsx(Z,{mt:2,children:i.jsx(B,{variant:"body2",color:"text.secondary",children:e.find(k=>k.id===r)?.email})})]})})}),i.jsx(ie,{item:!0,xs:12,md:S==="profile"?8:12,children:i.jsx(qr,{children:i.jsxs(Wr,{children:[i.jsxs(B,{variant:"h6",gutterBottom:!0,children:["Documents",i.jsx(st,{label:`${a.length} documents`,size:"small",sx:{ml:2}})]}),S==="profile"&&!r?i.jsx(Ot,{severity:"info",children:"Please select a profile to view documents."}):s?i.jsx(Z,{display:"flex",justifyContent:"center",p:3,children:i.jsx(tr,{})}):a.length===0?i.jsx(Ot,{severity:"info",children:S==="admin"?"No documents found.":"No documents found for this profile."}):i.jsx(pa,{children:i.jsxs(Jn,{size:"small",children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{children:"Document Name"}),i.jsx(Ae,{align:"center",children:"Size"}),i.jsx(Ae,{align:"center",children:"Type"}),S==="admin"?i.jsxs(i.Fragment,{children:[i.jsx(Ae,{align:"center",children:"Visible To"}),i.jsx(Ae,{align:"center",children:"Read Status"})]}):i.jsx(Ae,{align:"center",children:"Read Status"}),i.jsx(Ae,{align:"center",children:"Uploaded"}),i.jsx(Ae,{align:"center",children:"Actions"})]})}),i.jsx(ea,{children:a.map(k=>i.jsxs(hr,{children:[i.jsxs(Ae,{children:[i.jsx(B,{variant:"body2",fontWeight:"medium",children:k.original_filename}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:["by ",k.uploaded_by_name]})]}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"body2",children:J(k.file_size)})}),i.jsx(Ae,{align:"center",children:i.jsx(st,{label:k.mime_type.split("/")[1]?.toUpperCase()||"FILE",size:"small",variant:"outlined"})}),S==="admin"?i.jsxs(i.Fragment,{children:[i.jsx(Ae,{align:"center",children:i.jsx(Z,{display:"flex",flexWrap:"wrap",gap:.5,justifyContent:"center",children:k.profile_details&&k.profile_details.length>0?k.profile_details.map($=>i.jsx(st,{label:$.profile_name,size:"small",variant:"outlined",color:"primary"},$.profile_id)):k.visible_to_profiles?.map($=>{const X=e.find(C=>C.id===$);return X?i.jsx(st,{label:X.name,size:"small",variant:"outlined",color:"primary"},$):null})})}),i.jsx(Ae,{align:"center",children:i.jsx(Z,{display:"flex",flexWrap:"wrap",gap:.5,justifyContent:"center",children:k.profile_details&&k.profile_details.length>0?k.profile_details.map($=>i.jsx(st,{label:$.has_read?"Read":"Unread",size:"small",color:$.has_read?"success":"default",icon:$.has_read?i.jsx(jh,{}):i.jsx(Eu,{}),title:`${$.profile_name}: ${$.has_read?"Read":"Unread"}`},$.profile_id)):k.visible_to_profiles?.map($=>{const X=e.find(M=>M.id===$),C=k.profile_read_status?.[$]||!1;return X?i.jsx(st,{label:C?"Read":"Unread",size:"small",color:C?"success":"default",icon:C?i.jsx(jh,{}):i.jsx(Eu,{}),title:`${X.name}: ${C?"Read":"Unread"}`},$):null})})})]}):i.jsx(Ae,{align:"center",children:i.jsx(st,{label:k.profile_read_status?.[r]?"Read":"Unread",size:"small",color:k.profile_read_status?.[r]?"success":"default",icon:k.profile_read_status?.[r]?i.jsx(jh,{}):i.jsx(Eu,{})})}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"body2",children:L(k.created_at)})}),i.jsxs(Ae,{align:"center",children:[i.jsx(xr,{size:"small",onClick:()=>K(k),title:"View Statistics",children:i.jsx(SI,{})}),i.jsx(xr,{size:"small",component:"a",href:`/api/profile-documents/file/${k.id}`,target:"_blank",title:"Download",children:i.jsx(PI,{})}),i.jsx(xr,{size:"small",onClick:()=>z(k.id),title:"Delete",color:"error",children:i.jsx(Id,{})})]})]},k.id))})]})})]})})})]}),i.jsxs(pr,{open:c,onClose:()=>u(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(mr,{children:"Upload Document"}),i.jsx(gr,{children:i.jsxs(Z,{sx:{pt:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Select Profiles"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Choose which profiles can see this document"}),i.jsx(Tp,{children:e.map(k=>i.jsx(ti,{control:i.jsx(Qi,{checked:T.includes(k.id),onChange:$=>{$.target.checked?E([...T,k.id]):E(T.filter(X=>X!==k.id))}}),label:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",children:k.name}),i.jsx(B,{variant:"caption",color:"text.secondary",children:k.email})]})},k.id))}),i.jsx(Pe,{fullWidth:!0,label:"Custom Document Name",value:h,onChange:k=>p(k.target.value),sx:{mb:2,mt:2},helperText:"Leave empty to use original filename"}),i.jsxs(Z,{sx:{mb:2},children:[i.jsx("input",{type:"file",id:"file-upload",onChange:R,style:{display:"none"},accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.gif"}),i.jsx("label",{htmlFor:"file-upload",children:i.jsx(xe,{variant:"outlined",component:"span",startIcon:i.jsx(dg,{}),fullWidth:!0,children:d?d.name:"Select File"})})]}),d&&i.jsxs(Ot,{severity:"info",children:["Selected: ",d.name," (",J(d.size),")"]})]})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:()=>u(!1),disabled:v,children:"Cancel"}),i.jsx(xe,{onClick:F,variant:"contained",disabled:!d||T.length===0||v,startIcon:v?i.jsx(tr,{size:20}):i.jsx(dg,{}),children:v?"Uploading...":"Upload"})]})]}),i.jsxs(pr,{open:y,onClose:()=>b(!1),maxWidth:"md",fullWidth:!0,children:[i.jsxs(mr,{children:["Document Statistics: ",_?.original_filename]}),i.jsx(gr,{children:i.jsxs(Z,{sx:{pt:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Profile Read Status"}),i.jsx(B,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"View which profiles can see this document and their read status:"}),_&&i.jsx(pa,{sx:{mt:2},children:i.jsxs(Jn,{size:"small",children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{children:"Profile"}),i.jsx(Ae,{children:"Email"}),i.jsx(Ae,{align:"center",children:"Read Status"}),i.jsx(Ae,{align:"center",children:"Read At"})]})}),i.jsx(ea,{children:_.visible_to_profiles?.map(k=>{const $=e.find(M=>M.id===k),X=_.profile_read_status?.[k]||!1,C=A.find(M=>M.profile_id===k);return $?i.jsxs(hr,{children:[i.jsx(Ae,{children:i.jsx(B,{variant:"body2",fontWeight:"medium",children:$.name})}),i.jsx(Ae,{children:i.jsx(B,{variant:"body2",color:"text.secondary",children:$.email})}),i.jsx(Ae,{align:"center",children:i.jsx(st,{label:X?"Read":"Unread",size:"small",color:X?"success":"default",icon:X?i.jsx(jh,{}):i.jsx(Eu,{})})}),i.jsx(Ae,{align:"center",children:C?i.jsx(B,{variant:"body2",children:L(C.read_at)}):i.jsx(B,{variant:"body2",color:"text.secondary",children:"-"})})]},k):null})})]})})]})}),i.jsx(jr,{children:i.jsx(xe,{onClick:()=>b(!1),children:"Close"})})]})]})},Gue=()=>{const[e,t]=x.useState([]),[r,n]=x.useState(!0),[a,o]=x.useState(!1),[s,l]=x.useState(!1),[c,u]=x.useState({margin_id:"",cost_lower_bound:"",cost_upper_bound:"",margin_factor:""}),[d,f]=x.useState(null),[h,p]=x.useState({page:0,pageSize:5}),[v,m]=x.useState(""),[y,b]=x.useState(!1),[_,w]=x.useState(""),[A,P]=x.useState(!1),[T,E]=x.useState(""),[S,I]=x.useState(!1),[W,O]=x.useState(""),[D,R]=x.useState(!1),[F,z]=x.useState(""),[K,J]=x.useState(!1),L=async()=>{try{const V=await ve.get("/api/margin-schedule");t(V.data.map(Ge=>({...Ge,id:Ge.margin_id}))),n(!1),f(null)}catch(V){console.error("Error fetching margin schedules:",V),f("Failed to load margin schedules"),ge.error("Failed to load margin schedules"),n(!1)}},k=async()=>{b(!0);try{const V=await ve.get("/api/settings/labour-rate");m(V.data.labour_rate??"")}catch{m("")}finally{b(!1)}},$=async()=>{P(!0);try{const V=await ve.get("/api/settings/overhead-rate");w(V.data.overhead_rate??"")}catch{w("")}finally{P(!1)}},X=async()=>{I(!0);try{const V=await ve.get("/api/settings/supply-rate");E(V.data.supply_rate??"")}catch{E("")}finally{I(!1)}},C=async()=>{R(!0);try{const V=await ve.get("/api/settings/daily-break-start");O(V.data.daily_break_start??"")}catch{O("")}finally{R(!1)}},M=async()=>{J(!0);try{const V=await ve.get("/api/settings/daily-break-end");z(V.data.daily_break_end??"")}catch{z("")}finally{J(!1)}};x.useEffect(()=>{L(),k(),$(),X(),C(),M()},[]);const H=()=>{l(!1),u({margin_id:"",cost_lower_bound:"",cost_upper_bound:"",margin_factor:""}),o(!0)},U=V=>{l(!0),u({margin_id:V.margin_id,cost_lower_bound:String(V.cost_lower_bound),cost_upper_bound:String(V.cost_upper_bound),margin_factor:String(V.margin_factor)}),o(!0)},te=async V=>{if(window.confirm("Are you sure you want to delete this margin schedule?"))try{await ve.delete(`/api/margin-schedule/${V}`),ge.success("Margin schedule deleted successfully"),L()}catch(Ge){console.error("Error deleting margin schedule:",Ge),ge.error("Failed to delete margin schedule")}},le=()=>{o(!1)},oe=V=>{const{name:Ge,value:De}=V.target;u(Fe=>({...Fe,[Ge]:De}))},ae=async V=>{V.preventDefault();try{s?(await ve.put(`/api/margin-schedule/${c.margin_id}`,{cost_lower_bound:parseFloat(c.cost_lower_bound),cost_upper_bound:parseFloat(c.cost_upper_bound),margin_factor:parseFloat(c.margin_factor)}),ge.success("Margin schedule updated successfully")):(await ve.post("/api/margin-schedule",{schedule:[{cost_lower_bound:parseFloat(c.cost_lower_bound),cost_upper_bound:parseFloat(c.cost_upper_bound),margin_factor:parseFloat(c.margin_factor)}]}),ge.success("Margin schedule created successfully")),le(),L()}catch(Ge){console.error("Error saving margin schedule:",Ge),ge.error("Failed to save margin schedule")}},he=async()=>{b(!0);try{await ve.put("/api/settings/labour-rate",{labour_rate:Number(v)}),k()}catch{}finally{b(!1)}},me=async()=>{P(!0);try{await ve.put("/api/settings/overhead-rate",{overhead_rate:Number(_)}),$()}catch{}finally{P(!1)}},Q=async()=>{I(!0);try{await ve.put("/api/settings/supply-rate",{supply_rate:Number(T)}),X(),ge.success("Supply rate updated successfully")}catch{ge.error("Failed to update supply rate")}finally{I(!1)}},G=async()=>{R(!0);try{await ve.put("/api/settings/daily-break-start",{daily_break_start:W}),C(),ge.success("Daily break start time updated successfully")}catch{ge.error("Failed to update daily break start time")}finally{R(!1)}},ee=async()=>{J(!0);try{await ve.put("/api/settings/daily-break-end",{daily_break_end:F}),M(),ge.success("Daily break end time updated successfully")}catch{ge.error("Failed to update daily break end time")}finally{J(!1)}},se=[{field:"margin_id",headerName:"ID",flex:.5,minWidth:60,headerAlign:"center",align:"center"},{field:"cost_lower_bound",headerName:"Cost Lower Bound",flex:1,minWidth:120,type:"number",headerAlign:"center",align:"center"},{field:"cost_upper_bound",headerName:"Cost Upper Bound",flex:1,minWidth:120,type:"number",headerAlign:"center",align:"center"},{field:"margin_factor",headerName:"Margin Factor",flex:1,minWidth:120,type:"number",headerAlign:"center",align:"center"},{field:"actions",headerName:"Actions",width:80,sortable:!1,headerAlign:"center",align:"center",renderCell:V=>i.jsx(xr,{size:"small",color:"error",onClick:Ge=>{Ge.stopPropagation(),te(V.row.margin_id)},children:i.jsx(ma,{})})}];return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Global Variables"}),i.jsxs(dt,{direction:"row",spacing:2,children:[i.jsx(xe,{variant:"contained",onClick:H,startIcon:i.jsx(Va,{}),children:"New Entry"}),i.jsx(xe,{variant:"contained",onClick:L,children:"Refresh"})]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsx(Z,{sx:{p:2},children:i.jsx(Po,{rows:e,columns:se,getRowId:V=>V.id,paginationModel:h,onPaginationModelChange:V=>p(V),pageSizeOptions:[5,10,20],loading:r,disableRowSelectionOnClick:!0,onRowClick:V=>U(V.row),sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"},cursor:"pointer"}})})}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3,p:2},children:i.jsxs(Z,{sx:{display:"flex",gap:4,alignItems:"flex-start"},children:[i.jsxs(Z,{sx:{flex:1},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Labour Hourly Rate"}),i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(Pe,{label:"Hourly Rate ($)",type:"number",value:v,onChange:V=>m(V.target.value===""?"":Number(V.target.value)),disabled:y,InputProps:{startAdornment:i.jsx(sa,{position:"start",children:"$"})},sx:{maxWidth:200}}),i.jsx(xe,{variant:"contained",onClick:he,disabled:y||v==="",children:"Save"})]})]}),i.jsxs(Z,{sx:{flex:1},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Overhead Hourly Rate"}),i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(Pe,{label:"Hourly Rate ($)",type:"number",value:_,onChange:V=>w(V.target.value===""?"":Number(V.target.value)),disabled:A,InputProps:{startAdornment:i.jsx(sa,{position:"start",children:"$"})},sx:{maxWidth:200}}),i.jsx(xe,{variant:"contained",onClick:me,disabled:A||_==="",children:"Save"})]})]}),i.jsxs(Z,{sx:{flex:1},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Supply Percentage"}),i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(Pe,{label:"Percentage (%)",type:"number",value:T,onChange:V=>E(V.target.value===""?"":Number(V.target.value)),disabled:S,InputProps:{endAdornment:i.jsx(sa,{position:"end",children:"%"})},sx:{maxWidth:200}}),i.jsx(xe,{variant:"contained",onClick:Q,disabled:S||T==="",children:"Save"})]})]}),i.jsxs(Z,{sx:{flex:1},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Daily Break Times"}),i.jsxs(Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[i.jsx(Pe,{label:"Break Start (HH:MM)",type:"time",value:W,onChange:V=>O(V.target.value),disabled:D,InputLabelProps:{shrink:!0},sx:{maxWidth:200}}),i.jsx(xe,{variant:"contained",onClick:G,disabled:D||W==="",children:"Save Start"}),i.jsx(Pe,{label:"Break End (HH:MM)",type:"time",value:F,onChange:V=>z(V.target.value),disabled:K,InputLabelProps:{shrink:!0},sx:{maxWidth:200}}),i.jsx(xe,{variant:"contained",onClick:ee,disabled:K||F==="",children:"Save End"})]})]})]})}),i.jsxs(pr,{open:a,onClose:le,children:[i.jsx(mr,{children:s?"Edit Margin Entry":"Add New Margin Entry"}),i.jsx(gr,{children:i.jsxs(dt,{spacing:2,mt:1,children:[i.jsx(Pe,{label:"Cost Lower Bound",name:"cost_lower_bound",value:c.cost_lower_bound,onChange:oe,fullWidth:!0,type:"number"}),i.jsx(Pe,{label:"Cost Upper Bound",name:"cost_upper_bound",value:c.cost_upper_bound,onChange:oe,fullWidth:!0,type:"number"}),i.jsx(Pe,{label:"Margin Factor",name:"margin_factor",value:c.margin_factor,onChange:oe,fullWidth:!0,type:"number"})]})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:le,children:"Cancel"}),i.jsx(xe,{onClick:ae,children:s?"Save Changes":"Add Entry"})]})]})]})};var Xf={},jE;function Yue(){if(jE)return Xf;jE=1;var e=sr();Object.defineProperty(Xf,"__esModule",{value:!0}),Xf.default=void 0;var t=e(cr()),r=lr();return Xf.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),Xf}var Kue=Yue();const ac=Et(Kue);var Jf={},SE;function Que(){if(SE)return Jf;SE=1;var e=sr();Object.defineProperty(Jf,"__esModule",{value:!0}),Jf.default=void 0;var t=e(cr()),r=lr();return Jf.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error"),Jf}var Xue=Que();const qy=Et(Xue);var Zf={},CE;function Jue(){if(CE)return Zf;CE=1;var e=sr();Object.defineProperty(Zf,"__esModule",{value:!0}),Zf.default=void 0;var t=e(cr()),r=lr();return Zf.default=(0,t.default)((0,r.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),Zf}var Zue=Jue();const Uw=Et(Zue);var eh={},AE;function ede(){if(AE)return eh;AE=1;var e=sr();Object.defineProperty(eh,"__esModule",{value:!0}),eh.default=void 0;var t=e(cr()),r=lr();return eh.default=(0,t.default)((0,r.jsx)("path",{d:"M6 2v6h.01L6 8.01 10 12l-4 4 .01.01H6V22h12v-5.99h-.01L18 16l-4-4 4-3.99-.01-.01H18V2zm10 14.5V20H8v-3.5l4-4zm-4-5-4-4V4h8v3.5z"}),"HourglassEmpty"),eh}var tde=ede();const oR=Et(tde);var th={},PE;function rde(){if(PE)return th;PE=1;var e=sr();Object.defineProperty(th,"__esModule",{value:!0}),th.default=void 0;var t=e(cr()),r=lr();return th.default=(0,t.default)((0,r.jsx)("path",{d:"M14.67 5v14H9.33V5zm1 14H21V5h-5.33zm-7.34 0V5H3v14z"}),"ViewColumn"),th}var nde=rde();const zw=Et(nde),ade=e=>{if(typeof e=="string"){const t=e.trim().toLowerCase();if(["needed","need","required","pending"].includes(t))return"needed";if(["done","complete","completed","sent"].includes(t))return"done";if(["true","t","yes","y","1","on"].includes(t))return"needed";if(["false","f","no","n","0","off",""].includes(t))return""}return typeof e=="boolean"&&e?"needed":""},ide=()=>{const[e,t]=x.useState(""),[r,n]=x.useState([]),[a,o]=x.useState("open"),[s,l]=x.useState(0),c=Tn(),u=Ds(),{user:d}=ta(),[f,h]=x.useState(!1),p="openSalesOrders.columnVisibility",[v,m]=x.useState(()=>{if(typeof window>"u")return{};const L=localStorage.getItem(p);if(L)try{return JSON.parse(L)}catch(k){console.warn("Failed to parse column visibility model, resetting to defaults",k)}return{}}),[y,b]=x.useState(null),[_,w]=x.useState([]);x.useEffect(()=>{typeof window<"u"&&localStorage.setItem(p,JSON.stringify(v))},[v]);const A=(L,k)=>{w(k),b(L.currentTarget)},P=()=>b(null),T=i.jsx(Iv,{open:!!y,anchorEl:y,onClose:P,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:i.jsxs(Z,{sx:{p:2,maxWidth:280},children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1.5},children:"Show / Hide Columns"}),i.jsx(Tp,{children:_.filter(L=>L.field!=="actions").map(L=>i.jsx(ti,{control:i.jsx(Qi,{size:"small",checked:v[L.field]!==!1,onChange:k=>m($=>({...$,[L.field]:k.target.checked}))}),label:L.headerName||L.field},L.field))})]})}),[E,S]=x.useState({page:0,pageSize:10}),I=async(L=a)=>{try{const k=d?.access_role==="Sales and Purchase"?"open":L,X=(await ve.get("/api/sales-orders",{params:{status:k,_ts:Date.now()}})).data.sort((M,H)=>{const U=oe=>{const ae=oe.match(/\d+/);return ae?parseInt(ae[0],10):0},te=U(M.sales_order_number);return U(H.sales_order_number)-te}),C=X.map(M=>({...M,id:M.sales_order_id,subtotal:Number(M.subtotal)||0,total_gst_amount:Number(M.total_gst_amount)||0,total_amount:Number(M.total_amount)||0,invoice_status:ade(M.invoice_status??M.invoice_required)}));if(n(C),L==="open"||L==="all"){const H=(L==="open"?X:X.filter(U=>U.status==="Open")).reduce((U,te)=>{const le=parseFloat(te.subtotal)||0;return U+le},0);l(H)}else l(0)}catch(k){console.error("Error fetching sales orders:",k),n([]),l(0)}};x.useEffect(()=>{I(a)},[a,d?.access_role]),x.useEffect(()=>{setTimeout(()=>{I(a)},500)},[u.key]),x.useEffect(()=>{const L=()=>I(a),k=()=>{document.visibilityState==="visible"&&I(a)};return window.addEventListener("focus",L),document.addEventListener("visibilitychange",k),()=>{window.removeEventListener("focus",L),document.removeEventListener("visibilitychange",k)}},[a]);const W=async L=>{if(window.confirm("Are you sure you want to close this Sales Order?"))try{const k=await ve.get(`/api/sales-orders/${L}`),{salesOrder:$,lineItems:X}=k.data,{subtotal:C,total_gst_amount:M,total_amount:H,...U}=$;await ve.put(`/api/sales-orders/${L}`,{...U,status:"Closed",lineItems:(X||[]).map(te=>{const le=String(te.part_number||"").toUpperCase(),oe={part_number:String(te.part_number||""),part_description:String(te.part_description||""),unit:String(te.unit||""),unit_price:le==="SUPPLY"?0:Number(te.unit_price)||0,line_amount:Number(te.line_amount)||0,...te.part_id?{part_id:Number(te.part_id)}:{}};if(le==="SUPPLY")return{...oe,unit:"Each",quantity:1};if(le==="LABOUR"||le==="OVERHEAD"){const ae=Number(te.quantity_sold??te.quantity??0)||0;return{...oe,quantity:ae}}return{...oe,quantity:Number(te.quantity_sold??te.quantity??0)||0}})}),ge.success("Sales Order closed successfully!"),I()}catch(k){console.error("Error closing sales order:",k);let $="Failed to close sales order.";k.response?.data?.error?$=k.response.data.error:k.response?.data?.details?$=k.response.data.details:k.response?.data?.message&&($=k.response.data.message),$.toLowerCase().includes("insufficient inventory")||$.toLowerCase().includes("insufficient quantity")||$.toLowerCase().includes("negative inventory")?ge.error(`Inventory Error: ${$}`):ge.error($)}},O=async L=>{if(window.confirm("Are you sure you want to delete this Sales Order? This action cannot be undone."))try{await ve.delete(`/api/sales-orders/${L}`),ge.success("Sales Order deleted successfully!"),I()}catch(k){console.error("Error deleting sales order:",k),ge.error("Failed to delete sales order.")}},D=e.toLowerCase(),R=r.filter(L=>[L.sales_order_number,L.customer_name,L.product_name,L.product_description,L.unit_number,L.mileage,L.vin_number,L.sales_date?new Date(L.sales_date).toLocaleDateString():"",L.wanted_by_date?new Date(L.wanted_by_date).toLocaleDateString():"",L.wanted_by_time_of_day].filter(k=>k!=null).some(k=>k.toString().toLowerCase().includes(D))),F=[{field:"sales_order_number",headerName:"Sales Order #",flex:1,minWidth:120,valueFormatter:L=>L.value?String(L.value).replace("SO-",""):""},{field:"sales_date",headerName:"Sales Date",flex:.9,minWidth:130,valueFormatter:L=>L.value?new Date(L.value).toLocaleDateString():""},{field:"wanted_by_date",headerName:"Wanted By Date",flex:.9,minWidth:140,valueFormatter:L=>L.value?new Date(L.value).toLocaleDateString():""},{field:"wanted_by_time_of_day",headerName:"Wanted Time",flex:.8,minWidth:120,valueFormatter:L=>L.value?`${String(L.value).charAt(0).toUpperCase()}${String(L.value).slice(1)}`:""},{field:"customer_name",headerName:"Customer",flex:1.3,minWidth:150},{field:"product_name",headerName:"Product Name",flex:1,minWidth:120},{field:"product_description",headerName:"Product Description",flex:1.5,minWidth:150},{field:"unit_number",headerName:"Unit #",flex:.9,minWidth:110},{field:"mileage",headerName:"Mileage",flex:.8,minWidth:100},{field:"vin_number",headerName:"VIN #",flex:1,minWidth:140},{field:"subtotal",headerName:"Subtotal",flex:.8,minWidth:100,valueFormatter:L=>L.value!=null&&!isNaN(Number(L.value))?`$${Number(L.value).toFixed(2)}`:"$0.00"},{field:"total_amount",headerName:"Total",flex:.8,minWidth:100,valueFormatter:L=>L.value!=null&&!isNaN(Number(L.value))?`$${Number(L.value).toFixed(2)}`:"$0.00"},{field:"status",headerName:"Status",flex:.8,minWidth:100,renderCell:L=>i.jsx(st,{label:L.value,color:L.value==="Open"?"success":"error",size:"small",variant:"outlined"})},{field:"invoice_status",headerName:"Invoice",flex:.6,minWidth:90,valueFormatter:L=>L.value==="done"?"Done":L.value==="needed"?"Needed":"",renderCell:L=>L.value==="done"?i.jsx(ac,{color:"success",titleAccess:"Invoice done"}):L.value==="needed"?i.jsx(Uw,{color:"error",titleAccess:"Invoice needed"}):null,sortable:!1},{field:"exported_to_qbo",headerName:"QBO Exported",flex:.8,minWidth:120,renderCell:L=>L.row.exported_to_qbo?i.jsx(ac,{color:"success",titleAccess:"Exported to QuickBooks"}):L.row.qbo_export_status?i.jsx(qy,{color:"error",titleAccess:`QBO Export Error: ${L.row.qbo_export_status}`}):L.row.status==="Closed"?i.jsx(oR,{color:"warning",titleAccess:"Not exported to QuickBooks"}):null},{field:"actions",headerName:"Actions",width:140,sortable:!1,renderCell:L=>i.jsxs(Z,{sx:{display:"flex",gap:.5},children:[L.row.status!=="Closed"&&i.jsx(xr,{size:"small",color:"primary",onClick:k=>{k.stopPropagation(),W(L.row.sales_order_id)},children:i.jsx(oj,{})}),L.row.status!=="Closed"&&i.jsx(xr,{size:"small",color:"error",onClick:k=>{k.stopPropagation(),O(L.row.sales_order_id)},children:i.jsx(ma,{})})]})}],z=()=>{setTimeout(()=>{I()},500)},K=()=>{let L=R;a==="open"?L=R.filter(C=>C.status==="Open"):a==="closed"&&(L=R.filter(C=>C.status==="Closed"));const k=Cl.unparse(L.map(C=>{const M={};return F.forEach(H=>{if(H.field!=="actions"){const U=C[H.field];H.field==="bill_date"||H.field==="sales_date"||H.field==="wanted_by_date"?M[H.headerName]=U?new Date(U).toLocaleDateString():"":H.type==="number"?M[H.headerName]=U!=null&&!isNaN(parseFloat(String(U)))?parseFloat(String(U)).toFixed(2):"":M[H.headerName]=U!==void 0?String(U):""}}),M})),$=new Blob([k],{type:"text/csv;charset=utf-8;"}),X=document.createElement("a");if(X.download!==void 0){const C=URL.createObjectURL($);X.setAttribute("href",C),X.setAttribute("download","open_sales_orders.csv"),X.style.visibility="hidden",document.body.appendChild(X),X.click(),document.body.removeChild(X)}},J=L=>{console.log("OpenSalesOrdersPage: Row clicked:",L.row),console.log("OpenSalesOrdersPage: User role:",d?.access_role),console.log("OpenSalesOrdersPage: Sales order ID:",L.row.sales_order_id);const k=`/open-sales-orders/${L.row.sales_order_id}`;console.log("OpenSalesOrdersPage: Navigating user to:",k),c(k)};return d?.access_role==="Time Tracking"?i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Sales Orders"}),i.jsxs(Z,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:[i.jsx(xe,{variant:"outlined",startIcon:i.jsx(zw,{}),sx:{mr:1},onClick:L=>A(L,F.filter(k=>k.field!=="actions")),children:"Columns"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),sx:{mr:1},onClick:()=>c("/open-sales-orders/new"),children:"New Sales Order"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Es,{}),onClick:z,children:"Refresh"})]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(dt,{direction:"row",spacing:3,sx:{mb:2},children:i.jsx(Pe,{label:"Search",variant:"outlined",value:e,onChange:L=>t(L.target.value),InputProps:{startAdornment:i.jsx(sa,{position:"start",children:i.jsx(fi,{sx:{fontSize:22}})})},sx:{minWidth:340,maxWidth:400,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"small"})}),i.jsx(Po,{rows:R,columns:F.filter(L=>L.field!=="actions"),loading:!1,columnVisibilityModel:v,onColumnVisibilityModelChange:L=>m(L),paginationModel:E,onPaginationModelChange:S,pageSizeOptions:[10,25,50],getRowId:L=>L.id,onRowClick:J,disableRowSelectionOnClick:!0,initialState:{sorting:{sortModel:[{field:"sales_order_number",sort:"desc"}]}},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),T]}):i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:d?.access_role==="Sales and Purchase"?"Sales Orders (Open Only)":"Sales Orders"}),(a==="open"||a==="all")&&i.jsxs(Z,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[i.jsxs(B,{variant:"h6",component:"div",sx:{fontWeight:"bold",color:"primary.main"},children:["Work In Process: $",s.toFixed(2)]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Total subtotal value of all open sales orders"})]}),i.jsx(Z,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:i.jsxs(dt,{direction:"row",spacing:2,children:[d?.access_role!=="Time Tracking"&&i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:()=>c("/open-sales-orders/new"),children:"New SO"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(zw,{}),onClick:L=>A(L,F),children:"Columns"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:K,children:"Export CSV"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Es,{}),onClick:z,children:"Refresh"})]})})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsxs(dt,{direction:"row",spacing:3,sx:{mb:2},children:[i.jsx(Pe,{label:"Search",variant:"outlined",value:e,onChange:L=>t(L.target.value),InputProps:{startAdornment:i.jsx(sa,{position:"start",children:i.jsx(fi,{sx:{fontSize:22}})})},sx:{minWidth:340,maxWidth:400,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"small"}),d?.access_role!=="Sales and Purchase"&&i.jsx(st,{label:"All",onClick:()=>o("all"),color:a==="all"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),i.jsx(st,{label:"Open",onClick:()=>o("open"),color:a==="open"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),d?.access_role!=="Sales and Purchase"&&i.jsx(st,{label:"Closed",onClick:()=>o("closed"),color:a==="closed"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}})]}),i.jsx(Po,{rows:R,columns:F,loading:!1,columnVisibilityModel:v,onColumnVisibilityModelChange:L=>m(L),paginationModel:E,onPaginationModelChange:S,pageSizeOptions:[10,25,50],getRowId:L=>L.id,onRowClick:J,disableRowSelectionOnClick:!0,initialState:{sorting:{sortModel:[{field:"sales_order_number",sort:"desc"}]}},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),T]})};var rh={},OE;function ode(){if(OE)return rh;OE=1;var e=sr();Object.defineProperty(rh,"__esModule",{value:!0}),rh.default=void 0;var t=e(cr()),r=lr();return rh.default=(0,t.default)([(0,r.jsx)("path",{d:"M19.5 3.5 18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2v14H3v3c0 1.66 1.34 3 3 3h12c1.66 0 3-1.34 3-3V2zM19 19c0 .55-.45 1-1 1s-1-.45-1-1v-3H8V5h11z"},"0"),(0,r.jsx)("path",{d:"M9 7h6v2H9zm7 0h2v2h-2zm-7 3h6v2H9zm7 0h2v2h-2z"},"1")],"ReceiptLong"),rh}var sde=ode();const Sv=Et(sde);var nh={},kE;function lde(){if(kE)return nh;kE=1;var e=sr();Object.defineProperty(nh,"__esModule",{value:!0}),nh.default=void 0;var t=e(cr()),r=lr();return nh.default=(0,t.default)((0,r.jsx)("path",{d:"M3 17v2h6v-2zM3 5v2h10V5zm10 16v-2h8v-2h-8v-2h-2v6zM7 9v2H3v2h4v2h2V9zm14 4v-2H11v2zm-6-4h2V7h4V5h-4V3h-2z"}),"Tune"),nh}var cde=lde();const ude=Et(cde),$u=(e,t)=>{const r=parseFloat(String(e))||0,n=parseFloat(String(t))||0;return Math.round(r*n*100)/100},bo=e=>{const t=parseFloat(String(e));return isNaN(t)?0:t},kd={salesOrders:{customerPoNumber:!0,quotedPrice:!0,sourceQuote:!0,vin:!0,unitNumber:!0,vehicleMake:!0,vehicleModel:!0,invoiceStatus:!0,wantedByDate:!0,wantedByTimeOfDay:!0,productDescription:!0,terms:!0,mileage:!0,techStory:!0},invoices:{vin:!0,productDescription:!0,unitNumber:!0,vehicleMake:!0,vehicleModel:!0,mileage:!0,techStory:!0}},TE=e=>{const t=kd,r=(n,a)=>{const o={...a};return!n||typeof n!="object"||Object.keys(a).forEach(s=>{const l=n[s];o[s]=typeof l=="boolean"?l:a[s]}),o};return{salesOrders:r(e?.salesOrders,t.salesOrders),invoices:r(e?.invoices,t.invoices)}},Cv={async fetchSettings(){try{const e=await ve.get("/api/settings/field-visibility");return TE(e.data?.settings)}catch(e){return console.warn("Failed to fetch field visibility settings, using defaults",e),{...kd}}},async updateSettings(e){const t=await ve.put("/api/settings/field-visibility",e);return TE(t.data?.settings)}},sR=async e=>(await ve.get(`/api/customers/${e}/vehicle-history`)).data,cl=e=>(e??"").trim().toUpperCase(),dde=e=>e!=null&&!(typeof e=="string"&&e.trim()===""),lR=e=>{const t=[],r=[],n={},a={},o=new Set,s=new Set;return e.forEach(l=>{const c=cl(l.unit_number),u=cl(l.vin_number);c&&!o.has(c)&&l.unit_number&&(t.push(l.unit_number),o.add(c)),u&&!s.has(u)&&l.vin_number&&(r.push(l.vin_number),s.add(u)),c&&u&&l.unit_number&&l.vin_number&&(n[c]||(n[c]=[]),n[c].some(d=>cl(d)===u)||n[c].push(l.vin_number),a[u]||(a[u]=[]),a[u].some(d=>cl(d)===c)||a[u].push(l.unit_number))}),{units:t,vins:r,unitToVins:n,vinToUnits:a}},cR=(e,t,r)=>{const n=cl(t),a=cl(r),o=e.filter(l=>{const c=cl(l.unit_number),u=cl(l.vin_number);return n&&c!==n||a&&u!==a?!1:!!(n||a)}),s=l=>{const c=o.find(u=>dde(u[l]));return c?c[l]:void 0};return{unit_number:s("unit_number"),vin_number:s("vin_number"),vehicle_make:s("vehicle_make"),vehicle_model:s("vehicle_model"),mileage:s("mileage"),product_name:s("product_name"),product_description:s("product_description")}},Av=cl,Fm=["Each","cm","ft","ft^2","kg","pcs","hr","L"],Cc=5,EE=e=>{if(typeof e=="string"){const t=e.trim().toLowerCase();if(["needed","need","required","pending"].includes(t))return"needed";if(["done","complete","completed","sent"].includes(t))return"done";if(["true","t","yes","y","1","on"].includes(t))return"needed";if(["false","f","no","n","0","off",""].includes(t))return""}return typeof e=="boolean"&&e?"needed":""},Pv=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim().toUpperCase(),fde=(e,t,r=8)=>{const n=Pv(t);if(!n)return e.slice(0,r);const a=e.map(o=>{const s=Pv(o.label);let l=-1;return s.startsWith(n)?l=3:s.split(" ").some(c=>c.startsWith(n))?l=2:s.includes(n)&&(l=1),{opt:o,score:l}}).filter(o=>o.score>=0);return a.sort((o,s)=>s.score-o.score||o.opt.label.localeCompare(s.opt.label)),a.slice(0,r).map(o=>o.opt)},hde=e=>e>=4?3:e===3?4:e===2?6:12,pde=()=>{const{id:e}=Ms(),t=e==="new",r=!!e&&/^\d+$/.test(e),n=Tn(),{user:a}=ta(),o=a?.access_role==="Sales and Purchase",s=a?.access_role==="Time Tracking",[l,c]=x.useState([]),[u,d]=x.useState([]),[f,h]=x.useState([]),[p,v]=x.useState(null),[m,y]=x.useState(null),[b,_]=x.useState(null),[w,A]=x.useState(null),[P,T]=x.useState(""),[E,S]=x.useState(!1),[I,W]=x.useState(null),[O,D]=x.useState(!1),R=x.useRef(null),[F,z]=x.useState([]),[K,J]=x.useState(!1),L=x.useRef(null),[k,$]=x.useState(null),[X,C]=x.useState(""),[M,H]=x.useState(!1),[U,te]=x.useState(null),[le,oe]=x.useState(Rt()),[ae,he]=x.useState(null),[me,Q]=x.useState(""),[G,ee]=x.useState(""),[se,V]=x.useState(""),[Ge,De]=x.useState(""),[Fe,Xe]=x.useState(""),[it,lt]=x.useState(""),[vt,Ye]=x.useState(""),[Ze,We]=x.useState(""),[wt,Nt]=x.useState(""),[kt,Wt]=x.useState(""),[jt,ur]=x.useState(""),$e=x.useCallback((de,pe)=>{Nt(pe??"")},[]),[He,Je]=x.useState(null),[Ue,pt]=x.useState(""),[at,St]=x.useState([]);x.useMemo(()=>at.map(de=>({part_number:de.part_number,part_description:de.part_description,quantity:bo(de.quantity),unit:de.unit,unit_price:de.unit_price})),[at]);const It="salesOrderDetail.fieldVisibility",Yt={...kd.salesOrders},[Sr,Mr]=x.useState(()=>{if(typeof window>"u")return Yt;try{const de=localStorage.getItem(It);if(de){const pe=JSON.parse(de);return{...Yt,...pe}}}catch(de){console.warn("Failed to read sales order field visibility preferences",de)}return Yt}),[nr,Cr]=x.useState(Yt);x.useEffect(()=>{typeof window<"u"&&localStorage.setItem(It,JSON.stringify(Sr))},[Sr]),x.useEffect(()=>{(async()=>{try{const de=await Cv.fetchSettings();Cr(de.salesOrders),Mr(pe=>{const Te={...pe};let ke=!1;return Object.keys(de.salesOrders).forEach(nt=>{!de.salesOrders[nt]&&Te[nt]&&(Te[nt]=!1,ke=!0)}),ke?Te:pe})}catch(de){console.warn("Failed to load admin field visibility defaults; using user preferences",de)}})()},[]);const Dr=x.useMemo(()=>{const de={...Yt};return Object.keys(de).forEach(pe=>{de[pe]=!!(nr[pe]&&Sr[pe])}),s&&(de.quotedPrice=!1,de.invoiceStatus=!1,de.terms=!1),de},[nr,Sr,s]),[fn,Oa]=x.useState(null),En=de=>Oa(de.currentTarget),er=()=>Oa(null),Jr=x.useMemo(()=>s?{partNumber:3,description:3,quantity:1.5,availability:1.5,unit:1.5,unitCost:0,amount:0,actions:1.5}:{partNumber:2.5,description:2.5,quantity:1,availability:1,unit:1,unitCost:1.5,amount:1.5,actions:1},[s]),Vn=x.useMemo(()=>{if(!at||at.length===0)return{subtotal:0,total_gst_amount:0,total_amount:0};const de=at.reduce((ke,nt)=>{const _t=nt.line_amount||0;return ke+_t},0),pe=de*.05,Te=de+pe;return{subtotal:Math.round(de*100)/100,total_gst_amount:Math.round(pe*100)/100,total_amount:Math.round(Te*100)/100}},[at]),In=Vn.subtotal,Yr=Vn.total_gst_amount,Kr=Vn.total_amount,[je,Ve]=x.useState(null),[ot,Oe]=x.useState(!t),[qe,rt]=x.useState(null),[Pt,Kt]=x.useState(null),[ar,kr]=x.useState([]),[rn,Vr]=x.useState(""),[$n,ka]=x.useState(!1),[Ya,to]=x.useState(!1),qi=x.useCallback(de=>JSON.stringify((de||[]).map(pe=>({part_number:(pe.part_number||"").trim(),part_description:(pe.part_description||"").trim(),quantity:bo(pe.quantity),unit:(pe.unit||"").trim(),unit_price:bo(pe.unit_price)})).sort((pe,Te)=>pe.part_number!==Te.part_number?pe.part_number.localeCompare(Te.part_number):pe.quantity-Te.quantity)),[]),Gn=x.useCallback(()=>({customer:w?{id:w.id,label:w.label}:null,product:k?{id:k.id,label:k.label}:null,salesDate:le?le.toISOString():null,wantedByDate:ae?ae.toISOString():null,wantedByTimeOfDay:kt,terms:(G||"").trim(),customerPoNumber:(se||"").trim(),vinNumber:(Ge||"").trim(),unitNumber:(Fe||"").trim(),estimatedCost:He!=null?Number(He):null,vehicleMake:(it||"").trim(),vehicleModel:(vt||"").trim(),mileage:Ze===""?"":Number(Ze),invoiceStatus:wt}),[w,k,le,ae,kt,G,se,Ge,Fe,He,it,vt,Ze,wt]);x.useEffect(()=>{if($n&&rn===""){const de=JSON.stringify({header:Gn(),lineItems:qi(at)});Vr(de)}},[$n,rn,Gn,qi,at]);const hi=x.useMemo(()=>JSON.stringify({header:Gn(),lineItems:qi(at)}),[Gn,qi,at]),ro=!!rn&&rn!==hi&&!Ya,Qe=!!je&&je.status?.toLowerCase()==="closed",[Vt,or]=x.useState([]),[Fr,Er]=x.useState([]),[jn,Lr]=x.useState(null),[ra,bn]=x.useState(null),[Ta,Ea]=x.useState(null),[ni,na]=x.useState(null),[An,Hr]=x.useState(null),[no,ao]=x.useState(null),[io,ji]=x.useState(!1),[oo,pi]=x.useState(null),[Oo,Fi]=x.useState(""),[fs,so]=x.useState(!1),[hs,Ka]=x.useState(null),[lo,ai]=x.useState(""),Bn=Fr.length>0?8+64*Fr.length:0,Yo={p:3,mb:3,border:"1px solid",borderColor:"divider",borderRadius:2,boxShadow:"0 8px 24px rgba(0,0,0,0.06)"},ko={display:"grid",gap:2,gridAutoFlow:"row dense",alignItems:"stretch"},br={...ko,gridTemplateColumns:{xs:"1fr",sm:"repeat(2, minmax(0, 1fr))",md:"2fr 1fr 1fr"}},Al={...ko,gridTemplateColumns:{xs:"1fr",sm:"repeat(2, minmax(0, 1fr))",md:"repeat(3, minmax(0, 1fr))",lg:"1.2fr repeat(4, minmax(0, 1fr))"}},fc={...ko,gridTemplateColumns:{xs:"1fr",sm:"repeat(2, minmax(0, 1fr))",md:"repeat(3, minmax(0, 1fr))"}},Si=x.useCallback((de,pe)=>{const Te={},ke=de??Fe,nt=pe??Ge;if(de!==void 0&&(Te.unit=de),pe!==void 0&&(Te.vin=pe),F.length&&(ke||nt)){const _t=cR(F,ke,nt);_t.unit_number&&(Te.unit=_t.unit_number),_t.vin_number&&(Te.vin=_t.vin_number),_t.vehicle_make&&(Te.make=_t.vehicle_make),_t.vehicle_model&&(Te.model=_t.vehicle_model);const Bt=_t.mileage;if(Bt!=null&&String(Bt)!==""){const Dt=Number(Bt);Te.mileage=Number.isFinite(Dt)?Dt:Bt}}Te.unit!==void 0&&Xe(Te.unit),Te.vin!==void 0&&De(Te.vin),Te.make!==void 0&&lt(Te.make),Te.model!==void 0&&Ye(Te.model),Te.mileage!==void 0&&We(Te.mileage)},[Fe,F,Ge]),Fs=!!(w?.id||je?.customer_id);x.useMemo(()=>JSON.stringify(at.map(de=>({part_number:de.part_number,part_description:de.part_description,quantity:de.quantity,unit:de.unit,unit_price:de.unit_price,line_amount:de.line_amount}))),[at]);const{units:Ci,vins:Ko,unitToVins:ii,vinToUnits:$i}=x.useMemo(()=>lR(F),[F]),hc=x.useMemo(()=>{const de=Av(Fe);return de&&ii[de]?ii[de]:Ko},[Fe,ii,Ko]),$s=x.useMemo(()=>{const de=Av(Ge);return de&&$i[de]?$i[de]:Ci},[Ci,Ge,$i]),co=x.useMemo(()=>{const de={};for(const pe of f||[])pe?.part_number&&(de[String(pe.part_number)]=pe.part_description||"");return de},[f]),To=x.useCallback((de,pe,Te=!1)=>{const ke=(pe.inputValue||"").toUpperCase(),nt=50,_t=[];for(const Dt of de){const dr=String(Dt).toUpperCase(),Kn=(co[Dt]||"").toUpperCase();if((!ke||dr.includes(ke)||Kn.includes(ke))&&(_t.push(Dt),_t.length>=nt))break}const Bt=_t.some(Dt=>String(typeof Dt=="string"?Dt:Dt?.label||"").toUpperCase()===ke);return Te&&ke&&!Bt&&_t.push({label:`Add "${pe.inputValue}" as New Part`,isNew:!0,inputValue:pe.inputValue}),_t},[co]),Eo=(de,pe)=>{const Te=(at[de]?.part_number||"").trim(),ke=pe.key==="Enter",nt=pe.key==="Tab",_t=pe.key==="Escape",Bt=pe.key==="ArrowDown"||pe.key==="ArrowUp";if(_t){bn(null);return}if(Bt){pe.key==="ArrowDown"&&ra!==de&&bn(de);return}if(!(ra===de&&(ke||nt))&&(ke||nt)&&Te){if(ke&&pe.ctrlKey){pe.preventDefault(),na(de),Fi(Te.toUpperCase()),pi(de),ji(!0),bn(null);return}!f.find(dr=>dr.part_number.toUpperCase()===Te.toUpperCase())&&ke&&(pe.preventDefault(),na(de),Fi(Te.toUpperCase()),pi(de),ji(!0),bn(null))}},Pl=(de,pe)=>{const Te=(ar[de]?.part_number||"").trim(),ke=pe.key==="Enter",nt=pe.key==="Tab",_t=pe.key==="Escape",Bt=pe.key==="ArrowDown"||pe.key==="ArrowUp";if(_t){Hr(null);return}if(Bt){pe.key==="ArrowDown"&&An!==de&&Hr(de);return}if(!(An===de&&(ke||nt))&&(ke||nt)&&Te){if(ke&&pe.ctrlKey){pe.preventDefault(),ao(de),ai(Te.toUpperCase()),Ka(de),so(!0),Hr(null);return}!f.find(dr=>dr.part_number.toUpperCase()===Te.toUpperCase())&&ke&&(pe.preventDefault(),ao(de),ai(Te.toUpperCase()),Ka(de),so(!0),Hr(null))}},Ai=de=>l.find(pe=>Pv(pe.label)===Pv(de))||null,[Bs,Bi]=x.useState(!1),[Us,be]=x.useState(""),[we,Ee]=x.useState(!1),[Me,Ne]=x.useState(""),[mt,Tt]=x.useState(!1),[Lt,Ar]=x.useState([]),[zr,hn]=x.useState(null),[aa,Yn]=x.useState(!1),[Pi,oi]=x.useState(!1),[Ia,Fa]=x.useState(null),[Ui,uo]=x.useState(null),[Io,Oi]=x.useState(!1),[zi,Wi]=x.useState(!1),[ps,si]=x.useState(null);x.useEffect(()=>{(async()=>{try{const[de,pe,Te]=await Promise.all([ve.get("/api/customers"),ve.get("/api/products"),ve.get("/api/inventory")]);c(de.data.map(ke=>({label:ke.customer_name,id:ke.customer_id}))),d(pe.data.map(ke=>({label:ke.product_name,id:ke.product_id,description:ke.product_description}))),h(Te.data),t&&ka(!0)}catch(de){console.error("Prefetch failed",de)}})()},[]),x.useEffect(()=>{(async()=>{try{const[de,pe,Te]=await Promise.all([ve.get("/api/settings/labour-rate").catch(()=>({data:{labour_rate:null}})),ve.get("/api/settings/overhead-rate").catch(()=>({data:{overhead_rate:null}})),ve.get("/api/settings/supply-rate").catch(()=>({data:{supply_rate:null}}))]);v(de.data.labour_rate??null),y(pe.data.overhead_rate??null),_(Te.data.supply_rate??null)}catch{}})()},[]);const pc=x.useCallback(async()=>{if(!(zi||l.length>0)){Wi(!0);try{const de=await ve.get("/api/customers");c(de.data.map(pe=>({label:pe.customer_name,id:pe.customer_id})))}catch(de){console.error("Failed to reload customers",de)}finally{Wi(!1)}}},[l.length,zi]),N=x.useCallback(async de=>{if(!de){z([]),L.current=null;return}if(!(L.current===de&&F.length)){L.current=de,J(!0);try{const Te=[...(await sR(de)).records||[]].sort((ke,nt)=>{const _t=ke.activity_date?new Date(ke.activity_date).getTime():0;return(nt.activity_date?new Date(nt.activity_date).getTime():0)-_t});z(Te)}catch(pe){console.error("Failed to load vehicle history for customer",pe),z([])}finally{J(!1)}}},[F.length]);x.useEffect(()=>{if(!e||t||!r){t&&(St([{part_number:"",part_description:"",quantity:"",unit:Fm[0],unit_price:0,gst:Cc,line_amount:0}]),ka(!0),pt(""),ur(""));return}(async()=>{Oe(!0),rt(null);try{const pe=(await ve.get(`/api/sales-orders/${e}`)).data,Te=EE(pe.salesOrder?.invoice_status??pe.salesOrder?.invoice_required);Ve(pe.salesOrder?{...pe.salesOrder,invoice_status:Te||null}:null),pt(pe.salesOrder?.source_quote_number||"");const ke=(pe.lineItems||pe.salesOrder?.line_items||[]).map(dr=>({part_number:dr.part_number,part_description:dr.part_description,unit:dr.unit,unit_price:dr.unit_price,line_amount:Number(dr.line_amount||0),quantity:dr.part_number==="SUPPLY"?"1":["LABOUR","OVERHEAD"].includes(dr.part_number)?String(dr.quantity_sold||0):String(dr.quantity_sold??dr.quantity??0),gst:Cc,part_id:dr.part_id??void 0}));console.log("[SalesOrderDetail] Raw line items from backend:",pe.lineItems),console.log("[SalesOrderDetail] Mapped line items:",ke),St(ke),or(ke);const nt=(pe.partsToOrder||[]).map(dr=>({sales_order_id:parseInt(e),part_number:dr.part_number,part_description:dr.part_description,quantity_to_order:String(dr.quantity_needed||0),unit:dr.unit||"Each",unit_price:Number(dr.unit_price||0),line_amount:Number(dr.line_amount||0)}));kr(nt),oe(Rt(pe.salesOrder?.sales_date)),he(pe.salesOrder?.wanted_by_date?Rt(pe.salesOrder?.wanted_by_date):null);const _t=pe.salesOrder?.wanted_by_time_of_day?String(pe.salesOrder.wanted_by_time_of_day).toLowerCase():"";Wt(_t||""),Je(pe.salesOrder?.estimated_cost||0),Q(pe.salesOrder?.product_description||""),ee(pe.salesOrder?.terms||""),V(pe.salesOrder?.customer_po_number||""),De(pe.salesOrder?.vin_number||""),Xe(pe.salesOrder?.unit_number||""),We(pe.salesOrder?.mileage===null||pe.salesOrder?.mileage===void 0?"":Number(pe.salesOrder.mileage)),lt(pe.salesOrder?.vehicle_make||""),Ye(pe.salesOrder?.vehicle_model||""),Nt(Te),ur(pe.salesOrder?.tech_story||"");const Bt=l.find(dr=>dr.id===pe.salesOrder?.customer_id)||{label:pe.salesOrder?.customer_name||"",id:pe.salesOrder?.customer_id};A(Bt?.id?Bt:null);const Dt=u.find(dr=>dr.label===pe.salesOrder?.product_name)||{label:pe.salesOrder?.product_name||""};$(Dt?.label?Dt:null)}catch(de){console.error(de),rt(de?.response?.status===404?"Sales order not found. It may have been deleted.":"Failed to load sales order data. Please try again.")}finally{Oe(!1),ka(!0)}})()},[e,t,r]),x.useEffect(()=>{const de=w?.id??je?.customer_id??null;N(de?Number(de):null)},[w?.id,N,je?.customer_id]),x.useEffect(()=>{$n&&p!==null&&St(de=>de.map(pe=>pe.part_number!=="LABOUR"?pe:pe.unit_price!==p?{...pe,unit_price:p}:pe))},[p,$n]),x.useEffect(()=>{$n&&m!==null&&St(de=>de.map(pe=>pe.part_number!=="OVERHEAD"?pe:pe.unit_price!==m?{...pe,unit_price:m}:pe))},[m,$n]),x.useEffect(()=>{$n&&St(de=>{const pe=de.some(ke=>ke.part_number==="LABOUR"),Te=de.some(ke=>ke.part_number==="SUPPLY");if(b&&b>0){if(pe&&!Te)return[...de,{part_number:"SUPPLY",part_description:"Supply",quantity:t?"":"1",unit:t?"":"Each",unit_price:0,gst:Cc,line_amount:0}];if(!pe&&Te)return de.filter(ke=>ke.part_number!=="SUPPLY")}else if(Te)return de.filter(ke=>ke.part_number!=="SUPPLY");return de})},[b,at,$n,t]),x.useEffect(()=>{$n&&(!f||f.length===0||!at||at.length===0||St(de=>{let pe=!1;const Te=de.map(ke=>{if(["LABOUR","OVERHEAD","SUPPLY"].includes(ke.part_number))return ke;const nt=(f||[]).find(Hi=>String(Hi.part_number).trim().toUpperCase()===String(ke.part_number).trim().toUpperCase());if(!nt)return ke;const _t=String(nt.unit||"").trim(),Bt=String(ke.unit||"").trim(),Dt=String(nt.part_description||""),Kn=parseFloat(String(nt.last_unit_cost))||0;let va=ke;return _t&&_t!==Bt&&(va={...va,unit:_t},pe=!0),Dt&&Dt!==ke.part_description&&(va={...va,part_description:Dt},pe=!0),!isNaN(Kn)&&Kn!==ke.unit_price&&(va={...va,unit_price:Kn},pe=!0),va});return pe?Te:de}))},[$n,f,at]);const ne=de=>f.find(pe=>pe.part_number===de),Se=(de,pe)=>{St(Te=>{const ke=[...Te];if(!pe||pe.trim()==="")ke[de]={...ke[de],part_number:"",part_description:"",quantity:"",unit:Fm[0],unit_price:0,line_amount:0};else if(pe.toUpperCase()==="LABOUR")ke[de]={...ke[de],part_number:"LABOUR",part_description:"Labour",unit:"hr",unit_price:p??0,line_amount:0};else if(pe.toUpperCase()==="OVERHEAD")ke[de]={...ke[de],part_number:"OVERHEAD",part_description:"Overhead",unit:"hr",unit_price:m??0,line_amount:0};else if(pe.toUpperCase()==="SUPPLY")ke[de]={...ke[de],part_number:"SUPPLY",part_description:"Supply",unit:t?"":"Each",unit_price:0,line_amount:0};else{const nt=ne(pe);if(nt){const Bt=parseFloat(String(nt.last_unit_cost))||0,Dt=bo(ke[de]?.quantity),dr=$u(Dt,Bt);ke[de]={...ke[de],part_number:pe,part_description:nt.part_description||"",unit:nt.unit,unit_price:Bt,line_amount:dr}}else ke[de]={...ke[de],part_number:pe,part_description:"Part not found",unit_price:0,line_amount:0}}return ke})},Ie=(de,pe,Te)=>{St(ke=>{const nt=[...ke],_t={...nt[de],[pe]:Te};if(parseFloat(Te)<=0&&_t.part_number!=="SUPPLY")return nt.filter((Bt,Dt)=>Dt!==de);if(["LABOUR","OVERHEAD"].includes(_t.part_number))return nt[de]=_t,nt;{const Bt=bo(_t.quantity),Dt=bo(_t.unit_price);_t.line_amount=$u(Bt,Dt)}return nt[de]=_t,nt})},Ke=()=>{St(de=>[...de,{part_number:"",part_description:"",quantity:"",unit:Fm[0],unit_price:0,gst:Cc,line_amount:0}])},ft=de=>{St(pe=>pe.filter((Te,ke)=>ke!==de))},At=(de,pe)=>{if(["LABOUR","OVERHEAD","SUPPLY"].includes(de.part_number))return null;const Te=f.find(Kn=>Kn.part_number.toLowerCase()===de.part_number.toLowerCase());if(!Te||Te.part_type==="supply")return null;const ke=parseFloat(Te.quantity_on_hand)||0;if(t){const Kn=at.filter(Hi=>Hi.part_number.toLowerCase()===de.part_number.toLowerCase()).reduce((Hi,Ws)=>Hi+(parseFloat(String(Ws.quantity).replace(/[^\d.-]/g,""))||0),0),va=ke-Kn;return{available:va<0?Math.floor(va):Math.round(va),isNegative:va<0,currentStock:ke,changeInQuantity:Kn,totalQuantityForPart:Kn,totalOriginalQuantityForPart:0}}const nt=at.filter(Kn=>Kn.part_number.toLowerCase()===de.part_number.toLowerCase()).reduce((Kn,va)=>Kn+(parseFloat(String(va.quantity).replace(/[^\d.-]/g,""))||0),0),_t=Vt.filter(Kn=>Kn.part_number.toLowerCase()===de.part_number.toLowerCase()).reduce((Kn,va)=>Kn+(parseFloat(String(va.quantity).replace(/[^\d.-]/g,""))||0),0),Bt=nt-_t,Dt=ke-Bt,dr=Dt<0?Math.floor(Dt):Math.round(Dt);return{available:dr,isNegative:dr<0,currentStock:ke,changeInQuantity:Bt,totalQuantityForPart:nt,totalOriginalQuantityForPart:_t}},zt=x.useMemo(()=>at.map((de,pe)=>At(de)),[at,f,Vt,t]);x.useEffect(()=>{if(t)return;const de=[];at.forEach((pe,Te)=>{const ke=At(pe);ke&&ke.available<0&&de.push({lineItemIndex:Te,partNumber:pe.part_number,partDescription:pe.part_description,excessQuantity:Math.abs(ke.available),unit:pe.unit})}),Er(de)},[at,f,t]);const ir=()=>{if(at.filter(ke=>!ke.part_number||ke.part_number.trim()==="").length>0)return ge.error("Line items with blank part numbers are not allowed."),!1;const pe=at.filter(ke=>{if(["LABOUR","OVERHEAD","SUPPLY"].includes(String(ke.part_number).toUpperCase()))return!1;const nt=ke.part_id;if(nt){const Bt=(f||[]).find(Dt=>Dt.part_id===nt);return Bt?Bt.part_type==="supply":!1}const _t=(f||[]).find(Bt=>String(Bt.part_number).toUpperCase()===String(ke.part_number).trim().toUpperCase());return!_t||_t.part_type==="supply"});if(pe.length>0){const ke=pe.map(nt=>nt.part_number).join(", ");return ge.error(`Invalid or supply parts (not allowed): ${ke}`),!1}return at.some((ke,nt)=>{const _t=At(ke);return _t&&_t.available<0})?(si("Insufficient inventory for one or more parts."),!1):(si(null),!0)},Ir=de=>{const pe=de.reduce((Te,ke)=>{const nt=ke.part_number.trim().toLowerCase();if(!Te[nt]){const _t=["LABOUR","OVERHEAD","SUPPLY"].includes(ke.part_number.toUpperCase())?null:(f||[]).find(Bt=>String(Bt.part_number).toUpperCase()===ke.part_number.trim().toUpperCase());Te[nt]={part_number:ke.part_number.trim(),part_description:ke.part_description.trim(),unit:ke.unit.trim(),unit_price:ke.unit_price!=null?Number(ke.unit_price):0,line_amount:0,quantity_sold:0,...ke.part_id?{part_id:ke.part_id}:_t&&_t.part_id?{part_id:_t.part_id}:{}}}if(ke.part_number.toUpperCase()==="SUPPLY")Te[nt].quantity_sold=1,Te[nt].unit="Each",Te[nt].unit_price=0,Te[nt].line_amount+=Number(ke.line_amount||0);else if(["LABOUR","OVERHEAD"].includes(ke.part_number.toUpperCase())){const _t=parseFloat(String(ke.quantity).replace(/[^\d.-]/g,""))||0;Te[nt].quantity_sold=_t,Te[nt].line_amount=Number(ke.line_amount||0)}else{const _t=parseFloat(String(ke.quantity).replace(/[^\d.-]/g,""))||0,Bt=Number.isFinite(_t)?_t:0;Te[nt].quantity_sold+=Bt,Te[nt].line_amount+=Bt*(ke.unit_price||0)}return Te},{});return Object.values(pe)},Pr=async()=>{if(!w||!le||!k){ge.error("Please fill in required fields.");return}if(!ir())return;const de={customer_id:w?.id,sales_date:le?le.toISOString():new Date().toISOString(),wanted_by_date:ae?ae.format("YYYY-MM-DD"):null,wanted_by_time_of_day:kt||null,product_name:k?.label?.trim(),product_description:me.trim(),terms:G.trim(),customer_po_number:se.trim(),vin_number:Ge.trim(),unit_number:Fe.trim(),vehicle_make:it.trim(),vehicle_model:vt.trim(),mileage:Ze===""?null:Number(Ze),invoice_status:wt||null,status:t?"Open":je?.status||"Open",estimated_cost:He!=null?Number(He):0,lineItems:Ir(at),source_quote_number:Ue?.trim()||null,tech_story:jt?.trim()||null};to(!0);try{if(t){if(window.__soCreateInFlight){console.log("[SO] Skipping duplicate create (in flight)");return}window.__soCreateInFlight=!0;const pe=await ve.post("/api/sales-orders",de);ge.success("Sales Order created successfully!"),window.__unsavedGuardAllowNext=!0,n(`/open-sales-orders/${pe.data.sales_order_id}`)}else{const pe=ar.filter(Te=>Te.part_number&&parseFloat(String(Te.quantity_to_order))>0).map(Te=>({sales_order_id:Number(e),part_number:Te.part_number.trim(),part_description:Te.part_description.trim(),quantity_needed:parseFloat(String(Te.quantity_to_order))||0,unit:Te.unit.trim(),unit_price:Te.unit_price,line_amount:Te.line_amount}));await ve.put(`/api/sales-orders/${e}`,{...de,partsToOrder:pe}),Kt("Sales Order updated successfully!"),setTimeout(()=>{window.__unsavedGuardAllowNext=!0},100),Vr(JSON.stringify({header:Gn(),lineItems:at,quantityToOrderItems:ar}));try{const[Te,ke]=await Promise.all([ve.get(`/api/sales-orders/${e}`),ve.get("/api/inventory")]),nt=Te.data,_t=EE(nt.salesOrder?.invoice_status??nt.salesOrder?.invoice_required);Ve(nt.salesOrder?{...nt.salesOrder,invoice_status:_t||null}:null),Nt(_t),pt(nt.salesOrder?.source_quote_number||""),Xe(nt.salesOrder?.unit_number||""),We(nt.salesOrder?.mileage===null||nt.salesOrder?.mileage===void 0?"":Number(nt.salesOrder.mileage));const Bt=(nt.lineItems||nt.salesOrder?.line_items||[]).map(Dt=>({part_number:Dt.part_number,part_description:Dt.part_description,unit:Dt.unit,unit_price:Dt.unit_price,line_amount:Number(Dt.line_amount||0),quantity:Dt.part_number==="SUPPLY"?"1":["LABOUR","OVERHEAD"].includes(Dt.part_number)?String(Dt.quantity_sold||0):String(Dt.quantity_sold??Dt.quantity??0),gst:Cc,part_id:Dt.part_id??void 0}));St(Bt),or(Bt),h(ke.data)}catch{}}}catch(pe){const Te=pe?.response?.data?.error||pe?.response?.data?.details||pe?.response?.data?.message||"Failed to save sales order.";si(Te)}finally{to(!1),window.__soCreateInFlight=!1}},Qr=async()=>{if(t||!je)return;const de=at.filter(pe=>!["LABOUR","OVERHEAD","SUPPLY"].includes(pe.part_number)&&(parseFloat(String(pe.quantity).replace(/[^\d.-]/g,""))||0)===0);if(de.length>0){ge.error(`Cannot close: line items with 0 quantity: ${de.map(pe=>pe.part_number).join(", ")}`);return}if(ar.some(pe=>parseFloat(String(pe.quantity_to_order))>0)){const pe=ar.filter(Te=>parseFloat(String(Te.quantity_to_order))>0).map(Te=>`${Te.part_number} (${Te.quantity_to_order})`).join(", ");ge.error(`Cannot close: parts still need to be ordered: ${pe}`);return}try{await ve.put(`/api/sales-orders/${je.sales_order_id}`,{customer_id:je.customer_id,sales_date:je.sales_date,product_name:k?.label?.trim()||je.product_name,product_description:me.trim(),terms:G.trim(),unit_number:Fe.trim()||je.unit_number,status:"Closed",estimated_cost:He??je.estimated_cost,lineItems:Ir(at)}),ge.success("Sales Order closed successfully!"),Ve(pe=>pe&&{...pe,status:"Closed"})}catch(pe){const Te=pe?.response?.data?.error||pe?.response?.data?.details||pe?.response?.data?.message||"Failed to close sales order.";si(Te)}},Nn=async()=>{if(!(t||!je))try{await ve.put(`/api/sales-orders/${je.sales_order_id}`,{customer_id:je.customer_id,sales_date:je.sales_date,product_name:k?.label?.trim()||je.product_name,product_description:me.trim(),terms:G.trim(),unit_number:Fe.trim()||je.unit_number,status:"Open",estimated_cost:He??je.estimated_cost,lineItems:Ir(at)}),ge.success("Sales Order reopened successfully!"),Ve(de=>de&&{...de,status:"Open"}),n(`/open-sales-orders/${je.sales_order_id}`)}catch(de){const pe=de?.response?.data?.error||de?.response?.data?.details||de?.response?.data?.message||"Failed to reopen sales order.";si(pe)}},Un=async()=>{if(t)return await(async()=>(await Pr(),!0))(),void 0;if(je)try{je.status?.toLowerCase()!=="closed"&&await Pr();const de=Object.entries(Dr).filter(([,nt])=>nt).map(([nt])=>nt).join(","),pe=await ve.get(`/api/sales-orders/${je.sales_order_id}/pdf`,{responseType:"blob",params:{visibleFields:de}}),Te=window.URL.createObjectURL(new Blob([pe.data],{type:"application/pdf"})),ke=document.createElement("a");ke.href=Te,ke.download=`sales_order_${je.sales_order_number}.pdf`,document.body.appendChild(ke),ke.click(),ke.remove(),window.URL.revokeObjectURL(Te),ge.success(je.status?.toLowerCase()==="closed"?"PDF downloaded.":"Saved and downloaded PDF.")}catch(de){const pe=de?.response?.data?.error||de?.response?.data?.details||de?.response?.data?.message||"Failed to save or download PDF.";si(pe)}},ia=async()=>{if(je){Oi(!0);try{const de=await ve.post(`/api/invoices/from-sales-order/${je.sales_order_id}`),pe=de.data?.invoice_id||de.data?.id||de.data?.invoice?.invoice_id;ge.success("Invoice created from this sales order"),pe&&n(`/invoices/${pe}`),Ve(Te=>Te&&{...Te,invoice_status:"done"})}catch(de){console.error("Failed to create invoice",de);const pe=de?.response?.data?.error||"Failed to create invoice";ge.error(pe)}finally{Oi(!1)}}},$a=async()=>{if(!(t||!je)){if(ar.some(de=>parseFloat(String(de.quantity_to_order))>0)){const de=ar.filter(pe=>parseFloat(String(pe.quantity_to_order))>0).map(pe=>`${pe.part_number} (${pe.quantity_to_order})`).join(", ");ge.error(`Cannot export to QuickBooks: parts to order exist: ${de}`);return}oi(!0),Fa(null),uo(null);try{const de=await ve.post(`/api/sales-orders/${je.sales_order_id}/export-to-qbo`);uo("Sales Order exported to QuickBooks successfully!"),Ve(pe=>pe&&{...pe,exported_to_qbo:!0,qbo_invoice_id:de.data.qbo_invoice_id,qbo_export_date:new Date().toISOString(),qbo_export_status:"Success"}),ge.success("Exported to QuickBooks.")}catch(de){const pe=de?.response?.data;if(pe?.error==="CUSTOMER_NOT_FOUND")if(window.confirm(`Customer '${pe.customerName}' does not exist in QuickBooks.
Create it and export the Sales Order?`))try{const ke=await ve.post(`/api/sales-orders/${je.sales_order_id}/export-to-qbo-with-customer`,{customerData:pe.customerData});ge.success("Customer created and Sales Order exported."),uo("Customer created and Sales Order exported."),Ve(nt=>nt&&{...nt,exported_to_qbo:!0,qbo_invoice_id:ke.data.qbo_invoice_id,qbo_export_date:new Date().toISOString(),qbo_export_status:"Success"})}catch(ke){const nt=ke?.response?.data?.error||"Failed to create customer and export to QuickBooks.";Fa(nt),ge.error(nt)}else Fa("Export cancelled. Customer must exist in QuickBooks.");else{const Te=pe?.error||pe?.message||"Failed to export to QuickBooks.";Fa(Te),ge.error(Te)}}finally{oi(!1)}}},Na=async()=>{Yn(!0);try{const de=await ve.get("/api/sales-orders");Ar(de.data)}catch{ge.error("Failed to fetch sales orders for import")}finally{Yn(!1)}},fo=()=>{Tt(!0),Na()},ki=async()=>{if(zr){Yn(!0);try{const de=await ve.get(`/api/sales-orders/${zr.sales_order_id}`),ke=(de.data.lineItems||de.data.salesOrder?.line_items||[]).filter(nt=>(nt.part_number||"").toUpperCase()!=="LABOUR").map(nt=>({part_number:nt.part_number,part_description:nt.part_description,quantity:String(t?nt.quantity:nt.quantity_sold??nt.quantity??0),unit:nt.unit,unit_price:nt.unit_price,gst:Cc,line_amount:nt.line_amount,part_id:nt.part_id??void 0}));St(ke),Tt(!1),hn(null),ge.success("Line items imported!")}catch{ge.error("Failed to import line items")}finally{Yn(!1)}}},No=de=>{const pe=P.trim(),Te=de.key==="Enter",ke=de.key==="Tab";if(de.key==="Escape"){S(!1);return}if(Te||ke){if(Te&&de.ctrlKey&&pe){de.preventDefault(),D(!0),be(pe),Bi(!0);return}if(E||!pe)return;de.preventDefault();const _t=Ai(pe);_t?(A(_t),T(_t.label)):(D(!0),be(pe),Bi(!0))}},uu=de=>{if(de.key!=="Enter")return;de.preventDefault();const pe=X.trim();if(!pe)return;const Te=u.find(ke=>ke.label.toLowerCase()===pe.toLowerCase());Te?($(Te),C(Te.label)):(Ne(pe),Ee(!0))},mc=()=>{if(!je)return null;const de=at||[];let pe=de.reduce((nt,_t)=>nt+(Number(_t.line_amount)||0),0),Te=pe*.05,ke=pe+Te;return isNaN(pe)&&(pe=0),isNaN(Te)&&(Te=0),isNaN(ke)&&(ke=0),i.jsxs(Z,{p:{xs:2,md:4},maxWidth:1e3,mx:"auto",children:[Ui&&i.jsx(Ot,{severity:"success",sx:{mb:2},onClose:()=>uo(null),children:Ui}),Ia&&i.jsx(Ot,{severity:"error",sx:{mb:2},onClose:()=>Fa(null),children:Ia}),i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Sales Order Details"}),i.jsx(qr,{variant:"outlined",sx:{mb:3},children:i.jsx(Wr,{children:i.jsxs(ie,{container:!0,spacing:{xs:2,md:3},children:[i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Sales Order #:"})," ",je.sales_order_number]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Customer:"})," ",je.customer_name||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Sales Date:"})," ",je.sales_date?new Date(je.sales_date).toLocaleDateString():""]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Wanted By:"})," ",je.wanted_by_date?new Date(je.wanted_by_date).toLocaleDateString():"N/A",je.wanted_by_time_of_day?` (${String(je.wanted_by_time_of_day).charAt(0).toUpperCase()}${String(je.wanted_by_time_of_day).slice(1)})`:""]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Status:"})," ",je.status?.toUpperCase()||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"VIN #:"})," ",je.vin_number||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Unit #:"})," ",je.unit_number||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Mileage:"})," ",je.mileage??"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Make:"})," ",je.vehicle_make||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Model:"})," ",je.vehicle_model||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Invoice:"})," ",je.invoice_status==="done"&&i.jsxs(Z,{component:"span",sx:{display:"inline-flex",alignItems:"center",gap:.5},children:[i.jsx(ac,{color:"success",fontSize:"small"})," Done"]}),je.invoice_status==="needed"&&i.jsxs(Z,{component:"span",sx:{display:"inline-flex",alignItems:"center",gap:.5},children:[i.jsx(Uw,{color:"error",fontSize:"small"})," Needed"]}),!je.invoice_status&&""]}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx("b",{children:"Estimated Price:"})," ",za(je.estimated_cost||0)]}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx("b",{children:"Product Description:"})," ",je.product_description||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx("b",{children:"Tech Story:"}),i.jsx(Z,{sx:{whiteSpace:"pre-line",mt:.5},children:je.tech_story||"N/A"})]}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx("b",{children:"Terms:"})," ",je.terms||"N/A"]}),je.exported_to_qbo&&i.jsxs(ie,{item:!0,xs:12,children:[i.jsx("b",{children:"QBO Export:"})," Exported",je.qbo_invoice_id&&` (Invoice ID: ${je.qbo_invoice_id})`,je.qbo_export_date&&` on ${new Date(je.qbo_export_date).toLocaleDateString()}`]})]})})}),i.jsx(B,{variant:"h5",gutterBottom:!0,children:"Items"}),i.jsx(qr,{variant:"outlined",children:i.jsx(Wr,{children:de.map((nt,_t)=>i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:3,md:2,children:nt.part_number}),i.jsx(ie,{item:!0,xs:6,sm:5,md:4,children:nt.part_description}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1.5,children:nt.quantity}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1.5,children:nt.unit}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1.5,children:za(nt.unit_price)}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1,children:za(nt.line_amount)})]},_t))})}),i.jsxs(Z,{mt:4,display:"flex",flexDirection:"column",alignItems:"flex-end",children:[i.jsxs(B,{variant:"h6",children:["Subtotal: ",za(pe)]}),i.jsxs(B,{variant:"h6",children:["Total GST: ",za(Te)]}),i.jsxs(B,{variant:"h6",children:["Total Amount: ",za(ke)]})]}),i.jsxs(Z,{mt:4,display:"flex",justifyContent:{xs:"center",sm:"flex-end"},gap:2,children:[i.jsx(xe,{variant:"contained",color:"primary",startIcon:i.jsx(la,{}),onClick:Un,children:"Download PDF"}),!je.exported_to_qbo&&i.jsx(xe,{variant:"contained",color:"success",startIcon:i.jsx(Cp,{}),disabled:Pi,onClick:$a,children:Pi?"Exporting...":"Export to QuickBooks"}),i.jsx(xe,{variant:"contained",color:"secondary",startIcon:i.jsx(Sv,{}),onClick:ia,disabled:Io,children:Io?"Creating Invoice...":"Create Invoice"}),a?.access_role!=="Sales and Purchase"&&i.jsx(xe,{variant:"contained",color:"primary",onClick:Nn,children:"Reopen SO"})]})]})};if(!t&&ot)return i.jsxs(rr,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(tr,{}),i.jsx(B,{children:"Loading sales order..."})]});if(!t&&qe)return i.jsxs(rr,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(Ot,{severity:"error",sx:{mb:2},children:qe}),i.jsx(xe,{variant:"contained",onClick:()=>window.location.reload(),sx:{mr:2},children:"Retry"}),i.jsx(xe,{variant:"outlined",onClick:()=>n("/open-sales-orders"),children:"Back to Sales Orders"})]});if(!t&&Qe&&a?.access_role==="Sales and Purchase")return i.jsxs(rr,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(Ot,{severity:"error",sx:{mb:2},children:"Access Denied: Sales and Purchase users cannot view closed sales orders."}),i.jsx(xe,{variant:"outlined",onClick:()=>n("/open-sales-orders"),children:"Back to Sales Orders"})]});if(!t&&Qe)return mc();const Ol=[{key:"customer",element:i.jsx(Ra,{open:E,onOpen:()=>S(!0),onClose:()=>S(!1),autoHighlight:!0,value:w,onChange:(de,pe)=>{if(O){D(!1);return}pe&&pe.isNew?(Bi(!0),be(P),A(null),T(""),S(!1)):(A(pe),S(!1))},inputValue:P,onInputChange:(de,pe,Te)=>{if(T(pe),I&&window.clearTimeout(I),Te==="reset")return;if((pe||"").trim().length>0){const nt=window.setTimeout(()=>S(!0),200);W(nt)}else S(!1)},options:l,filterOptions:(de,pe)=>{const Te=fde(de,pe.inputValue||""),ke=!!Ai(pe.inputValue||""),nt=[...Te];return(pe.inputValue||"").trim()!==""&&!ke&&nt.push({label:`Add "${pe.inputValue}" as New Customer`,isNew:!0}),nt},getOptionLabel:de=>typeof de=="string"?de:de.label,isOptionEqualToValue:(de,pe)=>de.id===pe.id,renderOption:(de,pe)=>{const Te=pe.isNew,{key:ke,...nt}=de;return i.jsxs("li",{...nt,style:{display:"flex",alignItems:"center",opacity:Te?.9:1},children:[Te&&i.jsx(ec,{fontSize:"small",style:{marginRight:8,color:"#666"}}),i.jsx("span",{children:pe.label})]},ke)},renderInput:de=>i.jsx(Pe,{...de,label:"Customer",required:!0,onFocus:pc,onKeyDown:No,onBlur:()=>{if(!w){const pe=P.trim();if(pe){const Te=Ai(pe);Te&&(A(Te),T(Te.label))}}},inputRef:pe=>{R.current=pe}})})},Dr.customerPoNumber?{key:"customerPoNumber",element:i.jsx(Pe,{label:"Customer PO #",value:se,onChange:de=>V(de.target.value),fullWidth:!0,placeholder:"Optional"})}:null,Dr.sourceQuote?{key:"sourceQuote",element:i.jsx(Pe,{label:"Source Quote #",value:Ue||"",placeholder:"Not converted from a quote",fullWidth:!0,InputProps:{readOnly:!0}})}:null,!o&&Dr.quotedPrice?{key:"quotedPrice",element:i.jsx(Pe,{label:"Quoted Price",type:"number",value:He??"",onChange:de=>Je(de.target.value?parseFloat(de.target.value):null),fullWidth:!0,InputProps:{startAdornment:i.jsx(sa,{position:"start",children:"$"})},inputProps:{onWheel:de=>de.currentTarget.blur()}})}:null].filter(Boolean),kl=Fs?i.jsx(Ra,{freeSolo:!0,options:hc,loading:K,value:Ge,onInputChange:(de,pe)=>De(pe),onChange:(de,pe,Te)=>{if(Te==="clear"){De("");return}Si(void 0,typeof pe=="string"?pe:pe??"")},renderInput:de=>i.jsx(Pe,{...de,label:"VIN #",fullWidth:!0,placeholder:"Optional"})}):i.jsx(Pe,{label:"VIN #",value:Ge,onChange:de=>De(de.target.value),fullWidth:!0,placeholder:"Optional"}),gc=Fs?i.jsx(Ra,{freeSolo:!0,options:$s,loading:K,value:Fe,onInputChange:(de,pe)=>Xe(pe),onChange:(de,pe,Te)=>{if(Te==="clear"){Xe("");return}Si(typeof pe=="string"?pe:pe??"",void 0)},renderInput:de=>i.jsx(Pe,{...de,label:"Unit #",fullWidth:!0,placeholder:"Optional"})}):i.jsx(Pe,{label:"Unit #",value:Fe,onChange:de=>Xe(de.target.value),fullWidth:!0,placeholder:"Optional"}),Tl=[Dr.vin?{key:"vin",element:kl}:null,Dr.unitNumber?{key:"unitNumber",element:gc}:null,Dr.vehicleMake?{key:"vehicleMake",element:i.jsx(Pe,{label:"Make",value:it,onChange:de=>lt(de.target.value),fullWidth:!0,placeholder:"Optional"})}:null,Dr.vehicleModel?{key:"vehicleModel",element:i.jsx(Pe,{label:"Model",value:vt,onChange:de=>Ye(de.target.value),fullWidth:!0,placeholder:"Optional"})}:null,Dr.mileage?{key:"mileage",element:i.jsx(Pe,{label:"Mileage",type:"number",value:Ze===""?"":Ze,onChange:de=>We(de.target.value===""?"":Number(de.target.value)),fullWidth:!0,placeholder:"Optional",inputProps:{min:0,step:1}})}:null].filter(Boolean),zs=[{key:"salesDate",element:i.jsx(os,{label:"Sales Date",value:le,onChange:oe,sx:{width:"100%"},slotProps:{textField:{fullWidth:!0,required:!0}}})},Dr.wantedByDate?{key:"wantedByDate",element:i.jsx(os,{label:"Wanted By Date",value:ae,onChange:he,sx:{width:"100%"},slotProps:{textField:{placeholder:"Optional",fullWidth:!0}}})}:null,Dr.wantedByTimeOfDay?{key:"wantedTimeOfDay",element:i.jsxs(tn,{component:"fieldset",fullWidth:!0,children:[i.jsx(a5,{sx:{mb:1},children:"Wanted Time of Day"}),i.jsxs(q2,{value:kt||null,exclusive:!0,fullWidth:!0,size:"small",color:"standard","aria-label":"Wanted time of day",onChange:(de,pe)=>Wt(pe||""),sx:{"& .MuiToggleButtonGroup-grouped":{textTransform:"none",flex:1,gap:0},"& .MuiToggleButtonGroup-grouped:not(:first-of-type)":{marginLeft:0}},children:[i.jsx(al,{value:"morning",children:"Morning"}),i.jsx(al,{value:"afternoon",children:"Afternoon"}),i.jsx(al,{value:"evening",children:"Evening"})]})]})}:null].filter(Boolean),ca=[Dr.invoiceStatus?{key:"invoiceStatus",element:i.jsxs(tn,{component:"fieldset",fullWidth:!0,children:[i.jsx(a5,{sx:{mb:1},children:"Invoice"}),i.jsxs(q2,{value:wt||null,exclusive:!0,fullWidth:!0,size:"small",color:"standard","aria-label":"Invoice status",onChange:$e,sx:{"& .MuiToggleButtonGroup-grouped":{textTransform:"none",flex:1,gap:0},"& .MuiToggleButtonGroup-grouped:not(:first-of-type)":{marginLeft:0},"& .MuiToggleButtonGroup-grouped.Mui-selected":{color:"#fff"},"& .MuiToggleButtonGroup-grouped.Mui-selected.MuiToggleButton-colorError":{bgcolor:de=>de.palette.error.main,"&:hover":{bgcolor:de=>de.palette.error.dark}},"& .MuiToggleButtonGroup-grouped.Mui-selected.MuiToggleButton-colorSuccess":{bgcolor:de=>de.palette.success.main,"&:hover":{bgcolor:de=>de.palette.success.dark}}},children:[i.jsxs(al,{value:"needed",color:"error",children:[i.jsx(Uw,{fontSize:"small",sx:{mr:1}}),"Needed"]}),i.jsxs(al,{value:"done",color:"success",children:[i.jsx(ac,{fontSize:"small",sx:{mr:1}}),"Done"]})]})]})}:null,Dr.terms?{key:"terms",element:i.jsx(Pe,{label:"Terms",value:G,onChange:de=>ee(de.target.value),fullWidth:!0,multiline:!0,minRows:3,maxRows:8,placeholder:"Enter payment/delivery terms, etc."})}:null].filter(Boolean),El=hde(ca.length||1);return i.jsxs(Os,{dateAdapter:oc,children:[i.jsx(Ry,{when:ro,onSave:Pr}),i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",component:"h1",children:t?"Create Sales Order":`Edit Sales Order${je?.sales_order_number?`: ${je.sales_order_number}`:""}`}),i.jsxs(dt,{direction:"row",spacing:1,children:[i.jsx(xe,{variant:"outlined",startIcon:i.jsx(ude,{}),onClick:En,children:"Customize Fields"}),t&&i.jsx(xe,{variant:"outlined",onClick:()=>{A(null),T(""),oe(Rt()),he(null),Wt(""),$(null),C(""),Q(""),ee(""),V(""),De(""),Xe(""),lt(""),Ye(""),Nt(""),We(""),Je(null),St([{part_number:"",part_description:"",quantity:"",unit:Fm[0],unit_price:0,gst:Cc,line_amount:0}]),si(null)},children:"Reset"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:Pr,children:t?"Save Sales Order":"Save Changes"}),!t&&i.jsxs(i.Fragment,{children:[a?.access_role!=="Sales and Purchase"&&i.jsx(xe,{variant:"contained",startIcon:i.jsx(xv,{}),onClick:Qr,children:"Close SO"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(la,{}),onClick:Un,children:"Download PDF"})]})]})]}),i.jsx(Iv,{open:!!fn,anchorEl:fn,onClose:er,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:i.jsxs(Z,{sx:{p:2,width:280},children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1},children:"Show / Hide Optional Fields"}),i.jsx(Tp,{children:[{key:"customerPoNumber",label:"Customer PO #"},{key:"quotedPrice",label:"Quoted Price"},{key:"sourceQuote",label:"Source Quote #"},{key:"vin",label:"VIN #"},{key:"unitNumber",label:"Unit #"},{key:"mileage",label:"Mileage"},{key:"vehicleMake",label:"Make"},{key:"vehicleModel",label:"Model"},{key:"invoiceStatus",label:"Invoice Status"},{key:"wantedByDate",label:"Wanted By Date"},{key:"wantedByTimeOfDay",label:"Wanted Time of Day"},{key:"productDescription",label:"Product Description"},{key:"techStory",label:"Tech Story"},{key:"terms",label:"Terms"},{key:"techStory",label:"Tech Story"}].filter(({key:de})=>nr[de]).filter(({key:de})=>!(s&&["quotedPrice","invoiceStatus","terms"].includes(de))).map(({key:de,label:pe})=>i.jsx(ti,{control:i.jsx(Qi,{size:"small",checked:!!Sr[de],onChange:Te=>Mr(ke=>({...ke,[de]:Te.target.checked}))}),label:pe},de))})]})}),i.jsx(Z,{sx:{mb:2},children:i.jsx(xe,{variant:"outlined",color:"secondary",onClick:fo,children:"Import Line Items"})}),i.jsxs(pr,{open:mt,onClose:()=>Tt(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(mr,{children:"Import Line Items from Sales Order"}),i.jsx(gr,{children:aa?i.jsx(Z,{display:"flex",alignItems:"center",justifyContent:"center",minHeight:120,children:i.jsx(tr,{})}):i.jsx(Ra,{options:Lt,getOptionLabel:de=>{if(!de)return"";const pe=de.sales_order_number||"",Te=de.customer_name||"",ke=de.status||"";return`${pe} - ${Te}${ke?` (${ke})`:""}`},value:zr,onChange:(de,pe)=>hn(pe),renderInput:de=>i.jsx(Pe,{...de,label:"Select Sales Order",fullWidth:!0}),isOptionEqualToValue:(de,pe)=>de.sales_order_id===pe?.sales_order_id})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:()=>Tt(!1),children:"Cancel"}),i.jsx(xe,{onClick:ki,disabled:!zr||aa,variant:"contained",children:"Import"})]})]}),ps&&i.jsxs(Ot,{severity:"warning",sx:{mb:3},onClose:()=>si(null),children:[i.jsx(B,{variant:"body1",sx:{fontWeight:"medium"},children:"Inventory Error"}),i.jsx(B,{variant:"body2",children:ps})]}),i.jsx(Z,{sx:{transform:Bn?`translateY(-${Bn}px)`:"none",transition:"transform 200ms ease"},children:i.jsxs(bt,{sx:Yo,elevation:3,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Customer Information"}),Ol.length?i.jsx(Z,{sx:br,children:Ol.map(de=>i.jsx(Z,{children:de.element},de.key))}):i.jsx(B,{variant:"body2",color:"text.secondary",children:"No customer fields are enabled."})]})}),Tl.length?i.jsxs(bt,{sx:Yo,elevation:3,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Vehicle Details"}),i.jsx(Z,{sx:Al,children:Tl.map(de=>i.jsx(Z,{children:de.element},de.key))})]}):null,i.jsxs(bt,{sx:Yo,elevation:3,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Job & Schedule"}),zs.length?i.jsx(Z,{sx:{...fc,mb:2},children:zs.map(de=>i.jsx(Z,{children:de.element},de.key))}):null,i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsx(Ra,{disablePortal:!0,open:M,onOpen:()=>H(!0),onClose:()=>H(!1),autoHighlight:!0,value:k,onChange:(de,pe)=>{if(pe&&pe.isNew){const Te=pe.inputValue?.toString?.()||X.trim();Ee(!0),Ne(Te),$(null),C(""),H(!1)}else $(pe),H(!1)},inputValue:X,onInputChange:(de,pe,Te)=>{if(C(pe),Ne(pe),U&&window.clearTimeout(U),Te==="reset")return;if((pe||"").trim().length>0){const nt=window.setTimeout(()=>H(!0),200);te(nt)}else H(!1)},options:u,filterOptions:(de,pe)=>{const Te=de.filter(ke=>ke.label.toLowerCase().includes((pe.inputValue||"").toLowerCase()));return(pe.inputValue||"")!==""&&!de.some(ke=>ke.label.toLowerCase()===(pe.inputValue||"").toLowerCase())&&Te.push({label:`Add "${pe.inputValue}"`,isNew:!0,inputValue:pe.inputValue}),Te},getOptionLabel:de=>typeof de=="string"?de:de.label,renderInput:de=>i.jsx(Pe,{...de,label:"Product Name",required:!0,onKeyDown:uu,onBlur:()=>{if(H(!1),!k){const pe=X.trim();if(pe){const Te=u.find(ke=>ke.label.toLowerCase()===pe.toLowerCase());Te&&($(Te),C(Te.label))}}}}),disabled:!1})}),Dr.productDescription&&i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Product Description",value:me,onChange:de=>Q(de.target.value),fullWidth:!0,multiline:!0,minRows:2,maxRows:6})}),Dr.techStory&&i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Tech Story",value:jt,onChange:de=>ur(de.target.value),fullWidth:!0,multiline:!0,minRows:4,maxRows:12,placeholder:"Add technician notes for this sales order"})})]})]}),ca.length?i.jsxs(bt,{sx:Yo,elevation:3,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Invoice Status"}),i.jsx(ie,{container:!0,spacing:2,children:ca.map(de=>i.jsx(ie,{item:!0,xs:12,sm:ca.length>1?6:12,md:El,children:de.element},de.key))})]}):null,i.jsxs(Z,{sx:{position:"relative",zIndex:1e3,transform:Bn?`translateY(-${Bn}px)`:"none",transition:"transform 200ms ease"},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Line Items"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Each part number can only appear once. Edit existing line items to change quantities."})]}),i.jsxs(Z,{sx:{position:"relative",mb:3},children:[!t&&Fr.length>0&&i.jsx(Z,{sx:{position:"absolute",bottom:"calc(100% + 8px)",left:0,right:0,zIndex:500,display:"flex",flexDirection:"column",gap:1,pointerEvents:"none"},children:Fr.map((de,pe)=>i.jsx(Ot,{severity:"warning",sx:{width:"100%",boxShadow:2,pointerEvents:"auto","& .MuiAlert-message":{width:"100%",padding:0}},children:i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{width:"100%"},children:[i.jsxs(Z,{children:[i.jsxs(B,{variant:"body2",fontWeight:"medium",children:["Insufficient stock for ",de.partNumber]}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Excess quantity: ",de.excessQuantity," ",de.unit]})]}),i.jsxs(xe,{variant:"contained",size:"small",sx:{whiteSpace:"nowrap"},onClick:()=>Lr(de),children:["Transfer ",de.excessQuantity," to Parts to Order"]})]})},`${de.lineItemIndex}-${pe}`))}),i.jsxs(pr,{open:!!jn,onClose:()=>Lr(null),maxWidth:"xs",fullWidth:!0,children:[i.jsx(mr,{children:"Transfer to Parts to Order"}),i.jsx(gr,{children:jn&&i.jsxs(B,{variant:"body2",children:["Transfer ",jn.excessQuantity," ",jn.unit," of ",jn.partNumber," to Parts to Order?"]})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:()=>Lr(null),children:"Cancel"}),i.jsx(xe,{variant:"contained",onClick:()=>{if(!jn)return;const de=jn,pe=at[de.lineItemIndex],Te=de.excessQuantity,ke=f.find(Bt=>Bt.part_number.toLowerCase()===pe.part_number.toLowerCase()),nt={sales_order_id:je?.sales_order_id||0,part_number:pe.part_number,part_description:pe.part_description,quantity_to_order:String(Te),unit:pe.unit,unit_price:ke?.last_unit_cost||0,line_amount:(ke?.last_unit_cost||0)*Te};kr(Bt=>[...Bt,nt]);const _t=Math.max(0,(parseFloat(String(pe.quantity).replace(/[^\d.-]/g,""))||0)-Te);St(Bt=>Bt.map((Dt,dr)=>dr===de.lineItemIndex?{...Dt,quantity:String(_t)}:Dt)),Er(Bt=>Bt.filter(Dt=>Dt.lineItemIndex!==de.lineItemIndex)),Lr(null),ge.success(`Transferred ${Te} ${pe.unit} of ${pe.part_number} to parts to order`)},children:"Confirm"})]})]}),i.jsxs(bt,{sx:{p:3,mb:3},elevation:3,children:[i.jsx(ie,{container:!0,spacing:2,children:at.map((de,pe)=>({item:de,originalIndex:pe})).sort((de,pe)=>{const Te=["LABOUR","OVERHEAD","SUPPLY"].includes(de.item.part_number),ke=["LABOUR","OVERHEAD","SUPPLY"].includes(pe.item.part_number);return Te&&!ke?1:!Te&&ke?-1:0}).map(({item:de,originalIndex:pe})=>i.jsxs(Ce.Fragment,{children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:Jr.partNumber,children:i.jsx(Ra,{open:ra===pe,onOpen:()=>bn(pe),onClose:()=>bn(null),autoHighlight:!0,inputValue:de.part_number,onChange:(Te,ke)=>{if(typeof ke=="string"){const nt=at.findIndex((_t,Bt)=>Bt!==pe&&_t.part_number.trim().toLowerCase()===ke.trim().toLowerCase());if(nt!==-1){ge.error(`Part "${ke}" already exists as line item ${nt+1}. Edit that line item instead.`),St(_t=>_t.map((Bt,Dt)=>Dt===pe?{...Bt,part_number:"",part_description:""}:Bt)),bn(null);return}Se(pe,ke),bn(null)}else if(ke&&typeof ke=="object"&&"isNew"in ke){const nt=ke.inputValue||"";Fi(String(nt).toUpperCase()),pi(pe),ji(!0),bn(null)}},onInputChange:(Te,ke,nt)=>{if(nt==="reset")return;const _t=(ke||"").trim();if(St(Bt=>Bt.map((Dt,dr)=>dr===pe?{...Dt,part_number:_t}:Dt)),Ta&&window.clearTimeout(Ta),_t.length>0){const Bt=window.setTimeout(()=>bn(pe),200);Ea(Bt)}else bn(null)},options:f.filter(Te=>Te.part_type!=="supply").map(Te=>Te.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,filterOptions:(Te,ke)=>To(Te,ke,!0),renderOption:(Te,ke)=>{const nt=typeof ke=="object"&&ke.isNew,_t=typeof ke=="string"?ke:ke.label,{key:Bt,...Dt}=Te;return i.jsxs("li",{...Dt,children:[nt&&i.jsx(ec,{fontSize:"small",style:{marginRight:8,color:"#666"}}),typeof ke=="string"?i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",children:ke}),(()=>{const dr=co[String(ke)]||"";return dr?i.jsx(B,{variant:"caption",color:"text.secondary",children:dr}):null})()]}):_t]},Bt)},renderInput:Te=>i.jsx(Pe,{...Te,label:"Part Number",required:!0,fullWidth:!0,onKeyDown:ke=>Eo(pe,ke),onBlur:()=>bn(null)}),onBlur:()=>{const Te=at[pe]?.part_number?.trim().toUpperCase();if(!Te)return;f.find(nt=>nt.part_number===Te)?Se(pe,Te):(pi(pe),Fi(Te),ji(!0),bn(null))}})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:Jr.description,children:i.jsx(Pe,{label:"Part Description",value:de.part_description,fullWidth:!0,required:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:Jr.quantity,children:i.jsx(Pe,{label:"Qty",value:de.quantity,onChange:Te=>Ie(pe,"quantity",Te.target.value),type:"number",fullWidth:!0,required:!0,InputProps:{readOnly:["SUPPLY","LABOUR","OVERHEAD"].includes(de.part_number),disabled:["SUPPLY","LABOUR","OVERHEAD"].includes(de.part_number)},inputProps:{step:1,onWheel:Te=>Te.target.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:Jr.availability,children:i.jsx(Pe,{label:"Avail",value:(()=>{const Te=zt[pe];return Te?Te.available<0?`${Te.available} (Insufficient)`:String(Te.available):"N/A"})(),fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:(()=>{const Te=zt[pe];return Te?Te.available>=0?"#e8f5e8":"#ffeaea":"#f5f5f5"})(),"& .MuiInputBase-input":{color:zt[pe]?.isNegative?"#d32f2f":"#2e7d32"}}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:Jr.unit,children:i.jsx(Pe,{label:"Unit",value:de.part_number==="SUPPLY"?"":de.unit,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),!s&&i.jsx(ie,{item:!0,xs:12,sm:2,md:Jr.unitCost,children:i.jsx(Pe,{label:"Unit Cost",value:de.part_number==="LABOUR"?p??0:de.part_number==="OVERHEAD"?m??0:de.part_number==="SUPPLY"?"":de.unit_price,type:"number",fullWidth:!0,InputProps:{readOnly:!0,startAdornment:de.part_number!=="SUPPLY"?i.jsx(sa,{position:"start",children:"$"}):void 0,disabled:["LABOUR","OVERHEAD","SUPPLY"].includes(de.part_number)}})}),!s&&i.jsx(ie,{item:!0,xs:6,sm:3,md:Jr.amount,children:i.jsx(Pe,{label:"Amount",value:de.line_amount!=null&&!isNaN(Number(de.line_amount))?Number(de.line_amount).toFixed(2):"0.00",InputProps:{readOnly:!0},fullWidth:!0})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:Jr.actions,sx:{display:"flex",alignItems:"center"},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:()=>ft(pe),fullWidth:!0,children:"Remove"})})]},pe))}),i.jsx(Z,{sx:{mt:2},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:Ke,children:"Add Line Item"})})]})]}),!s&&i.jsx(bt,{sx:{p:3,mb:3},elevation:3,children:i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Subtotal: ",za(In)]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Total GST: ",za(Yr)]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"h6",children:["Total Amount: ",za(Kr)]})})]})}),!t&&i.jsxs(bt,{sx:{p:3,mb:3,elevation:3,border:"2px solid #b8860b","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#b8860b"},"&:hover fieldset":{borderColor:"#b8860b"}}},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Parts to Order"}),i.jsx(B,{variant:"body2",color:"textSecondary",sx:{mb:2},children:"Add parts that need to be ordered for this sales order. These quantities are aggregated across all sales orders."}),i.jsx(ie,{container:!0,spacing:2,children:ar.map((de,pe)=>i.jsxs(Ce.Fragment,{children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Ra,{open:An===pe,onOpen:()=>Hr(pe),onClose:()=>Hr(null),autoHighlight:!0,value:de.part_number,onChange:(Te,ke)=>{if(!ke){kr(nt=>{const _t=[...nt];return _t[pe]={..._t[pe],part_number:"",part_description:"",unit:"Each",unit_price:0,line_amount:0},_t});return}if(typeof ke=="string"){const nt=f.find(_t=>_t.part_number===ke);if(nt){const Bt=parseFloat(String(nt.last_unit_cost))||0;kr(Dt=>{const dr=[...Dt];return dr[pe]={...dr[pe],part_number:nt.part_number,part_description:nt.part_description,unit:nt.unit||"Each",unit_price:Bt,line_amount:0},dr})}else{kr(Bt=>{const Dt=[...Bt];return Dt[pe]={...Dt[pe],part_number:ke,part_description:"",unit:"Each",unit_price:0,line_amount:0},Dt});const _t=String(ke).toUpperCase();Ka(pe),ai(_t),so(!0)}}else if(ke&&typeof ke=="object"&&"isNew"in ke){const nt=String(ke.inputValue||"").toUpperCase();Ka(pe),ai(nt),so(!0)}},onInputChange:(Te,ke,nt)=>{if(kr(Bt=>{const Dt=[...Bt];return Dt[pe]={...Dt[pe],part_number:(ke||"").toUpperCase()},Dt}),Ta&&window.clearTimeout(Ta),nt==="reset")return;if((ke||"").trim().length>0){const Bt=window.setTimeout(()=>Hr(pe),200);Ea(Bt)}else Hr(null)},options:f.filter(Te=>Te.part_type!=="supply").map(Te=>Te.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,filterOptions:(Te,ke)=>To(Te,ke,!0),renderOption:(Te,ke)=>{const nt=typeof ke=="object"&&ke.isNew,_t=typeof ke=="string"?ke:ke.label,{key:Bt,...Dt}=Te;return i.jsxs("li",{...Dt,children:[nt&&i.jsx(ec,{fontSize:"small",style:{marginRight:8,color:"#666"}}),typeof ke=="string"?i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",children:ke}),(()=>{const dr=co[String(ke)]||"";return dr?i.jsx(B,{variant:"caption",color:"text.secondary",children:dr}):null})()]}):_t]},Bt)},renderInput:Te=>i.jsx(Pe,{...Te,label:"Part Number",fullWidth:!0,required:!0,onKeyDown:ke=>Pl(pe,ke),onBlur:()=>Hr(null)}),onBlur:()=>{const Te=(ar[pe]?.part_number||"").trim().toUpperCase();if(!Te)return;f.find(nt=>nt.part_number===Te)||(Ka(pe),ai(Te),so(!0),Hr(null))}})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Pe,{label:"Description",value:de.part_description,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#f5f5f5"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Pe,{label:"Qty to Order",value:de.quantity_to_order,onChange:Te=>{const ke=Te.target.value;kr(nt=>{const _t=[...nt],Bt=parseFloat(ke)||0,Dt=_t[pe].unit_price||0;return _t[pe]={..._t[pe],quantity_to_order:ke,line_amount:Bt*Dt},_t})},type:"number",fullWidth:!0,required:!0,inputProps:{step:1,min:0,onWheel:Te=>Te.target.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Pe,{label:"Unit",value:de.unit,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),i.jsx(ie,{item:!0,xs:12,sm:1.5,children:i.jsx(Pe,{label:"Unit Price",value:de.unit_price,type:"number",fullWidth:!0,InputProps:{readOnly:!0,startAdornment:i.jsx(sa,{position:"start",children:"$"})},sx:{backgroundColor:"#f5f5f5"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Amount",value:de.line_amount,InputProps:{readOnly:!0},fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:1,md:1,sx:{display:"flex",alignItems:"center",gap:2},children:i.jsx(xe,{variant:"outlined",onClick:()=>kr(Te=>Te.filter((ke,nt)=>nt!==pe)),sx:{flexShrink:0,borderColor:"#b8860b",color:"#b8860b","&:hover":{borderColor:"#8b6914",backgroundColor:"#fff8dc"}},children:"Remove"})})]},pe))}),i.jsx(Z,{sx:{mt:2},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:()=>kr(de=>[...de,{sales_order_id:Number(e)||0,part_number:"",part_description:"",quantity_to_order:"",unit:"Each",unit_price:0,line_amount:0}]),children:"Add Parts to Order Item"})})]}),i.jsx(Wd,{open:Bs,onClose:()=>Bi(!1),onSave:async de=>{try{const pe=await ve.post("/api/customers",de),Te={label:de.customer_name,id:pe.data.customer_id};c(ke=>[...ke,Te]),A(Te),Bi(!1),ge.success("Customer added successfully!")}catch{ge.error("Failed to add customer.")}},initialCustomer:{customer_name:Us},isEditMode:!1}),i.jsx(wS,{open:we,onClose:()=>Ee(!1),onSave:async de=>{try{const pe=await ve.post("/api/products",de),Te={label:de.product_name,id:pe.data.product_id,description:de.product_name};d(ke=>[...ke,Te]),$(Te),C(Te.label),Ee(!1),Ne(""),ge.success("Product added successfully!")}catch{ge.error("Failed to add product.")}},initialProduct:{product_name:Me||X},isEditMode:!1}),!t&&i.jsxs(i.Fragment,{children:[Ia&&i.jsx(Ot,{severity:"error",sx:{mb:2},onClose:()=>Fa(null),children:Ia}),i.jsx(pl,{open:!!Pt,autoHideDuration:6e3,onClose:()=>Kt(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>Kt(null),severity:"success",sx:{width:"100%"},children:Pt})}),je?.status?.toLowerCase()==="closed"&&i.jsxs(Z,{display:"flex",justifyContent:"flex-end",gap:2,mb:2,children:[i.jsx(xe,{variant:"contained",color:"secondary",startIcon:i.jsx(Sv,{}),onClick:ia,disabled:Io,children:Io?"Creating Invoice...":"Create Invoice"}),!je?.exported_to_qbo&&i.jsx(xe,{variant:"contained",color:"success",startIcon:i.jsx(Cp,{}),disabled:Pi,onClick:$a,children:Pi?"Exporting...":"Export to QuickBooks"}),a?.access_role!=="Sales and Purchase"&&i.jsx(xe,{variant:"outlined",onClick:Nn,children:"Reopen SO"})]})]})]}),i.jsx(tc,{open:io,onClose:()=>{ji(!1),pi(null),Fi("")},onSave:async de=>{const pe=await ve.post("/api/inventory",de),Te=await ve.get("/api/inventory");h(Te.data);const ke=pe.data.item;oo!==null&&St(nt=>{const _t=[...nt],Dt=parseFloat(String(ke.last_unit_cost))||0;return _t[oo]={..._t[oo],part_number:ke.part_number,part_description:ke.part_description,unit:ke.unit||_t[oo].unit,unit_price:Dt},_t})},title:"Add New Part",initialPart:{part_number:Oo.toUpperCase(),category:"Uncategorized"}}),i.jsx(tc,{open:fs,onClose:()=>{so(!1),Ka(null),ai("")},onSave:async de=>{const pe=await ve.post("/api/inventory",de),Te=await ve.get("/api/inventory");h(Te.data);const ke=pe.data.item;hs!==null&&kr(nt=>{const _t=[...nt],Dt=parseFloat(String(ke.last_unit_cost))||0;return _t[hs]={..._t[hs],part_number:ke.part_number,part_description:ke.part_description,unit:ke.unit||"Each",unit_price:Dt},_t})},title:"Add New Part",initialPart:{part_number:lo.toUpperCase(),category:"Uncategorized"}})]})},mde=async e=>{try{return(await ve.get("/api/purchase-history",{params:e})).data}catch(t){throw console.error("Error fetching purchase orders:",t),t}},gde=async()=>ve.get("/api/purchase-history/csv-template",{responseType:"blob"}),vde=async e=>{const t=new FormData;return t.append("file",e),(await ve.post("/api/purchase-history/upload-csv",t,{headers:{"Content-Type":"multipart/form-data"}})).data},IE=()=>{const[e,t]=x.useState([]),[r,n]=x.useState(!0),[a,o]=x.useState(""),[s,l]=x.useState("open"),[c,u]=x.useState({page:0,pageSize:10}),[d,f]=x.useState(!1),h=x.useRef(null),p=Tn();Ds();const{user:v}=ta(),m=async()=>{n(!0);try{const S=(await ve.get("/api/purchase-history",{params:{status:s,searchTerm:a||void 0}})).data.sort((I,W)=>{const O=F=>{const z=F.match(/\d+/);return z?parseInt(z[0],10):0},D=O(I.purchase_number);return O(W.purchase_number)-D});t(S)}catch(E){console.error("Error fetching purchase orders:",E),t([]),ge.error("Failed to fetch purchase orders")}finally{n(!1)}};x.useEffect(()=>{m()},[s,a]);const y=E=>{window.confirm("Are you sure you want to delete this purchase order?")&&b(E)},b=async E=>{try{await ve.delete(`/api/purchase-orders/${E}`),ge.success("Purchase order deleted successfully"),m()}catch(S){console.error("Error deleting purchase order:",S),ge.error("Failed to delete purchase order")}},_=()=>{let E=e;s==="open"?E=e.filter(O=>O.status==="Open"):s==="closed"&&(E=e.filter(O=>O.status==="Closed"));const S=Cl.unparse(E),I=new Blob([S],{type:"text/csv;charset=utf-8;"}),W=document.createElement("a");W.href=URL.createObjectURL(I),W.download=`purchase_orders_${Rt().format("YYYY-MM-DD")}.csv`,W.click()},w=async()=>{try{const E=await gde(),S=new Blob([E.data],{type:"text/csv"}),I=window.URL.createObjectURL(S),W=document.createElement("a");W.href=I,W.setAttribute("download","purchase_order_import_template.csv"),document.body.appendChild(W),W.click(),W.remove(),window.URL.revokeObjectURL(I)}catch(E){console.error("Error downloading template",E),ge.error("Failed to download template")}},A=()=>{h.current?.click()},P=async E=>{const S=E.target.files?.[0];if(S){f(!0);try{const I=await vde(S);ge.success(I?.message||"Purchase order CSV uploaded"),I?.warnings?.length&&ge.warn(I.warnings.join("; ")),m()}catch(I){console.error("Error uploading purchase order CSV",I);const W=I?.response?.data?.error||"Failed to upload purchase order CSV";ge.error(W)}finally{f(!1),E.target.value=""}}},T=[{field:"purchase_number",headerName:"Purchase #",flex:1,minWidth:120,valueFormatter:E=>E.value?String(E.value).replace("PO-",""):""},{field:"vendor_name",headerName:"Vendor",flex:1.3,minWidth:150},{field:"date",headerName:"Date",flex:.9,minWidth:130,valueFormatter:E=>E.value?new Date(E.value).toLocaleDateString():""},{field:"bill_number",headerName:"Bill #",flex:.9,minWidth:100},{field:"subtotal",headerName:"Subtotal",flex:.8,minWidth:100,valueFormatter:E=>E.value!=null&&!isNaN(Number(E.value))?`$${Number(E.value).toFixed(2)}`:"$0.00"},{field:"gst_rate",headerName:"GST Rate (%)",flex:.7,minWidth:80,valueFormatter:E=>E.value!=null&&!isNaN(Number(E.value))?`${Number(E.value).toFixed(2)}%`:"5.00%"},{field:"total_gst_amount",headerName:"GST",flex:.7,minWidth:80,valueFormatter:E=>E.value!=null&&!isNaN(Number(E.value))?`$${Number(E.value).toFixed(2)}`:"$0.00"},{field:"total_amount",headerName:"Total",flex:.8,minWidth:100,valueFormatter:E=>E.value!=null&&!isNaN(Number(E.value))?`$${Number(E.value).toFixed(2)}`:"$0.00"},{field:"status",headerName:"Status",flex:.8,minWidth:100,renderCell:E=>i.jsx(st,{label:E.value,color:E.value==="Open"?"success":"error",size:"small",variant:"outlined"})},{field:"return_summary",headerName:"Returns",flex:.9,minWidth:150,sortable:!1,renderCell:E=>{const S=E.row.return_requested_count??0,I=E.row.return_returned_count??0;return!S&&!I?i.jsx(B,{variant:"body2",color:"text.secondary",children:"None"}):i.jsxs(dt,{direction:"row",spacing:1,children:[S>0&&i.jsx(st,{label:`Requested ${S}`,color:"warning",size:"small",variant:"outlined"}),I>0&&i.jsx(st,{label:`Returned ${I}`,color:"success",size:"small",variant:"outlined"})]})}},{field:"qbo_exported",headerName:"QBO Exported",flex:.8,minWidth:120,renderCell:E=>E.row.exported_to_qbo?i.jsx(ac,{color:"success",titleAccess:"Exported to QuickBooks"}):E.row.qbo_export_status?i.jsx(qy,{color:"error",titleAccess:`QBO Export Error: ${E.row.qbo_export_status}`}):E.row.status==="Closed"?i.jsx(oR,{color:"warning",titleAccess:"Not exported to QuickBooks"}):null},{field:"actions",headerName:"Actions",width:100,sortable:!1,renderCell:E=>i.jsx(Z,{sx:{display:"flex",gap:.5},children:E.row.status!=="Closed"&&i.jsx(xr,{size:"small",color:"error",onClick:S=>{S.stopPropagation(),y(E.row.purchase_id)},children:i.jsx(ma,{})})})}];return i.jsx(rr,{maxWidth:"xl",sx:{mt:4},children:i.jsxs(Z,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:s==="open"?"Open Purchase Orders":s==="closed"?"Purchase Order History":"All Purchase Orders"}),i.jsxs(dt,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[i.jsx("input",{type:"file",accept:".csv,text/csv",ref:h,style:{display:"none"},onChange:P}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:w,children:"PO Template"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Cd,{}),onClick:A,disabled:d,children:d?"Uploading...":"Upload PO CSV"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:()=>p("/open-purchase-orders/new"),children:"New PO"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:_,children:"Export CSV"})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsxs(dt,{direction:"row",spacing:3,sx:{mb:3},children:[i.jsx(Pe,{label:"Search",variant:"outlined",value:a,onChange:E=>o(E.target.value),InputProps:{startAdornment:i.jsx(sa,{position:"start",children:i.jsx(fi,{sx:{fontSize:32}})}),sx:{fontSize:22,height:56}},sx:{minWidth:340,maxWidth:400,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"medium"}),i.jsx(st,{label:"All",onClick:()=>l("all"),color:s==="all"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),i.jsx(st,{label:"Open",onClick:()=>l("open"),color:s==="open"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}}),i.jsx(st,{label:"Closed",onClick:()=>l("closed"),color:s==="closed"?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}})]}),i.jsx(Po,{rows:e,columns:T,loading:r,paginationModel:c,onPaginationModelChange:u,pageSizeOptions:[10,25,50],getRowId:E=>E.purchase_id,disableRowSelectionOnClick:!0,initialState:{sorting:{sortModel:[{field:"purchase_number",sort:"desc"}]}},onRowClick:E=>{const S=E.row.status?.toLowerCase();p(S==="closed"?`/purchase-order/${E.row.purchase_id}`:`/open-purchase-orders/${E.row.purchase_id}`)},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"},cursor:"pointer"}})]})})]})})};var ah={},NE;function yde(){if(NE)return ah;NE=1;var e=sr();Object.defineProperty(ah,"__esModule",{value:!0}),ah.default=void 0;var t=e(cr()),r=lr();return ah.default=(0,t.default)((0,r.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),ah}var xde=yde();const Hp=Et(xde),bde=async e=>{const t=Array.isArray(e)?e:[e];if(t.length===0)throw new Error("Please select at least one document to analyze.");const r=new FormData;return t.forEach(a=>r.append("documents",a)),t.length===1&&r.append("document",t[0]),(await ve.post("/api/purchase-orders/ocr/upload",r,{headers:{"Content-Type":"multipart/form-data"}})).data};var ih={},DE;function _de(){if(DE)return ih;DE=1;var e=sr();Object.defineProperty(ih,"__esModule",{value:!0}),ih.default=void 0;var t=e(cr()),r=lr();return ih.default=(0,t.default)((0,r.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),ih}var wde=_de();const jde=Et(wde);var oh={},ME;function Sde(){if(ME)return oh;ME=1;var e=sr();Object.defineProperty(oh,"__esModule",{value:!0}),oh.default=void 0;var t=e(cr()),r=lr();return oh.default=(0,t.default)((0,r.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess"),oh}var Cde=Sde();const Ade=Et(Cde),Pde=({open:e,onClose:t,purchaseOrderId:r,onSuccess:n,onAllocationSaved:a})=>{const[o,s]=x.useState(!1),[l,c]=x.useState(!1),[u,d]=x.useState(null),[f,h]=x.useState({}),[p,v]=x.useState({}),[m,y]=x.useState({}),[b,_]=x.useState(new Set),[w,A]=x.useState(new Set),[P,T]=x.useState(""),[E,S]=x.useState([]);x.useEffect(()=>{e&&r&&(d(null),h({}),v({}),y({}),_(new Set),S([]),A(new Set),T(""),I())},[e,r]);const I=async()=>{s(!0);try{const H=(await ve.get(`/api/purchase-history/${r}/allocation-suggestions`)).data;console.log("Allocation suggestions data:",H),console.log("Number of suggestions:",H.suggestions?.length),H.suggestions?.forEach((he,me)=>{console.log(`Suggestion ${me}: ${he.part_number} - ${he.allocation_suggestions?.length} sales orders`),he.allocation_suggestions?.forEach((Q,G)=>{console.log(`  Allocation ${G}: SO ${Q.sales_order_number}, current_quantity_needed: ${Q.current_quantity_needed}, is_needed: ${Q.is_needed}`)})});const U=new Set,te=[];for(const he of H.suggestions||[])try{console.log(`Checking part type for: ${he.part_number}`);const me=await ZL(he.part_number);console.log(`Part info for ${he.part_number}:`,me),me.part_type==="supply"?(U.add(he.part_number),console.log(`Filtering out supply part: ${he.part_number}`)):(console.log(`Including stock part: ${he.part_number} (type: ${me.part_type})`),te.push(he))}catch(me){console.warn(`Could not determine part type for ${he.part_number}, including it:`,me),te.push(he)}_(U),console.log(`Filtering summary: ${U.size} supply parts filtered out, ${te.length} stock parts remaining`),console.log("Supply parts filtered:",Array.from(U)),console.log("Stock parts included:",te.map(he=>he.part_number));const le={...H,suggestions:te};d(le);let oe={},ae={};try{const me=(await ve.get(`/api/purchase-history/${r}/allocations`)).data||[],Q={};for(const G of me){const ee=String(G.part_number).toUpperCase();Q[ee]||(Q[ee]={}),Q[ee][G.sales_order_id]=Number(G.allocate_qty)||0}oe={},ae={},te.forEach(G=>{const ee=G.part_number,se=Q[ee]||{},V={};G.allocation_suggestions.forEach(De=>{const Fe=se[De.sales_order_id];V[De.sales_order_id]=typeof Fe=="number"?Fe:De.suggested_alloc}),oe[ee]=V;const Ge=Object.values(V).reduce((De,Fe)=>De+(Number(Fe)||0),0);ae[ee]=Math.max(0,G.quantity_ordered-Ge)})}catch{oe={},ae={},te.forEach(me=>{oe[me.part_number]={},me.allocation_suggestions.forEach(G=>{oe[me.part_number][G.sales_order_id]=G.suggested_alloc});const Q=Object.values(oe[me.part_number]).reduce((G,ee)=>G+(Number(ee)||0),0);ae[me.part_number]=Math.max(0,me.quantity_ordered-Q)})}h(oe),v(ae),A(new Set),S([])}catch(M){console.error("Error fetching allocation suggestions:",M),ge.error("Failed to load allocation suggestions")}finally{s(!1)}},W=(M,H,U)=>{if(!u)return{valid:!0};const te=u.suggestions.find(se=>se.part_number===M);if(!te)return{valid:!0};const le=te.allocation_suggestions.find(se=>se.sales_order_id===H);if(!le)return{valid:!0};const oe=le.current_quantity_needed,ae=te.quantity_ordered,he=te.allocation_suggestions.filter(se=>se.is_needed).reduce((se,V)=>se+V.current_quantity_needed,0),me=ae>=he,Q=$(M),G=f[M]?.[H]||0,ee=ae-(Q-G);return U>ee?{valid:!1,message:`Cannot allocate more than ${ee} units (exceeds ordered quantity)`}:me&&le.is_needed&&U<oe?{valid:!1,message:`Cannot allocate less than ${oe} units when surplus exists`}:!me&&le.is_needed&&U<oe?{valid:!0,warning:`Allocating ${U} units but ${oe} units are needed for quantity to order`}:{valid:!0}},O=(M,H,U)=>{const te=Math.max(0,U),le=W(M,H,te);if(!le.valid){ge.error(le.message);return}le.warning&&ge.warning(le.warning),h(oe=>{const ae={...oe,[M]:{...oe[M],[H]:te}};if(u){const he=u.suggestions.find(me=>me.part_number===M);if(he){const me=ae[M]||{},Q=Object.values(me).reduce((ee,se)=>ee+se,0),G=Math.max(0,he.quantity_ordered-Q);v(ee=>({...ee,[M]:G}))}}return ae})},D=M=>{if(!u)return;const H=u.suggestions.find(me=>me.part_number===M);if(!H)return;const U=H.quantity_ordered,te=H.allocation_suggestions.filter(me=>me.is_needed).reduce((me,Q)=>me+Q.current_quantity_needed,0),le=U>=te,oe=H.allocation_suggestions.filter(me=>me.is_needed).sort((me,Q)=>me.sales_order_number.localeCompare(Q.sales_order_number)),ae={};let he=U;if(le){for(const me of oe){const Q=me.current_quantity_needed,G=Math.min(Q,he);G>0&&(ae[me.sales_order_id]=G,he-=G)}if(he>0)for(const me of H.allocation_suggestions){if(he<=0)break;const Q=ae[me.sales_order_id]||0,G=Math.min(he,1);ae[me.sales_order_id]=Q+G,he-=G}}else for(const me of oe){if(he<=0)break;const Q=me.current_quantity_needed,G=Math.min(Q,he);G>0&&(ae[me.sales_order_id]=G,he-=G)}h(me=>({...me,[M]:ae})),v(me=>({...me,[M]:he}))},R=()=>{u&&u.suggestions.forEach(M=>{D(M.part_number)})},F=(M,H)=>{A(U=>{const te=new Set(U);return H?te.add(M):te.delete(M),te})},z=M=>{if(!u){A(new Set);return}A(M?new Set(u.suggestions.map(H=>H.part_number)):new Set)},K=x.useMemo(()=>{if(!u)return[];const M=new Map;return u.suggestions.forEach(H=>{H.allocation_suggestions.forEach(U=>{M.has(U.sales_order_id)||M.set(U.sales_order_id,{id:U.sales_order_id,label:U.sales_order_number,customer:U.customer_name})})}),Array.from(M.values()).sort((H,U)=>H.label.localeCompare(U.label))},[u]),J=()=>{if(!u)return;const M=Array.from(w);if(M.length===0){ge.error("Select at least one part to allocate.");return}if(P===""){ge.error("Select a sales order to allocate the selected parts.");return}const H={...f},U={...p};M.forEach(te=>{const le=u.suggestions.find(he=>he.part_number===te);if(!le)return;const oe={};le.allocation_suggestions.forEach(he=>{oe[he.sales_order_id]=he.sales_order_id===P?le.quantity_ordered:0}),H[te]=oe;const ae=Object.values(oe).reduce((he,me)=>he+(Number(me)||0),0);U[te]=Math.max(0,le.quantity_ordered-ae)}),h(H),v(U),ge.success("Selected parts allocated to the chosen sales order.")},L=()=>{const M=[];return u?(u.suggestions.forEach(H=>{const U=H.part_number,te=H.quantity_ordered,le=f[U]||{},oe=Object.values(le).reduce((me,Q)=>me+Q,0);oe>te&&M.push(`Total allocation (${oe}) exceeds ordered quantity (${te}) for part ${U}`);const ae=H.allocation_suggestions.filter(me=>me.is_needed).reduce((me,Q)=>me+Q.current_quantity_needed,0);if(te>=ae){for(const me of H.allocation_suggestions)if(me.is_needed){const Q=le[me.sales_order_id]||0,G=me.current_quantity_needed;Q<G&&M.push(`Sales order ${me.sales_order_number} must receive at least ${G} units when surplus exists`)}}}),S(M),M.length===0):!1},k=async()=>{if(L()){c(!0);try{const M=[];for(const[U,te]of Object.entries(f))for(const[le,oe]of Object.entries(te))oe>0&&M.push({sales_order_id:parseInt(le),part_number:U,allocate_qty:oe});const H=await ve.post(`/api/purchase-history/${r}/save-allocations`,{allocations:M,surplusPerPart:p});ge.success("Allocations saved successfully"),a&&a(),t()}catch(M){console.error("Error saving allocations:",M);const H=M.response?.data?.error||"Failed to save allocations";ge.error(H)}finally{c(!1)}}},$=M=>{const H=f[M]||{};return Object.values(H).reduce((U,te)=>U+te,0)},X=M=>{if(!u)return 0;const H=u.suggestions.find(te=>te.part_number===M);if(!H)return 0;const U=$(M);return H.quantity_ordered-U},C=M=>{y(H=>({...H,[M]:!H[M]}))};return o?i.jsxs(pr,{open:e,onClose:t,maxWidth:"lg",fullWidth:!0,children:[i.jsx(mr,{children:"Loading Allocation Suggestions..."}),i.jsx(gr,{children:i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:i.jsx(tr,{})})})]}):i.jsxs(pr,{open:e,onClose:t,maxWidth:"lg",fullWidth:!0,children:[i.jsxs(mr,{children:["Allocate Purchase Order: ",u?.purchase_order_number]}),i.jsxs(gr,{children:[u&&u.suggestions.length>0&&i.jsxs(bt,{sx:{mb:3,p:2,backgroundColor:"grey.50"},children:[i.jsxs(B,{variant:"h6",gutterBottom:!0,children:["Purchase Order Summary (",u.suggestions.length," parts)"]}),i.jsx(Z,{display:"flex",flexWrap:"wrap",gap:1,children:u.suggestions.map((M,H)=>i.jsx(st,{label:`${M.part_number}: ${M.quantity_ordered} ordered`,color:"primary",variant:"outlined",size:"small"},`${M.part_number}-${H}`))})]}),b.size>0&&i.jsxs(Ot,{severity:"info",sx:{mb:2},children:[i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"Note:"})," ",b.size," supply part",b.size>1?"s":""," ",b.size>1?"have":"has"," been filtered out from allocation. Supply parts are not tracked for inventory allocation."]}),i.jsx(Z,{mt:1,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Filtered parts: ",Array.from(b).join(", ")]})})]}),E.length>0&&i.jsxs(Ot,{severity:"error",sx:{mb:2},children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Please correct the following errors:"}),E.map((M,H)=>i.jsxs(B,{variant:"body2",children:[" ",M]},H))]}),u&&u.suggestions.length>0&&i.jsx(bt,{sx:{mb:3,p:2},variant:"outlined",children:i.jsxs(dt,{direction:{xs:"column",md:"row"},spacing:2,alignItems:{xs:"flex-start",md:"center"},children:[i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(ti,{control:i.jsx(Qi,{checked:w.size===u.suggestions.length&&u.suggestions.length>0,indeterminate:w.size>0&&w.size<u.suggestions.length,onChange:M=>z(M.target.checked)}),label:"Select all parts"}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:[w.size," selected"]})]}),i.jsxs(tn,{size:"small",sx:{minWidth:220},children:[i.jsx(ln,{id:"bulk-sales-order-label",children:"Sales Order"}),i.jsxs(cn,{labelId:"bulk-sales-order-label",label:"Sales Order",value:P,onChange:M=>T(M.target.value),displayEmpty:!0,children:[i.jsx(Zt,{value:"",children:i.jsx("em",{children:"Select sales order"})}),K.map(M=>i.jsxs(Zt,{value:M.id,children:[M.label,"  ",M.customer]},M.id))]})]}),i.jsx(xe,{variant:"contained",onClick:J,disabled:w.size===0||P==="",children:"Allocate selected parts to sales order"})]})}),u?.suggestions.length===0?i.jsx(Ot,{severity:"info",sx:{mb:2},children:i.jsx(B,{variant:"body1",children:"No parts found in this purchase order to allocate."})}):u?.suggestions.map((M,H)=>i.jsxs(bt,{sx:{mb:2,p:2},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(Qi,{checked:w.has(M.part_number),onChange:U=>F(M.part_number,U.target.checked),inputProps:{"aria-label":`Select part ${M.part_number}`}}),i.jsx(xr,{size:"small",onClick:()=>C(M.part_number),sx:{p:.5},children:m[M.part_number]?i.jsx(Ade,{}):i.jsx(jde,{})}),i.jsxs(B,{variant:"h6",children:[M.part_number," - ",M.part_description]})]}),i.jsxs(Z,{display:"flex",gap:1,alignItems:"center",children:[i.jsx(st,{label:`Ordered: ${M.quantity_ordered}`,color:"primary",variant:"outlined",size:"small"}),i.jsx(st,{label:`Total Needed: ${M.total_needed}`,color:"secondary",variant:"outlined",size:"small"}),i.jsx(st,{label:`Remaining: ${X(M.part_number)}`,color:X(M.part_number)<0?"error":"default",variant:"outlined",size:"small"}),i.jsx(xe,{variant:"outlined",size:"small",onClick:()=>D(M.part_number),children:"Auto Allocate (FIFO)"})]})]}),i.jsx(OI,{in:m[M.part_number],children:i.jsx(Z,{mt:2,children:i.jsx(pa,{children:i.jsxs(Jn,{size:"small",children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{children:"Sales Order"}),i.jsx(Ae,{children:"Customer"}),i.jsx(Ae,{children:"Date"}),i.jsx(Ae,{align:"right",children:"Quantity to Order"}),i.jsx(Ae,{align:"right",children:"Allocate Qty"}),i.jsx(Ae,{children:"Status"})]})}),i.jsx(ea,{children:M.allocation_suggestions.map(U=>(console.log(`Rendering allocation for SO ${U.sales_order_number}: current_quantity_needed = ${U.current_quantity_needed}, is_needed = ${U.is_needed}`),i.jsxs(hr,{sx:{backgroundColor:U.is_needed?"warning.light":"grey.50","&:hover":{backgroundColor:U.is_needed?"warning.main":"grey.100"},borderLeft:U.is_needed?"4px solid #ff9800":"4px solid transparent"},children:[i.jsx(Ae,{children:i.jsx(B,{variant:"body2",fontWeight:"medium",children:U.sales_order_number})}),i.jsx(Ae,{children:U.customer_name}),i.jsx(Ae,{children:new Date(U.sales_date).toLocaleDateString()}),i.jsx(Ae,{align:"right",children:i.jsx(B,{variant:"body2",color:"black",fontWeight:U.is_needed?"bold":"normal",children:U.current_quantity_needed||0})}),i.jsx(Ae,{align:"right",children:i.jsx(Pe,{type:"number",value:f[M.part_number]?.[U.sales_order_id]||0,onChange:te=>{const le=parseFloat(te.target.value)||0;O(M.part_number,U.sales_order_id,le)},onBlur:te=>{const le=parseFloat(te.target.value)||0,oe=$(M.part_number),ae=f[M.part_number]?.[U.sales_order_id]||0,he=M.quantity_ordered-(oe-ae);le>he&&O(M.part_number,U.sales_order_id,he)},size:"small",sx:{width:80},inputProps:{min:0,step:1,max:M.quantity_ordered}})}),i.jsx(Ae,{children:i.jsx(st,{label:U.is_needed?"Needs Part":"No Need",color:U.is_needed?"warning":"default",size:"small",variant:"outlined"})})]},`${M.part_number}-${U.sales_order_id}`)))})]})})})}),i.jsxs(Z,{mt:2,display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsxs(B,{variant:"body2",children:["Total Allocated: ",$(M.part_number)]}),i.jsxs(Z,{display:"flex",alignItems:"center",gap:2,children:[i.jsx(B,{variant:"body2",children:"Surplus to Stock:"}),i.jsx(Pe,{type:"number",value:p[M.part_number]||0,disabled:!0,size:"small",sx:{width:80},inputProps:{min:0,step:1}})]})]})]},`${M.part_number}-${H}`))]}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:t,disabled:l,children:"Cancel"}),i.jsx(xe,{onClick:R,variant:"outlined",disabled:l,sx:{mr:"auto"},children:"Auto Allocate All (FIFO)"}),i.jsx(xe,{onClick:k,variant:"contained",disabled:l||E.length>0,children:l?i.jsx(tr,{size:20}):"Save Allocations"})]})]})},Ww=(e,t)=>{const r=parseFloat(String(e))||0,n=parseFloat(String(t))||0;return Math.round(r*n*100)/100},Ode=(e,t=5)=>{const r=e.reduce((o,s)=>{const l=Ww(s.quantity,s.unit_cost);return o+l},0),n=r*(t/100),a=r+n;return{subtotal:Math.round(r*100)/100,total_gst_amount:Math.round(n*100)/100,total_amount:Math.round(a*100)/100}},kde=(e,t=!1)=>{const r={};e.part_number?.trim()||(r.part_number="Part Number is required"),e.part_description?.trim()||(r.part_description="Part Description is required");const n=parseFloat(String(e.quantity));if((isNaN(n)||n<=0)&&(r.quantity="Quantity must be greater than 0"),t){const a=parseFloat(String(e.unit_cost));(isNaN(a)||a<=0)&&(r.unit_cost="Unit Cost must be greater than 0")}return r},Tde=(e,t,r=!1)=>{const n={};t||(n.vendor="Vendor is required");const a=e.map(s=>kde(s,r));return a.some(s=>Object.keys(s).length>0)&&(n.lineItems=a),n},tl=e=>{const t=parseFloat(String(e));return isNaN(t)?0:t},rl=["Each","cm","ft","ft^2","kg","pcs","L"],LE=5,RE=()=>{const{id:e}=Ms(),t=Tn(),{user:r}=ta(),n=e==="new";console.log("Is creation mode:",n,"ID:",e);const[a,o]=x.useState(null),[s,l]=x.useState(null),[c,u]=x.useState(Rt()),[d,f]=x.useState(Rt().toISOString()),[h,p]=x.useState(""),[v,m]=x.useState([]),y=Ay(v,300),[b,_]=x.useState([]),[w,A]=x.useState("Open"),[P,T]=x.useState(!1),[E,S]=x.useState(LE),[I,W]=x.useState({}),[O,D]=x.useState(0),[R,F]=x.useState([]),[z,K]=x.useState(""),J=x.useRef(null),[L,k]=x.useState(!1),[$,X]=x.useState(null),[C,M]=x.useState(null),[H,U]=x.useState(!1),[te,le]=x.useState(!1),[oe,ae]=x.useState([]),[he,me]=x.useState({}),[Q,G]=x.useState(null),[ee,se]=x.useState(null),[V,Ge]=x.useState(!1),[De,Fe]=x.useState(null),Xe=x.useRef(null),[it,lt]=x.useState(!0),vt=x.useCallback(async()=>{if(!(te||R.length>0)){le(!0);try{const be=await ve.get("/api/vendors");F(be.data.map(we=>({label:we.vendor_name,id:we.vendor_id,vendor_code:we.vendor_code||"",isNew:!1})))}catch(be){console.error("Failed to reload vendors",be)}finally{le(!1)}}},[R.length,te]),Ye=x.useMemo(()=>{const be={};for(const we of oe||[])we?.part_number&&(be[String(we.part_number)]=we.part_description||"");return be},[oe]),Ze=x.useCallback((be,we,Ee=!1)=>{const Me=(we.inputValue||"").toUpperCase(),Ne=50,mt=[];for(const Lt of be){const Ar=String(Lt).toUpperCase(),zr=(Ye[Lt]||"").toUpperCase();if((!Me||Ar.includes(Me)||zr.includes(Me))&&(mt.push(Lt),mt.length>=Ne))break}const Tt=mt.some(Lt=>String(typeof Lt=="string"?Lt:Lt?.label||"").toUpperCase()===Me);return Ee&&Me&&!Tt&&mt.push({label:`Add "${we.inputValue}" as New Part`,isNew:!0,inputValue:we.inputValue}),mt},[Ye]),[We,wt]=x.useState(!1),[Nt,kt]=x.useState(null),[Wt,jt]=x.useState(""),[ur,$e]=x.useState(void 0),[He,Je]=x.useState("manual"),[Ue,pt]=x.useState([]),[at,St]=x.useState(null),[It,Yt]=x.useState(null),[Sr,Mr]=x.useState(null),[nr,Cr]=x.useState({}),[Dr,fn]=x.useState({});x.useMemo(()=>j8(),[]);const[Oa,En]=x.useState(null),[er,Jr]=x.useState(!1),[Vn,In]=x.useState(null),[Yr,Kr]=x.useState(""),[je,Ve]=x.useState(!1),[ot,Oe]=x.useState(!1);x.useEffect(()=>{n&&c&&f(c.toISOString())},[c,n]);const qe=async()=>{try{console.log("Fetching aggregate quantities...");const be=new AbortController,we=setTimeout(()=>be.abort(),1e4),Ee=await ve.get("/api/sales-orders/parts-to-order/all",{signal:be.signal});clearTimeout(we);const{aggregatedParts:Me}=Ee.data;if(console.log("Full API response:",Ee.data),console.log("Aggregated parts response:",Me),Me&&Me.length>0){const Ne={};Me.forEach(mt=>{const Tt=typeof mt.total_quantity_needed=="string"?parseFloat(mt.total_quantity_needed):mt.total_quantity_needed;Ne[mt.part_number.toUpperCase()]=Tt}),console.log("Calculated quantities:",Ne),W(Ne),_(mt=>{const Tt=mt.map(Lt=>({...Lt,quantity_to_order:Ne[Lt.part_number]||0}));return console.log("Updated line items with quantities:",Tt),Tt})}else console.log("No aggregated parts found, clearing quantities"),W({}),_(Ne=>Ne.map(mt=>({...mt,quantity_to_order:0})))}catch(be){console.error("Error fetching aggregate quantities:",be),be.name==="AbortError"&&console.error("Request timed out"),W({}),_(we=>we.map(Ee=>({...Ee,quantity_to_order:0})))}},rt=async()=>{if(console.log("fetchData called. ID:",e),n)try{console.log(" Fetching vendors and inventory for creation mode...");const be=new AbortController,we=setTimeout(()=>be.abort(),15e3),[Ee,Me]=await Promise.all([ve.get("/api/vendors",{signal:be.signal}),ve.get("/api/inventory",{signal:be.signal})]);clearTimeout(we),console.log(" Vendors and inventory fetched successfully"),console.log("Raw vendors data:",Ee.data);const Ne=Ee.data.map(mt=>({label:mt.vendor_name,id:mt.vendor_id,email:mt.email}));console.log("Mapped vendors:",Ne),F(Ne),ae(Me.data),_([]);try{await qe()}catch(mt){console.error("Error fetching aggregate quantities:",mt)}lt(!1),Ve(!0),console.log(" Creation mode initialization complete");return}catch(be){console.error(" Error fetching vendors/inventory:",be),be.name==="AbortError"?En("Request timed out. Please try again."):En("Failed to fetch vendors and inventory. Please check your connection and try again."),lt(!1);return}try{const[be,we,Ee]=await Promise.all([ve.get(`/api/purchase-orders/${e}`),ve.get("/api/vendors"),ve.get("/api/inventory")]),Me=be.data;if(console.log("Fetched Order Data:",Me),o(Me),Me.vendor_name&&Me.vendor_id){const Lt=we.data.find(Ar=>Ar.vendor_id===Me.vendor_id);l({label:Me.vendor_name,id:Me.vendor_id,email:Lt?.email})}else if(Me.vendor_id){const Lt=we.data.find(Ar=>Ar.vendor_id===Me.vendor_id);Lt?l({label:Lt.vendor_name,id:Lt.vendor_id,email:Lt.email}):(!s||!s.id)&&l(null)}else(!s||!s.id)&&l(null);u(Rt(Me.purchase_date)),f(Me.date||Me.purchase_date||null),p(Me.bill_number||""),console.log("Original line items from backend:",Me.lineItems);const Ne=Me.lineItems.map(Lt=>{const Ar={...Lt,quantity:String(Lt.quantity||""),unit_cost:String(Lt.unit_cost||""),line_amount:parseFloat(String(Lt.line_amount??Lt.line_total??0)),quantity_to_order:0};return console.log("Mapped line item:",Ar),Ar});console.log("Final mapped line items:",Ne),_(Ne),m(Ne);const mt=Me.status==="Closed"?"Closed":"Open";console.log("Setting purchase order status:",mt,"from fetched status:",Me.status),A(mt),T(!1),S(Me.global_gst_rate||LE),console.log("State after setting:",{purchaseOrder:Me,billNumber:Me.bill_number||"",lineItems:Me.lineItems,mappedLineItems:Ne,subTotal:parseFloat(String(Me.subtotal))||0,totalGSTAmount:parseFloat(String(Me.total_gst_amount))||0,totalAmount:parseFloat(String(Me.total_amount))||0}),console.log("Raw vendors data (edit mode):",we.data);const Tt=we.data.map(Lt=>({label:Lt.vendor_name,id:Lt.vendor_id,email:Lt.email}));console.log("Mapped vendors (edit mode):",Tt),F(Tt),ae(Ee.data),await qe(),lt(!1),Ve(!0)}catch(be){console.error("Error fetching data:",be),be instanceof di&&be.response?.data?.message?En(be.response.data.message):En("An unexpected error occurred")}};x.useEffect(()=>{e&&rt()},[e]),x.useEffect(()=>{console.log("lineItems state changed:",b)},[b]),x.useEffect(()=>{m(b)},[b]),x.useEffect(()=>{k(!1),St(null)},[e]);const Pt=be=>Ww(tl(be.quantity),tl(be.unit_cost)),Kt=x.useMemo(()=>y.map(be=>({part_number:be.part_number,part_description:be.part_description,quantity:tl(be.quantity),unit:be.unit,unit_cost:tl(be.unit_cost)})),[y]),ar=x.useMemo(()=>Ode(Kt,E),[Kt,E]),kr=ar.subtotal,rn=ar.total_gst_amount,Vr=ar.total_amount,$n=x.useCallback(be=>JSON.stringify(be.map(we=>({part_number:we.part_number.trim(),part_description:we.part_description.trim(),quantity:parseFloat(String(we.quantity)),unit:we.unit.trim(),unit_cost:parseFloat(String(we.unit_cost))})).sort((we,Ee)=>we.part_number!==Ee.part_number?we.part_number.localeCompare(Ee.part_number):we.quantity-Ee.quantity)),[]);x.useEffect(()=>{je&&(!Array.isArray(oe)||oe.length===0||m(be=>{let we=!1;const Ee=be.map(Me=>{const Ne=String(Me.part_number||"").trim().toUpperCase();if(!Ne)return Me;const mt=(oe||[]).find(Yn=>String(Yn.part_number).trim().toUpperCase()===Ne);if(!mt)return Me;let Tt=Me;const Lt=String(mt.unit||"").trim(),Ar=String(Me.unit||"").trim();Lt&&!Ar&&(Tt={...Tt,unit:Lt},we=!0);const zr=String(mt.part_description||"");zr&&zr!==String(Me.part_description||"")&&(Tt={...Tt,part_description:zr},we=!0);const hn=parseFloat(String(Me.unit_cost));if(!Number.isFinite(hn)||hn===0){const Yn=parseFloat(String(mt.last_unit_cost))||0;Yn>0&&Yn!==hn&&(Tt={...Tt,unit_cost:String(Yn)},we=!0)}if(Tt!==Me){const Yn=Pt(Tt);Tt={...Tt,line_amount:Yn}}return Tt});return we?Ee:be}))},[je,oe]),x.useEffect(()=>{if(!n&&!it&&a&&Yr===""&&je){console.log("[PO Detail] Setting initial signature for dirty tracking");const be=JSON.stringify({vendor:s?{id:s.id,label:s.label}:null,billNumber:h.trim(),date:c?.toISOString(),lineItems:$n(b),pickup_time:a.pickup_time||null,pickup_location:a.pickup_location||null,pickup_contact_person:a.pickup_contact_person||null,pickup_phone:a.pickup_phone||null,pickup_instructions:a.pickup_instructions||null,pickup_notes:a.pickup_notes||null,order_placed:a.order_placed||!1,order_placed_at:a.order_placed_at||null,order_placed_by:a.order_placed_by||null,order_placed_method:a.order_placed_method||null,vendor_confirmation_status:a.vendor_confirmation_status||"pending",vendor_confirmation_notes:a.vendor_confirmation_notes||null,vendor_confirmation_date:a.vendor_confirmation_date||null,pricing_updated:a.pricing_updated||!1,pricing_updated_at:a.pricing_updated_at||null,pricing_updated_by:a.pricing_updated_by||null,pricing_updated_method:a.pricing_updated_method||null,quantity_adjusted:a.quantity_adjusted||!1,quantity_adjusted_at:a.quantity_adjusted_at||null,quantity_adjusted_by:a.quantity_adjusted_by||null,quantity_adjusted_method:a.quantity_adjusted_method||null,original_quantities:a.original_quantities||null,adjusted_quantities:a.adjusted_quantities||null,vendor_pricing_notes:a.vendor_pricing_notes||null});Kr(be)}},[n,it,a,je,Yr]);const ka=x.useMemo(()=>JSON.stringify({vendor:s?{id:s.id,label:s.label}:null,billNumber:h.trim(),date:c?.toISOString(),lineItems:$n(b),pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null}),[s,h,c,b,a]),Ya=!!Yr&&Yr!==ka&&!ot;x.useEffect(()=>{console.log("[PO Detail] isDirty changed:",{isDirty:Ya,hasInitialSignature:!!Yr,signaturesMatch:Yr===ka,initialSignature:Yr.slice(0,100)+"...",currentSignature:ka.slice(0,100)+"..."}),console.log("[PO Detail] About to render UnsavedChangesGuard with when=",Ya)},[Ya,Yr,ka]),x.useEffect(()=>{console.log("Aggregate quantities changed:",I),Object.keys(I).length>0&&_(be=>{const we=be.map(Ee=>{const Me=I[Ee.part_number]||I[Ee.part_number.toUpperCase()]||I[Ee.part_number.toLowerCase()]||0,Ne=typeof Me=="string"?parseFloat(Me):Me;return{...Ee,quantity_to_order:Ne}});return console.log("Updated line items from aggregate quantities effect:",we),we})},[I]);const to=(be,we,Ee)=>{_(Me=>{const Ne=[...Me];if(!Ne[be])return console.log("Item at index",be,"not found in handleLineItemChange"),Me;const mt={...Ne[be],[we]:Ee};return we==="quantity"&&parseFloat(Ee)<=0?Ne.filter((Tt,Lt)=>Lt!==be):((we==="quantity"||we==="unit_cost")&&(mt.line_amount=Pt(mt)),Ne[be]=mt,Ne)})},qi=()=>{_(be=>[...be,{part_number:"",part_description:"",quantity:"",unit:rl[0],unit_cost:"",line_amount:0,quantity_to_order:0}])},Gn=be=>{const we=[],Ee=[];if(!be||be.length===0)return{mapped:we,pending:Ee};const Me=Ne=>Ne?Ne.trim().toUpperCase():"";return be.filter(Ne=>Ne.description&&Ne.description.trim().length>0||Ne.partNumber&&Ne.partNumber.trim().length>0).forEach(Ne=>{const mt=tl(Ne.quantity??0),Tt=Ne.unitCost!==null&&Ne.unitCost!==void 0&&String(Ne.unitCost).trim()!=="",Lt=Tt?tl(Ne.unitCost):0,Ar=Tt?Lt:tl(Ne.match?.lastUnitCost??0),zr=Ne.match?.status==="existing"?Me(Ne.match?.matchedPartNumber||Ne.partNumber||Ne.match?.normalizedPartNumber||""):Me(Ne.match?.suggestedPartNumber||Ne.partNumber||Ne.normalizedPartNumber||""),hn=Ne.description||Ne.match?.partDescription||"",aa=Ne.match?.status==="existing"?Ne.match?.unit||Ne.unit||rl[0]:Ne.unit||rl[0],Yn=Ne.match?.status==="existing"?Tt?String(Ne.unitCost):Ne.match?.lastUnitCost!=null?String(Ne.match.lastUnitCost):"":Ne.unitCost!=null?String(Ne.unitCost):"",Pi={part_number:zr,part_description:hn,quantity:Ne.quantity!==null&&Ne.quantity!==void 0?String(Ne.quantity):"",unit:aa,unit_cost:Yn,line_amount:Ww(mt,Ar),quantity_to_order:0},oi=we.length;if(we.push(Pi),Ne.match?.status==="missing"&&zr){const Ia={part_number:Me(Ne.match.suggestedPartNumber||zr),part_description:Ne.description||"",unit:Ne.unit||rl[0],last_unit_cost:Ne.unitCost??"",part_type:"stock",category:"Uncategorized"};Ee.push({index:oi,suggestion:Ia})}else if(Ne.match?.status==="existing"&&Ne.match.descriptionMatches===!1){const Ia=`Invoice description for part "${Ne.match.matchedPartNumber||zr}" differs from inventory. Create a new part using the invoice details?`;if(typeof window<"u"?window.confirm(Ia):!1){const Ui={part_number:Me(Ne.match.suggestedPartNumber||zr),part_description:Ne.description||"",unit:Ne.unit||Ne.match?.unit||rl[0],last_unit_cost:Ne.unitCost??Ne.match?.lastUnitCost??"",part_type:"stock",category:"Uncategorized"};Ee.push({index:oi,suggestion:Ui})}}}),{mapped:we,pending:Ee}},hi=async be=>{const we=be.target.files?Array.from(be.target.files):[];if(we.length!==0){Fe(null),Ge(!0);try{const Ee=await bde(we);se(Ee);const Me=we.length>1?`${we.length} documents`:"the uploaded document";ge.success(`Gemini analysis completed for ${Me}. Review the detected values before applying them.`)}catch(Ee){console.error("Error processing OCR document:",Ee);let Me="Failed to analyze the document with AI. Please ensure OCR and Gemini are configured on the server.";Ee instanceof di&&Ee.response?.data?.error?Me=Ee.response.data.error:Ee?.message&&(Me=Ee.message),Fe(Me),ge.error(Me)}finally{Ge(!1),be.target&&(be.target.value="")}}},ro=()=>{if(!ee)return;const{normalized:be}=ee.ocr,we=be.vendorMatch,Ee=we?.vendorName||be.vendorName||"";if(we&&we.status==="existing"&&we.vendorId){const Me=R.find(Tt=>Tt.id===we.vendorId),Ne=we.matchedVendorName||Ee,mt=we.details?.email||"";if(Me)l(Me),K(Me.label);else{const Tt={label:Ne||Ee,id:we.vendorId,email:mt};F(Lt=>Lt.some(Ar=>Ar.id===we.vendorId)?Lt:[...Lt,Tt]),l(Tt),K(Tt.label)}Ne&&ge.info(`Matched invoice vendor to "${Ne}".`)}else if(we&&we.status==="missing"&&Ee){l(null),K(Ee);const Me={vendor_name:Ee,street_address:we.details?.streetAddress||"",city:we.details?.city||"",province:we.details?.province||"",country:we.details?.country||"",postal_code:we.details?.postalCode||"",contact_person:we.details?.contactPerson||"",telephone_number:we.details?.telephone||"",email:we.details?.email||"",website:we.details?.website||""};ii(Me),(typeof window<"u"?window.confirm(`Vendor "${Ee}" was not found. Would you like to add this vendor now?`):!1)?Ci(!0):ge.warn(`Vendor "${Ee}" is not in the system. Review the captured details before continuing.`)}else if(Ee){const Me=R.find(Ne=>Ne.label.toLowerCase()===Ee.toLowerCase());Me?(l(Me),K(Me.label)):(l(null),K(Ee))}if(be.billNumber&&p(be.billNumber),be.billDate){const Me=Rt(be.billDate);Me.isValid()&&u(Me)}if(typeof be.gstRate=="number"&&!Number.isNaN(be.gstRate)&&S(be.gstRate),be.lineItems?.length){const{mapped:Me,pending:Ne}=Gn(be.lineItems);Me.length>0&&(_(Me),m(Me)),pt(Ne)}else pt([]);ge.success("OCR data applied. Please review the form before saving.")},Qe=async be=>{const we=be.toUpperCase();if(!he[we])try{const Ee=await Jm(we);me(Me=>({...Me,[we]:Ee}))}catch{}},Vt=(be,we)=>{const Ee=he[be.toUpperCase()]||[];if(Ee.length===0)return be;if(we){const mt=Ee.filter(Tt=>Tt.vendor_id===we);if(mt.length>0){const Tt=mt.find(Ar=>Ar.preferred);if(Tt)return Tt.vendor_part_number;const Lt=[...mt].sort((Ar,zr)=>(zr.usage_count||0)-(Ar.usage_count||0))[0];if(Lt)return Lt.vendor_part_number}}const Me=Ee.find(mt=>mt.preferred);if(Me)return Me.vendor_part_number;const Ne=[...Ee].sort((mt,Tt)=>(Tt.usage_count||0)-(mt.usage_count||0))[0];return Ne?Ne.vendor_part_number:be};x.useEffect(()=>{s&&_(be=>be.map(we=>{const Ee=(we.part_number||"").toUpperCase(),Me=he[Ee];if(!Me||Me.length===0)return we;const Ne=Vt(Ee,s?.id||null);return{...we,part_number:Ne}}))},[s,he]);const or=be=>{_(we=>we.filter((Ee,Me)=>Me!==be))},Fr=be=>oe.find(we=>we.part_number===be),Er=(be,we)=>{console.log("handlePartNumberChange called:",{idx:be,newValue:we,inventoryItemsLength:oe.length}),m(Ee=>{const Me=[...Ee],Ne=Me[be];if(console.log("Current item before change:",Ne),!Ne)return console.log("Current item not found, creating default item"),Me[be]={part_number:"",part_description:"",quantity:"",unit:rl[0],unit_cost:"",line_amount:0,quantity_to_order:0},Me;if(we===null||typeof we=="string"&&we.trim()==="")console.log("Resetting line item to empty values"),!Ne.part_number&&!Ne.part_description&&!Ne.quantity&&!Ne.unit_cost?Me[be]={...Ne,part_number:"",part_description:"",quantity:"",unit:rl[0],unit_cost:"",line_amount:0,quantity_to_order:0}:console.log("Preserving existing data despite empty input value");else if(typeof we!="string"&&we.isNew){console.log("Opening part dialog for new part"),kt(be);const mt=we.inputValue||"";jt(mt),$e({part_number:mt.toUpperCase(),category:"Uncategorized"}),Je("manual"),wt(!0)}else if(typeof we=="string"){const mt=Fr(we);console.log("Found inventory item:",mt);const Tt=I[we]||I[we.toUpperCase()]||I[we.toLowerCase()]||0,Lt=typeof Tt=="string"?parseFloat(Tt):Tt;if(console.log(`Quantity to order for ${we}:`,Tt,"as number:",Lt),console.log("Available aggregate quantities keys:",Object.keys(I)),console.log("Looking for part:",we,"in aggregate quantities:",I),mt){const Ar=Ne.unit_cost,zr=!Ar||Ar===""||Ar==="0";Me[be]={...Ne,part_number:we,part_description:mt.part_description,unit:mt.unit,unit_cost:zr?String(mt.last_unit_cost):Ar,quantity_to_order:Lt}}else console.log("Inventory item not found, preserving existing data"),Me[be]={...Ne,part_number:we,quantity_to_order:Lt}}return Me[be].line_amount=Pt(Me[be]),console.log("Updated item after change:",Me[be]),Me}),typeof we=="string"&&we.trim()!==""&&qe()},jn=async(be,we)=>{if(!be||be.trim()==="")return!1;try{return(await ve.get("/api/purchase-history/check-bill-number",{params:{bill_number:be.trim(),exclude_purchase_id:we}})).data.exists}catch(Ee){return console.error("Error checking duplicate bill number:",Ee),!1}},Lr=(be=!1,we=!1)=>{let Ee={};s||(Ee.vendor="Vendor is required."),c||(Ee.date="Date is required."),be&&!h.trim()&&(Ee.billNumber="Bill Number is required.");const Me=b.map(mt=>({part_number:mt.part_number,part_description:mt.part_description,quantity:tl(mt.quantity),unit:mt.unit,unit_cost:tl(mt.unit_cost)})),Ne=Tde(Me,s,we);return Ne.lineItems&&b.length>0&&(Ee.lineItems=Ne.lineItems),fn(Ee),Ee},ra=async()=>{const be=Lr(!1,!1);if(Object.keys(be).length>0){ge.error("Please correct the errors before saving.");return}if(!(h&&h.trim()&&await jn(h,a?.purchase_id)&&!window.confirm(`Warning: Bill number "${h}" already exists in another purchase order. Do you want to proceed anyway?`))){Oe(!0);try{if(n){const we={vendor_id:s?.id,purchase_date:c?.toISOString(),date:d||c?.toISOString(),bill_number:h.trim(),lineItems:b.map(Ne=>({part_number:Ne.part_number.trim(),part_description:Ne.part_description.trim(),unit:Ne.unit.trim(),quantity:parseFloat(String(Ne.quantity)),unit_cost:parseFloat(String(Ne.unit_cost)),line_amount:parseFloat(String(Ne.line_amount))})),status:"Open",subtotal:kr,total_gst_amount:rn,total_amount:Vr,global_gst_rate:E,company_id:r?.company_id,created_by:r?.id,pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null};if(console.log("Creating new purchase order:",we),window.__poCreateInFlight){console.log("[PO] Skipping duplicate create (in flight)");return}window.__poCreateInFlight=!0;const Ee=await ve.post("/api/purchase-orders",we);ge.success("Purchase Order created successfully!");const Me=Ee.data.purchase_id;window.__unsavedGuardAllowNext=!0,t(`/open-purchase-orders/${Me}`)}else{const we=w==="Closed"&&P,Ee={...a,vendor_id:s?.id,purchase_date:c?.toISOString(),date:d||c?.toISOString()||a?.date,bill_number:h.trim(),lineItems:b.map(Ne=>({...Ne,part_number:Ne.part_number.trim(),part_description:Ne.part_description.trim(),unit:Ne.unit.trim(),quantity:parseFloat(String(Ne.quantity)),unit_cost:parseFloat(String(Ne.unit_cost)),line_amount:parseFloat(String(Ne.line_amount))})),status:w,subtotal:kr,total_gst_amount:rn,total_amount:Vr,global_gst_rate:E,gst_rate:E,pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null};console.log("Sending to backend (handleSave):",Ee);const Me=await ve.put(`/api/purchase-orders/${e}`,Ee);In("Purchase Order updated successfully!"),we&&(await rt(),T(!1)),setTimeout(()=>{window.__unsavedGuardAllowNext=!0},100),we||Kr(JSON.stringify({vendor:s,billNumber:h,date:c,lineItems:b,pickup_time:a?.pickup_time,pickup_location:a?.pickup_location,pickup_contact_person:a?.pickup_contact_person,pickup_phone:a?.pickup_phone,pickup_instructions:a?.pickup_instructions,pickup_notes:a?.pickup_notes,order_placed:a?.order_placed,order_placed_at:a?.order_placed_at,order_placed_by:a?.order_placed_by,order_placed_method:a?.order_placed_method,vendor_confirmation_status:a?.vendor_confirmation_status,vendor_confirmation_notes:a?.vendor_confirmation_notes,vendor_confirmation_date:a?.vendor_confirmation_date,pricing_updated:a?.pricing_updated,pricing_updated_at:a?.pricing_updated_at,pricing_updated_by:a?.pricing_updated_by,pricing_updated_method:a?.pricing_updated_method,quantity_adjusted:a?.quantity_adjusted,quantity_adjusted_at:a?.quantity_adjusted_at,quantity_adjusted_by:a?.quantity_adjusted_by,quantity_adjusted_method:a?.quantity_adjusted_method,original_quantities:a?.original_quantities,adjusted_quantities:a?.adjusted_quantities,vendor_pricing_notes:a?.vendor_pricing_notes}))}}catch(we){if(console.error("Error saving Purchase Order:",we),we instanceof di&&we.response?.data?.error){const Ee=we.response.data,Me=Ee.details?` (${Ee.details})`:"";ge.error(`Error saving Purchase Order: ${Ee.error}${Me}`)}else ge.error("Error saving Purchase Order. Please try again.")}finally{Oe(!1),window.__poCreateInFlight=!1}}},bn=async()=>{if(w==="Closed"&&!(Ya&&!window.confirm("Discard your edits to this closed purchase order?")))try{await rt()}finally{T(!1)}},Ta=async()=>{if(!a?.purchase_id){ge.error("Purchase order not loaded. Cannot export.");return}if(a.status!=="Closed"){ge.error("Only closed purchase orders can be exported to QuickBooks.");return}if(a.exported_to_qbo){ge.error("Purchase order has already been exported to QuickBooks.");return}hs(!0);try{const be=await ve.post(`/api/purchase-orders/${a.purchase_id}/export-to-qbo`);ge.success("Exported to QuickBooks successfully!"),o(we=>we&&{...we,exported_to_qbo:!0})}catch(be){const we=be?.response?.data?.error||"Failed to export to QuickBooks.";ge.error(we)}finally{hs(!1)}},Ea=async()=>{a?.purchase_id&&await ni()},ni=async()=>{if(!a?.purchase_id)return;const be=Lr(!0,!0);if(Object.keys(be).length>0){be.lineItems?.some(Me=>Me.unit_cost)?ge.error("Unit cost is required for all line items before closing a purchase order."):(Jr(!0),ge.error("A bill number is required to close the purchase order."));return}if(!(await jn(h,a.purchase_id)&&!window.confirm(`Warning: Bill number "${h}" already exists in another purchase order. Do you want to proceed with closing this purchase order anyway?`)))try{const Ee={...a,vendor_id:s?.id,purchase_date:c?.toISOString(),bill_number:h.trim(),lineItems:b.map(Ne=>({...Ne,part_number:Ne.part_number.trim(),part_description:Ne.part_description.trim(),unit:Ne.unit.trim(),quantity:parseFloat(String(Ne.quantity)),unit_cost:parseFloat(String(Ne.unit_cost)),line_amount:parseFloat(String(Ne.line_amount))})),status:"Closed",subtotal:kr,total_gst_amount:rn,total_amount:Vr,global_gst_rate:E,gst_rate:E,pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null},Me=await ve.put(`/api/purchase-orders/${a.purchase_id}`,Ee);Me.status===200?(console.log("Purchase Order closed:",Me.data),ge.success("Purchase Order closed successfully!"),o(Ne=>Ne&&{...Ne,status:"Closed"}),A("Closed"),t(`/open-purchase-orders/${a.purchase_id}`)):ge.error("Failed to close purchase order")}catch(Ee){if(console.error("Error closing purchase order:",Ee),Ee instanceof di&&Ee.response?.data?.error){const Me=Ee.response.data.error;Me.toLowerCase().includes("negative quantity")||Me.toLowerCase().includes("insufficient inventory")||Me.toLowerCase().includes("inventory constraint")?ge.error(`Cannot close: ${Me}`):ge.error(`Error closing PO: ${Me}`)}else ge.error("Failed to close purchase order. Please try again.")}},na=()=>{t(`/open-purchase-orders/${a?.purchase_id}`)},An=()=>{rt(),ge.success("Allocation changes saved successfully. Purchase order remains open.")},Hr=async()=>{if(!Lr(!1)){ge.error("Please correct the errors before proceeding with allocation.");return}try{const be={...a,vendor_id:s?.id,purchase_date:c?.toISOString(),bill_number:h.trim(),lineItems:b.map(we=>({...we,part_number:we.part_number.trim(),part_description:we.part_description.trim(),unit:we.unit.trim(),quantity:parseFloat(String(we.quantity)),unit_cost:parseFloat(String(we.unit_cost)),line_amount:parseFloat(String(we.line_amount))})),subtotal:kr,total_gst_amount:rn,total_amount:Vr,global_gst_rate:E,gst_rate:E,pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null};await ve.put(`/api/purchase-orders/${a.purchase_id}`,be),o(be),oo(!0),ge.success("Changes saved successfully. Opening allocation modal...")}catch(be){console.error("Error saving changes before allocation:",be),be instanceof di&&be.response?.data?.error?ge.error(`Error saving changes: ${be.response.data.error}`):ge.error("Failed to save changes before allocation. Please try again.")}},no=async()=>{if(!a?.purchase_id){ge.error("Purchase order not loaded. Cannot download PDF.");return}try{const be=await ve.get(`/api/purchase-orders/${a.purchase_id}/pdf`,{responseType:"blob"}),we=window.URL.createObjectURL(new Blob([be.data])),Ee=document.createElement("a");Ee.href=we,Ee.download=`purchase_order_${a.purchase_number}.pdf`,document.body.appendChild(Ee),Ee.click(),Ee.remove(),window.URL.revokeObjectURL(we)}catch(be){console.error("Error downloading PDF:",be),ge.error("Failed to download PDF. Please try again.")}},ao=async()=>{await ra(),!(Object.keys(Dr).length>0)&&await no()},io=()=>{if(!a)return;const be=b.map(Ee=>Ee.quantity),we=prompt(`Enter adjusted quantities (comma-separated, e.g., 50,100,25):
Current quantities: `+be.join(", ")+`
Note: Adjust based on vendor minimum orders (e.g., sold by 10ft packs)`);if(we)try{const Ee=we.split(",").map(Me=>parseFloat(Me.trim()));if(Ee.length!==b.length){ge.error("Number of quantities must match number of line items");return}_(Me=>Me.map((Ne,mt)=>({...Ne,quantity:Ee[mt]}))),o(Me=>Me&&{...Me,quantity_adjusted:!0,quantity_adjusted_at:new Date().toISOString(),quantity_adjusted_by:Number(r?.id),quantity_adjusted_method:"manual",original_quantities:be,adjusted_quantities:Ee}),ge.success("Quantities adjusted based on vendor confirmation")}catch{ge.error("Invalid quantity format. Please use numbers separated by commas.")}},[ji,oo]=x.useState(!1),[pi,Oo]=x.useState(!1),[Fi,fs]=x.useState(""),[so,hs]=x.useState(!1),[Ka,lo]=x.useState(!1),[ai,dc]=x.useState([]),[Bn,Yo]=x.useState(!1),[ko,br]=x.useState(null),[Al,fc]=x.useState({}),Si=async()=>{if(a?.purchase_id){Yo(!0),br(null);try{const be=await ve.get(`/api/purchase-history/${a.purchase_id}/allocations`);dc(be.data||[]);const we=Array.from(new Set((be.data||[]).map(Ee=>Ee.sales_order_id).filter(Boolean)));if(we.length>0)try{const Ee=await Promise.all(we.map(Ne=>ve.get(`/api/sales-orders/${Ne}`))),Me={};Ee.forEach((Ne,mt)=>{const Tt=we[mt],Lt=Ne.data?.salesOrder?.sales_order_number||Ne.data?.salesOrder?.sales_number||"";Lt&&(Me[Tt]=Lt)}),fc(Me)}catch(Ee){console.warn("Unable to fetch one or more sales order numbers:",Ee)}lo(!0)}catch(be){console.error("Error fetching allocations:",be),br("Failed to load allocations."),lo(!0)}finally{Yo(!1)}}},[Fs,Ci]=x.useState(!1),[Ko,ii]=x.useState({}),$i=be=>be.normalize("NFD").replace(/[-]/g,"").replace(/[^a-zA-Z0-9\s]/g," ").replace(/\s+/g," ").trim().toUpperCase(),hc=(be,we)=>{const Ee=$i(we);if(!Ee)return be.slice(0,8);const Me=be.map(Ne=>{const mt=$i(Ne.label);let Tt=-1;return mt.startsWith(Ee)?Tt=3:mt.split(" ").some(Lt=>Lt.startsWith(Ee))?Tt=2:mt.includes(Ee)&&(Tt=1),{opt:Ne,score:Tt}}).filter(Ne=>Ne.score>=0);return Me.sort((Ne,mt)=>mt.score-Ne.score||Ne.opt.label.localeCompare(mt.opt.label)),Me.slice(0,8).map(Ne=>Ne.opt)},$s=be=>{const we=$i(be);return R.find(Ee=>$i(Ee.label)===we)||null},co=be=>{const we=$i(be),Ee=oe.find(Me=>$i(Me.part_number)===we);return Ee?Ee.part_number:null},To=be=>{const we=z.trim(),Ee=be.key==="Enter",Me=be.key==="Tab",Ne=be.key==="Escape",mt=be.key==="ArrowDown"||be.key==="ArrowUp";if(Ne){k(!1);return}if(mt){be.key==="ArrowDown"&&!L&&k(!0);return}if(Ee||Me){if(Ee&&be.ctrlKey&&we){be.preventDefault(),U(!0),ii({vendor_name:we}),Ci(!0),k(!1);return}if(L){if(Ee){const Lt=C;Lt&&Lt.isNew&&(be.preventDefault(),U(!0),ii({vendor_name:we}),Ci(!0),k(!1))}return}const Tt=$s(we);if(!we)return;be.preventDefault(),Tt?(l(Tt),K(Tt.label)):(U(!0),ii({vendor_name:we}),Ci(!0),k(!1))}},Eo=(be,we)=>{const Ee=(b[be]?.part_number||"").trim(),Me=we.key==="Enter",Ne=we.key==="Tab",mt=we.key==="Escape",Tt=we.key==="ArrowDown"||we.key==="ArrowUp";if(mt){St(null);return}if(Tt){we.key==="ArrowDown"&&at!==be&&St(be);return}if(!(at===be&&(Me||Ne))&&(Me||Ne)){if(Me&&we.ctrlKey&&Ee){we.preventDefault(),Mr(be),jt(Ee),kt(be),$e({part_number:Ee.toUpperCase(),category:"Uncategorized"}),Je("manual"),wt(!0),St(null);return}const Lt=co(Ee);if(!Ee)return;we.preventDefault(),Lt?Er(be,Lt):(Mr(be),jt(Ee),kt(be),$e({part_number:Ee.toUpperCase(),category:"Uncategorized"}),Je("manual"),wt(!0),St(null))}},Pl=()=>{wt(!1),kt(null),$e(void 0),Je("manual"),jt("")},Ai=be=>{const we=R.find(Ee=>Ee.id===be);return console.log("Getting vendor email for vendor ID:",be),console.log("Selected vendor:",we),console.log("Vendor email:",we?.email),we?.email||""},Bs=async()=>{if(!s?.id){ge.error("Please select a vendor first");return}if(n){if(!Lr(!1)){ge.error("Please correct the errors before sending email.");return}try{const be={vendor_id:s?.id,purchase_date:c?.toISOString(),bill_number:h.trim(),lineItems:b.map(mt=>({part_number:mt.part_number.trim(),part_description:mt.part_description.trim(),unit:mt.unit.trim(),quantity:parseFloat(String(mt.quantity)),unit_cost:parseFloat(String(mt.unit_cost)),line_amount:parseFloat(String(mt.line_amount))})),status:"Open",subtotal:kr,total_gst_amount:rn,total_amount:Vr,global_gst_rate:E,company_id:r?.company_id,created_by:r?.id,pickup_time:a?.pickup_time||null,pickup_location:a?.pickup_location||null,pickup_contact_person:a?.pickup_contact_person||null,pickup_phone:a?.pickup_phone||null,pickup_instructions:a?.pickup_instructions||null,pickup_notes:a?.pickup_notes||null,order_placed:a?.order_placed||!1,order_placed_at:a?.order_placed_at||null,order_placed_by:a?.order_placed_by||null,order_placed_method:a?.order_placed_method||null,vendor_confirmation_status:a?.vendor_confirmation_status||"pending",vendor_confirmation_notes:a?.vendor_confirmation_notes||null,vendor_confirmation_date:a?.vendor_confirmation_date||null,pricing_updated:a?.pricing_updated||!1,pricing_updated_at:a?.pricing_updated_at||null,pricing_updated_by:a?.pricing_updated_by||null,pricing_updated_method:a?.pricing_updated_method||null,quantity_adjusted:a?.quantity_adjusted||!1,quantity_adjusted_at:a?.quantity_adjusted_at||null,quantity_adjusted_by:a?.quantity_adjusted_by||null,quantity_adjusted_method:a?.quantity_adjusted_method||null,original_quantities:a?.original_quantities||null,adjusted_quantities:a?.adjusted_quantities||null,vendor_pricing_notes:a?.vendor_pricing_notes||null};console.log("Creating new purchase order for email:",be);const Ee=(await ve.post("/api/purchase-orders",be)).data;o(Ee);const Me=Ee.purchase_id;t(`/open-purchase-orders/${Me}`);const Ne=Ai(s.id);fs(Ne),Oo(!0),ge.success("Purchase Order created and email modal opened!")}catch(be){console.error("Error creating Purchase Order for email:",be),be instanceof di&&be.response?.data?.error?ge.error(`Error creating Purchase Order: ${be.response.data.error}`):ge.error("Error creating Purchase Order. Please try again.")}}else{const be=Ai(s.id);console.log("Email button clicked - vendor ID:",s.id),console.log("Retrieved email:",be),fs(be),Oo(!0)}};x.useEffect(()=>{console.log("Part modal state changed - openPartDialog:",We,"partNumberForModal:",Wt,"partToAddIndex:",Nt)},[We,Wt,Nt]),x.useEffect(()=>{if(!We&&Ue.length>0){const[be,...we]=Ue;pt(we),kt(be.index),jt(be.suggestion.part_number?String(be.suggestion.part_number):""),$e({part_number:be.suggestion.part_number??"",part_description:be.suggestion.part_description??"",unit:be.suggestion.unit??rl[0],last_unit_cost:be.suggestion.last_unit_cost??"",quantity_on_hand:be.suggestion.quantity_on_hand??"",reorder_point:be.suggestion.reorder_point??"",part_type:be.suggestion.part_type??"stock",category:be.suggestion.category??"Uncategorized"}),Je("ocr"),wt(!0)}},[We,Ue]),x.useEffect(()=>{We&&St(null)},[We]),x.useEffect(()=>{if(s?.id){const be=Ai(s.id);console.log("Vendor changed - updating email:",be),fs(be)}else fs("")},[s,R]);const Bi=()=>{if(!a)return null;const be=b||[];let we=be.reduce((Ne,mt)=>Ne+(Number(mt.line_amount)||0),0),Ee=we*(a.global_gst_rate||5)/100,Me=we+Ee;return isNaN(we)&&(we=0),isNaN(Ee)&&(Ee=0),isNaN(Me)&&(Me=0),i.jsxs(Z,{p:{xs:2,md:4},maxWidth:1e3,mx:"auto",children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Purchase Order Details"}),i.jsx(qr,{variant:"outlined",sx:{mb:3},children:i.jsx(Wr,{children:i.jsxs(ie,{container:!0,spacing:{xs:2,md:3},children:[i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Purchase Order #:"})," ",a.purchase_number]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Vendor:"})," ",a.vendor_name||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Purchase Date:"})," ",a.purchase_date?new Date(a.purchase_date).toLocaleDateString():""]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Transaction Date:"})," ",d?new Date(d).toLocaleDateString():""]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Created On:"})," ",a.created_at?new Date(a.created_at).toLocaleDateString():"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Status:"})," ",a.status?.toUpperCase()||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"Bill Number:"})," ",a.bill_number||"N/A"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"GST Rate:"})," ",(a.global_gst_rate||5).toFixed(2),"%"]}),i.jsxs(ie,{item:!0,xs:12,sm:6,children:[i.jsx("b",{children:"QuickBooks Export:"})," ",a.exported_to_qbo?"Exported":a.qbo_export_status?`Error: ${a.qbo_export_status}`:"Not Exported"]})]})})}),a.return_orders&&i.jsx(Z,{mb:3,children:Us()}),i.jsx(B,{variant:"h5",gutterBottom:!0,children:"Items"}),i.jsx(qr,{variant:"outlined",children:i.jsx(Wr,{children:be.map((Ne,mt)=>i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,sm:3,md:2,children:Ne.part_number}),i.jsx(ie,{item:!0,xs:6,sm:5,md:4,children:Ne.part_description}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1.5,children:Ne.quantity}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1.5,children:Ne.unit}),i.jsxs(ie,{item:!0,xs:4,sm:2,md:1.5,children:["$",Hne(Number(Ne.unit_cost)||0)]}),i.jsx(ie,{item:!0,xs:4,sm:2,md:1,children:za(Number(Ne.line_amount)||0)})]},mt))})}),i.jsxs(Z,{mt:4,display:"flex",flexDirection:"column",alignItems:"flex-end",children:[i.jsxs(B,{variant:"h6",children:["Subtotal: ",za(we)]}),i.jsxs(B,{variant:"h6",children:["Total GST: ",za(Ee)]}),i.jsxs(B,{variant:"h6",children:["Total Amount: ",za(Me)]})]}),i.jsxs(Z,{mt:4,display:"flex",justifyContent:{xs:"center",sm:"flex-end"},gap:2,children:[i.jsx(xe,{variant:"contained",color:"primary",startIcon:i.jsx(la,{}),onClick:ao,children:"Download PDF"}),!a?.exported_to_qbo&&r?.access_role==="Admin"&&i.jsx(xe,{variant:"contained",color:"success",startIcon:i.jsx(Cp,{}),onClick:Ta,disabled:so,children:so?"Exporting...":"Export to QuickBooks"}),(r?.access_role==="Admin"||r?.access_role==="Sales and Purchase")&&i.jsx(xe,{variant:"contained",color:"secondary",startIcon:i.jsx(tu,{}),onClick:()=>T(!0),children:"Edit"}),i.jsx(xe,{variant:"outlined",color:"primary",onClick:Si,children:"View Allocations"})]}),i.jsxs(pr,{open:Ka,onClose:()=>lo(!1),maxWidth:"md",fullWidth:!0,children:[i.jsx(mr,{children:"Allocations"}),i.jsxs(gr,{dividers:!0,children:[Bn&&i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",py:4,children:i.jsx(tr,{})}),!Bn&&ko&&i.jsx(Ot,{severity:"error",children:ko}),!Bn&&!ko&&(()=>{if(!ai||ai.length===0)return i.jsx(B,{variant:"body2",children:"No allocations were saved for this purchase order."});const Ne=ai.reduce((Tt,Lt)=>{const Ar=(Lt.part_number||"").toString();return Tt[Ar]||(Tt[Ar]=[]),Tt[Ar].push(Lt),Tt},{}),mt=Object.keys(Ne).sort();return i.jsx(dt,{spacing:3,children:mt.map(Tt=>{const Lt=Ne[Tt],Ar=Lt.find(hn=>hn.part_description)?.part_description||"",zr=Lt.reduce((hn,aa)=>hn+(Number(aa.allocate_qty)||0),0);return i.jsxs(Z,{children:[i.jsxs(B,{variant:"subtitle1",sx:{fontWeight:"bold"},children:[Tt," ",Ar?`- ${Ar}`:""]}),i.jsx(pa,{component:bt,sx:{mt:1},children:i.jsxs(Jn,{size:"small",children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{children:"Sales Order"}),i.jsx(Ae,{children:"Sales Order Number"}),i.jsx(Ae,{align:"right",children:"Allocated Qty"})]})}),i.jsxs(ea,{children:[Lt.map(hn=>i.jsxs(hr,{children:[i.jsxs(Ae,{children:["#",hn.sales_order_id]}),i.jsx(Ae,{children:Al[hn.sales_order_id]?`SO-${Al[hn.sales_order_id]}`:"-"}),i.jsx(Ae,{align:"right",children:Number(hn.allocate_qty||0).toFixed(2)})]},hn.allocation_id)),i.jsxs(hr,{children:[i.jsx(Ae,{sx:{fontWeight:600},children:"Total"}),i.jsx(Ae,{align:"right",sx:{fontWeight:600},children:zr.toFixed(2)})]})]})]})})]},Tt)})})})()]}),i.jsx(jr,{children:i.jsx(xe,{onClick:()=>lo(!1),children:"Close"})})]})]})},Us=()=>{if(!a)return null;const be=a.return_orders??[],we=a.return_summary??{};return i.jsxs(bt,{sx:{p:3},elevation:1,children:[i.jsxs(dt,{direction:{xs:"column",md:"row"},alignItems:{xs:"flex-start",md:"center"},justifyContent:"space-between",spacing:2,children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"h6",children:"Return Orders"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"View vendor returns associated with this purchase order."})]}),i.jsxs(dt,{direction:"row",spacing:1,children:[i.jsx(st,{label:`Requested: ${we.requested_count??0}`,color:"warning",variant:"outlined",size:"small"}),i.jsx(st,{label:`Returned: ${we.returned_count??0}`,color:"success",variant:"outlined",size:"small"}),i.jsx(xe,{variant:"outlined",onClick:()=>t(`/return-orders/new?purchaseId=${a.purchase_id}`),children:"Create Return"})]})]}),be.length===0?i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"No return orders have been logged for this purchase order."}):i.jsx(pa,{component:Z,sx:{mt:2},children:i.jsxs(Jn,{size:"small",children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{children:"Return #"}),i.jsx(Ae,{children:"Status"}),i.jsx(Ae,{children:"Requested"}),i.jsx(Ae,{children:"Returned"}),i.jsx(Ae,{align:"right",children:"Total Qty"}),i.jsx(Ae,{align:"right",children:"Actions"})]})}),i.jsx(ea,{children:be.map(Ee=>i.jsxs(hr,{hover:!0,children:[i.jsx(Ae,{children:Ee.return_number}),i.jsx(Ae,{children:i.jsx(st,{label:Ee.status,size:"small",color:Ee.status==="Returned"?"success":"warning",variant:"outlined"})}),i.jsx(Ae,{children:Ee.requested_at?new Date(Ee.requested_at).toLocaleString():""}),i.jsx(Ae,{children:Ee.returned_at?new Date(Ee.returned_at).toLocaleString():""}),i.jsx(Ae,{align:"right",children:Number(Ee.total_quantity??0).toFixed(2)}),i.jsx(Ae,{align:"right",children:i.jsx(xe,{size:"small",onClick:()=>t(`/return-orders/${Ee.return_id}`),children:"View"})})]},Ee.return_id))})]})})]})};return!n&&!a?i.jsx(Z,{p:4,children:i.jsx(B,{variant:"h5",children:"Loading Purchase Order..."})}):it?i.jsx(Z,{p:4,children:i.jsx(B,{variant:"h5",children:"Loading..."})}):!n&&w==="Closed"&&!P?Bi():i.jsxs(i.Fragment,{children:[i.jsxs(Os,{dateAdapter:oc,children:[i.jsx(Ry,{when:Ya,onSave:ra}),i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:n?"Create New Purchase Order":`Edit Purchase Order: ${a?.purchase_number}`}),!n&&a&&i.jsxs(i.Fragment,{children:[i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2,mt:1},children:[i.jsx(st,{label:a.order_placed?"Order Placed":"Order Not Placed",color:a.order_placed?"success":"warning",variant:"outlined",size:"small"}),i.jsx(st,{label:`Vendor: ${a.vendor_confirmation_status||"pending"}`,color:a.vendor_confirmation_status==="confirmed"?"success":a.vendor_confirmation_status==="partial"?"warning":a.vendor_confirmation_status==="unavailable"?"error":"default",variant:"outlined",size:"small"}),a.pricing_updated&&i.jsx(st,{label:"Pricing Updated",color:"info",variant:"outlined",size:"small"}),a.quantity_adjusted&&i.jsx(st,{label:"Quantities Adjusted",color:"secondary",variant:"outlined",size:"small"})]}),a.created_at&&i.jsxs(B,{variant:"subtitle1",color:"text.secondary",sx:{mt:1},children:["Created On: ",new Date(a.created_at).toLocaleDateString()]})]})]}),i.jsxs(dt,{direction:"row",spacing:1,children:[i.jsx(xe,{variant:"contained",color:"primary",onClick:ra,startIcon:i.jsx(Is,{}),children:n?"Create Purchase Order":w==="Closed"&&P?"Save Closed PO Edits":"Save Changes"}),!n&&w==="Closed"&&P&&i.jsx(xe,{variant:"outlined",color:"secondary",onClick:bn,startIcon:i.jsx(Hp,{}),children:"Cancel Edit"}),!n&&i.jsxs(i.Fragment,{children:[w!=="Closed"&&i.jsx(xe,{variant:"contained",color:"primary",onClick:Ea,startIcon:i.jsx(xv,{}),children:"Close PO"}),i.jsx(xe,{variant:"contained",color:"primary",onClick:ao,startIcon:i.jsx(la,{}),children:"Download PDF"}),i.jsx(xe,{variant:"contained",onClick:Bs,startIcon:i.jsx(yS,{}),sx:{backgroundColor:"#ff9800","&:hover":{backgroundColor:"#f57c00"}},children:"Email Vendor"})]})]})]}),!n&&a&&i.jsx(Z,{sx:{mb:3},children:Us()}),er&&i.jsxs(Ot,{severity:"warning",sx:{mb:3},onClose:()=>Jr(!1),children:[i.jsx(B,{variant:"body1",sx:{fontWeight:"medium"},children:"Bill Number Required"}),i.jsx(B,{variant:"body2",children:"A bill number is required to close this purchase order. Please enter a bill number before closing."})]}),i.jsx(qr,{variant:"outlined",sx:{mb:3},children:i.jsxs(Wr,{children:[i.jsxs(dt,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:{xs:"stretch",sm:"center"},children:[i.jsxs(Z,{sx:{flexGrow:1},children:[i.jsx(B,{variant:"h6",children:"Invoice / Packing Slip OCR Prefill"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Upload one or multiple invoice/packing slip images (or a PDF) to extract vendor, bill, and line item details using on-server OCR."})]}),i.jsx("input",{type:"file",accept:"image/*,.pdf",multiple:!0,hidden:!0,ref:Xe,onChange:hi}),i.jsx(xe,{variant:"contained",color:"secondary",startIcon:i.jsx(Cp,{}),onClick:()=>Xe.current?.click(),disabled:V,children:V?"Processing":"Upload Documents"}),V&&i.jsx(tr,{size:24})]}),De&&i.jsx(Ot,{severity:"error",sx:{mt:2},children:De}),ee&&i.jsxs(Z,{sx:{mt:3},children:[i.jsxs(dt,{direction:{xs:"column",md:"row"},spacing:2,alignItems:{xs:"flex-start",md:"center"},children:[i.jsxs(Z,{sx:{flexGrow:1},children:[i.jsxs(dt,{direction:"row",spacing:1,alignItems:"center",children:[i.jsx(B,{variant:"subtitle1",children:"Detected Fields"}),i.jsx(st,{size:"small",color:ee.source==="ai"?"info":"default",variant:ee.source==="ai"?"filled":"outlined",label:ee.source==="ai"?"Gemini AI analysis":"OCR extraction"})]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Review the extracted details and apply them to this purchase order."}),ee.files?.length?i.jsx(dt,{direction:"row",spacing:1,sx:{flexWrap:"wrap",mt:1},children:ee.files.map(be=>i.jsx(st,{size:"small",label:be.originalName,variant:"outlined"},be.storedName))}):ee.file?i.jsx(B,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:ee.file.originalName}):null]}),i.jsx(dt,{direction:"row",spacing:1,children:i.jsx(xe,{variant:"contained",color:"primary",onClick:ro,children:"Apply to Form"})})]}),i.jsxs(ie,{container:!0,spacing:2,sx:{mt:1},children:[i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsx(B,{variant:"body2",color:"text.secondary",children:"Vendor"}),i.jsx(B,{variant:"body1",children:ee.ocr.normalized.vendorName||"Not detected"}),ee.ocr.normalized.vendorAddress&&i.jsx(B,{variant:"body2",color:"text.secondary",children:ee.ocr.normalized.vendorAddress})]}),i.jsxs(ie,{item:!0,xs:12,md:3,children:[i.jsx(B,{variant:"body2",color:"text.secondary",children:"Bill Number"}),i.jsx(B,{variant:"body1",children:ee.ocr.normalized.billNumber||"Not detected"})]}),i.jsxs(ie,{item:!0,xs:12,md:3,children:[i.jsx(B,{variant:"body2",color:"text.secondary",children:"Bill Date"}),i.jsx(B,{variant:"body1",children:ee.ocr.normalized.billDate||"Not detected"})]})]}),ee.ocr.normalized.lineItems.length>0&&i.jsxs(Z,{sx:{mt:2},children:[i.jsxs(B,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Sample of detected line items (",ee.ocr.normalized.lineItems.length," total)"]}),i.jsx(bt,{variant:"outlined",sx:{maxHeight:200,overflowY:"auto",p:1},children:ee.ocr.normalized.lineItems.slice(0,5).map((be,we)=>i.jsxs(Z,{sx:{py:.5},children:[i.jsxs(B,{variant:"body2",sx:{fontWeight:500},children:[be.partNumber?`${be.partNumber}  `:"",be.description]}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:["Qty: ",be.quantity??"n/a"," | Unit Cost: ",be.unitCost??"n/a"," | Total: ",be.totalCost??"n/a"]})]},`${be.rawLine}-${we}`))})]}),(ee.ocr.warnings.length>0||ee.ocr.notes.length>0)&&i.jsxs(dt,{direction:"row",spacing:1,sx:{mt:2,flexWrap:"wrap"},children:[ee.ocr.warnings.map((be,we)=>i.jsx(st,{label:be,color:"warning",variant:"outlined",sx:{mr:1,mb:1}},`ocr-warning-${we}`)),ee.ocr.notes.map((be,we)=>i.jsx(st,{label:be,color:"info",variant:"outlined",sx:{mr:1,mb:1}},`ocr-note-${we}`))]})]})]})}),i.jsx(bt,{sx:{p:3},children:i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Ra,{disablePortal:!1,open:L,onOpen:()=>k(!0),onClose:()=>k(!1),autoHighlight:!0,value:s,onChange:(be,we)=>{if(H){U(!1);return}we&&we.isNew?(Ci(!0),ii({vendor_name:z}),l(null),K(""),k(!1)):(l(we),k(!1))},filterOptions:(be,we)=>{const Ee=hc(be,we.inputValue||""),Me=!!$s(we.inputValue||""),Ne=[...Ee];return(we.inputValue||"").trim()!==""&&!Me&&Ne.push({label:`Add "${we.inputValue}" as New Vendor`,isNew:!0}),Ee.length===0&&(we.inputValue||"").trim()!==""&&!Me,Ne},inputValue:z,onInputChange:(be,we,Ee)=>{if(K(we),Ee==="reset")return;(we||"").trim()||k(!1)},options:R,getOptionLabel:be=>typeof be=="string"?be:be.label,isOptionEqualToValue:(be,we)=>be.id===we.id,onHighlightChange:(be,we)=>M(we),ListboxProps:{role:"listbox",style:{maxHeight:320,overflowY:"auto"}},renderOption:(be,we)=>{const Ee=we.isNew,{key:Me,...Ne}=be;return i.jsxs("li",{...Ne,style:{display:"flex",alignItems:"center",opacity:Ee?.9:1},children:[Ee&&i.jsx(ec,{fontSize:"small",style:{marginRight:8,color:"#666"}}),i.jsx("span",{children:we.label})]},Me)},renderInput:be=>i.jsx(Pe,{...be,label:"Vendor",error:!!Dr.vendor,helperText:Dr.vendor,onFocus:vt,onKeyDown:To,onBlur:()=>{if(k(!1),!s){const we=z.trim();if(we){const Ee=$s(we);Ee&&(l(Ee),K(Ee.label))}}},inputRef:we=>{J.current=we}})})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"Bill Number",value:h,onChange:be=>{p(be.target.value),be.target.value.trim()!==""&&Jr(!1)},fullWidth:!0,error:!!Dr.billNumber,helperText:Dr.billNumber})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"GST Rate (%)",type:"number",value:E,onChange:be=>S(Number(be.target.value)),fullWidth:!0,inputProps:{min:0,max:100,step:"0.01",readOnly:w==="Closed"&&!P,onWheel:be=>be.currentTarget.blur()},helperText:"Change GST rate if needed (default 5%). This will affect GST and total calculations.",disabled:w==="Closed"&&!P})})]})}),i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:3,mb:2},children:[i.jsx(B,{variant:"h6",children:"Line Items"}),i.jsx(xe,{variant:"contained",onClick:Hr,startIcon:i.jsx(xv,{}),sx:{backgroundColor:n?"#e0e0e0":"#ff9800",color:"#fff","&:hover":{backgroundColor:n?"#e0e0e0":"#f57c00"},"&.Mui-disabled":{color:"#fff"}},disabled:n,children:"  Allocate Parts"})]}),i.jsxs(bt,{sx:{p:3,mb:3,mt:0},elevation:3,children:[i.jsx(ie,{container:!0,spacing:2,children:b.map((be,we)=>i.jsxs(Ce.Fragment,{children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Ra,{disablePortal:!1,open:at===we,onOpen:()=>St(we),onClose:()=>St(null),autoHighlight:!0,value:be.part_number,inputValue:nr[we]??be.part_number,onInputChange:(Ee,Me,Ne)=>{if(Cr(Tt=>({...Tt,[we]:Me})),Ne==="reset")return;(Me||"").trim()||St(null)},onChange:(Ee,Me)=>{if(typeof Me=="string"){const Ne=Me,mt=oe.find(Ar=>Ar.part_number===Ne),Tt=I[Ne]||I[Ne?.toUpperCase?.()||""]||I[Ne?.toLowerCase?.()||""]||0,Lt=typeof Tt=="string"?parseFloat(Tt):Tt;_(Ar=>{const zr=[...Ar],hn=zr[we];if(mt){const aa=hn.unit_cost,Pi=String(!aa||aa===""||aa==="0"?mt.last_unit_cost:aa),oi={...hn,part_number:Ne,part_description:mt.part_description,unit:mt.unit,unit_cost:Pi,quantity_to_order:Lt};if(oi.line_amount=Pt(oi),zr[we]=oi,Qe(mt.part_number),s?.id){const Ia=(()=>{const Fa=he[mt.part_number.toUpperCase()]||[];if(Fa.length===0)return null;const Ui=Fa.filter(Oi=>Oi.vendor_id===s.id);if(Ui.length>0){const Oi=Ui.find(Wi=>Wi.preferred);if(Oi)return Oi.vendor_part_number;const zi=[...Ui].sort((Wi,ps)=>(ps.usage_count||0)-(Wi.usage_count||0))[0];if(zi)return zi.vendor_part_number}const uo=Fa.find(Oi=>Oi.preferred);if(uo)return uo.vendor_part_number;const Io=[...Fa].sort((Oi,zi)=>(zi.usage_count||0)-(Oi.usage_count||0))[0];return Io?Io.vendor_part_number:null})();Ia&&(zr[we].part_number=Ia)}}else zr[we]={...hn,part_number:Ne};return zr}),Er(we,Ne),St(null),Cr(Ar=>({...Ar,[we]:""}))}else if(Me&&typeof Me=="object"&&"isNew"in Me){const Ne=Me.inputValue||"";jt(Ne),kt(we),$e({part_number:Ne.toUpperCase(),category:"Uncategorized"}),Je("manual"),wt(!0),St(null),Cr(mt=>({...mt,[we]:""}))}},options:oe.map(Ee=>Ee.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,getOptionLabel:Ee=>typeof Ee=="string"?Ee:Ee.label,renderOption:(Ee,Me)=>{const Ne=typeof Me=="object"&&Me.isNew,mt=typeof Me=="string"?Me:Me.label,{key:Tt,...Lt}=Ee;return i.jsxs("li",{...Lt,children:[Ne&&i.jsx(ec,{fontSize:"small",style:{marginRight:8,color:"#666"}}),typeof Me=="string"?i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",children:Me}),(()=>{const Ar=Ye[String(Me)]||"";return Ar?i.jsx(B,{variant:"caption",color:"text.secondary",children:Ar}):null})()]}):mt]},Tt)},filterOptions:(Ee,Me)=>Ze(Ee,Me,!0),ListboxProps:{role:"listbox",style:{maxHeight:320,overflowY:"auto"}},renderInput:Ee=>i.jsx(Pe,{...Ee,label:"Part Number",fullWidth:!0,required:!0,error:!!Dr.lineItems?.[we]?.part_number,helperText:Dr.lineItems?.[we]?.part_number,onKeyDown:Me=>Eo(we,Me),onBlur:()=>{St(null);const Ne=(b[we]?.part_number||"").trim();if(!Ne)return;const mt=co(Ne);if(mt){const Tt=oe.find(zr=>zr.part_number===mt),Lt=I[mt]||I[mt?.toUpperCase?.()||""]||I[mt?.toLowerCase?.()||""]||0,Ar=typeof Lt=="string"?parseFloat(Lt):Lt;_(zr=>{const hn=[...zr],aa=hn[we];if(Tt){const Yn=aa.unit_cost,oi=String(!Yn||Yn===""||Yn==="0"?Tt.last_unit_cost:Yn),Ia={...aa,part_number:mt,part_description:Tt.part_description,unit:Tt.unit,unit_cost:oi,quantity_to_order:Ar};Ia.line_amount=Pt(Ia),hn[we]=Ia}else hn[we]={...aa,part_number:mt};return hn}),Er(we,mt)}}})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(Pe,{label:"Part Description",value:be.part_description,InputProps:{readOnly:!0},fullWidth:!0,error:!!Dr.lineItems?.[we]?.part_description,helperText:Dr.lineItems?.[we]?.part_description})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Pe,{label:"Qty",value:be.quantity,onChange:Ee=>to(we,"quantity",Ee.target.value),type:"number",fullWidth:!0,required:!0,error:!!Dr.lineItems?.[we]?.quantity,helperText:Dr.lineItems?.[we]?.quantity,inputProps:{step:"1",onWheel:Ee=>Ee.currentTarget.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Pe,{label:"Unit",value:be.unit,select:!0,fullWidth:!0,disabled:!0,InputProps:{readOnly:!0},children:rl.map(Ee=>i.jsx(Zt,{value:Ee,children:Ee},Ee))})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Unit Cost",value:be.unit_cost,onChange:Ee=>to(we,"unit_cost",Ee.target.value),type:"number",fullWidth:!0,error:!!Dr.lineItems?.[we]?.unit_cost,helperText:Dr.lineItems?.[we]?.unit_cost,inputProps:{step:"0.0001",onWheel:Ee=>Ee.currentTarget.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Amount",value:be.line_amount!=null&&!isNaN(Number(be.line_amount))?Number(be.line_amount).toFixed(2):"0.00",InputProps:{readOnly:!0},fullWidth:!0})}),i.jsxs(ie,{item:!0,xs:12,sm:1,md:1,sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(xe,{variant:"outlined",color:"primary",onClick:()=>or(we),sx:{flexShrink:0},children:"Remove"}),(()=>{const Ee=n?"Open":w,Me=Ee==="Open"&&typeof be.quantity_to_order=="number"&&be.quantity_to_order>0;return console.log(`Rendering Qty to Order for ${be.part_number}:`,{status:w,isCreationMode:n,effectiveStatus:Ee,quantity_to_order:be.quantity_to_order,type:typeof be.quantity_to_order,shouldShow:Me}),Me?i.jsx(Pe,{label:"Qty to Order",value:be.quantity_to_order,size:"small",InputProps:{readOnly:!0},sx:{backgroundColor:"#fff3cd",minWidth:"120px","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#ffc107"},"&:hover fieldset":{borderColor:"#ffc107"}}}}):null})()]})]},we))}),i.jsx(Z,{sx:{mt:2},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:qi,children:"Add Line Item"})})]}),i.jsx(bt,{sx:{p:3,mb:3},elevation:3,children:i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Subtotal: $",kr!=null&&!isNaN(Number(kr))?Number(kr).toFixed(2):"0.00"]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Total GST: $",rn!=null&&!isNaN(Number(rn))?Number(rn).toFixed(2):"0.00"]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"h6",children:["Total Amount: $",Vr!=null&&!isNaN(Number(Vr))?Number(Vr).toFixed(2):"0.00"]})})]})}),i.jsx(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:3,mb:2},children:i.jsx(B,{variant:"h6",children:"Pickup Details for Drivers"})}),i.jsx(bt,{sx:{p:3,mb:3},elevation:3,children:i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Pickup Time",placeholder:"e.g., tomorrow at 2 PM, Friday morning",value:a?.pickup_time||"",onChange:be=>{a&&o({...a,pickup_time:be.target.value})},fullWidth:!0,helperText:"When to pick up the order"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Pickup Location",placeholder:"e.g., 123 Main St, Building A, Loading Dock",value:a?.pickup_location||"",onChange:be=>{a&&o({...a,pickup_location:be.target.value})},fullWidth:!0,helperText:"Where to pick up the order"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Contact Person",placeholder:"e.g., John Smith, Warehouse Manager",value:a?.pickup_contact_person||"",onChange:be=>{a&&o({...a,pickup_contact_person:be.target.value})},fullWidth:!0,helperText:"Name of person to contact at pickup location"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Contact Phone",placeholder:"e.g., (555) 123-4567",value:a?.pickup_phone||"",onChange:be=>{a&&o({...a,pickup_phone:be.target.value})},fullWidth:!0,helperText:"Phone number for pickup contact person"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Pickup Instructions",placeholder:"e.g., Use loading dock on east side, call 15 minutes before arrival, parking available in lot B",value:a?.pickup_instructions||"",onChange:be=>{a&&o({...a,pickup_instructions:be.target.value})},fullWidth:!0,multiline:!0,rows:3,helperText:"Special instructions for pickup (parking, loading dock, etc.)"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Pickup Notes",placeholder:"e.g., After-hours pickup available, bring ID, parts are in warehouse section C",value:a?.pickup_notes||"",onChange:be=>{a&&o({...a,pickup_notes:be.target.value})},fullWidth:!0,multiline:!0,rows:2,helperText:"General notes about pickup for drivers"})})]})}),i.jsx(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:3,mb:2},children:i.jsx(B,{variant:"h6",children:"Order Placement Tracking"})}),i.jsx(bt,{sx:{p:3,mb:3},elevation:3,children:i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx("input",{type:"checkbox",checked:a?.order_placed||!1,onChange:be=>{a&&o({...a,order_placed:be.target.checked,order_placed_at:be.target.checked?new Date().toISOString():void 0,order_placed_by:be.target.checked?Number(r?.id):void 0,order_placed_method:be.target.checked?"manual":void 0})},style:{transform:"scale(1.5)"}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:"bold"},children:"Order Placed with Vendor"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:a?.order_placed?`Placed on ${new Date(a.order_placed_at||"").toLocaleDateString()}`:"Order not yet placed"})]})]})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsxs(Pe,{select:!0,label:"Vendor Confirmation Status",value:a?.vendor_confirmation_status||"pending",onChange:be=>{a&&o({...a,vendor_confirmation_status:be.target.value,vendor_confirmation_date:be.target.value!=="pending"?new Date().toISOString():void 0})},fullWidth:!0,helperText:"Current vendor confirmation status",children:[i.jsx(Zt,{value:"pending",children:"Pending"}),i.jsx(Zt,{value:"confirmed",children:"Confirmed"}),i.jsx(Zt,{value:"partial",children:"Partially Available"}),i.jsx(Zt,{value:"unavailable",children:"Unavailable"})]})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Vendor Confirmation Notes",placeholder:"e.g., Parts available, pricing confirmed, minimum order 10ft packs",value:a?.vendor_confirmation_notes||"",onChange:be=>{a&&o({...a,vendor_confirmation_notes:be.target.value})},fullWidth:!0,multiline:!0,rows:2,helperText:"Notes from vendor about order confirmation, availability, and pricing"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx("input",{type:"checkbox",checked:a?.pricing_updated||!1,onChange:be=>{a&&o({...a,pricing_updated:be.target.checked,pricing_updated_at:be.target.checked?new Date().toISOString():void 0,pricing_updated_by:be.target.checked?Number(r?.id):void 0,pricing_updated_method:be.target.checked?"manual":void 0})},style:{transform:"scale(1.5)"}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:"bold"},children:"Pricing Updated"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:a?.pricing_updated?`Updated on ${new Date(a.pricing_updated_at||"").toLocaleDateString()}`:"Pricing not yet updated"})]})]})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx("input",{type:"checkbox",checked:a?.quantity_adjusted||!1,onChange:be=>{a&&o({...a,quantity_adjusted:be.target.checked,quantity_adjusted_at:be.target.checked?new Date().toISOString():void 0,quantity_adjusted_by:be.target.checked?Number(r?.id):void 0,quantity_adjusted_method:be.target.checked?"manual":void 0})},style:{transform:"scale(1.5)"}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:"bold"},children:"Quantities Adjusted"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:a?.quantity_adjusted?`Adjusted on ${new Date(a.quantity_adjusted_at||"").toLocaleDateString()}`:"Quantities not yet adjusted"})]})]})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Vendor Pricing Structure Notes",placeholder:"e.g., Sold by 10ft packs, minimum order 50ft, bulk pricing available over 100ft",value:a?.vendor_pricing_notes||"",onChange:be=>{a&&o({...a,vendor_pricing_notes:be.target.value})},fullWidth:!0,multiline:!0,rows:2,helperText:"Notes about vendor pricing structure, minimum orders, and packaging units"})}),i.jsxs(ie,{item:!0,xs:12,children:[i.jsx(Z,{sx:{display:"flex",justifyContent:"center",mt:2},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:io,disabled:!a||b.length===0,sx:{minWidth:"200px"},children:"Adjust Quantities (Vendor Confirmation)"})}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",mt:1},children:"Use this when vendor confirms different quantities (e.g., sold by 10ft packs)"})]}),(a?.original_quantities||a?.adjusted_quantities)&&i.jsxs(ie,{item:!0,xs:12,children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:"bold",mb:2},children:"Quantity Adjustments"}),i.jsx(ie,{container:!0,spacing:2,children:b.map((be,we)=>{const Ee=a?.original_quantities?.[we]||be.quantity,Me=a?.adjusted_quantities?.[we]||be.quantity;return Ee!==Me?i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsxs(bt,{sx:{p:2,backgroundColor:"#f5f5f5"},elevation:1,children:[i.jsx(B,{variant:"body2",sx:{fontWeight:"bold"},children:be.part_number}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Original: ",Ee,"  Adjusted: ",Me]})]})},we):null})})]})]})}),i.jsx(tc,{open:We,onClose:Pl,onSave:async be=>{try{const we=await ve.post("/api/inventory",be);console.log("New part added successfully:",we.data);const Ee=await ve.get("/api/inventory");ae(Ee.data);const Me=we.data.item;Nt!==null&&_(Ne=>{const mt=[...Ne];return mt[Nt]={...mt[Nt],part_number:Me.part_number,part_description:Me.part_description,unit:Me.unit,unit_cost:String(Me.last_unit_cost),quantity:mt[Nt].quantity},mt[Nt].line_amount=Pt(mt[Nt]),mt}),Pl()}catch(we){throw we}},title:He==="ocr"?"Add New Part from OCR":"Add New Part",initialPart:ur??{part_number:Wt.toUpperCase(),category:"Uncategorized"}}),i.jsx(JL,{open:Fs,onClose:()=>{Ci(!1),ii({})},onSave:async be=>{try{const Ee=(await ve.post("/api/vendors",be)).data.vendor;F(Me=>[...Me,{label:Ee.vendor_name,id:Ee.vendor_id,email:Ee.email}]),l({label:Ee.vendor_name,id:Ee.vendor_id,email:Ee.email}),!n&&a&&o(Me=>Me&&{...Me,vendor_id:Ee.vendor_id,vendor_name:Ee.vendor_name}),Ci(!1),ii({}),ge.success("Vendor added successfully!")}catch{ge.error("Failed to add vendor.")}},initialVendor:Ko,isEditMode:!1}),i.jsx(Pde,{open:ji,onClose:()=>oo(!1),purchaseOrderId:a?.purchase_id||0,onSuccess:na,onAllocationSaved:An}),i.jsx(eR,{open:pi,onClose:()=>Oo(!1),type:"purchase-order",recordId:a?.purchase_id,defaultTo:Fi,allowMessageEdit:!0}),pi&&i.jsxs("div",{style:{display:"none"},children:["Debug: vendorEmail = ",Fi,", vendor = ",JSON.stringify(s)]})]})]}),i.jsx(pl,{open:!!Vn,autoHideDuration:6e3,onClose:()=>In(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>In(null),severity:"success",sx:{width:"100%"},children:Vn})})]})},Ede=()=>{const e=Tn(),[t,r]=x.useState([]),[n,a]=x.useState({totalReceivables:0,totalOverdue:0}),[o,s]=x.useState(!1),[l,c]=x.useState(!0),[u,d]=x.useState(0),f=x.useRef(0),h=200,[p,v]=x.useState([]),[m,y]=x.useState(null),[b,_]=x.useState(""),[w,A]=x.useState(null),[P,T]=x.useState(!1),[E,S]=x.useState(!1),[I,W]=x.useState(""),[O,D]=x.useState("unpaid"),[R,F]=x.useState(()=>{const Ye=new Date;return`${Ye.getFullYear()}-${String(Ye.getMonth()+1).padStart(2,"0")}`}),[z,K]=x.useState(!1),[J,L]=x.useState(!1),k=x.useRef(null),$=x.useRef(null),X="invoices.columnVisibility",[C,M]=x.useState(()=>{if(typeof window>"u")return{};const Ye=localStorage.getItem(X);if(Ye)try{return JSON.parse(Ye)}catch{}return{}}),[H,U]=x.useState(null),[te,le]=x.useState([]);x.useEffect(()=>{typeof window<"u"&&localStorage.setItem(X,JSON.stringify(C))},[C]),x.useEffect(()=>{(async()=>{try{const Ye=await dS();v(Ye.map(Ze=>({id:Ze.customer_id||Ze.id,label:Ze.customer_name})))}catch(Ye){console.error("Failed to load customers",Ye)}})()},[]),x.useEffect(()=>{(async()=>{if(!m?.id){A(null);return}try{const Ze=await KL(String(m.id));A(Ze)}catch(Ze){console.error("Failed to load customer detail",Ze),A(null)}})()},[m?.id]);const oe=(Ye,Ze)=>{le(Ze),U(Ye.currentTarget)},ae=()=>U(null),he=x.useMemo(()=>{if(O!=="all")return O==="paid"?"Paid":"Unpaid"},[O]),me=x.useCallback(async(Ye=!1)=>{const Ze=Ye?0:f.current;Ye&&(f.current=0,d(0),c(!0)),s(!0);try{const We=await h4({customer_id:m?.id,status:he,limit:h,offset:Ze}),wt=We.invoices.map(kt=>({...kt,id:kt.invoice_id}));r(kt=>Ye?wt:[...kt,...wt]),a(We.summary);const Nt=Ze+wt.length;f.current=Nt,d(Nt),c(We.hasMore??wt.length===h)}catch(We){console.error("Failed to load invoices",We),Ye&&(r([]),d(0)),c(!1),a({totalReceivables:0,totalOverdue:0})}finally{s(!1)}},[m?.id,he]),Q=x.useCallback(async()=>{s(!0);try{const Ye=await h4({customer_id:m?.id,status:he}),Ze=Ye.invoices.map(We=>({...We,id:We.invoice_id}));r(Ze),a(Ye.summary),f.current=Ze.length,d(Ze.length),c(!1)}catch(Ye){console.error("Failed to load all invoices",Ye),ge.error("Failed to load all invoices")}finally{s(!1)}},[m?.id,he]);x.useEffect(()=>{me(!0)},[me,m?.id,he]);const G=Ye=>{e(`/invoices/${Ye.row.invoice_id}`)},ee=x.useCallback(async Ye=>{if(Ye&&window.confirm("Delete this invoice? This cannot be undone."))try{await bae(Ye),ge.success("Invoice deleted."),me(!0)}catch(Ze){console.error("Failed to delete invoice",Ze),ge.error("Failed to delete invoice.")}},[me]),se=x.useMemo(()=>{const Ye=[{field:"invoice_number",headerName:"Invoice #",flex:1,minWidth:140},{field:"customer_name",headerName:"Customer",flex:1.2,minWidth:160},{field:"sales_order_number",headerName:"SO #",minWidth:140,flex:1},{field:"product_name",headerName:"Product",minWidth:140,flex:1.1},{field:"product_description",headerName:"Product Description",minWidth:200,flex:1.5},{field:"vin_number",headerName:"VIN #",minWidth:120},{field:"unit_number",headerName:"Unit #",minWidth:120},{field:"mileage",headerName:"Mileage",minWidth:110},{field:"vehicle_make",headerName:"Make",minWidth:120},{field:"vehicle_model",headerName:"Model",minWidth:120},{field:"invoice_date",headerName:"Invoice Date",minWidth:130,valueFormatter:We=>We.value?new Date(We.value).toLocaleDateString():""},{field:"due_in",headerName:"Due In",minWidth:140,renderCell:We=>{const wt=We.row.due_date?new Date(We.row.due_date):null;if(!wt)return"";const Nt=new Date,kt=wt.getTime()-Nt.getTime(),Wt=Math.round(kt/(1e3*60*60*24)),jt=Wt<0,ur=`${Wt} day${Math.abs(Wt)===1?"":"s"}`;return i.jsxs(dt,{direction:"row",spacing:1,alignItems:"center",children:[i.jsx(B,{color:jt?"error":"success.main",fontWeight:600,children:ur}),jt&&i.jsx(UL,{color:"error",fontSize:"small"})]})},valueGetter:We=>We.row.due_date||null},{field:"status",headerName:"Status",minWidth:120,renderCell:We=>i.jsx(st,{label:We.value,color:We.value==="Paid"?"success":"default",size:"small"})},{field:"total_amount",headerName:"Total",minWidth:120,valueFormatter:We=>za(Number(We.value)||0)}],Ze={field:"actions",headerName:"Actions",type:"actions",width:90,getActions:We=>String(We.row.status||"").toLowerCase()!=="unpaid"?[]:[i.jsx(S8,{icon:i.jsx(ma,{color:"error"}),label:"Delete",onClick:wt=>{wt.stopPropagation(),ee(We.row.invoice_id)},showInMenu:!1},"delete")]};return[...Ye,Ze]},[ee]),V=x.useMemo(()=>{const Ye=I.toLowerCase();return t.filter(Ze=>[Ze.invoice_number,Ze.sales_order_number,Ze.customer_name,Ze.product_name,Ze.product_description,Ze.vin_number,Ze.unit_number,Ze.mileage,Ze.vehicle_make,Ze.vehicle_model,Ze.invoice_date?new Date(Ze.invoice_date).toLocaleDateString():"",Ze.due_date?new Date(Ze.due_date).toLocaleDateString():""].filter(We=>We!=null).some(We=>We.toString().toLowerCase().includes(Ye)))},[t,I]),Ge=x.useMemo(()=>t.filter(Ye=>{const Ze=Ye.due_date?new Date(Ye.due_date):null;return Ye.status==="Unpaid"&&Ze&&Ze<new Date}).length,[t]),De=async()=>{if(!R){ge.error("Select a month for the statement.");return}try{const Ye=await wae({month:R,customer_id:m?.id}),Ze=new Blob([Ye.data],{type:"application/pdf"}),We=window.URL.createObjectURL(Ze),wt=document.createElement("a");wt.href=We;const Nt=m?.label?m.label.replace(/\s+/g,"_"):"all-customers";wt.download=`statement-${Nt}-${R}.pdf`,wt.click(),window.URL.revokeObjectURL(We),ge.success("Statement downloaded.")}catch(Ye){console.error("Error downloading statements",Ye),ge.error("Failed to download statement.")}},Fe=async()=>{try{const Ye=await jae(),Ze=new Blob([Ye.data],{type:"text/csv"}),We=window.URL.createObjectURL(Ze),wt=document.createElement("a");wt.href=We,wt.download="invoice_import_template.csv",wt.click(),window.URL.revokeObjectURL(We),ge.success("Template downloaded.")}catch(Ye){console.error("Error downloading template",Ye),ge.error("Failed to download template.")}},Xe=()=>{k.current?.click()},it=()=>{$.current?.click()},lt=async Ye=>{const Ze=Ye.target.files?.[0];if(Ze){K(!0);try{const We=await Sae(Ze);ge.success(`Upload complete. Created: ${We.summary?.invoicesCreated??0}, skipped: ${We.summary?.invoicesSkipped??0}`),We.warnings?.length&&console.warn("Invoice CSV upload warnings:",We.warnings),me(!0)}catch(We){console.error("Error uploading invoice CSV",We);const wt=We?.response?.data?.error||"Failed to upload CSV",Nt=We?.response?.data?.errors?.[0];ge.error(Nt?`${wt}: ${Nt}`:wt)}finally{K(!1),k.current&&(k.current.value="")}}},vt=async Ye=>{const Ze=Ye.target.files?.[0];if(Ze){L(!0);try{const We=await Cae(Ze),wt=We.summary?.updated??0,Nt=We.summary?.missingInvoices??We.missingInvoices?.length??0;ge.success(`Unit upload complete. Updated: ${wt}${Nt?`, missing invoices: ${Nt}`:""}`),We.warnings?.length&&console.warn("Invoice unit CSV warnings:",We.warnings),me(!0)}catch(We){console.error("Error uploading invoice unit CSV",We);const wt=We?.response?.data?.error||"Failed to upload unit CSV",Nt=We?.response?.data?.warnings?.[0];ge.error(Nt?`${wt}: ${Nt}`:wt)}finally{L(!1),$.current&&($.current.value="")}}};return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(dt,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},mb:3,children:[i.jsx(B,{variant:"h4",children:"Invoices"}),i.jsxs(dt,{direction:"row",spacing:1,children:[i.jsx(xe,{startIcon:i.jsx(zw,{}),variant:"outlined",onClick:Ye=>oe(Ye,se),children:"Columns"}),i.jsx(xe,{startIcon:i.jsx(Es,{}),variant:"outlined",onClick:()=>me(!0),children:"Refresh"}),i.jsx(xe,{startIcon:i.jsx(la,{}),variant:"outlined",onClick:Fe,children:"Download Template"}),i.jsx(xe,{startIcon:i.jsx(Cd,{}),variant:"outlined",color:"secondary",onClick:it,disabled:J,children:J?"Uploading units...":"Upload Unit CSV"}),i.jsx(xe,{startIcon:i.jsx(Cd,{}),variant:"outlined",color:"secondary",onClick:Xe,disabled:z,children:z?"Uploading...":"Upload CSV"}),i.jsx(xe,{startIcon:i.jsx(Va,{}),variant:"contained",onClick:()=>e("/invoices/new"),children:"New Invoice"}),i.jsx(xe,{startIcon:i.jsx(la,{}),variant:"outlined",onClick:De,children:"Download Statement"})]})]}),i.jsx("input",{type:"file",accept:".csv,text/csv",ref:k,style:{display:"none"},onChange:lt}),i.jsx("input",{type:"file",accept:".csv,text/csv",ref:$,style:{display:"none"},onChange:vt}),i.jsx(bt,{sx:{mb:3,p:2,border:"1px solid",borderColor:"divider"},children:i.jsxs(dt,{direction:{xs:"column",sm:"row"},spacing:3,alignItems:"flex-start",children:[i.jsxs(Z,{children:[i.jsxs(B,{variant:"h6",sx:{fontWeight:"bold",color:"primary.main"},children:["Total Receivables: ",za(n.totalReceivables)]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Total value of all unpaid invoices"})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle1",children:"Overdue"}),i.jsx(B,{variant:"h6",color:n.totalOverdue>0?"error":"inherit",children:za(n.totalOverdue)})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle1",children:"Overdue Count"}),i.jsx(B,{variant:"h6",children:Ge})]})]})}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsxs(dt,{direction:"row",spacing:3,sx:{mb:2},flexWrap:"wrap",children:[i.jsx(Pe,{label:"Search",variant:"outlined",value:I,onChange:Ye=>W(Ye.target.value),InputProps:{startAdornment:i.jsx(sa,{position:"start",children:i.jsx(fi,{sx:{fontSize:22}})})},sx:{minWidth:300,maxWidth:380,"& .MuiInputBase-input":{fontSize:18,py:1.5},"& .MuiInputLabel-root":{fontSize:16}},size:"small"}),i.jsx(Pe,{label:"Statement Month",type:"month",value:R,onChange:Ye=>F(Ye.target.value),size:"small",sx:{minWidth:170},InputLabelProps:{shrink:!0}}),i.jsx(Ra,{options:p,getOptionLabel:Ye=>Ye.label,value:m,inputValue:b,onInputChange:(Ye,Ze)=>_(Ze),onChange:(Ye,Ze)=>y(Ze),renderInput:Ye=>i.jsx(Pe,{...Ye,label:"Customer (optional)",size:"small",placeholder:"Choose customer or leave empty for all",sx:{minWidth:260}}),clearOnBlur:!1}),i.jsx(st,{label:"All",onClick:()=>D("all"),color:O==="all"?"primary":"default",sx:{fontSize:16,px:3,py:1,minWidth:80,height:40}}),i.jsx(st,{label:"Unpaid",onClick:()=>D("unpaid"),color:O==="unpaid"?"primary":"default",sx:{fontSize:16,px:3,py:1,minWidth:90,height:40}}),i.jsx(st,{label:"Paid",onClick:()=>D("paid"),color:O==="paid"?"primary":"default",sx:{fontSize:16,px:3,py:1,minWidth:80,height:40}}),i.jsx(Z,{sx:{flexGrow:1}})]}),w&&i.jsx(bt,{variant:"outlined",sx:{p:2,mb:2,backgroundColor:"#fafafa",borderColor:"divider"},children:i.jsxs(dt,{direction:{xs:"column",md:"row"},spacing:2,justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},children:[i.jsxs(Z,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:1.5,flex:1},children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"caption",color:"text.secondary",children:"Email"}),i.jsx(B,{variant:"body1",children:w.email||""})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"caption",color:"text.secondary",children:"Phone"}),i.jsx(B,{variant:"body1",children:w.phone||w.phone_number||""})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"caption",color:"text.secondary",children:"Payment Terms"}),i.jsx(B,{variant:"body1",children:w.default_payment_terms_in_days!=null?`${w.default_payment_terms_in_days} days`:""})]}),i.jsxs(Z,{sx:{gridColumn:"1 / -1"},children:[i.jsx(B,{variant:"caption",color:"text.secondary",children:"General Notes"}),i.jsx(B,{variant:"body1",sx:{whiteSpace:"pre-wrap"},children:w.general_notes||""})]})]}),i.jsx(xe,{variant:"outlined",onClick:()=>{T(!0)},children:"Edit Customer"})]})}),i.jsx(Po,{rows:V,columns:se,loading:o,density:"comfortable",onRowClick:G,columnVisibilityModel:C,onColumnVisibilityModelChange:Ye=>M(Ye),getRowClassName:Ye=>{const Ze=Ye.row.due_date?new Date(Ye.row.due_date):null;return Ye.row.status==="Unpaid"&&Ze&&Ze<new Date?"overdue-row":""},initialState:{sorting:{sortModel:[{field:"invoice_number",sort:"desc"}]}},sx:{"& .overdue-row":{backgroundColor:"#fff5f5"},"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.05rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}}),i.jsxs(Z,{sx:{mt:2,display:"flex",justifyContent:"center",gap:2,flexWrap:"wrap"},children:[i.jsx(xe,{variant:"outlined",onClick:()=>me(!1),disabled:o||!l,children:o?"Loading...":l?"Load More":"No more invoices"}),i.jsx(xe,{variant:"contained",onClick:Q,disabled:o,children:o?"Loading...":"Load All"})]})]})}),i.jsx(Iv,{open:!!H,anchorEl:H,onClose:ae,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:i.jsxs(Z,{sx:{p:2,maxWidth:320},children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1.5},children:"Show / Hide Columns"}),i.jsx(Tp,{children:te.map(Ye=>i.jsx(ti,{control:i.jsx(Qi,{size:"small",checked:C[Ye.field]!==!1,onChange:Ze=>M(We=>({...We,[Ye.field]:Ze.target.checked}))}),label:Ye.headerName||Ye.field},Ye.field))})]})}),i.jsx(Wd,{open:P,onClose:()=>T(!1),isEditMode:!0,loading:E,initialCustomer:w?{customer_id:String(w.customer_id??w.id),customer_name:w.customer_name,contact_person:w.contact_person||"",email:w.email||"",phone_number:w.phone||w.phone_number||"",street_address:w.street_address||w.address||"",city:w.city||"",province:w.province||w.state||"",country:w.country||"",postal_code:w.postal_code||"",default_payment_terms_in_days:w.default_payment_terms_in_days,website:w.website||"",general_notes:w.general_notes||""}:void 0,onSave:async Ye=>{if(!w)return;S(!0);const Ze=Number(w.customer_id??w.id);try{const We=await fS(String(Ze),Ye);A(We),v(wt=>wt.map(Nt=>Nt.id===Ze?{...Nt,label:We.customer_name}:Nt)),m&&y({...m,label:We.customer_name}),me(!0),ge.success("Customer updated"),T(!1)}catch(We){console.error("Failed to update customer",We);const wt=We?.response?.data?.error||"Failed to update customer";ge.error(wt)}finally{S(!1)}}})]})},Ov=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim().toUpperCase(),Ide=(e,t,r=8)=>{const n=Ov(t||"");if(!n)return e.slice(0,r);const a=e.map(o=>{const s=Ov(o.label);let l=-1;return s.startsWith(n)?l=3:s.split(" ").some(c=>c.startsWith(n))?l=2:s.includes(n)&&(l=1),{opt:o,score:l}}).filter(o=>o.score>=0);return a.sort((o,s)=>s.score-o.score||o.opt.label.localeCompare(s.opt.label)),a.slice(0,r).map(o=>o.opt)},I2=()=>({part_id:null,part_number:"",part_description:"",quantity:1,unit:"",unit_price:0,line_amount:0}),Nde=()=>{const{id:e}=Ms(),t=e==="new",r=Tn(),[n,a]=x.useState({status:"Unpaid",product_name:"",product_description:"",vin_number:"",unit_number:"",vehicle_make:"",vehicle_model:"",source_sales_order_number:"",mileage:"",tech_story:""}),[o,s]=x.useState([I2()]),[l,c]=x.useState([]),[u,d]=x.useState([]),[f,h]=x.useState(null),[p,v]=x.useState(null),[m,y]=x.useState([]),[b,_]=x.useState(null),[w,A]=x.useState(""),[P,T]=x.useState(!1),E=x.useRef(!1),[S,I]=x.useState(!1),[W,O]=x.useState(""),[D,R]=x.useState(Rt()),[F,z]=x.useState(Rt().add(30,"day")),[K,J]=x.useState(!1),[L,k]=x.useState(!t),[$,X]=x.useState(!1),[C,M]=x.useState(null),[H,U]=x.useState(!1),te="invoiceDetail.fieldVisibility",le={...kd.invoices},[oe,ae]=x.useState(()=>{if(typeof window>"u")return le;const je=localStorage.getItem(te);if(je)try{return{...le,...JSON.parse(je)}}catch{}return le}),[he,me]=x.useState(le),[Q,G]=x.useState(null),[ee,se]=x.useState([]),[V,Ge]=x.useState(!1),De=x.useRef(null),Fe=x.useMemo(()=>{const je=o.reduce((Oe,qe)=>Oe+(Number(qe.line_amount)||0),0),Ve=Math.round(je*.05*100)/100,ot=Math.round((je+Ve)*100)/100;return{subtotal:je,gst:Ve,total:ot}},[o]),Xe=x.useCallback(async()=>{if(!E.current){E.current=!0,T(!0);try{const Ve=(await dS()).map(ot=>({id:ot.customer_id||ot.id,label:ot.customer_name,defaultTerms:Number(ot.default_payment_terms_in_days)||30}));y(Ve)}catch(je){console.error("Failed to load customers",je)}finally{E.current=!1,T(!1)}}},[]),it=x.useCallback(async je=>{if(!je){se([]),De.current=null;return}if(!(De.current===je&&ee.length)){De.current=je,Ge(!0);try{const ot=[...(await sR(je)).records||[]].sort((Oe,qe)=>{const rt=Oe.activity_date?new Date(Oe.activity_date).getTime():0;return(qe.activity_date?new Date(qe.activity_date).getTime():0)-rt});se(ot)}catch(Ve){console.error("Failed to load vehicle history for customer",Ve),se([])}finally{Ge(!1)}}},[ee.length]);x.useEffect(()=>{Xe()},[Xe]),x.useEffect(()=>{(async()=>{try{const[je,Ve,ot,Oe]=await Promise.all([ve.get("/api/inventory"),ve.get("/api/margin-schedule"),ve.get("/api/settings/labour-charge-rate").catch(()=>({data:{labour_charge_rate:null}})),ve.get("/api/settings/overhead-charge-rate").catch(()=>({data:{overhead_charge_rate:null}}))]);c(je.data||[]),d(Ve.data||[]),h(ot.data?.labour_charge_rate??null),v(Oe.data?.overhead_charge_rate??null)}catch(je){console.error("Failed to load inventory or margin schedule for invoices",je)}})()},[]),x.useEffect(()=>{typeof window<"u"&&localStorage.setItem(te,JSON.stringify(oe))},[oe]),x.useEffect(()=>{(async()=>{try{const je=await Cv.fetchSettings();me(je.invoices),ae(Ve=>{const ot={...Ve};let Oe=!1;return Object.keys(je.invoices).forEach(qe=>{!je.invoices[qe]&&ot[qe]&&(ot[qe]=!1,Oe=!0)}),Oe?ot:Ve})}catch(je){console.warn("Failed to load invoice field visibility defaults; using saved preferences",je)}})()},[]),x.useEffect(()=>{const je=b?.id??n.customer_id??null;it(je?Number(je):null)},[b?.id,n.customer_id,it]);const lt=x.useMemo(()=>{const je={...le};return Object.keys(je).forEach(Ve=>{je[Ve]=!!(he[Ve]&&oe[Ve])}),je},[he,oe]),{units:vt,vins:Ye,unitToVins:Ze,vinToUnits:We}=x.useMemo(()=>lR(ee),[ee]),wt=x.useMemo(()=>{const je=Av(n.unit_number);return je&&Ze[je]?Ze[je]:Ye},[n.unit_number,Ze,Ye]),Nt=x.useMemo(()=>{const je=Av(n.vin_number);return je&&We[je]?We[je]:vt},[n.vin_number,vt,We]),kt=async je=>{try{const Ve=await ve.get(`/api/sales-orders/${je}`),ot=Ve.data?.salesOrder||Ve.data;if(!ot)return;a(Oe=>({...Oe,product_name:Oe.product_name||ot.product_name||"",product_description:Oe.product_description||ot.product_description||"",vin_number:Oe.vin_number||ot.vin_number||"",unit_number:Oe.unit_number||ot.unit_number||"",vehicle_make:Oe.vehicle_make||ot.vehicle_make||"",vehicle_model:Oe.vehicle_model||ot.vehicle_model||"",mileage:Oe.mileage??ot.mileage??"",notes:Oe.notes||ot.terms||"",tech_story:Oe.tech_story||ot.tech_story||""}))}catch(Ve){console.warn("Failed to pull sales order defaults for invoice",Ve)}};x.useEffect(()=>{!t&&e&&(async()=>{k(!0);try{const je=await vae(e),Ve=je.invoice,ot=(je.lineItems||[]).map(qe=>({invoice_line_item_id:qe.invoice_line_item_id,part_id:qe.part_id??null,part_number:qe.part_number||"",part_description:qe.part_description||"",quantity:Number(qe.quantity)||0,unit:qe.unit||"",unit_price:Number(qe.unit_price)||0,line_amount:Number(qe.line_amount)||Math.round(Number(qe.quantity)*Number(qe.unit_price)*100)/100}));a({...Ve,tech_story:Ve.tech_story||""}),s(ot.length?ot:[I2()]);const Oe=Ve.customer_id?{id:Ve.customer_id,label:Ve.customer_name||`Customer ${Ve.customer_id}`,defaultTerms:Number(Ve.payment_terms_in_days)||Number(Ve.default_payment_terms_in_days)||30}:null;_(Oe||null),A(Oe?.label||""),R(Ve.invoice_date?Rt(Ve.invoice_date):Rt()),z(Ve.due_date?Rt(Ve.due_date):Rt().add(Oe?.defaultTerms||30,"day")),Ve.sales_order_id&&kt(Ve.sales_order_id)}catch(je){console.error("Failed to load invoice",je),M("Failed to load invoice")}finally{k(!1)}})()},[e,t]),x.useEffect(()=>{if(!m.length||!n.customer_id)return;const je=m.find(Ve=>Ve.id===n.customer_id);je&&(_(je),A(je.label))},[m,n.customer_id]),x.useEffect(()=>{t&&!K&&D&&b?.defaultTerms&&z(D.add(b.defaultTerms,"day"))},[b,D,K,t]);const Wt=x.useCallback(je=>{const Ve=(je||"").trim().toUpperCase();return l.find(ot=>String(ot.part_number||"").trim().toUpperCase()===Ve)},[l]),jt=x.useCallback((je,Ve)=>{const ot=u.filter(Pt=>Pt.product_id===(Ve??null)),Oe=u.filter(Pt=>Pt.product_id==null),qe=Pt=>{const Kt=[...Pt].sort((ar,kr)=>Number(ar.cost_lower_bound??0)-Number(kr.cost_lower_bound??0));for(const ar of Kt){const kr=Number(ar.cost_lower_bound??0),rn=ar.cost_upper_bound==null?null:Number(ar.cost_upper_bound),Vr=Number(ar.margin_factor??1);if(je>=kr&&(rn===null||je<rn))return Number.isFinite(Vr)&&Vr>0?Vr:1}return 1},rt=ot.length?qe(ot):1;return rt!==1?rt:qe(ot.length?ot:Oe)},[u]),ur=x.useCallback((je,Ve)=>{const ot=(je||"").trim().toUpperCase();if(ot==="LABOUR"||ot==="LABOR"||ot==="OVERHEAD"||ot==="SUPPLY")return!0;const Oe=(Ve||"").toLowerCase();return Oe==="labour"||Oe==="labor"||Oe==="overhead"||Oe==="supply"},[]),$e=x.useCallback((je,Ve)=>{const ot=Ve??(je.part_number?Wt(je.part_number):null);if(!ot||ur(je.part_number,ot.part_type))return{...je,part_id:ot?.part_id??je.part_id??null};const Oe=Number(ot.last_unit_cost??0);if(!Number.isFinite(Oe)||Oe<=0)return{...je,part_id:ot.part_id??je.part_id??null,part_description:je.part_description||ot.part_description||"",unit:je.unit||ot.unit||""};const qe=jt(Oe,ot.part_id??null),rt=Math.round(Oe*qe*100)/100,Pt=Number(je.quantity??0),Kt=Math.round(rt*Pt*100)/100;return{...je,part_id:ot.part_id??je.part_id??null,part_number:ot.part_number??je.part_number,part_description:je.part_description||ot.part_description||"",unit:je.unit||ot.unit||"",unit_price:rt,line_amount:Pt?Kt:je.line_amount}},[Wt,jt,ur]);x.useEffect(()=>{t&&l.length&&s(je=>je.map(Ve=>{const ot=Ve.part_number?Wt(Ve.part_number):null;return!ot||Ve.unit_price&&Ve.unit_price>0&&Ve.part_id?Ve:$e(Ve,ot)}))},[$e,Wt,l,t]);const He=(je,Ve,ot)=>{s(Oe=>{const qe=[...Oe],rt={...qe[je]};if(Ve==="part_number"){const Pt=String(ot||"").trim();rt.part_number=Pt,rt.part_id=null;const Kt=Pt.toUpperCase();if(!Pt)rt.part_description="",rt.unit="",rt.unit_price=0,rt.line_amount=0;else if(Kt==="LABOUR"||Kt==="LABOR"){const ar=f??0;rt.unit=rt.unit||"hr",rt.unit_price=ar;const kr=Number(rt.quantity)||0;rt.line_amount=Math.round(kr*ar*100)/100}else if(Kt==="OVERHEAD"){const ar=p??0;rt.unit=rt.unit||"hr",rt.unit_price=ar;const kr=Number(rt.quantity)||0;rt.line_amount=Math.round(kr*ar*100)/100}else{const ar=Wt(Pt);if(ar){const kr=$e({...rt,part_number:Pt},ar);return qe[je]=kr,qe}!rt.part_description&&!rt.unit_price&&(rt.part_description="",rt.unit_price=0,rt.line_amount=0)}}else if(Ve==="quantity"||Ve==="unit_price"){const Pt=Number(ot);rt[Ve]=Number.isFinite(Pt)?Pt:0,rt.line_amount=Math.round(Number(rt.quantity)*Number(rt.unit_price)*100)/100}else if(Ve==="line_amount"){const Pt=Number(ot);rt.line_amount=Number.isFinite(Pt)?Pt:0}else rt[Ve]=ot;return qe[je]=rt,qe})},Je=()=>G(null),Ue=()=>s(je=>[...je,I2()]),pt=je=>s(Ve=>Ve.filter((ot,Oe)=>Oe!==je)),at=x.useMemo(()=>l.map(je=>({part_number:je.part_number,part_description:je.part_description})),[l]),St=x.useMemo(()=>{const je={};for(const Ve of l||[])Ve?.part_number&&(je[String(Ve.part_number)]=Ve.part_description||"");return je},[l]),It=x.useCallback((je,Ve)=>{const ot=(Ve.inputValue||"").toUpperCase(),Oe=[];for(const qe of je){const rt=String(qe).toUpperCase(),Pt=(St[qe]||"").toUpperCase();if((!ot||rt.includes(ot)||Pt.includes(ot))&&(Oe.push(qe),Oe.length>=50))break}return ot&&!Oe.some(qe=>qe.toUpperCase()===ot)&&Oe.push(Ve.inputValue),Oe},[St]),Yt=async()=>{if(!b&&!n.customer_id){ge.error("Please select a customer");return}const je={customer_id:b?.id??n.customer_id,invoice_date:D?D.toISOString():void 0,due_date:F?F.toISOString():void 0,status:n.status||"Unpaid",payment_terms_in_days:n.payment_terms_in_days??b?.defaultTerms,notes:n.notes,tech_story:n.tech_story??null,sales_order_id:n.sales_order_id??null,source_sales_order_number:n.source_sales_order_number??null,product_name:n.product_name??"",product_description:n.product_description??"",vin_number:n.vin_number??"",unit_number:n.unit_number??"",vehicle_make:n.vehicle_make??"",vehicle_model:n.vehicle_model??"",mileage:n.mileage===""||n.mileage===null||n.mileage===void 0?null:Number(n.mileage),line_items:o.map(Ve=>({invoice_line_item_id:Ve.invoice_line_item_id,part_id:Ve.part_id,part_number:Ve.part_number,part_description:Ve.part_description,quantity:Number(Ve.quantity)||0,unit:Ve.unit,unit_price:Number(Ve.unit_price)||0,line_amount:Number(Ve.line_amount)||Math.round(Number(Ve.quantity)*Number(Ve.unit_price)*100)/100}))};X(!0);try{if(t){const Ve=await yae(je);ge.success("Invoice created"),r(`/invoices/${Ve.invoice_id}`)}else await xae(n.invoice_id,je),ge.success("Invoice updated")}catch(Ve){console.error("Failed to save invoice",Ve),ge.error("Failed to save invoice")}finally{X(!1)}},Sr=async()=>{if(!(t||!n.invoice_id)){U(!0);try{const je=await ve.get(`/api/invoices/${n.invoice_id}/pdf`,{responseType:"blob"}),Ve=window.URL.createObjectURL(new Blob([je.data],{type:"application/pdf"})),ot=document.createElement("a");ot.href=Ve,ot.download=`${n.invoice_number||"invoice"}.pdf`,document.body.appendChild(ot),ot.click(),ot.remove(),window.URL.revokeObjectURL(Ve)}catch(je){console.error("Failed to download invoice PDF",je),ge.error("Failed to download invoice PDF")}finally{U(!1)}}},Mr=x.useCallback((je,Ve)=>{const ot={};if(je!==void 0&&(ot.unit_number=je),Ve!==void 0&&(ot.vin_number=Ve),ee.length&&(je||Ve||n.unit_number||n.vin_number)){const Oe=cR(ee,je??n.unit_number,Ve??n.vin_number);Oe.unit_number&&(ot.unit_number=Oe.unit_number),Oe.vin_number&&(ot.vin_number=Oe.vin_number),Oe.vehicle_make&&(ot.vehicle_make=Oe.vehicle_make),Oe.vehicle_model&&(ot.vehicle_model=Oe.vehicle_model);const qe=Oe.mileage;if(qe!=null&&String(qe)!==""){const rt=Number(qe);ot.mileage=Number.isFinite(rt)?rt:qe}}a(Oe=>({...Oe,...ot}))},[n.unit_number,n.vin_number,ee]);if(L)return i.jsx(rr,{maxWidth:"md",sx:{mt:6,textAlign:"center"},children:i.jsx(B,{children:"Loading invoice..."})});if(C)return i.jsxs(rr,{maxWidth:"md",sx:{mt:6,textAlign:"center"},children:[i.jsx(B,{color:"error",children:C}),i.jsx(xe,{variant:"outlined",sx:{mt:2},onClick:()=>r("/invoices"),children:"Back to Invoices"})]});const nr=n.status==="Unpaid"&&F&&F.isBefore(Rt(),"day"),Cr={p:3,mb:3,border:"1px solid",borderColor:"divider",borderRadius:2,boxShadow:"0 8px 24px rgba(0,0,0,0.06)"},Dr={display:"grid",gap:2,gridAutoFlow:"row dense",alignItems:"stretch"},fn={...Dr,gridTemplateColumns:{xs:"1fr",sm:"repeat(2, minmax(0, 1fr))",md:"2fr 1fr 1fr"}},Oa={...Dr,gridTemplateColumns:{xs:"repeat(auto-fit, minmax(200px, 1fr))",md:"repeat(auto-fit, minmax(180px, 1fr))",lg:"repeat(auto-fit, minmax(160px, 1fr))"}},En={...Dr,gridTemplateColumns:{xs:"1fr",sm:"repeat(2, minmax(0, 1fr))",md:"repeat(3, minmax(0, 1fr))"}},er=!!(b?.id||n.customer_id),Jr=i.jsx(Ra,{options:m,value:b,inputValue:w,onInputChange:(je,Ve)=>A(Ve),loading:P,onFocus:Xe,onChange:(je,Ve)=>{if(!Ve){_(null),a(Oe=>({...Oe,customer_id:null}));return}if(typeof Ve=="object"&&Ve.isNew){const Oe=Ve.inputValue||w||"";O(Oe),I(!0);return}const ot=typeof Ve=="string"?m.find(Oe=>Oe.label===Ve)||null:Ve;_(ot),A(ot?.label||""),ot?.id&&a(Oe=>({...Oe,customer_id:ot.id}))},getOptionLabel:je=>typeof je=="string"?je:je.label,isOptionEqualToValue:(je,Ve)=>je.id===Ve.id,filterOptions:(je,Ve)=>{const ot=(Ve.inputValue||"").trim(),Oe=Ide(je,ot,10),qe=je.some(Pt=>Ov(Pt.label)===Ov(ot)),rt=[...Oe];return ot&&!qe&&rt.push({label:`Add "${Ve.inputValue}"`,isNew:!0,id:-1}),rt},renderInput:je=>i.jsx(Pe,{...je,label:"Customer",fullWidth:!0})}),Vn=er?i.jsx(Ra,{freeSolo:!0,options:wt,loading:V,value:n.vin_number||"",onInputChange:(je,Ve)=>a(ot=>({...ot,vin_number:Ve})),onChange:(je,Ve,ot)=>{if(ot==="clear"){a(qe=>({...qe,vin_number:""}));return}Mr(void 0,typeof Ve=="string"?Ve:Ve??"")},renderInput:je=>i.jsx(Pe,{...je,label:"VIN #",fullWidth:!0})}):i.jsx(Pe,{label:"VIN #",value:n.vin_number||"",onChange:je=>a(Ve=>({...Ve,vin_number:je.target.value})),fullWidth:!0}),In=er?i.jsx(Ra,{freeSolo:!0,options:Nt,loading:V,value:n.unit_number||"",onInputChange:(je,Ve)=>a(ot=>({...ot,unit_number:Ve})),onChange:(je,Ve,ot)=>{if(ot==="clear"){a(qe=>({...qe,unit_number:""}));return}Mr(typeof Ve=="string"?Ve:Ve??"",void 0)},renderInput:je=>i.jsx(Pe,{...je,label:"Unit #",fullWidth:!0})}):i.jsx(Pe,{label:"Unit #",value:n.unit_number||"",onChange:je=>a(Ve=>({...Ve,unit_number:je.target.value})),fullWidth:!0}),Yr=[lt.vin!==!1?{key:"vin",element:Vn}:null,lt.unitNumber!==!1?{key:"unitNumber",element:In}:null,lt.vehicleMake!==!1?{key:"vehicleMake",element:i.jsx(Pe,{label:"Make",value:n.vehicle_make||"",onChange:je=>a(Ve=>({...Ve,vehicle_make:je.target.value})),fullWidth:!0})}:null,lt.vehicleModel!==!1?{key:"vehicleModel",element:i.jsx(Pe,{label:"Model",value:n.vehicle_model||"",onChange:je=>a(Ve=>({...Ve,vehicle_model:je.target.value})),fullWidth:!0})}:null,lt.mileage!==!1?{key:"mileage",element:i.jsx(Pe,{label:"Mileage",type:"number",value:n.mileage??"",onChange:je=>a(Ve=>({...Ve,mileage:je.target.value===""?"":Number(je.target.value)})),fullWidth:!0,inputProps:{step:1,min:0}})}:null].filter(Boolean),Kr=[{key:"invoiceDate",element:i.jsx(os,{label:"Invoice Date",value:D,onChange:je=>R(je),slotProps:{textField:{fullWidth:!0}}})},{key:"dueDate",element:i.jsx(os,{label:"Due Date",value:F,onChange:je=>{z(je),J(!0)},slotProps:{textField:{fullWidth:!0}}})}];return i.jsxs(i.Fragment,{children:[i.jsx(Os,{dateAdapter:oc,children:i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",children:t?"New Invoice":`Invoice ${n.invoice_number||""}`}),n.source_sales_order_number&&i.jsxs(dt,{direction:"row",spacing:1,alignItems:"center",sx:{mt:1},children:[i.jsx(B,{variant:"body1",children:"Source Sales Order:"}),i.jsx(xe,{variant:"text",size:"small",startIcon:i.jsx(Sv,{}),onClick:()=>r(`/open-sales-orders/${n.sales_order_id}`),children:n.source_sales_order_number})]})]}),i.jsxs(dt,{direction:"row",spacing:1,children:[nr&&i.jsx(st,{color:"error",label:"Overdue"}),i.jsx(st,{color:n.status==="Paid"?"success":"default",label:n.status||"Unpaid",onClick:()=>a(je=>({...je,status:je.status==="Paid"?"Unpaid":"Paid"}))}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Sv,{}),onClick:Sr,disabled:H||t,children:H?"Downloading...":"Download PDF"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:Yt,disabled:$,children:$?"Saving...":"Save"}),i.jsx(xe,{variant:"outlined",onClick:je=>G(je.currentTarget),children:"Customize Fields"})]})]}),i.jsxs(bt,{sx:Cr,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Customer Information"}),i.jsx(Z,{sx:fn,children:i.jsx(Z,{children:Jr})})]}),i.jsxs(bt,{sx:Cr,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Vehicle Details"}),i.jsx(Z,{sx:Oa,children:Yr.map(je=>i.jsx(Z,{children:je.element},je.key))})]}),i.jsxs(bt,{sx:Cr,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Job & Schedule"}),i.jsx(Z,{sx:{...En,mb:2},children:Kr.map(je=>i.jsx(Z,{children:je.element},je.key))}),i.jsxs(Z,{sx:{display:"grid",gap:2},children:[i.jsx(Pe,{label:"Product",value:n.product_name||"",onChange:je=>a(Ve=>({...Ve,product_name:je.target.value})),fullWidth:!0}),lt.productDescription!==!1&&i.jsx(Pe,{label:"Product Description",value:n.product_description||"",onChange:je=>a(Ve=>({...Ve,product_description:je.target.value})),fullWidth:!0,multiline:!0,minRows:2}),lt.techStory!==!1&&i.jsx(Pe,{label:"Tech Story",value:n.tech_story||"",onChange:je=>a(Ve=>({...Ve,tech_story:je.target.value})),fullWidth:!0,multiline:!0,minRows:4,placeholder:"Technician notes carried from the sales order"})]})]}),i.jsxs(bt,{sx:Cr,children:[i.jsx(B,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Invoice Terms"}),i.jsx(Pe,{label:"Invoice Terms",multiline:!0,minRows:2,fullWidth:!0,value:n.notes||"",onChange:je=>a(Ve=>({...Ve,notes:je.target.value}))})]}),i.jsx(Iv,{open:!!Q,anchorEl:Q,onClose:Je,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:i.jsxs(Z,{sx:{p:2,minWidth:220},children:[i.jsx(B,{variant:"subtitle1",sx:{mb:1.5},children:"Show / Hide Fields"}),i.jsx(Tp,{children:[{key:"vin",label:"VIN #"},{key:"productDescription",label:"Product Description"},{key:"unitNumber",label:"Unit #"},{key:"mileage",label:"Mileage"},{key:"vehicleMake",label:"Make"},{key:"vehicleModel",label:"Model"},{key:"techStory",label:"Tech Story"}].filter(({key:je})=>he[je]).map(({key:je,label:Ve})=>i.jsx(ti,{control:i.jsx(Qi,{size:"small",checked:!!oe[je],onChange:ot=>ae(Oe=>({...Oe,[je]:ot.target.checked}))}),label:Ve},je))})]})}),i.jsx(B,{variant:"h6",sx:{mt:2,mb:.5},children:"Line Items"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Each part number can only appear once. Edit existing line items to change quantities."}),i.jsxs(bt,{sx:{p:3,mb:3},elevation:3,children:[i.jsx(ie,{container:!0,spacing:2,children:o.map((je,Ve)=>i.jsxs(Ce.Fragment,{children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:2.5,children:i.jsx(Ra,{freeSolo:!0,autoHighlight:!0,options:at.map(ot=>ot.part_number),value:je.part_number||"",onInputChange:(ot,Oe)=>He(Ve,"part_number",Oe),onChange:(ot,Oe)=>He(Ve,"part_number",Oe||""),filterOptions:It,renderOption:(ot,Oe)=>{const qe=St[Oe]||"",{key:rt,...Pt}=ot;return i.jsx("li",{...Pt,children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",children:Oe}),qe?i.jsx(B,{variant:"caption",color:"text.secondary",children:qe}):null]})},rt)},renderInput:ot=>i.jsx(Pe,{...ot,label:"Part Number *",fullWidth:!0})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3.5,children:i.jsx(Pe,{label:"Part Description *",value:je.part_description,onChange:ot=>He(Ve,"part_description",ot.target.value),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Pe,{label:"Qty",type:"number",value:je.quantity,onChange:ot=>He(Ve,"quantity",ot.target.value),fullWidth:!0,inputProps:{step:.01}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Pe,{label:"Unit",value:je.unit,onChange:ot=>He(Ve,"unit",ot.target.value),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Unit Price",type:"number",value:je.unit_price,onChange:ot=>He(Ve,"unit_price",ot.target.value),fullWidth:!0,InputProps:{startAdornment:i.jsx(sa,{position:"start",children:"$"})}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Amount",type:"number",value:je.line_amount,onChange:ot=>He(Ve,"line_amount",ot.target.value),fullWidth:!0,InputProps:{startAdornment:i.jsx(sa,{position:"start",children:"$"})}})}),i.jsx(ie,{item:!0,xs:12,sm:3,md:1,sx:{display:"flex",alignItems:"center"},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:()=>pt(Ve),fullWidth:!0,children:"Remove"})})]},Ve))}),i.jsx(Z,{sx:{mt:2},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:Ue,startIcon:i.jsx(Va,{}),children:"Add Line Item"})})]}),i.jsx(bt,{sx:{p:3,mb:3},elevation:3,children:i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Subtotal: ",za(Fe.subtotal)]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"subtitle1",children:["Total GST: ",za(Fe.gst)]})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsxs(B,{variant:"h6",children:["Total Amount: ",za(Fe.total)]})})]})}),i.jsx(qn,{sx:{my:3}}),i.jsxs(dt,{direction:"row",spacing:2,children:[i.jsx(xe,{variant:"outlined",onClick:()=>r("/invoices"),children:"Back to Invoices"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:Yt,disabled:$,children:$?"Saving...":"Save Invoice"})]})]})}),i.jsx(Wd,{open:S,onClose:()=>I(!1),onSave:async je=>{try{const Ve=await ve.post("/api/customers",je),ot={id:Ve.data.customer_id,label:je.customer_name,defaultTerms:Number(Ve.data.default_payment_terms_in_days)||30};y(Oe=>[...Oe,ot]),_(ot),A(ot.label),a(Oe=>({...Oe,customer_id:ot.id})),I(!1),ge.success("Customer added successfully!")}catch{ge.error("Failed to add customer.")}},initialCustomer:{customer_name:W},isEditMode:!1})]})};var sh={},qE;function Dde(){if(qE)return sh;qE=1;var e=sr();Object.defineProperty(sh,"__esModule",{value:!0}),sh.default=void 0;var t=e(cr()),r=lr();return sh.default=(0,t.default)((0,r.jsx)("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorder"),sh}var Mde=Dde();const Lde=Et(Mde);var lh={},FE;function Rde(){if(FE)return lh;FE=1;var e=sr();Object.defineProperty(lh,"__esModule",{value:!0}),lh.default=void 0;var t=e(cr()),r=lr();return lh.default=(0,t.default)((0,r.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),lh}var qde=Rde();const Fde=Et(qde);var ch={},$E;function $de(){if($E)return ch;$E=1;var e=sr();Object.defineProperty(ch,"__esModule",{value:!0}),ch.default=void 0;var t=e(cr()),r=lr();return ch.default=(0,t.default)((0,r.jsx)("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"}),"Mic"),ch}var Bde=$de();const Ude=Et(Bde);var uh={},BE;function zde(){if(BE)return uh;BE=1;var e=sr();Object.defineProperty(uh,"__esModule",{value:!0}),uh.default=void 0;var t=e(cr()),r=lr();return uh.default=(0,t.default)((0,r.jsx)("path",{d:"M6 6h12v12H6z"}),"Stop"),uh}var Wde=zde();const Hde=Et(Wde);class Vde{mediaRecorder=null;audioChunks=[];isRecording=!1;stream=null;async startRecording(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});const t={mimeType:"audio/webm;codecs=opus",audioBitsPerSecond:16e3};MediaRecorder.isTypeSupported(t.mimeType)||delete t.mimeType,this.mediaRecorder=new MediaRecorder(this.stream,t),this.audioChunks=[],this.isRecording=!0,this.mediaRecorder.ondataavailable=r=>{r.data.size>0&&this.audioChunks.push(r.data)},this.mediaRecorder.start(1e3)}catch(t){throw console.error("Error starting voice recording:",t),new Error("Failed to start voice recording. Please check microphone permissions.")}}async stopRecording(){return new Promise((t,r)=>{if(!this.mediaRecorder||!this.isRecording){r(new Error("No active recording"));return}this.mediaRecorder.onstop=async()=>{try{this.isRecording=!1;const n=new Blob(this.audioChunks,{type:"audio/wav"}),a=await this.processAudioQuery(n);t(a)}catch(n){r(n)}finally{this.cleanup()}},this.mediaRecorder.stop()})}cleanup(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.mediaRecorder=null,this.audioChunks=[],this.isRecording=!1}async processAudioQuery(t){try{if(t.size>1048576)throw new Error(`Audio file too large (${(t.size/1024/1024).toFixed(2)}MB). Please record a shorter message.`);const n=await this.blobToBase64(t);return(await ve.post("/api/voice-search/search-parts",{audioData:n,audioFormat:t.type||"audio/webm"})).data}catch(r){throw console.error("Error processing voice query:",r),r instanceof Error?new Error(r.message):new Error("Failed to process voice query. Please try again.")}}blobToBase64(t){return new Promise((r,n)=>{const a=new FileReader;a.onload=()=>{const s=a.result.split(",")[1];r(s)},a.onerror=n,a.readAsDataURL(t)})}async interpretTextQuery(t){try{return(await ve.post("/api/voice-search/interpret-query",{query:t})).data}catch(r){return console.error("Error interpreting text query:",r),{query:t,searchInPartNumbers:!0,searchInDescriptions:!0,extractedTerms:[t]}}}isRecordingActive(){return this.isRecording}cancelRecording(){this.isRecording&&(this.mediaRecorder?.stop(),this.cleanup())}}const Gde=new Vde,Yde=({onSearchTerms:e,disabled:t=!1})=>{const[r,n]=x.useState(!1),[a,o]=x.useState(!1),[s,l]=x.useState(""),c=x.useRef(null),u=x.useRef(null),d=()=>{const m=typeof window<"u"&&window.process&&window.process.type;if(typeof window<"u"&&"webkitSpeechRecognition"in window&&!c.current){const y=window.webkitSpeechRecognition||window.SpeechRecognition;c.current=new y,c.current.continuous=!1,c.current.interimResults=!0,c.current.lang="en-US",m&&console.log("Running in Electron environment"),c.current.onresult=b=>{let _="",w="";for(let A=b.resultIndex;A<b.results.length;A++){const P=b.results[A][0].transcript;b.results[A].isFinal?_+=P:w+=P}l(_+w),_.trim()&&p(_.trim())},c.current.onerror=b=>{console.error("Speech recognition error:",b.error),b.error==="network"?(typeof window<"u"&&window.process&&window.process.type?ge.error("Voice recognition network error in Electron. Please try again or use text search."):ge.error("Voice recognition requires internet connection. Please try again."),n(!1)):b.error==="not-allowed"?(ge.error("Microphone access denied. Please allow microphone access."),n(!1)):b.error==="no-speech"?(ge.info("No speech detected. Please try again."),n(!1)):b.error==="audio-capture"?(ge.error("Audio capture error. Please check your microphone."),n(!1)):b.error==="service-not-allowed"?(ge.error("Voice recognition service not allowed. This is common in Electron apps."),n(!1)):(console.error("Speech recognition error:",b.error),ge.error(`Voice recognition error: ${b.error}. Please try again.`),n(!1))},c.current.onend=()=>{n(!1),l("")}}},f=()=>{try{if(!(typeof window<"u"&&("webkitSpeechRecognition"in window||"SpeechRecognition"in window))){ge.error("Voice recognition not available in this browser.");return}typeof window<"u"&&window.process&&window.process.type&&ge.info("Voice recognition in Electron may have limitations. If it doesn't work, please use text search."),d(),c.current&&(n(!0),l(""),c.current.start(),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{r&&h()},8e3))}catch(m){console.error("Error starting voice recognition:",m),ge.error("Failed to start voice recognition."),n(!1)}},h=()=>{c.current&&c.current.stop(),n(!1),u.current&&clearTimeout(u.current)},p=async m=>{try{o(!0),l("");const y=await Gde.interpretTextQuery(m);e(y.extractedTerms,{searchInPartNumbers:y.searchInPartNumbers,searchInDescriptions:y.searchInDescriptions}),ge.success(`Voice search: "${m}"  ${y.extractedTerms.join(", ")}`)}catch(y){console.error("Error processing voice input:",y),ge.error("Failed to process voice input. Please try again.")}finally{o(!1)}},v=()=>{r?h():f()};return i.jsxs(Z,{children:[i.jsx(xe,{variant:"contained",size:"large",onClick:v,disabled:t||a,startIcon:a?i.jsx(tr,{size:20,color:"inherit"}):r?i.jsx(Hde,{}):i.jsx(Ude,{}),sx:{backgroundColor:r?"error.main":"primary.main",color:"white","&:hover":{backgroundColor:r?"error.dark":"primary.dark"},minWidth:120,height:48},children:a?"Processing...":r?"Stop":"Voice Search"}),r&&i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,mt:1,children:[i.jsx(Z,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:"error.main",animation:"pulse 1s infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.3},"100%":{opacity:1}}}}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:["Listening... ",s&&`"${s}"`]})]})]})},Kde="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),Qde="0123456789".split("");function uR(e,t,r){return`so:${t}:${e}:${r}`}function UE(e,t,r){try{const n=localStorage.getItem(uR(e,t,r));if(!n)return[];const a=JSON.parse(n);return Array.isArray(a)?a:[]}catch{return[]}}function zE(e,t,r,n){try{localStorage.setItem(uR(e,t,r),JSON.stringify(n.slice(0,50)))}catch{}}function dR(){return"partFinder:usage:global"}function fR(e,t){return`partFinder:usage:so:${e}:${t}`}function Xde(){try{const e=localStorage.getItem(dR());return e?JSON.parse(e):{}}catch{return{}}}function Jde(e){try{localStorage.setItem(dR(),JSON.stringify(e))}catch{}}function Zde(e,t){try{const r=localStorage.getItem(fR(e,t));return r?JSON.parse(r):{}}catch{return{}}}function efe(e,t,r){try{localStorage.setItem(fR(e,t),JSON.stringify(r))}catch{}}function tfe(e){const{open:t,onClose:r,onSelect:n,salesOrderId:a,context:o,inventoryItems:s}=e,[l,c]=x.useState(""),[u,d]=x.useState(""),[f,h]=x.useState([]),[p,v]=x.useState([]),[m,y]=x.useState([]),[b,_]=x.useState({}),[w,A]=x.useState({}),[P,T]=x.useState([]),[E,S]=x.useState(null);x.useEffect(()=>{t&&(v(UE("favorites",a,o)),y(UE("recents",a,o)),_(Zde(a,o)),A(Xde()))},[t,a,o]);const I=x.useMemo(()=>{const L=l.toUpperCase(),k=new Set(f.map(C=>C.toUpperCase())),$=new Set(P.map(C=>C.toUpperCase())),X=u.trim().toUpperCase();return s.filter(C=>{const M=(C.part_number||"").toUpperCase(),H=(C.part_description||"").toUpperCase();if(L&&!M.startsWith(L)||X&&!(M.includes(X)||H.includes(X)))return!1;for(const U of k)if(!(M.includes(U)||H.includes(U)))return!1;if(P.length>0&&E){let U=!1;for(const te of $){if(E.searchInPartNumbers&&M.includes(te)){U=!0;break}if(E.searchInDescriptions&&H.includes(te)){U=!0;break}}if(!U)return!1}return!0})},[s,l,f,u,P,E]),W=x.useMemo(()=>{const L={},k=new Set(f.map(oe=>oe.toUpperCase())),$=new Set(p),X=new Set(m),C={SS:"STAINLESS",STAIN:"STAINLESS",STAINLESS:"STAINLESS",AL:"ALUMINUM",ALUM:"ALUMINUM",GALV:"GALVANIZED",GALVANIZED:"GALVANIZED",SQ:"SQUARE",RECT:"RECTANGULAR",TUBE:"TUBING"},M=new Set(["TUBING","PIPE","ANGLE","BAR","FLAT","BEAM","CHANNEL","SHEET","PLATE","ROUND","SQUARE","RECTANGULAR"]),H=oe=>C[oe]||oe,U=(oe,ae)=>{const he=oe.trim();!he||k.has(he)||(L[he]=(L[he]||0)+ae)},te=oe=>{const[ae,he]=oe.split("/").map(Number);return!ae||!he?null:(ae/he).toFixed(4).replace(/0+$/,"").replace(/\.$/,"")},le=oe=>{const ae=[];if(!oe)return ae;const he=oe.toUpperCase().replace(/[\s-]+/g,"").replace(//g,"X").replace(/[()]/g,""),me=he.match(/\d+\/\d+/g)??[];if(he.includes("X")){const Q=he.split("X");Q.length>=2&&Q.length<=4&&(ae.push(Q.slice(0,2).join("X")),ae.push(Q.join("X")))}return me.forEach(Q=>{ae.push(Q);const G=te(Q);G&&ae.push(G)}),(he.match(/(\d+)GA/g)??[]).forEach(Q=>ae.push(Q)),(he.match(/SCH\s*\d+/g)??[]).forEach(Q=>ae.push(Q.replace(/\s+/g,""))),(he.match(/OD\d+(?:\.\d+)?/g)??[]).forEach(Q=>ae.push(Q)),(he.match(/ID\d+(?:\.\d+)?/g)??[]).forEach(Q=>ae.push(Q)),(he.match(/\d+(?:\.\d+)?/g)??[]).slice(0,3).forEach(Q=>ae.push(Q)),Array.from(new Set(ae))};for(const oe of I){const he=String(oe.part_description||"").toUpperCase().split(/[^A-Z0-9]+/).filter(Ze=>Ze.length>=2&&!k.has(Ze)).map(H),me=b[oe.part_number]?.count||0,Q=w[oe.part_number]?.count||0,G=b[oe.part_number]?.last||0,ee=Date.now(),se=G?(ee-G)/(1e3*60*60*24):365,V=se<=7?1:se<=30?.5:0;let Ge=1+me*.5+Q*.25+V;$.has(oe.part_number)&&(Ge+=3),X.has(oe.part_number)&&(Ge+=1);const De=u.trim().toUpperCase(),Fe=(oe.part_number||"").toUpperCase(),Xe=(oe.part_description||"").toUpperCase(),it=De&&(Fe.startsWith(De)||Xe.includes(De))?.5:0,lt=[];he.forEach(Ze=>{M.has(Ze)&&lt.push(Ze),U(Ze,Ge*(1+it+(De&&Ze.includes(De)?.5:0)))});const vt=Array.from(new Set(he));vt.forEach(Ze=>vt.forEach(We=>{Ze!==We&&(M.has(Ze)||M.has(We))&&U(`${Ze} ${We}`,Ge*1.2)}));const Ye=le(Fe);Ye.forEach(Ze=>U(Ze,Ge*1.3)),Ye[0]&&lt.slice(0,2).forEach(Ze=>U(`${Ze} ${Ye[0]}`,Ge*1.5))}return Object.entries(L).sort((oe,ae)=>ae[1]-oe[1]).slice(0,24).map(([oe])=>oe)},[I,f,p,m,b,w,u]),O=I,D=x.useMemo(()=>O.slice(0,200),[O]),R=L=>{h(k=>k.includes(L)?k.filter($=>$!==L):[...k,L])},F=()=>{c(""),h([]),T([]),S(null)},z=L=>p.includes(L),K=L=>{v(k=>{const $=k.includes(L)?k.filter(X=>X!==L):[L,...k];zE("favorites",a,o,$);try{fetch(`/api/part-finder/${a}/favorite`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({part_number:L,context:o,value:!k.includes(L)})}).catch(()=>{})}catch{}return $})},J=L=>{y(k=>{const $=[L.part_number,...k.filter(X=>X!==L.part_number)].slice(0,20);return zE("recents",a,o,$),$}),_(k=>{const $={...k},X=$[L.part_number]||{count:0,last:0};return X.count+=1,X.last=Date.now(),$[L.part_number]=X,efe(a,o,$),$}),A(k=>{const $={...k},X=$[L.part_number]||{count:0,last:0};return X.count+=1,X.last=Date.now(),$[L.part_number]=X,Jde($),$}),n(L);try{fetch(`/api/part-finder/${a}/use`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({part_number:L.part_number,context:o})}).catch(()=>{})}catch{}};return i.jsxs(pr,{open:t,onClose:r,maxWidth:"lg",fullWidth:!0,fullScreen:!1,"aria-labelledby":"part-finder-title",children:[i.jsx(mr,{id:"part-finder-title",children:"Find Part"}),i.jsxs(gr,{dividers:!0,children:[i.jsx(Z,{mb:2,children:i.jsxs(Z,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[i.jsx(Pe,{fullWidth:!0,placeholder:"Search by part # or description",value:u,onChange:L=>d(L.target.value),InputProps:{startAdornment:i.jsx(sa,{position:"start",children:i.jsx(fi,{})})}}),i.jsx(Yde,{onSearchTerms:(L,k)=>{T(L),S(k)},disabled:!1})]})}),null,i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",mb:2,children:[!!l&&i.jsx(st,{label:`Prefix: ${l}`,color:"primary",onDelete:()=>c(""),sx:{height:40,borderRadius:2,"& .MuiChip-label":{px:2,py:1,fontSize:16,fontWeight:600}}}),f.map(L=>i.jsx(st,{label:L,color:"secondary",onDelete:()=>R(L),sx:{height:38,borderRadius:2,"& .MuiChip-label":{px:2,py:1,fontSize:15,fontWeight:600}}},L)),P.length>0&&i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[i.jsx(B,{variant:"caption",color:"text.secondary",children:"Voice:"}),P.map(L=>i.jsx(st,{label:L,color:"success",variant:"outlined",size:"small",sx:{height:32,"& .MuiChip-label":{px:1.5,py:.5,fontSize:12}}},L)),E&&i.jsxs(B,{variant:"caption",color:"text.secondary",sx:{ml:1},children:["(",E.searchInPartNumbers?"Part#":"",E.searchInPartNumbers&&E.searchInDescriptions?" + ":"",E.searchInDescriptions?"Desc":"",")"]})]}),(!!l||f.length>0||P.length>0)&&i.jsx(xe,{onClick:F,children:"Clear All"})]}),i.jsxs(Z,{display:"flex",gap:2,mb:2,flexWrap:"wrap",children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Part # Starts With"}),i.jsxs(Z,{display:"flex",flexWrap:"wrap",gap:1.5,children:[Kde.map(L=>i.jsx(st,{label:L,variant:l.startsWith(L)?"filled":"outlined",onClick:()=>c(L),sx:{height:44,borderRadius:2,"& .MuiChip-label":{px:2.25,py:1.25,fontSize:18,fontWeight:700}}},L)),Qde.map(L=>i.jsx(st,{label:L,variant:l.startsWith(L)?"filled":"outlined",onClick:()=>c(L),sx:{height:44,borderRadius:2,"& .MuiChip-label":{px:2.25,py:1.25,fontSize:18,fontWeight:700}}},L))]})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Description Tokens"}),i.jsx(Z,{display:"flex",flexWrap:"wrap",gap:1.5,children:W.map(L=>i.jsx(st,{label:L,clickable:!0,color:f.includes(L)?"secondary":"default",onClick:()=>R(L),sx:{height:40,borderRadius:2,"& .MuiChip-label":{px:2,py:1,fontSize:16,fontWeight:600}}},L))})]})]}),i.jsx(qn,{sx:{my:2}}),i.jsxs(Z,{mb:2,children:[p.length>0&&i.jsxs(Z,{mb:1,children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Favorites for this Sales Order"}),i.jsx(Z,{display:"flex",flexWrap:"wrap",gap:1.25,children:p.map(L=>{const k=s.find($=>$.part_number===L);return k?i.jsx(st,{label:`${k.part_number}`,onClick:()=>J(k),title:k.part_description,sx:{height:38,borderRadius:2,"& .MuiChip-label":{px:2,py:1,fontSize:15,fontWeight:600}}},L):null})})]}),m.length>0&&i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Recents for this Sales Order"}),i.jsx(Z,{display:"flex",flexWrap:"wrap",gap:1.25,children:m.map(L=>{const k=s.find($=>$.part_number===L);return k?i.jsx(st,{variant:"outlined",label:`${k.part_number}`,onClick:()=>J(k),title:k.part_description,sx:{height:38,borderRadius:2,"& .MuiChip-label":{px:2,py:1,fontSize:15,fontWeight:600}}},L):null})})]})]}),i.jsxs(ie,{container:!0,spacing:2,children:[D.map(L=>i.jsx(ie,{item:!0,xs:12,sm:6,md:4,lg:3,children:i.jsxs(Z,{sx:{border:"1px solid #ddd",borderRadius:1,p:1.5,display:"flex",flexDirection:"column",gap:1,height:"100%"},children:[i.jsxs(Z,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:700},children:L.part_number}),i.jsx(Hn,{title:z(L.part_number)?"Remove favorite":"Add favorite",children:i.jsx(xr,{size:"small",onClick:()=>K(L.part_number),children:z(L.part_number)?i.jsx(Fde,{color:"warning",fontSize:"small"}):i.jsx(Lde,{fontSize:"small"})})})]}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{minHeight:40},children:L.part_description||""}),i.jsxs(Z,{mt:"auto",display:"flex",gap:1,children:[i.jsx(xe,{variant:"contained",size:"small",onClick:()=>J(L),children:"Add"}),i.jsx(xe,{variant:"outlined",size:"small",onClick:()=>{J(L)},children:"Add & Keep Open"})]})]})},L.part_number)),D.length===0&&i.jsx(ie,{item:!0,xs:12,children:i.jsx(B,{variant:"body2",color:"text.secondary",children:"No parts match the current filters."})})]})]}),i.jsx(jr,{children:i.jsx(xe,{onClick:r,children:"Close"})})]})}const WE=["Each","cm","ft","ft^2","kg","pcs","hr","L"],N2=5,HE=()=>{const{id:e}=Ms(),t=Tn(),r=!!e&&/^\d+$/.test(e);console.log("WokerSalesOrderPage: Component rendered with id:",e,"isNumericId:",r),x.useEffect(()=>(console.log("WokerSalesOrderPage: Component mounted"),()=>{console.log("WokerSalesOrderPage: Component unmounted")}),[]);const[n,a]=x.useState(null),[o,s]=x.useState(!0),[l,c]=x.useState(null),[u,d]=x.useState(null),[f,h]=x.useState([]),[p,v]=x.useState(null),[m,y]=x.useState(null),[b,_]=x.useState([]),[w,A]=x.useState([]),[P,T]=x.useState([]),[E,S]=x.useState([]),I=x.useRef(null),W=x.useRef(0);x.useLayoutEffect(()=>{const $e=I.current,He=$e?$e.getBoundingClientRect().height:0,Je=He-W.current;Je!==0&&(window.scrollBy({top:Je,left:0,behavior:"auto"}),W.current=He)},[P.length]);const[O,D]=x.useState(null),[R,F]=x.useState(null),[z,K]=x.useState(null),[J,L]=x.useState(!1),[k,$]=x.useState(null),[X,C]=x.useState(""),[M,H]=x.useState(!1),[U,te]=x.useState(null),[le,oe]=x.useState(""),[ae,he]=x.useState(!1),[me,Q]=x.useState("line"),[G,ee]=x.useState(0),se=$e=>f.find(He=>He.part_number===$e),V=($e,He)=>{const Je=f.find(Sr=>Sr.part_number.toLowerCase()===$e.part_number.toLowerCase());if(!Je||Je.part_type==="supply")return null;const Ue=parseFloat(Je.quantity_on_hand)||0,pt=b.filter(Sr=>Sr.part_number.toLowerCase()===$e.part_number.toLowerCase()).reduce((Sr,Mr)=>Sr+(parseFloat(String(Mr.quantity).replace(/[^\d.-]/g,""))||0),0),at=w.filter(Sr=>Sr.part_number.toLowerCase()===$e.part_number.toLowerCase()).reduce((Sr,Mr)=>Sr+(parseFloat(String(Mr.quantity).replace(/[^\d.-]/g,""))||0),0),St=pt-at,It=Ue-St,Yt=It<0?Math.floor(It):Math.round(It);return{available:Yt,isNegative:Yt<0,currentStock:Ue,changeInQuantity:St,totalQuantityForPart:pt,totalOriginalQuantityForPart:at}},Ge=($e,He)=>{const Je=b.filter(pt=>pt.part_number.toLowerCase()===$e.part_number.toLowerCase());if(Je.length<=1)return!0;const Ue=Math.max(...Je.map((pt,at)=>b.findIndex(St=>St.part_number.toLowerCase()===$e.part_number.toLowerCase()&&b.indexOf(St)===at)));return He===Ue},De=x.useMemo(()=>b.map($e=>({part_number:$e.part_number,part_description:$e.part_description,quantity:bo($e.quantity),unit:$e.unit,unit_price:bo($e.unit_price)})),[b]),Fe=x.useMemo(()=>De.reduce(($e,He)=>$e+$u(He.quantity,He.unit_price),0),[De]),Xe=x.useMemo(()=>Fe*(N2/100),[Fe]);x.useMemo(()=>Fe+Xe,[Fe,Xe]);const[it,lt]=x.useState("");x.useEffect(()=>{n&&lt(JSON.stringify({lineItems:b,partsToOrder:E}))},[n]);const vt=!!it&&it!==JSON.stringify({lineItems:b,partsToOrder:E});x.useEffect(()=>{(async()=>{try{const[$e,He,Je]=await Promise.all([ve.get("/api/inventory"),ve.get("/api/settings/labour-rate").catch(()=>({data:{labour_rate:null}})),ve.get("/api/settings/overhead-rate").catch(()=>({data:{overhead_rate:null}}))]);h($e.data),v(He.data.labour_rate??null),y(Je.data.overhead_rate??null)}catch($e){console.error("Prefetch failed",$e)}})()},[]),x.useEffect(()=>{if(console.log("WokerSalesOrderPage: useEffect triggered with id:",e,"isNumericId:",r),!e||!r){console.log("WokerSalesOrderPage: Invalid ID, setting error"),c("Invalid sales order ID."),s(!1);return}(async()=>{console.log("WokerSalesOrderPage: Fetching sales order data for ID:",e),s(!0),c(null);try{console.log("WokerSalesOrderPage: Making API call to /api/sales-orders/${id}");const $e=await ve.get(`/api/sales-orders/${e}`);if(console.log("WokerSalesOrderPage: API response received:",$e),console.log("WokerSalesOrderPage: API response data:",$e.data),!$e.data||!$e.data.salesOrder){console.error("WokerSalesOrderPage: No sales order data in response"),c("Invalid response format from server"),s(!1);return}const He=$e.data.salesOrder;console.log("WokerSalesOrderPage: Parsed sales order:",He),a({sales_order_id:He.sales_order_id,sales_order_number:He.sales_order_number,status:He.status});const Je=($e.data.lineItems||He?.line_items||[]).filter(pt=>!["LABOUR","OVERHEAD","SUPPLY"].includes(pt.part_number?.toUpperCase())).map(pt=>({line_item_id:pt.line_item_id,part_number:pt.part_number,part_description:pt.part_description,unit:pt.unit,unit_price:pt.unit_price,line_amount:pt.line_amount,quantity:String(pt.quantity_sold??pt.quantity??0),gst:N2,part_id:pt.part_id??void 0}));console.log("WokerSalesOrderPage: Loaded line items (filtered):",Je),_(Je),A(Je);const Ue=($e.data.partsToOrder||[]).map(pt=>({sales_order_id:He.sales_order_id,part_number:pt.part_number,part_description:pt.part_description,quantity_to_order:String(pt.quantity_needed??pt.quantity_to_order??""),unit:pt.unit||"Each",unit_price:Number(pt.unit_price||0),line_amount:Number(pt.line_amount||0)}));console.log("WokerSalesOrderPage: Loaded parts to order:",Ue),S(Ue),console.log("WokerSalesOrderPage: Successfully loaded sales order data")}catch($e){console.error("WokerSalesOrderPage: Error loading sales order:",$e),console.error("WokerSalesOrderPage: Error details:",{message:$e?.message,status:$e?.response?.status,statusText:$e?.response?.statusText,data:$e?.response?.data,url:$e?.config?.url}),c($e?.response?.status===404?"Sales order not found. It may have been deleted.":"Failed to load sales order data. Please try again.")}finally{s(!1)}})()},[e,r]),x.useEffect(()=>{p!==null&&_($e=>$e.map(He=>He.part_number==="LABOUR"?{...He,unit_price:p}:He))},[p]),x.useEffect(()=>{m!==null&&_($e=>$e.map(He=>He.part_number==="OVERHEAD"?{...He,unit_price:m}:He))},[m]),x.useEffect(()=>{const $e=[];b.forEach((He,Je)=>{if(Ge(He,Je)){const Ue=V(He);Ue&&Ue.available<0&&$e.push({lineItemIndex:Je,partNumber:He.part_number,partDescription:He.part_description,excessQuantity:Math.abs(Ue.available),unit:He.unit})}}),T($e)},[b,f]);const Ye=($e,He)=>{_(Je=>{const Ue=[...Je];if(!He||He.trim()==="")Ue[$e]={...Ue[$e],part_number:"",part_description:"",quantity:"",unit:WE[0],unit_price:0,line_amount:0};else{const St=se(He);if(St){const It=parseFloat(String(St.last_unit_cost))||0;Ue[$e]={...Ue[$e],part_number:He,part_description:St.part_description||"",unit:St.unit||"Each",unit_price:It}}else Ue[$e]={...Ue[$e],part_number:He,part_description:"Part not found",unit_price:0}}const pt=bo(Ue[$e].quantity),at=bo(Ue[$e].unit_price);return Ue[$e].line_amount=$u(pt,at),Ue})},Ze=($e,He,Je)=>{_(Ue=>{const pt=[...Ue],at={...pt[$e],[He]:Je};if(parseFloat(Je)<=0)return pt.filter((Yt,Sr)=>Sr!==$e);const St=bo(at.quantity),It=bo(at.unit_price);return at.line_amount=$u(St,It),pt[$e]=at,pt})},We=()=>{_($e=>[...$e,{part_number:"",part_description:"",quantity:"",unit:WE[0],unit_price:0,gst:N2,line_amount:0}])},wt=$e=>{_(He=>He.filter((Je,Ue)=>Ue!==$e))},Nt=()=>{if(b.filter(Ue=>!Ue.part_number||Ue.part_number.trim()==="").length>0)return ge.error("Line items with blank part numbers are not allowed."),!1;const He=b.filter(Ue=>{if(["LABOUR","OVERHEAD","SUPPLY"].includes(String(Ue.part_number).toUpperCase()))return!1;const pt=Ue.part_id;if(pt){const St=(f||[]).find(It=>It.part_id===pt);return St?St.part_type==="supply":!1}const at=(f||[]).find(St=>String(St.part_number).toUpperCase()===String(Ue.part_number).trim().toUpperCase());return!at||at.part_type==="supply"});if(He.length>0){const Ue=He.map(pt=>pt.part_number).join(", ");return ge.error(`Invalid or supply parts (not allowed): ${Ue}`),!1}return b.some((Ue,pt)=>{if(!Ge(Ue,pt))return!1;const at=V(Ue);return at&&at.available<0})?(ge.error("Insufficient inventory for one or more parts."),!1):!0},kt=$e=>{const He=$e.reduce((Je,Ue)=>{const pt=Ue.part_number.trim().toLowerCase();if(!Je[pt]){const St=["LABOUR","OVERHEAD","SUPPLY"].includes(Ue.part_number.toUpperCase())?null:(f||[]).find(It=>String(It.part_number).toUpperCase()===Ue.part_number.trim().toUpperCase());Je[pt]={part_number:Ue.part_number.trim(),part_description:Ue.part_description.trim(),unit:Ue.unit.trim(),unit_price:Ue.unit_price!=null?Number(Ue.unit_price):0,line_amount:0,quantity_sold:0,...Ue.part_id?{part_id:Ue.part_id}:St&&St.part_id?{part_id:St.part_id}:{}}}const at=parseFloat(String(Ue.quantity).replace(/[^\d.-]/g,""))||0;return Je[pt].quantity_sold+=Math.round(at),Je[pt].line_amount+=at*(Ue.unit_price||0),Je},{});return Object.values(He)},Wt=async()=>{if(n&&Nt())try{const $e={lineItems:kt(b),partsToOrder:E.filter(He=>He.part_number&&parseFloat(String(He.quantity_to_order))>0).map(He=>({sales_order_id:n.sales_order_id,part_number:He.part_number.trim(),part_description:He.part_description.trim(),quantity_needed:parseFloat(String(He.quantity_to_order))||0,unit:He.unit.trim(),unit_price:He.unit_price,line_amount:He.line_amount}))};await ve.put(`/api/sales-orders/${n.sales_order_id}`,$e),d("Sales Order updated successfully!"),lt(JSON.stringify({lineItems:b,partsToOrder:E}));try{const He=await ve.get("/api/inventory");h(He.data)}catch{}}catch($e){const He=$e?.response?.data?.error||$e?.response?.data?.details||$e?.response?.data?.message||"Failed to save sales order.";ge.error(He)}},jt=($e,He)=>{const Je=(b[$e]?.part_number||"").trim(),Ue=He.key==="Enter",pt=He.key==="Tab",at=He.key==="Escape",St=He.key==="ArrowDown"||He.key==="ArrowUp";if(at){D(null);return}if(St){He.key==="ArrowDown"&&O!==$e&&D($e);return}if(!(O===$e&&(Ue||pt))&&(Ue||pt)&&Je){if(Ue&&He.ctrlKey){He.preventDefault(),C(Je.toUpperCase()),$($e),L(!0),D(null);return}!f.find(Yt=>Yt.part_number.toUpperCase()===Je.toUpperCase())&&Ue&&(He.preventDefault(),C(Je.toUpperCase()),$($e),L(!0),D(null))}},ur=($e,He)=>{const Je=(E[$e]?.part_number||"").trim(),Ue=He.key==="Enter",pt=He.key==="Tab",at=He.key==="Escape",St=He.key==="ArrowDown"||He.key==="ArrowUp";if(at){F(null);return}if(St){He.key==="ArrowDown"&&R!==$e&&F($e);return}if(!(R===$e&&(Ue||pt))&&(Ue||pt)&&Je){if(Ue&&He.ctrlKey){He.preventDefault(),oe(Je.toUpperCase()),te($e),H(!0),F(null);return}!f.find(Yt=>Yt.part_number.toUpperCase()===Je.toUpperCase())&&Ue&&(He.preventDefault(),oe(Je.toUpperCase()),te($e),H(!0),F(null))}};return o?i.jsxs(rr,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(tr,{}),i.jsx(B,{children:"Loading sales order..."})]}):l?i.jsxs(rr,{component:"main",maxWidth:"md",sx:{mt:8,textAlign:"center"},children:[i.jsx(Ot,{severity:"error",sx:{mb:2},children:l}),i.jsx(xe,{variant:"contained",onClick:()=>window.location.reload(),sx:{mr:2},children:"Retry"}),i.jsx(xe,{variant:"outlined",onClick:()=>t("/open-sales-orders"),children:"Back to Sales Orders"})]}):n?i.jsxs(Os,{dateAdapter:oc,children:[i.jsx(Ry,{when:vt,onSave:Wt}),i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{position:"relative",zIndex:1},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsxs(B,{variant:"h5",sx:{fontWeight:700},children:["Edit Lines & Parts to Order  SO ",n.sales_order_number||n.sales_order_id]}),i.jsx(xe,{variant:"contained",onClick:Wt,children:"Save Changes"})]}),i.jsx(B,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Line Items"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"You can add multiple line items with the same part number. They will be automatically merged on save."})]}),i.jsx(Z,{ref:I,sx:{mb:P.length?2:0,display:P.length?"flex":"none",flexDirection:"column",gap:1},children:P.map(($e,He)=>{const Je=b[$e.lineItemIndex];return!Je||!Ge(Je,$e.lineItemIndex)?null:i.jsx(Ot,{severity:"warning",sx:{width:"100%",boxShadow:2,"& .MuiAlert-message":{width:"100%",padding:0}},children:i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{width:"100%"},children:[i.jsxs(Z,{sx:{flex:1},children:[i.jsxs(B,{variant:"body2",fontWeight:"medium",children:["Insufficient stock for ",$e.partNumber]}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Excess quantity: ",$e.excessQuantity," ",$e.unit]})]}),i.jsxs(xe,{variant:"contained",size:"small",sx:{whiteSpace:"nowrap"},onClick:()=>{const Ue=$e.excessQuantity,pt=f.find(It=>It.part_number.toLowerCase()===Je.part_number.toLowerCase()),at={sales_order_id:n.sales_order_id,part_number:Je.part_number,part_description:Je.part_description,quantity_to_order:String(Ue),unit:Je.unit,unit_price:pt?.last_unit_cost||0,line_amount:(pt?.last_unit_cost||0)*Ue};S(It=>[...It,at]);const St=Math.max(0,(parseFloat(String(Je.quantity).replace(/[^\d.-]/g,""))||0)-Ue);_(It=>It.map((Yt,Sr)=>Sr===$e.lineItemIndex?{...Yt,quantity:String(St)}:Yt)),T(It=>It.filter(Yt=>Yt.lineItemIndex!==$e.lineItemIndex)),ge.success(`Transferred ${Ue} ${Je.unit} of ${Je.part_number} to parts to order`)},children:["Transfer ",$e.excessQuantity," to Parts to Order"]})]})},`${$e.lineItemIndex}-${He}`)})}),i.jsxs(bt,{sx:{p:3,mb:3},elevation:3,children:[i.jsx(ie,{container:!0,spacing:2,children:b.map(($e,He)=>i.jsxs(Ce.Fragment,{children:[i.jsxs(ie,{item:!0,xs:12,sm:6,md:3.5,children:[i.jsx(Ra,{open:O===He,onOpen:()=>D(He),onClose:()=>D(null),autoHighlight:!0,inputValue:$e.part_number,onChange:(Je,Ue)=>{if(typeof Ue=="string")Ye(He,Ue),D(null);else if(Ue&&typeof Ue=="object"&&"isNew"in Ue){const pt=Ue.inputValue||"";C(String(pt).toUpperCase()),$(He),L(!0),D(null)}},onInputChange:(Je,Ue,pt)=>{if(_(St=>{const It=[...St];return It[He]={...It[He],part_number:(Ue||"").toUpperCase()},It}),z&&window.clearTimeout(z),pt==="reset")return;if((Ue||"").trim().length>0){const St=window.setTimeout(()=>D(He),200);K(St)}else D(null)},options:f.filter(Je=>Je.part_type!=="supply").map(Je=>Je.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,filterOptions:(Je,Ue)=>{const pt=(Ue.inputValue||"").toUpperCase(),at=Je.filter(Yt=>{const Sr=f.find(Mr=>Mr.part_number===Yt);return Sr?String(Yt).toUpperCase().includes(pt)||String(Sr.part_description||"").toUpperCase().includes(pt):String(Yt).toUpperCase().includes(pt)}),St=at.some(Yt=>String(Yt).toUpperCase()===pt),It=[...at];return pt&&!St&&It.push({label:`Add "${Ue.inputValue}" as New Part`,isNew:!0,inputValue:Ue.inputValue}),It},renderOption:(Je,Ue)=>{const pt=typeof Ue=="object"&&Ue.isNew,at=typeof Ue=="string"?Ue:Ue.label,{key:St,...It}=Je;return i.jsxs("li",{...It,children:[pt&&i.jsx(ec,{fontSize:"small",style:{marginRight:8,color:"#666"}}),typeof Ue=="string"?i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",children:Ue}),(()=>{const Yt=f.find(Sr=>Sr.part_number===Ue);return Yt?.part_description?i.jsx(B,{variant:"caption",color:"text.secondary",children:Yt.part_description}):null})()]}):at]},St)},renderInput:Je=>i.jsx(Pe,{...Je,label:"Part Number",required:!0,fullWidth:!0,onKeyDown:Ue=>jt(He,Ue),onBlur:()=>D(null)}),onBlur:()=>{const Je=b[He]?.part_number?.trim().toUpperCase();if(!Je)return;f.find(pt=>pt.part_number===Je)?Ye(He,Je):($(He),C(Je),L(!0),D(null))}}),i.jsx(Z,{mt:1,children:i.jsx(xe,{size:"small",variant:"outlined",onClick:()=>{Q("line"),ee(He),he(!0)},children:"Find Part"})})]}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3.5,children:i.jsx(Pe,{label:"Part Description",value:$e.part_description,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,children:i.jsx(Pe,{label:"Qty",value:$e.quantity,onChange:Je=>Ze(He,"quantity",Je.target.value),type:"number",fullWidth:!0,required:!0,inputProps:{step:1,onWheel:Je=>Je.target.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Avail",value:(()=>{if(!Ge($e,He))return"N/A";const Je=V($e);return Je?Je.available<0?`${Je.available} (Insufficient)`:String(Je.available):"N/A"})(),fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:(()=>{if(!Ge($e,He))return"#f5f5f5";const Je=V($e);return Je?Je.available>=0?"#e8f5e8":"#ffeaea":"#f5f5f5"})(),"& .MuiInputBase-input":{color:Ge($e,He)?V($e)?.isNegative?"#d32f2f":"#2e7d32":"#666"}}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Unit",value:$e.unit,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1,sx:{display:"flex",alignItems:"stretch"},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:()=>wt(He),fullWidth:!0,sx:{height:"56px"},children:"Remove"})})]},He))}),i.jsx(Z,{sx:{mt:2},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:We,children:"Add Line Item"})})]}),i.jsxs(bt,{sx:{p:3,mb:3,border:"2px solid #b8860b","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#b8860b"},"&:hover fieldset":{borderColor:"#b8860b"}}},elevation:0,children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Parts to Order"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Add parts that need to be ordered for this sales order. These quantities are aggregated across all sales orders."}),i.jsx(ie,{container:!0,spacing:2,children:E.map(($e,He)=>i.jsxs(Ce.Fragment,{children:[i.jsxs(ie,{item:!0,xs:12,sm:6,md:3.5,children:[i.jsx(Ra,{open:R===He,onOpen:()=>F(He),onClose:()=>F(null),autoHighlight:!0,value:$e.part_number,onChange:(Je,Ue)=>{if(!Ue){S(pt=>{const at=[...pt];return at[He]={...at[He],part_number:"",part_description:"",unit:"Each",unit_price:0,line_amount:0},at});return}if(typeof Ue=="string"){const pt=f.find(at=>at.part_number===Ue);if(pt){const St=parseFloat(String(pt.last_unit_cost))||0;S(It=>{const Yt=[...It];return Yt[He]={...Yt[He],part_number:pt.part_number,part_description:pt.part_description,unit:pt.unit||"Each",unit_price:St,line_amount:0},Yt})}else{S(St=>{const It=[...St];return It[He]={...It[He],part_number:Ue,part_description:"",unit:"Each",unit_price:0,line_amount:0},It});const at=String(Ue).toUpperCase();te(He),oe(at),H(!0)}}else if(Ue&&typeof Ue=="object"&&"isNew"in Ue){const pt=String(Ue.inputValue||"").toUpperCase();te(He),oe(pt),H(!0)}},onInputChange:(Je,Ue,pt)=>{if(S(St=>{const It=[...St];return It[He]={...It[He],part_number:(Ue||"").toUpperCase()},It}),z&&window.clearTimeout(z),pt==="reset")return;if((Ue||"").trim().length>0){const St=window.setTimeout(()=>F(He),200);K(St)}else F(null)},options:f.filter(Je=>Je.part_type!=="supply").map(Je=>Je.part_number),freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,filterOptions:(Je,Ue)=>{const pt=(Ue.inputValue||"").toUpperCase(),at=Je.filter(Yt=>{const Sr=f.find(Mr=>Mr.part_number===Yt);return Sr?String(Yt).toUpperCase().includes(pt)||String(Sr.part_description||"").toUpperCase().includes(pt):String(Yt).toUpperCase().includes(pt)}),St=at.some(Yt=>String(Yt).toUpperCase()===pt),It=[...at];return pt&&!St&&It.push({label:`Add "${Ue.inputValue}" as New Part`,isNew:!0,inputValue:Ue.inputValue}),It},renderOption:(Je,Ue)=>{const pt=typeof Ue=="object"&&Ue.isNew,at=typeof Ue=="string"?Ue:Ue.label,{key:St,...It}=Je;return i.jsxs("li",{...It,children:[pt&&i.jsx(ec,{fontSize:"small",style:{marginRight:8,color:"#666"}}),typeof Ue=="string"?i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",children:Ue}),(()=>{const Yt=f.find(Sr=>Sr.part_number===Ue);return Yt?.part_description?i.jsx(B,{variant:"caption",color:"text.secondary",children:Yt.part_description}):null})()]}):at]},St)},renderInput:Je=>i.jsx(Pe,{...Je,label:"Part Number",fullWidth:!0,required:!0,onKeyDown:Ue=>ur(He,Ue),onBlur:()=>F(null)}),onBlur:()=>{const Je=(E[He]?.part_number||"").trim().toUpperCase();if(!Je)return;f.find(pt=>pt.part_number===Je)||(te(He),oe(Je),H(!0),F(null))}}),i.jsx(Z,{mt:1,children:i.jsx(xe,{size:"small",variant:"outlined",onClick:()=>{Q("pto"),ee(He),he(!0)},children:"Find Part"})})]}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3.5,children:i.jsx(Pe,{label:"Description",value:$e.part_description,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#f5f5f5"}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Qty to Order",value:$e.quantity_to_order,onChange:Je=>{const Ue=Je.target.value;S(pt=>{const at=[...pt],St=parseFloat(Ue)||0,It=at[He].unit_price||0;return at[He]={...at[He],quantity_to_order:Ue,line_amount:St*It},at})},type:"number",fullWidth:!0,required:!0,inputProps:{step:1,min:0,onWheel:Je=>Je.target.blur()}})}),i.jsx(ie,{item:!0,xs:6,sm:3,md:1.5,children:i.jsx(Pe,{label:"Unit",value:$e.unit,fullWidth:!0,InputProps:{readOnly:!0},sx:{backgroundColor:"#ffffff"}})}),i.jsx(ie,{item:!0,xs:12,sm:1,md:1,sx:{display:"flex",alignItems:"stretch",gap:2},children:i.jsx(xe,{variant:"outlined",onClick:()=>S(Je=>Je.filter((Ue,pt)=>pt!==He)),sx:{height:"56px",flexShrink:0,borderColor:"#b8860b",color:"#b8860b","&:hover":{borderColor:"#8b6914",backgroundColor:"#fff8dc"}},children:"Remove"})})]},He))}),i.jsx(Z,{sx:{mt:2},children:i.jsx(xe,{variant:"outlined",color:"primary",onClick:()=>S($e=>[...$e,{sales_order_id:n.sales_order_id,part_number:"",part_description:"",quantity_to_order:"",unit:"Each",unit_price:0,line_amount:0}]),children:"Add Parts to Order Item"})})]}),i.jsxs(Z,{display:"flex",justifyContent:"flex-end",gap:2,children:[i.jsx(xe,{variant:"outlined",onClick:()=>t(`/open-sales-orders/${n.sales_order_id}`),children:"Back to SO"}),i.jsx(xe,{variant:"contained",onClick:Wt,children:"Save Changes"})]}),i.jsx(pl,{open:!!u,autoHideDuration:6e3,onClose:()=>d(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>d(null),severity:"success",sx:{width:"100%"},children:u})})]}),i.jsx(tc,{open:J,onClose:()=>{L(!1),$(null),C("")},onSave:async $e=>{const He=await ve.post("/api/inventory",$e),Je=await ve.get("/api/inventory");h(Je.data);const Ue=He.data.item;k!==null&&_(pt=>{const at=[...pt],It=parseFloat(String(Ue.last_unit_cost))||0;at[k]={...at[k],part_number:Ue.part_number,part_description:Ue.part_description,unit:Ue.unit||at[k].unit,unit_price:It};const Yt=bo(at[k].quantity);return at[k].line_amount=$u(Yt,It),at})},title:"Add New Part",initialPart:{part_number:X.toUpperCase(),category:"Uncategorized"}}),i.jsx(tfe,{open:ae,onClose:()=>he(!1),onSelect:$e=>{if(n)if(me==="line"){const He=G;_(Je=>{const Ue=[...Je];return Ue[He]?(Ue[He]={...Ue[He],part_number:$e.part_number,part_description:$e.part_description},Ue):Je})}else{const He=G;S(Je=>{const Ue=[...Je];return Ue[He]?(Ue[He]={...Ue[He],part_number:$e.part_number,part_description:$e.part_description},Ue):Je})}},salesOrderId:n?.sales_order_id||0,context:me,inventoryItems:f.map($e=>({part_number:$e.part_number,part_description:$e.part_description}))}),i.jsx(tc,{open:M,onClose:()=>{H(!1),te(null),oe("")},onSave:async $e=>{const He=await ve.post("/api/inventory",$e),Je=await ve.get("/api/inventory");h(Je.data);const Ue=He.data.item;U!==null&&S(pt=>{const at=[...pt],It=parseFloat(String(Ue.last_unit_cost))||0;at[U]={...at[U],part_number:Ue.part_number,part_description:Ue.part_description,unit:Ue.unit||"Each",unit_price:It};const Yt=parseFloat(String(at[U].quantity_to_order))||0;return at[U].line_amount=Yt*It,at})},title:"Add New Part",initialPart:{part_number:le.toUpperCase(),category:"Uncategorized"}})]}):null},kv=e=>new Date(e.getTime()-e.getTimezoneOffset()*6e4).toISOString(),hR=()=>crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`;function Hc(e){if(e==null)return null;if(typeof e=="number")return Number.isNaN(e)?null:e;if(typeof e=="string"){const t=e.trim();if(!t)return null;const r=Number(t);if(!Number.isNaN(r))return r;const n=t.match(/^(-?)(\d+):(\d{2})(?::(\d{2})(?:\.\d+)?)?$/);if(n){const o=n[1]==="-"?-1:1,s=parseInt(n[2],10),l=parseInt(n[3],10),c=n[4]?parseInt(n[4],10):0;return Number.isNaN(s)||Number.isNaN(l)||Number.isNaN(c)?null:o*(s+l/60+c/3600)}const a=t.match(/^(-)?P?T?(?:(\d+(?:\.\d+)?)H)?(?:(\d+(?:\.\d+)?)M)?(?:(\d+(?:\.\d+)?)S)?$/i);if(a){const o=a[1]==="-"?-1:1,s=a[2]?parseFloat(a[2]):0,l=a[3]?parseFloat(a[3]):0,c=a[4]?parseFloat(a[4]):0;return[s,l,c].some(u=>Number.isNaN(u))?null:o*(s+l/60+c/3600)}}return null}function Tv(e,t=3){const r=Hc(e);return r!==null&&!Number.isNaN(r)?`${r.toFixed(t)} hrs`:"-"}const SS=async()=>{try{const e=await ve.get("/api/time-tracking/profiles");return localStorage.setItem("tt_profiles_cache",JSON.stringify(e.data)),e.data}catch{const t=localStorage.getItem("tt_profiles_cache");return t?JSON.parse(t):[]}},rfe=async(e,t,r)=>(await ve.post("/api/time-tracking/profiles",{name:e,email:t,phone_number:r})).data,nfe=async(e,t,r,n)=>(await ve.put(`/api/time-tracking/profiles/${e}`,{name:t,email:r,phone_number:n})).data,pR=async()=>{try{const e=await ve.get("/api/time-tracking/sales-orders");return localStorage.setItem("tt_sales_orders_cache",JSON.stringify(e.data)),e.data}catch{const t=localStorage.getItem("tt_sales_orders_cache");return t?JSON.parse(t):[]}},afe=async(e,t)=>{const r={date:e};return t&&(r.profile_id=t),(await ve.get("/api/time-tracking/time-entries",{params:r})).data},ife=async(e,t)=>{try{return(await ve.post("/api/time-tracking/time-entries/clock-in",{profile_id:e,so_id:t})).data}catch(r){if(r?.response)throw r;if(!!!window?.api?.timeEvents?.insert)throw new Error("Network error: time entry clock-in did not reach the server. Please check your connection and try again.");const a={event_id:hR(),user_id:e,device_id:localStorage.getItem("deviceId")||"unknown-device",type:"time_clock_in",timestamp_utc:kv(new Date),payload_json:JSON.stringify({profile_id:e,so_id:t}),created_at:kv(new Date)};return await window?.api?.timeEvents?.insert?.(a),{id:-Math.floor(Math.random()*1e9),profile_id:e,profile_name:"",sales_order_id:t,sales_order_number:"",clock_in:new Date().toISOString(),clock_out:null,duration:null,unit_price:0,__pending:!0,__pending_event_id:a.event_id}}},ofe=async e=>{try{return(await ve.post(`/api/time-tracking/time-entries/${e}/clock-out`)).data}catch{if(!!!window?.api?.timeEvents?.insert)throw new Error("Network error: time entry clock-out did not reach the server. Please check your connection and try again.");const n={event_id:hR(),device_id:localStorage.getItem("deviceId")||"unknown-device",type:"time_clock_out",timestamp_utc:kv(new Date),payload_json:JSON.stringify({id:e}),created_at:kv(new Date)};return await window?.api?.timeEvents?.insert?.(n),{id:e,clock_out:new Date().toISOString(),__pending:!0,__pending_event_id:n.event_id}}},sfe=async(e,t,r)=>(await ve.put(`/api/time-tracking/time-entries/${e}`,{clock_in:t,clock_out:r})).data,lfe=async e=>{await ve.delete(`/api/time-tracking/time-entries/${e}`)},cfe=async(e,t,r,n)=>(await ve.post("/api/time-tracking/time-entries/manual",{profile_id:e,sales_order_id:t,clock_in:r,clock_out:n})).data,ufe=async(e,t,r,n)=>(await ve.get("/api/time-tracking/reports/time-entries",{params:{from:e,to:t,profile:r,so:n}})).data,dfe=async(e,t,r,n,a="csv")=>(await ve.get("/api/time-tracking/reports/time-entries/export",{params:{from:e,to:t,profile:r,so:n,format:a},responseType:"blob"})).data,VE=async e=>(await ve.get("/api/time-tracking/time-entries/open",{params:{profile_id:e}})).data,ffe=()=>{const{user:e}=ta(),[t,r]=x.useState([]),[n,a]=x.useState([]),[o,s]=x.useState([]),[l,c]=x.useState([]),[u,d]=x.useState(""),[f,h]=x.useState(""),[p,v]=x.useState(!0),[m,y]=x.useState(!1),[b,_]=x.useState(null),[w,A]=x.useState(null),P=x.useRef(null),T=R=>{P.current&&window.clearTimeout(P.current),A(R),P.current=window.setTimeout(()=>{A(null),P.current=null},2500)};x.useEffect(()=>()=>{P.current&&window.clearTimeout(P.current)},[]),x.useEffect(()=>{E()},[]),x.useEffect(()=>{u?S():s([])},[u]),x.useEffect(()=>{const R=setInterval(()=>{s(F=>F.map(z=>{if(!z.clock_out){const K=new Date,J=new Date(z.clock_in),L=(K.getTime()-J.getTime())/(1e3*60*60);return{...z,duration:L}}return z})),c(F=>F.map(z=>{if(!z.clock_out){const K=new Date,J=new Date(z.clock_in),L=(K.getTime()-J.getTime())/(1e3*60*60);return{...z,duration:L}}return z}))},1e3);return()=>clearInterval(R)},[]);const E=async()=>{try{v(!0);const[R,F]=await Promise.all([SS(),pR()]);console.log("Sales orders data received:",F),r(R),a(F),I(R),_(null)}catch(R){_("Failed to fetch data. Please try again."),console.error("Error fetching data:",R)}finally{v(!1)}},S=async()=>{if(u)try{const[R,F]=await Promise.all([afe(new Date().toISOString().split("T")[0],u),VE(u)]),z=new Map;[...R,...F].forEach(K=>{z.set(K.id,K)}),s(Array.from(z.values()))}catch(R){_("Failed to fetch time entries. Please try again."),console.error("Error fetching time entries:",R)}},I=async R=>{const F=R||t;if(!F.length){c([]);return}try{y(!0);const z=[];await Promise.all(F.map(async K=>{try{(await VE(K.id)).forEach(L=>{z.push({...L,profile_name:K.name})})}catch(J){console.error(`Failed to fetch open time entries for profile ${K.id}`,J)}})),c(z)}catch(z){console.error("Error fetching active time entries:",z)}finally{y(!1)}},W=async()=>{if(!u||!f){_("Please select both a profile and a sales order");return}if(o.find(F=>F.sales_order_id===f&&!F.clock_out)){_("You are already clocked in for this sales order");return}try{A(null);const F=await ife(u,f);s([F,...o]),d(""),h(""),s([]),_(null),T("Successfully clocked in."),I()}catch(F){A(null),F.response&&F.response.data&&F.response.data.error.includes("attendance")?_("You must clock in for attendance before you can clock in for a sales order."):_(F?.message||"Failed to clock in. Please try again."),console.error("Error clocking in:",F)}},O=async R=>{try{A(null);const F=await ofe(R);s(o.map(z=>z.id===R?F:z)),d(""),h(""),s([]),_(null),T("Successfully clocked out."),I()}catch(F){A(null),_(F?.message||"Failed to clock out. Please try again."),console.error("Error clocking out:",F)}},D=u&&o.some(R=>R.profile_id===u&&!R.clock_out);return p?i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:i.jsx(tr,{})}):i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Time Tracking"}),b&&i.jsx(Ot,{severity:"error",variant:"filled",sx:{mb:2,fontSize:"1.1rem",fontWeight:700,py:2},children:b}),i.jsxs(pr,{open:!!w,onClose:()=>A(null),PaperProps:{sx:{px:6,py:4,textAlign:"center"}},children:[i.jsx(mr,{sx:{fontSize:"2rem"},children:"Success"}),i.jsx(gr,{children:i.jsx(B,{variant:"h4",component:"p",children:w})})]}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(bt,{sx:{p:2},children:[i.jsx(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:i.jsx(B,{variant:"h6",children:"Profile"})}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Select Profile"}),i.jsx(cn,{value:u,label:"Select Profile",onChange:R=>d(R.target.value),sx:{"& .MuiSelect-select":{fontSize:"1.25rem",py:1.5,minHeight:56}},MenuProps:{PaperProps:{sx:{"& .MuiMenuItem-root":{fontSize:"1.25rem",py:1.5,minHeight:56},"& .MuiMenuItem-root.Mui-selected, & .MuiMenuItem-root.Mui-selected:hover":{backgroundColor:"rgba(25, 118, 210, 0.2)",color:"primary.main",fontWeight:700},"& .MuiMenuItem-root:hover":{backgroundColor:"rgba(25, 118, 210, 0.15)"}}}},children:t.map(R=>i.jsx(Zt,{value:R.id,sx:{fontSize:"1.2rem",py:1.25},children:R.name},R.id))})]})]})}),u&&i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(bt,{sx:{p:2},children:[i.jsx(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:i.jsx(B,{variant:"h6",children:"Sales Order"})}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Select Sales Order"}),i.jsx(cn,{value:f,label:"Select Sales Order",onChange:R=>h(R.target.value),sx:{"& .MuiSelect-select":{fontSize:"1.25rem",py:1.5,minHeight:56}},MenuProps:{PaperProps:{sx:{"& .MuiMenuItem-root":{fontSize:"1.25rem",py:1.5,lineHeight:1.3,minHeight:56},"& .MuiMenuItem-root.Mui-selected, & .MuiMenuItem-root.Mui-selected:hover":{backgroundColor:"rgba(25, 118, 210, 0.2)",color:"primary.main",fontWeight:700},"& .MuiMenuItem-root:hover":{backgroundColor:"rgba(25, 118, 210, 0.15)"}}}},children:n.map(R=>{const F=o.some(z=>z.sales_order_id===R.id&&!z.clock_out);return i.jsxs(Zt,{value:R.id,disabled:F,sx:{fontSize:"1.1rem"},children:[`${R.number} - ${R.product_name||"No Product Name"} - ${R.customer_name||"Unknown Customer"}`,F?" - Already Clocked In":""]},R.id)})})]})]})}),u&&f&&i.jsx(ie,{item:!0,xs:12,children:i.jsx(bt,{sx:{p:2},children:i.jsx(Z,{display:"flex",justifyContent:"center",gap:2,children:i.jsx(xe,{variant:"contained",sx:{backgroundColor:"green",px:4,py:2,fontSize:"1.2rem",fontWeight:700,borderRadius:"12px",minWidth:220,"&:hover":{backgroundColor:"darkgreen"}},onClick:W,disabled:D,children:"Clock In"})})})}),u&&i.jsx(ie,{item:!0,xs:12,children:i.jsxs(bt,{sx:{p:2},children:[i.jsxs(B,{variant:"h6",gutterBottom:!0,children:["Today's Time Entries for ",t.find(R=>R.id===u)?.name]}),i.jsx(pa,{children:i.jsxs(Jn,{children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Sales Order"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Clock In"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Clock Out"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Duration"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Actions"})]})}),i.jsx(ea,{children:o.map(R=>i.jsxs(hr,{children:[i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:R.sales_order_number}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:new Date(R.clock_in).toLocaleTimeString()}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:R.clock_out?new Date(R.clock_out).toLocaleTimeString():"-"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:Tv(R.duration)}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:!R.clock_out&&i.jsx(xe,{variant:"contained",sx:{backgroundColor:"red",px:3,py:1.5,fontSize:"1.1rem",fontWeight:700,borderRadius:"12px","&:hover":{backgroundColor:"darkred"}},onClick:()=>O(R.id),children:"Clock Out"})})]},R.id))})]})})]})}),i.jsx(ie,{item:!0,xs:12,children:i.jsxs(bt,{sx:{p:2},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[i.jsx(B,{variant:"h6",children:"Active Clock Ins"}),m&&i.jsx(tr,{size:24})]}),l.length===0&&!m?i.jsx(B,{color:"text.secondary",children:"No active clock ins."}):i.jsx(pa,{children:i.jsxs(Jn,{children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Profile"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Sales Order"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Clock In"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Duration"})]})}),i.jsx(ea,{children:l.map(R=>i.jsxs(hr,{children:[i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:R.profile_name||t.find(F=>F.id===R.profile_id)?.name||"Unknown"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:R.sales_order_number}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:new Date(R.clock_in).toLocaleString()}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:Tv(R.duration)})]},R.id))})]})})]})})]})]})};var $m={exports:{}},GE;function hfe(){return GE||(GE=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(c,u){switch(c){case"P":return u.date({width:"short"});case"PP":return u.date({width:"medium"});case"PPP":return u.date({width:"long"});case"PPPP":default:return u.date({width:"full"})}},n=function(c,u){switch(c){case"p":return u.time({width:"short"});case"pp":return u.time({width:"medium"});case"ppp":return u.time({width:"long"});case"pppp":default:return u.time({width:"full"})}},a=function(c,u){var d=c.match(/(P+)(p+)?/)||[],f=d[1],h=d[2];if(!h)return r(c,u);var p;switch(f){case"P":p=u.dateTime({width:"short"});break;case"PP":p=u.dateTime({width:"medium"});break;case"PPP":p=u.dateTime({width:"long"});break;case"PPPP":default:p=u.dateTime({width:"full"});break}return p.replace("{{date}}",r(f,u)).replace("{{time}}",n(h,u))},o={p:n,P:a},s=o;t.default=s,e.exports=t.default}($m,$m.exports)),$m.exports}var pfe=hfe();const mfe=Et(pfe),gfe={y:{sectionType:"year",contentType:"digit",maxLength:4},yy:"year",yyy:{sectionType:"year",contentType:"digit",maxLength:4},yyyy:"year",M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMMM:{sectionType:"month",contentType:"letter"},MMM:{sectionType:"month",contentType:"letter"},L:{sectionType:"month",contentType:"digit",maxLength:2},LL:"month",LLL:{sectionType:"month",contentType:"letter"},LLLL:{sectionType:"month",contentType:"letter"},d:{sectionType:"day",contentType:"digit",maxLength:2},dd:"day",do:{sectionType:"day",contentType:"digit-with-letter"},E:{sectionType:"weekDay",contentType:"letter"},EE:{sectionType:"weekDay",contentType:"letter"},EEE:{sectionType:"weekDay",contentType:"letter"},EEEE:{sectionType:"weekDay",contentType:"letter"},EEEEE:{sectionType:"weekDay",contentType:"letter"},i:{sectionType:"weekDay",contentType:"digit",maxLength:1},ii:"weekDay",iii:{sectionType:"weekDay",contentType:"letter"},iiii:{sectionType:"weekDay",contentType:"letter"},e:{sectionType:"weekDay",contentType:"digit",maxLength:1},ee:"weekDay",eee:{sectionType:"weekDay",contentType:"letter"},eeee:{sectionType:"weekDay",contentType:"letter"},eeeee:{sectionType:"weekDay",contentType:"letter"},eeeeee:{sectionType:"weekDay",contentType:"letter"},c:{sectionType:"weekDay",contentType:"digit",maxLength:1},cc:"weekDay",ccc:{sectionType:"weekDay",contentType:"letter"},cccc:{sectionType:"weekDay",contentType:"letter"},ccccc:{sectionType:"weekDay",contentType:"letter"},cccccc:{sectionType:"weekDay",contentType:"letter"},a:"meridiem",aa:"meridiem",aaa:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},vfe={year:"yyyy",month:"LLLL",monthShort:"MMM",dayOfMonth:"d",weekday:"EEEE",weekdayShort:"EEEEEE",hours24h:"HH",hours12h:"hh",meridiem:"aa",minutes:"mm",seconds:"ss",fullDate:"PP",fullDateWithWeekday:"PPPP",keyboardDate:"P",shortDate:"MMM d",normalDate:"d MMMM",normalDateWithWeekday:"EEE, MMM d",monthAndYear:"LLLL yyyy",monthAndDate:"MMMM d",fullTime:"p",fullTime12h:"hh:mm aa",fullTime24h:"HH:mm",fullDateTime:"PP p",fullDateTime12h:"PP hh:mm aa",fullDateTime24h:"PP HH:mm",keyboardDateTime:"P p",keyboardDateTime12h:"P hh:mm aa",keyboardDateTime24h:"P HH:mm"};class yfe{constructor(t){this.isMUIAdapter=!0,this.isTimezoneCompatible=!1,this.lib="date-fns",this.locale=void 0,this.formats=void 0,this.formatTokenMap=gfe,this.escapedCharacters={start:"'",end:"'"},this.longFormatters=void 0,this.date=o=>typeof o>"u"?new Date:o===null?null:new Date(o),this.dateWithTimezone=o=>this.date(o),this.getTimezone=()=>"default",this.setTimezone=o=>o,this.toJsDate=o=>o,this.getCurrentLocaleCode=()=>{var o;return((o=this.locale)==null?void 0:o.code)||"en-US"},this.is12HourCycleInCurrentLocale=()=>this.locale?/a/.test(this.locale.formatLong.time({width:"short"})):!0,this.expandFormat=o=>{const s=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g;return o.match(s).map(l=>{const c=l[0];if(c==="p"||c==="P"){const u=this.longFormatters[c];return u(l,this.locale.formatLong)}return l}).join("")},this.getFormatHelperText=o=>this.expandFormat(o).replace(/(aaa|aa|a)/g,"(a|p)m").toLocaleLowerCase(),this.isNull=o=>o===null,this.formatNumber=o=>o,this.getMeridiemText=o=>o==="am"?"AM":"PM";const{locale:r,formats:n,longFormatters:a}=t;this.locale=r,this.formats=vI({},vfe,n),this.longFormatters=a}}class YE extends yfe{constructor({locale:t,formats:r}={}){if(typeof Zm!="function")throw new Error(["MUI: The `date-fns` package v3.x is not compatible with this adapter.","Please, install v2.x of the package or use the `AdapterDateFnsV3` instead."].join(`
`));super({locale:t??Iy,formats:r,longFormatters:mfe}),this.parseISO=n=>$se(n),this.toISO=n=>Aoe(n,{format:"extended"}),this.parse=(n,a)=>n===""?null:Dse(n,a,new Date,{locale:this.locale}),this.isValid=n=>t6(this.date(n)),this.format=(n,a)=>this.formatByString(n,this.formats[a]),this.formatByString=(n,a)=>Ru(n,a,{locale:this.locale}),this.getDiff=(n,a,o)=>{switch(o){case"years":return Pie(n,this.date(a));case"quarters":return Sie(n,this.date(a));case"months":return n6(n,this.date(a));case"weeks":return Aie(n,this.date(a));case"days":return r6(n,this.date(a));case"hours":return _ie(n,this.date(a));case"minutes":return wie(n,this.date(a));case"seconds":return Cie(n,this.date(a));default:return Ey(n,this.date(a))}},this.isEqual=(n,a)=>n===null&&a===null?!0:qoe(n,a),this.isSameYear=(n,a)=>qse(n,a),this.isSameMonth=(n,a)=>Rse(n,a),this.isSameDay=(n,a)=>gie(n,a),this.isSameHour=(n,a)=>Lse(n,a),this.isAfter=(n,a)=>v2(n,a),this.isAfterYear=(n,a)=>v2(n,p2(a)),this.isAfterDay=(n,a)=>v2(n,bw(a)),this.isBefore=(n,a)=>Mf(n,a),this.isBeforeYear=(n,a)=>Mf(n,Im(a)),this.isBeforeDay=(n,a)=>Mf(n,Pd(a)),this.isWithinRange=(n,[a,o])=>Fse(n,{start:a,end:o}),this.startOfYear=n=>Im(n),this.startOfMonth=n=>_4(n),this.startOfWeek=n=>zc(n,{locale:this.locale}),this.startOfDay=n=>Pd(n),this.endOfYear=n=>p2(n),this.endOfMonth=n=>_w(n),this.endOfWeek=n=>m2(n,{locale:this.locale}),this.endOfDay=n=>bw(n),this.addYears=(n,a)=>y4(n,a),this.addMonths=(n,a)=>eg(n,a),this.addWeeks=(n,a)=>pie(n,a),this.addDays=(n,a)=>Zm(n,a),this.addHours=(n,a)=>sie(n,a),this.addMinutes=(n,a)=>fie(n,a),this.addSeconds=(n,a)=>hie(n,a),this.getYear=n=>Roe(n),this.getMonth=n=>Eoe(n),this.getDate=n=>Poe(n),this.getHours=n=>Ooe(n),this.getMinutes=n=>Toe(n),this.getSeconds=n=>Ioe(n),this.getMilliseconds=n=>koe(n),this.setYear=(n,a)=>lle(n,a),this.setMonth=(n,a)=>rle(n,a),this.setDate=(n,a)=>nle(n,a),this.setHours=(n,a)=>ale(n,a),this.setMinutes=(n,a)=>ole(n,a),this.setSeconds=(n,a)=>sle(n,a),this.setMilliseconds=(n,a)=>ile(n,a),this.getDaysInMonth=n=>d6(n),this.getNextMonth=n=>eg(n,1),this.getPreviousMonth=n=>eg(n,-1),this.getMonthArray=n=>{const o=[Im(n)];for(;o.length<12;){const s=o[o.length-1];o.push(this.getNextMonth(s))}return o},this.mergeDateAndTime=(n,a)=>this.setSeconds(this.setMinutes(this.setHours(n,this.getHours(a)),this.getMinutes(a)),this.getSeconds(a)),this.getWeekdays=()=>{const n=new Date;return Oie({start:zc(n,{locale:this.locale}),end:m2(n,{locale:this.locale})}).map(a=>this.formatByString(a,"EEEEEE"))},this.getWeekArray=n=>{const a=zc(_4(n),{locale:this.locale}),o=m2(_w(n),{locale:this.locale});let s=0,l=a;const c=[];for(;Mf(l,o);){const u=Math.floor(s/7);c[u]=c[u]||[],c[u].push(l),l=Zm(l,1),s+=1}return c},this.getWeekNumber=n=>Loe(n,{locale:this.locale}),this.getYearRange=(n,a)=>{const o=Im(n),s=p2(a),l=[];let c=o;for(;Mf(c,s);)l.push(c),c=y4(c,1);return l}}}const Td=e=>new Date(e.getTime()-e.getTimezoneOffset()*6e4).toISOString(),CS=()=>crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,xfe=()=>new Promise((e,t)=>{if(typeof navigator>"u"||!navigator?.geolocation)return t(new Error("Location services are unavailable in this environment."));navigator.geolocation.getCurrentPosition(r=>e({latitude:r.coords.latitude,longitude:r.coords.longitude}),r=>t(r),{enableHighAccuracy:!0,timeout:1e4})}),bfe=()=>{try{const e=typeof navigator<"u"&&(navigator.userAgent||navigator.vendor)||"";if(e&&/android|iphone|ipad|ipod|mobile/i.test(e))return!0;if(typeof window<"u"&&window.matchMedia)return window.matchMedia("(max-width: 768px)").matches}catch{}return!1},_fe=async()=>{try{return(await ve.get("/api/attendance/geofence")).data}catch{return null}},wfe=async e=>(await ve.get("/api/attendance",{params:{profile_id:e}})).data,jfe=async e=>{const t=bfe(),r=t?await _fe():null,n=!!(t&&r?.enabled&&r?.configured);let a=null;if(n)try{a=await xfe()}catch(s){const l=s?.message||"Location access is required to clock in because geofencing is enabled. Please allow location permissions and try again.",c=new Error(l);throw c.code="GEOFENCE_LOCATION_REQUIRED",c}const o={profile_id:e};a&&(o.latitude=a.latitude,o.longitude=a.longitude);try{return(await ve.post("/api/attendance/clock-in",o)).data}catch(s){if(s?.response)throw s;if(!!!window?.api?.timeEvents?.insert)throw new Error("Network error: clock-in did not reach the server. Please check your connection and try again.");const c={...o},u={event_id:CS(),user_id:e,device_id:localStorage.getItem("deviceId")||"unknown-device",type:"attendance_clock_in",timestamp_utc:Td(new Date),payload_json:JSON.stringify(c),created_at:Td(new Date)};return await window?.api?.timeEvents?.insert?.(u),{id:-Math.floor(Math.random()*1e9),profile_id:e,clock_in:new Date().toISOString(),clock_out:null,duration:null,__pending:!0,__pending_event_id:u.event_id}}},Sfe=async e=>{try{return(await ve.post("/api/attendance/clock-out",{shift_id:e})).data}catch{if(!!!window?.api?.timeEvents?.insert)throw new Error("Network error: clock-out did not reach the server. Please check your connection and try again.");const n={event_id:CS(),user_id:void 0,device_id:localStorage.getItem("deviceId")||"unknown-device",type:"attendance_clock_out",timestamp_utc:Td(new Date),payload_json:JSON.stringify({shift_id:e}),created_at:Td(new Date)};return await window?.api?.timeEvents?.insert?.(n),{id:e,clock_out:new Date().toISOString(),__pending:!0,__pending_event_id:n.event_id}}},Cfe=async(e,t,r)=>{try{return(await ve.post("/api/attendance/manual",{profile_id:e,clock_in:t,clock_out:r})).data}catch(n){throw n}},Afe=async(e,t,r)=>{try{return(await ve.put(`/api/attendance/${e}`,{clock_in:t,clock_out:r})).data}catch(n){if(n?.response)throw n;const a={event_id:CS(),device_id:localStorage.getItem("deviceId")||"unknown-device",type:"attendance_update",timestamp_utc:Td(new Date),payload_json:JSON.stringify({shift_id:e,clock_in:t,clock_out:r}),created_at:Td(new Date)};return await window?.api?.timeEvents?.insert?.(a),{id:e,clock_in:t,clock_out:r,__pending:!0,__pending_event_id:a.event_id}}},Pfe=async(e,t,r)=>(await ve.get("/api/attendance",{params:{profile_id:e,from:t,to:r}})).data,Ofe=async e=>(await ve.get("/api/attendance/active",{params:{profile_id:e}})).data,kfe=async e=>{await ve.delete(`/api/attendance/${e}`)};function Vl(e){if(!e)return"";const t=new Date(e),r=t.getTimezoneOffset()*6e4;return new Date(t.getTime()-r).toISOString().slice(0,16)}function Pu(e){return e?new Date(e).toISOString():null}function Hw(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}function dh(e){const t=Hw(e),r=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${r}-${n}-${a}`}const KE=["#2563eb","#22c55e","#f97316","#06b6d4","#eab308","#8b5cf6","#ef4444","#0ea5e9","#d946ef","#14b8a6"],Tfe="#9ca3af",Efe=()=>{const[e,t]=x.useState([]),[r,n]=x.useState([]),[a,o]=x.useState([]),[s,l]=x.useState(""),[c,u]=x.useState(""),d=new Date,f=new Date;f.setDate(d.getDate()-1);const h=new Date;h.setDate(f.getDate()-13);const[p,v]=x.useState(h),[m,y]=x.useState(f),[b,_]=x.useState(!0),[w,A]=x.useState(null),[P,T]=x.useState(null),[E,S]=x.useState(""),[I,W]=x.useState(""),[O,D]=x.useState(null),[R,F]=x.useState([]),[z,K]=x.useState({}),[J,L]=x.useState([]),[k,$]=x.useState(null),[X,C]=x.useState(null),[M,H]=x.useState(""),[U,te]=x.useState(""),[le,oe]=x.useState(!1),[ae,he]=x.useState(!0),[me,Q]=x.useState(!1),[G,ee]=x.useState(null),[se,V]=x.useState(""),[Ge,De]=x.useState(""),[Fe,Xe]=x.useState(""),[it,lt]=x.useState(!1),[vt,Ye]=x.useState(!1),[Ze,We]=x.useState(""),[wt,Nt]=x.useState(""),[kt,Wt]=x.useState(""),[jt,ur]=x.useState(!1),[$e,He]=x.useState(null),[Je,Ue]=x.useState(!1),[pt,at]=x.useState(null),[St,It]=x.useState(null),[Yt,Sr]=x.useState(!1),[Mr,nr]=x.useState(null),[Cr,Dr]=x.useState(null),[fn,Oa]=x.useState(null),En=x.useMemo(()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"}catch(Qe){return console.warn("Unable to determine browser timezone, defaulting to UTC.",Qe),"UTC"}},[]);x.useEffect(()=>{er()},[]);const er=async()=>{try{_(!0);const[Qe,Vt]=await Promise.all([SS(),pR()]);t(Qe),n(Vt);const[or,Fr]=await Promise.all([ve.get("/api/settings/daily-break-start").catch(()=>null),ve.get("/api/settings/daily-break-end").catch(()=>null)]);Dr(or?.data?.daily_break_start??null),Oa(Fr?.data?.daily_break_end??null),A(null)}catch(Qe){A("Failed to fetch data. Please try again."),console.error("Error fetching data:",Qe)}finally{_(!1)}},Jr=async()=>{if(!p||!m){A("Please select a date range");return}try{_(!0);const Qe=Hw(p),Vt=new Date(m.getFullYear(),m.getMonth(),m.getDate()+1),or=dh(Qe),Fr=dh(Vt);console.log("Requesting shifts for:",or,Fr);const Er={from_date:or,to_date:Fr};s&&(Er.profile_id=s),c&&(Er.sales_order_id=c);const jn=await ufe(or,Fr,s||void 0,c||void 0);if(o(jn),c)F([]),K({}),L([]);else{const ra=(await Pfe(s||void 0,or,Fr)).map(An=>({...An,id:Number(An.id),profile_id:Number(An.profile_id)}));console.log("Fetched shifts:",ra),F(ra);const bn=[];let Ta=new Date(Qe);const Ea=new Date(Vt);for(;Ta<Ea;){const Hr={date:dh(Ta)};s&&(Hr.profile_id=s);const no=await ve.get("/api/time-tracking/time-entries",{params:Hr});bn.push(...no.data),Ta.setDate(Ta.getDate()+1)}const ni={},na=[];ra.forEach(An=>{const Hr=Number(An.id);Number.isNaN(Hr)||(ni[Hr]=[])}),bn.forEach(An=>{const Hr=new Date(An.clock_in).getTime(),no=Number(An.profile_id);let ao=!1;for(const io of ra){const ji=Number(io.id);if(Number.isNaN(ji))continue;const oo=new Date(io.clock_in).getTime(),pi=io.clock_out?new Date(io.clock_out).getTime():null,Oo=Number(io.profile_id);if(pi&&!Number.isNaN(no)&&!Number.isNaN(Oo)&&no===Oo&&Hr>=oo&&Hr<pi){ni[ji].push(An),ao=!0;break}}ao||na.push(An)}),K(ni),L(na)}A(null)}catch(Qe){A("Failed to generate report. Please try again."),console.error("Error generating report:",Qe)}finally{_(!1)}},Vn=async Qe=>{if(!p||!m){A("Please select both from and to dates");return}try{const Vt=Hw(p),or=new Date(m.getFullYear(),m.getMonth(),m.getDate()+1),Fr=dh(Vt),Er=dh(or),jn=await dfe(Fr,Er,s||void 0,c||void 0,Qe),Lr=c?`time-entries-report-so-${c}.${Qe}`:`time-entries-report.${Qe}`;Ife(jn,Lr)}catch(Vt){A("Failed to export report. Please try again."),console.error("Error exporting report:",Vt)}},In=async()=>{if(P){D(null),A(null);try{const Qe=Pu(E),Vt=Pu(I),or=await sfe(P.id,Qe,Vt);o(a.map(Fr=>Fr.id===P.id?{...Fr,clock_in:or.clock_in,clock_out:or.clock_out,duration:or.duration}:Fr)),D(null),T(null),A(null)}catch(Qe){const or=(Qe?.response?.data?.message??Qe?.response?.data?.error)||"Failed to update time entry. Please try again.";D(or),A(or),console.error("Error updating time entry:",Qe)}}},Yr=Qe=>{ee(Qe),Q(!0),V(c!==""?c:""),De(Qe.clock_in?Vl(Qe.clock_in):""),Xe(Qe.clock_out?Vl(Qe.clock_out):""),A(null)},Kr=()=>{Q(!1),ee(null),De(""),Xe(""),V(c!==""?c:""),lt(!1)},je=async()=>{if(!G||se===""||!Ge||!Fe)return;const Qe=Pu(Ge),Vt=Pu(Fe);if(!(!Qe||!Vt)){lt(!0),A(null);try{await cfe(G.profile_id,Number(se),Qe,Vt),Kr(),await Jr()}catch(or){const Fr=or?.response?.data?.message||or?.response?.data?.error||"Failed to create time entry. Please try again.";A(Fr),console.error("Error creating manual time entry:",or)}finally{lt(!1)}}},Ve=Qe=>{at(null),A(null),He(Qe)},ot=()=>{Je||(He(null),at(null))},Oe=async()=>{if(!$e)return;const Qe=$e.id;Ue(!0),at(null),A(null);try{await lfe(Qe),He(null),await Jr()}catch(Vt){const or=Vt?.response?.data?.message||Vt?.response?.data?.error||"Failed to delete time entry.";at(or),A(or)}finally{Ue(!1)}},qe=Qe=>{nr(null),A(null),It(Qe)},rt=()=>{Yt||(It(null),nr(null))},Pt=async()=>{if(!St)return;const Qe=St.id;Sr(!0),nr(null),A(null);try{await kfe(Qe),It(null),await Jr()}catch(Vt){const or=Vt?.response?.data?.message||Vt?.response?.data?.error||"Failed to delete shift.";nr(or),A(or)}finally{Sr(!1)}};x.useEffect(()=>{X&&(H(X.clock_in?Vl(X.clock_in):""),te(X.clock_out?Vl(X.clock_out):""))},[X]);const{stackedChartData:Kt,salesOrderKeys:ar,salesOrderColorMap:kr}=x.useMemo(()=>{const Qe=new Set,Vt=new Map;R.forEach(Er=>{const jn=Number(Er.id),Lr=Number(Er.profile_id);if(Number.isNaN(jn)||Number.isNaN(Lr)||!Er.clock_in||!Er.clock_out)return;const ra=Er.profile_name||e.find(ni=>ni.id===Lr)?.name||`Profile ${Lr}`,bn=Vw(Er.duration,Er.clock_in,Er.clock_out,Cr,fn,En),Ta=z[jn]||[],Ea=Vt.get(Lr)||{profileName:ra,total:0,salesOrders:{}};Ea.total+=bn,Ta.forEach(ni=>{const na=ni.sales_order_number||`SO ${ni.sales_order_id||"Unknown"}`,An=Hc(ni.duration),Hr=An!==null?An:0;Ea.salesOrders[na]=(Ea.salesOrders[na]||0)+Hr,Qe.add(na)}),Vt.set(Lr,Ea)});const or=Array.from(Vt.values()).map(Er=>{const jn=Object.values(Er.salesOrders).reduce((ra,bn)=>ra+bn,0),Lr=Math.max(0,Er.total-jn);return{profileName:Er.profileName,...Er.salesOrders,Idle:Lr}}),Fr={Idle:Tfe};return Array.from(Qe).forEach((Er,jn)=>{Fr[Er]=KE[jn%KE.length]}),{stackedChartData:or,salesOrderKeys:Array.from(Qe),salesOrderColorMap:Fr}},[En,fn,Cr,e,z,R]),rn=({active:Qe,payload:Vt,label:or})=>{if(!Qe||!Vt?.length)return null;const Fr=Vt.filter(Er=>Er?.value&&Er.value>1e-4);return Fr.length?i.jsxs(bt,{sx:{p:1.5},elevation:3,children:[i.jsx(B,{variant:"subtitle2",fontWeight:700,children:or}),Fr.map(Er=>i.jsxs(B,{variant:"body2",children:[Er.name,": ",Number(Er.value).toFixed(2)," hrs"]},Er.name))]}):null},Vr=Math.max(320,Kt.length*80);if(b)return i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:i.jsx(tr,{})});const $n=Ge?new Date(Ge):null,ka=Fe?new Date(Fe):null,Ya=!!(G&&se!==""&&$n&&ka&&ka.getTime()>$n.getTime()),to=G?G.profile_name||e.find(Qe=>Qe.id===G.profile_id)?.name||`Profile ${G.profile_id}`:"",qi=St?St.profile_name||e.find(Qe=>Qe.id===St.profile_id)?.name||`Profile ${St.profile_id}`:"",Gn={};R.forEach(Qe=>{if(Qe.clock_in&&Qe.clock_out){const Vt=Number(Qe.id);if(Number.isNaN(Vt))return;const or=Number(Qe.profile_id);if(Number.isNaN(or))return;new Date(Qe.clock_in).getTime(),new Date(Qe.clock_out).getTime();const Fr=Vw(Qe.duration,Qe.clock_in,Qe.clock_out,Cr,fn,En),Er=z[Vt]||[];let jn=0;Er.forEach(Ta=>{const Ea=Hc(Ta.duration);jn+=Ea!==null?Ea:0});const Lr=Math.max(0,Fr-jn),ra=Math.min(Fr,8),bn=Math.max(0,Fr-8);Gn[or]||(Gn[or]={hours:0,idle:0,regular:0,overtime:0}),Gn[or].hours+=Fr,Gn[or].idle+=Lr,Gn[or].regular+=ra,Gn[or].overtime+=bn}});let hi={},ro={};return c&&a.forEach(Qe=>{const Vt=Qe.profile_name||"Unknown",or=Hc(Qe.duration),Fr=or!==null?or:0;hi[Vt]=(hi[Vt]||0)+Fr,ro[Vt]||(ro[Vt]=[]),ro[Vt].push({date:Qe.date,duration:Fr})}),i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsx(B,{variant:"h4",gutterBottom:!0,sx:{fontSize:"2.5rem"},children:"Time Tracking Reports"}),w&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:w}),i.jsx(Z,{mb:3,children:i.jsxs(bt,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,sx:{fontSize:"1.5rem"},children:"Hours by Profile (Attendance vs Sales Orders)"}),Kt.length>0?i.jsx(Z,{sx:{width:"100%",height:Vr},children:i.jsx(xD,{children:i.jsxs($L,{data:Kt,layout:"vertical",margin:{top:16,right:24,left:24,bottom:16},children:[i.jsx(cv,{strokeDasharray:"3 3"}),i.jsx(Zc,{type:"number",tickFormatter:Qe=>`${Qe}h`}),i.jsx(eu,{dataKey:"profileName",type:"category",width:180}),i.jsx(xo,{content:rn}),i.jsx(Ss,{wrapperStyle:{paddingTop:8}}),ar.map(Qe=>i.jsx(yl,{dataKey:Qe,stackId:"hours",fill:kr[Qe]},Qe)),i.jsx(yl,{dataKey:"Idle",stackId:"hours",fill:kr.Idle})]})})}):i.jsx(B,{variant:"body1",sx:{color:"text.secondary"},children:"Generate a report to see attendance hours stacked by sales order and idle time."})]})}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsxs(bt,{sx:{p:2},children:[i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:2,children:i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{shrink:!0,children:"Profile"}),i.jsxs(cn,{value:s,label:"Profile",onChange:Qe=>l(Qe.target.value),displayEmpty:!0,sx:{"& .MuiSelect-select":{fontSize:"1.2rem"}},children:[i.jsx(Zt,{value:"",sx:{fontSize:"1.2rem"},children:"All Profiles"}),e.map(Qe=>i.jsx(Zt,{value:Qe.id,sx:{fontSize:"1.1rem"},children:Qe.name},Qe.id))]})]})}),i.jsx(ie,{item:!0,xs:12,md:2,children:i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{shrink:!0,children:"Sales Order"}),i.jsxs(cn,{value:c,label:"Sales Order",onChange:Qe=>u(Qe.target.value),displayEmpty:!0,sx:{"& .MuiSelect-select":{fontSize:"1.2rem"}},children:[i.jsx(Zt,{value:"",sx:{fontSize:"1.2rem"},children:"All Sales Orders"}),r.map(Qe=>i.jsx(Zt,{value:Qe.id,sx:{fontSize:"1.1rem"},children:`${Qe.number} - ${Qe.product_name||"No Product Name"} - ${Qe.customer_name||"Unknown Customer"}`},Qe.id))]})]})}),i.jsx(ie,{item:!0,xs:12,md:2,children:i.jsx(Os,{dateAdapter:YE,children:i.jsx(os,{label:"From Date",value:p,onChange:Qe=>v(Qe),slotProps:{textField:{fullWidth:!0}}})})}),i.jsx(ie,{item:!0,xs:12,md:2,children:i.jsx(Os,{dateAdapter:YE,children:i.jsx(os,{label:"To Date",value:m,onChange:Qe=>y(Qe),slotProps:{textField:{fullWidth:!0}}})})})]}),i.jsxs(Z,{display:"flex",justifyContent:"center",gap:2,mt:2,children:[i.jsx(xe,{variant:"contained",color:"secondary",onClick:()=>{We(s===""?"":s),Nt(""),Wt(""),A(null),Ye(!0)},children:"Add Shift"}),i.jsx(xe,{variant:"contained",color:"primary",onClick:Jr,children:"Generate Report"}),i.jsx(xe,{variant:"outlined",onClick:()=>Vn("csv"),children:"Export CSV"}),i.jsx(xe,{variant:"outlined",onClick:()=>Vn("pdf"),children:"Download PDF"})]})]})}),i.jsx(ie,{item:!0,xs:12,children:c?i.jsxs(bt,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,sx:{fontSize:"1.5rem"},children:"Time Entries Report for Sales Order"}),i.jsx(Z,{mb:2,children:i.jsxs(bt,{elevation:2,sx:{p:2,background:"#ede9fe",borderLeft:"6px solid #7c3aed"},children:[i.jsx(B,{variant:"h6",color:"#7c3aed",fontWeight:700,sx:{fontSize:"1.5rem"},children:"Total Hours by Profile on Sales Order"}),Object.entries(hi).map(([Qe,Vt])=>i.jsxs(B,{variant:"body1",sx:{ml:2,fontSize:"1.2rem"},children:[" ",Qe,": ",Vt.toFixed(2)," hrs"]},Qe))]})}),i.jsxs(bt,{elevation:3,sx:{p:2,mb:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Time Entries for Sales Order"}),i.jsx(pa,{children:i.jsxs(Jn,{children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Profile"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Date"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Clock In"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Clock Out"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Duration"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Actions"})]})}),i.jsx(ea,{children:a.map(Qe=>i.jsxs(hr,{children:[i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:Qe.profile_name}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:new Date(Qe.date).toLocaleDateString()}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:new Date(Qe.clock_in).toLocaleTimeString()}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:Qe.clock_out?new Date(Qe.clock_out).toLocaleTimeString():"-"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:Tv(Qe.duration)}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:Qe.clock_out&&i.jsx(xe,{variant:"text",startIcon:i.jsx(Ep,{}),onClick:()=>{D(null),A(null),T(Qe),S(Vl(Qe.clock_in)),W(Vl(Qe.clock_out))},sx:{ml:1},children:"Edit"})})]},Qe.id))})]})})]})]}):i.jsxs(bt,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,sx:{fontSize:"1.5rem"},children:"Time Entries Report"}),i.jsx(Z,{display:"flex",alignItems:"center",mb:2,children:i.jsx(ti,{control:i.jsx(hl,{checked:ae,onChange:Qe=>he(Qe.target.checked),color:"primary"}),label:i.jsx(B,{sx:{fontSize:"1.1rem"},children:"Show time entry breakdown"})})}),R.length>0&&i.jsx(Z,{mb:2,children:i.jsxs(bt,{elevation:2,sx:{p:2,background:"#ede9fe",borderLeft:"6px solid #7c3aed"},children:[i.jsx(B,{variant:"h6",color:"#7c3aed",fontWeight:700,children:"Summary of Shift Hours by Profile"}),i.jsx(pa,{component:bt,sx:{mt:2},children:i.jsxs(Jn,{size:"small",children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Profile Name"}),i.jsx(Ae,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Total hr"}),i.jsx(Ae,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Idle hr"}),i.jsx(Ae,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Regular hr"}),i.jsx(Ae,{sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Overtime hr"})]})}),i.jsx(ea,{children:Object.entries(Gn).map(([Qe,Vt])=>{const Fr=R.find(Er=>Er.profile_id===Number(Qe))?.profile_name||e.find(Er=>Er.id===Number(Qe))?.name||`Profile ${Qe}`;return i.jsxs(hr,{children:[i.jsx(Ae,{sx:{fontSize:"1.2rem"},children:Fr}),i.jsx(Ae,{sx:{fontSize:"1.2rem"},children:Vt.hours.toFixed(2)}),i.jsx(Ae,{sx:{fontSize:"1.2rem"},children:Vt.idle.toFixed(2)}),i.jsx(Ae,{sx:{fontSize:"1.2rem"},children:Vt.regular.toFixed(2)}),i.jsx(Ae,{sx:{fontSize:"1.2rem"},children:Vt.overtime.toFixed(2)})]},Qe)})})]})})]})}),R.length===0&&!b&&i.jsx(Ot,{severity:"info",sx:{mb:2},children:"No shifts found"}),R.map(Qe=>{const Vt=Number(Qe.id);return Number.isNaN(Vt)?null:i.jsx(qfe,{shift:Qe,entries:z[Vt]||[],expanded:k===Vt,onExpand:()=>$(k===Vt?null:Vt),onAddEntry:Yr,setEditEntry:T,setEditClockIn:S,setEditClockOut:W,profiles:e,setEditShift:C,showBreakdown:ae,setEditEntryError:D,setError:A,onDeleteShift:qe,onDeleteEntry:Ve,dailyBreakStart:Cr,dailyBreakEnd:fn,timeZone:En},Vt)}),J.length>0&&i.jsx(bt,{elevation:3,sx:{mb:2,borderLeft:"6px solid #a21caf",background:"#f3e8ff"},children:i.jsxs(Z,{p:2,children:[i.jsx(B,{variant:"subtitle1",fontWeight:700,color:"#a21caf",sx:{fontSize:"1.2rem"},children:"Unscheduled Entries"}),i.jsx(gR,{entries:J,setEditEntry:T,setEditClockIn:S,setEditClockOut:W,setEditEntryError:D,setError:A,onDeleteEntry:Ve})]})})]})})]}),i.jsxs(pr,{open:me,onClose:Kr,children:[i.jsx(mr,{children:"Add Time Entry"}),i.jsxs(gr,{children:[G&&i.jsx(B,{variant:"body2",sx:{mb:2},children:`Profile: ${to} | Shift Date: ${new Date(G.clock_in).toLocaleDateString()}`}),i.jsxs(tn,{fullWidth:!0,sx:{mb:2},children:[i.jsx(ln,{id:"add-entry-sales-order-label",children:"Sales Order"}),i.jsxs(cn,{labelId:"add-entry-sales-order-label",value:se,label:"Sales Order",displayEmpty:!0,onChange:Qe=>{const Vt=Qe.target.value;V(Vt===""?"":Number(Vt))},children:[i.jsx(Zt,{value:"",disabled:!0,children:i.jsx("em",{children:"Select a Sales Order"})}),r.map(Qe=>i.jsx(Zt,{value:Qe.id,children:`${Qe.number} - ${Qe.product_name||"No Product Name"} - ${Qe.customer_name||"Unknown Customer"}`},Qe.id))]})]}),i.jsx(Pe,{label:"Clock In",type:"datetime-local",value:Ge,onChange:Qe=>De(Qe.target.value),fullWidth:!0,sx:{mb:2}}),i.jsx(Pe,{label:"Clock Out",type:"datetime-local",value:Fe,onChange:Qe=>Xe(Qe.target.value),fullWidth:!0})]}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:Kr,disabled:it,children:"Cancel"}),i.jsx(xe,{onClick:je,variant:"contained",disabled:!Ya||it,children:"Save"})]})]}),i.jsxs(pr,{open:!!P,onClose:()=>{T(null),D(null)},children:[i.jsx(mr,{children:"Edit Time Entry"}),i.jsxs(gr,{children:[O&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:O}),i.jsx(Pe,{label:"Clock In",type:"datetime-local",value:E,onChange:Qe=>S(Qe.target.value),fullWidth:!0,sx:{mb:2}}),i.jsx(Pe,{label:"Clock Out",type:"datetime-local",value:I,onChange:Qe=>W(Qe.target.value),fullWidth:!0})]}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:()=>{T(null),D(null)},children:"Cancel"}),i.jsx(xe,{onClick:In,variant:"contained",startIcon:i.jsx(kI,{}),children:"Save"})]})]}),i.jsxs(pr,{open:!!$e,onClose:ot,children:[i.jsx(mr,{children:"Delete Time Entry"}),i.jsxs(gr,{children:[pt&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:pt}),$e&&i.jsxs(B,{variant:"body2",children:["Are you sure you want to delete the entry for sales order ",$e.sales_order_number," on"," ",new Date($e.clock_in).toLocaleString(),"?"]})]}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:ot,disabled:Je,children:"Cancel"}),i.jsx(xe,{onClick:Oe,variant:"contained",color:"error",disabled:Je,children:"Delete"})]})]}),i.jsxs(pr,{open:vt,onClose:()=>{jt||Ye(!1)},children:[i.jsx(mr,{children:"Add Shift"}),i.jsxs(gr,{children:[i.jsxs(tn,{fullWidth:!0,sx:{mb:2},children:[i.jsx(ln,{id:"add-shift-profile-label",children:"Profile"}),i.jsxs(cn,{labelId:"add-shift-profile-label",value:Ze,label:"Profile",onChange:Qe=>We(Qe.target.value),displayEmpty:!0,renderValue:Qe=>{if(Qe==null)return i.jsx("em",{children:"Select Profile"});if(typeof Qe=="string"&&Qe==="")return i.jsx("em",{children:"Select Profile"});const Vt=e.find(or=>or.id===Number(Qe));return Vt?Vt.name:String(Qe)},children:[i.jsx(Zt,{value:"",children:i.jsx("em",{children:"Select Profile"})}),e.map(Qe=>i.jsx(Zt,{value:Qe.id,children:Qe.name},Qe.id))]})]}),i.jsx(Pe,{label:"Clock In",type:"datetime-local",value:wt,onChange:Qe=>Nt(Qe.target.value),fullWidth:!0,sx:{mb:2},InputLabelProps:{shrink:!0}}),i.jsx(Pe,{label:"Clock Out",type:"datetime-local",value:kt,onChange:Qe=>Wt(Qe.target.value),fullWidth:!0,InputLabelProps:{shrink:!0}})]}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:()=>{jt||Ye(!1)},children:"Cancel"}),i.jsx(xe,{onClick:async()=>{if(Ze===""||!wt||!kt)return;const Qe=Pu(wt),Vt=Pu(kt);if(!Qe||!Vt){A("Please provide valid shift times.");return}ur(!0);try{await Cfe(Ze,Qe,Vt),Ye(!1),Nt(""),Wt(""),A(null),await Jr()}catch(or){const Fr=or?.response?.data?.message||or?.response?.data?.error||"Failed to create shift.";A(Fr)}finally{ur(!1)}},variant:"contained",color:"primary",disabled:jt||Ze===""||!wt||!kt,children:"Save"})]})]}),i.jsxs(pr,{open:!!X,onClose:()=>C(null),children:[i.jsx(mr,{children:"Edit Shift"}),i.jsxs(gr,{children:[i.jsx(Pe,{label:"Clock In",type:"datetime-local",value:M,onChange:Qe=>H(Qe.target.value),fullWidth:!0,sx:{mb:2}}),i.jsx(Pe,{label:"Clock Out",type:"datetime-local",value:U,onChange:Qe=>te(Qe.target.value),fullWidth:!0})]}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:()=>C(null),children:"Cancel"}),i.jsx(xe,{onClick:async()=>{if(X){oe(!0);try{await Afe(X.id,new Date(M).toISOString(),new Date(U).toISOString()),C(null),oe(!1),await Jr()}catch(Qe){oe(!1);const Vt=Qe?.response?.data?.message||Qe?.response?.data?.error||"Failed to update shift.";A(Vt)}}},variant:"contained",color:"primary",disabled:le,children:"Save"})]})]}),i.jsxs(pr,{open:!!St,onClose:rt,children:[i.jsx(mr,{children:"Delete Shift"}),i.jsxs(gr,{children:[Mr&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:Mr}),St&&i.jsxs(B,{variant:"body2",children:["Are you sure you want to delete the shift for ",qi," on"," ",new Date(St.clock_in).toLocaleString(),"? Any associated time entries must be removed first."]})]}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:rt,disabled:Yt,children:"Cancel"}),i.jsx(xe,{onClick:Pt,variant:"contained",color:"error",disabled:Yt,children:"Delete"})]})]})]})};function Ife(e,t){const r=window.URL.createObjectURL(e),n=document.createElement("a");n.href=r,n.download=t,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(r),document.body.removeChild(n)}function Vw(e,t,r,n,a,o){const s=Hc(e);if(s!==null&&!Number.isNaN(s))return s;if(!t||!r)return 0;const l=new Date(t),c=new Date(r);return Number.isNaN(l.getTime())||Number.isNaN(c.getTime())||c.getTime()<=l.getTime()?0:Nfe(l,c,n,a,o)}function Nfe(e,t,r,n,a){let o=t.getTime()-e.getTime();if(r&&n){const l=Dfe(a),c=Mfe(e,t,r,n,l);o-=c}const s=Math.max(0,o/(1e3*60*60));return Math.round(s*100)/100}function Dfe(e){const t=(e||"").trim();if(!t)return"UTC";try{return new Intl.DateTimeFormat("en-US",{timeZone:t}),t}catch{return console.warn(`Invalid timezone "${t}" supplied. Falling back to UTC.`),"UTC"}}function Mfe(e,t,r,n,a){let o=0;if(t.getUTCDate()!==e.getUTCDate()||t.getUTCMonth()!==e.getUTCMonth()||t.getUTCFullYear()!==e.getUTCFullYear()){const l=Math.round((Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())-Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()))/864e5);for(let c=0;c<=l;c++){const u=mR(e,c),{start:d,end:f}=QE(u,r,n,a),h=Math.max(e.getTime(),d.getTime()),p=Math.min(t.getTime(),f.getTime());p>h&&(o+=p-h)}}else{const{start:l,end:c}=QE(e,r,n,a),u=Math.max(e.getTime(),l.getTime()),d=Math.min(t.getTime(),c.getTime());d>u&&(o+=d-u)}return Math.max(0,o)}function QE(e,t,r,n){const a=D2(e,t,n);let o=D2(e,r,n);return o.getTime()<=a.getTime()&&(o=D2(mR(e,1),r,n)),{start:a,end:o}}function D2(e,t,r){const[n="0",a="0"]=t.split(":"),o=Number(n),s=Number(a);if(Number.isNaN(o)||Number.isNaN(s))return new Date(e.getTime());const{year:l,month:c,day:u}=Lfe(e,r),d=new Date(Date.UTC(l,c-1,u,o,s,0,0)),f=Rfe(d,r);return new Date(d.getTime()-f*60*1e3)}function Lfe(e,t){const a=new Intl.DateTimeFormat("en-US",{timeZone:t,year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(e).reduce((o,s)=>(s.type!=="literal"&&(o[s.type]=s.value),o),{});return{year:Number(a.year),month:Number(a.month),day:Number(a.day)}}function Rfe(e,t){const a=new Intl.DateTimeFormat("en-US",{timeZone:t,hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).formatToParts(e).reduce((s,l)=>(l.type!=="literal"&&(s[l.type]=l.value),s),{});return(Date.UTC(Number(a.year),Number(a.month)-1,Number(a.day),Number(a.hour),Number(a.minute),Number(a.second))-e.getTime())/(1e3*60)}function mR(e,t){const r=new Date(e.getTime());return r.setUTCDate(r.getUTCDate()+t),r}function qfe({shift:e,entries:t,expanded:r,onExpand:n,onAddEntry:a,setEditEntry:o,setEditClockIn:s,setEditClockOut:l,profiles:c,setEditShift:u,showBreakdown:d,setEditEntryError:f,setError:h,onDeleteShift:p,onDeleteEntry:v,dailyBreakStart:m,dailyBreakEnd:y,timeZone:b}){const _=new Date(e.clock_in),w=e.clock_out?new Date(e.clock_out):null,A=Vw(e.duration,e.clock_in,e.clock_out,m,y,b),P=e.profile_name||c.find(S=>S.id===e.profile_id)?.name||`Profile ${e.profile_id}`;let T=0;t.forEach(S=>{const I=Hc(S.duration);T+=I!==null?I:0});const E=Math.max(0,A-T);return i.jsx(bt,{elevation:3,sx:{mb:2,borderLeft:"6px solid #7c3aed",background:r?"#f3e8ff":"white"},children:i.jsxs(Z,{p:2,children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsxs(B,{variant:"subtitle1",fontWeight:700,color:"#7c3aed",sx:{fontSize:"1.2rem"},children:["Profile: ",P,"  Date: ",_.toLocaleDateString()]}),i.jsxs(Z,{display:"flex",gap:1,children:[d&&i.jsx(xe,{variant:"contained",color:"primary",size:"small",onClick:n,children:r?"Hide Entries":"Show Entries"}),i.jsx(xe,{variant:"outlined",color:"primary",size:"small",onClick:()=>a(e),children:"Add Entry"}),i.jsx(xe,{variant:"contained",color:"primary",size:"small",onClick:()=>u(e),children:"Edit Shift"}),i.jsx(xe,{variant:"outlined",color:"error",size:"small",onClick:()=>p(e),startIcon:i.jsx(Id,{}),children:"Delete Shift"})]})]}),i.jsxs(B,{variant:"body1",sx:{mt:1,fontSize:"1.1rem"},children:["Shift: ",_.toLocaleTimeString(),"  ",w?w.toLocaleTimeString():"-"," (",A.toFixed(2)," hrs)"]}),d&&i.jsxs(Z,{sx:{mt:1,ml:2},children:[t.map((S,I)=>{const W=Hc(S.duration),O=W!==null?W:0,D=new Date(S.clock_in),R=S.clock_out?new Date(S.clock_out):null;return i.jsxs(B,{variant:"body2",sx:{fontSize:"1.1rem"},children:[" ",S.sales_order_number,": ",D.toLocaleTimeString(),"  ",R?R.toLocaleTimeString():"-"," (",O.toFixed(3)," hrs)"]},S.id||I)}),E>0&&i.jsxs(B,{variant:"body2",sx:{fontSize:"1.1rem"},children:[" Idle: ",E.toFixed(3)," hrs"]})]}),d&&r&&i.jsx(gR,{entries:t,setEditEntry:o,setEditClockIn:s,setEditClockOut:l,setEditEntryError:f,setError:h,onDeleteEntry:v})]})})}function gR({entries:e,setEditEntry:t,setEditClockIn:r,setEditClockOut:n,setEditEntryError:a,setError:o,onDeleteEntry:s}){return i.jsx(pa,{sx:{mt:1,mb:1},children:i.jsxs(Jn,{size:"small",children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{children:"Sales Order"}),i.jsx(Ae,{children:"Clock In"}),i.jsx(Ae,{children:"Clock Out"}),i.jsx(Ae,{children:"Duration"}),i.jsx(Ae,{children:"Actions"})]})}),i.jsx(ea,{children:e.map(l=>i.jsxs(hr,{children:[i.jsx(Ae,{children:l.sales_order_number}),i.jsx(Ae,{children:new Date(l.clock_in).toLocaleTimeString()}),i.jsx(Ae,{children:l.clock_out?new Date(l.clock_out).toLocaleTimeString():"-"}),i.jsx(Ae,{children:Tv(l.duration)}),i.jsxs(Ae,{children:[l.clock_out&&i.jsx(xe,{variant:"text",startIcon:i.jsx(Ep,{}),onClick:()=>{a(null),o(null),t(l),r(Vl(l.clock_in)),n(Vl(l.clock_out))},sx:{ml:1},children:"Edit"}),s&&i.jsx(xe,{variant:"text",color:"error",startIcon:i.jsx(Id,{}),onClick:()=>s(l),sx:{ml:l.clock_out?1:0},children:"Delete"})]})]},l.id))})]})})}const Wo={submitRequest:async e=>(await ve.post("/api/leave-management/request",e)).data,getMyRequests:async()=>(await ve.get("/api/leave-management/my-requests")).data,getAllRequests:async()=>(await ve.get("/api/leave-management/all-requests")).data,getCalendar:async(e,t)=>{const r={};return e&&(r.start_date=e),t&&(r.end_date=t),(await ve.get("/api/leave-management/calendar",{params:r})).data},approveRequest:async(e,t,r,n)=>(await ve.post(`/api/leave-management/approve/${e}`,{admin_notes:t,proposed_start_date:r,proposed_end_date:n})).data,denyRequest:async(e,t)=>(await ve.post(`/api/leave-management/deny/${e}`,{admin_notes:t})).data,proposeVacationDates:async(e,t,r,n)=>(await ve.post(`/api/leave-management/propose/${e}`,{proposed_start_date:t,proposed_end_date:r,admin_notes:n})).data,getProfiles:async()=>(await ve.get("/api/leave-management/profiles")).data,getLeaveHistory:async()=>(await ve.get("/api/leave-management/history")).data,getVacationSettings:async()=>(await ve.get("/api/leave-management/vacation-settings")).data,updateVacationSettings:async e=>(await ve.put("/api/leave-management/vacation-settings",{reset_date:e})).data,updateEmployeeVacationDays:async(e,t)=>(await ve.put(`/api/leave-management/profiles/${e}/vacation-days`,{total_vacation_days:t})).data,resetAllVacationDays:async()=>(await ve.post("/api/leave-management/reset-vacation-days")).data,getLeaveStatistics:async()=>(await ve.get("/api/leave-management/statistics")).data},Ffe=()=>{const{user:e}=ta(),t=Tn(),[r,n]=x.useState([]),[a,o]=x.useState([]),[s,l]=x.useState(!0),[c,u]=x.useState(null),[d,f]=x.useState(()=>{const k=Rt(),$=k.day();return k.subtract($,"day").startOf("day")}),[h,p]=x.useState({open:!1,requestId:0,action:"approve"}),[v,m]=x.useState(""),[y,b]=x.useState(null),[_,w]=x.useState(null),[A,P]=x.useState(!1),[T,E]=x.useState(!0);x.useEffect(()=>{console.log("LeaveManagementPage - User data:",e),(e?.access_role==="Admin"||e?.access_role==="Time Tracking")&&S()},[e]);const S=async()=>{try{console.log("LeaveManagementPage - Fetching data..."),l(!0);const[k,$]=await Promise.all([Wo.getAllRequests(),Wo.getProfiles()]);console.log("LeaveManagementPage - Data received:",{requestsData:k,profilesData:$}),n(k||[]),o($||[]),u(null)}catch(k){console.error("LeaveManagementPage - Error fetching data:",k),u(k.response?.data?.message||"Failed to load data. Please try again.")}finally{l(!1)}},I=()=>{const k=[],$=Rt();for(let X=0;X<7;X++){const C=d.add(X,"day"),M=C.isSame($,"day"),H=r.filter(U=>{if(U.status!=="approved")return!1;const te=Rt(U.start_date),le=Rt(U.end_date);return(te.isSame(C,"day")||te.isBefore(C))&&(le.isSame(C,"day")||le.isAfter(C))}).map(U=>U.profile_name);k.push({date:C,isToday:M,hasTimeOff:H.length>0,timeOffProfiles:H})}return k},W=k=>{f(k==="prev"?$=>$.subtract(7,"day"):$=>$.add(7,"day"))},O=()=>{const k=Rt(),$=k.day();f(k.subtract($,"day").startOf("day"))},D=()=>{const k=d.add(6,"day");return r.filter($=>{if($.status!=="approved")return!1;const X=Rt($.start_date),C=Rt($.end_date);return(X.isSame(k,"day")||X.isBefore(k))&&(C.isSame(d,"day")||C.isAfter(d))}).map($=>({profileName:$.profile_name,startDate:Rt($.start_date),endDate:Rt($.end_date),requestType:$.request_type,reason:$.reason})).sort(($,X)=>$.startDate.valueOf()-X.startDate.valueOf())},R=()=>{const k=Rt(),$=k.startOf("month"),X=k.endOf("month");return r.filter(M=>{if(M.status!=="approved")return!1;const H=Rt(M.start_date),U=Rt(M.end_date);return(H.isSame(X,"day")||H.isBefore(X))&&(U.isSame($,"day")||U.isAfter($))}).map(M=>({profileName:M.profile_name,startDate:Rt(M.start_date),endDate:Rt(M.end_date),requestType:M.request_type})).sort((M,H)=>M.startDate.valueOf()-H.startDate.valueOf())},F=()=>{const k=R();if(k.length===0)return"No employees on leave this month";const $=new Map;return k.forEach(C=>{$.has(C.profileName)||$.set(C.profileName,[]),$.get(C.profileName).push(C)}),Array.from($.entries()).map(([C,M])=>{const H=M.map(U=>{const te=U.startDate.format("MMM D"),le=U.endDate.format("MMM D");return`${te}-${le}`}).join(", ");return`${C}: ${H}`}).slice(0,3).join("  ")},z=(k,$)=>{p({open:!0,requestId:k,action:$}),m(""),b(null),w(null)},K=async()=>{P(!0);try{const{requestId:k,action:$}=h;if($==="approve")await Wo.approveRequest(k,v,y?.format("YYYY-MM-DD"),_?.format("YYYY-MM-DD"));else if($==="deny")await Wo.denyRequest(k,v);else if($==="propose"){if(!y||!_){u("Please enter both start and end dates"),P(!1);return}if(_.isBefore(y)){u("End date cannot be before start date"),P(!1);return}await Wo.proposeVacationDates(k,y.format("YYYY-MM-DD"),_.format("YYYY-MM-DD"),v)}p({open:!1,requestId:0,action:"approve"}),await S()}catch(k){u(k.response?.data?.message||"Action failed. Please try again.")}finally{P(!1)}},J=k=>{const X={pending:{color:"warning",label:"Pending"},approved:{color:"success",label:"Approved"},denied:{color:"error",label:"Denied"},modified:{color:"info",label:"Modified"}}[k]||{color:"default",label:k};return i.jsx(st,{label:X.label,color:X.color,size:"small"})},L=k=>({vacation:"Vacation",sick:"Sick Day",personal:"Personal",bereavement:"Bereavement"})[k]||k;return e?e.access_role!=="Admin"&&e.access_role!=="Time Tracking"?i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(Ot,{severity:"error",children:"Access denied. Admin or Time Tracking privileges required to view this page."})}):s?i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:i.jsx(tr,{})})}):i.jsx(Os,{dateAdapter:oc,children:i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsxs(B,{variant:"h4",component:"h1",children:["Leave Management",e.access_role==="Admin"?" (Admin)":" (View Only)"]}),i.jsxs(Z,{display:"flex",gap:2,children:[i.jsx(xe,{variant:"outlined",startIcon:i.jsx(F2,{}),onClick:()=>t("/leave-history"),children:"View History"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Uu,{}),onClick:()=>t("/vacation-days-management"),children:"Manage Vacation Days"})]})]}),i.jsx(B,{variant:"body1",color:"text.secondary",paragraph:!0,children:F()}),c&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:c}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsxs(bt,{sx:{p:3},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsxs(B,{variant:"h6",children:[i.jsx(zu,{sx:{mr:1,verticalAlign:"middle"}}),"Weekly Leave Schedule"]}),i.jsxs(Z,{display:"flex",gap:1,children:[i.jsx(xe,{variant:"outlined",size:"small",onClick:()=>W("prev"),startIcon:i.jsx(C8,{}),children:"Previous Week"}),i.jsx(xe,{variant:"outlined",size:"small",onClick:O,startIcon:i.jsx(A8,{}),children:"Today"}),i.jsx(xe,{variant:"outlined",size:"small",onClick:()=>W("next"),endIcon:i.jsx(P8,{}),children:"Next Week"})]})]}),i.jsxs(B,{variant:"body2",color:"text.secondary",mb:3,children:["Week of ",d.format("MMMM D, YYYY")]}),i.jsx(Z,{sx:{overflowX:"auto"},children:i.jsx(pa,{component:bt,variant:"outlined",children:i.jsxs(Jn,{size:"small",children:[i.jsx(Zn,{children:i.jsxs(hr,{sx:{backgroundColor:"grey.50"},children:[i.jsx(Ae,{sx:{fontWeight:"bold",minWidth:140},children:"Employee Name"}),I().map((k,$)=>i.jsx(Ae,{align:"center",sx:{fontWeight:"bold",minWidth:70},children:i.jsxs(Z,{children:[i.jsx(B,{variant:"caption",display:"block",sx:{fontWeight:"bold"},children:k.date.format("ddd")}),i.jsx(B,{variant:"body2",children:k.date.format("MMM D")}),k.isToday&&i.jsx(B,{variant:"caption",display:"block",sx:{color:"primary.main",fontWeight:"bold"},children:"Today"})]})},$))]})}),i.jsxs(ea,{children:[D().map((k,$)=>i.jsxs(hr,{hover:!0,children:[i.jsx(Ae,{sx:{fontWeight:"medium"},children:k.profileName}),I().map((X,C)=>{const M=(k.startDate.isSame(X.date,"day")||k.startDate.isBefore(X.date))&&(k.endDate.isSame(X.date,"day")||k.endDate.isAfter(X.date));return i.jsx(Ae,{align:"center",sx:{backgroundColor:M?"error.light":"inherit",color:M?"error.dark":"text.primary",fontWeight:M?"medium":"normal"},children:M?i.jsxs(Z,{children:[i.jsx(B,{variant:"caption",display:"block",sx:{fontWeight:"bold",textTransform:"capitalize"},children:L(k.requestType)}),k.reason&&i.jsx(Hn,{title:k.reason,children:i.jsx(B,{variant:"caption",sx:{opacity:.75},children:k.reason.length>8?k.reason.substring(0,8)+"...":k.reason})})]}):i.jsx(B,{variant:"body2",color:"text.secondary",children:"-"})},C)})]},$)),D().length===0&&i.jsx(hr,{children:i.jsx(Ae,{colSpan:8,align:"center",sx:{py:4},children:i.jsxs(Z,{sx:{textAlign:"center"},children:[i.jsx(zu,{sx:{fontSize:48,color:"text.secondary",mb:2}}),i.jsx(B,{color:"text.secondary",children:"No employees on leave this week"})]})})})]})]})})})]})}),i.jsx(ie,{item:!0,xs:12,children:i.jsxs(bt,{sx:{p:3},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsxs(B,{variant:"h6",children:[i.jsx(O8,{sx:{mr:1,verticalAlign:"middle"}}),"Leave Requests",e.access_role!=="Admin"&&i.jsx(B,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:1},children:"View-only mode. Admin actions are restricted to administrators."})]}),i.jsxs(Z,{display:"flex",alignItems:"center",gap:2,children:[i.jsx(B,{variant:"body2",color:"text.secondary",children:"Show:"}),i.jsx(xe,{variant:T?"contained":"outlined",size:"small",onClick:()=>E(!0),sx:{minWidth:100},children:"Pending"}),i.jsx(xe,{variant:T?"outlined":"contained",size:"small",onClick:()=>E(!1),sx:{minWidth:100},children:"All"})]})]}),i.jsx(pa,{children:i.jsxs(Jn,{children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{sx:{fontWeight:"bold"},children:"Employee"}),i.jsx(Ae,{sx:{fontWeight:"bold"},children:"Type"}),i.jsx(Ae,{sx:{fontWeight:"bold"},children:"Dates"}),i.jsx(Ae,{sx:{fontWeight:"bold"},children:"Days"}),i.jsx(Ae,{sx:{fontWeight:"bold"},children:"Status"}),i.jsx(Ae,{sx:{fontWeight:"bold"},children:"Reason"}),i.jsx(Ae,{sx:{fontWeight:"bold"},children:"Admin Notes"}),i.jsx(Ae,{sx:{fontWeight:"bold"},children:"Actions"})]})}),i.jsx(ea,{children:(()=>{const k=T?r.filter($=>$.status==="pending"):r;return k.length===0?i.jsx(hr,{children:i.jsx(Ae,{colSpan:8,align:"center",sx:{py:4},children:i.jsx(B,{color:"text.secondary",children:T?"No pending leave requests found":"No leave requests found"})})}):k.map($=>i.jsxs(hr,{hover:!0,children:[i.jsx(Ae,{children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",sx:{fontWeight:"medium"},children:$.profile_name}),i.jsx(B,{variant:"caption",color:"text.secondary",children:$.user_email})]})}),i.jsx(Ae,{children:i.jsx(st,{label:L($.request_type),size:"small",variant:"outlined"})}),i.jsxs(Ae,{children:[i.jsx(B,{variant:"body2",children:Rt($.start_date).format("MMM D, YYYY")}),i.jsxs(B,{variant:"body2",children:["to ",Rt($.end_date).format("MMM D, YYYY")]})]}),i.jsx(Ae,{children:i.jsxs(B,{variant:"body2",children:[$.total_days," day",$.total_days!==1?"s":""]})}),i.jsx(Ae,{children:J($.status)}),i.jsx(Ae,{children:i.jsx(B,{variant:"body2",sx:{maxWidth:200},children:$.reason||"-"})}),i.jsx(Ae,{children:i.jsx(B,{variant:"body2",sx:{maxWidth:200},children:$.admin_notes||"-"})}),i.jsx(Ae,{children:$.status==="pending"&&e.access_role==="Admin"&&i.jsxs(Z,{display:"flex",gap:1,children:[i.jsx(Hn,{title:"Approve Request",children:i.jsx(xr,{color:"success",size:"small",onClick:()=>z($.request_id,"approve"),children:i.jsx(jh,{})})}),i.jsx(Hn,{title:"Deny Request",children:i.jsx(xr,{color:"error",size:"small",onClick:()=>z($.request_id,"deny"),children:i.jsx(Eu,{})})}),($.request_type==="vacation"||$.request_type==="personal"||$.request_type==="bereavement")&&i.jsx(Hn,{title:"Propose Dates",children:i.jsx(xr,{color:"info",size:"small",onClick:()=>z($.request_id,"propose"),children:i.jsx(zu,{})})})]})})]},$.request_id))})()})]})})]})})]}),i.jsxs(pr,{open:h.open,onClose:()=>p({open:!1,requestId:0,action:"approve"}),maxWidth:"sm",fullWidth:!0,children:[i.jsx(mr,{children:h.action==="approve"?"Approve Request":h.action==="deny"?"Deny Request":"Propose Dates"}),i.jsx(gr,{children:i.jsxs(Z,{sx:{pt:2},children:[(h.action==="propose"||h.action==="approve")&&i.jsx(Z,{sx:{mb:3},children:i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:6,children:i.jsx(os,{label:h.action==="propose"?"Proposed Start Date":"Proposed Start Date (Optional)",value:y,onChange:k=>b(k),slotProps:{textField:{fullWidth:!0,size:"small"}}})}),i.jsx(ie,{item:!0,xs:6,children:i.jsx(os,{label:h.action==="propose"?"Proposed End Date":"Proposed End Date (Optional)",value:_,onChange:k=>w(k),minDate:y,disabled:!y,slotProps:{textField:{fullWidth:!0,size:"small"}}})})]})}),i.jsx(Pe,{fullWidth:!0,multiline:!0,rows:3,label:"Admin Notes",value:v,onChange:k=>m(k.target.value),placeholder:"Add notes about this decision...",variant:"outlined",size:"small"})]})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:()=>p({open:!1,requestId:0,action:"approve"}),disabled:A,children:"Cancel"}),i.jsx(xe,{onClick:K,disabled:A,variant:"contained",color:h.action==="deny"?"error":"primary",children:A?"Processing...":h.action==="approve"?"Approve":h.action==="deny"?"Deny":"Propose"})]})]})]})}):i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsxs(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:[i.jsx(tr,{}),i.jsx(B,{variant:"body2",sx:{ml:2},children:"Loading user data..."})]})})},$fe=()=>{const{user:e}=ta(),[t,r]=x.useState([]),[n,a]=x.useState(null),[o,s]=x.useState(!0),[l,c]=x.useState(null);x.useEffect(()=>{(e?.access_role==="Admin"||e?.access_role==="Time Tracking")&&u()},[e]);const u=async()=>{try{s(!0);const[v,m]=await Promise.all([Wo.getLeaveHistory(),Wo.getLeaveStatistics()]);r(v||[]),a(m),c(null)}catch(v){console.error("Error fetching leave history:",v),c(v.response?.data?.message||"Failed to load leave history. Please try again.")}finally{s(!1)}},d=v=>Rt(v+"-01").format("MMMM YYYY"),f=v=>{let m=0;return Object.values(v.months).forEach(y=>{m+=y.total_days}),m},h=()=>{const v=new Set;return t.forEach(m=>{Object.keys(m.months).forEach(y=>v.add(y))}),Array.from(v).sort().reverse()};if(!e)return i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsxs(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:[i.jsx(tr,{}),i.jsx(B,{variant:"body2",sx:{ml:2},children:"Loading user data..."})]})});if(e.access_role!=="Admin"&&e.access_role!=="Time Tracking")return i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(Ot,{severity:"error",children:"Access denied. Admin or Time Tracking privileges required to view this page."})});if(o)return i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:i.jsx(tr,{})})});const p=h();return i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(B,{variant:"h4",component:"h1",gutterBottom:!0,children:[i.jsx(F2,{sx:{mr:1,verticalAlign:"middle"}}),"Leave History (Past 12 Months)"]}),i.jsx(B,{variant:"body1",color:"text.secondary",paragraph:!0,children:"View leave history for all employees over the past 12 months"}),l&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:l}),t.length===0?i.jsxs(bt,{sx:{p:4,textAlign:"center"},children:[i.jsx(F2,{sx:{fontSize:64,color:"text.secondary",mb:2}}),i.jsx(B,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Leave History Found"}),i.jsx(B,{color:"text.secondary",children:"No approved leave requests found in the past 12 months."})]}):i.jsxs(Z,{children:[i.jsxs(ie,{container:!0,spacing:3,sx:{mb:4},children:[i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(qr,{children:i.jsx(Wr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(TI,{sx:{fontSize:40,color:"primary.main",mr:2}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",component:"div",children:n?.employees_with_leave_this_month||0}),i.jsx(B,{color:"text.secondary",children:"Employees with Leave This Month"})]})]})})})}),i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(qr,{children:i.jsx(Wr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(zu,{sx:{fontSize:40,color:"success.main",mr:2}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",component:"div",children:n?.total_days_this_month||0}),i.jsx(B,{color:"text.secondary",children:"Total Days of Leave This Month"})]})]})})})}),i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsx(qr,{children:i.jsx(Wr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(EI,{sx:{fontSize:40,color:"info.main",mr:2}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",component:"div",children:n?.total_days_past_12_months||0}),i.jsx(B,{color:"text.secondary",children:"Total Days of Leave (Past 12 Months)"})]})]})})})})]}),t.map(v=>i.jsxs(k8,{sx:{mb:2},children:[i.jsx(T8,{expandIcon:i.jsx(II,{}),children:i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"h6",children:v.profile_name}),i.jsx(B,{variant:"body2",color:"text.secondary",children:v.profile_email})]}),i.jsxs(Z,{display:"flex",alignItems:"center",gap:2,children:[i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Total: ",f(v).toFixed(1)," days"]}),i.jsx(st,{label:`${Object.keys(v.months).length} months`,size:"small",variant:"outlined"})]})]})}),i.jsx(E8,{children:i.jsx(pa,{component:bt,variant:"outlined",children:i.jsxs(Jn,{size:"small",children:[i.jsx(Zn,{children:i.jsxs(hr,{sx:{backgroundColor:"grey.50"},children:[i.jsx(Ae,{sx:{fontWeight:"bold"},children:"Month"}),i.jsx(Ae,{align:"center",sx:{fontWeight:"bold"},children:"Vacation"}),i.jsx(Ae,{align:"center",sx:{fontWeight:"bold"},children:"Sick"}),i.jsx(Ae,{align:"center",sx:{fontWeight:"bold"},children:"Personal"}),i.jsx(Ae,{align:"center",sx:{fontWeight:"bold"},children:"Bereavement"}),i.jsx(Ae,{align:"center",sx:{fontWeight:"bold"},children:"Total"})]})}),i.jsx(ea,{children:p.map(m=>{const y=v.months[m];return!y||y.total_days===0?null:i.jsxs(hr,{hover:!0,children:[i.jsx(Ae,{sx:{fontWeight:"medium"},children:d(m)}),i.jsx(Ae,{align:"center",children:y.vacation_days>0?i.jsx(st,{label:y.vacation_days,size:"small",color:"success",variant:"outlined"}):"-"}),i.jsx(Ae,{align:"center",children:y.sick_days>0?i.jsx(st,{label:y.sick_days,size:"small",color:"error",variant:"outlined"}):"-"}),i.jsx(Ae,{align:"center",children:y.personal_days>0?i.jsx(st,{label:y.personal_days,size:"small",color:"info",variant:"outlined"}):"-"}),i.jsx(Ae,{align:"center",children:y.bereavement_days>0?i.jsx(st,{label:y.bereavement_days,size:"small",color:"warning",variant:"outlined"}):"-"}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"body2",sx:{fontWeight:"bold"},children:y.total_days})})]},m)})})]})})})]},v.profile_id))]})]})},Bfe=()=>{const{user:e}=ta(),[t,r]=x.useState([]),[n,a]=x.useState(null),[o,s]=x.useState(!0),[l,c]=x.useState(null),[u,d]=x.useState(null),[f,h]=x.useState(0),[p,v]=x.useState(!1),[m,y]=x.useState(null),[b,_]=x.useState(!1);x.useEffect(()=>{e?.access_role==="Admin"&&w()},[e]);const w=async()=>{try{s(!0);const[R,F]=await Promise.all([Wo.getProfiles(),Wo.getVacationSettings()]);r(R||[]),a(F),c(null)}catch(R){console.error("Error fetching data:",R),c(R.response?.data?.message||"Failed to load data. Please try again.")}finally{s(!1)}},A=R=>{d(R.id),h(R.total_vacation_days||R.vacation_days_available||20)},P=async()=>{if(!u)return;const R=Math.round(f);try{_(!0),await Wo.updateEmployeeVacationDays(u,R),await w(),d(null),h(0)}catch(F){c(F.response?.data?.message||"Failed to update vacation days.")}finally{_(!1)}},T=()=>{d(null),h(0)},E=()=>{y(n?.reset_date?Rt(n.reset_date):null),v(!0)},S=async()=>{if(!m){c("Please select a reset date.");return}try{_(!0),await Wo.updateVacationSettings(m.format("YYYY-MM-DD")),await w(),v(!1)}catch(R){c(R.response?.data?.message||"Failed to update settings.")}finally{_(!1)}},I=async()=>{if(window.confirm("This will reset vacation days for ALL employees. Are you sure?"))try{_(!0),await Wo.resetAllVacationDays(),await w()}catch(R){c(R.response?.data?.message||"Failed to reset vacation days.")}finally{_(!1)}};if(!e)return i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsxs(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:[i.jsx(tr,{}),i.jsx(B,{variant:"body2",sx:{ml:2},children:"Loading user data..."})]})});if(e.access_role!=="Admin")return i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(Ot,{severity:"error",children:"Access denied. Admin privileges required to view this page."})});if(o)return i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:i.jsx(tr,{})})});const W=t.length,O=t.reduce((R,F)=>R+(F.total_vacation_days||F.vacation_days_available||20),0),D=t.reduce((R,F)=>R+Math.round(F.days_used||0),0);return i.jsx(Os,{dateAdapter:oc,children:i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsxs(B,{variant:"h4",component:"h1",children:[i.jsx(Uu,{sx:{mr:1,verticalAlign:"middle"}}),"Vacation Days Management"]}),i.jsxs(Z,{display:"flex",gap:2,children:[i.jsx(xe,{variant:"outlined",startIcon:i.jsx(zu,{}),onClick:E,children:"Reset Settings"}),i.jsx(xe,{variant:"contained",color:"warning",startIcon:i.jsx(Xw,{}),onClick:I,disabled:b,children:"Reset All Days"})]})]}),i.jsx(B,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Manage vacation days allocation for each employee and set the global reset date."}),l&&i.jsx(Ot,{severity:"error",sx:{mb:2},children:l}),i.jsxs(ie,{container:!0,spacing:3,sx:{mb:4},children:[i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsx(qr,{children:i.jsx(Wr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(TI,{sx:{fontSize:40,color:"primary.main",mr:2}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",component:"div",children:W}),i.jsx(B,{color:"text.secondary",children:"Total Employees"})]})]})})})}),i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsx(qr,{children:i.jsx(Wr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(zu,{sx:{fontSize:40,color:"success.main",mr:2}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",component:"div",children:O}),i.jsx(B,{color:"text.secondary",children:"Total Days Allocated"})]})]})})})}),i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsx(qr,{children:i.jsx(Wr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(EI,{sx:{fontSize:40,color:"info.main",mr:2}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",component:"div",children:D}),i.jsx(B,{color:"text.secondary",children:"Days Used"})]})]})})})}),i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsx(qr,{children:i.jsx(Wr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(Uu,{sx:{fontSize:40,color:"warning.main",mr:2}}),i.jsxs(Z,{children:[i.jsx(B,{variant:"h6",component:"div",children:n?.reset_date?Rt(n.reset_date).format("MMM D, YYYY"):"Not Set"}),i.jsx(B,{color:"text.secondary",children:"Reset Date"})]})]})})})})]}),i.jsxs(bt,{sx:{p:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Employee Vacation Days"}),i.jsx(pa,{children:i.jsxs(Jn,{children:[i.jsx(Zn,{children:i.jsxs(hr,{sx:{backgroundColor:"grey.50"},children:[i.jsx(Ae,{sx:{fontWeight:"bold"},children:"Employee"}),i.jsx(Ae,{align:"center",sx:{fontWeight:"bold"},children:"Total Days"}),i.jsx(Ae,{align:"center",sx:{fontWeight:"bold"},children:"Days Used"}),i.jsx(Ae,{align:"center",sx:{fontWeight:"bold"},children:"Days Remaining"}),i.jsx(Ae,{align:"center",sx:{fontWeight:"bold"},children:"Reset Date"}),i.jsx(Ae,{align:"center",sx:{fontWeight:"bold"},children:"Actions"})]})}),i.jsx(ea,{children:t.map(R=>i.jsxs(hr,{hover:!0,children:[i.jsx(Ae,{children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",sx:{fontWeight:"medium"},children:R.name}),i.jsx(B,{variant:"caption",color:"text.secondary",children:R.email})]})}),i.jsx(Ae,{align:"center",children:u===R.id?i.jsx(Pe,{type:"number",value:f,onChange:F=>h(Math.max(0,parseInt(F.target.value)||0)),size:"small",sx:{width:80},inputProps:{min:0,step:1}}):i.jsx(B,{variant:"body2",sx:{fontWeight:"bold"},children:R.total_vacation_days||R.vacation_days_available||20})}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"body2",color:"text.secondary",children:Math.round(R.days_used||0)})}),i.jsx(Ae,{align:"center",children:i.jsx(st,{label:Math.round(R.days_remaining||R.vacation_days_available||20),size:"small",color:R.days_remaining&&R.days_remaining<5?"warning":"success",variant:"outlined"})}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"body2",color:"text.secondary",children:R.reset_date?Rt(R.reset_date).format("MMM D, YYYY"):"-"})}),i.jsx(Ae,{align:"center",children:u===R.id?i.jsxs(Z,{display:"flex",gap:1,children:[i.jsx(Hn,{title:"Save",children:i.jsx(xr,{color:"success",size:"small",onClick:P,disabled:b,children:i.jsx(kI,{})})}),i.jsx(Hn,{title:"Cancel",children:i.jsx(xr,{color:"error",size:"small",onClick:T,disabled:b,children:i.jsx(Eu,{})})})]}):i.jsx(Hn,{title:"Edit Vacation Days",children:i.jsx(xr,{color:"primary",size:"small",onClick:()=>A(R),children:i.jsx(Ep,{})})})})]},R.id))})]})})]}),i.jsxs(pr,{open:p,onClose:()=>v(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(mr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(Uu,{sx:{mr:1}}),"Vacation Reset Settings"]})}),i.jsx(gr,{children:i.jsxs(Z,{sx:{pt:2},children:[i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Set the date when vacation days will reset for all employees. This date will be the same for everyone and will repeat on the same month and day every year (e.g., January 1st, July 1st, etc.)."}),i.jsx(os,{label:"Reset Date",value:m,onChange:R=>y(R),slotProps:{textField:{fullWidth:!0,size:"small"}}}),m&&i.jsxs(Ot,{severity:"info",sx:{mt:2},children:["Vacation days will reset on ",m.format("MMMM D")," every year for all employees."]})]})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:()=>v(!1),disabled:b,children:"Cancel"}),i.jsx(xe,{onClick:S,disabled:b||!m,variant:"contained",children:b?"Saving...":"Save Settings"})]})]})]})})},Ufe=async()=>(await ve.get("/api/products")).data,zfe=()=>{const[e,t]=x.useState([]),[r,n]=x.useState(!1),[a,o]=x.useState(null),[s,l]=x.useState({page:0,pageSize:10}),[c,u]=x.useState(""),[d,f]=x.useState(!1),[h,p]=x.useState(null),[v,m]=x.useState(null);x.useEffect(()=>{y()},[]);const y=async()=>{n(!0),o(null);try{const S=[...await Ufe()].sort((I,W)=>Number(W.product_id)-Number(I.product_id));t(S)}catch{o("Failed to fetch products"),ge.error("Failed to fetch products")}finally{n(!1)}},b=e.filter(E=>{const S=c.toLowerCase();return E.product_name?.toLowerCase().includes(S)||E.product_description?.toLowerCase?.().includes(S)||String(E.product_id??"").toLowerCase().includes(S)}),_=async E=>{if(window.confirm("Are you sure you want to delete this product?"))try{await ve.delete(`/api/products/${E}`),t(S=>S.filter(I=>I.product_id!==E)),ge.success("Product deleted successfully")}catch{ge.error("Failed to delete product")}},w=()=>{const E=b.map(D=>({"Product ID":D.product_id,"Product Name":D.product_name,"Product Description":D.product_description??""})),S=Cl.unparse(E),I=new Blob([S],{type:"text/csv;charset=utf-8;"}),W=document.createElement("a"),O=URL.createObjectURL(I);W.href=O,W.setAttribute("download","products.csv"),W.style.visibility="hidden",document.body.appendChild(W),W.click(),document.body.removeChild(W),m("Products exported to CSV.")},A=()=>f(!0),P=()=>f(!1),T=[{field:"product_id",headerName:"Product ID",flex:.8,minWidth:110},{field:"product_name",headerName:"Product Name",flex:1.4,minWidth:200},{field:"product_description",headerName:"Product Description",flex:2,minWidth:250,valueGetter:E=>E.row.product_description??""},{field:"actions",headerName:"Actions",width:90,sortable:!1,filterable:!1,disableColumnMenu:!0,renderCell:E=>i.jsx(xr,{size:"small",color:"error",onClick:S=>{S.stopPropagation(),_(E.row.product_id)},children:i.jsx(ma,{})})}];return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Product List"}),i.jsx(Z,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:i.jsxs(dt,{direction:"row",spacing:2,children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:A,children:"New Product"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:w,children:"Export CSV"})]})})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(Pe,{fullWidth:!0,label:"Search",variant:"outlined",value:c,onChange:E=>u(E.target.value),InputProps:{startAdornment:i.jsx(sa,{position:"start",children:i.jsx(fi,{sx:{fontSize:22}})})},sx:{mb:2,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"small"}),i.jsx(Po,{rows:b.map(E=>({...E,id:E.product_id})),columns:T,loading:r,paginationModel:s,onPaginationModelChange:l,pageSizeOptions:[10,25,50],getRowId:E=>E.id,disableRowSelectionOnClick:!0,initialState:{sorting:{sortModel:[{field:"product_id",sort:"desc"}]}},sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"}}})]})}),h&&i.jsx(Ot,{severity:"error",sx:{mt:2},onClose:()=>p(null),children:h}),v&&i.jsx(Ot,{severity:"success",sx:{mt:2},onClose:()=>m(null),children:v}),a&&i.jsx(B,{color:"error",children:a}),i.jsx(wS,{open:d,onClose:P,onSave:async E=>{try{await ve.post("/api/products",E),ge.success("Product added successfully!"),f(!1),y()}catch{ge.error("Failed to add product")}},isEditMode:!1})]})},Wfe=({open:e,onClose:t,onSettingsSaved:r})=>{const[n,a]=x.useState({customBackupDir:"",customRestoreDir:""}),[o,s]=x.useState(!1),[l,c]=x.useState(!1),[u,d]=x.useState(null),[f,h]=x.useState(!1);x.useEffect(()=>{e&&p()},[e]);const p=async()=>{s(!0);try{const w=await ve.get("/api/backup/settings");a(w.data)}catch(w){console.error("Error fetching backup settings:",w),ge.error("Failed to load backup settings")}finally{s(!1)}},v=async()=>{c(!0);try{await ve.post("/api/backup/settings",n),ge.success("Backup settings saved successfully!"),r(),t()}catch(w){console.error("Error saving backup settings:",w),ge.error("Failed to save backup settings")}finally{c(!1)}},m=w=>{const A=w.target.files?.[0];A&&d(A)},y=async()=>{if(!u){ge.error("Please select a backup file to upload");return}h(!0);try{const w=new FormData;w.append("backup",u);const A=await ve.post("/api/backup/upload",w,{headers:{"Content-Type":"multipart/form-data"}});ge.success("Backup uploaded successfully!"),d(null),r(),t()}catch(w){console.error("Error uploading backup:",w),ge.error("Failed to upload backup file")}finally{h(!1)}},b=async()=>{try{if(window.api?.browseDirectory){const w=await window.api.browseDirectory({title:"Select Restore Directory"});w.success&&w.directory&&a(A=>({...A,customRestoreDir:w.directory}))}else ge.info("Please enter the restore directory path manually")}catch(w){console.error("Error browsing restore directory:",w),ge.error("Failed to browse directory")}},_=async()=>{try{if(window.api?.browseDirectory){const w=await window.api.browseDirectory({title:"Select Backup Directory"});w.success&&w.directory&&a(A=>({...A,customBackupDir:w.directory}))}else ge.info("In web version, please enter the backup directory path manually. Example: C:\\MyBackups or /home/user/backups")}catch(w){console.error("Error browsing backup directory:",w),ge.error("Failed to browse directory")}};return i.jsxs(pr,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,children:[i.jsx(mr,{children:i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[i.jsx(Uu,{}),"Backup Settings"]})}),i.jsx(gr,{children:o?i.jsx(Z,{sx:{display:"flex",justifyContent:"center",p:3},children:i.jsx(tr,{})}):i.jsxs(Z,{sx:{mt:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Custom Backup Directory"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Set a custom directory where backups will be stored on the server device. Note: Backups are created on the server, not your local device. The directory must be accessible from the server where the application is running."}),i.jsxs(ie,{container:!0,spacing:2,alignItems:"center",children:[i.jsx(ie,{item:!0,xs:!0,children:i.jsx(Pe,{fullWidth:!0,label:"Backup Directory Path",value:n.customBackupDir,onChange:w=>a(A=>({...A,customBackupDir:w.target.value})),placeholder:"e.g., C:\\MyBackups or /home/user/backups",helperText:n.customBackupDir?`Backups will be stored in: ${n.customBackupDir}`:"Leave empty to use default backup location (backups folder in server directory)"})}),i.jsx(ie,{item:!0,children:i.jsx(Hn,{title:"Browse for backup directory (Desktop app only)",children:i.jsx(xr,{onClick:_,children:i.jsx(i5,{})})})})]}),!n.customBackupDir&&i.jsxs(Ot,{severity:"info",sx:{mt:1},children:[i.jsx(nx,{children:"Default Backup Location"}),"Backups will be stored in the default location: ",i.jsx("strong",{children:"backups/"})," folder in the server directory. To use a custom location, enter a valid directory path above."]}),n.customBackupDir&&!n.customDirExists&&i.jsxs(Ot,{severity:"warning",sx:{mt:1},children:[i.jsx(nx,{children:"Directory Not Found"}),"The specified backup directory does not exist: ",i.jsx("strong",{children:n.customBackupDir}),"Backups will fall back to the default location until this directory is created."]}),n.currentBackupDir&&i.jsxs(Ot,{severity:"success",sx:{mt:1},children:[i.jsx(nx,{children:"Current Backup Location"}),"Backups are currently being stored in: ",i.jsx("strong",{children:n.currentBackupDir})]}),i.jsx(qn,{sx:{my:3}}),i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Custom Restore Directory"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Set a custom directory on the server to look for backup files when restoring. Note: This directory must be accessible from the server."}),i.jsxs(ie,{container:!0,spacing:2,alignItems:"center",children:[i.jsx(ie,{item:!0,xs:!0,children:i.jsx(Pe,{fullWidth:!0,label:"Restore Directory Path",value:n.customRestoreDir,onChange:w=>a(A=>({...A,customRestoreDir:w.target.value})),placeholder:"e.g., C:\\ExternalBackups or /home/user/external-backups",helperText:"Leave empty to use default restore location"})}),i.jsx(ie,{item:!0,children:i.jsx(Hn,{title:"Browse for restore directory",children:i.jsx(xr,{onClick:b,children:i.jsx(i5,{})})})})]}),i.jsx(qn,{sx:{my:3}}),i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Upload External Backup"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Upload a backup file from your device to restore from"}),i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsxs(xe,{variant:"outlined",component:"label",startIcon:i.jsx(dg,{}),disabled:f,children:["Select Backup File",i.jsx("input",{type:"file",hidden:!0,accept:".zip,.sql,.json",onChange:m})]}),u&&i.jsxs(B,{variant:"body2",children:["Selected: ",u.name]}),u&&i.jsx(xe,{variant:"contained",onClick:y,disabled:f,startIcon:f?i.jsx(tr,{size:20}):i.jsx(dg,{}),children:f?"Uploading...":"Upload & Restore"})]}),i.jsx(Ot,{severity:"info",sx:{mt:2},children:i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"Note:"})," Custom directories must be accessible by the application. Make sure the directories exist and have proper read/write permissions."]})})]})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:t,children:"Cancel"}),i.jsx(xe,{onClick:v,variant:"contained",disabled:l||o,startIcon:l?i.jsx(tr,{size:20}):void 0,children:l?"Saving...":"Save Settings"})]})]})},Hfe=()=>{const[e,t]=x.useState([]),[r,n]=x.useState(null),[a,o]=x.useState(!1),[s,l]=x.useState(!1),[c,u]=x.useState(null),[d,f]=x.useState(null),[h,p]=x.useState(null),[v,m]=x.useState(!1),y=async()=>{o(!0);try{const[I,W]=await Promise.all([ve.get("/api/backup/list"),ve.get("/api/backup/stats")]);t(I.data.backups),n(W.data)}catch(I){console.error("Error fetching backups:",I),ge.error("Failed to fetch backups")}finally{o(!1)}};x.useEffect(()=>{y()},[]);const b=async()=>{l(!0);try{const I=await ve.post("/api/backup/create");ge.success("Backup created successfully!"),y()}catch(I){console.error("Error creating backup:",I),ge.error("Failed to create backup")}finally{l(!1)}},_=async I=>{try{const W=await ve.get(`/api/backup/download/${I}`,{responseType:"blob"}),O=window.URL.createObjectURL(new Blob([W.data])),D=document.createElement("a");D.href=O,D.setAttribute("download",I),document.body.appendChild(D),D.click(),D.remove(),window.URL.revokeObjectURL(O),ge.success("Backup downloaded successfully!")}catch(W){console.error("Error downloading backup:",W),ge.error("Failed to download backup")}},w=async I=>{try{await ve.delete(`/api/backup/delete/${I}`),ge.success("Backup deleted successfully!"),f(null),y()}catch(W){console.error("Error deleting backup:",W),ge.error("Failed to delete backup")}},A=async I=>{u(I.manifest);try{const O=(await ve.post(`/api/backup/restore/${I.manifest}`)).data.results,D=Object.values(O).filter(F=>F==="success").length,R=Object.keys(O).length;D===R?ge.success("Backup restored successfully! Please refresh the page."):ge.warning(`Restore completed with ${D}/${R} components successful`),p(null),u(null)}catch(W){console.error("Error restoring backup:",W),ge.error("Failed to restore backup"),u(null)}},P=I=>{if(I===0)return"0 Bytes";const W=1024,O=["Bytes","KB","MB","GB"],D=Math.floor(Math.log(I)/Math.log(W));return parseFloat((I/Math.pow(W,D)).toFixed(2))+" "+O[D]},T=I=>I.replace(/(\d{4}-\d{2}-\d{2})T(\d{2})-(\d{2})-(\d{2})-(\d{3})Z/,"$1T$2:$3:$4.$5Z"),E=I=>new Date(T(I)).toLocaleString(),S=I=>{const W=I.components,O=Object.keys(W).length;return`${Object.values(W).filter(R=>R!==null).length}/${O}`};return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Backup Management"}),i.jsx(B,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:"Create, manage, and restore backups of your application data"})]}),r&&i.jsxs(ie,{container:!0,spacing:3,sx:{mb:4},children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(qr,{children:i.jsxs(Wr,{children:[i.jsx(B,{color:"text.secondary",gutterBottom:!0,children:"Total Backups"}),i.jsx(B,{variant:"h4",component:"div",children:r.total_backups})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(qr,{children:i.jsxs(Wr,{children:[i.jsx(B,{color:"text.secondary",gutterBottom:!0,children:"Total Size"}),i.jsx(B,{variant:"h4",component:"div",children:P(r.total_size)})]})})})]}),i.jsxs(Z,{sx:{mb:3,display:"flex",gap:2,flexWrap:"wrap"},children:[i.jsx(xe,{variant:"contained",startIcon:s?i.jsx(tr,{size:20}):i.jsx(Kw,{}),onClick:b,disabled:s,children:s?"Creating Backup...":"Create Backup"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Xw,{}),onClick:y,disabled:a,children:"Refresh"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Uu,{}),onClick:()=>m(!0),children:"Backup Settings"})]}),i.jsx(Ot,{severity:"warning",sx:{mb:3},children:i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"Important:"})," Restoring a backup will overwrite your current data. Make sure you have a backup of your current data before proceeding."]})}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden"},children:i.jsx(pa,{children:i.jsxs(Jn,{children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{children:"Date & Time"}),i.jsx(Ae,{children:"Components"}),i.jsx(Ae,{children:"Size"}),i.jsx(Ae,{children:"System Info"}),i.jsx(Ae,{align:"center",children:"Actions"})]})}),i.jsx(ea,{children:a?i.jsx(hr,{children:i.jsx(Ae,{colSpan:5,align:"center",children:i.jsx(tr,{})})}):e.length===0?i.jsx(hr,{children:i.jsx(Ae,{colSpan:5,align:"center",children:i.jsx(B,{variant:"body2",color:"text.secondary",children:"No backups found. Create your first backup to get started."})})}):e.map(I=>i.jsxs(hr,{hover:!0,children:[i.jsx(Ae,{children:i.jsx(B,{variant:"body2",children:E(I.timestamp)})}),i.jsxs(Ae,{children:[i.jsxs(Z,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[I.components.database&&i.jsx(st,{label:"Database",size:"small",color:"primary"}),I.components.uploads&&i.jsx(st,{label:"Uploads",size:"small",color:"secondary"}),I.components.config&&i.jsx(st,{label:"Config",size:"small",color:"default"})]}),i.jsxs(B,{variant:"caption",color:"text.secondary",children:[S(I)," components available"]})]}),i.jsx(Ae,{children:i.jsx(B,{variant:"body2",children:P(I.size)})}),i.jsx(Ae,{children:i.jsxs(B,{variant:"caption",color:"text.secondary",children:[I.system_info.platform,"  ",I.system_info.arch]})}),i.jsx(Ae,{align:"center",children:i.jsxs(Z,{sx:{display:"flex",gap:1,justifyContent:"center"},children:[i.jsx(Hn,{title:"Download Backup",children:i.jsx(xr,{size:"small",onClick:()=>_(I.manifest),children:i.jsx(PI,{})})}),i.jsx(Hn,{title:"Restore Backup",children:i.jsx(xr,{size:"small",color:"primary",onClick:()=>p(I),children:i.jsx(o5,{})})}),i.jsx(Hn,{title:"Delete Backup",children:i.jsx(xr,{size:"small",color:"error",onClick:()=>f(I.manifest),children:i.jsx(Id,{})})})]})})]},I.manifest))})]})})}),i.jsxs(pr,{open:!!d,onClose:()=>f(null),children:[i.jsx(mr,{children:"Delete Backup"}),i.jsx(gr,{children:i.jsx(B,{children:"Are you sure you want to delete this backup? This action cannot be undone."})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:()=>f(null),children:"Cancel"}),i.jsx(xe,{onClick:()=>d&&w(d),color:"error",variant:"contained",children:"Delete"})]})]}),i.jsxs(pr,{open:!!h,onClose:()=>p(null),maxWidth:"sm",fullWidth:!0,children:[i.jsx(mr,{children:i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[i.jsx(I8,{color:"warning"}),"Restore Backup"]})}),i.jsxs(gr,{children:[i.jsx(Ot,{severity:"warning",sx:{mb:2},children:i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"Warning:"})," This will overwrite your current data with the backup from"," ",h?E(h.timestamp):"","."]})}),i.jsx(B,{variant:"body2",gutterBottom:!0,children:"Backup components:"}),i.jsxs(Z,{sx:{display:"flex",gap:1,mb:2},children:[h?.components.database&&i.jsx(st,{label:"Database",size:"small",color:"primary"}),h?.components.uploads&&i.jsx(st,{label:"Uploads",size:"small",color:"secondary"}),h?.components.config&&i.jsx(st,{label:"Config",size:"small",color:"default"})]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Make sure you have a backup of your current data before proceeding."})]}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:()=>p(null),children:"Cancel"}),i.jsx(xe,{onClick:()=>h&&A(h),color:"warning",variant:"contained",disabled:c===h?.manifest,startIcon:c===h?.manifest?i.jsx(tr,{size:20}):i.jsx(o5,{}),children:c===h?.manifest?"Restoring...":"Restore"})]})]}),i.jsx(Wfe,{open:v,onClose:()=>m(!1),onSettingsSaved:y})]})},Vfe=()=>{const{user:e}=ta(),[t,r]=x.useState([]),[n,a]=x.useState([]),[o,s]=x.useState([]),[l,c]=x.useState(""),[u,d]=x.useState(!0),[f,h]=x.useState(!1),[p,v]=x.useState(null),[m,y]=x.useState(!1),[b,_]=x.useState({name:"",email:"",phone_number:""}),[w,A]=x.useState(null),[P,T]=x.useState(!1),[E,S]=x.useState(null),I=x.useRef(null),W=(k,$)=>k?.response?.data?.message||k?.response?.data?.error||k?.message||$,O=k=>{I.current&&window.clearTimeout(I.current),S(k),I.current=window.setTimeout(()=>{S(null),I.current=null},2500)};x.useEffect(()=>()=>{I.current&&window.clearTimeout(I.current)},[]),x.useEffect(()=>{D()},[]),x.useEffect(()=>{l?R():a([])},[l]),x.useEffect(()=>{const k=setInterval(()=>{a($=>$.map(X=>{if(!X.clock_out){const C=new Date,M=new Date(X.clock_in),H=(C.getTime()-M.getTime())/(1e3*60*60);return{...X,duration:H}}return X})),s($=>$.map(X=>{if(!X.clock_out){const C=new Date,M=new Date(X.clock_in),H=(C.getTime()-M.getTime())/(1e3*60*60);return{...X,duration:H}}return X}))},1e3);return()=>clearInterval(k)},[]);const D=async()=>{try{d(!0);const k=await SS();r(k),F(k),v(null)}catch(k){v("Failed to fetch data. Please try again."),console.error("Error fetching data:",k)}finally{d(!1)}},R=async()=>{if(l)try{const k=await wfe(l);a(k);const $=new Date;$.setDate($.getDate()-1);const X=k.find(C=>!C.clock_out&&new Date(C.clock_in).toDateString()!==new Date().toDateString());T(!!X)}catch(k){v("Failed to fetch shifts. Please try again."),console.error("Error fetching shifts:",k)}},F=async k=>{const $=k||t;if(!$.length){s([]);return}try{h(!0);const X=[];await Promise.all($.map(async C=>{try{const M=await Ofe(C.id);M&&X.push({...M,profile_name:C.name})}catch(M){console.error(`Failed to fetch active shift for profile ${C.id}`,M)}})),s(X)}catch(X){console.error("Error fetching active shifts:",X)}finally{h(!1)}},z=async()=>{if(!l){v("Please select a profile");return}if(n.some(k=>!k.clock_out)){v("You are already clocked in. Please clock out first.");return}try{S(null);const k=await jfe(l);a([k,...n]),v(null),c(""),a([]),O("Successfully clocked in."),F()}catch(k){S(null),v(W(k,"Failed to clock in. Please try again.")),console.error("Error clocking in:",k)}},K=async k=>{try{S(null);const $=await Sfe(k);a(n.map(X=>X.id===k?$:X)),v(null),c(""),a([]),O("Successfully clocked out."),F()}catch($){S(null),v(W($,"Failed to clock out. Please try again.")),console.error("Error clocking out:",$)}},J=async()=>{if(!b.name||!b.email){v("Name and email are required");return}try{let k;w?(k=await nfe(w,b.name,b.email,b.phone_number||void 0),r($=>$.map(X=>X.id===w?k:X)),ge.success("Profile updated")):(k=await rfe(b.name,b.email,b.phone_number||void 0),r([...t,k]),ge.success("Profile created")),y(!1),_({name:"",email:"",phone_number:""}),A(null),v(null)}catch(k){v("Failed to save profile. Please try again."),console.error("Error saving profile:",k)}},L=l&&n.some(k=>k.profile_id===l&&!k.clock_out);return u?i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:i.jsx(tr,{})}):i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Attendance (Shift Tracking)"}),p&&i.jsx(Ot,{severity:"error",variant:"filled",sx:{mb:2,fontSize:"1.1rem",fontWeight:700,py:2},children:p}),P&&i.jsx(Ot,{severity:"warning",sx:{mb:2},children:"You have an unclosed shift from a previous day. Please clock out before starting a new shift."}),i.jsxs(pr,{open:!!E,onClose:()=>S(null),PaperProps:{sx:{px:6,py:4,textAlign:"center"}},children:[i.jsx(mr,{sx:{fontSize:"2rem"},children:"Success"}),i.jsx(gr,{children:i.jsx(B,{variant:"h4",component:"p",children:E})})]}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(bt,{sx:{p:2},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[i.jsx(B,{variant:"h6",children:"Profile"}),e?.access_role!=="Time Tracking"&&i.jsx(xe,{startIcon:i.jsx(Ev,{}),onClick:()=>{A(null),_({name:"",email:"",phone_number:""}),y(!0)},children:"Add Profile"})]}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Select Profile"}),i.jsx(cn,{value:l,label:"Select Profile",onChange:k=>c(k.target.value),sx:{"& .MuiSelect-select":{fontSize:"1.25rem",py:1.5,minHeight:56}},MenuProps:{PaperProps:{sx:{"& .MuiMenuItem-root":{fontSize:"1.25rem",py:1.5,minHeight:56},"& .MuiMenuItem-root.Mui-selected, & .MuiMenuItem-root.Mui-selected:hover":{backgroundColor:"rgba(25, 118, 210, 0.2)",color:"primary.main",fontWeight:700},"& .MuiMenuItem-root:hover":{backgroundColor:"rgba(25, 118, 210, 0.15)"}}}},renderValue:k=>{const $=t.find(X=>X.id===k);return $?$.name:""},children:t.map(k=>i.jsxs(Zt,{value:k.id,sx:{fontSize:"1.1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("span",{children:k.name}),e?.access_role==="Admin"&&i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(xr,{"aria-label":`Edit ${k.name}`,size:"small",edge:"end",onClick:$=>{$.preventDefault(),$.stopPropagation(),A(k.id),_({name:k.name||"",email:k.email||"",phone_number:k.phone_number||""}),y(!0)},sx:{color:"primary.main"},children:i.jsx(Ep,{fontSize:"small"})}),i.jsx(xr,{"aria-label":`Delete ${k.name}`,size:"small",edge:"end",onClick:async $=>{if($.preventDefault(),$.stopPropagation(),!!window.confirm(`Delete profile "${k.name}"? This cannot be undone.`))try{await ve.delete(`/api/time-tracking/profiles/${k.id}`),r(C=>C.filter(M=>M.id!==k.id)),l===k.id&&c(""),ge.success("Profile deleted")}catch(C){const M=C?.response?.data?.error||"Failed to delete profile";ge.error(M)}},sx:{color:"error.main"},children:i.jsx(Id,{fontSize:"small"})})]})]},k.id))})]})]})}),l&&!L&&i.jsx(ie,{item:!0,xs:12,children:i.jsx(bt,{sx:{p:2},children:i.jsx(Z,{display:"flex",justifyContent:"center",gap:2,children:i.jsx(xe,{variant:"contained",sx:{backgroundColor:"green",px:4,py:2,fontSize:"1.2rem",fontWeight:700,borderRadius:"12px",minWidth:220,"&:hover":{backgroundColor:"darkgreen"}},onClick:z,children:"Clock In"})})})}),l&&i.jsx(ie,{item:!0,xs:12,children:i.jsxs(bt,{sx:{p:2},children:[i.jsx(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:i.jsxs(B,{variant:"h6",gutterBottom:!0,children:["Shift History for ",t.find(k=>k.id===l)?.name]})}),i.jsx(pa,{children:i.jsxs(Jn,{children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Clock In"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Clock Out"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Duration"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Actions"})]})}),i.jsx(ea,{children:n.map(k=>{const $=new Date(k.clock_in),X=k.clock_out?new Date(k.clock_out):null,C=k.duration!==null&&k.duration!==void 0?Number(k.duration):null;return i.jsxs(hr,{children:[i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:$.toLocaleString()}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:X?X.toLocaleString():"-"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:C!==null?`${C.toFixed(2)} hrs`:"-"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:!k.clock_out&&i.jsx(xe,{variant:"contained",sx:{backgroundColor:"red",px:3,py:1.5,fontSize:"1.1rem",fontWeight:700,borderRadius:"12px","&:hover":{backgroundColor:"darkred"}},onClick:()=>K(k.id),children:"Clock Out"})})]},k.id)})})]})})]})}),i.jsx(ie,{item:!0,xs:12,children:i.jsxs(bt,{sx:{p:2},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[i.jsx(B,{variant:"h6",children:"Active Clock Ins"}),f&&i.jsx(tr,{size:24})]}),o.length===0&&!f?i.jsx(B,{color:"text.secondary",children:"No active clock ins."}):i.jsx(pa,{children:i.jsxs(Jn,{children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Profile"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Clock In"}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:"Duration"})]})}),i.jsx(ea,{children:o.map(k=>{const $=k.duration!==null&&k.duration!==void 0?Number(k.duration):null;return i.jsxs(hr,{children:[i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:k.profile_name}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:new Date(k.clock_in).toLocaleString()}),i.jsx(Ae,{sx:{fontSize:"1.1rem"},children:$!==null?`${$.toFixed(2)} hrs`:"-"})]},k.id)})})]})})]})})]}),i.jsxs(pr,{open:m,onClose:()=>y(!1),children:[i.jsx(mr,{children:w?"Edit Profile":"Add Profile"}),i.jsxs(gr,{children:[i.jsx(Pe,{label:"Name",value:b.name,onChange:k=>_({...b,name:k.target.value}),fullWidth:!0,sx:{mb:2}}),i.jsx(Pe,{label:"Email",value:b.email,onChange:k=>_({...b,email:k.target.value}),fullWidth:!0,sx:{mb:2}}),i.jsx(Pe,{label:"Phone Number",value:b.phone_number,onChange:k=>_({...b,phone_number:k.target.value}),fullWidth:!0})]}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:()=>y(!1),children:"Cancel"}),i.jsx(xe,{onClick:J,variant:"contained",children:"Save"})]})]})]})};var fh={},XE;function Gfe(){if(XE)return fh;XE=1;var e=sr();Object.defineProperty(fh,"__esModule",{value:!0}),fh.default=void 0;var t=e(cr()),r=lr();return fh.default=(0,t.default)((0,r.jsx)("path",{d:"M4 10h3v7H4zm6.5 0h3v7h-3zM2 19h20v3H2zm15-9h3v7h-3zm-5-9L2 6v2h20V6z"}),"AccountBalance"),fh}var Yfe=Gfe();const Gw=Et(Yfe),Kfe=()=>{const e=Tn(),[t,r]=x.useState(!0),[n,a]=x.useState(!1),[o,s]=x.useState([]),[l,c]=x.useState({}),[u,d]=x.useState(null),[f,h]=x.useState(null),[p,v]=x.useState(""),[m,y]=x.useState(""),[b,_]=x.useState(""),[w,A]=x.useState(""),[P,T]=x.useState(""),[E,S]=x.useState(""),[I,W]=x.useState(""),[O,D]=x.useState(""),[R,F]=x.useState(""),[z,K]=x.useState(""),[J,L]=x.useState(""),[k,$]=x.useState(""),[X,C]=x.useState(!1),[M,H]=x.useState(""),[U,te]=x.useState("");x.useEffect(()=>{oe()},[]);const le=()=>{const ee=`${Wu().baseURL}/api/qbo/auth`;window.location.href=ee},oe=async()=>{r(!0);try{const G=await ve.get("/api/qbo-accounts/test-connection");if(h(G.data),G.data.connected){const ee=await ve.get("/api/qbo-accounts/accounts");s(ee.data.accounts),c(ee.data.accountTypes);const se=await ve.get("/api/qbo-accounts/mapping");se.data.mapping&&(d(se.data.mapping),v(se.data.mapping.qbo_inventory_account_id),y(se.data.mapping.qbo_gst_account_id),_(se.data.mapping.qbo_ap_account_id),A(se.data.mapping.qbo_supply_expense_account_id||""),T(se.data.mapping.qbo_sales_account_id||""),S(se.data.mapping.qbo_labour_sales_account_id||""),W(se.data.mapping.qbo_ar_account_id||""),D(se.data.mapping.qbo_cogs_account_id||""),F(se.data.mapping.qbo_cost_of_labour_account_id||""),K(se.data.mapping.qbo_cost_of_materials_account_id||""),L(se.data.mapping.qbo_labour_expense_reduction_account_id||""),$(se.data.mapping.qbo_overhead_cogs_account_id||""))}}catch(G){console.error("Error loading QBO data:",G),ge.error("Failed to load QuickBooks data")}finally{r(!1)}},ae=async()=>{if(!p||!m||!b){ge.error("Please select all required accounts");return}a(!0);try{const G=await ve.post("/api/qbo-accounts/mapping",{qbo_inventory_account_id:p,qbo_gst_account_id:m,qbo_ap_account_id:b,qbo_supply_expense_account_id:w,qbo_sales_account_id:P,qbo_labour_sales_account_id:E,qbo_ar_account_id:I,qbo_cogs_account_id:O,qbo_cost_of_labour_account_id:R,qbo_cost_of_materials_account_id:z,qbo_labour_expense_reduction_account_id:J,qbo_overhead_cogs_account_id:k});d(G.data.mapping),ge.success("Account mapping saved successfully")}catch(G){console.error("Error saving mapping:",G),ge.error("Failed to save account mapping")}finally{a(!1)}},he=G=>{const ee=G.AccountNumber?`#${G.AccountNumber}`:"";return`${G.Name} ${ee} (${G.AccountType})`},me=G=>{let ee=o.filter(se=>se.Classification===G);if(U){const se=U.toLowerCase();ee=ee.filter(V=>V.Name.toLowerCase().includes(se)||V.AccountNumber&&V.AccountNumber.includes(se)||V.Description&&V.Description.toLowerCase().includes(se))}return ee},Q=()=>i.jsxs(pr,{open:X,onClose:()=>C(!1),maxWidth:"md",fullWidth:!0,children:[i.jsxs(mr,{children:["QuickBooks Accounts - ",M]}),i.jsx(gr,{children:i.jsx(Z,{sx:{mt:2},children:l[M]?.map(G=>i.jsx(qr,{sx:{mb:1,p:2},children:i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"h6",children:G.Name}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Type: ",G.AccountType," | Subtype: ",G.AccountSubType]}),G.AccountNumber&&i.jsxs(B,{variant:"body2",color:"primary",fontWeight:500,children:["Account #: ",G.AccountNumber]}),G.Description&&i.jsx(B,{variant:"body2",color:"text.secondary",children:G.Description})]}),i.jsx(st,{label:G.AccountNumber||"No Number",size:"small",color:G.AccountNumber?"primary":"default",variant:"outlined"})]})},G.Id))})}),i.jsx(jr,{children:i.jsx(xe,{onClick:()=>C(!1),children:"Close"})})]});return t?i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:i.jsx(tr,{})}):i.jsxs(rr,{maxWidth:"lg",sx:{py:4},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsxs(Z,{display:"flex",alignItems:"center",children:[i.jsx(xe,{startIcon:i.jsx(Hp,{}),onClick:()=>e("/business-profile"),sx:{mr:2},children:"Back"}),i.jsx(B,{variant:"h4",component:"h1",children:"QuickBooks Account Mapping"})]}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Gw,{}),onClick:le,sx:{borderRadius:2,fontWeight:600},children:"Connect to QuickBooks"})]}),f&&i.jsx(qr,{sx:{mb:3},children:i.jsxs(Wr,{children:[i.jsxs(Z,{display:"flex",alignItems:"center",gap:2,children:[f.connected?i.jsx(ac,{color:"success"}):i.jsx(qy,{color:"error"}),i.jsx(B,{variant:"h6",children:f.connected?"Connected to QuickBooks":"Not Connected"})]}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mt:1},children:f.message}),f.connected&&f.realmId&&i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Realm ID: ",f.realmId]})]})}),f?.connected?i.jsxs(i.Fragment,{children:[i.jsx(ie,{container:!0,spacing:3,sx:{mb:3},children:Object.entries(l).map(([G,ee])=>i.jsx(ie,{item:!0,xs:12,sm:6,md:4,children:i.jsx(qr,{children:i.jsxs(Wr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:G}),i.jsx(B,{variant:"h4",color:"primary",children:ee.length}),i.jsx(xe,{size:"small",onClick:()=>{H(G),C(!0)},sx:{mt:1},children:"View Accounts"})]})})},G))}),i.jsxs(bt,{sx:{p:3},children:[i.jsx(B,{variant:"h5",gutterBottom:!0,children:"Map QuickBooks Accounts"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Select the QuickBooks accounts that correspond to your business accounts. Different companies use different account names, so choose the accounts that make sense for your business."}),i.jsxs(Ot,{severity:"info",sx:{mb:3},children:[i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"How this works:"})," Configure your QuickBooks accounts to map to your business transactions. Accounts used by both purchase orders and sales orders are shown at the top."]}),i.jsxs(B,{variant:"body2",sx:{mt:1},children:[i.jsx("strong",{children:"Purchase Orders:"})," Stock items  Inventory Account, Supply items  Supply Expense Account, GST  GST Account, Total  Accounts Payable."]}),i.jsxs(B,{variant:"body2",sx:{mt:1},children:[i.jsx("strong",{children:"Sales Orders:"})," Materials  Sales Account, Labour  Labour Sales Account, GST  GST Account, Total  Accounts Receivable, Costs  COGS Account."]})]}),i.jsx(Z,{sx:{mb:3},children:i.jsx(Pe,{fullWidth:!0,label:"Search accounts by name, number, or description",value:U,onChange:G=>te(G.target.value),placeholder:"e.g., 1200, Inventory, GST...",size:"small",InputProps:{startAdornment:i.jsx(fi,{sx:{mr:1,color:"text.secondary"}})}})}),i.jsx(B,{variant:"h6",sx:{mt:4,mb:2,color:"primary.main"},children:"Shared Accounts (Purchase Orders & Sales Orders)"}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"GST/Tax Account"}),i.jsx(cn,{value:m,onChange:G=>y(G.target.value),label:"GST/Tax Account",children:me("Liability").map(G=>i.jsx(Zt,{value:G.Id,children:he(G)},G.Id))})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Account for GST/HST/tax tracking (used by both purchase orders and sales orders)"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Inventory Account"}),i.jsx(cn,{value:p,onChange:G=>v(G.target.value),label:"Inventory Account",children:me("Asset").map(G=>i.jsx(Zt,{value:G.Id,children:he(G)},G.Id))})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Account for tracking inventory (stock purchases and sales cost reduction)"})]})]}),i.jsx(B,{variant:"h6",sx:{mt:4,mb:2},children:"Purchase Order Account Mapping"}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Supply Expense Account"}),i.jsxs(cn,{value:w,onChange:G=>A(G.target.value),label:"Supply Expense Account",children:[i.jsx(Zt,{value:"",children:i.jsx("em",{children:"Optional - Select an expense account"})}),me("Expense").map(G=>i.jsx(Zt,{value:G.Id,children:he(G)},G.Id))]})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Account for supply items (e.g., Office Supplies, Tools, etc.) - Optional"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Accounts Payable"}),i.jsx(cn,{value:b,onChange:G=>_(G.target.value),label:"Accounts Payable",children:me("Liability").map(G=>i.jsx(Zt,{value:G.Id,children:he(G)},G.Id))})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:'Account for tracking vendor payables (usually "Accounts Payable")'})]})]}),i.jsx(B,{variant:"h6",sx:{mt:4,mb:2},children:"Sales Order Account Mapping"}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Sales Account"}),i.jsx(cn,{value:P,onChange:G=>T(G.target.value),label:"Sales Account",children:me("Revenue").map(G=>i.jsx(Zt,{value:G.Id,children:he(G)},G.Id))})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Revenue account for sales (e.g., Sales, Revenue, etc.) - Used for invoice creation"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Accounts Receivable"}),i.jsx(cn,{value:I,onChange:G=>W(G.target.value),label:"Accounts Receivable",children:me("Asset").map(G=>i.jsx(Zt,{value:G.Id,children:he(G)},G.Id))})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:'Account for tracking customer receivables (usually "Accounts Receivable") - Used for invoice total amount'})]})]}),i.jsx(B,{variant:"h6",sx:{mt:4,mb:2},children:"Cost Accounts (Journal Entries)"}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Cost of Materials"}),i.jsxs(cn,{value:z,onChange:G=>K(G.target.value),label:"Cost of Materials",children:[i.jsx(Zt,{value:"",children:i.jsx("em",{children:"Optional - Select an expense account"})}),me("Expense").map(G=>i.jsx(Zt,{value:G.Id,children:he(G)},G.Id))]})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Expense account for tracking cost of materials sold - Used for COGS journal entries - Optional"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Cost of Labour"}),i.jsxs(cn,{value:R,onChange:G=>F(G.target.value),label:"Cost of Labour",children:[i.jsx(Zt,{value:"",children:i.jsx("em",{children:"Optional - Select an expense account"})}),me("Expense").map(G=>i.jsx(Zt,{value:G.Id,children:he(G)},G.Id))]})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Expense account for tracking cost of labour sold - Used for COGS journal entries - Optional"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Labour Expense Reduction Account"}),i.jsxs(cn,{value:J,onChange:G=>L(G.target.value),label:"Labour Expense Reduction Account",children:[i.jsx(Zt,{value:"",children:i.jsx("em",{children:"Optional - Select an expense account"})}),me("Expense").map(G=>i.jsx(Zt,{value:G.Id,children:he(G)},G.Id))]})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Expense account for reducing labour costs when sold (e.g., Labour Expense, Wages Expense) - Used for COGS journal entries - Optional"})]}),i.jsxs(ie,{item:!0,xs:12,md:6,children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Overhead COGS Account"}),i.jsxs(cn,{value:k,onChange:G=>$(G.target.value),label:"Overhead COGS Account",children:[i.jsx(Zt,{value:"",children:i.jsx("em",{children:"Optional - Select an expense account"})}),me("Expense").map(G=>i.jsx(Zt,{value:G.Id,children:he(G)},G.Id))]})]}),i.jsx(B,{variant:"caption",color:"text.secondary",children:"Expense account for tracking overhead costs when sold - Used for COGS journal entries - Optional"})]})]}),i.jsx(Z,{sx:{mt:3,display:"flex",justifyContent:"center"},children:i.jsx(xe,{variant:"outlined",onClick:()=>e("/overhead-management"),sx:{width:"100%",maxWidth:"600px",borderRadius:2,fontWeight:600,py:1.5,fontSize:"1.1rem"},children:"Manage Overhead Settings"})}),i.jsxs(Z,{sx:{mt:3,display:"flex",gap:2},children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:ae,disabled:n||!p||!m||!b,children:n?"Saving...":"Save Mapping"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Es,{}),onClick:oe,disabled:t,children:"Refresh"})]}),u&&i.jsxs(Z,{sx:{mt:3,p:2,bgcolor:"grey.50",borderRadius:1},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Current Mapping"}),i.jsx(B,{variant:"subtitle2",color:"primary",sx:{mt:2,mb:1},children:"Shared Accounts (Purchase Orders & Sales Orders)"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["GST/Tax: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_gst_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Inventory: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_inventory_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})})]}),i.jsx(B,{variant:"subtitle2",color:"primary",sx:{mt:2,mb:1},children:"Purchase Order Accounts"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Supply Expense: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_supply_expense_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Accounts Payable: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_ap_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})})]}),i.jsx(B,{variant:"subtitle2",color:"primary",sx:{mt:2,mb:1},children:"Sales Order Accounts"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Sales: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_sales_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Accounts Receivable: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_ar_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})})]}),i.jsx(B,{variant:"subtitle2",color:"primary",sx:{mt:2,mb:1},children:"Cost Accounts"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Cost of Materials: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_cost_of_materials_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Cost of Labour: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_cost_of_labour_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Labour Expense Reduction: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_labour_expense_reduction_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Overhead COGS: ",(()=>{const G=o.find(ee=>ee.Id===u.qbo_overhead_cogs_account_id);return G?`${G.Name}${G.AccountNumber?` (#${G.AccountNumber})`:""}`:"Not configured"})()]})})]})]})]})]}):i.jsx(Ot,{severity:"warning",sx:{mb:3},children:"Please connect your QuickBooks account first in the Business Profile page."}),Q()]})},Qfe=()=>{const e=Tn(),[t,r]=x.useState(!0),[n,a]=x.useState(!1),[o,s]=x.useState([]),[l,c]=x.useState({}),[u,d]=x.useState([]),[f,h]=x.useState(null),[p,v]=x.useState(!1),[m,y]=x.useState(""),[b,_]=x.useState(""),[w,A]=x.useState(!1),[P,T]=x.useState(null),[E,S]=x.useState({expense_account_id:"",percentage:"",description:""});x.useEffect(()=>{I()},[]);const I=async()=>{r(!0);try{const[L,k]=await Promise.all([ve.get("/api/qbo-accounts/accounts"),ve.get("/api/overhead/distribution")]);s(L.data.accounts||[]),c(L.data.accountTypes||{}),d(k.data||[]),h({connected:!0,message:"Connected to QuickBooks"})}catch(L){console.error("Error loading data:",L),h({connected:!1,message:L.response?.data?.error||"Failed to connect to QuickBooks"}),ge.error("Failed to load overhead management data")}finally{r(!1)}},W=async()=>{if(!E.expense_account_id||!E.percentage){ge.error("Please fill in all required fields");return}const L=parseFloat(E.percentage);if(isNaN(L)||L<=0||L>100){ge.error("Percentage must be between 0 and 100");return}const k=u.filter($=>$.id!==P?.id).reduce(($,X)=>$+X.percentage,0);if(k+L>100){ge.error(`Total percentage would exceed 100%. Current total: ${k}%, adding: ${L}%`);return}a(!0);try{P?(await ve.put(`/api/overhead/distribution/${P.id}`,{expense_account_id:E.expense_account_id,percentage:L,description:E.description}),ge.success("Distribution updated successfully")):(await ve.post("/api/overhead/distribution",{expense_account_id:E.expense_account_id,percentage:L,description:E.description}),ge.success("Distribution added successfully")),A(!1),T(null),S({expense_account_id:"",percentage:"",description:""}),I()}catch($){console.error("Error saving distribution:",$),ge.error($.response?.data?.error||"Failed to save distribution")}finally{a(!1)}},O=L=>{T(L),S({expense_account_id:L.expense_account_id,percentage:L.percentage.toString(),description:L.description}),A(!0)},D=async L=>{if(window.confirm("Are you sure you want to delete this distribution?"))try{await ve.delete(`/api/overhead/distribution/${L}`),ge.success("Distribution deleted successfully"),I()}catch(k){console.error("Error deleting distribution:",k),ge.error(k.response?.data?.error||"Failed to delete distribution")}},R=()=>{T(null),S({expense_account_id:"",percentage:"",description:""}),A(!0)},F=L=>`${L.Name} (${L.AccountType})`,z=L=>(l[L]||[]).filter(k=>k.Classification===L).map(k=>({label:F(k),value:k.Id,account:k})),K=()=>i.jsxs(pr,{open:p,onClose:()=>v(!1),maxWidth:"md",fullWidth:!0,children:[i.jsx(mr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(Gw,{}),"QuickBooks Accounts"]})}),i.jsxs(gr,{children:[i.jsx(Z,{mb:2,children:i.jsx(Pe,{fullWidth:!0,label:"Search accounts",value:b,onChange:L=>_(L.target.value),InputProps:{startAdornment:i.jsx(fi,{})}})}),i.jsxs(tn,{fullWidth:!0,sx:{mb:2},children:[i.jsx(ln,{children:"Account Type"}),i.jsxs(cn,{value:m,onChange:L=>y(L.target.value),label:"Account Type",children:[i.jsx(Zt,{value:"",children:"All Types"}),i.jsx(Zt,{value:"Asset",children:"Asset"}),i.jsx(Zt,{value:"Liability",children:"Liability"}),i.jsx(Zt,{value:"Equity",children:"Equity"}),i.jsx(Zt,{value:"Revenue",children:"Revenue"}),i.jsx(Zt,{value:"Expense",children:"Expense"})]})]}),i.jsx(Z,{maxHeight:400,overflow:"auto",children:Object.entries(l).map(([L,k])=>{if(m&&L!==m)return null;const $=k.filter(X=>X.Name.toLowerCase().includes(b.toLowerCase())||X.AccountType.toLowerCase().includes(b.toLowerCase()));return $.length===0?null:i.jsxs(Z,{mb:3,children:[i.jsxs(B,{variant:"h6",gutterBottom:!0,children:[L," Accounts (",$.length,")"]}),i.jsx(ie,{container:!0,spacing:1,children:$.map(X=>i.jsx(ie,{item:!0,xs:12,sm:6,md:4,children:i.jsxs(qr,{variant:"outlined",sx:{p:1},children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:X.Name}),i.jsx(B,{variant:"caption",color:"textSecondary",children:X.AccountType}),X.AccountNumber&&i.jsxs(B,{variant:"caption",display:"block",color:"textSecondary",children:["#",X.AccountNumber]})]})},X.Id))})]},L)})})]}),i.jsx(jr,{children:i.jsx(xe,{onClick:()=>v(!1),children:"Close"})})]}),J=u.reduce((L,k)=>L+k.percentage,0);return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(xr,{onClick:()=>e(-1),children:i.jsx(Hp,{})}),i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Overhead Management"})]}),i.jsxs(dt,{direction:"row",spacing:2,children:[i.jsx(xe,{variant:"outlined",onClick:()=>v(!0),startIcon:i.jsx(Gw,{}),children:"View QBO Accounts"}),i.jsx(xe,{variant:"contained",onClick:R,startIcon:i.jsx(Va,{}),children:"Add Distribution"}),i.jsx(xe,{variant:"outlined",onClick:I,startIcon:i.jsx(Es,{}),children:"Refresh"})]})]}),f&&i.jsx(Ot,{severity:f.connected?"success":"error",icon:f.connected?i.jsx(ac,{}):i.jsx(qy,{}),sx:{mb:3},children:f.message}),i.jsxs(bt,{sx:{p:3,mb:3},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Distribution Summary"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(qr,{children:i.jsxs(Wr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Total Distributions"}),i.jsx(B,{variant:"h4",children:u.length})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(qr,{children:i.jsxs(Wr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Total Percentage"}),i.jsxs(B,{variant:"h4",color:J===100?"success.main":"warning.main",children:[J.toFixed(1),"%"]})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(qr,{children:i.jsxs(Wr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Remaining"}),i.jsxs(B,{variant:"h4",color:J>100?"error.main":"text.primary",children:[(100-J).toFixed(1),"%"]})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(qr,{children:i.jsxs(Wr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Status"}),i.jsx(st,{label:J===100?"Complete":J>100?"Over 100%":"Incomplete",color:J===100?"success":J>100?"error":"warning"})]})})})]})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden"},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Expense Distributions"}),t?i.jsx(Z,{display:"flex",justifyContent:"center",p:3,children:i.jsx(tr,{})}):u.length===0?i.jsx(Ot,{severity:"info",children:'No expense distributions configured. Click "Add Distribution" to get started.'}):i.jsx(ie,{container:!0,spacing:2,children:u.map(L=>{const k=o.find($=>$.Id===L.expense_account_id);return i.jsx(ie,{item:!0,xs:12,sm:6,md:4,children:i.jsx(qr,{children:i.jsx(Wr,{children:i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[i.jsxs(Z,{flex:1,children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:L.description||k?.Name||"Unknown Account"}),i.jsxs(B,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:[k?.Name," (",k?.AccountType,")"]}),i.jsx(st,{label:`${L.percentage}%`,color:"primary",size:"small"})]}),i.jsxs(Z,{children:[i.jsx(xr,{size:"small",onClick:()=>O(L),children:i.jsx(tu,{})}),i.jsx(xr,{size:"small",color:"error",onClick:()=>D(L.id),children:i.jsx(ma,{})})]})]})})})},L.id)})})]})}),i.jsxs(pr,{open:w,onClose:()=>A(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(mr,{children:P?"Edit Distribution":"Add Distribution"}),i.jsx(gr,{children:i.jsxs(dt,{spacing:3,sx:{mt:1},children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Expense Account"}),i.jsx(cn,{value:E.expense_account_id,onChange:L=>S(k=>({...k,expense_account_id:L.target.value})),label:"Expense Account",children:z("Expense").map(L=>i.jsx(Zt,{value:L.value,children:L.label},L.value))})]}),i.jsx(Pe,{label:"Percentage",type:"number",value:E.percentage,onChange:L=>S(k=>({...k,percentage:L.target.value})),inputProps:{min:0,max:100,step:.01},helperText:`Current total: ${J}%${P?` (excluding this item: ${(J-P.percentage).toFixed(1)}%)`:""}`}),i.jsx(Pe,{label:"Description (Optional)",value:E.description,onChange:L=>S(k=>({...k,description:L.target.value})),helperText:"A description to help identify this distribution"})]})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:()=>A(!1),children:"Cancel"}),i.jsx(xe,{onClick:W,variant:"contained",disabled:n||!E.expense_account_id||!E.percentage,startIcon:n?i.jsx(tr,{size:20}):i.jsx(Is,{}),children:n?"Saving...":"Save"})]})]}),K()]})},Xfe=()=>{const[e,t]=x.useState(!1),[r,n]=x.useState(!1),[a,o]=x.useState([]),[s,l]=x.useState(new Set),[c,u]=x.useState(new Set),[d,f]=x.useState(!1),[h,p]=x.useState([]),[v,m]=x.useState([]),y=Tn();x.useEffect(()=>{b();const O=()=>{console.log(" Parts to order update event received, refreshing data..."),b()};return window.addEventListener("parts-to-order-updated",O),()=>{window.removeEventListener("parts-to-order-updated",O)}},[]);const b=async()=>{t(!0);try{const[O,D]=await Promise.all([ve.get("/api/sales-orders/parts-to-order/all"),ve.get("/api/inventory")]),{individualParts:R,aggregatedParts:F}=O.data,z=D.data||[];m(z);const K=J=>{const L=$=>($||"").replace(/[\-\s"]/g,"").toUpperCase(),k=new Map(z.map($=>[L(String($.part_number)),$]));return J.map($=>{const X=k.get(L($.part_number));if(!X)return $;const C=X.unit||$.unit,M=X.part_description||$.part_description,H=Number(X.last_unit_cost)||Number($.unit_price)||0,U=H*(Number($.total_quantity_needed)||0);return{...$,unit:C,part_description:M,unit_price:H,total_line_amount:U,sales_orders:($.sales_orders||[]).map(te=>{const le=Number(X.last_unit_cost)||Number(te.unit_price)||0,oe=le*(Number(te.quantity_needed)||0);return{...te,unit:X.unit||te.unit,unit_price:le,line_amount:oe}})}})};if(F&&F.length>0)o(K(F));else{const J=_(R);o(K(J))}}catch(O){console.error("Error fetching parts to order:",O),ge.error("Failed to load parts to order data")}finally{t(!1)}},_=O=>{const D={};return O.forEach(R=>{D[R.part_number]||(D[R.part_number]={part_number:R.part_number,part_description:R.part_description,total_quantity_needed:0,unit:R.unit,unit_price:R.unit_price,total_line_amount:0,sales_orders:[]}),D[R.part_number].total_quantity_needed+=R.quantity_needed,D[R.part_number].total_line_amount+=R.line_amount,D[R.part_number].sales_orders.push(R)}),Object.values(D)},w=O=>{const D=new Set(s);D.has(O)?D.delete(O):D.add(O),l(D)},A=()=>{b()},P=O=>{u(D=>{const R=new Set(D);return R.has(O)?R.delete(O):R.add(O),R})},T=()=>{c.size===a.length?u(new Set):u(new Set(a.map(O=>O.part_number)))},E=()=>{if(c.size===0){ge.warning("Please select at least one part to create a purchase order");return}const O=a.filter(D=>c.has(D.part_number));p(O),f(!0)},S=()=>{f(!1),p([])},I=async()=>{if(h.length===0){ge.warning("No parts selected for purchase order");return}n(!0);try{const O=await ve.post("/api/purchase-orders/auto-create-from-parts-to-order",{parts:h});if(O.data.success)if(ge.success(`Purchase order created successfully! PO Number: ${O.data.purchase_order_number}`),O.data.purchase_orders&&O.data.purchase_orders.length===1){const D=O.data.purchase_orders[0].purchase_id;S(),u(new Set),y(`/open-purchase-orders/${D}`)}else S(),u(new Set),b();else ge.error(O.data.message||"Failed to create purchase order")}catch(O){console.error("Error creating purchase order:",O),ge.error(O.response?.data?.error||"Failed to create purchase order")}finally{n(!1)}},W=async O=>{let D=a;if(O){const R=a.find(F=>F.part_number===O);if(!R){ge.warning(`Part ${O} not found for purchase order creation.`);return}D=[R]}if(D.length===0){ge.warning("No parts to order");return}n(!0);try{const R=await ve.post("/api/purchase-orders/auto-create-from-parts-to-order",{parts:D});if(R.data.success)if(ge.success(`Purchase order created successfully! PO Number: ${R.data.purchase_order_number}`),R.data.purchase_orders&&R.data.purchase_orders.length===1){const F=R.data.purchase_orders[0].purchase_id;y(`/open-purchase-orders/${F}`)}else b();else ge.error(R.data.message||"Failed to create purchase order")}catch(R){console.error("Error creating purchase order:",R),ge.error(R.response?.data?.error||"Failed to create purchase order")}finally{n(!1)}};return e?i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:i.jsx(tr,{})}):i.jsxs(Z,{p:3,children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[i.jsx(B,{variant:"h3",component:"h1",children:"Parts to Order"}),i.jsxs(Z,{display:"flex",gap:2,children:[c.size>0&&i.jsxs(xe,{variant:"contained",color:"primary",startIcon:i.jsx(N8,{}),onClick:E,disabled:r,children:["Create PO (",c.size,")"]}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Xw,{}),onClick:A,children:"Refresh"})]})]}),a.length===0?i.jsx(Ot,{severity:"info",children:"No parts currently need to be ordered."}):i.jsx(pa,{component:bt,children:i.jsxs(Jn,{size:"medium",children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{padding:"checkbox",children:i.jsx(Qi,{indeterminate:c.size>0&&c.size<a.length,checked:a.length>0&&c.size===a.length,onChange:T})}),i.jsx(Ae,{children:i.jsx(B,{variant:"h6",fontWeight:"bold"})}),i.jsx(Ae,{children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Part Number"})}),i.jsx(Ae,{children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Description"})}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Quantity to Order"})}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Unit"})}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Unit Price"})}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Total Amount"})}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"h6",fontWeight:"bold",children:"Actions"})})]})}),i.jsx(ea,{children:a.map(O=>i.jsxs(Ce.Fragment,{children:[i.jsxs(hr,{children:[i.jsx(Ae,{padding:"checkbox",children:i.jsx(Qi,{checked:c.has(O.part_number),onChange:()=>P(O.part_number)})}),i.jsx(Ae,{children:i.jsx(xr,{size:"small",onClick:()=>w(O.part_number),children:s.has(O.part_number)?i.jsx(D8,{}):i.jsx(II,{})})}),i.jsx(Ae,{children:i.jsx(B,{variant:"body1",fontWeight:"medium",fontSize:"1.1rem",children:O.part_number})}),i.jsx(Ae,{children:i.jsx(B,{variant:"body1",fontSize:"1.1rem",children:O.part_description})}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"body1",fontWeight:"medium",fontSize:"1.1rem",children:Number(O.total_quantity_needed)||0})}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"body1",fontSize:"1.1rem",children:O.unit})}),i.jsx(Ae,{align:"center",children:i.jsxs(B,{variant:"body1",fontSize:"1.1rem",children:["$",(Number(O.unit_price)||0).toFixed(2)]})}),i.jsx(Ae,{align:"center",children:i.jsxs(B,{variant:"body1",fontSize:"1.1rem",children:["$",(Number(O.total_line_amount)||0).toFixed(2)]})}),i.jsx(Ae,{align:"center",children:i.jsx(xe,{variant:"contained",color:"primary",size:"medium",startIcon:i.jsx(s5,{}),onClick:()=>W(O.part_number),disabled:r,children:"Create PO"})})]}),i.jsx(hr,{children:i.jsx(Ae,{style:{paddingBottom:0,paddingTop:0},colSpan:9,children:i.jsx(OI,{in:s.has(O.part_number),timeout:"auto",unmountOnExit:!0,children:i.jsxs(Z,{sx:{margin:1},children:[i.jsx(B,{variant:"h5",gutterBottom:!0,component:"div",children:"Sales Orders Requiring This Part"}),i.jsxs(Jn,{size:"medium",children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{children:i.jsx(B,{variant:"subtitle1",fontWeight:"bold",children:"Sales Order"})}),i.jsx(Ae,{children:i.jsx(B,{variant:"subtitle1",fontWeight:"bold",children:"Customer"})}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"subtitle1",fontWeight:"bold",children:"Quantity to Order"})}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"subtitle1",fontWeight:"bold",children:"Unit Price"})}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"subtitle1",fontWeight:"bold",children:"Line Amount"})})]})}),i.jsx(ea,{children:O.sales_orders.map(D=>i.jsxs(hr,{children:[i.jsx(Ae,{children:i.jsx(B,{variant:"body1",fontSize:"1rem",children:D.sales_order_number})}),i.jsx(Ae,{children:i.jsx(B,{variant:"body1",fontSize:"1rem",children:D.customer_name})}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"body1",fontSize:"1rem",children:Number(D.quantity_needed)||0})}),i.jsx(Ae,{align:"center",children:i.jsxs(B,{variant:"body1",fontSize:"1rem",children:["$",(Number(D.unit_price)||0).toFixed(2)]})}),i.jsx(Ae,{align:"center",children:i.jsxs(B,{variant:"body1",fontSize:"1rem",children:["$",(Number(D.line_amount)||0).toFixed(2)]})})]},`${D.sales_order_id}-${D.part_number}`))})]})]})})})})]},O.part_number))})]})}),i.jsxs(pr,{open:d,onClose:S,maxWidth:"md",fullWidth:!0,children:[i.jsx(mr,{children:"Create Purchase Order"}),i.jsxs(gr,{children:[i.jsx(B,{variant:"body1",sx:{mb:2},children:"Selected parts for purchase order:"}),i.jsx(pa,{component:bt,variant:"outlined",children:i.jsxs(Jn,{size:"small",children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{children:"Part Number"}),i.jsx(Ae,{children:"Description"}),i.jsx(Ae,{align:"center",children:"Quantity"}),i.jsx(Ae,{align:"center",children:"Unit"}),i.jsx(Ae,{align:"center",children:"Unit Price"}),i.jsx(Ae,{align:"center",children:"Total"})]})}),i.jsx(ea,{children:h.map(O=>i.jsxs(hr,{children:[i.jsx(Ae,{children:i.jsx(B,{variant:"body2",fontWeight:"medium",children:O.part_number})}),i.jsx(Ae,{children:i.jsx(B,{variant:"body2",children:O.part_description})}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"body2",children:Number(O.total_quantity_needed)||0})}),i.jsx(Ae,{align:"center",children:i.jsx(B,{variant:"body2",children:O.unit})}),i.jsx(Ae,{align:"center",children:i.jsxs(B,{variant:"body2",children:["$",(Number(O.unit_price)||0).toFixed(2)]})}),i.jsx(Ae,{align:"center",children:i.jsxs(B,{variant:"body2",fontWeight:"medium",children:["$",(Number(O.total_line_amount)||0).toFixed(2)]})})]},O.part_number))})]})}),i.jsx(Z,{sx:{mt:2,p:2,backgroundColor:"grey.50",borderRadius:1},children:i.jsxs(B,{variant:"h6",align:"right",children:["Total Amount: $",h.reduce((O,D)=>O+(Number(D.total_line_amount)||0),0).toFixed(2)]})})]}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:S,disabled:r,children:"Cancel"}),i.jsx(xe,{onClick:I,variant:"contained",color:"primary",disabled:r,startIcon:r?i.jsx(tr,{size:20}):i.jsx(s5,{}),children:r?"Creating...":"Create Purchase Order"})]})]})]})},Jfe=()=>{const e=Tn(),[t,r]=x.useState(!0),[n,a]=x.useState(!1),[o,s]=x.useState([]),[l,c]=x.useState([]),[u,d]=x.useState([]),[f,h]=x.useState(!1),[p,v]=x.useState(""),[m,y]=x.useState("");x.useEffect(()=>{b()},[]);const b=async()=>{r(!0);try{const[T,E,S]=await Promise.all([ve.get("/api/time-tracking/admin/available-users"),ve.get("/api/time-tracking/profiles"),ve.get("/api/time-tracking/admin/user-profile-access")]);s(T.data||[]),c(E.data||[]),d(S.data||[])}catch(T){console.error("Error loading data:",T),ge.error("Failed to load mobile user access data")}finally{r(!1)}},_=async()=>{if(!p||!m){ge.error("Please select both a user and a profile");return}a(!0);try{await ve.post("/api/time-tracking/admin/user-profile-access",{user_id:p,profile_id:m}),ge.success("Profile access granted successfully"),h(!1),v(""),y(""),b()}catch(T){console.error("Error granting access:",T),ge.error(T.response?.data?.error||"Failed to grant access")}finally{a(!1)}},w=async T=>{if(window.confirm("Are you sure you want to revoke this profile access?"))try{await ve.delete(`/api/time-tracking/admin/user-profile-access/${T}`),ge.success("Profile access revoked successfully"),b()}catch(E){console.error("Error revoking access:",E),ge.error(E.response?.data?.error||"Failed to revoke access")}},A=u.filter(T=>T.is_active),P=u.filter(T=>!T.is_active);return i.jsxs(rr,{maxWidth:"xl",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.jsx(xr,{onClick:()=>e(-1),children:i.jsx(Hp,{})}),i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Mobile User Access Management"})]}),i.jsxs(dt,{direction:"row",spacing:2,children:[i.jsx(xe,{variant:"contained",onClick:()=>h(!0),startIcon:i.jsx(Va,{}),children:"Grant Access"}),i.jsx(xe,{variant:"outlined",onClick:b,startIcon:i.jsx(Es,{}),children:"Refresh"})]})]}),i.jsxs(ie,{container:!0,spacing:3,sx:{mb:4},children:[i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(qr,{children:i.jsxs(Wr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Mobile Users"}),i.jsx(B,{variant:"h4",children:o.length})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(qr,{children:i.jsxs(Wr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Available Profiles"}),i.jsx(B,{variant:"h4",children:l.length})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(qr,{children:i.jsxs(Wr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Active Access"}),i.jsx(B,{variant:"h4",color:"success.main",children:A.length})]})})}),i.jsx(ie,{item:!0,xs:12,sm:6,md:3,children:i.jsx(qr,{children:i.jsxs(Wr,{children:[i.jsx(B,{color:"textSecondary",gutterBottom:!0,children:"Revoked Access"}),i.jsx(B,{variant:"h4",color:"text.secondary",children:P.length})]})})})]}),t?i.jsx(Z,{display:"flex",justifyContent:"center",p:3,children:i.jsx(tr,{})}):i.jsxs(i.Fragment,{children:[i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Active Profile Access"}),A.length===0?i.jsx(Ot,{severity:"info",children:'No active profile access assignments. Click "Grant Access" to get started.'}):i.jsx(pa,{children:i.jsxs(Jn,{children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{children:"Mobile User"}),i.jsx(Ae,{children:"Profile"}),i.jsx(Ae,{children:"Granted By"}),i.jsx(Ae,{children:"Granted At"}),i.jsx(Ae,{children:"Actions"})]})}),i.jsx(ea,{children:A.map(T=>i.jsxs(hr,{children:[i.jsx(Ae,{children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:T.user_email}),i.jsx(st,{label:T.user_role,size:"small",color:"primary",variant:"outlined"})]})}),i.jsx(Ae,{children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:T.profile_name}),i.jsx(B,{variant:"caption",color:"textSecondary",children:T.profile_email})]})}),i.jsx(Ae,{children:i.jsx(B,{variant:"body2",children:T.granted_by_email||"System"})}),i.jsx(Ae,{children:i.jsx(B,{variant:"body2",children:new Date(T.granted_at).toLocaleDateString()})}),i.jsx(Ae,{children:i.jsx(xr,{color:"error",onClick:()=>w(T.id),title:"Revoke Access",children:i.jsx(ma,{})})})]},T.id))})]})})]})}),P.length>0&&i.jsx(bt,{sx:{width:"100%",overflow:"hidden"},children:i.jsxs(Z,{sx:{p:2},children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Revoked Profile Access"}),i.jsx(pa,{children:i.jsxs(Jn,{children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{children:"Mobile User"}),i.jsx(Ae,{children:"Profile"}),i.jsx(Ae,{children:"Revoked At"})]})}),i.jsx(ea,{children:P.map(T=>i.jsxs(hr,{children:[i.jsx(Ae,{children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:T.user_email}),i.jsx(st,{label:T.user_role,size:"small",color:"default",variant:"outlined"})]})}),i.jsx(Ae,{children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:T.profile_name}),i.jsx(B,{variant:"caption",color:"textSecondary",children:T.profile_email})]})}),i.jsx(Ae,{children:i.jsx(B,{variant:"body2",children:new Date(T.updated_at).toLocaleDateString()})})]},T.id))})]})})]})})]}),i.jsxs(pr,{open:f,onClose:()=>h(!1),maxWidth:"sm",fullWidth:!0,children:[i.jsx(mr,{children:i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(Va,{}),"Grant Profile Access"]})}),i.jsx(gr,{children:i.jsxs(dt,{spacing:3,sx:{mt:1},children:[i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Mobile User"}),i.jsx(cn,{value:p,onChange:T=>v(Number(T.target.value)),label:"Mobile User",children:o.map(T=>i.jsx(Zt,{value:T.id,children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:T.email}),i.jsx(B,{variant:"caption",color:"textSecondary",children:T.access_role})]})},T.id))})]}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Profile"}),i.jsx(cn,{value:m,onChange:T=>y(Number(T.target.value)),label:"Profile",children:l.map(T=>i.jsx(Zt,{value:T.id,children:i.jsxs(Z,{children:[i.jsx(B,{variant:"body2",fontWeight:"bold",children:T.name}),i.jsx(B,{variant:"caption",color:"textSecondary",children:T.email})]})},T.id))})]})]})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:()=>h(!1),children:"Cancel"}),i.jsx(xe,{onClick:_,variant:"contained",disabled:n||!p||!m,startIcon:n?i.jsx(tr,{size:20}):i.jsx(ac,{}),children:n?"Granting...":"Grant Access"})]})]})]})};var hh={},JE;function Zfe(){if(JE)return hh;JE=1;var e=sr();Object.defineProperty(hh,"__esModule",{value:!0}),hh.default=void 0;var t=e(cr()),r=lr();return hh.default=(0,t.default)((0,r.jsx)("path",{d:"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20zm-6 8h-4v-2h4zm0-4h-4v-2h4z"}),"BugReport"),hh}var ehe=Zfe();const the=Et(ehe);var ph={},ZE;function rhe(){if(ZE)return ph;ZE=1;var e=sr();Object.defineProperty(ph,"__esModule",{value:!0}),ph.default=void 0;var t=e(cr()),r=lr();return ph.default=(0,t.default)((0,r.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 16H8v-2h8zm0-4H8v-2h8zm-3-5V3.5L18.5 9z"}),"Description"),ph}var nhe=rhe();const ahe=Et(nhe),eI=[{value:"gmail",label:"Gmail",host:"smtp.gmail.com",port:587,secure:!1},{value:"outlook",label:"Outlook/Hotmail",host:"smtp-mail.outlook.com",port:587,secure:!1},{value:"yahoo",label:"Yahoo",host:"smtp.mail.yahoo.com",port:587,secure:!1},{value:"icloud",label:"iCloud",host:"smtp.mail.me.com",port:587,secure:!1},{value:"titan",label:"Titan Email",host:"smtp.titan.email",port:465,secure:!0},{value:"custom",label:"Custom SMTP",host:"",port:587,secure:!1}],ihe=()=>{const e=Tn(),[t,r]=x.useState({email_provider:"gmail",email_host:"smtp.gmail.com",email_port:587,email_secure:!1,email_user:"",email_from:""}),[n,a]=x.useState(""),[o,s]=x.useState(!1),[l,c]=x.useState(!1),[u,d]=x.useState(!1),[f,h]=x.useState("unknown");x.useEffect(()=>{p()},[]);const p=async()=>{try{const A=await ve.get("/api/email/user-settings");if(A.data.success&&A.data.settings){const P=A.data.settings;r({email_provider:P.email_provider,email_host:P.email_host,email_port:P.email_port,email_secure:P.email_secure,email_user:P.email_user,email_from:P.email_from||P.email_user}),d(!0)}}catch(A){console.error("Error loading user email settings:",A)}},v=async()=>{if(!t.email_host||!t.email_port||!t.email_user){ge.error("Please fill in all required fields");return}u&&!n&&ge.info("Password field is empty - keeping existing password"),s(!0);try{const A={...t,...n&&{email_pass:n}},P=await ve.post("/api/email/user-settings",A);P.data.success?(ge.success("Email settings saved successfully!"),d(!0),a(""),h("unknown")):ge.error(P.data.message||"Failed to save email settings")}catch(A){console.error("Error saving email settings:",A),ge.error(A.response?.data?.message||"Failed to save email settings")}finally{s(!1)}},m=async()=>{if(!u){ge.error("Please save your email settings first");return}c(!0);try{const A=await ve.post("/api/email/test-user-connection");A.data.success?(h("connected"),ge.success("Email connection test successful!")):(h("failed"),ge.error(A.data.message||"Email connection test failed"))}catch(A){console.error("Error testing email connection:",A),h("failed"),ge.error(A.response?.data?.message||"Email connection test failed")}finally{c(!1)}},y=A=>{const P=eI.find(T=>T.value===A);P&&r(T=>({...T,email_provider:A,email_host:P.host,email_port:P.port,email_secure:P.secure}))},b=(A,P)=>{r(T=>({...T,[A]:P}))},_=()=>{switch(f){case"connected":return"success";case"failed":return"error";default:return"info"}},w=()=>{switch(f){case"connected":return"Connected";case"failed":return"Connection Failed";default:return"Not Tested"}};return i.jsxs(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:[i.jsxs(Z,{sx:{display:"flex",alignItems:"center",mb:3},children:[i.jsx(yS,{sx:{mr:2,fontSize:32}}),i.jsx(B,{variant:"h4",component:"h1",children:"My Email Settings"})]}),i.jsx(Ot,{severity:"info",sx:{mb:3},children:"Configure your personal email settings to send emails from your own email account. These settings are private to your account and will be used when you send emails from the system."}),i.jsxs(Ot,{severity:"warning",sx:{mb:3},children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:i.jsx("strong",{children:"Important for Gmail users:"})}),i.jsxs(B,{variant:"body2",children:[`If you're using Gmail with 2-Factor Authentication, you need to use an "App Password" instead of your regular password.`,i.jsx("br",{})," Go to ",i.jsx("a",{href:"https://myaccount.google.com/apppasswords",target:"_blank",rel:"noopener noreferrer",children:"Google App Passwords"}),i.jsx("br",{}),' Generate an app password for "Mail"',i.jsx("br",{}),' Use that 16-character password in the "App Password" field below']})]}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,md:8,children:i.jsxs(qr,{children:[i.jsxs(Wr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Email Configuration"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{select:!0,label:"Email Provider",value:t.email_provider,onChange:A=>y(A.target.value),fullWidth:!0,helperText:"Select your email provider or choose Custom for other SMTP servers",children:eI.map(A=>i.jsx(Zt,{value:A.value,children:A.label},A.value))})}),i.jsx(ie,{item:!0,xs:12,sm:8,children:i.jsx(Pe,{label:"SMTP Host",value:t.email_host,onChange:A=>b("email_host",A.target.value),fullWidth:!0,required:!0,disabled:t.email_provider!=="custom"})}),i.jsx(ie,{item:!0,xs:12,sm:4,children:i.jsx(Pe,{label:"SMTP Port",type:"number",value:t.email_port,onChange:A=>b("email_port",parseInt(A.target.value)),fullWidth:!0,required:!0,disabled:t.email_provider!=="custom"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(ti,{control:i.jsx(hl,{checked:t.email_secure,onChange:A=>b("email_secure",A.target.checked),disabled:t.email_provider!=="custom"}),label:"Use SSL/TLS (usually for port 465)"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Email Address",type:"email",value:t.email_user,onChange:A=>b("email_user",A.target.value),fullWidth:!0,required:!0,helperText:"Your email address for authentication"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:u?"Update App Password":"App Password",type:"password",value:n,onChange:A=>a(A.target.value),fullWidth:!0,required:!u,helperText:u?"Leave blank to keep current password, or enter new password to update":"Your email password or app password (for Gmail with 2FA)"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"From Name (Optional)",value:t.email_from,onChange:A=>b("email_from",A.target.value),fullWidth:!0,helperText:"Display name for outgoing emails (defaults to email address)"})})]})]}),i.jsx($h,{children:i.jsx(xe,{variant:"contained",startIcon:o?i.jsx(tr,{size:20}):i.jsx(Is,{}),onClick:v,disabled:o,children:o?"Saving...":"Save Settings"})})]})}),i.jsxs(ie,{item:!0,xs:12,md:4,children:[i.jsxs(qr,{children:[i.jsxs(Wr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Connection Status"}),i.jsx(Ot,{severity:_(),sx:{mb:2},children:w()}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Test your email configuration to ensure it works correctly."})]}),i.jsx($h,{children:i.jsx(xe,{variant:"outlined",startIcon:l?i.jsx(tr,{size:20}):i.jsx(the,{}),onClick:m,disabled:l||!u,fullWidth:!0,children:l?"Testing...":"Test Connection"})})]}),i.jsx(qr,{sx:{mt:2},children:i.jsxs(Wr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Setup Instructions"}),i.jsxs(B,{variant:"body2",sx:{mb:1},children:[i.jsx("strong",{children:"Gmail:"})," Use an App Password instead of your regular password."]}),i.jsxs(B,{variant:"body2",sx:{mb:1},children:[i.jsx("strong",{children:"Outlook:"})," Use an App Password for enhanced security."]}),i.jsxs(B,{variant:"body2",children:[i.jsx("strong",{children:"Other providers:"})," Check your email provider's SMTP settings."]})]})}),i.jsx(qr,{sx:{mt:2,border:"2px solid red"},children:i.jsxs(Wr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Quick Actions"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Manage your email templates and customize email content for different types of communications."}),i.jsx(xe,{fullWidth:!0,variant:"outlined",onClick:()=>e("/email-templates"),startIcon:i.jsx(ahe,{}),sx:{mb:1},color:"primary",children:"Manage Email Templates"})]})})]})]})]})};var mh={},tI;function ohe(){if(tI)return mh;tI=1;var e=sr();Object.defineProperty(mh,"__esModule",{value:!0}),mh.default=void 0;var t=e(cr()),r=lr();return mh.default=(0,t.default)((0,r.jsx)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link"),mh}var she=ohe();const rI=Et(she);var gh={},nI;function lhe(){if(nI)return gh;nI=1;var e=sr();Object.defineProperty(gh,"__esModule",{value:!0}),gh.default=void 0;var t=e(cr()),r=lr();return gh.default=(0,t.default)((0,r.jsx)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8m0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4z"}),"Sync"),gh}var che=lhe();const uhe=Et(che),dhe=e=>{switch(e){case"created_po":return"success";case"needs_review":return"warning";case"processing":return"info";case"error":return"error";default:return"default"}},fhe=()=>{const[e,t]=x.useState(!1),[r,n]=x.useState(!0),[a,o]=x.useState(!1),[s,l]=x.useState(!1),[c,u]=x.useState(""),[d,f]=x.useState(""),[h,p]=x.useState("imap.titan.email"),[v,m]=x.useState(993),[y,b]=x.useState("smtp.titan.email"),[_,w]=x.useState(465),[A,P]=x.useState('unread:true has:attachment subject:invoice subject:inv subject:bill subject:billing subject:receipt subject:facture subject:"tax invoice" subject:"commercial invoice"'),[T,E]=x.useState(20),[S,I]=x.useState(!0),[W,O]=x.useState(!1),[D,R]=x.useState(!0),[F,z]=x.useState([]),[K,J]=x.useState(!1),L=async()=>{n(!0);try{const U=await ve.get("/api/email/titan/status");U.data?.success?t(!!U.data.connected):t(!1)}catch{t(!1)}finally{n(!1)}},k=async()=>{R(!0);try{const U=await ve.get("/api/invoice-automator/ingestions?limit=50");z(Array.isArray(U.data?.ingestions)?U.data.ingestions:[])}catch{ge.error("Failed to load ingestions")}finally{R(!1)}};x.useEffect(()=>{L().finally(()=>k())},[]);const $=async()=>{o(!0);try{const U={email:c,password:d,hostImap:h,portImap:v,hostSmtp:y,portSmtp:_},te=await ve.post("/api/email/connect/titan",U);te.data?.success?(ge.success("Titan connected"),f(""),await L()):ge.error(te.data?.message||"Failed to connect Titan")}catch(U){ge.error(U?.response?.data?.message||"Failed to connect Titan")}finally{o(!1)}},X=async()=>{l(!0);try{const U=await ve.post("/api/email/disconnect");U.data?.success?(ge.success("Disconnected"),await L()):ge.error(U.data?.message||"Failed to disconnect")}catch(U){ge.error(U?.response?.data?.message||"Failed to disconnect")}finally{l(!1)}},C=async()=>{O(!0);try{const U=await ve.post("/api/invoice-automator/titan/sync",{query:A,maxMessages:T,autoCreatePurchaseOrders:S});U.data?.success?(ge.success(`Synced: ${U.data.processedAttachments||0} attachments, ${U.data.createdPurchaseOrders||0} POs created`),await k()):ge.error(U.data?.message||"Sync failed")}catch(U){ge.error(U?.response?.data?.message||"Sync failed")}finally{O(!1)}},M=async U=>{try{const te=await ve.post(`/api/invoice-automator/ingestions/${U.id}/create-po`,{});te.data?.success?(ge.success("Purchase order created"),await k()):ge.error(te.data?.message||"Failed to create purchase order")}catch(te){ge.error(te?.response?.data?.message||"Failed to create purchase order")}},H=x.useMemo(()=>K?F:F.filter(U=>!String(U.status||"").startsWith("rejected")),[F,K]);return i.jsxs(Z,{p:3,children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Invoice Automator"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Connect a Titan mailbox, scan invoice attachments, run OCR, and create purchase orders automatically when the vendor can be matched."}),i.jsxs(ie,{container:!0,spacing:3,children:[i.jsxs(ie,{item:!0,xs:12,md:5,children:[i.jsxs(qr,{children:[i.jsxs(Wr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Titan Connection"}),i.jsx(Ot,{severity:e?"success":"warning",sx:{mb:2},children:r?"Checking...":e?"Connected":"Not connected"}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Email",value:c,onChange:U=>u(U.target.value),fullWidth:!0,disabled:e})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Password",type:"password",value:d,onChange:U=>f(U.target.value),fullWidth:!0,disabled:e,helperText:e?"Disconnect to update credentials":"Your Titan mailbox password"})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"IMAP Host",value:h,onChange:U=>p(U.target.value),fullWidth:!0,disabled:e})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"IMAP Port",type:"number",value:v,onChange:U=>m(Number(U.target.value)),fullWidth:!0,disabled:e})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"SMTP Host",value:y,onChange:U=>b(U.target.value),fullWidth:!0,disabled:e})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"SMTP Port",type:"number",value:_,onChange:U=>w(Number(U.target.value)),fullWidth:!0,disabled:e})})]})]}),i.jsx($h,{children:e?i.jsx(xe,{variant:"outlined",color:"warning",startIcon:s?i.jsx(tr,{size:18}):i.jsx(rI,{}),onClick:X,disabled:s,children:s?"Disconnecting...":"Disconnect"}):i.jsx(xe,{variant:"contained",startIcon:a?i.jsx(tr,{size:18}):i.jsx(rI,{}),onClick:$,disabled:a||!c||!d,children:a?"Connecting...":"Connect Titan"})})]}),i.jsx(qr,{sx:{mt:2},children:i.jsxs(Wr,{children:[i.jsx(B,{variant:"h6",gutterBottom:!0,children:"Sync Settings"}),i.jsx(Pe,{label:"Titan Search Query",value:A,onChange:U=>P(U.target.value),fullWidth:!0,sx:{mb:2},helperText:'Examples: `unread:true has:attachment subject:invoice`, `from:"billing@vendor.com" unread:true has:attachment subject:invoice`'}),i.jsxs(ie,{container:!0,spacing:2,children:[i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(Pe,{label:"Max Messages",type:"number",value:T,onChange:U=>E(Number(U.target.value)),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,sm:6,children:i.jsx(ti,{control:i.jsx(hl,{checked:S,onChange:U=>I(U.target.checked)}),label:"Auto-create POs"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(ti,{control:i.jsx(hl,{checked:K,onChange:U=>J(U.target.checked)}),label:"Show rejected statements"})})]}),i.jsx(qn,{sx:{my:2}}),i.jsx(xe,{variant:"contained",startIcon:W?i.jsx(tr,{size:18}):i.jsx(uhe,{}),onClick:C,disabled:!e||W,fullWidth:!0,children:W?"Syncing...":"Sync Inbox"})]})})]}),i.jsx(ie,{item:!0,xs:12,md:7,children:i.jsx(qr,{children:i.jsxs(Wr,{children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[i.jsx(B,{variant:"h6",children:"Recent Ingestions"}),i.jsx(xe,{size:"small",onClick:k,disabled:D,children:"Refresh"})]}),D?i.jsx(Z,{display:"flex",justifyContent:"center",py:4,children:i.jsx(tr,{})}):H.length===0?i.jsx(Ot,{severity:"info",children:"No ingestions yet. Connect Titan and run a sync."}):i.jsx(Z,{display:"flex",flexDirection:"column",gap:1,children:H.map(U=>{const te=U.ocr_normalized,le=te?.vendorName,oe=te?.billNumber,ae=te?.vendorMatch?.status==="existing"?te?.vendorMatch?.vendorId:null,he=te?.documentType==="invoice",me=he&&!U.purchase_id&&(U.status==="needs_review"||U.status==="processed")&&ae;return i.jsxs(qr,{variant:"outlined",children:[i.jsxs(Wr,{sx:{pb:1},children:[i.jsxs(Z,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:U.attachment_filename||"attachment"}),i.jsx(st,{size:"small",label:U.status,color:dhe(U.status)})]}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:[U.subject||"(no subject)","  ",U.from_address||"unknown sender"]}),i.jsxs(B,{variant:"body2",sx:{mt:1},children:["Vendor: ",le||"","  Bill: ",oe||""]}),U.error?i.jsx(Ot,{severity:"error",sx:{mt:1},children:U.error}):null]}),i.jsxs($h,{sx:{pt:0},children:[U.purchase_id?i.jsx(xe,{size:"small",component:zI,to:`/open-purchase-orders/${U.purchase_id}`,startIcon:i.jsx($w,{}),children:"Open PO"}):i.jsx(xe,{size:"small",variant:"contained",onClick:()=>M(U),disabled:!me,startIcon:i.jsx($w,{}),children:"Create PO"}),!ae&&he?i.jsx(B,{variant:"caption",color:"text.secondary",children:"Vendor not matched (add vendor, then re-sync)"}):null]})]},U.id)})})]})})})]})]})},hhe=()=>{const{user:e}=ta(),[t,r]=x.useState([]),[n,a]=x.useState(!0),[o,s]=x.useState(!1),[l,c]=x.useState(null),[u,d]=x.useState({name:"",type:"purchase_order",subject:"",html_content:"",text_content:"",is_default:!1}),[f,h]=x.useState(""),[p,v]=x.useState("");x.useEffect(()=>{m()},[]);const m=async()=>{try{a(!0);const T=await ve.get("/api/email/templates");T.data.success&&r(T.data.templates)}catch(T){console.error("Error loading templates:",T),h("Failed to load email templates")}finally{a(!1)}},y=T=>{T?(c(T),d({name:T.name,type:T.type,subject:T.subject,html_content:T.html_content,text_content:T.text_content||"",is_default:T.is_default})):(c(null),d({name:"",type:"purchase_order",subject:"",html_content:"",text_content:"",is_default:!1})),s(!0)},b=()=>{s(!1),c(null),d({name:"",type:"purchase_order",subject:"",html_content:"",text_content:"",is_default:!1})},_=async()=>{try{l?(await ve.put(`/api/email/templates/${l.id}`,u),v("Email template updated successfully")):(await ve.post("/api/email/templates",u),v("Email template created successfully")),b(),m()}catch(T){console.error("Error saving template:",T),h(T.response?.data?.message||"Failed to save template")}},w=async T=>{if(window.confirm("Are you sure you want to delete this template?"))try{await ve.delete(`/api/email/templates/${T}`),v("Email template deleted successfully"),m()}catch(E){console.error("Error deleting template:",E),h(E.response?.data?.message||"Failed to delete template")}},A=T=>{switch(T){case"purchase_order":return"primary";case"sales_order":return"success";case"quote":return"warning";case"custom":return"info";default:return"default"}},P=T=>{switch(T){case"purchase_order":return"Purchase Order";case"sales_order":return"Sales Order";case"quote":return"Quote";case"custom":return"Custom";default:return T}};return n?i.jsx(rr,{maxWidth:"lg",children:i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Loading..."})}):i.jsxs(rr,{maxWidth:"lg",children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Email Templates"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Ev,{}),onClick:()=>y(),children:"Create Template"})]}),i.jsx(ie,{container:!0,spacing:3,children:t.map(T=>i.jsx(ie,{item:!0,xs:12,md:6,lg:4,children:i.jsx(qr,{children:i.jsxs(Wr,{children:[i.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[i.jsx(B,{variant:"h6",component:"div",children:T.name}),i.jsxs(Z,{children:[i.jsx(xr,{size:"small",onClick:()=>y(T),color:"primary",children:i.jsx(Ep,{})}),i.jsx(xr,{size:"small",onClick:()=>w(T.id),color:"error",children:i.jsx(Id,{})})]})]}),i.jsx(st,{label:P(T.type),color:A(T.type),size:"small",sx:{mb:1}}),T.is_default&&i.jsx(st,{label:"Default",color:"secondary",size:"small",sx:{ml:1}}),i.jsxs(B,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[i.jsx("strong",{children:"Subject:"})," ",T.subject]}),i.jsxs(B,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[i.jsx("strong",{children:"Created:"})," ",new Date(T.created_at).toLocaleDateString()]}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:[i.jsx("strong",{children:"Updated:"})," ",new Date(T.updated_at).toLocaleDateString()]})]})})},T.id))}),t.length===0&&i.jsxs(Z,{sx:{textAlign:"center",mt:4},children:[i.jsx(B,{variant:"h6",color:"text.secondary",children:"No email templates found"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Create your first email template to get started"})]}),i.jsxs(pr,{open:o,onClose:b,maxWidth:"md",fullWidth:!0,children:[i.jsx(mr,{children:l?"Edit Email Template":"Create Email Template"}),i.jsx(gr,{children:i.jsxs(Z,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[i.jsx(Pe,{label:"Template Name",value:u.name,onChange:T=>d({...u,name:T.target.value}),fullWidth:!0,required:!0}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{children:"Template Type"}),i.jsxs(cn,{value:u.type,onChange:T=>d({...u,type:T.target.value}),label:"Template Type",children:[i.jsx(Zt,{value:"purchase_order",children:"Purchase Order"}),i.jsx(Zt,{value:"sales_order",children:"Sales Order"}),i.jsx(Zt,{value:"quote",children:"Quote"}),i.jsx(Zt,{value:"custom",children:"Custom"})]})]}),i.jsx(Pe,{label:"Subject",value:u.subject,onChange:T=>d({...u,subject:T.target.value}),fullWidth:!0,required:!0}),i.jsx(Pe,{label:"HTML Content",value:u.html_content,onChange:T=>d({...u,html_content:T.target.value}),fullWidth:!0,multiline:!0,rows:8,required:!0,helperText:"Use HTML formatting for rich email content"}),i.jsx(Pe,{label:"Text Content (Optional)",value:u.text_content,onChange:T=>d({...u,text_content:T.target.value}),fullWidth:!0,multiline:!0,rows:4,helperText:"Plain text version for email clients that don't support HTML"}),i.jsx(ti,{control:i.jsx(hl,{checked:u.is_default,onChange:T=>d({...u,is_default:T.target.checked})}),label:"Set as default template for this type"})]})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:b,children:"Cancel"}),i.jsx(xe,{onClick:_,variant:"contained",children:l?"Update":"Create"})]})]}),i.jsx(pl,{open:!!f,autoHideDuration:6e3,onClose:()=>h(""),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>h(""),severity:"error",sx:{width:"100%"},children:f})}),i.jsx(pl,{open:!!p,autoHideDuration:6e3,onClose:()=>v(""),anchorOrigin:{vertical:"top",horizontal:"center"},children:i.jsx(Ot,{onClose:()=>v(""),severity:"success",sx:{width:"100%"},children:p})})]})};var ig={exports:{}},phe=ig.exports,aI;function mhe(){return aI||(aI=1,function(e,t){(function(r,n){e.exports=n()})(phe,function(){return function(r,n,a){r=r||{};var o=n.prototype,s={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function l(u,d,f,h){return o.fromToBase(u,d,f,h)}a.en.relativeTime=s,o.fromToBase=function(u,d,f,h,p){for(var v,m,y,b=f.$locale().relativeTime||s,_=r.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],w=_.length,A=0;A<w;A+=1){var P=_[A];P.d&&(v=h?a(u).diff(f,P.d,!0):f.diff(u,P.d,!0));var T=(r.rounding||Math.round)(Math.abs(v));if(y=v>0,T<=P.r||!P.r){T<=1&&A>0&&(P=_[A-1]);var E=b[P.l];p&&(T=p(""+T)),m=typeof E=="string"?E.replace("%d",T):E(T,d,P.l,y);break}}if(d)return m;var S=y?b.future:b.past;return typeof S=="function"?S(m):S.replace("%s",m)},o.to=function(u,d){return l(u,d,this,!0)},o.from=function(u,d){return l(u,d,this)};var c=function(u){return u.$u?a.utc():a()};o.toNow=function(u){return this.to(c(this),u)},o.fromNow=function(u){return this.from(c(this),u)}}})}(ig)),ig.exports}var ghe=mhe();const vR=Et(ghe),og={async fetchMessages(e,t){return(await ve.get(`/api/tasks/${e}/messages`,{params:t?{after:t}:void 0})).data},async postMessage(e,t){return(await ve.post(`/api/tasks/${e}/messages`,t)).data},async markMessagesRead(e,t){return(await ve.post(`/api/tasks/${e}/messages/mark-read`,{lastMessageId:t})).data},async getTaskDetail(e){return(await ve.get(`/api/tasks/${e}`)).data}};Rt.extend(vR);const yR=e=>[...e].sort((t,r)=>{const n=new Date(t.createdAt).getTime(),a=new Date(r.createdAt).getTime();return n===a?t.id-r.id:n-a}),vhe=(e,t)=>{if(!t.length)return{merged:e,appended:[]};const r=new Map;e.forEach(o=>r.set(o.id,o));const n=[];return t.forEach(o=>{r.has(o.id)||n.push(o),r.set(o.id,o)}),{merged:yR(Array.from(r.values())),appended:n}},yhe=({taskId:e,pollIntervalMs:t=15e3,onUnreadChange:r})=>{const{user:n}=ta(),a=x.useMemo(()=>{if(!n?.id)return null;const C=Number(n.id);return Number.isFinite(C)?C:null},[n?.id]),[o,s]=x.useState([]),[l,c]=x.useState(null),[u,d]=x.useState(0),[f,h]=x.useState(!0),[p,v]=x.useState(!1),[m,y]=x.useState(!1),[b,_]=x.useState(""),[w,A]=x.useState(null),[P,T]=x.useState(null),E=x.useRef(null),S=x.useRef(null),I=x.useRef(!0),W=x.useRef(null),O=x.useCallback(C=>{d(C),r?.(C)},[r]),D=x.useCallback((C=!1)=>{const M=E.current;M&&M.scrollTo({top:M.scrollHeight,behavior:C?"smooth":"auto"})},[]),R=x.useCallback(()=>{const C=E.current;return C?C.scrollHeight-C.scrollTop-C.clientHeight<=120:!0},[]),F=x.useCallback(async C=>{try{const M=await og.markMessagesRead(e,C??void 0);c(M.participant),O(M.unreadCount)}catch(M){console.warn("Failed to update read state for task chat",M)}},[O,e]),z=x.useCallback(C=>{!C.length||I.current||C.filter(M=>M.sender?.userId&&a&&M.sender.userId!==a).forEach(M=>{const H=M.sender?.name||"Task teammate";ge.info(`New message from ${H}`)})},[a]),K=x.useCallback((C,M=!1)=>{const H=R();let U=[],te=W.current;return s(le=>{if(M){const he=yR(C);return U=he,te=he.length?he[he.length-1].id:null,he}const{merged:oe,appended:ae}=vhe(le,C);return U=ae,te=oe.length?oe[oe.length-1].id:te,oe}),te!=null&&(W.current==null||te>W.current)&&(W.current=te),U.length?(z(U),H&&setTimeout(()=>D(!0),50)):H&&M&&setTimeout(()=>D(!0),50),{appended:U,latestId:te}},[z,D,R]),J=x.useCallback(async C=>{try{C?.initial?h(!0):T(null);const M=C?.forceFull?void 0:W.current??void 0,H=await og.fetchMessages(e,M);c(H.participant),A(H.lastSyncedAt);const{appended:U,latestId:te}=K(H.messages,!!C?.initial||C?.forceFull);O(H.unreadCount),(H.unreadCount>0||U.length>0)&&te!=null&&await F(te),C?.initial&&(I.current=!1)}catch(M){console.error("Failed to load task messages",M);const H=M?.response?.data?.message||"Unable to load task messages.";T(H),C?.initial&&ge.error(H)}finally{C?.initial&&h(!1)}},[K,F,O,e]);x.useEffect(()=>(I.current=!0,W.current=null,s([]),c(null),O(0),J({initial:!0,forceFull:!0}).catch(()=>{}),()=>{S.current&&(clearInterval(S.current),S.current=null)}),[J,O,e]),x.useEffect(()=>{if(S.current&&clearInterval(S.current),!(t<=0))return S.current=setInterval(()=>{J({forceFull:!1}).catch(()=>{})},t),()=>{S.current&&(clearInterval(S.current),S.current=null)}},[J,t]);const L=x.useCallback(async C=>{if(C.preventDefault(),!!b.trim())try{y(!0);const M=await og.postMessage(e,{content:b.trim()});c(M.participant),O(M.unreadCount),K([M.message]),W.current=M.message.id,_(""),setTimeout(()=>D(!0),50)}catch(M){console.error("Failed to send message",M),ge.error(M?.response?.data?.message||"Failed to send message")}finally{y(!1)}},[K,b,O,D,e]),k=x.useCallback(async()=>{try{v(!0),await J({forceFull:!0})}finally{v(!1)}},[J]),$=x.useMemo(()=>w?`Updated ${Rt(w).fromNow()}`:"Not synced yet",[w]),X=C=>{const M=!!(C.metadata&&C.metadata.agent||C.isSystem),H=!M&&a!=null&&C.sender?.userId===a,U=M?"System":H?"You":C.sender?.name||"Team member",te=Rt(C.createdAt).format("MMM D, YYYY h:mm A");return i.jsxs(Z,{display:"flex",flexDirection:"column",alignItems:H?"flex-end":"flex-start",mb:2,children:[i.jsx(Z,{sx:{maxWidth:"80%",bgcolor:M?"rgba(25, 118, 210, 0.08)":H?"primary.main":"grey.100",color:M?"text.primary":H?"primary.contrastText":"text.primary",px:2,py:1,borderRadius:2,boxShadow:1,border:M?"1px solid":void 0,borderColor:M?"info.light":void 0},children:i.jsx(B,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:C.content})}),i.jsxs(B,{variant:"caption",color:"text.secondary",sx:{mt:.5},children:[U,"  ",te]})]},C.id)};return i.jsxs(bt,{elevation:2,sx:{display:"flex",flexDirection:"column",height:"100%"},children:[i.jsxs(Z,{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,py:1.5,children:[i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(B,{variant:"h6",children:"Task chat"}),i.jsx(Qw,{color:"secondary",badgeContent:u,invisible:u===0,children:i.jsx(st,{label:"Unread",size:"small",variant:u?"filled":"outlined"})})]}),i.jsxs(Z,{display:"flex",alignItems:"center",gap:1,children:[w&&i.jsx(B,{variant:"caption",color:"text.secondary",children:$}),i.jsx(Hn,{title:"Refresh conversation",children:i.jsx("span",{children:i.jsx(xr,{onClick:k,disabled:p||f,size:"small",children:p?i.jsx(tr,{size:18}):i.jsx(Es,{fontSize:"small"})})})})]})]}),i.jsx(qn,{}),i.jsx(Z,{ref:E,flex:1,overflow:"auto",px:2,py:2,children:f?i.jsx(Z,{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",children:i.jsx(tr,{size:32})}):P?i.jsx(B,{color:"error",variant:"body2",children:P}):o.length===0?i.jsx(Z,{textAlign:"center",color:"text.secondary",children:i.jsx(B,{variant:"body2",children:"No messages yet. Start the conversation below."})}):o.map(C=>X(C))}),i.jsx(qn,{}),i.jsxs(Z,{component:"form",onSubmit:L,display:"flex",gap:1,px:2,py:1.5,children:[i.jsx(Pe,{value:b,onChange:C=>_(C.target.value),placeholder:"Write a message",fullWidth:!0,minRows:2,maxRows:4,multiline:!0,disabled:m}),i.jsx(xe,{type:"submit",variant:"contained",endIcon:m?i.jsx(tr,{color:"inherit",size:18}):i.jsx(yN,{}),disabled:m||b.trim().length===0,children:"Send"})]})]})};Rt.extend(vR);const xhe=()=>{const{id:e}=Ms(),t=x.useMemo(()=>{if(!e)return NaN;const v=Number(e);return Number.isFinite(v)?v:NaN},[e]),[r,n]=x.useState(null),[a,o]=x.useState(!0),[s,l]=x.useState(null),[c,u]=x.useState(0),d=x.useCallback(async()=>{if(!Number.isFinite(t)){l("Invalid task identifier"),o(!1);return}try{o(!0),l(null);const v=await og.getTaskDetail(t);n(v)}catch(v){console.error("Failed to load task details",v);const m=v?.response?.data?.message||"Unable to load task details.";l(m),ge.error(m)}finally{o(!1)}},[t]);x.useEffect(()=>{d()},[d]);const f=x.useCallback(v=>{u(v)},[]);if(!Number.isFinite(t))return i.jsx(Z,{p:3,children:i.jsx(B,{color:"error",children:"Invalid task identifier."})});if(a)return i.jsx(Z,{p:3,display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40vh",children:i.jsx(tr,{})});if(s)return i.jsx(Z,{p:3,children:i.jsx(B,{color:"error",children:s})});if(!r)return null;const{task:h,participants:p}=r;return i.jsxs(Z,{p:3,display:"flex",flexDirection:"column",gap:3,children:[i.jsxs(Z,{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,justifyContent:"space-between",children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:h.title}),i.jsxs(Z,{display:"flex",flexWrap:"wrap",gap:1,alignItems:"center",children:[i.jsx(st,{label:h.status,color:h.status==="completed"?"success":"default"}),i.jsx(st,{label:`Priority: ${h.priority??"N/A"}`,variant:"outlined"}),h.dueDate&&i.jsx(st,{label:`Due ${Rt(h.dueDate).format("MMM D, YYYY")}`,color:"warning"}),c>0&&i.jsx(st,{label:`${c} unread`,color:"secondary"})]})]}),i.jsxs(Z,{textAlign:{xs:"left",md:"right"},color:"text.secondary",children:[h.updatedAt&&i.jsxs(B,{variant:"body2",children:["Updated ",Rt(h.updatedAt).format("MMM D, YYYY h:mm A")]}),h.createdAt&&i.jsxs(B,{variant:"body2",children:["Created ",Rt(h.createdAt).format("MMM D, YYYY h:mm A")]})]})]}),h.description&&i.jsxs(bt,{variant:"outlined",sx:{p:2},children:[i.jsx(B,{variant:"subtitle1",gutterBottom:!0,children:"Description"}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{whiteSpace:"pre-wrap"},children:h.description})]}),i.jsxs(ie,{container:!0,spacing:3,alignItems:"stretch",children:[i.jsx(ie,{item:!0,xs:12,md:4,children:i.jsxs(bt,{variant:"outlined",sx:{p:2,height:"100%"},children:[i.jsx(B,{variant:"subtitle1",gutterBottom:!0,children:"Participants"}),p.length===0?i.jsx(B,{variant:"body2",color:"text.secondary",children:"No participants assigned."}):i.jsx(Z,{display:"flex",flexDirection:"column",gap:1.5,children:p.map(v=>{const m=(v.name||v.email||"T")[0]?.toUpperCase();return i.jsxs(Z,{display:"flex",alignItems:"center",gap:1.5,children:[i.jsx(kp,{sx:{bgcolor:"primary.main"},children:m}),i.jsxs(Z,{flex:1,children:[i.jsx(B,{variant:"body2",children:v.name||"Unnamed user"}),i.jsxs(B,{variant:"caption",color:"text.secondary",display:"block",children:[v.email||"No email","  ",v.role||"Participant"]}),v.lastReadAt&&i.jsxs(B,{variant:"caption",color:"text.secondary",display:"block",children:["Read ",Rt(v.lastReadAt).fromNow()]})]})]},v.id)})})]})}),i.jsx(ie,{item:!0,xs:12,md:8,children:i.jsx(yhe,{taskId:t,onUnreadChange:f})})]})]})},iI=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}],bhe=({filters:e,assignees:t,onChange:r,onReset:n})=>{const a=c=>{const u=c.target.value,d=typeof u=="string"?u.split(","):u;r({...e,status:d.filter(Boolean)})},o=c=>{const u=c.target.value;r({...e,assignedTo:u?Number(u):void 0})},s=c=>u=>{r({...e,[c]:u.target.value||void 0})},l=c=>u=>{r({...e,[c]:u.target.checked})};return i.jsx(bt,{variant:"outlined",sx:{p:{xs:2.5,md:3},borderRadius:3,backgroundColor:"background.paper"},children:i.jsxs(dt,{direction:{xs:"column",lg:"row"},spacing:2,useFlexGap:!0,flexWrap:"wrap",alignItems:{xs:"stretch",lg:"flex-end"},children:[i.jsxs(tn,{sx:{minWidth:180,flex:"1 1 200px"},size:"small",children:[i.jsx(ln,{id:"task-status-label",children:"Status"}),i.jsx(cn,{labelId:"task-status-label",multiple:!0,value:e.status??[],onChange:a,input:i.jsx(NI,{label:"Status"}),renderValue:c=>c.map(u=>iI.find(d=>d.value===u)?.label??u).join(", "),children:iI.map(c=>i.jsxs(Zt,{value:c.value,children:[i.jsx(Qi,{checked:e.status?.includes(c.value)??!1}),i.jsx(Qn,{primary:c.label})]},c.value))})]}),i.jsxs(tn,{sx:{minWidth:180,flex:"1 1 200px"},size:"small",children:[i.jsx(ln,{id:"task-assigned-label",children:"Assigned to"}),i.jsxs(cn,{labelId:"task-assigned-label",value:e.assignedTo?String(e.assignedTo):"",label:"Assigned to",onChange:o,children:[i.jsx(Zt,{value:"",children:i.jsx("em",{children:"All team members"})}),t.map(c=>i.jsx(Zt,{value:c.id,children:c.username||c.email},c.id))]})]}),i.jsx(Pe,{label:"Search",size:"small",value:e.search??"",onChange:s("search"),sx:{flex:"1 1 200px"}}),i.jsx(Pe,{label:"Due from",type:"date",size:"small",value:e.dueFrom?.slice(0,10)??"",onChange:s("dueFrom"),InputLabelProps:{shrink:!0},sx:{flex:"1 1 180px"}}),i.jsx(Pe,{label:"Due to",type:"date",size:"small",value:e.dueTo?.slice(0,10)??"",onChange:s("dueTo"),InputLabelProps:{shrink:!0},sx:{flex:"1 1 180px"}}),i.jsxs(Z,{sx:{display:"flex",flexDirection:"column",gap:1,flex:"1 1 220px"},children:[i.jsx(ti,{control:i.jsx(Qi,{checked:e.includeCompleted??!1,onChange:l("includeCompleted")}),label:"Show completed"}),i.jsx(ti,{control:i.jsx(Qi,{checked:e.includeArchived??!1,onChange:l("includeArchived")}),label:"Show archived"})]}),n&&i.jsx(Z,{sx:{display:"flex",alignItems:"center"},children:i.jsx(xe,{variant:"text",onClick:n,color:"secondary",children:"Reset"})})]})})};var vh={},oI;function _he(){if(oI)return vh;oI=1;var e=sr();Object.defineProperty(vh,"__esModule",{value:!0}),vh.default=void 0;var t=e(cr()),r=lr();return vh.default=(0,t.default)((0,r.jsx)("path",{d:"M3 18h12v-2H3zM3 6v2h18V6zm0 7h18v-2H3z"}),"Notes"),vh}var whe=_he();const sI=Et(whe);var yh={},lI;function jhe(){if(lI)return yh;lI=1;var e=sr();Object.defineProperty(yh,"__esModule",{value:!0}),yh.default=void 0;var t=e(cr()),r=lr();return yh.default=(0,t.default)([(0,r.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),(0,r.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"Schedule"),yh}var She=jhe();const Che=Et(She),xR=({completed:e,disabled:t,onToggle:r,label:n})=>{const a=o=>{r(o.target.checked)};return i.jsx(Hn,{title:e?"Mark as incomplete":"Mark as completed",children:i.jsx(ti,{control:i.jsx(hl,{checked:e,onChange:a,disabled:t,color:"success",size:"small"}),label:n??(e?"Completed":"Mark complete")})})},Ahe={pending:"Pending",in_progress:"In Progress",completed:"Completed",archived:"Archived"},Phe={pending:"warning",in_progress:"info",completed:"success",archived:"default"},bR=e=>e?new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric",year:"numeric"}).format(new Date(e)):"No due date",M2=typeof Intl<"u"&&"RelativeTimeFormat"in Intl?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null,cI=e=>{if(!e)return"Never";const t=new Date(e);if(Number.isNaN(t.getTime())||!M2)return bR(e);const r=t.getTime()-Date.now(),n=Math.abs(r),a=[["day",1e3*60*60*24],["hour",1e3*60*60],["minute",1e3*60]];for(const[o,s]of a)if(n>=s||o==="minute"){const l=Math.round(r/s);return M2.format(l,o)}return M2.format(0,"minute")},Ohe=({tasks:e,onSelect:t,onToggleComplete:r,onEdit:n,onDelete:a})=>e.length===0?i.jsxs(Z,{textAlign:"center",py:6,color:"text.secondary",sx:{border:"1px dashed",borderColor:"divider",borderRadius:3,backgroundColor:"background.paper"},children:[i.jsx(sI,{sx:{fontSize:48,mb:1}}),i.jsx(B,{variant:"h6",children:"No tasks found"}),i.jsx(B,{variant:"body2",children:"Use the New task button above to create your first assignment."})]}):i.jsx(dt,{spacing:2.5,children:e.map(o=>{const s=o.dueDate?new Date(o.dueDate):null,l=Date.now(),c=!!(s&&s.getTime()<l&&o.status!=="completed"),u=s&&o.status!=="completed"?Math.ceil((s.getTime()-l)/(1e3*60*60*24)):null,d=typeof u=="number"&&u>=0&&u<=3,f=c?"error.main":o.status==="completed"?"success.main":d?"warning.main":"info.main";return i.jsxs(qr,{elevation:0,sx:{position:"relative",borderRadius:3,border:"1px solid",borderColor:"divider",overflow:"hidden",transition:"all 0.2s ease-in-out",backgroundColor:"background.paper","&:hover":{boxShadow:8,transform:"translateY(-2px)"}},children:[i.jsx(Z,{sx:{position:"absolute",top:0,left:0,bottom:0,width:6,bgcolor:f}}),i.jsx(M8,{onClick:()=>t(o),sx:{alignSelf:"stretch"},children:i.jsx(Z,{sx:{p:{xs:2.5,sm:3}},children:i.jsxs(dt,{spacing:2,children:[i.jsxs(dt,{direction:{xs:"column",md:"row"},spacing:1.5,justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},children:[i.jsx(B,{variant:"h6",children:o.title}),i.jsxs(dt,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",useFlexGap:!0,children:[i.jsx(st,{label:Ahe[o.status],color:Phe[o.status],size:"small"}),c&&o.status!=="completed"&&i.jsx(st,{label:"Overdue",color:"error",size:"small",variant:"outlined"}),o.status==="completed"&&i.jsx(st,{label:`Completed ${cI(o.completedAt)}`,color:"success",size:"small",variant:"outlined"})]})]}),o.description&&i.jsx(B,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:o.description}),i.jsxs(dt,{direction:{xs:"column",md:"row"},spacing:2,justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},children:[i.jsxs(dt,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:[i.jsx(st,{icon:i.jsx(BL,{fontSize:"small"}),label:bR(o.dueDate),color:c?"error":d?"warning":"default",variant:o.dueDate?"filled":"outlined",size:"small"}),i.jsx(st,{icon:i.jsx(sI,{fontSize:"small"}),label:`${o.noteCount} note${o.noteCount===1?"":"s"}`,size:"small",variant:"outlined"}),i.jsx(st,{icon:i.jsx(Che,{fontSize:"small"}),label:`Updated ${cI(o.updatedAt)}`,size:"small",variant:"outlined"})]}),o.assignees.length>0?i.jsx(L8,{max:4,sx:{"& .MuiAvatar-root":{width:32,height:32,fontSize:14}},children:o.assignees.map(h=>i.jsx(Hn,{title:h.username||h.email,children:i.jsx(kp,{children:(h.username||h.email||"?").charAt(0).toUpperCase()})},`${o.id}-assignee-${h.id}`))}):i.jsx(st,{label:"Unassigned",size:"small",variant:"outlined"})]})]})})}),i.jsx(qn,{}),i.jsxs($h,{sx:{px:{xs:2,sm:3},py:1.5,justifyContent:"space-between",alignItems:"center"},children:[i.jsx(Z,{onClick:h=>h.stopPropagation(),sx:{display:"flex",alignItems:"center"},children:i.jsx(xR,{completed:o.status==="completed",onToggle:h=>r(o,h),label:o.status==="completed"?"Completed":"Mark complete"})}),i.jsxs(dt,{direction:"row",spacing:1.5,alignItems:"center",children:[i.jsx(Hn,{title:"Edit task",children:i.jsx(xr,{onClick:h=>{h.stopPropagation(),n(o)},children:i.jsx(tu,{})})}),i.jsx(Hn,{title:"Delete task",children:i.jsx(xr,{color:"error",onClick:h=>{h.stopPropagation(),a(o)},children:i.jsx(ma,{})})})]})]})]},o.id)})}),xh=e=>e?new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric"}).format(new Date(e)):"Not set",khe=({open:e,task:t,loading:r,onClose:n,onEdit:a,onToggleComplete:o,onAddNote:s})=>{const[l,c]=x.useState(""),[u,d]=x.useState(!1),[f,h]=x.useState(!1);x.useEffect(()=>{e||(c(""),d(!1),h(!1))},[e]);const p=async()=>{if(l.trim()){d(!0);try{await s(l.trim()),c("")}finally{d(!1)}}},v=async m=>{h(!0);try{await o(m)}finally{h(!1)}};return i.jsxs(pr,{open:e,onClose:n,fullWidth:!0,maxWidth:"md",children:[i.jsxs(mr,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsx(B,{variant:"h6",children:"Task details"}),i.jsx(xr,{onClick:n,children:i.jsx(oj,{})})]}),i.jsx(gr,{dividers:!0,children:r&&!t?i.jsx(B,{variant:"body2",children:"Loading task details"}):t?i.jsxs(dt,{spacing:3,children:[i.jsxs(Z,{children:[i.jsxs(dt,{direction:"row",spacing:2,alignItems:"center",flexWrap:"wrap",children:[i.jsx(B,{variant:"h5",children:t.title}),i.jsx(st,{label:t.status.replace("_"," "),color:t.status==="completed"?"success":"default"})]}),t.description&&i.jsx(B,{variant:"body1",sx:{mt:1},color:"text.secondary",children:t.description})]}),i.jsxs(dt,{direction:{xs:"column",sm:"row"},spacing:3,children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",children:"Due date"}),i.jsx(B,{variant:"body1",children:xh(t.dueDate)})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",children:"Last updated"}),i.jsx(B,{variant:"body1",children:xh(t.updatedAt)})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",children:"Completed at"}),i.jsx(B,{variant:"body1",children:xh(t.completedAt)})]})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Assigned team members"}),t.assignees.length===0?i.jsx(B,{variant:"body2",color:"text.secondary",children:"No assignees yet."}):i.jsx(dt,{direction:"row",spacing:1,flexWrap:"wrap",children:t.assignees.map(m=>i.jsx(st,{label:m.username||m.email},m.id))})]}),i.jsx(qn,{}),i.jsxs(dt,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:{xs:"flex-start",sm:"center"},children:[i.jsx(xR,{completed:t.status==="completed",onToggle:v,disabled:f}),i.jsx(xe,{variant:"outlined",onClick:a,children:"Edit task"})]}),i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",gutterBottom:!0,children:"Notes"}),t.notes&&t.notes.length>0?i.jsx(ha,{dense:!0,children:t.notes.map(m=>i.jsx(ja,{alignItems:"flex-start",disableGutters:!0,children:i.jsx(Qn,{primary:m.note,secondary:m.authorName?`${m.authorName}  ${xh(m.createdAt)}`:xh(m.createdAt)})},m.id))}):i.jsx(B,{variant:"body2",color:"text.secondary",children:"No notes yet."})]}),i.jsxs(dt,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:{xs:"stretch",sm:"center"},children:[i.jsx(Pe,{label:"Add a note",fullWidth:!0,value:l,onChange:m=>c(m.target.value),multiline:!0,minRows:2}),i.jsx(xe,{variant:"contained",onClick:p,disabled:!l.trim()||u,children:"Add note"})]})]}):i.jsx(B,{variant:"body2",children:"Task not found."})}),i.jsx(jr,{children:i.jsx(xe,{onClick:n,children:"Close"})})]})},The=[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}],Ehe=e=>{if(!e)return"";try{const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toISOString().slice(0,10)}catch{return""}},Ihe=({open:e,mode:t,initialTask:r,assignees:n,submitting:a,onClose:o,onSubmit:s})=>{const[l,c]=x.useState(""),[u,d]=x.useState(""),[f,h]=x.useState(""),[p,v]=x.useState("pending"),[m,y]=x.useState([]),[b,_]=x.useState(""),[w,A]=x.useState({});x.useEffect(()=>{e&&(t==="edit"&&r?(c(r.title),d(r.description??""),h(Ehe(r.dueDate)),v(r.status),y(r.assignees.map(S=>S.id))):(c(""),d(""),h(""),v("pending"),y([])),_(""),A({}))},[e,t,r]);const P=x.useMemo(()=>[...n].sort((S,I)=>(S.username||S.email||"").localeCompare(I.username||I.email||"")),[n]),T=async()=>{const S=l.trim();if(!S){A({title:"Title is required"});return}const I=u.trim(),W={title:S,description:I.length>0?I:null,dueDate:f?new Date(f).toISOString():null,status:p,assigneeIds:m};t==="create"&&b.trim()&&(W.initialNote=b.trim()),await s(W)},E=t==="create"?"Create task":"Edit task";return i.jsxs(pr,{open:e,onClose:o,fullWidth:!0,maxWidth:"sm",children:[i.jsx(mr,{children:E}),i.jsx(gr,{children:i.jsxs(dt,{spacing:3,sx:{mt:1},children:[i.jsx(Pe,{label:"Title",value:l,onChange:S=>c(S.target.value),error:!!w.title,helperText:w.title,required:!0,autoFocus:!0}),i.jsx(Pe,{label:"Description",value:u,onChange:S=>d(S.target.value),multiline:!0,minRows:3}),i.jsx(Pe,{label:"Due date",type:"date",value:f,onChange:S=>h(S.target.value),InputLabelProps:{shrink:!0}}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{id:"task-status-select",children:"Status"}),i.jsx(cn,{labelId:"task-status-select",value:p,label:"Status",onChange:S=>v(S.target.value),children:The.map(S=>i.jsx(Zt,{value:S.value,children:S.label},S.value))})]}),i.jsxs(tn,{fullWidth:!0,children:[i.jsx(ln,{id:"task-assignees-label",children:"Assign to"}),i.jsx(cn,{labelId:"task-assignees-label",multiple:!0,value:m.map(String),onChange:S=>{const I=S.target.value,W=typeof I=="string"?I.split(","):I;y(W.map(O=>Number(O)).filter(O=>!Number.isNaN(O)))},input:i.jsx(NI,{label:"Assign to"}),renderValue:S=>{const I=S;return I.length===0?"No assignees":I.map(W=>{const O=P.find(D=>D.id===Number(W));return O?.username||O?.email||W}).join(", ")},children:P.map(S=>i.jsx(Zt,{value:String(S.id),children:i.jsx(Qn,{primary:S.username||S.email})},S.id))})]}),t==="create"&&i.jsxs(Z,{children:[i.jsx(B,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Initial note (optional)"}),i.jsx(Pe,{placeholder:"Share context with your team",value:b,onChange:S=>_(S.target.value),fullWidth:!0,multiline:!0,minRows:2})]})]})}),i.jsxs(jr,{children:[i.jsx(xe,{onClick:o,disabled:a,children:"Cancel"}),i.jsx(xe,{onClick:T,variant:"contained",disabled:a,children:t==="create"?"Create task":"Save changes"})]})]})};var bh={},uI;function Nhe(){if(uI)return bh;uI=1;var e=sr();Object.defineProperty(bh,"__esModule",{value:!0}),bh.default=void 0;var t=e(cr()),r=lr();return bh.default=(0,t.default)((0,r.jsx)("path",{d:"M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V10h14zM9 14H7v-2h2zm4 0h-2v-2h2zm4 0h-2v-2h2zm-8 4H7v-2h2zm4 0h-2v-2h2zm4 0h-2v-2h2z"}),"CalendarMonth"),bh}var Dhe=Nhe();const Mhe=Et(Dhe),Lhe={pending:"Pending",in_progress:"In Progress",completed:"Completed",archived:"Archived"},Rhe={pending:"warning",in_progress:"info",completed:"success",archived:"default"},qhe=({tasks:e,loading:t,onSelectTask:r})=>{const n=x.useMemo(()=>{const h=new Map;return e.forEach(p=>{if(!p.dueDate)return;const v=Rt(p.dueDate);if(!v.isValid())return;const m=v.format("YYYY-MM-DD"),y=h.get(m)??[];y.push(p),h.set(m,y)}),h.forEach(p=>{p.sort((v,m)=>{const y=Rt(v.dueDate??0).valueOf(),b=Rt(m.dueDate??0).valueOf();return y-b})}),h},[e]),a=x.useMemo(()=>{if(n.size===0)return Rt();const h=Rt().format("YYYY-MM-DD");if(n.has(h))return Rt();const p=Array.from(n.keys()).sort()[0];return p?Rt(p):Rt()},[n]),[o,s]=x.useState(a);x.useEffect(()=>{const h=o.format("YYYY-MM-DD");if(n.size===0||n.has(h))return;const p=Rt(),v=p.format("YYYY-MM-DD");if(n.has(v)){s(p);return}const m=Array.from(n.keys()).sort()[0];m&&s(Rt(m))},[o,n]);const l=o.format("YYYY-MM-DD"),c=n.get(l)??[],u=n.size>0,d=Rt(),f=h=>{const p=h.day.format("YYYY-MM-DD"),v=n.get(p)??[],m=v.length>0,y=v.some(b=>b.dueDate&&Rt(b.dueDate).isBefore(d)&&b.status!=="completed");return i.jsx(Qw,{overlap:"circular",variant:m?"dot":"standard",color:y?"error":"primary",anchorOrigin:{vertical:"bottom",horizontal:"right"},children:i.jsx(q8,{...h,sx:{...m?{fontWeight:600}:null}})},p)};return i.jsx(qr,{sx:{borderRadius:3,border:"1px solid",borderColor:"divider",boxShadow:"0 24px 60px -36px rgba(15, 23, 42, 0.35)"},children:i.jsxs(Wr,{sx:{p:{xs:3,md:4}},children:[i.jsxs(dt,{direction:"row",spacing:1.5,alignItems:"center",mb:2,children:[i.jsx(Mhe,{color:"primary"}),i.jsx(B,{variant:"h5",component:"h2",sx:{fontWeight:600},children:"Due date calendar"})]}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Visualize upcoming deadlines and jump directly to the tasks that need your attention."}),i.jsxs(dt,{direction:{xs:"column",lg:"row"},spacing:{xs:3,lg:4},mt:3,alignItems:{xs:"stretch",lg:"flex-start"},children:[i.jsx(R8,{value:o,onChange:h=>h&&s(h),views:["day"],slots:{day:f},sx:{borderRadius:2,border:"1px solid",borderColor:"divider",p:1.5}}),i.jsxs(Z,{sx:{flex:1,width:"100%"},children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:o.format("MMMM D, YYYY")}),t?i.jsx(Z,{display:"flex",justifyContent:"center",py:4,children:i.jsx(tr,{size:28})}):u?c.length===0?i.jsx(Z,{sx:{mt:2,p:3,borderRadius:2,border:"1px dashed",borderColor:"divider",textAlign:"center",color:"text.secondary"},children:i.jsx(B,{variant:"body2",children:"No tasks are due on this day. Select another date to explore upcoming work."})}):i.jsx(dt,{spacing:1.5,mt:2,children:c.map(h=>{const p=Rt(h.dueDate),v=h.dueDate&&p.isBefore(d)&&h.status!=="completed";return i.jsx(Z,{onClick:()=>r?.(h),role:r?"button":void 0,tabIndex:r?0:void 0,onKeyDown:m=>{r&&(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),r(h))},sx:{p:2.25,borderRadius:2,border:"1px solid",borderColor:"divider",backgroundColor:"background.paper",cursor:r?"pointer":"default",transition:"all 0.2s ease-in-out","&:hover":r?{borderColor:"primary.main",boxShadow:3}:void 0},children:i.jsxs(dt,{spacing:1,children:[i.jsx(B,{variant:"subtitle1",sx:{fontWeight:600},children:h.title}),h.description&&i.jsx(B,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:h.description}),i.jsxs(dt,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",useFlexGap:!0,children:[i.jsx(st,{label:Lhe[h.status],color:Rhe[h.status],size:"small"}),v&&i.jsx(st,{label:"Overdue",color:"error",size:"small",variant:"outlined"}),h.dueDate&&i.jsx(st,{label:`Due ${p.format("MMM D, YYYY")}`,color:"info",size:"small",variant:"outlined"})]})]})},h.id)})}):i.jsx(Z,{sx:{mt:2,p:3,borderRadius:2,border:"1px dashed",borderColor:"divider",textAlign:"center",color:"text.secondary"},children:i.jsx(B,{variant:"body2",children:"None of your tasks have due dates yet. Add due dates to see them on the calendar."})})]})]})]})})},dI=e=>[...e].sort((t,r)=>t-r),Fhe=(e,t)=>{if(e.length!==t.length)return!1;const r=dI(e),n=dI(t);return r.every((a,o)=>a===n[o])},fI={includeCompleted:!1,includeArchived:!1},$he=()=>{const[e,t]=x.useState([]),[r,n]=x.useState(fI),[a,o]=x.useState([]),[s,l]=x.useState(null),[c,u]=x.useState(!0),[d,f]=x.useState(null),[h,p]=x.useState(null),[v,m]=x.useState(!1),[y,b]=x.useState(!1),[_,w]=x.useState(!1),[A,P]=x.useState("create"),[T,E]=x.useState(!1),[S,I]=x.useState(null),W=x.useCallback(async()=>{u(!0),f(null);try{const[H,U]=await Promise.all([vne(r),vw()]);t(H),l(U)}catch(H){console.error(H),f("Failed to load tasks. Please try again later.")}finally{u(!1)}},[r]),O=x.useCallback(async()=>{try{const H=await vw();l(H)}catch(H){console.error("Failed to refresh task summary",H)}},[]);x.useEffect(()=>{W()},[W]),x.useEffect(()=>{(async()=>{try{const U=await Cne();o(U)}catch(U){console.error(U),ge.error("Unable to load team members")}})()},[]);const D=H=>{n(H)},R=()=>{n(fI)},F=()=>{W()},z=()=>{P("create"),I(null),w(!0)},K=H=>{P("edit"),I(H),w(!0)},J=async H=>{b(!0);try{const U=await yne(H.id);p(U),m(!0)}catch(U){console.error(U),ge.error("Unable to load task details")}finally{b(!1)}},L=x.useCallback(H=>{t(U=>U.some(le=>le.id===H.id)?U.map(le=>le.id===H.id?{...le,...H}:le):[H,...U])},[]),k=async H=>{try{if(E(!0),A==="create"){const U=await xne({...H,description:H.description??null});ge.success("Task created successfully"),w(!1),I(null),L(U)}else if(A==="edit"&&S){const U=await bne(S.id,{title:H.title,description:H.description??null,status:H.status,dueDate:H.dueDate??null}),te=S.assignees?.map(ae=>ae.id)??[],oe=!Fhe(te,H.assigneeIds)?await _ne(S.id,H.assigneeIds):{...U,assignees:S.assignees};ge.success("Task updated successfully"),w(!1),I(null),L(oe),p(ae=>ae&&ae.id===oe.id?{...ae,...oe,notes:ae.notes}:ae)}await W()}catch(U){console.error(U),ge.error("Failed to save task changes")}finally{E(!1)}},$=async(H,U)=>{try{const te=await wne(H.id,U);L(te),p(le=>le&&le.id===te.id?{...le,...te,notes:le.notes}:le),ge.success(U?"Task marked as completed":"Task reopened"),await O()}catch(te){console.error(te),ge.error("Failed to update task status")}},X=async H=>{if(window.confirm(`Delete task "${H.title}"? This action cannot be undone.`))try{await Sne(H.id),t(te=>te.filter(le=>le.id!==H.id)),h?.id===H.id&&(m(!1),p(null)),ge.success("Task deleted"),await W()}catch(te){console.error(te),ge.error("Failed to delete task")}},C=async H=>{if(h)try{const U=await jne(h.id,H);p(te=>te&&{...te,notes:[U,...te.notes??[]],noteCount:(te.noteCount??0)+1,lastNoteAt:U.createdAt}),t(te=>te.map(le=>le.id===h.id?{...le,noteCount:le.noteCount+1,lastNoteAt:U.createdAt}:le)),ge.success("Note added")}catch(U){console.error(U),ge.error("Failed to add note")}},M=x.useMemo(()=>r,[r]);return i.jsxs(rr,{maxWidth:"lg",sx:{py:4},children:[i.jsxs(dt,{spacing:3,children:[i.jsx(zL,{summary:s,loading:c&&e.length===0,onRefresh:F}),i.jsx(qhe,{tasks:e,loading:c&&e.length===0,onSelectTask:J}),i.jsxs(bt,{sx:{p:{xs:2.5,md:4},borderRadius:3,border:"1px solid",borderColor:"divider",boxShadow:"0 24px 60px -36px rgba(15, 23, 42, 0.45)",background:"linear-gradient(145deg, rgba(15, 118, 110, 0.04) 0%, rgba(30, 64, 175, 0.05) 100%)"},children:[i.jsxs(dt,{direction:{xs:"column",md:"row"},spacing:2,justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",gutterBottom:!0,children:"Tasks"}),i.jsx(B,{variant:"body2",color:"text.secondary",children:"Manage assignments, due dates, and shared notes for your team."})]}),i.jsxs(dt,{direction:"row",spacing:1,children:[i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Es,{}),onClick:F,children:"Refresh"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:z,children:"New task"})]})]}),i.jsx(Z,{sx:{mt:3},children:i.jsx(bhe,{filters:M,assignees:a,onChange:D,onReset:R})}),d&&i.jsx(Ot,{severity:"error",sx:{mt:2},children:d}),i.jsx(Z,{sx:{mt:3},children:c&&e.length===0?i.jsx(Z,{display:"flex",justifyContent:"center",py:6,children:i.jsx(tr,{})}):i.jsx(Ohe,{tasks:e,onSelect:J,onToggleComplete:$,onEdit:K,onDelete:X})})]})]}),i.jsx(khe,{open:v,task:h,loading:y,onClose:()=>m(!1),onEdit:()=>{h&&K(h)},onToggleComplete:H=>h?$(h,H):Promise.resolve(),onAddNote:C}),i.jsx(Ihe,{open:_,mode:A,initialTask:S,assignees:a,submitting:T,onClose:()=>w(!1),onSubmit:k})]})},Bhe=async(e="all")=>(await ve.get("/api/return-orders",{params:{status:e}})).data,Uhe=async e=>(await ve.get(`/api/return-orders/${e}`)).data,zhe=async e=>(await ve.post("/api/return-orders",e)).data,Whe=async(e,t)=>{await ve.put(`/api/return-orders/${e}`,t)},Hhe=async e=>{await ve.delete(`/api/return-orders/${e}`)},Vhe=async e=>(await ve.get(`/api/return-orders/by-purchase/${e}`)).data,Ghe=async(e,t)=>{const n=(await ve.get(`/api/return-orders/purchase/${e}/line-items`,{params:t?{excludeReturnId:t}:void 0})).data;return Array.isArray(n)?n:Array.isArray(n?.items)?n.items:Array.isArray(n?.available_items)?n.available_items:[]},Yhe=e=>{if(!e)return;const t=/filename\*=UTF-8''([^;]+)/i.exec(e);if(t?.[1])try{return decodeURIComponent(t[1])}catch{return t[1]}return/filename="?([^";]+)"?/i.exec(e)?.[1]},Khe=async e=>{try{const t=await ve.get(`/api/return-orders/${e}/pdf`,{responseType:"blob"}),r=new Blob([t.data],{type:"application/pdf"}),n=window.URL.createObjectURL(r),a=Yhe(t.headers["content-disposition"])||`return-order-${e}.pdf`,o=document.createElement("a");return o.href=n,o.setAttribute("download",a),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(n),!0}catch(t){return console.error("Failed to download return order PDF",t),!1}},Qhe=[{label:"All",value:"all"},{label:"Return Requested",value:"Requested"},{label:"Returned",value:"Returned"}],Xhe=()=>{const[e,t]=x.useState("Requested"),[r,n]=x.useState(""),[a,o]=x.useState([]),[s,l]=x.useState(!1),[c,u]=x.useState(null),d=Tn(),f=x.useCallback(async()=>{l(!0);try{const m=await Bhe(e);o(m)}catch(m){console.error("Failed to load return orders",m),o([])}finally{l(!1)}},[e]);x.useEffect(()=>{f()},[f]);const h=x.useMemo(()=>{if(!r)return a;const m=r.toLowerCase();return a.filter(y=>y.return_number?.toLowerCase().includes(m)||y.purchase_number?.toLowerCase().includes(m)||y.vendor_name?.toLowerCase().includes(m))},[a,r]),p=x.useCallback(async m=>{if(window.confirm(`Delete return order ${m.return_number}? This will restore any associated inventory adjustments.`)){u(m.return_id);try{await Hhe(m.return_id),ge.success(`Return order ${m.return_number} deleted.`),await f()}catch(b){console.error("Failed to delete return order",b);const _=b?.response?.data?.error||"Failed to delete return order.";ge.error(_)}finally{u(null)}}},[f]),v=[{field:"return_number",headerName:"Return #",flex:1,minWidth:150,renderCell:m=>i.jsx(B,{color:"primary",sx:{cursor:"pointer"},children:m.value})},{field:"purchase_number",headerName:"Purchase Order",flex:1,minWidth:150,renderCell:m=>i.jsx(B,{color:"primary",sx:{cursor:"pointer"},children:m.value||"-"})},{field:"vendor_name",headerName:"Vendor",flex:1.3,minWidth:160,valueGetter:m=>m.value||"No Vendor"},{field:"status",headerName:"Status",flex:.8,minWidth:130,renderCell:m=>i.jsx(st,{label:m.value,color:m.value==="Returned"?"success":"warning",variant:"outlined",size:"small"})},{field:"requested_at",headerName:"Requested On",flex:.9,minWidth:150,valueFormatter:m=>m.value?Rt(m.value).format("YYYY-MM-DD HH:mm"):""},{field:"returned_at",headerName:"Returned On",flex:.9,minWidth:150,valueFormatter:m=>m.value?Rt(m.value).format("YYYY-MM-DD HH:mm"):""},{field:"total_quantity",headerName:"Total Qty",flex:.6,minWidth:110,type:"number",valueFormatter:m=>Number(m.value??0).toFixed(2)},{field:"actions",headerName:"Actions",sortable:!1,filterable:!1,width:80,renderCell:m=>i.jsx(dt,{direction:"row",spacing:.5,children:i.jsx(xr,{size:"small",color:"error","aria-label":"Delete return order",disabled:c===m.row.return_id,onClick:y=>{y.stopPropagation(),p(m.row)},children:i.jsx(ma,{})})})}];return i.jsx(rr,{maxWidth:"xl",sx:{mt:4},children:i.jsxs(Z,{sx:{mb:4},children:[i.jsx(B,{variant:"h4",component:"h1",gutterBottom:!0,children:"Return Orders"}),i.jsxs(dt,{direction:"row",spacing:2,sx:{mb:2,justifyContent:"flex-end"},children:[i.jsx(xe,{variant:"contained",startIcon:i.jsx(Va,{}),onClick:()=>d("/return-orders/new"),children:"New Return Order"}),i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Es,{}),onClick:f,disabled:s,children:"Refresh"})]}),i.jsx(bt,{sx:{width:"100%",overflow:"hidden",mb:3},children:i.jsxs(Z,{sx:{p:2},children:[i.jsxs(dt,{direction:"row",spacing:3,sx:{mb:3},children:[i.jsx(Pe,{label:"Search",variant:"outlined",value:r,onChange:m=>n(m.target.value),InputProps:{startAdornment:i.jsx(sa,{position:"start",children:i.jsx(fi,{sx:{fontSize:32}})}),sx:{fontSize:22,height:56}},sx:{minWidth:340,maxWidth:400,"& .MuiInputBase-input":{fontSize:22,py:2},"& .MuiInputLabel-root":{fontSize:20}},size:"medium"}),Qhe.map(m=>i.jsx(st,{label:m.label,onClick:()=>t(m.value),color:e===m.value?"primary":"default",sx:{fontSize:18,px:3,py:1.5,minWidth:80,height:44}},m.value))]}),i.jsx(Po,{rows:h,columns:v,loading:s,getRowId:m=>m.return_id,disableRowSelectionOnClick:!0,onRowClick:m=>d(`/return-orders/${m.row.return_id}`),sx:{"& .MuiDataGrid-cell, & .MuiDataGrid-columnHeader, & .MuiDataGrid-columnHeaderTitle":{fontSize:"1.1rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid rgba(224,224,224,1)",cursor:"pointer"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid rgba(224,224,224,1)"},"& .MuiDataGrid-row":{minHeight:"52px !important",maxHeight:"52px !important"},"& .MuiDataGrid-columnHeadersInner":{minHeight:"60px !important",maxHeight:"60px !important"},"& .MuiDataGrid-row:hover":{backgroundColor:"action.hover"},cursor:"pointer"}})]})})]})})};function Jhe(){const e=Ds();return x.useMemo(()=>new URLSearchParams(e.search),[e.search])}const hI=()=>{const{id:e}=Ms(),t=Tn(),r=Jhe(),n=!e||e==="new",[a,o]=x.useState(!0),[s,l]=x.useState(!1),[c,u]=x.useState([]),[d,f]=x.useState(null),[h,p]=x.useState("Requested"),[v,m]=x.useState(""),[y,b]=x.useState(void 0),[_,w]=x.useState(""),[A,P]=x.useState([]),[T,E]=x.useState(null),[S,I]=x.useState(null),[W,O]=x.useState({}),D=x.useCallback(async()=>{try{const X=(await mde({status:"all"})).map(C=>({label:`${C.purchase_number}  ${C.vendor_name??"No Vendor"}`,purchase_id:C.purchase_id,purchase_number:C.purchase_number,vendor_name:C.vendor_name}));return u(X),X}catch($){return console.error("Failed to load purchase orders",$),u([]),[]}},[]),R=x.useCallback(async $=>{try{const X=await Vhe($),C=X.filter(H=>H.status==="Requested").length,M=X.filter(H=>H.status==="Returned").length;O(H=>({...H,[$]:{requested:C,returned:M}}))}catch(X){console.warn("Unable to load return summary for purchase",X)}},[]),F=x.useCallback(async($,X,C)=>{try{const H=(await Ghe($,C))?.map(U=>{const te=X?.find(le=>le.purchase_line_item_id===U.line_item_id);return{purchase_line_item_id:U.line_item_id,part_number:U.part_number,part_description:U.part_description,unit:U.unit,quantityPurchased:U.quantity,returnable_quantity:U.returnable_quantity,already_requested:U.already_requested,inputQuantity:te?String(te.quantity):"",reason:te?.reason??"",selected:!!te}});P(H??[])}catch(M){console.error("Failed to load available return items",M),P([])}},[]);x.useEffect(()=>{(async()=>{const X=await D(),C=r.get("purchaseId");if(!n&&e){try{const M=await Uhe(Number(e));E(M),p(M.status),m(M.requested_by??""),b(M.requested_at),w(M.notes??"");const H={label:`${M.purchase_number||""}  ${M.vendor_name||"No Vendor"}`,purchase_id:M.purchase_id,purchase_number:M.purchase_number||"",vendor_name:M.vendor_name||void 0};f(H),await F(M.purchase_id,M.line_items,M.return_id),await R(M.purchase_id)}catch(M){console.error("Failed to load return order detail",M),I("Unable to load return order.")}finally{o(!1)}return}if(C){const M=Number(C);if(Number.isFinite(M)){const U=(X.length?X:c).find(te=>te.purchase_id===M);U&&(f(U),await F(M),await R(M))}}o(!1)})()},[F,e,n,D,R,r]);const z=async($,X)=>{f(X),X?(await F(X.purchase_id,T?.line_items,T?.return_id??void 0),await R(X.purchase_id)):P([])},K=x.useMemo(()=>A.reduce(($,X)=>{if(!X.selected)return $;const C=parseFloat(X.inputQuantity||"0");return $+(Number.isFinite(C)?C:0)},0),[A]),J=x.useMemo(()=>A.some($=>$.returnable_quantity>0),[A]),L=x.useMemo(()=>A.some($=>$.selected),[A]),k=async()=>{if(I(null),!d){I("Select a purchase order before saving.");return}const $=A.filter(C=>C.selected).map(C=>({purchase_line_item_id:C.purchase_line_item_id,quantity:parseFloat(C.inputQuantity||"0"),reason:C.reason?.trim()?C.reason.trim():void 0,maxQuantity:C.returnable_quantity,part_number:C.part_number})).filter(C=>Number.isFinite(C.quantity)&&C.quantity>0);if($.length===0){I("Select at least one part and enter a quantity to return.");return}for(const C of $)if(C.quantity>(C.maxQuantity??0)+1e-6){I(`Return quantity for part ${C.part_number} exceeds the available quantity.`);return}const X={purchase_id:d.purchase_id,status:h,requested_by:v||void 0,requested_at:y,notes:_||void 0,line_items:$.map(({purchase_line_item_id:C,quantity:M,reason:H})=>({purchase_line_item_id:C,quantity:M,reason:H}))};try{if(l(!0),n){const C=await zhe(X);ge.success(`Return order ${C.return_number} created.`)}else e&&(await Whe(Number(e),{status:X.status,requested_by:X.requested_by,requested_at:X.requested_at,notes:X.notes,line_items:X.line_items}),ge.success("Return order updated."));t("/return-orders")}catch(C){console.error("Failed to save return order",C);const M=C?.response?.data?.error||"Unable to save return order.";I(M),ge.error(M)}finally{l(!1)}};return a?i.jsx(Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:i.jsx(tr,{})}):i.jsx(rr,{maxWidth:"lg",sx:{mt:4,mb:4},children:i.jsxs(dt,{spacing:3,children:[i.jsxs(dt,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[i.jsxs(Z,{children:[i.jsx(B,{variant:"h4",component:"h1",children:n?"Create Return Order":`Return Order ${T?.return_number??""}`}),d&&i.jsxs(dt,{direction:"row",spacing:1,sx:{mt:1},children:[i.jsx(st,{label:`Purchase: ${d.purchase_number}`,color:"primary",variant:"outlined"}),i.jsx(st,{label:`Vendor: ${d.vendor_name??"No Vendor"}`,variant:"outlined",color:"secondary"}),W[d.purchase_id]&&i.jsx(st,{label:`Returns - Requested: ${W[d.purchase_id].requested}  Completed: ${W[d.purchase_id].returned}`,color:"default",variant:"outlined"})]})]}),i.jsxs(dt,{direction:{xs:"column",sm:"row"},spacing:2,children:[i.jsx(xe,{variant:"outlined",startIcon:i.jsx(Hp,{}),onClick:()=>t("/return-orders"),children:"Back to List"}),!n&&e&&i.jsx(xe,{variant:"outlined",startIcon:i.jsx(la,{}),onClick:async()=>{await Khe(Number(e))||ge.error("Failed to download return order PDF. Please try again.")},children:"Download"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:k,disabled:s,children:s?"Saving":"Save & Close"})]})]}),S&&i.jsx(Ot,{severity:"error",children:S}),i.jsx(bt,{sx:{p:3},elevation:1,children:i.jsxs(ie,{container:!0,spacing:3,children:[i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Ra,{options:c,value:d,onChange:z,getOptionLabel:$=>$.label,renderInput:$=>i.jsx(Pe,{...$,label:"Purchase Order",placeholder:"Select purchase order"}),disabled:!n&&!!T})}),i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsxs(Pe,{select:!0,SelectProps:{native:!0},label:"Status",value:h,onChange:$=>p($.target.value),fullWidth:!0,children:[i.jsx("option",{value:"Requested",children:"Requested"}),i.jsx("option",{value:"Returned",children:"Returned"})]})}),i.jsx(ie,{item:!0,xs:12,md:3,children:i.jsx(Pe,{label:"Requested By",value:v,onChange:$=>m($.target.value),fullWidth:!0})}),i.jsx(ie,{item:!0,xs:12,md:6,children:i.jsx(Pe,{label:"Requested At",type:"datetime-local",fullWidth:!0,value:y?Rt(y).format("YYYY-MM-DDTHH:mm"):"",onChange:$=>b($.target.value?new Date($.target.value).toISOString():void 0),helperText:"Optional timestamp for when the return was requested"})}),i.jsx(ie,{item:!0,xs:12,children:i.jsx(Pe,{label:"Notes",value:_,onChange:$=>w($.target.value),multiline:!0,rows:3,fullWidth:!0,placeholder:"Add any notes for the vendor or internal team"})})]})}),i.jsx(bt,{sx:{p:3},elevation:1,children:i.jsxs(dt,{spacing:2,children:[i.jsxs(dt,{direction:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},children:[i.jsx(B,{variant:"h6",children:"Return Line Items"}),i.jsxs(B,{variant:"body2",color:"text.secondary",children:["Total Selected Quantity: ",K.toFixed(2)]})]}),A.length>0&&i.jsx(B,{variant:"body2",color:"text.secondary",children:"Check the boxes to add parts to this return, then adjust the quantity being sent back."}),A.length===0?i.jsx(B,{variant:"body2",color:"text.secondary",children:"Select a purchase order to view parts eligible for return."}):i.jsxs(i.Fragment,{children:[!J&&i.jsx(Ot,{severity:"info",children:"All parts on this purchase order have already been requested for return."}),i.jsx(pa,{sx:{maxHeight:420},children:i.jsxs(Jn,{size:"small",stickyHeader:!0,children:[i.jsx(Zn,{children:i.jsxs(hr,{children:[i.jsx(Ae,{padding:"checkbox",children:"Select"}),i.jsx(Ae,{children:"Part Number"}),i.jsx(Ae,{children:"Description"}),i.jsx(Ae,{align:"right",children:"Purchased"}),i.jsx(Ae,{align:"right",children:"Available"}),i.jsx(Ae,{align:"right",children:"Qty to Return"}),i.jsx(Ae,{children:"Reason"})]})}),i.jsx(ea,{children:A.map($=>{const X=$.returnable_quantity<=0&&!$.selected;return i.jsxs(hr,{hover:!0,selected:$.selected,sx:{"&.Mui-selected":{backgroundColor:C=>C.palette.action.hover}},children:[i.jsx(Ae,{padding:"checkbox",children:i.jsx(Qi,{checked:$.selected,onChange:C=>{const M=C.target.checked;P(H=>H.map(U=>{if(U.purchase_line_item_id!==$.purchase_line_item_id)return U;const te=U.returnable_quantity>0?String(U.returnable_quantity):"";return{...U,selected:M,inputQuantity:M?U.inputQuantity||te:"",reason:M?U.reason:""}}))},disabled:X,inputProps:{"aria-label":`Select ${$.part_number}`}})}),i.jsxs(Ae,{children:[i.jsx(B,{variant:"body2",fontWeight:600,children:$.part_number}),$.unit&&i.jsxs(B,{variant:"caption",color:"text.secondary",display:"block",children:["Unit: ",$.unit]})]}),i.jsx(Ae,{children:i.jsx(B,{variant:"body2",children:$.part_description||"-"})}),i.jsx(Ae,{align:"right",children:i.jsx(B,{variant:"body2",children:$.quantityPurchased.toFixed(2)})}),i.jsxs(Ae,{align:"right",children:[i.jsx(B,{variant:"body2",children:$.returnable_quantity.toFixed(2)}),$.already_requested>0&&i.jsxs(B,{variant:"caption",color:"text.secondary",display:"block",children:["Already requested: ",$.already_requested.toFixed(2)]})]}),i.jsx(Ae,{align:"right",sx:{minWidth:140},children:i.jsx(Pe,{type:"number",size:"small",value:$.inputQuantity,onChange:C=>{const M=C.target.value;P(H=>H.map(U=>{if(U.purchase_line_item_id!==$.purchase_line_item_id)return U;const te=parseFloat(M),le=!Number.isNaN(te)&&te>0;return{...U,inputQuantity:M,selected:le?!0:U.selected}}))},inputProps:{min:0,step:.01,max:$.returnable_quantity},fullWidth:!0,disabled:!$.selected})}),i.jsx(Ae,{sx:{minWidth:200},children:i.jsx(Pe,{size:"small",value:$.reason,onChange:C=>{const M=C.target.value;P(H=>H.map(U=>U.purchase_line_item_id===$.purchase_line_item_id?{...U,reason:M}:U))},placeholder:"Optional",fullWidth:!0,disabled:!$.selected,multiline:!0,minRows:1})})]},$.purchase_line_item_id)})})]})})]}),A.length>0&&!L&&J&&i.jsx(Ot,{severity:"info",children:"Select at least one part to include it in the return order."})]})})]})})};var _h={},pI;function Zhe(){if(pI)return _h;pI=1;var e=sr();Object.defineProperty(_h,"__esModule",{value:!0}),_h.default=void 0;var t=e(cr()),r=lr();return _h.default=(0,t.default)((0,r.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility"),_h}var epe=Zhe();const mI=Et(epe);var wh={},gI;function tpe(){if(gI)return wh;gI=1;var e=sr();Object.defineProperty(wh,"__esModule",{value:!0}),wh.default=void 0;var t=e(cr()),r=lr();return wh.default=(0,t.default)((0,r.jsx)("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"}),"Replay"),wh}var rpe=tpe();const npe=Et(rpe),ape=[{key:"customerPoNumber",label:"Customer PO #"},{key:"quotedPrice",label:"Quoted Price"},{key:"sourceQuote",label:"Source Quote"},{key:"vin",label:"VIN #"},{key:"unitNumber",label:"Unit #"},{key:"vehicleMake",label:"Vehicle Make"},{key:"vehicleModel",label:"Vehicle Model"},{key:"invoiceStatus",label:"Invoice Status"},{key:"wantedByDate",label:"Wanted By Date"},{key:"wantedByTimeOfDay",label:"Wanted By Time of Day"},{key:"productDescription",label:"Product Description"},{key:"terms",label:"Terms"},{key:"mileage",label:"Mileage"}],ipe=[{key:"vin",label:"VIN #"},{key:"productDescription",label:"Product Description"},{key:"unitNumber",label:"Unit #"},{key:"vehicleMake",label:"Vehicle Make"},{key:"vehicleModel",label:"Vehicle Model"},{key:"mileage",label:"Mileage"}],ope=()=>{const{user:e}=ta(),t=e?.access_role==="Admin",[r,n]=x.useState(kd),[a,o]=x.useState(!0),[s,l]=x.useState(!1),[c,u]=x.useState(null),[d,f]=x.useState(null);x.useEffect(()=>{(async()=>{o(!0),u(null);try{const y=await Cv.fetchSettings();n(y)}catch(y){console.error("Failed to load field visibility settings",y),u("Could not load field visibility settings. Using defaults.")}finally{o(!1)}})()},[]);const h=(y,b)=>(_,w)=>{n(A=>({...A,[y]:{...A[y],[b]:w}}))},p=()=>{n(kd),f(null),u(null)},v=async()=>{if(!t){u("Only admins can change field visibility defaults.");return}l(!0),u(null),f(null);try{const y=await Cv.updateSettings(r);n(y),f("Field visibility updated. Users can still adjust their own view within these limits.")}catch(y){console.error("Failed to save field visibility settings",y),u("Failed to save field visibility settings. Please try again.")}finally{l(!1)}},m=(y,b,_,w)=>i.jsxs(bt,{elevation:2,sx:{p:3},children:[i.jsxs(dt,{direction:"row",spacing:1,alignItems:"center",sx:{mb:1},children:[i.jsx(mI,{color:"primary"}),i.jsx(B,{variant:"h6",children:y})]}),i.jsx(B,{variant:"body2",color:"text.secondary",sx:{mb:2},children:b}),i.jsx(ie,{container:!0,spacing:2,children:w.map(A=>i.jsx(ie,{item:!0,xs:12,sm:6,md:4,children:i.jsx(ti,{control:i.jsx(hl,{color:"primary",checked:!!r[_][A.key],onChange:h(_,A.key),disabled:!t}),label:A.label})},A.key))})]});return i.jsxs(rr,{maxWidth:"lg",children:[i.jsxs(dt,{direction:"row",alignItems:"center",spacing:1,sx:{mb:2},children:[i.jsx(mI,{color:"primary"}),i.jsx(B,{variant:"h5",children:"Field Visibility"}),i.jsx(st,{label:"Admin default",color:"primary",size:"small"})]}),i.jsx(B,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Choose which sales order and invoice fields are available to users by default. Users can still hide fields locally with the Customize fields/columns toggles, but cannot turn on anything you disable here."}),c?i.jsx(Ot,{severity:"warning",sx:{mb:2},children:c}):null,d?i.jsx(Ot,{severity:"success",sx:{mb:2},children:d}):null,t?null:i.jsx(Ot,{severity:"info",sx:{mb:2},children:"Only admins can change these defaults. You can view the current configuration below."}),a?i.jsx(Z,{sx:{display:"flex",justifyContent:"center",py:6},children:i.jsx(tr,{})}):i.jsxs(dt,{spacing:3,children:[m("Sales Orders","Toggle which optional fields appear on sales orders. These act as the baseline for all users.","salesOrders",ape),i.jsx(qn,{}),m("Invoices","Toggle which optional fields appear on invoices.","invoices",ipe)]}),i.jsxs(dt,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mt:3},children:[i.jsx(xe,{variant:"outlined",startIcon:i.jsx(npe,{}),onClick:p,disabled:!t||a||s,children:"Reset to defaults"}),i.jsx(xe,{variant:"contained",startIcon:i.jsx(Is,{}),onClick:v,disabled:!t||a||s,children:s?"Saving":"Save"})]})]})},spe=({children:e})=>{const{isAuthenticated:t,user:r}=ta(),a=Ds().pathname;if(!t)return i.jsx(Ou,{to:"/login",replace:!0});if(r?.access_role==="Time Tracking"){if(a==="/"||a==="/dashboard")return i.jsx(Ou,{to:"/attendance",replace:!0});if(a!=="/time-tracking"&&a!=="/attendance"&&a!=="/messaging"&&!a.startsWith("/open-sales-orders")&&!a.startsWith("/worker-sales-orders"))return i.jsx(Ou,{to:"/attendance",replace:!0})}return r?.access_role==="Sales and Purchase"&&!["/","/open-sales-orders","/invoices","/open-purchase-orders","/purchase-order","/return-orders","/parts-to-order","/inventory","/inventory/smart-search","/supply","/service","/email-settings","/tasks","/messaging"].includes(a)&&!a.startsWith("/open-sales-orders/")&&!a.startsWith("/invoices/")&&!a.startsWith("/open-purchase-orders/")&&!a.startsWith("/purchase-order/")&&!a.startsWith("/return-orders/")?i.jsx(Ou,{to:"/",replace:!0}):r?.access_role==="Quotes"&&a!=="/quotes"&&!a.startsWith("/quotes/")&&a!=="/messaging"?i.jsx(Ou,{to:"/quotes",replace:!0}):i.jsx(i.Fragment,{children:e})},lpe=()=>i.jsxs(Fq,{children:[i.jsx(fr,{path:"/login",element:i.jsx(Jre,{})}),i.jsx(fr,{path:"/register",element:i.jsx(Zre,{})}),i.jsxs(fr,{path:"/",element:i.jsx(spe,{children:i.jsx(Xre,{})}),children:[i.jsx(fr,{index:!0,element:i.jsx(ZT,{})}),i.jsx(fr,{path:"dashboard",element:i.jsx(ZT,{})}),i.jsx(fr,{path:"business-profile",element:i.jsx(Vne,{})}),i.jsx(fr,{path:"qbo-account-mapping",element:i.jsx(Kfe,{})}),i.jsx(fr,{path:"customers",element:i.jsx(gae,{})}),i.jsx(fr,{path:"customers/:id",element:i.jsx(Aae,{})}),i.jsx(fr,{path:"products",element:i.jsx(zfe,{})}),i.jsx(fr,{path:"products/:id",element:i.jsx(Bae,{})}),i.jsx(fr,{path:"purchase-order",element:i.jsx(IE,{})}),i.jsx(fr,{path:"purchase-order/:id",element:i.jsx(RE,{})}),i.jsx(fr,{path:"open-purchase-orders",element:i.jsx(IE,{})}),i.jsx(fr,{path:"open-purchase-orders/:id",element:i.jsx(RE,{})}),i.jsx(fr,{path:"return-orders",element:i.jsx(Xhe,{})}),i.jsx(fr,{path:"return-orders/new",element:i.jsx(hI,{})}),i.jsx(fr,{path:"return-orders/:id",element:i.jsx(hI,{})}),i.jsx(fr,{path:"vendors",element:i.jsx(Fae,{})}),i.jsx(fr,{path:"vendors/:id",element:i.jsx($ae,{})}),i.jsx(fr,{path:"inventory",element:i.jsx(nie,{})}),i.jsx(fr,{path:"inventory/smart-search",element:i.jsx(zue,{})}),i.jsx(fr,{path:"supply",element:i.jsx(aie,{})}),i.jsx(fr,{path:"service",element:i.jsx(iie,{})}),i.jsx(fr,{path:"employees",element:i.jsx(Hue,{})}),i.jsx(fr,{path:"profile-documents",element:i.jsx(Vue,{})}),i.jsx(fr,{path:"time-tracking",element:i.jsx(ffe,{})}),i.jsx(fr,{path:"attendance",element:i.jsx(Vfe,{})}),i.jsx(fr,{path:"time-tracking/reports",element:i.jsx(Efe,{})}),i.jsx(fr,{path:"leave-management",element:i.jsx(Ffe,{})}),i.jsx(fr,{path:"leave-history",element:i.jsx($fe,{})}),i.jsx(fr,{path:"vacation-days-management",element:i.jsx(Bfe,{})}),i.jsx(fr,{path:"open-sales-orders",element:i.jsx(ide,{})}),i.jsx(fr,{path:"open-sales-orders/:id",element:i.jsx(pde,{})}),i.jsx(fr,{path:"invoices",element:i.jsx(Ede,{})}),i.jsx(fr,{path:"invoices/:id",element:i.jsx(Nde,{})}),i.jsx(fr,{path:"worker-sales-orders",element:i.jsx(HE,{})}),i.jsx(fr,{path:"worker-sales-orders/:id",element:i.jsx(HE,{})}),i.jsx(fr,{path:"quotes",element:i.jsx(cle,{})}),i.jsx(fr,{path:"quotes/new",element:i.jsx(pE,{})}),i.jsx(fr,{path:"quotes/:id",element:i.jsx(pE,{})}),i.jsx(fr,{path:"margin-schedule",element:i.jsx(Gue,{})}),i.jsx(fr,{path:"overhead-management",element:i.jsx(Qfe,{})}),i.jsx(fr,{path:"parts-to-order",element:i.jsx(Xfe,{})}),i.jsx(fr,{path:"tasks",element:i.jsx($he,{})}),i.jsx(fr,{path:"backup-management",element:i.jsx(Hfe,{})}),i.jsx(fr,{path:"field-visibility",element:i.jsx(ope,{})}),i.jsx(fr,{path:"mobile-user-access",element:i.jsx(Jfe,{})}),i.jsx(fr,{path:"email-settings",element:i.jsx(ihe,{})}),i.jsx(fr,{path:"invoice-automator",element:i.jsx(fhe,{})}),i.jsx(fr,{path:"email-templates",element:i.jsx(hhe,{})}),i.jsx(fr,{path:"tasks/:id",element:i.jsx(xhe,{})}),i.jsx(fr,{path:"messaging",element:i.jsx(wue,{})})]}),i.jsx(fr,{path:"*",element:i.jsx(Ou,{to:"/",replace:!0})})]}),cpe=()=>{const[e,t]=x.useState(0),[r,n]=x.useState(!!window.__backendUnavailableSince),[a,o]=x.useState(typeof navigator<"u"?navigator.onLine===!1:!1),s=x.useRef(0),l=x.useRef(r),c=x.useRef(a);return x.useEffect(()=>{l.current=r},[r]),x.useEffect(()=>{c.current=a},[a]),x.useEffect(()=>{window.__triggerSync=async()=>{try{await Sh()>0&&!window.__backendUnavailableSince&&!l.current&&!c.current&&(await F5(),t(await Sh()))}catch{}};let u=!0;const d=async()=>{try{const h=await Sh();if(u&&t(h),!window.__backendUnavailableSince&&!l.current&&!c.current&&h>0){await F5();const p=await Sh();u&&t(p)}}catch{}},f=setInterval(d,15e3);return d(),()=>{u=!1,clearInterval(f)}},[]),x.useEffect(()=>{const u=()=>Date.now(),d=()=>{const b=s.current||0,_=u();return _-b<3e3?!1:(s.current=_,!0)},f=()=>{o(!0),d()&&ge.warn("You appear to be offline. We will retry automatically.")},h=()=>{o(!1),n(!1),d()&&ge.success("Connection restored.")},p=()=>{n(!0),d()&&ge.error("Cannot reach the server. We will keep retrying.")},v=()=>{n(!1)},m=b=>{const _=b?.detail;_?.message&&d()&&ge.error(_.message)},y=()=>{d()&&ge.error("Session expired. Please sign in again.")};return window.addEventListener("offline",f),window.addEventListener("online",h),window.addEventListener("backend:unavailable",p),window.addEventListener("backend:available",v),window.addEventListener("app:error",m),window.addEventListener("auth:expired",y),()=>{window.removeEventListener("offline",f),window.removeEventListener("online",h),window.removeEventListener("backend:unavailable",p),window.removeEventListener("backend:available",v),window.removeEventListener("app:error",m),window.removeEventListener("auth:expired",y)}},[a]),i.jsxs(F8,{theme:E$,children:[i.jsx($8,{}),i.jsx(O$,{children:i.jsx(T$,{children:i.jsxs(Os,{dateAdapter:oc,children:[i.jsx(Vq,{children:i.jsx(lpe,{})}),i.jsx(Wne,{position:"top-right",autoClose:3e3,newestOnTop:!1,closeOnClick:!0,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"colored"})]})})})]})};H8.createRoot(document.getElementById("root")).render(i.jsx(cpe,{}));export{Ht as _};
